{"pr_number": 909, "pr_title": "RDM-8051 Log and audit: log audit events in Data Store", "pr_createdAt": "2020-04-17T12:16:34Z", "pr_url": "https://github.com/hmcts/ccd-data-store-api/pull/909", "timeline": [{"oid": "f81c5535903883da902691ef7eff25c5cc6e922f", "url": "https://github.com/hmcts/ccd-data-store-api/commit/f81c5535903883da902691ef7eff25c5cc6e922f", "message": "RDM-8051 - review comment - extracted to a property though it won't differ and change so often.", "committedDate": "2020-04-23T12:49:07Z", "type": "commit"}, {"oid": "f5809a96c716bde53ddf8428349c0e79d5d6694e", "url": "https://github.com/hmcts/ccd-data-store-api/commit/f5809a96c716bde53ddf8428349c0e79d5d6694e", "message": "RDM-8051 Change UPDATE_CASE_ACCESS AuditOperationType label", "committedDate": "2020-04-23T12:54:49Z", "type": "commit"}, {"oid": "fad408366224f98d414258711f3fdcf7a7fa084a", "url": "https://github.com/hmcts/ccd-data-store-api/commit/fad408366224f98d414258711f3fdcf7a7fa084a", "message": "Merge branch 'RDM-8051' into RDM-8051-v1\n\n# Conflicts:\n#\tsrc/main/java/uk/gov/hmcts/ccd/auditlog/AuditOperationType.java", "committedDate": "2020-04-23T12:56:19Z", "type": "commit"}, {"oid": "2af44c4c90fb9d6de1445a6deb39c81dbf9e3bf8", "url": "https://github.com/hmcts/ccd-data-store-api/commit/2af44c4c90fb9d6de1445a6deb39c81dbf9e3bf8", "message": "RDM-8051 Change AuditOperationType access labels", "committedDate": "2020-04-23T12:57:12Z", "type": "commit"}, {"oid": "6b2b7d1e2e0136f8c8e20cef4e54f86ada7d9063", "url": "https://github.com/hmcts/ccd-data-store-api/commit/6b2b7d1e2e0136f8c8e20cef4e54f86ada7d9063", "message": "RDM-8051 Fix few bugs", "committedDate": "2020-04-24T10:57:30Z", "type": "commit"}, {"oid": "d8789e6517040eb09868268098193516d25a2521", "url": "https://github.com/hmcts/ccd-data-store-api/commit/d8789e6517040eb09868268098193516d25a2521", "message": "RDM-8051 - test checkStyle fixes", "committedDate": "2020-04-24T11:08:57Z", "type": "commit"}, {"oid": "51732ed4f9d0a8c4e3906453f703cc544b6e3b20", "url": "https://github.com/hmcts/ccd-data-store-api/commit/51732ed4f9d0a8c4e3906453f703cc544b6e3b20", "message": "RDM-8051 Remove LogAudit on internal v2 event-triggers", "committedDate": "2020-04-24T11:39:23Z", "type": "commit"}, {"oid": "239c2587c530189d8904337eb1db50269133442e", "url": "https://github.com/hmcts/ccd-data-store-api/commit/239c2587c530189d8904337eb1db50269133442e", "message": "Merge branch 'develop' into RDM-8051", "committedDate": "2020-04-24T11:42:24Z", "type": "commit"}, {"oid": "58f221985505179591301f7916e1e5fccdef37e5", "url": "https://github.com/hmcts/ccd-data-store-api/commit/58f221985505179591301f7916e1e5fccdef37e5", "message": "Merge branch 'RDM-8051' into RDM-8051-v1\n\n# Conflicts:\n#\tsrc/test/java/uk/gov/hmcts/ccd/v2/internal/controller/UIStartTriggerControllerCaseRolesIT.java", "committedDate": "2020-04-27T08:22:24Z", "type": "commit"}, {"oid": "5b7b2249f6b54b518269108fee2734071a43a973", "url": "https://github.com/hmcts/ccd-data-store-api/commit/5b7b2249f6b54b518269108fee2734071a43a973", "message": "RDM-8051 fix checkstyle", "committedDate": "2020-04-27T08:41:39Z", "type": "commit"}, {"oid": "2b3510b690d45e362c267b3bd34239c993b694a1", "url": "https://github.com/hmcts/ccd-data-store-api/commit/2b3510b690d45e362c267b3bd34239c993b694a1", "message": "RDM-8051 Change the user to fix the func test.", "committedDate": "2020-04-27T11:22:39Z", "type": "commit"}, {"oid": "ca58c53c7e00eb7b903c550407f0dabe6a2ac706", "url": "https://github.com/hmcts/ccd-data-store-api/commit/ca58c53c7e00eb7b903c550407f0dabe6a2ac706", "message": "RDM-8051 - added feature toggle for audit-log", "committedDate": "2020-04-27T12:55:42Z", "type": "commit"}, {"oid": "af3ca9dbe481523d09e145acefff8b5edf3b8fde", "url": "https://github.com/hmcts/ccd-data-store-api/commit/af3ca9dbe481523d09e145acefff8b5edf3b8fde", "message": "RDM-8051 Default the USER_PROFILE_HOST", "committedDate": "2020-04-27T13:11:02Z", "type": "commit"}, {"oid": "913a21b579a731f6fa8a5c2f69543d267a533647", "url": "https://github.com/hmcts/ccd-data-store-api/commit/913a21b579a731f6fa8a5c2f69543d267a533647", "message": "Merge branch 'develop' into RDM-8051", "committedDate": "2020-04-27T19:23:25Z", "type": "commit"}, {"oid": "c3e158bdb634c02ef6a918c39a2c0e66a5affad0", "url": "https://github.com/hmcts/ccd-data-store-api/commit/c3e158bdb634c02ef6a918c39a2c0e66a5affad0", "message": "Merge branch 'RDM-8051' into RDM-8051-v1", "committedDate": "2020-04-27T19:49:48Z", "type": "commit"}, {"oid": "00bba1e5fe42f60da30af3963939aeb2bcfe41ce", "url": "https://github.com/hmcts/ccd-data-store-api/commit/00bba1e5fe42f60da30af3963939aeb2bcfe41ce", "message": "RDM-8051 add jurisdiction to LogAudit in CaseAccessEndpoint", "committedDate": "2020-04-28T15:23:50Z", "type": "commit"}, {"oid": "815d7859a94e7fa547d8f78da97f58ba0de0b993", "url": "https://github.com/hmcts/ccd-data-store-api/commit/815d7859a94e7fa547d8f78da97f58ba0de0b993", "message": "RDM-8051 operationOutcome to operationalOutcome", "committedDate": "2020-04-28T18:46:08Z", "type": "commit"}, {"oid": "088d9d4228e54a14aa48a4ddba71d580b8565d0e", "url": "https://github.com/hmcts/ccd-data-store-api/commit/088d9d4228e54a14aa48a4ddba71d580b8565d0e", "message": "Merge branch 'develop' into RDM-8051\n\n# Conflicts:\n#\tsrc/main/java/uk/gov/hmcts/ccd/endpoint/ui/QueryEndpoint.java\n#\tsrc/main/java/uk/gov/hmcts/ccd/v2/internal/controller/UICaseController.java\n#\tsrc/main/java/uk/gov/hmcts/ccd/v2/internal/controller/UIDefinitionController.java\n#\tsrc/main/java/uk/gov/hmcts/ccd/v2/internal/controller/UIStartTriggerController.java\n#\tsrc/test/java/uk/gov/hmcts/ccd/BaseTest.java\n#\tsrc/test/java/uk/gov/hmcts/ccd/v2/internal/controller/UICaseControllerCaseRolesIT.java", "committedDate": "2020-05-06T13:41:23Z", "type": "commit"}, {"oid": "fd235ed3fefa7f62d20c9fbf611ec62680313b78", "url": "https://github.com/hmcts/ccd-data-store-api/commit/fd235ed3fefa7f62d20c9fbf611ec62680313b78", "message": "RDM-8051 Checkstyle", "committedDate": "2020-05-06T13:49:57Z", "type": "commit"}, {"oid": "8bc5426920c0ad08a5ecea27d4773efa8e32f4d2", "url": "https://github.com/hmcts/ccd-data-store-api/commit/8bc5426920c0ad08a5ecea27d4773efa8e32f4d2", "message": "RDM-8051 Checkstyle cd.", "committedDate": "2020-05-06T14:17:04Z", "type": "commit"}, {"oid": "229b364262d0528481cb3fe70a08f0eb11a561a1", "url": "https://github.com/hmcts/ccd-data-store-api/commit/229b364262d0528481cb3fe70a08f0eb11a561a1", "message": "Merge branch 'RDM-8051' into RDM-8051-v1", "committedDate": "2020-05-06T16:09:21Z", "type": "commit"}, {"oid": "3f3d2751dd27b0faa775a72c84a56343292a18fe", "url": "https://github.com/hmcts/ccd-data-store-api/commit/3f3d2751dd27b0faa775a72c84a56343292a18fe", "message": "RDM-8051 Checkstyle", "committedDate": "2020-05-06T16:30:27Z", "type": "commit"}, {"oid": "3b46ac7099417e89c1de45e720104eb8dde9cb3d", "url": "https://github.com/hmcts/ccd-data-store-api/commit/3b46ac7099417e89c1de45e720104eb8dde9cb3d", "message": "RDM-8051 Fix merge issues", "committedDate": "2020-05-06T17:19:47Z", "type": "commit"}, {"oid": "cc8f81018276135e5bae31df407c706ee5ba4717", "url": "https://github.com/hmcts/ccd-data-store-api/commit/cc8f81018276135e5bae31df407c706ee5ba4717", "message": "Merge remote-tracking branch 'origin/RDM-8051-v1' into RDM-8051-v1\n\n# Conflicts:\n#\tsrc/main/java/uk/gov/hmcts/ccd/auditlog/AuditInterceptor.java", "committedDate": "2020-05-07T09:44:02Z", "type": "commit"}, {"oid": "1f31fd22b33919dae17568d909743c705bfa1dc7", "url": "https://github.com/hmcts/ccd-data-store-api/commit/1f31fd22b33919dae17568d909743c705bfa1dc7", "message": "Merge branch 'develop' into RDM-8051", "committedDate": "2020-05-07T09:57:23Z", "type": "commit"}, {"oid": "1b69423f6e331ada2653b68b503513601f8f65a3", "url": "https://github.com/hmcts/ccd-data-store-api/commit/1b69423f6e331ada2653b68b503513601f8f65a3", "message": "RDM-8051 Disable header checks on FTAs", "committedDate": "2020-05-07T10:53:56Z", "type": "commit"}, {"oid": "d2c70667f96f34dca67e253311b5a4a2985aed88", "url": "https://github.com/hmcts/ccd-data-store-api/commit/d2c70667f96f34dca67e253311b5a4a2985aed88", "message": "RDM-8051 Disable header checks on FTAs", "committedDate": "2020-05-07T12:31:44Z", "type": "commit"}, {"oid": "f70b8295e9f83be031a479d2e491acc6a3016cdd", "url": "https://github.com/hmcts/ccd-data-store-api/commit/f70b8295e9f83be031a479d2e491acc6a3016cdd", "message": "Merge branch 'RDM-8051' into RDM-8051-v1", "committedDate": "2020-05-07T13:19:23Z", "type": "commit"}, {"oid": "22f0d6ad0d53c47b22ca852672f83f71823fde02", "url": "https://github.com/hmcts/ccd-data-store-api/commit/22f0d6ad0d53c47b22ca852672f83f71823fde02", "message": "Revert USER_PROFILE_HOST", "committedDate": "2020-05-07T13:42:02Z", "type": "commit"}, {"oid": "aecfb2f74a1bd88a96929993baa26ad0b4665dd5", "url": "https://github.com/hmcts/ccd-data-store-api/commit/aecfb2f74a1bd88a96929993baa26ad0b4665dd5", "message": "Merge pull request #921 from hmcts/RDM-8051-v1\n\nRDM-8051 LogAudit for v1 endpoints", "committedDate": "2020-05-07T14:38:56Z", "type": "commit"}, {"oid": "f38567d642ece1157fcd6b05aa3162093513f2d8", "url": "https://github.com/hmcts/ccd-data-store-api/commit/f38567d642ece1157fcd6b05aa3162093513f2d8", "message": "Merge branch 'develop' into RDM-8051", "committedDate": "2020-05-07T14:40:37Z", "type": "commit"}, {"oid": "a338f38620610299c49598af909b38456a7e4c5f", "url": "https://github.com/hmcts/ccd-data-store-api/commit/a338f38620610299c49598af909b38456a7e4c5f", "message": "RDM-8051 WIP", "committedDate": "2020-04-07T11:17:46Z", "type": "commit"}, {"oid": "a49e5848471e9026306f0d9c4720b60c2570f201", "url": "https://github.com/hmcts/ccd-data-store-api/commit/a49e5848471e9026306f0d9c4720b60c2570f201", "message": "RDM-8051 Introduce Clock", "committedDate": "2020-04-07T12:29:54Z", "type": "commit"}, {"oid": "929e1ae7db62c3c22802446813e5534e80e64c9e", "url": "https://github.com/hmcts/ccd-data-store-api/commit/929e1ae7db62c3c22802446813e5534e80e64c9e", "message": "RDM-8051 Switch to LogAuditInterceptor", "committedDate": "2020-04-08T12:57:43Z", "type": "commit"}, {"oid": "d3032e241654f426bebbfc770c1c581fa2c01d10", "url": "https://github.com/hmcts/ccd-data-store-api/commit/d3032e241654f426bebbfc770c1c581fa2c01d10", "message": "RDM-8051 - added test to verify audit flow", "committedDate": "2020-04-08T16:14:02Z", "type": "commit"}, {"oid": "980ebb5db871edc9fb5f0868112245f00bf11013", "url": "https://github.com/hmcts/ccd-data-store-api/commit/980ebb5db871edc9fb5f0868112245f00bf11013", "message": "RDM-8051 - added idam props to audit log message", "committedDate": "2020-04-09T13:19:47Z", "type": "commit"}, {"oid": "3d5faec5df2816480e0a806e537cf2c6b01000e8", "url": "https://github.com/hmcts/ccd-data-store-api/commit/3d5faec5df2816480e0a806e537cf2c6b01000e8", "message": "RDM-8051 - Audit aspect using using spring expression language.", "committedDate": "2020-04-14T08:40:25Z", "type": "commit"}, {"oid": "73cfc51ababc8123e4623da676c7a43a6316d4e1", "url": "https://github.com/hmcts/ccd-data-store-api/commit/73cfc51ababc8123e4623da676c7a43a6316d4e1", "message": "RDM-8051 - Audit aspect using using spring expression language.", "committedDate": "2020-04-14T10:12:37Z", "type": "commit"}, {"oid": "f52c76f4e92814155761841bc167e2b628288f29", "url": "https://github.com/hmcts/ccd-data-store-api/commit/f52c76f4e92814155761841bc167e2b628288f29", "message": "RDM-8051 - audit aspect refactoring", "committedDate": "2020-04-14T14:54:21Z", "type": "commit"}, {"oid": "664e184d1bba782c3604ba3c09cec26bb7e63489", "url": "https://github.com/hmcts/ccd-data-store-api/commit/664e184d1bba782c3604ba3c09cec26bb7e63489", "message": "RDM-8051 - audit aspect - added caseType property", "committedDate": "2020-04-14T18:27:19Z", "type": "commit"}, {"oid": "ce1a3dab0b618423614b9c5d107a31b270445457", "url": "https://github.com/hmcts/ccd-data-store-api/commit/ce1a3dab0b618423614b9c5d107a31b270445457", "message": "RDM-8051 Add annotation with the operationType", "committedDate": "2020-04-14T19:40:49Z", "type": "commit"}, {"oid": "f913a0d68bcfd27d348ab324bc795d88aa1755b0", "url": "https://github.com/hmcts/ccd-data-store-api/commit/f913a0d68bcfd27d348ab324bc795d88aa1755b0", "message": "RDM-8051 - minor clean-up; renamed to make it consistency.", "committedDate": "2020-04-14T21:35:38Z", "type": "commit"}, {"oid": "c2e263eabd8ceb03e3628874e20d7522d228dc6a", "url": "https://github.com/hmcts/ccd-data-store-api/commit/c2e263eabd8ceb03e3628874e20d7522d228dc6a", "message": "RDM-8051 - integration test for audit annotation on GET /case/{caseId}", "committedDate": "2020-04-15T09:46:41Z", "type": "commit"}, {"oid": "3cd3e096f1b32d42753df8ebde4f496073347ecd", "url": "https://github.com/hmcts/ccd-data-store-api/commit/3cd3e096f1b32d42753df8ebde4f496073347ecd", "message": "RDM-8051 - audit aspect - added eventSelected property", "committedDate": "2020-04-15T12:39:09Z", "type": "commit"}, {"oid": "790e168c44918812839044571afa1cc05d503315", "url": "https://github.com/hmcts/ccd-data-store-api/commit/790e168c44918812839044571afa1cc05d503315", "message": "RDM-8051 - audit aspect - added eventSelected property", "committedDate": "2020-04-15T14:01:56Z", "type": "commit"}, {"oid": "eaaede6ceab915b3fb9115057c662974a0716e87", "url": "https://github.com/hmcts/ccd-data-store-api/commit/eaaede6ceab915b3fb9115057c662974a0716e87", "message": "RDM-8051 wip", "committedDate": "2020-04-15T15:34:02Z", "type": "commit"}, {"oid": "4964ed4012c54be2f8833d1a1a93269a0bd104ea", "url": "https://github.com/hmcts/ccd-data-store-api/commit/4964ed4012c54be2f8833d1a1a93269a0bd104ea", "message": "RDM-8051 Test LogAudit on CaseController", "committedDate": "2020-04-15T20:54:52Z", "type": "commit"}, {"oid": "fc8e012c1f5a8fac42584e390eda067f69e738c5", "url": "https://github.com/hmcts/ccd-data-store-api/commit/fc8e012c1f5a8fac42584e390eda067f69e738c5", "message": "RDM-8051 Test LogAudit on DocumentController", "committedDate": "2020-04-15T21:11:16Z", "type": "commit"}, {"oid": "eca83255b7be292094c25ebd6fcdfdf6000b099b", "url": "https://github.com/hmcts/ccd-data-store-api/commit/eca83255b7be292094c25ebd6fcdfdf6000b099b", "message": "RDM-8051 - audit log few more endpoints and tests", "committedDate": "2020-04-16T09:21:52Z", "type": "commit"}, {"oid": "96a0404f3ac41dca8d22f7f6c41bc7c9cef43183", "url": "https://github.com/hmcts/ccd-data-store-api/commit/96a0404f3ac41dca8d22f7f6c41bc7c9cef43183", "message": "RDM-8051 - fixed auditInterceptor in case of exceptionHandlers", "committedDate": "2020-04-16T09:53:42Z", "type": "commit"}, {"oid": "c5658709a6a65071973d2003cffbf9ab8f9e290b", "url": "https://github.com/hmcts/ccd-data-store-api/commit/c5658709a6a65071973d2003cffbf9ab8f9e290b", "message": "RDM-8051 - CaseUser.caseRoles log_audit", "committedDate": "2020-04-16T14:08:54Z", "type": "commit"}, {"oid": "564314d8daaf7ee19a2854341852b7c3972160bb", "url": "https://github.com/hmcts/ccd-data-store-api/commit/564314d8daaf7ee19a2854341852b7c3972160bb", "message": "RDM-8051 Test LogAudit on StartTriggerController", "committedDate": "2020-04-16T15:31:56Z", "type": "commit"}, {"oid": "bad96d31b1e3b6d394abd4b4ee2d5d7ef530b6fd", "url": "https://github.com/hmcts/ccd-data-store-api/commit/bad96d31b1e3b6d394abd4b4ee2d5d7ef530b6fd", "message": "RDM-8051 Remove not needed LogAudit", "committedDate": "2020-04-16T15:48:07Z", "type": "commit"}, {"oid": "1d00c6fd260b17bb6b18e9528b14b931728aa0cc", "url": "https://github.com/hmcts/ccd-data-store-api/commit/1d00c6fd260b17bb6b18e9528b14b931728aa0cc", "message": "RDM-8051 reset sequences", "committedDate": "2020-04-17T08:19:21Z", "type": "commit"}, {"oid": "15924c6b57158664cde808bf8cb3041e2f5a8092", "url": "https://github.com/hmcts/ccd-data-store-api/commit/15924c6b57158664cde808bf8cb3041e2f5a8092", "message": "RDM-8051 update address.postcode for a valid one", "committedDate": "2020-04-17T09:12:46Z", "type": "commit"}, {"oid": "9ae4000b1eae4164ddfdbb35ea122c184d091048", "url": "https://github.com/hmcts/ccd-data-store-api/commit/9ae4000b1eae4164ddfdbb35ea122c184d091048", "message": "RDM-8051 Clean up Access OperationTypes", "committedDate": "2020-04-17T12:04:15Z", "type": "commit"}, {"oid": "fc70edd71e478c486c294247406b08141669d405", "url": "https://github.com/hmcts/ccd-data-store-api/commit/fc70edd71e478c486c294247406b08141669d405", "message": "RDM-8051 Align the endpoint LogAudit with the spec", "committedDate": "2020-04-17T12:06:03Z", "type": "commit"}, {"oid": "53c2885fea9d6000b48aa27db904e7edd4698752", "url": "https://github.com/hmcts/ccd-data-store-api/commit/53c2885fea9d6000b48aa27db904e7edd4698752", "message": "RDM-8051 Checkstyle cleanup", "committedDate": "2020-04-17T12:51:58Z", "type": "commit"}, {"oid": "1bdc951bac684d3ea7afb6fb6170ffe7539633b9", "url": "https://github.com/hmcts/ccd-data-store-api/commit/1bdc951bac684d3ea7afb6fb6170ffe7539633b9", "message": "RDM-8051 - fixed CaseRoleRepo securityUtils mock", "committedDate": "2020-04-17T14:43:58Z", "type": "commit"}, {"oid": "0c476465511311a0c1675ab2e7db150960f72c20", "url": "https://github.com/hmcts/ccd-data-store-api/commit/0c476465511311a0c1675ab2e7db150960f72c20", "message": "RDM-8051 Remove unneeded code", "committedDate": "2020-04-17T15:03:43Z", "type": "commit"}, {"oid": "33c893ab8defe9223acfb75485460e42bd992cc6", "url": "https://github.com/hmcts/ccd-data-store-api/commit/33c893ab8defe9223acfb75485460e42bd992cc6", "message": "RDM-8051 Unit test for AuditService", "committedDate": "2020-04-17T15:51:04Z", "type": "commit"}, {"oid": "f8cdb174351f68b267a3d2898133def1aeb0b837", "url": "https://github.com/hmcts/ccd-data-store-api/commit/f8cdb174351f68b267a3d2898133def1aeb0b837", "message": "RDM-8051 - unit tests for ExpressionEvaluator", "committedDate": "2020-04-20T08:28:34Z", "type": "commit"}, {"oid": "bb0f38e720428ea5b641dbda8c9373475d21c196", "url": "https://github.com/hmcts/ccd-data-store-api/commit/bb0f38e720428ea5b641dbda8c9373475d21c196", "message": "RDM-8051 - sonar exclusions", "committedDate": "2020-04-20T09:24:42Z", "type": "commit"}, {"oid": "397c3773be58cdba363fddd551e8cc405b767a4f", "url": "https://github.com/hmcts/ccd-data-store-api/commit/397c3773be58cdba363fddd551e8cc405b767a4f", "message": "RDM-8051 - checkstyle fixes", "committedDate": "2020-04-20T09:51:56Z", "type": "commit"}, {"oid": "e4fa99147fee9c955436f79dcd842b6ee4982a6e", "url": "https://github.com/hmcts/ccd-data-store-api/commit/e4fa99147fee9c955436f79dcd842b6ee4982a6e", "message": "RDM-8051 - unit tests and sonar fixes", "committedDate": "2020-04-20T10:27:19Z", "type": "commit"}, {"oid": "23349ce04bb8b4cffe870dec50d0a476eb73a086", "url": "https://github.com/hmcts/ccd-data-store-api/commit/23349ce04bb8b4cffe870dec50d0a476eb73a086", "message": "Merge branch 'develop' into RDM-8051", "committedDate": "2020-04-20T11:02:06Z", "type": "commit"}, {"oid": "80b925590bfe9364034ee9854c25bbc7e10efc3c", "url": "https://github.com/hmcts/ccd-data-store-api/commit/80b925590bfe9364034ee9854c25bbc7e10efc3c", "message": "RDM-8051 - audit log for V1 search cases", "committedDate": "2020-04-20T15:07:15Z", "type": "commit"}, {"oid": "6ae9b46c5b1cecb9765ab6b7310a88fa01115acb", "url": "https://github.com/hmcts/ccd-data-store-api/commit/6ae9b46c5b1cecb9765ab6b7310a88fa01115acb", "message": "RDM-8051 - audit log for V1 Query endpoint", "committedDate": "2020-04-20T15:31:47Z", "type": "commit"}, {"oid": "9529a70ea34714f5bf98bfc0a0411980b12a3931", "url": "https://github.com/hmcts/ccd-data-store-api/commit/9529a70ea34714f5bf98bfc0a0411980b12a3931", "message": "RDM-8051 v1 CaseSearchEndpoint amd CallbackEndpoint", "committedDate": "2020-04-20T18:51:16Z", "type": "commit"}, {"oid": "e691114d68c5eb22a29a64b42e783047436aff19", "url": "https://github.com/hmcts/ccd-data-store-api/commit/e691114d68c5eb22a29a64b42e783047436aff19", "message": "RDM-8051 refactor listOfCaseTypes", "committedDate": "2020-04-20T18:54:35Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjA3NTc1OA==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r412075758", "bodyText": "Remove the commented lines .", "author": "Thor-tech-of-metal", "createdAt": "2020-04-21T10:44:24Z", "path": "src/main/java/uk/gov/hmcts/ccd/auditlog/AuditEntry.java", "diffHunk": "@@ -0,0 +1,169 @@\n+package uk.gov.hmcts.ccd.auditlog;\n+\n+import org.apache.commons.lang3.builder.ReflectionToStringBuilder;\n+\n+import java.util.List;\n+import java.util.stream.Collectors;\n+\n+import static org.apache.commons.lang3.StringUtils.isNotBlank;\n+import static org.apache.commons.lang3.builder.ToStringStyle.JSON_STYLE;\n+\n+public class AuditEntry {\n+\n+    private static final String TAG = \"CLA-CCD\";\n+\n+    private String dateTime;\n+    private int httpStatus;\n+    private String httpMethod;\n+    private String path;\n+    private String idamId;\n+    private String caseId;\n+    private String caseType;\n+    private String jurisdiction;\n+    private String eventSelected;\n+    private String invokingService;\n+    private String operationType;\n+    private String requestId;\n+    private String targetIdamId;\n+    private List<String> targetCaseRoles;\n+\n+    public void setDateTime(String time) {\n+        this.dateTime = time;\n+    }\n+\n+    public String getDateTime() {\n+        return dateTime;\n+    }\n+\n+    public int getHttpStatus() {\n+        return httpStatus;\n+    }\n+\n+    public void setHttpStatus(int httpStatus) {\n+        this.httpStatus = httpStatus;\n+    }\n+\n+    public String getHttpMethod() {\n+        return httpMethod;\n+    }\n+\n+    public void setHttpMethod(String httpMethod) {\n+        this.httpMethod = httpMethod;\n+    }\n+\n+    public String getPath() {\n+        return path;\n+    }\n+\n+    public void setPath(String path) {\n+        this.path = path;\n+    }\n+\n+    public String getOperationType() {\n+        return operationType;\n+    }\n+\n+    public void setOperationType(String operationType) {\n+        this.operationType = operationType;\n+    }\n+\n+    public String getIdamId() {\n+        return idamId;\n+    }\n+\n+    public void setIdamId(String idamId) {\n+        this.idamId = idamId;\n+    }\n+\n+    public String getInvokingService() {\n+        return invokingService;\n+    }\n+\n+    public void setInvokingService(String invokingService) {\n+        this.invokingService = invokingService;\n+    }\n+\n+    public static String getTAG() {\n+        return TAG;\n+    }\n+\n+    public String getCaseId() {\n+        return caseId;\n+    }\n+\n+    public void setCaseId(String caseId) {\n+        this.caseId = caseId;\n+    }\n+\n+    public String getJurisdiction() {\n+        return jurisdiction;\n+    }\n+\n+    public void setJurisdiction(String jurisdiction) {\n+        this.jurisdiction = jurisdiction;\n+    }\n+\n+    public String getCaseType() {\n+        return caseType;\n+    }\n+\n+    public void setCaseType(String caseType) {\n+        this.caseType = caseType;\n+    }\n+\n+    public String getEventSelected() {\n+        return eventSelected;\n+    }\n+\n+    public void setEventSelected(String eventSelected) {\n+        this.eventSelected = eventSelected;\n+    }\n+\n+    public String getRequestId() {\n+        return requestId;\n+    }\n+\n+    public void setRequestId(String requestId) {\n+        this.requestId = requestId;\n+    }\n+\n+    public String getTargetIdamId() {\n+        return targetIdamId;\n+    }\n+\n+    public void setTargetIdamId(String targetIdamId) {\n+        this.targetIdamId = targetIdamId;\n+    }\n+\n+    public List<String> getTargetCaseRoles() {\n+        return targetCaseRoles;\n+    }\n+\n+    public void setTargetCaseRoles(List<String> targetCaseRoles) {\n+        this.targetCaseRoles = targetCaseRoles;\n+    }\n+\n+    @Override\n+    public String toString() {\n+        return TAG + \" \" + dateTime + \" operationType:\" + operationType +\n+            (isNotBlank(caseId) ? \", caseId:\" + caseId : \"\") +\n+            (isNotBlank(idamId) ? \", idamId:\" + idamId : \"\") +\n+            (isNotBlank(invokingService) ? \", invokingService:\" + invokingService : \"\") +\n+            (isNotBlank(path) ? \", endpointCalled:\" + httpMethod + \" \" + path : \"\") +\n+            \", operationOutcome:\" + httpStatus +\n+            (isNotBlank(caseType) ? \", caseType:\" + caseType : \"\") +\n+            (isNotBlank(jurisdiction) ? \", jurisdiction:\" + jurisdiction : \"\") +\n+            (isNotBlank(eventSelected) ? \", eventSelected:\" + eventSelected : \"\") +\n+           (isNotBlank(targetIdamId) ? \", idamIdOfTarget:\" + targetIdamId : \"\") +\n+//            (isNotBlank(listOfCaseTypes) ? \", listOfCaseTypes:\" + listOfCaseTypes : \"\") +\n+            (targetCaseRoles != null && !targetCaseRoles.isEmpty() ? \", targetCaseRoles:\" +", "originalCommit": "23349ce04bb8b4cffe870dec50d0a476eb73a086", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjA3NTgxNQ==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r412075815", "bodyText": "Any particular reason why @lazy final SecurityUtils securityUtils is lazy. Because it seems that this securityUtils attribute is important for the AuditService functionality.   without securityUtils AuditService will not work.   Maybe it is good if it always present.   If securityUtils were inside an if statement yes .", "author": "Thor-tech-of-metal", "createdAt": "2020-04-21T10:44:30Z", "path": "src/main/java/uk/gov/hmcts/ccd/auditlog/AuditService.java", "diffHunk": "@@ -0,0 +1,61 @@\n+package uk.gov.hmcts.ccd.auditlog;\n+\n+import org.springframework.beans.factory.annotation.Qualifier;\n+import org.springframework.context.annotation.Lazy;\n+import org.springframework.stereotype.Service;\n+import uk.gov.hmcts.ccd.auditlog.aop.AuditContext;\n+import uk.gov.hmcts.ccd.data.SecurityUtils;\n+import uk.gov.hmcts.ccd.data.user.CachedUserRepository;\n+import uk.gov.hmcts.ccd.data.user.UserRepository;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import java.time.Clock;\n+import java.time.LocalDateTime;\n+\n+import static java.time.format.DateTimeFormatter.ISO_LOCAL_DATE_TIME;\n+\n+@Service\n+public class AuditService {\n+\n+    private final Clock clock;\n+    private final SecurityUtils securityUtils;\n+    private final UserRepository userRepository;\n+    private final AuditRepository auditRepository;\n+\n+    public AuditService(@Qualifier(\"utcClock\") final Clock clock,\n+                        @Qualifier(CachedUserRepository.QUALIFIER) final UserRepository userRepository,\n+                        @Lazy final SecurityUtils securityUtils, final AuditRepository auditRepository) {\n+        this.clock = clock;", "originalCommit": "23349ce04bb8b4cffe870dec50d0a476eb73a086", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjc0NTE1Mg==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r412745152", "bodyText": "Can't work without that - it's not optional.\nSecurityUtils referring AuthTokenGenerator which is loading lazily at the moment.", "author": "smathangi", "createdAt": "2020-04-22T07:38:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjA3NTgxNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjk4MjEzNg==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r412982136", "bodyText": "Fair enough . It means that SecurityUtils is liked to Lazy initialization due to it is using AuthTokenGenerator with lazy loading.  Perfect : \ud83d\udc4c", "author": "Thor-tech-of-metal", "createdAt": "2020-04-22T13:28:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjA3NTgxNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjA3NTkxOA==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r412075918", "bodyText": "I think that there is a constant ion the model for \"request-id\" value .  If not maybe we can create one . Only if there is a shared common area for test modules and business modules.", "author": "Thor-tech-of-metal", "createdAt": "2020-04-21T10:44:39Z", "path": "src/main/java/uk/gov/hmcts/ccd/auditlog/AuditService.java", "diffHunk": "@@ -0,0 +1,61 @@\n+package uk.gov.hmcts.ccd.auditlog;\n+\n+import org.springframework.beans.factory.annotation.Qualifier;\n+import org.springframework.context.annotation.Lazy;\n+import org.springframework.stereotype.Service;\n+import uk.gov.hmcts.ccd.auditlog.aop.AuditContext;\n+import uk.gov.hmcts.ccd.data.SecurityUtils;\n+import uk.gov.hmcts.ccd.data.user.CachedUserRepository;\n+import uk.gov.hmcts.ccd.data.user.UserRepository;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import java.time.Clock;\n+import java.time.LocalDateTime;\n+\n+import static java.time.format.DateTimeFormatter.ISO_LOCAL_DATE_TIME;\n+\n+@Service\n+public class AuditService {\n+\n+    private final Clock clock;\n+    private final SecurityUtils securityUtils;\n+    private final UserRepository userRepository;\n+    private final AuditRepository auditRepository;\n+\n+    public AuditService(@Qualifier(\"utcClock\") final Clock clock,\n+                        @Qualifier(CachedUserRepository.QUALIFIER) final UserRepository userRepository,\n+                        @Lazy final SecurityUtils securityUtils, final AuditRepository auditRepository) {\n+        this.clock = clock;\n+        this.userRepository = userRepository;\n+        this.securityUtils = securityUtils;\n+        this.auditRepository = auditRepository;\n+    }\n+\n+    public void audit(HttpServletRequest request, int httpResponseStatus, AuditContext auditContext) {\n+        AuditEntry entry = new AuditEntry();\n+\n+        String formattedDate = LocalDateTime.now(clock).format(ISO_LOCAL_DATE_TIME);\n+\n+        entry.setDateTime(formattedDate);\n+        entry.setHttpStatus(httpResponseStatus);\n+        entry.setHttpMethod(request.getMethod());\n+        entry.setPath(request.getRequestURI());\n+        entry.setIdamId(userRepository.getUser().getEmail());\n+        entry.setInvokingService(securityUtils.getServiceName());\n+\n+        if (auditContext != null) {\n+            entry.setOperationType(auditContext.getOperationType().getLabel());\n+            entry.setJurisdiction(auditContext.getJurisdiction());\n+            entry.setCaseId(auditContext.getCaseId());\n+            entry.setCaseType(auditContext.getCaseType());\n+            entry.setEventSelected(auditContext.getEventName());\n+            entry.setTargetIdamId(auditContext.getTargetIdamId());\n+            entry.setTargetCaseRoles(auditContext.getTargetCaseRoles());\n+        }\n+\n+        entry.setRequestId(request.getHeader(\"request-id\"));\n+", "originalCommit": "23349ce04bb8b4cffe870dec50d0a476eb73a086", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjc0NTYwNw==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r412745607", "bodyText": "moved this to interceptor and extracted to a constant now.", "author": "smathangi", "createdAt": "2020-04-22T07:39:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjA3NTkxOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjA3NjAzNg==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r412076036", "bodyText": "there is a logger \"LOG\" it would be good if we log the trace and a message.  We know where it is coming from", "author": "Thor-tech-of-metal", "createdAt": "2020-04-21T10:44:50Z", "path": "src/main/java/uk/gov/hmcts/ccd/auditlog/aop/AuditAspect.java", "diffHunk": "@@ -0,0 +1,74 @@\n+package uk.gov.hmcts.ccd.auditlog.aop;\n+\n+import org.apache.commons.lang.StringUtils;\n+import org.aspectj.lang.JoinPoint;\n+import org.aspectj.lang.ProceedingJoinPoint;\n+import org.aspectj.lang.annotation.Around;\n+import org.aspectj.lang.annotation.Aspect;\n+import org.aspectj.lang.reflect.MethodSignature;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.context.expression.AnnotatedElementKey;\n+import org.springframework.expression.EvaluationContext;\n+import org.springframework.expression.spel.SpelEvaluationException;\n+import org.springframework.stereotype.Component;\n+import uk.gov.hmcts.ccd.auditlog.LogAudit;\n+\n+import java.lang.reflect.Method;\n+import java.util.List;\n+\n+@Aspect\n+@Component\n+public class AuditAspect {\n+\n+    private static final Logger LOG = LoggerFactory.getLogger(AuditAspect.class);\n+\n+    private static final String RESULT_VARIABLE = \"result\";\n+\n+    private ExpressionEvaluator evaluator = new ExpressionEvaluator();\n+\n+    @Around(\"@annotation(logAudit)\")\n+    public Object audit(ProceedingJoinPoint joinPoint, LogAudit logAudit) throws Throwable {\n+        Object result = null;\n+        try {\n+            result = joinPoint.proceed();\n+            return result;\n+        } catch (Exception ex) {\n+            throw ex;", "originalCommit": "23349ce04bb8b4cffe870dec50d0a476eb73a086", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjc0NjU1OQ==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r412746559", "bodyText": "Controller advice logs the same. Actually no need to catch and throw here.", "author": "smathangi", "createdAt": "2020-04-22T07:40:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjA3NjAzNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjA3NzQ0NQ==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r412077445", "bodyText": "public Object[] getArgs() {. }.  It is not used anywhere and it is not overwriting .", "author": "Thor-tech-of-metal", "createdAt": "2020-04-21T10:47:09Z", "path": "src/main/java/uk/gov/hmcts/ccd/auditlog/aop/ExpressionEvaluator.java", "diffHunk": "@@ -0,0 +1,66 @@\n+package uk.gov.hmcts.ccd.auditlog.aop;\n+\n+import org.springframework.aop.support.AopUtils;\n+import org.springframework.context.expression.AnnotatedElementKey;\n+import org.springframework.context.expression.CachedExpressionEvaluator;\n+import org.springframework.context.expression.MethodBasedEvaluationContext;\n+import org.springframework.core.DefaultParameterNameDiscoverer;\n+import org.springframework.core.ParameterNameDiscoverer;\n+import org.springframework.expression.EvaluationContext;\n+import org.springframework.expression.Expression;\n+\n+import java.lang.reflect.Method;\n+import java.util.Map;\n+import java.util.concurrent.ConcurrentHashMap;\n+\n+/**\n+ *  Utility class handling the SpEL expression parsing\n+ *\n+ */\n+public class ExpressionEvaluator extends CachedExpressionEvaluator {\n+\n+    // shared param discoverer since it caches data internally\n+    private final ParameterNameDiscoverer paramNameDiscoverer = new DefaultParameterNameDiscoverer();\n+\n+    private final Map<ExpressionKey, Expression> conditionCache = new ConcurrentHashMap<>(64);\n+\n+    private final Map<AnnotatedElementKey, Method> targetMethodCache = new ConcurrentHashMap<>(64);\n+\n+    public EvaluationContext createEvaluationContext(Object object, Class<?> targetClass, Method method, Object[] args) {\n+        Method targetMethod = getTargetMethod(targetClass, method);\n+        ExpressionRootObject root = new ExpressionRootObject(object, args);\n+        return new MethodBasedEvaluationContext(root, targetMethod, args, this.paramNameDiscoverer);\n+    }\n+\n+    public <T> T condition(String conditionExpression, AnnotatedElementKey elementKey, EvaluationContext evalContext, Class<T> clazz) {\n+        return getExpression(this.conditionCache, elementKey, conditionExpression).getValue(evalContext, clazz);\n+    }\n+\n+    private Method getTargetMethod(Class<?> targetClass, Method method) {\n+        AnnotatedElementKey methodKey = new AnnotatedElementKey(method, targetClass);\n+        Method targetMethod = this.targetMethodCache.get(methodKey);\n+        if (targetMethod == null) {\n+            targetMethod = AopUtils.getMostSpecificMethod(method, targetClass);\n+            this.targetMethodCache.put(methodKey, targetMethod);\n+        }\n+        return targetMethod;\n+    }\n+\n+    private static class ExpressionRootObject {\n+        private final Object object;\n+        private final Object[] args;\n+\n+        public ExpressionRootObject(Object object, Object[] args) {\n+            this.object = object;\n+            this.args = args;\n+        }\n+\n+        public Object getObject() {\n+            return object;\n+        }\n+\n+        public Object[] getArgs() {\n+            return args;\n+        }\n+    }", "originalCommit": "23349ce04bb8b4cffe870dec50d0a476eb73a086", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjc0ODExMA==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r412748110", "bodyText": "That class similar to VO/DTO.", "author": "smathangi", "createdAt": "2020-04-22T07:42:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjA3NzQ0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzAxOTUwNA==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r413019504", "bodyText": "It is ok . there has to be a getter.", "author": "Thor-tech-of-metal", "createdAt": "2020-04-22T14:13:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjA3NzQ0NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjEzOTU5Mw==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r412139593", "bodyText": "better to have an AuditRepository interface with at the moment one implementation LoggerAuditRepository.\nThis will allow in the future to easily change the destination of the log files if needed. For example they might want to ask to store on DB rather than on std out", "author": "mario-paniccia", "createdAt": "2020-04-21T12:27:23Z", "path": "src/main/java/uk/gov/hmcts/ccd/auditlog/AuditRepository.java", "diffHunk": "@@ -0,0 +1,15 @@\n+package uk.gov.hmcts.ccd.auditlog;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.stereotype.Component;\n+\n+@Component\n+public class AuditRepository {", "originalCommit": "23349ce04bb8b4cffe870dec50d0a476eb73a086", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjc1MTQ2NQ==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r412751465", "bodyText": "at any point of time we've one implementation only right? Also this is not a library class. https://martinfowler.com/bliki/InterfaceImplementationPair.html", "author": "smathangi", "createdAt": "2020-04-22T07:47:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjEzOTU5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzcxMjU4Mg==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r413712582", "bodyText": "The benefit of introducing an interface is not so that we can support more than one destination at a single time. That is not what I meant. The benefit is that it make the code more extensible by allowing us to change the destination if we need and limiting the amount of changes we need to do. We just inject a different implementation class without having to change the client classes using the AuditRepository. Because the client classes use an interface.\nIf you look at any implementation of the repository design pattern on internet it's always defined as an interface, also when there is only 1 implementation class:\nhttps://thoughts-on-java.org/implementing-the-repository-pattern-with-jpa-and-hibernate/\nhttps://medium.com/@krzychukosobudzki/repository-design-pattern-bc490b256006\nAnother point is that without an interface you can't use dependency injection on that component, which is an established good practice.\nThis is a specific application of the more generic Object Oriented Design Principle to code to an interface: https://medium.com/javarevisited/oop-good-practices-coding-to-the-interface-baea84fd60d3\nFurthermore all the Repository classes in DataStore are interfaces, which for example allowed us to easily introduce caching by replacing the original implementation with one that introduced caching by limiting the amount of code changes required", "author": "mario-paniccia", "createdAt": "2020-04-23T10:48:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjEzOTU5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzc2ODgxNg==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r413768816", "bodyText": "haha.. we can't generalise every single principle to each scenario. This particular one has just one line of code (log statement), surely there won't be any caching required, dependency injection still possible.  I've seen many well known libraries including Spring has single implementation class without interface.\nPersonally I disagree in this particular scenario but pushed as requested.", "author": "smathangi", "createdAt": "2020-04-23T12:22:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjEzOTU5Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjA3ODYyNw==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r412078627", "bodyText": "if we can avoid using. .*; checkstyle will complaint.", "author": "Thor-tech-of-metal", "createdAt": "2020-04-21T10:49:04Z", "path": "src/main/java/uk/gov/hmcts/ccd/v2/external/controller/CaseController.java", "diffHunk": "@@ -31,7 +24,11 @@\n import uk.gov.hmcts.ccd.v2.external.resource.CaseEventsResource;\n import uk.gov.hmcts.ccd.v2.external.resource.CaseResource;\n \n+import javax.transaction.Transactional;\n+import java.util.List;\n+\n import static org.springframework.http.ResponseEntity.status;\n+import static uk.gov.hmcts.ccd.auditlog.OperationType.*;\n ", "originalCommit": "23349ce04bb8b4cffe870dec50d0a476eb73a086", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjA4NzQ0NA==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r412087444", "bodyText": "private constructor for enum is redundant.  I think intellij can mark that", "author": "Thor-tech-of-metal", "createdAt": "2020-04-21T11:03:32Z", "path": "src/main/java/uk/gov/hmcts/ccd/auditlog/OperationType.java", "diffHunk": "@@ -0,0 +1,19 @@\n+package uk.gov.hmcts.ccd.auditlog;\n+\n+public enum OperationType {\n+    CREATE_CASE(\"Create case\"),\n+    UPDATE_CASE(\"Update case\"),\n+    VIEW_CASE(\"View case\"),\n+    SEARCH_CASE(\"Search case\"),\n+    UPDATE_CASE_ACCESS(\"Update case access\");\n+\n+    private final String label;\n+\n+    private OperationType(String label) {", "originalCommit": "23349ce04bb8b4cffe870dec50d0a476eb73a086", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjc1MTY0NA==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r412751644", "bodyText": "removed", "author": "smathangi", "createdAt": "2020-04-22T07:48:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjA4NzQ0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjE3NTQwOA==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r412175408", "bodyText": "I'm thinking that maybe for consistency we should have a field id for the datetime, like datetime:\nThis will also simplify the processing of the records.", "author": "mario-paniccia", "createdAt": "2020-04-21T13:17:10Z", "path": "src/main/java/uk/gov/hmcts/ccd/auditlog/AuditEntry.java", "diffHunk": "@@ -0,0 +1,169 @@\n+package uk.gov.hmcts.ccd.auditlog;\n+\n+import org.apache.commons.lang3.builder.ReflectionToStringBuilder;\n+\n+import java.util.List;\n+import java.util.stream.Collectors;\n+\n+import static org.apache.commons.lang3.StringUtils.isNotBlank;\n+import static org.apache.commons.lang3.builder.ToStringStyle.JSON_STYLE;\n+\n+public class AuditEntry {\n+\n+    private static final String TAG = \"CLA-CCD\";\n+\n+    private String dateTime;\n+    private int httpStatus;\n+    private String httpMethod;\n+    private String path;\n+    private String idamId;\n+    private String caseId;\n+    private String caseType;\n+    private String jurisdiction;\n+    private String eventSelected;\n+    private String invokingService;\n+    private String operationType;\n+    private String requestId;\n+    private String targetIdamId;\n+    private List<String> targetCaseRoles;\n+\n+    public void setDateTime(String time) {\n+        this.dateTime = time;\n+    }\n+\n+    public String getDateTime() {\n+        return dateTime;\n+    }\n+\n+    public int getHttpStatus() {\n+        return httpStatus;\n+    }\n+\n+    public void setHttpStatus(int httpStatus) {\n+        this.httpStatus = httpStatus;\n+    }\n+\n+    public String getHttpMethod() {\n+        return httpMethod;\n+    }\n+\n+    public void setHttpMethod(String httpMethod) {\n+        this.httpMethod = httpMethod;\n+    }\n+\n+    public String getPath() {\n+        return path;\n+    }\n+\n+    public void setPath(String path) {\n+        this.path = path;\n+    }\n+\n+    public String getOperationType() {\n+        return operationType;\n+    }\n+\n+    public void setOperationType(String operationType) {\n+        this.operationType = operationType;\n+    }\n+\n+    public String getIdamId() {\n+        return idamId;\n+    }\n+\n+    public void setIdamId(String idamId) {\n+        this.idamId = idamId;\n+    }\n+\n+    public String getInvokingService() {\n+        return invokingService;\n+    }\n+\n+    public void setInvokingService(String invokingService) {\n+        this.invokingService = invokingService;\n+    }\n+\n+    public static String getTAG() {\n+        return TAG;\n+    }\n+\n+    public String getCaseId() {\n+        return caseId;\n+    }\n+\n+    public void setCaseId(String caseId) {\n+        this.caseId = caseId;\n+    }\n+\n+    public String getJurisdiction() {\n+        return jurisdiction;\n+    }\n+\n+    public void setJurisdiction(String jurisdiction) {\n+        this.jurisdiction = jurisdiction;\n+    }\n+\n+    public String getCaseType() {\n+        return caseType;\n+    }\n+\n+    public void setCaseType(String caseType) {\n+        this.caseType = caseType;\n+    }\n+\n+    public String getEventSelected() {\n+        return eventSelected;\n+    }\n+\n+    public void setEventSelected(String eventSelected) {\n+        this.eventSelected = eventSelected;\n+    }\n+\n+    public String getRequestId() {\n+        return requestId;\n+    }\n+\n+    public void setRequestId(String requestId) {\n+        this.requestId = requestId;\n+    }\n+\n+    public String getTargetIdamId() {\n+        return targetIdamId;\n+    }\n+\n+    public void setTargetIdamId(String targetIdamId) {\n+        this.targetIdamId = targetIdamId;\n+    }\n+\n+    public List<String> getTargetCaseRoles() {\n+        return targetCaseRoles;\n+    }\n+\n+    public void setTargetCaseRoles(List<String> targetCaseRoles) {\n+        this.targetCaseRoles = targetCaseRoles;\n+    }\n+\n+    @Override\n+    public String toString() {\n+        return TAG + \" \" + dateTime + \" operationType:\" + operationType +", "originalCommit": "23349ce04bb8b4cffe870dec50d0a476eb73a086", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjI3NjA5MA==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r412276090", "bodyText": "need to reflect in the jira/confluence first.", "author": "smathangi", "createdAt": "2020-04-21T15:16:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjE3NTQwOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjE3Njg4Nw==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r412176887", "bodyText": "// FIXME : suppress 404 and 403/401 requests. is this going to be done in this implementation ?", "author": "Thor-tech-of-metal", "createdAt": "2020-04-21T13:19:06Z", "path": "src/main/java/uk/gov/hmcts/ccd/auditlog/AuditInterceptor.java", "diffHunk": "@@ -0,0 +1,31 @@\n+package uk.gov.hmcts.ccd.auditlog;\n+\n+import org.springframework.lang.Nullable;\n+import org.springframework.web.method.HandlerMethod;\n+import org.springframework.web.servlet.handler.HandlerInterceptorAdapter;\n+import uk.gov.hmcts.ccd.auditlog.aop.AuditContext;\n+import uk.gov.hmcts.ccd.auditlog.aop.AuditContextHolder;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+\n+public class AuditInterceptor extends HandlerInterceptorAdapter {\n+\n+    private final AuditService auditService;\n+\n+    public AuditInterceptor(AuditService auditService) {\n+        this.auditService = auditService;\n+    }\n+\n+    @Override\n+    public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler,\n+                           @Nullable Exception ex) {\n+        if (handler instanceof HandlerMethod && ((HandlerMethod) handler).hasMethodAnnotation(LogAudit.class)) {\n+            AuditContext auditContext = AuditContextHolder.getAuditContext();\n+            // FIXME : suppress 404 and 403/401 requests\n+            auditService.audit(request, response.getStatus(), auditContext);", "originalCommit": "23349ce04bb8b4cffe870dec50d0a476eb73a086", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjI0Nzk3OA==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r412247978", "bodyText": "done. removed", "author": "smathangi", "createdAt": "2020-04-21T14:43:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjE3Njg4Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjE3NzcwOQ==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r412177709", "bodyText": "I would move this logic into a separate AuditEntryFormatter class for better separation of concerns. We could also more easily change the formatting", "author": "mario-paniccia", "createdAt": "2020-04-21T13:20:10Z", "path": "src/main/java/uk/gov/hmcts/ccd/auditlog/AuditEntry.java", "diffHunk": "@@ -0,0 +1,169 @@\n+package uk.gov.hmcts.ccd.auditlog;\n+\n+import org.apache.commons.lang3.builder.ReflectionToStringBuilder;\n+\n+import java.util.List;\n+import java.util.stream.Collectors;\n+\n+import static org.apache.commons.lang3.StringUtils.isNotBlank;\n+import static org.apache.commons.lang3.builder.ToStringStyle.JSON_STYLE;\n+\n+public class AuditEntry {\n+\n+    private static final String TAG = \"CLA-CCD\";\n+\n+    private String dateTime;\n+    private int httpStatus;\n+    private String httpMethod;\n+    private String path;\n+    private String idamId;\n+    private String caseId;\n+    private String caseType;\n+    private String jurisdiction;\n+    private String eventSelected;\n+    private String invokingService;\n+    private String operationType;\n+    private String requestId;\n+    private String targetIdamId;\n+    private List<String> targetCaseRoles;\n+\n+    public void setDateTime(String time) {\n+        this.dateTime = time;\n+    }\n+\n+    public String getDateTime() {\n+        return dateTime;\n+    }\n+\n+    public int getHttpStatus() {\n+        return httpStatus;\n+    }\n+\n+    public void setHttpStatus(int httpStatus) {\n+        this.httpStatus = httpStatus;\n+    }\n+\n+    public String getHttpMethod() {\n+        return httpMethod;\n+    }\n+\n+    public void setHttpMethod(String httpMethod) {\n+        this.httpMethod = httpMethod;\n+    }\n+\n+    public String getPath() {\n+        return path;\n+    }\n+\n+    public void setPath(String path) {\n+        this.path = path;\n+    }\n+\n+    public String getOperationType() {\n+        return operationType;\n+    }\n+\n+    public void setOperationType(String operationType) {\n+        this.operationType = operationType;\n+    }\n+\n+    public String getIdamId() {\n+        return idamId;\n+    }\n+\n+    public void setIdamId(String idamId) {\n+        this.idamId = idamId;\n+    }\n+\n+    public String getInvokingService() {\n+        return invokingService;\n+    }\n+\n+    public void setInvokingService(String invokingService) {\n+        this.invokingService = invokingService;\n+    }\n+\n+    public static String getTAG() {\n+        return TAG;\n+    }\n+\n+    public String getCaseId() {\n+        return caseId;\n+    }\n+\n+    public void setCaseId(String caseId) {\n+        this.caseId = caseId;\n+    }\n+\n+    public String getJurisdiction() {\n+        return jurisdiction;\n+    }\n+\n+    public void setJurisdiction(String jurisdiction) {\n+        this.jurisdiction = jurisdiction;\n+    }\n+\n+    public String getCaseType() {\n+        return caseType;\n+    }\n+\n+    public void setCaseType(String caseType) {\n+        this.caseType = caseType;\n+    }\n+\n+    public String getEventSelected() {\n+        return eventSelected;\n+    }\n+\n+    public void setEventSelected(String eventSelected) {\n+        this.eventSelected = eventSelected;\n+    }\n+\n+    public String getRequestId() {\n+        return requestId;\n+    }\n+\n+    public void setRequestId(String requestId) {\n+        this.requestId = requestId;\n+    }\n+\n+    public String getTargetIdamId() {\n+        return targetIdamId;\n+    }\n+\n+    public void setTargetIdamId(String targetIdamId) {\n+        this.targetIdamId = targetIdamId;\n+    }\n+\n+    public List<String> getTargetCaseRoles() {\n+        return targetCaseRoles;\n+    }\n+\n+    public void setTargetCaseRoles(List<String> targetCaseRoles) {\n+        this.targetCaseRoles = targetCaseRoles;\n+    }\n+\n+    @Override\n+    public String toString() {\n+        return TAG + \" \" + dateTime + \" operationType:\" + operationType +\n+            (isNotBlank(caseId) ? \", caseId:\" + caseId : \"\") +\n+            (isNotBlank(idamId) ? \", idamId:\" + idamId : \"\") +\n+            (isNotBlank(invokingService) ? \", invokingService:\" + invokingService : \"\") +\n+            (isNotBlank(path) ? \", endpointCalled:\" + httpMethod + \" \" + path : \"\") +\n+            \", operationOutcome:\" + httpStatus +\n+            (isNotBlank(caseType) ? \", caseType:\" + caseType : \"\") +\n+            (isNotBlank(jurisdiction) ? \", jurisdiction:\" + jurisdiction : \"\") +\n+            (isNotBlank(eventSelected) ? \", eventSelected:\" + eventSelected : \"\") +\n+           (isNotBlank(targetIdamId) ? \", idamIdOfTarget:\" + targetIdamId : \"\") +\n+//            (isNotBlank(listOfCaseTypes) ? \", listOfCaseTypes:\" + listOfCaseTypes : \"\") +\n+            (targetCaseRoles != null && !targetCaseRoles.isEmpty() ? \", targetCaseRoles:\" +\n+                targetCaseRoles.stream().map(String::toString).collect(Collectors.joining(\",\")) : \"\") +\n+            (isNotBlank(requestId) ? \", X-Request-ID:\" + requestId : \"\") +\n+            '}';\n+    }\n+\n+    public String formattedAuditData() {\n+        return  ReflectionToStringBuilder.toString(this, JSON_STYLE, false, false,\n+            true, null).toString();\n+    }", "originalCommit": "23349ce04bb8b4cffe870dec50d0a476eb73a086", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjc1MjI2MA==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r412752260", "bodyText": "done", "author": "smathangi", "createdAt": "2020-04-22T07:49:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjE3NzcwOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjE3ODQyMg==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r412178422", "bodyText": "we'd need to evaluate impact of performance if using reflection", "author": "mario-paniccia", "createdAt": "2020-04-21T13:21:05Z", "path": "src/main/java/uk/gov/hmcts/ccd/auditlog/AuditEntry.java", "diffHunk": "@@ -0,0 +1,169 @@\n+package uk.gov.hmcts.ccd.auditlog;\n+\n+import org.apache.commons.lang3.builder.ReflectionToStringBuilder;\n+\n+import java.util.List;\n+import java.util.stream.Collectors;\n+\n+import static org.apache.commons.lang3.StringUtils.isNotBlank;\n+import static org.apache.commons.lang3.builder.ToStringStyle.JSON_STYLE;\n+\n+public class AuditEntry {\n+\n+    private static final String TAG = \"CLA-CCD\";\n+\n+    private String dateTime;\n+    private int httpStatus;\n+    private String httpMethod;\n+    private String path;\n+    private String idamId;\n+    private String caseId;\n+    private String caseType;\n+    private String jurisdiction;\n+    private String eventSelected;\n+    private String invokingService;\n+    private String operationType;\n+    private String requestId;\n+    private String targetIdamId;\n+    private List<String> targetCaseRoles;\n+\n+    public void setDateTime(String time) {\n+        this.dateTime = time;\n+    }\n+\n+    public String getDateTime() {\n+        return dateTime;\n+    }\n+\n+    public int getHttpStatus() {\n+        return httpStatus;\n+    }\n+\n+    public void setHttpStatus(int httpStatus) {\n+        this.httpStatus = httpStatus;\n+    }\n+\n+    public String getHttpMethod() {\n+        return httpMethod;\n+    }\n+\n+    public void setHttpMethod(String httpMethod) {\n+        this.httpMethod = httpMethod;\n+    }\n+\n+    public String getPath() {\n+        return path;\n+    }\n+\n+    public void setPath(String path) {\n+        this.path = path;\n+    }\n+\n+    public String getOperationType() {\n+        return operationType;\n+    }\n+\n+    public void setOperationType(String operationType) {\n+        this.operationType = operationType;\n+    }\n+\n+    public String getIdamId() {\n+        return idamId;\n+    }\n+\n+    public void setIdamId(String idamId) {\n+        this.idamId = idamId;\n+    }\n+\n+    public String getInvokingService() {\n+        return invokingService;\n+    }\n+\n+    public void setInvokingService(String invokingService) {\n+        this.invokingService = invokingService;\n+    }\n+\n+    public static String getTAG() {\n+        return TAG;\n+    }\n+\n+    public String getCaseId() {\n+        return caseId;\n+    }\n+\n+    public void setCaseId(String caseId) {\n+        this.caseId = caseId;\n+    }\n+\n+    public String getJurisdiction() {\n+        return jurisdiction;\n+    }\n+\n+    public void setJurisdiction(String jurisdiction) {\n+        this.jurisdiction = jurisdiction;\n+    }\n+\n+    public String getCaseType() {\n+        return caseType;\n+    }\n+\n+    public void setCaseType(String caseType) {\n+        this.caseType = caseType;\n+    }\n+\n+    public String getEventSelected() {\n+        return eventSelected;\n+    }\n+\n+    public void setEventSelected(String eventSelected) {\n+        this.eventSelected = eventSelected;\n+    }\n+\n+    public String getRequestId() {\n+        return requestId;\n+    }\n+\n+    public void setRequestId(String requestId) {\n+        this.requestId = requestId;\n+    }\n+\n+    public String getTargetIdamId() {\n+        return targetIdamId;\n+    }\n+\n+    public void setTargetIdamId(String targetIdamId) {\n+        this.targetIdamId = targetIdamId;\n+    }\n+\n+    public List<String> getTargetCaseRoles() {\n+        return targetCaseRoles;\n+    }\n+\n+    public void setTargetCaseRoles(List<String> targetCaseRoles) {\n+        this.targetCaseRoles = targetCaseRoles;\n+    }\n+\n+    @Override\n+    public String toString() {\n+        return TAG + \" \" + dateTime + \" operationType:\" + operationType +\n+            (isNotBlank(caseId) ? \", caseId:\" + caseId : \"\") +\n+            (isNotBlank(idamId) ? \", idamId:\" + idamId : \"\") +\n+            (isNotBlank(invokingService) ? \", invokingService:\" + invokingService : \"\") +\n+            (isNotBlank(path) ? \", endpointCalled:\" + httpMethod + \" \" + path : \"\") +\n+            \", operationOutcome:\" + httpStatus +\n+            (isNotBlank(caseType) ? \", caseType:\" + caseType : \"\") +\n+            (isNotBlank(jurisdiction) ? \", jurisdiction:\" + jurisdiction : \"\") +\n+            (isNotBlank(eventSelected) ? \", eventSelected:\" + eventSelected : \"\") +\n+           (isNotBlank(targetIdamId) ? \", idamIdOfTarget:\" + targetIdamId : \"\") +\n+//            (isNotBlank(listOfCaseTypes) ? \", listOfCaseTypes:\" + listOfCaseTypes : \"\") +\n+            (targetCaseRoles != null && !targetCaseRoles.isEmpty() ? \", targetCaseRoles:\" +\n+                targetCaseRoles.stream().map(String::toString).collect(Collectors.joining(\",\")) : \"\") +\n+            (isNotBlank(requestId) ? \", X-Request-ID:\" + requestId : \"\") +\n+            '}';\n+    }\n+\n+    public String formattedAuditData() {\n+        return  ReflectionToStringBuilder.toString(this, JSON_STYLE, false, false,", "originalCommit": "23349ce04bb8b4cffe870dec50d0a476eb73a086", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjI0NzQ3OA==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r412247478", "bodyText": "That's a placeholder method if we want json format . But requirements want planing text.. so will delete the method.", "author": "smathangi", "createdAt": "2020-04-21T14:43:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjE3ODQyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjI3NDc2NQ==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r412274765", "bodyText": "removed.", "author": "smathangi", "createdAt": "2020-04-21T15:14:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjE3ODQyMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjE4MTMxNA==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r412181314", "bodyText": "in terms of design I wouldn't pass down web level classes like HttpServletRequest to the AuditService. Ideally AuditService should not be tied to any web class.\nSame way as you don't pass down HttpServletRequest objects to other type of Services classes or *Operation classes\nWe could have the interceptor parsing the request, adding all that info to the context, and invoking the AuditService with the context only so the AuditService knows nothing about HttpServletRequest  and HttpServletResponse", "author": "mario-paniccia", "createdAt": "2020-04-21T13:24:49Z", "path": "src/main/java/uk/gov/hmcts/ccd/auditlog/AuditInterceptor.java", "diffHunk": "@@ -0,0 +1,31 @@\n+package uk.gov.hmcts.ccd.auditlog;\n+\n+import org.springframework.lang.Nullable;\n+import org.springframework.web.method.HandlerMethod;\n+import org.springframework.web.servlet.handler.HandlerInterceptorAdapter;\n+import uk.gov.hmcts.ccd.auditlog.aop.AuditContext;\n+import uk.gov.hmcts.ccd.auditlog.aop.AuditContextHolder;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+\n+public class AuditInterceptor extends HandlerInterceptorAdapter {\n+\n+    private final AuditService auditService;\n+\n+    public AuditInterceptor(AuditService auditService) {\n+        this.auditService = auditService;\n+    }\n+\n+    @Override\n+    public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler,\n+                           @Nullable Exception ex) {\n+        if (handler instanceof HandlerMethod && ((HandlerMethod) handler).hasMethodAnnotation(LogAudit.class)) {", "originalCommit": "23349ce04bb8b4cffe870dec50d0a476eb73a086", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjI4MDE2Mw==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r412280163", "bodyText": "agree.. don't like passing http semantics", "author": "smathangi", "createdAt": "2020-04-21T15:20:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjE4MTMxNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjE4NzE4OA==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r412187188", "bodyText": "out of coursiosity when is it that auditContext can be null?", "author": "mario-paniccia", "createdAt": "2020-04-21T13:32:05Z", "path": "src/main/java/uk/gov/hmcts/ccd/auditlog/AuditService.java", "diffHunk": "@@ -0,0 +1,61 @@\n+package uk.gov.hmcts.ccd.auditlog;\n+\n+import org.springframework.beans.factory.annotation.Qualifier;\n+import org.springframework.context.annotation.Lazy;\n+import org.springframework.stereotype.Service;\n+import uk.gov.hmcts.ccd.auditlog.aop.AuditContext;\n+import uk.gov.hmcts.ccd.data.SecurityUtils;\n+import uk.gov.hmcts.ccd.data.user.CachedUserRepository;\n+import uk.gov.hmcts.ccd.data.user.UserRepository;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import java.time.Clock;\n+import java.time.LocalDateTime;\n+\n+import static java.time.format.DateTimeFormatter.ISO_LOCAL_DATE_TIME;\n+\n+@Service\n+public class AuditService {\n+\n+    private final Clock clock;\n+    private final SecurityUtils securityUtils;\n+    private final UserRepository userRepository;\n+    private final AuditRepository auditRepository;\n+\n+    public AuditService(@Qualifier(\"utcClock\") final Clock clock,\n+                        @Qualifier(CachedUserRepository.QUALIFIER) final UserRepository userRepository,\n+                        @Lazy final SecurityUtils securityUtils, final AuditRepository auditRepository) {\n+        this.clock = clock;\n+        this.userRepository = userRepository;\n+        this.securityUtils = securityUtils;\n+        this.auditRepository = auditRepository;\n+    }\n+\n+    public void audit(HttpServletRequest request, int httpResponseStatus, AuditContext auditContext) {\n+        AuditEntry entry = new AuditEntry();\n+\n+        String formattedDate = LocalDateTime.now(clock).format(ISO_LOCAL_DATE_TIME);\n+\n+        entry.setDateTime(formattedDate);\n+        entry.setHttpStatus(httpResponseStatus);\n+        entry.setHttpMethod(request.getMethod());\n+        entry.setPath(request.getRequestURI());\n+        entry.setIdamId(userRepository.getUser().getEmail());\n+        entry.setInvokingService(securityUtils.getServiceName());\n+\n+        if (auditContext != null) {", "originalCommit": "23349ce04bb8b4cffe870dec50d0a476eb73a086", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjI1MDU4OQ==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r412250589", "bodyText": "Eg: 400 bad request when Spring fails (serialisation) to bind data to controller methods. Also, 403/401.", "author": "smathangi", "createdAt": "2020-04-21T14:46:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjE4NzE4OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjE5MTU5NQ==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r412191595", "bodyText": "with this design it's not possible from the code to distinguish what properties we are logging for each operation type. I think this is not ideal.\nI wonder whether it's possible to have an AuditEntry superclass with one implementation for each operation type that contains properties only relevant to that operation. So for example CaseSearchAudit, CaseUpdateAudit....", "author": "mario-paniccia", "createdAt": "2020-04-21T13:37:48Z", "path": "src/main/java/uk/gov/hmcts/ccd/auditlog/AuditEntry.java", "diffHunk": "@@ -0,0 +1,169 @@\n+package uk.gov.hmcts.ccd.auditlog;\n+\n+import org.apache.commons.lang3.builder.ReflectionToStringBuilder;\n+\n+import java.util.List;\n+import java.util.stream.Collectors;\n+\n+import static org.apache.commons.lang3.StringUtils.isNotBlank;\n+import static org.apache.commons.lang3.builder.ToStringStyle.JSON_STYLE;\n+\n+public class AuditEntry {", "originalCommit": "23349ce04bb8b4cffe870dec50d0a476eb73a086", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjI3OTM2MA==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r412279360", "bodyText": "you get that from LogAudit() annotation on the controller method.  I feel defining another class hierarchy complicates aspect design.", "author": "smathangi", "createdAt": "2020-04-21T15:19:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjE5MTU5NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjE5NDU4MA==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r412194580", "bodyText": "I think the AuditService could be injected with a AuditLogFormatter which is responsible for formatting the audit string. Then the Repository just logs the formatted entry", "author": "mario-paniccia", "createdAt": "2020-04-21T13:41:31Z", "path": "src/main/java/uk/gov/hmcts/ccd/auditlog/AuditRepository.java", "diffHunk": "@@ -0,0 +1,15 @@\n+package uk.gov.hmcts.ccd.auditlog;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.stereotype.Component;\n+\n+@Component\n+public class AuditRepository {\n+\n+    private static final Logger LOG = LoggerFactory.getLogger(AuditRepository.class);\n+\n+    public void save(final AuditEntry auditEntry) {\n+        LOG.info(auditEntry.toString());", "originalCommit": "23349ce04bb8b4cffe870dec50d0a476eb73a086", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjI1MzAxOQ==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r412253019", "bodyText": "if you introduce formatter class then it should inject here rather than AuditServcie.  I like passing domain entity to repository", "author": "smathangi", "createdAt": "2020-04-21T14:49:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjE5NDU4MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjE5OTIzOA==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r412199238", "bodyText": "since we're using AOP I'll request some thorough performance testing on this ticket to evaluate the impact on the CCD performance. Will add a comment on the ticket", "author": "mario-paniccia", "createdAt": "2020-04-21T13:47:14Z", "path": "src/main/java/uk/gov/hmcts/ccd/auditlog/aop/AuditAspect.java", "diffHunk": "@@ -0,0 +1,74 @@\n+package uk.gov.hmcts.ccd.auditlog.aop;\n+\n+import org.apache.commons.lang.StringUtils;\n+import org.aspectj.lang.JoinPoint;\n+import org.aspectj.lang.ProceedingJoinPoint;\n+import org.aspectj.lang.annotation.Around;\n+import org.aspectj.lang.annotation.Aspect;\n+import org.aspectj.lang.reflect.MethodSignature;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.context.expression.AnnotatedElementKey;\n+import org.springframework.expression.EvaluationContext;\n+import org.springframework.expression.spel.SpelEvaluationException;\n+import org.springframework.stereotype.Component;\n+import uk.gov.hmcts.ccd.auditlog.LogAudit;\n+\n+import java.lang.reflect.Method;\n+import java.util.List;\n+\n+@Aspect\n+@Component\n+public class AuditAspect {", "originalCommit": "23349ce04bb8b4cffe870dec50d0a476eb73a086", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjI1NDE2Mg==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r412254162", "bodyText": "sure, but that's the cleanest option we came across inspired from Spring caching. Otherwise you've to parse request/response jsons again and structure varies from one endpoint to another endpoint.\nAny other design suggestions always welcome.", "author": "smathangi", "createdAt": "2020-04-21T14:50:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjE5OTIzOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzcyMTczNA==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r413721734", "bodyText": "I think AOP is a good choice. We just need to evaluate the performance of the solution.", "author": "mario-paniccia", "createdAt": "2020-04-23T11:03:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjE5OTIzOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjIwNDczMQ==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r412204731", "bodyText": "ThreadLocal are a bit tricky and could cause mem leaks. For my knowledge, why we need to use it here? what problem is this addressing?", "author": "mario-paniccia", "createdAt": "2020-04-21T13:53:49Z", "path": "src/main/java/uk/gov/hmcts/ccd/auditlog/aop/AuditContextHolder.java", "diffHunk": "@@ -0,0 +1,21 @@\n+package uk.gov.hmcts.ccd.auditlog.aop;\n+\n+public class AuditContextHolder {\n+\n+    private AuditContextHolder() {}\n+\n+    private static final InheritableThreadLocal<AuditContext> threadLocal = new InheritableThreadLocal<>();", "originalCommit": "23349ce04bb8b4cffe870dec50d0a476eb73a086", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjI1NTM4NQ==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r412255385", "bodyText": "it depends on how you use it. how do you pass to Interceptor then..?", "author": "smathangi", "createdAt": "2020-04-21T14:52:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjIwNDczMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjIwNzM1Ng==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r412207356", "bodyText": "mmm don't understand why this operation is being logged as a search", "author": "mario-paniccia", "createdAt": "2020-04-21T13:56:51Z", "path": "src/main/java/uk/gov/hmcts/ccd/endpoint/std/CallbackEndpoint.java", "diffHunk": "@@ -30,6 +32,7 @@ public CallbackEndpoint(final PrintableDocumentListOperation printableDocumentLi\n     @ApiResponses(value = {\n         @ApiResponse(code = 200, message = \"Printable documents list retrieved\")\n     })\n+    @LogAudit(operationType = OperationType.SEARCH_CASE)", "originalCommit": "23349ce04bb8b4cffe870dec50d0a476eb73a086", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjIwNzgxMw==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r412207813", "bodyText": "We could probably ignore this endpoint", "author": "mario-paniccia", "createdAt": "2020-04-21T13:57:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjIwNzM1Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjIxODc3Mg==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r412218772", "bodyText": "This is a mistake. Will remove and in another PR with v1 will go as\n@LogAudit(operationType = OperationType.VIEW_CASE, caseId = \"#caseDetails.reference\", caseType = \"#caseTypeId\",\njurisdiction = \"#jurisdictionId\")", "author": "rafalkalita", "createdAt": "2020-04-21T14:10:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjIwNzM1Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjIwODgyMA==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r412208820", "bodyText": "we said to ignore this endpoint. If we want to log it I don't think we should log it as a search. Search case should be only for the search api I'd say", "author": "mario-paniccia", "createdAt": "2020-04-21T13:58:35Z", "path": "src/main/java/uk/gov/hmcts/ccd/endpoint/std/CaseAccessEndpoint.java", "diffHunk": "@@ -33,6 +35,7 @@ public CaseAccessEndpoint(CaseAccessOperation caseAccessOperation) {\n         @ApiResponse(code = 200, message = \"List of cases ids found\"),\n         @ApiResponse(code = 400, message = \"Invalid case ID\")\n     })\n+    @LogAudit(operationType = OperationType.SEARCH_CASE)\n     public List<String> findCaseIdsGivenUserIdHasAccessTo(", "originalCommit": "23349ce04bb8b4cffe870dec50d0a476eb73a086", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjIyMDAzMg==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r412220032", "bodyText": "It is a mistake. V1 will be in another PR. Will remove from this PR.", "author": "rafalkalita", "createdAt": "2020-04-21T14:11:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjIwODgyMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjIwOTk4Nw==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r412209987", "bodyText": "I think we agreed to have GRANT_CASE_ACCESS, REVOKE_CASE_ACCESS for these 2 v1 endpoints, and UDPATE_CASE_ACCESS for the v2 endpoint.", "author": "mario-paniccia", "createdAt": "2020-04-21T14:00:02Z", "path": "src/main/java/uk/gov/hmcts/ccd/endpoint/std/CaseAccessEndpoint.java", "diffHunk": "@@ -58,6 +61,7 @@ public CaseAccessEndpoint(CaseAccessOperation caseAccessOperation) {\n         @ApiResponse(code = 400, message = \"Invalid case ID\")\n     })\n     @ResponseStatus(value = HttpStatus.CREATED)\n+    @LogAudit(operationType = OperationType.UPDATE_CASE_ACCESS)", "originalCommit": "23349ce04bb8b4cffe870dec50d0a476eb73a086", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjIyMDgwNQ==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r412220805", "bodyText": "It is a mistake. V1 will be in another PR. Will remove from this PR.", "author": "rafalkalita", "createdAt": "2020-04-21T14:12:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjIwOTk4Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjIxMTYxNA==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r412211614", "bodyText": "this endpoint is not used by the UI when the user is viewing a case. So the name of the operation might be a bit misleading. I wonder whether we want to introduce a separate operation name for when the case is being accessed programmatically like in this case. Rather than by the UI. I'll ask the Lee and the BAs", "author": "mario-paniccia", "createdAt": "2020-04-21T14:01:53Z", "path": "src/main/java/uk/gov/hmcts/ccd/endpoint/std/CaseDetailsEndpoint.java", "diffHunk": "@@ -112,6 +114,7 @@ public CaseDetailsEndpoint(@Qualifier(CreatorGetCaseOperation.QUALIFIER) final G\n         @ApiResponse(code = 400, message = \"Invalid case ID\"),\n         @ApiResponse(code = 404, message = \"No case found for the given ID\")\n     })\n+    @LogAudit(operationType = OperationType.VIEW_CASE)", "originalCommit": "23349ce04bb8b4cffe870dec50d0a476eb73a086", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjIyNDgxNw==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r412224817", "bodyText": "Please check and let us know. Same as other comments. Will clean up and will be in v1 PR.", "author": "rafalkalita", "createdAt": "2020-04-21T14:17:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjIxMTYxNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjIxNjU3MA==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r412216570", "bodyText": "I think we agreed we wouldn't log these start event operations:\nHi @Mario We have few questions for Log and Audit\n1.) Do we need to log this one: Case access API - GET /caseworkers/{uid}/jurisdictions/{jid}/case-types/{ctid}/cases/ids\n2.) Do we need to log middle case creation steps, like Standard case API - GET /caseworkers/{uid}/jurisdictions/{jid}/case-types/{ctid}/event-triggers/{etid}/token  Those are trigerred on starting a new event (for Update or Create case), but not when we persist the case on the Submit.\n\nHi @Rafal Kalita 1) no 2) no \n\nIt's been implemented as yes and yes lol", "author": "mario-paniccia", "createdAt": "2020-04-21T14:07:36Z", "path": "src/main/java/uk/gov/hmcts/ccd/endpoint/std/CaseDetailsEndpoint.java", "diffHunk": "@@ -160,6 +164,7 @@ public CaseDetails findCaseDetailsForCitizen(\n         @ApiResponse(code = 404, message = \"No case found for the given ID\"),\n         @ApiResponse(code = 422, message = \"Process could not be started\")\n     })\n+    @LogAudit(operationType = OperationType.CREATE_CASE)", "originalCommit": "23349ce04bb8b4cffe870dec50d0a476eb73a086", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjIyMjI3MQ==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r412222271", "bodyText": "Same as other comments. Will clean up and will be in v1 PR.", "author": "rafalkalita", "createdAt": "2020-04-21T14:14:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjIxNjU3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjIyNjQxNA==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r412226414", "bodyText": "the reason I think it's best not to log the start of a case update it that it's better to have 1 log audit for each user operation. Because to update a case in CCD you need to call 2 endpoint, each user update would be result with 2 audit logs. Which is not nice", "author": "mario-paniccia", "createdAt": "2020-04-21T14:18:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjIxNjU3MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjIxOTMzNw==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r412219337", "bodyText": "we agreed not to log this. mmm how come we have done all the opposite of what we agreed? lol", "author": "mario-paniccia", "createdAt": "2020-04-21T14:10:53Z", "path": "src/main/java/uk/gov/hmcts/ccd/endpoint/std/CaseDetailsEndpoint.java", "diffHunk": "@@ -308,6 +318,7 @@ public CaseDetails saveCaseDetailsForCitizen(\n         @ApiResponse(code = 422, message = \"Field validation failed\"),\n         @ApiResponse(code = 409, message = \"Case reference not unique\")\n     })\n+    @LogAudit(operationType = OperationType.CREATE_CASE)\n     public JsonNode validateCaseDetails(", "originalCommit": "23349ce04bb8b4cffe870dec50d0a476eb73a086", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjIyMTY5Mw==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r412221693", "bodyText": "We have initially committed this on v1 as well, and then asked questions. Will go to another PR.", "author": "rafalkalita", "createdAt": "2020-04-21T14:13:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjIxOTMzNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjIyMzEyOA==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r412223128", "bodyText": "don't think it's correct to classify this as a search. There is not requirement to log this in the design. We could ignore or if we want to log it then we need  a more suitable operation name, like CASE_DOCUMENTS_ACCESS?", "author": "mario-paniccia", "createdAt": "2020-04-21T14:15:14Z", "path": "src/main/java/uk/gov/hmcts/ccd/endpoint/std/CaseDetailsEndpoint.java", "diffHunk": "@@ -385,6 +398,7 @@ public CaseDetails createCaseEventForCitizen(\n     @ApiResponses(value = {\n         @ApiResponse(code = 200, message = \"Documents list for the given case id\")\n     })\n+    @LogAudit(operationType = OperationType.SEARCH_CASE)\n     public List<Document> getDocumentsForCase(", "originalCommit": "23349ce04bb8b4cffe870dec50d0a476eb73a086", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjIyNDgzMQ==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r412224831", "bodyText": "I thing we can ignore this. We are already logging the search operation in searchCasesForCaseWorkers and searchCasesForCitizens. If we log here as well every user search would be logged twice which would be misleading. For one use operation I think it's better to have 1 log audit only.", "author": "mario-paniccia", "createdAt": "2020-04-21T14:17:10Z", "path": "src/main/java/uk/gov/hmcts/ccd/endpoint/std/CaseDetailsEndpoint.java", "diffHunk": "@@ -437,6 +453,7 @@ public CaseDetails createCaseEventForCitizen(\n     @ApiOperation(value = \"Get the pagination metadata for a case data search\")\n     @ApiResponses(value = {\n         @ApiResponse(code = 200, message = \"Pagination metadata for the given search criteria\")})\n+    @LogAudit(operationType = OperationType.SEARCH_CASE)", "originalCommit": "23349ce04bb8b4cffe870dec50d0a476eb73a086", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjIyNjcyNQ==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r412226725", "bodyText": "ignore please", "author": "mario-paniccia", "createdAt": "2020-04-21T14:19:19Z", "path": "src/main/java/uk/gov/hmcts/ccd/endpoint/std/CaseDetailsEndpoint.java", "diffHunk": "@@ -449,6 +466,7 @@ public PaginatedSearchMetadata searchCasesMetadataForCaseworkers(@PathVariable(\"\n     @ApiOperation(value = \"Get the pagination metadata for a case data search\")\n     @ApiResponses(value = {\n         @ApiResponse(code = 200, message = \"Pagination metadata for the given search criteria\")})\n+    @LogAudit(operationType = OperationType.SEARCH_CASE)\n     public PaginatedSearchMetadata searchCasesMetadataForCitizens(@PathVariable(\"uid\") final String uid,", "originalCommit": "23349ce04bb8b4cffe870dec50d0a476eb73a086", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjIyNzI4Mw==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r412227283", "bodyText": "UPDATE_CASE?", "author": "mario-paniccia", "createdAt": "2020-04-21T14:19:58Z", "path": "src/main/java/uk/gov/hmcts/ccd/endpoint/std/DraftsEndpoint.java", "diffHunk": "@@ -113,6 +117,7 @@ public DraftResponse updateDraftForCaseWorker(\n     @ApiResponses(value = {\n         @ApiResponse(code = 200, message = \"A displayable draft\")\n     })\n+    @LogAudit(operationType = OperationType.CREATE_CASE)", "originalCommit": "23349ce04bb8b4cffe870dec50d0a476eb73a086", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjI1NjMyMg==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r412256322", "bodyText": "We will ignore drafts totally. We use UPDATE_CASE when we already have the case created (it has a caseId/reference)", "author": "rafalkalita", "createdAt": "2020-04-21T14:53:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjIyNzI4Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjIyNzg4Mw==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r412227883", "bodyText": "rename to AuditOperationType please", "author": "mario-paniccia", "createdAt": "2020-04-21T14:20:41Z", "path": "src/main/java/uk/gov/hmcts/ccd/auditlog/OperationType.java", "diffHunk": "@@ -0,0 +1,19 @@\n+package uk.gov.hmcts.ccd.auditlog;\n+\n+public enum OperationType {", "originalCommit": "23349ce04bb8b4cffe870dec50d0a476eb73a086", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjIyODc2Mg==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r412228762", "bodyText": "this is not a search, it's  a  case view. VIEW_CASE?", "author": "mario-paniccia", "createdAt": "2020-04-21T14:21:36Z", "path": "src/main/java/uk/gov/hmcts/ccd/endpoint/ui/QueryEndpoint.java", "diffHunk": "@@ -218,6 +193,7 @@ public SearchResultView searchNew(@PathVariable(\"jid\") final String jurisdiction\n     @ApiResponses(value = {\n         @ApiResponse(code = 200, message = \"A displayable case\")\n     })\n+    @LogAudit(operationType = OperationType.SEARCH_CASE)", "originalCommit": "23349ce04bb8b4cffe870dec50d0a476eb73a086", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjIzMDIyNA==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r412230224", "bodyText": "better to introduce a VIEW_CASE_HISTORY operation", "author": "mario-paniccia", "createdAt": "2020-04-21T14:23:21Z", "path": "src/main/java/uk/gov/hmcts/ccd/endpoint/ui/QueryEndpoint.java", "diffHunk": "@@ -290,6 +269,7 @@ public CaseEventTrigger getEventTriggerForDraft(@PathVariable(\"uid\") String user\n         @ApiResponse(code = 200, message = \"Displayable case data\"),\n         @ApiResponse(code = 404, message = \"Invalid jurisdiction/case type/case reference or event id\")\n     })\n+    @LogAudit(operationType = OperationType.VIEW_CASE)", "originalCommit": "23349ce04bb8b4cffe870dec50d0a476eb73a086", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjI0NzUzMQ==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r412247531", "bodyText": "We will ignore this one.", "author": "rafalkalita", "createdAt": "2020-04-21T14:43:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjIzMDIyNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjIzMTgyNw==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r412231827", "bodyText": "either we ignore, or we create a better operation name I'd suggest", "author": "mario-paniccia", "createdAt": "2020-04-21T14:25:15Z", "path": "src/main/java/uk/gov/hmcts/ccd/v2/external/controller/DocumentController.java", "diffHunk": "@@ -66,6 +68,7 @@ public DocumentController(\n             message = V2.Error.PRINTABLE_DOCUMENTS_ENDPOINT_DOWN\n         )\n     })\n+    @LogAudit(operationType = OperationType.VIEW_CASE, caseId = \"#caseId\")\n     public ResponseEntity<DocumentsResource> getDocuments(@PathVariable(\"caseId\") String caseId) {", "originalCommit": "23349ce04bb8b4cffe870dec50d0a476eb73a086", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjIzMjE4MA==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r412232180", "bodyText": "better to ignore as we agreed", "author": "mario-paniccia", "createdAt": "2020-04-21T14:25:40Z", "path": "src/main/java/uk/gov/hmcts/ccd/v2/external/controller/StartTriggerController.java", "diffHunk": "@@ -61,6 +63,8 @@ public StartTriggerController(\n             message = EVENT_TRIGGER_NOT_FOUND\n         )\n     })\n+    @LogAudit(operationType = OperationType.CREATE_CASE, jurisdiction = \"#result.body.caseDetails.jurisdiction\",\n+        caseType = \"#caseTypeId\", eventName = \"#triggerId\")\n     public ResponseEntity<StartTriggerResource> getStartCaseTrigger(@PathVariable(\"caseTypeId\") String caseTypeId,", "originalCommit": "23349ce04bb8b4cffe870dec50d0a476eb73a086", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjIzMjMyNg==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r412232326", "bodyText": "we can ignore as we agreed", "author": "mario-paniccia", "createdAt": "2020-04-21T14:25:53Z", "path": "src/main/java/uk/gov/hmcts/ccd/v2/external/controller/StartTriggerController.java", "diffHunk": "@@ -104,6 +108,8 @@ public StartTriggerController(\n             message = EVENT_TRIGGER_NOT_FOUND\n         )\n     })\n+    @LogAudit(operationType = OperationType.UPDATE_CASE, jurisdiction = \"#result.body.caseDetails.jurisdiction\",\n+        caseType = \"#result.body.caseDetails.caseTypeId\", eventName = \"#triggerId\", caseId = \"#caseId\")\n     public ResponseEntity<StartTriggerResource> getStartEventTrigger(@PathVariable(\"caseId\") String caseId,", "originalCommit": "23349ce04bb8b4cffe870dec50d0a476eb73a086", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjIzNDAwNg==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r412234006", "bodyText": "I'd suggest VIEW_CASE_HISTORY", "author": "mario-paniccia", "createdAt": "2020-04-21T14:27:46Z", "path": "src/main/java/uk/gov/hmcts/ccd/v2/internal/controller/UICaseController.java", "diffHunk": "@@ -108,6 +113,8 @@ public UICaseController(\n             message = \"Case event not found\"\n         )\n     })\n+    @LogAudit(operationType = VIEW_CASE, caseId = \"#caseId\", eventName = \"#result.body.event.eventId\",", "originalCommit": "23349ce04bb8b4cffe870dec50d0a476eb73a086", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjg1MzY2MQ==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r412853661", "bodyText": "done", "author": "rafalkalita", "createdAt": "2020-04-22T10:12:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjIzNDAwNg=="}], "type": "inlineReview"}, {"oid": "964ec1f4e18aac3b88059f5b0c37cafc5717a65a", "url": "https://github.com/hmcts/ccd-data-store-api/commit/964ec1f4e18aac3b88059f5b0c37cafc5717a65a", "message": "RDM-8051 remove v1 endpoint logging - there will be a separate PR", "committedDate": "2020-04-21T14:37:00Z", "type": "commit"}, {"oid": "c8214c3912eae3e2019ab32439f287224fc4ab1f", "url": "https://github.com/hmcts/ccd-data-store-api/commit/c8214c3912eae3e2019ab32439f287224fc4ab1f", "message": "RDM-8051 CaseAccessEndpoint", "committedDate": "2020-04-21T17:45:36Z", "type": "commit"}, {"oid": "3c1be43cad815a17b913e229d16d2354fc146c83", "url": "https://github.com/hmcts/ccd-data-store-api/commit/3c1be43cad815a17b913e229d16d2354fc146c83", "message": "RDM-8051 - minor refactoring and clean up", "committedDate": "2020-04-22T07:29:42Z", "type": "commit"}, {"oid": "1650864ba4a8b55a6af9359ad3619ac7a7919f96", "url": "https://github.com/hmcts/ccd-data-store-api/commit/1650864ba4a8b55a6af9359ad3619ac7a7919f96", "message": "RDM-8051 - minor refactoring and clean up\n\n# Conflicts:\n#\tsrc/main/java/uk/gov/hmcts/ccd/auditlog/AuditEntry.java\n#\tsrc/main/java/uk/gov/hmcts/ccd/auditlog/AuditService.java", "committedDate": "2020-04-22T07:34:00Z", "type": "commit"}, {"oid": "89c34ff8aaf71a3fbfa4d5810bdc2ba42b225600", "url": "https://github.com/hmcts/ccd-data-store-api/commit/89c34ff8aaf71a3fbfa4d5810bdc2ba42b225600", "message": "RDM-8051 Remove v1 property", "committedDate": "2020-04-22T09:35:12Z", "type": "commit"}, {"oid": "d0e94a8563b0252101add4e13e31ffc464295631", "url": "https://github.com/hmcts/ccd-data-store-api/commit/d0e94a8563b0252101add4e13e31ffc464295631", "message": "RDM-8051 Rename OperationType to AuditOperationType", "committedDate": "2020-04-22T10:00:53Z", "type": "commit"}, {"oid": "e9804e39845e42e8bb2e3c664a568828badab393", "url": "https://github.com/hmcts/ccd-data-store-api/commit/e9804e39845e42e8bb2e3c664a568828badab393", "message": "RDM-8051 Rename OperationType to AuditOperationType", "committedDate": "2020-04-22T10:01:21Z", "type": "commit"}, {"oid": "8d092ef0379fc0807b0e65c7d565a305b1c493de", "url": "https://github.com/hmcts/ccd-data-store-api/commit/8d092ef0379fc0807b0e65c7d565a305b1c493de", "message": "RDM-8051 remove LogAndAudit from the StartTriggerController", "committedDate": "2020-04-22T10:07:25Z", "type": "commit"}, {"oid": "9a8f962089bd0dda4d19cee7d02a0dd077aa215f", "url": "https://github.com/hmcts/ccd-data-store-api/commit/9a8f962089bd0dda4d19cee7d02a0dd077aa215f", "message": "RDM-8051 Change GET events from VIEW_CASE to VIEW_CASE_HISTORY", "committedDate": "2020-04-22T10:12:26Z", "type": "commit"}, {"oid": "4841ab2af29258967fb1473edcbfc331406e3c6f", "url": "https://github.com/hmcts/ccd-data-store-api/commit/4841ab2af29258967fb1473edcbfc331406e3c6f", "message": "RDM-8051 do not ignore FORBIDDEN, UNAUTHORIZED errors", "committedDate": "2020-04-22T10:41:15Z", "type": "commit"}, {"oid": "89388626c13384d4caa6a0a97737b7a9317fcdf0", "url": "https://github.com/hmcts/ccd-data-store-api/commit/89388626c13384d4caa6a0a97737b7a9317fcdf0", "message": "RDM-8051 do not log DocumentsController", "committedDate": "2020-04-22T13:58:23Z", "type": "commit"}, {"oid": "41a5a15d9b5cc843fbbd943dd5e7a5b2602b651a", "url": "https://github.com/hmcts/ccd-data-store-api/commit/41a5a15d9b5cc843fbbd943dd5e7a5b2602b651a", "message": "RDM-8051 do not log GET /documents", "committedDate": "2020-04-22T14:05:43Z", "type": "commit"}, {"oid": "41adb948d3456d439a28ef01e8543336070a35ef", "url": "https://github.com/hmcts/ccd-data-store-api/commit/41adb948d3456d439a28ef01e8543336070a35ef", "message": "RDM-8051 Rename VIEW_CASE to CASE_ACCESSED", "committedDate": "2020-04-22T14:09:28Z", "type": "commit"}, {"oid": "e40a85ac19103518a978343acdad573647fc5263", "url": "https://github.com/hmcts/ccd-data-store-api/commit/e40a85ac19103518a978343acdad573647fc5263", "message": "RDM-8051 Update CaseAccessEndpoint LogAudit OperationType", "committedDate": "2020-04-22T14:23:42Z", "type": "commit"}, {"oid": "d02c5825f9ccee12e3dd2e399b7218aadb71fc6a", "url": "https://github.com/hmcts/ccd-data-store-api/commit/d02c5825f9ccee12e3dd2e399b7218aadb71fc6a", "message": "Merge branch 'RDM-8051' into RDM-8051-v1\n\n# Conflicts:\n#\tsrc/main/java/uk/gov/hmcts/ccd/auditlog/AuditInterceptor.java\n#\tsrc/main/java/uk/gov/hmcts/ccd/auditlog/AuditOperationType.java\n#\tsrc/main/java/uk/gov/hmcts/ccd/auditlog/AuditService.java\n#\tsrc/main/java/uk/gov/hmcts/ccd/auditlog/aop/AuditContext.java\n#\tsrc/main/java/uk/gov/hmcts/ccd/endpoint/std/CaseAccessEndpoint.java\n#\tsrc/main/java/uk/gov/hmcts/ccd/endpoint/std/CaseDetailsEndpoint.java\n#\tsrc/main/java/uk/gov/hmcts/ccd/endpoint/std/CaseSearchEndpoint.java\n#\tsrc/main/java/uk/gov/hmcts/ccd/endpoint/ui/QueryEndpoint.java", "committedDate": "2020-04-22T14:34:47Z", "type": "commit"}, {"oid": "9b1e7f71e8a9988cf5596e19d27ac0f7ec0daba7", "url": "https://github.com/hmcts/ccd-data-store-api/commit/9b1e7f71e8a9988cf5596e19d27ac0f7ec0daba7", "message": "RDM-8051 Fix the error after merge", "committedDate": "2020-04-22T14:37:29Z", "type": "commit"}, {"oid": "f1c26896cfe7e41b21179d4a121a1a6b4084837b", "url": "https://github.com/hmcts/ccd-data-store-api/commit/f1c26896cfe7e41b21179d4a121a1a6b4084837b", "message": "RDM-8051 Updated OperationType to AuditOperationType", "committedDate": "2020-04-22T14:44:46Z", "type": "commit"}, {"oid": "a2dbc01dc8a92cb19cb2a4538076aa9b3801d986", "url": "https://github.com/hmcts/ccd-data-store-api/commit/a2dbc01dc8a92cb19cb2a4538076aa9b3801d986", "message": "RDM-8051 LogAudit in CaseDetailsEndpoint", "committedDate": "2020-04-22T17:22:58Z", "type": "commit"}, {"oid": "83262b5c49e1b84706bdfa88edb5618b49441487", "url": "https://github.com/hmcts/ccd-data-store-api/commit/83262b5c49e1b84706bdfa88edb5618b49441487", "message": "RDM-8051 LogAudit in CaseDetailsEndpoint", "committedDate": "2020-04-22T17:39:43Z", "type": "commit"}, {"oid": "3f0d3266d9798d4034c0f18ff76ed585cff60b13", "url": "https://github.com/hmcts/ccd-data-store-api/commit/3f0d3266d9798d4034c0f18ff76ed585cff60b13", "message": "RDM-8051 CaseDetailsEndpointIT refactor", "committedDate": "2020-04-22T18:32:22Z", "type": "commit"}, {"oid": "e0a1c87aa94d93650c2bb2820ac8ad65f0a4b318", "url": "https://github.com/hmcts/ccd-data-store-api/commit/e0a1c87aa94d93650c2bb2820ac8ad65f0a4b318", "message": "RDM-8051 - dateTime field and unit tests for interceptor, formatter", "committedDate": "2020-04-23T07:11:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzY5NjgzNg==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r413696836", "bodyText": "this should be a config property rather than hardcoded?", "author": "mario-paniccia", "createdAt": "2020-04-23T10:22:59Z", "path": "src/main/java/uk/gov/hmcts/ccd/auditlog/AuditInterceptor.java", "diffHunk": "@@ -0,0 +1,63 @@\n+package uk.gov.hmcts.ccd.auditlog;\n+\n+import com.google.common.collect.Lists;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.lang.Nullable;\n+import org.springframework.web.method.HandlerMethod;\n+import org.springframework.web.servlet.handler.HandlerInterceptorAdapter;\n+import uk.gov.hmcts.ccd.auditlog.aop.AuditAspect;\n+import uk.gov.hmcts.ccd.auditlog.aop.AuditContext;\n+import uk.gov.hmcts.ccd.auditlog.aop.AuditContextHolder;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import java.util.List;\n+\n+import static org.springframework.http.HttpStatus.NOT_FOUND;\n+\n+public class AuditInterceptor extends HandlerInterceptorAdapter {\n+\n+    private static final Logger LOG = LoggerFactory.getLogger(AuditAspect.class);\n+\n+    public static final String REQUEST_ID = \"request-id\";\n+\n+    private final AuditService auditService;\n+\n+    private static final List<HttpStatus> IGNORED_STATUSES = Lists.newArrayList(NOT_FOUND);", "originalCommit": "e0a1c87aa94d93650c2bb2820ac8ad65f0a4b318", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzc4ODAxMg==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r413788012", "bodyText": "done", "author": "smathangi", "createdAt": "2020-04-23T12:50:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzY5NjgzNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzcwMDY3Ng==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r413700676", "bodyText": "mmm did we say to call this \"Update case access permissions\"?", "author": "mario-paniccia", "createdAt": "2020-04-23T10:29:08Z", "path": "src/main/java/uk/gov/hmcts/ccd/auditlog/AuditOperationType.java", "diffHunk": "@@ -0,0 +1,20 @@\n+package uk.gov.hmcts.ccd.auditlog;\n+\n+public enum AuditOperationType {\n+    CREATE_CASE(\"Create case\"),\n+    UPDATE_CASE(\"Update case\"),\n+    CASE_ACCESSED(\"Case Accessed\"),\n+    SEARCH_CASE(\"Search case\"),\n+    UPDATE_CASE_ACCESS(\"Update case access\"),", "originalCommit": "e0a1c87aa94d93650c2bb2820ac8ad65f0a4b318", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzc5MzIwOQ==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r413793209", "bodyText": "done", "author": "rafalkalita", "createdAt": "2020-04-23T12:57:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzcwMDY3Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzcxNzUxMA==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r413717510", "bodyText": "we should use dependency injection for AuditRepository", "author": "mario-paniccia", "createdAt": "2020-04-23T10:56:31Z", "path": "src/main/java/uk/gov/hmcts/ccd/auditlog/AuditService.java", "diffHunk": "@@ -0,0 +1,57 @@\n+package uk.gov.hmcts.ccd.auditlog;\n+\n+import org.springframework.beans.factory.annotation.Qualifier;\n+import org.springframework.context.annotation.Lazy;\n+import org.springframework.stereotype.Service;\n+import uk.gov.hmcts.ccd.auditlog.aop.AuditContext;\n+import uk.gov.hmcts.ccd.data.SecurityUtils;\n+import uk.gov.hmcts.ccd.data.user.CachedUserRepository;\n+import uk.gov.hmcts.ccd.data.user.UserRepository;\n+\n+import java.time.Clock;\n+import java.time.LocalDateTime;\n+\n+import static java.time.format.DateTimeFormatter.ISO_LOCAL_DATE_TIME;\n+\n+@Service\n+public class AuditService {\n+\n+    private final Clock clock;\n+    private final SecurityUtils securityUtils;\n+    private final UserRepository userRepository;\n+    private final AuditRepository auditRepository;\n+\n+    public AuditService(@Qualifier(\"utcClock\") final Clock clock,\n+                        @Qualifier(CachedUserRepository.QUALIFIER) final UserRepository userRepository,\n+                        @Lazy final SecurityUtils securityUtils, final AuditRepository auditRepository) {", "originalCommit": "e0a1c87aa94d93650c2bb2820ac8ad65f0a4b318", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzc3MjE4Nw==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/909#discussion_r413772187", "bodyText": "it does", "author": "smathangi", "createdAt": "2020-04-23T12:27:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzcxNzUxMA=="}], "type": "inlineReview"}, {"oid": "2d4bf1b4bc525013f9ee2137f14f68e7dd993ffd", "url": "https://github.com/hmcts/ccd-data-store-api/commit/2d4bf1b4bc525013f9ee2137f14f68e7dd993ffd", "message": "RDM-8051 - review comment - auditRepository interface.", "committedDate": "2020-04-23T12:22:09Z", "type": "commit"}]}