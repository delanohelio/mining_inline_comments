{"pr_number": 1225, "pr_title": "RDM-10165: Update V2 createEvent API", "pr_createdAt": "2020-11-18T20:48:07Z", "pr_url": "https://github.com/hmcts/ccd-data-store-api/pull/1225", "timeline": [{"oid": "ac63afb28ad8168280ba3937c8c1cd577dc2879c", "url": "https://github.com/hmcts/ccd-data-store-api/commit/ac63afb28ad8168280ba3937c8c1cd577dc2879c", "message": "RDM-10165:Update V2 createEvent API to include on_behalf_of user in request parameters", "committedDate": "2020-11-16T14:54:55Z", "type": "commit"}, {"oid": "5d301c698ffb487f7e8bf4d4056c05144f391f09", "url": "https://github.com/hmcts/ccd-data-store-api/commit/5d301c698ffb487f7e8bf4d4056c05144f391f09", "message": "RDM-10165:Update V2 createEvent API to include on_behalf_of user in request parameters", "committedDate": "2020-11-18T20:45:55Z", "type": "commit"}, {"oid": "43dbc8671c142898535616dbe8c3313d22c094c1", "url": "https://github.com/hmcts/ccd-data-store-api/commit/43dbc8671c142898535616dbe8c3313d22c094c1", "message": "RDM-10165:Unused imports removed", "committedDate": "2020-11-18T22:29:18Z", "type": "commit"}, {"oid": "04e95bd8be7b4eadc8f64fc41afc80d4b98491e2", "url": "https://github.com/hmcts/ccd-data-store-api/commit/04e95bd8be7b4eadc8f64fc41afc80d4b98491e2", "message": "RDM-10165:reverted to previous version", "committedDate": "2020-11-18T23:47:03Z", "type": "commit"}, {"oid": "58dd6456ceaa7227e835c9bc4e23397b34cd2e45", "url": "https://github.com/hmcts/ccd-data-store-api/commit/58dd6456ceaa7227e835c9bc4e23397b34cd2e45", "message": "RDM-10165: imports reorganised to habdle issue with (was detected as changed but without having changed lines)", "committedDate": "2020-11-19T09:45:17Z", "type": "commit"}, {"oid": "e291f36793ae6bf856fa098664de2c7228ef647a", "url": "https://github.com/hmcts/ccd-data-store-api/commit/e291f36793ae6bf856fa098664de2c7228ef647a", "message": "RDM-10165: imports reorganised to habdle issue with (was detected as changed but without having changed lines)", "committedDate": "2020-11-19T09:45:47Z", "type": "commit"}, {"oid": "dc87f29a2bb05d7cb57007822531acff041076e2", "url": "https://github.com/hmcts/ccd-data-store-api/commit/dc87f29a2bb05d7cb57007822531acff041076e2", "message": "RDM-10165:suppress duplicate blocks", "committedDate": "2020-11-19T13:20:17Z", "type": "commit"}, {"oid": "2ef670f4906da46bc6a7fcaa41c35cc11519349d", "url": "https://github.com/hmcts/ccd-data-store-api/commit/2ef670f4906da46bc6a7fcaa41c35cc11519349d", "message": "RDM-10165: Checkstyle issues resolved", "committedDate": "2020-11-19T14:11:04Z", "type": "commit"}, {"oid": "a3a9901e6ce3042c9ee48edd5254d146d4bbe575", "url": "https://github.com/hmcts/ccd-data-store-api/commit/a3a9901e6ce3042c9ee48edd5254d146d4bbe575", "message": "RDM-10165: Suppress CVE-2020-26168", "committedDate": "2020-11-19T14:28:30Z", "type": "commit"}, {"oid": "426101fbc6d82b67c3e1ad57e2d86479fd97b6bd", "url": "https://github.com/hmcts/ccd-data-store-api/commit/426101fbc6d82b67c3e1ad57e2d86479fd97b6bd", "message": "Merge branch 'develop' into RDM-10165", "committedDate": "2020-11-19T15:00:12Z", "type": "commit"}, {"oid": "a5e71bcfaa9e1c86a84c8a6c96b92d7a24e3bfaf", "url": "https://github.com/hmcts/ccd-data-store-api/commit/a5e71bcfaa9e1c86a84c8a6c96b92d7a24e3bfaf", "message": "RDM-10165: Suppress CVE-2020-26168", "committedDate": "2020-11-19T15:42:55Z", "type": "commit"}, {"oid": "70029c107361385c2b0359fd72a886bdddf837c7", "url": "https://github.com/hmcts/ccd-data-store-api/commit/70029c107361385c2b0359fd72a886bdddf837c7", "message": "RDM-10165:CPD exclusions added", "committedDate": "2020-11-19T16:41:52Z", "type": "commit"}, {"oid": "56f6efb9de39f7d674c752a785c757f899aa6f58", "url": "https://github.com/hmcts/ccd-data-store-api/commit/56f6efb9de39f7d674c752a785c757f899aa6f58", "message": "RDM-10165: functional Test cases added", "committedDate": "2020-11-23T17:07:17Z", "type": "commit"}, {"oid": "b1bed79d29e3909c26a9b3d66da046f2514c1511", "url": "https://github.com/hmcts/ccd-data-store-api/commit/b1bed79d29e3909c26a9b3d66da046f2514c1511", "message": "RDM-10165: functional Test cases added", "committedDate": "2020-11-23T17:07:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTY0NTU4OQ==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1225#discussion_r529645589", "bodyText": "May we  you can add a test in CachedUserRepositoryTest.  Optional It is not mandatory if sonar already passed. :)", "author": "Thor-tech-of-metal", "createdAt": "2020-11-24T15:35:41Z", "path": "src/main/java/uk/gov/hmcts/ccd/data/user/CachedUserRepository.java", "diffHunk": "@@ -47,6 +47,11 @@ public IdamUser getUser() {\n         return userRepository.getUser();\n     }", "originalCommit": "b1bed79d29e3909c26a9b3d66da046f2514c1511", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDI1MzU1Nw==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1225#discussion_r530253557", "bodyText": "I don't think we need the test here as it is trying to get from DefaultUserRepository always", "author": "kiran-yenigala-hmcts", "createdAt": "2020-11-25T10:10:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTY0NTU4OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTY0OTE4Ng==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1225#discussion_r529649186", "bodyText": "May we you can add a test in DefaultUserRepositoryTest Optional It is not mandatory if sonar already passed. :)", "author": "Thor-tech-of-metal", "createdAt": "2020-11-24T15:38:08Z", "path": "src/main/java/uk/gov/hmcts/ccd/data/user/DefaultUserRepository.java", "diffHunk": "@@ -88,6 +88,12 @@ public IdamUser getUser() {\n         return toIdamUser(userInfo);\n     }\n \n+    @Override\n+    public IdamUser getUser(String userToken) {\n+        UserInfo userInfo = securityUtils.getUserInfo(userToken);\n+        return toIdamUser(userInfo);\n+    }\n+\n     @Override", "originalCommit": "b1bed79d29e3909c26a9b3d66da046f2514c1511", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDI1NjY5NQ==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1225#discussion_r530256695", "bodyText": "Added test case in DefaultUserRepositoryTest", "author": "kiran-yenigala-hmcts", "createdAt": "2020-11-25T10:14:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTY0OTE4Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTY1MDU1MQ==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1225#discussion_r529650551", "bodyText": "Could you please move  the imports and take developed  version ?", "author": "Thor-tech-of-metal", "createdAt": "2020-11-24T15:39:08Z", "path": "src/main/java/uk/gov/hmcts/ccd/domain/model/aggregated/CaseViewField.java", "diffHunk": "@@ -1,15 +1,14 @@\n package uk.gov.hmcts.ccd.domain.model.aggregated;\n ", "originalCommit": "b1bed79d29e3909c26a9b3d66da046f2514c1511", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTY1MDk0MQ==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1225#discussion_r529650941", "bodyText": "Could you please move  the imports and take developed  version ?", "author": "Thor-tech-of-metal", "createdAt": "2020-11-24T15:39:25Z", "path": "src/main/java/uk/gov/hmcts/ccd/domain/model/aggregated/CaseViewFieldBuilder.java", "diffHunk": "@@ -1,14 +1,13 @@\n package uk.gov.hmcts.ccd.domain.model.aggregated;\n \n-import uk.gov.hmcts.ccd.domain.model.definition.CaseEventFieldDefinition;\n-import uk.gov.hmcts.ccd.domain.model.definition.CaseFieldDefinition;", "originalCommit": "b1bed79d29e3909c26a9b3d66da046f2514c1511", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDI1NzQ1OQ==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1225#discussion_r530257459", "bodyText": "reverted to develop version", "author": "kiran-yenigala-hmcts", "createdAt": "2020-11-25T10:15:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTY1MDk0MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTY1MTE3Mg==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1225#discussion_r529651172", "bodyText": "Could you please move  the imports and take developed  version ?", "author": "Thor-tech-of-metal", "createdAt": "2020-11-24T15:39:33Z", "path": "src/main/java/uk/gov/hmcts/ccd/domain/model/definition/CaseEventFieldDefinition.java", "diffHunk": "@@ -3,12 +3,11 @@\n import com.fasterxml.jackson.annotation.JsonProperty;\n import io.swagger.annotations.ApiModel;", "originalCommit": "b1bed79d29e3909c26a9b3d66da046f2514c1511", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDI1ODA4OA==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1225#discussion_r530258088", "bodyText": "reverted to develop version", "author": "kiran-yenigala-hmcts", "createdAt": "2020-11-25T10:16:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTY1MTE3Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTY1MTM5Mg==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1225#discussion_r529651392", "bodyText": "Could you please move  the imports and take developed  version ?", "author": "Thor-tech-of-metal", "createdAt": "2020-11-24T15:39:41Z", "path": "src/main/java/uk/gov/hmcts/ccd/domain/model/definition/CaseFieldDefinition.java", "diffHunk": "@@ -3,16 +3,15 @@\n import com.fasterxml.jackson.annotation.JsonIgnore;\n import com.fasterxml.jackson.annotation.JsonProperty;\n import io.swagger.annotations.ApiModel;\n-import lombok.ToString;\n-import uk.gov.hmcts.ccd.domain.model.aggregated.CommonField;", "originalCommit": "b1bed79d29e3909c26a9b3d66da046f2514c1511", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDI2MDMxMA==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1225#discussion_r530260310", "bodyText": "reverted to develop version", "author": "kiran-yenigala-hmcts", "createdAt": "2020-11-25T10:20:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTY1MTM5Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTY1MzE3MA==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1225#discussion_r529653170", "bodyText": "Could you please take developed  version  and exclude this file from the pr? unless checkstyle crash :)", "author": "Thor-tech-of-metal", "createdAt": "2020-11-24T15:40:53Z", "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/createevent/AuthorisedCreateEventOperation.java", "diffHunk": "@@ -76,8 +76,7 @@ public CaseDetails createCaseEvent(String caseReference,\n \n         verifyUpsertAccess(content.getEvent(), content.getData(), existingCaseDetails, caseTypeDefinition, userRoles);\n \n-        final CaseDetails caseDetails = createEventOperation.createCaseEvent(caseReference,\n-                                                                             content);", "originalCommit": "b1bed79d29e3909c26a9b3d66da046f2514c1511", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDI1ODc1MQ==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1225#discussion_r530258751", "bodyText": "reverted to develop version", "author": "kiran-yenigala-hmcts", "createdAt": "2020-11-25T10:17:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTY1MzE3MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTY1MzQ0MQ==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1225#discussion_r529653441", "bodyText": "Could you please take developed  version  and exclude this file from the pr? unless checkstyle crash :)", "author": "Thor-tech-of-metal", "createdAt": "2020-11-24T15:41:04Z", "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/createevent/ClassifiedCreateEventOperation.java", "diffHunk": "@@ -26,8 +26,7 @@ public ClassifiedCreateEventOperation(@Qualifier(\"default\") CreateEventOperation\n     @Override\n     public CaseDetails createCaseEvent(String caseReference,\n                                        CaseDataContent content) {\n-        final CaseDetails caseDetails = createEventOperation.createCaseEvent(caseReference,\n-                                                                           content);", "originalCommit": "b1bed79d29e3909c26a9b3d66da046f2514c1511", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDI1OTQ2NQ==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1225#discussion_r530259465", "bodyText": "reverted to develop version", "author": "kiran-yenigala-hmcts", "createdAt": "2020-11-25T10:18:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTY1MzQ0MQ=="}], "type": "inlineReview"}, {"oid": "a861c8c80ad1c25712451fcca1e0c36311f6f586", "url": "https://github.com/hmcts/ccd-data-store-api/commit/a861c8c80ad1c25712451fcca1e0c36311f6f586", "message": "RDM-10165: Functional test cases updated", "committedDate": "2020-11-24T20:09:29Z", "type": "commit"}, {"oid": "b1f279dfabe53ca4faa8361a584a3be39c90a0de", "url": "https://github.com/hmcts/ccd-data-store-api/commit/b1f279dfabe53ca4faa8361a584a3be39c90a0de", "message": "RDM-10165: removed @currentrun tag", "committedDate": "2020-11-24T20:17:36Z", "type": "commit"}, {"oid": "50788484d4d2254a5715baca98934cb3ed9ee877", "url": "https://github.com/hmcts/ccd-data-store-api/commit/50788484d4d2254a5715baca98934cb3ed9ee877", "message": "RDM-10165: User names expected values changed", "committedDate": "2020-11-24T21:51:19Z", "type": "commit"}, {"oid": "896e0acee723e9bfb7817aa1c3f37f9857ca26c5", "url": "https://github.com/hmcts/ccd-data-store-api/commit/896e0acee723e9bfb7817aa1c3f37f9857ca26c5", "message": "RDM-10165: removed cpd exclusions", "committedDate": "2020-11-25T10:08:07Z", "type": "commit"}, {"oid": "0a2e3dba5004a8d9a85b72c51f84576a4e89d7c8", "url": "https://github.com/hmcts/ccd-data-store-api/commit/0a2e3dba5004a8d9a85b72c51f84576a4e89d7c8", "message": "RDM-10165: Reverted to develop branch and use lombok", "committedDate": "2020-11-25T12:03:57Z", "type": "commit"}, {"oid": "1ba29ce9badfea85499d5e980a809a5440843385", "url": "https://github.com/hmcts/ccd-data-store-api/commit/1ba29ce9badfea85499d5e980a809a5440843385", "message": "RDM-10165: Removed unused imports", "committedDate": "2020-11-25T12:10:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDkwMzY5Mw==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1225#discussion_r530903693", "bodyText": "Why whole userToken?? we only need invoker's user details right?\nit\u2019s a bit odd to pass user auth token around systems rather than required userInfo elements.", "author": "smathangi", "createdAt": "2020-11-26T09:53:00Z", "path": "src/main/java/uk/gov/hmcts/ccd/domain/model/std/CaseDataContent.java", "diffHunk": "@@ -34,6 +34,9 @@\n     @JsonProperty(\"case_reference\")\n     private String caseReference;\n \n+    @JsonProperty(\"on_behalf_of_token\")\n+    private String onBehalfOfUserToken;", "originalCommit": "1ba29ce9badfea85499d5e980a809a5440843385", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDkyOTkyOA==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1225#discussion_r530929928", "bodyText": "hi @smathangi initial request from architects was to pass the whole token. I also thought userId would be enough so we started with userId.\nThe complication we found was that the IdamClient getUserDetails API wants the whole token in input to retrieve the user info, not the userId.\nTherefore we moved back to the initial suggestion of passing the whole token.\nI now also think that the benefit of passing the whole token is that the client can prove that he's authorised to use on_behalf_of because he has a valid token for that user\nI'm not adamant on this though, I guess there are pros and cons for both approaches. What do you think?", "author": "mario-paniccia", "createdAt": "2020-11-26T10:33:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDkwMzY5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDk1Mzk2OA==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1225#discussion_r530953968", "bodyText": "CCD api is not using that token for authentication / authorisation purpose. So, to me what's the need to expose to CCD ?  Also one extra call to IDAM from ccd in the e2e user flow. Instead the caller (MCA) can actually pass all required bits (userid, first_name, lastName) in the payload.\nI just thought of flagging this - either way is fine with me. (as architects already discussed )", "author": "smathangi", "createdAt": "2020-11-26T11:12:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDkwMzY5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDk5ODc2NQ==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1225#discussion_r530998765", "bodyText": "Just had a chat with Mario. For now we can keep the implementation as it is.\nIt can be improved a bit later once architects give it a thought on new proposals ( 1. Caller (mca) pass valid data for all required fields . Or 2. Caller pass userId and CCD uses it's own system-user-token to retrieve userInfo for a given userId).", "author": "smathangi", "createdAt": "2020-11-26T12:34:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDkwMzY5Mw=="}], "type": "inlineReview"}, {"oid": "632c02fa117fc3cf43eb9f347b10a476fb70bf11", "url": "https://github.com/hmcts/ccd-data-store-api/commit/632c02fa117fc3cf43eb9f347b10a476fb70bf11", "message": "Merge branch 'develop' into RDM-10165", "committedDate": "2020-11-28T13:55:13Z", "type": "commit"}, {"oid": "d98af518d702e6be1cd5997db2aa0136da22710f", "url": "https://github.com/hmcts/ccd-data-store-api/commit/d98af518d702e6be1cd5997db2aa0136da22710f", "message": "RDM-10165: Proxied by values added to /events/{eventId} endpoint response", "committedDate": "2020-12-01T10:01:35Z", "type": "commit"}, {"oid": "ee240a0d6d8a03dfea930ce5ee48b42cccae02b5", "url": "https://github.com/hmcts/ccd-data-store-api/commit/ee240a0d6d8a03dfea930ce5ee48b42cccae02b5", "message": "Merge remote-tracking branch 'origin/RDM-10165' into RDM-10165", "committedDate": "2020-12-01T10:01:46Z", "type": "commit"}, {"oid": "c8353fc7ae329147ab1316f9b20575c7c503dee0", "url": "https://github.com/hmcts/ccd-data-store-api/commit/c8353fc7ae329147ab1316f9b20575c7c503dee0", "message": "Merge branch 'develop' into RDM-10165", "committedDate": "2020-12-01T11:02:14Z", "type": "commit"}, {"oid": "7b0071cfe315d488fef16eafa4542f95278a8ec3", "url": "https://github.com/hmcts/ccd-data-store-api/commit/7b0071cfe315d488fef16eafa4542f95278a8ec3", "message": "RDM-10165: fixed sonar cloud code coverage issues", "committedDate": "2020-12-01T14:28:40Z", "type": "commit"}, {"oid": "21412381b6d771d17d19ff91f9b4c001b5f806b9", "url": "https://github.com/hmcts/ccd-data-store-api/commit/21412381b6d771d17d19ff91f9b4c001b5f806b9", "message": "Merge remote-tracking branch 'origin/RDM-10165' into RDM-10165", "committedDate": "2020-12-01T14:28:49Z", "type": "commit"}, {"oid": "92702b72ffde17c6924c21392877327c15845f5b", "url": "https://github.com/hmcts/ccd-data-store-api/commit/92702b72ffde17c6924c21392877327c15845f5b", "message": "RDM-10165: proxied by values added to befta test cases", "committedDate": "2020-12-01T16:11:28Z", "type": "commit"}]}