{"pr_number": 1525, "pr_title": "Update to Eclipse 2020-09-M2", "pr_createdAt": "2020-08-06T20:01:22Z", "pr_url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1525", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc5NTk4Nw==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1525#discussion_r466795987", "bodyText": "Regarding that the completionHandler will pass the favorite prefs to the collector at each completion request, what's benefit to persist it to the preference store?", "author": "testforstephen", "createdAt": "2020-08-07T03:08:50Z", "path": "org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/core/internal/JavaLanguageServerPlugin.java", "diffHunk": "@@ -173,6 +173,9 @@ public void start(BundleContext bundleContext) throws Exception {\n \t\t\tpreferenceManager = new StandardPreferenceManager();\n \t\t\tprojectsManager = new StandardProjectsManager(preferenceManager);\n \t\t}\n+\t\tIEclipsePreferences fDefaultPreferenceStore = DefaultScope.INSTANCE.getNode(JavaManipulation.getPreferenceNodeId());\n+\t\tString javaCompletionFavoriteMembers = String.join(\":\", preferenceManager.getPreferences().getJavaCompletionFavoriteMembers());\n+\t\tfDefaultPreferenceStore.put(JavaManipulationPlugin.CODEASSIST_FAVORITE_STATIC_MEMBERS, javaCompletionFavoriteMembers);", "originalCommit": "36783e09628b59858617722cdd41c623c590f3e9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTQxNTUyMQ==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1525#discussion_r469415521", "bodyText": "See https://github.com/eclipse/eclipse.jdt.ui/blob/master/org.eclipse.jdt.core.manipulation/common/org/eclipse/jdt/core/manipulation/OrganizeImportsOperation.java#L677", "author": "snjeza", "createdAt": "2020-08-12T17:15:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc5NTk4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTc4NTY2OA==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1525#discussion_r469785668", "bodyText": "I see. Here are new comments:\n\nLooks like you also need update the store when the preferences changed.\nSince the link you pasted is used to fix the bug https://bugs.eclipse.org/bugs/show_bug.cgi?id=283287, not sure whether the previous workaround in JLS OrganizeImportsHandler is still needed.\nhttps://github.com/eclipse/eclipse.jdt.ls/blob/master/org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/core/internal/handlers/OrganizeImportsHandler.java#L101-L106", "author": "testforstephen", "createdAt": "2020-08-13T08:31:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc5NTk4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTc5MjMzMw==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1525#discussion_r469792333", "bodyText": "those changes belong to the preference manager", "author": "fbricon", "createdAt": "2020-08-13T08:41:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc5NTk4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTgzNjgzMA==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1525#discussion_r469836830", "bodyText": "When you update the preferenceStore in the plugin start function, the preferences from the client side is not passed to the JLS yet, that means you will always save the default JAVA_COMPLETION_FAVORITE_MEMBERS_DEFAULT to the preferenceStore. If this is not on purpose, then you should do it in Preferences#setJavaCompletionFavoriteMembers\n\tpublic Preferences setJavaCompletionFavoriteMembers(List<String> javaCompletionFavoriteMembers) {\n\t\tthis.javaCompletionFavoriteMembers = (javaCompletionFavoriteMembers == null || javaCompletionFavoriteMembers.isEmpty()) ? JAVA_COMPLETION_FAVORITE_MEMBERS_DEFAULT : javaCompletionFavoriteMembers;\n        IEclipsePreferences fDefaultPreferenceStore = DefaultScope.INSTANCE.getNode(JavaManipulation.getPreferenceNodeId());\n\t\tfDefaultPreferenceStore.put(JavaManipulationPlugin.CODEASSIST_FAVORITE_STATIC_MEMBERS,String.join(\":\", this.javaCompletionFavoriteMembers));\n\t\treturn this;\n\t}\nAlso i see the upstream code uses \";\" to restore the favorite members, but here you use \":\" to join the array, is that right?\nString[] favourites= pref.split(\";\");", "author": "testforstephen", "createdAt": "2020-08-13T09:55:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc5NTk4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTg0ODU1Mw==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1525#discussion_r469848553", "bodyText": "Besides, JAVA_COMPLETION_FAVORITE_MEMBERS_DEFAULT in Preferences.java looks a little curious to me. It contains a tailing \":\" for each array item. But the default user settings in vscode-java doesn't contain \":\". Maybe it works, just curious.", "author": "testforstephen", "createdAt": "2020-08-13T10:17:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc5NTk4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDM1OTUyNw==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1525#discussion_r470359527", "bodyText": "Since the link you pasted is used to fix the bug https://bugs.eclipse.org/bugs/show_bug.cgi?id=283287, not sure whether the previous workaround in JLS OrganizeImportsHandler is still needed.\n\nWe have to use the JLs workaround because of redhat-developer/vscode-java#1472", "author": "snjeza", "createdAt": "2020-08-14T01:17:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc5NTk4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDM2MDI1MQ==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1525#discussion_r470360251", "bodyText": "When you update the preferenceStore in the plugin start function, the preferences from the client side is not passed to the JLS yet, that means you will always save the default\n\nWe don't use JavaManipulationPlugin.CODEASSIST_FAVORITE_STATIC, but have to set it to the blank string.", "author": "snjeza", "createdAt": "2020-08-14T01:21:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc5NTk4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDM2MDM5NQ==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1525#discussion_r470360395", "bodyText": "Besides, JAVA_COMPLETION_FAVORITE_MEMBERS_DEFAULT in Preferences.java looks a little curious to me. It contains a tailing \":\" for each array item. But the default user settings in vscode-java doesn't contain \":\".\n\nFixed.", "author": "snjeza", "createdAt": "2020-08-14T01:21:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc5NTk4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDM2MTQ2Nw==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1525#discussion_r470361467", "bodyText": "Regarding that the completionHandler will pass the favorite prefs to the collector at each completion request, what's benefit to persist it to the preference store?\n\nIf the JavaManipulationPlugin.CODEASSIST_FAVORITE_STATIC preference is null, some tests throw NPE at OrganizeImportsOperation.java, line 678.", "author": "snjeza", "createdAt": "2020-08-14T01:26:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc5NTk4Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc5NzU4OQ==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1525#discussion_r466797589", "bodyText": "=> assertTrue(list.getItems().stream().anyMatch(i -> \"java.util.List\".equals(i.getDetail())));", "author": "testforstephen", "createdAt": "2020-08-07T03:15:45Z", "path": "org.eclipse.jdt.ls.tests/src/org/eclipse/jdt/ls/core/internal/handlers/CompletionHandlerTest.java", "diffHunk": "@@ -2849,7 +2849,8 @@ public void testCompletion_FilterTypes() throws JavaModelException {\n \n \t\tCompletionList list = server.completion(JsonMessageHelper.getParams(createCompletionRequest(unit, loc[0], loc[1]))).join().getRight();\n \t\tassertNotNull(list);\n-\t\tassertEquals(3, list.getItems().size());\n+\t\tList<CompletionItem> items = list.getItems().stream().filter(i -> \"java.util.List\".equals(i.getDetail())).collect(Collectors.toList());\n+\t\tassertFalse(items.isEmpty());", "originalCommit": "36783e09628b59858617722cdd41c623c590f3e9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTQyMjc2MQ==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1525#discussion_r469422761", "bodyText": "Fixed.", "author": "snjeza", "createdAt": "2020-08-12T17:27:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc5NzU4OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc5NzY0OQ==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1525#discussion_r466797649", "bodyText": "See above comment.", "author": "testforstephen", "createdAt": "2020-08-07T03:16:03Z", "path": "org.eclipse.jdt.ls.tests/src/org/eclipse/jdt/ls/core/internal/handlers/CompletionHandlerTest.java", "diffHunk": "@@ -2864,7 +2865,8 @@ public void testCompletion_FilterTypes() throws JavaModelException {\n \t\t\tPreferenceManager.getPrefs(null).setFilteredTypes(filteredTypes);\n \t\t\tlist = server.completion(JsonMessageHelper.getParams(createCompletionRequest(unit, loc[0], loc[1]))).join().getRight();\n \t\t\tassertNotNull(list);\n-\t\t\tassertEquals(0, list.getItems().size());\n+\t\t\titems = list.getItems().stream().filter(i -> \"java.util.List\".equals(i.getDetail())).collect(Collectors.toList());\n+\t\t\tassertTrue(items.isEmpty());", "originalCommit": "36783e09628b59858617722cdd41c623c590f3e9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTQyMjg4Nw==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1525#discussion_r469422887", "bodyText": "Fixed.", "author": "snjeza", "createdAt": "2020-08-12T17:27:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc5NzY0OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc5ODQ4MQ==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1525#discussion_r466798481", "bodyText": "Is there any new factor that contributes more completion items?", "author": "testforstephen", "createdAt": "2020-08-07T03:19:46Z", "path": "org.eclipse.jdt.ls.tests/src/org/eclipse/jdt/ls/core/internal/handlers/CompletionHandlerTest.java", "diffHunk": "@@ -1459,7 +1459,7 @@ public void testSnippet_record() throws Exception {\n \t\tassertFalse(items.isEmpty());\n \t\titems.sort((i1, i2) -> (i1.getSortText().compareTo(i2.getSortText())));\n \n-\t\tCompletionItem item = items.get(10);\n+\t\tCompletionItem item = items.get(11);", "originalCommit": "36783e09628b59858617722cdd41c623c590f3e9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTQyMDEyMw==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1525#discussion_r469420123", "bodyText": "See https://www.eclipse.org/eclipse/news/4.17/jdt.php#content-assist-substring-types", "author": "snjeza", "createdAt": "2020-08-12T17:22:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc5ODQ4MQ=="}], "type": "inlineReview"}, {"oid": "3df8db7f6be0e1fbcfbd8b376e0845f13ca00822", "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/3df8db7f6be0e1fbcfbd8b376e0845f13ca00822", "message": "Update to Eclipse 2020-09-M2\n\nSigned-off-by: Snjezana Peco <snjezana.peco@redhat.com>", "committedDate": "2020-08-12T17:26:15Z", "type": "forcePushed"}, {"oid": "d69cabf95cc4495c35c1397a2d73e19a0f54b530", "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/d69cabf95cc4495c35c1397a2d73e19a0f54b530", "message": "Update to Eclipse 2020-09-M2\n\nSigned-off-by: Snjezana Peco <snjezana.peco@redhat.com>", "committedDate": "2020-08-14T01:15:27Z", "type": "forcePushed"}, {"oid": "944d1c53dae254033b07fd8e812b8a1f2c8f61fa", "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/944d1c53dae254033b07fd8e812b8a1f2c8f61fa", "message": "Update to Eclipse 2020-09-M2\n\nSigned-off-by: Snjezana Peco <snjezana.peco@redhat.com>", "committedDate": "2020-08-14T16:59:04Z", "type": "forcePushed"}, {"oid": "c0b54dc253542ab24ff2645652fe54238ef7ff2f", "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/c0b54dc253542ab24ff2645652fe54238ef7ff2f", "message": "Update to Eclipse 2020-09-M2\n\nSigned-off-by: Snjezana Peco <snjezana.peco@redhat.com>", "committedDate": "2020-08-15T02:12:36Z", "type": "forcePushed"}, {"oid": "2b19d9c2dcce50fd66019b32de3ba85600d575ce", "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/2b19d9c2dcce50fd66019b32de3ba85600d575ce", "message": "Update to Eclipse 2020-09-M2\n\nSigned-off-by: Snjezana Peco <snjezana.peco@redhat.com>", "committedDate": "2020-08-17T16:26:55Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU5ODA0NA==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1525#discussion_r471598044", "bodyText": "no, keep 50. Clients which don't support additional computation on completion/resolve will see a bad performance degradation", "author": "fbricon", "createdAt": "2020-08-17T16:31:25Z", "path": "org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/core/internal/preferences/Preferences.java", "diffHunk": "@@ -236,7 +236,7 @@\n \t * Defaults to 50.\n \t */\n \tpublic static final String JAVA_COMPLETION_MAX_RESULTS_KEY = \"java.completion.maxResults\";\n-\tpublic static final int JAVA_COMPLETION_MAX_RESULTS_DEFAULT = 50;\n+\tpublic static final int JAVA_COMPLETION_MAX_RESULTS_DEFAULT = Integer.MAX_VALUE;", "originalCommit": "2b19d9c2dcce50fd66019b32de3ba85600d575ce", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTYzMjE5Mw==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1525#discussion_r471632193", "bodyText": "Fixed.", "author": "snjeza", "createdAt": "2020-08-17T17:16:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU5ODA0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU5ODM4Mw==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1525#discussion_r471598383", "bodyText": "you can use a foreach loop here", "author": "fbricon", "createdAt": "2020-08-17T16:32:05Z", "path": "org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/core/internal/syntaxserver/ModelBasedSearchableEnvironment.java", "diffHunk": "@@ -77,9 +77,11 @@ public void findTypes(String prefix, ISearchRequestor storage, int type) {\n \t\t\tIPackageFragment[] fragments = elementRequestor.getPackageFragments();\n \t\t\tif (fragments != null) {\n \t\t\t\tString className = prefix.substring(index + 1);\n-\t\t\t\tfor (int i = 0, length = fragments.length; i < length; i++)\n-\t\t\t\t\tif (fragments[i] != null)\n+\t\t\t\tfor (int i = 0, length = fragments.length; i < length; i++) {", "originalCommit": "2b19d9c2dcce50fd66019b32de3ba85600d575ce", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTYzMjQ0Nw==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1525#discussion_r471632447", "bodyText": "Fixed.", "author": "snjeza", "createdAt": "2020-08-17T17:16:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU5ODM4Mw=="}], "type": "inlineReview"}, {"oid": "0ab92df641d66bfdd328f6a124cbf996bc898866", "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/0ab92df641d66bfdd328f6a124cbf996bc898866", "message": "Update to Eclipse 2020-09-M2\n\nSigned-off-by: Snjezana Peco <snjezana.peco@redhat.com>", "committedDate": "2020-08-17T17:14:27Z", "type": "forcePushed"}, {"oid": "1b91cdd1565492fac1433ff8a6cae06b15c09c1c", "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/1b91cdd1565492fac1433ff8a6cae06b15c09c1c", "message": "Update to Eclipse 2020-09-M2\n\nSigned-off-by: Snjezana Peco <snjezana.peco@redhat.com>", "committedDate": "2020-08-17T17:58:42Z", "type": "forcePushed"}, {"oid": "50dadbb96961bfbfa368b0b364a2fb0b7a99ef1b", "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/50dadbb96961bfbfa368b0b364a2fb0b7a99ef1b", "message": "Update to Eclipse 2020-09-M2\n\nSigned-off-by: Snjezana Peco <snjezana.peco@redhat.com>", "committedDate": "2020-08-18T17:55:34Z", "type": "forcePushed"}, {"oid": "26e88fa18cff42f81eb6fa8f670a5fbaebcd0894", "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/26e88fa18cff42f81eb6fa8f670a5fbaebcd0894", "message": "Update to Eclipse 2020-09-M2\n\nSigned-off-by: Snjezana Peco <snjezana.peco@redhat.com>", "committedDate": "2020-08-18T18:37:17Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjg5ODc1NQ==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1525#discussion_r472898755", "bodyText": "With the new PR, i also observed the completion performance on type degraded.\nEnvironment:\n\nHardware\n\nMacBook Pro (13-inch, 2016, Four Thunderbolt 3 Ports)\nProcesor: 2.9 GHz Dual-Core Intel Core i5\nMemory: 8 GB 2133 MHz LPDDR3\n\n\nProject: https://github.com/spring-projects/spring-petclinic\nVS Code 1.48, only with Language Support for Java enabled.\n\nOld:\n\nNew:\nIt takes more than 3s to get the completion of String. If you only type S, it's slower.\n\nThis issue should be related with the new Substring/Subword matches for types https://www.eclipse.org/eclipse/news/4.17/jdt.php#content-assist-substring-types.\nIt seems it only provides switch to control subwords match, we need evaluate more on the new change.", "author": "testforstephen", "createdAt": "2020-08-19T09:37:55Z", "path": "org.eclipse.jdt.ls.tests/src/org/eclipse/jdt/ls/core/internal/handlers/CompletionHandlerTest.java", "diffHunk": "@@ -2622,8 +2625,11 @@ public void testLimitCompletionResults() throws Exception {\n \t@Test\n \tpublic void testStaticImports2() throws Exception {\n \t\tPreferenceManager.getPrefs(null).setJavaCompletionFavoriteMembers(Collections.emptyList());\n-\t\tICompilationUnit unit = getWorkingCopy(\"src/test1/B.java\",\n-\t\t//@formatter:off\n+\t\tlong timeout = Long.getLong(\"completion.timeout\", 5000);\n+\t\ttry {\n+\t\t\tSystem.setProperty(\"completion.timeout\", String.valueOf(60000));", "originalCommit": "26e88fa18cff42f81eb6fa8f670a5fbaebcd0894", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjkwMDM0NA==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1525#discussion_r472900344", "bodyText": "@testforstephen can you try disabling subwords match in the JDT preferences, see if it restores the performance?", "author": "fbricon", "createdAt": "2020-08-19T09:40:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjg5ODc1NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjk4NTg0NA==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1525#discussion_r472985844", "bodyText": "Sure. I tried to turn off both substring and subwords, the performance go back to normal. And the major perf factor is the substring match.\n\nTurn off substring match with vmArgs -Djdt.codeCompleteSubstringMatch=false or System.setProperty(AssistOptions.PROPERTY_SubstringMatch, \"false\")\nTurn off subwords match with JavaCore.setOptions().\n\n// JavaLanguageServerPlugin.java\n\npublic void start(BundleContext bundleContext) throws Exception {\n    ...\n    Hashtable<String, String> options = new Hashtable<>();\n    options.put(AssistOptions.OPTION_SubwordMatch, AssistOptions.DISABLED);\n    JavaCore.setOptions(options);\n}", "author": "testforstephen", "createdAt": "2020-08-19T12:20:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjg5ODc1NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjk4NjY3NA==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1525#discussion_r472986674", "bodyText": "i suggest we keep the max completion timeout to 5s in the test case. This will guard the possible performance issue.", "author": "testforstephen", "createdAt": "2020-08-19T12:21:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjg5ODc1NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzAwNzgwOA==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1525#discussion_r473007808", "bodyText": "options.put(AssistOptions.OPTION_SubwordMatch, AssistOptions.DISABLED) \n\nshould be added in the preferencemanager", "author": "fbricon", "createdAt": "2020-08-19T12:57:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjg5ODc1NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzE0Njc5Mg==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1525#discussion_r473146792", "bodyText": "i suggest we keep the max completion timeout to 5s in the test case. This will guard the possible performance issue.\n\nSome tests fail randomly without this option. See #1411 (review)\nThe option is used only in tests", "author": "snjeza", "createdAt": "2020-08-19T16:12:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjg5ODc1NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzE3NjY1MA==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1525#discussion_r473176650", "bodyText": "options.put(AssistOptions.OPTION_SubwordMatch, AssistOptions.DISABLED)\nshould be added in the preferencemanager\n\nDone", "author": "snjeza", "createdAt": "2020-08-19T16:49:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjg5ODc1NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzQ5OTk3NQ==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1525#discussion_r473499975", "bodyText": "Please turn off substring match too. It's the main factor to slow down the completion performance. Find the switch in my comment above.", "author": "testforstephen", "createdAt": "2020-08-20T01:11:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjg5ODc1NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzUwNDc0OQ==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1525#discussion_r473504749", "bodyText": "It is done. See 59f3ea0#diff-ce44e5aecff47a5dd96a42b0a961f48cR86", "author": "snjeza", "createdAt": "2020-08-20T01:19:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjg5ODc1NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzUwOTE4OA==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1525#discussion_r473509188", "bodyText": "No, that line only turns off subword match. The switch for substring match is System.setProperty(AssistOptions.PROPERTY_SubstringMatch, \"false\")", "author": "testforstephen", "createdAt": "2020-08-20T01:26:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjg5ODc1NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzUzMjg5Mg==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1525#discussion_r473532892", "bodyText": "Done. See f520966#diff-55f26b9037b6c92ad4701f61028ae2cdR190", "author": "snjeza", "createdAt": "2020-08-20T02:02:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjg5ODc1NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTk4MzkyMg==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1525#discussion_r551983922", "bodyText": "Just a heads-up regarding this feature. It might be worth revisiting once we adopt 2021-03 M1.\nhttps://www.eclipse.org/lists/platform-dev/msg02635.html", "author": "rgrunber", "createdAt": "2021-01-05T14:57:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjg5ODc1NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjMzNTg1Nw==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1525#discussion_r552335857", "bodyText": "The parallel index search looks promising.", "author": "testforstephen", "createdAt": "2021-01-06T02:53:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjg5ODc1NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1Njg4OTE3MQ==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1525#discussion_r556889171", "bodyText": "I tried to test this and while I think there might be a bit of an improvement using JDT Core 2021-03 M1, it still was much slower than with subword feature completely disabled so will have to look on the upstream bug.", "author": "rgrunber", "createdAt": "2021-01-13T22:08:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjg5ODc1NQ=="}], "type": "inlineReview"}, {"oid": "8fbfaa2958363b76f05fd46c8fb3487260e06cb7", "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/8fbfaa2958363b76f05fd46c8fb3487260e06cb7", "message": "Update to Eclipse 2020-09-M2\n\nSigned-off-by: Snjezana Peco <snjezana.peco@redhat.com>", "committedDate": "2020-08-19T15:57:07Z", "type": "forcePushed"}, {"oid": "59f3ea04aa516ad37d613ca6707c04421479f634", "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/59f3ea04aa516ad37d613ca6707c04421479f634", "message": "Update to Eclipse 2020-09-M2\n\nSigned-off-by: Snjezana Peco <snjezana.peco@redhat.com>", "committedDate": "2020-08-19T16:47:52Z", "type": "forcePushed"}, {"oid": "f52096613015aae6840cc047e01cf51b93edaf45", "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/f52096613015aae6840cc047e01cf51b93edaf45", "message": "Update to Eclipse 2020-09-M2\n\nSigned-off-by: Snjezana Peco <snjezana.peco@redhat.com>", "committedDate": "2020-08-20T02:00:09Z", "type": "forcePushed"}, {"oid": "3428e743c564786aa791d329724fd732baedaf71", "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/3428e743c564786aa791d329724fd732baedaf71", "message": "Update to Eclipse 2020-09-M2\n\nSigned-off-by: Snjezana Peco <snjezana.peco@redhat.com>", "committedDate": "2020-08-20T02:55:34Z", "type": "commit"}, {"oid": "3428e743c564786aa791d329724fd732baedaf71", "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/3428e743c564786aa791d329724fd732baedaf71", "message": "Update to Eclipse 2020-09-M2\n\nSigned-off-by: Snjezana Peco <snjezana.peco@redhat.com>", "committedDate": "2020-08-20T02:55:34Z", "type": "forcePushed"}]}