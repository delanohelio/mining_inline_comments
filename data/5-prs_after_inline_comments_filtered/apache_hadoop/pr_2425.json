{"pr_number": 2425, "pr_title": "HADOOP-17332. S3A MarkerTool -min and -max are inverted.", "pr_createdAt": "2020-10-30T15:06:52Z", "pr_url": "https://github.com/apache/hadoop/pull/2425", "timeline": [{"oid": "003df8e130b541b4b6ce9ee7450b2b09d8a5b383", "url": "https://github.com/apache/hadoop/commit/003df8e130b541b4b6ce9ee7450b2b09d8a5b383", "message": "HADOOP-17332 s3a MarkerTool -min and -max are inverted.\n\nThis patch\n* fixes the inversion\n* adds a precondition check\n* if the commands are supplied inverted, swaps them with a warning.\n  This is to stop breaking any tests written to cope with the existing\n  behavior.\n* adds tests for all this\n\nChange-Id: Ibff4201abb0c26332c96c9c701901e0611b43ab8", "committedDate": "2020-10-30T15:04:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjU2ODE1MA==", "url": "https://github.com/apache/hadoop/pull/2425#discussion_r522568150", "bodyText": "nit: typo in \"greater\".", "author": "mehakmeet", "createdAt": "2020-11-13T02:15:33Z", "path": "hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/tools/MarkerTool.java", "diffHunk": "@@ -513,6 +526,11 @@ private ScanResult scan(\n       final DirectoryPolicy filterPolicy)\n       throws IOException, ExitUtil.ExitException {\n \n+    // safety check: min and max are correctly ordered at this point.\n+    Preconditions.checkArgument(minMarkerCount <= maxMarkerCount,\n+        \"Min marker count of %d is greather than the max value of %d\",", "originalCommit": "003df8e130b541b4b6ce9ee7450b2b09d8a5b383", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDE1NDAxNA==", "url": "https://github.com/apache/hadoop/pull/2425#discussion_r524154014", "bodyText": "well spotted", "author": "steveloughran", "createdAt": "2020-11-16T11:27:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjU2ODE1MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjY0MTY3OA==", "url": "https://github.com/apache/hadoop/pull/2425#discussion_r522641678", "bodyText": "nit: Is this check required again since we have already swapped above?", "author": "mukund-thakur", "createdAt": "2020-11-13T04:57:55Z", "path": "hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/tools/MarkerTool.java", "diffHunk": "@@ -513,6 +526,11 @@ private ScanResult scan(\n       final DirectoryPolicy filterPolicy)\n       throws IOException, ExitUtil.ExitException {\n \n+    // safety check: min and max are correctly ordered at this point.\n+    Preconditions.checkArgument(minMarkerCount <= maxMarkerCount,", "originalCommit": "003df8e130b541b4b6ce9ee7450b2b09d8a5b383", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTA5Mzg3Mg==", "url": "https://github.com/apache/hadoop/pull/2425#discussion_r525093872", "bodyText": "no, but I'm just being extra paranoid", "author": "steveloughran", "createdAt": "2020-11-17T11:47:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjY0MTY3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODg4NzcyMQ==", "url": "https://github.com/apache/hadoop/pull/2425#discussion_r528887721", "bodyText": "it will harm nobody, we can leave this check here.", "author": "bgaborg", "createdAt": "2020-11-23T17:47:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjY0MTY3OA=="}], "type": "inlineReview"}, {"oid": "c32dae755bfd1953ef241b69421d158cc267b0d5", "url": "https://github.com/apache/hadoop/commit/c32dae755bfd1953ef241b69421d158cc267b0d5", "message": "HADOOP-17332. Fix typo in precondition\n\nChange-Id: I75916829a95605869fa7088d28ed63e95854f11b", "committedDate": "2020-11-17T15:08:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODg4ODA1MQ==", "url": "https://github.com/apache/hadoop/pull/2425#discussion_r528888051", "bodyText": "I wanted to ask for a test like this, but it's already here so LGTM.", "author": "bgaborg", "createdAt": "2020-11-23T17:48:02Z", "path": "hadoop-tools/hadoop-aws/src/test/java/org/apache/hadoop/fs/s3a/tools/ITestMarkerTool.java", "diffHunk": "@@ -259,8 +259,25 @@ public void testRunAuditWithExpectedMarkers() throws Throwable {\n         AUDIT,\n         m(OPT_LIMIT), 0,\n         m(OPT_OUT), audit,\n-        m(OPT_MIN), expectedMarkersWithBaseDir,\n-        m(OPT_MAX), expectedMarkersWithBaseDir,\n+        m(OPT_MIN), expectedMarkersWithBaseDir - 1,\n+        m(OPT_MAX), expectedMarkersWithBaseDir + 1,\n+        createdPaths.base);\n+    expectMarkersInOutput(audit, expectedMarkersWithBaseDir);\n+  }\n+\n+  @Test\n+  public void testRunAuditWithExpectedMarkersSwappedMinMax() throws Throwable {", "originalCommit": "c32dae755bfd1953ef241b69421d158cc267b0d5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODk4NzA1NA==", "url": "https://github.com/apache/hadoop/pull/2425#discussion_r528987054", "bodyText": "wanted to make sure that anyone in QE wouldn't be upset with the fix :)", "author": "steveloughran", "createdAt": "2020-11-23T20:49:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODg4ODA1MQ=="}], "type": "inlineReview"}]}