{"pr_number": 2360, "pr_title": "HDFS-15613. RBF: Router FSCK fails after HDFS-14442.", "pr_createdAt": "2020-10-05T10:22:15Z", "pr_url": "https://github.com/apache/hadoop/pull/2360", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTcyNzQ5NQ==", "url": "https://github.com/apache/hadoop/pull/2360#discussion_r499727495", "bodyText": "Instead of using exceptions, can we extract the code from checkSafeMode() so we can just check the state?", "author": "goiri", "createdAt": "2020-10-05T16:33:12Z", "path": "hadoop-hdfs-project/hadoop-hdfs-rbf/src/main/java/org/apache/hadoop/hdfs/server/federation/router/RouterClientProtocol.java", "diffHunk": "@@ -1799,10 +1800,14 @@ public void satisfyStoragePolicy(String path) throws IOException {\n   }\n \n   @Override\n-  public HAServiceProtocol.HAServiceState getHAServiceState()\n-      throws IOException {\n-    rpcServer.checkOperation(NameNode.OperationCategory.READ, false);\n-    return null;\n+  public HAServiceProtocol.HAServiceState getHAServiceState() {\n+    try {\n+      // check safemode or not\n+      rpcServer.checkOperation(NameNode.OperationCategory.WRITE);", "originalCommit": "6db762daf7c771bf0b4c20eb753921bfadaabcd5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTk2NjQzOA==", "url": "https://github.com/apache/hadoop/pull/2360#discussion_r499966438", "bodyText": "Thank you for your comment. Updated the patch to just check the state instead of using StandbyException.", "author": "aajisaka", "createdAt": "2020-10-06T02:06:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTcyNzQ5NQ=="}], "type": "inlineReview"}, {"oid": "1d6112e2314b77cf05d25f4029b9397ad47350d6", "url": "https://github.com/apache/hadoop/commit/1d6112e2314b77cf05d25f4029b9397ad47350d6", "message": "HDFS-15613. RBF: Router FSCK fails after HDFS-14442.\n\nSupport getHAServiceState in DFSRouter", "committedDate": "2020-10-06T02:02:22Z", "type": "commit"}, {"oid": "023d35e6a0422ccc6ec33f6b5f70c9f2c625c722", "url": "https://github.com/apache/hadoop/commit/023d35e6a0422ccc6ec33f6b5f70c9f2c625c722", "message": "Avoid using expceptions", "committedDate": "2020-10-06T02:02:26Z", "type": "commit"}, {"oid": "023d35e6a0422ccc6ec33f6b5f70c9f2c625c722", "url": "https://github.com/apache/hadoop/commit/023d35e6a0422ccc6ec33f6b5f70c9f2c625c722", "message": "Avoid using expceptions", "committedDate": "2020-10-06T02:02:26Z", "type": "forcePushed"}, {"oid": "b6d6ffe0798e343fad85b75039805f41f2731e6c", "url": "https://github.com/apache/hadoop/commit/b6d6ffe0798e343fad85b75039805f41f2731e6c", "message": "Remove unused import", "committedDate": "2020-10-06T06:05:35Z", "type": "commit"}]}