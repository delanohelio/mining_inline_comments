{"pr_number": 1880, "pr_title": "HADOOP-16661. Support TLS 1.3", "pr_createdAt": "2020-03-06T01:35:38Z", "pr_url": "https://github.com/apache/hadoop/pull/1880", "timeline": [{"oid": "d9e2dd74b75beba80e6d9f845285fc82cfbb7d68", "url": "https://github.com/apache/hadoop/commit/d9e2dd74b75beba80e6d9f845285fc82cfbb7d68", "message": "tls1.3\n\nChange-Id: I0b4d8ac730fa52267ee0413ec98d6711fa3ca7f0", "committedDate": "2020-03-05T03:13:13Z", "type": "commit"}, {"oid": "2670160d36809ddea601d51a0017052f6d866994", "url": "https://github.com/apache/hadoop/commit/2670160d36809ddea601d51a0017052f6d866994", "message": "Added test to verify TLSv1.3 support. Updated core-default.xml to add description for TLSv1.3\n\nChange-Id: Id8fdfd132ded25d3f9a05710f83f5f2c38b3ad8c", "committedDate": "2020-03-06T01:32:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODc1NzQyOQ==", "url": "https://github.com/apache/hadoop/pull/1880#discussion_r388757429", "bodyText": "We can use the utility method and don't have to parse the java.version string. This change can avoid test failure in Java 9 and 10 (corner case).\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                String version = System.getProperty(\"java.version\");\n          \n          \n            \n                if (version.startsWith(\"1.\")) { // JDK 8\n          \n          \n            \n                  includedProtocols = INCLUDED_PROTOCOLS;\n          \n          \n            \n                } else { // JDK 11 and above\n          \n          \n            \n                  includedProtocols = INCLUDED_PROTOCOLS_JDK11;\n          \n          \n            \n                }\n          \n          \n            \n                if (Shell.isJavaVersionAtLeast(11) {\n          \n          \n            \n                  includedProtocols = INCLUDED_PROTOCOLS_JDK11;\n          \n          \n            \n                } else {\n          \n          \n            \n                  includedProtocols = INCLUDED_PROTOCOLS;\n          \n          \n            \n                }", "author": "aajisaka", "createdAt": "2020-03-06T07:56:51Z", "path": "hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/http/TestSSLHttpServer.java", "diffHunk": "@@ -291,13 +294,30 @@ public void testExcludedCiphers() throws Exception {\n   @Test\n   public void testIncludedProtocols() throws Exception {\n     URL url = new URL(baseUrl, SERVLET_PATH_ECHO + \"?a=b&c=d\");\n+\n+    String includedProtocols;\n+    String version = System.getProperty(\"java.version\");\n+    if (version.startsWith(\"1.\")) { // JDK 8\n+      includedProtocols = INCLUDED_PROTOCOLS;\n+    } else { // JDK 11 and above\n+      includedProtocols = INCLUDED_PROTOCOLS_JDK11;\n+    }", "originalCommit": "2670160d36809ddea601d51a0017052f6d866994", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODc1ODA0MQ==", "url": "https://github.com/apache/hadoop/pull/1880#discussion_r388758041", "bodyText": "This lines can be fixed as well.", "author": "aajisaka", "createdAt": "2020-03-06T07:58:31Z", "path": "hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/http/TestSSLHttpServer.java", "diffHunk": "@@ -291,13 +294,30 @@ public void testExcludedCiphers() throws Exception {\n   @Test\n   public void testIncludedProtocols() throws Exception {\n     URL url = new URL(baseUrl, SERVLET_PATH_ECHO + \"?a=b&c=d\");\n+\n+    String includedProtocols;\n+    String version = System.getProperty(\"java.version\");\n+    if (version.startsWith(\"1.\")) { // JDK 8\n+      includedProtocols = INCLUDED_PROTOCOLS;\n+    } else { // JDK 11 and above\n+      includedProtocols = INCLUDED_PROTOCOLS_JDK11;\n+    }\n     HttpsURLConnection conn =\n         getConnectionWithPreferredProtocolSSLSocketFactory(url,\n-        INCLUDED_PROTOCOLS);\n+            includedProtocols);\n     assertFalse(\"included protocol list is empty\",\n-        INCLUDED_PROTOCOLS.isEmpty());\n+        includedProtocols.isEmpty());\n \n     readFromConnection(conn);\n+\n+    PreferredProtocolSSLSocketFactory factory =\n+        (PreferredProtocolSSLSocketFactory)conn.getSSLSocketFactory();\n+\n+    if (version.startsWith(\"1.\")) {\n+      assertEquals(\"TLSv1.2\", factory.getSocket().getSession().getProtocol());\n+    } else {\n+      assertEquals(\"TLSv1.3\", factory.getSocket().getSession().getProtocol());\n+    }", "originalCommit": "2670160d36809ddea601d51a0017052f6d866994", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "dda227280d3325016aba932bf194730f2cf87b70", "url": "https://github.com/apache/hadoop/commit/dda227280d3325016aba932bf194730f2cf87b70", "message": "Update code per Akira's review comments.\n\nChange-Id: I14ce47919badf93b309c1855a888349f2e58d2ae", "committedDate": "2020-03-07T01:18:46Z", "type": "commit"}]}