{"pr_number": 2332, "pr_title": "HDFS-15594. Lazy calculate live datanodes in safe mode tip", "pr_createdAt": "2020-09-23T20:12:04Z", "pr_url": "https://github.com/apache/hadoop/pull/2332", "timeline": [{"oid": "a634143db184ce5a8a0d21216d27d8c1fc41284f", "url": "https://github.com/apache/hadoop/commit/a634143db184ce5a8a0d21216d27d8c1fc41284f", "message": "Update BlockManagerSafeMode.java", "committedDate": "2020-09-23T20:09:45Z", "type": "commit"}, {"oid": "08f505eb5c0fe38cc9f4efc5951485224082e2de", "url": "https://github.com/apache/hadoop/commit/08f505eb5c0fe38cc9f4efc5951485224082e2de", "message": "Update TestBlockManagerSafeMode.java", "committedDate": "2020-09-23T20:11:09Z", "type": "commit"}, {"oid": "299299aae47049a421970841ff92e2a6ae4a7bd3", "url": "https://github.com/apache/hadoop/commit/299299aae47049a421970841ff92e2a6ae4a7bd3", "message": "Update BlockManagerSafeMode.java", "committedDate": "2020-09-23T21:41:05Z", "type": "commit"}, {"oid": "010ad6f6b023d0e6a312cf94b9021992a43d5c4e", "url": "https://github.com/apache/hadoop/commit/010ad6f6b023d0e6a312cf94b9021992a43d5c4e", "message": "Update TestBlockManagerSafeMode.java", "committedDate": "2020-09-23T21:41:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDQ2MjEwNA==", "url": "https://github.com/apache/hadoop/pull/2332#discussion_r494462104", "bodyText": "As we are at it, does it make sense to use StringBuilder?", "author": "goiri", "createdAt": "2020-09-24T16:42:39Z", "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/blockmanagement/BlockManagerSafeMode.java", "diffHunk": "@@ -309,16 +311,21 @@ String getSafeModeTip() {\n     }\n \n     if (datanodeThreshold > 0) {\n-      int numLive = blockManager.getDatanodeManager().getNumLiveDataNodes();\n-      if (numLive < datanodeThreshold) {\n-        msg += String.format(\n-            \"The number of live datanodes %d needs an additional %d live \"\n-                + \"datanodes to reach the minimum number %d.%n\",\n-            numLive, (datanodeThreshold - numLive), datanodeThreshold);\n+      if (isBlockThresholdMet) {\n+        int numLive = blockManager.getDatanodeManager().getNumLiveDataNodes();\n+        if (numLive < datanodeThreshold) {\n+          msg += String.format(\n+              \"The number of live datanodes %d needs an additional %d live \"\n+                  + \"datanodes to reach the minimum number %d.%n\",\n+              numLive, (datanodeThreshold - numLive), datanodeThreshold);\n+        } else {\n+          msg += String.format(\"The number of live datanodes %d has reached \"\n+                  + \"the minimum number %d. \",\n+              numLive, datanodeThreshold);\n+        }\n       } else {\n-        msg += String.format(\"The number of live datanodes %d has reached \"\n-                + \"the minimum number %d. \",\n-            numLive, datanodeThreshold);\n+        msg += \"The number of live datanodes is not calculated \" +", "originalCommit": "010ad6f6b023d0e6a312cf94b9021992a43d5c4e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDYyNDgyNg==", "url": "https://github.com/apache/hadoop/pull/2332#discussion_r494624826", "bodyText": "fixed.", "author": "NickyYe", "createdAt": "2020-09-24T21:36:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDQ2MjEwNA=="}], "type": "inlineReview"}, {"oid": "68219d8c6678b230cde4b711690205e39d8ea132", "url": "https://github.com/apache/hadoop/commit/68219d8c6678b230cde4b711690205e39d8ea132", "message": "Update BlockManagerSafeMode.java", "committedDate": "2020-09-24T21:35:32Z", "type": "commit"}]}