{"pr_number": 1870, "pr_title": "HDFS-15201 SnapshotCounter hits MaxSnapshotID limit", "pr_createdAt": "2020-03-02T19:25:50Z", "pr_url": "https://github.com/apache/hadoop/pull/1870", "timeline": [{"oid": "15929f6f6c5761088bc00fb18b7b384b75e35da9", "url": "https://github.com/apache/hadoop/commit/15929f6f6c5761088bc00fb18b7b384b75e35da9", "message": "HDFS-15201 SnapshotCounter hits MaxSnapshotID limit", "committedDate": "2020-03-02T19:22:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjYyNjQ2MQ==", "url": "https://github.com/apache/hadoop/pull/1870#discussion_r386626461", "bodyText": "I believe @szetszwo recommended setting this to 28 bits for now (something less than 31).", "author": "arp7", "createdAt": "2020-03-02T20:17:34Z", "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/snapshot/SnapshotManager.java", "diffHunk": "@@ -96,7 +96,7 @@\n   private final boolean snapshotDiffAllowSnapRootDescendant;\n \n   private final AtomicInteger numSnapshots = new AtomicInteger();\n-  private static final int SNAPSHOT_ID_BIT_WIDTH = 24;\n+  private static final int SNAPSHOT_ID_BIT_WIDTH = 31;", "originalCommit": "15929f6f6c5761088bc00fb18b7b384b75e35da9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjY3NzMwOA==", "url": "https://github.com/apache/hadoop/pull/1870#discussion_r386677308", "bodyText": "Sure @arp7  I will set to 28 then.", "author": "karthikhw", "createdAt": "2020-03-02T22:01:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjYyNjQ2MQ=="}], "type": "inlineReview"}, {"oid": "558f9547389f6df26f110afa359d6ec496a50d8e", "url": "https://github.com/apache/hadoop/commit/558f9547389f6df26f110afa359d6ec496a50d8e", "message": "Set SNAPSHOT_ID_BIT_WIDTH to 28", "committedDate": "2020-03-02T22:17:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njc1MDI0Mg==", "url": "https://github.com/apache/hadoop/pull/1870#discussion_r386750242", "bodyText": "can you add a description/comment to explain this assertion.", "author": "jojochuang", "createdAt": "2020-03-03T01:27:15Z", "path": "hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/snapshot/TestSnapshotManager.java", "diffHunk": "@@ -92,4 +92,15 @@ public void testSnapshotLimits() throws Exception {\n           StringUtils.toLowerCase(se.getMessage()).contains(\"rollover\"));\n     }\n   }\n+\n+\n+  @Test\n+  public void testValidateSnapshotIDWidth() {\n+    FSDirectory fsdir = mock(FSDirectory.class);\n+    SnapshotManager snapshotManager = new SnapshotManager(new Configuration(),\n+        fsdir);\n+    Assert.assertTrue(snapshotManager.", "originalCommit": "558f9547389f6df26f110afa359d6ec496a50d8e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzk1Mzg0Mg==", "url": "https://github.com/apache/hadoop/pull/1870#discussion_r387953842", "bodyText": "Added!", "author": "karthikhw", "createdAt": "2020-03-04T21:47:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njc1MDI0Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njc2ODEwNg==", "url": "https://github.com/apache/hadoop/pull/1870#discussion_r386768106", "bodyText": "I think we can still leave this as max index -1, as we would only have one snapshot id here.", "author": "mukul1987", "createdAt": "2020-03-03T02:34:21Z", "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/snapshot/SnapshotManager.java", "diffHunk": "@@ -541,8 +541,8 @@ public void clearSnapshottableDirs() {\n    *\n    * @return maximum allowable snapshot ID.\n    */\n-   public int getMaxSnapshotID() {\n-    return ((1 << SNAPSHOT_ID_BIT_WIDTH) - 1);\n+  public int getMaxSnapshotID() {\n+    return (1 << SNAPSHOT_ID_BIT_WIDTH);", "originalCommit": "558f9547389f6df26f110afa359d6ec496a50d8e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzkwNjIyMQ==", "url": "https://github.com/apache/hadoop/pull/1870#discussion_r387906221", "bodyText": "Thank you @mukul1987. I didn't understand this \"as we would only have one snapshot id here\".\nSNAPSHOT_ID_BIT_WIDTH  has no relation with anyone. Not sure why would we need index -1.", "author": "karthikhw", "createdAt": "2020-03-04T20:07:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njc2ODEwNg=="}], "type": "inlineReview"}, {"oid": "a189ef1bb3488d1f11fdc6f9da4e0c2d2c5ddc97", "url": "https://github.com/apache/hadoop/commit/a189ef1bb3488d1f11fdc6f9da4e0c2d2c5ddc97", "message": "Review fix", "committedDate": "2020-03-04T21:12:45Z", "type": "commit"}, {"oid": "3f6830c10796d2f034991070b077f4b91b8e465a", "url": "https://github.com/apache/hadoop/commit/3f6830c10796d2f034991070b077f4b91b8e465a", "message": "Update TestSnapshotManager.java", "committedDate": "2020-03-04T21:15:18Z", "type": "commit"}, {"oid": "b9f05e22ee9f119cef83fb4c152ee81f81c6fb56", "url": "https://github.com/apache/hadoop/commit/b9f05e22ee9f119cef83fb4c152ee81f81c6fb56", "message": "Changed -1 from -2 for getMaxSnapshotID", "committedDate": "2020-03-13T00:04:49Z", "type": "commit"}]}