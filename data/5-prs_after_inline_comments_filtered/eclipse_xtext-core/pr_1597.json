{"pr_number": 1597, "pr_title": "Semantic quickfix (generic IDE integration)", "pr_createdAt": "2020-10-24T19:40:18Z", "pr_url": "https://github.com/eclipse/xtext-core/pull/1597", "timeline": [{"oid": "30935a66fdf78bfffbc3811fc1e49e7b80486056", "url": "https://github.com/eclipse/xtext-core/commit/30935a66fdf78bfffbc3811fc1e49e7b80486056", "message": "Introduce quickfix API", "committedDate": "2020-10-24T19:54:14Z", "type": "forcePushed"}, {"oid": "d4a330f31ef0528aa1ee9e8e18c5e6f1ef77b076", "url": "https://github.com/eclipse/xtext-core/commit/d4a330f31ef0528aa1ee9e8e18c5e6f1ef77b076", "message": "Introduce quickfix API\n\nSigned-off-by: Heinrich Weichert <heinrich.weichert@avl.com>", "committedDate": "2020-10-24T19:56:32Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTU1MDg3NQ==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r511550875", "bodyText": "Why this", "author": "cdietrich", "createdAt": "2020-10-25T05:45:54Z", "path": "org.eclipse.xtext.ide.tests/src/org/eclipse/xtext/ide/tests/editor/quickfix/QuickFixInjectorProvider.java", "diffHunk": "@@ -0,0 +1,39 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 itemis AG (http://www.itemis.eu) and others.\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0.\n+ * \n+ * SPDX-License-Identifier: EPL-2.0\n+ *******************************************************************************/\n+package org.eclipse.xtext.ide.tests.editor.quickfix;\n+\n+import org.eclipse.xtext.testlanguages.fileAware.FileAwareTestLanguageRuntimeModule;\n+import org.eclipse.xtext.testlanguages.fileAware.ide.FileAwareTestLanguageIdeModule;\n+import org.eclipse.xtext.testlanguages.fileAware.ide.FileAwareTestLanguageIdeSetup;\n+import org.eclipse.xtext.testlanguages.fileAware.ide.tests.FileAwareTestLanguageIdeInjectorProvider;\n+import org.eclipse.xtext.util.Modules2;\n+\n+import com.google.inject.Binder;\n+import com.google.inject.Guice;\n+import com.google.inject.Injector;\n+\n+public class QuickFixInjectorProvider extends FileAwareTestLanguageIdeInjectorProvider {\n+\n+\t// overridden to avoid NPE in org.eclipse.xtext.resource.impl.LiveShadowedResourceDescriptions.getAllResourceDescriptions()\n+\t@Override\n+\tpublic Injector internalCreateInjector() {\n+\t\treturn new FileAwareTestLanguageIdeSetup() {\n+\t\t\t@Override\n+\t\t\tpublic Injector createInjector() {\n+\t\t\t\treturn Guice.createInjector(Modules2.mixin(new FileAwareTestLanguageRuntimeModule(), new FileAwareTestLanguageIdeModule() {\n+\t\t\t\t\t@Override\n+\t\t\t\t\tpublic void configureIResourceDescriptionsLiveScope(Binder binder) {\n+\t\t\t\t\t\t// do not override runtime binding", "originalCommit": "d4a330f31ef0528aa1ee9e8e18c5e6f1ef77b076", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTU1MTQ3MA==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r511551470", "bodyText": "The Unit test failed with an NPE because of the IDE implementation. I used the runtime binding and resolved it with it. I can attach a stacktrace of the failing test. If I can resolve it another way I'll try to.", "author": "imhotep82", "createdAt": "2020-10-25T05:55:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTU1MDg3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTU1MTY5Mw==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r511551693", "bodyText": "please do so", "author": "cdietrich", "createdAt": "2020-10-25T05:58:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTU1MDg3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTU2NTQ2Mw==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r511565463", "bodyText": "Will push a commit that fixes the NPE", "author": "imhotep82", "createdAt": "2020-10-25T08:35:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTU1MDg3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTU2NTcwMA==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r511565700", "bodyText": "i assume the problem is that you dont test on full lsp level and thus no ChunkedResourceDescriptions\nare created. so you might have to change that or do something similar as others tests do\n\tprotected def EObject createInMemoryFile(CharSequence content, EClass type) {\n.....\n// might also go to org.eclipse.xtext.ide.tests.serializer.ChangeSerializerTestHelper.createResourceSet(InMemoryURIHandler), dont know why it is not there\n\t\tval Map<String, ResourceDescriptionsData> dataMap = new HashMap();\n\t\tdataMap.put(\"egal\", ResourceSetAdapter.findResourceDescriptionsData(rs));\n\t\tnew ChunkedResourceDescriptions(Collections.unmodifiableMap(dataMap), rs); \n\t\treturn rs.contents(fileName, type.instanceClass) as EObject\n\n\nthis might also be a LiveShadowedChunkedResourceDescriptions vs LiveShadowedResourceDescriptions\nproblem (latter is used in normal changeserializer tests vs lsp/ide usually usss LiveShadowedChunkedResourceDescriptions and thus ChunkedResourceDescriptions to be installed (usually project and workspace manager care about this", "author": "cdietrich", "createdAt": "2020-10-25T08:37:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTU1MDg3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTU3NDQzMw==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r511574433", "bodyText": "Thanks for the hints. I'll consider that fix.", "author": "imhotep82", "createdAt": "2020-10-25T10:00:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTU1MDg3NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTU4NDc5Mw==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r511584793", "bodyText": "No need for final arguments or final parameters, they don't offer much value and make the code harder to read. There's quite a few more in the code", "author": "tivervac", "createdAt": "2020-10-25T11:39:58Z", "path": "org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/editor/quickfix/AbstractDeclarativeIdeQuickfixProvider.java", "diffHunk": "@@ -0,0 +1,86 @@\n+package org.eclipse.xtext.ide.editor.quickfix;\n+/*******************************************************************************\n+ * Copyright (c) 2020 TypeFox GmbH (http://www.typefox.io) and others.\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0.\n+ * \n+ * SPDX-License-Identifier: EPL-2.0\n+ *******************************************************************************/\n+import java.lang.reflect.Method;\n+import java.util.Collections;\n+import java.util.List;\n+\n+import org.apache.log4j.Logger;\n+import org.eclipse.lsp4j.Diagnostic;\n+import org.eclipse.xtext.ide.server.codeActions.ICodeActionService2.Options;\n+\n+import com.google.common.base.Predicate;\n+import com.google.common.base.Strings;\n+import com.google.common.collect.Iterables;\n+import com.google.common.collect.Lists;\n+import com.google.inject.Inject;\n+import com.google.inject.Provider;\n+\n+public class AbstractDeclarativeIdeQuickfixProvider implements IQuickFixProvider {\n+\n+\tprivate static final Logger LOG = Logger.getLogger(AbstractDeclarativeIdeQuickfixProvider.class);\n+\n+\t@Inject\n+\tprivate Provider<DiagnosticResolutionAcceptor> issueResolutionAcceptorProvider;\n+\n+\tprivate Predicate<Method> getFixMethodPredicate(final String issueCode) {", "originalCommit": "d4a330f31ef0528aa1ee9e8e18c5e6f1ef77b076", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTU4NTIzNw==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r511585237", "bodyText": "Aren't we 2.24 already?", "author": "tivervac", "createdAt": "2020-10-25T11:44:07Z", "path": "org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/editor/quickfix/DiagnosticResolution.java", "diffHunk": "@@ -0,0 +1,95 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 TypeFox GmbH (http://www.typefox.io) and others.\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0.\n+ * \n+ * SPDX-License-Identifier: EPL-2.0\n+ *******************************************************************************/\n+package org.eclipse.xtext.ide.editor.quickfix;\n+\n+import org.eclipse.emf.common.util.URI;\n+import org.eclipse.emf.common.util.WrappedException;\n+import org.eclipse.emf.ecore.EObject;\n+import org.eclipse.emf.ecore.resource.ResourceSet;\n+import org.eclipse.lsp4j.CodeActionParams;\n+import org.eclipse.lsp4j.WorkspaceEdit;\n+import org.eclipse.xtext.ide.editor.quickfix.DiagnosticModificationContext.Factory;\n+import org.eclipse.xtext.ide.serializer.IChangeSerializer;\n+import org.eclipse.xtext.ide.serializer.IChangeSerializer.IModification;\n+import org.eclipse.xtext.ide.server.ILanguageServerAccess;\n+import org.eclipse.xtext.ide.server.codeActions.ICodeActionService2.Options;\n+import org.eclipse.xtext.ide.server.rename.ChangeConverter2;\n+import org.eclipse.xtext.resource.EObjectAtOffsetHelper;\n+import org.eclipse.xtext.resource.XtextResource;\n+\n+public class DiagnosticResolution {\n+\n+\tprivate final String label;\n+\n+\tprivate final IModification<EObject> modification;\n+\n+\tprivate final Factory factory;\n+\n+\tprivate final int relevance;\n+\n+\tprivate Options options;\n+\n+\tpublic DiagnosticResolution(final String label, final Factory modificationContextFactory,\n+\t\t\tfinal IModification<EObject> modification) {\n+\t\tthis(label, modificationContextFactory, modification, 0);\n+\t}\n+\n+\t/**\n+\t * @since 2.22", "originalCommit": "d4a330f31ef0528aa1ee9e8e18c5e6f1ef77b076", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTU4NTYxMA==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r511585610", "bodyText": "Might as well just use new ArrayList<>();", "author": "tivervac", "createdAt": "2020-10-25T11:47:36Z", "path": "org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/editor/quickfix/DiagnosticResolutionAcceptor.java", "diffHunk": "@@ -0,0 +1,40 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 TypeFox GmbH (http://www.typefox.io) and others.\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0.\n+ * \n+ * SPDX-License-Identifier: EPL-2.0\n+ *******************************************************************************/\n+package org.eclipse.xtext.ide.editor.quickfix;\n+\n+import java.util.List;\n+\n+import org.eclipse.emf.ecore.EObject;\n+import org.eclipse.xtext.ide.serializer.IChangeSerializer.IModification;\n+import org.eclipse.xtext.ide.server.codeActions.ICodeActionService2.Options;\n+\n+import com.google.common.collect.Lists;\n+import com.google.inject.Inject;\n+\n+public class DiagnosticResolutionAcceptor {\n+\n+\tprivate final List<DiagnosticResolution> issues = Lists.newArrayList();", "originalCommit": "d4a330f31ef0528aa1ee9e8e18c5e6f1ef77b076", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTU4NTc5OQ==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r511585799", "bodyText": "Abundant empty line", "author": "tivervac", "createdAt": "2020-10-25T11:49:12Z", "path": "org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/editor/quickfix/QuickFixes.java", "diffHunk": "@@ -0,0 +1,27 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 TypeFox GmbH (http://www.typefox.io) and others.\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0.\n+ * \n+ * SPDX-License-Identifier: EPL-2.0\n+ *******************************************************************************/\n+package org.eclipse.xtext.ide.editor.quickfix;\n+\n+import java.lang.annotation.ElementType;\n+import java.lang.annotation.Retention;\n+import java.lang.annotation.RetentionPolicy;\n+import java.lang.annotation.Target;\n+\n+/**\n+ * Annotation Container for @{@link QuickFix} annotations. You can mark a method in a {@link AbstractDeclarativeIdeQuickfixProvider} with this annotation to\n+ * specify which issue codes the method offers quick-fixes for.\n+ *", "originalCommit": "d4a330f31ef0528aa1ee9e8e18c5e6f1ef77b076", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTU4NTk0OQ==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r511585949", "bodyText": "Hmm, I only see @QuickFix being mentioned, not @QuickFixes, am I missing something?", "author": "tivervac", "createdAt": "2020-10-25T11:50:15Z", "path": "org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/editor/quickfix/QuickFixes.java", "diffHunk": "@@ -0,0 +1,27 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 TypeFox GmbH (http://www.typefox.io) and others.\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0.\n+ * \n+ * SPDX-License-Identifier: EPL-2.0\n+ *******************************************************************************/\n+package org.eclipse.xtext.ide.editor.quickfix;\n+\n+import java.lang.annotation.ElementType;\n+import java.lang.annotation.Retention;\n+import java.lang.annotation.RetentionPolicy;\n+import java.lang.annotation.Target;\n+\n+/**\n+ * Annotation Container for @{@link QuickFix} annotations. You can mark a method in a {@link AbstractDeclarativeIdeQuickfixProvider} with this annotation to\n+ * specify which issue codes the method offers quick-fixes for.", "originalCommit": "d4a330f31ef0528aa1ee9e8e18c5e6f1ef77b076", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTcyNjAxMQ==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r511726011", "bodyText": "add @since 2.24", "author": "cdietrich", "createdAt": "2020-10-26T05:27:52Z", "path": "org.eclipse.xtext.ide.tests/src/org/eclipse/xtext/ide/tests/editor/quickfix/AbstractIdeQuickfixTest.java", "diffHunk": "@@ -0,0 +1,223 @@\n+/**\n+ * Copyright (c) 2020 TypeFox GmbH (http://www.typefox.io) and others.\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0.\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.eclipse.xtext.ide.tests.editor.quickfix;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.concurrent.CompletableFuture;\n+import java.util.function.Function;\n+\n+import org.eclipse.emf.common.util.URI;\n+import org.eclipse.emf.ecore.EClass;\n+import org.eclipse.emf.ecore.EObject;\n+import org.eclipse.emf.ecore.resource.ResourceSet;\n+import org.eclipse.lsp4j.CodeActionContext;\n+import org.eclipse.lsp4j.CodeActionParams;\n+import org.eclipse.lsp4j.Diagnostic;\n+import org.eclipse.lsp4j.DiagnosticSeverity;\n+import org.eclipse.lsp4j.InitializeParams;\n+import org.eclipse.lsp4j.InitializeResult;\n+import org.eclipse.lsp4j.Position;\n+import org.eclipse.lsp4j.Range;\n+import org.eclipse.lsp4j.TextDocumentIdentifier;\n+import org.eclipse.lsp4j.WorkspaceEdit;\n+import org.eclipse.lsp4j.services.LanguageClient;\n+import org.eclipse.xtext.ide.editor.quickfix.DiagnosticResolution;\n+import org.eclipse.xtext.ide.editor.quickfix.IQuickFixProvider;\n+import org.eclipse.xtext.ide.server.Document;\n+import org.eclipse.xtext.ide.server.ILanguageServerAccess;\n+import org.eclipse.xtext.ide.server.codeActions.ICodeActionService2;\n+import org.eclipse.xtext.nodemodel.ICompositeNode;\n+import org.eclipse.xtext.nodemodel.util.NodeModelUtils;\n+import org.eclipse.xtext.resource.FileExtensionProvider;\n+import org.eclipse.xtext.resource.XtextResource;\n+import org.eclipse.xtext.resource.impl.ChunkedResourceDescriptions;\n+import org.eclipse.xtext.resource.impl.ResourceDescriptionsData;\n+import org.eclipse.xtext.testing.util.InMemoryURIHandler;\n+import org.eclipse.xtext.util.CancelIndicator;\n+import org.eclipse.xtext.util.LineAndColumn;\n+import org.eclipse.xtext.util.Strings;\n+import org.eclipse.xtext.xbase.lib.CollectionLiterals;\n+import org.eclipse.xtext.xbase.lib.IterableExtensions;\n+import org.eclipse.xtext.xbase.lib.ObjectExtensions;\n+import org.eclipse.xtext.xbase.lib.Pair;\n+import org.eclipse.xtext.xbase.lib.Procedures.Procedure1;\n+import org.junit.Assert;\n+\n+import com.google.inject.Inject;\n+\n+/**\n+ * @author Heinrich Weichert", "originalCommit": "2e79f2903b3205fd24528e23d3c30b1ae5ddedb3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTcyNjI0Nw==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r511726247", "bodyText": "@since 2.24 on the class is enhough", "author": "cdietrich", "createdAt": "2020-10-26T05:29:02Z", "path": "org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/editor/quickfix/DiagnosticResolution.java", "diffHunk": "@@ -0,0 +1,98 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 TypeFox GmbH (http://www.typefox.io) and others.\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0.\n+ * \n+ * SPDX-License-Identifier: EPL-2.0\n+ *******************************************************************************/\n+package org.eclipse.xtext.ide.editor.quickfix;\n+\n+import org.eclipse.emf.common.util.URI;\n+import org.eclipse.emf.common.util.WrappedException;\n+import org.eclipse.emf.ecore.EObject;\n+import org.eclipse.emf.ecore.resource.ResourceSet;\n+import org.eclipse.lsp4j.CodeActionParams;\n+import org.eclipse.lsp4j.WorkspaceEdit;\n+import org.eclipse.xtext.ide.editor.quickfix.DiagnosticModificationContext.Factory;\n+import org.eclipse.xtext.ide.serializer.IChangeSerializer;\n+import org.eclipse.xtext.ide.serializer.IChangeSerializer.IModification;\n+import org.eclipse.xtext.ide.server.ILanguageServerAccess;\n+import org.eclipse.xtext.ide.server.codeActions.ICodeActionService2.Options;\n+import org.eclipse.xtext.ide.server.rename.ChangeConverter2;\n+import org.eclipse.xtext.resource.EObjectAtOffsetHelper;\n+import org.eclipse.xtext.resource.XtextResource;\n+\n+/**\n+ * @since 2.24\n+ * \n+ * @author Heinrich Weichert\n+ */\n+public class DiagnosticResolution {\n+\n+\tprivate String label;\n+\n+\tprivate IModification<EObject> modification;\n+\n+\tprivate Factory factory;\n+\n+\tprivate int relevance;\n+\n+\tprivate Options options;\n+\n+\tpublic DiagnosticResolution(String label, Factory modificationContextFactory, IModification<EObject> modification) {\n+\t\tthis(label, modificationContextFactory, modification, 0);\n+\t}\n+\n+\t/**\n+\t * @since 2.24", "originalCommit": "2e79f2903b3205fd24528e23d3c30b1ae5ddedb3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTcyNjUzOQ==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r511726539", "bodyText": "please move the @sinces after the @auther (check also other places)", "author": "cdietrich", "createdAt": "2020-10-26T05:30:15Z", "path": "org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/editor/quickfix/AbstractDeclarativeIdeQuickfixProvider.java", "diffHunk": "@@ -0,0 +1,92 @@\n+package org.eclipse.xtext.ide.editor.quickfix;\n+\n+/*******************************************************************************\n+ * Copyright (c) 2020 TypeFox GmbH (http://www.typefox.io) and others.\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0.\n+ * \n+ * SPDX-License-Identifier: EPL-2.0\n+ *******************************************************************************/\n+import java.lang.reflect.Method;\n+import java.util.Collections;\n+import java.util.List;\n+\n+import org.apache.log4j.Logger;\n+import org.eclipse.lsp4j.Diagnostic;\n+import org.eclipse.xtext.ide.server.codeActions.ICodeActionService2.Options;\n+\n+import com.google.common.base.Predicate;\n+import com.google.common.base.Strings;\n+import com.google.common.collect.Iterables;\n+import com.google.common.collect.Lists;\n+import com.google.inject.Inject;\n+import com.google.inject.Provider;\n+\n+/**\n+ * @since 2.24", "originalCommit": "2e79f2903b3205fd24528e23d3c30b1ae5ddedb3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTcyNzA4OQ==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r511727089", "bodyText": "please remove final from parameters (for fields it is ok)", "author": "cdietrich", "createdAt": "2020-10-26T05:32:57Z", "path": "org.eclipse.xtext.ide.tests/src/org/eclipse/xtext/ide/tests/editor/quickfix/AbstractIdeQuickfixTest.java", "diffHunk": "@@ -0,0 +1,223 @@\n+/**\n+ * Copyright (c) 2020 TypeFox GmbH (http://www.typefox.io) and others.\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0.\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.eclipse.xtext.ide.tests.editor.quickfix;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.concurrent.CompletableFuture;\n+import java.util.function.Function;\n+\n+import org.eclipse.emf.common.util.URI;\n+import org.eclipse.emf.ecore.EClass;\n+import org.eclipse.emf.ecore.EObject;\n+import org.eclipse.emf.ecore.resource.ResourceSet;\n+import org.eclipse.lsp4j.CodeActionContext;\n+import org.eclipse.lsp4j.CodeActionParams;\n+import org.eclipse.lsp4j.Diagnostic;\n+import org.eclipse.lsp4j.DiagnosticSeverity;\n+import org.eclipse.lsp4j.InitializeParams;\n+import org.eclipse.lsp4j.InitializeResult;\n+import org.eclipse.lsp4j.Position;\n+import org.eclipse.lsp4j.Range;\n+import org.eclipse.lsp4j.TextDocumentIdentifier;\n+import org.eclipse.lsp4j.WorkspaceEdit;\n+import org.eclipse.lsp4j.services.LanguageClient;\n+import org.eclipse.xtext.ide.editor.quickfix.DiagnosticResolution;\n+import org.eclipse.xtext.ide.editor.quickfix.IQuickFixProvider;\n+import org.eclipse.xtext.ide.server.Document;\n+import org.eclipse.xtext.ide.server.ILanguageServerAccess;\n+import org.eclipse.xtext.ide.server.codeActions.ICodeActionService2;\n+import org.eclipse.xtext.nodemodel.ICompositeNode;\n+import org.eclipse.xtext.nodemodel.util.NodeModelUtils;\n+import org.eclipse.xtext.resource.FileExtensionProvider;\n+import org.eclipse.xtext.resource.XtextResource;\n+import org.eclipse.xtext.resource.impl.ChunkedResourceDescriptions;\n+import org.eclipse.xtext.resource.impl.ResourceDescriptionsData;\n+import org.eclipse.xtext.testing.util.InMemoryURIHandler;\n+import org.eclipse.xtext.util.CancelIndicator;\n+import org.eclipse.xtext.util.LineAndColumn;\n+import org.eclipse.xtext.util.Strings;\n+import org.eclipse.xtext.xbase.lib.CollectionLiterals;\n+import org.eclipse.xtext.xbase.lib.IterableExtensions;\n+import org.eclipse.xtext.xbase.lib.ObjectExtensions;\n+import org.eclipse.xtext.xbase.lib.Pair;\n+import org.eclipse.xtext.xbase.lib.Procedures.Procedure1;\n+import org.junit.Assert;\n+\n+import com.google.inject.Inject;\n+\n+/**\n+ * @author Heinrich Weichert\n+ */\n+public abstract class AbstractIdeQuickfixTest {\n+\n+\tprotected static class Quickfix {\n+\t\tprivate final String label;\n+\t\tprivate final String description;\n+\t\tprivate final String result;\n+\n+\t\tpublic Quickfix(final String label, final String description, final String result) {", "originalCommit": "2e79f2903b3205fd24528e23d3c30b1ae5ddedb3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTcyNzEzNg==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r511727136", "bodyText": "remove finals from variables", "author": "cdietrich", "createdAt": "2020-10-26T05:33:13Z", "path": "org.eclipse.xtext.ide.tests/src/org/eclipse/xtext/ide/tests/editor/quickfix/AbstractIdeQuickfixTest.java", "diffHunk": "@@ -0,0 +1,223 @@\n+/**\n+ * Copyright (c) 2020 TypeFox GmbH (http://www.typefox.io) and others.\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0.\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.eclipse.xtext.ide.tests.editor.quickfix;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.concurrent.CompletableFuture;\n+import java.util.function.Function;\n+\n+import org.eclipse.emf.common.util.URI;\n+import org.eclipse.emf.ecore.EClass;\n+import org.eclipse.emf.ecore.EObject;\n+import org.eclipse.emf.ecore.resource.ResourceSet;\n+import org.eclipse.lsp4j.CodeActionContext;\n+import org.eclipse.lsp4j.CodeActionParams;\n+import org.eclipse.lsp4j.Diagnostic;\n+import org.eclipse.lsp4j.DiagnosticSeverity;\n+import org.eclipse.lsp4j.InitializeParams;\n+import org.eclipse.lsp4j.InitializeResult;\n+import org.eclipse.lsp4j.Position;\n+import org.eclipse.lsp4j.Range;\n+import org.eclipse.lsp4j.TextDocumentIdentifier;\n+import org.eclipse.lsp4j.WorkspaceEdit;\n+import org.eclipse.lsp4j.services.LanguageClient;\n+import org.eclipse.xtext.ide.editor.quickfix.DiagnosticResolution;\n+import org.eclipse.xtext.ide.editor.quickfix.IQuickFixProvider;\n+import org.eclipse.xtext.ide.server.Document;\n+import org.eclipse.xtext.ide.server.ILanguageServerAccess;\n+import org.eclipse.xtext.ide.server.codeActions.ICodeActionService2;\n+import org.eclipse.xtext.nodemodel.ICompositeNode;\n+import org.eclipse.xtext.nodemodel.util.NodeModelUtils;\n+import org.eclipse.xtext.resource.FileExtensionProvider;\n+import org.eclipse.xtext.resource.XtextResource;\n+import org.eclipse.xtext.resource.impl.ChunkedResourceDescriptions;\n+import org.eclipse.xtext.resource.impl.ResourceDescriptionsData;\n+import org.eclipse.xtext.testing.util.InMemoryURIHandler;\n+import org.eclipse.xtext.util.CancelIndicator;\n+import org.eclipse.xtext.util.LineAndColumn;\n+import org.eclipse.xtext.util.Strings;\n+import org.eclipse.xtext.xbase.lib.CollectionLiterals;\n+import org.eclipse.xtext.xbase.lib.IterableExtensions;\n+import org.eclipse.xtext.xbase.lib.ObjectExtensions;\n+import org.eclipse.xtext.xbase.lib.Pair;\n+import org.eclipse.xtext.xbase.lib.Procedures.Procedure1;\n+import org.junit.Assert;\n+\n+import com.google.inject.Inject;\n+\n+/**\n+ * @author Heinrich Weichert\n+ */\n+public abstract class AbstractIdeQuickfixTest {\n+\n+\tprotected static class Quickfix {\n+\t\tprivate final String label;\n+\t\tprivate final String description;\n+\t\tprivate final String result;\n+\n+\t\tpublic Quickfix(final String label, final String description, final String result) {\n+\t\t\tthis.label = label;\n+\t\t\tthis.description = description;\n+\t\t\tthis.result = result;\n+\t\t}\n+\n+\t\tpublic String getLabel() {\n+\t\t\treturn label;\n+\t\t}\n+\n+\t\tpublic String getDescription() {\n+\t\t\treturn description;\n+\t\t}\n+\n+\t\tpublic String getResult() {\n+\t\t\treturn result;\n+\t\t}\n+\t}\n+\n+\t@Inject\n+\tprivate IQuickFixProvider quickFixProvider;\n+\t@Inject\n+\tprivate QuickFixTestHelper quickFixTestHelper;\n+\t@Inject\n+\tprivate FileExtensionProvider fileExtensionProvider;\n+\n+\t/**\n+\t * Test that the expected quickfixes are offered on a given validation issue in a given DSL text.\n+\t *\n+\t * @param fileContents\n+\t *            The initial DSL text.\n+\t * @param issueCode\n+\t *            The code of the validation issue the offered quickfixes to test.\n+\t * @param quickfixes\n+\t *            The quickfixes that are expected to be offered on the given <code>issueCode</code>. Each expected quickfix should be described by the\n+\t *            following triple:\n+\t *            <ol>\n+\t *            <li>the quickfix label</li>\n+\t *            <li>the quickfix description</li>\n+\t *            <li>the DSL text after the quickfix application</li>\n+\t *            </ol>\n+\t */\n+\tpublic void testQuickfixesOn(final String fileContents, final String issueCode, final EClass type, final AbstractIdeQuickfixTest.Quickfix... quickfixes) {\n+\t\tquickfixesAreOffered(createInMemoryFile(fileContents, type), issueCode, fileContents, quickfixes);\n+\t}\n+\n+\t@SuppressWarnings(\"unchecked\")\n+\tprivate <T> T createInMemoryFile(final CharSequence content, final EClass type) {\n+\t\tInMemoryURIHandler fs = new InMemoryURIHandler();\n+\t\tString _primaryFileExtension = this.fileExtensionProvider.getPrimaryFileExtension();\n+\t\tfinal String fileName = \"inmemory:/file1.\" + _primaryFileExtension;", "originalCommit": "2e79f2903b3205fd24528e23d3c30b1ae5ddedb3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTcyNzIyNg==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r511727226", "bodyText": "finals", "author": "cdietrich", "createdAt": "2020-10-26T05:33:42Z", "path": "org.eclipse.xtext.ide.tests/src/org/eclipse/xtext/ide/tests/editor/quickfix/QuickFixTestHelper.java", "diffHunk": "@@ -0,0 +1,30 @@\n+/**\n+ * Copyright (c) 2020 itemis AG (http://www.itemis.eu) and others.\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0.\n+ * \n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.eclipse.xtext.ide.tests.editor.quickfix;\n+\n+import org.eclipse.emf.common.util.URI;\n+import org.eclipse.emf.ecore.resource.ResourceSet;\n+import org.eclipse.xtext.ide.tests.serializer.ChangeSerializerTestHelper;\n+import org.eclipse.xtext.xbase.lib.IteratorExtensions;\n+\n+import com.google.common.collect.Iterators;\n+\n+/**\n+ * \n+ * @author Heinrich Weichert\n+ */\n+public class QuickFixTestHelper extends ChangeSerializerTestHelper {\n+  @Override\n+  public <T extends Object> T contents(final ResourceSet rs, final String fileName, final Class<T> type) {", "originalCommit": "2e79f2903b3205fd24528e23d3c30b1ae5ddedb3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTcyNzMwNg==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r511727306", "bodyText": "finals", "author": "cdietrich", "createdAt": "2020-10-26T05:34:08Z", "path": "org.eclipse.xtext.testlanguages.ide/src/org/eclipse/xtext/testlanguages/fileAware/ide/quickfix/FileAwareTestLanguageQuickFixProvider.java", "diffHunk": "@@ -0,0 +1,28 @@\n+package org.eclipse.xtext.testlanguages.fileAware.ide.quickfix;\n+\n+import org.eclipse.xtext.ide.editor.quickfix.AbstractDeclarativeIdeQuickfixProvider;\n+import org.eclipse.xtext.ide.editor.quickfix.DiagnosticResolutionAcceptor;\n+import org.eclipse.xtext.ide.editor.quickfix.QuickFix;\n+import org.eclipse.xtext.testlanguages.fileAware.fileAware.Element;\n+import org.eclipse.xtext.xbase.lib.StringExtensions;\n+\n+public class FileAwareTestLanguageQuickFixProvider extends AbstractDeclarativeIdeQuickfixProvider {\n+\n+\tpublic static class IssueCodes {\n+\t\tprivate IssueCodes() {\n+\t\t\t// utility\n+\t\t}\n+\n+\t\tpublic static final String TESTISSUECODE = \"test\";\n+\t\tpublic static final String TESTLABEL = \"Change element name to first upper\";\n+\t}\n+\n+\t@QuickFix(IssueCodes.TESTISSUECODE)\n+\tpublic void removeUnusedVariable(final DiagnosticResolutionAcceptor acceptor) {", "originalCommit": "2e79f2903b3205fd24528e23d3c30b1ae5ddedb3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTcyNzM1MA==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r511727350", "bodyText": "finals", "author": "cdietrich", "createdAt": "2020-10-26T05:34:17Z", "path": "org.eclipse.xtext.testlanguages/src/org/eclipse/xtext/testlanguages/fileAware/FileAwareTestLanguageRuntimeModule.java", "diffHunk": "@@ -17,16 +17,18 @@\n  * Use this class to register components to be used at runtime / without the Equinox extension registry.\n  */\n public class FileAwareTestLanguageRuntimeModule extends AbstractFileAwareTestLanguageRuntimeModule {\n-\t\n-\tpublic void configureIResourceDescriptionsLiveScope(Binder binder) {\n+\n+\t@Override\n+\tpublic void configureIResourceDescriptionsLiveScope(final Binder binder) {", "originalCommit": "2e79f2903b3205fd24528e23d3c30b1ae5ddedb3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTcyNzQyMg==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r511727422", "bodyText": "finals", "author": "cdietrich", "createdAt": "2020-10-26T05:34:27Z", "path": "org.eclipse.xtext.testlanguages/src/org/eclipse/xtext/testlanguages/fileAware/validation/FileAwareTestLanguageValidator.java", "diffHunk": "@@ -3,23 +3,20 @@\n  */\n package org.eclipse.xtext.testlanguages.fileAware.validation;\n \n+import org.eclipse.xtext.testlanguages.fileAware.fileAware.Element;\n+import org.eclipse.xtext.validation.Check;\n \n /**\n- * This class contains custom validation rules. \n+ * This class contains custom validation rules.\n  *\n  * See https://www.eclipse.org/Xtext/documentation/303_runtime_concepts.html#validation\n  */\n public class FileAwareTestLanguageValidator extends AbstractFileAwareTestLanguageValidator {\n-\t\n-//\tpublic static final INVALID_NAME = 'invalidName'\n-//\n-//\t@Check\n-//\tpublic void checkGreetingStartsWithCapital(Greeting greeting) {\n-//\t\tif (!Character.isUpperCase(greeting.getName().charAt(0))) {\n-//\t\t\twarning(\"Name should start with a capital\",\n-//\t\t\t\t\tFileAwareTestLanguagePackage.Literals.GREETING__NAME,\n-//\t\t\t\t\tINVALID_NAME);\n-//\t\t}\n-//\t}\n-\t\n+\n+\t@Check\n+\tpublic void checkElementNameStartsWithUpperCase(final Element element) {", "originalCommit": "2e79f2903b3205fd24528e23d3c30b1ae5ddedb3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTcyNzQ5OQ==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r511727499", "bodyText": "no constant for issue code", "author": "cdietrich", "createdAt": "2020-10-26T05:34:49Z", "path": "org.eclipse.xtext.testlanguages/src/org/eclipse/xtext/testlanguages/fileAware/validation/FileAwareTestLanguageValidator.java", "diffHunk": "@@ -3,23 +3,20 @@\n  */\n package org.eclipse.xtext.testlanguages.fileAware.validation;\n \n+import org.eclipse.xtext.testlanguages.fileAware.fileAware.Element;\n+import org.eclipse.xtext.validation.Check;\n \n /**\n- * This class contains custom validation rules. \n+ * This class contains custom validation rules.\n  *\n  * See https://www.eclipse.org/Xtext/documentation/303_runtime_concepts.html#validation\n  */\n public class FileAwareTestLanguageValidator extends AbstractFileAwareTestLanguageValidator {\n-\t\n-//\tpublic static final INVALID_NAME = 'invalidName'\n-//\n-//\t@Check\n-//\tpublic void checkGreetingStartsWithCapital(Greeting greeting) {\n-//\t\tif (!Character.isUpperCase(greeting.getName().charAt(0))) {\n-//\t\t\twarning(\"Name should start with a capital\",\n-//\t\t\t\t\tFileAwareTestLanguagePackage.Literals.GREETING__NAME,\n-//\t\t\t\t\tINVALID_NAME);\n-//\t\t}\n-//\t}\n-\t\n+\n+\t@Check\n+\tpublic void checkElementNameStartsWithUpperCase(final Element element) {\n+\t\tif (!Character.isUpperCase(element.getName().charAt(0))) {\n+\t\t\twarning(\"Element name should start with a capital\", element, null, \"test\");", "originalCommit": "2e79f2903b3205fd24528e23d3c30b1ae5ddedb3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTcyNzU3OA==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r511727578", "bodyText": "move to validator", "author": "cdietrich", "createdAt": "2020-10-26T05:35:09Z", "path": "org.eclipse.xtext.testlanguages.ide/src/org/eclipse/xtext/testlanguages/fileAware/ide/quickfix/FileAwareTestLanguageQuickFixProvider.java", "diffHunk": "@@ -0,0 +1,28 @@\n+package org.eclipse.xtext.testlanguages.fileAware.ide.quickfix;\n+\n+import org.eclipse.xtext.ide.editor.quickfix.AbstractDeclarativeIdeQuickfixProvider;\n+import org.eclipse.xtext.ide.editor.quickfix.DiagnosticResolutionAcceptor;\n+import org.eclipse.xtext.ide.editor.quickfix.QuickFix;\n+import org.eclipse.xtext.testlanguages.fileAware.fileAware.Element;\n+import org.eclipse.xtext.xbase.lib.StringExtensions;\n+\n+public class FileAwareTestLanguageQuickFixProvider extends AbstractDeclarativeIdeQuickfixProvider {\n+\n+\tpublic static class IssueCodes {\n+\t\tprivate IssueCodes() {\n+\t\t\t// utility\n+\t\t}\n+\n+\t\tpublic static final String TESTISSUECODE = \"test\";", "originalCommit": "2e79f2903b3205fd24528e23d3c30b1ae5ddedb3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTcyNzkwOA==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r511727908", "bodyText": "use new ArrayList<>() and remove the Unmodifiable list", "author": "cdietrich", "createdAt": "2020-10-26T05:36:31Z", "path": "org.eclipse.xtext.ide.tests/src/org/eclipse/xtext/ide/tests/editor/quickfix/AbstractIdeQuickfixTest.java", "diffHunk": "@@ -0,0 +1,223 @@\n+/**\n+ * Copyright (c) 2020 TypeFox GmbH (http://www.typefox.io) and others.\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0.\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.eclipse.xtext.ide.tests.editor.quickfix;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.concurrent.CompletableFuture;\n+import java.util.function.Function;\n+\n+import org.eclipse.emf.common.util.URI;\n+import org.eclipse.emf.ecore.EClass;\n+import org.eclipse.emf.ecore.EObject;\n+import org.eclipse.emf.ecore.resource.ResourceSet;\n+import org.eclipse.lsp4j.CodeActionContext;\n+import org.eclipse.lsp4j.CodeActionParams;\n+import org.eclipse.lsp4j.Diagnostic;\n+import org.eclipse.lsp4j.DiagnosticSeverity;\n+import org.eclipse.lsp4j.InitializeParams;\n+import org.eclipse.lsp4j.InitializeResult;\n+import org.eclipse.lsp4j.Position;\n+import org.eclipse.lsp4j.Range;\n+import org.eclipse.lsp4j.TextDocumentIdentifier;\n+import org.eclipse.lsp4j.WorkspaceEdit;\n+import org.eclipse.lsp4j.services.LanguageClient;\n+import org.eclipse.xtext.ide.editor.quickfix.DiagnosticResolution;\n+import org.eclipse.xtext.ide.editor.quickfix.IQuickFixProvider;\n+import org.eclipse.xtext.ide.server.Document;\n+import org.eclipse.xtext.ide.server.ILanguageServerAccess;\n+import org.eclipse.xtext.ide.server.codeActions.ICodeActionService2;\n+import org.eclipse.xtext.nodemodel.ICompositeNode;\n+import org.eclipse.xtext.nodemodel.util.NodeModelUtils;\n+import org.eclipse.xtext.resource.FileExtensionProvider;\n+import org.eclipse.xtext.resource.XtextResource;\n+import org.eclipse.xtext.resource.impl.ChunkedResourceDescriptions;\n+import org.eclipse.xtext.resource.impl.ResourceDescriptionsData;\n+import org.eclipse.xtext.testing.util.InMemoryURIHandler;\n+import org.eclipse.xtext.util.CancelIndicator;\n+import org.eclipse.xtext.util.LineAndColumn;\n+import org.eclipse.xtext.util.Strings;\n+import org.eclipse.xtext.xbase.lib.CollectionLiterals;\n+import org.eclipse.xtext.xbase.lib.IterableExtensions;\n+import org.eclipse.xtext.xbase.lib.ObjectExtensions;\n+import org.eclipse.xtext.xbase.lib.Pair;\n+import org.eclipse.xtext.xbase.lib.Procedures.Procedure1;\n+import org.junit.Assert;\n+\n+import com.google.inject.Inject;\n+\n+/**\n+ * @author Heinrich Weichert\n+ */\n+public abstract class AbstractIdeQuickfixTest {\n+\n+\tprotected static class Quickfix {\n+\t\tprivate final String label;\n+\t\tprivate final String description;\n+\t\tprivate final String result;\n+\n+\t\tpublic Quickfix(final String label, final String description, final String result) {\n+\t\t\tthis.label = label;\n+\t\t\tthis.description = description;\n+\t\t\tthis.result = result;\n+\t\t}\n+\n+\t\tpublic String getLabel() {\n+\t\t\treturn label;\n+\t\t}\n+\n+\t\tpublic String getDescription() {\n+\t\t\treturn description;\n+\t\t}\n+\n+\t\tpublic String getResult() {\n+\t\t\treturn result;\n+\t\t}\n+\t}\n+\n+\t@Inject\n+\tprivate IQuickFixProvider quickFixProvider;\n+\t@Inject\n+\tprivate QuickFixTestHelper quickFixTestHelper;\n+\t@Inject\n+\tprivate FileExtensionProvider fileExtensionProvider;\n+\n+\t/**\n+\t * Test that the expected quickfixes are offered on a given validation issue in a given DSL text.\n+\t *\n+\t * @param fileContents\n+\t *            The initial DSL text.\n+\t * @param issueCode\n+\t *            The code of the validation issue the offered quickfixes to test.\n+\t * @param quickfixes\n+\t *            The quickfixes that are expected to be offered on the given <code>issueCode</code>. Each expected quickfix should be described by the\n+\t *            following triple:\n+\t *            <ol>\n+\t *            <li>the quickfix label</li>\n+\t *            <li>the quickfix description</li>\n+\t *            <li>the DSL text after the quickfix application</li>\n+\t *            </ol>\n+\t */\n+\tpublic void testQuickfixesOn(final String fileContents, final String issueCode, final EClass type, final AbstractIdeQuickfixTest.Quickfix... quickfixes) {\n+\t\tquickfixesAreOffered(createInMemoryFile(fileContents, type), issueCode, fileContents, quickfixes);\n+\t}\n+\n+\t@SuppressWarnings(\"unchecked\")\n+\tprivate <T> T createInMemoryFile(final CharSequence content, final EClass type) {\n+\t\tInMemoryURIHandler fs = new InMemoryURIHandler();\n+\t\tString _primaryFileExtension = this.fileExtensionProvider.getPrimaryFileExtension();\n+\t\tfinal String fileName = \"inmemory:/file1.\" + _primaryFileExtension;\n+\t\tString _string = content.toString();\n+\t\tPair<String, String> _mappedTo = Pair.of(fileName, _string);\n+\t\tthis.quickFixTestHelper.operator_add(fs, _mappedTo);\n+\t\tfinal ResourceSet rs = this.quickFixTestHelper.createResourceSet(fs);\n+\t\tfinal Map<String, ResourceDescriptionsData> dataMap = new HashMap<>();\n+\t\tdataMap.put(\"project\", ResourceDescriptionsData.ResourceSetAdapter.findResourceDescriptionsData(rs));\n+\t\tnew ChunkedResourceDescriptions(dataMap, rs);\n+\t\treturn (T) this.quickFixTestHelper.contents(rs, fileName, type.getInstanceClass());\n+\t}\n+\n+\tprivate void quickfixesAreOffered(final EObject target, final String issueCode, final String originalText,\n+\t\t\tfinal AbstractIdeQuickfixTest.Quickfix... expected) {\n+\t\tfinal List<AbstractIdeQuickfixTest.Quickfix> expectedSorted = IterableExtensions.sortBy(Arrays.asList(expected), it -> it.label);\n+\t\tfinal ICompositeNode elementNode = NodeModelUtils.getNode(target);\n+\t\tfinal LineAndColumn elementStartPosition = NodeModelUtils.getLineAndColumn(elementNode, elementNode.getOffset());\n+\t\tfinal LineAndColumn elementEndPosition = NodeModelUtils.getLineAndColumn(elementNode, elementNode.getEndOffset());\n+\t\tfinal Position startPos = new Position(elementStartPosition.getLine() - 1, elementStartPosition.getColumn() - 1);\n+\t\tfinal Position endPos = new Position(elementEndPosition.getLine() - 1, elementEndPosition.getColumn() - 1);\n+\t\tDiagnostic issue = new Diagnostic();\n+\t\tissue.setCode(issueCode);\n+\t\tissue.setMessage(\"error\");\n+\t\tissue.setSeverity(DiagnosticSeverity.Error);\n+\t\tissue.setSource(\"source\");\n+\t\tissue.setRange(new Range(startPos, endPos));\n+\n+\t\tfinal ICodeActionService2.Options options = new ICodeActionService2.Options();\n+\t\toptions.setCancelIndicator(CancelIndicator.NullImpl);\n+\t\toptions.setDocument(new Document(Integer.valueOf(0), Strings.toUnixLineSeparator(originalText)));\n+\t\toptions.setResource((XtextResource) target.eResource());\n+\t\toptions.setLanguageServerAccess(new ILanguageServerAccess() {\n+\t\t\t@Override\n+\t\t\tpublic void addBuildListener(final ILanguageServerAccess.IBuildListener listener) {\n+\t\t\t\t//\n+\t\t\t}\n+\n+\t\t\t@Override\n+\t\t\tpublic <T extends Object> CompletableFuture<T> doRead(final String uri, final Function<ILanguageServerAccess.Context, T> function) {\n+\t\t\t\tXtextResource _resource = options.getResource();\n+\t\t\t\tDocument _document = options.getDocument();\n+\t\t\t\tfinal ILanguageServerAccess.Context ctx = new ILanguageServerAccess.Context(_resource, _document,\n+\t\t\t\t\t\ttrue, CancelIndicator.NullImpl);\n+\t\t\t\treturn CompletableFuture.<T> completedFuture(function.apply(ctx));\n+\t\t\t}\n+\n+\t\t\t@Override\n+\t\t\tpublic <T extends Object> CompletableFuture<T> doReadIndex(final Function<? super ILanguageServerAccess.IndexContext, ? extends T> function) {\n+\t\t\t\treturn null;\n+\t\t\t}\n+\n+\t\t\t@Override\n+\t\t\tpublic InitializeParams getInitializeParams() {\n+\t\t\t\treturn null;\n+\t\t\t}\n+\n+\t\t\t@Override\n+\t\t\tpublic InitializeResult getInitializeResult() {\n+\t\t\t\treturn null;\n+\t\t\t}\n+\n+\t\t\t@Override\n+\t\t\tpublic LanguageClient getLanguageClient() {\n+\t\t\t\treturn null;\n+\t\t\t}\n+\n+\t\t\t@Override\n+\t\t\tpublic ResourceSet newLiveScopeResourceSet(final URI uri) {\n+\t\t\t\tfinal ResourceSet resourceSet = options.getResource().getResourceSet();\n+\t\t\t\treturn resourceSet;\n+\t\t\t}\n+\t\t});\n+\t\tCodeActionParams codeActionParams = new CodeActionParams();\n+\t\tcodeActionParams.setRange(new Range(startPos, endPos));\n+\t\tcodeActionParams.setTextDocument(new TextDocumentIdentifier(target.eResource().getURI().toString()));\n+\t\n+\t\tCodeActionContext codeActionContext = new CodeActionContext();\n+\t\tcodeActionContext.setDiagnostics(Collections.unmodifiableList(CollectionLiterals.newArrayList(issue)));", "originalCommit": "2e79f2903b3205fd24528e23d3c30b1ae5ddedb3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTcyODYxNQ==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r511728615", "bodyText": "check for unused imports", "author": "cdietrich", "createdAt": "2020-10-26T05:39:42Z", "path": "org.eclipse.xtext.ide.tests/src/org/eclipse/xtext/ide/tests/editor/quickfix/AbstractIdeQuickfixTest.java", "diffHunk": "@@ -0,0 +1,223 @@\n+/**\n+ * Copyright (c) 2020 TypeFox GmbH (http://www.typefox.io) and others.\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0.\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.eclipse.xtext.ide.tests.editor.quickfix;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.concurrent.CompletableFuture;\n+import java.util.function.Function;\n+\n+import org.eclipse.emf.common.util.URI;\n+import org.eclipse.emf.ecore.EClass;\n+import org.eclipse.emf.ecore.EObject;\n+import org.eclipse.emf.ecore.resource.ResourceSet;\n+import org.eclipse.lsp4j.CodeActionContext;\n+import org.eclipse.lsp4j.CodeActionParams;\n+import org.eclipse.lsp4j.Diagnostic;\n+import org.eclipse.lsp4j.DiagnosticSeverity;\n+import org.eclipse.lsp4j.InitializeParams;\n+import org.eclipse.lsp4j.InitializeResult;\n+import org.eclipse.lsp4j.Position;\n+import org.eclipse.lsp4j.Range;\n+import org.eclipse.lsp4j.TextDocumentIdentifier;\n+import org.eclipse.lsp4j.WorkspaceEdit;\n+import org.eclipse.lsp4j.services.LanguageClient;\n+import org.eclipse.xtext.ide.editor.quickfix.DiagnosticResolution;\n+import org.eclipse.xtext.ide.editor.quickfix.IQuickFixProvider;\n+import org.eclipse.xtext.ide.server.Document;\n+import org.eclipse.xtext.ide.server.ILanguageServerAccess;\n+import org.eclipse.xtext.ide.server.codeActions.ICodeActionService2;\n+import org.eclipse.xtext.nodemodel.ICompositeNode;\n+import org.eclipse.xtext.nodemodel.util.NodeModelUtils;\n+import org.eclipse.xtext.resource.FileExtensionProvider;\n+import org.eclipse.xtext.resource.XtextResource;\n+import org.eclipse.xtext.resource.impl.ChunkedResourceDescriptions;\n+import org.eclipse.xtext.resource.impl.ResourceDescriptionsData;\n+import org.eclipse.xtext.testing.util.InMemoryURIHandler;\n+import org.eclipse.xtext.util.CancelIndicator;\n+import org.eclipse.xtext.util.LineAndColumn;\n+import org.eclipse.xtext.util.Strings;\n+import org.eclipse.xtext.xbase.lib.CollectionLiterals;\n+import org.eclipse.xtext.xbase.lib.IterableExtensions;\n+import org.eclipse.xtext.xbase.lib.ObjectExtensions;", "originalCommit": "2e79f2903b3205fd24528e23d3c30b1ae5ddedb3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTcyODcxOA==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r511728718", "bodyText": "please inline the \"_\" local vars", "author": "cdietrich", "createdAt": "2020-10-26T05:40:07Z", "path": "org.eclipse.xtext.ide.tests/src/org/eclipse/xtext/ide/tests/editor/quickfix/AbstractIdeQuickfixTest.java", "diffHunk": "@@ -0,0 +1,223 @@\n+/**\n+ * Copyright (c) 2020 TypeFox GmbH (http://www.typefox.io) and others.\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0.\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.eclipse.xtext.ide.tests.editor.quickfix;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.concurrent.CompletableFuture;\n+import java.util.function.Function;\n+\n+import org.eclipse.emf.common.util.URI;\n+import org.eclipse.emf.ecore.EClass;\n+import org.eclipse.emf.ecore.EObject;\n+import org.eclipse.emf.ecore.resource.ResourceSet;\n+import org.eclipse.lsp4j.CodeActionContext;\n+import org.eclipse.lsp4j.CodeActionParams;\n+import org.eclipse.lsp4j.Diagnostic;\n+import org.eclipse.lsp4j.DiagnosticSeverity;\n+import org.eclipse.lsp4j.InitializeParams;\n+import org.eclipse.lsp4j.InitializeResult;\n+import org.eclipse.lsp4j.Position;\n+import org.eclipse.lsp4j.Range;\n+import org.eclipse.lsp4j.TextDocumentIdentifier;\n+import org.eclipse.lsp4j.WorkspaceEdit;\n+import org.eclipse.lsp4j.services.LanguageClient;\n+import org.eclipse.xtext.ide.editor.quickfix.DiagnosticResolution;\n+import org.eclipse.xtext.ide.editor.quickfix.IQuickFixProvider;\n+import org.eclipse.xtext.ide.server.Document;\n+import org.eclipse.xtext.ide.server.ILanguageServerAccess;\n+import org.eclipse.xtext.ide.server.codeActions.ICodeActionService2;\n+import org.eclipse.xtext.nodemodel.ICompositeNode;\n+import org.eclipse.xtext.nodemodel.util.NodeModelUtils;\n+import org.eclipse.xtext.resource.FileExtensionProvider;\n+import org.eclipse.xtext.resource.XtextResource;\n+import org.eclipse.xtext.resource.impl.ChunkedResourceDescriptions;\n+import org.eclipse.xtext.resource.impl.ResourceDescriptionsData;\n+import org.eclipse.xtext.testing.util.InMemoryURIHandler;\n+import org.eclipse.xtext.util.CancelIndicator;\n+import org.eclipse.xtext.util.LineAndColumn;\n+import org.eclipse.xtext.util.Strings;\n+import org.eclipse.xtext.xbase.lib.CollectionLiterals;\n+import org.eclipse.xtext.xbase.lib.IterableExtensions;\n+import org.eclipse.xtext.xbase.lib.ObjectExtensions;\n+import org.eclipse.xtext.xbase.lib.Pair;\n+import org.eclipse.xtext.xbase.lib.Procedures.Procedure1;\n+import org.junit.Assert;\n+\n+import com.google.inject.Inject;\n+\n+/**\n+ * @author Heinrich Weichert\n+ */\n+public abstract class AbstractIdeQuickfixTest {\n+\n+\tprotected static class Quickfix {\n+\t\tprivate final String label;\n+\t\tprivate final String description;\n+\t\tprivate final String result;\n+\n+\t\tpublic Quickfix(final String label, final String description, final String result) {\n+\t\t\tthis.label = label;\n+\t\t\tthis.description = description;\n+\t\t\tthis.result = result;\n+\t\t}\n+\n+\t\tpublic String getLabel() {\n+\t\t\treturn label;\n+\t\t}\n+\n+\t\tpublic String getDescription() {\n+\t\t\treturn description;\n+\t\t}\n+\n+\t\tpublic String getResult() {\n+\t\t\treturn result;\n+\t\t}\n+\t}\n+\n+\t@Inject\n+\tprivate IQuickFixProvider quickFixProvider;\n+\t@Inject\n+\tprivate QuickFixTestHelper quickFixTestHelper;\n+\t@Inject\n+\tprivate FileExtensionProvider fileExtensionProvider;\n+\n+\t/**\n+\t * Test that the expected quickfixes are offered on a given validation issue in a given DSL text.\n+\t *\n+\t * @param fileContents\n+\t *            The initial DSL text.\n+\t * @param issueCode\n+\t *            The code of the validation issue the offered quickfixes to test.\n+\t * @param quickfixes\n+\t *            The quickfixes that are expected to be offered on the given <code>issueCode</code>. Each expected quickfix should be described by the\n+\t *            following triple:\n+\t *            <ol>\n+\t *            <li>the quickfix label</li>\n+\t *            <li>the quickfix description</li>\n+\t *            <li>the DSL text after the quickfix application</li>\n+\t *            </ol>\n+\t */\n+\tpublic void testQuickfixesOn(final String fileContents, final String issueCode, final EClass type, final AbstractIdeQuickfixTest.Quickfix... quickfixes) {\n+\t\tquickfixesAreOffered(createInMemoryFile(fileContents, type), issueCode, fileContents, quickfixes);\n+\t}\n+\n+\t@SuppressWarnings(\"unchecked\")\n+\tprivate <T> T createInMemoryFile(final CharSequence content, final EClass type) {\n+\t\tInMemoryURIHandler fs = new InMemoryURIHandler();\n+\t\tString _primaryFileExtension = this.fileExtensionProvider.getPrimaryFileExtension();", "originalCommit": "2e79f2903b3205fd24528e23d3c30b1ae5ddedb3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTcyODg2Mw==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r511728863", "bodyText": "remove finals", "author": "cdietrich", "createdAt": "2020-10-26T05:40:41Z", "path": "org.eclipse.xtext.ide.tests/src/org/eclipse/xtext/ide/tests/editor/quickfix/AbstractIdeQuickfixTest.java", "diffHunk": "@@ -0,0 +1,223 @@\n+/**\n+ * Copyright (c) 2020 TypeFox GmbH (http://www.typefox.io) and others.\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0.\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.eclipse.xtext.ide.tests.editor.quickfix;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.concurrent.CompletableFuture;\n+import java.util.function.Function;\n+\n+import org.eclipse.emf.common.util.URI;\n+import org.eclipse.emf.ecore.EClass;\n+import org.eclipse.emf.ecore.EObject;\n+import org.eclipse.emf.ecore.resource.ResourceSet;\n+import org.eclipse.lsp4j.CodeActionContext;\n+import org.eclipse.lsp4j.CodeActionParams;\n+import org.eclipse.lsp4j.Diagnostic;\n+import org.eclipse.lsp4j.DiagnosticSeverity;\n+import org.eclipse.lsp4j.InitializeParams;\n+import org.eclipse.lsp4j.InitializeResult;\n+import org.eclipse.lsp4j.Position;\n+import org.eclipse.lsp4j.Range;\n+import org.eclipse.lsp4j.TextDocumentIdentifier;\n+import org.eclipse.lsp4j.WorkspaceEdit;\n+import org.eclipse.lsp4j.services.LanguageClient;\n+import org.eclipse.xtext.ide.editor.quickfix.DiagnosticResolution;\n+import org.eclipse.xtext.ide.editor.quickfix.IQuickFixProvider;\n+import org.eclipse.xtext.ide.server.Document;\n+import org.eclipse.xtext.ide.server.ILanguageServerAccess;\n+import org.eclipse.xtext.ide.server.codeActions.ICodeActionService2;\n+import org.eclipse.xtext.nodemodel.ICompositeNode;\n+import org.eclipse.xtext.nodemodel.util.NodeModelUtils;\n+import org.eclipse.xtext.resource.FileExtensionProvider;\n+import org.eclipse.xtext.resource.XtextResource;\n+import org.eclipse.xtext.resource.impl.ChunkedResourceDescriptions;\n+import org.eclipse.xtext.resource.impl.ResourceDescriptionsData;\n+import org.eclipse.xtext.testing.util.InMemoryURIHandler;\n+import org.eclipse.xtext.util.CancelIndicator;\n+import org.eclipse.xtext.util.LineAndColumn;\n+import org.eclipse.xtext.util.Strings;\n+import org.eclipse.xtext.xbase.lib.CollectionLiterals;\n+import org.eclipse.xtext.xbase.lib.IterableExtensions;\n+import org.eclipse.xtext.xbase.lib.ObjectExtensions;\n+import org.eclipse.xtext.xbase.lib.Pair;\n+import org.eclipse.xtext.xbase.lib.Procedures.Procedure1;\n+import org.junit.Assert;\n+\n+import com.google.inject.Inject;\n+\n+/**\n+ * @author Heinrich Weichert\n+ */\n+public abstract class AbstractIdeQuickfixTest {\n+\n+\tprotected static class Quickfix {\n+\t\tprivate final String label;\n+\t\tprivate final String description;\n+\t\tprivate final String result;\n+\n+\t\tpublic Quickfix(final String label, final String description, final String result) {\n+\t\t\tthis.label = label;\n+\t\t\tthis.description = description;\n+\t\t\tthis.result = result;\n+\t\t}\n+\n+\t\tpublic String getLabel() {\n+\t\t\treturn label;\n+\t\t}\n+\n+\t\tpublic String getDescription() {\n+\t\t\treturn description;\n+\t\t}\n+\n+\t\tpublic String getResult() {\n+\t\t\treturn result;\n+\t\t}\n+\t}\n+\n+\t@Inject\n+\tprivate IQuickFixProvider quickFixProvider;\n+\t@Inject\n+\tprivate QuickFixTestHelper quickFixTestHelper;\n+\t@Inject\n+\tprivate FileExtensionProvider fileExtensionProvider;\n+\n+\t/**\n+\t * Test that the expected quickfixes are offered on a given validation issue in a given DSL text.\n+\t *\n+\t * @param fileContents\n+\t *            The initial DSL text.\n+\t * @param issueCode\n+\t *            The code of the validation issue the offered quickfixes to test.\n+\t * @param quickfixes\n+\t *            The quickfixes that are expected to be offered on the given <code>issueCode</code>. Each expected quickfix should be described by the\n+\t *            following triple:\n+\t *            <ol>\n+\t *            <li>the quickfix label</li>\n+\t *            <li>the quickfix description</li>\n+\t *            <li>the DSL text after the quickfix application</li>\n+\t *            </ol>\n+\t */\n+\tpublic void testQuickfixesOn(final String fileContents, final String issueCode, final EClass type, final AbstractIdeQuickfixTest.Quickfix... quickfixes) {\n+\t\tquickfixesAreOffered(createInMemoryFile(fileContents, type), issueCode, fileContents, quickfixes);\n+\t}\n+\n+\t@SuppressWarnings(\"unchecked\")\n+\tprivate <T> T createInMemoryFile(final CharSequence content, final EClass type) {\n+\t\tInMemoryURIHandler fs = new InMemoryURIHandler();\n+\t\tString _primaryFileExtension = this.fileExtensionProvider.getPrimaryFileExtension();\n+\t\tfinal String fileName = \"inmemory:/file1.\" + _primaryFileExtension;\n+\t\tString _string = content.toString();\n+\t\tPair<String, String> _mappedTo = Pair.of(fileName, _string);\n+\t\tthis.quickFixTestHelper.operator_add(fs, _mappedTo);\n+\t\tfinal ResourceSet rs = this.quickFixTestHelper.createResourceSet(fs);\n+\t\tfinal Map<String, ResourceDescriptionsData> dataMap = new HashMap<>();\n+\t\tdataMap.put(\"project\", ResourceDescriptionsData.ResourceSetAdapter.findResourceDescriptionsData(rs));\n+\t\tnew ChunkedResourceDescriptions(dataMap, rs);\n+\t\treturn (T) this.quickFixTestHelper.contents(rs, fileName, type.getInstanceClass());\n+\t}\n+\n+\tprivate void quickfixesAreOffered(final EObject target, final String issueCode, final String originalText,\n+\t\t\tfinal AbstractIdeQuickfixTest.Quickfix... expected) {\n+\t\tfinal List<AbstractIdeQuickfixTest.Quickfix> expectedSorted = IterableExtensions.sortBy(Arrays.asList(expected), it -> it.label);", "originalCommit": "2e79f2903b3205fd24528e23d3c30b1ae5ddedb3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTcyOTU0OA==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r511729548", "bodyText": "i wonder if we should mark this as @Beta. that do you think @szarnekow", "author": "cdietrich", "createdAt": "2020-10-26T05:43:54Z", "path": "org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/editor/quickfix/AbstractDeclarativeIdeQuickfixProvider.java", "diffHunk": "@@ -0,0 +1,92 @@\n+package org.eclipse.xtext.ide.editor.quickfix;\n+\n+/*******************************************************************************\n+ * Copyright (c) 2020 TypeFox GmbH (http://www.typefox.io) and others.\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0.\n+ * \n+ * SPDX-License-Identifier: EPL-2.0\n+ *******************************************************************************/\n+import java.lang.reflect.Method;\n+import java.util.Collections;\n+import java.util.List;\n+\n+import org.apache.log4j.Logger;\n+import org.eclipse.lsp4j.Diagnostic;\n+import org.eclipse.xtext.ide.server.codeActions.ICodeActionService2.Options;\n+\n+import com.google.common.base.Predicate;\n+import com.google.common.base.Strings;\n+import com.google.common.collect.Iterables;\n+import com.google.common.collect.Lists;\n+import com.google.inject.Inject;\n+import com.google.inject.Provider;\n+\n+/**\n+ * @since 2.24\n+ * \n+ * @author Heinrich Weichert\n+ */\n+public class AbstractDeclarativeIdeQuickfixProvider implements IQuickFixProvider {", "originalCommit": "2e79f2903b3205fd24528e23d3c30b1ae5ddedb3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTcyOTU5Mg==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r511729592", "bodyText": "i wonder if we should mark this as @Beta. that do you think @szarnekow", "author": "cdietrich", "createdAt": "2020-10-26T05:44:10Z", "path": "org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/server/codeActions/QuickFixCodeActionService.java", "diffHunk": "@@ -0,0 +1,65 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 itemis AG (http://www.itemis.eu) and others.\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0.\n+ * \n+ * SPDX-License-Identifier: EPL-2.0\n+ *******************************************************************************/\n+package org.eclipse.xtext.ide.server.codeActions;\n+\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n+\n+import javax.inject.Inject;\n+\n+import org.eclipse.lsp4j.CodeAction;\n+import org.eclipse.lsp4j.CodeActionKind;\n+import org.eclipse.lsp4j.Command;\n+import org.eclipse.lsp4j.Diagnostic;\n+import org.eclipse.lsp4j.jsonrpc.messages.Either;\n+import org.eclipse.xtext.ide.editor.quickfix.AbstractDeclarativeIdeQuickfixProvider;\n+import org.eclipse.xtext.ide.editor.quickfix.DiagnosticResolution;\n+import org.eclipse.xtext.ide.editor.quickfix.IQuickFixProvider;\n+import org.eclipse.xtext.ide.editor.quickfix.QuickFix;\n+\n+/**\n+ * {@link ICodeActionService2} handling quick-fixes annoted with {@link CodeActionKind#QuickFix}.\n+ * \n+ * @author Heinrich Weichert\n+ * \n+ * @see AbstractDeclarativeIdeQuickfixProvider\n+ * @see QuickFix\n+ * \n+ * @since 2.24\n+ */\n+public class QuickFixCodeActionService implements ICodeActionService2 {", "originalCommit": "2e79f2903b3205fd24528e23d3c30b1ae5ddedb3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTczMDQ3MA==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r511730470", "bodyText": "unused import", "author": "cdietrich", "createdAt": "2020-10-26T05:48:03Z", "path": "org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/editor/quickfix/DiagnosticResolutionAcceptor.java", "diffHunk": "@@ -0,0 +1,46 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 TypeFox GmbH (http://www.typefox.io) and others.\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0.\n+ * \n+ * SPDX-License-Identifier: EPL-2.0\n+ *******************************************************************************/\n+package org.eclipse.xtext.ide.editor.quickfix;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import org.eclipse.emf.ecore.EObject;\n+import org.eclipse.xtext.ide.serializer.IChangeSerializer.IModification;\n+import org.eclipse.xtext.ide.server.codeActions.ICodeActionService2.Options;\n+\n+import com.google.common.collect.Lists;", "originalCommit": "2e79f2903b3205fd24528e23d3c30b1ae5ddedb3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTczMTU3NA==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r511731574", "bodyText": "Thanks. I noticed a lot of .project and .classpath files. Do you generally gitignore eclipse prefs? Can I add/enhance save actions? I'll do an organize imports over my files anyway.", "author": "imhotep82", "createdAt": "2020-10-26T05:52:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTczMDQ3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTczMTg3NA==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r511731874", "bodyText": "nope. they should be (as) checked in.\nbut as we are in transition to Java 11 such\ndiscrepancies as yours may happen unfortunately", "author": "cdietrich", "createdAt": "2020-10-26T05:53:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTczMDQ3MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTczMDcyOQ==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r511730729", "bodyText": "unused imports", "author": "cdietrich", "createdAt": "2020-10-26T05:49:04Z", "path": "org.eclipse.xtext.ide.tests/src/org/eclipse/xtext/ide/tests/server/QuickFixCodeActionServiceTest.java", "diffHunk": "@@ -0,0 +1,62 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 itemis AG (http://www.itemis.eu) and others.\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0.\n+ * \n+ * SPDX-License-Identifier: EPL-2.0\n+ *******************************************************************************/\n+package org.eclipse.xtext.ide.tests.server;\n+\n+import org.eclipse.xtext.ide.server.ServerModule;\n+import org.eclipse.xtext.ide.server.concurrent.RequestManager;\n+import org.eclipse.xtext.testing.AbstractLanguageServerTest;\n+import org.eclipse.xtext.testing.AbstractLanguageServerTest.DirectRequestManager;", "originalCommit": "2e79f2903b3205fd24528e23d3c30b1ae5ddedb3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTgwNzEyMQ==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r511807121", "bodyText": "remove finals", "author": "cdietrich", "createdAt": "2020-10-26T09:04:47Z", "path": "org.eclipse.xtext.testlanguages.ide/src/org/eclipse/xtext/testlanguages/fileAware/ide/quickfix/FileAwareTestLanguageQuickFixProvider.java", "diffHunk": "@@ -0,0 +1,28 @@\n+package org.eclipse.xtext.testlanguages.fileAware.ide.quickfix;\n+\n+import org.eclipse.xtext.ide.editor.quickfix.AbstractDeclarativeIdeQuickfixProvider;\n+import org.eclipse.xtext.ide.editor.quickfix.DiagnosticResolutionAcceptor;\n+import org.eclipse.xtext.ide.editor.quickfix.QuickFix;\n+import org.eclipse.xtext.testlanguages.fileAware.fileAware.Element;\n+import org.eclipse.xtext.testlanguages.fileAware.validation.FileAwareTestLanguageValidator;\n+import org.eclipse.xtext.xbase.lib.StringExtensions;\n+\n+public class FileAwareTestLanguageQuickFixProvider extends AbstractDeclarativeIdeQuickfixProvider {\n+\n+\tpublic static class IssueCodes {\n+\t\tprivate IssueCodes() {\n+\t\t\t// utility\n+\t\t}\n+\n+\t\tpublic static final String TESTLABEL = \"Change element name to first upper\";\n+\t}\n+\n+\t@QuickFix(FileAwareTestLanguageValidator.TESTISSUECODE)\n+\tpublic void removeUnusedVariable(final DiagnosticResolutionAcceptor acceptor) {", "originalCommit": "ab782110ea93c4f864502620c7be4839866a7fe3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTgwOTAxMA==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r511809010", "bodyText": "@cdietrich I will move this into testlang and this class will be removed. I'll check if there are any finals left, thanks.\nI already implemented the IDE bindings in QuickfixProviderFragment2, so this could be added, too, if you wanted.", "author": "imhotep82", "createdAt": "2020-10-26T09:08:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTgwNzEyMQ=="}], "type": "inlineReview"}, {"oid": "d509c04282bbf0e05784d66fa0453209580e8e8a", "url": "https://github.com/eclipse/xtext-core/commit/d509c04282bbf0e05784d66fa0453209580e8e8a", "message": "Introduce quickfix API for generic IDE module\n\nSigned-off-by: Heinrich Weichert <heinrich.weichert@avl.com>", "committedDate": "2020-10-26T14:45:34Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjAyMDA4Mg==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r512020082", "bodyText": "shouldnt the to upper case which mimics the quickfix be dropped here?", "author": "cdietrich", "createdAt": "2020-10-26T14:50:22Z", "path": "org.eclipse.xtext.ide.tests/testlang-src/org/eclipse/xtext/ide/tests/testlanguage/ide/server/CodeActionService.java", "diffHunk": "@@ -41,13 +42,13 @@\n /**\n  * @author Sven Efftinge - Initial contribution and API\n  */\n-public class CodeActionService implements ICodeActionService2 {\n+public class CodeActionService extends QuickFixCodeActionService {\n \t@Inject\n \tprivate IChangeSerializer serializer;\n \n \t@Override\n \tpublic List<Either<Command, CodeAction>> getCodeActions(ICodeActionService2.Options options) {\n-\t\tList<Either<Command, CodeAction>> actions = new ArrayList<>();\n+\t\tList<Either<Command, CodeAction>> actions = super.getCodeActions(options);", "originalCommit": "d509c04282bbf0e05784d66fa0453209580e8e8a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjAyMDU5MQ==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r512020591", "bodyText": "ahh no, that one is a command", "author": "cdietrich", "createdAt": "2020-10-26T14:50:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjAyMDA4Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjAyMjIyMg==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r512022222", "bodyText": "Do you mean the hard-coded one from before? Would be OK with me, I can adapt the test accordingly.", "author": "imhotep82", "createdAt": "2020-10-26T14:53:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjAyMDA4Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjAyMzYwOA==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r512023608", "bodyText": "both things do a to upper case.\ndo we need both.\nif i read your quickfixcode action service correct it does a code acction not a command?", "author": "cdietrich", "createdAt": "2020-10-26T14:54:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjAyMDA4Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjAyODg5Mg==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r512028892", "bodyText": "so maybe we should change it to\ncommand.setTitle(\"Make '\" + string + \"' upper case (Command)\");", "author": "cdietrich", "createdAt": "2020-10-26T15:01:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjAyMDA4Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjAzMDQ2OA==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r512030468", "bodyText": "but the impl is bogus as there is no edit command in\nTestLanguageExecutableCommandService", "author": "cdietrich", "createdAt": "2020-10-26T15:03:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjAyMDA4Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjAzMDY5NA==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r512030694", "bodyText": "=> have no idea why the current impl is as it is", "author": "cdietrich", "createdAt": "2020-10-26T15:03:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjAyMDA4Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjAzMzI5Mg==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r512033292", "bodyText": "Ok, I'll just drop the \"old\" one and use the quickfix action instead in the tests. Then we have a real implementation test.", "author": "imhotep82", "createdAt": "2020-10-26T15:06:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjAyMDA4Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjAzNzM0OQ==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r512037349", "bodyText": "i wonder if we want to have a testcase for command code action anyway thus having both would be better.\neven if its not completely implemented", "author": "cdietrich", "createdAt": "2020-10-26T15:11:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjAyMDA4Mg=="}], "type": "inlineReview"}, {"oid": "f6d7458992da1c766c2023b5463e6575646f32a1", "url": "https://github.com/eclipse/xtext-core/commit/f6d7458992da1c766c2023b5463e6575646f32a1", "message": "Introduce quickfix API for generic IDE module\n\nSigned-off-by: Heinrich Weichert <heinrich.weichert@avl.com>", "committedDate": "2020-10-26T15:12:07Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjA0MDE0NQ==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r512040145", "bodyText": "please restore. otherwise we would have code action as command untested.", "author": "cdietrich", "createdAt": "2020-10-26T15:15:26Z", "path": "org.eclipse.xtext.ide.tests/testlang-src/org/eclipse/xtext/ide/tests/testlanguage/ide/server/CodeActionService.java", "diffHunk": "@@ -41,39 +42,22 @@\n /**\n  * @author Sven Efftinge - Initial contribution and API\n  */\n-public class CodeActionService implements ICodeActionService2 {\n+public class CodeActionService extends QuickFixCodeActionService {\n \t@Inject\n \tprivate IChangeSerializer serializer;\n \n \t@Override\n \tpublic List<Either<Command, CodeAction>> getCodeActions(ICodeActionService2.Options options) {\n-\t\tList<Either<Command, CodeAction>> actions = new ArrayList<>();\n+\t\tList<Either<Command, CodeAction>> actions = super.getCodeActions(options);\n \t\tfor (Diagnostic d : options.getCodeActionParams().getContext().getDiagnostics()) {\n \t\t\tObject code = d.getCode().get();\n-\t\t\tif (TestLanguageValidator.INVALID_NAME.equals(code)) {\n-\t\t\t\tactions.add(Either.forLeft(fixInvalidName(d, options)));\n-\t\t\t} else if (TestLanguageValidator.UNSORTED_MEMBERS.equals(code)) {\n+\t\t\tif (TestLanguageValidator.UNSORTED_MEMBERS.equals(code)) {\n \t\t\t\tactions.add(Either.forRight(fixUnsortedMembers(d, options)));\n \t\t\t}\n \t\t}\n \t\treturn actions;\n \t}\n \n-\tprivate Command fixInvalidName(Diagnostic d, ICodeActionService2.Options options) {", "originalCommit": "f6d7458992da1c766c2023b5463e6575646f32a1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjA0MDgyNw==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r512040827", "bodyText": "Ok, then I'll do as you suggested", "author": "imhotep82", "createdAt": "2020-10-26T15:16:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjA0MDE0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjA0MzM2Mg==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r512043362", "bodyText": "i assume the test (framework) can handle multiple results. correct?", "author": "cdietrich", "createdAt": "2020-10-26T15:19:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjA0MDE0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjA2NDk4Nw==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r512064987", "bodyText": "yes", "author": "imhotep82", "createdAt": "2020-10-26T15:46:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjA0MDE0NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjA1MDk4NA==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r512050984", "bodyText": "i assume this class can be dropped/is redundant now?", "author": "cdietrich", "createdAt": "2020-10-26T15:29:01Z", "path": "org.eclipse.xtext.ide.tests/src/org/eclipse/xtext/ide/tests/server/QuickFixCodeActionServiceTest.java", "diffHunk": "@@ -0,0 +1,56 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 itemis AG (http://www.itemis.eu) and others.\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0.\n+ * \n+ * SPDX-License-Identifier: EPL-2.0\n+ *******************************************************************************/\n+package org.eclipse.xtext.ide.tests.server;\n+\n+import org.eclipse.xtext.ide.server.ServerModule;\n+import org.eclipse.xtext.ide.server.concurrent.RequestManager;\n+import org.eclipse.xtext.util.Modules2;\n+import org.eclipse.xtext.xbase.lib.Procedures.Procedure1;\n+import org.junit.Test;\n+\n+import com.google.inject.Module;\n+\n+/**\n+ * @author Heinrich Weichert\n+ */\n+public class QuickFixCodeActionServiceTest extends AbstractTestLangLanguageServerTest {", "originalCommit": "521cfdeffc8dbaec924e2d0a9f7f0f3e5348fb18", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjA2MTU0OA==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r512061548", "bodyText": "It basically tests the same stuff, so yes \ud83d\ude04 -> removed", "author": "imhotep82", "createdAt": "2020-10-26T15:42:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjA1MDk4NA=="}], "type": "inlineReview"}, {"oid": "72a00ca85e68d7cf9fac5c487df556d8ab1c7c3e", "url": "https://github.com/eclipse/xtext-core/commit/72a00ca85e68d7cf9fac5c487df556d8ab1c7c3e", "message": "Introduce quickfix API for generic IDE module\n\nSigned-off-by: Heinrich Weichert <heinrich.weichert@avl.com>", "committedDate": "2020-10-26T15:44:04Z", "type": "forcePushed"}, {"oid": "5e9e96a7b728557d259d1b906d2e589eadeabbe4", "url": "https://github.com/eclipse/xtext-core/commit/5e9e96a7b728557d259d1b906d2e589eadeabbe4", "message": "Introduce quickfix API for generic IDE module (beta)\n\nSigned-off-by: Heinrich Weichert <heinrich.weichert@avl.com>", "committedDate": "2020-10-26T16:01:17Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzM0MDQ0NA==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r513340444", "bodyText": "Can we agree on throwing UnsupportedOperationException in the methods that are no-ops?", "author": "szarnekow", "createdAt": "2020-10-28T10:38:24Z", "path": "org.eclipse.xtext.ide.tests/src/org/eclipse/xtext/ide/tests/editor/quickfix/AbstractIdeQuickfixTest.java", "diffHunk": "@@ -0,0 +1,220 @@\n+/**\n+ * Copyright (c) 2020 TypeFox GmbH (http://www.typefox.io) and others.\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0.\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.eclipse.xtext.ide.tests.editor.quickfix;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.concurrent.CompletableFuture;\n+import java.util.function.Function;\n+\n+import org.eclipse.emf.common.util.URI;\n+import org.eclipse.emf.ecore.EClass;\n+import org.eclipse.emf.ecore.EObject;\n+import org.eclipse.emf.ecore.resource.ResourceSet;\n+import org.eclipse.lsp4j.CodeActionContext;\n+import org.eclipse.lsp4j.CodeActionParams;\n+import org.eclipse.lsp4j.Diagnostic;\n+import org.eclipse.lsp4j.DiagnosticSeverity;\n+import org.eclipse.lsp4j.InitializeParams;\n+import org.eclipse.lsp4j.InitializeResult;\n+import org.eclipse.lsp4j.Position;\n+import org.eclipse.lsp4j.Range;\n+import org.eclipse.lsp4j.TextDocumentIdentifier;\n+import org.eclipse.lsp4j.WorkspaceEdit;\n+import org.eclipse.lsp4j.services.LanguageClient;\n+import org.eclipse.xtext.ide.editor.quickfix.DiagnosticResolution;\n+import org.eclipse.xtext.ide.editor.quickfix.IQuickFixProvider;\n+import org.eclipse.xtext.ide.server.Document;\n+import org.eclipse.xtext.ide.server.ILanguageServerAccess;\n+import org.eclipse.xtext.ide.server.codeActions.ICodeActionService2;\n+import org.eclipse.xtext.nodemodel.ICompositeNode;\n+import org.eclipse.xtext.nodemodel.util.NodeModelUtils;\n+import org.eclipse.xtext.resource.FileExtensionProvider;\n+import org.eclipse.xtext.resource.XtextResource;\n+import org.eclipse.xtext.resource.impl.ChunkedResourceDescriptions;\n+import org.eclipse.xtext.resource.impl.ResourceDescriptionsData;\n+import org.eclipse.xtext.testing.util.InMemoryURIHandler;\n+import org.eclipse.xtext.util.CancelIndicator;\n+import org.eclipse.xtext.util.LineAndColumn;\n+import org.eclipse.xtext.util.Strings;\n+import org.eclipse.xtext.xbase.lib.IterableExtensions;\n+import org.eclipse.xtext.xbase.lib.Pair;\n+import org.junit.Assert;\n+\n+import com.google.inject.Inject;\n+\n+/**\n+ * @author Heinrich Weichert\n+ * \n+ * @since 2.24\n+ */\n+public abstract class AbstractIdeQuickfixTest {\n+\n+\tprotected static class Quickfix {\n+\t\tprivate String label;\n+\t\tprivate String description;\n+\t\tprivate String result;\n+\n+\t\tpublic Quickfix(String label, String description, String result) {\n+\t\t\tthis.label = label;\n+\t\t\tthis.description = description;\n+\t\t\tthis.result = result;\n+\t\t}\n+\n+\t\tpublic String getLabel() {\n+\t\t\treturn label;\n+\t\t}\n+\n+\t\tpublic String getDescription() {\n+\t\t\treturn description;\n+\t\t}\n+\n+\t\tpublic String getResult() {\n+\t\t\treturn result;\n+\t\t}\n+\t}\n+\n+\t@Inject\n+\tprivate IQuickFixProvider quickFixProvider;\n+\t@Inject\n+\tprivate QuickFixTestHelper quickFixTestHelper;\n+\t@Inject\n+\tprivate FileExtensionProvider fileExtensionProvider;\n+\n+\t/**\n+\t * Test that the expected quickfixes are offered on a given validation issue in a given DSL text.\n+\t *\n+\t * @param fileContents\n+\t *            The initial DSL text.\n+\t * @param issueCode\n+\t *            The code of the validation issue the offered quickfixes to test.\n+\t * @param quickfixes\n+\t *            The quickfixes that are expected to be offered on the given <code>issueCode</code>. Each expected quickfix should be described by the\n+\t *            following triple:\n+\t *            <ol>\n+\t *            <li>the quickfix label</li>\n+\t *            <li>the quickfix description</li>\n+\t *            <li>the DSL text after the quickfix application</li>\n+\t *            </ol>\n+\t */\n+\tpublic void testQuickfixesOn(String fileContents, String issueCode, EClass type, AbstractIdeQuickfixTest.Quickfix... quickfixes) {\n+\t\tquickfixesAreOffered(createInMemoryFile(fileContents, type), issueCode, fileContents, quickfixes);\n+\t}\n+\n+\t@SuppressWarnings(\"unchecked\")\n+\tprivate <T> T createInMemoryFile(CharSequence content, EClass type) {\n+\t\tInMemoryURIHandler fs = new InMemoryURIHandler();\n+\t\tString fileName = \"inmemory:/file1.\" + fileExtensionProvider.getPrimaryFileExtension();\n+\t\tPair<String, String> _mappedTo = Pair.of(fileName, content.toString());\n+\t\tthis.quickFixTestHelper.operator_add(fs, _mappedTo);\n+\t\tResourceSet rs = this.quickFixTestHelper.createResourceSet(fs);\n+\t\tMap<String, ResourceDescriptionsData> dataMap = new HashMap<>();\n+\t\tdataMap.put(\"project\", ResourceDescriptionsData.ResourceSetAdapter.findResourceDescriptionsData(rs));\n+\t\tnew ChunkedResourceDescriptions(dataMap, rs);\n+\t\treturn (T) this.quickFixTestHelper.contents(rs, fileName, type.getInstanceClass());\n+\t}\n+\n+\tprivate void quickfixesAreOffered(EObject target, String issueCode, String originalText,\n+\t\t\tAbstractIdeQuickfixTest.Quickfix... expected) {\n+\t\tList<AbstractIdeQuickfixTest.Quickfix> expectedSorted = IterableExtensions.sortBy(Arrays.asList(expected), it -> it.label);\n+\t\tICompositeNode elementNode = NodeModelUtils.getNode(target);\n+\t\tLineAndColumn elementStartPosition = NodeModelUtils.getLineAndColumn(elementNode, elementNode.getOffset());\n+\t\tLineAndColumn elementEndPosition = NodeModelUtils.getLineAndColumn(elementNode, elementNode.getEndOffset());\n+\t\tPosition startPos = new Position(elementStartPosition.getLine() - 1, elementStartPosition.getColumn() - 1);\n+\t\tPosition endPos = new Position(elementEndPosition.getLine() - 1, elementEndPosition.getColumn() - 1);\n+\t\tDiagnostic issue = new Diagnostic();\n+\t\tissue.setCode(issueCode);\n+\t\tissue.setMessage(\"error\");\n+\t\tissue.setSeverity(DiagnosticSeverity.Error);\n+\t\tissue.setSource(\"source\");\n+\t\tissue.setRange(new Range(startPos, endPos));\n+\n+\t\tICodeActionService2.Options options = new ICodeActionService2.Options();\n+\t\toptions.setCancelIndicator(CancelIndicator.NullImpl);\n+\t\toptions.setDocument(new Document(Integer.valueOf(0), Strings.toUnixLineSeparator(originalText)));\n+\t\toptions.setResource((XtextResource) target.eResource());\n+\t\toptions.setLanguageServerAccess(new ILanguageServerAccess() {\n+\t\t\t@Override\n+\t\t\tpublic void addBuildListener(ILanguageServerAccess.IBuildListener listener) {\n+\t\t\t\t//", "originalCommit": "5e9e96a7b728557d259d1b906d2e589eadeabbe4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzM1NTQ0Mw==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r513355443", "bodyText": "it might be called.but we dont seem to care here", "author": "cdietrich", "createdAt": "2020-10-28T11:03:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzM0MDQ0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ4MTI5Ng==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r513481296", "bodyText": "Added the throw", "author": "imhotep82", "createdAt": "2020-10-28T14:19:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzM0MDQ0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzM0MTEyMw==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r513341123", "bodyText": "Hmm this mock im looks far too much like a mock to me. Please add a comment why newLiveScopeResourceSet does not create a new resource set.", "author": "szarnekow", "createdAt": "2020-10-28T10:39:29Z", "path": "org.eclipse.xtext.ide.tests/src/org/eclipse/xtext/ide/tests/editor/quickfix/AbstractIdeQuickfixTest.java", "diffHunk": "@@ -0,0 +1,220 @@\n+/**\n+ * Copyright (c) 2020 TypeFox GmbH (http://www.typefox.io) and others.\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0.\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.eclipse.xtext.ide.tests.editor.quickfix;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.concurrent.CompletableFuture;\n+import java.util.function.Function;\n+\n+import org.eclipse.emf.common.util.URI;\n+import org.eclipse.emf.ecore.EClass;\n+import org.eclipse.emf.ecore.EObject;\n+import org.eclipse.emf.ecore.resource.ResourceSet;\n+import org.eclipse.lsp4j.CodeActionContext;\n+import org.eclipse.lsp4j.CodeActionParams;\n+import org.eclipse.lsp4j.Diagnostic;\n+import org.eclipse.lsp4j.DiagnosticSeverity;\n+import org.eclipse.lsp4j.InitializeParams;\n+import org.eclipse.lsp4j.InitializeResult;\n+import org.eclipse.lsp4j.Position;\n+import org.eclipse.lsp4j.Range;\n+import org.eclipse.lsp4j.TextDocumentIdentifier;\n+import org.eclipse.lsp4j.WorkspaceEdit;\n+import org.eclipse.lsp4j.services.LanguageClient;\n+import org.eclipse.xtext.ide.editor.quickfix.DiagnosticResolution;\n+import org.eclipse.xtext.ide.editor.quickfix.IQuickFixProvider;\n+import org.eclipse.xtext.ide.server.Document;\n+import org.eclipse.xtext.ide.server.ILanguageServerAccess;\n+import org.eclipse.xtext.ide.server.codeActions.ICodeActionService2;\n+import org.eclipse.xtext.nodemodel.ICompositeNode;\n+import org.eclipse.xtext.nodemodel.util.NodeModelUtils;\n+import org.eclipse.xtext.resource.FileExtensionProvider;\n+import org.eclipse.xtext.resource.XtextResource;\n+import org.eclipse.xtext.resource.impl.ChunkedResourceDescriptions;\n+import org.eclipse.xtext.resource.impl.ResourceDescriptionsData;\n+import org.eclipse.xtext.testing.util.InMemoryURIHandler;\n+import org.eclipse.xtext.util.CancelIndicator;\n+import org.eclipse.xtext.util.LineAndColumn;\n+import org.eclipse.xtext.util.Strings;\n+import org.eclipse.xtext.xbase.lib.IterableExtensions;\n+import org.eclipse.xtext.xbase.lib.Pair;\n+import org.junit.Assert;\n+\n+import com.google.inject.Inject;\n+\n+/**\n+ * @author Heinrich Weichert\n+ * \n+ * @since 2.24\n+ */\n+public abstract class AbstractIdeQuickfixTest {\n+\n+\tprotected static class Quickfix {\n+\t\tprivate String label;\n+\t\tprivate String description;\n+\t\tprivate String result;\n+\n+\t\tpublic Quickfix(String label, String description, String result) {\n+\t\t\tthis.label = label;\n+\t\t\tthis.description = description;\n+\t\t\tthis.result = result;\n+\t\t}\n+\n+\t\tpublic String getLabel() {\n+\t\t\treturn label;\n+\t\t}\n+\n+\t\tpublic String getDescription() {\n+\t\t\treturn description;\n+\t\t}\n+\n+\t\tpublic String getResult() {\n+\t\t\treturn result;\n+\t\t}\n+\t}\n+\n+\t@Inject\n+\tprivate IQuickFixProvider quickFixProvider;\n+\t@Inject\n+\tprivate QuickFixTestHelper quickFixTestHelper;\n+\t@Inject\n+\tprivate FileExtensionProvider fileExtensionProvider;\n+\n+\t/**\n+\t * Test that the expected quickfixes are offered on a given validation issue in a given DSL text.\n+\t *\n+\t * @param fileContents\n+\t *            The initial DSL text.\n+\t * @param issueCode\n+\t *            The code of the validation issue the offered quickfixes to test.\n+\t * @param quickfixes\n+\t *            The quickfixes that are expected to be offered on the given <code>issueCode</code>. Each expected quickfix should be described by the\n+\t *            following triple:\n+\t *            <ol>\n+\t *            <li>the quickfix label</li>\n+\t *            <li>the quickfix description</li>\n+\t *            <li>the DSL text after the quickfix application</li>\n+\t *            </ol>\n+\t */\n+\tpublic void testQuickfixesOn(String fileContents, String issueCode, EClass type, AbstractIdeQuickfixTest.Quickfix... quickfixes) {\n+\t\tquickfixesAreOffered(createInMemoryFile(fileContents, type), issueCode, fileContents, quickfixes);\n+\t}\n+\n+\t@SuppressWarnings(\"unchecked\")\n+\tprivate <T> T createInMemoryFile(CharSequence content, EClass type) {\n+\t\tInMemoryURIHandler fs = new InMemoryURIHandler();\n+\t\tString fileName = \"inmemory:/file1.\" + fileExtensionProvider.getPrimaryFileExtension();\n+\t\tPair<String, String> _mappedTo = Pair.of(fileName, content.toString());\n+\t\tthis.quickFixTestHelper.operator_add(fs, _mappedTo);\n+\t\tResourceSet rs = this.quickFixTestHelper.createResourceSet(fs);\n+\t\tMap<String, ResourceDescriptionsData> dataMap = new HashMap<>();\n+\t\tdataMap.put(\"project\", ResourceDescriptionsData.ResourceSetAdapter.findResourceDescriptionsData(rs));\n+\t\tnew ChunkedResourceDescriptions(dataMap, rs);\n+\t\treturn (T) this.quickFixTestHelper.contents(rs, fileName, type.getInstanceClass());\n+\t}\n+\n+\tprivate void quickfixesAreOffered(EObject target, String issueCode, String originalText,\n+\t\t\tAbstractIdeQuickfixTest.Quickfix... expected) {\n+\t\tList<AbstractIdeQuickfixTest.Quickfix> expectedSorted = IterableExtensions.sortBy(Arrays.asList(expected), it -> it.label);\n+\t\tICompositeNode elementNode = NodeModelUtils.getNode(target);\n+\t\tLineAndColumn elementStartPosition = NodeModelUtils.getLineAndColumn(elementNode, elementNode.getOffset());\n+\t\tLineAndColumn elementEndPosition = NodeModelUtils.getLineAndColumn(elementNode, elementNode.getEndOffset());\n+\t\tPosition startPos = new Position(elementStartPosition.getLine() - 1, elementStartPosition.getColumn() - 1);\n+\t\tPosition endPos = new Position(elementEndPosition.getLine() - 1, elementEndPosition.getColumn() - 1);\n+\t\tDiagnostic issue = new Diagnostic();\n+\t\tissue.setCode(issueCode);\n+\t\tissue.setMessage(\"error\");\n+\t\tissue.setSeverity(DiagnosticSeverity.Error);\n+\t\tissue.setSource(\"source\");\n+\t\tissue.setRange(new Range(startPos, endPos));\n+\n+\t\tICodeActionService2.Options options = new ICodeActionService2.Options();\n+\t\toptions.setCancelIndicator(CancelIndicator.NullImpl);\n+\t\toptions.setDocument(new Document(Integer.valueOf(0), Strings.toUnixLineSeparator(originalText)));\n+\t\toptions.setResource((XtextResource) target.eResource());\n+\t\toptions.setLanguageServerAccess(new ILanguageServerAccess() {\n+\t\t\t@Override\n+\t\t\tpublic void addBuildListener(ILanguageServerAccess.IBuildListener listener) {\n+\t\t\t\t//\n+\t\t\t}\n+\n+\t\t\t@Override\n+\t\t\tpublic <T extends Object> CompletableFuture<T> doRead(String uri, Function<ILanguageServerAccess.Context, T> function) {\n+\t\t\t\tXtextResource _resource = options.getResource();\n+\t\t\t\tDocument _document = options.getDocument();\n+\t\t\t\tILanguageServerAccess.Context ctx = new ILanguageServerAccess.Context(_resource, _document,\n+\t\t\t\t\t\ttrue, CancelIndicator.NullImpl);\n+\t\t\t\treturn CompletableFuture.<T> completedFuture(function.apply(ctx));\n+\t\t\t}\n+\n+\t\t\t@Override\n+\t\t\tpublic <T extends Object> CompletableFuture<T> doReadIndex(Function<? super ILanguageServerAccess.IndexContext, ? extends T> function) {\n+\t\t\t\treturn null;\n+\t\t\t}\n+\n+\t\t\t@Override\n+\t\t\tpublic InitializeParams getInitializeParams() {\n+\t\t\t\treturn null;\n+\t\t\t}\n+\n+\t\t\t@Override\n+\t\t\tpublic InitializeResult getInitializeResult() {\n+\t\t\t\treturn null;\n+\t\t\t}\n+\n+\t\t\t@Override\n+\t\t\tpublic LanguageClient getLanguageClient() {\n+\t\t\t\treturn null;\n+\t\t\t}\n+\n+\t\t\t@Override\n+\t\t\tpublic ResourceSet newLiveScopeResourceSet(URI uri) {\n+\t\t\t\tResourceSet resourceSet = options.getResource().getResourceSet();", "originalCommit": "5e9e96a7b728557d259d1b906d2e589eadeabbe4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ2MjY0OA==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r513462648", "bodyText": "//re-using the existing ResourceSet because it contains the URI protocol mapping for \"inmemory\" resources. perhaps?", "author": "imhotep82", "createdAt": "2020-10-28T13:55:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzM0MTEyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ5NDQ0Ng==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r513494446", "bodyText": "\ud83d\udc4d", "author": "szarnekow", "createdAt": "2020-10-28T14:35:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzM0MTEyMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzM0MTgxNQ==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r513341815", "bodyText": "Nit: This line deserves a formatter to add spaces.", "author": "szarnekow", "createdAt": "2020-10-28T10:40:36Z", "path": "org.eclipse.xtext.ide.tests/src/org/eclipse/xtext/ide/tests/editor/quickfix/AbstractIdeQuickfixTest.java", "diffHunk": "@@ -0,0 +1,220 @@\n+/**\n+ * Copyright (c) 2020 TypeFox GmbH (http://www.typefox.io) and others.\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0.\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.eclipse.xtext.ide.tests.editor.quickfix;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.concurrent.CompletableFuture;\n+import java.util.function.Function;\n+\n+import org.eclipse.emf.common.util.URI;\n+import org.eclipse.emf.ecore.EClass;\n+import org.eclipse.emf.ecore.EObject;\n+import org.eclipse.emf.ecore.resource.ResourceSet;\n+import org.eclipse.lsp4j.CodeActionContext;\n+import org.eclipse.lsp4j.CodeActionParams;\n+import org.eclipse.lsp4j.Diagnostic;\n+import org.eclipse.lsp4j.DiagnosticSeverity;\n+import org.eclipse.lsp4j.InitializeParams;\n+import org.eclipse.lsp4j.InitializeResult;\n+import org.eclipse.lsp4j.Position;\n+import org.eclipse.lsp4j.Range;\n+import org.eclipse.lsp4j.TextDocumentIdentifier;\n+import org.eclipse.lsp4j.WorkspaceEdit;\n+import org.eclipse.lsp4j.services.LanguageClient;\n+import org.eclipse.xtext.ide.editor.quickfix.DiagnosticResolution;\n+import org.eclipse.xtext.ide.editor.quickfix.IQuickFixProvider;\n+import org.eclipse.xtext.ide.server.Document;\n+import org.eclipse.xtext.ide.server.ILanguageServerAccess;\n+import org.eclipse.xtext.ide.server.codeActions.ICodeActionService2;\n+import org.eclipse.xtext.nodemodel.ICompositeNode;\n+import org.eclipse.xtext.nodemodel.util.NodeModelUtils;\n+import org.eclipse.xtext.resource.FileExtensionProvider;\n+import org.eclipse.xtext.resource.XtextResource;\n+import org.eclipse.xtext.resource.impl.ChunkedResourceDescriptions;\n+import org.eclipse.xtext.resource.impl.ResourceDescriptionsData;\n+import org.eclipse.xtext.testing.util.InMemoryURIHandler;\n+import org.eclipse.xtext.util.CancelIndicator;\n+import org.eclipse.xtext.util.LineAndColumn;\n+import org.eclipse.xtext.util.Strings;\n+import org.eclipse.xtext.xbase.lib.IterableExtensions;\n+import org.eclipse.xtext.xbase.lib.Pair;\n+import org.junit.Assert;\n+\n+import com.google.inject.Inject;\n+\n+/**\n+ * @author Heinrich Weichert\n+ * \n+ * @since 2.24\n+ */\n+public abstract class AbstractIdeQuickfixTest {\n+\n+\tprotected static class Quickfix {\n+\t\tprivate String label;\n+\t\tprivate String description;\n+\t\tprivate String result;\n+\n+\t\tpublic Quickfix(String label, String description, String result) {\n+\t\t\tthis.label = label;\n+\t\t\tthis.description = description;\n+\t\t\tthis.result = result;\n+\t\t}\n+\n+\t\tpublic String getLabel() {\n+\t\t\treturn label;\n+\t\t}\n+\n+\t\tpublic String getDescription() {\n+\t\t\treturn description;\n+\t\t}\n+\n+\t\tpublic String getResult() {\n+\t\t\treturn result;\n+\t\t}\n+\t}\n+\n+\t@Inject\n+\tprivate IQuickFixProvider quickFixProvider;\n+\t@Inject\n+\tprivate QuickFixTestHelper quickFixTestHelper;\n+\t@Inject\n+\tprivate FileExtensionProvider fileExtensionProvider;\n+\n+\t/**\n+\t * Test that the expected quickfixes are offered on a given validation issue in a given DSL text.\n+\t *\n+\t * @param fileContents\n+\t *            The initial DSL text.\n+\t * @param issueCode\n+\t *            The code of the validation issue the offered quickfixes to test.\n+\t * @param quickfixes\n+\t *            The quickfixes that are expected to be offered on the given <code>issueCode</code>. Each expected quickfix should be described by the\n+\t *            following triple:\n+\t *            <ol>\n+\t *            <li>the quickfix label</li>\n+\t *            <li>the quickfix description</li>\n+\t *            <li>the DSL text after the quickfix application</li>\n+\t *            </ol>\n+\t */\n+\tpublic void testQuickfixesOn(String fileContents, String issueCode, EClass type, AbstractIdeQuickfixTest.Quickfix... quickfixes) {\n+\t\tquickfixesAreOffered(createInMemoryFile(fileContents, type), issueCode, fileContents, quickfixes);\n+\t}\n+\n+\t@SuppressWarnings(\"unchecked\")\n+\tprivate <T> T createInMemoryFile(CharSequence content, EClass type) {\n+\t\tInMemoryURIHandler fs = new InMemoryURIHandler();\n+\t\tString fileName = \"inmemory:/file1.\" + fileExtensionProvider.getPrimaryFileExtension();\n+\t\tPair<String, String> _mappedTo = Pair.of(fileName, content.toString());\n+\t\tthis.quickFixTestHelper.operator_add(fs, _mappedTo);\n+\t\tResourceSet rs = this.quickFixTestHelper.createResourceSet(fs);\n+\t\tMap<String, ResourceDescriptionsData> dataMap = new HashMap<>();\n+\t\tdataMap.put(\"project\", ResourceDescriptionsData.ResourceSetAdapter.findResourceDescriptionsData(rs));\n+\t\tnew ChunkedResourceDescriptions(dataMap, rs);\n+\t\treturn (T) this.quickFixTestHelper.contents(rs, fileName, type.getInstanceClass());\n+\t}\n+\n+\tprivate void quickfixesAreOffered(EObject target, String issueCode, String originalText,\n+\t\t\tAbstractIdeQuickfixTest.Quickfix... expected) {\n+\t\tList<AbstractIdeQuickfixTest.Quickfix> expectedSorted = IterableExtensions.sortBy(Arrays.asList(expected), it -> it.label);\n+\t\tICompositeNode elementNode = NodeModelUtils.getNode(target);\n+\t\tLineAndColumn elementStartPosition = NodeModelUtils.getLineAndColumn(elementNode, elementNode.getOffset());\n+\t\tLineAndColumn elementEndPosition = NodeModelUtils.getLineAndColumn(elementNode, elementNode.getEndOffset());\n+\t\tPosition startPos = new Position(elementStartPosition.getLine() - 1, elementStartPosition.getColumn() - 1);\n+\t\tPosition endPos = new Position(elementEndPosition.getLine() - 1, elementEndPosition.getColumn() - 1);\n+\t\tDiagnostic issue = new Diagnostic();\n+\t\tissue.setCode(issueCode);\n+\t\tissue.setMessage(\"error\");\n+\t\tissue.setSeverity(DiagnosticSeverity.Error);\n+\t\tissue.setSource(\"source\");\n+\t\tissue.setRange(new Range(startPos, endPos));\n+\n+\t\tICodeActionService2.Options options = new ICodeActionService2.Options();\n+\t\toptions.setCancelIndicator(CancelIndicator.NullImpl);\n+\t\toptions.setDocument(new Document(Integer.valueOf(0), Strings.toUnixLineSeparator(originalText)));\n+\t\toptions.setResource((XtextResource) target.eResource());\n+\t\toptions.setLanguageServerAccess(new ILanguageServerAccess() {\n+\t\t\t@Override\n+\t\t\tpublic void addBuildListener(ILanguageServerAccess.IBuildListener listener) {\n+\t\t\t\t//\n+\t\t\t}\n+\n+\t\t\t@Override\n+\t\t\tpublic <T extends Object> CompletableFuture<T> doRead(String uri, Function<ILanguageServerAccess.Context, T> function) {\n+\t\t\t\tXtextResource _resource = options.getResource();\n+\t\t\t\tDocument _document = options.getDocument();\n+\t\t\t\tILanguageServerAccess.Context ctx = new ILanguageServerAccess.Context(_resource, _document,\n+\t\t\t\t\t\ttrue, CancelIndicator.NullImpl);\n+\t\t\t\treturn CompletableFuture.<T> completedFuture(function.apply(ctx));\n+\t\t\t}\n+\n+\t\t\t@Override\n+\t\t\tpublic <T extends Object> CompletableFuture<T> doReadIndex(Function<? super ILanguageServerAccess.IndexContext, ? extends T> function) {\n+\t\t\t\treturn null;\n+\t\t\t}\n+\n+\t\t\t@Override\n+\t\t\tpublic InitializeParams getInitializeParams() {\n+\t\t\t\treturn null;\n+\t\t\t}\n+\n+\t\t\t@Override\n+\t\t\tpublic InitializeResult getInitializeResult() {\n+\t\t\t\treturn null;\n+\t\t\t}\n+\n+\t\t\t@Override\n+\t\t\tpublic LanguageClient getLanguageClient() {\n+\t\t\t\treturn null;\n+\t\t\t}\n+\n+\t\t\t@Override\n+\t\t\tpublic ResourceSet newLiveScopeResourceSet(URI uri) {\n+\t\t\t\tResourceSet resourceSet = options.getResource().getResourceSet();\n+\t\t\t\treturn resourceSet;\n+\t\t\t}\n+\t\t});\n+\t\tCodeActionParams codeActionParams = new CodeActionParams();\n+\t\tcodeActionParams.setRange(new Range(startPos, endPos));\n+\t\tcodeActionParams.setTextDocument(new TextDocumentIdentifier(target.eResource().getURI().toString()));\n+\t\n+\t\tCodeActionContext codeActionContext = new CodeActionContext();\n+\t\tcodeActionContext.setDiagnostics(Collections.singletonList(issue));\n+\t\tcodeActionParams.setContext(codeActionContext);\n+\t\n+\t\toptions.setCodeActionParams(codeActionParams);\n+\t\t\n+\t\tList<DiagnosticResolution> actualIssueResolutions = IterableExtensions.sortBy(this.quickFixProvider.getResolutions(options, issue),\n+\t\t\t\tDiagnosticResolution::getLabel);\n+\t\tAssert.assertEquals(\"The number of quickfixes does not match!\", expectedSorted.size(),\n+\t\t\t\tactualIssueResolutions.size());\n+\n+\t\tfor (int i=0;i<actualIssueResolutions.size();i++) {", "originalCommit": "5e9e96a7b728557d259d1b906d2e589eadeabbe4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzM0MjMzOQ==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r513342339", "bodyText": "Should we also normalize the fileContents to unix line endings?", "author": "szarnekow", "createdAt": "2020-10-28T10:41:28Z", "path": "org.eclipse.xtext.ide.tests/src/org/eclipse/xtext/ide/tests/editor/quickfix/AbstractIdeQuickfixTest.java", "diffHunk": "@@ -0,0 +1,220 @@\n+/**\n+ * Copyright (c) 2020 TypeFox GmbH (http://www.typefox.io) and others.\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0.\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.eclipse.xtext.ide.tests.editor.quickfix;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.concurrent.CompletableFuture;\n+import java.util.function.Function;\n+\n+import org.eclipse.emf.common.util.URI;\n+import org.eclipse.emf.ecore.EClass;\n+import org.eclipse.emf.ecore.EObject;\n+import org.eclipse.emf.ecore.resource.ResourceSet;\n+import org.eclipse.lsp4j.CodeActionContext;\n+import org.eclipse.lsp4j.CodeActionParams;\n+import org.eclipse.lsp4j.Diagnostic;\n+import org.eclipse.lsp4j.DiagnosticSeverity;\n+import org.eclipse.lsp4j.InitializeParams;\n+import org.eclipse.lsp4j.InitializeResult;\n+import org.eclipse.lsp4j.Position;\n+import org.eclipse.lsp4j.Range;\n+import org.eclipse.lsp4j.TextDocumentIdentifier;\n+import org.eclipse.lsp4j.WorkspaceEdit;\n+import org.eclipse.lsp4j.services.LanguageClient;\n+import org.eclipse.xtext.ide.editor.quickfix.DiagnosticResolution;\n+import org.eclipse.xtext.ide.editor.quickfix.IQuickFixProvider;\n+import org.eclipse.xtext.ide.server.Document;\n+import org.eclipse.xtext.ide.server.ILanguageServerAccess;\n+import org.eclipse.xtext.ide.server.codeActions.ICodeActionService2;\n+import org.eclipse.xtext.nodemodel.ICompositeNode;\n+import org.eclipse.xtext.nodemodel.util.NodeModelUtils;\n+import org.eclipse.xtext.resource.FileExtensionProvider;\n+import org.eclipse.xtext.resource.XtextResource;\n+import org.eclipse.xtext.resource.impl.ChunkedResourceDescriptions;\n+import org.eclipse.xtext.resource.impl.ResourceDescriptionsData;\n+import org.eclipse.xtext.testing.util.InMemoryURIHandler;\n+import org.eclipse.xtext.util.CancelIndicator;\n+import org.eclipse.xtext.util.LineAndColumn;\n+import org.eclipse.xtext.util.Strings;\n+import org.eclipse.xtext.xbase.lib.IterableExtensions;\n+import org.eclipse.xtext.xbase.lib.Pair;\n+import org.junit.Assert;\n+\n+import com.google.inject.Inject;\n+\n+/**\n+ * @author Heinrich Weichert\n+ * \n+ * @since 2.24\n+ */\n+public abstract class AbstractIdeQuickfixTest {\n+\n+\tprotected static class Quickfix {\n+\t\tprivate String label;\n+\t\tprivate String description;\n+\t\tprivate String result;\n+\n+\t\tpublic Quickfix(String label, String description, String result) {\n+\t\t\tthis.label = label;\n+\t\t\tthis.description = description;\n+\t\t\tthis.result = result;\n+\t\t}\n+\n+\t\tpublic String getLabel() {\n+\t\t\treturn label;\n+\t\t}\n+\n+\t\tpublic String getDescription() {\n+\t\t\treturn description;\n+\t\t}\n+\n+\t\tpublic String getResult() {\n+\t\t\treturn result;\n+\t\t}\n+\t}\n+\n+\t@Inject\n+\tprivate IQuickFixProvider quickFixProvider;\n+\t@Inject\n+\tprivate QuickFixTestHelper quickFixTestHelper;\n+\t@Inject\n+\tprivate FileExtensionProvider fileExtensionProvider;\n+\n+\t/**\n+\t * Test that the expected quickfixes are offered on a given validation issue in a given DSL text.\n+\t *\n+\t * @param fileContents\n+\t *            The initial DSL text.\n+\t * @param issueCode\n+\t *            The code of the validation issue the offered quickfixes to test.\n+\t * @param quickfixes\n+\t *            The quickfixes that are expected to be offered on the given <code>issueCode</code>. Each expected quickfix should be described by the\n+\t *            following triple:\n+\t *            <ol>\n+\t *            <li>the quickfix label</li>\n+\t *            <li>the quickfix description</li>\n+\t *            <li>the DSL text after the quickfix application</li>\n+\t *            </ol>\n+\t */\n+\tpublic void testQuickfixesOn(String fileContents, String issueCode, EClass type, AbstractIdeQuickfixTest.Quickfix... quickfixes) {\n+\t\tquickfixesAreOffered(createInMemoryFile(fileContents, type), issueCode, fileContents, quickfixes);", "originalCommit": "5e9e96a7b728557d259d1b906d2e589eadeabbe4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ2MDI3NQ==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r513460275", "bodyText": "I'll do that here, pack it into a variable and pass it to the in-mem resource and method", "author": "imhotep82", "createdAt": "2020-10-28T13:52:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzM0MjMzOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzM0MzMxMQ==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r513343311", "bodyText": "The code looks still to much like the Xtend-generated Java. Please do some more cleanup, e.g. Quickfix instead of AbstractIdeQuickfixTest.Quickfix", "author": "szarnekow", "createdAt": "2020-10-28T10:43:07Z", "path": "org.eclipse.xtext.ide.tests/src/org/eclipse/xtext/ide/tests/editor/quickfix/AbstractIdeQuickfixTest.java", "diffHunk": "@@ -0,0 +1,220 @@\n+/**\n+ * Copyright (c) 2020 TypeFox GmbH (http://www.typefox.io) and others.\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0.\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.eclipse.xtext.ide.tests.editor.quickfix;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.concurrent.CompletableFuture;\n+import java.util.function.Function;\n+\n+import org.eclipse.emf.common.util.URI;\n+import org.eclipse.emf.ecore.EClass;\n+import org.eclipse.emf.ecore.EObject;\n+import org.eclipse.emf.ecore.resource.ResourceSet;\n+import org.eclipse.lsp4j.CodeActionContext;\n+import org.eclipse.lsp4j.CodeActionParams;\n+import org.eclipse.lsp4j.Diagnostic;\n+import org.eclipse.lsp4j.DiagnosticSeverity;\n+import org.eclipse.lsp4j.InitializeParams;\n+import org.eclipse.lsp4j.InitializeResult;\n+import org.eclipse.lsp4j.Position;\n+import org.eclipse.lsp4j.Range;\n+import org.eclipse.lsp4j.TextDocumentIdentifier;\n+import org.eclipse.lsp4j.WorkspaceEdit;\n+import org.eclipse.lsp4j.services.LanguageClient;\n+import org.eclipse.xtext.ide.editor.quickfix.DiagnosticResolution;\n+import org.eclipse.xtext.ide.editor.quickfix.IQuickFixProvider;\n+import org.eclipse.xtext.ide.server.Document;\n+import org.eclipse.xtext.ide.server.ILanguageServerAccess;\n+import org.eclipse.xtext.ide.server.codeActions.ICodeActionService2;\n+import org.eclipse.xtext.nodemodel.ICompositeNode;\n+import org.eclipse.xtext.nodemodel.util.NodeModelUtils;\n+import org.eclipse.xtext.resource.FileExtensionProvider;\n+import org.eclipse.xtext.resource.XtextResource;\n+import org.eclipse.xtext.resource.impl.ChunkedResourceDescriptions;\n+import org.eclipse.xtext.resource.impl.ResourceDescriptionsData;\n+import org.eclipse.xtext.testing.util.InMemoryURIHandler;\n+import org.eclipse.xtext.util.CancelIndicator;\n+import org.eclipse.xtext.util.LineAndColumn;\n+import org.eclipse.xtext.util.Strings;\n+import org.eclipse.xtext.xbase.lib.IterableExtensions;\n+import org.eclipse.xtext.xbase.lib.Pair;\n+import org.junit.Assert;\n+\n+import com.google.inject.Inject;\n+\n+/**\n+ * @author Heinrich Weichert\n+ * \n+ * @since 2.24\n+ */\n+public abstract class AbstractIdeQuickfixTest {\n+\n+\tprotected static class Quickfix {\n+\t\tprivate String label;\n+\t\tprivate String description;\n+\t\tprivate String result;\n+\n+\t\tpublic Quickfix(String label, String description, String result) {\n+\t\t\tthis.label = label;\n+\t\t\tthis.description = description;\n+\t\t\tthis.result = result;\n+\t\t}\n+\n+\t\tpublic String getLabel() {\n+\t\t\treturn label;\n+\t\t}\n+\n+\t\tpublic String getDescription() {\n+\t\t\treturn description;\n+\t\t}\n+\n+\t\tpublic String getResult() {\n+\t\t\treturn result;\n+\t\t}\n+\t}\n+\n+\t@Inject\n+\tprivate IQuickFixProvider quickFixProvider;\n+\t@Inject\n+\tprivate QuickFixTestHelper quickFixTestHelper;\n+\t@Inject\n+\tprivate FileExtensionProvider fileExtensionProvider;\n+\n+\t/**\n+\t * Test that the expected quickfixes are offered on a given validation issue in a given DSL text.\n+\t *\n+\t * @param fileContents\n+\t *            The initial DSL text.\n+\t * @param issueCode\n+\t *            The code of the validation issue the offered quickfixes to test.\n+\t * @param quickfixes\n+\t *            The quickfixes that are expected to be offered on the given <code>issueCode</code>. Each expected quickfix should be described by the\n+\t *            following triple:\n+\t *            <ol>\n+\t *            <li>the quickfix label</li>\n+\t *            <li>the quickfix description</li>\n+\t *            <li>the DSL text after the quickfix application</li>\n+\t *            </ol>\n+\t */\n+\tpublic void testQuickfixesOn(String fileContents, String issueCode, EClass type, AbstractIdeQuickfixTest.Quickfix... quickfixes) {\n+\t\tquickfixesAreOffered(createInMemoryFile(fileContents, type), issueCode, fileContents, quickfixes);\n+\t}\n+\n+\t@SuppressWarnings(\"unchecked\")\n+\tprivate <T> T createInMemoryFile(CharSequence content, EClass type) {\n+\t\tInMemoryURIHandler fs = new InMemoryURIHandler();\n+\t\tString fileName = \"inmemory:/file1.\" + fileExtensionProvider.getPrimaryFileExtension();\n+\t\tPair<String, String> _mappedTo = Pair.of(fileName, content.toString());\n+\t\tthis.quickFixTestHelper.operator_add(fs, _mappedTo);\n+\t\tResourceSet rs = this.quickFixTestHelper.createResourceSet(fs);\n+\t\tMap<String, ResourceDescriptionsData> dataMap = new HashMap<>();\n+\t\tdataMap.put(\"project\", ResourceDescriptionsData.ResourceSetAdapter.findResourceDescriptionsData(rs));\n+\t\tnew ChunkedResourceDescriptions(dataMap, rs);\n+\t\treturn (T) this.quickFixTestHelper.contents(rs, fileName, type.getInstanceClass());\n+\t}\n+\n+\tprivate void quickfixesAreOffered(EObject target, String issueCode, String originalText,\n+\t\t\tAbstractIdeQuickfixTest.Quickfix... expected) {", "originalCommit": "5e9e96a7b728557d259d1b906d2e589eadeabbe4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzM0MzUxMA==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r513343510", "bodyText": "Is this a QuickfixExpectation?", "author": "szarnekow", "createdAt": "2020-10-28T10:43:27Z", "path": "org.eclipse.xtext.ide.tests/src/org/eclipse/xtext/ide/tests/editor/quickfix/AbstractIdeQuickfixTest.java", "diffHunk": "@@ -0,0 +1,220 @@\n+/**\n+ * Copyright (c) 2020 TypeFox GmbH (http://www.typefox.io) and others.\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0.\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.eclipse.xtext.ide.tests.editor.quickfix;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.concurrent.CompletableFuture;\n+import java.util.function.Function;\n+\n+import org.eclipse.emf.common.util.URI;\n+import org.eclipse.emf.ecore.EClass;\n+import org.eclipse.emf.ecore.EObject;\n+import org.eclipse.emf.ecore.resource.ResourceSet;\n+import org.eclipse.lsp4j.CodeActionContext;\n+import org.eclipse.lsp4j.CodeActionParams;\n+import org.eclipse.lsp4j.Diagnostic;\n+import org.eclipse.lsp4j.DiagnosticSeverity;\n+import org.eclipse.lsp4j.InitializeParams;\n+import org.eclipse.lsp4j.InitializeResult;\n+import org.eclipse.lsp4j.Position;\n+import org.eclipse.lsp4j.Range;\n+import org.eclipse.lsp4j.TextDocumentIdentifier;\n+import org.eclipse.lsp4j.WorkspaceEdit;\n+import org.eclipse.lsp4j.services.LanguageClient;\n+import org.eclipse.xtext.ide.editor.quickfix.DiagnosticResolution;\n+import org.eclipse.xtext.ide.editor.quickfix.IQuickFixProvider;\n+import org.eclipse.xtext.ide.server.Document;\n+import org.eclipse.xtext.ide.server.ILanguageServerAccess;\n+import org.eclipse.xtext.ide.server.codeActions.ICodeActionService2;\n+import org.eclipse.xtext.nodemodel.ICompositeNode;\n+import org.eclipse.xtext.nodemodel.util.NodeModelUtils;\n+import org.eclipse.xtext.resource.FileExtensionProvider;\n+import org.eclipse.xtext.resource.XtextResource;\n+import org.eclipse.xtext.resource.impl.ChunkedResourceDescriptions;\n+import org.eclipse.xtext.resource.impl.ResourceDescriptionsData;\n+import org.eclipse.xtext.testing.util.InMemoryURIHandler;\n+import org.eclipse.xtext.util.CancelIndicator;\n+import org.eclipse.xtext.util.LineAndColumn;\n+import org.eclipse.xtext.util.Strings;\n+import org.eclipse.xtext.xbase.lib.IterableExtensions;\n+import org.eclipse.xtext.xbase.lib.Pair;\n+import org.junit.Assert;\n+\n+import com.google.inject.Inject;\n+\n+/**\n+ * @author Heinrich Weichert\n+ * \n+ * @since 2.24\n+ */\n+public abstract class AbstractIdeQuickfixTest {\n+\n+\tprotected static class Quickfix {", "originalCommit": "5e9e96a7b728557d259d1b906d2e589eadeabbe4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ4MDMwNA==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r513480304", "bodyText": "I can rename that, yes", "author": "imhotep82", "createdAt": "2020-10-28T14:18:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzM0MzUxMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzM0MzYxMg==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r513343612", "bodyText": "Is this an expectation rather than a result?", "author": "szarnekow", "createdAt": "2020-10-28T10:43:37Z", "path": "org.eclipse.xtext.ide.tests/src/org/eclipse/xtext/ide/tests/editor/quickfix/AbstractIdeQuickfixTest.java", "diffHunk": "@@ -0,0 +1,220 @@\n+/**\n+ * Copyright (c) 2020 TypeFox GmbH (http://www.typefox.io) and others.\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0.\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.eclipse.xtext.ide.tests.editor.quickfix;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.concurrent.CompletableFuture;\n+import java.util.function.Function;\n+\n+import org.eclipse.emf.common.util.URI;\n+import org.eclipse.emf.ecore.EClass;\n+import org.eclipse.emf.ecore.EObject;\n+import org.eclipse.emf.ecore.resource.ResourceSet;\n+import org.eclipse.lsp4j.CodeActionContext;\n+import org.eclipse.lsp4j.CodeActionParams;\n+import org.eclipse.lsp4j.Diagnostic;\n+import org.eclipse.lsp4j.DiagnosticSeverity;\n+import org.eclipse.lsp4j.InitializeParams;\n+import org.eclipse.lsp4j.InitializeResult;\n+import org.eclipse.lsp4j.Position;\n+import org.eclipse.lsp4j.Range;\n+import org.eclipse.lsp4j.TextDocumentIdentifier;\n+import org.eclipse.lsp4j.WorkspaceEdit;\n+import org.eclipse.lsp4j.services.LanguageClient;\n+import org.eclipse.xtext.ide.editor.quickfix.DiagnosticResolution;\n+import org.eclipse.xtext.ide.editor.quickfix.IQuickFixProvider;\n+import org.eclipse.xtext.ide.server.Document;\n+import org.eclipse.xtext.ide.server.ILanguageServerAccess;\n+import org.eclipse.xtext.ide.server.codeActions.ICodeActionService2;\n+import org.eclipse.xtext.nodemodel.ICompositeNode;\n+import org.eclipse.xtext.nodemodel.util.NodeModelUtils;\n+import org.eclipse.xtext.resource.FileExtensionProvider;\n+import org.eclipse.xtext.resource.XtextResource;\n+import org.eclipse.xtext.resource.impl.ChunkedResourceDescriptions;\n+import org.eclipse.xtext.resource.impl.ResourceDescriptionsData;\n+import org.eclipse.xtext.testing.util.InMemoryURIHandler;\n+import org.eclipse.xtext.util.CancelIndicator;\n+import org.eclipse.xtext.util.LineAndColumn;\n+import org.eclipse.xtext.util.Strings;\n+import org.eclipse.xtext.xbase.lib.IterableExtensions;\n+import org.eclipse.xtext.xbase.lib.Pair;\n+import org.junit.Assert;\n+\n+import com.google.inject.Inject;\n+\n+/**\n+ * @author Heinrich Weichert\n+ * \n+ * @since 2.24\n+ */\n+public abstract class AbstractIdeQuickfixTest {\n+\n+\tprotected static class Quickfix {\n+\t\tprivate String label;\n+\t\tprivate String description;\n+\t\tprivate String result;", "originalCommit": "5e9e96a7b728557d259d1b906d2e589eadeabbe4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzM0MzgxNA==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r513343814", "bodyText": "Formatting", "author": "szarnekow", "createdAt": "2020-10-28T10:43:57Z", "path": "org.eclipse.xtext.ide.tests/src/org/eclipse/xtext/ide/tests/editor/quickfix/QuickFixTestHelper.java", "diffHunk": "@@ -0,0 +1,31 @@\n+/**\n+ * Copyright (c) 2020 itemis AG (http://www.itemis.eu) and others.\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0.\n+ * \n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.eclipse.xtext.ide.tests.editor.quickfix;\n+\n+import org.eclipse.emf.common.util.URI;\n+import org.eclipse.emf.ecore.resource.ResourceSet;\n+import org.eclipse.xtext.ide.tests.serializer.ChangeSerializerTestHelper;\n+import org.eclipse.xtext.xbase.lib.IteratorExtensions;\n+\n+import com.google.common.collect.Iterators;\n+\n+/**\n+ * \n+ * @author Heinrich Weichert\n+ */\n+class QuickFixTestHelper extends ChangeSerializerTestHelper {\n+  @Override\n+  public <T extends Object> T contents(ResourceSet rs, String fileName, Class<T> type) {", "originalCommit": "5e9e96a7b728557d259d1b906d2e589eadeabbe4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzM0NDIwMg==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r513344202", "bodyText": "Also the method name does not tell what this routine does.", "author": "szarnekow", "createdAt": "2020-10-28T10:44:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzM0MzgxNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ1MDI0MA==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r513450240", "bodyText": "It's overridden, I'll rename the method to \"findFirstOfTypeInFile\" if it's OK.", "author": "imhotep82", "createdAt": "2020-10-28T13:40:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzM0MzgxNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ5NDYwNg==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r513494606", "bodyText": "\ud83d\udc4d", "author": "szarnekow", "createdAt": "2020-10-28T14:35:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzM0MzgxNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzM0NDUyOA==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r513344528", "bodyText": "Java is happier with a normal \"string\" + \"contatenation\"", "author": "szarnekow", "createdAt": "2020-10-28T10:44:58Z", "path": "org.eclipse.xtext.ide.tests/src/org/eclipse/xtext/ide/tests/editor/quickfix/TestLanguageQuickfixTest.java", "diffHunk": "@@ -0,0 +1,48 @@\n+/**\n+* Copyright (c) 2020 itemis AG (http://www.itemis.eu) and others.\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0.\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.eclipse.xtext.ide.tests.editor.quickfix;\n+\n+import org.eclipse.xtend2.lib.StringConcatenation;\n+import org.eclipse.xtext.ide.tests.testlanguage.TestLanguageIdeInjectorProvider;\n+import org.eclipse.xtext.ide.tests.testlanguage.testLanguage.TestLanguagePackage;\n+import org.eclipse.xtext.ide.tests.testlanguage.validation.TestLanguageValidator;\n+import org.eclipse.xtext.testing.InjectWith;\n+import org.eclipse.xtext.testing.XtextRunner;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+\n+/**\n+ * @author Heinrich Weichert\n+ */\n+@RunWith(XtextRunner.class)\n+@InjectWith(TestLanguageIdeInjectorProvider.class)\n+public class TestLanguageQuickfixTest extends AbstractIdeQuickfixTest {\n+\t\n+\t@Test\n+\tpublic void issueProducesTextualChange() {\n+\n+\t\tStringConcatenation actual = new StringConcatenation();", "originalCommit": "5e9e96a7b728557d259d1b906d2e589eadeabbe4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzM0NDkxMw==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r513344913", "bodyText": "This base class could offer a method Quickfix expect(String, String, String)", "author": "szarnekow", "createdAt": "2020-10-28T10:45:39Z", "path": "org.eclipse.xtext.ide.tests/src/org/eclipse/xtext/ide/tests/editor/quickfix/TestLanguageQuickfixTest.java", "diffHunk": "@@ -0,0 +1,48 @@\n+/**\n+* Copyright (c) 2020 itemis AG (http://www.itemis.eu) and others.\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0.\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.eclipse.xtext.ide.tests.editor.quickfix;\n+\n+import org.eclipse.xtend2.lib.StringConcatenation;\n+import org.eclipse.xtext.ide.tests.testlanguage.TestLanguageIdeInjectorProvider;\n+import org.eclipse.xtext.ide.tests.testlanguage.testLanguage.TestLanguagePackage;\n+import org.eclipse.xtext.ide.tests.testlanguage.validation.TestLanguageValidator;\n+import org.eclipse.xtext.testing.InjectWith;\n+import org.eclipse.xtext.testing.XtextRunner;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+\n+/**\n+ * @author Heinrich Weichert\n+ */\n+@RunWith(XtextRunner.class)\n+@InjectWith(TestLanguageIdeInjectorProvider.class)\n+public class TestLanguageQuickfixTest extends AbstractIdeQuickfixTest {\n+\t\n+\t@Test\n+\tpublic void issueProducesTextualChange() {\n+\n+\t\tStringConcatenation actual = new StringConcatenation();\n+\t\tactual.append(\"package testLanguage {\");\n+\t\tactual.newLine();\n+\t\tactual.newLine();\n+\t\tactual.append(\"type myType {\");\n+\t\tactual.newLine();\n+\t\tactual.append(\"}}\");\n+\t\tactual.newLine();\n+\n+\t\t// quickfix replaces first char to Upper\n+\t\t// see: org.eclipse.xtext.ide.tests.testlanguage.ide.quickfix.TestLanguageQuickFixProvider.fixLowerCaseName(DiagnosticResolutionAcceptor)\n+\t\tString expected = actual.toString().replace(\"myType\", \"MyType\");\n+\n+\t\tAbstractIdeQuickfixTest.Quickfix quickfix = new AbstractIdeQuickfixTest.Quickfix(\"Change element name to first upper\",", "originalCommit": "5e9e96a7b728557d259d1b906d2e589eadeabbe4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzM0NzMxNg==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r513347316", "bodyText": "If we make this class package private, the bindings of the factory become meaningless since nobody can ever implement a subtype of the context.", "author": "szarnekow", "createdAt": "2020-10-28T10:49:42Z", "path": "org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/editor/quickfix/DiagnosticModificationContext.java", "diffHunk": "@@ -0,0 +1,67 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 TypeFox GmbH (http://www.typefox.io) and others.\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0.\n+ * \n+ * SPDX-License-Identifier: EPL-2.0\n+ *******************************************************************************/\n+package org.eclipse.xtext.ide.editor.quickfix;\n+\n+import javax.inject.Inject;\n+\n+import org.eclipse.xtext.ide.serializer.IChangeSerializer;\n+import org.eclipse.xtext.ide.server.rename.ChangeConverter2;\n+\n+import com.google.inject.ImplementedBy;\n+\n+/**\n+ * @author Heinrich Weichert\n+\n+ * @since 2.24\n+ */\n+class DiagnosticModificationContext {", "originalCommit": "5e9e96a7b728557d259d1b906d2e589eadeabbe4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ0ODg5NQ==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r513448895", "bodyText": "Agreed, I'll make the surrounding class public", "author": "imhotep82", "createdAt": "2020-10-28T13:38:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzM0NzMxNg=="}], "type": "inlineReview"}, {"oid": "db29fa69a6fc312d4d813950954ef959e32acb27", "url": "https://github.com/eclipse/xtext-core/commit/db29fa69a6fc312d4d813950954ef959e32acb27", "message": "quickfix_ide: implement review comments (except Command)\n\nSigned-off-by: Heinrich Weichert <heinrich.weichert@avl.com>", "committedDate": "2020-10-28T17:29:42Z", "type": "forcePushed"}, {"oid": "213b071e95dc49f8a1e319c49c77266abc73ff2b", "url": "https://github.com/eclipse/xtext-core/commit/213b071e95dc49f8a1e319c49c77266abc73ff2b", "message": "quickfix_ide: quickfix implementation for generic IDEs\n\nSigned-off-by: Heinrich Weichert <heinrich.weichert@avl.com>", "committedDate": "2020-10-29T05:33:16Z", "type": "forcePushed"}, {"oid": "13c4e0c4406d01cb00fa28aa9ae53c52fd313163", "url": "https://github.com/eclipse/xtext-core/commit/13c4e0c4406d01cb00fa28aa9ae53c52fd313163", "message": "Introduce quickfix API for generic IDE module (beta)\n\nSigned-off-by: Heinrich Weichert <heinrich.weichert@avl.com>", "committedDate": "2020-10-29T05:56:49Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQ4MzYzMQ==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r515483631", "bodyText": "add @Beta", "author": "cdietrich", "createdAt": "2020-10-31T10:44:35Z", "path": "org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/editor/quickfix/IQuickFixProvider.java", "diffHunk": "@@ -0,0 +1,39 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 TypeFox GmbH (http://www.typefox.io) and others.\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0.\n+ * \n+ * SPDX-License-Identifier: EPL-2.0\n+ *******************************************************************************/\n+package org.eclipse.xtext.ide.editor.quickfix;\n+\n+import java.util.List;\n+\n+import org.eclipse.lsp4j.Diagnostic;\n+import org.eclipse.xtext.ide.server.codeActions.ICodeActionService2.Options;\n+\n+/**\n+ * Quickfix for code actions in files.<br>\n+ * The quickfix itself is applied to a temporary resource.<br>\n+ * The textual edit can be composed by calling DiagnosticResolution#apply().\n+ *\n+ * @author Heinrich Weichert\n+ * \n+ * @since 2.24\n+ */\n+public interface IQuickFixProvider {", "originalCommit": "13c4e0c4406d01cb00fa28aa9ae53c52fd313163", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQ4MzY4Ng==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r515483686", "bodyText": "add @Beta", "author": "cdietrich", "createdAt": "2020-10-31T10:45:05Z", "path": "org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/editor/quickfix/QuickFix.java", "diffHunk": "@@ -0,0 +1,30 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 TypeFox GmbH (http://www.typefox.io) and others.\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0.\n+ * \n+ * SPDX-License-Identifier: EPL-2.0\n+ *******************************************************************************/\n+package org.eclipse.xtext.ide.editor.quickfix;\n+\n+import java.lang.annotation.ElementType;\n+import java.lang.annotation.Repeatable;\n+import java.lang.annotation.Retention;\n+import java.lang.annotation.RetentionPolicy;\n+import java.lang.annotation.Target;\n+\n+/**\n+ * Semantic quick-fix. Multiple quick-fixes can be assigned to one method by wrapping it in one {@link QuickFixes}\n+ * annotation.\n+ * \n+ * @author Heinrich Weichert\n+ *\n+ * @since 2.24\n+ */\n+@Retention(RetentionPolicy.RUNTIME)\n+@Target({ ElementType.METHOD })\n+@Repeatable(QuickFixes.class)\n+public @interface QuickFix {", "originalCommit": "13c4e0c4406d01cb00fa28aa9ae53c52fd313163", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQ4MzY5MQ==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r515483691", "bodyText": "add @Beta", "author": "cdietrich", "createdAt": "2020-10-31T10:45:13Z", "path": "org.eclipse.xtext.ide/src/org/eclipse/xtext/ide/editor/quickfix/QuickFixes.java", "diffHunk": "@@ -0,0 +1,31 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 TypeFox GmbH (http://www.typefox.io) and others.\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0.\n+ * \n+ * SPDX-License-Identifier: EPL-2.0\n+ *******************************************************************************/\n+package org.eclipse.xtext.ide.editor.quickfix;\n+\n+import java.lang.annotation.ElementType;\n+import java.lang.annotation.Retention;\n+import java.lang.annotation.RetentionPolicy;\n+import java.lang.annotation.Target;\n+\n+/**\n+ * Annotation Container for @{@link QuickFix} annotations. You can mark a method in a\n+ * {@link AbstractDeclarativeIdeQuickfixProvider} with this annotation to specify which issue codes the method offers\n+ * quick-fixes for. \n+\n+ * @author Heinrich Weichert\n+ * \n+ * @since 2.24\n+ */\n+@Retention(RetentionPolicy.RUNTIME)\n+@Target({ ElementType.METHOD })\n+public @interface QuickFixes {", "originalCommit": "13c4e0c4406d01cb00fa28aa9ae53c52fd313163", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQ4ODMwOQ==", "url": "https://github.com/eclipse/xtext-core/pull/1597#discussion_r515488309", "bodyText": "done", "author": "imhotep82", "createdAt": "2020-10-31T11:40:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQ4MzY5MQ=="}], "type": "inlineReview"}, {"oid": "c8525e34f321292a89f33490dbbe0f29a5435563", "url": "https://github.com/eclipse/xtext-core/commit/c8525e34f321292a89f33490dbbe0f29a5435563", "message": "Introduce quickfix API for generic IDE module (beta)\n\nSigned-off-by: Heinrich Weichert <heinrich.weichert@avl.com>", "committedDate": "2020-10-31T11:40:50Z", "type": "commit"}, {"oid": "c8525e34f321292a89f33490dbbe0f29a5435563", "url": "https://github.com/eclipse/xtext-core/commit/c8525e34f321292a89f33490dbbe0f29a5435563", "message": "Introduce quickfix API for generic IDE module (beta)\n\nSigned-off-by: Heinrich Weichert <heinrich.weichert@avl.com>", "committedDate": "2020-10-31T11:40:50Z", "type": "forcePushed"}]}