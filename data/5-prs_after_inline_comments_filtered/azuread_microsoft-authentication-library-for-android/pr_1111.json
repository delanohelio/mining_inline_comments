{"pr_number": 1111, "pr_title": "Added showMsalRedirectUriInfo command and activity to MSAL", "pr_createdAt": "2020-07-26T16:54:44Z", "pr_url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1111", "timeline": [{"oid": "e0b57c635985779c404c4ff5b6b8428823cffe5c", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/e0b57c635985779c404c4ff5b6b8428823cffe5c", "message": "Added showMsalRedirectUriInfo command and activity to MSAL", "committedDate": "2020-07-26T16:51:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk5Mjk4NQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1111#discussion_r460992985", "bodyText": "Needs javadoc.....Also should we rename this to something like showExpectedMsalRedirectUriInfo (to indicate that the redirect uri displayed here isn't the one they have already registered (in case they have) but rather the one that we actually expect)?", "author": "shahzaibj", "createdAt": "2020-07-27T15:53:49Z", "path": "msal/src/main/java/com/microsoft/identity/client/PublicClientApplication.java", "diffHunk": "@@ -1213,6 +1214,10 @@ public static String getSdkVersion() {\n         return BuildConfig.VERSION_NAME;\n     }\n \n+    public static void showMsalRedirectUriInfo(Activity activity){", "originalCommit": "e0b57c635985779c404c4ff5b6b8428823cffe5c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTAyNTA5OA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1111#discussion_r461025098", "bodyText": "I like that suggestion.  Thanks", "author": "shoatman", "createdAt": "2020-07-27T16:44:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk5Mjk4NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk5MzcxNQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1111#discussion_r460993715", "bodyText": "Could add some javadoc here", "author": "shahzaibj", "createdAt": "2020-07-27T15:54:52Z", "path": "msal/src/main/java/com/microsoft/identity/client/helper/BrokerHelperActivity.java", "diffHunk": "@@ -0,0 +1,81 @@\n+package com.microsoft.identity.client.helper;\r\n+\r\n+import android.app.Activity;\r\n+import android.content.Context;\r\n+import android.content.Intent;\r\n+import android.os.Bundle;\r\n+import android.util.Log;\r\n+import android.widget.TextView;\r\n+\r\n+import androidx.annotation.Nullable;\r\n+\r\n+import com.microsoft.identity.common.adal.internal.AuthenticationConstants;\r\n+import com.microsoft.identity.common.internal.broker.BrokerValidator;\r\n+import com.microsoft.identity.common.internal.broker.PackageHelper;\r\n+import com.microsoft.identity.msal.R;\r\n+\r\n+import java.io.UnsupportedEncodingException;\r\n+import java.net.URLEncoder;\r\n+\r\n+public class BrokerHelperActivity extends Activity {\r", "originalCommit": "e0b57c635985779c404c4ff5b6b8428823cffe5c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTAyNTE5NA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1111#discussion_r461025194", "bodyText": "ack", "author": "shoatman", "createdAt": "2020-07-27T16:44:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk5MzcxNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk3OTU3Mg==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1111#discussion_r460979572", "bodyText": "nit: extra line.", "author": "AdamBJohnsonx", "createdAt": "2020-07-27T15:33:50Z", "path": "msal/src/main/java/com/microsoft/identity/client/helper/BrokerHelperActivity.java", "diffHunk": "@@ -0,0 +1,81 @@\n+package com.microsoft.identity.client.helper;\r\n+\r\n+import android.app.Activity;\r\n+import android.content.Context;\r\n+import android.content.Intent;\r\n+import android.os.Bundle;\r\n+import android.util.Log;\r\n+import android.widget.TextView;\r\n+\r\n+import androidx.annotation.Nullable;\r\n+\r\n+import com.microsoft.identity.common.adal.internal.AuthenticationConstants;\r\n+import com.microsoft.identity.common.internal.broker.BrokerValidator;\r\n+import com.microsoft.identity.common.internal.broker.PackageHelper;\r\n+import com.microsoft.identity.msal.R;\r\n+\r\n+import java.io.UnsupportedEncodingException;\r\n+import java.net.URLEncoder;\r\n+\r\n+public class BrokerHelperActivity extends Activity {\r\n+\r\n+    TextView mPackageName;\r\n+    TextView mSignature;\r\n+    TextView mRedirect;\r\n+    TextView mManifest;\r\n+\r\n+    String mManifestTemplate= \"<activity android:name=\\\"com.microsoft.identity.client.BrowserTabActivity\\\">\\n\" +\r\n+            \"    <intent-filter>\\n\" +\r\n+            \"        <action android:name=\\\"android.intent.action.VIEW\\\" />\\n\" +\r\n+            \"        <category android:name=\\\"android.intent.category.DEFAULT\\\" />\\n\" +\r\n+            \"        <category android:name=\\\"android.intent.category.BROWSABLE\\\" />\\n\" +\r\n+            \"        <data\\n\" +\r\n+            \"            android:host=\\\"%s\\\"\\n\" +\r\n+            \"            android:path=\\\"%s\\\"\\n\" +\r\n+            \"            android:scheme=\\\"msauth\\\" />\\n\" +\r\n+            \"    </intent-filter>\\n\" +\r\n+            \"</activity>\";\r\n+\r\n+    public static Intent createStartIntent(final Context context) {\r\n+        final Intent intent = new Intent(context, BrokerHelperActivity.class);\r\n+          return intent;\r\n+    }\r\n+\r\n+    @Override\r\n+    protected void onCreate(@Nullable Bundle savedInstanceState) {\r\n+        super.onCreate(savedInstanceState);\r\n+        setContentView(R.layout.broker_helper);\r\n+\r\n+        mPackageName = findViewById(R.id.txtPackageName);\r\n+        mSignature = findViewById(R.id.txtSignature);\r\n+        mRedirect = findViewById(R.id.txtRedirect);\r\n+        mManifest = findViewById(R.id.txtManifest);\r\n+\r\n+        mSignature.append(getSignature(false));\r\n+        mRedirect.append(BrokerValidator.getBrokerRedirectUri(this.getApplicationContext(), this.getPackageName()));\r\n+        mManifest.append(String.format(mManifestTemplate, this.getPackageName(), getSignature(false)));\r\n+        mPackageName.append(this.getPackageName());\r\n+\r\n+\r\n+    }\r\n+\r\n+    private String getSignature(Boolean urlEncode){\r\n+\r\n+        final PackageHelper info = new PackageHelper(this.getApplicationContext().getPackageManager());\r\n+        final String signatureDigest = info.getCurrentSignatureForPackage(this.getPackageName());\r\n+        String signature = \"\";\r\n+\r\n+        try {\r\n+            if(urlEncode) {\r\n+                signature = URLEncoder.encode(signatureDigest, AuthenticationConstants.ENCODING_UTF8);\r\n+            }else{\r\n+                signature = signatureDigest;\r\n+            }\r\n+        } catch (UnsupportedEncodingException e) {\r\n+            Log.e(\"getSignature\", \"Error encoding signature digest\", e);\r\n+        }\r\n+\r\n+        return signature;\r\n+\r", "originalCommit": "e0b57c635985779c404c4ff5b6b8428823cffe5c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTAyNTIzNw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1111#discussion_r461025237", "bodyText": "ack", "author": "shoatman", "createdAt": "2020-07-27T16:44:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk3OTU3Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk4MDExOA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1111#discussion_r460980118", "bodyText": "nits: final parameter,- can this be a primitive?", "author": "AdamBJohnsonx", "createdAt": "2020-07-27T15:34:39Z", "path": "msal/src/main/java/com/microsoft/identity/client/helper/BrokerHelperActivity.java", "diffHunk": "@@ -0,0 +1,81 @@\n+package com.microsoft.identity.client.helper;\r\n+\r\n+import android.app.Activity;\r\n+import android.content.Context;\r\n+import android.content.Intent;\r\n+import android.os.Bundle;\r\n+import android.util.Log;\r\n+import android.widget.TextView;\r\n+\r\n+import androidx.annotation.Nullable;\r\n+\r\n+import com.microsoft.identity.common.adal.internal.AuthenticationConstants;\r\n+import com.microsoft.identity.common.internal.broker.BrokerValidator;\r\n+import com.microsoft.identity.common.internal.broker.PackageHelper;\r\n+import com.microsoft.identity.msal.R;\r\n+\r\n+import java.io.UnsupportedEncodingException;\r\n+import java.net.URLEncoder;\r\n+\r\n+public class BrokerHelperActivity extends Activity {\r\n+\r\n+    TextView mPackageName;\r\n+    TextView mSignature;\r\n+    TextView mRedirect;\r\n+    TextView mManifest;\r\n+\r\n+    String mManifestTemplate= \"<activity android:name=\\\"com.microsoft.identity.client.BrowserTabActivity\\\">\\n\" +\r\n+            \"    <intent-filter>\\n\" +\r\n+            \"        <action android:name=\\\"android.intent.action.VIEW\\\" />\\n\" +\r\n+            \"        <category android:name=\\\"android.intent.category.DEFAULT\\\" />\\n\" +\r\n+            \"        <category android:name=\\\"android.intent.category.BROWSABLE\\\" />\\n\" +\r\n+            \"        <data\\n\" +\r\n+            \"            android:host=\\\"%s\\\"\\n\" +\r\n+            \"            android:path=\\\"%s\\\"\\n\" +\r\n+            \"            android:scheme=\\\"msauth\\\" />\\n\" +\r\n+            \"    </intent-filter>\\n\" +\r\n+            \"</activity>\";\r\n+\r\n+    public static Intent createStartIntent(final Context context) {\r\n+        final Intent intent = new Intent(context, BrokerHelperActivity.class);\r\n+          return intent;\r\n+    }\r\n+\r\n+    @Override\r\n+    protected void onCreate(@Nullable Bundle savedInstanceState) {\r\n+        super.onCreate(savedInstanceState);\r\n+        setContentView(R.layout.broker_helper);\r\n+\r\n+        mPackageName = findViewById(R.id.txtPackageName);\r\n+        mSignature = findViewById(R.id.txtSignature);\r\n+        mRedirect = findViewById(R.id.txtRedirect);\r\n+        mManifest = findViewById(R.id.txtManifest);\r\n+\r\n+        mSignature.append(getSignature(false));\r\n+        mRedirect.append(BrokerValidator.getBrokerRedirectUri(this.getApplicationContext(), this.getPackageName()));\r\n+        mManifest.append(String.format(mManifestTemplate, this.getPackageName(), getSignature(false)));\r\n+        mPackageName.append(this.getPackageName());\r\n+\r\n+\r\n+    }\r\n+\r\n+    private String getSignature(Boolean urlEncode){\r", "originalCommit": "e0b57c635985779c404c4ff5b6b8428823cffe5c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTAyNTMyOQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1111#discussion_r461025329", "bodyText": "ack", "author": "shoatman", "createdAt": "2020-07-27T16:44:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk4MDExOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk4NDM0OQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1111#discussion_r460984349", "bodyText": "I think we should be explicit here, since this is truly a \"can't happen\" case as UTF-8 has been folded into Java.  This isn't thrown for any random error encoding the string, it's thrown if the character set specified by name is not supported.  It's \"Character encoding \" + AuthenticationConstants.ENCODING_UTF8 + \" is not supported.\"  You could even use Lombok to @SneakyThrows an UnsupportedEncodingException, supposing that the upper layer can responsibly handle a \"WorldIsBrokenException\".", "author": "AdamBJohnsonx", "createdAt": "2020-07-27T15:40:53Z", "path": "msal/src/main/java/com/microsoft/identity/client/helper/BrokerHelperActivity.java", "diffHunk": "@@ -0,0 +1,81 @@\n+package com.microsoft.identity.client.helper;\r\n+\r\n+import android.app.Activity;\r\n+import android.content.Context;\r\n+import android.content.Intent;\r\n+import android.os.Bundle;\r\n+import android.util.Log;\r\n+import android.widget.TextView;\r\n+\r\n+import androidx.annotation.Nullable;\r\n+\r\n+import com.microsoft.identity.common.adal.internal.AuthenticationConstants;\r\n+import com.microsoft.identity.common.internal.broker.BrokerValidator;\r\n+import com.microsoft.identity.common.internal.broker.PackageHelper;\r\n+import com.microsoft.identity.msal.R;\r\n+\r\n+import java.io.UnsupportedEncodingException;\r\n+import java.net.URLEncoder;\r\n+\r\n+public class BrokerHelperActivity extends Activity {\r\n+\r\n+    TextView mPackageName;\r\n+    TextView mSignature;\r\n+    TextView mRedirect;\r\n+    TextView mManifest;\r\n+\r\n+    String mManifestTemplate= \"<activity android:name=\\\"com.microsoft.identity.client.BrowserTabActivity\\\">\\n\" +\r\n+            \"    <intent-filter>\\n\" +\r\n+            \"        <action android:name=\\\"android.intent.action.VIEW\\\" />\\n\" +\r\n+            \"        <category android:name=\\\"android.intent.category.DEFAULT\\\" />\\n\" +\r\n+            \"        <category android:name=\\\"android.intent.category.BROWSABLE\\\" />\\n\" +\r\n+            \"        <data\\n\" +\r\n+            \"            android:host=\\\"%s\\\"\\n\" +\r\n+            \"            android:path=\\\"%s\\\"\\n\" +\r\n+            \"            android:scheme=\\\"msauth\\\" />\\n\" +\r\n+            \"    </intent-filter>\\n\" +\r\n+            \"</activity>\";\r\n+\r\n+    public static Intent createStartIntent(final Context context) {\r\n+        final Intent intent = new Intent(context, BrokerHelperActivity.class);\r\n+          return intent;\r\n+    }\r\n+\r\n+    @Override\r\n+    protected void onCreate(@Nullable Bundle savedInstanceState) {\r\n+        super.onCreate(savedInstanceState);\r\n+        setContentView(R.layout.broker_helper);\r\n+\r\n+        mPackageName = findViewById(R.id.txtPackageName);\r\n+        mSignature = findViewById(R.id.txtSignature);\r\n+        mRedirect = findViewById(R.id.txtRedirect);\r\n+        mManifest = findViewById(R.id.txtManifest);\r\n+\r\n+        mSignature.append(getSignature(false));\r\n+        mRedirect.append(BrokerValidator.getBrokerRedirectUri(this.getApplicationContext(), this.getPackageName()));\r\n+        mManifest.append(String.format(mManifestTemplate, this.getPackageName(), getSignature(false)));\r\n+        mPackageName.append(this.getPackageName());\r\n+\r\n+\r\n+    }\r\n+\r\n+    private String getSignature(Boolean urlEncode){\r\n+\r\n+        final PackageHelper info = new PackageHelper(this.getApplicationContext().getPackageManager());\r\n+        final String signatureDigest = info.getCurrentSignatureForPackage(this.getPackageName());\r\n+        String signature = \"\";\r\n+\r\n+        try {\r\n+            if(urlEncode) {\r\n+                signature = URLEncoder.encode(signatureDigest, AuthenticationConstants.ENCODING_UTF8);\r\n+            }else{\r\n+                signature = signatureDigest;\r\n+            }\r\n+        } catch (UnsupportedEncodingException e) {\r\n+            Log.e(\"getSignature\", \"Error encoding signature digest\", e);\r", "originalCommit": "e0b57c635985779c404c4ff5b6b8428823cffe5c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTAyNjY4Nw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1111#discussion_r461026687", "bodyText": "I don't expect this to happen... ;-).  Ack on suggestion for logging message.", "author": "shoatman", "createdAt": "2020-07-27T16:46:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk4NDM0OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk4NTQzNQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1111#discussion_r460985435", "bodyText": "nit: extra lines", "author": "AdamBJohnsonx", "createdAt": "2020-07-27T15:42:37Z", "path": "testapps/testapp/src/main/java/com/microsoft/identity/client/testapp/AcquireTokenFragment.java", "diffHunk": "@@ -118,6 +122,8 @@ public View onCreateView(final LayoutInflater inflater, final ViewGroup containe\n         mPopSection = view.findViewById(R.id.pop_section);\n         mLoginHintSection = view.findViewById(R.id.login_hint_section);\n \n+\n+", "originalCommit": "e0b57c635985779c404c4ff5b6b8428823cffe5c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk4NzgzNg==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1111#discussion_r460987836", "bodyText": "nit: extra lines?", "author": "AdamBJohnsonx", "createdAt": "2020-07-27T15:46:14Z", "path": "msal/src/main/java/com/microsoft/identity/client/helper/BrokerHelperActivity.java", "diffHunk": "@@ -0,0 +1,81 @@\n+package com.microsoft.identity.client.helper;\r\n+\r\n+import android.app.Activity;\r\n+import android.content.Context;\r\n+import android.content.Intent;\r\n+import android.os.Bundle;\r\n+import android.util.Log;\r\n+import android.widget.TextView;\r\n+\r\n+import androidx.annotation.Nullable;\r\n+\r\n+import com.microsoft.identity.common.adal.internal.AuthenticationConstants;\r\n+import com.microsoft.identity.common.internal.broker.BrokerValidator;\r\n+import com.microsoft.identity.common.internal.broker.PackageHelper;\r\n+import com.microsoft.identity.msal.R;\r\n+\r\n+import java.io.UnsupportedEncodingException;\r\n+import java.net.URLEncoder;\r\n+\r\n+public class BrokerHelperActivity extends Activity {\r\n+\r\n+    TextView mPackageName;\r\n+    TextView mSignature;\r\n+    TextView mRedirect;\r\n+    TextView mManifest;\r\n+\r\n+    String mManifestTemplate= \"<activity android:name=\\\"com.microsoft.identity.client.BrowserTabActivity\\\">\\n\" +\r\n+            \"    <intent-filter>\\n\" +\r\n+            \"        <action android:name=\\\"android.intent.action.VIEW\\\" />\\n\" +\r\n+            \"        <category android:name=\\\"android.intent.category.DEFAULT\\\" />\\n\" +\r\n+            \"        <category android:name=\\\"android.intent.category.BROWSABLE\\\" />\\n\" +\r\n+            \"        <data\\n\" +\r\n+            \"            android:host=\\\"%s\\\"\\n\" +\r\n+            \"            android:path=\\\"%s\\\"\\n\" +\r\n+            \"            android:scheme=\\\"msauth\\\" />\\n\" +\r\n+            \"    </intent-filter>\\n\" +\r\n+            \"</activity>\";\r\n+\r\n+    public static Intent createStartIntent(final Context context) {\r\n+        final Intent intent = new Intent(context, BrokerHelperActivity.class);\r\n+          return intent;\r\n+    }\r\n+\r\n+    @Override\r\n+    protected void onCreate(@Nullable Bundle savedInstanceState) {\r\n+        super.onCreate(savedInstanceState);\r\n+        setContentView(R.layout.broker_helper);\r\n+\r\n+        mPackageName = findViewById(R.id.txtPackageName);\r\n+        mSignature = findViewById(R.id.txtSignature);\r\n+        mRedirect = findViewById(R.id.txtRedirect);\r\n+        mManifest = findViewById(R.id.txtManifest);\r\n+\r\n+        mSignature.append(getSignature(false));\r\n+        mRedirect.append(BrokerValidator.getBrokerRedirectUri(this.getApplicationContext(), this.getPackageName()));\r\n+        mManifest.append(String.format(mManifestTemplate, this.getPackageName(), getSignature(false)));\r\n+        mPackageName.append(this.getPackageName());\r\n+\r\n+\r", "originalCommit": "e0b57c635985779c404c4ff5b6b8428823cffe5c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTAyNjc5MQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1111#discussion_r461026791", "bodyText": "ack", "author": "shoatman", "createdAt": "2020-07-27T16:47:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk4NzgzNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk5MDMyMA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1111#discussion_r460990320", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                String mManifestTemplate= \"<activity android:name=\\\"com.microsoft.identity.client.BrowserTabActivity\\\">\\n\" +\n          \n          \n            \n                String mManifestTemplate = \"<activity android:name=\\\"com.microsoft.identity.client.BrowserTabActivity\\\">\\n\" +", "author": "AdamBJohnsonx", "createdAt": "2020-07-27T15:49:56Z", "path": "msal/src/main/java/com/microsoft/identity/client/helper/BrokerHelperActivity.java", "diffHunk": "@@ -0,0 +1,81 @@\n+package com.microsoft.identity.client.helper;\r\n+\r\n+import android.app.Activity;\r\n+import android.content.Context;\r\n+import android.content.Intent;\r\n+import android.os.Bundle;\r\n+import android.util.Log;\r\n+import android.widget.TextView;\r\n+\r\n+import androidx.annotation.Nullable;\r\n+\r\n+import com.microsoft.identity.common.adal.internal.AuthenticationConstants;\r\n+import com.microsoft.identity.common.internal.broker.BrokerValidator;\r\n+import com.microsoft.identity.common.internal.broker.PackageHelper;\r\n+import com.microsoft.identity.msal.R;\r\n+\r\n+import java.io.UnsupportedEncodingException;\r\n+import java.net.URLEncoder;\r\n+\r\n+public class BrokerHelperActivity extends Activity {\r\n+\r\n+    TextView mPackageName;\r\n+    TextView mSignature;\r\n+    TextView mRedirect;\r\n+    TextView mManifest;\r\n+\r\n+    String mManifestTemplate= \"<activity android:name=\\\"com.microsoft.identity.client.BrowserTabActivity\\\">\\n\" +\r", "originalCommit": "e0b57c635985779c404c4ff5b6b8428823cffe5c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTAyNjkwMA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1111#discussion_r461026900", "bodyText": "ack", "author": "shoatman", "createdAt": "2020-07-27T16:47:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk5MDMyMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk5NDQ1Mw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1111#discussion_r460994453", "bodyText": "Could be private", "author": "shahzaibj", "createdAt": "2020-07-27T15:55:58Z", "path": "msal/src/main/java/com/microsoft/identity/client/helper/BrokerHelperActivity.java", "diffHunk": "@@ -0,0 +1,81 @@\n+package com.microsoft.identity.client.helper;\r\n+\r\n+import android.app.Activity;\r\n+import android.content.Context;\r\n+import android.content.Intent;\r\n+import android.os.Bundle;\r\n+import android.util.Log;\r\n+import android.widget.TextView;\r\n+\r\n+import androidx.annotation.Nullable;\r\n+\r\n+import com.microsoft.identity.common.adal.internal.AuthenticationConstants;\r\n+import com.microsoft.identity.common.internal.broker.BrokerValidator;\r\n+import com.microsoft.identity.common.internal.broker.PackageHelper;\r\n+import com.microsoft.identity.msal.R;\r\n+\r\n+import java.io.UnsupportedEncodingException;\r\n+import java.net.URLEncoder;\r\n+\r\n+public class BrokerHelperActivity extends Activity {\r\n+\r\n+    TextView mPackageName;\r\n+    TextView mSignature;\r\n+    TextView mRedirect;\r\n+    TextView mManifest;\r\n+\r\n+    String mManifestTemplate= \"<activity android:name=\\\"com.microsoft.identity.client.BrowserTabActivity\\\">\\n\" +\r", "originalCommit": "e0b57c635985779c404c4ff5b6b8428823cffe5c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk5NTczMA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1111#discussion_r460995730", "bodyText": "... and final.  and a constant?", "author": "AdamBJohnsonx", "createdAt": "2020-07-27T15:57:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk5NDQ1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTAyNzA4Mw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1111#discussion_r461027083", "bodyText": "ack, ack", "author": "shoatman", "createdAt": "2020-07-27T16:47:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk5NDQ1Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk5NTYyMg==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1111#discussion_r460995622", "bodyText": "Do we also want to display an error on the BrokerHelperActivity when this happens? Looks like an empty string will be shown", "author": "shahzaibj", "createdAt": "2020-07-27T15:57:35Z", "path": "msal/src/main/java/com/microsoft/identity/client/helper/BrokerHelperActivity.java", "diffHunk": "@@ -0,0 +1,81 @@\n+package com.microsoft.identity.client.helper;\r\n+\r\n+import android.app.Activity;\r\n+import android.content.Context;\r\n+import android.content.Intent;\r\n+import android.os.Bundle;\r\n+import android.util.Log;\r\n+import android.widget.TextView;\r\n+\r\n+import androidx.annotation.Nullable;\r\n+\r\n+import com.microsoft.identity.common.adal.internal.AuthenticationConstants;\r\n+import com.microsoft.identity.common.internal.broker.BrokerValidator;\r\n+import com.microsoft.identity.common.internal.broker.PackageHelper;\r\n+import com.microsoft.identity.msal.R;\r\n+\r\n+import java.io.UnsupportedEncodingException;\r\n+import java.net.URLEncoder;\r\n+\r\n+public class BrokerHelperActivity extends Activity {\r\n+\r\n+    TextView mPackageName;\r\n+    TextView mSignature;\r\n+    TextView mRedirect;\r\n+    TextView mManifest;\r\n+\r\n+    String mManifestTemplate= \"<activity android:name=\\\"com.microsoft.identity.client.BrowserTabActivity\\\">\\n\" +\r\n+            \"    <intent-filter>\\n\" +\r\n+            \"        <action android:name=\\\"android.intent.action.VIEW\\\" />\\n\" +\r\n+            \"        <category android:name=\\\"android.intent.category.DEFAULT\\\" />\\n\" +\r\n+            \"        <category android:name=\\\"android.intent.category.BROWSABLE\\\" />\\n\" +\r\n+            \"        <data\\n\" +\r\n+            \"            android:host=\\\"%s\\\"\\n\" +\r\n+            \"            android:path=\\\"%s\\\"\\n\" +\r\n+            \"            android:scheme=\\\"msauth\\\" />\\n\" +\r\n+            \"    </intent-filter>\\n\" +\r\n+            \"</activity>\";\r\n+\r\n+    public static Intent createStartIntent(final Context context) {\r\n+        final Intent intent = new Intent(context, BrokerHelperActivity.class);\r\n+          return intent;\r\n+    }\r\n+\r\n+    @Override\r\n+    protected void onCreate(@Nullable Bundle savedInstanceState) {\r\n+        super.onCreate(savedInstanceState);\r\n+        setContentView(R.layout.broker_helper);\r\n+\r\n+        mPackageName = findViewById(R.id.txtPackageName);\r\n+        mSignature = findViewById(R.id.txtSignature);\r\n+        mRedirect = findViewById(R.id.txtRedirect);\r\n+        mManifest = findViewById(R.id.txtManifest);\r\n+\r\n+        mSignature.append(getSignature(false));\r\n+        mRedirect.append(BrokerValidator.getBrokerRedirectUri(this.getApplicationContext(), this.getPackageName()));\r\n+        mManifest.append(String.format(mManifestTemplate, this.getPackageName(), getSignature(false)));\r\n+        mPackageName.append(this.getPackageName());\r\n+\r\n+\r\n+    }\r\n+\r\n+    private String getSignature(Boolean urlEncode){\r\n+\r\n+        final PackageHelper info = new PackageHelper(this.getApplicationContext().getPackageManager());\r\n+        final String signatureDigest = info.getCurrentSignatureForPackage(this.getPackageName());\r\n+        String signature = \"\";\r\n+\r\n+        try {\r\n+            if(urlEncode) {\r\n+                signature = URLEncoder.encode(signatureDigest, AuthenticationConstants.ENCODING_UTF8);\r\n+            }else{\r\n+                signature = signatureDigest;\r\n+            }\r\n+        } catch (UnsupportedEncodingException e) {\r\n+            Log.e(\"getSignature\", \"Error encoding signature digest\", e);\r\n+        }\r", "originalCommit": "e0b57c635985779c404c4ff5b6b8428823cffe5c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTAyNzUxMw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1111#discussion_r461027513", "bodyText": "Hadn't considered that since I don't expect this to happen... wondering in this case if I should convert this to a runtime exception.", "author": "shoatman", "createdAt": "2020-07-27T16:48:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk5NTYyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTAzODQ4NA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1111#discussion_r461038484", "bodyText": "If you sneaky it out it'll land in the same place. ;-)", "author": "AdamBJohnsonx", "createdAt": "2020-07-27T17:05:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk5NTYyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTA0NzQxMg==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1111#discussion_r461047412", "bodyText": "I chose to convert checked exception to runtime in this case.  So I'll log and then throw a runtime exception.", "author": "shoatman", "createdAt": "2020-07-27T17:20:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk5NTYyMg=="}], "type": "inlineReview"}, {"oid": "45c5c9d54553fe88a58343a9ee1961032bd76a7a", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/45c5c9d54553fe88a58343a9ee1961032bd76a7a", "message": "Feedback comments", "committedDate": "2020-07-27T17:23:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTA1MTE3MA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1111#discussion_r461051170", "bodyText": "may be shows instead of includes?", "author": "shahzaibj", "createdAt": "2020-07-27T17:26:56Z", "path": "msal/src/main/java/com/microsoft/identity/client/PublicClientApplication.java", "diffHunk": "@@ -1213,6 +1214,14 @@ public static String getSdkVersion() {\n         return BuildConfig.VERSION_NAME;\n     }\n \n+    /**\n+     * Presents an activity that includes the package name, signature, redirect URI and manifest entry required for your application", "originalCommit": "45c5c9d54553fe88a58343a9ee1961032bd76a7a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTA1MjcyMg==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1111#discussion_r461052722", "bodyText": "should we not attach the causing exception?", "author": "AdamBJohnsonx", "createdAt": "2020-07-27T17:29:31Z", "path": "msal/src/main/java/com/microsoft/identity/client/helper/BrokerHelperActivity.java", "diffHunk": "@@ -0,0 +1,81 @@\n+package com.microsoft.identity.client.helper;\r\n+\r\n+import android.app.Activity;\r\n+import android.content.Context;\r\n+import android.content.Intent;\r\n+import android.os.Bundle;\r\n+import android.util.Log;\r\n+import android.widget.TextView;\r\n+\r\n+import androidx.annotation.Nullable;\r\n+\r\n+import com.microsoft.identity.common.adal.internal.AuthenticationConstants;\r\n+import com.microsoft.identity.common.internal.broker.BrokerValidator;\r\n+import com.microsoft.identity.common.internal.broker.PackageHelper;\r\n+import com.microsoft.identity.msal.R;\r\n+\r\n+import java.io.UnsupportedEncodingException;\r\n+import java.net.URLEncoder;\r\n+\r\n+/**\r\n+ * Activity to show the expected redirect URL (which includes support for Broker)\r\n+ */\r\n+public class BrokerHelperActivity extends Activity {\r\n+\r\n+    private final String MANIFEST_TEMPLATE = \"<activity android:name=\\\"com.microsoft.identity.client.BrowserTabActivity\\\">\\n\" +\r\n+            \"    <intent-filter>\\n\" +\r\n+            \"        <action android:name=\\\"android.intent.action.VIEW\\\" />\\n\" +\r\n+            \"        <category android:name=\\\"android.intent.category.DEFAULT\\\" />\\n\" +\r\n+            \"        <category android:name=\\\"android.intent.category.BROWSABLE\\\" />\\n\" +\r\n+            \"        <data\\n\" +\r\n+            \"            android:host=\\\"%s\\\"\\n\" +\r\n+            \"            android:path=\\\"%s\\\"\\n\" +\r\n+            \"            android:scheme=\\\"msauth\\\" />\\n\" +\r\n+            \"    </intent-filter>\\n\" +\r\n+            \"</activity>\";\r\n+    TextView mPackageName;\r\n+    TextView mSignature;\r\n+    TextView mRedirect;\r\n+    TextView mManifest;\r\n+\r\n+    public static Intent createStartIntent(final Context context) {\r\n+        final Intent intent = new Intent(context, BrokerHelperActivity.class);\r\n+        return intent;\r\n+    }\r\n+\r\n+    @Override\r\n+    protected void onCreate(@Nullable Bundle savedInstanceState) {\r\n+        super.onCreate(savedInstanceState);\r\n+        setContentView(R.layout.broker_helper);\r\n+\r\n+        mPackageName = findViewById(R.id.txtPackageName);\r\n+        mSignature = findViewById(R.id.txtSignature);\r\n+        mRedirect = findViewById(R.id.txtRedirect);\r\n+        mManifest = findViewById(R.id.txtManifest);\r\n+\r\n+        mSignature.append(getSignature(false));\r\n+        mRedirect.append(BrokerValidator.getBrokerRedirectUri(this.getApplicationContext(), this.getPackageName()));\r\n+        mManifest.append(String.format(MANIFEST_TEMPLATE, this.getPackageName(), getSignature(false)));\r\n+        mPackageName.append(this.getPackageName());\r\n+    }\r\n+\r\n+    private String getSignature(final boolean urlEncode) {\r\n+\r\n+        final PackageHelper info = new PackageHelper(this.getApplicationContext().getPackageManager());\r\n+        final String signatureDigest = info.getCurrentSignatureForPackage(this.getPackageName());\r\n+        String signature = \"\";\r\n+\r\n+        try {\r\n+            if (urlEncode) {\r\n+                signature = URLEncoder.encode(signatureDigest, AuthenticationConstants.ENCODING_UTF8);\r\n+            } else {\r\n+                signature = signatureDigest;\r\n+            }\r\n+        } catch (UnsupportedEncodingException e) {\r\n+            Log.e(\"getSignature\", \"Character encoding \" + AuthenticationConstants.ENCODING_UTF8 + \" is not supported.\", e);\r\n+            throw new RuntimeException(\"Unexpected: Unable to get the signature for this application package.\");\r", "originalCommit": "45c5c9d54553fe88a58343a9ee1961032bd76a7a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}