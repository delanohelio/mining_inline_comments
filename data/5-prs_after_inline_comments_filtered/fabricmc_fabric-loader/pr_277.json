{"pr_number": 277, "pr_title": "Add friendlier dependency resolution error descriptions", "pr_createdAt": "2020-07-13T17:45:33Z", "pr_url": "https://github.com/FabricMC/fabric-loader/pull/277", "timeline": [{"oid": "f8631524aa36e8ef3c9b319b732572415959f66d", "url": "https://github.com/FabricMC/fabric-loader/commit/f8631524aa36e8ef3c9b319b732572415959f66d", "message": "first draft, todo: friendlier version strings", "committedDate": "2020-07-13T17:44:26Z", "type": "commit"}, {"oid": "89aad6fcc609d1c1822b715bc412aa3e27708ef8", "url": "https://github.com/FabricMC/fabric-loader/commit/89aad6fcc609d1c1822b715bc412aa3e27708ef8", "message": "Fix location of exclamation mark", "committedDate": "2020-07-13T17:46:51Z", "type": "commit"}, {"oid": "c1cb82bda319b1f1b7b7e23bb7f549129a5afb0d", "url": "https://github.com/FabricMC/fabric-loader/commit/c1cb82bda319b1f1b7b7e23bb7f549129a5afb0d", "message": "missed a depModId here", "committedDate": "2020-07-13T17:51:27Z", "type": "commit"}, {"oid": "74c5eb5f370eece720e219315bd745d0354882c9", "url": "https://github.com/FabricMC/fabric-loader/commit/74c5eb5f370eece720e219315bd745d0354882c9", "message": "and that's why you use IDEs, kids", "committedDate": "2020-07-13T18:11:15Z", "type": "commit"}, {"oid": "15f11f99bf9ffdaf829326ade6cfcb3a3720f57e", "url": "https://github.com/FabricMC/fabric-loader/commit/15f11f99bf9ffdaf829326ade6cfcb3a3720f57e", "message": "show correct version in \"different version is present\" error", "committedDate": "2020-07-13T18:22:19Z", "type": "commit"}, {"oid": "1a66dcb3aa54880846a2e0bc306dc9b74db4623f", "url": "https://github.com/FabricMC/fabric-loader/commit/1a66dcb3aa54880846a2e0bc306dc9b74db4623f", "message": "Friendly version strings done in a decidedly non-friendly way\n\nAlso, error window requests focus now", "committedDate": "2020-07-13T18:39:07Z", "type": "commit"}, {"oid": "1622a04b81b6383c266b99f7a45c718cfc697ce4", "url": "https://github.com/FabricMC/fabric-loader/commit/1622a04b81b6383c266b99f7a45c718cfc697ce4", "message": "TODO: Make lines that start with \"INFO:\" show up as child nodes\n\nI need to go to sleep, will do tomorrow", "committedDate": "2020-07-13T18:54:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzg2MTMwNw==", "url": "https://github.com/FabricMC/fabric-loader/pull/277#discussion_r453861307", "bodyText": "good lord switch block may be least messy", "author": "i509VCB", "createdAt": "2020-07-13T18:52:52Z", "path": "src/main/java/net/fabricmc/loader/discovery/ModResolver.java", "diffHunk": "@@ -340,20 +340,56 @@ private void addErrorToList(ModCandidate candidate, ModDependency dependency, Ma\n \t\t\terrors.append(\"\\n - Mod \").append(candidate.getInfo().getId()).append(\" \").append(errorType).append(\" mod \").append(dependency).append(\", \");\n \n \t\t\tif (depCandidate == null) {\n-\t\t\t\terrors.append(\"which is missing\");\n-\t\t\t} else if (cond) {\n-\t\t\t\terrors.append(\"but a different version is present: \").append(depCandidate.getInfo().getVersion());\n-\t\t\t} else if (errorType.contains(\"conf\")) {\n-\t\t\t\t// CONFLICTS WITH\n-\t\t\t\terrors.append(\"but the conflicting version is present: \").append(depCandidate.getInfo().getVersion());\n+\t\t\t\terrors.append(\"which is missing!\");\n+\t\t\t\terrors.append(\"\\n     You must install \").append(horribleModDependencyToStringMethod(dependency)).append(\" of \").append(depModId).append(\".\");\n \t\t\t} else {\n-\t\t\t\terrors.append(\"but the breaking version is present: \").append(depCandidate.getInfo().getVersion());\n+\t\t\t\tfinal String depCandidateVer = depCandidate.getInfo().getVersion().getFriendlyString();\n+\t\t\t\tif (cond) {\n+\t\t\t\t\terrors.append(\"but a different version is present: \").append(depCandidateVer).append(\"!\");\n+\t\t\t\t\terrors.append(\"\\n     You must install \").append(horribleModDependencyToStringMethod(dependency)).append(\" of \").append(depModId).append(\".\");\n+\t\t\t\t} else if (errorType.contains(\"conf\")) {\n+\t\t\t\t\t// CONFLICTS WITH\n+\t\t\t\t\terrors.append(\"but the conflicting version is present: \").append(depCandidateVer).append(\"!\");\n+\t\t\t\t\terrors.append(\"\\n     While this won't prevent you from starting the game, the developer(s) of \").append(candidate.getInfo().getId());\n+\t\t\t\t\terrors.append(\"\\n     have found that version \").append(depCandidateVer).append(\" of \").append(depModId);\n+\t\t\t\t\terrors.append(\"\\n     conflicts with their mod. It is heavily recommended to remove one of the mods.\");\n+\t\t\t\t} else {\n+\t\t\t\t\terrors.append(\"but the breaking version is present: \").append(depCandidate.getInfo().getVersion()).append(\"!\");\n+\t\t\t\t\terrors.append(\"\\n     The developer(s) of \").append(candidate.getInfo().getId());\n+\t\t\t\t\terrors.append(\"\\n     have found that version \").append(depCandidateVer).append(\" of \").append(depModId);\n+\t\t\t\t\terrors.append(\"\\n     critically conflicts with their mod. You must remove one of the mods.\");\n+\t\t\t\t}\n \t\t\t}\n \n-\t\t\terrors.append(\"!\");\n+\t\t\t//errors.append(\"!\");\n \t\t}\n \t}\n \n+\t// lord forgive me for what I must do\n+\tprivate static String horribleModDependencyToStringMethod(ModDependency dependency) {\n+\t\tString depStr = dependency.toString();\n+\t\tint verStart = depStr.indexOf('[');\n+\t\tif (verStart < 0)\n+\t\t\treturn \"unknown version\";\n+\t\tint verEnd = depStr.indexOf(']');\n+\t\tif (verEnd < verStart)\n+\t\t\treturn \"unknown version\";\n+\t\tString verStr = depStr.substring(verStart + 1, verEnd);\n+\t\tif (\"*\".equals(verStr))", "originalCommit": "1a66dcb3aa54880846a2e0bc306dc9b74db4623f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzg2Mzk2Nw==", "url": "https://github.com/FabricMC/fabric-loader/pull/277#discussion_r453863967", "bodyText": "should probably add a method on ModDependency to do this, really, since toString is implementation-independent\ncase in point: the current mess always returns \"unknown version\" for v0 mods", "author": "Leo40Git", "createdAt": "2020-07-13T18:57:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzg2MTMwNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDI5ODQ5OQ==", "url": "https://github.com/FabricMC/fabric-loader/pull/277#discussion_r454298499", "bodyText": "I did the thing, also it's a switch block now\nfor v0 mods: https://github.com/FabricMC/fabric-loader/pull/277/files#diff-3239f64a8e4a83838362f26163c22eedR333 (REQUIRES MORE WORK)\nfor v1 mods: https://github.com/FabricMC/fabric-loader/pull/277/files#diff-e7a80560353754b29221f3af67d286fcR303", "author": "Leo40Git", "createdAt": "2020-07-14T11:48:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzg2MTMwNw=="}], "type": "inlineReview"}, {"oid": "4531a204e3226f0cc5b443651ac4b5a1c0ba1687", "url": "https://github.com/FabricMC/fabric-loader/commit/4531a204e3226f0cc5b443651ac4b5a1c0ba1687", "message": "Split each error to their own \"append\" method\n\nRemove manual newlines from \"conflicts\" and \"breaks\" descriptions", "committedDate": "2020-07-14T08:19:37Z", "type": "commit"}, {"oid": "f01d49fd2100fc6d6a1357146860c139d7315c04", "url": "https://github.com/FabricMC/fabric-loader/commit/f01d49fd2100fc6d6a1357146860c139d7315c04", "message": "Improved the look of error descriptions\n\nFabricStatusTree: lines starting with \"INFO:\" now get appended to the last child as a sub-child\nUnsatisfied \"depends\", \"breaks\" and \"conflicts\" now use the dependency candidate's name instead of the dependency's mod ID", "committedDate": "2020-07-14T08:30:31Z", "type": "commit"}, {"oid": "7147b77c7fbbb081ade3a3be5a7ab424f207f4d7", "url": "https://github.com/FabricMC/fabric-loader/commit/7147b77c7fbbb081ade3a3be5a7ab424f207f4d7", "message": "Error descriptions will no longer break horribly on v0/v2+ schemas\n\nNote: Error descriptions for mods using v0 schema will still probably not look quite right", "committedDate": "2020-07-14T08:43:52Z", "type": "commit"}, {"oid": "b379ea8412eb7d7d9822fe631390bd28100f0a6c", "url": "https://github.com/FabricMC/fabric-loader/commit/b379ea8412eb7d7d9822fe631390bd28100f0a6c", "message": "Improve some wording, clean up console output", "committedDate": "2020-07-14T11:24:13Z", "type": "commit"}, {"oid": "47f794e92194815a40318448891d412180b1e047", "url": "https://github.com/FabricMC/fabric-loader/commit/47f794e92194815a40318448891d412180b1e047", "message": "Error descriptions now have info icon and are bold and brash\n\nMain error node now displays dependency candidate mod name if available", "committedDate": "2020-07-14T11:38:02Z", "type": "commit"}, {"oid": "043afe60889ed2ad410b8487ad3ce72024fa9914", "url": "https://github.com/FabricMC/fabric-loader/commit/043afe60889ed2ad410b8487ad3ce72024fa9914", "message": "Mod names are now wrapped in double quotes rather than single quotes", "committedDate": "2020-07-14T12:05:12Z", "type": "commit"}, {"oid": "81fed5b4d1e8e2a9635ed275d28acd10bd75a2a6", "url": "https://github.com/FabricMC/fabric-loader/commit/81fed5b4d1e8e2a9635ed275d28acd10bd75a2a6", "message": "Revert \"Mod names are now wrapped in double quotes rather than single quotes\"\n\nThis reverts commit 043afe60889ed2ad410b8487ad3ce72024fa9914.", "committedDate": "2020-07-14T12:45:43Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDU2MzI1NA==", "url": "https://github.com/FabricMC/fabric-loader/pull/277#discussion_r454563254", "bodyText": "I somewhat feel like exposing this is in api may not be a great idea for future translation support if someone writes that into loader.\nThis makes supporting translations in loader very hard as it does not expose the language aspect of these friendly version strings.\nMaybe until we decide on a translation system, this should be on a sort of AbstractModDependency", "author": "i509VCB", "createdAt": "2020-07-14T18:36:10Z", "path": "src/main/java/net/fabricmc/loader/api/metadata/ModDependency.java", "diffHunk": "@@ -33,4 +33,11 @@\n \t * @param version the version to check\n \t */\n \tboolean matches(Version version);\n+\n+\t/**\n+\t * Converts this dependency's version range to a user-friendly text representation.\n+\t *\n+\t * @return a user-friendly representation of this dependency's version range\n+\t */\n+\tString getFriendlyVersionString();", "originalCommit": "81fed5b4d1e8e2a9635ed275d28acd10bd75a2a6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDc3ODc2MA==", "url": "https://github.com/FabricMC/fabric-loader/pull/277#discussion_r454778760", "bodyText": "I could possibly return a Pair<VersionComparisonOperationEnum, String> or something like that here. Would also help with future features...", "author": "Leo40Git", "createdAt": "2020-07-15T04:09:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDU2MzI1NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDc4MTIzNQ==", "url": "https://github.com/FabricMC/fabric-loader/pull/277#discussion_r454781235", "bodyText": "Yeah maybe a sort of VersionComparisonType.", "author": "i509VCB", "createdAt": "2020-07-15T04:19:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDU2MzI1NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDkzNzI4MA==", "url": "https://github.com/FabricMC/fabric-loader/pull/277#discussion_r454937280", "bodyText": "AbstractModDependency and VersionRange are now things, please check 252d8f2", "author": "Leo40Git", "createdAt": "2020-07-15T10:01:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDU2MzI1NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDU2NDY2MA==", "url": "https://github.com/FabricMC/fabric-loader/pull/277#discussion_r454564660", "bodyText": "This implementation could be dragged to an AbstractModDependency so we don't have two copies.", "author": "i509VCB", "createdAt": "2020-07-14T18:38:45Z", "path": "src/main/java/net/fabricmc/loader/metadata/ModMetadataV1.java", "diffHunk": "@@ -300,6 +300,44 @@ public boolean matches(Version version) {\n \t\t\t\t\t\t\treturn false;\n \t\t\t\t\t\t}\n \n+\t\t\t\t\t\t@Override\n+\t\t\t\t\t\tpublic String getFriendlyVersionString() {", "originalCommit": "81fed5b4d1e8e2a9635ed275d28acd10bd75a2a6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDcwMTQ0Mg==", "url": "https://github.com/FabricMC/fabric-loader/pull/277#discussion_r454701442", "bodyText": "This shouldn't throw an exception, instead you could log an error and/or add an additional \"error\" node with the problem. (Or you could just ignore the tab, and not append it).", "author": "AlexIIL", "createdAt": "2020-07-14T23:25:00Z", "path": "src/main/java/net/fabricmc/loader/gui/FabricStatusTree.java", "diffHunk": "@@ -204,9 +204,32 @@ public void setInfo() {\n \t\t}\n \n \t\tpublic FabricStatusNode addChild(String string) {\n-\t\t\tFabricStatusNode child = new FabricStatusNode(this, string);\n-\t\t\tchildren.add(child);\n-\t\t\treturn child;\n+\t\t\tif (string.startsWith(\"\\t\")) {\n+\t\t\t\tif (children.size() == 0)\n+\t\t\t\t\tthrow new RuntimeException(\"Tried to add indented node without having a root node\");", "originalCommit": "81fed5b4d1e8e2a9635ed275d28acd10bd75a2a6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDcwMjI3Nw==", "url": "https://github.com/FabricMC/fabric-loader/pull/277#discussion_r454702277", "bodyText": "This should probably only remove the dash if the string starts with a dash rather than just finding the first one to remove.", "author": "AlexIIL", "createdAt": "2020-07-14T23:27:52Z", "path": "src/main/java/net/fabricmc/loader/gui/FabricStatusTree.java", "diffHunk": "@@ -204,9 +204,32 @@ public void setInfo() {\n \t\t}\n \n \t\tpublic FabricStatusNode addChild(String string) {\n-\t\t\tFabricStatusNode child = new FabricStatusNode(this, string);\n-\t\t\tchildren.add(child);\n-\t\t\treturn child;\n+\t\t\tif (string.startsWith(\"\\t\")) {\n+\t\t\t\tif (children.size() == 0)\n+\t\t\t\t\tthrow new RuntimeException(\"Tried to add indented node without having a root node\");\n+\t\t\t\tFabricStatusNode lastChild = children.get(children.size() - 1);\n+\t\t\t\tFabricStatusNode subChild = new FabricStatusNode(lastChild, emboldenForNode(string.substring(1)));\n+\t\t\t\tsubChild.warningLevel = FabricTreeWarningLevel.INFO;\n+\t\t\t\tlastChild.children.add(subChild);\n+\t\t\t\tlastChild.expandByDefault = true;\n+\t\t\t\treturn lastChild;\n+\t\t\t} else {\n+\t\t\t\tFabricStatusNode child = new FabricStatusNode(this, cleanForNode(string));\n+\t\t\t\tchildren.add(child);\n+\t\t\t\treturn child;\n+\t\t\t}\n+\t\t}\n+\n+\t\tprivate String cleanForNode(String string) {\n+\t\t\tint dashIndex = string.indexOf('-');\n+\t\t\tif (dashIndex > 0)\n+\t\t\t\tstring = string.substring(dashIndex + 1);\n+\t\t\tstring = string.trim();\n+\t\t\treturn string;", "originalCommit": "81fed5b4d1e8e2a9635ed275d28acd10bd75a2a6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDc3ODg4Ng==", "url": "https://github.com/FabricMC/fabric-loader/pull/277#discussion_r454778886", "bodyText": "whoops", "author": "Leo40Git", "createdAt": "2020-07-15T04:09:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDcwMjI3Nw=="}], "type": "inlineReview"}, {"oid": "252d8f26f67faa78b177567ec3877d4665f6f2aa", "url": "https://github.com/FabricMC/fabric-loader/commit/252d8f26f67faa78b177567ec3877d4665f6f2aa", "message": "Represent version ranges with data structures rather than strings\n\nAbstractModDependency is now a thing", "committedDate": "2020-07-15T09:57:19Z", "type": "commit"}, {"oid": "8d7cad30f3254dcda5455c5baa43a6012fd18720", "url": "https://github.com/FabricMC/fabric-loader/commit/8d7cad30f3254dcda5455c5baa43a6012fd18720", "message": "AlexIIL review changes\n\n- trying to add indented node before root node no longer crashes\n- fix dash removal to only remove dash if it's at the start of the string", "committedDate": "2020-07-15T10:05:29Z", "type": "commit"}, {"oid": "e664bac20feaa9a474d843acc2db288b0f5f496e", "url": "https://github.com/FabricMC/fabric-loader/commit/e664bac20feaa9a474d843acc2db288b0f5f496e", "message": "Merge branch 'master' into friendly-errors", "committedDate": "2020-07-15T10:06:47Z", "type": "commit"}, {"oid": "d500c28446a8d0e9d95e86817c5391e32357df8f", "url": "https://github.com/FabricMC/fabric-loader/commit/d500c28446a8d0e9d95e86817c5391e32357df8f", "message": "Log non-Fabric mod JARs", "committedDate": "2020-07-15T10:15:54Z", "type": "commit"}, {"oid": "5037a1ce7876b2d1e109a9cabd0d56f918890b34", "url": "https://github.com/FabricMC/fabric-loader/commit/5037a1ce7876b2d1e109a9cabd0d56f918890b34", "message": "Handle ^, ~ and string versions", "committedDate": "2020-07-15T10:43:42Z", "type": "commit"}, {"oid": "d616a1dd1616fc849c93e51b5b14fa445b056d43", "url": "https://github.com/FabricMC/fabric-loader/commit/d616a1dd1616fc849c93e51b5b14fa445b056d43", "message": "i guess this counts as an optimization", "committedDate": "2020-07-15T10:46:34Z", "type": "commit"}, {"oid": "adecf0462f100b0bf5bf556c3a9ce95fe2877c78", "url": "https://github.com/FabricMC/fabric-loader/commit/adecf0462f100b0bf5bf556c3a9ce95fe2877c78", "message": "streams are cool, i guess", "committedDate": "2020-07-15T11:17:11Z", "type": "commit"}, {"oid": "000498779edd98b0453f25bc09fcbeb2ac6d4826", "url": "https://github.com/FabricMC/fabric-loader/commit/000498779edd98b0453f25bc09fcbeb2ac6d4826", "message": "allow deeper node indentation", "committedDate": "2020-07-15T11:23:02Z", "type": "commit"}, {"oid": "f37d6afb9cb86b37518e211875298be54466b707", "url": "https://github.com/FabricMC/fabric-loader/commit/f37d6afb9cb86b37518e211875298be54466b707", "message": "AbstractModDependency: simplify version ranges, make it unmodifiable", "committedDate": "2020-07-15T14:09:17Z", "type": "commit"}, {"oid": "33f37a725e4321a597f61495d7085c137d28e512", "url": "https://github.com/FabricMC/fabric-loader/commit/33f37a725e4321a597f61495d7085c137d28e512", "message": "VersionRange: improve toString for SAME_MAJOR and SAME_MAJOR_AND_MINOR types", "committedDate": "2020-07-29T08:04:42Z", "type": "commit"}, {"oid": "8d23a7be69a4d66335283431a8596c075de3fc56", "url": "https://github.com/FabricMC/fabric-loader/commit/8d23a7be69a4d66335283431a8596c075de3fc56", "message": "VersionRange: add equals and hashCode because why not", "committedDate": "2020-07-29T08:21:57Z", "type": "commit"}, {"oid": "2962e602ae73bb32b4c16b42d27d4fa15d674f9d", "url": "https://github.com/FabricMC/fabric-loader/commit/2962e602ae73bb32b4c16b42d27d4fa15d674f9d", "message": "Remove TODO about alternate instructions\n\nVersionRange: cache toString result", "committedDate": "2020-08-02T08:43:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDMxMDI0Mw==", "url": "https://github.com/FabricMC/fabric-loader/pull/277#discussion_r470310243", "bodyText": "Run ./gradlew licenseFormat", "author": "liach", "createdAt": "2020-08-13T23:53:54Z", "path": "src/main/java/net/fabricmc/loader/api/VersionRange.java", "diffHunk": "@@ -0,0 +1,88 @@\n+package net.fabricmc.loader.api;", "originalCommit": "2962e602ae73bb32b4c16b42d27d4fa15d674f9d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDMxMTI4Mg==", "url": "https://github.com/FabricMC/fabric-loader/pull/277#discussion_r470311282", "bodyText": "Prefer moving this to a method within Type, like String represent(String version).\nPutting things here will make people forget to update if we add new entries to Type, and this forgotten problem is hard to spot as you have a default branch here.", "author": "liach", "createdAt": "2020-08-13T23:57:45Z", "path": "src/main/java/net/fabricmc/loader/api/VersionRange.java", "diffHunk": "@@ -0,0 +1,88 @@\n+package net.fabricmc.loader.api;\n+\n+import java.util.Objects;\n+\n+public class VersionRange {\n+\tpublic enum Type {\n+\t\tINVALID,\n+\t\tANY,\n+\t\tEQUALS,\n+\t\tGREATER_THAN,\n+\t\tLESSER_THAN,\n+\t\tGREATER_THAN_OR_EQUAL,\n+\t\tLESSER_THAN_OR_EQUAL,\n+\t\tSAME_MAJOR,\n+\t\tSAME_MAJOR_AND_MINOR\n+\t}\n+\n+\tprivate final Type type;\n+\tprivate final String version;\n+\tprivate String stringRepr;\n+\n+\tpublic VersionRange(Type type, String version) {\n+\t\tthis.type = type;\n+\t\tthis.version = version;\n+\t}\n+\n+\tpublic Type getType() {\n+\t\treturn type;\n+\t}\n+\n+\tpublic String getVersion() {\n+\t\treturn version;\n+\t}\n+\n+\tprivate String makeStringRepr() {\n+\t\tswitch (type) {", "originalCommit": "2962e602ae73bb32b4c16b42d27d4fa15d674f9d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDQzNDA3Nw==", "url": "https://github.com/FabricMC/fabric-loader/pull/277#discussion_r470434077", "bodyText": "moved.\ni've also changed the default branch to actually say that something is wrong (\"unhandled version range type X\").", "author": "Leo40Git", "createdAt": "2020-08-14T06:27:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDMxMTI4Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDMxMTgzMQ==", "url": "https://github.com/FabricMC/fabric-loader/pull/277#discussion_r470311831", "bodyText": "Please run this over fabric checkstyle. This clearly violates fabric checkstyle as fab checkstyle requires blank lines before and after if blocks with {}", "author": "liach", "createdAt": "2020-08-13T23:59:47Z", "path": "src/main/java/net/fabricmc/loader/api/VersionRange.java", "diffHunk": "@@ -0,0 +1,88 @@\n+package net.fabricmc.loader.api;\n+\n+import java.util.Objects;\n+\n+public class VersionRange {\n+\tpublic enum Type {\n+\t\tINVALID,\n+\t\tANY,\n+\t\tEQUALS,\n+\t\tGREATER_THAN,\n+\t\tLESSER_THAN,\n+\t\tGREATER_THAN_OR_EQUAL,\n+\t\tLESSER_THAN_OR_EQUAL,\n+\t\tSAME_MAJOR,\n+\t\tSAME_MAJOR_AND_MINOR\n+\t}\n+\n+\tprivate final Type type;\n+\tprivate final String version;\n+\tprivate String stringRepr;\n+\n+\tpublic VersionRange(Type type, String version) {\n+\t\tthis.type = type;\n+\t\tthis.version = version;\n+\t}\n+\n+\tpublic Type getType() {\n+\t\treturn type;\n+\t}\n+\n+\tpublic String getVersion() {\n+\t\treturn version;\n+\t}\n+\n+\tprivate String makeStringRepr() {\n+\t\tswitch (type) {\n+\t\t\tdefault:\n+\t\t\tcase INVALID:\n+\t\t\t\treturn \"unknown version\";\n+\t\t\tcase ANY:\n+\t\t\t\treturn \"any version\";\n+\t\t\tcase EQUALS:\n+\t\t\t\treturn \"version \" + version;\n+\t\t\tcase GREATER_THAN:\n+\t\t\t\treturn \"any version after \" + version;\n+\t\t\tcase LESSER_THAN:\n+\t\t\t\treturn \"any version before \" + version;\n+\t\t\tcase GREATER_THAN_OR_EQUAL:\n+\t\t\t\treturn \"version \" + version + \" or later\";\n+\t\t\tcase LESSER_THAN_OR_EQUAL:\n+\t\t\t\treturn \"version \" + version + \" or earlier\";\n+\t\t\tcase SAME_MAJOR:\n+\t\t\tcase SAME_MAJOR_AND_MINOR:\n+\t\t\t\tString[] parts = version.split(\"\\\\.\");\n+\t\t\t\tint start = 1;\n+\t\t\t\tif (type == Type.SAME_MAJOR_AND_MINOR)\n+\t\t\t\t\tstart = 2;\n+\t\t\t\tfor (int i = start; i < parts.length; i++)\n+\t\t\t\t\tparts[i] = \"x\";\n+\t\t\t\treturn \"version \" + String.join(\".\", parts);\n+\t\t}\n+\t}\n+\n+\t@Override\n+\tpublic String toString() {\n+\t\tif (stringRepr == null)\n+\t\t\tstringRepr = makeStringRepr();\n+\t\treturn stringRepr;\n+\t}\n+\n+\t@Override\n+\tpublic boolean equals(Object o) {\n+\t\tif (this == o) {\n+\t\t\treturn true;\n+\t\t}\n+\t\tif (o == null || getClass() != o.getClass()) {", "originalCommit": "2962e602ae73bb32b4c16b42d27d4fa15d674f9d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDMxMjMxNQ==", "url": "https://github.com/FabricMC/fabric-loader/pull/277#discussion_r470312315", "bodyText": "Also maintainability concern here. Should add to VersionRange so we have an easier time maintaining this. Leaving this here will most likely make us forget this code and make updates to version range code out of sync.", "author": "liach", "createdAt": "2020-08-14T00:01:27Z", "path": "src/main/java/net/fabricmc/loader/api/metadata/AbstractModDependency.java", "diffHunk": "@@ -0,0 +1,69 @@\n+package net.fabricmc.loader.api.metadata;\n+\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.HashSet;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n+\n+import net.fabricmc.loader.api.VersionRange;\n+\n+public abstract class AbstractModDependency implements ModDependency {\n+\tprotected final String modId;\n+\tprivate Collection<VersionRange> ranges;\n+\n+\tprotected AbstractModDependency(String modId) {\n+\t\tthis.modId = modId;\n+\t}\n+\n+\t@Override\n+\tpublic String getModId() {\n+\t\treturn modId;\n+\t}\n+\n+\tprotected abstract String[] getVersionMatchers();\n+\n+\t@Override\n+\tpublic Collection<VersionRange> getVersionRanges() {\n+\t\tif (ranges == null) {\n+\t\t\tranges = Stream.of(getVersionMatchers()).map(matcher -> {\n+\t\t\t\tchar firstChar = matcher.charAt(0);\n+\t\t\t\tchar secondChar = 0;\n+\t\t\t\tif (matcher.length() > 1)\n+\t\t\t\t\tsecondChar = matcher.charAt(1);\n+\t\t\t\tswitch (firstChar) {", "originalCommit": "2962e602ae73bb32b4c16b42d27d4fa15d674f9d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDQzNDM0MA==", "url": "https://github.com/FabricMC/fabric-loader/pull/277#discussion_r470434340", "bodyText": "moved to static Collection<VersionRange> fromVersionMatchers(String... matchers) in VersionRange", "author": "Leo40Git", "createdAt": "2020-08-14T06:28:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDMxMjMxNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDMxMjQ1Mw==", "url": "https://github.com/FabricMC/fabric-loader/pull/277#discussion_r470312453", "bodyText": "maybe getVersionRequirements, nitpick", "author": "liach", "createdAt": "2020-08-14T00:02:00Z", "path": "src/main/java/net/fabricmc/loader/api/metadata/ModDependency.java", "diffHunk": "@@ -33,4 +36,11 @@\n \t * @param version the version to check\n \t */\n \tboolean matches(Version version);\n+\n+\t/**\n+\t * Returns a representation of the dependency's version requirements.\n+\t *\n+\t * @return representation of the dependency's version requirements\n+\t */\n+\tCollection<VersionRange> getVersionRanges();", "originalCommit": "2962e602ae73bb32b4c16b42d27d4fa15d674f9d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "c1279f04555e953d289cf0168fdc42ac82707013", "url": "https://github.com/FabricMC/fabric-loader/commit/c1279f04555e953d289cf0168fdc42ac82707013", "message": "liach review changes\n\n- license and checkstyle\n- ModDependency: getVersionRanges to getVersionRequirements\n- VersionRange:\n  - add fromVersionMatchers (contents moved from AbstractModDependency.getVersionRequirements)\n  - add Type.represent (contents moved from VersionRange.makeStringRepr, now deleted)", "committedDate": "2020-08-14T06:22:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDcxMTYxNA==", "url": "https://github.com/FabricMC/fabric-loader/pull/277#discussion_r470711614", "bodyText": "I'd make this throw an exception, or move the branches into the enum values themselves.", "author": "Juuxel", "createdAt": "2020-08-14T15:55:33Z", "path": "src/main/java/net/fabricmc/loader/api/VersionRange.java", "diffHunk": "@@ -0,0 +1,166 @@\n+/*\n+ * Copyright 2016 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.loader.api;\n+\n+import java.util.Arrays;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.Objects;\n+import java.util.stream.Collectors;\n+\n+public class VersionRange {\n+\tpublic enum Type {\n+\t\tINVALID,\n+\t\tANY,\n+\t\tEQUALS,\n+\t\tGREATER_THAN,\n+\t\tLESSER_THAN,\n+\t\tGREATER_THAN_OR_EQUAL,\n+\t\tLESSER_THAN_OR_EQUAL,\n+\t\tSAME_MAJOR,\n+\t\tSAME_MAJOR_AND_MINOR;\n+\n+\t\tpublic String represent(String version) {\n+\t\t\tswitch (this) {\n+\t\t\tcase INVALID:\n+\t\t\t\treturn \"unknown version\";\n+\t\t\tcase ANY:\n+\t\t\t\treturn \"any version\";\n+\t\t\tcase EQUALS:\n+\t\t\t\treturn \"version \" + version;\n+\t\t\tcase GREATER_THAN:\n+\t\t\t\treturn \"any version after \" + version;\n+\t\t\tcase LESSER_THAN:\n+\t\t\t\treturn \"any version before \" + version;\n+\t\t\tcase GREATER_THAN_OR_EQUAL:\n+\t\t\t\treturn \"version \" + version + \" or later\";\n+\t\t\tcase LESSER_THAN_OR_EQUAL:\n+\t\t\t\treturn \"version \" + version + \" or earlier\";\n+\t\t\tcase SAME_MAJOR:\n+\t\t\tcase SAME_MAJOR_AND_MINOR:\n+\t\t\t\tString[] parts = version.split(\"\\\\.\");\n+\t\t\t\tint start = 1;\n+\n+\t\t\t\tif (this == Type.SAME_MAJOR_AND_MINOR) {\n+\t\t\t\t\tstart = 2;\n+\t\t\t\t}\n+\n+\t\t\t\tfor (int i = start; i < parts.length; i++) {\n+\t\t\t\t\tparts[i] = \"x\";\n+\t\t\t\t}\n+\n+\t\t\t\treturn \"version \" + String.join(\".\", parts);\n+\t\t\tdefault:\n+\t\t\t\treturn \"unhandled version range type \" + this;", "originalCommit": "c1279f04555e953d289cf0168fdc42ac82707013", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc2MTA0OQ==", "url": "https://github.com/FabricMC/fabric-loader/pull/277#discussion_r470761049", "bodyText": "542fa57: it's a UnaryOperator<String> now i guess", "author": "Leo40Git", "createdAt": "2020-08-14T17:33:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDcxMTYxNA=="}], "type": "inlineReview"}, {"oid": "542fa57664e489bfb89fa6608e0317374f9dfbc1", "url": "https://github.com/FabricMC/fabric-loader/commit/542fa57664e489bfb89fa6608e0317374f9dfbc1", "message": "move Type.represent case branches into lambda on each enum value", "committedDate": "2020-08-14T17:31:59Z", "type": "commit"}, {"oid": "df2274d81c9e33633fcb5e320e26adb6ef21e12d", "url": "https://github.com/FabricMC/fabric-loader/commit/df2274d81c9e33633fcb5e320e26adb6ef21e12d", "message": "Invalid ID error descriptions are now also affected\n\nTheoretically, an error of this type should not reach the user...", "committedDate": "2020-08-14T18:02:11Z", "type": "commit"}, {"oid": "8cc6ed62b4c1f644e9cd6c8d6765e25b2117089e", "url": "https://github.com/FabricMC/fabric-loader/commit/8cc6ed62b4c1f644e9cd6c8d6765e25b2117089e", "message": "Light cleanup in ModResolver\n\n- Removed the extra \"prefix\" StringBuilder, common prefix is now added directly to destination SB\n- \"Invalid ID\" errors now use the 'mod name' (mod ID) format\n- Removed unused ModDependency parameter from appendConflictError and appendBreakingError (leftover from a scrapped feature)", "committedDate": "2020-08-20T19:07:13Z", "type": "commit"}, {"oid": "cca88b89b989ab57acc6c8b57485ee9932179d32", "url": "https://github.com/FabricMC/fabric-loader/commit/cca88b89b989ab57acc6c8b57485ee9932179d32", "message": "Improve invalid char display", "committedDate": "2020-08-20T19:11:54Z", "type": "commit"}, {"oid": "a1da19a330478f634beddaf9947110447b514f54", "url": "https://github.com/FabricMC/fabric-loader/commit/a1da19a330478f634beddaf9947110447b514f54", "message": "Merge remote-tracking branch 'upstream/master' into friendly-errors", "committedDate": "2020-09-18T17:49:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzE4Nzg3Mg==", "url": "https://github.com/FabricMC/fabric-loader/pull/277#discussion_r497187872", "bodyText": "This shouldn't be in api imo.", "author": "i509VCB", "createdAt": "2020-09-30T01:05:25Z", "path": "src/main/java/net/fabricmc/loader/api/metadata/AbstractModDependency.java", "diffHunk": "@@ -0,0 +1,46 @@\n+/*\n+ * Copyright 2016 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.loader.api.metadata;\n+\n+import java.util.Collection;\n+\n+import net.fabricmc.loader.api.VersionRange;\n+\n+public abstract class AbstractModDependency implements ModDependency {", "originalCommit": "a1da19a330478f634beddaf9947110447b514f54", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzE4NjMyMw==", "url": "https://github.com/FabricMC/fabric-loader/pull/277#discussion_r497186323", "bodyText": "I don't think this class needs to be part of the API. From what I can tell this can be a package private class in metadata.", "author": "sfPlayer1", "createdAt": "2020-09-30T00:59:01Z", "path": "src/main/java/net/fabricmc/loader/api/metadata/AbstractModDependency.java", "diffHunk": "@@ -0,0 +1,46 @@\n+/*\n+ * Copyright 2016 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.loader.api.metadata;\n+\n+import java.util.Collection;\n+\n+import net.fabricmc.loader.api.VersionRange;\n+\n+public abstract class AbstractModDependency implements ModDependency {", "originalCommit": "a1da19a330478f634beddaf9947110447b514f54", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzE4Njc5MQ==", "url": "https://github.com/FabricMC/fabric-loader/pull/277#discussion_r497186791", "bodyText": "This should return a Set in order to have a useful contract for equals, Collection's is too weak for the desired semantics.\n\"VersionMatchers\" is a somewhat odd term, it'd call it parse.", "author": "sfPlayer1", "createdAt": "2020-09-30T01:00:57Z", "path": "src/main/java/net/fabricmc/loader/api/VersionRange.java", "diffHunk": "@@ -0,0 +1,158 @@\n+/*\n+ * Copyright 2016 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.loader.api;\n+\n+import java.util.Arrays;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.Objects;\n+import java.util.function.UnaryOperator;\n+import java.util.stream.Collectors;\n+\n+public class VersionRange {\n+\tpublic enum Type {\n+\t\tINVALID(version -> \"unknown version\"),\n+\t\tANY(version -> \"any version\"),\n+\t\tEQUALS(version -> \"version \" + version),\n+\t\tGREATER_THAN(version -> \"any version after \" + version),\n+\t\tLESSER_THAN(version -> \"any version before \" + version),\n+\t\tGREATER_THAN_OR_EQUAL(version -> \"version \" + version + \" or later\"),\n+\t\tLESSER_THAN_OR_EQUAL(version -> \"version \" + version + \" or earlier\"),\n+\t\tSAME_MAJOR(version -> {\n+\t\t\tString[] parts = version.split(\"\\\\.\");\n+\n+\t\t\tfor (int i = 1; i < parts.length; i++) {\n+\t\t\t\tparts[i] = \"x\";\n+\t\t\t}\n+\n+\t\t\treturn \"version \" + String.join(\".\", parts);\n+\t\t}),\n+\t\tSAME_MAJOR_AND_MINOR(version -> {\n+\t\t\tString[] parts = version.split(\"\\\\.\");\n+\n+\t\t\tfor (int i = 2; i < parts.length; i++) {\n+\t\t\t\tparts[i] = \"x\";\n+\t\t\t}\n+\n+\t\t\treturn \"version \" + String.join(\".\", parts);\n+\t\t});\n+\n+\t\tprivate final UnaryOperator<String> reprOperator;\n+\n+\t\tType(UnaryOperator<String> reprOperator) {\n+\t\t\tthis.reprOperator = reprOperator;\n+\t\t}\n+\n+\t\tpublic String represent(String version) {\n+\t\t\treturn reprOperator.apply(version);\n+\t\t}\n+\t}\n+\n+\tprivate final Type type;\n+\tprivate final String version;\n+\tprivate String stringRepr;\n+\n+\tpublic VersionRange(Type type, String version) {\n+\t\tthis.type = type;\n+\t\tthis.version = version;\n+\t}\n+\n+\tpublic Type getType() {\n+\t\treturn type;\n+\t}\n+\n+\tpublic String getVersion() {\n+\t\treturn version;\n+\t}\n+\n+\t@Override\n+\tpublic String toString() {\n+\t\tif (stringRepr == null) {\n+\t\t\tstringRepr = type.represent(version);\n+\t\t}\n+\n+\t\treturn stringRepr;\n+\t}\n+\n+\t@Override\n+\tpublic boolean equals(Object o) {\n+\t\tif (this == o) {\n+\t\t\treturn true;\n+\t\t}\n+\n+\t\tif (o == null || getClass() != o.getClass()) {\n+\t\t\treturn false;\n+\t\t}\n+\n+\t\tVersionRange that = (VersionRange) o;\n+\t\treturn type == that.type && version.equals(that.version);\n+\t}\n+\n+\t@Override\n+\tpublic int hashCode() {\n+\t\treturn Objects.hash(type, version);\n+\t}\n+\n+\tpublic static Collection<VersionRange> fromVersionMatchers(String... matchers) {", "originalCommit": "a1da19a330478f634beddaf9947110447b514f54", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzQ0Mzg1MA==", "url": "https://github.com/FabricMC/fabric-loader/pull/277#discussion_r497443850", "bodyText": "I'm like 90% sure it's already a Set internally so that should be easy\n\"VersionMatchers\" are my unofficial name for the semantic version range strings. I guess parse(String... rangeStrings) makes more sense, though.", "author": "Leo40Git", "createdAt": "2020-09-30T11:43:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzE4Njc5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzQ3Mzk3OQ==", "url": "https://github.com/FabricMC/fabric-loader/pull/277#discussion_r497473979", "bodyText": "This method is now public static Set<VersionPredicate> parse(String... matchers).", "author": "Leo40Git", "createdAt": "2020-09-30T12:36:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzE4Njc5MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzE4Njg5NQ==", "url": "https://github.com/FabricMC/fabric-loader/pull/277#discussion_r497186895", "bodyText": "I don't think this cache is worth it.\nReturning a normalized formal version predicate would fit this better (same format as parse input, e.g. effectively \">=\".concat(version))", "author": "sfPlayer1", "createdAt": "2020-09-30T01:01:28Z", "path": "src/main/java/net/fabricmc/loader/api/VersionRange.java", "diffHunk": "@@ -0,0 +1,158 @@\n+/*\n+ * Copyright 2016 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.loader.api;\n+\n+import java.util.Arrays;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.Objects;\n+import java.util.function.UnaryOperator;\n+import java.util.stream.Collectors;\n+\n+public class VersionRange {\n+\tpublic enum Type {\n+\t\tINVALID(version -> \"unknown version\"),\n+\t\tANY(version -> \"any version\"),\n+\t\tEQUALS(version -> \"version \" + version),\n+\t\tGREATER_THAN(version -> \"any version after \" + version),\n+\t\tLESSER_THAN(version -> \"any version before \" + version),\n+\t\tGREATER_THAN_OR_EQUAL(version -> \"version \" + version + \" or later\"),\n+\t\tLESSER_THAN_OR_EQUAL(version -> \"version \" + version + \" or earlier\"),\n+\t\tSAME_MAJOR(version -> {\n+\t\t\tString[] parts = version.split(\"\\\\.\");\n+\n+\t\t\tfor (int i = 1; i < parts.length; i++) {\n+\t\t\t\tparts[i] = \"x\";\n+\t\t\t}\n+\n+\t\t\treturn \"version \" + String.join(\".\", parts);\n+\t\t}),\n+\t\tSAME_MAJOR_AND_MINOR(version -> {\n+\t\t\tString[] parts = version.split(\"\\\\.\");\n+\n+\t\t\tfor (int i = 2; i < parts.length; i++) {\n+\t\t\t\tparts[i] = \"x\";\n+\t\t\t}\n+\n+\t\t\treturn \"version \" + String.join(\".\", parts);\n+\t\t});\n+\n+\t\tprivate final UnaryOperator<String> reprOperator;\n+\n+\t\tType(UnaryOperator<String> reprOperator) {\n+\t\t\tthis.reprOperator = reprOperator;\n+\t\t}\n+\n+\t\tpublic String represent(String version) {\n+\t\t\treturn reprOperator.apply(version);\n+\t\t}\n+\t}\n+\n+\tprivate final Type type;\n+\tprivate final String version;\n+\tprivate String stringRepr;\n+\n+\tpublic VersionRange(Type type, String version) {\n+\t\tthis.type = type;\n+\t\tthis.version = version;\n+\t}\n+\n+\tpublic Type getType() {\n+\t\treturn type;\n+\t}\n+\n+\tpublic String getVersion() {\n+\t\treturn version;\n+\t}\n+\n+\t@Override\n+\tpublic String toString() {\n+\t\tif (stringRepr == null) {\n+\t\t\tstringRepr = type.represent(version);\n+\t\t}\n+\n+\t\treturn stringRepr;", "originalCommit": "a1da19a330478f634beddaf9947110447b514f54", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzQ3NDI2MA==", "url": "https://github.com/FabricMC/fabric-loader/pull/277#discussion_r497474260", "bodyText": "Cache has been snatched", "author": "Leo40Git", "createdAt": "2020-09-30T12:37:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzE4Njg5NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzE4NzM0OQ==", "url": "https://github.com/FabricMC/fabric-loader/pull/277#discussion_r497187349", "bodyText": "I don't think invalid should exist, the existing parser seems to treat weird inputs as an equality requirement.", "author": "sfPlayer1", "createdAt": "2020-09-30T01:03:24Z", "path": "src/main/java/net/fabricmc/loader/api/VersionRange.java", "diffHunk": "@@ -0,0 +1,158 @@\n+/*\n+ * Copyright 2016 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.loader.api;\n+\n+import java.util.Arrays;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.Objects;\n+import java.util.function.UnaryOperator;\n+import java.util.stream.Collectors;\n+\n+public class VersionRange {\n+\tpublic enum Type {\n+\t\tINVALID(version -> \"unknown version\"),", "originalCommit": "a1da19a330478f634beddaf9947110447b514f54", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzQ0NTAxMw==", "url": "https://github.com/FabricMC/fabric-loader/pull/277#discussion_r497445013", "bodyText": "I'm pretty sure there's currently no way to get an actual INVALID range without messing with the program itself, since I treat anything that doesn't have a semantic version prefix as string version equality.\nI do think it's a good idea to keep an \"oh god oh fuck\" value that isn't a potentially-crashing null, though.", "author": "Leo40Git", "createdAt": "2020-09-30T11:45:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzE4NzM0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzQ3NDkwMQ==", "url": "https://github.com/FabricMC/fabric-loader/pull/277#discussion_r497474901", "bodyText": "So INVALID was only used for \"*moretext\" type situations. Those now just generate a standard ANY predicate, if they're supposed to be equality shout at me.", "author": "Leo40Git", "createdAt": "2020-09-30T12:38:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzE4NzM0OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzE4NzUzNw==", "url": "https://github.com/FabricMC/fabric-loader/pull/277#discussion_r497187537", "bodyText": "For-each loop is cleaner IMO, and definitely easier to debug.", "author": "sfPlayer1", "createdAt": "2020-09-30T01:04:10Z", "path": "src/main/java/net/fabricmc/loader/api/VersionRange.java", "diffHunk": "@@ -0,0 +1,158 @@\n+/*\n+ * Copyright 2016 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.loader.api;\n+\n+import java.util.Arrays;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.Objects;\n+import java.util.function.UnaryOperator;\n+import java.util.stream.Collectors;\n+\n+public class VersionRange {\n+\tpublic enum Type {\n+\t\tINVALID(version -> \"unknown version\"),\n+\t\tANY(version -> \"any version\"),\n+\t\tEQUALS(version -> \"version \" + version),\n+\t\tGREATER_THAN(version -> \"any version after \" + version),\n+\t\tLESSER_THAN(version -> \"any version before \" + version),\n+\t\tGREATER_THAN_OR_EQUAL(version -> \"version \" + version + \" or later\"),\n+\t\tLESSER_THAN_OR_EQUAL(version -> \"version \" + version + \" or earlier\"),\n+\t\tSAME_MAJOR(version -> {\n+\t\t\tString[] parts = version.split(\"\\\\.\");\n+\n+\t\t\tfor (int i = 1; i < parts.length; i++) {\n+\t\t\t\tparts[i] = \"x\";\n+\t\t\t}\n+\n+\t\t\treturn \"version \" + String.join(\".\", parts);\n+\t\t}),\n+\t\tSAME_MAJOR_AND_MINOR(version -> {\n+\t\t\tString[] parts = version.split(\"\\\\.\");\n+\n+\t\t\tfor (int i = 2; i < parts.length; i++) {\n+\t\t\t\tparts[i] = \"x\";\n+\t\t\t}\n+\n+\t\t\treturn \"version \" + String.join(\".\", parts);\n+\t\t});\n+\n+\t\tprivate final UnaryOperator<String> reprOperator;\n+\n+\t\tType(UnaryOperator<String> reprOperator) {\n+\t\t\tthis.reprOperator = reprOperator;\n+\t\t}\n+\n+\t\tpublic String represent(String version) {\n+\t\t\treturn reprOperator.apply(version);\n+\t\t}\n+\t}\n+\n+\tprivate final Type type;\n+\tprivate final String version;\n+\tprivate String stringRepr;\n+\n+\tpublic VersionRange(Type type, String version) {\n+\t\tthis.type = type;\n+\t\tthis.version = version;\n+\t}\n+\n+\tpublic Type getType() {\n+\t\treturn type;\n+\t}\n+\n+\tpublic String getVersion() {\n+\t\treturn version;\n+\t}\n+\n+\t@Override\n+\tpublic String toString() {\n+\t\tif (stringRepr == null) {\n+\t\t\tstringRepr = type.represent(version);\n+\t\t}\n+\n+\t\treturn stringRepr;\n+\t}\n+\n+\t@Override\n+\tpublic boolean equals(Object o) {\n+\t\tif (this == o) {\n+\t\t\treturn true;\n+\t\t}\n+\n+\t\tif (o == null || getClass() != o.getClass()) {\n+\t\t\treturn false;\n+\t\t}\n+\n+\t\tVersionRange that = (VersionRange) o;\n+\t\treturn type == that.type && version.equals(that.version);\n+\t}\n+\n+\t@Override\n+\tpublic int hashCode() {\n+\t\treturn Objects.hash(type, version);\n+\t}\n+\n+\tpublic static Collection<VersionRange> fromVersionMatchers(String... matchers) {\n+\t\tCollection<VersionRange> ranges = Arrays.stream(matchers).map(matcher -> {", "originalCommit": "a1da19a330478f634beddaf9947110447b514f54", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzE4NzcxMA==", "url": "https://github.com/FabricMC/fabric-loader/pull/277#discussion_r497187710", "bodyText": "This could be handled in the above analysis inline.", "author": "sfPlayer1", "createdAt": "2020-09-30T01:04:54Z", "path": "src/main/java/net/fabricmc/loader/api/VersionRange.java", "diffHunk": "@@ -0,0 +1,158 @@\n+/*\n+ * Copyright 2016 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.loader.api;\n+\n+import java.util.Arrays;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.Objects;\n+import java.util.function.UnaryOperator;\n+import java.util.stream.Collectors;\n+\n+public class VersionRange {\n+\tpublic enum Type {\n+\t\tINVALID(version -> \"unknown version\"),\n+\t\tANY(version -> \"any version\"),\n+\t\tEQUALS(version -> \"version \" + version),\n+\t\tGREATER_THAN(version -> \"any version after \" + version),\n+\t\tLESSER_THAN(version -> \"any version before \" + version),\n+\t\tGREATER_THAN_OR_EQUAL(version -> \"version \" + version + \" or later\"),\n+\t\tLESSER_THAN_OR_EQUAL(version -> \"version \" + version + \" or earlier\"),\n+\t\tSAME_MAJOR(version -> {\n+\t\t\tString[] parts = version.split(\"\\\\.\");\n+\n+\t\t\tfor (int i = 1; i < parts.length; i++) {\n+\t\t\t\tparts[i] = \"x\";\n+\t\t\t}\n+\n+\t\t\treturn \"version \" + String.join(\".\", parts);\n+\t\t}),\n+\t\tSAME_MAJOR_AND_MINOR(version -> {\n+\t\t\tString[] parts = version.split(\"\\\\.\");\n+\n+\t\t\tfor (int i = 2; i < parts.length; i++) {\n+\t\t\t\tparts[i] = \"x\";\n+\t\t\t}\n+\n+\t\t\treturn \"version \" + String.join(\".\", parts);\n+\t\t});\n+\n+\t\tprivate final UnaryOperator<String> reprOperator;\n+\n+\t\tType(UnaryOperator<String> reprOperator) {\n+\t\t\tthis.reprOperator = reprOperator;\n+\t\t}\n+\n+\t\tpublic String represent(String version) {\n+\t\t\treturn reprOperator.apply(version);\n+\t\t}\n+\t}\n+\n+\tprivate final Type type;\n+\tprivate final String version;\n+\tprivate String stringRepr;\n+\n+\tpublic VersionRange(Type type, String version) {\n+\t\tthis.type = type;\n+\t\tthis.version = version;\n+\t}\n+\n+\tpublic Type getType() {\n+\t\treturn type;\n+\t}\n+\n+\tpublic String getVersion() {\n+\t\treturn version;\n+\t}\n+\n+\t@Override\n+\tpublic String toString() {\n+\t\tif (stringRepr == null) {\n+\t\t\tstringRepr = type.represent(version);\n+\t\t}\n+\n+\t\treturn stringRepr;\n+\t}\n+\n+\t@Override\n+\tpublic boolean equals(Object o) {\n+\t\tif (this == o) {\n+\t\t\treturn true;\n+\t\t}\n+\n+\t\tif (o == null || getClass() != o.getClass()) {\n+\t\t\treturn false;\n+\t\t}\n+\n+\t\tVersionRange that = (VersionRange) o;\n+\t\treturn type == that.type && version.equals(that.version);\n+\t}\n+\n+\t@Override\n+\tpublic int hashCode() {\n+\t\treturn Objects.hash(type, version);\n+\t}\n+\n+\tpublic static Collection<VersionRange> fromVersionMatchers(String... matchers) {\n+\t\tCollection<VersionRange> ranges = Arrays.stream(matchers).map(matcher -> {\n+\t\t\tchar firstChar = matcher.charAt(0);\n+\t\t\tchar secondChar = 0;\n+\n+\t\t\tif (matcher.length() > 1) {\n+\t\t\t\tsecondChar = matcher.charAt(1);\n+\t\t\t}\n+\n+\t\t\tswitch (firstChar) {\n+\t\t\tcase '*':\n+\t\t\t\tif (matcher.length() == 1) {\n+\t\t\t\t\treturn new VersionRange(Type.ANY, \"\");\n+\t\t\t\t} else {\n+\t\t\t\t\treturn new VersionRange(Type.INVALID, \"\");\n+\t\t\t\t}\n+\t\t\tcase '>':\n+\t\t\t\tif (secondChar == '=') {\n+\t\t\t\t\treturn new VersionRange(Type.GREATER_THAN_OR_EQUAL, matcher.substring(2));\n+\t\t\t\t} else {\n+\t\t\t\t\treturn new VersionRange(Type.GREATER_THAN, matcher.substring(1));\n+\t\t\t\t}\n+\t\t\tcase '<':\n+\t\t\t\tif (secondChar == '=') {\n+\t\t\t\t\treturn new VersionRange(Type.LESSER_THAN_OR_EQUAL, matcher.substring(2));\n+\t\t\t\t} else {\n+\t\t\t\t\treturn new VersionRange(Type.LESSER_THAN, matcher.substring(1));\n+\t\t\t\t}\n+\t\t\tcase '=':\n+\t\t\t\treturn new VersionRange(Type.EQUALS, matcher.substring(1));\n+\t\t\tcase '^':\n+\t\t\t\treturn new VersionRange(Type.SAME_MAJOR, matcher.substring(1));\n+\t\t\tcase '~':\n+\t\t\t\treturn new VersionRange(Type.SAME_MAJOR_AND_MINOR, matcher.substring(1));\n+\t\t\tdefault: // string version\n+\t\t\t\treturn new VersionRange(Type.EQUALS, matcher);\n+\t\t\t}\n+\t\t}).collect(Collectors.toSet());\n+\n+\t\t// simplify: if one ANY range exists, only use that\n+\t\tif (ranges.stream().anyMatch(range -> range.getType() == Type.ANY)) {", "originalCommit": "a1da19a330478f634beddaf9947110447b514f54", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzE4ODgwNQ==", "url": "https://github.com/FabricMC/fabric-loader/pull/277#discussion_r497188805", "bodyText": "A lot of the message assembly below could be done with PrintWriter and printf, which should look cleaner and lend itself to localization later on. This change can be done at another time though.", "author": "sfPlayer1", "createdAt": "2020-09-30T01:09:09Z", "path": "src/main/java/net/fabricmc/loader/discovery/ModResolver.java", "diffHunk": "@@ -314,46 +315,82 @@ private static IVecInt toVecInt(IntStream stream) {\n \tprivate void addErrorToList(ModCandidate candidate, ModDependency dependency, Map<String, ModCandidate> result, StringBuilder errors, String errorType, boolean cond) {\n \t\tString depModId = dependency.getModId();\n \n-\t\tStringBuilder prefix = new StringBuilder(\"\\n - Mod \").append(candidate.getInfo().getId());\n-\t\tprefix.append(\" \").append(errorType).append(\" mod \").append(depModId);\n+\t\terrors.append(\"\\n - Mod \").append(getCandidateName(candidate)).append(\" \").append(errorType).append(\" \");\n \n \t\tList<String> errorList = new ArrayList<>();\n \n \t\tif (!isModIdValid(depModId, errorList)) {\n-\t\t\tif (errorList.size() == 1) {\n-\t\t\t\terrors.append(prefix).append(\" which has an invalid mod id because it \").append(errorList.get(0));\n-\t\t\t} else {\n-\t\t\t\terrors.append(prefix).append(\" which has an invalid mod because:\");\n+\t\t\terrors.append(depModId).append(\", which has an invalid mod ID because:\");\n \n-\t\t\t\tfor (String error : errorList) {\n-\t\t\t\t\terrors.append(\"\\n   - It \").append(error);\n-\t\t\t\t}\n+\t\t\tfor (String error : errorList) {\n+\t\t\t\terrors.append(\"\\n\\t - It \").append(error);\n \t\t\t}\n \n \t\t\treturn;\n \t\t}\n \n \t\tModCandidate depCandidate = result.get(depModId);\n-\t\tboolean isPresent = depCandidate == null ? false : dependency.matches(depCandidate.getInfo().getVersion());\n+\t\tboolean isPresent = depCandidate != null && dependency.matches(depCandidate.getInfo().getVersion());\n \n \t\tif (isPresent != cond) {\n-\t\t\terrors.append(\"\\n - Mod \").append(candidate.getInfo().getId()).append(\" \").append(errorType).append(\" mod \").append(dependency).append(\", \");\n-\n+\t\t\terrors.append(getDependencyVersionRequirements(dependency)).append(\" of mod \")\n+\t\t\t\t\t.append(depCandidate == null ? depModId : getCandidateName(depCandidate)).append(\", \");\n \t\t\tif (depCandidate == null) {\n-\t\t\t\terrors.append(\"which is missing\");\n+\t\t\t\tappendMissingDependencyError(errors, dependency);\n \t\t\t} else if (cond) {\n-\t\t\t\terrors.append(\"but a different version is present: \").append(depCandidate.getInfo().getVersion());\n+\t\t\t\tappendUnsatisfiedDependencyError(errors, dependency, depCandidate);\n \t\t\t} else if (errorType.contains(\"conf\")) {\n \t\t\t\t// CONFLICTS WITH\n-\t\t\t\terrors.append(\"but the conflicting version is present: \").append(depCandidate.getInfo().getVersion());\n+\t\t\t\tappendConflictError(errors, candidate, depCandidate);\n \t\t\t} else {\n-\t\t\t\terrors.append(\"but the breaking version is present: \").append(depCandidate.getInfo().getVersion());\n+\t\t\t\tappendBreakingError(errors, candidate, depCandidate);\n \t\t\t}\n-\n-\t\t\terrors.append(\"!\");\n \t\t}\n \t}\n ", "originalCommit": "a1da19a330478f634beddaf9947110447b514f54", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzQ3NTM3Ng==", "url": "https://github.com/FabricMC/fabric-loader/pull/277#discussion_r497475376", "bodyText": "Probably on a separate \"ModResolver overhaul\" PR since god is that thing a mess and I've messed it up a lil more", "author": "Leo40Git", "createdAt": "2020-09-30T12:39:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzE4ODgwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjEwNzkyNQ==", "url": "https://github.com/FabricMC/fabric-loader/pull/277#discussion_r502107925", "bodyText": "Fine with me!", "author": "sfPlayer1", "createdAt": "2020-10-09T00:59:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzE4ODgwNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzE4OTMwMw==", "url": "https://github.com/FabricMC/fabric-loader/pull/277#discussion_r497189303", "bodyText": "I don't think we need to handle this gracefully?", "author": "sfPlayer1", "createdAt": "2020-09-30T01:10:59Z", "path": "src/main/java/net/fabricmc/loader/gui/FabricStatusTree.java", "diffHunk": "@@ -203,10 +203,43 @@ public void setInfo() {\n \t\t\tsetWarningLevel(FabricTreeWarningLevel.INFO);\n \t\t}\n \n+\t\tprivate FabricStatusNode addChild(String string, boolean info) {\n+\t\t\tif (string.startsWith(\"\\t\")) {\n+\t\t\t\tif (children.size() == 0) {\n+\t\t\t\t\tFabricStatusNode rootChild = new FabricStatusNode(this, \"(indented node was added before root node - this is a bug!)\");", "originalCommit": "a1da19a330478f634beddaf9947110447b514f54", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzE5MTI0NA==", "url": "https://github.com/FabricMC/fabric-loader/pull/277#discussion_r497191244", "bodyText": "API classes should always be final unless extending is explicitly desired.\nTo me a VersionRange is a range with 2 version bounds, we already call these VersionPredicate elsewhere, which should be appropriate here. We'd then implement Predicate<Version> later (see net.fabricmc.loader.util.version.VersionPredicateParser.matches)", "author": "sfPlayer1", "createdAt": "2020-09-30T01:19:32Z", "path": "src/main/java/net/fabricmc/loader/api/VersionRange.java", "diffHunk": "@@ -0,0 +1,158 @@\n+/*\n+ * Copyright 2016 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.loader.api;\n+\n+import java.util.Arrays;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.Objects;\n+import java.util.function.UnaryOperator;\n+import java.util.stream.Collectors;\n+\n+public class VersionRange {", "originalCommit": "a1da19a330478f634beddaf9947110447b514f54", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzE5MTY2MQ==", "url": "https://github.com/FabricMC/fabric-loader/pull/277#discussion_r497191661", "bodyText": "I'd null check the args", "author": "sfPlayer1", "createdAt": "2020-09-30T01:21:11Z", "path": "src/main/java/net/fabricmc/loader/api/VersionRange.java", "diffHunk": "@@ -0,0 +1,158 @@\n+/*\n+ * Copyright 2016 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.loader.api;\n+\n+import java.util.Arrays;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.Objects;\n+import java.util.function.UnaryOperator;\n+import java.util.stream.Collectors;\n+\n+public class VersionRange {\n+\tpublic enum Type {\n+\t\tINVALID(version -> \"unknown version\"),\n+\t\tANY(version -> \"any version\"),\n+\t\tEQUALS(version -> \"version \" + version),\n+\t\tGREATER_THAN(version -> \"any version after \" + version),\n+\t\tLESSER_THAN(version -> \"any version before \" + version),\n+\t\tGREATER_THAN_OR_EQUAL(version -> \"version \" + version + \" or later\"),\n+\t\tLESSER_THAN_OR_EQUAL(version -> \"version \" + version + \" or earlier\"),\n+\t\tSAME_MAJOR(version -> {\n+\t\t\tString[] parts = version.split(\"\\\\.\");\n+\n+\t\t\tfor (int i = 1; i < parts.length; i++) {\n+\t\t\t\tparts[i] = \"x\";\n+\t\t\t}\n+\n+\t\t\treturn \"version \" + String.join(\".\", parts);\n+\t\t}),\n+\t\tSAME_MAJOR_AND_MINOR(version -> {\n+\t\t\tString[] parts = version.split(\"\\\\.\");\n+\n+\t\t\tfor (int i = 2; i < parts.length; i++) {\n+\t\t\t\tparts[i] = \"x\";\n+\t\t\t}\n+\n+\t\t\treturn \"version \" + String.join(\".\", parts);\n+\t\t});\n+\n+\t\tprivate final UnaryOperator<String> reprOperator;\n+\n+\t\tType(UnaryOperator<String> reprOperator) {\n+\t\t\tthis.reprOperator = reprOperator;\n+\t\t}\n+\n+\t\tpublic String represent(String version) {\n+\t\t\treturn reprOperator.apply(version);\n+\t\t}\n+\t}\n+\n+\tprivate final Type type;\n+\tprivate final String version;\n+\tprivate String stringRepr;\n+\n+\tpublic VersionRange(Type type, String version) {", "originalCommit": "a1da19a330478f634beddaf9947110447b514f54", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzE5MjE0Mg==", "url": "https://github.com/FabricMC/fabric-loader/pull/277#discussion_r497192142", "bodyText": "\"describe\" may be a better name? Not sure.\nThe method signature isn't very suitable to add localization support. I think it may be best to move the description logic to the implementation and not expose it in the API.", "author": "sfPlayer1", "createdAt": "2020-09-30T01:23:12Z", "path": "src/main/java/net/fabricmc/loader/api/VersionRange.java", "diffHunk": "@@ -0,0 +1,158 @@\n+/*\n+ * Copyright 2016 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.loader.api;\n+\n+import java.util.Arrays;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.Objects;\n+import java.util.function.UnaryOperator;\n+import java.util.stream.Collectors;\n+\n+public class VersionRange {\n+\tpublic enum Type {\n+\t\tINVALID(version -> \"unknown version\"),\n+\t\tANY(version -> \"any version\"),\n+\t\tEQUALS(version -> \"version \" + version),\n+\t\tGREATER_THAN(version -> \"any version after \" + version),\n+\t\tLESSER_THAN(version -> \"any version before \" + version),\n+\t\tGREATER_THAN_OR_EQUAL(version -> \"version \" + version + \" or later\"),\n+\t\tLESSER_THAN_OR_EQUAL(version -> \"version \" + version + \" or earlier\"),\n+\t\tSAME_MAJOR(version -> {\n+\t\t\tString[] parts = version.split(\"\\\\.\");\n+\n+\t\t\tfor (int i = 1; i < parts.length; i++) {\n+\t\t\t\tparts[i] = \"x\";\n+\t\t\t}\n+\n+\t\t\treturn \"version \" + String.join(\".\", parts);\n+\t\t}),\n+\t\tSAME_MAJOR_AND_MINOR(version -> {\n+\t\t\tString[] parts = version.split(\"\\\\.\");\n+\n+\t\t\tfor (int i = 2; i < parts.length; i++) {\n+\t\t\t\tparts[i] = \"x\";\n+\t\t\t}\n+\n+\t\t\treturn \"version \" + String.join(\".\", parts);\n+\t\t});\n+\n+\t\tprivate final UnaryOperator<String> reprOperator;\n+\n+\t\tType(UnaryOperator<String> reprOperator) {\n+\t\t\tthis.reprOperator = reprOperator;\n+\t\t}\n+\n+\t\tpublic String represent(String version) {", "originalCommit": "a1da19a330478f634beddaf9947110447b514f54", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzQ1MTUwMw==", "url": "https://github.com/FabricMC/fabric-loader/pull/277#discussion_r497451503", "bodyText": "This'll get changed to \"<predicate type symbol(s)><predicate argument>\" (i.e \"=1.0.2\") or something", "author": "Leo40Git", "createdAt": "2020-09-30T11:58:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzE5MjE0Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzIwMjQ2MA==", "url": "https://github.com/FabricMC/fabric-loader/pull/277#discussion_r497202460", "bodyText": "existing parser infers equality, similar to your default case", "author": "sfPlayer1", "createdAt": "2020-09-30T02:05:31Z", "path": "src/main/java/net/fabricmc/loader/api/VersionRange.java", "diffHunk": "@@ -0,0 +1,158 @@\n+/*\n+ * Copyright 2016 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.loader.api;\n+\n+import java.util.Arrays;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.Objects;\n+import java.util.function.UnaryOperator;\n+import java.util.stream.Collectors;\n+\n+public class VersionRange {\n+\tpublic enum Type {\n+\t\tINVALID(version -> \"unknown version\"),\n+\t\tANY(version -> \"any version\"),\n+\t\tEQUALS(version -> \"version \" + version),\n+\t\tGREATER_THAN(version -> \"any version after \" + version),\n+\t\tLESSER_THAN(version -> \"any version before \" + version),\n+\t\tGREATER_THAN_OR_EQUAL(version -> \"version \" + version + \" or later\"),\n+\t\tLESSER_THAN_OR_EQUAL(version -> \"version \" + version + \" or earlier\"),\n+\t\tSAME_MAJOR(version -> {\n+\t\t\tString[] parts = version.split(\"\\\\.\");\n+\n+\t\t\tfor (int i = 1; i < parts.length; i++) {\n+\t\t\t\tparts[i] = \"x\";\n+\t\t\t}\n+\n+\t\t\treturn \"version \" + String.join(\".\", parts);\n+\t\t}),\n+\t\tSAME_MAJOR_AND_MINOR(version -> {\n+\t\t\tString[] parts = version.split(\"\\\\.\");\n+\n+\t\t\tfor (int i = 2; i < parts.length; i++) {\n+\t\t\t\tparts[i] = \"x\";\n+\t\t\t}\n+\n+\t\t\treturn \"version \" + String.join(\".\", parts);\n+\t\t});\n+\n+\t\tprivate final UnaryOperator<String> reprOperator;\n+\n+\t\tType(UnaryOperator<String> reprOperator) {\n+\t\t\tthis.reprOperator = reprOperator;\n+\t\t}\n+\n+\t\tpublic String represent(String version) {\n+\t\t\treturn reprOperator.apply(version);\n+\t\t}\n+\t}\n+\n+\tprivate final Type type;\n+\tprivate final String version;\n+\tprivate String stringRepr;\n+\n+\tpublic VersionRange(Type type, String version) {\n+\t\tthis.type = type;\n+\t\tthis.version = version;\n+\t}\n+\n+\tpublic Type getType() {\n+\t\treturn type;\n+\t}\n+\n+\tpublic String getVersion() {\n+\t\treturn version;\n+\t}\n+\n+\t@Override\n+\tpublic String toString() {\n+\t\tif (stringRepr == null) {\n+\t\t\tstringRepr = type.represent(version);\n+\t\t}\n+\n+\t\treturn stringRepr;\n+\t}\n+\n+\t@Override\n+\tpublic boolean equals(Object o) {\n+\t\tif (this == o) {\n+\t\t\treturn true;\n+\t\t}\n+\n+\t\tif (o == null || getClass() != o.getClass()) {\n+\t\t\treturn false;\n+\t\t}\n+\n+\t\tVersionRange that = (VersionRange) o;\n+\t\treturn type == that.type && version.equals(that.version);\n+\t}\n+\n+\t@Override\n+\tpublic int hashCode() {\n+\t\treturn Objects.hash(type, version);\n+\t}\n+\n+\tpublic static Collection<VersionRange> fromVersionMatchers(String... matchers) {\n+\t\tCollection<VersionRange> ranges = Arrays.stream(matchers).map(matcher -> {\n+\t\t\tchar firstChar = matcher.charAt(0);\n+\t\t\tchar secondChar = 0;\n+\n+\t\t\tif (matcher.length() > 1) {\n+\t\t\t\tsecondChar = matcher.charAt(1);\n+\t\t\t}\n+\n+\t\t\tswitch (firstChar) {\n+\t\t\tcase '*':\n+\t\t\t\tif (matcher.length() == 1) {\n+\t\t\t\t\treturn new VersionRange(Type.ANY, \"\");\n+\t\t\t\t} else {\n+\t\t\t\t\treturn new VersionRange(Type.INVALID, \"\");", "originalCommit": "a1da19a330478f634beddaf9947110447b514f54", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzIwMjg2OA==", "url": "https://github.com/FabricMC/fabric-loader/pull/277#discussion_r497202868", "bodyText": "This should return a Set for correct equals semantics.", "author": "sfPlayer1", "createdAt": "2020-09-30T02:07:23Z", "path": "src/main/java/net/fabricmc/loader/api/metadata/ModDependency.java", "diffHunk": "@@ -33,4 +36,11 @@\n \t * @param version the version to check\n \t */\n \tboolean matches(Version version);\n+\n+\t/**\n+\t * Returns a representation of the dependency's version requirements.\n+\t *\n+\t * @return representation of the dependency's version requirements\n+\t */\n+\tCollection<VersionRange> getVersionRequirements();", "originalCommit": "a1da19a330478f634beddaf9947110447b514f54", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzIwNTEzOQ==", "url": "https://github.com/FabricMC/fabric-loader/pull/277#discussion_r497205139", "bodyText": "The logic here looks a bit weird, the 2nd trim makes no difference outside the 2nd if. Why is it > 1 instead of > 0?", "author": "sfPlayer1", "createdAt": "2020-09-30T02:16:38Z", "path": "src/main/java/net/fabricmc/loader/gui/FabricStatusTree.java", "diffHunk": "@@ -203,10 +203,43 @@ public void setInfo() {\n \t\t\tsetWarningLevel(FabricTreeWarningLevel.INFO);\n \t\t}\n \n+\t\tprivate FabricStatusNode addChild(String string, boolean info) {\n+\t\t\tif (string.startsWith(\"\\t\")) {\n+\t\t\t\tif (children.size() == 0) {\n+\t\t\t\t\tFabricStatusNode rootChild = new FabricStatusNode(this, \"(indented node was added before root node - this is a bug!)\");\n+\t\t\t\t\trootChild.warningLevel = FabricTreeWarningLevel.WARN;\n+\t\t\t\t\tchildren.add(rootChild);\n+\t\t\t\t}\n+\t\t\t\tFabricStatusNode lastChild = children.get(children.size() - 1);\n+\t\t\t\tlastChild.addChild(string.substring(1), true);\n+\t\t\t\treturn lastChild;\n+\t\t\t} else {\n+\t\t\t\tFabricStatusNode child = new FabricStatusNode(this, info ? emboldenForNode(string) : cleanForNode(string));\n+\t\t\t\tif (info) {\n+\t\t\t\t\tchild.warningLevel = FabricTreeWarningLevel.INFO;\n+\t\t\t\t\texpandByDefault = true;\n+\t\t\t\t}\n+\t\t\t\tchildren.add(child);\n+\t\t\t\treturn child;\n+\t\t\t}\n+\t\t}\n+\n \t\tpublic FabricStatusNode addChild(String string) {\n-\t\t\tFabricStatusNode child = new FabricStatusNode(this, string);\n-\t\t\tchildren.add(child);\n-\t\t\treturn child;\n+\t\t\treturn addChild(string, false);\n+\t\t}\n+\n+\t\tprivate String cleanForNode(String string) {\n+\t\t\tstring = string.trim();\n+\t\t\tif (string.length() > 1) {\n+\t\t\t\tif (string.startsWith(\"-\"))\n+\t\t\t\t\tstring = string.substring(1);\n+\t\t\t\tstring = string.trim();", "originalCommit": "a1da19a330478f634beddaf9947110447b514f54", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzIwNjAxNA==", "url": "https://github.com/FabricMC/fabric-loader/pull/277#discussion_r497206014", "bodyText": "This makes me suspicious of whether the code deals with string containing characters that are meaningful html.", "author": "sfPlayer1", "createdAt": "2020-09-30T02:20:11Z", "path": "src/main/java/net/fabricmc/loader/gui/FabricStatusTree.java", "diffHunk": "@@ -203,10 +203,43 @@ public void setInfo() {\n \t\t\tsetWarningLevel(FabricTreeWarningLevel.INFO);\n \t\t}\n \n+\t\tprivate FabricStatusNode addChild(String string, boolean info) {\n+\t\t\tif (string.startsWith(\"\\t\")) {\n+\t\t\t\tif (children.size() == 0) {\n+\t\t\t\t\tFabricStatusNode rootChild = new FabricStatusNode(this, \"(indented node was added before root node - this is a bug!)\");\n+\t\t\t\t\trootChild.warningLevel = FabricTreeWarningLevel.WARN;\n+\t\t\t\t\tchildren.add(rootChild);\n+\t\t\t\t}\n+\t\t\t\tFabricStatusNode lastChild = children.get(children.size() - 1);\n+\t\t\t\tlastChild.addChild(string.substring(1), true);\n+\t\t\t\treturn lastChild;\n+\t\t\t} else {\n+\t\t\t\tFabricStatusNode child = new FabricStatusNode(this, info ? emboldenForNode(string) : cleanForNode(string));\n+\t\t\t\tif (info) {\n+\t\t\t\t\tchild.warningLevel = FabricTreeWarningLevel.INFO;\n+\t\t\t\t\texpandByDefault = true;\n+\t\t\t\t}\n+\t\t\t\tchildren.add(child);\n+\t\t\t\treturn child;\n+\t\t\t}\n+\t\t}\n+\n \t\tpublic FabricStatusNode addChild(String string) {\n-\t\t\tFabricStatusNode child = new FabricStatusNode(this, string);\n-\t\t\tchildren.add(child);\n-\t\t\treturn child;\n+\t\t\treturn addChild(string, false);\n+\t\t}\n+\n+\t\tprivate String cleanForNode(String string) {\n+\t\t\tstring = string.trim();\n+\t\t\tif (string.length() > 1) {\n+\t\t\t\tif (string.startsWith(\"-\"))\n+\t\t\t\t\tstring = string.substring(1);\n+\t\t\t\tstring = string.trim();\n+\t\t\t}\n+\t\t\treturn string;\n+\t\t}\n+\n+\t\tprivate String emboldenForNode(String string) {\n+\t\t\treturn \"<html><b>\" + cleanForNode(string) + \"</b></html>\";", "originalCommit": "a1da19a330478f634beddaf9947110447b514f54", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzQ0OTIwMg==", "url": "https://github.com/FabricMC/fabric-loader/pull/277#discussion_r497449202", "bodyText": "Probably not. Apache utilities add a method for escaping HTML characters, but I'm honestly considering just removing the bold node stuff since nested nodes are useful for other things as well.", "author": "Leo40Git", "createdAt": "2020-09-30T11:53:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzIwNjAxNA=="}], "type": "inlineReview"}, {"oid": "a7e2f778988e785bb91d4e01f6a23d6726f82bd2", "url": "https://github.com/FabricMC/fabric-loader/commit/a7e2f778988e785bb91d4e01f6a23d6726f82bd2", "message": "player refactors\n\n- VersionRange -> VersionPredicate\n- Use Set instead of useless Collection\n- VersionPredicate.toString is now less descriptive, descriptions will be generated in ModResolver to allow for better i18n\n- Sub-nodes are no longer in bold and set as info in FabricStatusTree", "committedDate": "2020-09-30T12:33:18Z", "type": "commit"}, {"oid": "2d07730695baa172b38c500fa08e7a344b41f1ce", "url": "https://github.com/FabricMC/fabric-loader/commit/2d07730695baa172b38c500fa08e7a344b41f1ce", "message": "Check for nulls in VersionPredicate constructor", "committedDate": "2020-09-30T12:47:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzUyMjMzMg==", "url": "https://github.com/FabricMC/fabric-loader/pull/277#discussion_r497522332", "bodyText": "The caret (^) ranges actually check that the left-most non-zero digit matches, so this would have different behaviour for versions such as 0.a.b and 0.0.c. (This is detailed in the NPM semver docs, which are linked in the fabric.mod.json spec as the definition of the dep strings.)", "author": "Juuxel", "createdAt": "2020-09-30T13:46:32Z", "path": "src/main/java/net/fabricmc/loader/discovery/ModResolver.java", "diffHunk": "@@ -314,46 +314,117 @@ private static IVecInt toVecInt(IntStream stream) {\n \tprivate void addErrorToList(ModCandidate candidate, ModDependency dependency, Map<String, ModCandidate> result, StringBuilder errors, String errorType, boolean cond) {\n \t\tString depModId = dependency.getModId();\n \n-\t\tStringBuilder prefix = new StringBuilder(\"\\n - Mod \").append(candidate.getInfo().getId());\n-\t\tprefix.append(\" \").append(errorType).append(\" mod \").append(depModId);\n+\t\terrors.append(\"\\n - Mod \").append(getCandidateName(candidate)).append(\" \").append(errorType).append(\" \");\n \n \t\tList<String> errorList = new ArrayList<>();\n \n \t\tif (!isModIdValid(depModId, errorList)) {\n-\t\t\tif (errorList.size() == 1) {\n-\t\t\t\terrors.append(prefix).append(\" which has an invalid mod id because it \").append(errorList.get(0));\n-\t\t\t} else {\n-\t\t\t\terrors.append(prefix).append(\" which has an invalid mod because:\");\n+\t\t\terrors.append(depModId).append(\", which has an invalid mod ID because:\");\n \n-\t\t\t\tfor (String error : errorList) {\n-\t\t\t\t\terrors.append(\"\\n   - It \").append(error);\n-\t\t\t\t}\n+\t\t\tfor (String error : errorList) {\n+\t\t\t\terrors.append(\"\\n\\t - It \").append(error);\n \t\t\t}\n \n \t\t\treturn;\n \t\t}\n \n \t\tModCandidate depCandidate = result.get(depModId);\n-\t\tboolean isPresent = depCandidate == null ? false : dependency.matches(depCandidate.getInfo().getVersion());\n+\t\tboolean isPresent = depCandidate != null && dependency.matches(depCandidate.getInfo().getVersion());\n \n \t\tif (isPresent != cond) {\n-\t\t\terrors.append(\"\\n - Mod \").append(candidate.getInfo().getId()).append(\" \").append(errorType).append(\" mod \").append(dependency).append(\", \");\n-\n+\t\t\terrors.append(getDependencyVersionRequirements(dependency)).append(\" of mod \")\n+\t\t\t\t\t.append(depCandidate == null ? depModId : getCandidateName(depCandidate)).append(\", \");\n \t\t\tif (depCandidate == null) {\n-\t\t\t\terrors.append(\"which is missing\");\n+\t\t\t\tappendMissingDependencyError(errors, dependency);\n \t\t\t} else if (cond) {\n-\t\t\t\terrors.append(\"but a different version is present: \").append(depCandidate.getInfo().getVersion());\n+\t\t\t\tappendUnsatisfiedDependencyError(errors, dependency, depCandidate);\n \t\t\t} else if (errorType.contains(\"conf\")) {\n \t\t\t\t// CONFLICTS WITH\n-\t\t\t\terrors.append(\"but the conflicting version is present: \").append(depCandidate.getInfo().getVersion());\n+\t\t\t\tappendConflictError(errors, candidate, depCandidate);\n \t\t\t} else {\n-\t\t\t\terrors.append(\"but the breaking version is present: \").append(depCandidate.getInfo().getVersion());\n+\t\t\t\tappendBreakingError(errors, candidate, depCandidate);\n \t\t\t}\n-\n-\t\t\terrors.append(\"!\");\n \t\t}\n \t}\n \n+\tprivate void appendMissingDependencyError(StringBuilder errors, ModDependency dependency) {\n+\t\terrors.append(\"which is missing!\");\n+\t\terrors.append(\"\\n\\t - You must install \").append(getDependencyVersionRequirements(dependency)).append(\" of \")\n+\t\t\t\t.append(dependency.getModId()).append(\".\");\n+\t}\n+\n+\tprivate void appendUnsatisfiedDependencyError(StringBuilder errors, ModDependency dependency, ModCandidate depCandidate) {\n+\t\terrors.append(\"but a non-matching version is present: \").append(getCandidateFriendlyVersion(depCandidate)).append(\"!\");\n+\t\terrors.append(\"\\n\\t - You must install \").append(getDependencyVersionRequirements(dependency)).append(\" of \")\n+\t\t\t\t.append(getCandidateName(depCandidate)).append(\".\");\n+\t}\n+\n+\tprivate void appendConflictError(StringBuilder errors, ModCandidate candidate, ModCandidate depCandidate) {\n+\t\tfinal String depCandidateVer = getCandidateFriendlyVersion(depCandidate);\n+\t\terrors.append(\"but a matching version is present: \").append(depCandidateVer).append(\"!\");\n+\t\terrors.append(\"\\n\\t - While this won't prevent you from starting the game,\");\n+\t\terrors.append(\" the developer(s) of \").append(getCandidateName(candidate));\n+\t\terrors.append(\" have found that version \").append(depCandidateVer).append(\" of \").append(getCandidateName(depCandidate));\n+\t\terrors.append(\" conflicts with their mod.\");\n+\t\terrors.append(\"\\n\\t - It is heavily recommended to remove one of the mods.\");\n+\t}\n+\n+\tprivate void appendBreakingError(StringBuilder errors, ModCandidate candidate, ModCandidate depCandidate) {\n+\t\tfinal String depCandidateVer = getCandidateFriendlyVersion(depCandidate);\n+\t\terrors.append(\"but a matching version is present: \").append(depCandidate.getInfo().getVersion()).append(\"!\");\n+\t\terrors.append(\"\\n\\t - The developer(s) of \").append(getCandidateName(candidate));\n+\t\terrors.append(\" have found that version \").append(depCandidateVer).append(\" of \").append(getCandidateName(depCandidate));\n+\t\terrors.append(\" critically conflicts with their mod.\");\n+\t\terrors.append(\"\\n\\t - You must remove one of the mods.\");\n+\t}\n+\n+\tprivate static String getCandidateName(ModCandidate candidate) {\n+\t\treturn \"'\" + candidate.getInfo().getName() + \"' (\" + candidate.getInfo().getId() + \")\";\n+\t}\n+\n+\tprivate static String getCandidateFriendlyVersion(ModCandidate candidate) {\n+\t\treturn candidate.getInfo().getVersion().getFriendlyString();\n+\t}\n+\n+\tprivate static String getDependencyVersionRequirements(ModDependency dependency) {\n+\t\treturn dependency.getVersionRequirements().stream().map(predicate -> {\n+\t\t\tString version = predicate.getVersion();\n+\t\t\tString[] parts;\n+\t\t\tswitch(predicate.getType()) {\n+\t\t\tcase ANY:\n+\t\t\t\treturn \"any version\";\n+\t\t\tcase EQUALS:\n+\t\t\t\treturn \"version \" + version;\n+\t\t\tcase GREATER_THAN:\n+\t\t\t\treturn \"any version after \" + version;\n+\t\t\tcase LESSER_THAN:\n+\t\t\t\treturn \"any version before \" + version;\n+\t\t\tcase GREATER_THAN_OR_EQUAL:\n+\t\t\t\treturn \"version \" + version + \" or later\";\n+\t\t\tcase LESSER_THAN_OR_EQUAL:\n+\t\t\t\treturn \"version \" + version + \" or earlier\";\n+\t\t\tcase SAME_MAJOR:\n+\t\t\t\tparts = version.split(\"\\\\.\");\n+\n+\t\t\t\tfor (int i = 1; i < parts.length; i++) {\n+\t\t\t\t\tparts[i] = \"x\";\n+\t\t\t\t}\n+\n+\t\t\t\treturn \"version \" + String.join(\".\", parts);", "originalCommit": "2d07730695baa172b38c500fa08e7a344b41f1ce", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzUyNTIzMw==", "url": "https://github.com/FabricMC/fabric-loader/pull/277#discussion_r497525233", "bodyText": "Oops. ~ is probably wrong too, then...", "author": "Leo40Git", "createdAt": "2020-09-30T13:50:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzUyMjMzMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzUyNzkzNg==", "url": "https://github.com/FabricMC/fabric-loader/pull/277#discussion_r497527936", "bodyText": "What should the equivalent values in the Type enum be called, then? Just CARET and TILDE?", "author": "Leo40Git", "createdAt": "2020-09-30T13:53:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzUyMjMzMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjU2ODI2Mg==", "url": "https://github.com/FabricMC/fabric-loader/pull/277#discussion_r502568262", "bodyText": "According to Player, this special condition doesn't exist here. Marking as resolved.", "author": "Leo40Git", "createdAt": "2020-10-09T17:16:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzUyMjMzMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjEwNzQxOA==", "url": "https://github.com/FabricMC/fabric-loader/pull/277#discussion_r502107418", "bodyText": "in Java switch-case is fall through, you need to add break; before every case that you don't want to enter form the previous case.", "author": "sfPlayer1", "createdAt": "2020-10-09T00:58:09Z", "path": "src/main/java/net/fabricmc/loader/api/VersionPredicate.java", "diffHunk": "@@ -0,0 +1,135 @@\n+/*\n+ * Copyright 2016 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.loader.api;\n+\n+import java.util.Collections;\n+import java.util.HashSet;\n+import java.util.Objects;\n+import java.util.Set;\n+\n+public final class VersionPredicate {\n+\tpublic enum Type {\n+\t\tANY(\"*\"),\n+\t\tEQUALS(\"=\"),\n+\t\tGREATER_THAN(\">\"),\n+\t\tLESSER_THAN(\"<\"),\n+\t\tGREATER_THAN_OR_EQUAL(\">=\"),\n+\t\tLESSER_THAN_OR_EQUAL(\"<=\"),\n+\t\tSAME_MAJOR(\"^\"),\n+\t\tSAME_MAJOR_AND_MINOR(\"~\");\n+\n+\t\tprivate final String prefix;\n+\n+\t\tType(String prefix) {\n+\t\t\tthis.prefix = prefix;\n+\t\t}\n+\n+\t\tpublic String prefix() {\n+\t\t\treturn prefix;\n+\t\t}\n+\n+\t\tpublic String describe(String version) {\n+\t\t\treturn this == ANY ? prefix : prefix + version;\n+\t\t}\n+\t}\n+\n+\tprivate final Type type;\n+\tprivate final String version;\n+\n+\tpublic VersionPredicate(Type type, String version) {\n+\t\tthis.type = Objects.requireNonNull(type, \"type == null!\");\n+\t\tthis.version = Objects.requireNonNull(version, \"version == null!\");\n+\t}\n+\n+\tpublic Type getType() {\n+\t\treturn type;\n+\t}\n+\n+\tpublic String getVersion() {\n+\t\treturn version;\n+\t}\n+\n+\t@Override\n+\tpublic String toString() {\n+\t\treturn type.describe(version);\n+\t}\n+\n+\t@Override\n+\tpublic boolean equals(Object o) {\n+\t\tif (this == o) {\n+\t\t\treturn true;\n+\t\t}\n+\n+\t\tif (o == null || getClass() != o.getClass()) {\n+\t\t\treturn false;\n+\t\t}\n+\n+\t\tVersionPredicate that = (VersionPredicate) o;\n+\t\treturn type == that.type && version.equals(that.version);\n+\t}\n+\n+\t@Override\n+\tpublic int hashCode() {\n+\t\treturn Objects.hash(type, version);\n+\t}\n+\n+\tpublic static Set<VersionPredicate> parse(String... matchers) {\n+\t\tSet<VersionPredicate> predicates = new HashSet<>(matchers.length);\n+\n+\t\tfor (String matcher : matchers) {\n+\t\t\tchar firstChar = matcher.charAt(0);\n+\t\t\tchar secondChar = 0;\n+\n+\t\t\tif (matcher.length() > 1) {\n+\t\t\t\tsecondChar = matcher.charAt(1);\n+\t\t\t}\n+\n+\t\t\tswitch (firstChar) {\n+\t\t\tcase '*':\n+\t\t\t\tif (matcher.length() == 1) {\n+\t\t\t\t\tpredicates.clear();\n+\t\t\t\t\tpredicates.add(new VersionPredicate(Type.ANY, \"\"));\n+\t\t\t\t} else {\n+\t\t\t\t\tpredicates.add(new VersionPredicate(Type.EQUALS, matcher));\n+\t\t\t\t}", "originalCommit": "2d07730695baa172b38c500fa08e7a344b41f1ce", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjU2ODUzMQ==", "url": "https://github.com/FabricMC/fabric-loader/pull/277#discussion_r502568531", "bodyText": "...Oops.", "author": "Leo40Git", "createdAt": "2020-10-09T17:16:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjEwNzQxOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjU3NzkwMQ==", "url": "https://github.com/FabricMC/fabric-loader/pull/277#discussion_r502577901", "bodyText": "Missing breaks have been added.", "author": "Leo40Git", "createdAt": "2020-10-09T17:34:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjEwNzQxOA=="}], "type": "inlineReview"}, {"oid": "9c998b86132a722692727b8084750e54ff3defbc", "url": "https://github.com/FabricMC/fabric-loader/commit/9c998b86132a722692727b8084750e54ff3defbc", "message": "them's the breaks", "committedDate": "2020-10-09T17:23:33Z", "type": "commit"}, {"oid": "f3869dc52a133011925c2593505a61bc4e4a4491", "url": "https://github.com/FabricMC/fabric-loader/commit/f3869dc52a133011925c2593505a61bc4e4a4491", "message": "VersionPredicate.parse: fail-fast on ANY predicate", "committedDate": "2020-10-10T10:12:28Z", "type": "commit"}, {"oid": "d1f614fc5c0d82bfeac3eb5d9f58444b8a950979", "url": "https://github.com/FabricMC/fabric-loader/commit/d1f614fc5c0d82bfeac3eb5d9f58444b8a950979", "message": "Merge branch 'master' of https://github.com/FabricMC/fabric-loader into friendly-errors\n\n\u0001 Conflicts:\n\u0001\tsrc/main/java/net/fabricmc/loader/metadata/ModMetadataV0.java\n\u0001\tsrc/main/java/net/fabricmc/loader/metadata/ModMetadataV1.java", "committedDate": "2020-10-18T16:23:02Z", "type": "commit"}, {"oid": "70a3b31d63df7679a99b327fd4b728b9961b35bf", "url": "https://github.com/FabricMC/fabric-loader/commit/70a3b31d63df7679a99b327fd4b728b9961b35bf", "message": "post Gson yeetage update", "committedDate": "2020-10-18T16:35:58Z", "type": "commit"}, {"oid": "0c89ba62541882dbf95622b3420f06dedf2d2636", "url": "https://github.com/FabricMC/fabric-loader/commit/0c89ba62541882dbf95622b3420f06dedf2d2636", "message": "ModResolver: don't make up errors for god's sake\n\nThis is why you test with a set of mods that *should* work, Leo...", "committedDate": "2020-10-19T06:52:59Z", "type": "commit"}, {"oid": "a762f179441e562f1086a1a2aa262de84752423c", "url": "https://github.com/FabricMC/fabric-loader/commit/a762f179441e562f1086a1a2aa262de84752423c", "message": "Add JiJ info to dependency errors\n\nProblem: If JiJs are present, this code never gets run...", "committedDate": "2020-10-19T08:06:43Z", "type": "commit"}]}