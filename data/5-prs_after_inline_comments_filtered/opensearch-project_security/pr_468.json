{"pr_number": 468, "pr_title": "Refactor Base64Helper class", "pr_createdAt": "2020-05-20T06:20:42Z", "pr_url": "https://github.com/opensearch-project/security/pull/468", "timeline": [{"oid": "5d25412bfe13e637ca82217405c66f5fa5b0595b", "url": "https://github.com/opensearch-project/security/commit/5d25412bfe13e637ca82217405c66f5fa5b0595b", "message": "Refactor Base64Helper class\n- introduced SafeObjectOutputStream to catch unauthorized serializations\n- introduced Base64HelperTest", "committedDate": "2020-05-20T06:21:23Z", "type": "commit"}, {"oid": "5d25412bfe13e637ca82217405c66f5fa5b0595b", "url": "https://github.com/opensearch-project/security/commit/5d25412bfe13e637ca82217405c66f5fa5b0595b", "message": "Refactor Base64Helper class\n- introduced SafeObjectOutputStream to catch unauthorized serializations\n- introduced Base64HelperTest", "committedDate": "2020-05-20T06:21:23Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODI3MjkzMg==", "url": "https://github.com/opensearch-project/security/pull/468#discussion_r428272932", "bodyText": "Should this be a Set as well?", "author": "debjanibnrj", "createdAt": "2020-05-20T19:58:41Z", "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/support/Base64Helper.java", "diffHunk": "@@ -38,79 +44,123 @@\n import java.io.ObjectInputStream;\n import java.io.ObjectOutputStream;\n import java.io.ObjectStreamClass;\n+import java.io.OutputStream;\n import java.io.Serializable;\n import java.net.InetAddress;\n import java.net.InetSocketAddress;\n import java.net.SocketAddress;\n-import java.util.ArrayList;\n+import java.security.PrivilegedAction;\n import java.util.Collection;\n+import java.util.Collections;\n import java.util.List;\n import java.util.Map;\n+import java.util.Set;\n+import java.util.regex.Pattern;\n \n import org.elasticsearch.ElasticsearchException;\n+import org.elasticsearch.common.Strings;\n \n-import com.amazon.opendistroforelasticsearch.security.resolver.IndexResolverReplacer;\n import com.amazon.opendistroforelasticsearch.security.user.User;\n+\n+import com.google.common.base.Preconditions;\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.ImmutableSet;\n import com.google.common.io.BaseEncoding;\n \n public class Base64Helper {\n \n-    public static String serializeObject(final Serializable object) {\n+    private static final Set<Class<?>> SAFE_CLASSES = ImmutableSet.of(\n+        String.class,\n+        SocketAddress.class,\n+        InetSocketAddress.class,\n+        Pattern.class,\n+        User.class,\n+        SourceFieldsContext.class,\n+        LdapUser.class,\n+        SearchEntry.class,\n+        LdapEntry.class,\n+        AbstractLdapBean.class,\n+        LdapAttribute.class\n+    );\n+\n+    private static final List<Class<?>> SAFE_ASSIGNABLE_FROM_CLASSES = ImmutableList.of(", "originalCommit": "5d25412bfe13e637ca82217405c66f5fa5b0595b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODI4MzM3Nw==", "url": "https://github.com/opensearch-project/security/pull/468#discussion_r428283377", "bodyText": "It can be List or Set as there is no lookup by key support required and elements needs to be unique. As it is statically populated and we can guarantee uniqueness, List or even Collection is sufficient.", "author": "vrozov", "createdAt": "2020-05-20T20:18:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODI3MjkzMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODI3NzIwNw==", "url": "https://github.com/opensearch-project/security/pull/468#discussion_r428277207", "bodyText": "Is IndexResolverReplacer.Resolved not needed or missed ?", "author": "sujithvm", "createdAt": "2020-05-20T20:06:46Z", "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/support/Base64Helper.java", "diffHunk": "@@ -38,79 +44,123 @@\n import java.io.ObjectInputStream;\n import java.io.ObjectOutputStream;\n import java.io.ObjectStreamClass;\n+import java.io.OutputStream;\n import java.io.Serializable;\n import java.net.InetAddress;\n import java.net.InetSocketAddress;\n import java.net.SocketAddress;\n-import java.util.ArrayList;\n+import java.security.PrivilegedAction;\n import java.util.Collection;\n+import java.util.Collections;\n import java.util.List;\n import java.util.Map;\n+import java.util.Set;\n+import java.util.regex.Pattern;\n \n import org.elasticsearch.ElasticsearchException;\n+import org.elasticsearch.common.Strings;\n \n-import com.amazon.opendistroforelasticsearch.security.resolver.IndexResolverReplacer;", "originalCommit": "5d25412bfe13e637ca82217405c66f5fa5b0595b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODI4MDIxNQ==", "url": "https://github.com/opensearch-project/security/pull/468#discussion_r428280215", "bodyText": "It is not needed.", "author": "vrozov", "createdAt": "2020-05-20T20:12:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODI3NzIwNw=="}], "type": "inlineReview"}]}