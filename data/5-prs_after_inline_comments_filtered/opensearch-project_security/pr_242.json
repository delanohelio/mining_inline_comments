{"pr_number": 242, "pr_title": "Added SuperAdmin check to allow update/delete/add of reserved config \u2026", "pr_createdAt": "2020-02-24T23:28:30Z", "pr_url": "https://github.com/opensearch-project/security/pull/242", "timeline": [{"oid": "a10d9543a224333e2240ab213352b8201cfa27a0", "url": "https://github.com/opensearch-project/security/commit/a10d9543a224333e2240ab213352b8201cfa27a0", "message": "Added SuperAdmin check to allow update/delete/add of reserved config without restarting elasticsearch", "committedDate": "2020-02-24T23:21:26Z", "type": "commit"}, {"oid": "dd25120141ebf3a969f28d87d04c09a60a786458", "url": "https://github.com/opensearch-project/security/commit/dd25120141ebf3a969f28d87d04c09a60a786458", "message": "Add unit test for disallowing anyone apart from SuperAdmin to alter the reserved resources", "committedDate": "2020-02-25T01:46:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA3OTY2Nw==", "url": "https://github.com/opensearch-project/security/pull/242#discussion_r384079667", "bodyText": "PR looks good to me.\nNot sure if there is a better name for isReservedAndAccessibleToSuperAdmin or maybe use isReserved itself and document that super admins can update reserved resources.", "author": "sujithvm", "createdAt": "2020-02-25T19:33:06Z", "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/dlic/rest/api/AbstractApiAction.java", "diffHunk": "@@ -537,4 +538,17 @@ public String getName() {\n \n \tprotected abstract Endpoint getEndpoint();\n \n+\tprotected boolean isSuperAdmin() {\n+\t\tUser user = threadPool.getThreadContext().getTransient(ConfigConstants.OPENDISTRO_SECURITY_USER);\n+\t\treturn adminDNs.isAdmin(user);\n+\t}\n+\n+\tprotected boolean isReservedAndAccessibleToSuperAdmin(final SecurityDynamicConfiguration<?> existingConfiguration,", "originalCommit": "dd25120141ebf3a969f28d87d04c09a60a786458", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA4MDI4OQ==", "url": "https://github.com/opensearch-project/security/pull/242#discussion_r384080289", "bodyText": "What are your thoughts?", "author": "sujithvm", "createdAt": "2020-02-25T19:34:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA3OTY2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA4MjUzOA==", "url": "https://github.com/opensearch-project/security/pull/242#discussion_r384082538", "bodyText": "I think rename is required. From what I think, isReservedAndAccessible should be the one. Because it will make more sense. isReserved we can do but I think it wont go with the code.\nYour call - isReserved or isReservedAndAccessible?", "author": "palashhedau", "createdAt": "2020-02-25T19:38:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA3OTY2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA4MzkyNw==", "url": "https://github.com/opensearch-project/security/pull/242#discussion_r384083927", "bodyText": "Are there any resources which are reserved and not accessible to super-admins ?", "author": "sujithvm", "createdAt": "2020-02-25T19:41:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA3OTY2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA4NjIyOA==", "url": "https://github.com/opensearch-project/security/pull/242#discussion_r384086228", "bodyText": "We are allowing actiongroups, internalusers, roles, rolesmapping, tenants.\nAccount & Permission is not allowed to edit.\nAre they also required?", "author": "palashhedau", "createdAt": "2020-02-25T19:45:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA3OTY2Nw=="}], "type": "inlineReview"}, {"oid": "36ed503d349bbe1437228019b9f7388495c64e6e", "url": "https://github.com/opensearch-project/security/commit/36ed503d349bbe1437228019b9f7388495c64e6e", "message": "Function name change", "committedDate": "2020-02-26T01:43:33Z", "type": "commit"}, {"oid": "321817c808e0f54529d5220fece033a491c78070", "url": "https://github.com/opensearch-project/security/commit/321817c808e0f54529d5220fece033a491c78070", "message": "Reverse the logic to make sense to the caller", "committedDate": "2020-02-26T01:51:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDc1MTM3Mw==", "url": "https://github.com/opensearch-project/security/pull/242#discussion_r384751373", "bodyText": "Should we rename it to testActionGroupsApiForNonSuperAdmin() ?", "author": "hardik-k-shah", "createdAt": "2020-02-26T20:39:00Z", "path": "src/test/java/com/amazon/opendistroforelasticsearch/security/dlic/rest/api/ActionGroupsApiTest.java", "diffHunk": "@@ -298,4 +307,36 @@ public void testActionGroupsApi() throws Exception {\n         Assert.assertEquals(1, permissions.size());\n         Assert.assertTrue(permissions.contains(\"READ_UT\"));        \n \t}\n+\n+    @Test\n+    public void testActionGroupsApiWithoutCertificate() throws Exception {", "originalCommit": "321817c808e0f54529d5220fece033a491c78070", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDgwNTMxNQ==", "url": "https://github.com/opensearch-project/security/pull/242#discussion_r384805315", "bodyText": "Make sense. Changed.", "author": "palashhedau", "createdAt": "2020-02-26T22:25:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDc1MTM3Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDc2MDI1OQ==", "url": "https://github.com/opensearch-project/security/pull/242#discussion_r384760259", "bodyText": "lets rename sendHTTPClientCertificate to presentAdminCertificate or sendAdminCertificate", "author": "hardik-k-shah", "createdAt": "2020-02-26T20:56:11Z", "path": "src/test/java/com/amazon/opendistroforelasticsearch/security/dlic/rest/api/ActionGroupsApiTest.java", "diffHunk": "@@ -193,9 +195,10 @@ public void testActionGroupsApi() throws Exception {\n         Assert.assertEquals(HttpStatus.SC_NOT_FOUND, response.getStatusCode());\n \n         // PATCH read only resource, must be forbidden\n+        // SuperAdmin can patch read only resource", "originalCommit": "321817c808e0f54529d5220fece033a491c78070", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDgwNTE3MQ==", "url": "https://github.com/opensearch-project/security/pull/242#discussion_r384805171", "bodyText": "renamed to sendAdminCertificate", "author": "palashhedau", "createdAt": "2020-02-26T22:25:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDc2MDI1OQ=="}], "type": "inlineReview"}, {"oid": "53c824936c77970804745b3a77844b7b6a2289eb", "url": "https://github.com/opensearch-project/security/commit/53c824936c77970804745b3a77844b7b6a2289eb", "message": "Changed test admincert variable name and renamed test function to reflect proper functionality", "committedDate": "2020-02-26T21:56:52Z", "type": "commit"}]}