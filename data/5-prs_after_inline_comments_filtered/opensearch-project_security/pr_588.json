{"pr_number": 588, "pr_title": "Log index event requests on transport layer", "pr_createdAt": "2020-07-27T19:54:12Z", "pr_url": "https://github.com/opensearch-project/security/pull/588", "timeline": [{"oid": "cd689ab92b72adfe7bafa2f885ed6205e4c267e7", "url": "https://github.com/opensearch-project/security/commit/cd689ab92b72adfe7bafa2f885ed6205e4c267e7", "message": "Log index requests on transport layer", "committedDate": "2020-07-27T23:02:22Z", "type": "commit"}, {"oid": "6a8813ef0f9cbb5ddbf6a4398a7e5e4d7dfcc549", "url": "https://github.com/opensearch-project/security/commit/6a8813ef0f9cbb5ddbf6a4398a7e5e4d7dfcc549", "message": "Fix", "committedDate": "2020-07-27T23:33:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTI1NzU0MA==", "url": "https://github.com/opensearch-project/security/pull/588#discussion_r461257540", "bodyText": "Why are we ignoring non cluster admin?", "author": "debjanibnrj", "createdAt": "2020-07-28T01:07:10Z", "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/auditlog/impl/AbstractAuditLog.java", "diffHunk": "@@ -272,6 +272,21 @@ public void logGrantedPrivileges(String privilege, TransportRequest request, Tas\n         }\n     }\n \n+    @Override\n+    public void logIndexEvent(String privilege, TransportRequest request, Task task) {\n+        if(!checkTransportFilter(AuditCategory.INDEX_EVENT, privilege, getUser(), request)) {\n+            return;\n+        }\n+        // log only cluster admin action\n+        if (!privilege.startsWith(\"indices:admin/\")) {", "originalCommit": "cd689ab92b72adfe7bafa2f885ed6205e4c267e7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTI1ODIxNg==", "url": "https://github.com/opensearch-project/security/pull/588#discussion_r461258216", "bodyText": "We are interested only in Index actions https://opendistro.github.io/for-elasticsearch-docs/docs/security/access-control/permissions/#indices", "author": "sujithvm", "createdAt": "2020-07-28T01:09:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTI1NzU0MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTI1ODk1NQ==", "url": "https://github.com/opensearch-project/security/pull/588#discussion_r461258955", "bodyText": "Index actions also include indices:data/* and indices:monitor/* options", "author": "debjanibnrj", "createdAt": "2020-07-28T01:12:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTI1NzU0MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTI2MTg2MQ==", "url": "https://github.com/opensearch-project/security/pull/588#discussion_r461261861", "bodyText": "indices:data involves document indexing and indices:monitor involves monitoring requests.\nWe are only interested in requests affecting an index like index is created, deleted, settings updated, close, open, update mappings so on.", "author": "sujithvm", "createdAt": "2020-07-28T01:22:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTI1NzU0MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTI2MjY1OQ==", "url": "https://github.com/opensearch-project/security/pull/588#discussion_r461262659", "bodyText": "Also document data access is already covered under compliance", "author": "sujithvm", "createdAt": "2020-07-28T01:25:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTI1NzU0MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTI2NDgxNw==", "url": "https://github.com/opensearch-project/security/pull/588#discussion_r461264817", "bodyText": "Thanks for the information.", "author": "debjanibnrj", "createdAt": "2020-07-28T01:33:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTI1NzU0MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTI1NzkwMg==", "url": "https://github.com/opensearch-project/security/pull/588#discussion_r461257902", "bodyText": "nit: empty line", "author": "debjanibnrj", "createdAt": "2020-07-28T01:08:33Z", "path": "src/test/java/com/amazon/opendistroforelasticsearch/security/auditlog/impl/DisabledCategoriesTest.java", "diffHunk": "@@ -209,6 +209,8 @@ protected void logAll(AuditLog auditLog) {\n \t\tlogTransportBadHeaders(auditLog);\n \t\tlogTransportFailedLogin(auditLog);\n \t\tlogTransportSucceededLogin(auditLog);\n+", "originalCommit": "cd689ab92b72adfe7bafa2f885ed6205e4c267e7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTI2MjEwNQ==", "url": "https://github.com/opensearch-project/security/pull/588#discussion_r461262105", "bodyText": "There are new line separations above it hence added.", "author": "sujithvm", "createdAt": "2020-07-28T01:23:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTI1NzkwMg=="}], "type": "inlineReview"}, {"oid": "0f56025d0e3ca4e9ed9a4e58724db435ad1ea372", "url": "https://github.com/opensearch-project/security/commit/0f56025d0e3ca4e9ed9a4e58724db435ad1ea372", "message": "Merge remote-tracking branch 'upstream/master' into index_request", "committedDate": "2020-07-28T18:20:30Z", "type": "commit"}]}