{"pr_number": 3839, "pr_title": "Notification for Auto Downloads", "pr_createdAt": "2020-02-07T02:55:28Z", "pr_url": "https://github.com/AntennaPod/AntennaPod/pull/3839", "timeline": [{"oid": "26814568777f0a49fff5dd4a5de3f0493821c5d2", "url": "https://github.com/AntennaPod/AntennaPod/commit/26814568777f0a49fff5dd4a5de3f0493821c5d2", "message": "Fix build and tests", "committedDate": "2020-02-07T03:48:54Z", "type": "forcePushed"}, {"oid": "4bdf5b5ce35dfa48b5f682ffa4e3ab0647714618", "url": "https://github.com/AntennaPod/AntennaPod/commit/4bdf5b5ce35dfa48b5f682ffa4e3ab0647714618", "message": "Rename generatedBySystem to initiatedByUser", "committedDate": "2020-02-07T16:42:46Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njc4MjYyOA==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3839#discussion_r376782628", "bodyText": "This parameter seems to be always true. You can just remove it :)", "author": "ByteHamster", "createdAt": "2020-02-09T13:08:29Z", "path": "app/src/main/java/de/danoeh/antennapod/activity/OnlineFeedViewActivity.java", "diffHunk": "@@ -225,7 +225,7 @@ public boolean onOptionsItemSelected(MenuItem item) {\n         return super.onOptionsItemSelected(item);\n     }\n \n-    private void startFeedDownload(String url, String username, String password) {\n+    private void startFeedDownload(String url, String username, String password, boolean initiatedByUser) {", "originalCommit": "4bdf5b5ce35dfa48b5f682ffa4e3ab0647714618", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzA4ODQ5Mw==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3839#discussion_r377088493", "bodyText": "Fixed.", "author": "shortspider", "createdAt": "2020-02-10T14:18:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njc4MjYyOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njc4Mjg2NQ==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3839#discussion_r376782865", "bodyText": "I do not think this is needed", "author": "ByteHamster", "createdAt": "2020-02-09T13:12:12Z", "path": "core/src/main/java/de/danoeh/antennapod/core/storage/PodDBAdapter.java", "diffHunk": "@@ -110,6 +110,7 @@\n     public static final String KEY_INCLUDE_FILTER = \"include_filter\";\n     public static final String KEY_EXCLUDE_FILTER = \"exclude_filter\";\n     public static final String KEY_FEED_PLAYBACK_SPEED = \"feed_playback_speed\";\n+    public static final String KEY_INITIATED_BY_USER = \"initiated_by_user\";", "originalCommit": "4bdf5b5ce35dfa48b5f682ffa4e3ab0647714618", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzA4OTI3Mg==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3839#discussion_r377089272", "bodyText": "It's used in DownloadStatus to create a staus from a cursor.", "author": "shortspider", "createdAt": "2020-02-10T14:19:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njc4Mjg2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODE0MjQxMA==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3839#discussion_r378142410", "bodyText": "The cursor is used for things that come from the database. You did not update the database to contain this column. I think when creating a status from cursor, the initiatedByUser field does not matter (it is just used for the Downloads\u00bbLogs page). So you can just set it to false and remove the key here.", "author": "ByteHamster", "createdAt": "2020-02-12T09:51:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njc4Mjg2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODI0NTA1Nw==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3839#discussion_r378245057", "bodyText": "OK that makes sense, changed.", "author": "shortspider", "createdAt": "2020-02-12T13:21:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njc4Mjg2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njc4MzAzMw==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3839#discussion_r376783033", "bodyText": "Please keep this line", "author": "ByteHamster", "createdAt": "2020-02-09T13:15:16Z", "path": "core/src/main/java/de/danoeh/antennapod/core/service/download/DownloadServiceNotification.java", "diffHunk": "@@ -108,9 +108,11 @@ public void updateReport(List<DownloadStatus> reportQueue) {\n             if (status.isSuccessful()) {\n                 successfulDownloads++;\n             } else if (!status.isCancelled()) {\n-                createReport = true;", "originalCommit": "4bdf5b5ce35dfa48b5f682ffa4e3ab0647714618", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzE0ODg0Nw==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3839#discussion_r377148847", "bodyText": "Changed.", "author": "shortspider", "createdAt": "2020-02-10T15:52:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njc4MzAzMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njc4MzEyNQ==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3839#discussion_r376783125", "bodyText": "This is only about auto download. Please do not add something related to failed downloads here.", "author": "ByteHamster", "createdAt": "2020-02-09T13:16:19Z", "path": "core/src/main/java/de/danoeh/antennapod/core/service/download/DownloadServiceNotification.java", "diffHunk": "@@ -108,9 +108,11 @@ public void updateReport(List<DownloadStatus> reportQueue) {\n             if (status.isSuccessful()) {\n                 successfulDownloads++;\n             } else if (!status.isCancelled()) {\n-                createReport = true;\n                 failedDownloads++;\n             }\n+            if (failedDownloads > 0 || showAutoDownloadReport && !status.isInitiatedByUser() && status.getFeedfileType() == FeedMedia.FEEDFILETYPE_FEEDMEDIA) {", "originalCommit": "4bdf5b5ce35dfa48b5f682ffa4e3ab0647714618", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzE0ODk5Nw==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3839#discussion_r377148997", "bodyText": "Changed.", "author": "shortspider", "createdAt": "2020-02-10T15:52:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njc4MzEyNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njc4MzE4Nw==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3839#discussion_r376783187", "bodyText": "Instead of adding the field to DownloadStatus, please use status.getRequest().isInitiatedByUser(). Then we do not need another copy of the variable.", "author": "ByteHamster", "createdAt": "2020-02-09T13:17:22Z", "path": "core/src/main/java/de/danoeh/antennapod/core/service/download/DownloadStatus.java", "diffHunk": "@@ -41,62 +41,49 @@\n \t * FEEDFILETYPE_FEEDIMAGE or FEEDFILETYPE_FEEDMEDIA\n \t */\n     private final int feedfileType;\n+    private final boolean initiatedByUser;", "originalCommit": "4bdf5b5ce35dfa48b5f682ffa4e3ab0647714618", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzA4Nzc0Mg==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3839#discussion_r377087742", "bodyText": "There is no getRequest method that I can see. I can add it but not all status' are created with a request, and even so that seems like overkill. Or were you just talking about the constructor that takes a request? I'll clean that up either way.", "author": "shortspider", "createdAt": "2020-02-10T14:16:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njc4MzE4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODE0MDA3OA==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3839#discussion_r378140078", "bodyText": "Oh you are right. Then it's OK this way.", "author": "ByteHamster", "createdAt": "2020-02-12T09:47:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njc4MzE4Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njc4MzQ4MA==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3839#discussion_r376783480", "bodyText": "Users can also press the refresh button. I think this method might be called when users press the refresh button, so it is not always initiated by the system. Not sure what to pick here, though.", "author": "ByteHamster", "createdAt": "2020-02-09T13:20:55Z", "path": "core/src/main/java/de/danoeh/antennapod/core/storage/DBTasks.java", "diffHunk": "@@ -199,11 +199,12 @@ private static void refreshFeeds(final Context context,\n                 } catch (DownloadRequestException e) {\n                     e.printStackTrace();\n                     DBWriter.addDownloadStatus(\n-                            new DownloadStatus(feed, feed\n-                                    .getHumanReadableIdentifier(),\n-                                    DownloadError.ERROR_REQUEST_ERROR, false, e\n-                                    .getMessage()\n-                            )\n+                            new DownloadStatus(feed,\n+                                               feed.getHumanReadableIdentifier(),\n+                                               DownloadError.ERROR_REQUEST_ERROR,\n+                                               false,\n+                                               e.getMessage(),\n+                                               false)", "originalCommit": "4bdf5b5ce35dfa48b5f682ffa4e3ab0647714618", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzA5NjA0Mw==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3839#discussion_r377096043", "bodyText": "Good catch, managed to get it sorted out.", "author": "shortspider", "createdAt": "2020-02-10T14:30:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njc4MzQ4MA=="}], "type": "inlineReview"}, {"oid": "787dadd0abbc2611e7fa9a772fad072e1fd9f999", "url": "https://github.com/AntennaPod/AntennaPod/commit/787dadd0abbc2611e7fa9a772fad072e1fd9f999", "message": "Fix build after rebase", "committedDate": "2020-02-12T13:34:59Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTY5MDYxNQ==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3839#discussion_r385690615", "bodyText": "Please break to a new line. The maximum line length should be 120 characters. This is currently not enforced by the CI because other parts of the app do not comply but I want new code to be consistent.", "author": "ByteHamster", "createdAt": "2020-02-28T13:20:26Z", "path": "core/src/main/java/de/danoeh/antennapod/core/storage/DownloadRequester.java", "diffHunk": "@@ -203,25 +203,26 @@ public synchronized void downloadFeed(Context context, Feed feed, boolean loadAl\n             args.putBoolean(REQUEST_ARG_LOAD_ALL_PAGES, loadAllPages);\n \n             DownloadRequest request = createRequest(feed, null, new File(getFeedfilePath(), getFeedfileName(feed)),\n-                    true, username, password, lastModified, true, args);\n+                    true, username, password, lastModified, true, args, initiatedByUser\n+            );\n             if (request != null) {\n                 download(context, request);\n             }\n         }\n     }\n \n     public synchronized void downloadFeed(Context context, Feed feed) throws DownloadRequestException {\n-        downloadFeed(context, feed, false, false);\n+        downloadFeed(context, feed, false, false, true);\n     }\n \n-    public synchronized void downloadMedia(@NonNull Context context, FeedItem... feedItems)\n+    public synchronized void downloadMedia(@NonNull Context context, boolean initiatedByUser, FeedItem... feedItems)\n             throws DownloadRequestException {\n-        downloadMedia(true, context, feedItems);\n+        downloadMedia(true, context, initiatedByUser, feedItems);\n \n     }\n \n     @VisibleForTesting(otherwise = VisibleForTesting.PACKAGE_PRIVATE)\n-    public synchronized void downloadMedia(boolean performAutoCleanup, @NonNull Context context,\n+    public synchronized void downloadMedia(boolean performAutoCleanup, @NonNull Context context, boolean initiatedByUser,", "originalCommit": "bd327f119b32cdf3b053eded9ed8ae3dfda42233", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDcwMjQyNw==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3839#discussion_r390702427", "bodyText": "Changed.", "author": "shortspider", "createdAt": "2020-03-11T01:39:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTY5MDYxNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTY5MjM5MQ==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3839#discussion_r385692391", "bodyText": "Please add a space after (byte)", "author": "ByteHamster", "createdAt": "2020-02-28T13:23:52Z", "path": "core/src/main/java/de/danoeh/antennapod/core/service/download/DownloadRequest.java", "diffHunk": "@@ -107,6 +134,7 @@ public void writeToParcel(Parcel dest, int flags) {\n         dest.writeString(nonNullString(password));\n         dest.writeByte((mediaEnqueued) ? (byte) 1 : 0);\n         dest.writeBundle(arguments);\n+        dest.writeByte(initiatedByUser ? (byte)1 : 0);", "originalCommit": "bd327f119b32cdf3b053eded9ed8ae3dfda42233", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDcwMjU1Mg==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3839#discussion_r390702552", "bodyText": "Changed.", "author": "shortspider", "createdAt": "2020-03-11T01:40:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTY5MjM5MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTY5MjgwNA==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3839#discussion_r385692804", "bodyText": "To be honest, I think this is harder to read than before. This nearly fills the screen of my laptop vertically and is basically empty horizontally. Please break the lines, so that one line has more than one parameter.", "author": "ByteHamster", "createdAt": "2020-02-28T13:24:47Z", "path": "core/src/main/java/de/danoeh/antennapod/core/service/download/DownloadRequest.java", "diffHunk": "@@ -38,50 +39,76 @@ public DownloadRequest(@NonNull String destination,\n                            String username,\n                            String password,\n                            boolean deleteOnFailure,\n-                           Bundle arguments) {\n+                           Bundle arguments,\n+                           boolean initiatedByUser) {\n+        this(destination,\n+             source,\n+             title,\n+             feedfileId,\n+             feedfileType,\n+             null,\n+             deleteOnFailure,\n+             username,\n+             password,\n+             false,\n+             arguments,\n+             initiatedByUser);", "originalCommit": "bd327f119b32cdf3b053eded9ed8ae3dfda42233", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDcwMzI0NA==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3839#discussion_r390703244", "bodyText": "Changed.", "author": "shortspider", "createdAt": "2020-03-11T01:42:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTY5MjgwNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTY5MjkxOQ==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3839#discussion_r385692919", "bodyText": "Please add line breaks", "author": "ByteHamster", "createdAt": "2020-02-28T13:25:00Z", "path": "core/src/main/java/de/danoeh/antennapod/core/service/download/DownloadRequest.java", "diffHunk": "@@ -258,6 +287,8 @@ public boolean isMediaEnqueued() {\n         return mediaEnqueued;\n     }\n \n+    public boolean isInitiatedByUser() { return initiatedByUser; }", "originalCommit": "bd327f119b32cdf3b053eded9ed8ae3dfda42233", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDcwMzcyNA==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3839#discussion_r390703724", "bodyText": "Changed.", "author": "shortspider", "createdAt": "2020-03-11T01:45:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTY5MjkxOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTY5NTUwNQ==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3839#discussion_r385695505", "bodyText": "This file seems to be indented with tabs instead of spaces. While you are already touching big parts of the file, it would make sense to let Android Studio convert the file to spaces instead of tabs. That would also fix the strange indention above.", "author": "ByteHamster", "createdAt": "2020-02-28T13:30:31Z", "path": "core/src/main/java/de/danoeh/antennapod/core/service/download/DownloadStatus.java", "diffHunk": "@@ -109,18 +95,41 @@ public static DownloadStatus fromCursor(Cursor cursor) {\n \t\tint indexCompletionDate = cursor.getColumnIndex(PodDBAdapter.KEY_COMPLETION_DATE);\n \t\tint indexReasonDetailed = cursor.getColumnIndex(PodDBAdapter.KEY_REASON_DETAILED);\n \n-\t\tlong id = cursor.getLong(indexId);\n-\t\tString title = cursor.getString(indexTitle);\n-\t\tlong feedfileId = cursor.getLong(indexFeedFile);\n-\t\tint feedfileType = cursor.getInt(indexFileFileType);\n-\t\tboolean successful = cursor.getInt(indexSuccessful) > 0;\n-\t\tint reason = cursor.getInt(indexReason);\n-\t\tDate completionDate = new Date(cursor.getLong(indexCompletionDate));\n-\t\tString reasonDetailed = cursor.getString(indexReasonDetailed);\n-\n-\t\treturn new DownloadStatus(id, title, feedfileId,\n-\t\t\t\tfeedfileType, successful, DownloadError.fromCode(reason), completionDate,\n-\t\t\t\treasonDetailed);\n+\t\treturn new DownloadStatus(cursor.getLong(indexId),\n+\t\t\t\t\t\t\t\t  cursor.getString(indexTitle),\n+\t\t\t\t\t\t\t\t  cursor.getLong(indexFeedFile),\n+\t\t\t\t\t\t\t\t  cursor.getInt(indexFileFileType),\n+\t\t\t\t\t\t\t\t  cursor.getInt(indexSuccessful) > 0,\n+\t\t\t\t\t\t\t\t  false,\n+\t\t\t\t\t\t\t\t  true,\n+\t\t\t\t\t\t\t\t  DownloadError.fromCode(cursor.getInt(indexReason)),\n+\t\t\t\t\t\t\t\t  new Date(cursor.getLong(indexCompletionDate)),\n+\t\t\t\t\t\t\t\t  cursor.getString(indexReasonDetailed),\n+\t\t\t\t\t\t\t\t  false);", "originalCommit": "bd327f119b32cdf3b053eded9ed8ae3dfda42233", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDcwNTAyMw==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3839#discussion_r390705023", "bodyText": "Changed.", "author": "shortspider", "createdAt": "2020-03-11T01:50:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTY5NTUwNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTY5NjQ1NQ==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3839#discussion_r385696455", "bodyText": "Just wondering... The two kinds of notifications are now quite different (Channel, text, maybe even icon). Would it make sense to extract the auto download notification to a new class instead of handling everything in the existing notificationManager? I have not checked if this will lead to a lot of code duplication, though.", "author": "ByteHamster", "createdAt": "2020-02-28T13:32:39Z", "path": "core/src/main/java/de/danoeh/antennapod/core/service/download/DownloadService.java", "diffHunk": "@@ -205,9 +205,10 @@ public void onDestroy() {\n         Log.d(TAG, \"Service shutting down\");\n         isRunning = false;\n \n+        boolean showAutoDownloadReport = UserPreferences.showAutoDownloadReport();\n         if (ClientConfig.downloadServiceCallbacks.shouldCreateReport()\n-                && UserPreferences.showDownloadReport()) {\n-            notificationManager.updateReport(reportQueue);\n+                && (UserPreferences.showDownloadReport() || showAutoDownloadReport)) {\n+            notificationManager.updateReport(reportQueue, showAutoDownloadReport);", "originalCommit": "bd327f119b32cdf3b053eded9ed8ae3dfda42233", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDcwNjA2OA==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3839#discussion_r390706068", "bodyText": "I'm not 100% sure what you mean here. DownloadService seems to be the right place to kick off a notification and notificationManager (to me anyway) seems like a class that will generate whatever notification is required for a given set of parameters. IMO if we did create another class there would be a fair bit of duplication.", "author": "shortspider", "createdAt": "2020-03-11T01:55:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTY5NjQ1NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc0MTY2Nw==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3839#discussion_r393741667", "bodyText": "IMO if we did create another class there would be a fair bit of duplication.\n\n\ud83d\udc4d", "author": "ByteHamster", "createdAt": "2020-03-17T14:57:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTY5NjQ1NQ=="}], "type": "inlineReview"}, {"oid": "7717669c9d045efe8807d762b3283e6d5ef06bb7", "url": "https://github.com/AntennaPod/AntennaPod/commit/7717669c9d045efe8807d762b3283e6d5ef06bb7", "message": "Autodownload notification opens queue", "committedDate": "2020-03-12T20:05:30Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzczMzcwNg==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3839#discussion_r393733706", "bodyText": "Please use request.getTitle() instead of feed.getHumanReadableIdentifier(): In this case, feed does not have a human readable title yet", "author": "ByteHamster", "createdAt": "2020-03-17T14:46:44Z", "path": "core/src/main/java/de/danoeh/antennapod/core/service/download/handler/FeedParserTask.java", "diffHunk": "@@ -78,12 +78,12 @@ public FeedHandlerResult call() {\n         }\n \n         if (successful) {\n-            downloadStatus = new DownloadStatus(feed, feed.getHumanReadableIdentifier(),\n-                    DownloadError.SUCCESS, successful, reasonDetailed);\n+            downloadStatus = new DownloadStatus(feed, feed.getHumanReadableIdentifier(), DownloadError.SUCCESS,\n+                                                successful, reasonDetailed, request.isInitiatedByUser());\n             return result;\n         } else {\n-            downloadStatus = new DownloadStatus(feed, request.getTitle(),\n-                    reason, successful, reasonDetailed);\n+            downloadStatus = new DownloadStatus(feed, feed.getHumanReadableIdentifier(), reason, successful,", "originalCommit": "7717669c9d045efe8807d762b3283e6d5ef06bb7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjEzNDA3MQ==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3839#discussion_r396134071", "bodyText": "Changed.", "author": "shortspider", "createdAt": "2020-03-22T19:54:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzczMzcwNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzczNzk5OA==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3839#discussion_r393737998", "bodyText": "I think the description string is wrong. Should be the new one for auto download\nCould you please use the same formatting as the rest of the file, so that it looks more even?", "author": "ByteHamster", "createdAt": "2020-03-17T14:52:35Z", "path": "core/src/main/java/de/danoeh/antennapod/core/util/gui/NotificationUtils.java", "diffHunk": "@@ -62,4 +64,14 @@ private static NotificationChannel createChannelError(Context c) {\n         mChannel.setDescription(c.getString(R.string.notification_channel_error_description));\n         return mChannel;\n     }\n+\n+    @RequiresApi(api = Build.VERSION_CODES.O)\n+    private static NotificationChannel createChannelAutoDownload(Context c) {\n+        NotificationChannel mChannel = new NotificationChannel(\n+                                            CHANNEL_ID_AUTO_DOWNLOAD,\n+                                            c.getString(R.string.notification_channel_auto_download),\n+                                            NotificationManager.IMPORTANCE_DEFAULT);\n+        mChannel.setDescription(c.getString(R.string.notification_channel_downloading_description));", "originalCommit": "7717669c9d045efe8807d762b3283e6d5ef06bb7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjEzNDcxNg==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3839#discussion_r396134716", "bodyText": "Done.", "author": "shortspider", "createdAt": "2020-03-22T20:00:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzczNzk5OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzczOTc0Ng==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3839#discussion_r393739746", "bodyText": "I think createReport |= ... would be easier to read because you do not need to think about operator precedence", "author": "ByteHamster", "createdAt": "2020-03-17T14:55:00Z", "path": "core/src/main/java/de/danoeh/antennapod/core/service/download/DownloadServiceNotification.java", "diffHunk": "@@ -107,29 +107,28 @@ public void updateReport(List<DownloadStatus> reportQueue) {\n         for (DownloadStatus status : reportQueue) {\n             if (status.isSuccessful()) {\n                 successfulDownloads++;\n+                createReport = createReport || showAutoDownloadReport && !status.isInitiatedByUser() && status.getFeedfileType() == FeedMedia.FEEDFILETYPE_FEEDMEDIA;", "originalCommit": "7717669c9d045efe8807d762b3283e6d5ef06bb7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjEzNDgwNw==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3839#discussion_r396134807", "bodyText": "Agreed.", "author": "shortspider", "createdAt": "2020-03-22T20:01:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzczOTc0Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc0MDU5Ng==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3839#discussion_r393740596", "bodyText": "I think it would make sense to create a second method here.", "author": "ByteHamster", "createdAt": "2020-03-17T14:56:08Z", "path": "app/src/main/java/de/danoeh/antennapod/config/DownloadServiceCallbacksImpl.java", "diffHunk": "@@ -38,13 +39,15 @@ public PendingIntent getAuthentificationNotificationContentIntent(Context contex\n     }\n \n     @Override\n-    public PendingIntent getReportNotificationContentIntent(Context context) {\n+    public PendingIntent getReportNotificationContentIntent(Context context, boolean autoDownloadReport) {", "originalCommit": "7717669c9d045efe8807d762b3283e6d5ef06bb7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjEzNTcwNg==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3839#discussion_r396135706", "bodyText": "Done.", "author": "shortspider", "createdAt": "2020-03-22T20:12:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc0MDU5Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc0NDE4NQ==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3839#discussion_r393744185", "bodyText": "Please use the same string for ticker and content title. Also, I think it would be easier to read the code if you copied the notification builder code: if(autoDownloadReport){...}else{...} instead of using the ? operator in basically every line.", "author": "ByteHamster", "createdAt": "2020-03-17T15:00:51Z", "path": "core/src/main/java/de/danoeh/antennapod/core/service/download/DownloadServiceNotification.java", "diffHunk": "@@ -107,29 +107,28 @@ public void updateReport(List<DownloadStatus> reportQueue) {\n         for (DownloadStatus status : reportQueue) {\n             if (status.isSuccessful()) {\n                 successfulDownloads++;\n+                createReport = createReport || showAutoDownloadReport && !status.isInitiatedByUser() && status.getFeedfileType() == FeedMedia.FEEDFILETYPE_FEEDMEDIA;\n             } else if (!status.isCancelled()) {\n-                createReport = true;\n                 failedDownloads++;\n+                createReport = true;\n             }\n         }\n \n         if (createReport) {\n             Log.d(TAG, \"Creating report\");\n+\n             // create notification object\n-            NotificationCompat.Builder builder = new NotificationCompat.Builder(context,\n-                    NotificationUtils.CHANNEL_ID_ERROR)\n-                    .setTicker(context.getString(R.string.download_report_title))\n-                    .setContentTitle(context.getString(R.string.download_report_content_title))\n-                    .setContentText(\n-                            String.format(\n-                                    context.getString(R.string.download_report_content),\n-                                    successfulDownloads, failedDownloads)\n-                    )\n-                    .setSmallIcon(R.drawable.stat_notify_sync_error)\n-                    .setContentIntent(\n-                            ClientConfig.downloadServiceCallbacks.getReportNotificationContentIntent(context)\n-                    )\n-                    .setAutoCancel(true);\n+            boolean autoDownloadReport = failedDownloads == 0;\n+            String channelId = autoDownloadReport ? NotificationUtils.CHANNEL_ID_AUTO_DOWNLOAD : NotificationUtils.CHANNEL_ID_ERROR;\n+            int titleId = autoDownloadReport ? R.string.auto_download_report_title : R.string.download_report_title;\n+\n+            NotificationCompat.Builder builder = new NotificationCompat.Builder(context, channelId);\n+            builder.setTicker(context.getString(titleId))\n+                   .setContentTitle(context.getString(R.string.download_report_content_title))", "originalCommit": "7717669c9d045efe8807d762b3283e6d5ef06bb7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjEzNTMzMg==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3839#discussion_r396135332", "bodyText": "Agreed, done.", "author": "shortspider", "createdAt": "2020-03-22T20:07:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc0NDE4NQ=="}], "type": "inlineReview"}, {"oid": "b5244bbe99e423bfe5a2377728a086343a4c2fff", "url": "https://github.com/AntennaPod/AntennaPod/commit/b5244bbe99e423bfe5a2377728a086343a4c2fff", "message": "Add generatedBySystem to DownloadRequest", "committedDate": "2020-03-22T20:19:31Z", "type": "commit"}, {"oid": "895af777cf761aa0edba7b89dd04318ab6ede1d2", "url": "https://github.com/AntennaPod/AntennaPod/commit/895af777cf761aa0edba7b89dd04318ab6ede1d2", "message": "Add generatedBySystem to DownloadStatus", "committedDate": "2020-03-22T20:19:31Z", "type": "commit"}, {"oid": "39e0d20ae7db2bf263ba02ebd9cfaccd5988a96f", "url": "https://github.com/AntennaPod/AntennaPod/commit/39e0d20ae7db2bf263ba02ebd9cfaccd5988a96f", "message": "Create report if download generated by system", "committedDate": "2020-03-22T20:19:31Z", "type": "commit"}, {"oid": "1eaecf8358b3c5a9b946fa5283f6f60051dbc7b5", "url": "https://github.com/AntennaPod/AntennaPod/commit/1eaecf8358b3c5a9b946fa5283f6f60051dbc7b5", "message": "Add preferences", "committedDate": "2020-03-22T20:19:31Z", "type": "commit"}, {"oid": "bbc994fc9bf4e066e80af624ee4329f95ac8db4b", "url": "https://github.com/AntennaPod/AntennaPod/commit/bbc994fc9bf4e066e80af624ee4329f95ac8db4b", "message": "Fix build and tests", "committedDate": "2020-03-22T20:25:04Z", "type": "commit"}, {"oid": "71f57bda32b942320b564ad68d0919fab0a77378", "url": "https://github.com/AntennaPod/AntennaPod/commit/71f57bda32b942320b564ad68d0919fab0a77378", "message": "Simplify constructors", "committedDate": "2020-03-22T20:25:04Z", "type": "commit"}, {"oid": "5d70a3cc38f561a95050fb552194d8b4ab4ef56d", "url": "https://github.com/AntennaPod/AntennaPod/commit/5d70a3cc38f561a95050fb552194d8b4ab4ef56d", "message": "Rename generatedBySystem to initiatedByUser", "committedDate": "2020-03-22T20:25:57Z", "type": "commit"}, {"oid": "bd4631126d55aa91df2b83aebd5afa1e8ef0c841", "url": "https://github.com/AntennaPod/AntennaPod/commit/bd4631126d55aa91df2b83aebd5afa1e8ef0c841", "message": "Updates based on QA feedback", "committedDate": "2020-03-22T20:25:57Z", "type": "commit"}, {"oid": "f7c520bc65c2c8c102f22c1a4d1e7eb5c7d8ad38", "url": "https://github.com/AntennaPod/AntennaPod/commit/f7c520bc65c2c8c102f22c1a4d1e7eb5c7d8ad38", "message": "Remove unused constant", "committedDate": "2020-03-22T20:25:57Z", "type": "commit"}, {"oid": "052c86f43b8646cda322ae592cdf0cce6f186340", "url": "https://github.com/AntennaPod/AntennaPod/commit/052c86f43b8646cda322ae592cdf0cce6f186340", "message": "Fix build after rebase", "committedDate": "2020-03-22T20:25:57Z", "type": "commit"}, {"oid": "7a93f1e513c3616cebd88567fc701578cef357f1", "url": "https://github.com/AntennaPod/AntennaPod/commit/7a93f1e513c3616cebd88567fc701578cef357f1", "message": "Add new notification channel", "committedDate": "2020-03-22T20:25:57Z", "type": "commit"}, {"oid": "576baf90d874834dc3c0c9d52e40a0882a5c9136", "url": "https://github.com/AntennaPod/AntennaPod/commit/576baf90d874834dc3c0c9d52e40a0882a5c9136", "message": "Requested changes from review feedback", "committedDate": "2020-03-22T20:25:57Z", "type": "commit"}, {"oid": "ad54ed3ec6685ade44e0238841569e0dd3187903", "url": "https://github.com/AntennaPod/AntennaPod/commit/ad54ed3ec6685ade44e0238841569e0dd3187903", "message": "Autodownload notification opens queue", "committedDate": "2020-03-22T20:27:28Z", "type": "commit"}, {"oid": "f82f9d702c90577737c2073f7bfc2ef64a6b9b7c", "url": "https://github.com/AntennaPod/AntennaPod/commit/f82f9d702c90577737c2073f7bfc2ef64a6b9b7c", "message": "Changes based on feedback", "committedDate": "2020-03-22T20:28:51Z", "type": "commit"}, {"oid": "f82f9d702c90577737c2073f7bfc2ef64a6b9b7c", "url": "https://github.com/AntennaPod/AntennaPod/commit/f82f9d702c90577737c2073f7bfc2ef64a6b9b7c", "message": "Changes based on feedback", "committedDate": "2020-03-22T20:28:51Z", "type": "forcePushed"}, {"oid": "16345468e33fb8252986c9ebfb26f3b0ad3a3c23", "url": "https://github.com/AntennaPod/AntennaPod/commit/16345468e33fb8252986c9ebfb26f3b0ad3a3c23", "message": "Fix build after rebase", "committedDate": "2020-03-22T20:31:43Z", "type": "commit"}, {"oid": "c2d87f57e584ebf4e85a1cf098da4ab6f224db58", "url": "https://github.com/AntennaPod/AntennaPod/commit/c2d87f57e584ebf4e85a1cf098da4ab6f224db58", "message": "Use different ids", "committedDate": "2020-03-25T00:03:04Z", "type": "commit"}, {"oid": "125fa3932e84b7b13c9994b07b82abc8656bd0f9", "url": "https://github.com/AntennaPod/AntennaPod/commit/125fa3932e84b7b13c9994b07b82abc8656bd0f9", "message": "List episodes that are downloaded", "committedDate": "2020-03-25T00:48:35Z", "type": "commit"}, {"oid": "9637734000d399ffaa8739f5a3f1c1624b2a6a37", "url": "https://github.com/AntennaPod/AntennaPod/commit/9637734000d399ffaa8739f5a3f1c1624b2a6a37", "message": "Add and use new icon", "committedDate": "2020-03-25T01:12:02Z", "type": "commit"}, {"oid": "11ef58f5920cadadeb8e3f34fce14ce8ff005dc8", "url": "https://github.com/AntennaPod/AntennaPod/commit/11ef58f5920cadadeb8e3f34fce14ce8ff005dc8", "message": "Merge branch 'develop' into NotificationForAutoDownloads", "committedDate": "2020-03-26T16:17:52Z", "type": "commit"}, {"oid": "13ca1a8dbc04958eda4a488642139972637f6d2f", "url": "https://github.com/AntennaPod/AntennaPod/commit/13ca1a8dbc04958eda4a488642139972637f6d2f", "message": "Removed unused StringBuilder", "committedDate": "2020-03-26T17:56:25Z", "type": "commit"}]}