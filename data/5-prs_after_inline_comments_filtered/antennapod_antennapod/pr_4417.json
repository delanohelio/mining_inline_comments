{"pr_number": 4417, "pr_title": "Google Assistant App Actions for AntennaPod", "pr_createdAt": "2020-09-10T15:32:47Z", "pr_url": "https://github.com/AntennaPod/AntennaPod/pull/4417", "timeline": [{"oid": "1e604358ba8958c4951501da0728992d90b3af61", "url": "https://github.com/AntennaPod/AntennaPod/commit/1e604358ba8958c4951501da0728992d90b3af61", "message": "Added actions.xml", "committedDate": "2020-09-10T14:46:44Z", "type": "commit"}, {"oid": "cbc7f5ad7bd693132d4f5e55daabe3d1947c5507", "url": "https://github.com/AntennaPod/AntennaPod/commit/cbc7f5ad7bd693132d4f5e55daabe3d1947c5507", "message": "Added functionality to handle incoming intents and deeplinks", "committedDate": "2020-09-10T14:52:06Z", "type": "commit"}, {"oid": "eb5add27f79d3a208a7c844c64df460feae70391", "url": "https://github.com/AntennaPod/AntennaPod/commit/eb5add27f79d3a208a7c844c64df460feae70391", "message": "Made changes to handling deeplinks and intents in MainActivity. Added comments and specified entity set in actions.xml.", "committedDate": "2020-09-10T14:52:09Z", "type": "commit"}, {"oid": "bb515d9624de5a3b021c9a3ea6805ddf40ab60b2", "url": "https://github.com/AntennaPod/AntennaPod/commit/bb515d9624de5a3b021c9a3ea6805ddf40ab60b2", "message": "Implemented in-app search with Google Assistant (#2)\n\n* Implemented in-app search with Google Assistant\n\n* Updated a comment to split long sentences", "committedDate": "2020-09-10T14:56:26Z", "type": "commit"}, {"oid": "376f4730017d002208e7cf2dd93b04754970ce67", "url": "https://github.com/AntennaPod/AntennaPod/commit/376f4730017d002208e7cf2dd93b04754970ce67", "message": "App actions search (#3)\n\n* Implemented in-app search with Google Assistant\r\n\r\n* Updated a comment to split long sentences\r\n\r\n* Change urls to match the original package name", "committedDate": "2020-09-10T14:56:29Z", "type": "commit"}, {"oid": "25c3429d5587e3e280ba35699c454816a02fe73d", "url": "https://github.com/AntennaPod/AntennaPod/commit/25c3429d5587e3e280ba35699c454816a02fe73d", "message": "Updated imports in Main Activity", "committedDate": "2020-09-10T15:06:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ0MjE3MQ==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4417#discussion_r487442171", "bodyText": "This looks pretty similar to the switch in loadFragment. Could that one be re-used instead of creating another switch?", "author": "ByteHamster", "createdAt": "2020-09-12T19:45:46Z", "path": "app/src/main/java/de/danoeh/antennapod/activity/MainActivity.java", "diffHunk": "@@ -511,4 +543,57 @@ public Snackbar showSnackbarAbovePlayer(CharSequence text, int duration) {\n     public Snackbar showSnackbarAbovePlayer(int text, int duration) {\n         return showSnackbarAbovePlayer(getResources().getText(text), duration);\n     }\n+\n+    /**\n+     * Handles the deep link incoming via App Actions.\n+     * Performs an in-app search or opens the relevant feature of the app\n+     * depending on the query.\n+     *\n+     * @param uri incoming deep link\n+     */\n+    private void handleDeeplink(Uri uri) {\n+        if (uri == null || uri.getPath() == null) {\n+           return;\n+        }\n+\n+        switch (uri.getPath()) {\n+            case \"/search\":\n+                String query = uri.getQueryParameter(\"query\");\n+                if (query == null) {\n+                    return;\n+                }\n+\n+                this.loadChildFragment(OnlineSearchFragment.newInstance(CombinedSearcher.class, query));\n+                break;\n+\n+            case \"/main\":\n+                String feature = uri.getQueryParameter(\"featureName\");\n+                if (feature == null) {\n+                    return;\n+                }\n+\n+                feature = feature.toLowerCase();\n+                switch (feature) {\n+                    case \"downloads\":", "originalCommit": "25c3429d5587e3e280ba35699c454816a02fe73d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODU5NTE1MA==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4417#discussion_r488595150", "bodyText": "The feature names (and therefore, the parameters used in a potential user query in the Assistant) don\u2019t exactly match the Strings in the loadFragment switch so it\u2019s not possible to simply re-use it. One solution would be to add an additional method to convert the strings first, which would then get rid of the second switch.", "author": "mgborowiec", "createdAt": "2020-09-15T11:35:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ0MjE3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTU5MzExNw==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4417#discussion_r495593117", "bodyText": "Is this the same as the identifier specified in actions.xml (entity identifier=\"DOWNLOADS\")? If so, why do you use lower case here and upper case in actions.xml?", "author": "ByteHamster", "createdAt": "2020-09-27T17:01:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ0MjE3MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ0MjI2MA==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4417#discussion_r487442260", "bodyText": "We already have a function named handleNavIntent. Could those functions be combined? They seem to do pretty similar things.", "author": "ByteHamster", "createdAt": "2020-09-12T19:47:06Z", "path": "app/src/main/java/de/danoeh/antennapod/activity/MainActivity.java", "diffHunk": "@@ -492,6 +498,32 @@ private void handleNavIntent() {\n     protected void onNewIntent(Intent intent) {\n         super.onNewIntent(intent);\n         setIntent(intent);\n+\n+        handleIntent(intent);\n+    }\n+\n+    /**\n+     *  Handles the incoming intent. If the activity was launched via a deep link,\n+     *  passes the uri to handleDeeplink().\n+     *\n+     *  Added an SDK version check since the minimum SDK supported by AntennaPod is 16\n+     *  and Object.equals(Obj1, Obj2) is only supported in API 19+.\n+     *\n+     * @param intent incoming intent\n+     */\n+    private void handleIntent(Intent intent) {", "originalCommit": "25c3429d5587e3e280ba35699c454816a02fe73d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODU5NTAxNw==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4417#discussion_r488595017", "bodyText": "They could potentially be combined, however, I think keeping them separate is beneficial as they are meant for slightly different purposes.", "author": "mgborowiec", "createdAt": "2020-09-15T11:35:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ0MjI2MA=="}], "type": "inlineReview"}, {"oid": "02128be7a80301193bb70ab5fb4567959dc06d6f", "url": "https://github.com/AntennaPod/AntennaPod/commit/02128be7a80301193bb70ab5fb4567959dc06d6f", "message": "Code changes to deal with static analysis fails", "committedDate": "2020-09-15T11:32:48Z", "type": "commit"}, {"oid": "817dbea5952c40d8ae3d9398a4e11bd8c6bbade1", "url": "https://github.com/AntennaPod/AntennaPod/commit/817dbea5952c40d8ae3d9398a4e11bd8c6bbade1", "message": "URL change for App Actions", "committedDate": "2020-09-15T11:34:33Z", "type": "commit"}, {"oid": "1f1ec18b84b1d670ce7daa550245b0b9b1fe745b", "url": "https://github.com/AntennaPod/AntennaPod/commit/1f1ec18b84b1d670ce7daa550245b0b9b1fe745b", "message": "Referenced actions.xml in AndroidManifest", "committedDate": "2020-09-15T11:43:20Z", "type": "commit"}, {"oid": "415dc548f29adcf399a272da663442e632b797eb", "url": "https://github.com/AntennaPod/AntennaPod/commit/415dc548f29adcf399a272da663442e632b797eb", "message": "Merge branch 'develop' into appActionsPullRequest", "committedDate": "2021-01-23T19:35:53Z", "type": "commit"}, {"oid": "b526806a51587602243c45a679574487d306d93f", "url": "https://github.com/AntennaPod/AntennaPod/commit/b526806a51587602243c45a679574487d306d93f", "message": "Fixes and localization", "committedDate": "2021-01-23T21:57:45Z", "type": "commit"}, {"oid": "9629cc6bb1ac7b16663090ea9c138aecfab842f0", "url": "https://github.com/AntennaPod/AntennaPod/commit/9629cc6bb1ac7b16663090ea9c138aecfab842f0", "message": "Local search", "committedDate": "2021-01-24T14:12:55Z", "type": "commit"}]}