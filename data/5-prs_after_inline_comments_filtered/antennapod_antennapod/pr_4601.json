{"pr_number": 4601, "pr_title": "[Statistics] Add podcast specific statistics to podcast info screen", "pr_createdAt": "2020-10-26T05:10:53Z", "pr_url": "https://github.com/AntennaPod/AntennaPod/pull/4601", "timeline": [{"oid": "05b2c093cd8ebaab01d318dc20a9411b6109df61", "url": "https://github.com/AntennaPod/AntennaPod/commit/05b2c093cd8ebaab01d318dc20a9411b6109df61", "message": "Added count of episodes stocked on device in statistics", "committedDate": "2020-10-22T09:16:35Z", "type": "commit"}, {"oid": "2b372cfce811abcc7bfd6466ee7ed81410868bb3", "url": "https://github.com/AntennaPod/AntennaPod/commit/2b372cfce811abcc7bfd6466ee7ed81410868bb3", "message": "Middle Dot Added", "committedDate": "2020-10-24T08:11:06Z", "type": "commit"}, {"oid": "49b13697c159e3460a55ef76afcee5647bd7d72e", "url": "https://github.com/AntennaPod/AntennaPod/commit/49b13697c159e3460a55ef76afcee5647bd7d72e", "message": "Merge branch 'develop' of https://github.com/AntennaPod/AntennaPod into develop", "committedDate": "2020-10-26T03:32:18Z", "type": "commit"}, {"oid": "c0eb7c2c0bc5f952133b8ec097c211b54ad15060", "url": "https://github.com/AntennaPod/AntennaPod/commit/c0eb7c2c0bc5f952133b8ec097c211b54ad15060", "message": "Add podcast specific statistics to podcast info screen", "committedDate": "2020-10-26T05:02:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTc3Njc4Nw==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4601#discussion_r511776787", "bodyText": "I think it would be better to call both here and then decouple displaying statistics and displaying the other feed info", "author": "ByteHamster", "createdAt": "2020-10-26T08:08:42Z", "path": "app/src/main/java/de/danoeh/antennapod/fragment/FeedInfoFragment.java", "diffHunk": "@@ -169,7 +186,7 @@ public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceStat\n                 .observeOn(AndroidSchedulers.mainThread())\n                 .subscribe(result -> {\n                     feed = result;\n-                    showFeed();\n+                    loadStatistics();", "originalCommit": "a04e79283d571141594ef1ceb8c8adfd7128bfe4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTc3ODI4Ng==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4601#discussion_r511778286", "bodyText": "Oh, I think those lines can all just be removed. The title in settings is already handled by StatisticsFragment (where you added a similar change). That's a leftover from the old statistics screen with only one single tab.", "author": "ByteHamster", "createdAt": "2020-10-26T08:11:57Z", "path": "app/src/main/java/de/danoeh/antennapod/fragment/preferences/PlaybackStatisticsFragment.java", "diffHunk": "@@ -79,7 +79,9 @@ public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup c\n     @Override\n     public void onStart() {\n         super.onStart();\n-        ((PreferenceActivity) getActivity()).getSupportActionBar().setTitle(R.string.statistics_label);\n+        if (getActivity().getClass() == PreferenceActivity.class) {\n+            ((PreferenceActivity) getActivity()).getSupportActionBar().setTitle(R.string.statistics_label);\n+        }", "originalCommit": "a04e79283d571141594ef1ceb8c8adfd7128bfe4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTc4MTYwMQ==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4601#discussion_r511781601", "bodyText": "Please do a similar thing to the toolbar. Currently, the screen hides its toolbar but when calling from MainActivity, we need one. See this line in the same file:\nrootView.findViewById(R.id.toolbar).setVisibility(View.GONE);", "author": "ByteHamster", "createdAt": "2020-10-26T08:18:26Z", "path": "app/src/main/java/de/danoeh/antennapod/fragment/preferences/StatisticsFragment.java", "diffHunk": "@@ -67,7 +67,9 @@ public View onCreateView(@NonNull LayoutInflater inflater, ViewGroup container,\n     @Override\n     public void onStart() {\n         super.onStart();\n-        ((PreferenceActivity) getActivity()).getSupportActionBar().setTitle(R.string.statistics_label);\n+        if (getActivity().getClass() == PreferenceActivity.class) {\n+            ((PreferenceActivity) getActivity()).getSupportActionBar().setTitle(R.string.statistics_label);\n+        }", "originalCommit": "a04e79283d571141594ef1ceb8c8adfd7128bfe4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTc4NDcxMQ==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4601#discussion_r511784711", "bodyText": "You only use one of the feeds, so it is not necessary to sort the list", "author": "ByteHamster", "createdAt": "2020-10-26T08:24:29Z", "path": "app/src/main/java/de/danoeh/antennapod/fragment/FeedInfoFragment.java", "diffHunk": "@@ -218,18 +235,52 @@ private void showFeed() {\n             lblAuthor.setVisibility(View.GONE);\n             txtvAuthor.setVisibility(View.GONE);\n         }\n-        if (!TextUtils.isEmpty(feed.getLanguage())) {\n-            txtvLanguage.setText(LangUtils.getLanguageString(feed.getLanguage()));\n+        if (podcastStatistics != null) {\n+            txtvStatistics.setText(getString(R.string.podcast_listendes_for)\n+                    + \" \"\n+                    + Converter.shortLocalizedDuration(getContext(), podcastStatistics.timePlayed)\n+                    + \"\\n\"\n+                    + getString(R.string.podcast_on_device)\n+                    + \" \"\n+                    + Formatter.formatShortFileSize(getContext(), podcastStatistics.totalDownloadSize)\n+                    + \" \u2022 \"\n+                    + String.format(Locale.getDefault(), \"%d%s\",\n+                    podcastStatistics.episodesDownloadCount, getString(R.string.episodes_suffix)));\n         } else {\n-            lblLanguage.setVisibility(View.GONE);\n-            txtvLanguage.setVisibility(View.GONE);\n+            lblStatistics.setVisibility(View.GONE);\n+            txtvStatistics.setVisibility(View.GONE);\n         }\n+\n         txtvUrl.setText(feed.getDownload_url() + \" {fa-paperclip}\");\n         Iconify.addIcons(txtvUrl);\n-\n         getActivity().invalidateOptionsMenu();\n     }\n \n+    private void loadStatistics() {\n+        if (disposable != null) {\n+            disposable.dispose();\n+        }\n+\n+        disposable =\n+                Observable.fromCallable(() -> {\n+                    List<StatisticsItem> statisticsData = DBReader.getStatistics();\n+                    Collections.sort(statisticsData, (item1, item2) ->\n+                            CompareCompat.compareLong(item1.totalDownloadSize, item2.totalDownloadSize));", "originalCommit": "a04e79283d571141594ef1ceb8c8adfd7128bfe4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTc4NTQ0Mg==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4601#discussion_r511785442", "bodyText": "I would move this loop up to the fromCallable section. That way, searching is done in a background thread instead of the main UI thread.", "author": "ByteHamster", "createdAt": "2020-10-26T08:25:44Z", "path": "app/src/main/java/de/danoeh/antennapod/fragment/FeedInfoFragment.java", "diffHunk": "@@ -218,18 +235,52 @@ private void showFeed() {\n             lblAuthor.setVisibility(View.GONE);\n             txtvAuthor.setVisibility(View.GONE);\n         }\n-        if (!TextUtils.isEmpty(feed.getLanguage())) {\n-            txtvLanguage.setText(LangUtils.getLanguageString(feed.getLanguage()));\n+        if (podcastStatistics != null) {\n+            txtvStatistics.setText(getString(R.string.podcast_listendes_for)\n+                    + \" \"\n+                    + Converter.shortLocalizedDuration(getContext(), podcastStatistics.timePlayed)\n+                    + \"\\n\"\n+                    + getString(R.string.podcast_on_device)\n+                    + \" \"\n+                    + Formatter.formatShortFileSize(getContext(), podcastStatistics.totalDownloadSize)\n+                    + \" \u2022 \"\n+                    + String.format(Locale.getDefault(), \"%d%s\",\n+                    podcastStatistics.episodesDownloadCount, getString(R.string.episodes_suffix)));\n         } else {\n-            lblLanguage.setVisibility(View.GONE);\n-            txtvLanguage.setVisibility(View.GONE);\n+            lblStatistics.setVisibility(View.GONE);\n+            txtvStatistics.setVisibility(View.GONE);\n         }\n+\n         txtvUrl.setText(feed.getDownload_url() + \" {fa-paperclip}\");\n         Iconify.addIcons(txtvUrl);\n-\n         getActivity().invalidateOptionsMenu();\n     }\n \n+    private void loadStatistics() {\n+        if (disposable != null) {\n+            disposable.dispose();\n+        }\n+\n+        disposable =\n+                Observable.fromCallable(() -> {\n+                    List<StatisticsItem> statisticsData = DBReader.getStatistics();\n+                    Collections.sort(statisticsData, (item1, item2) ->\n+                            CompareCompat.compareLong(item1.totalDownloadSize, item2.totalDownloadSize));\n+                    return statisticsData;\n+                })\n+                        .subscribeOn(Schedulers.io())\n+                        .observeOn(AndroidSchedulers.mainThread())\n+                        .subscribe(result -> {\n+                            for (StatisticsItem item : result) {\n+                                if (item.feed.getId() == feed.getId()) {\n+                                    podcastStatistics = item;\n+                                    break;\n+                                }\n+                            }", "originalCommit": "a04e79283d571141594ef1ceb8c8adfd7128bfe4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "bc5a77236599be50160eae842ff4d21eb9ecb936", "url": "https://github.com/AntennaPod/AntennaPod/commit/bc5a77236599be50160eae842ff4d21eb9ecb936", "message": "Add podcast specific statistics to podcast info screen\n\nAdd podcast specific statistics to podcast info screen\n\nAdd podcast specific statistics to podcast info screen\n\nAdd podcast specific statistics to podcast info screen\n\nAdd podcast specific statistics to podcast info screen\n\nAdd podcast specific statistics to podcast info screen\n\nAdd podcast specific statistics to podcast info screen\n\nAdd podcast specific statistics to podcast info screen\n\nAdd podcast specific statistics to podcast info screen", "committedDate": "2020-10-26T10:39:08Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTkyNjQ4MA==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4601#discussion_r511926480", "bodyText": "Sorry, I think I was not precise in my comment. My idea was to do the filtering in the callable, not to create a new method. The problem with creating a new method like this is that it duplicates the code. When changing something, one always needs to remember to change both locations.\nI was thinking more about something like this:\n    Observable.fromCallable(() -> {\n                StatisticsItem statisticsData = DBReader.getStatistics();\n                // Do the filtering loop here instead of in the main thread\n                return foundFeed;\n            })", "author": "ByteHamster", "createdAt": "2020-10-26T12:36:08Z", "path": "core/src/main/java/de/danoeh/antennapod/core/storage/DBReader.java", "diffHunk": "@@ -789,6 +788,71 @@ public static FeedMedia getFeedMedia(final long mediaId) {\n         return feedTime;\n     }\n \n+    /**\n+     * Searches the DB for statistics of a particular podcast through its ID.\n+     *\n+     * @return The statistics object\n+     */\n+    @NonNull\n+    public static StatisticsItem getStatisticsFromId(long id) {", "originalCommit": "bc5a77236599be50160eae842ff4d21eb9ecb936", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTkzNzc2OQ==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4601#discussion_r511937769", "bodyText": "How about making the statistics 3 rows?\nListened for:           x hours\nEpisodes on the device: x episodes\nSpace used:             x MB\n                   View all statistics \u00bb", "author": "ByteHamster", "createdAt": "2020-10-26T12:55:51Z", "path": "app/src/main/java/de/danoeh/antennapod/fragment/FeedInfoFragment.java", "diffHunk": "@@ -218,18 +235,44 @@ private void showFeed() {\n             lblAuthor.setVisibility(View.GONE);\n             txtvAuthor.setVisibility(View.GONE);\n         }\n-        if (!TextUtils.isEmpty(feed.getLanguage())) {\n-            txtvLanguage.setText(LangUtils.getLanguageString(feed.getLanguage()));\n-        } else {\n-            lblLanguage.setVisibility(View.GONE);\n-            txtvLanguage.setVisibility(View.GONE);\n-        }\n+\n         txtvUrl.setText(feed.getDownload_url() + \" {fa-paperclip}\");\n         Iconify.addIcons(txtvUrl);\n-\n         getActivity().invalidateOptionsMenu();\n     }\n \n+    private void loadStatistics() {\n+        if (disposable != null) {\n+            disposable.dispose();\n+        }\n+\n+        disposable =\n+                Observable.fromCallable(() -> {\n+                    StatisticsItem statisticsData = DBReader.getStatisticsFromId(feed.getId());\n+                    return statisticsData;\n+                })\n+                        .subscribeOn(Schedulers.io())\n+                        .observeOn(AndroidSchedulers.mainThread())\n+                        .subscribe(result -> {\n+                            podcastStatistics = result;\n+                            if (podcastStatistics != null) {\n+                                txtvPodcastTime.setText(Converter.shortLocalizedDuration(\n+                                        getContext(), podcastStatistics.timePlayed));\n+                                txtvPodcastSpace.setText(Formatter.formatShortFileSize(\n+                                        getContext(), podcastStatistics.totalDownloadSize)\n+                                        + \" \u2022 \"", "originalCommit": "bc5a77236599be50160eae842ff4d21eb9ecb936", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjI4MzQwNQ==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4601#discussion_r512283405", "bodyText": "I like the idea, but actually I'd keep it consistent with the other statistics screens (thus: stick to two lines). Especially because this section will be displayed above the description (which otherwise on small screens might not be visible above the fold).", "author": "keunes", "createdAt": "2020-10-26T21:35:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTkzNzc2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjMxNTgyNQ==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4601#discussion_r512315825", "bodyText": "I like the idea, but actually I'd keep it consistent with the other statistics screens (thus: stick to two lines).\n\n@keunes Having it in only 2 (instead of 3) lines looks a bit strange, in my opinion. Have a look at the screenshots below.\n \n\nEspecially because this section will be displayed above the description\n\nMaybe we could even remove the authors section from that screen because the authors are displayed in the blurred area anyway. When doing that (and making headings the same font size+color as on the \"add podcast\" screen), the screen has more space for the description and looks more clean. See screenshot below.", "author": "ByteHamster", "createdAt": "2020-10-26T22:51:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTkzNzc2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjQwMDM2MA==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4601#discussion_r512400360", "bodyText": "I agree with @ByteHamster,  In my opinion 3 rows is looking clean than having 2 rows. Also it is looking good after removing Author section.", "author": "avirajrsingh", "createdAt": "2020-10-27T03:49:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTkzNzc2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjQwMDczOQ==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4601#discussion_r512400739", "bodyText": "Let me know if I need to make any changes and push again.", "author": "avirajrsingh", "createdAt": "2020-10-27T03:50:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTkzNzc2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjQ2NjQxNQ==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4601#discussion_r512466415", "bodyText": "@ByteHamster Can you share a screenshot of https://feeds.soundcloud.com/users/soundcloud:users:216894809/sounds.rss on a 5 inch 1080\u00d71920 px HD 446 ppi display? My main concern is that the 'Description' title will be below the fold - if that's secured also on smaller screens (or even smaller than my screen). (That specific feed as it spans two lines.)", "author": "keunes", "createdAt": "2020-10-27T07:31:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTkzNzc2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjQ2NzAwNg==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4601#discussion_r512467006", "bodyText": "and making headings the same font size+color as on the \"add podcast\" screen\n\nWhat do you mean?", "author": "keunes", "createdAt": "2020-10-27T07:32:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTkzNzc2OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTk0MTQ4NA==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4601#discussion_r511941484", "bodyText": "Adding something like the following should make the arrow button work:\ntoolbar.setNavigationOnClickListener(v -> getParentFragmentManager().popBackStack());", "author": "ByteHamster", "createdAt": "2020-10-26T13:02:17Z", "path": "app/src/main/java/de/danoeh/antennapod/fragment/preferences/StatisticsFragment.java", "diffHunk": "@@ -59,15 +62,21 @@ public View onCreateView(@NonNull LayoutInflater inflater, ViewGroup container,\n             }\n         }).attach();\n \n-        rootView.findViewById(R.id.toolbar).setVisibility(View.GONE);\n+        if (getActivity().getClass() == PreferenceActivity.class) {\n+            rootView.findViewById(R.id.toolbar).setVisibility(View.GONE);\n+        } else {\n+            toolbar.setTitle(getString(R.string.statistics_label));", "originalCommit": "bc5a77236599be50160eae842ff4d21eb9ecb936", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "32d4b7d555f60666c290954a6aed828b47c810b2", "url": "https://github.com/AntennaPod/AntennaPod/commit/32d4b7d555f60666c290954a6aed828b47c810b2", "message": "Add podcast specific statistics to podcast info screen\n\nAdd podcast specific statistics to podcast info screen\n\nAdd podcast specific statistics to podcast info screen\n\nAdd podcast specific statistics to podcast info screen\n\nAdd podcast specific statistics to podcast info screen\n\nAdd podcast specific statistics to podcast info screen\n\nAdd podcast specific statistics to podcast info screen\n\nAdd podcast specific statistics to podcast info screen\n\nAdd podcast specific statistics to podcast info screen\n\nAdd podcast specific statistics to podcast info screen\n\nAdd podcast specific statistics to podcast info screen", "committedDate": "2020-10-26T16:32:52Z", "type": "forcePushed"}, {"oid": "27f30b63e7ce1ee6e6b1a842f676313de23674e9", "url": "https://github.com/AntennaPod/AntennaPod/commit/27f30b63e7ce1ee6e6b1a842f676313de23674e9", "message": "Add podcast specific statistics to podcast info screen\n\nAdd podcast specific statistics to podcast info screen\n\nAdd podcast specific statistics to podcast info screen\n\nAdd podcast specific statistics to podcast info screen\n\nAdd podcast specific statistics to podcast info screen\n\nAdd podcast specific statistics to podcast info screen\n\nAdd podcast specific statistics to podcast info screen\n\nAdd podcast specific statistics to podcast info screen\n\nAdd podcast specific statistics to podcast info screen\n\nAdd podcast specific statistics to podcast info screen\n\nAdd podcast specific statistics to podcast info screen\n\nAdd podcast specific statistics to podcast info screen", "committedDate": "2020-10-28T09:04:36Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ5ODIzOA==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4601#discussion_r513498238", "bodyText": "You can directly return statisticsItem here and use it below (result) to avoid storing in a variable", "author": "ByteHamster", "createdAt": "2020-10-28T14:39:49Z", "path": "app/src/main/java/de/danoeh/antennapod/fragment/FeedInfoFragment.java", "diffHunk": "@@ -211,25 +226,50 @@ private void showFeed() {\n \n         txtvDescription.setText(description);\n \n-        if (!TextUtils.isEmpty(feed.getAuthor())) {\n-            txtvAuthor.setText(feed.getAuthor());\n-            txtvAuthorHeader.setText(feed.getAuthor());\n-        } else {\n-            lblAuthor.setVisibility(View.GONE);\n-            txtvAuthor.setVisibility(View.GONE);\n-        }\n-        if (!TextUtils.isEmpty(feed.getLanguage())) {\n-            txtvLanguage.setText(LangUtils.getLanguageString(feed.getLanguage()));\n-        } else {\n-            lblLanguage.setVisibility(View.GONE);\n-            txtvLanguage.setVisibility(View.GONE);\n-        }\n         txtvUrl.setText(feed.getDownload_url() + \" {fa-paperclip}\");\n         Iconify.addIcons(txtvUrl);\n-\n         getActivity().invalidateOptionsMenu();\n     }\n \n+    private void loadStatistics() {\n+        if (disposable != null) {\n+            disposable.dispose();\n+        }\n+\n+        disposable =\n+                Observable.fromCallable(() -> {\n+                    List<StatisticsItem> statisticsData = DBReader.getStatistics();\n+\n+                    for (StatisticsItem statisticsItem : statisticsData) {\n+                        if (statisticsItem.feed.getId() == feed.getId()) {\n+                            podcastStatistics = statisticsItem;\n+                            break;", "originalCommit": "8b71cd5f6c3732e40635b9436b38781da1dfe0a7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ5ODkxMQ==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4601#discussion_r513498911", "bodyText": "Please move the else part to the error -> section below. It is then called in both cases, when the loading code above fails or when it returns null.", "author": "ByteHamster", "createdAt": "2020-10-28T14:40:34Z", "path": "app/src/main/java/de/danoeh/antennapod/fragment/FeedInfoFragment.java", "diffHunk": "@@ -211,25 +226,50 @@ private void showFeed() {\n \n         txtvDescription.setText(description);\n \n-        if (!TextUtils.isEmpty(feed.getAuthor())) {\n-            txtvAuthor.setText(feed.getAuthor());\n-            txtvAuthorHeader.setText(feed.getAuthor());\n-        } else {\n-            lblAuthor.setVisibility(View.GONE);\n-            txtvAuthor.setVisibility(View.GONE);\n-        }\n-        if (!TextUtils.isEmpty(feed.getLanguage())) {\n-            txtvLanguage.setText(LangUtils.getLanguageString(feed.getLanguage()));\n-        } else {\n-            lblLanguage.setVisibility(View.GONE);\n-            txtvLanguage.setVisibility(View.GONE);\n-        }\n         txtvUrl.setText(feed.getDownload_url() + \" {fa-paperclip}\");\n         Iconify.addIcons(txtvUrl);\n-\n         getActivity().invalidateOptionsMenu();\n     }\n \n+    private void loadStatistics() {\n+        if (disposable != null) {\n+            disposable.dispose();\n+        }\n+\n+        disposable =\n+                Observable.fromCallable(() -> {\n+                    List<StatisticsItem> statisticsData = DBReader.getStatistics();\n+\n+                    for (StatisticsItem statisticsItem : statisticsData) {\n+                        if (statisticsItem.feed.getId() == feed.getId()) {\n+                            podcastStatistics = statisticsItem;\n+                            break;\n+                        }\n+                    }\n+\n+                    return podcastStatistics;\n+                })\n+                        .subscribeOn(Schedulers.io())\n+                        .observeOn(AndroidSchedulers.mainThread())\n+                        .subscribe(result -> {\n+                            if (podcastStatistics != null) {\n+                                txtvPodcastTime.setText(Converter.shortLocalizedDuration(\n+                                        getContext(), podcastStatistics.timePlayed));\n+                                txtvPodcastSpace.setText(Formatter.formatShortFileSize(\n+                                        getContext(), podcastStatistics.totalDownloadSize));\n+                                txtvPodcastEpisodeCount.setText(String.format(Locale.getDefault(),\n+                                        \"%d%s\", podcastStatistics.episodesDownloadCount,\n+                                        getString(R.string.episodes_suffix)));\n+                            } else {", "originalCommit": "8b71cd5f6c3732e40635b9436b38781da1dfe0a7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDM0MjY3NQ==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4601#discussion_r514342675", "bodyText": "You no longer need the else part here in the success section. RxJava automatically calls the error -> section when the result is null.", "author": "ByteHamster", "createdAt": "2020-10-29T15:19:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ5ODkxMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzUwMzAxNA==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4601#discussion_r513503014", "bodyText": "Please revert the change. While the line is really not needed, touching more files than necessary creates unnecessary noise.", "author": "ByteHamster", "createdAt": "2020-10-28T14:45:27Z", "path": "core/src/main/java/de/danoeh/antennapod/core/storage/DBReader.java", "diffHunk": "@@ -10,7 +10,6 @@\n import java.util.ArrayList;\n import java.util.Collections;\n import java.util.Comparator;\n-import java.util.Date;", "originalCommit": "8b71cd5f6c3732e40635b9436b38781da1dfe0a7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzUwNzMwNQ==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4601#discussion_r513507305", "bodyText": "The author in the header should still be displayed. Please only remove the author from the actual page, not from the blurred header.", "author": "ByteHamster", "createdAt": "2020-10-28T14:50:26Z", "path": "app/src/main/java/de/danoeh/antennapod/fragment/FeedInfoFragment.java", "diffHunk": "@@ -211,25 +226,50 @@ private void showFeed() {\n \n         txtvDescription.setText(description);\n \n-        if (!TextUtils.isEmpty(feed.getAuthor())) {\n-            txtvAuthor.setText(feed.getAuthor());\n-            txtvAuthorHeader.setText(feed.getAuthor());", "originalCommit": "8b71cd5f6c3732e40635b9436b38781da1dfe0a7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzUwOTcyOQ==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4601#discussion_r513509729", "bodyText": "Please create a new variable for this (eg. disposableStatistics) and make sure to dispose in onDestroy, like it is done with the other one. Otherwise, loading statistics and loading feed details could interfere.", "author": "ByteHamster", "createdAt": "2020-10-28T14:53:16Z", "path": "app/src/main/java/de/danoeh/antennapod/fragment/FeedInfoFragment.java", "diffHunk": "@@ -211,25 +226,50 @@ private void showFeed() {\n \n         txtvDescription.setText(description);\n \n-        if (!TextUtils.isEmpty(feed.getAuthor())) {\n-            txtvAuthor.setText(feed.getAuthor());\n-            txtvAuthorHeader.setText(feed.getAuthor());\n-        } else {\n-            lblAuthor.setVisibility(View.GONE);\n-            txtvAuthor.setVisibility(View.GONE);\n-        }\n-        if (!TextUtils.isEmpty(feed.getLanguage())) {\n-            txtvLanguage.setText(LangUtils.getLanguageString(feed.getLanguage()));\n-        } else {\n-            lblLanguage.setVisibility(View.GONE);\n-            txtvLanguage.setVisibility(View.GONE);\n-        }\n         txtvUrl.setText(feed.getDownload_url() + \" {fa-paperclip}\");\n         Iconify.addIcons(txtvUrl);\n-\n         getActivity().invalidateOptionsMenu();\n     }\n \n+    private void loadStatistics() {\n+        if (disposable != null) {\n+            disposable.dispose();\n+        }\n+\n+        disposable =", "originalCommit": "8b71cd5f6c3732e40635b9436b38781da1dfe0a7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "bf2c91ea8f8a37dc4aae17ba4a7f23fffe0083f5", "url": "https://github.com/AntennaPod/AntennaPod/commit/bf2c91ea8f8a37dc4aae17ba4a7f23fffe0083f5", "message": "Add podcast specific statistics to podcast info screen", "committedDate": "2020-10-29T04:10:52Z", "type": "forcePushed"}, {"oid": "efe7bb003f9a58d2a5edd75256273fdfab7c7308", "url": "https://github.com/AntennaPod/AntennaPod/commit/efe7bb003f9a58d2a5edd75256273fdfab7c7308", "message": "Add podcast specific statistics to podcast info screen", "committedDate": "2020-10-29T04:20:19Z", "type": "forcePushed"}, {"oid": "398f3b8738ea7a7211edf32c7ebb3cb7f1d9a4eb", "url": "https://github.com/AntennaPod/AntennaPod/commit/398f3b8738ea7a7211edf32c7ebb3cb7f1d9a4eb", "message": "Removed else block", "committedDate": "2020-10-29T16:50:18Z", "type": "forcePushed"}, {"oid": "f88306a37ce2af14a7e6c8b9d0e5692121b39a55", "url": "https://github.com/AntennaPod/AntennaPod/commit/f88306a37ce2af14a7e6c8b9d0e5692121b39a55", "message": "Add podcast specific statistics to podcast info screen\n\nAdd podcast specific statistics to podcast info screen\n\nAdd podcast specific statistics to podcast info screen\n\nAdd podcast specific statistics to podcast info screen\n\nAdd podcast specific statistics to podcast info screen\n\nAdd podcast specific statistics to podcast info screen\n\nAdd podcast specific statistics to podcast info screen\n\nAdd podcast specific statistics to podcast info screen\n\nAdd podcast specific statistics to podcast info screen\n\nAdd podcast specific statistics to podcast info screen\n\nAdd podcast specific statistics to podcast info screen\n\nAdd podcast specific statistics to podcast info screen\n\nAdd podcast specific statistics to podcast info screen\n\nAdd podcast specific statistics to podcast info screen\n\nAdd podcast specific statistics to podcast info screen\n\nAdd podcast specific statistics to podcast info screen\n\nRemoved else block\n\nremoved else block", "committedDate": "2020-10-29T16:56:28Z", "type": "commit"}, {"oid": "f88306a37ce2af14a7e6c8b9d0e5692121b39a55", "url": "https://github.com/AntennaPod/AntennaPod/commit/f88306a37ce2af14a7e6c8b9d0e5692121b39a55", "message": "Add podcast specific statistics to podcast info screen\n\nAdd podcast specific statistics to podcast info screen\n\nAdd podcast specific statistics to podcast info screen\n\nAdd podcast specific statistics to podcast info screen\n\nAdd podcast specific statistics to podcast info screen\n\nAdd podcast specific statistics to podcast info screen\n\nAdd podcast specific statistics to podcast info screen\n\nAdd podcast specific statistics to podcast info screen\n\nAdd podcast specific statistics to podcast info screen\n\nAdd podcast specific statistics to podcast info screen\n\nAdd podcast specific statistics to podcast info screen\n\nAdd podcast specific statistics to podcast info screen\n\nAdd podcast specific statistics to podcast info screen\n\nAdd podcast specific statistics to podcast info screen\n\nAdd podcast specific statistics to podcast info screen\n\nAdd podcast specific statistics to podcast info screen\n\nRemoved else block\n\nremoved else block", "committedDate": "2020-10-29T16:56:28Z", "type": "forcePushed"}, {"oid": "536841ffcd9a0960c70afe4239985313d8c74cff", "url": "https://github.com/AntennaPod/AntennaPod/commit/536841ffcd9a0960c70afe4239985313d8c74cff", "message": "Delete {", "committedDate": "2020-10-29T17:15:21Z", "type": "commit"}]}