{"pr_number": 4400, "pr_title": "Add 'sort' to subscriptions view", "pr_createdAt": "2020-09-03T11:17:50Z", "pr_url": "https://github.com/AntennaPod/AntennaPod/pull/4400", "timeline": [{"oid": "bd0d0b5008fe2735b335df03ffe16bdae73785d0", "url": "https://github.com/AntennaPod/AntennaPod/commit/bd0d0b5008fe2735b335df03ffe16bdae73785d0", "message": "add feed sort menu item", "committedDate": "2020-09-03T11:16:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjkwNDgxMw==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4400#discussion_r482904813", "bodyText": "Can this loop be simplified with something like ArrayList.indexOf?", "author": "ByteHamster", "createdAt": "2020-09-03T11:24:57Z", "path": "app/src/main/java/de/danoeh/antennapod/dialog/FeedSortDialog.java", "diffHunk": "@@ -0,0 +1,40 @@\n+package de.danoeh.antennapod.dialog;\n+\n+import android.content.Context;\n+\n+import androidx.appcompat.app.AlertDialog;\n+\n+import org.greenrobot.eventbus.EventBus;\n+\n+import de.danoeh.antennapod.R;\n+import de.danoeh.antennapod.core.event.UnreadItemsUpdateEvent;\n+import de.danoeh.antennapod.core.preferences.UserPreferences;\n+\n+public class FeedSortDialog {\n+    public static void showDialog(Context context) {\n+        AlertDialog.Builder dialog = new AlertDialog.Builder(context);\n+        dialog.setTitle(context.getString(R.string.pref_nav_drawer_feed_order_title));\n+        dialog.setNegativeButton(android.R.string.cancel, (d, listener) -> d.dismiss());\n+\n+        int selectedIndexTemp = 0;\n+        int selected = UserPreferences.getFeedOrder();\n+        String[] entryValues = context.getResources().getStringArray(R.array.nav_drawer_feed_order_values);\n+        for (int i = 0; i < entryValues.length; i++) {\n+            if (Integer.parseInt(entryValues[i]) == selected) {\n+                selectedIndexTemp = i;\n+            }\n+        }", "originalCommit": "bd0d0b5008fe2735b335df03ffe16bdae73785d0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjkwNTI1OA==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4400#discussion_r482905258", "bodyText": "Not sure if this is the most fitting event. Feed list update might be better than unread items update.", "author": "ByteHamster", "createdAt": "2020-09-03T11:25:55Z", "path": "app/src/main/java/de/danoeh/antennapod/dialog/FeedSortDialog.java", "diffHunk": "@@ -0,0 +1,40 @@\n+package de.danoeh.antennapod.dialog;\n+\n+import android.content.Context;\n+\n+import androidx.appcompat.app.AlertDialog;\n+\n+import org.greenrobot.eventbus.EventBus;\n+\n+import de.danoeh.antennapod.R;\n+import de.danoeh.antennapod.core.event.UnreadItemsUpdateEvent;\n+import de.danoeh.antennapod.core.preferences.UserPreferences;\n+\n+public class FeedSortDialog {\n+    public static void showDialog(Context context) {\n+        AlertDialog.Builder dialog = new AlertDialog.Builder(context);\n+        dialog.setTitle(context.getString(R.string.pref_nav_drawer_feed_order_title));\n+        dialog.setNegativeButton(android.R.string.cancel, (d, listener) -> d.dismiss());\n+\n+        int selectedIndexTemp = 0;\n+        int selected = UserPreferences.getFeedOrder();\n+        String[] entryValues = context.getResources().getStringArray(R.array.nav_drawer_feed_order_values);\n+        for (int i = 0; i < entryValues.length; i++) {\n+            if (Integer.parseInt(entryValues[i]) == selected) {\n+                selectedIndexTemp = i;\n+            }\n+        }\n+\n+        final int selectedIndex = selectedIndexTemp;\n+        String[] items = context.getResources().getStringArray(R.array.nav_drawer_feed_order_options);\n+        dialog.setSingleChoiceItems(items, selectedIndex, (d, which) -> {\n+            if (selectedIndex != which) {\n+                UserPreferences.setFeedOrder(entryValues[which]);\n+                //Update subscriptions\n+                EventBus.getDefault().post(new UnreadItemsUpdateEvent());", "originalCommit": "bd0d0b5008fe2735b335df03ffe16bdae73785d0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjkzMDcyNA==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4400#discussion_r482930724", "bodyText": "The FeedListUpdateEvent needs a List<Feed> where should I get this from", "author": "asdoi", "createdAt": "2020-09-03T12:13:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjkwNTI1OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU1NzkzNg==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4400#discussion_r484557936", "bodyText": "Okay, let's keep it like this for now. I think the events need some rework in the future anyway. In every Fragment, there are quite a few duplicate methods that react to the events.", "author": "ByteHamster", "createdAt": "2020-09-07T20:08:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjkwNTI1OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjkwNTg1Nw==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4400#discussion_r482905857", "bodyText": "This is not needed. AlertDialog does it automatically.", "author": "ByteHamster", "createdAt": "2020-09-03T11:27:05Z", "path": "app/src/main/java/de/danoeh/antennapod/dialog/FeedSortDialog.java", "diffHunk": "@@ -0,0 +1,40 @@\n+package de.danoeh.antennapod.dialog;\n+\n+import android.content.Context;\n+\n+import androidx.appcompat.app.AlertDialog;\n+\n+import org.greenrobot.eventbus.EventBus;\n+\n+import de.danoeh.antennapod.R;\n+import de.danoeh.antennapod.core.event.UnreadItemsUpdateEvent;\n+import de.danoeh.antennapod.core.preferences.UserPreferences;\n+\n+public class FeedSortDialog {\n+    public static void showDialog(Context context) {\n+        AlertDialog.Builder dialog = new AlertDialog.Builder(context);\n+        dialog.setTitle(context.getString(R.string.pref_nav_drawer_feed_order_title));\n+        dialog.setNegativeButton(android.R.string.cancel, (d, listener) -> d.dismiss());\n+\n+        int selectedIndexTemp = 0;\n+        int selected = UserPreferences.getFeedOrder();\n+        String[] entryValues = context.getResources().getStringArray(R.array.nav_drawer_feed_order_values);\n+        for (int i = 0; i < entryValues.length; i++) {\n+            if (Integer.parseInt(entryValues[i]) == selected) {\n+                selectedIndexTemp = i;\n+            }\n+        }\n+\n+        final int selectedIndex = selectedIndexTemp;\n+        String[] items = context.getResources().getStringArray(R.array.nav_drawer_feed_order_options);\n+        dialog.setSingleChoiceItems(items, selectedIndex, (d, which) -> {\n+            if (selectedIndex != which) {\n+                UserPreferences.setFeedOrder(entryValues[which]);\n+                //Update subscriptions\n+                EventBus.getDefault().post(new UnreadItemsUpdateEvent());\n+            }\n+            d.dismiss();", "originalCommit": "bd0d0b5008fe2735b335df03ffe16bdae73785d0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjkyODA2Mg==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4400#discussion_r482928062", "bodyText": "No, if I remove that line the dialog does not close after selecting an item", "author": "asdoi", "createdAt": "2020-09-03T12:08:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjkwNTg1Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjkwNzA1MA==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4400#discussion_r482907050", "bodyText": "Please open the same dialog when clicking the settings item. This ensures that the UI is consistent.", "author": "ByteHamster", "createdAt": "2020-09-03T11:29:27Z", "path": "app/src/main/java/de/danoeh/antennapod/dialog/FeedSortDialog.java", "diffHunk": "@@ -0,0 +1,40 @@\n+package de.danoeh.antennapod.dialog;\n+\n+import android.content.Context;\n+\n+import androidx.appcompat.app.AlertDialog;\n+\n+import org.greenrobot.eventbus.EventBus;\n+\n+import de.danoeh.antennapod.R;\n+import de.danoeh.antennapod.core.event.UnreadItemsUpdateEvent;\n+import de.danoeh.antennapod.core.preferences.UserPreferences;\n+\n+public class FeedSortDialog {", "originalCommit": "bd0d0b5008fe2735b335df03ffe16bdae73785d0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "75be61ff6de87c7c1012c52258739a0be5fea1d2", "url": "https://github.com/AntennaPod/AntennaPod/commit/75be61ff6de87c7c1012c52258739a0be5fea1d2", "message": "fix FeedSortDialog", "committedDate": "2020-09-03T12:07:57Z", "type": "commit"}, {"oid": "0010433680ec94d9679ee37eb20670d8b3a6b6bc", "url": "https://github.com/AntennaPod/AntennaPod/commit/0010433680ec94d9679ee37eb20670d8b3a6b6bc", "message": "fix Preference", "committedDate": "2020-09-03T12:11:10Z", "type": "commit"}, {"oid": "7f068e95f9383e74543ff1480be1811d1d6b7c6a", "url": "https://github.com/AntennaPod/AntennaPod/commit/7f068e95f9383e74543ff1480be1811d1d6b7c6a", "message": "update FeedFilterDialog", "committedDate": "2020-09-03T12:15:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU1NzUyNg==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4400#discussion_r484557526", "bodyText": "This is missing a line return true;. Otherwise, it will fall through and execute the next case, too.", "author": "ByteHamster", "createdAt": "2020-09-07T20:05:46Z", "path": "app/src/main/java/de/danoeh/antennapod/fragment/SubscriptionFragment.java", "diffHunk": "@@ -131,6 +132,8 @@ public boolean onOptionsItemSelected(MenuItem item) {\n             case R.id.subscriptions_filter:\n                 FeedFilterDialog.showDialog(requireContext());\n                 return true;\n+            case R.id.subscriptions_sort:\n+                FeedSortDialog.showDialog(requireContext());", "originalCommit": "7f068e95f9383e74543ff1480be1811d1d6b7c6a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU1NzU2NA==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4400#discussion_r484557564", "bodyText": "Looks a lot easier to understand \ud83d\udc4d", "author": "ByteHamster", "createdAt": "2020-09-07T20:06:14Z", "path": "app/src/main/java/de/danoeh/antennapod/dialog/FeedFilterDialog.java", "diffHunk": "@@ -16,20 +19,15 @@ public static void showDialog(Context context) {\n         dialog.setTitle(context.getString(R.string.pref_filter_feed_title));\n         dialog.setNegativeButton(android.R.string.cancel, (d, listener) -> d.dismiss());\n \n-        int selectedIndexTemp = 0;\n         int selected = UserPreferences.getFeedFilter();\n-        String[] entryValues = context.getResources().getStringArray(R.array.nav_drawer_feed_filter_values);\n-        for (int i = 0; i < entryValues.length; i++) {\n-            if (Integer.parseInt(entryValues[i]) == selected) {\n-                selectedIndexTemp = i;\n-            }\n-        }\n+        List<String> entryValues =\n+                Arrays.asList(context.getResources().getStringArray(R.array.nav_drawer_feed_filter_values));\n+        final int selectedIndex = entryValues.indexOf(\"\" + selected);", "originalCommit": "7f068e95f9383e74543ff1480be1811d1d6b7c6a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f29a1ad98f6903df9bb621599213e4663d166a14", "url": "https://github.com/AntennaPod/AntennaPod/commit/f29a1ad98f6903df9bb621599213e4663d166a14", "message": "fix fallthrough", "committedDate": "2020-09-07T20:26:06Z", "type": "commit"}]}