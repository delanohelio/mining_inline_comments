{"pr_number": 4502, "pr_title": "Extended subscriptions filter", "pr_createdAt": "2020-10-06T13:21:50Z", "pr_url": "https://github.com/AntennaPod/AntennaPod/pull/4502", "timeline": [{"oid": "8a1e46db2d16334adef937ea139380107fb93db1", "url": "https://github.com/AntennaPod/AntennaPod/commit/8a1e46db2d16334adef937ea139380107fb93db1", "message": "add auto update/keep updated to subscriptions filter", "committedDate": "2020-10-05T15:33:34Z", "type": "commit"}, {"oid": "bd2bc78be850e6ebf2dc7faf77fc120ea7052616", "url": "https://github.com/AntennaPod/AntennaPod/commit/bd2bc78be850e6ebf2dc7faf77fc120ea7052616", "message": "remove unused files", "committedDate": "2020-10-06T13:13:11Z", "type": "commit"}, {"oid": "7f9cadc5a1ab24dbdf4c46f9d3cfb5be46c02e90", "url": "https://github.com/AntennaPod/AntennaPod/commit/7f9cadc5a1ab24dbdf4c46f9d3cfb5be46c02e90", "message": "Merge branch 'subscriptions_filter_extended' into filter_extended\n\n# Conflicts:\n#\tapp/src/main/java/de/danoeh/antennapod/fragment/SubscriptionFragment.java\n#\tcore/src/main/java/de/danoeh/antennapod/core/preferences/UserPreferences.java", "committedDate": "2020-10-06T13:18:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU0ODgyMA==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4502#discussion_r500548820", "bodyText": "Please pass the feedCounters array here instead of the database adapter. This avoids having to load the counters twice. Every caller of the method queries the counters, anyway.", "author": "ByteHamster", "createdAt": "2020-10-06T19:37:20Z", "path": "core/src/main/java/de/danoeh/antennapod/core/feed/SubscriptionsFilter.java", "diffHunk": "@@ -0,0 +1,116 @@\n+package de.danoeh.antennapod.core.feed;\n+\n+import android.text.TextUtils;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import de.danoeh.antennapod.core.storage.PodDBAdapter;\n+import de.danoeh.antennapod.core.util.LongIntMap;\n+\n+public class SubscriptionsFilter {\n+    private final String[] properties;\n+\n+    private boolean showIfCounterGreaterZero = false;\n+\n+    private boolean showAutoDownloadEnabled = false;\n+    private boolean showAutoDownloadDisabled = false;\n+\n+    private boolean showUpdatedEnabled = false;\n+    private boolean showUpdatedDisabled = false;\n+\n+    public SubscriptionsFilter(String properties) {\n+        this(TextUtils.split(properties, \",\"));\n+    }\n+\n+\n+    public SubscriptionsFilter(String[] properties) {\n+        this.properties = properties;\n+        for (String property : properties) {\n+            // see R.arrays.feed_filter_values\n+            switch (property) {\n+                case \"counter_greater_zero\":\n+                    showIfCounterGreaterZero = true;\n+                    break;\n+                case \"enabled_auto_download\":\n+                    showAutoDownloadEnabled = true;\n+                    break;\n+                case \"disabled_auto_download\":\n+                    showAutoDownloadDisabled = true;\n+                    break;\n+                case \"enabled_updates\":\n+                    showUpdatedEnabled = true;\n+                    break;\n+                case \"disabled_updates\":\n+                    showUpdatedDisabled = true;\n+                    break;\n+                default:\n+                    break;\n+            }\n+        }\n+    }\n+\n+    public boolean areSubscriptionsFiltered() {\n+        return properties.length > 0;\n+    }\n+\n+    /**\n+     * Run a list of feed items through the filter.\n+     */\n+    public List<Feed> filter(List<Feed> items, PodDBAdapter adapter) {", "originalCommit": "7f9cadc5a1ab24dbdf4c46f9d3cfb5be46c02e90", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU1MDAyMg==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4502#discussion_r500550022", "bodyText": "The method name sounds a bit strange to me (having the words \"subscription filter\" twice). I currently do not have a better name in mind, though.", "author": "ByteHamster", "createdAt": "2020-10-06T19:39:37Z", "path": "app/src/main/java/de/danoeh/antennapod/fragment/SubscriptionFragment.java", "diffHunk": "@@ -224,7 +224,7 @@ private void loadSubscriptions() {\n                     progressBar.setVisibility(View.GONE);\n                 }, error -> Log.e(TAG, Log.getStackTraceString(error)));\n \n-        if (UserPreferences.getFeedFilter() != UserPreferences.FEED_FILTER_NONE) {\n+        if (UserPreferences.getSubscriptionsFilter().areSubscriptionsFiltered()) {", "originalCommit": "7f9cadc5a1ab24dbdf4c46f9d3cfb5be46c02e90", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjkzNTM4NA==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4502#discussion_r502935384", "bodyText": "How do you feel about using isEnabled() instead?", "author": "ByteHamster", "createdAt": "2020-10-11T16:12:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU1MDAyMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU1MDUxNw==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4502#discussion_r500550517", "bodyText": "I think it is safe to not check this because the UI does not allow selecting those combinations", "author": "ByteHamster", "createdAt": "2020-10-06T19:40:34Z", "path": "core/src/main/java/de/danoeh/antennapod/core/feed/SubscriptionsFilter.java", "diffHunk": "@@ -0,0 +1,116 @@\n+package de.danoeh.antennapod.core.feed;\n+\n+import android.text.TextUtils;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import de.danoeh.antennapod.core.storage.PodDBAdapter;\n+import de.danoeh.antennapod.core.util.LongIntMap;\n+\n+public class SubscriptionsFilter {\n+    private final String[] properties;\n+\n+    private boolean showIfCounterGreaterZero = false;\n+\n+    private boolean showAutoDownloadEnabled = false;\n+    private boolean showAutoDownloadDisabled = false;\n+\n+    private boolean showUpdatedEnabled = false;\n+    private boolean showUpdatedDisabled = false;\n+\n+    public SubscriptionsFilter(String properties) {\n+        this(TextUtils.split(properties, \",\"));\n+    }\n+\n+\n+    public SubscriptionsFilter(String[] properties) {\n+        this.properties = properties;\n+        for (String property : properties) {\n+            // see R.arrays.feed_filter_values\n+            switch (property) {\n+                case \"counter_greater_zero\":\n+                    showIfCounterGreaterZero = true;\n+                    break;\n+                case \"enabled_auto_download\":\n+                    showAutoDownloadEnabled = true;\n+                    break;\n+                case \"disabled_auto_download\":\n+                    showAutoDownloadDisabled = true;\n+                    break;\n+                case \"enabled_updates\":\n+                    showUpdatedEnabled = true;\n+                    break;\n+                case \"disabled_updates\":\n+                    showUpdatedDisabled = true;\n+                    break;\n+                default:\n+                    break;\n+            }\n+        }\n+    }\n+\n+    public boolean areSubscriptionsFiltered() {\n+        return properties.length > 0;\n+    }\n+\n+    /**\n+     * Run a list of feed items through the filter.\n+     */\n+    public List<Feed> filter(List<Feed> items, PodDBAdapter adapter) {\n+        if (properties.length == 0) {\n+            return items;\n+        }\n+\n+        List<Feed> result = new ArrayList<>();\n+\n+        // Check for filter combinations that will always return an empty list", "originalCommit": "7f9cadc5a1ab24dbdf4c46f9d3cfb5be46c02e90", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU1MTY2NA==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4502#discussion_r500551664", "bodyText": "I think a method like value.serialize() would be better. This then keeps the details of how items are joined encapsulated within the class.", "author": "ByteHamster", "createdAt": "2020-10-06T19:42:43Z", "path": "core/src/main/java/de/danoeh/antennapod/core/preferences/UserPreferences.java", "diffHunk": "@@ -1046,14 +1045,14 @@ public static void setQueueKeepSortedOrder(SortOrder sortOrder) {\n                 .apply();\n     }\n \n-    public static int getFeedFilter() {\n-        String value = prefs.getString(PREF_FILTER_FEED, \"\" + FEED_FILTER_NONE);\n-        return Integer.parseInt(value);\n+    public static SubscriptionsFilter getSubscriptionsFilter() {\n+        String value = prefs.getString(PREF_FILTER_FEED, \"\");\n+        return new SubscriptionsFilter(value);\n     }\n \n-    public static void setFeedFilter(String value) {\n+    public static void setSubscriptionsFilter(SubscriptionsFilter value) {\n         prefs.edit()\n-                .putString(PREF_FILTER_FEED, value)\n+                .putString(PREF_FILTER_FEED, TextUtils.join(\",\", value.getValues()))", "originalCommit": "7f9cadc5a1ab24dbdf4c46f9d3cfb5be46c02e90", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "070af86c2aa6112cbcd042693e2e5af161176066", "url": "https://github.com/AntennaPod/AntennaPod/commit/070af86c2aa6112cbcd042693e2e5af161176066", "message": "fixes", "committedDate": "2020-10-07T16:46:25Z", "type": "commit"}, {"oid": "3c72b0437f8dc0a292656338def9880c5daed7e1", "url": "https://github.com/AntennaPod/AntennaPod/commit/3c72b0437f8dc0a292656338def9880c5daed7e1", "message": "rename to isEnabled()", "committedDate": "2020-10-12T14:49:44Z", "type": "commit"}]}