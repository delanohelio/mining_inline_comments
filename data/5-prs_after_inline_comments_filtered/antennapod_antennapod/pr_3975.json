{"pr_number": 3975, "pr_title": "Skip intro and ending per feed", "pr_createdAt": "2020-03-29T06:15:23Z", "pr_url": "https://github.com/AntennaPod/AntennaPod/pull/3975", "timeline": [{"oid": "2fbdcd3719e06fdd5faedc1cafe1cd4d3fb1a908", "url": "https://github.com/AntennaPod/AntennaPod/commit/2fbdcd3719e06fdd5faedc1cafe1cd4d3fb1a908", "message": "setting", "committedDate": "2020-03-29T04:52:26Z", "type": "commit"}, {"oid": "08d286af06ebb9eecbeb49335fb05cb290671313", "url": "https://github.com/AntennaPod/AntennaPod/commit/08d286af06ebb9eecbeb49335fb05cb290671313", "message": "skip ending", "committedDate": "2020-03-29T06:00:42Z", "type": "commit"}, {"oid": "5894083c48bf9d89871ae801520eb373eaae0ecb", "url": "https://github.com/AntennaPod/AntennaPod/commit/5894083c48bf9d89871ae801520eb373eaae0ecb", "message": "indent", "committedDate": "2020-03-29T06:22:16Z", "type": "commit"}, {"oid": "0dc1b522ce09eb3a92090ed9f549df50c50d187c", "url": "https://github.com/AntennaPod/AntennaPod/commit/0dc1b522ce09eb3a92090ed9f549df50c50d187c", "message": "db upgrade", "committedDate": "2020-03-29T06:50:36Z", "type": "commit"}, {"oid": "b93bce74012b31980fe3a1e19a49df82901e1978", "url": "https://github.com/AntennaPod/AntennaPod/commit/b93bce74012b31980fe3a1e19a49df82901e1978", "message": "db upgrade", "committedDate": "2020-03-29T07:25:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTc5NDc5Mg==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3975#discussion_r399794792", "bodyText": "Building Strings like this can break in other languages. I think an additional string Skipped %1$d seconds of intro would be better.", "author": "ByteHamster", "createdAt": "2020-03-29T13:02:22Z", "path": "core/src/main/java/de/danoeh/antennapod/core/service/playback/LocalPSMP.java", "diffHunk": "@@ -317,12 +320,53 @@ private void resumeSync() {\n                 float rightVolume = UserPreferences.getRightVolume();\n                 setVolume(leftVolume, rightVolume);\n \n+                int skipIntro = 0;\n+                int skipEnd = 0;\n+                if (media instanceof FeedMedia) {\n+                    FeedMedia feedMedia = (FeedMedia) media;\n+                    FeedPreferences preferences = feedMedia.getItem().getFeed().getPreferences();\n+                    skipIntro = preferences.getFeedSkipIntro();\n+                    skipEnd = preferences.getFeedSkipEnding();\n+                }\n+\n                 if (playerStatus == PlayerStatus.PREPARED && media.getPosition() > 0) {\n                     int newPosition = RewindAfterPauseUtils.calculatePositionWithRewind(\n                         media.getPosition(),\n                         media.getLastPlayedTime());\n                     seekToSync(newPosition);\n                 }\n+                String skipMesg = \"\";\n+                String skipIntroMesg = \"\";\n+                if (playerStatus == PlayerStatus.PREPARED && media.getPosition() == 0) {\n+                    if (skipIntro > 0) {\n+                        int duration = getDuration();\n+                        if (skipIntro * 1000 < duration) {\n+                            seekToSync(skipIntro * 1000);\n+                            skipIntroMesg = context.getString(R.string.pref_feed_skip_intro) + \" \" +", "originalCommit": "b93bce74012b31980fe3a1e19a49df82901e1978", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTg5MDk1Mw==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3975#discussion_r399890953", "bodyText": "done", "author": "tonytamsf", "createdAt": "2020-03-30T01:55:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTc5NDc5Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTc5NDg4NA==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3975#discussion_r399794884", "bodyText": "Why do you display both numbers? I think we should not display more information than necessary.", "author": "ByteHamster", "createdAt": "2020-03-29T13:03:05Z", "path": "core/src/main/java/de/danoeh/antennapod/core/service/playback/LocalPSMP.java", "diffHunk": "@@ -317,12 +320,53 @@ private void resumeSync() {\n                 float rightVolume = UserPreferences.getRightVolume();\n                 setVolume(leftVolume, rightVolume);\n \n+                int skipIntro = 0;\n+                int skipEnd = 0;\n+                if (media instanceof FeedMedia) {\n+                    FeedMedia feedMedia = (FeedMedia) media;\n+                    FeedPreferences preferences = feedMedia.getItem().getFeed().getPreferences();\n+                    skipIntro = preferences.getFeedSkipIntro();\n+                    skipEnd = preferences.getFeedSkipEnding();\n+                }\n+\n                 if (playerStatus == PlayerStatus.PREPARED && media.getPosition() > 0) {\n                     int newPosition = RewindAfterPauseUtils.calculatePositionWithRewind(\n                         media.getPosition(),\n                         media.getLastPlayedTime());\n                     seekToSync(newPosition);\n                 }\n+                String skipMesg = \"\";\n+                String skipIntroMesg = \"\";\n+                if (playerStatus == PlayerStatus.PREPARED && media.getPosition() == 0) {\n+                    if (skipIntro > 0) {\n+                        int duration = getDuration();\n+                        if (skipIntro * 1000 < duration) {\n+                            seekToSync(skipIntro * 1000);\n+                            skipIntroMesg = context.getString(R.string.pref_feed_skip_intro) + \" \" +\n+                                    skipIntro + \" \" +\n+                                    context.getString(R.string.time_seconds);\n+                        }\n+                    }\n+                    if (skipEnd > 0) {\n+                        int duration = getDuration();\n+                        if (skipEnd * 1000 < duration) {\n+                            skipMesg = context.getString(R.string.pref_feed_skip_ending) + \" \" +\n+                                    skipEnd + \" \" +\n+                                    context.getString(R.string.time_seconds);\n+                        }\n+                    }\n+                    if (skipMesg != \"\") {\n+                        skipMesg = skipIntroMesg + \"\\n\" + skipMesg;", "originalCommit": "b93bce74012b31980fe3a1e19a49df82901e1978", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTg5MTExNQ==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3975#discussion_r399891115", "bodyText": "removed dup", "author": "tonytamsf", "createdAt": "2020-03-30T01:56:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTc5NDg4NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTc5NTE1NQ==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3975#discussion_r399795155", "bodyText": "Please move this to DBUpgrader. Also, use oldVersion < 1090001. Users might skip AntennaPod versions. When checking for equality, this skips the migration when coming from, say 1080100 instead of exactly 1090000.", "author": "ByteHamster", "createdAt": "2020-03-29T13:05:25Z", "path": "core/src/main/java/de/danoeh/antennapod/core/storage/PodDBAdapter.java", "diffHunk": "@@ -1381,6 +1389,12 @@ public void onCreate(final SQLiteDatabase db) {\n         public void onUpgrade(final SQLiteDatabase db, final int oldVersion, final int newVersion) {\n             Log.w(\"DBAdapter\", \"Upgrading from version \" + oldVersion + \" to \" + newVersion + \".\");\n             DBUpgrader.upgrade(db, oldVersion, newVersion);\n+            if (oldVersion == 1090000) {", "originalCommit": "b93bce74012b31980fe3a1e19a49df82901e1978", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTc5NTIyMQ==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3975#discussion_r399795221", "bodyText": "Please only increment by 1.", "author": "ByteHamster", "createdAt": "2020-03-29T13:06:02Z", "path": "core/src/main/java/de/danoeh/antennapod/core/storage/PodDBAdapter.java", "diffHunk": "@@ -48,7 +48,7 @@\n \n     private static final String TAG = \"PodDBAdapter\";\n     public static final String DATABASE_NAME = \"Antennapod.db\";\n-    public static final int VERSION = 1090000;\n+    public static final int VERSION = 1091000;", "originalCommit": "b93bce74012b31980fe3a1e19a49df82901e1978", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTg2MjI5NA==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3975#discussion_r399862294", "bodyText": "done 1090000 + 1 -> 1090001", "author": "tonytamsf", "createdAt": "2020-03-29T22:21:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTc5NTIyMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTc5NTQ0Nw==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3975#discussion_r399795447", "bodyText": "Not sure if LocalPSMP is the right place to do this. What about Chromecast (RemotePSMP) or other media players that might get added in the future? I think this fits better into PlaybackService (but I am not sure where exactly).", "author": "ByteHamster", "createdAt": "2020-03-29T13:07:51Z", "path": "core/src/main/java/de/danoeh/antennapod/core/service/playback/LocalPSMP.java", "diffHunk": "@@ -317,12 +320,53 @@ private void resumeSync() {\n                 float rightVolume = UserPreferences.getRightVolume();\n                 setVolume(leftVolume, rightVolume);\n \n+                int skipIntro = 0;\n+                int skipEnd = 0;\n+                if (media instanceof FeedMedia) {\n+                    FeedMedia feedMedia = (FeedMedia) media;\n+                    FeedPreferences preferences = feedMedia.getItem().getFeed().getPreferences();\n+                    skipIntro = preferences.getFeedSkipIntro();\n+                    skipEnd = preferences.getFeedSkipEnding();\n+                }\n+\n                 if (playerStatus == PlayerStatus.PREPARED && media.getPosition() > 0) {\n                     int newPosition = RewindAfterPauseUtils.calculatePositionWithRewind(\n                         media.getPosition(),\n                         media.getLastPlayedTime());\n                     seekToSync(newPosition);\n                 }\n+                String skipMesg = \"\";\n+                String skipIntroMesg = \"\";\n+                if (playerStatus == PlayerStatus.PREPARED && media.getPosition() == 0) {\n+                    if (skipIntro > 0) {\n+                        int duration = getDuration();\n+                        if (skipIntro * 1000 < duration) {\n+                            seekToSync(skipIntro * 1000);", "originalCommit": "b93bce74012b31980fe3a1e19a49df82901e1978", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTg5MTAxMg==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3975#discussion_r399891012", "bodyText": "fixed in Playbackservice", "author": "tonytamsf", "createdAt": "2020-03-30T01:55:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTc5NTQ0Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTc5NTcyNQ==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3975#discussion_r399795725", "bodyText": "The UI should not be responsible for doing playback actions. If the user closes the UI, episodes should still get skipped. When adding the skipping code like this and swiping out the player during playback, this is no longer the case.\nAdditionally, this introduces code duplication. This should be done centrally, somewhere in the PlaybackService.", "author": "ByteHamster", "createdAt": "2020-03-29T13:10:04Z", "path": "app/src/main/java/de/danoeh/antennapod/fragment/AudioPlayerFragment.java", "diffHunk": "@@ -386,6 +390,24 @@ public void updatePosition(PlaybackPositionEvent event) {\n         }\n         float progress = ((float) event.getPosition()) / event.getDuration();\n         sbPosition.setProgress((int) (progress * sbPosition.getMax()));\n+        Playable media = controller.getMedia();\n+        if (media instanceof FeedMedia)  {\n+            FeedMedia feedMedia = (FeedMedia) media;\n+            FeedPreferences preferences = feedMedia.getItem().getFeed().getPreferences();\n+            int skipEnd = preferences.getFeedSkipEnding();\n+            if (skipEnd > 0 && remainingTime < skipEnd * 1000) {\n+                Log.d(TAG, \"Skipping the remaining \" + remainingTime / 1000 + \" \" + skipEnd );\n+                String skipMesg = getActivity().getString(de.danoeh.antennapod.core.R.string.pref_feed_skip_ending) + \" \" +\n+                        skipEnd + \" \" +\n+                        getActivity().getString(de.danoeh.antennapod.core.R.string.time_seconds);\n+                Toast toast = Toast.makeText(getActivity(), skipMesg,\n+                        Toast.LENGTH_LONG);\n+                toast.show();\n+                IntentUtils.sendLocalBroadcast(getActivity(), PlaybackService.ACTION_SKIP_CURRENT_EPISODE);", "originalCommit": "b93bce74012b31980fe3a1e19a49df82901e1978", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTg5MTA4Mw==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3975#discussion_r399891083", "bodyText": "done.", "author": "tonytamsf", "createdAt": "2020-03-30T01:55:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTc5NTcyNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTc5NTkyNg==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3975#discussion_r399795926", "bodyText": "Is there a case where the title might be different from R.string.pref_feed_skip? I do not think this needs to be a parameter.", "author": "ByteHamster", "createdAt": "2020-03-29T13:11:42Z", "path": "app/src/main/java/de/danoeh/antennapod/dialog/FeedPreferenceSkipDialog.java", "diffHunk": "@@ -0,0 +1,40 @@\n+package de.danoeh.antennapod.dialog;\n+\n+import android.app.AlertDialog;\n+import android.content.Context;\n+import android.view.View;\n+import android.widget.CheckBox;\n+import android.widget.EditText;\n+import de.danoeh.antennapod.R;\n+\n+/**\n+ * Displays a dialog with a username and password text field and an optional checkbox to save username and preferences.\n+ */\n+public abstract class FeedPreferenceSkipDialog extends AlertDialog.Builder {\n+\n+    public FeedPreferenceSkipDialog(Context context, int titleRes, int skipIntroInitialValue,", "originalCommit": "b93bce74012b31980fe3a1e19a49df82901e1978", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTg2MzQzOQ==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3975#discussion_r399863439", "bodyText": "done", "author": "tonytamsf", "createdAt": "2020-03-29T22:30:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTc5NTkyNg=="}], "type": "inlineReview"}, {"oid": "cd2b8c203cf8f84498da16bfc5a601b37405c5ea", "url": "https://github.com/AntennaPod/AntennaPod/commit/cd2b8c203cf8f84498da16bfc5a601b37405c5ea", "message": "move upgrade to the right right place, increment version by 1 only", "committedDate": "2020-03-29T22:24:32Z", "type": "commit"}, {"oid": "a9b13723de404e2dde45b8dd4f5d6c5544ae2d24", "url": "https://github.com/AntennaPod/AntennaPod/commit/a9b13723de404e2dde45b8dd4f5d6c5544ae2d24", "message": "indent and remove dup namespace", "committedDate": "2020-03-29T22:27:27Z", "type": "commit"}, {"oid": "d79e3db3f3d798b6193a8c45a98433f8ad429041", "url": "https://github.com/AntennaPod/AntennaPod/commit/d79e3db3f3d798b6193a8c45a98433f8ad429041", "message": "no need for dialog title to be diff", "committedDate": "2020-03-29T22:30:30Z", "type": "commit"}, {"oid": "70e1bff3aab2330aa5cb25f190258f0383552f45", "url": "https://github.com/AntennaPod/AntennaPod/commit/70e1bff3aab2330aa5cb25f190258f0383552f45", "message": "revert", "committedDate": "2020-03-30T00:54:53Z", "type": "commit"}, {"oid": "82cd109ea3fea61b0b491bfc2ef1f78f37a842d4", "url": "https://github.com/AntennaPod/AntennaPod/commit/82cd109ea3fea61b0b491bfc2ef1f78f37a842d4", "message": "skipIntro", "committedDate": "2020-03-30T00:55:16Z", "type": "commit"}, {"oid": "73ba128fcd10c3b55749242a56fca53ad071d0b5", "url": "https://github.com/AntennaPod/AntennaPod/commit/73ba128fcd10c3b55749242a56fca53ad071d0b5", "message": "revert", "committedDate": "2020-03-30T01:32:31Z", "type": "commit"}, {"oid": "8e7475f31314f9281ba1fa4f10784bf24b084e41", "url": "https://github.com/AntennaPod/AntennaPod/commit/8e7475f31314f9281ba1fa4f10784bf24b084e41", "message": "skip at ending", "committedDate": "2020-03-30T01:54:54Z", "type": "commit"}, {"oid": "47a40943a45844dad5a96732b2c311158baad090", "url": "https://github.com/AntennaPod/AntennaPod/commit/47a40943a45844dad5a96732b2c311158baad090", "message": "dup xmlns", "committedDate": "2020-03-30T01:58:17Z", "type": "commit"}, {"oid": "b661f29e75c2b2b127ae4f0d7502ff66941a08d8", "url": "https://github.com/AntennaPod/AntennaPod/commit/b661f29e75c2b2b127ae4f0d7502ff66941a08d8", "message": "format", "committedDate": "2020-03-30T01:58:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTg2NTE2MA==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3975#discussion_r399865160", "bodyText": "Is this method used anywhere? I'd vote to just add code that we actually need.", "author": "ByteHamster", "createdAt": "2020-03-29T22:45:09Z", "path": "app/src/main/java/de/danoeh/antennapod/dialog/FeedPreferenceSkipDialog.java", "diffHunk": "@@ -0,0 +1,40 @@\n+package de.danoeh.antennapod.dialog;\n+\n+import android.app.AlertDialog;\n+import android.content.Context;\n+import android.view.View;\n+import android.widget.CheckBox;\n+import android.widget.EditText;\n+import de.danoeh.antennapod.R;\n+\n+/**\n+ * Displays a dialog with a username and password text field and an optional checkbox to save username and preferences.\n+ */\n+public abstract class FeedPreferenceSkipDialog extends AlertDialog.Builder {\n+\n+    public FeedPreferenceSkipDialog(Context context, int skipIntroInitialValue,\n+                                int skipEndInitialValue) {\n+        super(context);\n+        setTitle(R.string.pref_feed_skip);\n+        View rootView = View.inflate(context, R.layout.feed_pref_skip_dialog, null);\n+        setView(rootView);\n+\n+        final EditText etxtSkipIntro = rootView.findViewById(R.id.etxtSkipIntro);\n+        final EditText etxtSkipEnd = rootView.findViewById(R.id.etxtSkipEnd);\n+\n+        etxtSkipIntro.setText(String.valueOf(skipIntroInitialValue));\n+        etxtSkipEnd.setText(String.valueOf(skipEndInitialValue));\n+\n+        setOnCancelListener(dialog -> onCancelled());\n+        setNegativeButton(R.string.cancel_label, null);\n+        setPositiveButton(R.string.confirm_label, (dialog, which)\n+                -> onConfirmed(Integer.valueOf(etxtSkipIntro.getText().toString()),\n+                Integer.valueOf(etxtSkipEnd.getText().toString())));\n+    }\n+\n+    protected void onCancelled() {", "originalCommit": "d79e3db3f3d798b6193a8c45a98433f8ad429041", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTg2NTU1MQ==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3975#discussion_r399865551", "bodyText": "GLOBAL in the case of SPEED_USE_GLOBAL means that the feed uses the speed that is set globally (for all feeds). Skipping is not a setting that is available globally (and I don't think it should be). So please rename to something like DEFAULT or just remove the variables (used in one place only).", "author": "ByteHamster", "createdAt": "2020-03-29T22:48:36Z", "path": "core/src/main/java/de/danoeh/antennapod/core/feed/FeedPreferences.java", "diffHunk": "@@ -15,6 +15,8 @@\n public class FeedPreferences {\n \n     public static final float SPEED_USE_GLOBAL = -1;\n+    public static final int FEED_SKIP_INTRO_GLOBAL = 0;\n+    public static final int FEED_SKIP_ENDING_GLOBAL = 0;", "originalCommit": "d79e3db3f3d798b6193a8c45a98433f8ad429041", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDYwMjQ5Mg==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3975#discussion_r400602492", "bodyText": "done", "author": "tonytamsf", "createdAt": "2020-03-31T02:15:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTg2NTU1MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTg2NTY5NQ==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3975#discussion_r399865695", "bodyText": "Please add a space before the plus here :)", "author": "ByteHamster", "createdAt": "2020-03-29T22:49:49Z", "path": "core/src/main/java/de/danoeh/antennapod/core/storage/PodDBAdapter.java", "diffHunk": "@@ -145,7 +147,9 @@\n             + KEY_LAST_UPDATE_FAILED + \" INTEGER DEFAULT 0,\"\n             + KEY_AUTO_DELETE_ACTION + \" INTEGER DEFAULT 0,\"\n             + KEY_FEED_PLAYBACK_SPEED + \" REAL DEFAULT \" + SPEED_USE_GLOBAL + \",\"\n-            + KEY_FEED_VOLUME_ADAPTION + \" INTEGER DEFAULT 0)\";\n+            + KEY_FEED_VOLUME_ADAPTION + \" INTEGER DEFAULT 0,\"\n+            + KEY_FEED_SKIP_INTRO + \" INTEGER DEFAULT 0,\"\n+            + KEY_FEED_SKIP_ENDING+ \" INTEGER DEFAULT 0)\";", "originalCommit": "d79e3db3f3d798b6193a8c45a98433f8ad429041", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDYwMTcyMg==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3975#discussion_r400601722", "bodyText": "done", "author": "tonytamsf", "createdAt": "2020-03-31T02:13:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTg2NTY5NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDAwODA2Mg==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3975#discussion_r400008062", "bodyText": "There is a checkstyle file in config/checkstyle/ that I want to enforce for new code. Because the existing code is quite inconsistent, CI only checks a small fraction of things. In the past months, I did the checks manually and commented on GitHub. In #3978, I enabled checking the diff on CI.\nI think checkstyle will complain about this line. Have not checked the rest of the code. Just that you already know before I merge #3978 and it suddenly complains.", "author": "ByteHamster", "createdAt": "2020-03-30T08:21:14Z", "path": "core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java", "diffHunk": "@@ -505,6 +507,36 @@ public int onStartCommand(Intent intent, int flags, int startId) {\n         return Service.START_NOT_STICKY;\n     }\n \n+    private void skipIntro(Playable playable) {\n+\n+        int skipIntro = 0;\n+        if (! (playable instanceof FeedMedia)) { return; }\n+        if (playable.getLastPlayedTime() > 0) { return; }", "originalCommit": "b661f29e75c2b2b127ae4f0d7502ff66941a08d8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDAwODQyNw==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3975#discussion_r400008427", "bodyText": "This is no longer needed, I think.", "author": "ByteHamster", "createdAt": "2020-03-30T08:21:51Z", "path": "app/src/main/java/de/danoeh/antennapod/activity/MediaplayerActivity.java", "diffHunk": "@@ -477,6 +480,24 @@ void onPositionObserverUpdate() {\n             txtvLength.setText(Converter.getDurationStringLong(duration));\n         }\n         updateProgressbarPosition(currentPosition, duration);\n+        Playable media = controller.getMedia();\n+        if (media instanceof FeedMedia)  {", "originalCommit": "b661f29e75c2b2b127ae4f0d7502ff66941a08d8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDAxMDg4Nw==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3975#discussion_r400010887", "bodyText": "I think you can directly add the format parameters to getString. Then Android Studio can do better analysis.", "author": "ByteHamster", "createdAt": "2020-03-30T08:25:59Z", "path": "core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java", "diffHunk": "@@ -1037,6 +1071,32 @@ private void sendNotificationBroadcast(int type, int code) {\n         sendBroadcast(intent);\n     }\n \n+    private void skipIfMetEnding() {\n+        Playable playable = mediaPlayer.getPlayable();\n+        if (! (playable instanceof FeedMedia)) { return; }\n+\n+        int duration = getDuration();\n+        int remainingTime = duration - getCurrentPosition();\n+\n+        FeedMedia feedMedia = (FeedMedia) playable;\n+        FeedPreferences preferences = feedMedia.getItem().getFeed().getPreferences();\n+        int skipEnd = preferences.getFeedSkipEnding();\n+        if (skipEnd > 0 && remainingTime < skipEnd * 1000) {\n+            Log.d(TAG, \"skipIfMetEnding: Skipping the remaining \" + remainingTime / 1000 + \" \" + skipEnd );\n+            Context context = getApplicationContext();\n+            String skipMesg = String.format(context.getString(R.string.pref_feed_skip_ending_toast),", "originalCommit": "b661f29e75c2b2b127ae4f0d7502ff66941a08d8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDYwMDc4OQ==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3975#discussion_r400600789", "bodyText": "fixed", "author": "tonytamsf", "createdAt": "2020-03-31T02:09:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDAxMDg4Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDAxMTU1Ng==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3975#discussion_r400011556", "bodyText": "Just wondering: Does this honor the \"Follow queue\" setting?", "author": "ByteHamster", "createdAt": "2020-03-30T08:27:06Z", "path": "core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java", "diffHunk": "@@ -1037,6 +1071,32 @@ private void sendNotificationBroadcast(int type, int code) {\n         sendBroadcast(intent);\n     }\n \n+    private void skipIfMetEnding() {\n+        Playable playable = mediaPlayer.getPlayable();\n+        if (! (playable instanceof FeedMedia)) { return; }\n+\n+        int duration = getDuration();\n+        int remainingTime = duration - getCurrentPosition();\n+\n+        FeedMedia feedMedia = (FeedMedia) playable;\n+        FeedPreferences preferences = feedMedia.getItem().getFeed().getPreferences();\n+        int skipEnd = preferences.getFeedSkipEnding();\n+        if (skipEnd > 0 && remainingTime < skipEnd * 1000) {\n+            Log.d(TAG, \"skipIfMetEnding: Skipping the remaining \" + remainingTime / 1000 + \" \" + skipEnd );\n+            Context context = getApplicationContext();\n+            String skipMesg = String.format(context.getString(R.string.pref_feed_skip_ending_toast),\n+                    skipEnd,\n+                    context.getString(R.string.time_seconds));\n+            Toast toast = Toast.makeText(context, skipMesg,\n+                    Toast.LENGTH_LONG);\n+            toast.show();\n+\n+            mediaPlayer.skip();", "originalCommit": "b661f29e75c2b2b127ae4f0d7502ff66941a08d8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU5ODIzNQ==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3975#discussion_r400598235", "bodyText": "I tested it and this behaves the same as hitting the 'Skip' button\n\nThe location is saved\nThe video is skipped and the next one is started.", "author": "tonytamsf", "createdAt": "2020-03-31T01:59:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDAxMTU1Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDc1ODExOA==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3975#discussion_r400758118", "bodyText": "The video is skipped and the next one is started.\n\nWhat if you uncheck the option Follow queue in Settings \u00bb Playback? It should then not start the next file.", "author": "ByteHamster", "createdAt": "2020-03-31T09:10:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDAxMTU1Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjAxODM2NQ==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3975#discussion_r402018365", "bodyText": "fixed now and tested.", "author": "tonytamsf", "createdAt": "2020-04-02T02:33:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDAxMTU1Ng=="}], "type": "inlineReview"}, {"oid": "7894cb874a18cda8ed028e7f6c017c7e1b06ebef", "url": "https://github.com/AntennaPod/AntennaPod/commit/7894cb874a18cda8ed028e7f6c017c7e1b06ebef", "message": "revert", "committedDate": "2020-03-31T02:12:11Z", "type": "commit"}, {"oid": "bc78e796a49ee399d7a0bd82c6a5f1328435bce3", "url": "https://github.com/AntennaPod/AntennaPod/commit/bc78e796a49ee399d7a0bd82c6a5f1328435bce3", "message": "cleanup", "committedDate": "2020-03-31T02:19:53Z", "type": "commit"}, {"oid": "aa0eed8995355143ab3d859374eb028d8e4a4d0f", "url": "https://github.com/AntennaPod/AntennaPod/commit/aa0eed8995355143ab3d859374eb028d8e4a4d0f", "message": "checkstyle", "committedDate": "2020-03-31T02:36:13Z", "type": "commit"}, {"oid": "8505e7bc5c072eaa3b52bf524b78e791a7a2778a", "url": "https://github.com/AntennaPod/AntennaPod/commit/8505e7bc5c072eaa3b52bf524b78e791a7a2778a", "message": "no need for onCancelled()", "committedDate": "2020-03-31T04:34:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDc2MDc0Mw==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3975#discussion_r400760743", "bodyText": "Please use the androidx alert dialog. It has the same interface but it might have better compatibility with old Android versions.", "author": "ByteHamster", "createdAt": "2020-03-31T09:14:46Z", "path": "app/src/main/java/de/danoeh/antennapod/dialog/FeedPreferenceSkipDialog.java", "diffHunk": "@@ -0,0 +1,35 @@\n+package de.danoeh.antennapod.dialog;\n+\n+import android.app.AlertDialog;", "originalCommit": "8505e7bc5c072eaa3b52bf524b78e791a7a2778a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDc2MTc3NA==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3975#discussion_r400761774", "bodyText": "Please add an empty line between the methods. Not sure why checkstyle did not complain about that. The checkstyle config file needs some more changes, I think.", "author": "ByteHamster", "createdAt": "2020-03-31T09:16:27Z", "path": "core/src/main/java/de/danoeh/antennapod/core/feed/FeedPreferences.java", "diffHunk": "@@ -34,12 +34,17 @@\n     private String username;\n     private String password;\n     private float feedPlaybackSpeed;\n+    private int feedSkipIntro;\n+    private int feedSkipEnding;\n \n     public FeedPreferences(long feedID, boolean autoDownload, AutoDeleteAction auto_delete_action, VolumeAdaptionSetting volumeAdaptionSetting, String username, String password) {\n         this(feedID, autoDownload, true, auto_delete_action, volumeAdaptionSetting, username, password, new FeedFilter(), SPEED_USE_GLOBAL);\n     }\n \n     private FeedPreferences(long feedID, boolean autoDownload, boolean keepUpdated, AutoDeleteAction auto_delete_action, VolumeAdaptionSetting volumeAdaptionSetting, String username, String password, @NonNull FeedFilter filter, float feedPlaybackSpeed) {\n+        this(feedID, autoDownload, true, auto_delete_action, volumeAdaptionSetting, username, password, new FeedFilter(), feedPlaybackSpeed, 0, 0);\n+    }\n+    private FeedPreferences(long feedID, boolean autoDownload, boolean keepUpdated, AutoDeleteAction auto_delete_action, VolumeAdaptionSetting volumeAdaptionSetting, String username, String password, @NonNull FeedFilter filter, float feedPlaybackSpeed, int feedSkipIntro, int feedSkipEnding) {", "originalCommit": "8505e7bc5c072eaa3b52bf524b78e791a7a2778a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDc2MjYxOA==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3975#discussion_r400762618", "bodyText": "Doesn't this mean that the intro is not skipped if you play it for the second time?", "author": "ByteHamster", "createdAt": "2020-03-31T09:17:39Z", "path": "core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java", "diffHunk": "@@ -505,6 +507,40 @@ public int onStartCommand(Intent intent, int flags, int startId) {\n         return Service.START_NOT_STICKY;\n     }\n \n+    private void skipIntro(Playable playable) {\n+        int skipIntro = 0;\n+        if (! (playable instanceof FeedMedia)) {\n+            return;\n+        }\n+\n+        if (playable.getLastPlayedTime() > 0) {", "originalCommit": "8505e7bc5c072eaa3b52bf524b78e791a7a2778a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTEwOTM4OA==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3975#discussion_r401109388", "bodyText": "Right, I intentionally don't want to skip the intro if someone\n\nPlays an, and rewinds back.\n--\nIf they replay, do you want me to fix that as well?", "author": "tonytamsf", "createdAt": "2020-03-31T18:02:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDc2MjYxOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjAxODc2OQ==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3975#discussion_r402018769", "bodyText": "I have fixed.\n\nIf you play, autoskip and rewind, it works as you expected.\nIf you play, autoskip, let it end. and come back, it will work as you expect.  The 2nd time, it will skip again", "author": "tonytamsf", "createdAt": "2020-04-02T02:35:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDc2MjYxOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDc2MzkyMQ==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3975#discussion_r400763921", "bodyText": "I would move this up into the two ifs above. Then you can skip the check (skipIntroMesg != \"\" if and only if the code above is executed).", "author": "ByteHamster", "createdAt": "2020-03-31T09:19:36Z", "path": "core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java", "diffHunk": "@@ -505,6 +507,40 @@ public int onStartCommand(Intent intent, int flags, int startId) {\n         return Service.START_NOT_STICKY;\n     }\n \n+    private void skipIntro(Playable playable) {\n+        int skipIntro = 0;\n+        if (! (playable instanceof FeedMedia)) {\n+            return;\n+        }\n+\n+        if (playable.getLastPlayedTime() > 0) {\n+            return;\n+        }\n+\n+        if (playable instanceof FeedMedia) {\n+            FeedMedia feedMedia = (FeedMedia) playable;\n+            FeedPreferences preferences = feedMedia.getItem().getFeed().getPreferences();\n+            skipIntro = preferences.getFeedSkipIntro();\n+        }\n+\n+        String skipIntroMesg = \"\";\n+        Context context = getApplicationContext();\n+        if (skipIntro > 0) {\n+            int duration = getDuration();\n+            if (skipIntro * 1000 < duration) {\n+                mediaPlayer.seekTo(skipIntro * 1000);\n+                skipIntroMesg = context.getString(R.string.pref_feed_skip_intro_toast,\n+                        skipIntro,\n+                        context.getString(R.string.time_seconds));\n+            }\n+        }\n+        if (skipIntroMesg != \"\") {", "originalCommit": "8505e7bc5c072eaa3b52bf524b78e791a7a2778a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDc2NDkyMA==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3975#discussion_r400764920", "bodyText": "positionSaverTick is only executed every 5 seconds. I think you can use EventBus:\n@Subscribe\npublic void skipIfMetEnding(PlaybackPositionEvent event) {", "author": "ByteHamster", "createdAt": "2020-03-31T09:21:16Z", "path": "core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java", "diffHunk": "@@ -1037,6 +1075,34 @@ private void sendNotificationBroadcast(int type, int code) {\n         sendBroadcast(intent);\n     }\n \n+    private void skipIfMetEnding() {", "originalCommit": "8505e7bc5c072eaa3b52bf524b78e791a7a2778a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjAxODMwOQ==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3975#discussion_r402018309", "bodyText": "instead of a new Subscriber, I'm piggybacking on the onPositionObserver()", "author": "tonytamsf", "createdAt": "2020-04-02T02:33:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDc2NDkyMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDc2Njk1Ng==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3975#discussion_r400766956", "bodyText": "I don't think that this is enough. If AntennaPod automatically plays the next item in the queue, this code is not executed.", "author": "ByteHamster", "createdAt": "2020-03-31T09:24:29Z", "path": "core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java", "diffHunk": "@@ -496,6 +497,7 @@ public int onStartCommand(Intent intent, int flags, int startId) {\n                     return Service.START_NOT_STICKY;\n                 }\n                 mediaPlayer.playMediaObject(playable, stream, startWhenPrepared, prepareImmediately);\n+                skipIntro(playable);", "originalCommit": "8505e7bc5c072eaa3b52bf524b78e791a7a2778a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e93df087899e0fa9e356ba1bd8ed20abb042bfb6", "url": "https://github.com/AntennaPod/AntennaPod/commit/e93df087899e0fa9e356ba1bd8ed20abb042bfb6", "message": "androidx dialog", "committedDate": "2020-03-31T17:59:01Z", "type": "commit"}, {"oid": "1bcca4567ce64b52c52a2475d839830258db8f8b", "url": "https://github.com/AntennaPod/AntennaPod/commit/1bcca4567ce64b52c52a2475d839830258db8f8b", "message": "format", "committedDate": "2020-03-31T18:00:32Z", "type": "commit"}, {"oid": "28727d2295afff50f187ef70affa4e019905c64b", "url": "https://github.com/AntennaPod/AntennaPod/commit/28727d2295afff50f187ef70affa4e019905c64b", "message": "cleaner code", "committedDate": "2020-03-31T18:03:37Z", "type": "commit"}, {"oid": "15ba8d031ba064c357000b6de13a9835095fe096", "url": "https://github.com/AntennaPod/AntennaPod/commit/15ba8d031ba064c357000b6de13a9835095fe096", "message": "grammer", "committedDate": "2020-03-31T18:06:31Z", "type": "commit"}, {"oid": "9ea5bed6d3b8bb1134f6e7ed3fb908025d155f6e", "url": "https://github.com/AntennaPod/AntennaPod/commit/9ea5bed6d3b8bb1134f6e7ed3fb908025d155f6e", "message": "skipIntroPref and skipEndingPref at the right places", "committedDate": "2020-04-02T02:32:34Z", "type": "commit"}, {"oid": "f9ec0698b0c07608e45e8aff00c28f42fc6568fe", "url": "https://github.com/AntennaPod/AntennaPod/commit/f9ec0698b0c07608e45e8aff00c28f42fc6568fe", "message": "oops, wrong func", "committedDate": "2020-04-02T02:37:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQ2MDk5MQ==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3975#discussion_r402460991", "bodyText": "Why is this method called skipIntroPref? Why pref?", "author": "ByteHamster", "createdAt": "2020-04-02T16:49:53Z", "path": "core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java", "diffHunk": "@@ -505,6 +506,34 @@ public int onStartCommand(Intent intent, int flags, int startId) {\n         return Service.START_NOT_STICKY;\n     }\n \n+    private void skipIntroPref(Playable playable) {", "originalCommit": "f9ec0698b0c07608e45e8aff00c28f42fc6568fe", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQ3NjI2Mg==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3975#discussion_r402476262", "bodyText": "I think it would be easier for the translators if you just added the text \"Seconds\" to \"Skipped first\" in strings.xml. I do not think that we want to skip other units than seconds. Additionally, this gives a weird mix of languages if \"Seconds\" is translated but \"Skipped first\" is not translated.", "author": "ByteHamster", "createdAt": "2020-04-02T17:14:23Z", "path": "core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java", "diffHunk": "@@ -1037,6 +1068,34 @@ private void sendNotificationBroadcast(int type, int code) {\n         sendBroadcast(intent);\n     }\n \n+    private void skipEndingPref() {\n+        Playable playable = mediaPlayer.getPlayable();\n+        if (! (playable instanceof FeedMedia)) {\n+            return;\n+        }\n+\n+        int duration = getDuration();\n+        int remainingTime = duration - getCurrentPosition();\n+\n+        FeedMedia feedMedia = (FeedMedia) playable;\n+        FeedPreferences preferences = feedMedia.getItem().getFeed().getPreferences();\n+        int skipEnd = preferences.getFeedSkipEnding();\n+        if (skipEnd > 0 && remainingTime < skipEnd * 1000) {\n+            Log.d(TAG, \"skipEndingPref: Skipping the remaining \" + remainingTime / 1000 + \" \" + skipEnd );\n+            Context context = getApplicationContext();\n+            String skipMesg = context.getString(R.string.pref_feed_skip_ending_toast,\n+                    skipEnd,\n+                    context.getString(R.string.time_seconds));", "originalCommit": "f9ec0698b0c07608e45e8aff00c28f42fc6568fe", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQ3NzM2OQ==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3975#discussion_r402477369", "bodyText": "This is always true. You check for FeedMedia in the line above.", "author": "ByteHamster", "createdAt": "2020-04-02T17:16:16Z", "path": "core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java", "diffHunk": "@@ -505,6 +506,34 @@ public int onStartCommand(Intent intent, int flags, int startId) {\n         return Service.START_NOT_STICKY;\n     }\n \n+    private void skipIntroPref(Playable playable) {\n+        int skipIntro = 0;\n+        if (! (playable instanceof FeedMedia)) {\n+            return;\n+        }\n+\n+        if (playable instanceof FeedMedia) {", "originalCommit": "f9ec0698b0c07608e45e8aff00c28f42fc6568fe", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "495fceed76fd89f80b63254fc6490e379a06b883", "url": "https://github.com/AntennaPod/AntennaPod/commit/495fceed76fd89f80b63254fc6490e379a06b883", "message": "smarter about skipping long duration", "committedDate": "2020-04-03T04:08:14Z", "type": "commit"}, {"oid": "a1caf62567feb98bb4a3cab4235c5bb14221c4b0", "url": "https://github.com/AntennaPod/AntennaPod/commit/a1caf62567feb98bb4a3cab4235c5bb14221c4b0", "message": "double check the integersg", "committedDate": "2020-04-03T04:31:00Z", "type": "commit"}, {"oid": "a96683acc5d3cdcc7f4f37c7a3103ed0aa42f8e3", "url": "https://github.com/AntennaPod/AntennaPod/commit/a96683acc5d3cdcc7f4f37c7a3103ed0aa42f8e3", "message": "skip right before our ending, so we can replay", "committedDate": "2020-04-03T05:49:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjkxOTIyMQ==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3975#discussion_r402919221", "bodyText": "I think this could be done inside FeedPreferenceSkipDialog to keep the FeedSettingsFragment a bit shorter", "author": "ByteHamster", "createdAt": "2020-04-03T10:46:01Z", "path": "app/src/main/java/de/danoeh/antennapod/fragment/FeedSettingsFragment.java", "diffHunk": "@@ -159,6 +161,37 @@ public void onDestroy() {\n             }\n         }\n \n+        private void setupFeedAutoSkipPreference() {\n+            findPreference(\"skipping\").setOnPreferenceClickListener(preference -> {\n+                new FeedPreferenceSkipDialog(getContext(),\n+                        feedPreferences.getFeedSkipIntro(),\n+                        feedPreferences.getFeedSkipEnding()) {\n+                    @Override\n+                    protected void onConfirmed(String skipIntroStr, String skipEndingStr) {\n+\n+                        int skipIntro;\n+                        int skipEnding;\n+                        try {\n+                            skipIntro = Integer.parseInt(skipIntroStr);\n+                        } catch (NumberFormatException e) {\n+                            skipIntro = 0;\n+                        }", "originalCommit": "a96683acc5d3cdcc7f4f37c7a3103ed0aa42f8e3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzUwMjM2Ng==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3975#discussion_r403502366", "bodyText": "done", "author": "tonytamsf", "createdAt": "2020-04-04T18:40:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjkxOTIyMQ=="}], "type": "inlineReview"}, {"oid": "8057871422cbaf1a7db7b446f0baa148e0dd735a", "url": "https://github.com/AntennaPod/AntennaPod/commit/8057871422cbaf1a7db7b446f0baa148e0dd735a", "message": "move str to in logic to the right place", "committedDate": "2020-04-04T18:39:46Z", "type": "commit"}, {"oid": "1cd505504daacc88e3600a50ca2bab239e422a67", "url": "https://github.com/AntennaPod/AntennaPod/commit/1cd505504daacc88e3600a50ca2bab239e422a67", "message": "consider auto skipping the exact same behavior has an episode ending", "committedDate": "2020-04-04T19:28:43Z", "type": "commit"}, {"oid": "d41ede9d8443bae3e6461b37a9dbb76551e1f36b", "url": "https://github.com/AntennaPod/AntennaPod/commit/d41ede9d8443bae3e6461b37a9dbb76551e1f36b", "message": "listen to events when the Feed preference changed for skipIntro and skipEnding", "committedDate": "2020-04-04T21:45:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzcwNzI0OQ==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3975#discussion_r403707249", "bodyText": "What about skipEndingIfNecessary?", "author": "ByteHamster", "createdAt": "2020-04-05T14:11:08Z", "path": "core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java", "diffHunk": "@@ -1037,6 +1070,37 @@ private void sendNotificationBroadcast(int type, int code) {\n         sendBroadcast(intent);\n     }\n \n+    private void skipEnding() {", "originalCommit": "d41ede9d8443bae3e6461b37a9dbb76551e1f36b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzcwNzMxNQ==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3975#discussion_r403707315", "bodyText": "Please remove this. It is executed every second, so this floods the log output", "author": "ByteHamster", "createdAt": "2020-04-05T14:11:45Z", "path": "core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java", "diffHunk": "@@ -1037,6 +1070,37 @@ private void sendNotificationBroadcast(int type, int code) {\n         sendBroadcast(intent);\n     }\n \n+    private void skipEnding() {\n+        Playable playable = mediaPlayer.getPlayable();\n+        if (! (playable instanceof FeedMedia)) {\n+            return;\n+        }\n+\n+        int duration = getDuration();\n+        int remainingTime = duration - getCurrentPosition();\n+\n+        FeedMedia feedMedia = (FeedMedia) playable;\n+        FeedPreferences preferences = feedMedia.getItem().getFeed().getPreferences();\n+        int skipEnd = preferences.getFeedSkipEnding();\n+        if (skipEnd > 0 &&\n+            skipEnd < playable.getDuration() &&\n+            (remainingTime - (skipEnd * 1000) > 0) &&\n+            ((remainingTime - skipEnd * 1000) < (getCurrentPlaybackSpeed() * 1000))) {\n+            Log.d(TAG, \"skipEnding: Skipping the remaining \" + remainingTime + \" \" + skipEnd * 1000 + \" speed \" + getCurrentPlaybackSpeed());\n+            Context context = getApplicationContext();\n+            String skipMesg = context.getString(R.string.pref_feed_skip_ending_toast,\n+                    skipEnd);\n+            Toast toast = Toast.makeText(context, skipMesg,\n+                    Toast.LENGTH_LONG);\n+            toast.show();\n+\n+            playable.setAutoSkippedEnding(true);\n+            mediaPlayer.skip();\n+        } else {\n+           Log.d(TAG, \"skipEnding: Not at ending yet \" + remainingTime + \" diff \" + (remainingTime - (skipEnd * 1000)) + \" skipEnd \" + skipEnd * 1000 + \" speed \" + getCurrentPlaybackSpeed() * 1000);", "originalCommit": "d41ede9d8443bae3e6461b37a9dbb76551e1f36b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzcwNzYwNQ==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3975#discussion_r403707605", "bodyText": "This PR does not include the more strict diff-checkstyle CI rule. The && characters should be in the next line. Also, indentation should be 8 spaces when breaking the same statement.\nYou can select the file config/checkstyle/checkstyle-new-code.xml in IntelliJ/Android Studio (with checkstyle version 8.18 and \"Treat errors as warnings\") to get inline suggestions. Alternatively, you can rebase the commit with a more recent develop branch to have it executed on CI.", "author": "ByteHamster", "createdAt": "2020-04-05T14:13:54Z", "path": "core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java", "diffHunk": "@@ -1037,6 +1070,37 @@ private void sendNotificationBroadcast(int type, int code) {\n         sendBroadcast(intent);\n     }\n \n+    private void skipEnding() {\n+        Playable playable = mediaPlayer.getPlayable();\n+        if (! (playable instanceof FeedMedia)) {\n+            return;\n+        }\n+\n+        int duration = getDuration();\n+        int remainingTime = duration - getCurrentPosition();\n+\n+        FeedMedia feedMedia = (FeedMedia) playable;\n+        FeedPreferences preferences = feedMedia.getItem().getFeed().getPreferences();\n+        int skipEnd = preferences.getFeedSkipEnding();\n+        if (skipEnd > 0 &&\n+            skipEnd < playable.getDuration() &&", "originalCommit": "d41ede9d8443bae3e6461b37a9dbb76551e1f36b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzcwNzcwMg==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3975#discussion_r403707702", "bodyText": "Could you please make above statements a single line each? There is a lot of horizontal screen space left :)", "author": "ByteHamster", "createdAt": "2020-04-05T14:14:37Z", "path": "core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java", "diffHunk": "@@ -1037,6 +1070,37 @@ private void sendNotificationBroadcast(int type, int code) {\n         sendBroadcast(intent);\n     }\n \n+    private void skipEnding() {\n+        Playable playable = mediaPlayer.getPlayable();\n+        if (! (playable instanceof FeedMedia)) {\n+            return;\n+        }\n+\n+        int duration = getDuration();\n+        int remainingTime = duration - getCurrentPosition();\n+\n+        FeedMedia feedMedia = (FeedMedia) playable;\n+        FeedPreferences preferences = feedMedia.getItem().getFeed().getPreferences();\n+        int skipEnd = preferences.getFeedSkipEnding();\n+        if (skipEnd > 0 &&\n+            skipEnd < playable.getDuration() &&\n+            (remainingTime - (skipEnd * 1000) > 0) &&\n+            ((remainingTime - skipEnd * 1000) < (getCurrentPlaybackSpeed() * 1000))) {\n+            Log.d(TAG, \"skipEnding: Skipping the remaining \" + remainingTime + \" \" + skipEnd * 1000 + \" speed \" + getCurrentPlaybackSpeed());\n+            Context context = getApplicationContext();\n+            String skipMesg = context.getString(R.string.pref_feed_skip_ending_toast,\n+                    skipEnd);\n+            Toast toast = Toast.makeText(context, skipMesg,\n+                    Toast.LENGTH_LONG);", "originalCommit": "d41ede9d8443bae3e6461b37a9dbb76551e1f36b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzcxMDc1Ng==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3975#discussion_r403710756", "bodyText": "Hmm this adds quite a lot of code for a single use-case. What about checking the position here instead of adding the Playable methods?", "author": "ByteHamster", "createdAt": "2020-04-05T14:38:51Z", "path": "core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java", "diffHunk": "@@ -997,6 +1026,10 @@ private void onPostPlayback(final Playable playable, boolean ended, boolean skip\n             media.onPlaybackPause(getApplicationContext());\n         }\n \n+        if (playable.hasAutoSkippedEnding()) {", "originalCommit": "d41ede9d8443bae3e6461b37a9dbb76551e1f36b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "4595a3f674b2f3931eda02f956bf9b96f88836b5", "url": "https://github.com/AntennaPod/AntennaPod/commit/4595a3f674b2f3931eda02f956bf9b96f88836b5", "message": "code review, smaller code", "committedDate": "2020-04-06T02:43:22Z", "type": "commit"}, {"oid": "ed0117b8f892d963a709a2bced7baa4458e2e39b", "url": "https://github.com/AntennaPod/AntennaPod/commit/ed0117b8f892d963a709a2bced7baa4458e2e39b", "message": "clean up whitespace", "committedDate": "2020-04-06T02:54:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjgyNzE0OQ==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3975#discussion_r406827149", "bodyText": "Missing space :)", "author": "ByteHamster", "createdAt": "2020-04-10T16:10:44Z", "path": "core/src/main/java/de/danoeh/antennapod/core/feed/FeedPreferences.java", "diffHunk": "@@ -49,6 +55,8 @@ private FeedPreferences(long feedID, boolean autoDownload, boolean keepUpdated,\n         this.password = password;\n         this.filter = filter;\n         this.feedPlaybackSpeed = feedPlaybackSpeed;\n+        this.feedSkipIntro= feedSkipIntro;", "originalCommit": "ed0117b8f892d963a709a2bced7baa4458e2e39b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjgyNzczNg==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3975#discussion_r406827736", "bodyText": "Only one statement per line, please", "author": "ByteHamster", "createdAt": "2020-04-10T16:12:17Z", "path": "core/src/main/java/de/danoeh/antennapod/core/feed/FeedPreferences.java", "diffHunk": "@@ -204,4 +227,12 @@ public float getFeedPlaybackSpeed() {\n     public void setFeedPlaybackSpeed(float playbackSpeed) {\n         feedPlaybackSpeed = playbackSpeed;\n     }\n+\n+    public void setFeedSkipIntro(int skipIntro) { feedSkipIntro = skipIntro; }", "originalCommit": "ed0117b8f892d963a709a2bced7baa4458e2e39b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjgyODcwNQ==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3975#discussion_r406828705", "bodyText": "Can this be private? I think it would be enough to only save the ID instead of the whole object.", "author": "ByteHamster", "createdAt": "2020-04-10T16:14:21Z", "path": "core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java", "diffHunk": "@@ -210,6 +212,8 @@\n     private Disposable positionEventTimer;\n     private PlaybackServiceNotificationBuilder notificationBuilder;\n \n+    FeedMedia autoSkippedFeedMedia;", "originalCommit": "ed0117b8f892d963a709a2bced7baa4458e2e39b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "68b2fc4432b0425416a114fb67da17be03528856", "url": "https://github.com/AntennaPod/AntennaPod/commit/68b2fc4432b0425416a114fb67da17be03528856", "message": "cleaner code", "committedDate": "2020-04-10T19:43:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjkyMDQ4Nw==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3975#discussion_r406920487", "bodyText": "Sorry, I just noticed this line (otherwise, I would have written that earlier). Please use a constant here, just like the other preferences in this class.", "author": "ByteHamster", "createdAt": "2020-04-10T20:05:11Z", "path": "app/src/main/java/de/danoeh/antennapod/fragment/FeedSettingsFragment.java", "diffHunk": "@@ -159,6 +162,26 @@ public void onDestroy() {\n             }\n         }\n \n+        private void setupFeedAutoSkipPreference() {\n+            findPreference(\"skipping\").setOnPreferenceClickListener(preference -> {", "originalCommit": "68b2fc4432b0425416a114fb67da17be03528856", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjk5NDk0Nw==", "url": "https://github.com/AntennaPod/AntennaPod/pull/3975#discussion_r406994947", "bodyText": "No worries will change", "author": "tonytamsf", "createdAt": "2020-04-11T00:46:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjkyMDQ4Nw=="}], "type": "inlineReview"}, {"oid": "3b418f66ede9b7f2a0a27edcc057b6b4c93ba703", "url": "https://github.com/AntennaPod/AntennaPod/commit/3b418f66ede9b7f2a0a27edcc057b6b4c93ba703", "message": "preference is a constant", "committedDate": "2020-04-19T18:00:53Z", "type": "commit"}]}