{"pr_number": 767, "pr_title": "fix(client): add provider for insecure okhttp client", "pr_createdAt": "2020-09-01T05:42:55Z", "pr_url": "https://github.com/spinnaker/kork/pull/767", "timeline": [{"oid": "f22140f2d5da60810ba5297e97c4e4d29acb2f19", "url": "https://github.com/spinnaker/kork/commit/f22140f2d5da60810ba5297e97c4e4d29acb2f19", "message": "fix(client): add provider for insecure okhttp client", "committedDate": "2020-09-01T05:33:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTM4OTg4OQ==", "url": "https://github.com/spinnaker/kork/pull/767#discussion_r481389889", "bodyText": "Let's set the defaults isSecure and config on the class fields instead of in the constructors.", "author": "jonsie", "createdAt": "2020-09-01T19:45:53Z", "path": "kork-web/src/main/java/com/netflix/spinnaker/config/DefaultServiceEndpoint.java", "diffHunk": "@@ -31,12 +31,24 @@\n   /** Base API url */\n   @Nonnull private final String baseUrl;\n \n+  /** Indicates whether the certificate/host verification is desired or not */\n+  @Nonnull private final Boolean isSecure;\n+\n   /** Misc. config necessary for the service client. */\n   @Nonnull private final Map<String, Object> config;\n \n   public DefaultServiceEndpoint(@Nonnull String name, @Nonnull String baseUrl) {\n     this.name = Objects.requireNonNull(name);\n     this.baseUrl = Objects.requireNonNull(baseUrl);\n+    this.isSecure = true;\n+    this.config = new HashMap<>();\n+  }\n+\n+  public DefaultServiceEndpoint(\n+      @Nonnull String name, @Nonnull String baseUrl, @Nonnull Boolean isSecure) {\n+    this.name = Objects.requireNonNull(name);\n+    this.baseUrl = Objects.requireNonNull(baseUrl);\n+    this.isSecure = Objects.requireNonNull(isSecure);\n     this.config = new HashMap<>();", "originalCommit": "f22140f2d5da60810ba5297e97c4e4d29acb2f19", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjUxMzU0Nw==", "url": "https://github.com/spinnaker/kork/pull/767#discussion_r482513547", "bodyText": "we won't able to set them via constructor if we set the values on the class fields and we want those to be immutable so.", "author": "srekapalli", "createdAt": "2020-09-02T21:56:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTM4OTg4OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTM5MTk5OQ==", "url": "https://github.com/spinnaker/kork/pull/767#discussion_r481391999", "bodyText": "Seems like the operators should be lined up?", "author": "jonsie", "createdAt": "2020-09-01T19:49:55Z", "path": "kork-web/src/main/java/com/netflix/spinnaker/config/okhttp3/OkHttpClientBuilderProvider.java", "diffHunk": "@@ -33,8 +33,9 @@\n    * @return true if supports the url given\n    */\n   default Boolean supports(ServiceEndpoint service) {\n-    return service.getBaseUrl().startsWith(\"http://\")\n-        || service.getBaseUrl().startsWith(\"https://\");\n+    return ((service.getBaseUrl().startsWith(\"http://\")\n+            || service.getBaseUrl().startsWith(\"https://\"))\n+        && service.isSecure());", "originalCommit": "f22140f2d5da60810ba5297e97c4e4d29acb2f19", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjEyMjY0MA==", "url": "https://github.com/spinnaker/kork/pull/767#discussion_r482122640", "bodyText": "Spotless handles formatting.", "author": "robzienert", "createdAt": "2020-09-02T14:40:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTM5MTk5OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjEyMTMyMQ==", "url": "https://github.com/spinnaker/kork/pull/767#discussion_r482121321", "bodyText": "Just make isSecure an un-boxed primitive and then you can avoid @Nonnull and this Objects.requireNonNull check.", "author": "robzienert", "createdAt": "2020-09-02T14:38:35Z", "path": "kork-web/src/main/java/com/netflix/spinnaker/config/DefaultServiceEndpoint.java", "diffHunk": "@@ -31,12 +31,24 @@\n   /** Base API url */\n   @Nonnull private final String baseUrl;\n \n+  /** Indicates whether the certificate/host verification is desired or not */\n+  @Nonnull private final Boolean isSecure;\n+\n   /** Misc. config necessary for the service client. */\n   @Nonnull private final Map<String, Object> config;\n \n   public DefaultServiceEndpoint(@Nonnull String name, @Nonnull String baseUrl) {\n     this.name = Objects.requireNonNull(name);\n     this.baseUrl = Objects.requireNonNull(baseUrl);\n+    this.isSecure = true;\n+    this.config = new HashMap<>();\n+  }\n+\n+  public DefaultServiceEndpoint(\n+      @Nonnull String name, @Nonnull String baseUrl, @Nonnull Boolean isSecure) {\n+    this.name = Objects.requireNonNull(name);\n+    this.baseUrl = Objects.requireNonNull(baseUrl);\n+    this.isSecure = Objects.requireNonNull(isSecure);", "originalCommit": "f22140f2d5da60810ba5297e97c4e4d29acb2f19", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjEyMTUzOQ==", "url": "https://github.com/spinnaker/kork/pull/767#discussion_r482121539", "bodyText": "Don't believe you need to have Objects.requireNonNull if you're defining the fields as @Nonnull.", "author": "robzienert", "createdAt": "2020-09-02T14:38:54Z", "path": "kork-web/src/main/java/com/netflix/spinnaker/config/DefaultServiceEndpoint.java", "diffHunk": "@@ -31,12 +31,24 @@\n   /** Base API url */\n   @Nonnull private final String baseUrl;\n \n+  /** Indicates whether the certificate/host verification is desired or not */\n+  @Nonnull private final Boolean isSecure;\n+\n   /** Misc. config necessary for the service client. */\n   @Nonnull private final Map<String, Object> config;\n \n   public DefaultServiceEndpoint(@Nonnull String name, @Nonnull String baseUrl) {\n     this.name = Objects.requireNonNull(name);\n     this.baseUrl = Objects.requireNonNull(baseUrl);\n+    this.isSecure = true;\n+    this.config = new HashMap<>();\n+  }\n+\n+  public DefaultServiceEndpoint(\n+      @Nonnull String name, @Nonnull String baseUrl, @Nonnull Boolean isSecure) {\n+    this.name = Objects.requireNonNull(name);\n+    this.baseUrl = Objects.requireNonNull(baseUrl);", "originalCommit": "f22140f2d5da60810ba5297e97c4e4d29acb2f19", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjUxNTk5MA==", "url": "https://github.com/spinnaker/kork/pull/767#discussion_r482515990", "bodyText": "Are we guarded during Runtime ..?  @Nonnull will do the IDE level checks only I thought ..", "author": "srekapalli", "createdAt": "2020-09-02T21:59:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjEyMTUzOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjYzMTUxMQ==", "url": "https://github.com/spinnaker/kork/pull/767#discussion_r482631511", "bodyText": "Ah, true. nvm then!", "author": "robzienert", "createdAt": "2020-09-03T01:00:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjEyMTUzOQ=="}], "type": "inlineReview"}, {"oid": "fda9ccaba67db90e99e1247c64da82eb8b2dc3cd", "url": "https://github.com/spinnaker/kork/commit/fda9ccaba67db90e99e1247c64da82eb8b2dc3cd", "message": "fix(misc): set default vals in constructors", "committedDate": "2020-09-02T21:54:45Z", "type": "commit"}, {"oid": "2325a0a17b834ee7107901d09574035d6b1ddce4", "url": "https://github.com/spinnaker/kork/commit/2325a0a17b834ee7107901d09574035d6b1ddce4", "message": "Merge branch 'master' into insecure_okc", "committedDate": "2020-09-04T20:11:37Z", "type": "commit"}]}