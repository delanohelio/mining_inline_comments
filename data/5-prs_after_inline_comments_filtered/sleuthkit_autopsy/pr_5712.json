{"pr_number": 5712, "pr_title": "6079 use helper for artifact creation", "pr_createdAt": "2020-03-16T04:20:56Z", "pr_url": "https://github.com/sleuthkit/autopsy/pull/5712", "timeline": [{"oid": "f144a46819e401ec383ac347b7d2b6de3e537176", "url": "https://github.com/sleuthkit/autopsy/commit/f144a46819e401ec383ac347b7d2b6de3e537176", "message": "Updated the XRY DSP to use the helper methods", "committedDate": "2020-03-06T22:41:41Z", "type": "commit"}, {"oid": "12542711f32f93774c8a0df07054fd7a1d2be082", "url": "https://github.com/sleuthkit/autopsy/commit/12542711f32f93774c8a0df07054fd7a1d2be082", "message": "Merge branch 'develop' of github.com:sleuthkit/autopsy into 6081-Use-Helper-For-Artifact-Creation", "committedDate": "2020-03-06T22:43:11Z", "type": "commit"}, {"oid": "44408269f60f0d0e7af6117aaea7b850f18f2da8", "url": "https://github.com/sleuthkit/autopsy/commit/44408269f60f0d0e7af6117aaea7b850f18f2da8", "message": "Updated recent activity parsers to use web helpers", "committedDate": "2020-03-06T22:47:25Z", "type": "commit"}, {"oid": "8ed0e48efd783f431fc078079ac0848b51e8f2d9", "url": "https://github.com/sleuthkit/autopsy/commit/8ed0e48efd783f431fc078079ac0848b51e8f2d9", "message": "Slightly simplified the XRY parser refactor", "committedDate": "2020-03-11T16:07:15Z", "type": "commit"}, {"oid": "5fd3e137ce7c7e29d44067060035b68b70760ca4", "url": "https://github.com/sleuthkit/autopsy/commit/5fd3e137ce7c7e29d44067060035b68b70760ca4", "message": "Merge branch 'develop' of github.com:sleuthkit/autopsy into 6081-Use-Helper-For-Artifact-Creation", "committedDate": "2020-03-13T19:57:04Z", "type": "commit"}, {"oid": "b4087ed9fff5848a299c87547f5e8b475418fb8c", "url": "https://github.com/sleuthkit/autopsy/commit/b4087ed9fff5848a299c87547f5e8b475418fb8c", "message": "Merge branch 'develop' of github.com:sleuthkit/autopsy into 6081-Use-Helper-For-Artifact-Creation", "committedDate": "2020-03-15T18:09:41Z", "type": "commit"}, {"oid": "13bc5f4abe13512b6ed8c74a2d5a7998d6c03054", "url": "https://github.com/sleuthkit/autopsy/commit/13bc5f4abe13512b6ed8c74a2d5a7998d6c03054", "message": "Simplified XRY logic with CommHelper bug fix", "committedDate": "2020-03-16T03:45:34Z", "type": "commit"}, {"oid": "25bb44b2ec7681df6aafcad41b7d714aa835c903", "url": "https://github.com/sleuthkit/autopsy/commit/25bb44b2ec7681df6aafcad41b7d714aa835c903", "message": "Merge branch '6111-cvt-wrong-to-number' into 6081-Use-Helper-For-Artifact-Creation", "committedDate": "2020-03-17T19:09:50Z", "type": "commit"}, {"oid": "f09cd24b9d3f3921ab44449cf44a361dad8896c1", "url": "https://github.com/sleuthkit/autopsy/commit/f09cd24b9d3f3921ab44449cf44a361dad8896c1", "message": "Merge branch 'develop' of github.com:sleuthkit/autopsy into 6081-Use-Helper-For-Artifact-Creation", "committedDate": "2020-03-17T20:19:08Z", "type": "commit"}, {"oid": "57efb88a6c1b3a058dc700f63872a6174e7a9969", "url": "https://github.com/sleuthkit/autopsy/commit/57efb88a6c1b3a058dc700f63872a6174e7a9969", "message": "Merge branch 'develop' of github.com:sleuthkit/autopsy into 6081-Use-Helper-For-Artifact-Creation", "committedDate": "2020-03-26T19:31:19Z", "type": "commit"}, {"oid": "88a58a6083512750a9a8f8a52b27d08dbb8c33ed", "url": "https://github.com/sleuthkit/autopsy/commit/88a58a6083512750a9a8f8a52b27d08dbb8c33ed", "message": "Updated the XRY parser implementations to do some phone and email validation using CommunicationUtils. Created an XRYUtils to contain all the shared methods", "committedDate": "2020-03-26T21:33:54Z", "type": "commit"}, {"oid": "c139387520ebecc03920a3a2a621934f7d0e52e6", "url": "https://github.com/sleuthkit/autopsy/commit/c139387520ebecc03920a3a2a621934f7d0e52e6", "message": "Fixed the header date on the XRYUtils file", "committedDate": "2020-03-26T21:40:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODgxNzUxOQ==", "url": "https://github.com/sleuthkit/autopsy/pull/5712#discussion_r398817519", "bodyText": "Is there a reason we don't need to normalize to lower case any more?", "author": "raman-bt", "createdAt": "2020-03-26T18:56:55Z", "path": "Core/src/org/sleuthkit/autopsy/datasourceprocessors/xry/XRYContactsFileParser.java", "diffHunk": "@@ -19,49 +19,30 @@\n package org.sleuthkit.autopsy.datasourceprocessors.xry;\n \n import java.util.ArrayList;\n-import java.util.HashMap;\n+import java.util.Collection;\n import java.util.List;\n-import java.util.Map;\n-import java.util.Optional;\n import java.util.logging.Level;\n import org.sleuthkit.autopsy.coreutils.Logger;\n-import org.sleuthkit.datamodel.BlackboardAttribute;\n+import static org.sleuthkit.autopsy.datasourceprocessors.xry.AbstractSingleEntityParser.PARSER_NAME;\n+import org.sleuthkit.datamodel.Account;\n+import org.sleuthkit.datamodel.Blackboard;\n import org.sleuthkit.datamodel.BlackboardArtifact;\n+import org.sleuthkit.datamodel.BlackboardAttribute;\n import org.sleuthkit.datamodel.Content;\n+import org.sleuthkit.datamodel.SleuthkitCase;\n import org.sleuthkit.datamodel.TskCoreException;\n+import org.sleuthkit.datamodel.blackboardutils.CommunicationArtifactsHelper;\n \n /**\n  * Parses XRY Contacts-Contacts files and creates artifacts.\n  */\n final class XRYContactsFileParser extends AbstractSingleEntityParser {\n-    \n+\n     private static final Logger logger = Logger.getLogger(XRYContactsFileParser.class.getName());\n \n-    //All of the known XRY keys for contacts.\n-    private static final Map<String, BlackboardAttribute.ATTRIBUTE_TYPE> XRY_KEYS = \n-            new HashMap<String, BlackboardAttribute.ATTRIBUTE_TYPE>() {{\n-        put(\"name\", BlackboardAttribute.ATTRIBUTE_TYPE.TSK_NAME);\n-        put(\"tel\", BlackboardAttribute.ATTRIBUTE_TYPE.TSK_PHONE_NUMBER);\n-        put(\"mobile\", BlackboardAttribute.ATTRIBUTE_TYPE.TSK_PHONE_NUMBER_MOBILE);\n-        put(\"home\", BlackboardAttribute.ATTRIBUTE_TYPE.TSK_PHONE_NUMBER_HOME);\n-        put(\"related application\", BlackboardAttribute.ATTRIBUTE_TYPE.TSK_PROG_NAME);\n-        put(\"address home\", BlackboardAttribute.ATTRIBUTE_TYPE.TSK_LOCATION);\n-        put(\"email home\", BlackboardAttribute.ATTRIBUTE_TYPE.TSK_EMAIL_HOME);\n-        put(\"deleted\", BlackboardAttribute.ATTRIBUTE_TYPE.TSK_ISDELETED);\n-        \n-        //Ignoring or need more information to decide.\n-        put(\"storage\", null);\n-        put(\"other\", null);\n-        put(\"picture\", null);\n-        put(\"index\", null);\n-        put(\"account name\", null);\n-        \n-    }};\n-    \n     @Override\n     boolean canProcess(XRYKeyValuePair pair) {\n-        String normalizedKey = pair.getKey().toLowerCase();\n-        return XRY_KEYS.containsKey(normalizedKey);\n+        return XryKey.contains(pair.getKey());", "originalCommit": "13bc5f4abe13512b6ed8c74a2d5a7998d6c03054", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTYyNTAxNA==", "url": "https://github.com/sleuthkit/autopsy/pull/5712#discussion_r401625014", "bodyText": "Yes, the key is lower-cased in XryKey.contains() method.", "author": "dannysmyda", "createdAt": "2020-04-01T13:42:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODgxNzUxOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTI1MDExNQ==", "url": "https://github.com/sleuthkit/autopsy/pull/5712#discussion_r399250115", "bodyText": "None of these Util methods are being used outside this package, at least not at the moment.\nLeave them with package access instead of public?", "author": "raman-bt", "createdAt": "2020-03-27T13:07:23Z", "path": "Core/src/org/sleuthkit/autopsy/datasourceprocessors/xry/XRYUtils.java", "diffHunk": "@@ -0,0 +1,151 @@\n+/*\n+ * Autopsy Forensic Browser\n+ *\n+ * Copyright 2019-2020 Basis Technology Corp.\n+ * Contact: carrier <at> sleuthkit <dot> org\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.sleuthkit.autopsy.datasourceprocessors.xry;\n+\n+import java.time.Instant;\n+import java.time.LocalDateTime;\n+import java.time.OffsetDateTime;\n+import java.time.ZoneId;\n+import java.time.ZonedDateTime;\n+import java.time.format.DateTimeFormatter;\n+import java.time.temporal.TemporalAccessor;\n+import java.time.temporal.TemporalQueries;\n+import org.sleuthkit.datamodel.CommunicationsUtils;\n+import org.sleuthkit.datamodel.TskCoreException;\n+\n+/**\n+ * Common utility methods shared among all XRY parser implementations.\n+ */\n+public final class XRYUtils {\n+\n+    // Pattern is in reverse due to a Java 8 bug, see calculateSecondsSinceEpoch()\n+    // function for more details.\n+    private static final DateTimeFormatter DATE_TIME_PARSER\n+            = DateTimeFormatter.ofPattern(\"[(XXX) ][O ][(O) ]a h:m:s M/d/y\");\n+\n+    private static final String DEVICE_LOCALE = \"(device)\";\n+    private static final String NETWORK_LOCALE = \"(network)\";\n+\n+    public static boolean isPhoneValid(String phoneNumber) {", "originalCommit": "88a58a6083512750a9a8f8a52b27d08dbb8c33ed", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTYyNTE2Ng==", "url": "https://github.com/sleuthkit/autopsy/pull/5712#discussion_r401625166", "bodyText": "Sounds good.", "author": "dannysmyda", "createdAt": "2020-04-01T13:43:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTI1MDExNQ=="}], "type": "inlineReview"}, {"oid": "8f8587dbfa9ba09e7d56819b6f218afa8cb22e50", "url": "https://github.com/sleuthkit/autopsy/commit/8f8587dbfa9ba09e7d56819b6f218afa8cb22e50", "message": "Implemented review feedback", "committedDate": "2020-04-01T13:51:12Z", "type": "commit"}]}