{"pr_number": 1035, "pr_title": "Fix resources unit test with parallel", "pr_createdAt": "2020-02-19T05:58:13Z", "pr_url": "https://github.com/Azure/azure-libraries-for-java/pull/1035", "timeline": [{"oid": "c23b80b12cf0a9d4d3fb2257fc785f3f36a524a2", "url": "https://github.com/Azure/azure-libraries-for-java/commit/c23b80b12cf0a9d4d3fb2257fc785f3f36a524a2", "message": "fix: provider impl", "committedDate": "2020-02-19T03:36:09Z", "type": "commit"}, {"oid": "0788cfd0eda0045b9736e09fae88d1740d1243d4", "url": "https://github.com/Azure/azure-libraries-for-java/commit/0788cfd0eda0045b9736e09fae88d1740d1243d4", "message": "fix: synchronized for getToken", "committedDate": "2020-02-19T03:36:09Z", "type": "commit"}, {"oid": "6cd7c432ba27d14e573cc7d24fe280acb7c02f9b", "url": "https://github.com/Azure/azure-libraries-for-java/commit/6cd7c432ba27d14e573cc7d24fe280acb7c02f9b", "message": "fix: begin delete in resource group", "committedDate": "2020-02-19T03:36:09Z", "type": "commit"}, {"oid": "bfe37392c6effd7309926ea74ca42d16c503f9c6", "url": "https://github.com/Azure/azure-libraries-for-java/commit/bfe37392c6effd7309926ea74ca42d16c503f9c6", "message": "fix: donot process request in playback", "committedDate": "2020-02-19T03:36:09Z", "type": "commit"}, {"oid": "009840af4b6d5575de89b0faad2c9cb8fca25843", "url": "https://github.com/Azure/azure-libraries-for-java/commit/009840af4b6d5575de89b0faad2c9cb8fca25843", "message": "fix: remove static variable for test parallel in resources", "committedDate": "2020-02-19T03:36:09Z", "type": "commit"}, {"oid": "6c6460f6b1c7c403cb4c67565c9321fc31805c8f", "url": "https://github.com/Azure/azure-libraries-for-java/commit/6c6460f6b1c7c403cb4c67565c9321fc31805c8f", "message": "fix: interceptor use lambda", "committedDate": "2020-02-19T03:36:09Z", "type": "commit"}, {"oid": "2ef60a3305a15decd9e311458d30b7eac471b346", "url": "https://github.com/Azure/azure-libraries-for-java/commit/2ef60a3305a15decd9e311458d30b7eac471b346", "message": "fix: add test info", "committedDate": "2020-02-19T05:34:26Z", "type": "commit"}, {"oid": "c4c7297d2a7cb2246ceb64ff342ee540cead8a83", "url": "https://github.com/Azure/azure-libraries-for-java/commit/c4c7297d2a7cb2246ceb64ff342ee540cead8a83", "message": "fix: do not wait the delete end", "committedDate": "2020-02-19T05:36:05Z", "type": "commit"}, {"oid": "3aee7db3d3d193c6e7de242723c70184f3dd4974", "url": "https://github.com/Azure/azure-libraries-for-java/commit/3aee7db3d3d193c6e7de242723c70184f3dd4974", "message": "fix: add thread local for resourceNamerFactory and ignore last variable error in playback", "committedDate": "2020-02-19T05:52:17Z", "type": "commit"}, {"oid": "6eb5b72eef08c9ccee1d6413d746e0928ce666b9", "url": "https://github.com/Azure/azure-libraries-for-java/commit/6eb5b72eef08c9ccee1d6413d746e0928ce666b9", "message": "feat: update session-records for resources", "committedDate": "2020-02-19T05:53:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTA5MTc2Ng==", "url": "https://github.com/Azure/azure-libraries-for-java/pull/1035#discussion_r381091766", "bodyText": "Probably better to just let it fail? Seems should not happen in normal case.", "author": "weidongxu-microsoft", "createdAt": "2020-02-19T06:01:50Z", "path": "azure-mgmt-resources/src/test/java/com/azure/management/resources/core/TestResourceNamer.java", "diffHunk": "@@ -28,7 +29,11 @@ public TestResourceNamer(String name, InterceptorManager interceptorManager) {\n     @Override\n     public String randomName(String prefix, int maxLen) {\n         if (interceptorManager.isPlaybackMode()) {\n-            return interceptorManager.popVariable();\n+            try {", "originalCommit": "6eb5b72eef08c9ccee1d6413d746e0928ce666b9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTA5MjU4Nw==", "url": "https://github.com/Azure/azure-libraries-for-java/pull/1035#discussion_r381092587", "bodyText": "It happened usually, since we only record the variable in main thread. Multi-thread behaves strange.", "author": "ChenTanyi", "createdAt": "2020-02-19T06:05:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTA5MTc2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTA5MzU1MQ==", "url": "https://github.com/Azure/azure-libraries-for-java/pull/1035#discussion_r381093551", "bodyText": "If the name doesn't match, it would cause other exception in playback.", "author": "ChenTanyi", "createdAt": "2020-02-19T06:09:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTA5MTc2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTA5NDU2Ng==", "url": "https://github.com/Azure/azure-libraries-for-java/pull/1035#discussion_r381094566", "bodyText": "I mean Exception is expected if something went wrong with recording. Better to just fail fast, instead of making up something, and fail far-away when people have no idea what is the cause.", "author": "weidongxu-microsoft", "createdAt": "2020-02-19T06:13:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTA5MTc2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTA5NjY3NQ==", "url": "https://github.com/Azure/azure-libraries-for-java/pull/1035#discussion_r381096675", "bodyText": "Some of the reason about it:\n\nThe random uuid in the async function does not affect the playback when it differ.\nThe async function would run into random thread, which could not make every record success. This makes it hard to distinguish record successful or not.\n\nSo I just skip this error in list, if the variable affect the playback process, it would throw not match exception during request.", "author": "ChenTanyi", "createdAt": "2020-02-19T06:22:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTA5MTc2Ng=="}], "type": "inlineReview"}]}