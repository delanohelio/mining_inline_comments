{"pr_number": 177, "pr_title": "Created Storage sample app with blob listing and MSAL", "pr_createdAt": "2020-02-03T18:30:57Z", "pr_url": "https://github.com/Azure/azure-sdk-for-android/pull/177", "timeline": [{"oid": "28acd7652221784628d9d59f3c3fa57ce1039332", "url": "https://github.com/Azure/azure-sdk-for-android/commit/28acd7652221784628d9d59f3c3fa57ce1039332", "message": "Moved the sample Storage app to root level, changed the folder structure to follow core and storage and refactored classes that required it. This work is based on the 'storage-client-prototype-1' branch by @anuchandy.", "committedDate": "2020-02-03T18:26:35Z", "type": "commit"}, {"oid": "b6ea91b9be061ec9492f0492b48b7997e5859b60", "url": "https://github.com/Azure/azure-sdk-for-android/commit/b6ea91b9be061ec9492f0492b48b7997e5859b60", "message": "Fix Gradle build issues", "committedDate": "2020-02-04T23:42:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDk3OTc2Mg==", "url": "https://github.com/Azure/azure-sdk-for-android/pull/177#discussion_r374979762", "bodyText": "Can we add a comment here about what this type of exception means?", "author": "bsiegel", "createdAt": "2020-02-04T23:19:55Z", "path": "samples/sample-app-storage/src/main/java/com/azure/android/storage/sample/MsalClient.java", "diffHunk": "@@ -0,0 +1,94 @@\n+package com.azure.android.storage.sample;\n+\n+import android.app.Activity;\n+import android.util.Log;\n+\n+import androidx.annotation.NonNull;\n+\n+import com.azure.android.storage.sample.core.credential.AccessToken;\n+import com.azure.android.storage.sample.core.util.tokenrequest.TokenResponseCallback;\n+import com.microsoft.identity.client.AuthenticationCallback;\n+import com.microsoft.identity.client.IAuthenticationResult;\n+import com.microsoft.identity.client.PublicClientApplication;\n+import com.microsoft.identity.client.exception.MsalClientException;\n+import com.microsoft.identity.client.exception.MsalException;\n+import com.microsoft.identity.client.exception.MsalServiceException;\n+import com.microsoft.identity.client.exception.MsalUiRequiredException;\n+\n+import org.threeten.bp.DateTimeUtils;\n+import org.threeten.bp.OffsetDateTime;\n+import org.threeten.bp.ZoneOffset;\n+\n+import java.util.Date;\n+\n+class MsalClient {\n+    private static final String TAG = MsalClient.class.getSimpleName();\n+\n+    private MsalClient() {}\n+\n+    public static void signIn(@NonNull final PublicClientApplication aadApp,\n+                       @NonNull final Activity activity,\n+                       @NonNull final String[] scopes,\n+                       @NonNull final TokenResponseCallback callback) {\n+        aadApp.getAccounts(accounts -> {\n+            if (!accounts.isEmpty()) {\n+                aadApp.acquireTokenSilentAsync(scopes, accounts.get(0), new AuthenticationCallback() {\n+                    @Override\n+                    public void onSuccess(IAuthenticationResult authResult) {\n+                        Log.d(TAG, \"[acquireTokenSilentAsync]: Successfully authenticated.\");\n+                        callback.onToken(new AccessToken(authResult.getAccessToken(),\n+                                toOffsetDateTime(authResult.getExpiresOn())));\n+                    }\n+\n+                    @Override\n+                    public void onError(MsalException exception) {\n+                        Log.d(TAG, \"[acquireTokenSilentAsync]: Authentication failed: \" + exception.toString());\n+                        if (exception instanceof MsalClientException) {", "originalCommit": "28acd7652221784628d9d59f3c3fa57ce1039332", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTAxMjc1NQ==", "url": "https://github.com/Azure/azure-sdk-for-android/pull/177#discussion_r375012755", "bodyText": "it's for general local error in msal library.\n@vcolin7 could you please add a comment referring to https://javadoc.io/doc/com.microsoft.identity.client/msal/0.1.1/com/microsoft/identity/client/MsalClientException.html", "author": "anuchandy", "createdAt": "2020-02-05T01:16:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDk3OTc2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTQ2MzkxOQ==", "url": "https://github.com/Azure/azure-sdk-for-android/pull/177#discussion_r375463919", "bodyText": "Sure thing", "author": "vcolin7", "createdAt": "2020-02-05T19:33:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDk3OTc2Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDk3OTk2Mw==", "url": "https://github.com/Azure/azure-sdk-for-android/pull/177#discussion_r374979963", "bodyText": "Nit: How do you feel about capitalizing this (and other MSAL-related classes) like MSALClient?", "author": "bsiegel", "createdAt": "2020-02-04T23:20:32Z", "path": "samples/sample-app-storage/src/main/java/com/azure/android/storage/sample/MsalClient.java", "diffHunk": "@@ -0,0 +1,94 @@\n+package com.azure.android.storage.sample;\n+\n+import android.app.Activity;\n+import android.util.Log;\n+\n+import androidx.annotation.NonNull;\n+\n+import com.azure.android.storage.sample.core.credential.AccessToken;\n+import com.azure.android.storage.sample.core.util.tokenrequest.TokenResponseCallback;\n+import com.microsoft.identity.client.AuthenticationCallback;\n+import com.microsoft.identity.client.IAuthenticationResult;\n+import com.microsoft.identity.client.PublicClientApplication;\n+import com.microsoft.identity.client.exception.MsalClientException;\n+import com.microsoft.identity.client.exception.MsalException;\n+import com.microsoft.identity.client.exception.MsalServiceException;\n+import com.microsoft.identity.client.exception.MsalUiRequiredException;\n+\n+import org.threeten.bp.DateTimeUtils;\n+import org.threeten.bp.OffsetDateTime;\n+import org.threeten.bp.ZoneOffset;\n+\n+import java.util.Date;\n+\n+class MsalClient {", "originalCommit": "28acd7652221784628d9d59f3c3fa57ce1039332", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTAxMTY3OA==", "url": "https://github.com/Azure/azure-sdk-for-android/pull/177#discussion_r375011678", "bodyText": "Java guideline is to use pascal-case for acronyms so Msal.", "author": "anuchandy", "createdAt": "2020-02-05T01:11:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDk3OTk2Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTAxMTgzNg==", "url": "https://github.com/Azure/azure-sdk-for-android/pull/177#discussion_r375011836", "bodyText": "https://azure.github.io/azure-sdk/java_design.html#java-naming-uppercase-acronyms", "author": "anuchandy", "createdAt": "2020-02-05T01:12:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDk3OTk2Mw=="}], "type": "inlineReview"}, {"oid": "a1e637e673dc47093049f05cef24920fedd6e3ad", "url": "https://github.com/Azure/azure-sdk-for-android/commit/a1e637e673dc47093049f05cef24920fedd6e3ad", "message": "Re-ordered the sample app's dependencies.", "committedDate": "2020-02-06T03:21:07Z", "type": "commit"}, {"oid": "d892a581830da5445a8bec986488c3a71f63957b", "url": "https://github.com/Azure/azure-sdk-for-android/commit/d892a581830da5445a8bec986488c3a71f63957b", "message": "Added more info on MsalException and fixed a lint error in ContainerBlobsPagedListAdapter.", "committedDate": "2020-02-06T04:09:21Z", "type": "commit"}, {"oid": "4b744d033fc4d3ffc0f0cac1335ef7eeddb2e2c9", "url": "https://github.com/Azure/azure-sdk-for-android/commit/4b744d033fc4d3ffc0f0cac1335ef7eeddb2e2c9", "message": "Merge branch 'dev' into storage-sample-app", "committedDate": "2020-02-06T04:11:35Z", "type": "commit"}, {"oid": "a8c445e828570134480c68db72548127e68ac652", "url": "https://github.com/Azure/azure-sdk-for-android/commit/a8c445e828570134480c68db72548127e68ac652", "message": "Re-applied changes to fix Gradle build issues (by @bsiegel here: https://github.com/Azure/azure-sdk-for-android/commit/b6ea91b9be061ec9492f0492b48b7997e5859b60).", "committedDate": "2020-02-06T22:57:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjEzNTA0NA==", "url": "https://github.com/Azure/azure-sdk-for-android/pull/177#discussion_r376135044", "bodyText": "link should be : https://javadoc.io/static/com.microsoft.identity.client/msal/0.1.1/com/microsoft/identity/client/MsalUiRequiredException.html", "author": "anuchandy", "createdAt": "2020-02-06T23:13:47Z", "path": "samples/sample-app-storage/src/main/java/com/azure/android/storage/sample/MsalClient.java", "diffHunk": "@@ -40,15 +40,18 @@ public void onSuccess(IAuthenticationResult authResult) {\n                                 toOffsetDateTime(authResult.getExpiresOn())));\n                     }\n \n-                    // For more info on MsalException, see: https://javadoc.io/doc/com.microsoft.identity.client/msal/0.1.1/com/microsoft/identity/client/MsalClientException.html\n                     @Override\n                     public void onError(MsalException exception) {\n                         Log.d(TAG, \"[acquireTokenSilentAsync]: Authentication failed: \" + exception.toString());\n                         if (exception instanceof MsalClientException) {\n+                            // Exception thrown for general errors that are local to the MSAL library. For more\n+                            // information, see: https://javadoc.io/doc/com.microsoft.identity.client/msal/0.1.1/com/microsoft/identity/client/MsalClientException.html\n                         } else if (exception instanceof MsalServiceException) {\n-                            /* Exception when communicating with the STS, likely config issue */\n+                            // Exception thrown when communicating with the STS, likely because of a configuration\n+                            // issue. For more information, see: https://javadoc.io/static/com.microsoft.identity.client/msal/0.1.1/com/microsoft/identity/client/MsalServiceException.html\n                         } else if (exception instanceof MsalUiRequiredException) {\n-                            /* Tokens expired or no session, retry with interactive */\n+                            // Exception thrown when auth token is expired or there is no active session, must retry\n+                            // with interactive login. For more information, see: https://javadoc.io/static/com.microsoft.identity.client/msal/0.1.1/com/microsoft/identity/client/MsalServiceException.html", "originalCommit": "a00a23c6c9cb9cd8894323687d0b5fb6443f0a80", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjEzNTUyMQ==", "url": "https://github.com/Azure/azure-sdk-for-android/pull/177#discussion_r376135521", "bodyText": "Good catch :)", "author": "bsiegel", "createdAt": "2020-02-06T23:15:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjEzNTA0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjEzNTcyMw==", "url": "https://github.com/Azure/azure-sdk-for-android/pull/177#discussion_r376135723", "bodyText": "You are right. I'll fix that real quick.", "author": "vcolin7", "createdAt": "2020-02-06T23:15:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjEzNTA0NA=="}], "type": "inlineReview"}, {"oid": "7828e2317252dd4dcb43727deb205491444f54cb", "url": "https://github.com/Azure/azure-sdk-for-android/commit/7828e2317252dd4dcb43727deb205491444f54cb", "message": "Added more information on the different types of MsalException.", "committedDate": "2020-02-06T23:16:10Z", "type": "commit"}, {"oid": "7828e2317252dd4dcb43727deb205491444f54cb", "url": "https://github.com/Azure/azure-sdk-for-android/commit/7828e2317252dd4dcb43727deb205491444f54cb", "message": "Added more information on the different types of MsalException.", "committedDate": "2020-02-06T23:16:10Z", "type": "forcePushed"}]}