{"pr_number": 340, "pr_title": "Adding callbackWithHeader and updating callback signature to include Response", "pr_createdAt": "2020-09-15T00:24:37Z", "pr_url": "https://github.com/Azure/azure-sdk-for-android/pull/340", "timeline": [{"oid": "9cabfcc693712c238fbb8852b4921581246a3857", "url": "https://github.com/Azure/azure-sdk-for-android/commit/9cabfcc693712c238fbb8852b4921581246a3857", "message": "Adding callbackWithHeader and updating callback signature to include Response", "committedDate": "2020-09-15T00:15:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODMxNDY0NA==", "url": "https://github.com/Azure/azure-sdk-for-android/pull/340#discussion_r488314644", "bodyText": "It is not clear H is a single or a collection. Consider making it clear. Single will be less useful, IMHO. If this can only be retrofit headers, make it clear, i.e., use the concrete rather than abstraction. Notice that okhttp3.Response already contains headers, what this additional H is meant for? Adding headers? but that doesn't make much sense in the response context (request maybe). I must be missing something", "author": "JianpingChen", "createdAt": "2020-09-15T00:42:07Z", "path": "sdk/core/azure-core/src/main/java/com/azure/android/core/http/CallbackWithHeader.java", "diffHunk": "@@ -0,0 +1,29 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.android.core.http;\n+\n+/**\n+ * Callback to receive a service operation result.\n+ *\n+ * @param <T> The type of the result.\n+ * @param <T> The type of the header.\n+ */\n+public interface CallbackWithHeader<T, H> {\n+    /**\n+     * The method to call on a successful result.\n+     *\n+     * @param result   The result.\n+     * @param header   The custom header value.\n+     * @param response The response.\n+     */\n+    void onSuccess(T result, H header, okhttp3.Response response);", "originalCommit": "9cabfcc693712c238fbb8852b4921581246a3857", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODM0OTc5OA==", "url": "https://github.com/Azure/azure-sdk-for-android/pull/340#discussion_r488349798", "bodyText": "It will be a single type. Basically swagger will define a header class type (H), whose properties are set from subset of raw http response headers. This often means those headers has special meaning or important for the service. All storage apis uses this pattern.", "author": "anuchandy", "createdAt": "2020-09-15T02:46:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODMxNDY0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODgwNDYwNw==", "url": "https://github.com/Azure/azure-sdk-for-android/pull/340#discussion_r488804607", "bodyText": "But they have to be part of okhttp3.Response.getHeaders() to be transported across, correct? If that's true, it is already contained in okhttp3.Response.getHeaders(). It is just when we interpret these headers, we need some kind of convenience, e.g. getBodyLength() or hasPagingHeader()/getPagingHeader(). To me, these convenience functions more belong to Response<T> class or its derivation. So instead of CallbackWithHeader, we may consider having Callback<Response<T>> where Response<T> class may interpret the raw okhttp3 headers for our convenience.", "author": "JianpingChen", "createdAt": "2020-09-15T16:32:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODMxNDY0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODgyMDQyNw==", "url": "https://github.com/Azure/azure-sdk-for-android/pull/340#discussion_r488820427", "bodyText": "For example, if ListBlobFlatSegmentHeaders is expected from the response, a class derived from Response<T>, e.g. ListBlobResponse, may provide function like getListBlobFlatSegmentHeaders(): ListBlobFlatSegmentHeaders where the corresponding raw header value is parsed into ListBlobFlatSegmentHeaders. When callback.onSuccess(listBlobResponse) is called, the header is already parsed. This way parsing of that particular header value will only happen in one place and one place only, in this case in ListBlobResponse only.", "author": "JianpingChen", "createdAt": "2020-09-15T16:58:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODMxNDY0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg0MDA5MQ==", "url": "https://github.com/Azure/azure-sdk-for-android/pull/340#discussion_r488840091", "bodyText": "Thanks, JP. Like you explained, we do have the concept similar to ListBlobResponse that composing:\n\"(1). deserialized body\" + \"(2). deserialized header\" ListBlobFlatSegmentHeaders.\nWe return  ListBlobResponse from \"sync\" calls.\nFor async calls, we always want to emit the \"deserialized body\" and raw-response as a separate value, for example, if we take Callback\nCallback::onSuccess(T deserializedBody, okhttp3.response rawResponse)\nif we want a consistent \"extended\" signature for storage, it looks like (as in this PR)\nCallback::onSuccess(T deserializedBody,  H deserialziedHeader,  okhttp3.response rawResponse)\n\nOf course,  alternatively we consistent with the \"sync\" case i.e. Callback::onSuccess(U result) where result = \"T deserializedBody +  H deserialziedHeader + response\".\nBut I would rather ensure consistency within \"async\" rather across \"sync\" and \"async\", often use-case is either use \"sync client\" or use \"async client\", not a mix of these two.", "author": "anuchandy", "createdAt": "2020-09-15T17:29:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODMxNDY0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg4MTk5MA==", "url": "https://github.com/Azure/azure-sdk-for-android/pull/340#discussion_r488881990", "bodyText": "To me, reuse existing code, ListBlobResponse, makes more sense. But if you have good reasons, I'll pass then.", "author": "JianpingChen", "createdAt": "2020-09-15T18:37:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODMxNDY0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODMxODU0NQ==", "url": "https://github.com/Azure/azure-sdk-for-android/pull/340#discussion_r488318545", "bodyText": "Check nullness?", "author": "JianpingChen", "createdAt": "2020-09-15T00:55:27Z", "path": "sdk/storage/azure-storage-blob/src/main/java/com/azure/android/storage/blob/models/BlobsPage.java", "diffHunk": "@@ -0,0 +1,28 @@\n+package com.azure.android.storage.blob.models;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+public class BlobsPage {\n+    private final List<BlobItem> items;\n+    private final String pageId;\n+    private final String nextPageId;\n+\n+    public BlobsPage(List<BlobItem> items, String pageId, String nextPageId) {\n+        this.items = items == null ? new ArrayList<>() : items;\n+        this.pageId = pageId;", "originalCommit": "9cabfcc693712c238fbb8852b4921581246a3857", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODM1MDIzMA==", "url": "https://github.com/Azure/azure-sdk-for-android/pull/340#discussion_r488350230", "bodyText": "PageId will be null for first page and nextPageId will be null for last page.", "author": "anuchandy", "createdAt": "2020-09-15T02:48:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODMxODU0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg3OTQ1MQ==", "url": "https://github.com/Azure/azure-sdk-for-android/pull/340#discussion_r488879451", "bodyText": "That's what I thought the first time around when working on our PagedCollection and Page, do we want to have a similar approach there? I mean not having a getFirstPage() method and getting the first page by passing a null pageId to getPage().", "author": "vcolin7", "createdAt": "2020-09-15T18:33:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODMxODU0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg4NDEzOA==", "url": "https://github.com/Azure/azure-sdk-for-android/pull/340#discussion_r488884138", "bodyText": "But caching cannot use a null as key, to my understanding. The fact a pageId can sometimes be null will only may code more complicated. I'd hope the calling code can fake a pageId when it is not supposed to be returned (using the fetching Url, for example).", "author": "JianpingChen", "createdAt": "2020-09-15T18:41:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODMxODU0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTA5MTcwOQ==", "url": "https://github.com/Azure/azure-sdk-for-android/pull/340#discussion_r489091709", "bodyText": "If the cache is a HashMap then null is a valid key. not sure if this is like an anti-pattern, though. I'll read a bit on that.", "author": "vcolin7", "createdAt": "2020-09-16T00:29:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODMxODU0NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODMxOTE2Nw==", "url": "https://github.com/Azure/azure-sdk-for-android/pull/340#discussion_r488319167", "bodyText": "Fix annotation", "author": "JianpingChen", "createdAt": "2020-09-15T00:57:43Z", "path": "sdk/storage/azure-storage-blob/src/main/java/com/azure/android/storage/blob/models/ListBlobFlatSegmentHeaders.java", "diffHunk": "@@ -13,7 +13,7 @@\n  * Defines headers for ListBlobFlatSegment operation.\n  */\n @JacksonXmlRootElement(localName = \"Container-ListBlobFlatSegment-Headers\")", "originalCommit": "9cabfcc693712c238fbb8852b4921581246a3857", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODM1MDUxNQ==", "url": "https://github.com/Azure/azure-sdk-for-android/pull/340#discussion_r488350515", "bodyText": "Container-ListBlobFlatSegment-Headers is the right root element name for wire data though the type name is simplified, or did I miss anything?", "author": "anuchandy", "createdAt": "2020-09-15T02:49:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODMxOTE2Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODMxMzY2Mg==", "url": "https://github.com/Azure/azure-sdk-for-android/pull/340#discussion_r488313662", "bodyText": "nit\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * @param response  The response, if available for the failure.\n          \n          \n            \n                 * @param response  The response for the failure, if available.", "author": "vcolin7", "createdAt": "2020-09-15T00:38:42Z", "path": "sdk/core/azure-core/src/main/java/com/azure/android/core/http/Callback.java", "diffHunk": "@@ -12,14 +12,16 @@\n     /**\n      * The method to call on a successful result.\n      *\n+     * @param result   The result.\n      * @param response The response.\n      */\n-    void onResponse(T response);\n+    void onSuccess(T result, okhttp3.Response response);\n \n     /**\n      * The method to call on failure.\n      *\n-     * @param t A throwable with the failure details.\n+     * @param throwable A throwable with the failure details.\n+     * @param response  The response, if available for the failure.", "originalCommit": "9cabfcc693712c238fbb8852b4921581246a3857", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODMxMzkyOQ==", "url": "https://github.com/Azure/azure-sdk-for-android/pull/340#discussion_r488313929", "bodyText": "nit\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * @param response  The response, if available for the failure.\n          \n          \n            \n                 * @param response  The response for the failure, if available.", "author": "vcolin7", "createdAt": "2020-09-15T00:39:38Z", "path": "sdk/core/azure-core/src/main/java/com/azure/android/core/http/CallbackWithHeader.java", "diffHunk": "@@ -0,0 +1,29 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.android.core.http;\n+\n+/**\n+ * Callback to receive a service operation result.\n+ *\n+ * @param <T> The type of the result.\n+ * @param <T> The type of the header.\n+ */\n+public interface CallbackWithHeader<T, H> {\n+    /**\n+     * The method to call on a successful result.\n+     *\n+     * @param result   The result.\n+     * @param header   The custom header value.\n+     * @param response The response.\n+     */\n+    void onSuccess(T result, H header, okhttp3.Response response);\n+\n+    /**\n+     * The method to call on failure.\n+     *\n+     * @param throwable A throwable with the failure details.\n+     * @param response  The response, if available for the failure.", "originalCommit": "9cabfcc693712c238fbb8852b4921581246a3857", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODMxOTc2MA==", "url": "https://github.com/Azure/azure-sdk-for-android/pull/340#discussion_r488319760", "bodyText": "Maybe this is a little outside of the scope of this PR but I was thinking it might make more sense to name this operation listBlobs()?", "author": "vcolin7", "createdAt": "2020-09-15T00:59:43Z", "path": "sdk/storage/azure-storage-blob/src/main/java/com/azure/android/storage/blob/StorageBlobAsyncClient.java", "diffHunk": "@@ -244,11 +248,24 @@ public void cancel(Context context, long transferId) {\n     public void getBlobsInPage(String pageId,\n                                String containerName,\n                                ListBlobsOptions options,\n-                               Callback<List<BlobItem>> callback) {\n-        this.storageBlobServiceClient.getBlobsInPage(pageId,\n+                               Callback<BlobsPage> callback) {", "originalCommit": "9cabfcc693712c238fbb8852b4921581246a3857", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODMxOTg1Mg==", "url": "https://github.com/Azure/azure-sdk-for-android/pull/340#discussion_r488319852", "bodyText": "Same comment about naming this listBlobs()?", "author": "vcolin7", "createdAt": "2020-09-15T01:00:01Z", "path": "sdk/storage/azure-storage-blob/src/main/java/com/azure/android/storage/blob/StorageBlobAsyncClient.java", "diffHunk": "@@ -266,24 +283,37 @@ public void getBlobsInPage(String pageId,\n      * @param callback          Callback that receives the response.\n      * @param cancellationToken The token to request cancellation.\n      */\n-    public void getBlobsInPageWithRestResponse(String pageId,\n-                                               String containerName,\n-                                               String prefix,\n-                                               Integer maxResults,\n-                                               List<ListBlobsIncludeItem> include,\n-                                               Integer timeout,\n-                                               String requestId,\n-                                               CancellationToken cancellationToken,\n-                                               Callback<ContainersListBlobFlatSegmentResponse> callback) {\n-        this.storageBlobServiceClient.getBlobsInPageWithRestResponse(pageId,\n+    public void getBlobsInPage(String pageId,", "originalCommit": "9cabfcc693712c238fbb8852b4921581246a3857", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODMyMDEzOA==", "url": "https://github.com/Azure/azure-sdk-for-android/pull/340#discussion_r488320138", "bodyText": "I think list operations should use plurals.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    this.storageBlobServiceClient.listBlobFlatSegment(pageId,\n          \n          \n            \n                    this.storageBlobServiceClient.listBlobFlatSegments(pageId,", "author": "vcolin7", "createdAt": "2020-09-15T01:01:11Z", "path": "sdk/storage/azure-storage-blob/src/main/java/com/azure/android/storage/blob/StorageBlobAsyncClient.java", "diffHunk": "@@ -266,24 +283,37 @@ public void getBlobsInPage(String pageId,\n      * @param callback          Callback that receives the response.\n      * @param cancellationToken The token to request cancellation.\n      */\n-    public void getBlobsInPageWithRestResponse(String pageId,\n-                                               String containerName,\n-                                               String prefix,\n-                                               Integer maxResults,\n-                                               List<ListBlobsIncludeItem> include,\n-                                               Integer timeout,\n-                                               String requestId,\n-                                               CancellationToken cancellationToken,\n-                                               Callback<ContainersListBlobFlatSegmentResponse> callback) {\n-        this.storageBlobServiceClient.getBlobsInPageWithRestResponse(pageId,\n+    public void getBlobsInPage(String pageId,\n+                               String containerName,\n+                               String prefix,\n+                               Integer maxResults,\n+                               List<ListBlobsIncludeItem> include,\n+                               Integer timeout,\n+                               String requestId,\n+                               CancellationToken cancellationToken,\n+                               Callback<BlobsPage> callback) {\n+        this.storageBlobServiceClient.listBlobFlatSegment(pageId,", "originalCommit": "9cabfcc693712c238fbb8852b4921581246a3857", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODMyMDUzOQ==", "url": "https://github.com/Azure/azure-sdk-for-android/pull/340#discussion_r488320539", "bodyText": "Is it ListBlobsFlatSegment, ListBlobFlatSegments or ListBlobFlatSegment?", "author": "vcolin7", "createdAt": "2020-09-15T01:02:28Z", "path": "sdk/storage/azure-storage-blob/src/main/java/com/azure/android/storage/blob/StorageBlobAsyncClient.java", "diffHunk": "@@ -266,24 +283,37 @@ public void getBlobsInPage(String pageId,\n      * @param callback          Callback that receives the response.\n      * @param cancellationToken The token to request cancellation.\n      */\n-    public void getBlobsInPageWithRestResponse(String pageId,\n-                                               String containerName,\n-                                               String prefix,\n-                                               Integer maxResults,\n-                                               List<ListBlobsIncludeItem> include,\n-                                               Integer timeout,\n-                                               String requestId,\n-                                               CancellationToken cancellationToken,\n-                                               Callback<ContainersListBlobFlatSegmentResponse> callback) {\n-        this.storageBlobServiceClient.getBlobsInPageWithRestResponse(pageId,\n+    public void getBlobsInPage(String pageId,\n+                               String containerName,\n+                               String prefix,\n+                               Integer maxResults,\n+                               List<ListBlobsIncludeItem> include,\n+                               Integer timeout,\n+                               String requestId,\n+                               CancellationToken cancellationToken,\n+                               Callback<BlobsPage> callback) {\n+        this.storageBlobServiceClient.listBlobFlatSegment(pageId,\n             containerName,\n             prefix,\n             maxResults,\n             include,\n             timeout,\n             requestId,\n             cancellationToken,\n-            callback);\n+            new CallbackWithHeader<ListBlobsFlatSegmentResponse, ListBlobFlatSegmentHeaders>() {", "originalCommit": "9cabfcc693712c238fbb8852b4921581246a3857", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODMyMTkwNg==", "url": "https://github.com/Azure/azure-sdk-for-android/pull/340#discussion_r488321906", "bodyText": "nit: To avoid code duplication we can have this method define the callback and call the overload that includes all optional arguments (the one below).", "author": "vcolin7", "createdAt": "2020-09-15T01:07:13Z", "path": "sdk/storage/azure-storage-blob/src/main/java/com/azure/android/storage/blob/StorageBlobAsyncClient.java", "diffHunk": "@@ -244,11 +248,24 @@ public void cancel(Context context, long transferId) {\n     public void getBlobsInPage(String pageId,\n                                String containerName,\n                                ListBlobsOptions options,\n-                               Callback<List<BlobItem>> callback) {\n-        this.storageBlobServiceClient.getBlobsInPage(pageId,\n+                               Callback<BlobsPage> callback) {\n+        this.storageBlobServiceClient.listBlobFlatSegment(pageId,\n             containerName,\n             options,\n-            callback);\n+            new CallbackWithHeader<ListBlobsFlatSegmentResponse, ListBlobFlatSegmentHeaders>() {", "originalCommit": "9cabfcc693712c238fbb8852b4921581246a3857", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODMyMzU4MQ==", "url": "https://github.com/Azure/azure-sdk-for-android/pull/340#discussion_r488323581", "bodyText": "This can either be listBlobs() or the following:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    this.storageBlobServiceClient.listBlobFlatSegment(pageId,\n          \n          \n            \n                    this.storageBlobServiceClient.listBlobFlatSegments(pageId,", "author": "vcolin7", "createdAt": "2020-09-15T01:13:49Z", "path": "sdk/storage/azure-storage-blob/src/main/java/com/azure/android/storage/blob/StorageBlobAsyncClient.java", "diffHunk": "@@ -244,11 +248,24 @@ public void cancel(Context context, long transferId) {\n     public void getBlobsInPage(String pageId,\n                                String containerName,\n                                ListBlobsOptions options,\n-                               Callback<List<BlobItem>> callback) {\n-        this.storageBlobServiceClient.getBlobsInPage(pageId,\n+                               Callback<BlobsPage> callback) {\n+        this.storageBlobServiceClient.listBlobFlatSegment(pageId,", "originalCommit": "9cabfcc693712c238fbb8852b4921581246a3857", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODMyMzczNg==", "url": "https://github.com/Azure/azure-sdk-for-android/pull/340#discussion_r488323736", "bodyText": "Do we need to name this rawDownload() if there is no other form of download in the impl client?", "author": "vcolin7", "createdAt": "2020-09-15T01:14:25Z", "path": "sdk/storage/azure-storage-blob/src/main/java/com/azure/android/storage/blob/StorageBlobAsyncClient.java", "diffHunk": "@@ -398,23 +428,23 @@ public void rawDownload(String containerName,\n      * @param cancellationToken     The token to request cancellation.\n      * @param callback              Callback that receives the response.\n      */\n-    public void rawDownloadWithRestResponse(String containerName,\n-                                            String blobName,\n-                                            String snapshot,\n-                                            Integer timeout,\n-                                            BlobRange range,\n-                                            BlobRequestConditions blobRequestConditions,\n-                                            Boolean getRangeContentMd5,\n-                                            Boolean getRangeContentCrc64,\n-                                            String version,\n-                                            String requestId,\n-                                            CpkInfo cpkInfo,\n-                                            CancellationToken cancellationToken,\n-                                            Callback<BlobDownloadResponse> callback) {\n+    public void rawDownload(String containerName,\n+                            String blobName,\n+                            String snapshot,\n+                            Integer timeout,\n+                            BlobRange range,\n+                            BlobRequestConditions blobRequestConditions,\n+                            Boolean getRangeContentMd5,\n+                            Boolean getRangeContentCrc64,\n+                            String version,\n+                            String requestId,\n+                            CpkInfo cpkInfo,\n+                            CancellationToken cancellationToken,\n+                            CallbackWithHeader<ResponseBody, BlobDownloadHeaders> callback) {\n         range = range == null ? new BlobRange(0) : range;\n         blobRequestConditions = blobRequestConditions == null ? new BlobRequestConditions() : blobRequestConditions;\n \n-        storageBlobServiceClient.downloadWithRestResponse(containerName,\n+        storageBlobServiceClient.rawDownload(containerName,", "originalCommit": "9cabfcc693712c238fbb8852b4921581246a3857", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODMyNjI2MA==", "url": "https://github.com/Azure/azure-sdk-for-android/pull/340#discussion_r488326260", "bodyText": "The same comments about naming from the async client apply to this client.", "author": "vcolin7", "createdAt": "2020-09-15T01:23:32Z", "path": "sdk/storage/azure-storage-blob/src/main/java/com/azure/android/storage/blob/StorageBlobClient.java", "diffHunk": "@@ -6,6 +6,7 @@\n import android.content.Context;", "originalCommit": "9cabfcc693712c238fbb8852b4921581246a3857", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg3MTgxMg==", "url": "https://github.com/Azure/azure-sdk-for-android/pull/340#discussion_r488871812", "bodyText": "nit\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public List<BlobItem>  getItems() {\n          \n          \n            \n                public List<BlobItem> getItems() {", "author": "vcolin7", "createdAt": "2020-09-15T18:19:19Z", "path": "sdk/storage/azure-storage-blob/src/main/java/com/azure/android/storage/blob/models/BlobsPage.java", "diffHunk": "@@ -0,0 +1,28 @@\n+package com.azure.android.storage.blob.models;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+public class BlobsPage {\n+    private final List<BlobItem> items;\n+    private final String pageId;\n+    private final String nextPageId;\n+\n+    public BlobsPage(List<BlobItem> items, String pageId, String nextPageId) {\n+        this.items = items == null ? new ArrayList<>() : items;\n+        this.pageId = pageId;\n+        this.nextPageId = nextPageId;\n+    }\n+\n+    public List<BlobItem>  getItems() {", "originalCommit": "9cabfcc693712c238fbb8852b4921581246a3857", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg3MjYxOA==", "url": "https://github.com/Azure/azure-sdk-for-android/pull/340#discussion_r488872618", "bodyText": "Naming: Is this going to be ListBlobFlatSegmentHeaders, ListBlobFlatSegmentsHeaders or ListBlobsHeaders?", "author": "vcolin7", "createdAt": "2020-09-15T18:20:47Z", "path": "sdk/storage/azure-storage-blob/src/main/java/com/azure/android/storage/blob/models/ListBlobFlatSegmentHeaders.java", "diffHunk": "@@ -13,7 +13,7 @@\n  * Defines headers for ListBlobFlatSegment operation.\n  */\n @JacksonXmlRootElement(localName = \"Container-ListBlobFlatSegment-Headers\")\n-public final class ContainerListBlobFlatSegmentHeaders {\n+public final class ListBlobFlatSegmentHeaders {", "originalCommit": "9cabfcc693712c238fbb8852b4921581246a3857", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg4NDMxOA==", "url": "https://github.com/Azure/azure-sdk-for-android/pull/340#discussion_r488884318", "bodyText": "ideally, the name should be coming from swagger, we can always change the name through README transformations, lets do that as part of releasing storage, and ensure consistent with iOS.", "author": "anuchandy", "createdAt": "2020-09-15T18:42:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg3MjYxOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg3MzU4MQ==", "url": "https://github.com/Azure/azure-sdk-for-android/pull/340#discussion_r488873581", "bodyText": "nit: I don't think we need to have a new line here.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    assertNotEquals(0, blobsPage.getItems()\n          \n          \n            \n                        .size());\n          \n          \n            \n                    assertNotEquals(0, blobsPage.getItems().size());", "author": "vcolin7", "createdAt": "2020-09-15T18:22:40Z", "path": "sdk/storage/azure-storage-blob/src/test/java/com/azure/android/storage/blob/StorageBlobClientTest.java", "diffHunk": "@@ -85,14 +90,15 @@ public void getBlobsInPage() {\n \n         mockWebServer.enqueue(mockResponse);\n \n-        List<BlobItem> blobItems = storageBlobClient.getBlobsInPage(null,\n+        BlobsPage blobsPage = storageBlobClient.getBlobsInPage(null,\n             \"testContainer\",\n             null);\n \n         // Then a list containing the details of the blobs will be returned by the service and converted to BlobItem\n         // objects by the client.\n-        assertNotEquals(0, blobItems.size());\n-        assertEquals(\"test.jpg\", blobItems.get(0).getName());\n+        assertNotEquals(0, blobsPage.getItems()\n+            .size());", "originalCommit": "9cabfcc693712c238fbb8852b4921581246a3857", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg3NDQwMA==", "url": "https://github.com/Azure/azure-sdk-for-android/pull/340#discussion_r488874400", "bodyText": "listBlobs maybe?", "author": "vcolin7", "createdAt": "2020-09-15T18:24:07Z", "path": "sdk/storage/azure-storage-blob/src/main/java/com/azure/android/storage/blob/StorageBlobServiceImpl.java", "diffHunk": "@@ -75,12 +73,12 @@\n         this.serializerAdapter = serviceClient.getSerializerAdapter();\n     }\n \n-    List<BlobItem> getBlobsInPage(String pageId,\n-                                  String containerName,\n-                                  ListBlobsOptions options) {\n+    ListBlobsFlatSegmentResponse listBlobFlatSegment(String pageId,", "originalCommit": "9cabfcc693712c238fbb8852b4921581246a3857", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg4MzIwMQ==", "url": "https://github.com/Azure/azure-sdk-for-android/pull/340#discussion_r488883201", "bodyText": "it's protocol layer (hidden from user) and is how named in swagger, we can revisit this once azure-core is released, storage we have more time to clean up.", "author": "anuchandy", "createdAt": "2020-09-15T18:40:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg3NDQwMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg3NTU2OA==", "url": "https://github.com/Azure/azure-sdk-for-android/pull/340#discussion_r488875568", "bodyText": "If there's no other type of download, do we really need to name this rawDownload()?", "author": "vcolin7", "createdAt": "2020-09-15T18:26:07Z", "path": "sdk/storage/azure-storage-blob/src/main/java/com/azure/android/storage/blob/StorageBlobServiceImpl.java", "diffHunk": "@@ -445,23 +407,23 @@ BlobDownloadResponse downloadWithRestResponse(String containerName,\n      * @param cpkInfo              Additional parameters for the operation.\n      * @param callback             Callback that receives the response.\n      */\n-    void downloadWithRestResponse(String containerName,\n-                                  String blobName,\n-                                  String snapshot,\n-                                  Integer timeout,\n-                                  String range,\n-                                  String leaseId,\n-                                  Boolean rangeGetContentMD5,\n-                                  Boolean rangeGetContentCRC64,\n-                                  OffsetDateTime ifModifiedSince,\n-                                  OffsetDateTime ifUnmodifiedSince,\n-                                  String ifMatch,\n-                                  String ifNoneMatch,\n-                                  String version,\n-                                  String requestId,\n-                                  CpkInfo cpkInfo,\n-                                  CancellationToken cancellationToken,\n-                                  Callback<BlobDownloadResponse> callback) {\n+    void rawDownload(String containerName,", "originalCommit": "9cabfcc693712c238fbb8852b4921581246a3857", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg4MjA1Ng==", "url": "https://github.com/Azure/azure-sdk-for-android/pull/340#discussion_r488882056", "bodyText": "yes, this is what we agreed across iOS and android, rawDownload for the protocol layer and download for the managed download.", "author": "anuchandy", "createdAt": "2020-09-15T18:38:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg3NTU2OA=="}], "type": "inlineReview"}, {"oid": "6706d3bbb99e9271d605d78c2aa475f6d27993c2", "url": "https://github.com/Azure/azure-sdk-for-android/commit/6706d3bbb99e9271d605d78c2aa475f6d27993c2", "message": "applying azure-core suggestions\n\nCo-authored-by: vcolin7 <vicolina@microsoft.com>", "committedDate": "2020-09-15T18:47:12Z", "type": "commit"}]}