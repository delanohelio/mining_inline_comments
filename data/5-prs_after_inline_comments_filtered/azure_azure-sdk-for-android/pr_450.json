{"pr_number": 450, "pr_title": "Added options bags to storage container APIs", "pr_createdAt": "2020-11-09T18:32:44Z", "pr_url": "https://github.com/Azure/azure-sdk-for-android/pull/450", "timeline": [{"oid": "5fb989e7d98261cdcd9829df77f8a3008e367f83", "url": "https://github.com/Azure/azure-sdk-for-android/commit/5fb989e7d98261cdcd9829df77f8a3008e367f83", "message": "Added options bags for container create", "committedDate": "2020-11-09T18:30:11Z", "type": "commit"}, {"oid": "4567f66606cf8c4d072f7efe1fa0eaf46e495939", "url": "https://github.com/Azure/azure-sdk-for-android/commit/4567f66606cf8c4d072f7efe1fa0eaf46e495939", "message": "Container create options bags", "committedDate": "2020-11-09T18:32:08Z", "type": "commit"}, {"oid": "c3aac974ea32530b7d4944af846532ebc661a553", "url": "https://github.com/Azure/azure-sdk-for-android/commit/c3aac974ea32530b7d4944af846532ebc661a553", "message": "Added some checks", "committedDate": "2020-11-09T18:50:05Z", "type": "commit"}, {"oid": "d43772fcb33d47f8730786514137ca6854a490e0", "url": "https://github.com/Azure/azure-sdk-for-android/commit/d43772fcb33d47f8730786514137ca6854a490e0", "message": "Added docs", "committedDate": "2020-11-09T19:18:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDA5MjEyNQ==", "url": "https://github.com/Azure/azure-sdk-for-android/pull/450#discussion_r520092125", "bodyText": "probably its wip, but just want to point Javadoc is in-complete for ctr, getters and setters", "author": "anuchandy", "createdAt": "2020-11-09T20:13:57Z", "path": "sdk/storage/azure-storage-blob/src/main/java/com/azure/android/storage/blob/options/ContainerCreateOptions.java", "diffHunk": "@@ -0,0 +1,115 @@\n+package com.azure.android.storage.blob.options;\n+\n+import androidx.annotation.NonNull;\n+import androidx.annotation.Nullable;\n+\n+import com.azure.android.core.annotation.Fluent;\n+import com.azure.android.core.util.CancellationToken;\n+import com.azure.android.storage.blob.models.PublicAccessType;\n+\n+import java.util.Map;\n+import java.util.Objects;\n+\n+/**\n+ * Extended options that may be passed when creating a container.\n+ */\n+@Fluent\n+public class ContainerCreateOptions {\n+\n+    private final String containerName;\n+    private Map<String, String> metadata;\n+    private PublicAccessType publicAccessType;\n+    private Integer timeout;\n+    private CancellationToken cancellationToken;\n+\n+    /**\n+     * @param containerName The container name.\n+     */\n+    public ContainerCreateOptions(@NonNull String containerName) {\n+        Objects.requireNonNull(containerName);\n+        this.containerName  = containerName;\n+    }\n+", "originalCommit": "d43772fcb33d47f8730786514137ca6854a490e0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDExMTYxOQ==", "url": "https://github.com/Azure/azure-sdk-for-android/pull/450#discussion_r520111619", "bodyText": "Not sure if you commented this before or after I added some docs. Do you want me to add more detail than exists now? This docs are basically copy pasted from the Java SDK", "author": "gapra-msft", "createdAt": "2020-11-09T20:50:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDA5MjEyNQ=="}], "type": "inlineReview"}, {"oid": "7d64c9617e05eaae8f805295208b1e9e6018e002", "url": "https://github.com/Azure/azure-sdk-for-android/commit/7d64c9617e05eaae8f805295208b1e9e6018e002", "message": "Added get Container properties and delete container options bags", "committedDate": "2020-11-09T22:46:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDE4MzkxMw==", "url": "https://github.com/Azure/azure-sdk-for-android/pull/450#discussion_r520183913", "bodyText": "is Void technically non-null? I'm not sure", "author": "gapra-msft", "createdAt": "2020-11-09T23:21:26Z", "path": "sdk/storage/azure-storage-blob/src/main/java/com/azure/android/storage/blob/StorageBlobClient.java", "diffHunk": "@@ -91,38 +95,85 @@ public String getBlobServiceUrl() {\n     /**\n      * Creates a new container within a storage account. If a container with the same name already exists, the operation\n      * fails.\n+     * For more information, see the <a href=\"https://docs.microsoft.com/rest/api/storageservices/create-container\">Azure Docs</a>.\n      *\n      * @param containerName The container name.\n      */\n-    public Void createContainer(String containerName) {\n-        return storageBlobServiceClient.createContainer(containerName);\n+    @NonNull", "originalCommit": "7d64c9617e05eaae8f805295208b1e9e6018e002", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDg0NDQzOQ==", "url": "https://github.com/Azure/azure-sdk-for-android/pull/450#discussion_r520844439", "bodyText": "I'm pretty sure the only value a Void variable can have is null, so I wouldn't consider annotating it with @NonNull.", "author": "vcolin7", "createdAt": "2020-11-10T20:10:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDE4MzkxMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDE4NDEzMQ==", "url": "https://github.com/Azure/azure-sdk-for-android/pull/450#discussion_r520184131", "bodyText": "Should we check that only lease id is set here?", "author": "gapra-msft", "createdAt": "2020-11-09T23:22:03Z", "path": "sdk/storage/azure-storage-blob/src/main/java/com/azure/android/storage/blob/StorageBlobClient.java", "diffHunk": "@@ -91,38 +95,85 @@ public String getBlobServiceUrl() {\n     /**\n      * Creates a new container within a storage account. If a container with the same name already exists, the operation\n      * fails.\n+     * For more information, see the <a href=\"https://docs.microsoft.com/rest/api/storageservices/create-container\">Azure Docs</a>.\n      *\n      * @param containerName The container name.\n      */\n-    public Void createContainer(String containerName) {\n-        return storageBlobServiceClient.createContainer(containerName);\n+    @NonNull\n+    public Void createContainer(@NonNull String containerName) {\n+        return this.createContainerWithResponse(new ContainerCreateOptions(containerName)).getValue();\n     }\n \n     /**\n      * Creates a new container within a storage account. If a container with the same name already exists, the operation\n      * fails.\n+     * For more information, see the <a href=\"https://docs.microsoft.com/rest/api/storageservices/create-container\">Azure Docs</a>.\n      *\n-     * @param containerName     The container name.\n-     * @param timeout           The timeout parameter is expressed in seconds. For more information, see\n-     *                          &lt;a href=\"https://docs.microsoft.com/en-us/rest/api/storageservices/setting-timeouts-for-blob-service-operations\"&gt;Setting Timeouts for Blob Service Operations.&lt;/a&gt;.\n-     * @param metadata          Metadata to associate with the container.\n-     * @param publicAccessType  Specifies how the data in this container is available to the public. See the\n-     *                          x-ms-blob-public-access header in the Azure Docs for more information. Pass null\n-     *                          for no public access.\n-     * @param cancellationToken The token to request cancellation.\n+     * @param options {@link ContainerCreateOptions}\n      * @return The response information returned from the server when creating a container.\n      */\n-    public ContainerCreateResponse createContainerWithRestResponse(String containerName,\n-                                                                   Integer timeout,\n-                                                                   Map<String, String> metadata,\n-                                                                   PublicAccessType publicAccessType,\n-                                                                   CancellationToken cancellationToken) {\n+    @NonNull\n+    public ContainerCreateResponse createContainerWithResponse(@NonNull ContainerCreateOptions options) {\n+        Objects.requireNonNull(options);\n+        return storageBlobServiceClient.createContainerWithRestResponse(options.getContainerName(),\n+            options.getTimeout(), options.getMetadata(), options.getPublicAccessType(), options.getCancellationToken());\n+    }\n \n-        return storageBlobServiceClient.createContainerWithRestResponse(containerName,\n-            timeout,\n-            metadata,\n-            publicAccessType,\n-            cancellationToken);\n+    /**\n+     * Marks the specified container for deletion. The container and any blobs contained within it are later deleted\n+     * during garbage collection. For more information, see the\n+     * <a href=\"https://docs.microsoft.com/rest/api/storageservices/delete-container\">Azure Docs</a>.\n+     *\n+     * @param containerName The container name.\n+     */\n+    @NonNull\n+    public Void deleteContainer(@NonNull String containerName) {\n+        return this.deleteContainerWithResponse(new ContainerDeleteOptions(containerName)).getValue();\n+    }\n+\n+    /**\n+     * Marks the specified container for deletion. The container and any blobs contained within it are later deleted\n+     * during garbage collection. For more information, see the\n+     * <a href=\"https://docs.microsoft.com/rest/api/storageservices/delete-container\">Azure Docs</a>.\n+     *\n+     * @param options {@link ContainerDeleteOptions}\n+     * @return The response information returned from the server when deleting a container.\n+     */\n+    @NonNull\n+    public ContainerDeleteResponse deleteContainerWithResponse(@NonNull ContainerDeleteOptions options) {\n+        Objects.requireNonNull(options);\n+        return storageBlobServiceClient.deleteContainerWithRestResponse(options.getContainerName(),\n+            options.getTimeout(), options.getRequestConditions(), options.getCancellationToken());\n+    }\n+\n+    /**\n+     * Returns the container's metadata and system properties. For more information, see the\n+     * <a href=\"https://docs.microsoft.com/rest/api/storageservices/get-container-metadata\">Azure Docs</a>.\n+     *\n+     * @param containerName The container name.\n+     * @return The container's properties.\n+     */\n+    /* TODO: (gapra) This should probably return a handwrapped type? */\n+    @NonNull\n+    public ContainerGetPropertiesHeaders getContainerProperties(@NonNull String containerName) {\n+        return this.getContainerPropertiesWithResponse(new ContainerGetPropertiesOptions(containerName)).getDeserializedHeaders();\n+    }\n+\n+    /**\n+     * Returns the container's metadata and system properties. For more information, see the\n+     * <a href=\"https://docs.microsoft.com/rest/api/storageservices/get-container-metadata\">Azure Docs</a>.\n+     *\n+     * @param options {@link ContainerGetPropertiesOptions}\n+     * @return The response information returned from the server when getting a container's properties.\n+     */\n+    @NonNull\n+    public ContainerGetPropertiesResponse getContainerPropertiesWithResponse(@NonNull ContainerGetPropertiesOptions options) {\n+        Objects.requireNonNull(options);\n+        BlobRequestConditions requestConditions = options.getRequestConditions() == null ? new BlobRequestConditions()", "originalCommit": "7d64c9617e05eaae8f805295208b1e9e6018e002", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDE4NDI3OA==", "url": "https://github.com/Azure/azure-sdk-for-android/pull/450#discussion_r520184278", "bodyText": "Related: I think the param validation should move from the impl class to this one", "author": "gapra-msft", "createdAt": "2020-11-09T23:22:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDE4NDEzMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDg0OTUzNw==", "url": "https://github.com/Azure/azure-sdk-for-android/pull/450#discussion_r520849537", "bodyText": "I don't think it matters that much if the required parameter validation happens here or in Impl, but the latter would mean we don't have to duplicate code I guess. Is there a particular reason you think that should be here? If we are thinking the Impl class is going to be auto-generated then it makes sense to have validations outside of it.", "author": "vcolin7", "createdAt": "2020-11-10T20:20:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDE4NDEzMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDg1MTI2NA==", "url": "https://github.com/Azure/azure-sdk-for-android/pull/450#discussion_r520851264", "bodyText": "Question: is leaseId the only required parameter in the options bag? Is containerName a part of it as well?", "author": "vcolin7", "createdAt": "2020-11-10T20:23:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDE4NDEzMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDg1NDA2OQ==", "url": "https://github.com/Azure/azure-sdk-for-android/pull/450#discussion_r520854069", "bodyText": "lease Id is the only other service related optional param for this API.", "author": "gapra-msft", "createdAt": "2020-11-10T20:28:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDE4NDEzMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDg1NDMyMA==", "url": "https://github.com/Azure/azure-sdk-for-android/pull/450#discussion_r520854320", "bodyText": "Yeah, I think since it will eventually be generated, we should do param validation on the client", "author": "gapra-msft", "createdAt": "2020-11-10T20:29:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDE4NDEzMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDg2NjA2Mg==", "url": "https://github.com/Azure/azure-sdk-for-android/pull/450#discussion_r520866062", "bodyText": "If leaseId is required then I would add it to the options bag constructor and validate that its not null there instead of on the method in the client.", "author": "vcolin7", "createdAt": "2020-11-10T20:51:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDE4NDEzMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDg4MzE5Ng==", "url": "https://github.com/Azure/azure-sdk-for-android/pull/450#discussion_r520883196", "bodyText": "leaseId is optional. Sorry if I mis-communicated before.", "author": "gapra-msft", "createdAt": "2020-11-10T21:25:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDE4NDEzMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTI4NzMzMg==", "url": "https://github.com/Azure/azure-sdk-for-android/pull/450#discussion_r521287332", "bodyText": "No problem. Even if leaseId is the only other value the service expects, since its optional I don't think we should validate its contents.", "author": "vcolin7", "createdAt": "2020-11-11T11:16:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDE4NDEzMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTQ3OTE0Nw==", "url": "https://github.com/Azure/azure-sdk-for-android/pull/450#discussion_r521479147", "bodyText": "We're not validating it's contents, just making sure the RequestConditions object exists before we call requestConditions.getLeaseId", "author": "gapra-msft", "createdAt": "2020-11-11T16:28:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDE4NDEzMQ=="}], "type": "inlineReview"}, {"oid": "84c3a33bc66ef01ea281c04672e3c09204a0274c", "url": "https://github.com/Azure/azure-sdk-for-android/commit/84c3a33bc66ef01ea281c04672e3c09204a0274c", "message": "Updated some request conditions related code", "committedDate": "2020-11-10T22:05:32Z", "type": "commit"}, {"oid": "251898168da87fdeebed57440fd4a5d3f11e8be3", "url": "https://github.com/Azure/azure-sdk-for-android/commit/251898168da87fdeebed57440fd4a5d3f11e8be3", "message": "Removed comments on ignore", "committedDate": "2020-11-10T22:06:28Z", "type": "commit"}, {"oid": "6c083a67fe75bb601259386b97d2598cd25d3985", "url": "https://github.com/Azure/azure-sdk-for-android/commit/6c083a67fe75bb601259386b97d2598cd25d3985", "message": "Annotated as nullable", "committedDate": "2020-11-10T22:12:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzI2ODgzNw==", "url": "https://github.com/Azure/azure-sdk-for-android/pull/450#discussion_r523268837", "bodyText": "Why expand the options here rather than in the Intern method?", "author": "rickle-msft", "createdAt": "2020-11-13T22:36:47Z", "path": "sdk/storage/azure-storage-blob/src/main/java/com/azure/android/storage/blob/StorageBlobAsyncClient.java", "diffHunk": "@@ -259,43 +262,89 @@ public void cancel(Context context, long transferId) {\n     /**\n      * Creates a new container within a storage account. If a container with the same name already exists, the operation\n      * fails.\n+     * For more information, see the <a href=\"https://docs.microsoft.com/rest/api/storageservices/create-container\">Azure Docs</a>.\n      *\n      * @param containerName The container name.\n      * @param callback      Callback that receives the response.\n      */\n-    public void createContainer(String containerName,\n-                                CallbackWithHeader<Void, ContainerCreateHeaders> callback) {\n-        storageBlobServiceClient.createContainer(containerName, callback);\n+    public void createContainer(@NonNull String containerName,\n+                                @Nullable CallbackWithHeader<Void, ContainerCreateHeaders> callback) {\n+        this.createContainer(new ContainerCreateOptions(containerName), callback);\n     }\n \n     /**\n      * Creates a new container within a storage account. If a container with the same name already exists, the operation\n      * fails.\n+     * For more information, see the <a href=\"https://docs.microsoft.com/rest/api/storageservices/create-container\">Azure Docs</a>.\n      *\n-     * @param containerName     The container name.\n-     * @param timeout           The timeout parameter is expressed in seconds. For more information, see\n-     *                          &lt;a href=\"https://docs.microsoft.com/en-us/rest/api/storageservices/setting-timeouts-for-blob-service-operations\"&gt;Setting Timeouts for Blob Service Operations.&lt;/a&gt;.\n-     * @param metadata          Metadata to associate with the container.\n-     * @param publicAccessType  Specifies how the data in this container is available to the public. See the\n-     *                          x-ms-blob-public-access header in the Azure Docs for more information. Pass null\n-     *                          for no public access.\n-     * @param cancellationToken The token to request cancellation.\n-     * @param callback          Callback that receives the response.\n-     * @return The response information returned from the server when creating a container.\n+     * @param options {@link ContainerCreateOptions}\n+     * @param callback Callback that receives the response.\n      */\n-    public void createContainer(String containerName,\n-                                Integer timeout,\n-                                Map<String, String> metadata,\n-                                PublicAccessType publicAccessType,\n-                                CancellationToken cancellationToken,\n-                                CallbackWithHeader<Void, ContainerCreateHeaders> callback) {\n+    public void createContainer(@NonNull ContainerCreateOptions options,\n+                                @Nullable CallbackWithHeader<Void, ContainerCreateHeaders> callback) {\n+        Objects.requireNonNull(options);\n+        storageBlobServiceClient.createContainer(options.getContainerName(), options.getTimeout(),", "originalCommit": "6c083a67fe75bb601259386b97d2598cd25d3985", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzI3Mjk2Ng==", "url": "https://github.com/Azure/azure-sdk-for-android/pull/450#discussion_r523272966", "bodyText": "It's future proofing for when we generate code. The intern methods will eventually be generated so we probably want to do all this at the client level", "author": "gapra-msft", "createdAt": "2020-11-13T22:50:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzI2ODgzNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDY3NTE3Nw==", "url": "https://github.com/Azure/azure-sdk-for-android/pull/450#discussion_r524675177", "bodyText": "Is it a common pattern to name the options bags with ? I see we have other types like ListBlobsOptions so I'm not sure what's common in Java land.", "author": "vcolin7", "createdAt": "2020-11-16T22:23:20Z", "path": "sdk/storage/azure-storage-blob/src/main/java/com/azure/android/storage/blob/StorageBlobAsyncClient.java", "diffHunk": "@@ -44,14 +45,16 @@\n import com.azure.android.storage.blob.models.ContainerCreateHeaders;\n import com.azure.android.storage.blob.models.ContainerDeleteHeaders;\n import com.azure.android.storage.blob.models.ContainerGetPropertiesHeaders;\n-import com.azure.android.storage.blob.models.ListBlobFlatSegmentHeaders;\n import com.azure.android.storage.blob.models.CpkInfo;\n import com.azure.android.storage.blob.models.DeleteSnapshotsOptionType;\n+import com.azure.android.storage.blob.models.ListBlobFlatSegmentHeaders;\n import com.azure.android.storage.blob.models.ListBlobsFlatSegmentResponse;\n import com.azure.android.storage.blob.models.ListBlobsIncludeItem;\n import com.azure.android.storage.blob.models.ListBlobsOptions;\n import com.azure.android.storage.blob.models.RehydratePriority;\n-import com.azure.android.storage.blob.models.PublicAccessType;\n+import com.azure.android.storage.blob.options.ContainerCreateOptions;\n+import com.azure.android.storage.blob.options.ContainerDeleteOptions;\n+import com.azure.android.storage.blob.options.ContainerGetPropertiesOptions;", "originalCommit": "6c083a67fe75bb601259386b97d2598cd25d3985", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTMxNTEzMw==", "url": "https://github.com/Azure/azure-sdk-for-android/pull/450#discussion_r525315133", "bodyText": "Yeah theres a design guideline to name the options bag ClientTypeActionOptions", "author": "gapra-msft", "createdAt": "2020-11-17T16:46:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDY3NTE3Nw=="}], "type": "inlineReview"}]}