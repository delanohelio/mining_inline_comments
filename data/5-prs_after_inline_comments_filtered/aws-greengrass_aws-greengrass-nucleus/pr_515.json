{"pr_number": 515, "pr_title": "Add log manager helper to get logger for a component", "pr_createdAt": "2020-10-10T02:49:05Z", "pr_url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/515", "timeline": [{"oid": "1f6193bfd16b7af36da9dc749a85a31d0ddc4a80", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/1f6193bfd16b7af36da9dc749a85a31d0ddc4a80", "message": "Split out logs.", "committedDate": "2020-10-10T02:45:13Z", "type": "commit"}, {"oid": "99c37229161288e0f71db4394b394dad70c8a955", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/99c37229161288e0f71db4394b394dad70c8a955", "message": "Merge branch 'master' into splitOutLogs", "committedDate": "2020-10-10T02:50:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzM2MDU1MQ==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/515#discussion_r503360551", "bodyText": "should this be ~root/logs? or will the log config go into /logs by default?", "author": "MikeDombo", "createdAt": "2020-10-12T15:08:44Z", "path": "src/main/java/com/aws/greengrass/lifecyclemanager/KernelCommandLine.java", "diffHunk": "@@ -123,6 +124,7 @@ private void initPaths(String rootAbsolutePath) {\n             nucleusPaths.setRootPath(Paths.get(rootAbsolutePath).toAbsolutePath());\n             //set root path for the telemetry logger\n             TelemetryConfig.getInstance().setRoot(Paths.get(deTilde(ROOT_DIR_PREFIX)));\n+            LogConfig.getInstance().setRoot(Paths.get(deTilde(ROOT_DIR_PREFIX)));", "originalCommit": "99c37229161288e0f71db4394b394dad70c8a955", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzM3Mzg1OQ==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/515#discussion_r503373859", "bodyText": "The log config will go to /logs by default.", "author": "nikkhilmuthye", "createdAt": "2020-10-12T15:30:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzM2MDU1MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzM2MTMxOA==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/515#discussion_r503361318", "bodyText": "when we use the logger we are normally passing the class, so have an override for the class when naming the logger", "author": "MikeDombo", "createdAt": "2020-10-12T15:09:59Z", "path": "src/main/java/com/aws/greengrass/lifecyclemanager/LogManagerHelper.java", "diffHunk": "@@ -0,0 +1,42 @@\n+/*\n+ * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+\n+package com.aws.greengrass.lifecyclemanager;\n+\n+import com.aws.greengrass.logging.impl.LogManager;\n+import com.aws.greengrass.logging.impl.config.model.LoggerConfiguration;\n+\n+/**\n+ * Helper function to get a logger with configurations separate from the root logger.\n+ */\n+public class LogManagerHelper {\n+    private static final String LOG_FILE_EXTENSION = \".log\";\n+    private final Kernel kernel;\n+\n+    public LogManagerHelper(Kernel kernel) {\n+        this.kernel = kernel;\n+        // TODO: Subscribe to logging configuration in the kernel config and reconfigure all the loggers.\n+    }\n+\n+    /**\n+     * Get the logger for a particular component. The logs will be added to the a log file with the same name as the\n+     * component if the logs are configured to be written to the disk.\n+     * @param name  The name of the component\n+     * @return  a logger with configuration to log to a los file with the same name.\n+     */\n+    public com.aws.greengrass.logging.api.Logger getComponentLogger(String name) {\n+        return getComponentLogger(name, name + LOG_FILE_EXTENSION);\n+    }\n+    /**\n+     * Get the logger for a particular component. The logs will be added to the log file name provided in the method\n+     * signature if the logs are configured to be written to the disk.\n+     * @param name      The name of the component\n+     * @param fileName  The name of the log file.\n+     * @return a logger with configuration to log to a los file with the same name.\n+     */\n+    public com.aws.greengrass.logging.api.Logger getComponentLogger(String name, String fileName) {", "originalCommit": "99c37229161288e0f71db4394b394dad70c8a955", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzM2MjU5MA==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/515#discussion_r503362590", "bodyText": "also, don't we want an override that takes a GreengrassService? Shouldn't that be the whole point?", "author": "MikeDombo", "createdAt": "2020-10-12T15:12:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzM2MTMxOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzM3NTk2Ng==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/515#discussion_r503375966", "bodyText": "I was thinking that we would use the function in the UserLambdaService and set the logger there by using getComponentLogger(String name) function with the lambda name.", "author": "nikkhilmuthye", "createdAt": "2020-10-12T15:34:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzM2MTMxOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzM3NzgyMg==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/515#discussion_r503377822", "bodyText": "Ignore lambda. This applies to all services.\nI want this class to perform the subscription in order to reconfigure when logging configs change. So it should get the service instance so that it can then call getConfig() to get the service's config and subscribe to whatever logging topics we have", "author": "MikeDombo", "createdAt": "2020-10-12T15:37:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzM2MTMxOA=="}], "type": "inlineReview"}, {"oid": "734443b86f40ef314e91a20ccddd802c1517e9dc", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/734443b86f40ef314e91a20ccddd802c1517e9dc", "message": "Address PR comments.", "committedDate": "2020-10-12T16:00:01Z", "type": "commit"}, {"oid": "734443b86f40ef314e91a20ccddd802c1517e9dc", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/734443b86f40ef314e91a20ccddd802c1517e9dc", "message": "Address PR comments.", "committedDate": "2020-10-12T16:00:01Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzM5MTYyOQ==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/515#discussion_r503391629", "bodyText": "what's this about? The root doesn't have \"parameters\"", "author": "MikeDombo", "createdAt": "2020-10-12T16:00:45Z", "path": "src/main/java/com/aws/greengrass/lifecyclemanager/LogManagerHelper.java", "diffHunk": "@@ -0,0 +1,75 @@\n+/*\n+ * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+\n+package com.aws.greengrass.lifecyclemanager;\n+\n+import com.aws.greengrass.logging.impl.LogManager;\n+import com.aws.greengrass.logging.impl.config.model.LoggerConfiguration;\n+\n+import static com.aws.greengrass.componentmanager.KernelConfigResolver.PARAMETERS_CONFIG_KEY;\n+\n+/**\n+ * Helper function to get a logger with configurations separate from the root logger.\n+ */\n+public class LogManagerHelper {\n+    private static final String LOG_FILE_EXTENSION = \".log\";\n+    private static final String KERNEL_CONFIG_PARAMETER_TOPIC = \"rootLoggerConfig\";\n+    private static final String SERVICE_CONFIG_PARAMETER_TOPIC = \"ComponentLoggerConfig\";\n+    private final Kernel kernel;\n+\n+    public LogManagerHelper(Kernel kernel) {\n+        this.kernel = kernel;\n+        this.kernel.getConfig().lookup(PARAMETERS_CONFIG_KEY, KERNEL_CONFIG_PARAMETER_TOPIC)", "originalCommit": "734443b86f40ef314e91a20ccddd802c1517e9dc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzM5Njk0MQ==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/515#discussion_r503396941", "bodyText": "I think this PR will add parameters in the kernel config https://github.com/aws/aws-greengrass-kernel/pull/513/files\nThis is where we will add the root logger config.", "author": "nikkhilmuthye", "createdAt": "2020-10-12T16:10:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzM5MTYyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzM5ODEyMQ==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/515#discussion_r503398121", "bodyText": "In that case, your lookup here is wrong because this is looking under the config root instead of under the nucleus as a service's topics.", "author": "MikeDombo", "createdAt": "2020-10-12T16:12:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzM5MTYyOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzM5MjM1Mg==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/515#discussion_r503392352", "bodyText": "let's remove the interfaces that we won't be using. I suggest that we use only\ngetComponentLogger(Class<?> clazz, GreengrassService service)\nwhich will do make a logger with name clazz.getName() and filename service.getServiceName()", "author": "MikeDombo", "createdAt": "2020-10-12T16:01:57Z", "path": "src/main/java/com/aws/greengrass/lifecyclemanager/LogManagerHelper.java", "diffHunk": "@@ -0,0 +1,75 @@\n+/*\n+ * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+\n+package com.aws.greengrass.lifecyclemanager;\n+\n+import com.aws.greengrass.logging.impl.LogManager;\n+import com.aws.greengrass.logging.impl.config.model.LoggerConfiguration;\n+\n+import static com.aws.greengrass.componentmanager.KernelConfigResolver.PARAMETERS_CONFIG_KEY;\n+\n+/**\n+ * Helper function to get a logger with configurations separate from the root logger.\n+ */\n+public class LogManagerHelper {\n+    private static final String LOG_FILE_EXTENSION = \".log\";\n+    private static final String KERNEL_CONFIG_PARAMETER_TOPIC = \"rootLoggerConfig\";\n+    private static final String SERVICE_CONFIG_PARAMETER_TOPIC = \"ComponentLoggerConfig\";\n+    private final Kernel kernel;\n+\n+    public LogManagerHelper(Kernel kernel) {\n+        this.kernel = kernel;\n+        this.kernel.getConfig().lookup(PARAMETERS_CONFIG_KEY, KERNEL_CONFIG_PARAMETER_TOPIC)\n+                .subscribe((why, newv) -> {\n+                    // TODO: Subscribe to logging configuration in the kernel config and reconfigure all the loggers.\n+                });\n+    }\n+\n+    /**\n+     * Get the logger for a particular component. The logs will be added to the a log file with the same name as the\n+     * component if the logs are configured to be written to the disk.\n+     * @param name  The name of the component\n+     * @return  a logger with configuration to log to a los file with the same name.\n+     */\n+    public com.aws.greengrass.logging.api.Logger getComponentLogger(String name) {", "originalCommit": "734443b86f40ef314e91a20ccddd802c1517e9dc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzM5NDk2OQ==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/515#discussion_r503394969", "bodyText": "I think the logger name should be service.getServiceName() cause we need it to be unique for different services. We cache the logger based on their names. But will remove the other functions.", "author": "nikkhilmuthye", "createdAt": "2020-10-12T16:06:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzM5MjM1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzM5NjAwOA==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/515#discussion_r503396008", "bodyText": "Hmm, the logger name is typically the class name, but I suppose you're right. So just have getComponentLogger(GreengrassService service) which creates a logger with getServiceName as the logger and file name.", "author": "MikeDombo", "createdAt": "2020-10-12T16:08:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzM5MjM1Mg=="}], "type": "inlineReview"}, {"oid": "ae9209ff88ad768f0fa640cbd56c6b32db1594db", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/ae9209ff88ad768f0fa640cbd56c6b32db1594db", "message": "Keep only one function which will be used.", "committedDate": "2020-10-12T16:07:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzM5NzU3Ng==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/515#discussion_r503397576", "bodyText": "this is very wordy when it doesn't really need to be. I'd just call the Topics as Logging. Make sure to change it to Topics it shouldn't be a singular Topic", "author": "MikeDombo", "createdAt": "2020-10-12T16:11:32Z", "path": "src/main/java/com/aws/greengrass/lifecyclemanager/LogManagerHelper.java", "diffHunk": "@@ -0,0 +1,55 @@\n+/*\n+ * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+\n+package com.aws.greengrass.lifecyclemanager;\n+\n+import com.aws.greengrass.logging.impl.LogManager;\n+import com.aws.greengrass.logging.impl.config.model.LoggerConfiguration;\n+\n+import static com.aws.greengrass.componentmanager.KernelConfigResolver.PARAMETERS_CONFIG_KEY;\n+\n+/**\n+ * Helper function to get a logger with configurations separate from the root logger.\n+ */\n+public class LogManagerHelper {\n+    private static final String LOG_FILE_EXTENSION = \".log\";\n+    private static final String KERNEL_CONFIG_PARAMETER_TOPIC = \"rootLoggerConfig\";\n+    private static final String SERVICE_CONFIG_PARAMETER_TOPIC = \"ComponentLoggerConfig\";", "originalCommit": "ae9209ff88ad768f0fa640cbd56c6b32db1594db", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzM5ODg0MA==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/515#discussion_r503398840", "bodyText": "And use the same name for the kernel's topics too", "author": "MikeDombo", "createdAt": "2020-10-12T16:13:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzM5NzU3Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQwMTA4Mw==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/515#discussion_r503401083", "bodyText": "Right now its not implemented yet. So my point of adding this was just to have the skeleton code. Will make the change in the next PR when that is implemented.\nAlso, the name should be ComponentLoggerConfig to keep in the same line as the dependencies and other topics in the component recipe.", "author": "nikkhilmuthye", "createdAt": "2020-10-12T16:17:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzM5NzU3Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQwMjI4Ng==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/515#discussion_r503402286", "bodyText": "That's not how the topics are named inside the kernel. Inside it is just dependencies, etc. And \"LoggerConfig\" is gross, none of the other names are \"config\"", "author": "MikeDombo", "createdAt": "2020-10-12T16:20:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzM5NzU3Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQwMjY3MQ==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/515#discussion_r503402671", "bodyText": "Is it under parameters or not? If it is new top level thing in the recipe, then it shouldn't be under parameters anyway", "author": "MikeDombo", "createdAt": "2020-10-12T16:20:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzM5NzU3Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQxMTQ4NA==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/515#discussion_r503411484", "bodyText": "It will be under parameters for the kernel config. But yes. will remove the lookup in the service since it will be a top level thing in the component recipe.", "author": "nikkhilmuthye", "createdAt": "2020-10-12T16:37:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzM5NzU3Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQxMjM5Nw==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/515#discussion_r503412397", "bodyText": "Why would they be in different places if nucleus is just a normal component?", "author": "MikeDombo", "createdAt": "2020-10-12T16:39:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzM5NzU3Ng=="}], "type": "inlineReview"}, {"oid": "3f6ad83417f877cc13ff7caf054aa15b8f738980", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/3f6ad83417f877cc13ff7caf054aa15b8f738980", "message": "Correct the config look up and rename the topic name.", "committedDate": "2020-10-12T16:45:35Z", "type": "commit"}, {"oid": "3f6ad83417f877cc13ff7caf054aa15b8f738980", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/3f6ad83417f877cc13ff7caf054aa15b8f738980", "message": "Correct the config look up and rename the topic name.", "committedDate": "2020-10-12T16:45:35Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQxNjQ0Mw==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/515#discussion_r503416443", "bodyText": "why isn't this services.<nucleus name>.logging?", "author": "MikeDombo", "createdAt": "2020-10-12T16:47:44Z", "path": "src/main/java/com/aws/greengrass/lifecyclemanager/LogManagerHelper.java", "diffHunk": "@@ -0,0 +1,53 @@\n+/*\n+ * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+\n+package com.aws.greengrass.lifecyclemanager;\n+\n+import com.aws.greengrass.logging.impl.LogManager;\n+import com.aws.greengrass.logging.impl.config.model.LoggerConfiguration;\n+\n+/**\n+ * Helper function to get a logger with configurations separate from the root logger.\n+ */\n+public class LogManagerHelper {\n+    private static final String LOG_FILE_EXTENSION = \".log\";\n+    private static final String KERNEL_CONFIG_PARAMETER_TOPIC = \"logging\";\n+    private static final String SERVICE_CONFIG_PARAMETER_TOPIC = \"ComponentLogging\";\n+    private final Kernel kernel;\n+\n+    public LogManagerHelper(Kernel kernel) {\n+        this.kernel = kernel;\n+        this.kernel.getConfig().lookup(KERNEL_CONFIG_PARAMETER_TOPIC)", "originalCommit": "3f6ad83417f877cc13ff7caf054aa15b8f738980", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQxNjU5MQ==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/515#discussion_r503416591", "bodyText": "or, better yet, kernel.findServiceTopics(nucleus)", "author": "MikeDombo", "createdAt": "2020-10-12T16:48:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQxNjQ0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQxOTEyMw==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/515#discussion_r503419123", "bodyText": "I was going to wait for the other PR to get merged to reuse the KERNEL_COMPONENT_NAME field. This was just meant to be the skeleton code.", "author": "nikkhilmuthye", "createdAt": "2020-10-12T16:52:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQxNjQ0Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQyMDIwNQ==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/515#discussion_r503420205", "bodyText": "rename this", "author": "MikeDombo", "createdAt": "2020-10-12T16:54:44Z", "path": "src/main/java/com/aws/greengrass/lifecyclemanager/LogManagerHelper.java", "diffHunk": "@@ -0,0 +1,53 @@\n+/*\n+ * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+\n+package com.aws.greengrass.lifecyclemanager;\n+\n+import com.aws.greengrass.logging.impl.LogManager;\n+import com.aws.greengrass.logging.impl.config.model.LoggerConfiguration;\n+\n+/**\n+ * Helper function to get a logger with configurations separate from the root logger.\n+ */\n+public class LogManagerHelper {\n+    private static final String LOG_FILE_EXTENSION = \".log\";\n+    private static final String KERNEL_CONFIG_PARAMETER_TOPIC = \"logging\";\n+    private static final String SERVICE_CONFIG_PARAMETER_TOPIC = \"ComponentLogging\";", "originalCommit": "3f6ad83417f877cc13ff7caf054aa15b8f738980", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "b16056f22523259539503298e4963b8cdedceaec", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/b16056f22523259539503298e4963b8cdedceaec", "message": "Address PR comments.", "committedDate": "2020-10-12T19:03:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQ4ODU5Nw==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/515#discussion_r503488597", "bodyText": "do we actually need to pass the extension into the logger? Doesn't the logger actually strip it out and then add it back later?", "author": "MikeDombo", "createdAt": "2020-10-12T19:23:32Z", "path": "src/main/java/com/aws/greengrass/lifecyclemanager/LogManagerHelper.java", "diffHunk": "@@ -0,0 +1,56 @@\n+/*\n+ * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+\n+package com.aws.greengrass.lifecyclemanager;\n+\n+import com.aws.greengrass.logging.impl.LogManager;\n+import com.aws.greengrass.logging.impl.config.model.LoggerConfiguration;\n+\n+import static com.aws.greengrass.lifecyclemanager.GreengrassService.SERVICES_NAMESPACE_TOPIC;\n+\n+/**\n+ * Helper function to get a logger with configurations separate from the root logger.\n+ */\n+public class LogManagerHelper {\n+    private static final String LOG_FILE_EXTENSION = \".log\";", "originalCommit": "b16056f22523259539503298e4963b8cdedceaec", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "03661ecf97d3c5ea94e73af8a145357389ab5c2f", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/03661ecf97d3c5ea94e73af8a145357389ab5c2f", "message": "Merge branch 'master' into splitOutLogs", "committedDate": "2020-10-14T23:57:33Z", "type": "commit"}, {"oid": "146fa97153d6c985eed563c96ff639a1f4c7b4b7", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/146fa97153d6c985eed563c96ff639a1f4c7b4b7", "message": "Fix Build.", "committedDate": "2020-10-15T16:14:50Z", "type": "commit"}, {"oid": "e98405157c8c8cecb447196000617893dee471c5", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/e98405157c8c8cecb447196000617893dee471c5", "message": "Merge branch 'master' into splitOutLogs", "committedDate": "2020-10-15T16:15:17Z", "type": "commit"}, {"oid": "0503ab0280dceaa61cf8004743ac60d70b075d12", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/0503ab0280dceaa61cf8004743ac60d70b075d12", "message": "Fix build. Add unit test.", "committedDate": "2020-10-15T17:02:42Z", "type": "commit"}, {"oid": "a292b04fa217a8d4f65ba05c6a4627895a3e7646", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/a292b04fa217a8d4f65ba05c6a4627895a3e7646", "message": "Merge branch 'master' into splitOutLogs", "committedDate": "2020-10-15T18:22:05Z", "type": "commit"}, {"oid": "6280f2849baa1c957abf73d5c501c1c8242274bf", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/6280f2849baa1c957abf73d5c501c1c8242274bf", "message": "Fix build.", "committedDate": "2020-10-15T18:39:25Z", "type": "commit"}, {"oid": "e0271d096f3315773773a49211baea5ac59b6685", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/e0271d096f3315773773a49211baea5ac59b6685", "message": "Merge branch 'master' into splitOutLogs", "committedDate": "2020-10-15T18:39:55Z", "type": "commit"}, {"oid": "ccecea4a14d29da2ba89fe8b74c0f980d3210d70", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/ccecea4a14d29da2ba89fe8b74c0f980d3210d70", "message": "Don't make tempDir static.", "committedDate": "2020-10-15T21:51:35Z", "type": "commit"}, {"oid": "6576b1d3428e78b4699596f2cd7cd7d43f85d330", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/6576b1d3428e78b4699596f2cd7cd7d43f85d330", "message": "Close all loggers context.", "committedDate": "2020-10-15T22:17:40Z", "type": "commit"}, {"oid": "0f86cc640f61cc0115eaefc9af1aa97300deecb7", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/0f86cc640f61cc0115eaefc9af1aa97300deecb7", "message": "Merge branch 'master' into splitOutLogs", "committedDate": "2020-10-15T22:20:39Z", "type": "commit"}, {"oid": "54957b4d02a22e2bbd49bd9d83e9d2936ee43a4d", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/54957b4d02a22e2bbd49bd9d83e9d2936ee43a4d", "message": "Close context in test.", "committedDate": "2020-10-16T02:05:10Z", "type": "commit"}, {"oid": "3eaf88d5312183cef5fe92df2bc1d5358b2109e0", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/3eaf88d5312183cef5fe92df2bc1d5358b2109e0", "message": "Merge branch 'master' into splitOutLogs", "committedDate": "2020-10-16T02:28:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTk5NjMwMw==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/515#discussion_r505996303", "bodyText": "follow the example of telemetry and do nucleusPaths.setLoggerPath(). Make sure to set the log dir permissions to drwxr-xr-x", "author": "MikeDombo", "createdAt": "2020-10-16T02:30:39Z", "path": "src/main/java/com/aws/greengrass/lifecyclemanager/KernelCommandLine.java", "diffHunk": "@@ -123,6 +123,7 @@ private void initPaths(String rootAbsolutePath) {\n             nucleusPaths.setRootPath(Paths.get(rootAbsolutePath).toAbsolutePath());\n             //set root path for the telemetry logger\n             TelemetryConfig.getInstance().setRoot(Paths.get(deTilde(ROOT_DIR_PREFIX)));\n+            LogManager.setRoot(Paths.get(deTilde(ROOT_DIR_PREFIX)));", "originalCommit": "3eaf88d5312183cef5fe92df2bc1d5358b2109e0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTk5NjQyMQ==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/515#discussion_r505996421", "bodyText": "shut this down at the very very end (L299), otherwise the log messages at the end won't be logged.", "author": "MikeDombo", "createdAt": "2020-10-16T02:31:06Z", "path": "src/main/java/com/aws/greengrass/lifecyclemanager/KernelLifecycle.java", "diffHunk": "@@ -284,6 +285,11 @@ public void shutdown(int timeoutSeconds) {\n             //Stop the telemetry logger context after each test so we can delete the telemetry log files that are\n             // created during the test.\n             TelemetryConfig.getInstance().closeContext();\n+            // Stop all the contexts for the loggers.\n+            LogConfig.getInstance().closeContext();\n+            for (LogConfig logConfig : LogManager.getLogConfigurations().values()) {\n+                logConfig.closeContext();\n+            }", "originalCommit": "3eaf88d5312183cef5fe92df2bc1d5358b2109e0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "4d7b04fdbdc2108d40280c706b6b0d829ffcd448", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/4d7b04fdbdc2108d40280c706b6b0d829ffcd448", "message": "Address PR comments.", "committedDate": "2020-10-16T03:16:04Z", "type": "commit"}, {"oid": "55bc89bdf0f5edbfe7431dceca15707941268424", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/55bc89bdf0f5edbfe7431dceca15707941268424", "message": "Merge branch 'splitOutLogs' of github.com:aws/aws-greengrass-kernel into splitOutLogs", "committedDate": "2020-10-16T03:16:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjYxNzMzNA==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/515#discussion_r506617334", "bodyText": "Where is this called?", "author": "hui-yang", "createdAt": "2020-10-16T17:23:54Z", "path": "src/main/java/com/aws/greengrass/util/NucleusPaths.java", "diffHunk": "@@ -155,4 +155,9 @@ public void setTelemetryPath(Path p) throws IOException {\n         Utils.createPaths(p);\n         Permissions.setTelemetryPermission(p);\n     }\n+\n+    public void setLoggerPath(Path p) throws IOException {", "originalCommit": "4d7b04fdbdc2108d40280c706b6b0d829ffcd448", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjYxODM5Nw==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/515#discussion_r506618397", "bodyText": "https://github.com/aws/aws-greengrass-nucleus/pull/515/files#diff-796008acb74cf723c72fae28dfa08e52b408eac5dd5d1762ba1bac2b626626ebR128", "author": "nikkhilmuthye", "createdAt": "2020-10-16T17:25:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjYxNzMzNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjYxODQ0NQ==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/515#discussion_r506618445", "bodyText": "nvm. I saw it, just before nucleusPaths.initPaths", "author": "hui-yang", "createdAt": "2020-10-16T17:25:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjYxNzMzNA=="}], "type": "inlineReview"}]}