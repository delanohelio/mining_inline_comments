{"pr_number": 585, "pr_title": "Wildcard support for MQTT Proxy AuthZ", "pr_createdAt": "2020-10-29T22:23:49Z", "pr_url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/585", "timeline": [{"oid": "78611357181a0de7841d3e443d99a7156e37a62d", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/78611357181a0de7841d3e443d99a7156e37a62d", "message": "Wildcard support for MQTT Proxy AuthZ", "committedDate": "2020-10-29T22:20:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYwMzI1Mw==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/585#discussion_r514603253", "bodyText": "this test doesn't seem to actually validate the behavior for wildcards in topics.", "author": "MikeDombo", "createdAt": "2020-10-29T22:27:07Z", "path": "src/test/java/com/aws/greengrass/builtin/services/mqttproxy/MqttProxyIPCAgentTest.java", "diffHunk": "@@ -6,7 +6,6 @@\n package com.aws.greengrass.builtin.services.mqttproxy;", "originalCommit": "78611357181a0de7841d3e443d99a7156e37a62d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYwMzc2OA==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/585#discussion_r514603768", "bodyText": "yes, I'm working on adding tests for that. just wanted to get some quick feedback on the code change", "author": "popanmol", "createdAt": "2020-10-29T22:28:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYwMzI1Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYwMzg4Nw==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/585#discussion_r514603887", "bodyText": "let's have a unit test for this behavior", "author": "MikeDombo", "createdAt": "2020-10-29T22:28:55Z", "path": "src/main/java/com/aws/greengrass/builtin/services/mqttproxy/MqttProxyIPCAgent.java", "diffHunk": "@@ -199,12 +201,32 @@ private QualityOfService getQualityOfServiceFromQOS(QOS qos) {\n     }\n \n     private void doAuthorization(String opName, String serviceName, String topic) throws AuthorizationException {", "originalCommit": "78611357181a0de7841d3e443d99a7156e37a62d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "c8116f9a6314aa7dbb4667a65ef4e360f769827c", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/c8116f9a6314aa7dbb4667a65ef4e360f769827c", "message": "unit tests", "committedDate": "2020-10-30T01:17:57Z", "type": "commit"}, {"oid": "cb80eedddc5c868c1aaf4df52039233d3cb2f904", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/cb80eedddc5c868c1aaf4df52039233d3cb2f904", "message": "Merge branch 'master' into mqtt-authz", "committedDate": "2020-10-30T01:19:14Z", "type": "commit"}, {"oid": "e1ffe9c2a46128ca465c5888742914ae538ec6b2", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/e1ffe9c2a46128ca465c5888742914ae538ec6b2", "message": "Merge branch 'master' into mqtt-authz", "committedDate": "2020-10-30T02:23:51Z", "type": "commit"}, {"oid": "0b82bc873d14c6087b219ff19b4317839433d94a", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/0b82bc873d14c6087b219ff19b4317839433d94a", "message": "wildcards in config", "committedDate": "2020-10-30T02:26:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDgyMTQxNg==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/585#discussion_r514821416", "bodyText": "Policy is missing a couple cases. We need to ensure getAuthorizedResources() can handle wildcards (both principal and operation) and that it filters out resources that aren't matches.", "author": "jbutler", "createdAt": "2020-10-30T04:11:56Z", "path": "src/test/java/com/aws/greengrass/authorization/AuthorizationModuleTest.java", "diffHunk": "@@ -121,4 +123,25 @@ void Given_authZmodule_WHEN_added_entries_successively_THEN_retrieve_works() {\n             }\n         });\n     }\n+\n+    @Test\n+    void Given_authZmodule_WHEN_added_entries_THEN_getResources_works() throws AuthorizationException {", "originalCommit": "0b82bc873d14c6087b219ff19b4317839433d94a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "71b000d46c58b44d86f31140809715c857544051", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/71b000d46c58b44d86f31140809715c857544051", "message": "more coverage for getAuthorizedResources", "committedDate": "2020-10-30T17:31:41Z", "type": "commit"}, {"oid": "75fe11d9cbf95983ca334446a02dab5a7202a9ed", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/75fe11d9cbf95983ca334446a02dab5a7202a9ed", "message": "Merge branch 'master' into mqtt-authz", "committedDate": "2020-10-30T17:57:13Z", "type": "commit"}, {"oid": "46dc6174b6a2ef56fe510944ae91d73963f55002", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/46dc6174b6a2ef56fe510944ae91d73963f55002", "message": "getResources returns resources with * principal/op", "committedDate": "2020-10-30T20:36:57Z", "type": "commit"}, {"oid": "4c135a5f3e74f3fc7c11a4a595fa7c30501f0964", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/4c135a5f3e74f3fc7c11a4a595fa7c30501f0964", "message": "Merge branch 'master' into mqtt-authz", "committedDate": "2020-10-30T20:41:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTM4NTcwNA==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/585#discussion_r515385704", "bodyText": "Update the comment", "author": "prateek-y", "createdAt": "2020-10-30T21:13:39Z", "path": "src/main/java/com/aws/greengrass/authorization/AuthorizationHandler.java", "diffHunk": "@@ -192,6 +193,28 @@ public boolean isAuthorized(String destination, Permission permission) throws Au\n                         resource));\n     }\n \n+    /**\n+     * Get allowed resources for the combination of destination, principal and operation.\n+     * Also returns resources covered by permissions with * operation/principal.\n+     *\n+     * @param destination destination\n+     * @param principal   principal (cannot be *)\n+     * @param operation   operation (cannot be *)\n+     * @return list of allowed resources\n+     * @throws AuthorizationException when flow is not authorized", "originalCommit": "4c135a5f3e74f3fc7c11a4a595fa7c30501f0964", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQwMjMyNQ==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/585#discussion_r515402325", "bodyText": "do you need tests for multiple + or a combination of + and #", "author": "prateek-y", "createdAt": "2020-10-30T22:03:19Z", "path": "src/test/java/com/aws/greengrass/builtin/services/mqttproxy/MqttProxyIPCAgentTest.java", "diffHunk": "@@ -54,6 +59,18 @@\n     private static final String TEST_TOPIC = \"TestTopic\";\n     private static final byte[] TEST_PAYLOAD = \"TestPayload\".getBytes(StandardCharsets.UTF_8);\n \n+    private static final String TEST_SINGLE_LEVEL_WILDCARD = \"topic/with/single/level/+/wildcard\";\n+    private static final String TEST_MULTI_LEVEL_WILDCARD = \"topic/with/multi/level/wildcard/#\";", "originalCommit": "4c135a5f3e74f3fc7c11a4a595fa7c30501f0964", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQwNzY3OA==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/585#discussion_r515407678", "bodyText": "various cases covered in https://github.com/aws/aws-greengrass-nucleus/blob/master/src/test/java/com/aws/greengrass/mqttclient/MqttTopicTest.java", "author": "popanmol", "createdAt": "2020-10-30T22:22:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQwMjMyNQ=="}], "type": "inlineReview"}, {"oid": "e054700f2b11d717ea075bd49cfeec77b57a2b40", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/e054700f2b11d717ea075bd49cfeec77b57a2b40", "message": "update docstring", "committedDate": "2020-10-30T22:24:08Z", "type": "commit"}, {"oid": "7779aa6e22834b52e2d3d43e442181c267ef2e88", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/7779aa6e22834b52e2d3d43e442181c267ef2e88", "message": "Merge branch 'master' into mqtt-authz", "committedDate": "2020-10-30T23:15:36Z", "type": "commit"}]}