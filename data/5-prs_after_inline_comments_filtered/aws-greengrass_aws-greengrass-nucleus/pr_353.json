{"pr_number": 353, "pr_title": "support interpolating artifact unpack directories", "pr_createdAt": "2020-08-05T08:22:52Z", "pr_url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/353", "timeline": [{"oid": "0a272233661a26ae7cba7313c2d34abdc9593697", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/0a272233661a26ae7cba7313c2d34abdc9593697", "message": "support interpolating artifact unpack directories", "committedDate": "2020-08-05T08:20:28Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTg0ODc1Mw==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/353#discussion_r465848753", "bodyText": "Nice refactor. Can we make Utils more generic? I think we already have our own FileUtils class?", "author": "leaf94", "createdAt": "2020-08-05T16:23:30Z", "path": "src/main/java/com/aws/iot/evergreen/packagemanager/PackageStore.java", "diffHunk": "@@ -56,21 +60,12 @@\n     public PackageStore(@Named(CONTEXT_PACKAGE_STORE_DIRECTORY) @NonNull Path packageStoreDirectory)\n             throws PackagingException {\n         this.recipeDirectory = packageStoreDirectory.resolve(RECIPE_DIRECTORY);\n-        if (!Files.exists(recipeDirectory)) {\n-            try {\n-                Files.createDirectories(recipeDirectory);\n-            } catch (IOException e) {\n-                throw new PackagingException(String.format(\"Failed to create recipe directory %s\", recipeDirectory), e);\n-            }\n-        }\n         this.artifactDirectory = packageStoreDirectory.resolve(ARTIFACT_DIRECTORY);\n-        if (!Files.exists(artifactDirectory)) {\n-            try {\n-                Files.createDirectories(artifactDirectory);\n-            } catch (IOException e) {\n-                throw new PackagingException(String.format(\"Failed to create artifact directory %s\", artifactDirectory),\n-                        e);\n-            }\n+        this.artifactsUnpackDirectory = packageStoreDirectory.resolve(ARTIFACTS_UNPACK_DIRECTORY);\n+        try {\n+            Utils.createPaths(recipeDirectory, artifactDirectory, artifactsUnpackDirectory);\n+        } catch (IOException e) {\n+            throw new PackagingException(\"Failed to create necessary directories for package store\", e);", "originalCommit": "0a272233661a26ae7cba7313c2d34abdc9593697", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjYzOTA3NQ==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/353#discussion_r466639075", "bodyText": "+1. If you plan to make this refactor in this PR, i'd prefer rename to createDirs() . But I'm ok with current PR now", "author": "ShirleyZheng92", "createdAt": "2020-08-06T19:31:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTg0ODc1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY2Njk5MQ==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/353#discussion_r466666991", "bodyText": "There is no FileUtils yet, and Utils.createPaths is used at few other places. Push to another refactor ?", "author": "fahadmohammed01", "createdAt": "2020-08-06T20:27:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTg0ODc1Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTg2NDQxOA==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/353#discussion_r465864418", "bodyText": "Use the systemParameters instead of hardcoding these.", "author": "MikeDombo", "createdAt": "2020-08-05T16:48:08Z", "path": "src/main/java/com/aws/iot/evergreen/packagemanager/KernelConfigResolver.java", "diffHunk": "@@ -148,13 +150,19 @@ private Object interpolate(Object configValue, Set<PackageParameter> packagePara\n     }\n \n     private String replace(String stringValue, PackageIdentifier packageIdentifier,\n-                           Set<PackageParameter> packageParameters) {\n+                           Set<PackageParameter> packageParameters) throws PackageLoadingException {\n         // Handle package parameters\n         for (final PackageParameter parameter : packageParameters) {\n             stringValue = stringValue\n                     .replace(String.format(PARAMETER_REFERENCE_FORMAT, parameter.getName()), parameter.getValue());\n         }\n \n+        //Handle directories\n+        stringValue = stringValue.replace(ARTIFACTS_UNPACK_DIRECTORY_PLACEHOLDER,\n+                packageStore.resolveAndSetupArtifactsUnpackDirectory(packageIdentifier).toAbsolutePath().toString());\n+        stringValue = stringValue.replace(KERNEL_ROOT_DIRECTORY_PLACEHOLDER,\n+                kernel.getRootPath().toAbsolutePath().toString());\n+", "originalCommit": "0a272233661a26ae7cba7313c2d34abdc9593697", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTg5NDQ0OQ==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/353#discussion_r465894449", "bodyText": "+1", "author": "hui-yang", "createdAt": "2020-08-05T17:39:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTg2NDQxOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY2NzAxOQ==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/353#discussion_r466667019", "bodyText": "Updated", "author": "fahadmohammed01", "createdAt": "2020-08-06T20:27:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTg2NDQxOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTg2NTUxNA==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/353#discussion_r465865514", "bodyText": "How is this used? Does kernel decompress the file itself?\nFeng (IoT) Wang Yesterday at 9:40 PM\nCustomers should be able to specify the compression format of the artifact and the artifact downloader should unpack the artifacts. That\u2019s what I described in the original package downloader design: https://quip-amazon.com/aEbzAtwX1b1M/Evergreen-device-package-store#BJX9CAdFfH2\n5 replies\nMichael Dombrowski  12 hours ago\nIt says that it decompresses automatically, are we sure we want that? Or should it be an option?\nFeng (IoT) Wang  12 hours ago\nwe can make it configurable.\nMichael Dombrowski  12 hours ago\nuri: something\ndecompress: zip/gzip\nSomething like that?\nFeng (IoT) Wang  12 hours ago\nright. If a compression format is specified, such as zip or tar, then we can unzip/untar it. If it\u2019s not specified, then we do nothing.\nMichael Dombrowski  12 hours ago\nI'm good with that. Can work on it tomorrow. It'll need a cloud change too to add it to the recipe", "author": "MikeDombo", "createdAt": "2020-08-05T16:49:53Z", "path": "src/main/java/com/aws/iot/evergreen/packagemanager/PackageStore.java", "diffHunk": "@@ -46,8 +48,10 @@\n \n     private final Path artifactDirectory;\n \n+    private final Path artifactsUnpackDirectory;", "originalCommit": "0a272233661a26ae7cba7313c2d34abdc9593697", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTg3MDgwMg==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/353#discussion_r465870802", "bodyText": "How this folder will be used: https://quip-amazon.com/vWhOAWhGwA6q/Kernel-Update-Design#PTP9CArJVKy", "author": "fahadmohammed01", "createdAt": "2020-08-05T16:58:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTg2NTUxNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTg3Mjg4NQ==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/353#discussion_r465872885", "bodyText": "So it doesn't automatically decompress?", "author": "MikeDombo", "createdAt": "2020-08-05T17:01:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTg2NTUxNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTg4OTUyOA==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/353#discussion_r465889528", "bodyText": "No. Component authors can define the unpacking in lifecycle steps, maybe install.", "author": "hui-yang", "createdAt": "2020-08-05T17:30:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTg2NTUxNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTg5MDIyMw==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/353#discussion_r465890223", "bodyText": "OK, I think I'm going to be adding that today for lambda, but it should also help your work", "author": "MikeDombo", "createdAt": "2020-08-05T17:31:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTg2NTUxNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTg5MDEzMg==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/353#discussion_r465890132", "bodyText": "What's the unpack directory for?", "author": "fengwang666", "createdAt": "2020-08-05T17:31:46Z", "path": "src/main/java/com/aws/iot/evergreen/packagemanager/PackageStore.java", "diffHunk": "@@ -38,6 +39,7 @@\n     public static final String CONTEXT_PACKAGE_STORE_DIRECTORY = \"packageStoreDirectory\";\n     public static final String RECIPE_DIRECTORY = \"recipes\";\n     public static final String ARTIFACT_DIRECTORY = \"artifacts\";\n+    public static final String ARTIFACTS_UNPACK_DIRECTORY = \"artifacts-unpack\";", "originalCommit": "0a272233661a26ae7cba7313c2d34abdc9593697", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTg5NzM1Mw==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/353#discussion_r465897353", "bodyText": "It's an optional directory for customers to unpack component artifacts. It's not enforced to be used", "author": "hui-yang", "createdAt": "2020-08-05T17:44:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTg5MDEzMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTkxMDY3NA==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/353#discussion_r465910674", "bodyText": "Will kernel update unpack use this directory?", "author": "ShirleyZheng92", "createdAt": "2020-08-05T18:08:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTg5MDEzMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTkyNTI1OA==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/353#discussion_r465925258", "bodyText": "How unpack directory will be used: https://quip-amazon.com/vWhOAWhGwA6q/Kernel-Update-Design#PTP9CArJVKy", "author": "fahadmohammed01", "createdAt": "2020-08-05T18:35:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTg5MDEzMg=="}], "type": "inlineReview"}, {"oid": "241cb5f2dc5ffed4980a34bbaf5d19f3006afa00", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/241cb5f2dc5ffed4980a34bbaf5d19f3006afa00", "message": "Merge branch 'master' into interpolate-directories", "committedDate": "2020-08-05T18:08:03Z", "type": "commit"}, {"oid": "bb323631a5b12e24ac8055888bc0d53658383b00", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/bb323631a5b12e24ac8055888bc0d53658383b00", "message": "addressed pr comments", "committedDate": "2020-08-06T01:56:27Z", "type": "commit"}, {"oid": "2986e6b429f9f8a5225b10adea1b1c2044a029bb", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/2986e6b429f9f8a5225b10adea1b1c2044a029bb", "message": "added tests", "committedDate": "2020-08-06T20:26:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY4ODc2OQ==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/353#discussion_r466688769", "bodyText": "Why does this need to create the path? Our other artifact dir is created at some other time", "author": "MikeDombo", "createdAt": "2020-08-06T21:11:36Z", "path": "src/main/java/com/aws/iot/evergreen/packagemanager/KernelConfigResolver.java", "diffHunk": "@@ -55,10 +60,18 @@ public KernelConfigResolver(PackageStore packageStore, Kernel kernel) {\n         this.kernel = kernel;\n \n         // More system parameters can be added over time by extending this map with new namespaces/keys\n-        HashMap<String, Function<PackageIdentifier, String>> artifactNamespace = new HashMap<>();\n-        artifactNamespace\n-                .put(\"path\", (id) -> packageStore.resolveArtifactDirectoryPath(id).toAbsolutePath().toString());\n-        systemParameters.put(\"artifacts\", artifactNamespace);\n+        HashMap<String, CrashableFunction<PackageIdentifier, String, PackageLoadingException>> artifactNamespace\n+                = new HashMap<>();\n+        artifactNamespace.put(\"path\",\n+                (id) -> packageStore.resolveArtifactDirectoryPath(id).toAbsolutePath().toString());\n+        artifactNamespace.put(\"unpackPath\",\n+                (id) -> packageStore.resolveAndSetupArtifactsUnpackDirectory(id).toAbsolutePath().toString());", "originalCommit": "2986e6b429f9f8a5225b10adea1b1c2044a029bb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY5NzYyNA==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/353#discussion_r466697624", "bodyText": "artifacts directory is created for every component, unpack directory need not be created unless it is referred in the recipe.", "author": "fahadmohammed01", "createdAt": "2020-08-06T21:31:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY4ODc2OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY4ODk2NQ==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/353#discussion_r466688965", "bodyText": "maybe \"decompressedPath\"?", "author": "MikeDombo", "createdAt": "2020-08-06T21:12:00Z", "path": "src/main/java/com/aws/iot/evergreen/packagemanager/KernelConfigResolver.java", "diffHunk": "@@ -55,10 +60,18 @@ public KernelConfigResolver(PackageStore packageStore, Kernel kernel) {\n         this.kernel = kernel;\n \n         // More system parameters can be added over time by extending this map with new namespaces/keys\n-        HashMap<String, Function<PackageIdentifier, String>> artifactNamespace = new HashMap<>();\n-        artifactNamespace\n-                .put(\"path\", (id) -> packageStore.resolveArtifactDirectoryPath(id).toAbsolutePath().toString());\n-        systemParameters.put(\"artifacts\", artifactNamespace);\n+        HashMap<String, CrashableFunction<PackageIdentifier, String, PackageLoadingException>> artifactNamespace\n+                = new HashMap<>();\n+        artifactNamespace.put(\"path\",\n+                (id) -> packageStore.resolveArtifactDirectoryPath(id).toAbsolutePath().toString());\n+        artifactNamespace.put(\"unpackPath\",", "originalCommit": "2986e6b429f9f8a5225b10adea1b1c2044a029bb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjcwMjE0Ng==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/353#discussion_r466702146", "bodyText": "would adding decompressed give false impression that we actually decompress stuff?", "author": "fahadmohammed01", "createdAt": "2020-08-06T21:42:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY4ODk2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjcwMzU5Ng==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/353#discussion_r466703596", "bodyText": "I do want to decompress things for the customer. We want this feature for lambda", "author": "MikeDombo", "createdAt": "2020-08-06T21:46:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY4ODk2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjcwNjQ0OA==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/353#discussion_r466706448", "bodyText": "renamed", "author": "fahadmohammed01", "createdAt": "2020-08-06T21:52:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY4ODk2NQ=="}], "type": "inlineReview"}, {"oid": "e5092be8afb885ce0e718ce042d0a1c2a669ab53", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/e5092be8afb885ce0e718ce042d0a1c2a669ab53", "message": "Merge branch 'master' into interpolate-directories", "committedDate": "2020-08-06T21:30:18Z", "type": "commit"}, {"oid": "7805028cf2cf98e1ada5b05523834c095b05f5ec", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/7805028cf2cf98e1ada5b05523834c095b05f5ec", "message": "resolved merge conflict", "committedDate": "2020-08-06T21:48:19Z", "type": "commit"}, {"oid": "0a0f9371ca3804254795d9058f1b8f0b3c49667d", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/0a0f9371ca3804254795d9058f1b8f0b3c49667d", "message": "minor refactoring", "committedDate": "2020-08-06T21:52:50Z", "type": "commit"}, {"oid": "8b3f34624090425e93807ebe6053041c9f42f936", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/8b3f34624090425e93807ebe6053041c9f42f936", "message": "fixed test case to work in windows platform", "committedDate": "2020-08-06T22:31:13Z", "type": "commit"}, {"oid": "9e234e938f886f8f470a4f834ed0d9265de831e9", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/9e234e938f886f8f470a4f834ed0d9265de831e9", "message": "Merge branch 'master' into interpolate-directories", "committedDate": "2020-08-06T23:05:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc0MDkzNA==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/353#discussion_r466740934", "bodyText": "I don't think these need to be public", "author": "MikeDombo", "createdAt": "2020-08-06T23:35:51Z", "path": "src/main/java/com/aws/iot/evergreen/packagemanager/KernelConfigResolver.java", "diffHunk": "@@ -42,6 +43,9 @@\n     private static final Logger LOGGER = LogManager.getLogger(KernelConfigResolver.class);\n     public static final String VERSION_CONFIG_KEY = \"version\";\n     public static final String PARAMETERS_CONFIG_KEY = \"parameters\";\n+    public static final String ARTIFACTS_NAMESPACE = \"artifacts\";\n+    public static final String KERNEL_NAMESPACE = \"kernel\";\n+    public static final String KERNEL_ROOT_PATH = \"rootPath\";", "originalCommit": "9e234e938f886f8f470a4f834ed0d9265de831e9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc1NDc4Mg==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/353#discussion_r466754782", "bodyText": "updated", "author": "fahadmohammed01", "createdAt": "2020-08-07T00:26:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc0MDkzNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc0MTU5NA==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/353#discussion_r466741594", "bodyText": "change the unpack everywhere to decompressed", "author": "MikeDombo", "createdAt": "2020-08-06T23:38:13Z", "path": "src/main/java/com/aws/iot/evergreen/packagemanager/PackageStore.java", "diffHunk": "@@ -38,6 +39,7 @@\n     public static final String CONTEXT_PACKAGE_STORE_DIRECTORY = \"packageStoreDirectory\";\n     public static final String RECIPE_DIRECTORY = \"recipes\";\n     public static final String ARTIFACT_DIRECTORY = \"artifacts\";\n+    public static final String ARTIFACTS_UNPACK_DIRECTORY = \"artifacts-unpack\";", "originalCommit": "9e234e938f886f8f470a4f834ed0d9265de831e9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc1NDc0Ng==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/353#discussion_r466754746", "bodyText": "updated", "author": "fahadmohammed01", "createdAt": "2020-08-07T00:26:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc0MTU5NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc0MTkyMA==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/353#discussion_r466741920", "bodyText": "Format isn't necessary when you're just appending to the end, I think concatenation is faster in this case.", "author": "MikeDombo", "createdAt": "2020-08-06T23:39:14Z", "path": "src/main/java/com/aws/iot/evergreen/packagemanager/PackageStore.java", "diffHunk": "@@ -217,6 +211,25 @@ private Path resolveRecipePath(String packageName, Semver packageVersion) {\n         return recipeDirectory.resolve(String.format(RECIPE_FILE_NAME_FORMAT, packageName, packageVersion.getValue()));\n     }\n \n+    /**\n+     * Resolve the artifact unpack directory path and creates the directory if absent.\n+     * @param packageIdentifier packageIdentifier\n+     * @return artifact unpack directory path\n+     * @throws PackageLoadingException if un-able to create artifact unpack directory path\n+     */\n+    public Path resolveAndSetupArtifactsUnpackDirectory(@NonNull PackageIdentifier packageIdentifier)\n+            throws PackageLoadingException {\n+        Path path = artifactsUnpackDirectory.resolve(packageIdentifier.getName())\n+                .resolve(packageIdentifier.getVersion().getValue());\n+        try {\n+            Utils.createPaths(path);\n+            return path;\n+        } catch (IOException e) {\n+            throw new PackageLoadingException(String.format(\n+                    \"Failed to create artifact unpack directory for %s\", packageIdentifier.toString()), e);", "originalCommit": "9e234e938f886f8f470a4f834ed0d9265de831e9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc1NDcyMQ==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/353#discussion_r466754721", "bodyText": "I dont think that matters a lot, changed anyway", "author": "fahadmohammed01", "createdAt": "2020-08-07T00:25:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc0MTkyMA=="}], "type": "inlineReview"}, {"oid": "7dd579f6f995d3173c637adba47bb0e648fc58d4", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/7dd579f6f995d3173c637adba47bb0e648fc58d4", "message": "addressed pr comments", "committedDate": "2020-08-07T00:29:49Z", "type": "commit"}, {"oid": "cde04bf09bbdb820876fb58b7f853ba07337496a", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/cde04bf09bbdb820876fb58b7f853ba07337496a", "message": "fixed test", "committedDate": "2020-08-07T04:00:54Z", "type": "commit"}, {"oid": "be62f5e7126c575fc36122080624599bb82d9f02", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/be62f5e7126c575fc36122080624599bb82d9f02", "message": "fixed test", "committedDate": "2020-08-07T04:02:21Z", "type": "commit"}]}