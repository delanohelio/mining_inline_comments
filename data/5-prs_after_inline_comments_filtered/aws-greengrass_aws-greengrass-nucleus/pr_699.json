{"pr_number": 699, "pr_title": "removed support for parameters", "pr_createdAt": "2020-11-18T22:28:45Z", "pr_url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/699", "timeline": [{"oid": "09c2b385894ae9e217905df0758726715b4fc111", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/09c2b385894ae9e217905df0758726715b4fc111", "message": "removed support for parameters", "committedDate": "2020-11-18T22:27:43Z", "type": "commit"}, {"oid": "ae79f461efead973f56a7f7dd4acfa13515901af", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/ae79f461efead973f56a7f7dd4acfa13515901af", "message": "Merge branch 'master' into remove-parameters", "committedDate": "2020-11-18T22:30:38Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQ2OTU3NA==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/699#discussion_r526469574", "bodyText": "why is this a new error?", "author": "MikeDombo", "createdAt": "2020-11-18T22:36:29Z", "path": "src/integrationtests/java/com/aws/greengrass/integrationtests/e2e/deployment/DeploymentE2ETest.java", "diffHunk": "@@ -175,9 +177,10 @@ void GIVEN_kernel_running_WHEN_device_deployment_adds_packages_THEN_new_services\n \n     @Timeout(value = 10, unit = TimeUnit.MINUTES)\n     @Test\n-    void GIVEN_target_service_has_dependencies_WHEN_deploys_target_service_THEN_service_and_dependencies_should_be_deployed()\n+    void GIVEN_target_service_has_dependencies_WHEN_deploys_target_service_THEN_service_and_dependencies_should_be_deployed(ExtensionContext context)\n             throws Exception {\n         // Set up stdout listener to capture stdout for verify interpolation\n+        ignoreExceptionOfType(context, UserPrincipalNotFoundException.class);", "originalCommit": "ae79f461efead973f56a7f7dd4acfa13515901af", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQ4NjYxMQ==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/699#discussion_r526486611", "bodyText": "This is not related to this change, but something that gets thrown when testing locally on a mac. Saw the same exception get ignored in few other integ tests.", "author": "fahadmohammed01", "createdAt": "2020-11-18T23:16:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQ2OTU3NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjUwNTIyMg==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/699#discussion_r526505222", "bodyText": "This probably is not.. on mac, you need to change the nobody to your alias in BaseE2E and then E2E test would work.  Does it still show up even after that?", "author": "leaf94", "createdAt": "2020-11-19T00:07:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQ2OTU3NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjUxNzQ2NQ==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/699#discussion_r526517465", "bodyText": "that worked", "author": "fahadmohammed01", "createdAt": "2020-11-19T00:43:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQ2OTU3NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQ3MjY5OA==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/699#discussion_r526472698", "bodyText": "Do equivalents of these tests exist for Configuration? I don't think it would", "author": "MikeDombo", "createdAt": "2020-11-18T22:43:13Z", "path": "src/test/java/com/aws/greengrass/componentmanager/KernelConfigResolverTest.java", "diffHunk": "@@ -265,205 +260,6 @@ void GIVEN_deployment_for_existing_package_WHEN_config_resolution_requested_THEN\n                 dependencyListContains(\"main\", TEST_INPUT_PACKAGE_A, servicesConfig));\n     }\n \n-    @Test\n-    void GIVEN_deployment_with_parameters_set_WHEN_config_resolution_requested_THEN_parameters_should_be_interpolated()", "originalCommit": "ae79f461efead973f56a7f7dd4acfa13515901af", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQ4NTc1MA==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/699#discussion_r526485750", "bodyText": "New unit tests:\nGIVEN_deployment_with_configuration_update_WHEN_config_resolution_requested_THEN_correct_value_applied\nGIVEN_deployment_with_configuration_reset_WHEN_config_resolution_requested_THEN_default_value_applied\nGIVEN_deployment_with_configuration_update_on_dependency_component_WHEN_config_resolution_requested_THEN_correct_value_applied_to_dependent_component", "author": "fahadmohammed01", "createdAt": "2020-11-18T23:14:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQ3MjY5OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzIyNjAzMg==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/699#discussion_r527226032", "bodyText": "I had added some runWith config in the tests, are those carried over to the new ones?", "author": "rbattle", "createdAt": "2020-11-19T21:51:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQ3MjY5OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQ3Mjk4NA==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/699#discussion_r526472984", "bodyText": "same as before, do we have equivalent test coverage for the new method?", "author": "MikeDombo", "createdAt": "2020-11-18T22:43:46Z", "path": "src/test/java/com/aws/greengrass/deployment/converter/DeploymentDocumentConverterTest.java", "diffHunk": "@@ -213,36 +139,6 @@ void GIVEN_Full_Local_Override_Request_config_update_And_Current_Root_WHEN_conve\n         assertThat(DependencyComponentConfig.getResolvedVersion(), is(\"*\"));\n     }\n \n-    @Test\n-    void GIVEN_fleet_configuration_with_arn_WHEN_convert_to_deployment_doc_THEN_parse_successfully() {\n-        String configurationArn =\n-                Arn.builder().withPartition(\"aws\").withService(\"gg\").withResource(\"configuration:thing/test:1\").build()\n-                        .toString();\n-        Map<String, Object> configMapA = new HashMap<String, Object>() {{\n-            put(\"param1\", \"value1\");\n-        }};\n-        Map<String, Object> configMapB = new HashMap<String, Object>() {{\n-            put(\"param2\", singletonMap(\"foo\", \"bar\"));\n-        }};\n-        FleetConfiguration config =\n-                FleetConfiguration.builder().creationTimestamp(0L).packages(new HashMap<String, PackageInfo>() {{\n-                    put(\"pkgA\", new PackageInfo(true, \"1.0.0\", configMapA));\n-                    put(\"pkgB\", new PackageInfo(false, \"1.1.0\", configMapB));\n-                }}).componentUpdatePolicy(new ComponentUpdatePolicy().withAction(\"NOTIFY_COMPONENTS\").withTimeout(60))", "originalCommit": "ae79f461efead973f56a7f7dd4acfa13515901af", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "14aa882ad2ff768774fad0ea05b6a4a132615603", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/14aa882ad2ff768774fad0ea05b6a4a132615603", "message": "updated bench mark tests", "committedDate": "2020-11-18T23:17:44Z", "type": "commit"}, {"oid": "2a28230dbd353770351df54695e14ddabbb7958d", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/2a28230dbd353770351df54695e14ddabbb7958d", "message": "Merge branch 'master' into remove-parameters", "committedDate": "2020-11-18T23:24:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjUwNTQ2OQ==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/699#discussion_r526505469", "bodyText": "and this", "author": "leaf94", "createdAt": "2020-11-19T00:08:03Z", "path": "src/main/java/com/aws/greengrass/componentmanager/KernelConfigResolver.java", "diffHunk": "@@ -571,125 +532,6 @@ private String lookupSystemConfig(ComponentIdentifier component, String namespac\n \n     /**** end of new configuration code path. Most of below are all deprecated and will be remove soon ****/", "originalCommit": "2a28230dbd353770351df54695e14ddabbb7958d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjUxMTkyNQ==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/699#discussion_r526511925", "bodyText": "removed", "author": "fahadmohammed01", "createdAt": "2020-11-19T00:27:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjUwNTQ2OQ=="}], "type": "inlineReview"}, {"oid": "133b1d530cf4d5ed194dd402f338a49a46be9dc8", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/133b1d530cf4d5ed194dd402f338a49a46be9dc8", "message": "removed comment", "committedDate": "2020-11-19T00:27:05Z", "type": "commit"}, {"oid": "0c8e617b0190cad3268f652dcc1115ff65724539", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/0c8e617b0190cad3268f652dcc1115ff65724539", "message": "addressed pr comment", "committedDate": "2020-11-19T00:42:56Z", "type": "commit"}, {"oid": "0ee9666c761149b0ebb305ccb8749ce118234a80", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/0ee9666c761149b0ebb305ccb8749ce118234a80", "message": "fixed pmd", "committedDate": "2020-11-19T00:48:36Z", "type": "commit"}, {"oid": "138fd850aed67e40c08c6aa264e8a901f8400fa7", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/138fd850aed67e40c08c6aa264e8a901f8400fa7", "message": "removed old interpolation format", "committedDate": "2020-11-19T20:42:37Z", "type": "commit"}, {"oid": "8c562a48ab5c1a5c726b72d643d5acef44ef044e", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/8c562a48ab5c1a5c726b72d643d5acef44ef044e", "message": "Merge branch 'master' into remove-parameters", "committedDate": "2020-11-19T20:46:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzIwMzE0NQ==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/699#discussion_r527203145", "bodyText": "does this need to be public if it is used for testing? could it be package private? or tests updated to use the builder?", "author": "rbattle", "createdAt": "2020-11-19T21:15:10Z", "path": "src/main/java/com/aws/greengrass/deployment/model/DeploymentPackageConfiguration.java", "diffHunk": "@@ -41,30 +39,23 @@\n     @JsonProperty(\"ResolvedVersion\")\n     private String resolvedVersion;\n \n-    @Deprecated\n-    @JsonProperty(\"Configuration\")\n-    private Map<String, Object> configuration = new HashMap<>();\n-\n     @JsonProperty(\"ConfigurationUpdate\")\n     private ConfigurationUpdateOperation configurationUpdateOperation;\n \n     @JsonProperty(\"RunWith\")\n     private RunWith runWith;\n \n     /**\n-     * Constructor for no update configuration update for backward compatibility.\n+     * Constructor for no update configuration update. Used for testing\n      *\n      * @param packageName     name of package\n      * @param rootComponent   if it is root\n      * @param resolvedVersion resolved version\n-     * @param configuration   configuration\n      */\n-    public DeploymentPackageConfiguration(String packageName, boolean rootComponent, String resolvedVersion,\n-            Map<String, Object> configuration) {\n+    public DeploymentPackageConfiguration(String packageName, boolean rootComponent, String resolvedVersion) {", "originalCommit": "8c562a48ab5c1a5c726b72d643d5acef44ef044e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzI2NzY0OQ==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/699#discussion_r527267649", "bodyText": "This used at multiple places, we can move to private once the test are use builder. but I would prefer to do that later.", "author": "fahadmohammed01", "createdAt": "2020-11-19T23:15:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzIwMzE0NQ=="}], "type": "inlineReview"}, {"oid": "6d63dd3449eaf1920eabd6e8bcfcae0fc85f3f7d", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/6d63dd3449eaf1920eabd6e8bcfcae0fc85f3f7d", "message": "updated tests", "committedDate": "2020-11-20T00:03:37Z", "type": "commit"}]}