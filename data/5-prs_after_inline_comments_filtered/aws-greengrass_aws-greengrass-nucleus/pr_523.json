{"pr_number": 523, "pr_title": "Add version to command line, CLI support for recipes in json and not \u2026", "pr_createdAt": "2020-10-13T23:29:56Z", "pr_url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/523", "timeline": [{"oid": "2ec588d1d1485bef06a4285af2fbf58f319a72a7", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/2ec588d1d1485bef06a4285af2fbf58f319a72a7", "message": "Add version to command line, CLI support for recipes in json and not precicely named files", "committedDate": "2020-10-13T23:31:48Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDMxNzMwMg==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/523#discussion_r504317302", "bodyText": "What's the use-case of performing a partial update in case of read failure?", "author": "philcali", "createdAt": "2020-10-13T23:35:26Z", "path": "src/main/java/com/aws/greengrass/builtin/services/cli/CLIServiceAgent.java", "diffHunk": "@@ -241,6 +245,39 @@ public void updateRecipesAndArtifacts(UpdateRecipesAndArtifactsRequest request)\n         }\n     }\n \n+    private void copyRecipes(Path from, Path to) throws IOException {\n+        for (Path r : Files.walk(from).collect(Collectors.toList())) {\n+            String ext = Utils.extension(r.toString());\n+            ComponentRecipe recipe = null;\n+            try {\n+                switch (ext.toLowerCase()) {\n+                    case \"yaml\":\n+                    case \"yml\":\n+                        recipe = SerializerFactory.getRecipeSerializer().readValue(r.toFile(), ComponentRecipe.class);\n+                        break;\n+                    case \"json\":\n+                        recipe = SerializerFactory.getRecipeSerializerJson()\n+                                .readValue(r.toFile(), ComponentRecipe.class);\n+                        break;\n+                    default:\n+                        break;\n+                }\n+            } catch (IOException e) {\n+                logger.atError().log(\"Error reading recipe file from {}\", r, e);\n+            }\n+\n+            if (recipe == null) {\n+                continue;\n+            }", "originalCommit": "2ec588d1d1485bef06a4285af2fbf58f319a72a7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDMxOTIwNg==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/523#discussion_r504319206", "bodyText": "That may not be the recipe that they are caring about deploying", "author": "MikeDombo", "createdAt": "2020-10-13T23:42:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDMxNzMwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDMyMjMwOQ==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/523#discussion_r504322309", "bodyText": "Are we doing strict parsing? Failing on unknown fields and such?", "author": "philcali", "createdAt": "2020-10-13T23:52:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDMxNzMwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDMyMzc4Ng==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/523#discussion_r504323786", "bodyText": "Some fields are required and if they don't have it it would fail, but I think we're lenient with extra fields", "author": "MikeDombo", "createdAt": "2020-10-13T23:57:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDMxNzMwMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDMxODUzNA==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/523#discussion_r504318534", "bodyText": "Will customers understand --env-stage? Should we use --endpoint instead (like the SDK)?", "author": "philcali", "createdAt": "2020-10-13T23:39:42Z", "path": "src/main/java/com/aws/greengrass/easysetup/GreengrassSetup.java", "diffHunk": "@@ -51,6 +52,8 @@\n             + \"\\t--install-cli, -ic\\t\\tY/N Indicate if you want to install Greengrass device CLI\\n\"\n             + \"\\t--setup-system-service, -ss\\t\\tY/N Indicate if you want to setup Greengrass as a system service\\n\";", "originalCommit": "2ec588d1d1485bef06a4285af2fbf58f319a72a7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDMxOTc2NA==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/523#discussion_r504319764", "bodyText": "will probably undocument it for release. Customers will only use prod", "author": "MikeDombo", "createdAt": "2020-10-13T23:44:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDMxODUzNA=="}], "type": "inlineReview"}, {"oid": "8aa44eef66c393dc5a7d6e99386806359a8a3fe9", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/8aa44eef66c393dc5a7d6e99386806359a8a3fe9", "message": "Add version to command line, CLI support for recipes in json and not precicely named files", "committedDate": "2020-10-14T00:10:59Z", "type": "forcePushed"}, {"oid": "28f3ff473b8ec8435185f6dacce974b35647bb29", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/28f3ff473b8ec8435185f6dacce974b35647bb29", "message": "Add version to command line, CLI support for recipes in json and not precicely named files", "committedDate": "2020-10-14T06:49:07Z", "type": "commit"}, {"oid": "28f3ff473b8ec8435185f6dacce974b35647bb29", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/28f3ff473b8ec8435185f6dacce974b35647bb29", "message": "Add version to command line, CLI support for recipes in json and not precicely named files", "committedDate": "2020-10-14T06:49:07Z", "type": "forcePushed"}, {"oid": "452e2531626d1ff67fedebc3e71553428bb408ff", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/452e2531626d1ff67fedebc3e71553428bb408ff", "message": "Merge branch 'master' into nicer-cli", "committedDate": "2020-10-14T23:28:29Z", "type": "commit"}]}