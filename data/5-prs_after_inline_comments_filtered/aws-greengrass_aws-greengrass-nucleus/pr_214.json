{"pr_number": 214, "pr_title": "Fix race condition between reported state and actual state", "pr_createdAt": "2020-04-24T18:45:27Z", "pr_url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/214", "timeline": [{"oid": "80498ae9f58e4fe4949f7015c621a3cfd95494ce", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/80498ae9f58e4fe4949f7015c621a3cfd95494ce", "message": "Fix race condition between reported state and actual state", "committedDate": "2020-04-24T19:18:15Z", "type": "commit"}, {"oid": "80498ae9f58e4fe4949f7015c621a3cfd95494ce", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/80498ae9f58e4fe4949f7015c621a3cfd95494ce", "message": "Fix race condition between reported state and actual state", "committedDate": "2020-04-24T19:18:15Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDg3NjM1NQ==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/214#discussion_r414876355", "bodyText": "I think you can have an AtomicReference to keep track of last reported state", "author": "ShirleyZheng92", "createdAt": "2020-04-24T21:34:27Z", "path": "src/main/java/com/aws/iot/evergreen/kernel/Lifecycle.java", "diffHunk": "@@ -672,4 +672,9 @@ final void requestStop() {\n             desiredStateList.add(State.FINISHED);\n         }\n     }\n+\n+    Optional<State> lastReportedState() {", "originalCommit": "80498ae9f58e4fe4949f7015c621a3cfd95494ce", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDg4Mjc4MQ==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/214#discussion_r414882781", "bodyText": "Although that would be faster, I'm not sure how to make it be correct. Because I really only want this to return the last reported state if there is any, otherwise my method which uses this would return the wrong answer. If I switched it to an atomic ref, I don't know when to reset it to null.", "author": "MikeDombo", "createdAt": "2020-04-24T21:48:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDg3NjM1NQ=="}], "type": "inlineReview"}]}