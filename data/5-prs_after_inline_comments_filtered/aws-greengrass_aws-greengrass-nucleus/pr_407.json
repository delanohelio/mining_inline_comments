{"pr_number": 407, "pr_title": "Persist dependencies, do not autostart non-autostarts", "pr_createdAt": "2020-09-01T20:01:04Z", "pr_url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/407", "timeline": [{"oid": "b599fc461b6cf1da755d25ec60007018c3c523d2", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/b599fc461b6cf1da755d25ec60007018c3c523d2", "message": "Persist dependencies, do not autostart non-autostarts", "committedDate": "2020-09-01T20:03:33Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTQwMTI4NQ==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/407#discussion_r481401285", "bodyText": "Why only start the autostart service?", "author": "fengwang666", "createdAt": "2020-09-01T20:08:07Z", "path": "src/main/java/com/aws/iot/evergreen/kernel/KernelLifecycle.java", "diffHunk": "@@ -160,7 +160,8 @@ void initConfigAndTlog() {\n      * Make all services startup in order.\n      */\n     public void startupAllServices() {\n-        kernel.orderedDependencies().forEach(EvergreenService::requestStart);\n+        kernel.orderedDependencies().stream().filter(EvergreenService::shouldAutoStart)\n+                .forEach(EvergreenService::requestStart);", "originalCommit": "b599fc461b6cf1da755d25ec60007018c3c523d2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTQwMjIyOQ==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/407#discussion_r481402229", "bodyText": "This prevents on-demand lambdas from starting. All services return true for this, except for on-demand lambdas. We use the same logic during deployment to prevent us from starting the on-demand lambda during deployment.", "author": "MikeDombo", "createdAt": "2020-09-01T20:09:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTQwMTI4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTQwMzg3NQ==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/407#discussion_r481403875", "bodyText": "Okay. How is it distinguished from the autostart in the @ImplmentsService annotation?", "author": "fengwang666", "createdAt": "2020-09-01T20:13:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTQwMTI4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTQwNDg5NQ==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/407#discussion_r481404895", "bodyText": "That should basically be deprecated. That's only used by builtin services (services that are authored in the kernel repo). It is entirely separate.", "author": "MikeDombo", "createdAt": "2020-09-01T20:15:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTQwMTI4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTQwNTUzNQ==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/407#discussion_r481405535", "bodyText": "They are also started by this method, and their shouldAutoStart returns true (unless they override it, which none have)", "author": "MikeDombo", "createdAt": "2020-09-01T20:16:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTQwMTI4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTQwNzIwMQ==", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/pull/407#discussion_r481407201", "bodyText": "That should basically be deprecated. That's only used by builtin services (services that are authored in the kernel repo). It is entirely separate.\n\nOkay. Let's create a task to deprecate it. Right now it's confusing.", "author": "fengwang666", "createdAt": "2020-09-01T20:19:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTQwMTI4NQ=="}], "type": "inlineReview"}, {"oid": "d6c3cc4535b95cb7ce23de5d9021d16b75f6595f", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/d6c3cc4535b95cb7ce23de5d9021d16b75f6595f", "message": "Persist dependencies, do not autostart non-autostarts", "committedDate": "2020-09-01T20:13:22Z", "type": "forcePushed"}, {"oid": "595fecdfdf0a779c2372b7e92314b4619c83ea60", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/595fecdfdf0a779c2372b7e92314b4619c83ea60", "message": "Persist dependencies, do not autostart non-autostarts", "committedDate": "2020-09-01T20:49:17Z", "type": "commit"}, {"oid": "595fecdfdf0a779c2372b7e92314b4619c83ea60", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/595fecdfdf0a779c2372b7e92314b4619c83ea60", "message": "Persist dependencies, do not autostart non-autostarts", "committedDate": "2020-09-01T20:49:17Z", "type": "forcePushed"}, {"oid": "4663c608a1262960d0ccd6146b1199f186dca824", "url": "https://github.com/aws-greengrass/aws-greengrass-nucleus/commit/4663c608a1262960d0ccd6146b1199f186dca824", "message": "Merge branch 'master' into dep", "committedDate": "2020-09-01T21:25:09Z", "type": "commit"}]}