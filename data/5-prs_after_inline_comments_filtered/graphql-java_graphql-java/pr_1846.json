{"pr_number": 1846, "pr_title": "#1845: Implemented optimized FieldCoordinates creation methods", "pr_createdAt": "2020-04-03T20:44:13Z", "pr_url": "https://github.com/graphql-java/graphql-java/pull/1846", "timeline": [{"oid": "be101aab6ef5dfa9247f6fc315d31e4c2a637ebb", "url": "https://github.com/graphql-java/graphql-java/commit/be101aab6ef5dfa9247f6fc315d31e4c2a637ebb", "message": "#1845: Implemented optimized FieldCoordinates creation methods\n\nDescription:\nImplemented versions of FieldCoordinates creation methods that\ndo not perform validation in order to optimize performance.  This is\nto allow for cases that need to create field coordinates that are\nalready known to be valid and need to optimize for performance.\n\nChanges:\n* Added optmized FieldCoordinates.coordinates method\n* Added optmized FieldCoordinates.systemCoordinates method\n\nUnit Tests:\n* Added FieldCoordinates.groovy file to test all cases for\nFieldCoordinates creation", "committedDate": "2020-04-03T20:40:35Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzQzNjM2MA==", "url": "https://github.com/graphql-java/graphql-java/pull/1846#discussion_r403436360", "bodyText": "As discussed - pleake make this private (and hence no need for the javadoc)", "author": "bbakerman", "createdAt": "2020-04-04T07:12:44Z", "path": "src/main/java/graphql/schema/FieldCoordinates.java", "diffHunk": "@@ -88,8 +108,28 @@ public static FieldCoordinates coordinates(String parentType, String fieldName)\n      * @return the coordinates\n      */\n     public static FieldCoordinates systemCoordinates(String fieldName) {\n-        assertTrue(fieldName.startsWith(\"__\"), \"Only __ system fields can be addressed without a parent type\");\n-        assertValidName(fieldName);\n+        return systemCoordinates(fieldName, true);\n+    }\n+\n+    /**\n+     * The exception to the general rule is the system __xxxx Introspection fields which have no parent type and\n+     * are able to be specified on any type.\n+     *\n+     * Note:  Whether or not validation is run depends on the {@code validate} boolean flag.  This method should only\n+     *   be used in non-validation mode in cases where it's known that the values passed have been previously\n+     *   validated.  That is, when those values are from objects such as {@code GraphQLFieldDefinition},\n+     *   {@code GraphQLNamedOutputType}, etc.  The reason for this is to optimize the creation of the FieldCoordinates\n+     *   object as validation can have a large impact on performance.\n+     *\n+     * @param fieldName the name of the system field which MUST start with __\n+     *\n+     * @return the coordinates\n+     */\n+    public static FieldCoordinates systemCoordinates(String fieldName, boolean validate) {", "originalCommit": "be101aab6ef5dfa9247f6fc315d31e4c2a637ebb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzQzNjQxOA==", "url": "https://github.com/graphql-java/graphql-java/pull/1846#discussion_r403436418", "bodyText": "The reason for this is to optimize the creation of the FieldCoordinates\n*   object as validation can have a large impact on performance.\n\nDo you have any concrete evidence of the cost of these look ups?  I know regexes can be slow but I would love to see real perf data in how this lookup is used in real life.", "author": "bbakerman", "createdAt": "2020-04-04T07:13:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzQzNjM2MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzQzNjQ2Nw==", "url": "https://github.com/graphql-java/graphql-java/pull/1846#discussion_r403436467", "bodyText": "Make this private as discussed and hence remove the JavaDoc", "author": "bbakerman", "createdAt": "2020-04-04T07:13:53Z", "path": "src/main/java/graphql/schema/FieldCoordinates.java", "diffHunk": "@@ -74,8 +74,28 @@ public static FieldCoordinates coordinates(GraphQLFieldsContainer parentType, Gr\n      * @return new field coordinates represented by the two parameters\n      */\n     public static FieldCoordinates coordinates(String parentType, String fieldName) {\n-        assertValidName(parentType);\n-        assertValidName(fieldName);\n+        return coordinates(parentType, fieldName, true);\n+    }\n+\n+    /**\n+     * Creates new field coordinates.\n+     *\n+     * Note:  Whether or not validation is run depends on the {@code validate} boolean flag.  This method should only\n+     *   be used in non-validation mode in cases where it's known that the values passed have been previously\n+     *   validated.  That is, when those values are from objects such as {@code GraphQLFieldDefinition},\n+     *   {@code GraphQLNamedOutputType}, etc.  The reason for this is to optimize the creation of the FieldCoordinates\n+     *   object as validation can have a large impact on performance.\n+     *\n+     * @param parentType the container of the field\n+     * @param fieldName  the field name\n+     *\n+     * @return new field coordinates represented by the two parameters\n+     */\n+    public static FieldCoordinates coordinates(String parentType, String fieldName, boolean validate) {", "originalCommit": "be101aab6ef5dfa9247f6fc315d31e4c2a637ebb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "5405e32ad98b8afc232ca383b17b118821483332", "url": "https://github.com/graphql-java/graphql-java/commit/5405e32ad98b8afc232ca383b17b118821483332", "message": "#1845: Updated field coordinates implementation based on feedback\n\nDescription:\nUpdated optimized field coordinates implementation based on feedback\nfrom @bbakerman.  New implementation moves validation checks to the\nGraphQLCodeRegistry.  See below for details.\n\nChanges:\n* Removed validation from FieldCoordinates.coordinates method\n* Removed validation from FieldCoordinates.systemCoordinates method\n* Added systemCoordinates boolean to FieldCoordinates constructor\n* Added FieldCoordinates.assertValidNames method. This method performs\nslightly different validation based on whether or not the coordinates\nare system coordinates or not.\n* Updated GraphQLCodeRegistry data fetcher and system data fetcher\nmethods to make use of assertValidNames\n\nUnit Tests:\n* Updated FieldCoordinates.groovy file to test all cases for\nFieldCoordinates creation and validation", "committedDate": "2020-04-07T16:53:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDk2Njg1Mg==", "url": "https://github.com/graphql-java/graphql-java/pull/1846#discussion_r404966852", "bodyText": "Note:  I chose to go with a method that asserts rather than return a boolean because currently the name validation is handled by the GraphQL assert classes.  I didn't want to expose that here and I didn't want to catch the exception so I can return the boolean and then have the GraphQLCodeRegistry methods call AssertTrue() again.", "author": "fvilla-amazon", "createdAt": "2020-04-07T16:58:49Z", "path": "src/main/java/graphql/schema/FieldCoordinates.java", "diffHunk": "@@ -30,6 +33,25 @@ public String getFieldName() {\n         return fieldName;\n     }\n \n+\n+    /**\n+     * Checks the validity of the field coordinate names.  The validity checks vary by coordinate type.  Standard\n+     * coordinates validate both the {@code typeName} and {@code fieldName}, while system coordinates do not have\n+     * a parent so they only validate the {@code fieldName}.\n+     *\n+     * @throws AssertException if the coordinates are NOT valid; otherwise, returns normally.\n+     */\n+    public void assertValidNames() throws AssertException {", "originalCommit": "5405e32ad98b8afc232ca383b17b118821483332", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDk2NzY4Nw==", "url": "https://github.com/graphql-java/graphql-java/pull/1846#discussion_r404967687", "bodyText": "I'm not sure whether this is correct or not.  I'm making the assumption that if the parent type has no name or the name is empty that we should consider this a system coordinate, similar to what is done in the string method", "author": "fvilla-amazon", "createdAt": "2020-04-07T16:59:58Z", "path": "src/main/java/graphql/schema/FieldCoordinates.java", "diffHunk": "@@ -62,7 +84,9 @@ public String toString() {\n      * @return new field coordinates represented by the two parameters\n      */\n     public static FieldCoordinates coordinates(GraphQLFieldsContainer parentType, GraphQLFieldDefinition fieldDefinition) {\n-        return new FieldCoordinates(parentType.getName(), fieldDefinition.getName());\n+        final String parentTypeName = parentType.getName();\n+        return new FieldCoordinates(parentTypeName, fieldDefinition.getName(),\n+                (null == parentTypeName) || parentTypeName.isEmpty());", "originalCommit": "5405e32ad98b8afc232ca383b17b118821483332", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjA5MzM3Ng==", "url": "https://github.com/graphql-java/graphql-java/pull/1846#discussion_r406093376", "bodyText": "Just put false\nThe only true way to create a system coord is this method\n    public static FieldCoordinates systemCoordinates(String fieldName)", "author": "bbakerman", "createdAt": "2020-04-09T09:58:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDk2NzY4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjA5Mzk5NA==", "url": "https://github.com/graphql-java/graphql-java/pull/1846#discussion_r406093994", "bodyText": "Please fix this one and this fix is ready to go", "author": "bbakerman", "createdAt": "2020-04-09T09:59:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDk2NzY4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjM4MzQxNQ==", "url": "https://github.com/graphql-java/graphql-java/pull/1846#discussion_r406383415", "bodyText": "Thanks, will do.", "author": "fvilla-amazon", "createdAt": "2020-04-09T18:06:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDk2NzY4Nw=="}], "type": "inlineReview"}, {"oid": "5d46637296a548beaa3cd0f2c69630ac5f5822bd", "url": "https://github.com/graphql-java/graphql-java/commit/5d46637296a548beaa3cd0f2c69630ac5f5822bd", "message": "#1845: Updated cases that are allowed to create system coordinates\n\nDescription:\nUpdated optimized field coordinates implementation based on feedback\nfrom @bbakerman.  New implementation makes it so only FieldCoordinates.\nsystemCoordinates can create systemCoordinates.  See below for details.\n\nChanges:\n* Updated FieldCoordinates.coordinates(GraphQLFieldsContainer,\nGraphQLFieldDefinition) to set systemCoordinates boolean to false since\nonly FieldCoordinates.systemCoordinates(...) can create system\ncoordinates\n\nUnit Tests:\n* Validated, but no additional changes required to tests", "committedDate": "2020-04-09T18:19:53Z", "type": "commit"}]}