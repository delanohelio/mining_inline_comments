{"pr_number": 2074, "pr_title": "avoiding allocations in FieldCollectorParameters and MergedField", "pr_createdAt": "2020-10-15T06:16:15Z", "pr_url": "https://github.com/graphql-java/graphql-java/pull/2074", "timeline": [{"oid": "ae46a409f02959670fb54f0198598a3492fd0e07", "url": "https://github.com/graphql-java/graphql-java/commit/ae46a409f02959670fb54f0198598a3492fd0e07", "message": "avoiding LinkedHashMap allocations", "committedDate": "2020-10-15T06:04:35Z", "type": "commit"}, {"oid": "ee6ed0dd8ae6f36b36608a755159dff6b59d0911", "url": "https://github.com/graphql-java/graphql-java/commit/ee6ed0dd8ae6f36b36608a755159dff6b59d0911", "message": "avoiding ArrayList allocations\n\nArrayList allocated in the Builder never escapes the builder, so\nit is possible to avoid one copy in the private ctor", "committedDate": "2020-10-15T07:05:20Z", "type": "commit"}, {"oid": "ee6ed0dd8ae6f36b36608a755159dff6b59d0911", "url": "https://github.com/graphql-java/graphql-java/commit/ee6ed0dd8ae6f36b36608a755159dff6b59d0911", "message": "avoiding ArrayList allocations\n\nArrayList allocated in the Builder never escapes the builder, so\nit is possible to avoid one copy in the private ctor", "committedDate": "2020-10-15T07:05:20Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTI0MTgwMA==", "url": "https://github.com/graphql-java/graphql-java/pull/2074#discussion_r505241800", "bodyText": "used only in tests, could be a breaking change.\nMaybe this is the root cause of the additional copy that I've just removed in the constructor.", "author": "dfa1", "createdAt": "2020-10-15T07:08:49Z", "path": "src/main/java/graphql/execution/MergedField.java", "diffHunk": "@@ -155,7 +156,7 @@ private Builder(MergedField existing) {\n         }\n \n         public Builder fields(List<Field> fields) {\n-            this.fields = fields;\n+            this.fields.addAll(fields);\n             return this;", "originalCommit": "ee6ed0dd8ae6f36b36608a755159dff6b59d0911", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzY1ODQwOQ==", "url": "https://github.com/graphql-java/graphql-java/pull/2074#discussion_r507658409", "bodyText": "This is a tricky one - generally we try for more immutable classes and hence by \"copying\" we gain some control in mutable Java land\nHowever as this class is repeatedly called, we probably need to change this general pattern if we see evidence that it costs us.", "author": "bbakerman", "createdAt": "2020-10-19T11:02:25Z", "path": "src/main/java/graphql/execution/FieldCollectorParameters.java", "diffHunk": "@@ -70,12 +69,12 @@ public Builder objectType(GraphQLObjectType objectType) {\n         }\n \n         public Builder fragments(Map<String, FragmentDefinition> fragmentsByName) {\n-            this.fragmentsByName.putAll(fragmentsByName);\n+            this.fragmentsByName = fragmentsByName;\n             return this;\n         }\n \n         public Builder variables(Map<String, Object> variables) {\n-            this.variables.putAll(variables);\n+            this.variables = variables;\n             return this;", "originalCommit": "ee6ed0dd8ae6f36b36608a755159dff6b59d0911", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzY5MDYwMQ==", "url": "https://github.com/graphql-java/graphql-java/pull/2074#discussion_r507690601", "bodyText": "yes, I'm not sure too. I did that because the class is marked as @internal (so we may have more freedom) but I know that it is against the pattern mutable/builder -> immutable/built object.\nIt looks like it is always called with ExecutionContext data, that is unmodifiable.", "author": "dfa1", "createdAt": "2020-10-19T12:02:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzY1ODQwOQ=="}], "type": "inlineReview"}]}