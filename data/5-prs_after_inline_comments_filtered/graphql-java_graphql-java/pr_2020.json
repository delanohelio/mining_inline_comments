{"pr_number": 2020, "pr_title": "pre-sizing internal data structures", "pr_createdAt": "2020-09-05T14:32:05Z", "pr_url": "https://github.com/graphql-java/graphql-java/pull/2020", "timeline": [{"oid": "462bb1b8611dd7d27ea862f2692ec2011397d1c1", "url": "https://github.com/graphql-java/graphql-java/commit/462bb1b8611dd7d27ea862f2692ec2011397d1c1", "message": "pre-sizing internal data structures\n\nHelps to reduce garbage collector pressure and memory usage in general by avoiding some re-allocations of j.u.ArrayList and j.u.LinkedHashMap.", "committedDate": "2020-09-05T14:23:58Z", "type": "commit"}, {"oid": "7741fe87179d1820bf69aad1805c1d3a33f41fe7", "url": "https://github.com/graphql-java/graphql-java/commit/7741fe87179d1820bf69aad1805c1d3a33f41fe7", "message": "redundant addAll()/putAll()", "committedDate": "2020-09-05T18:33:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjg5MDY1MQ==", "url": "https://github.com/graphql-java/graphql-java/pull/2020#discussion_r542890651", "bodyText": "I know this PR has already been merged and closed, and the issue is perfectly ignorable, but wanted to point out that sizing a map to an exact number of elements is generally a bad idea. With the default load factor of 0.75, sizing a map like this guarantees a need for resizing.", "author": "kaqqao", "createdAt": "2020-12-14T22:45:21Z", "path": "src/main/java/graphql/execution/AbstractAsyncExecutionStrategy.java", "diffHunk": "@@ -32,7 +32,7 @@ public AbstractAsyncExecutionStrategy(DataFetcherExceptionHandler dataFetcherExc\n                 handleNonNullException(executionContext, overallResult, exception);\n                 return;\n             }\n-            Map<String, Object> resolvedValuesByField = new LinkedHashMap<>();\n+            Map<String, Object> resolvedValuesByField = new LinkedHashMap<>(fieldNames.size());", "originalCommit": "7741fe87179d1820bf69aad1805c1d3a33f41fe7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzA3ODUyMw==", "url": "https://github.com/graphql-java/graphql-java/pull/2020#discussion_r543078523", "bodyText": "feedback is always welcome @kaqqao  :)\nThe intent of the PR wasn't to avoid resizing at all costs but rather to avoid  wasting memory for ExecutionResult. If size is not provided, even for a single element map, LinkedHashMap will allocate a 16-elements array (because DEFAULT_INITIAL_CAPACITY=16).\nMaybe it is possible to further improve it by requesting loadFactor=1.0?", "author": "dfa1", "createdAt": "2020-12-15T06:24:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjg5MDY1MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzA4MDM5OQ==", "url": "https://github.com/graphql-java/graphql-java/pull/2020#discussion_r543080399", "bodyText": "NB: in my project I'm overriding this method to use a custom ImmutableArrayMap (no hashing, order is guaranteed by just appending and uniqueness of the keys is guaranteed by GQL).  Why? Because in my project we just send back the ExecutionResult as is to the client and in this way we are not wasting memory.", "author": "dfa1", "createdAt": "2020-12-15T06:29:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjg5MDY1MQ=="}], "type": "inlineReview"}]}