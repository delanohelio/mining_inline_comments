{"pr_number": 1941, "pr_title": "Empi 70 phonetic indexing", "pr_createdAt": "2020-06-23T21:13:46Z", "pr_url": "https://github.com/hapifhir/hapi-fhir/pull/1941", "timeline": [{"oid": "d93f76b326e5a68e64e905249f0c05f24fa6de75", "url": "https://github.com/hapifhir/hapi-fhir/commit/d93f76b326e5a68e64e905249f0c05f24fa6de75", "message": "start with failing test", "committedDate": "2020-06-23T17:47:53Z", "type": "commit"}, {"oid": "253690020ea28d100f72b4da6afaa45fb0754197", "url": "https://github.com/hapifhir/hapi-fhir/commit/253690020ea28d100f72b4da6afaa45fb0754197", "message": "test passes with fixmes", "committedDate": "2020-06-23T18:39:13Z", "type": "commit"}, {"oid": "eecf124178e19f27fb78cbd8e250a07b741490a9", "url": "https://github.com/hapifhir/hapi-fhir/commit/eecf124178e19f27fb78cbd8e250a07b741490a9", "message": "javadoc and config", "committedDate": "2020-06-23T21:10:11Z", "type": "commit"}, {"oid": "8bd295335b3c36d6fc895e1c9f95d0928afb31fd", "url": "https://github.com/hapifhir/hapi-fhir/commit/8bd295335b3c36d6fc895e1c9f95d0928afb31fd", "message": "pre-review cleanup", "committedDate": "2020-06-23T21:12:58Z", "type": "commit"}, {"oid": "73966f00ffe7ba5abb681a9c9b1e47f972462832", "url": "https://github.com/hapifhir/hapi-fhir/commit/73966f00ffe7ba5abb681a9c9b1e47f972462832", "message": "Merge remote-tracking branch 'remotes/origin/master' into empi-70-phonetic-indexing", "committedDate": "2020-06-25T19:39:23Z", "type": "commit"}, {"oid": "95c2320cb01f8bdb92cf99111a05585059a9841c", "url": "https://github.com/hapifhir/hapi-fhir/commit/95c2320cb01f8bdb92cf99111a05585059a9841c", "message": "generalize encoding", "committedDate": "2020-06-25T22:36:35Z", "type": "commit"}, {"oid": "9fafae59fb0cd8723ad7c14059eb1c928f61ce5d", "url": "https://github.com/hapifhir/hapi-fhir/commit/9fafae59fb0cd8723ad7c14059eb1c928f61ce5d", "message": "test passes, but indexing needs to be optimized", "committedDate": "2020-06-25T23:19:43Z", "type": "commit"}, {"oid": "9694e7eb738d5923ce00a8decbbb78a5ea926f8e", "url": "https://github.com/hapifhir/hapi-fhir/commit/9694e7eb738d5923ce00a8decbbb78a5ea926f8e", "message": "test passes, but indexing needs to be optimized", "committedDate": "2020-06-25T23:19:50Z", "type": "commit"}, {"oid": "ed7548c2b6c2493fe993bd9cff686ad8c5987c7e", "url": "https://github.com/hapifhir/hapi-fhir/commit/ed7548c2b6c2493fe993bd9cff686ad8c5987c7e", "message": "step 1 of optimization.  big refactor of all predicates", "committedDate": "2020-06-26T00:49:10Z", "type": "commit"}, {"oid": "6040857ac10ecbb8e47508d6056272cf4d6c7378", "url": "https://github.com/hapifhir/hapi-fhir/commit/6040857ac10ecbb8e47508d6056272cf4d6c7378", "message": "step 2 of optimization: determine phonetic encoder at time of RuntimeSearchParam creation", "committedDate": "2020-06-26T13:33:17Z", "type": "commit"}, {"oid": "bccd3a043fa9e9b855e6c714917151f0c6325968", "url": "https://github.com/hapifhir/hapi-fhir/commit/bccd3a043fa9e9b855e6c714917151f0c6325968", "message": "Merge remote-tracking branch 'remotes/origin/master' into empi-70-phonetic-indexing", "committedDate": "2020-06-26T13:33:34Z", "type": "commit"}, {"oid": "e5dcb192a9941d2b4ffd411e796031778feacd79", "url": "https://github.com/hapifhir/hapi-fhir/commit/e5dcb192a9941d2b4ffd411e796031778feacd79", "message": "integrated new phonetic encoders into empi", "committedDate": "2020-06-26T18:29:44Z", "type": "commit"}, {"oid": "7350005865965b9d22b3db7c752c6a010712683b", "url": "https://github.com/hapifhir/hapi-fhir/commit/7350005865965b9d22b3db7c752c6a010712683b", "message": "phonetic search implemented", "committedDate": "2020-06-27T00:10:27Z", "type": "commit"}, {"oid": "1ac73c0fa2783593ba0e66fa762e945fa6b0fbaf", "url": "https://github.com/hapifhir/hapi-fhir/commit/1ac73c0fa2783593ba0e66fa762e945fa6b0fbaf", "message": "IT passes", "committedDate": "2020-06-27T21:19:18Z", "type": "commit"}, {"oid": "53e491eb4dc3d7a4e2f81322971e1fc4877a8e62", "url": "https://github.com/hapifhir/hapi-fhir/commit/53e491eb4dc3d7a4e2f81322971e1fc4877a8e62", "message": "Merge remote-tracking branch 'remotes/origin/master' into empi-70-phonetic-indexing", "committedDate": "2020-06-27T21:22:18Z", "type": "commit"}, {"oid": "d976d0d4e23b9ee7a7c33cc04bfe1693b2c73939", "url": "https://github.com/hapifhir/hapi-fhir/commit/d976d0d4e23b9ee7a7c33cc04bfe1693b2c73939", "message": "pre-review cleanup", "committedDate": "2020-06-28T00:45:04Z", "type": "commit"}, {"oid": "9702a0737fb17cb037ae1767ab0b4a04827b0331", "url": "https://github.com/hapifhir/hapi-fhir/commit/9702a0737fb17cb037ae1767ab0b4a04827b0331", "message": "final pre-review cleanup", "committedDate": "2020-06-28T01:27:33Z", "type": "commit"}, {"oid": "8eb4f3e309874cc6858bdff9549ab8499bfd2ad9", "url": "https://github.com/hapifhir/hapi-fhir/commit/8eb4f3e309874cc6858bdff9549ab8499bfd2ad9", "message": "final pre-review cleanup", "committedDate": "2020-06-28T01:58:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk1OTQ1MQ==", "url": "https://github.com/hapifhir/hapi-fhir/pull/1941#discussion_r446959451", "bodyText": "Whoa, you can do a soundex on an address line?! Cool...\nI'm assuming it normalizes the word component and leaves the numbers or something?", "author": "jamesagnew", "createdAt": "2020-06-29T13:11:57Z", "path": "hapi-fhir-jpaserver-base/src/test/java/ca/uhn/fhir/jpa/dao/dstu3/FhirResourceDaoDstu3PhoneticSearchNoFtTest.java", "diffHunk": "@@ -0,0 +1,135 @@\n+package ca.uhn.fhir.jpa.dao.dstu3;\n+\n+import ca.uhn.fhir.context.phonetic.ApacheEncoder;\n+import ca.uhn.fhir.context.phonetic.PhoneticEncoderEnum;\n+import ca.uhn.fhir.jpa.api.config.DaoConfig;\n+import ca.uhn.fhir.jpa.model.entity.ResourceIndexedSearchParamString;\n+import ca.uhn.fhir.jpa.model.util.JpaConstants;\n+import ca.uhn.fhir.jpa.searchparam.SearchParameterMap;\n+import ca.uhn.fhir.jpa.searchparam.registry.ISearchParamRegistry;\n+import ca.uhn.fhir.rest.param.StringParam;\n+import org.apache.commons.codec.language.Soundex;\n+import org.hl7.fhir.dstu3.model.Enumerations;\n+import org.hl7.fhir.dstu3.model.Patient;\n+import org.hl7.fhir.dstu3.model.SearchParameter;\n+import org.hl7.fhir.dstu3.model.StringType;\n+import org.hl7.fhir.instance.model.api.IIdType;\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+\n+import java.util.List;\n+import java.util.stream.Collectors;\n+\n+import static org.hamcrest.Matchers.contains;\n+import static org.hamcrest.Matchers.containsInAnyOrder;\n+import static org.hamcrest.Matchers.hasSize;\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNotEquals;\n+import static org.junit.Assert.assertThat;\n+\n+public class FhirResourceDaoDstu3PhoneticSearchNoFtTest extends BaseJpaDstu3Test {\n+\tprivate static final org.slf4j.Logger ourLog = org.slf4j.LoggerFactory.getLogger(FhirResourceDaoDstu3PhoneticSearchNoFtTest.class);\n+\tpublic static final String GALE = \"Gale\";\n+\tpublic static final String GAIL = \"Gail\";\n+\tpublic static final String NAME_SOUNDEX_SP = \"nameSoundex\";\n+\tpublic static final String ADDRESS_LINE_SOUNDEX_SP = \"addressLineSoundex\";\n+\tprivate static final String BOB = \"BOB\";\n+\tprivate static final String ADDRESS = \"123 Nohili St\";\n+\tprivate static final String ADDRESS_CLOSE = \"123 Nohily St\";\n+\tprivate static final String ADDRESS_FAR = \"123 College St\";\n+\n+\t@Autowired\n+\tISearchParamRegistry mySearchParamRegistry;\n+\n+\t@Before\n+\tpublic void beforeDisableResultReuse() {\n+\t\tmyDaoConfig.setIndexMissingFields(DaoConfig.IndexEnabledEnum.DISABLED);\n+\t\tmyDaoConfig.setReuseCachedSearchResultsForMillis(null);\n+\t\tmyDaoConfig.setFetchSizeDefaultMaximum(new DaoConfig().getFetchSizeDefaultMaximum());\n+\n+\t\tcreateSoundexSearchParameter(NAME_SOUNDEX_SP, PhoneticEncoderEnum.SOUNDEX, \"Patient.name\");\n+\t\tcreateSoundexSearchParameter(ADDRESS_LINE_SOUNDEX_SP, PhoneticEncoderEnum.SOUNDEX, \"Patient.address.line\");", "originalCommit": "8eb4f3e309874cc6858bdff9549ab8499bfd2ad9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk3MTU0MA==", "url": "https://github.com/hapifhir/hapi-fhir/pull/1941#discussion_r446971540", "bodyText": "I didn't test that.  That's a good point--I wouldn't be surprised if it stripped the numbers out.  I'll create a new task to test that and tweak as necessary.", "author": "fil512", "createdAt": "2020-06-29T13:29:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk1OTQ1MQ=="}], "type": "inlineReview"}, {"oid": "63ab9b6b5cce8e50b9614617e59f6b3b7d7e227f", "url": "https://github.com/hapifhir/hapi-fhir/commit/63ab9b6b5cce8e50b9614617e59f6b3b7d7e227f", "message": "Merge remote-tracking branch 'remotes/origin/master' into empi-70-phonetic-indexing", "committedDate": "2020-06-29T21:23:59Z", "type": "commit"}, {"oid": "b696d565734fd73a65f72567e181fe0aeba6b6b2", "url": "https://github.com/hapifhir/hapi-fhir/commit/b696d565734fd73a65f72567e181fe0aeba6b6b2", "message": "Merge branch 'master' into empi-70-phonetic-indexing", "committedDate": "2020-06-30T20:18:24Z", "type": "commit"}, {"oid": "9577a8e9a41cf192b0ec24798fffb78c47aad672", "url": "https://github.com/hapifhir/hapi-fhir/commit/9577a8e9a41cf192b0ec24798fffb78c47aad672", "message": "Fix compile error", "committedDate": "2020-06-30T20:36:32Z", "type": "commit"}]}