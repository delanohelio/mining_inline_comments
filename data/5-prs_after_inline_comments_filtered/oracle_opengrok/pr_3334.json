{"pr_number": 3334, "pr_title": "Speed up IndexDatabase.accept() by avoiding history lookup for files \u2026", "pr_createdAt": "2020-10-28T20:43:36Z", "pr_url": "https://github.com/oracle/opengrok/pull/3334", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzg2NTQwNQ==", "url": "https://github.com/oracle/opengrok/pull/3334#discussion_r513865405", "bodyText": "superfluous else?", "author": "idodeclare", "createdAt": "2020-10-29T01:37:21Z", "path": "opengrok-indexer/src/main/java/org/opengrok/indexer/index/IndexDatabase.java", "diffHunk": "@@ -843,19 +843,21 @@ private boolean accept(File file, AcceptSymlinkRet ret) {\n             return true;\n         }\n \n-        if (HistoryGuru.getInstance().hasHistory(file)) {\n-            // versioned files should always be accepted\n-            return true;\n-        }\n \n-        // this is an unversioned file, check if it should be indexed\n         RuntimeEnvironment env = RuntimeEnvironment.getInstance();\n-        boolean res = !env.isIndexVersionedFilesOnly();\n-        if (!res) {\n-            LOGGER.log(Level.FINER, \"not accepting unversioned {0}\",\n-                absolutePath);\n+        // Lookup history if indexing versioned files only.\n+        // Skip the lookup entirely (which is expensive) if unversioned files are allowed\n+        if (env.isIndexVersionedFilesOnly()) {\n+            if (HistoryGuru.getInstance().hasHistory(file)) {\n+                // versioned files should always be accepted\n+                return true;\n+            } else {", "originalCommit": "ca18fe81e28696e1efc5ae522566460b9613e889", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzg4MDg2Mg==", "url": "https://github.com/oracle/opengrok/pull/3334#discussion_r513880862", "bodyText": "updated.", "author": "azakkerman", "createdAt": "2020-10-29T02:13:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzg2NTQwNQ=="}], "type": "inlineReview"}, {"oid": "e5b8a16a793767f6876d5a2703056946a0d22a9e", "url": "https://github.com/oracle/opengrok/commit/e5b8a16a793767f6876d5a2703056946a0d22a9e", "message": "Speed up IndexDatabase.accept() by avoiding history lookup for files if unversioned files are allowed by the config.", "committedDate": "2020-10-29T01:59:09Z", "type": "commit"}, {"oid": "e5b8a16a793767f6876d5a2703056946a0d22a9e", "url": "https://github.com/oracle/opengrok/commit/e5b8a16a793767f6876d5a2703056946a0d22a9e", "message": "Speed up IndexDatabase.accept() by avoiding history lookup for files if unversioned files are allowed by the config.", "committedDate": "2020-10-29T01:59:09Z", "type": "forcePushed"}]}