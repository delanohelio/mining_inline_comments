{"pr_number": 3200, "pr_title": "introduce command timeout types", "pr_createdAt": "2020-08-31T19:18:31Z", "pr_url": "https://github.com/oracle/opengrok/pull/3200", "timeline": [{"oid": "de698c4e0851dd700b852933eaf5294549ce2f39", "url": "https://github.com/oracle/opengrok/commit/de698c4e0851dd700b852933eaf5294549ce2f39", "message": "introduce CommandTimeoutType\n\nfixes #3146", "committedDate": "2020-08-31T09:24:02Z", "type": "commit"}, {"oid": "2739a693d632219fc9847688d762477095113ba2", "url": "https://github.com/oracle/opengrok/commit/2739a693d632219fc9847688d762477095113ba2", "message": "report command duration via Statistics", "committedDate": "2020-08-31T18:46:18Z", "type": "commit"}, {"oid": "acb0e685834ecd54cd8e47e665d0b5dd7f0fc471", "url": "https://github.com/oracle/opengrok/commit/acb0e685834ecd54cd8e47e665d0b5dd7f0fc471", "message": "report index time of files with Level.FINEST", "committedDate": "2020-09-02T09:35:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDIzNjMwMA==", "url": "https://github.com/oracle/opengrok/pull/3200#discussion_r490236300", "bodyText": "Would not IllegalArgumentException make more sense? InvalidParameterException is from security package and is not that commonly used.", "author": "ahornace", "createdAt": "2020-09-17T13:18:22Z", "path": "opengrok-indexer/src/main/java/org/opengrok/indexer/configuration/RuntimeEnvironment.java", "diffHunk": "@@ -227,29 +228,59 @@ public void setNestingMaximum(int nestingMaximum) {\n         syncWriteConfiguration(nestingMaximum, Configuration::setNestingMaximum);\n     }\n \n-    public int getCommandTimeout() {\n-        return syncReadConfiguration(Configuration::getCommandTimeout);\n+    public int getCommandTimeout(CommandTimeoutType cmdType) {\n+        switch (cmdType) {\n+            case INDEXER:\n+                return getIndexerCommandTimeout();\n+            case INTERACTIVE:\n+                return getInteractiveCommandTimeout();\n+            case WEBAPP_START:\n+                return getWebappStartCommandTimeout();\n+            case RESTFUL:\n+                return getRestfulCommandTimeout();\n+        }\n+\n+        throw new InvalidParameterException(\"invalid command timeout type\");", "originalCommit": "acb0e685834ecd54cd8e47e665d0b5dd7f0fc471", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDM2MTM0OA==", "url": "https://github.com/oracle/opengrok/pull/3200#discussion_r490361348", "bodyText": "sounds reasonable, changed.", "author": "vladak", "createdAt": "2020-09-17T15:53:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDIzNjMwMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDI0MzE0Mg==", "url": "https://github.com/oracle/opengrok/pull/3200#discussion_r490243142", "bodyText": "I know it was like this but since you are touching it, could you please rename to timeStr to follow Java standard?", "author": "ahornace", "createdAt": "2020-09-17T13:26:34Z", "path": "opengrok-indexer/src/main/java/org/opengrok/indexer/util/Statistics.java", "diffHunk": "@@ -28,28 +28,47 @@\n import static org.opengrok.indexer.util.StringUtils.getReadableTime;\n \n public class Statistics {\n-        \n-  private final long startTime;  \n \n-  public Statistics() {\n+    private final long startTime;\n+\n+    public Statistics() {\n       startTime = System.currentTimeMillis();    \n   }\n \n-  public void report(Logger log, String msg) {\n-      long stopTime = System.currentTimeMillis();\n-      String time_str = StringUtils.getReadableTime(stopTime - startTime);\n-      log.log(Level.INFO, msg + \" (took {0})\", time_str);\n-  }\n+    /**\n+     * log a message along with how much time it took since the constructor was called.\n+     * @param logger logger instance\n+     * @param logLevel log level\n+     * @param msg message string\n+     */\n+    public void report(Logger logger, Level logLevel, String msg) {\n+        long stopTime = System.currentTimeMillis();\n+        String time_str = StringUtils.getReadableTime(stopTime - startTime);", "originalCommit": "acb0e685834ecd54cd8e47e665d0b5dd7f0fc471", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDM1OTkzMA==", "url": "https://github.com/oracle/opengrok/pull/3200#discussion_r490359930", "bodyText": "sure", "author": "vladak", "createdAt": "2020-09-17T15:51:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDI0MzE0Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDI0OTY2Nw==", "url": "https://github.com/oracle/opengrok/pull/3200#discussion_r490249667", "bodyText": "I still prefer using Instant and Duration classes for computing the duration as it is more high level. If you do not, then feel free to ignore.", "author": "ahornace", "createdAt": "2020-09-17T13:33:46Z", "path": "opengrok-indexer/src/main/java/org/opengrok/indexer/util/Statistics.java", "diffHunk": "@@ -28,28 +28,47 @@\n import static org.opengrok.indexer.util.StringUtils.getReadableTime;\n \n public class Statistics {\n-        \n-  private final long startTime;  \n \n-  public Statistics() {\n+    private final long startTime;", "originalCommit": "acb0e685834ecd54cd8e47e665d0b5dd7f0fc471", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDM2NTAwOA==", "url": "https://github.com/oracle/opengrok/pull/3200#discussion_r490365008", "bodyText": "why not, changed. I like Duration.between().", "author": "vladak", "createdAt": "2020-09-17T15:58:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDI0OTY2Nw=="}], "type": "inlineReview"}, {"oid": "187f4cd872c1fceca95551343bdb2b9a4df4fc52", "url": "https://github.com/oracle/opengrok/commit/187f4cd872c1fceca95551343bdb2b9a4df4fc52", "message": "rename per review comment", "committedDate": "2020-09-17T15:51:13Z", "type": "commit"}, {"oid": "e8c53d06676e666d0146465992e0d9111d9fbeb5", "url": "https://github.com/oracle/opengrok/commit/e8c53d06676e666d0146465992e0d9111d9fbeb5", "message": "use IllegalArgumentException per review comment", "committedDate": "2020-09-17T15:53:14Z", "type": "commit"}, {"oid": "b08ee2a79de4f1e6f076f2ba617f9aa077ad438f", "url": "https://github.com/oracle/opengrok/commit/b08ee2a79de4f1e6f076f2ba617f9aa077ad438f", "message": "use Instant/Duration per review comment", "committedDate": "2020-09-17T15:58:18Z", "type": "commit"}, {"oid": "1a10c24c4b271ec1cf6bfeef17491acc61ce6e85", "url": "https://github.com/oracle/opengrok/commit/1a10c24c4b271ec1cf6bfeef17491acc61ce6e85", "message": "remove unused import", "committedDate": "2020-09-17T17:38:25Z", "type": "commit"}]}