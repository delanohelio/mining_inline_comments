{"pr_number": 1373, "pr_title": "Added getter for sensitivity rank and check for version which added sensitivity rank support", "pr_createdAt": "2020-06-26T00:09:40Z", "pr_url": "https://github.com/microsoft/mssql-jdbc/pull/1373", "timeline": [{"oid": "c97b863c95385bdcd1afc897ef39cbebaf495578", "url": "https://github.com/microsoft/mssql-jdbc/commit/c97b863c95385bdcd1afc897ef39cbebaf495578", "message": "Fix AEv2 tests exclude for reqExternalSetup and cleanup (#1247)", "committedDate": "2020-02-05T19:03:48Z", "type": "commit"}, {"oid": "54b5a194e5d46552419c86e0d1f8c800f42d3de8", "url": "https://github.com/microsoft/mssql-jdbc/commit/54b5a194e5d46552419c86e0d1f8c800f42d3de8", "message": "Fix | Add null check for getObject() with LocalTime and LocalDate (#1250)", "committedDate": "2020-02-08T00:19:05Z", "type": "commit"}, {"oid": "672b7d67caae75250c53f82a760e8d3880e62a37", "url": "https://github.com/microsoft/mssql-jdbc/commit/672b7d67caae75250c53f82a760e8d3880e62a37", "message": "added all AKV tests to use reqExternalSetup tag so they will be skipped by default (#1254)\n\n* skip AKV test properly\r\n\r\n* removed enclave properties string to failed errors as enclave tests could be skipped", "committedDate": "2020-02-10T19:04:22Z", "type": "commit"}, {"oid": "3c3331b7b0ff1b27b1e80271bf9ffdc6aae7be79", "url": "https://github.com/microsoft/mssql-jdbc/commit/3c3331b7b0ff1b27b1e80271bf9ffdc6aae7be79", "message": "Merge remote-tracking branch 'upstream/dev' into dev", "committedDate": "2020-03-25T06:21:47Z", "type": "commit"}, {"oid": "e2c5640370daa89c0d8c1559b5791e99656f78c8", "url": "https://github.com/microsoft/mssql-jdbc/commit/e2c5640370daa89c0d8c1559b5791e99656f78c8", "message": "Merge remote-tracking branch 'upstream/dev' into dev", "committedDate": "2020-03-26T06:10:08Z", "type": "commit"}, {"oid": "aad696640378b75f3cb8cb24cc2fa299358db9ac", "url": "https://github.com/microsoft/mssql-jdbc/commit/aad696640378b75f3cb8cb24cc2fa299358db9ac", "message": "Merge remote-tracking branch 'upstream/dev' into dev", "committedDate": "2020-03-28T03:18:02Z", "type": "commit"}, {"oid": "92bf04c2787c3b2a704f641f50cb4a83193f1d6d", "url": "https://github.com/microsoft/mssql-jdbc/commit/92bf04c2787c3b2a704f641f50cb4a83193f1d6d", "message": "Merge remote-tracking branch 'upstream/dev' into dev", "committedDate": "2020-03-31T01:58:20Z", "type": "commit"}, {"oid": "3ba5ab72008501e23f43dbcbcc333775320ddafa", "url": "https://github.com/microsoft/mssql-jdbc/commit/3ba5ab72008501e23f43dbcbcc333775320ddafa", "message": "Merge remote-tracking branch 'upstream/dev' into dev", "committedDate": "2020-04-04T05:47:37Z", "type": "commit"}, {"oid": "d20823deffea162b2b17b079cc291f91269558aa", "url": "https://github.com/microsoft/mssql-jdbc/commit/d20823deffea162b2b17b079cc291f91269558aa", "message": "Merge remote-tracking branch 'upstream/dev' into dev", "committedDate": "2020-04-07T00:45:05Z", "type": "commit"}, {"oid": "4cc959f7e76eedbf49e30e5b92de43c86d7eb803", "url": "https://github.com/microsoft/mssql-jdbc/commit/4cc959f7e76eedbf49e30e5b92de43c86d7eb803", "message": "Merge remote-tracking branch 'upstream/dev' into dev", "committedDate": "2020-04-29T02:59:23Z", "type": "commit"}, {"oid": "7b301f8184b26da4d99b2feab8b2aea886c01cea", "url": "https://github.com/microsoft/mssql-jdbc/commit/7b301f8184b26da4d99b2feab8b2aea886c01cea", "message": "Merge remote-tracking branch 'upstream/dev' into dev", "committedDate": "2020-04-30T06:36:21Z", "type": "commit"}, {"oid": "56bcf139fe6acd87c41b3829b4f157c59bd9f873", "url": "https://github.com/microsoft/mssql-jdbc/commit/56bcf139fe6acd87c41b3829b4f157c59bd9f873", "message": "Merge remote-tracking branch 'upstream/dev' into dev", "committedDate": "2020-05-07T22:26:03Z", "type": "commit"}, {"oid": "744e0ca78e57bc6c0db98910a9066d5b583c6ba8", "url": "https://github.com/microsoft/mssql-jdbc/commit/744e0ca78e57bc6c0db98910a9066d5b583c6ba8", "message": "Merge remote-tracking branch 'upstream/dev' into dev", "committedDate": "2020-05-12T22:47:18Z", "type": "commit"}, {"oid": "8479062ad4a3c0277255479095da7541def34ec5", "url": "https://github.com/microsoft/mssql-jdbc/commit/8479062ad4a3c0277255479095da7541def34ec5", "message": "dataclassification v2", "committedDate": "2020-05-16T04:50:00Z", "type": "commit"}, {"oid": "8dbcca62db19332d875aafe1d5ed93f6d879ce4a", "url": "https://github.com/microsoft/mssql-jdbc/commit/8dbcca62db19332d875aafe1d5ed93f6d879ce4a", "message": "fix", "committedDate": "2020-05-18T21:08:06Z", "type": "commit"}, {"oid": "c64011d1a46345b88fdc1dd9e21f2e7da2cbfe71", "url": "https://github.com/microsoft/mssql-jdbc/commit/c64011d1a46345b88fdc1dd9e21f2e7da2cbfe71", "message": "Merge remote-tracking branch 'upstream/dev' into dataclass", "committedDate": "2020-05-19T00:57:57Z", "type": "commit"}, {"oid": "234512b6f5e89a9d3aed1cfd56a12416e1408261", "url": "https://github.com/microsoft/mssql-jdbc/commit/234512b6f5e89a9d3aed1cfd56a12416e1408261", "message": "fixed typo", "committedDate": "2020-05-19T02:31:35Z", "type": "commit"}, {"oid": "621bc2e5c56e38b74828fedce4cf5589b82b6943", "url": "https://github.com/microsoft/mssql-jdbc/commit/621bc2e5c56e38b74828fedce4cf5589b82b6943", "message": "comment", "committedDate": "2020-05-20T19:51:07Z", "type": "commit"}, {"oid": "7712b19ecbeeba633f82e63bba846e42fb45857d", "url": "https://github.com/microsoft/mssql-jdbc/commit/7712b19ecbeeba633f82e63bba846e42fb45857d", "message": "resolved conflicts", "committedDate": "2020-06-10T21:22:25Z", "type": "commit"}, {"oid": "05993532bab653f3d508adf38ecc0ad7f38bee23", "url": "https://github.com/microsoft/mssql-jdbc/commit/05993532bab653f3d508adf38ecc0ad7f38bee23", "message": "Merge branch 'dataclass' of https://github.com/lilgreenbird/mssql-jdbc into dataclass", "committedDate": "2020-06-10T21:24:03Z", "type": "commit"}, {"oid": "23da8c2cee27f728e343a138b227dd812f673998", "url": "https://github.com/microsoft/mssql-jdbc/commit/23da8c2cee27f728e343a138b227dd812f673998", "message": "Merge remote-tracking branch 'upstream/dev' into dataclass", "committedDate": "2020-06-18T19:19:35Z", "type": "commit"}, {"oid": "6461154f8c4134ab3d821fa427cb4068847e94b2", "url": "https://github.com/microsoft/mssql-jdbc/commit/6461154f8c4134ab3d821fa427cb4068847e94b2", "message": "review updates", "committedDate": "2020-06-18T20:01:54Z", "type": "commit"}, {"oid": "104d4bbbede2e3148d95a9bf97e34712acea5f2d", "url": "https://github.com/microsoft/mssql-jdbc/commit/104d4bbbede2e3148d95a9bf97e34712acea5f2d", "message": "updated rank", "committedDate": "2020-06-26T00:02:18Z", "type": "commit"}, {"oid": "804f1811c7e74e9110cd36513575dfc6009ffde6", "url": "https://github.com/microsoft/mssql-jdbc/commit/804f1811c7e74e9110cd36513575dfc6009ffde6", "message": "merged", "committedDate": "2020-06-26T00:06:20Z", "type": "commit"}, {"oid": "20905a29c252c7d483189710713bc96b82bde5e9", "url": "https://github.com/microsoft/mssql-jdbc/commit/20905a29c252c7d483189710713bc96b82bde5e9", "message": "removed enum", "committedDate": "2020-06-26T00:38:03Z", "type": "commit"}, {"oid": "46910c63dd813b0b348daf5c83f2ad0ec90b4ed4", "url": "https://github.com/microsoft/mssql-jdbc/commit/46910c63dd813b0b348daf5c83f2ad0ec90b4ed4", "message": "fixed enums", "committedDate": "2020-06-26T06:35:19Z", "type": "commit"}, {"oid": "a3d6325f27570790734eee1bec38e9edb58501d6", "url": "https://github.com/microsoft/mssql-jdbc/commit/a3d6325f27570790734eee1bec38e9edb58501d6", "message": "expected and actual order", "committedDate": "2020-06-28T05:15:29Z", "type": "commit"}, {"oid": "5735612a27ae498fa6d7d2bf4c9b7e5b86f5b277", "url": "https://github.com/microsoft/mssql-jdbc/commit/5735612a27ae498fa6d7d2bf4c9b7e5b86f5b277", "message": "added xAzureSQLDW and TODO", "committedDate": "2020-06-30T21:22:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTIzMjgxMw==", "url": "https://github.com/microsoft/mssql-jdbc/pull/1373#discussion_r449232813", "bodyText": "two semicolons", "author": "peterbae", "createdAt": "2020-07-02T19:46:04Z", "path": "src/main/java/com/microsoft/sqlserver/jdbc/StreamColumns.java", "diffHunk": "@@ -274,8 +277,12 @@ private SensitivityClassification processDataClassification(TDSReader tdsReader)\n             informationTypes.add(readSensitivityInformationType(tdsReader));\n         }\n \n-        int sensitivityRank = SensitivityRank.NOT_DEFINED.getValue();\n-        if (TDS.MAX_SUPPORTED_DATA_CLASSIFICATION_VERSION <= tdsReader.getServerSupportedDataClassificationVersion()) {\n+        sensitivityRankSupported = tdsReader\n+                .getServerSupportedDataClassificationVersion() >= TDS.DATA_CLASSIFICATION_VERSION_ADDED_RANK_SUPPORT;\n+\n+        // get sensitivity rank if supported\n+        int sensitivityRank = SensitivityRank.NOT_DEFINED.getValue();;", "originalCommit": "5735612a27ae498fa6d7d2bf4c9b7e5b86f5b277", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTI0Mzk2NQ==", "url": "https://github.com/microsoft/mssql-jdbc/pull/1373#discussion_r449243965", "bodyText": "This change is already merged.", "author": "ulvii", "createdAt": "2020-07-02T20:12:49Z", "path": "src/main/java/com/microsoft/sqlserver/jdbc/SQLServerDatabaseMetaData.java", "diffHunk": "@@ -2556,6 +2556,7 @@ public boolean locatorsUpdateCopy() throws SQLException {\n      *\n      * @return the database compatibility level value (from sys.databases table).\n      * @throws SQLException\n+     *         if error", "originalCommit": "5735612a27ae498fa6d7d2bf4c9b7e5b86f5b277", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTI1NjAzNw==", "url": "https://github.com/microsoft/mssql-jdbc/pull/1373#discussion_r449256037", "bodyText": "We need to add ORDER BY to this select statement.", "author": "ulvii", "createdAt": "2020-07-02T20:41:27Z", "path": "src/test/java/com/microsoft/sqlserver/jdbc/resultset/DataClassificationTest.java", "diffHunk": "@@ -39,31 +40,35 @@\n \n     private static final String addSensitivitySql = \"ADD SENSITIVITY CLASSIFICATION TO %s.%s WITH (LABEL='PII', LABEL_ID='L1', INFORMATION_TYPE='%s', INFORMATION_TYPE_ID='%s'%s)\";\n     private static final String sensitivityRankSql = \", RANK=%s\";\n-    private static String sensitivityRank[][] = {{\"NONE\", \"0\"}, {\"LOW\", \"10\"}, {\"MEDIUM\", \"20\"}, {\"HIGH\", \"30\"},\n-            {\"CRITICAL\", \"40\"}};\n \n     /**\n      * Tests data classification metadata information from SQL Server\n      * \n+     * TODO: remove xAzureSQLDW tag once issue on server is fixed\n+     * (currently DW not returning rank info) VSO issue 12931\n+     * \n      * @throws Exception\n      */\n     @Tag(Constants.xSQLv12)\n     @Tag(Constants.xSQLv14)\n+    @Tag(Constants.xAzureSQLDW)\n     @Test\n     public void testDataClassificationMetadata() throws Exception {\n         try (Statement stmt = connection.createStatement();) {\n             if (!TestUtils.serverSupportsDataClassification(stmt)) {\n                 fail(TestResource.getResource(\"R_dataClassificationNotSupported\"));\n             }\n \n-            for (int i = 0; i < sensitivityRank.length; i++) {\n-                createTable(connection, stmt);\n-                addSensitivity(connection, stmt, sensitivityRank[i][0]);\n-                insertData(connection, stmt);\n-                try (SQLServerResultSet rs = (SQLServerResultSet) stmt.executeQuery(\"SELECT * FROM \" + tableName)) {\n-                    verifySensitivityClassification(rs, Integer.parseInt(sensitivityRank[i][1]));\n+            for (SensitivityRank i : SensitivityRank.values()) {\n+                if (SensitivityRank.NOT_DEFINED != i) {\n+                    createTable(connection, stmt);\n+                    addSensitivity(connection, stmt, i.toString());\n+                    insertData(connection, stmt);\n+                    try (SQLServerResultSet rs = (SQLServerResultSet) stmt.executeQuery(\"SELECT * FROM \" + tableName)) {", "originalCommit": "5735612a27ae498fa6d7d2bf4c9b7e5b86f5b277", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTI4ODU1Ng==", "url": "https://github.com/microsoft/mssql-jdbc/pull/1373#discussion_r449288556", "bodyText": "Just to confirm - this line (328) was executed regardless of sensitivity rank being supported, but now it's only being executed if sensitivity rank is supported because it moved up one if statement bracket. Is this intended?", "author": "peterbae", "createdAt": "2020-07-02T22:13:16Z", "path": "src/main/java/com/microsoft/sqlserver/jdbc/StreamColumns.java", "diffHunk": "@@ -311,21 +318,26 @@ private SensitivityClassification processDataClassification(TDSReader tdsReader)\n                     informationType = informationTypes.get(informationTypeIndex);\n                 }\n \n-                if (TDS.MAX_SUPPORTED_DATA_CLASSIFICATION_VERSION <= tdsReader\n-                        .getServerSupportedDataClassificationVersion()) {\n-                    sensitivityRank = tdsReader.readInt();\n-                    if (!SensitivityRank.isValid(sensitivityRank)) {\n+                int sensitivityRankProperty = SensitivityRank.NOT_DEFINED.getValue();\n+                if (sensitivityRankSupported) {\n+                    sensitivityRankProperty = tdsReader.readInt();\n+                    if (!SensitivityRank.isValid(sensitivityRankProperty)) {\n                         tdsReader.throwInvalidTDS();\n                     }\n+                    // add sensitivity properties for the source", "originalCommit": "5735612a27ae498fa6d7d2bf4c9b7e5b86f5b277", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTMwMzY0OA==", "url": "https://github.com/microsoft/mssql-jdbc/pull/1373#discussion_r449303648", "bodyText": "SensitivityRank used to not be visible to public, but now it is. Is this intended?", "author": "peterbae", "createdAt": "2020-07-02T23:08:48Z", "path": "src/main/java/com/microsoft/sqlserver/jdbc/dataclassification/SensitivityClassification.java", "diffHunk": "@@ -8,20 +8,54 @@\n import java.util.ArrayList;\n import java.util.List;\n \n+import com.microsoft.sqlserver.jdbc.SQLServerException;\n+\n \n /**\n- * Provides the functionlity to retrieve Sensitivity Classification data as received from SQL Server for the active\n+ * Provides the functionality to retrieve Sensitivity Classification data as received from SQL Server for the active\n  * resultSet\n  */\n public class SensitivityClassification {\n+\n+    public enum SensitivityRank {", "originalCommit": "5735612a27ae498fa6d7d2bf4c9b7e5b86f5b277", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTMxODUyMQ==", "url": "https://github.com/microsoft/mssql-jdbc/pull/1373#discussion_r449318521", "bodyText": "yes this is so users can check the values", "author": "lilgreenbird", "createdAt": "2020-07-03T00:14:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTMwMzY0OA=="}], "type": "inlineReview"}, {"oid": "26bf42ac0710c6fad287d2121656b3e8bac1c151", "url": "https://github.com/microsoft/mssql-jdbc/commit/26bf42ac0710c6fad287d2121656b3e8bac1c151", "message": "review updates", "committedDate": "2020-07-03T00:17:38Z", "type": "commit"}]}