{"pr_number": 1262, "pr_title": "Feature | Cleanup Always Encrypted with secure enclaves tests", "pr_createdAt": "2020-02-13T22:56:47Z", "pr_url": "https://github.com/microsoft/mssql-jdbc/pull/1262", "timeline": [{"oid": "c97b863c95385bdcd1afc897ef39cbebaf495578", "url": "https://github.com/microsoft/mssql-jdbc/commit/c97b863c95385bdcd1afc897ef39cbebaf495578", "message": "Fix AEv2 tests exclude for reqExternalSetup and cleanup (#1247)", "committedDate": "2020-02-05T19:03:48Z", "type": "commit"}, {"oid": "931158ff0e1b83cc5dcc7a81b5a5f8cf4c4f9273", "url": "https://github.com/microsoft/mssql-jdbc/commit/931158ff0e1b83cc5dcc7a81b5a5f8cf4c4f9273", "message": "skip AKV test properly", "committedDate": "2020-02-05T21:41:02Z", "type": "commit"}, {"oid": "397d3e86ce4fcb06a0851bfa30931ebcef219174", "url": "https://github.com/microsoft/mssql-jdbc/commit/397d3e86ce4fcb06a0851bfa30931ebcef219174", "message": "removed enclave properties string to failed errors as enclave tests could be skipped", "committedDate": "2020-02-05T22:41:08Z", "type": "commit"}, {"oid": "54b5a194e5d46552419c86e0d1f8c800f42d3de8", "url": "https://github.com/microsoft/mssql-jdbc/commit/54b5a194e5d46552419c86e0d1f8c800f42d3de8", "message": "Fix | Add null check for getObject() with LocalTime and LocalDate (#1250)", "committedDate": "2020-02-08T00:19:05Z", "type": "commit"}, {"oid": "672b7d67caae75250c53f82a760e8d3880e62a37", "url": "https://github.com/microsoft/mssql-jdbc/commit/672b7d67caae75250c53f82a760e8d3880e62a37", "message": "added all AKV tests to use reqExternalSetup tag so they will be skipped by default (#1254)\n\n* skip AKV test properly\r\n\r\n* removed enclave properties string to failed errors as enclave tests could be skipped", "committedDate": "2020-02-10T19:04:22Z", "type": "commit"}, {"oid": "08d8ae3f3d9a3d02896bd79232104c948860f6f6", "url": "https://github.com/microsoft/mssql-jdbc/commit/08d8ae3f3d9a3d02896bd79232104c948860f6f6", "message": "Optimize callablestatement test", "committedDate": "2020-02-10T20:11:10Z", "type": "commit"}, {"oid": "7c67ebd5a9be81ee34623a528c032edd2dc8e4b5", "url": "https://github.com/microsoft/mssql-jdbc/commit/7c67ebd5a9be81ee34623a528c032edd2dc8e4b5", "message": "stop checking AE all the time, also add some tags", "committedDate": "2020-02-12T17:20:53Z", "type": "commit"}, {"oid": "62d2e64a821bd68daf09e589ca000f2d92f9be39", "url": "https://github.com/microsoft/mssql-jdbc/commit/62d2e64a821bd68daf09e589ca000f2d92f9be39", "message": "some changes", "committedDate": "2020-02-12T18:16:19Z", "type": "commit"}, {"oid": "e05c67ed652c3796789afca27e71ac61657615ea", "url": "https://github.com/microsoft/mssql-jdbc/commit/e05c67ed652c3796789afca27e71ac61657615ea", "message": "test", "committedDate": "2020-02-12T21:16:20Z", "type": "commit"}, {"oid": "8979de23d70986fa17bdd4b24077288ef89140d3", "url": "https://github.com/microsoft/mssql-jdbc/commit/8979de23d70986fa17bdd4b24077288ef89140d3", "message": "Revert \"test\"\n\nThis reverts commit e05c67ed652c3796789afca27e71ac61657615ea.", "committedDate": "2020-02-12T21:22:58Z", "type": "commit"}, {"oid": "89609f8c674ca7c7962217b82498e8fd38569771", "url": "https://github.com/microsoft/mssql-jdbc/commit/89609f8c674ca7c7962217b82498e8fd38569771", "message": "Revert \"some changes\"\n\nThis reverts commit 62d2e64a821bd68daf09e589ca000f2d92f9be39.", "committedDate": "2020-02-13T18:26:08Z", "type": "commit"}, {"oid": "2f048f3e0e5b6f505ce101d489f336fd0f7bab4a", "url": "https://github.com/microsoft/mssql-jdbc/commit/2f048f3e0e5b6f505ce101d489f336fd0f7bab4a", "message": "delete everythign", "committedDate": "2020-02-13T21:11:09Z", "type": "commit"}, {"oid": "80013a353967db91fdd3f10af8620498493005e9", "url": "https://github.com/microsoft/mssql-jdbc/commit/80013a353967db91fdd3f10af8620498493005e9", "message": "add aev2 stuff", "committedDate": "2020-02-13T21:50:39Z", "type": "commit"}, {"oid": "ff339886b47f9b85bbc3bf7da8dc598edea2b2c8", "url": "https://github.com/microsoft/mssql-jdbc/commit/ff339886b47f9b85bbc3bf7da8dc598edea2b2c8", "message": "fix index out of bounds", "committedDate": "2020-02-13T22:50:52Z", "type": "commit"}, {"oid": "1ce8158f82a84aa90e515de2235a8a6d42b16b73", "url": "https://github.com/microsoft/mssql-jdbc/commit/1ce8158f82a84aa90e515de2235a8a6d42b16b73", "message": "Merge branch 'dev' of https://github.com/Microsoft/mssql-jdbc into junit\n\n# Conflicts:\n#\tsrc/test/java/com/microsoft/sqlserver/jdbc/AlwaysEncrypted/AESetup.java\n#\tsrc/test/java/com/microsoft/sqlserver/jdbc/AlwaysEncrypted/EnclaveTest.java\n#\tsrc/test/java/com/microsoft/sqlserver/jdbc/AlwaysEncrypted/JDBCEncryptionDecryptionTest.java", "committedDate": "2020-02-13T22:56:22Z", "type": "commit"}, {"oid": "4793f8157449631a6681870ae69eb6cce8cdcfc2", "url": "https://github.com/microsoft/mssql-jdbc/commit/4793f8157449631a6681870ae69eb6cce8cdcfc2", "message": "fix errors", "committedDate": "2020-02-13T23:33:44Z", "type": "commit"}, {"oid": "67aa997c863728d7d58a0039cd78a3627cef79b6", "url": "https://github.com/microsoft/mssql-jdbc/commit/67aa997c863728d7d58a0039cd78a3627cef79b6", "message": "Remove test that doesn't belong", "committedDate": "2020-02-14T00:22:37Z", "type": "commit"}, {"oid": "8d6f6a55f75caf51f097970ed6e42e8a3a8dbf34", "url": "https://github.com/microsoft/mssql-jdbc/commit/8d6f6a55f75caf51f097970ed6e42e8a3a8dbf34", "message": "revert surefire plugin", "committedDate": "2020-02-14T16:37:33Z", "type": "commit"}, {"oid": "752595832af81e32544d68f112675e5e982797d3", "url": "https://github.com/microsoft/mssql-jdbc/commit/752595832af81e32544d68f112675e5e982797d3", "message": "fix exclude", "committedDate": "2020-02-14T23:15:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTY5NTYxNA==", "url": "https://github.com/microsoft/mssql-jdbc/pull/1262#discussion_r379695614", "bodyText": "Where are you testing testRichQuery, testRichQueryDate, testRichQuery if they are removed?", "author": "ulvii", "createdAt": "2020-02-15T00:01:40Z", "path": "src/test/java/com/microsoft/sqlserver/jdbc/AlwaysEncrypted/JDBCEncryptionDecryptionTest.java", "diffHunk": "@@ -2138,254 +2091,6 @@ void testWithSpecifiedtype(SQLServerResultSet rs, int numberOfColumns, String[]\n         index++;\n     }\n \n-    /**\n-     * Alter Column encryption on deterministic columns to randomized - this will trigger enclave to re-encrypt\n-     * \n-     * @param stmt\n-     * @param tableName\n-     * @param table\n-     * @param values\n-     * @throws SQLException\n-     */\n-    private void testAlterColumnEncryption(SQLServerStatement stmt, String tableName, String table[][],\n-            String cekName) throws SQLException {\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo)) {\n-            for (int i = 0; i < table.length; i++) {\n-                // alter deterministic to randomized\n-                String sql = \"ALTER TABLE \" + tableName + \" ALTER COLUMN \" + ColumnType.DETERMINISTIC.name()\n-                        + table[i][0] + \" \" + table[i][1]\n-                        + String.format(encryptSql, ColumnType.RANDOMIZED.name(), cekName) + \")\";\n-                try (SQLServerPreparedStatement pstmt = (SQLServerPreparedStatement) TestUtils.getPreparedStmt(con, sql,\n-                        stmtColEncSetting)) {\n-                    stmt.execute(sql);\n-                    if (!TestUtils.isAEv2(con)) {\n-                        fail(TestResource.getResource(\"R_expectedExceptionNotThrown\"));\n-                    }\n-                } catch (SQLException e) {\n-                    if (!TestUtils.isAEv2(con)) {\n-                        fail(TestResource.getResource(\"R_expectedExceptionNotThrown\"));\n-                    } else {\n-                        fail(TestResource.getResource(\"R_AlterAEv2Error\") + e.getMessage() + \"Query: \" + sql);\n-                    }\n-                }\n-            }\n-        }\n-    }\n-\n-    private void testRichQuery(SQLServerStatement stmt, String tableName, String table[][],", "originalCommit": "752595832af81e32544d68f112675e5e982797d3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "abc42ed62636e156c270f12b62066f57c187ba8b", "url": "https://github.com/microsoft/mssql-jdbc/commit/abc42ed62636e156c270f12b62066f57c187ba8b", "message": "Merge branch 'dev' of https://github.com/microsoft/mssql-jdbc into junit\n\n# Conflicts:\n#\tpom.xml\n#\tsrc/test/java/com/microsoft/sqlserver/jdbc/AlwaysEncrypted/AESetup.java\n#\tsrc/test/java/com/microsoft/sqlserver/jdbc/AlwaysEncrypted/CallableStatementTest.java\n#\tsrc/test/java/com/microsoft/sqlserver/jdbc/AlwaysEncrypted/EnclaveTest.java\n#\tsrc/test/java/com/microsoft/sqlserver/jdbc/AlwaysEncrypted/JDBCEncryptionDecryptionTest.java", "committedDate": "2020-04-02T20:11:41Z", "type": "commit"}, {"oid": "f70a0b2feda25d8d28d19cc383f0e529f62de7f3", "url": "https://github.com/microsoft/mssql-jdbc/commit/f70a0b2feda25d8d28d19cc383f0e529f62de7f3", "message": "revert table creation logic", "committedDate": "2020-04-07T16:29:34Z", "type": "commit"}, {"oid": "0437d1c37b8ff7a06d231af0a208c9d98f0051d3", "url": "https://github.com/microsoft/mssql-jdbc/commit/0437d1c37b8ff7a06d231af0a208c9d98f0051d3", "message": "fixes", "committedDate": "2020-04-07T16:39:25Z", "type": "commit"}, {"oid": "0c0726bb595c3c3ab5fd76aa0ac103395467390d", "url": "https://github.com/microsoft/mssql-jdbc/commit/0c0726bb595c3c3ab5fd76aa0ac103395467390d", "message": "alter", "committedDate": "2020-04-07T16:51:56Z", "type": "commit"}, {"oid": "8193c6828b7e5aa1ec1c787d69379ab2c6b9a340", "url": "https://github.com/microsoft/mssql-jdbc/commit/8193c6828b7e5aa1ec1c787d69379ab2c6b9a340", "message": "z", "committedDate": "2020-04-07T17:11:15Z", "type": "commit"}, {"oid": "42dbb3052c4e068d6eaa9155195ea6ea92e02a4c", "url": "https://github.com/microsoft/mssql-jdbc/commit/42dbb3052c4e068d6eaa9155195ea6ea92e02a4c", "message": "z", "committedDate": "2020-04-08T16:20:35Z", "type": "commit"}, {"oid": "bedd0ad568ec52e107c8e6c5be699614e063c347", "url": "https://github.com/microsoft/mssql-jdbc/commit/bedd0ad568ec52e107c8e6c5be699614e063c347", "message": "zz", "committedDate": "2020-04-08T16:49:20Z", "type": "commit"}, {"oid": "97408bcee711a586a8f807e775a396c2cffb26fd", "url": "https://github.com/microsoft/mssql-jdbc/commit/97408bcee711a586a8f807e775a396c2cffb26fd", "message": "temp", "committedDate": "2020-04-08T17:21:56Z", "type": "commit"}, {"oid": "817cf6c41353de79d5e2d0fa1856b1d42d0e2d03", "url": "https://github.com/microsoft/mssql-jdbc/commit/817cf6c41353de79d5e2d0fa1856b1d42d0e2d03", "message": "zzz", "committedDate": "2020-04-08T17:37:29Z", "type": "commit"}, {"oid": "f3ceffa755426a131c0184e0a5f71f227185a179", "url": "https://github.com/microsoft/mssql-jdbc/commit/f3ceffa755426a131c0184e0a5f71f227185a179", "message": "zzz", "committedDate": "2020-04-08T18:18:22Z", "type": "commit"}, {"oid": "11a119816069694b9de6c76a528bee434c1338a4", "url": "https://github.com/microsoft/mssql-jdbc/commit/11a119816069694b9de6c76a528bee434c1338a4", "message": "Merge branch 'dev' of https://github.com/Microsoft/mssql-jdbc into junit", "committedDate": "2020-04-08T18:18:56Z", "type": "commit"}, {"oid": "5ca3c581f2524b9c9551ef20519c76acd312d888", "url": "https://github.com/microsoft/mssql-jdbc/commit/5ca3c581f2524b9c9551ef20519c76acd312d888", "message": "re-add print", "committedDate": "2020-04-08T20:16:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjU2MDMwNw==", "url": "https://github.com/microsoft/mssql-jdbc/pull/1262#discussion_r406560307", "bodyText": "Do we need this pstmt? It gets created but doesnt get used.", "author": "peterbae", "createdAt": "2020-04-10T01:28:53Z", "path": "src/test/java/com/microsoft/sqlserver/jdbc/AlwaysEncrypted/AESetup.java", "diffHunk": "@@ -1959,4 +1941,38 @@ private static void dropCMK(String cmkName, Statement stmt) throws SQLException\n                 + \" drop column master key \" + cmkName + \" end\";\n         stmt.execute(cekSql);\n     }\n+\n+    /**\n+     * Alter Column encryption on deterministic columns to randomized - this will trigger enclave to re-encrypt\n+     * \n+     * @param stmt\n+     * @param tableName\n+     * @param table\n+     * @param values\n+     * @throws SQLException\n+     */\n+    protected void testAlterColumnEncryption(SQLServerStatement stmt, String tableName, String table[][],\n+            String cekName) throws SQLException {\n+        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo)) {\n+            for (int i = 0; i < table.length; i++) {\n+                // alter deterministic to randomized\n+                String sql = \"ALTER TABLE \" + tableName + \" ALTER COLUMN \" + ColumnType.DETERMINISTIC.name()\n+                        + table[i][0] + \" \" + table[i][1]\n+                        + String.format(encryptSql, ColumnType.RANDOMIZED.name(), cekName) + \")\";\n+                try (SQLServerPreparedStatement pstmt = (SQLServerPreparedStatement) TestUtils.getPreparedStmt(con, sql,", "originalCommit": "5ca3c581f2524b9c9551ef20519c76acd312d888", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjU2MDczNQ==", "url": "https://github.com/microsoft/mssql-jdbc/pull/1262#discussion_r406560735", "bodyText": "Should probably leave the newline at end of file?", "author": "peterbae", "createdAt": "2020-04-10T01:30:53Z", "path": "src/test/java/com/microsoft/sqlserver/jdbc/AlwaysEncrypted/JDBCEncryptionDecryptionTest.java", "diffHunk": "@@ -2296,4 +2262,4 @@ public String getAccessToken(String authority, String resource, String scope) {\n             return result.getAccessToken();\n         }\n     };\n-}\n+}", "originalCommit": "5ca3c581f2524b9c9551ef20519c76acd312d888", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY0NDI4Ng==", "url": "https://github.com/microsoft/mssql-jdbc/pull/1262#discussion_r406644286", "bodyText": "params don't match", "author": "lilgreenbird", "createdAt": "2020-04-10T07:42:33Z", "path": "src/test/java/com/microsoft/sqlserver/jdbc/AlwaysEncrypted/AESetup.java", "diffHunk": "@@ -1959,4 +1941,38 @@ private static void dropCMK(String cmkName, Statement stmt) throws SQLException\n                 + \" drop column master key \" + cmkName + \" end\";\n         stmt.execute(cekSql);\n     }\n+\n+    /**\n+     * Alter Column encryption on deterministic columns to randomized - this will trigger enclave to re-encrypt\n+     * \n+     * @param stmt\n+     * @param tableName\n+     * @param table\n+     * @param values", "originalCommit": "5ca3c581f2524b9c9551ef20519c76acd312d888", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY0NTYzNw==", "url": "https://github.com/microsoft/mssql-jdbc/pull/1262#discussion_r406645637", "bodyText": "this is not necessary as a sep method since it's only called once now", "author": "lilgreenbird", "createdAt": "2020-04-10T07:46:27Z", "path": "src/test/java/com/microsoft/sqlserver/jdbc/AlwaysEncrypted/CallableStatementTest.java", "diffHunk": "@@ -127,15 +127,15 @@\n      */\n     @BeforeAll\n     public static void initValues() throws Exception {\n-        dropAll();\n-\n         numericValues = createNumericValues(nullable);\n         byteValues = createBinaryValues(nullable);\n         dateValues = createTemporalTypesCallableStatement(nullable);\n         charValues = createCharValues(nullable);\n+\n+        initCallableStatementTest();\n     }\n \n-    void initCallableStatementTest() throws Exception {\n+    static void initCallableStatementTest() throws Exception {", "originalCommit": "5ca3c581f2524b9c9551ef20519c76acd312d888", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY0NzU3OA==", "url": "https://github.com/microsoft/mssql-jdbc/pull/1262#discussion_r406647578", "bodyText": "test description", "author": "lilgreenbird", "createdAt": "2020-04-10T07:52:22Z", "path": "src/test/java/com/microsoft/sqlserver/jdbc/AlwaysEncrypted/EnclaveTest.java", "diffHunk": "@@ -206,656 +180,172 @@ public void testAEv2Disabled(String serverName, String url, String protocol) thr\n \n         try (SQLServerConnection con = PrepUtil.getConnection(testConnectionString);\n                 SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = createCharValues(nullable);\n-            testChars(stmt, cekJks, charTable, values, TestCase.NORMAL, true);\n+            String[] values = createCharValues(false);\n+            TestUtils.dropTableIfExists(CHAR_TABLE_AE, stmt);\n+            createTable(CHAR_TABLE_AE, cekJks, charTable);\n+            populateCharNormalCase(values);\n+            testAlterColumnEncryption(stmt, CHAR_TABLE_AE, charTable, cekJks);\n             fail(TestResource.getResource(\"R_expectedExceptionNotThrown\"));\n         } catch (Throwable e) {\n             // testChars called fail()\n             assertTrue(e.getMessage().contains(TestResource.getResource(\"R_AlterAEv2Error\")));\n         }\n     }\n \n-    /**\n-     * Test case for char set string for string values\n-     * \n-     * @throws Exception\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testCharSpecificSetter(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = createCharValues(nullable);\n-\n-            testChars(stmt, cekJks, charTable, values, TestCase.NORMAL, true);\n-            testChars(stmt, cekAkv, charTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for char set string for string values using windows certificate store\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testCharSpecificSetterWindows(String serverName, String url, String protocol) throws Exception {\n-        org.junit.Assume.assumeTrue(System.getProperty(\"os.name\").startsWith(\"Windows\"));\n-\n-        checkAESetup(serverName, url, protocol);\n-\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = createCharValues(nullable);\n-\n-            testChars(stmt, cekWin, charTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for char set object for string values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testCharSetObject(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = createCharValues(nullable);\n-\n-            testChars(stmt, cekJks, charTable, values, TestCase.SETOBJECT, true);\n-            testChars(stmt, cekAkv, charTable, values, TestCase.SETOBJECT, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for char set object for jdbc string values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testCharSetObjectWithJDBCTypes(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = createCharValues(nullable);\n-\n-            testChars(stmt, cekJks, charTable, values, TestCase.SETOBJECT_WITH_JDBCTYPES, true);\n-            testChars(stmt, cekAkv, charTable, values, TestCase.SETOBJECT_WITH_JDBCTYPES, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for char set string for null values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testCharSpecificSetterNull(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = {null, null, null, null, null, null, null, null, null};\n-\n-            testChars(stmt, cekJks, charTable, values, TestCase.NORMAL, true);\n-            testChars(stmt, cekAkv, charTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for char set object for null values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testCharSetObjectNull(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = {null, null, null, null, null, null, null, null, null};\n-\n-            testChars(stmt, cekJks, charTable, values, TestCase.SETOBJECT, true);\n-            testChars(stmt, cekAkv, charTable, values, TestCase.SETOBJECT, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for char set null for null values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testCharSetNull(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = {null, null, null, null, null, null, null, null, null};\n-\n-            testChars(stmt, cekJks, charTable, values, TestCase.NULL, true);\n-            testChars(stmt, cekAkv, charTable, values, TestCase.NULL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for binary set binary for binary values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testBinarySpecificSetter(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<byte[]> values = createBinaryValues(false);\n-\n-            testBinaries(stmt, cekJks, binaryTable, values, TestCase.NORMAL, true);\n-            testBinaries(stmt, cekAkv, binaryTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for binary set binary for binary values using windows certificate store\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testBinarySpecificSetterWindows(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        org.junit.Assume.assumeTrue(System.getProperty(\"os.name\").startsWith(\"Windows\"));\n-\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<byte[]> values = createBinaryValues(false);\n-\n-            testBinaries(stmt, cekWin, binaryTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for binary set object for binary values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testBinarySetobject(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<byte[]> values = createBinaryValues(false);\n-\n-            testBinaries(stmt, cekJks, binaryTable, values, TestCase.SETOBJECT, true);\n-            testBinaries(stmt, cekAkv, binaryTable, values, TestCase.SETOBJECT, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for binary set null for binary values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testBinarySetNull(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<byte[]> values = createBinaryValues(true);\n-\n-            testBinaries(stmt, cekJks, binaryTable, values, TestCase.NULL, true);\n-            testBinaries(stmt, cekAkv, binaryTable, values, TestCase.NULL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for binary set binary for null values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testBinarySpecificSetterNull(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<byte[]> values = createBinaryValues(true);\n-\n-            testBinaries(stmt, cekJks, binaryTable, values, TestCase.NORMAL, true);\n-            testBinaries(stmt, cekAkv, binaryTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for binary set object for null values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testBinarysetObjectNull(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<byte[]> values = createBinaryValues(true);\n-\n-            testBinaries(stmt, cekJks, binaryTable, values, TestCase.SETOBJECT_NULL, true);\n-            testBinaries(stmt, cekAkv, binaryTable, values, TestCase.SETOBJECT_NULL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for binary set object for jdbc type binary values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testBinarySetObjectWithJDBCTypes(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<byte[]> values = createBinaryValues(false);\n-\n-            testBinaries(stmt, cekJks, binaryTable, values, TestCase.SETOBJECT_WITH_JDBCTYPES, true);\n-            testBinaries(stmt, cekAkv, binaryTable, values, TestCase.SETOBJECT_WITH_JDBCTYPES, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for date set date for date values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testDateSpecificSetter(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<Object> values = createTemporalTypes(nullable);\n-\n-            testDates(stmt, cekJks, dateTable, values, TestCase.NORMAL, true);\n-            testDates(stmt, cekAkv, dateTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for date set date for date values using windows certificate store\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testDateSpecificSetterWindows(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        org.junit.Assume.assumeTrue(System.getProperty(\"os.name\").startsWith(\"Windows\"));\n-\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<Object> values = createTemporalTypes(nullable);\n-\n-            testDates(stmt, cekWin, dateTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for date set object for date values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testDateSetObject(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<Object> values = createTemporalTypes(nullable);\n-\n-            testDates(stmt, cekJks, dateTable, values, TestCase.SETOBJECT, true);\n-            testDates(stmt, cekAkv, dateTable, values, TestCase.SETOBJECT, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for date set object for java date values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testDateSetObjectWithJavaType(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<Object> values = createTemporalTypes(nullable);\n-\n-            testDates(stmt, cekJks, dateTable, values, TestCase.SETOBJECT_WITH_JAVATYPES, true);\n-            testDates(stmt, cekAkv, dateTable, values, TestCase.SETOBJECT_WITH_JAVATYPES, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for date set object for jdbc date values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testDateSetObjectWithJDBCType(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<Object> values = createTemporalTypes(nullable);\n-\n-            testDates(stmt, cekJks, dateTable, values, TestCase.SETOBJECT_WITH_JDBCTYPES, true);\n-            testDates(stmt, cekAkv, dateTable, values, TestCase.SETOBJECT_WITH_JDBCTYPES, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for date set date for min/max date values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testDateSpecificSetterMinMaxValue(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            RandomData.returnMinMax = true;\n-            LinkedList<Object> values = createTemporalTypes(nullable);\n-\n-            testDates(stmt, cekJks, dateTable, values, TestCase.NORMAL, true);\n-            testDates(stmt, cekAkv, dateTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for date set date for null values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testDateSetNull(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            RandomData.returnNull = true;\n-            nullable = true;\n-            LinkedList<Object> values = createTemporalTypes(nullable);\n-\n-            testDates(stmt, cekJks, dateTable, values, TestCase.NULL, true);\n-            testDates(stmt, cekAkv, dateTable, values, TestCase.NULL, true);\n-        }\n-\n-        nullable = false;\n-        RandomData.returnNull = false;\n-    }\n-\n-    /**\n-     * Test case for date set object for null values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testDateSetObjectNull(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        RandomData.returnNull = true;\n-        nullable = true;\n-\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<Object> values = createTemporalTypes(nullable);\n-\n-            testDates(stmt, cekJks, dateTable, values, TestCase.SETOBJECT_NULL, true);\n-            testDates(stmt, cekAkv, dateTable, values, TestCase.SETOBJECT_NULL, true);\n-        }\n-\n-        nullable = false;\n-        RandomData.returnNull = false;\n-    }\n-\n-    /**\n-     * Test case for numeric set numeric for numeric values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testNumericSpecificSetter(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-\n-            String[] values1 = createNumericValues(nullable);\n-            String[] values2 = new String[values1.length];\n-            System.arraycopy(values1, 0, values2, 0, values1.length);\n-\n-            testNumerics(stmt, cekJks, numericTable, values1, values2, TestCase.NORMAL, true);\n-            testNumerics(stmt, cekAkv, numericTable, values1, values2, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for numeric set numeric for numeric values using windows certificate store\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testNumericSpecificSetterWindows(String serverName, String url, String protocol) throws Exception {\n-        org.junit.Assume.assumeTrue(System.getProperty(\"os.name\").startsWith(\"Windows\"));\n-\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-\n-            String[] values1 = createNumericValues(nullable);\n-            String[] values2 = new String[values1.length];\n-            System.arraycopy(values1, 0, values2, 0, values1.length);\n-\n-            testNumerics(stmt, cekWin, numericTable, values1, values2, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for numeric set object for numeric values F\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testNumericSetObject(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values1 = createNumericValues(nullable);\n-            String[] values2 = new String[values1.length];\n-            System.arraycopy(values1, 0, values2, 0, values1.length);\n-\n-            testNumerics(stmt, cekJks, numericTable, values1, values2, TestCase.SETOBJECT, true);\n-            testNumerics(stmt, cekAkv, numericTable, values1, values2, TestCase.SETOBJECT, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for numeric set object for jdbc type numeric values\n-     * \n-     * @throws SQLException\n+    /*\n+     * Test char", "originalCommit": "5ca3c581f2524b9c9551ef20519c76acd312d888", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY0NzY5MA==", "url": "https://github.com/microsoft/mssql-jdbc/pull/1262#discussion_r406647690", "bodyText": "test description", "author": "lilgreenbird", "createdAt": "2020-04-10T07:52:42Z", "path": "src/test/java/com/microsoft/sqlserver/jdbc/AlwaysEncrypted/EnclaveTest.java", "diffHunk": "@@ -206,656 +180,172 @@ public void testAEv2Disabled(String serverName, String url, String protocol) thr\n \n         try (SQLServerConnection con = PrepUtil.getConnection(testConnectionString);\n                 SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = createCharValues(nullable);\n-            testChars(stmt, cekJks, charTable, values, TestCase.NORMAL, true);\n+            String[] values = createCharValues(false);\n+            TestUtils.dropTableIfExists(CHAR_TABLE_AE, stmt);\n+            createTable(CHAR_TABLE_AE, cekJks, charTable);\n+            populateCharNormalCase(values);\n+            testAlterColumnEncryption(stmt, CHAR_TABLE_AE, charTable, cekJks);\n             fail(TestResource.getResource(\"R_expectedExceptionNotThrown\"));\n         } catch (Throwable e) {\n             // testChars called fail()\n             assertTrue(e.getMessage().contains(TestResource.getResource(\"R_AlterAEv2Error\")));\n         }\n     }\n \n-    /**\n-     * Test case for char set string for string values\n-     * \n-     * @throws Exception\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testCharSpecificSetter(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = createCharValues(nullable);\n-\n-            testChars(stmt, cekJks, charTable, values, TestCase.NORMAL, true);\n-            testChars(stmt, cekAkv, charTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for char set string for string values using windows certificate store\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testCharSpecificSetterWindows(String serverName, String url, String protocol) throws Exception {\n-        org.junit.Assume.assumeTrue(System.getProperty(\"os.name\").startsWith(\"Windows\"));\n-\n-        checkAESetup(serverName, url, protocol);\n-\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = createCharValues(nullable);\n-\n-            testChars(stmt, cekWin, charTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for char set object for string values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testCharSetObject(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = createCharValues(nullable);\n-\n-            testChars(stmt, cekJks, charTable, values, TestCase.SETOBJECT, true);\n-            testChars(stmt, cekAkv, charTable, values, TestCase.SETOBJECT, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for char set object for jdbc string values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testCharSetObjectWithJDBCTypes(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = createCharValues(nullable);\n-\n-            testChars(stmt, cekJks, charTable, values, TestCase.SETOBJECT_WITH_JDBCTYPES, true);\n-            testChars(stmt, cekAkv, charTable, values, TestCase.SETOBJECT_WITH_JDBCTYPES, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for char set string for null values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testCharSpecificSetterNull(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = {null, null, null, null, null, null, null, null, null};\n-\n-            testChars(stmt, cekJks, charTable, values, TestCase.NORMAL, true);\n-            testChars(stmt, cekAkv, charTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for char set object for null values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testCharSetObjectNull(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = {null, null, null, null, null, null, null, null, null};\n-\n-            testChars(stmt, cekJks, charTable, values, TestCase.SETOBJECT, true);\n-            testChars(stmt, cekAkv, charTable, values, TestCase.SETOBJECT, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for char set null for null values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testCharSetNull(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = {null, null, null, null, null, null, null, null, null};\n-\n-            testChars(stmt, cekJks, charTable, values, TestCase.NULL, true);\n-            testChars(stmt, cekAkv, charTable, values, TestCase.NULL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for binary set binary for binary values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testBinarySpecificSetter(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<byte[]> values = createBinaryValues(false);\n-\n-            testBinaries(stmt, cekJks, binaryTable, values, TestCase.NORMAL, true);\n-            testBinaries(stmt, cekAkv, binaryTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for binary set binary for binary values using windows certificate store\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testBinarySpecificSetterWindows(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        org.junit.Assume.assumeTrue(System.getProperty(\"os.name\").startsWith(\"Windows\"));\n-\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<byte[]> values = createBinaryValues(false);\n-\n-            testBinaries(stmt, cekWin, binaryTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for binary set object for binary values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testBinarySetobject(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<byte[]> values = createBinaryValues(false);\n-\n-            testBinaries(stmt, cekJks, binaryTable, values, TestCase.SETOBJECT, true);\n-            testBinaries(stmt, cekAkv, binaryTable, values, TestCase.SETOBJECT, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for binary set null for binary values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testBinarySetNull(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<byte[]> values = createBinaryValues(true);\n-\n-            testBinaries(stmt, cekJks, binaryTable, values, TestCase.NULL, true);\n-            testBinaries(stmt, cekAkv, binaryTable, values, TestCase.NULL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for binary set binary for null values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testBinarySpecificSetterNull(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<byte[]> values = createBinaryValues(true);\n-\n-            testBinaries(stmt, cekJks, binaryTable, values, TestCase.NORMAL, true);\n-            testBinaries(stmt, cekAkv, binaryTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for binary set object for null values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testBinarysetObjectNull(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<byte[]> values = createBinaryValues(true);\n-\n-            testBinaries(stmt, cekJks, binaryTable, values, TestCase.SETOBJECT_NULL, true);\n-            testBinaries(stmt, cekAkv, binaryTable, values, TestCase.SETOBJECT_NULL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for binary set object for jdbc type binary values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testBinarySetObjectWithJDBCTypes(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<byte[]> values = createBinaryValues(false);\n-\n-            testBinaries(stmt, cekJks, binaryTable, values, TestCase.SETOBJECT_WITH_JDBCTYPES, true);\n-            testBinaries(stmt, cekAkv, binaryTable, values, TestCase.SETOBJECT_WITH_JDBCTYPES, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for date set date for date values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testDateSpecificSetter(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<Object> values = createTemporalTypes(nullable);\n-\n-            testDates(stmt, cekJks, dateTable, values, TestCase.NORMAL, true);\n-            testDates(stmt, cekAkv, dateTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for date set date for date values using windows certificate store\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testDateSpecificSetterWindows(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        org.junit.Assume.assumeTrue(System.getProperty(\"os.name\").startsWith(\"Windows\"));\n-\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<Object> values = createTemporalTypes(nullable);\n-\n-            testDates(stmt, cekWin, dateTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for date set object for date values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testDateSetObject(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<Object> values = createTemporalTypes(nullable);\n-\n-            testDates(stmt, cekJks, dateTable, values, TestCase.SETOBJECT, true);\n-            testDates(stmt, cekAkv, dateTable, values, TestCase.SETOBJECT, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for date set object for java date values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testDateSetObjectWithJavaType(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<Object> values = createTemporalTypes(nullable);\n-\n-            testDates(stmt, cekJks, dateTable, values, TestCase.SETOBJECT_WITH_JAVATYPES, true);\n-            testDates(stmt, cekAkv, dateTable, values, TestCase.SETOBJECT_WITH_JAVATYPES, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for date set object for jdbc date values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testDateSetObjectWithJDBCType(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<Object> values = createTemporalTypes(nullable);\n-\n-            testDates(stmt, cekJks, dateTable, values, TestCase.SETOBJECT_WITH_JDBCTYPES, true);\n-            testDates(stmt, cekAkv, dateTable, values, TestCase.SETOBJECT_WITH_JDBCTYPES, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for date set date for min/max date values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testDateSpecificSetterMinMaxValue(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            RandomData.returnMinMax = true;\n-            LinkedList<Object> values = createTemporalTypes(nullable);\n-\n-            testDates(stmt, cekJks, dateTable, values, TestCase.NORMAL, true);\n-            testDates(stmt, cekAkv, dateTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for date set date for null values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testDateSetNull(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            RandomData.returnNull = true;\n-            nullable = true;\n-            LinkedList<Object> values = createTemporalTypes(nullable);\n-\n-            testDates(stmt, cekJks, dateTable, values, TestCase.NULL, true);\n-            testDates(stmt, cekAkv, dateTable, values, TestCase.NULL, true);\n-        }\n-\n-        nullable = false;\n-        RandomData.returnNull = false;\n-    }\n-\n-    /**\n-     * Test case for date set object for null values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testDateSetObjectNull(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        RandomData.returnNull = true;\n-        nullable = true;\n-\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<Object> values = createTemporalTypes(nullable);\n-\n-            testDates(stmt, cekJks, dateTable, values, TestCase.SETOBJECT_NULL, true);\n-            testDates(stmt, cekAkv, dateTable, values, TestCase.SETOBJECT_NULL, true);\n-        }\n-\n-        nullable = false;\n-        RandomData.returnNull = false;\n-    }\n-\n-    /**\n-     * Test case for numeric set numeric for numeric values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testNumericSpecificSetter(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-\n-            String[] values1 = createNumericValues(nullable);\n-            String[] values2 = new String[values1.length];\n-            System.arraycopy(values1, 0, values2, 0, values1.length);\n-\n-            testNumerics(stmt, cekJks, numericTable, values1, values2, TestCase.NORMAL, true);\n-            testNumerics(stmt, cekAkv, numericTable, values1, values2, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for numeric set numeric for numeric values using windows certificate store\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testNumericSpecificSetterWindows(String serverName, String url, String protocol) throws Exception {\n-        org.junit.Assume.assumeTrue(System.getProperty(\"os.name\").startsWith(\"Windows\"));\n-\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-\n-            String[] values1 = createNumericValues(nullable);\n-            String[] values2 = new String[values1.length];\n-            System.arraycopy(values1, 0, values2, 0, values1.length);\n-\n-            testNumerics(stmt, cekWin, numericTable, values1, values2, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for numeric set object for numeric values F\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testNumericSetObject(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values1 = createNumericValues(nullable);\n-            String[] values2 = new String[values1.length];\n-            System.arraycopy(values1, 0, values2, 0, values1.length);\n-\n-            testNumerics(stmt, cekJks, numericTable, values1, values2, TestCase.SETOBJECT, true);\n-            testNumerics(stmt, cekAkv, numericTable, values1, values2, TestCase.SETOBJECT, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for numeric set object for jdbc type numeric values\n-     * \n-     * @throws SQLException\n+    /*\n+     * Test char\n      */\n     @ParameterizedTest\n     @MethodSource(\"enclaveParams\")\n-    public void testNumericSetObjectWithJDBCTypes(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n+    public void testChar(String serverName, String url, String protocol) throws Exception {\n+        setAEConnectionString(serverName, url, protocol);\n         try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n                 SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values1 = createNumericValues(nullable);\n-            String[] values2 = new String[values1.length];\n-            System.arraycopy(values1, 0, values2, 0, values1.length);\n-\n-            testNumerics(stmt, cekJks, numericTable, values1, values2, TestCase.SETOBJECT_WITH_JDBCTYPES, true);\n-            testNumerics(stmt, cekAkv, numericTable, values1, values2, TestCase.SETOBJECT_WITH_JDBCTYPES, true);\n+            TestUtils.dropTableIfExists(CHAR_TABLE_AE, stmt);\n+            createTable(CHAR_TABLE_AE, cekJks, charTable);\n+            populateCharNormalCase(createCharValues(false));\n+            testAlterColumnEncryption(stmt, CHAR_TABLE_AE, charTable, cekJks);\n         }\n     }\n \n-    /**\n-     * Test case for numeric set numeric for max numeric values\n-     * \n-     * @throws SQLException\n+    /*\n+     * Test char", "originalCommit": "5ca3c581f2524b9c9551ef20519c76acd312d888", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzY2NzMyMA==", "url": "https://github.com/microsoft/mssql-jdbc/pull/1262#discussion_r407667320", "bodyText": "This code throws an exception with error message \"Expected exception is not thrown.\", which might be misleading because SQLServerException will get thrown when the server does not support AEv2, which is expected. Perhaps it is better to fail with fail(e.getMessage());.", "author": "ulvii", "createdAt": "2020-04-13T19:23:35Z", "path": "src/test/java/com/microsoft/sqlserver/jdbc/AlwaysEncrypted/AESetup.java", "diffHunk": "@@ -1959,4 +1941,38 @@ private static void dropCMK(String cmkName, Statement stmt) throws SQLException\n                 + \" drop column master key \" + cmkName + \" end\";\n         stmt.execute(cekSql);\n     }\n+\n+    /**\n+     * Alter Column encryption on deterministic columns to randomized - this will trigger enclave to re-encrypt\n+     * \n+     * @param stmt\n+     * @param tableName\n+     * @param table\n+     * @param values\n+     * @throws SQLException\n+     */\n+    protected void testAlterColumnEncryption(SQLServerStatement stmt, String tableName, String table[][],\n+            String cekName) throws SQLException {\n+        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo)) {\n+            for (int i = 0; i < table.length; i++) {\n+                // alter deterministic to randomized\n+                String sql = \"ALTER TABLE \" + tableName + \" ALTER COLUMN \" + ColumnType.DETERMINISTIC.name()\n+                        + table[i][0] + \" \" + table[i][1]\n+                        + String.format(encryptSql, ColumnType.RANDOMIZED.name(), cekName) + \")\";\n+                try (SQLServerPreparedStatement pstmt = (SQLServerPreparedStatement) TestUtils.getPreparedStmt(con, sql,\n+                        stmtColEncSetting)) {\n+                    stmt.execute(sql);\n+                    if (!TestUtils.isAEv2(con)) {\n+                        fail(TestResource.getResource(\"R_expectedExceptionNotThrown\"));\n+                    }\n+                } catch (SQLException e) {\n+                    if (!TestUtils.isAEv2(con)) {\n+                        fail(TestResource.getResource(\"R_expectedExceptionNotThrown\"));", "originalCommit": "5ca3c581f2524b9c9551ef20519c76acd312d888", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzc5NjgzNg==", "url": "https://github.com/microsoft/mssql-jdbc/pull/1262#discussion_r407796836", "bodyText": "good point, please make the same change in JDBCEncryptionDecryptionTest", "author": "lilgreenbird", "createdAt": "2020-04-14T00:32:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzY2NzMyMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzY3NzMyMA==", "url": "https://github.com/microsoft/mssql-jdbc/pull/1262#discussion_r407677320", "bodyText": "Do the tables get cleaned up when the tests are done?", "author": "ulvii", "createdAt": "2020-04-13T19:43:06Z", "path": "src/test/java/com/microsoft/sqlserver/jdbc/AlwaysEncrypted/EnclaveTest.java", "diffHunk": "@@ -206,656 +180,172 @@ public void testAEv2Disabled(String serverName, String url, String protocol) thr\n \n         try (SQLServerConnection con = PrepUtil.getConnection(testConnectionString);\n                 SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = createCharValues(nullable);\n-            testChars(stmt, cekJks, charTable, values, TestCase.NORMAL, true);\n+            String[] values = createCharValues(false);\n+            TestUtils.dropTableIfExists(CHAR_TABLE_AE, stmt);\n+            createTable(CHAR_TABLE_AE, cekJks, charTable);", "originalCommit": "5ca3c581f2524b9c9551ef20519c76acd312d888", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzY3ODQwMw==", "url": "https://github.com/microsoft/mssql-jdbc/pull/1262#discussion_r407678403", "bodyText": "Are these tests tan in parallel or sequentially. If they are ran in parallel, wouldn't there be a conflict because tests are using the same table?", "author": "ulvii", "createdAt": "2020-04-13T19:45:12Z", "path": "src/test/java/com/microsoft/sqlserver/jdbc/AlwaysEncrypted/EnclaveTest.java", "diffHunk": "@@ -206,656 +180,172 @@ public void testAEv2Disabled(String serverName, String url, String protocol) thr\n \n         try (SQLServerConnection con = PrepUtil.getConnection(testConnectionString);\n                 SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = createCharValues(nullable);\n-            testChars(stmt, cekJks, charTable, values, TestCase.NORMAL, true);\n+            String[] values = createCharValues(false);\n+            TestUtils.dropTableIfExists(CHAR_TABLE_AE, stmt);", "originalCommit": "5ca3c581f2524b9c9551ef20519c76acd312d888", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODI5MDQ1NQ==", "url": "https://github.com/microsoft/mssql-jdbc/pull/1262#discussion_r408290455", "bodyText": "The classes themselves aren't run in parallel, e.g. EnclaveTest can run alongside JDBCEncryptionDecryption, but multiple EnclaveTest test cases can't be run at the same time. I don't think the chances of conflicts are very high but we can circumvent it either way by forcing the tests to use/create different databases if it becomes a problem.", "author": "rene-ye", "createdAt": "2020-04-14T16:55:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzY3ODQwMw=="}], "type": "inlineReview"}, {"oid": "0d27d52ba435c3aa85a5765639dea4bd0c9707ce", "url": "https://github.com/microsoft/mssql-jdbc/commit/0d27d52ba435c3aa85a5765639dea4bd0c9707ce", "message": "address comments", "committedDate": "2020-04-14T17:00:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ2ODQ4Mg==", "url": "https://github.com/microsoft/mssql-jdbc/pull/1262#discussion_r408468482", "bodyText": "Expected value should come first.", "author": "ulvii", "createdAt": "2020-04-14T22:16:35Z", "path": "src/test/java/com/microsoft/sqlserver/jdbc/AlwaysEncrypted/EnclaveTest.java", "diffHunk": "@@ -206,656 +181,183 @@ public void testAEv2Disabled(String serverName, String url, String protocol) thr\n \n         try (SQLServerConnection con = PrepUtil.getConnection(testConnectionString);\n                 SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = createCharValues(nullable);\n-            testChars(stmt, cekJks, charTable, values, TestCase.NORMAL, true);\n+            String[] values = createCharValues(false);\n+            TestUtils.dropTableIfExists(CHAR_TABLE_AE, stmt);\n+            createTable(CHAR_TABLE_AE, cekJks, charTable);\n+            populateCharNormalCase(values);\n+            testAlterColumnEncryption(stmt, CHAR_TABLE_AE, charTable, cekJks);\n             fail(TestResource.getResource(\"R_expectedExceptionNotThrown\"));\n         } catch (Throwable e) {\n             // testChars called fail()\n             assertTrue(e.getMessage().contains(TestResource.getResource(\"R_AlterAEv2Error\")));\n         }\n     }\n \n-    /**\n-     * Test case for char set string for string values\n-     * \n-     * @throws Exception\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testCharSpecificSetter(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = createCharValues(nullable);\n-\n-            testChars(stmt, cekJks, charTable, values, TestCase.NORMAL, true);\n-            testChars(stmt, cekAkv, charTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for char set string for string values using windows certificate store\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testCharSpecificSetterWindows(String serverName, String url, String protocol) throws Exception {\n-        org.junit.Assume.assumeTrue(System.getProperty(\"os.name\").startsWith(\"Windows\"));\n-\n-        checkAESetup(serverName, url, protocol);\n-\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = createCharValues(nullable);\n-\n-            testChars(stmt, cekWin, charTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for char set object for string values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testCharSetObject(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = createCharValues(nullable);\n-\n-            testChars(stmt, cekJks, charTable, values, TestCase.SETOBJECT, true);\n-            testChars(stmt, cekAkv, charTable, values, TestCase.SETOBJECT, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for char set object for jdbc string values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testCharSetObjectWithJDBCTypes(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = createCharValues(nullable);\n-\n-            testChars(stmt, cekJks, charTable, values, TestCase.SETOBJECT_WITH_JDBCTYPES, true);\n-            testChars(stmt, cekAkv, charTable, values, TestCase.SETOBJECT_WITH_JDBCTYPES, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for char set string for null values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testCharSpecificSetterNull(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = {null, null, null, null, null, null, null, null, null};\n-\n-            testChars(stmt, cekJks, charTable, values, TestCase.NORMAL, true);\n-            testChars(stmt, cekAkv, charTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for char set object for null values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testCharSetObjectNull(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = {null, null, null, null, null, null, null, null, null};\n-\n-            testChars(stmt, cekJks, charTable, values, TestCase.SETOBJECT, true);\n-            testChars(stmt, cekAkv, charTable, values, TestCase.SETOBJECT, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for char set null for null values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testCharSetNull(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = {null, null, null, null, null, null, null, null, null};\n-\n-            testChars(stmt, cekJks, charTable, values, TestCase.NULL, true);\n-            testChars(stmt, cekAkv, charTable, values, TestCase.NULL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for binary set binary for binary values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testBinarySpecificSetter(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<byte[]> values = createBinaryValues(false);\n-\n-            testBinaries(stmt, cekJks, binaryTable, values, TestCase.NORMAL, true);\n-            testBinaries(stmt, cekAkv, binaryTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for binary set binary for binary values using windows certificate store\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testBinarySpecificSetterWindows(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        org.junit.Assume.assumeTrue(System.getProperty(\"os.name\").startsWith(\"Windows\"));\n-\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<byte[]> values = createBinaryValues(false);\n-\n-            testBinaries(stmt, cekWin, binaryTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for binary set object for binary values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testBinarySetobject(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<byte[]> values = createBinaryValues(false);\n-\n-            testBinaries(stmt, cekJks, binaryTable, values, TestCase.SETOBJECT, true);\n-            testBinaries(stmt, cekAkv, binaryTable, values, TestCase.SETOBJECT, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for binary set null for binary values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testBinarySetNull(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<byte[]> values = createBinaryValues(true);\n-\n-            testBinaries(stmt, cekJks, binaryTable, values, TestCase.NULL, true);\n-            testBinaries(stmt, cekAkv, binaryTable, values, TestCase.NULL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for binary set binary for null values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testBinarySpecificSetterNull(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<byte[]> values = createBinaryValues(true);\n-\n-            testBinaries(stmt, cekJks, binaryTable, values, TestCase.NORMAL, true);\n-            testBinaries(stmt, cekAkv, binaryTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for binary set object for null values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testBinarysetObjectNull(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<byte[]> values = createBinaryValues(true);\n-\n-            testBinaries(stmt, cekJks, binaryTable, values, TestCase.SETOBJECT_NULL, true);\n-            testBinaries(stmt, cekAkv, binaryTable, values, TestCase.SETOBJECT_NULL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for binary set object for jdbc type binary values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testBinarySetObjectWithJDBCTypes(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<byte[]> values = createBinaryValues(false);\n-\n-            testBinaries(stmt, cekJks, binaryTable, values, TestCase.SETOBJECT_WITH_JDBCTYPES, true);\n-            testBinaries(stmt, cekAkv, binaryTable, values, TestCase.SETOBJECT_WITH_JDBCTYPES, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for date set date for date values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testDateSpecificSetter(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<Object> values = createTemporalTypes(nullable);\n-\n-            testDates(stmt, cekJks, dateTable, values, TestCase.NORMAL, true);\n-            testDates(stmt, cekAkv, dateTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for date set date for date values using windows certificate store\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testDateSpecificSetterWindows(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        org.junit.Assume.assumeTrue(System.getProperty(\"os.name\").startsWith(\"Windows\"));\n-\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<Object> values = createTemporalTypes(nullable);\n-\n-            testDates(stmt, cekWin, dateTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for date set object for date values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testDateSetObject(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<Object> values = createTemporalTypes(nullable);\n-\n-            testDates(stmt, cekJks, dateTable, values, TestCase.SETOBJECT, true);\n-            testDates(stmt, cekAkv, dateTable, values, TestCase.SETOBJECT, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for date set object for java date values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testDateSetObjectWithJavaType(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<Object> values = createTemporalTypes(nullable);\n-\n-            testDates(stmt, cekJks, dateTable, values, TestCase.SETOBJECT_WITH_JAVATYPES, true);\n-            testDates(stmt, cekAkv, dateTable, values, TestCase.SETOBJECT_WITH_JAVATYPES, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for date set object for jdbc date values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testDateSetObjectWithJDBCType(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<Object> values = createTemporalTypes(nullable);\n-\n-            testDates(stmt, cekJks, dateTable, values, TestCase.SETOBJECT_WITH_JDBCTYPES, true);\n-            testDates(stmt, cekAkv, dateTable, values, TestCase.SETOBJECT_WITH_JDBCTYPES, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for date set date for min/max date values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testDateSpecificSetterMinMaxValue(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            RandomData.returnMinMax = true;\n-            LinkedList<Object> values = createTemporalTypes(nullable);\n-\n-            testDates(stmt, cekJks, dateTable, values, TestCase.NORMAL, true);\n-            testDates(stmt, cekAkv, dateTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for date set date for null values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testDateSetNull(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            RandomData.returnNull = true;\n-            nullable = true;\n-            LinkedList<Object> values = createTemporalTypes(nullable);\n-\n-            testDates(stmt, cekJks, dateTable, values, TestCase.NULL, true);\n-            testDates(stmt, cekAkv, dateTable, values, TestCase.NULL, true);\n-        }\n-\n-        nullable = false;\n-        RandomData.returnNull = false;\n-    }\n-\n-    /**\n-     * Test case for date set object for null values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testDateSetObjectNull(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        RandomData.returnNull = true;\n-        nullable = true;\n-\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<Object> values = createTemporalTypes(nullable);\n-\n-            testDates(stmt, cekJks, dateTable, values, TestCase.SETOBJECT_NULL, true);\n-            testDates(stmt, cekAkv, dateTable, values, TestCase.SETOBJECT_NULL, true);\n-        }\n-\n-        nullable = false;\n-        RandomData.returnNull = false;\n-    }\n-\n-    /**\n-     * Test case for numeric set numeric for numeric values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testNumericSpecificSetter(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-\n-            String[] values1 = createNumericValues(nullable);\n-            String[] values2 = new String[values1.length];\n-            System.arraycopy(values1, 0, values2, 0, values1.length);\n-\n-            testNumerics(stmt, cekJks, numericTable, values1, values2, TestCase.NORMAL, true);\n-            testNumerics(stmt, cekAkv, numericTable, values1, values2, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for numeric set numeric for numeric values using windows certificate store\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testNumericSpecificSetterWindows(String serverName, String url, String protocol) throws Exception {\n-        org.junit.Assume.assumeTrue(System.getProperty(\"os.name\").startsWith(\"Windows\"));\n-\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-\n-            String[] values1 = createNumericValues(nullable);\n-            String[] values2 = new String[values1.length];\n-            System.arraycopy(values1, 0, values2, 0, values1.length);\n-\n-            testNumerics(stmt, cekWin, numericTable, values1, values2, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for numeric set object for numeric values F\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testNumericSetObject(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values1 = createNumericValues(nullable);\n-            String[] values2 = new String[values1.length];\n-            System.arraycopy(values1, 0, values2, 0, values1.length);\n-\n-            testNumerics(stmt, cekJks, numericTable, values1, values2, TestCase.SETOBJECT, true);\n-            testNumerics(stmt, cekAkv, numericTable, values1, values2, TestCase.SETOBJECT, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for numeric set object for jdbc type numeric values\n-     * \n-     * @throws SQLException\n+    /*\n+     * Tests alter column encryption on char tables\n      */\n     @ParameterizedTest\n     @MethodSource(\"enclaveParams\")\n-    public void testNumericSetObjectWithJDBCTypes(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n+    public void testChar(String serverName, String url, String protocol) throws Exception {\n+        setAEConnectionString(serverName, url, protocol);\n         try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n                 SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values1 = createNumericValues(nullable);\n-            String[] values2 = new String[values1.length];\n-            System.arraycopy(values1, 0, values2, 0, values1.length);\n-\n-            testNumerics(stmt, cekJks, numericTable, values1, values2, TestCase.SETOBJECT_WITH_JDBCTYPES, true);\n-            testNumerics(stmt, cekAkv, numericTable, values1, values2, TestCase.SETOBJECT_WITH_JDBCTYPES, true);\n+            TestUtils.dropTableIfExists(CHAR_TABLE_AE, stmt);\n+            createTable(CHAR_TABLE_AE, cekJks, charTable);\n+            populateCharNormalCase(createCharValues(false));\n+            testAlterColumnEncryption(stmt, CHAR_TABLE_AE, charTable, cekJks);\n         }\n     }\n \n-    /**\n-     * Test case for numeric set numeric for max numeric values\n-     * \n-     * @throws SQLException\n+    /*\n+     * Tests alter column encryption on char tables with AKV\n      */\n     @ParameterizedTest\n     @MethodSource(\"enclaveParams\")\n-    public void testNumericSpecificSetterMaxValue(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n+    public void testCharAkv(String serverName, String url, String protocol) throws Exception {\n+        setAEConnectionString(serverName, url, protocol);\n         try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n                 SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-\n-            String[] values1 = {Boolean.TRUE.toString(), \"255\", \"32767\", \"2147483647\", \"9223372036854775807\",\n-                    \"1.79E308\", \"1.123\", \"3.4E38\", \"999999999999999999\", \"12345.12345\", \"999999999999999999\",\n-                    \"567812.78\", \"214748.3647\", \"922337203685477.5807\", \"999999999999999999999999.9999\",\n-                    \"999999999999999999999999.9999\"};\n-            String[] values2 = {Boolean.TRUE.toString(), \"255\", \"32767\", \"2147483647\", \"9223372036854775807\",\n-                    \"1.79E308\", \"1.123\", \"3.4E38\", \"999999999999999999\", \"12345.12345\", \"999999999999999999\",\n-                    \"567812.78\", \"214748.3647\", \"922337203685477.5807\", \"999999999999999999999999.9999\",\n-                    \"999999999999999999999999.9999\"};\n-\n-            testNumerics(stmt, cekJks, numericTable, values1, values2, TestCase.NORMAL, true);\n-            testNumerics(stmt, cekAkv, numericTable, values1, values2, TestCase.NORMAL, true);\n+            TestUtils.dropTableIfExists(CHAR_TABLE_AE, stmt);\n+            createTable(CHAR_TABLE_AE, cekAkv, charTable);\n+            populateCharNormalCase(createCharValues(false));\n+            testAlterColumnEncryption(stmt, CHAR_TABLE_AE, charTable, cekAkv);\n         }\n     }\n \n     /**\n-     * Test case for numeric set numeric for min numeric values\n+     * Test FMTOnly with Always Encrypted\n      * \n      * @throws SQLException\n      */\n     @ParameterizedTest\n     @MethodSource(\"enclaveParams\")\n-    public void testNumericSpecificSetterMinValue(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values1 = {Boolean.FALSE.toString(), \"0\", \"-32768\", \"-2147483648\", \"-9223372036854775808\",\n-                    \"-1.79E308\", \"1.123\", \"-3.4E38\", \"999999999999999999\", \"12345.12345\", \"999999999999999999\",\n-                    \"567812.78\", \"-214748.3648\", \"-922337203685477.5808\", \"999999999999999999999999.9999\",\n-                    \"999999999999999999999999.9999\"};\n-            String[] values2 = {Boolean.FALSE.toString(), \"0\", \"-32768\", \"-2147483648\", \"-9223372036854775808\",\n-                    \"-1.79E308\", \"1.123\", \"-3.4E38\", \"999999999999999999\", \"12345.12345\", \"999999999999999999\",\n-                    \"567812.78\", \"-214748.3648\", \"-922337203685477.5808\", \"999999999999999999999999.9999\",\n-                    \"999999999999999999999999.9999\"};\n-\n-            testNumerics(stmt, cekJks, numericTable, values1, values2, TestCase.NORMAL, true);\n-            testNumerics(stmt, cekAkv, numericTable, values1, values2, TestCase.NORMAL, true);\n+    public void testAEFMTOnly(String serverName, String url, String protocol) throws Exception {\n+        setAEConnectionString(serverName, url, protocol);\n+        try (SQLServerConnection c = PrepUtil.getConnection(AETestConnectionString + \";useFmtOnly=true\", AEInfo);\n+                Statement s = c.createStatement()) {\n+            createTable(NUMERIC_TABLE_AE, cekJks, numericTable);\n+            String sql = \"insert into \" + NUMERIC_TABLE_AE + \" values( \" + \"?,?,?,\" + \"?,?,?,\" + \"?,?,?,\" + \"?,?,?,\"\n+                    + \"?,?,?,\" + \"?,?,?,\" + \"?,?,?,\" + \"?,?,?,\" + \"?,?,?,\" + \"?,?,?,\" + \"?,?,?,\" + \"?,?,?,\" + \"?,?,?,\"\n+                    + \"?,?,?,\" + \"?,?,?,\" + \"?,?,?\" + \")\";\n+            try (PreparedStatement p = c.prepareStatement(sql)) {\n+                ParameterMetaData pmd = p.getParameterMetaData();\n+                assertTrue(pmd.getParameterCount() == 48);\n+            }\n         }\n     }\n \n     /**\n-     * Test case for numeric set numeric for null values\n-     * \n-     * @throws SQLException\n+     * Test alter column\n      */\n     @ParameterizedTest\n     @MethodSource(\"enclaveParams\")\n-    public void testNumericSpecificSetterNull(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            nullable = true;\n-            RandomData.returnNull = true;\n-            String[] values1 = createNumericValues(nullable);\n-            String[] values2 = new String[values1.length];\n-            System.arraycopy(values1, 0, values2, 0, values1.length);\n-\n-            testNumerics(stmt, cekJks, numericTable, values1, values2, TestCase.NULL, true);\n-            testNumerics(stmt, cekAkv, numericTable, values1, values2, TestCase.NULL, true);\n+    public void testAlter(String serverName, String url, String protocol) throws Exception {\n+        setAEConnectionString(serverName, url, protocol);\n+        try (SQLServerConnection c = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n+                Statement s = c.createStatement()) {\n+            createTable(CHAR_TABLE_AE, cekJks, varcharTableSimple);\n+            PreparedStatement pstmt = c.prepareStatement(\"INSERT INTO \" + CHAR_TABLE_AE + \" VALUES (?,?,?)\");\n+            pstmt.setString(1, \"a\");\n+            pstmt.setString(2, \"b\");\n+            pstmt.setString(3, \"test\");\n+            pstmt.execute();\n+            pstmt = c.prepareStatement(\"ALTER TABLE \" + CHAR_TABLE_AE\n+                    + \" ALTER COLUMN RandomizedVarchar VARCHAR(20) NULL WITH (ONLINE = ON)\");\n+            pstmt.execute();\n         }\n-\n-        nullable = false;\n-        RandomData.returnNull = false;\n     }\n \n     /**\n-     * Test case for numeric set object for null values\n-     * \n-     * @throws SQLException\n+     * Rich Query with number compare\n      */\n     @ParameterizedTest\n     @MethodSource(\"enclaveParams\")\n-    public void testNumericSpecificSetterSetObjectNull(String serverName, String url,\n-            String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            nullable = true;\n-            RandomData.returnNull = true;\n-            String[] values1 = createNumericValues(nullable);\n-            String[] values2 = new String[values1.length];\n-            System.arraycopy(values1, 0, values2, 0, values1.length);\n-\n-            testNumerics(stmt, cekJks, numericTable, values1, values2, TestCase.NULL, true);\n-            testNumerics(stmt, cekAkv, numericTable, values1, values2, TestCase.NULL, true);\n+    public void testNumericRichQuery(String serverName, String url, String protocol) throws Exception {\n+        setAEConnectionString(serverName, url, protocol);\n+        try (SQLServerConnection c = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n+                Statement s = c.createStatement()) {\n+            createTable(NUMERIC_TABLE_AE, cekJks, numericTableSimple);\n+            PreparedStatement pstmt = c.prepareStatement(\"INSERT INTO \" + NUMERIC_TABLE_AE + \" VALUES (?,?,?)\");\n+            pstmt.setInt(1, 1);\n+            pstmt.setInt(2, 2);\n+            pstmt.setInt(3, 3);\n+            pstmt.execute();\n+            pstmt = c.prepareStatement(\"SELECT * FROM \" + NUMERIC_TABLE_AE + \" WHERE RANDOMIZEDInt = ?\");\n+            pstmt.setInt(1, 3);\n+            try (ResultSet rs = pstmt.executeQuery()) {\n+                while (rs.next()) {\n+                    assertTrue(rs.getInt(1) == 1);", "originalCommit": "0d27d52ba435c3aa85a5765639dea4bd0c9707ce", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ2OTIzMw==", "url": "https://github.com/microsoft/mssql-jdbc/pull/1262#discussion_r408469233", "bodyText": "Expected value should come first.", "author": "ulvii", "createdAt": "2020-04-14T22:18:31Z", "path": "src/test/java/com/microsoft/sqlserver/jdbc/AlwaysEncrypted/EnclaveTest.java", "diffHunk": "@@ -206,656 +181,183 @@ public void testAEv2Disabled(String serverName, String url, String protocol) thr\n \n         try (SQLServerConnection con = PrepUtil.getConnection(testConnectionString);\n                 SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = createCharValues(nullable);\n-            testChars(stmt, cekJks, charTable, values, TestCase.NORMAL, true);\n+            String[] values = createCharValues(false);\n+            TestUtils.dropTableIfExists(CHAR_TABLE_AE, stmt);\n+            createTable(CHAR_TABLE_AE, cekJks, charTable);\n+            populateCharNormalCase(values);\n+            testAlterColumnEncryption(stmt, CHAR_TABLE_AE, charTable, cekJks);\n             fail(TestResource.getResource(\"R_expectedExceptionNotThrown\"));\n         } catch (Throwable e) {\n             // testChars called fail()\n             assertTrue(e.getMessage().contains(TestResource.getResource(\"R_AlterAEv2Error\")));\n         }\n     }\n \n-    /**\n-     * Test case for char set string for string values\n-     * \n-     * @throws Exception\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testCharSpecificSetter(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = createCharValues(nullable);\n-\n-            testChars(stmt, cekJks, charTable, values, TestCase.NORMAL, true);\n-            testChars(stmt, cekAkv, charTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for char set string for string values using windows certificate store\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testCharSpecificSetterWindows(String serverName, String url, String protocol) throws Exception {\n-        org.junit.Assume.assumeTrue(System.getProperty(\"os.name\").startsWith(\"Windows\"));\n-\n-        checkAESetup(serverName, url, protocol);\n-\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = createCharValues(nullable);\n-\n-            testChars(stmt, cekWin, charTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for char set object for string values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testCharSetObject(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = createCharValues(nullable);\n-\n-            testChars(stmt, cekJks, charTable, values, TestCase.SETOBJECT, true);\n-            testChars(stmt, cekAkv, charTable, values, TestCase.SETOBJECT, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for char set object for jdbc string values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testCharSetObjectWithJDBCTypes(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = createCharValues(nullable);\n-\n-            testChars(stmt, cekJks, charTable, values, TestCase.SETOBJECT_WITH_JDBCTYPES, true);\n-            testChars(stmt, cekAkv, charTable, values, TestCase.SETOBJECT_WITH_JDBCTYPES, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for char set string for null values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testCharSpecificSetterNull(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = {null, null, null, null, null, null, null, null, null};\n-\n-            testChars(stmt, cekJks, charTable, values, TestCase.NORMAL, true);\n-            testChars(stmt, cekAkv, charTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for char set object for null values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testCharSetObjectNull(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = {null, null, null, null, null, null, null, null, null};\n-\n-            testChars(stmt, cekJks, charTable, values, TestCase.SETOBJECT, true);\n-            testChars(stmt, cekAkv, charTable, values, TestCase.SETOBJECT, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for char set null for null values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testCharSetNull(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = {null, null, null, null, null, null, null, null, null};\n-\n-            testChars(stmt, cekJks, charTable, values, TestCase.NULL, true);\n-            testChars(stmt, cekAkv, charTable, values, TestCase.NULL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for binary set binary for binary values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testBinarySpecificSetter(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<byte[]> values = createBinaryValues(false);\n-\n-            testBinaries(stmt, cekJks, binaryTable, values, TestCase.NORMAL, true);\n-            testBinaries(stmt, cekAkv, binaryTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for binary set binary for binary values using windows certificate store\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testBinarySpecificSetterWindows(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        org.junit.Assume.assumeTrue(System.getProperty(\"os.name\").startsWith(\"Windows\"));\n-\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<byte[]> values = createBinaryValues(false);\n-\n-            testBinaries(stmt, cekWin, binaryTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for binary set object for binary values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testBinarySetobject(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<byte[]> values = createBinaryValues(false);\n-\n-            testBinaries(stmt, cekJks, binaryTable, values, TestCase.SETOBJECT, true);\n-            testBinaries(stmt, cekAkv, binaryTable, values, TestCase.SETOBJECT, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for binary set null for binary values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testBinarySetNull(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<byte[]> values = createBinaryValues(true);\n-\n-            testBinaries(stmt, cekJks, binaryTable, values, TestCase.NULL, true);\n-            testBinaries(stmt, cekAkv, binaryTable, values, TestCase.NULL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for binary set binary for null values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testBinarySpecificSetterNull(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<byte[]> values = createBinaryValues(true);\n-\n-            testBinaries(stmt, cekJks, binaryTable, values, TestCase.NORMAL, true);\n-            testBinaries(stmt, cekAkv, binaryTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for binary set object for null values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testBinarysetObjectNull(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<byte[]> values = createBinaryValues(true);\n-\n-            testBinaries(stmt, cekJks, binaryTable, values, TestCase.SETOBJECT_NULL, true);\n-            testBinaries(stmt, cekAkv, binaryTable, values, TestCase.SETOBJECT_NULL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for binary set object for jdbc type binary values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testBinarySetObjectWithJDBCTypes(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<byte[]> values = createBinaryValues(false);\n-\n-            testBinaries(stmt, cekJks, binaryTable, values, TestCase.SETOBJECT_WITH_JDBCTYPES, true);\n-            testBinaries(stmt, cekAkv, binaryTable, values, TestCase.SETOBJECT_WITH_JDBCTYPES, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for date set date for date values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testDateSpecificSetter(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<Object> values = createTemporalTypes(nullable);\n-\n-            testDates(stmt, cekJks, dateTable, values, TestCase.NORMAL, true);\n-            testDates(stmt, cekAkv, dateTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for date set date for date values using windows certificate store\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testDateSpecificSetterWindows(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        org.junit.Assume.assumeTrue(System.getProperty(\"os.name\").startsWith(\"Windows\"));\n-\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<Object> values = createTemporalTypes(nullable);\n-\n-            testDates(stmt, cekWin, dateTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for date set object for date values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testDateSetObject(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<Object> values = createTemporalTypes(nullable);\n-\n-            testDates(stmt, cekJks, dateTable, values, TestCase.SETOBJECT, true);\n-            testDates(stmt, cekAkv, dateTable, values, TestCase.SETOBJECT, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for date set object for java date values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testDateSetObjectWithJavaType(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<Object> values = createTemporalTypes(nullable);\n-\n-            testDates(stmt, cekJks, dateTable, values, TestCase.SETOBJECT_WITH_JAVATYPES, true);\n-            testDates(stmt, cekAkv, dateTable, values, TestCase.SETOBJECT_WITH_JAVATYPES, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for date set object for jdbc date values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testDateSetObjectWithJDBCType(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<Object> values = createTemporalTypes(nullable);\n-\n-            testDates(stmt, cekJks, dateTable, values, TestCase.SETOBJECT_WITH_JDBCTYPES, true);\n-            testDates(stmt, cekAkv, dateTable, values, TestCase.SETOBJECT_WITH_JDBCTYPES, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for date set date for min/max date values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testDateSpecificSetterMinMaxValue(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            RandomData.returnMinMax = true;\n-            LinkedList<Object> values = createTemporalTypes(nullable);\n-\n-            testDates(stmt, cekJks, dateTable, values, TestCase.NORMAL, true);\n-            testDates(stmt, cekAkv, dateTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for date set date for null values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testDateSetNull(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            RandomData.returnNull = true;\n-            nullable = true;\n-            LinkedList<Object> values = createTemporalTypes(nullable);\n-\n-            testDates(stmt, cekJks, dateTable, values, TestCase.NULL, true);\n-            testDates(stmt, cekAkv, dateTable, values, TestCase.NULL, true);\n-        }\n-\n-        nullable = false;\n-        RandomData.returnNull = false;\n-    }\n-\n-    /**\n-     * Test case for date set object for null values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testDateSetObjectNull(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        RandomData.returnNull = true;\n-        nullable = true;\n-\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<Object> values = createTemporalTypes(nullable);\n-\n-            testDates(stmt, cekJks, dateTable, values, TestCase.SETOBJECT_NULL, true);\n-            testDates(stmt, cekAkv, dateTable, values, TestCase.SETOBJECT_NULL, true);\n-        }\n-\n-        nullable = false;\n-        RandomData.returnNull = false;\n-    }\n-\n-    /**\n-     * Test case for numeric set numeric for numeric values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testNumericSpecificSetter(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-\n-            String[] values1 = createNumericValues(nullable);\n-            String[] values2 = new String[values1.length];\n-            System.arraycopy(values1, 0, values2, 0, values1.length);\n-\n-            testNumerics(stmt, cekJks, numericTable, values1, values2, TestCase.NORMAL, true);\n-            testNumerics(stmt, cekAkv, numericTable, values1, values2, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for numeric set numeric for numeric values using windows certificate store\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testNumericSpecificSetterWindows(String serverName, String url, String protocol) throws Exception {\n-        org.junit.Assume.assumeTrue(System.getProperty(\"os.name\").startsWith(\"Windows\"));\n-\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-\n-            String[] values1 = createNumericValues(nullable);\n-            String[] values2 = new String[values1.length];\n-            System.arraycopy(values1, 0, values2, 0, values1.length);\n-\n-            testNumerics(stmt, cekWin, numericTable, values1, values2, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for numeric set object for numeric values F\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testNumericSetObject(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values1 = createNumericValues(nullable);\n-            String[] values2 = new String[values1.length];\n-            System.arraycopy(values1, 0, values2, 0, values1.length);\n-\n-            testNumerics(stmt, cekJks, numericTable, values1, values2, TestCase.SETOBJECT, true);\n-            testNumerics(stmt, cekAkv, numericTable, values1, values2, TestCase.SETOBJECT, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for numeric set object for jdbc type numeric values\n-     * \n-     * @throws SQLException\n+    /*\n+     * Tests alter column encryption on char tables\n      */\n     @ParameterizedTest\n     @MethodSource(\"enclaveParams\")\n-    public void testNumericSetObjectWithJDBCTypes(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n+    public void testChar(String serverName, String url, String protocol) throws Exception {\n+        setAEConnectionString(serverName, url, protocol);\n         try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n                 SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values1 = createNumericValues(nullable);\n-            String[] values2 = new String[values1.length];\n-            System.arraycopy(values1, 0, values2, 0, values1.length);\n-\n-            testNumerics(stmt, cekJks, numericTable, values1, values2, TestCase.SETOBJECT_WITH_JDBCTYPES, true);\n-            testNumerics(stmt, cekAkv, numericTable, values1, values2, TestCase.SETOBJECT_WITH_JDBCTYPES, true);\n+            TestUtils.dropTableIfExists(CHAR_TABLE_AE, stmt);\n+            createTable(CHAR_TABLE_AE, cekJks, charTable);\n+            populateCharNormalCase(createCharValues(false));\n+            testAlterColumnEncryption(stmt, CHAR_TABLE_AE, charTable, cekJks);\n         }\n     }\n \n-    /**\n-     * Test case for numeric set numeric for max numeric values\n-     * \n-     * @throws SQLException\n+    /*\n+     * Tests alter column encryption on char tables with AKV\n      */\n     @ParameterizedTest\n     @MethodSource(\"enclaveParams\")\n-    public void testNumericSpecificSetterMaxValue(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n+    public void testCharAkv(String serverName, String url, String protocol) throws Exception {\n+        setAEConnectionString(serverName, url, protocol);\n         try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n                 SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-\n-            String[] values1 = {Boolean.TRUE.toString(), \"255\", \"32767\", \"2147483647\", \"9223372036854775807\",\n-                    \"1.79E308\", \"1.123\", \"3.4E38\", \"999999999999999999\", \"12345.12345\", \"999999999999999999\",\n-                    \"567812.78\", \"214748.3647\", \"922337203685477.5807\", \"999999999999999999999999.9999\",\n-                    \"999999999999999999999999.9999\"};\n-            String[] values2 = {Boolean.TRUE.toString(), \"255\", \"32767\", \"2147483647\", \"9223372036854775807\",\n-                    \"1.79E308\", \"1.123\", \"3.4E38\", \"999999999999999999\", \"12345.12345\", \"999999999999999999\",\n-                    \"567812.78\", \"214748.3647\", \"922337203685477.5807\", \"999999999999999999999999.9999\",\n-                    \"999999999999999999999999.9999\"};\n-\n-            testNumerics(stmt, cekJks, numericTable, values1, values2, TestCase.NORMAL, true);\n-            testNumerics(stmt, cekAkv, numericTable, values1, values2, TestCase.NORMAL, true);\n+            TestUtils.dropTableIfExists(CHAR_TABLE_AE, stmt);\n+            createTable(CHAR_TABLE_AE, cekAkv, charTable);\n+            populateCharNormalCase(createCharValues(false));\n+            testAlterColumnEncryption(stmt, CHAR_TABLE_AE, charTable, cekAkv);\n         }\n     }\n \n     /**\n-     * Test case for numeric set numeric for min numeric values\n+     * Test FMTOnly with Always Encrypted\n      * \n      * @throws SQLException\n      */\n     @ParameterizedTest\n     @MethodSource(\"enclaveParams\")\n-    public void testNumericSpecificSetterMinValue(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values1 = {Boolean.FALSE.toString(), \"0\", \"-32768\", \"-2147483648\", \"-9223372036854775808\",\n-                    \"-1.79E308\", \"1.123\", \"-3.4E38\", \"999999999999999999\", \"12345.12345\", \"999999999999999999\",\n-                    \"567812.78\", \"-214748.3648\", \"-922337203685477.5808\", \"999999999999999999999999.9999\",\n-                    \"999999999999999999999999.9999\"};\n-            String[] values2 = {Boolean.FALSE.toString(), \"0\", \"-32768\", \"-2147483648\", \"-9223372036854775808\",\n-                    \"-1.79E308\", \"1.123\", \"-3.4E38\", \"999999999999999999\", \"12345.12345\", \"999999999999999999\",\n-                    \"567812.78\", \"-214748.3648\", \"-922337203685477.5808\", \"999999999999999999999999.9999\",\n-                    \"999999999999999999999999.9999\"};\n-\n-            testNumerics(stmt, cekJks, numericTable, values1, values2, TestCase.NORMAL, true);\n-            testNumerics(stmt, cekAkv, numericTable, values1, values2, TestCase.NORMAL, true);\n+    public void testAEFMTOnly(String serverName, String url, String protocol) throws Exception {\n+        setAEConnectionString(serverName, url, protocol);\n+        try (SQLServerConnection c = PrepUtil.getConnection(AETestConnectionString + \";useFmtOnly=true\", AEInfo);\n+                Statement s = c.createStatement()) {\n+            createTable(NUMERIC_TABLE_AE, cekJks, numericTable);\n+            String sql = \"insert into \" + NUMERIC_TABLE_AE + \" values( \" + \"?,?,?,\" + \"?,?,?,\" + \"?,?,?,\" + \"?,?,?,\"\n+                    + \"?,?,?,\" + \"?,?,?,\" + \"?,?,?,\" + \"?,?,?,\" + \"?,?,?,\" + \"?,?,?,\" + \"?,?,?,\" + \"?,?,?,\" + \"?,?,?,\"\n+                    + \"?,?,?,\" + \"?,?,?,\" + \"?,?,?\" + \")\";\n+            try (PreparedStatement p = c.prepareStatement(sql)) {\n+                ParameterMetaData pmd = p.getParameterMetaData();\n+                assertTrue(pmd.getParameterCount() == 48);", "originalCommit": "0d27d52ba435c3aa85a5765639dea4bd0c9707ce", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3c25da5ea6472aa47c96d3a8311d4975d85027d0", "url": "https://github.com/microsoft/mssql-jdbc/commit/3c25da5ea6472aa47c96d3a8311d4975d85027d0", "message": "Don't use pstmt", "committedDate": "2020-04-14T22:45:50Z", "type": "commit"}, {"oid": "dc3f11f1b92230b1467546f950ef22a41c43d2ad", "url": "https://github.com/microsoft/mssql-jdbc/commit/dc3f11f1b92230b1467546f950ef22a41c43d2ad", "message": "put expected values first", "committedDate": "2020-04-15T16:08:05Z", "type": "commit"}]}