{"pr_number": 1378, "pr_title": "Fix | Fix batch insert failing when AE is turned on", "pr_createdAt": "2020-07-02T17:26:37Z", "pr_url": "https://github.com/microsoft/mssql-jdbc/pull/1378", "timeline": [{"oid": "c72cf5b65c11d1ddadcb776c68094c9d4dbf75cf", "url": "https://github.com/microsoft/mssql-jdbc/commit/c72cf5b65c11d1ddadcb776c68094c9d4dbf75cf", "message": "1301 fix", "committedDate": "2020-06-30T17:16:28Z", "type": "commit"}, {"oid": "aee83f5f1816cf61c89eb63d3496fdf9b4d50a28", "url": "https://github.com/microsoft/mssql-jdbc/commit/aee83f5f1816cf61c89eb63d3496fdf9b4d50a28", "message": "tests", "committedDate": "2020-06-30T20:22:24Z", "type": "commit"}, {"oid": "c1582c5d70df71f317ddafaf03715f1073ef3083", "url": "https://github.com/microsoft/mssql-jdbc/commit/c1582c5d70df71f317ddafaf03715f1073ef3083", "message": "semeicolon", "committedDate": "2020-06-30T20:40:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY1MjQxNw==", "url": "https://github.com/microsoft/mssql-jdbc/pull/1378#discussion_r449652417", "bodyText": "Multi-line, also can we remove the 'on Connection' part.", "author": "rene-ye", "createdAt": "2020-07-03T16:26:03Z", "path": "src/main/java/com/microsoft/sqlserver/jdbc/SQLServerPreparedStatement.java", "diffHunk": "@@ -2720,14 +2721,14 @@ final void doExecutePreparedStatementBatch(PrepStmtBatchExecCmd batchCommand) th\n             boolean hasExistingTypeDefinitions = preparedTypeDefinitions != null;\n             boolean hasNewTypeDefinitions = buildPreparedStrings(batchParam, false);\n \n-            if ((0 == numBatchesExecuted) && !isInternalEncryptionQuery && connection.isAEv2()) {\n+            if ((0 == numBatchesExecuted) && !isInternalEncryptionQuery && connection.isAEv2()\n+                    && !encryptionMetadataIsRetrieved) {\n                 this.enclaveCEKs = connection.initEnclaveParameters(preparedSQL, preparedTypeDefinitions, batchParam,\n                         parameterNames);\n                 encryptionMetadataIsRetrieved = true;\n \n                 // fix an issue when inserting unicode into non-encrypted nchar column using setString() and AE is\n-                // on on\n-                // Connection\n+                // on on Connection", "originalCommit": "c1582c5d70df71f317ddafaf03715f1073ef3083", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "778a50e05256b204f5bbb51f661ea765dbfd6607", "url": "https://github.com/microsoft/mssql-jdbc/commit/778a50e05256b204f5bbb51f661ea765dbfd6607", "message": "comments", "committedDate": "2020-07-03T20:48:51Z", "type": "commit"}]}