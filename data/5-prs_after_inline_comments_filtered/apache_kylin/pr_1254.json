{"pr_number": 1254, "pr_title": "KYLIN-4556 improve job service", "pr_createdAt": "2020-06-11T02:24:35Z", "pr_url": "https://github.com/apache/kylin/pull/1254", "timeline": [{"oid": "3ac7460a1d7ebae881eaf77e4663e0d535e865b2", "url": "https://github.com/apache/kylin/commit/3ac7460a1d7ebae881eaf77e4663e0d535e865b2", "message": "KYLIN-4560 support to re-run/delete cardinality and lookup snapshot job", "committedDate": "2020-06-11T06:19:56Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzkyNDU5OQ==", "url": "https://github.com/apache/kylin/pull/1254#discussion_r443924599", "bodyText": "Hi, @guangxuCheng . Actually this method has replaced parseToJobInstanceQuietly(CubingJob job, Map<String, Output> outputs) and parseToJobInstanceQuietly(CheckpointExecutable job, Map<String, Output> outputs), so should  the replaced method and their UT be removed? And maybe UT for this new method should be added.", "author": "zhangayqian", "createdAt": "2020-06-23T02:22:47Z", "path": "engine-mr/src/main/java/org/apache/kylin/engine/mr/common/JobInfoConverter.java", "diffHunk": "@@ -61,6 +61,20 @@ public static JobInstance parseToJobInstanceQuietly(CheckpointExecutable job, Ma\n         }\n     }\n \n+    public static JobInstance parseToJobInstanceQuietly(AbstractExecutable job, Map<String, Output> outputs) {\n+        try {\n+            if (job instanceof CheckpointExecutable) {\n+                return parseToJobInstance((CheckpointExecutable)job, outputs);\n+            } else if (job instanceof CubingJob) {\n+                return parseToJobInstance((CubingJob)job, outputs);\n+            } else {\n+                return null;\n+            }\n+        } catch (Exception e) {\n+            logger.error(\"Failed to parse job instance: uuid={}\", job, e);\n+            return null;\n+        }\n+    }", "originalCommit": "2024b8e16c091844099020b011bd5b9f21df761a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDE1OTA1NQ==", "url": "https://github.com/apache/kylin/pull/1254#discussion_r444159055", "bodyText": "@zhangayqian Thanks for reviewing. A nice finding,I will remove the two method.\nThe new method is to combine parseToJobInstanceQuietly(CubingJob job, Map<String, Output> outputs) and parseToJobInstanceQuietly(CheckpointExecutable job, Map<String, Output> outputs), so the ut about the two method is suitable for new method.", "author": "guangxuCheng", "createdAt": "2020-06-23T11:41:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzkyNDU5OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDE4MzIzMw==", "url": "https://github.com/apache/kylin/pull/1254#discussion_r444183233", "bodyText": "I force-pushed the branch to rebase master and remove the two methods.", "author": "guangxuCheng", "createdAt": "2020-06-23T12:26:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzkyNDU5OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDU5ODEyNA==", "url": "https://github.com/apache/kylin/pull/1254#discussion_r444598124", "bodyText": "Thanks for your update in time!", "author": "zhangayqian", "createdAt": "2020-06-24T01:44:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzkyNDU5OQ=="}], "type": "inlineReview"}, {"oid": "7b7a38d8a5bb27d6c97b7f03c7a1de856a399c91", "url": "https://github.com/apache/kylin/commit/7b7a38d8a5bb27d6c97b7f03c7a1de856a399c91", "message": "KYLIN-4551 Provide interfaces to transfer cube/model/project ownership", "committedDate": "2020-06-23T10:31:12Z", "type": "forcePushed"}, {"oid": "46552f388612306fec107006111f726d7e8ea748", "url": "https://github.com/apache/kylin/commit/46552f388612306fec107006111f726d7e8ea748", "message": "KYLIN-4561 overall job number statistics in monitor page is incorrect after change the job status", "committedDate": "2020-06-23T12:19:52Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTk5MzQ0Mw==", "url": "https://github.com/apache/kylin/pull/1254#discussion_r445993443", "bodyText": "Is there any place to set LookupSnapshotBuildJob type. Similar with\nresult.setType(CubeBuildTypeEnum.CHECKPOINT);", "author": "sanjulian", "createdAt": "2020-06-26T06:33:29Z", "path": "engine-mr/src/main/java/org/apache/kylin/engine/mr/common/JobInfoConverter.java", "diffHunk": "@@ -43,25 +43,21 @@\n public class JobInfoConverter {\n     private static final Logger logger = LoggerFactory.getLogger(JobInfoConverter.class);\n \n-    public static JobInstance parseToJobInstanceQuietly(CubingJob job, Map<String, Output> outputs) {\n+    public static JobInstance parseToJobInstanceQuietly(AbstractExecutable job, Map<String, Output> outputs) {\n         try {\n-            return parseToJobInstance(job, outputs);\n-        } catch (Exception e) {\n-            logger.error(\"Failed to parse job instance: uuid={}\", job, e);\n-            return null;\n-        }\n-    }\n-\n-    public static JobInstance parseToJobInstanceQuietly(CheckpointExecutable job, Map<String, Output> outputs) {\n-        try {\n-            return parseToJobInstance(job, outputs);\n+            if (job instanceof CheckpointExecutable) {\n+                return parseToJobInstance((CheckpointExecutable)job, outputs);\n+            } else if (job instanceof CubingJob) {\n+                return parseToJobInstance((CubingJob)job, outputs);\n+            } else {\n+                return null;", "originalCommit": "46552f388612306fec107006111f726d7e8ea748", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjE1MDY2Ng==", "url": "https://github.com/apache/kylin/pull/1254#discussion_r446150666", "bodyText": "Hi @sanjulian thanks for your reviewing. JobInfoConverter#parseToJobInstanceQuietly is only called by JobService#innerSearchJobs. The search mode of job are only CUBING_ONLY and CHECKPOINT_ONLY, so I think that it's ok for the implemented of JobInfoConverter#parseToJobInstanceQuietly.", "author": "guangxuCheng", "createdAt": "2020-06-26T12:23:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTk5MzQ0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjYxNTU2Nw==", "url": "https://github.com/apache/kylin/pull/1254#discussion_r446615567", "bodyText": "OK, thanks for your reply.", "author": "sanjulian", "createdAt": "2020-06-28T07:54:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTk5MzQ0Mw=="}], "type": "inlineReview"}, {"oid": "a9846768206a6f8670b403cc270883e10542f631", "url": "https://github.com/apache/kylin/commit/a9846768206a6f8670b403cc270883e10542f631", "message": "KYLIN-4557 Refactor JobService to improve code readability", "committedDate": "2020-08-12T03:48:37Z", "type": "commit"}, {"oid": "d1595c93468e4a075ac579b69c3be9ba751f75af", "url": "https://github.com/apache/kylin/commit/d1595c93468e4a075ac579b69c3be9ba751f75af", "message": "KYLIN-4558 get all chained executable jobs through job API", "committedDate": "2020-08-12T03:49:00Z", "type": "commit"}, {"oid": "c1d833c409fee59947dfdcf14510d8bf2e1f6720", "url": "https://github.com/apache/kylin/commit/c1d833c409fee59947dfdcf14510d8bf2e1f6720", "message": "KYLIN-4559 show cardinality and lookup snapshot job on job", "committedDate": "2020-08-12T03:49:18Z", "type": "commit"}, {"oid": "dd27b903a5b51be1462b4d1b20740b59b63ec95c", "url": "https://github.com/apache/kylin/commit/dd27b903a5b51be1462b4d1b20740b59b63ec95c", "message": "KYLIN-4560 support to re-run/delete cardinality and lookup snapshot job", "committedDate": "2020-08-12T03:51:55Z", "type": "commit"}, {"oid": "ec5c9ff5c0c91dfd73218aacfe11f20f8f3d507f", "url": "https://github.com/apache/kylin/commit/ec5c9ff5c0c91dfd73218aacfe11f20f8f3d507f", "message": "KYLIN-4561 overall job number statistics in monitor page is incorrect after change the job status", "committedDate": "2020-08-12T03:52:07Z", "type": "commit"}, {"oid": "ec5c9ff5c0c91dfd73218aacfe11f20f8f3d507f", "url": "https://github.com/apache/kylin/commit/ec5c9ff5c0c91dfd73218aacfe11f20f8f3d507f", "message": "KYLIN-4561 overall job number statistics in monitor page is incorrect after change the job status", "committedDate": "2020-08-12T03:52:07Z", "type": "forcePushed"}]}