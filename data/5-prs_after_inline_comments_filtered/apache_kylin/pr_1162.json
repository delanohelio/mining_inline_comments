{"pr_number": 1162, "pr_title": "KYLIN-4426 Refine CliCommandExecutor", "pr_createdAt": "2020-03-16T23:22:32Z", "pr_url": "https://github.com/apache/kylin/pull/1162", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM5OTk0NA==", "url": "https://github.com/apache/kylin/pull/1162#discussion_r393399944", "bodyText": "I think \"debug\" level here is improper; This might be an attack, it's log level should be info or warn.", "author": "shaofengshi", "createdAt": "2020-03-17T01:42:51Z", "path": "core-common/src/main/java/org/apache/kylin/common/util/CliCommandExecutor.java", "diffHunk": "@@ -163,4 +163,34 @@ private void copyRemote(String localFile, String destDir) throws IOException {\n         }\n     }\n \n+    public static final String COMMAND_INJECT_REX = \"[ &`>|{}()$;\\\\-#~!+*\u201d\\\\\\\\]+\";\n+\n+    /**\n+     * <pre>\n+     * Check parameter for preventing command injection, replace illegal character into empty character.\n+     *\n+     * Note:\n+     * 1. Whitespace is also refused because parameter is a single word, should not contains it\n+     * 2. Some character may be illegal but still be accepted because commandParameter maybe a URI/path expression,\n+     *     you may check \"Character part\" in https://docs.oracle.com/javase/8/docs/api/java/net/URI.html,\n+     *     here is the character which is not banned.\n+     *\n+     *     1. dot .\n+     *     2. slash /\n+     *     3. colon :\n+     *     4. equal =\n+     *     5. ?\n+     *     6. @\n+     *     7. bracket []\n+     *     8. comma ,\n+     *     9. %\n+     * </pre>\n+     */\n+    public static String checkParameter(String commandParameter) {\n+        String repaired = commandParameter.replaceAll(COMMAND_INJECT_REX, \"\");\n+        if (repaired.length() != commandParameter.length()) {\n+            logger.debug(\"Detected illegal character in command {}, replace it to {}.\", commandParameter, repaired);", "originalCommit": "279161397fae720ab1c049fd6f71233cec120d5d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQwNzk2MQ==", "url": "https://github.com/apache/kylin/pull/1162#discussion_r393407961", "bodyText": "OK. The reason of I choose the debug level is for debug purpose, maybe the rare case if I mistake convert right command into some broken command.", "author": "hit-lacus", "createdAt": "2020-03-17T02:16:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM5OTk0NA=="}], "type": "inlineReview"}, {"oid": "5701dd6c2230188647e43bb86cfe1312f90b3226", "url": "https://github.com/apache/kylin/commit/5701dd6c2230188647e43bb86cfe1312f90b3226", "message": "KYLIN-4426 Refine CliCommandExecutor", "committedDate": "2020-03-17T02:33:03Z", "type": "commit"}, {"oid": "5701dd6c2230188647e43bb86cfe1312f90b3226", "url": "https://github.com/apache/kylin/commit/5701dd6c2230188647e43bb86cfe1312f90b3226", "message": "KYLIN-4426 Refine CliCommandExecutor", "committedDate": "2020-03-17T02:33:03Z", "type": "forcePushed"}]}