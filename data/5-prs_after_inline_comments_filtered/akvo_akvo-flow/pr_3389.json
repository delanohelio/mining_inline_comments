{"pr_number": 3389, "pr_title": "[#3283] Remove featureflag package", "pr_createdAt": "2020-01-14T04:50:15Z", "pr_url": "https://github.com/akvo/akvo-flow/pull/3389", "timeline": [{"oid": "d3aa227f41dd5d508b1b0709f0de5ba34fef1d92", "url": "https://github.com/akvo/akvo-flow/commit/d3aa227f41dd5d508b1b0709f0de5ba34fef1d92", "message": "[#3283] Remove featureflag package\n\nWe want to keep 2 authentication methods for now. ODIC based (Auth0)\nin Production, and GAE accounts for local development", "committedDate": "2020-01-14T04:47:36Z", "type": "commit"}, {"oid": "c2bd31f641e0368042d45bcf4c507e70787331f8", "url": "https://github.com/akvo/akvo-flow/commit/c2bd31f641e0368042d45bcf4c507e70787331f8", "message": "[#3283] Remove references to alternative login path", "committedDate": "2020-01-15T09:34:34Z", "type": "commit"}, {"oid": "47d7c3d4e68bb2d7e11bf799621c54fe73ff917c", "url": "https://github.com/akvo/akvo-flow/commit/47d7c3d4e68bb2d7e11bf799621c54fe73ff917c", "message": "[#3283] Use GAE API to determine the environment\n\n- Use GAE accounts in development and OIDC (Auth0) in production", "committedDate": "2020-01-15T11:02:20Z", "type": "commit"}, {"oid": "c38c572aacbf08933b2862cb939c29f84d6bfd05", "url": "https://github.com/akvo/akvo-flow/commit/c38c572aacbf08933b2862cb939c29f84d6bfd05", "message": "Merge branch 'develop' into issue/3283-feature-flag", "committedDate": "2020-01-15T14:28:12Z", "type": "commit"}, {"oid": "90124f07d5a9fac67e4ce4aae61e157747ac6f40", "url": "https://github.com/akvo/akvo-flow/commit/90124f07d5a9fac67e4ce4aae61e157747ac6f40", "message": "Merge branch 'develop' into issue/3283-feature-flag", "committedDate": "2020-01-15T16:02:28Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzI4MjU0MQ==", "url": "https://github.com/akvo/akvo-flow/pull/3389#discussion_r367282541", "bodyText": "Explicit configuration please, so that developers can chose which auth method to use locally.", "author": "dlebrero", "createdAt": "2020-01-16T08:20:37Z", "path": "GAE/src/org/akvo/flow/rest/security/EntryPoint.java", "diffHunk": "@@ -25,26 +25,24 @@\n import org.springframework.security.core.AuthenticationException;\n import org.springframework.security.web.AuthenticationEntryPoint;\n \n-import com.gallatinsystems.common.util.PropertyUtil;\n+import com.google.appengine.api.utils.SystemProperty;\n \n public class EntryPoint implements AuthenticationEntryPoint {\n-    private final AuthenticationEntryPoint defaultEntryPoint;\n-    private final AuthenticationEntryPoint alternativeEntryPoint;\n-    private final String defaultAuthProvider;\n-\n-    public EntryPoint(AuthenticationEntryPoint defaultEntryPoint, AuthenticationEntryPoint alternativeEntryPoint) {\n-        this.defaultEntryPoint = defaultEntryPoint;\n-        this.alternativeEntryPoint = alternativeEntryPoint;\n-        this.defaultAuthProvider =PropertyUtil.getProperty(\"defaultAuthProvider\");\n+    private final AuthenticationEntryPoint devEntryPoint;\n+    private final AuthenticationEntryPoint prodEntryPoint;\n+\n+\n+    public EntryPoint(AuthenticationEntryPoint prodEntryPoint, AuthenticationEntryPoint devEntryPoint) {\n+        this.devEntryPoint = devEntryPoint;\n+        this.prodEntryPoint = prodEntryPoint;\n     }\n \n     @Override\n     public void commence(HttpServletRequest request, HttpServletResponse response, AuthenticationException authException) throws IOException, ServletException {\n-        if (\"auth0\".equals(defaultAuthProvider)) {\n-            alternativeEntryPoint.commence(request, response, authException);\n+        if (SystemProperty.environment.value() == SystemProperty.Environment.Value.Production) {", "originalCommit": "90124f07d5a9fac67e4ce4aae61e157747ac6f40", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "9547b9de808c92c04291e7571ea2d86ae6ea4abc", "url": "https://github.com/akvo/akvo-flow/commit/9547b9de808c92c04291e7571ea2d86ae6ea4abc", "message": "[#3283] Ability to configure the auth entrypoint via properties\n\n* Together with @dlebrero we managed to simplify the code and\n  use `System.properties` (defined in `appengine-web.xml`) and\n  override the default authentication entrypoint `oidc` with `gae`", "committedDate": "2020-01-16T14:31:22Z", "type": "commit"}]}