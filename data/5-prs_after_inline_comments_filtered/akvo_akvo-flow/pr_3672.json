{"pr_number": 3672, "pr_title": "Issue/3669 survey copy error fix", "pr_createdAt": "2020-11-18T17:00:12Z", "pr_url": "https://github.com/akvo/akvo-flow/pull/3672", "timeline": [{"oid": "25598995304c86bff6ef2f352457389d66042e3e", "url": "https://github.com/akvo/akvo-flow/commit/25598995304c86bff6ef2f352457389d66042e3e", "message": "[#3669] Optimise survey copy (WIP)\n\nadd tests to copy translations\noptimise translations copy\n\nCo-authored-by: Emmanuel Mulo <emmanuel@akvo.org>", "committedDate": "2020-11-18T13:33:09Z", "type": "commit"}, {"oid": "5c6a0c28e38aaeb4760363feeceb52587e2b4c20", "url": "https://github.com/akvo/akvo-flow/commit/5c6a0c28e38aaeb4760363feeceb52587e2b4c20", "message": "[#3669] reverted imports", "committedDate": "2020-11-18T14:34:39Z", "type": "commit"}, {"oid": "ea94118b4ba646bebc45da27c46ac7bcae302319", "url": "https://github.com/akvo/akvo-flow/commit/ea94118b4ba646bebc45da27c46ac7bcae302319", "message": "[#3669] finish optimising how translations are copied for a survey", "committedDate": "2020-11-18T16:58:33Z", "type": "commit"}, {"oid": "972fca41ff1cc5b9cf8a2b30f886f01abd3d446b", "url": "https://github.com/akvo/akvo-flow/commit/972fca41ff1cc5b9cf8a2b30f886f01abd3d446b", "message": "[#3663] reverted unnecessary import changes", "committedDate": "2020-11-18T17:07:22Z", "type": "commit"}, {"oid": "b9dca88ccc2ae071dbc9af5906a766ac958322f0", "url": "https://github.com/akvo/akvo-flow/commit/b9dca88ccc2ae071dbc9af5906a766ac958322f0", "message": "[#3669] fixed NPE when missing translations", "committedDate": "2020-11-18T17:24:45Z", "type": "commit"}, {"oid": "df847ae2e95eb2da5f52a35198bceeb5c3ab2ed0", "url": "https://github.com/akvo/akvo-flow/commit/df847ae2e95eb2da5f52a35198bceeb5c3ab2ed0", "message": "[#3669] fixed broken tests", "committedDate": "2020-11-18T17:50:49Z", "type": "commit"}, {"oid": "a9b88fe625b306c1c78600f5dc1fc6305382f2f4", "url": "https://github.com/akvo/akvo-flow/commit/a9b88fe625b306c1c78600f5dc1fc6305382f2f4", "message": "[#3669] Correct expected vs actual parameters in tests", "committedDate": "2020-11-18T21:07:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjM5OTM5OQ==", "url": "https://github.com/akvo/akvo-flow/pull/3672#discussion_r526399399", "bodyText": "Its a little confusing for me the method copyQuestionGroupWithoutTranslations has the copiedTranslations parameter...", "author": "muloem", "createdAt": "2020-11-18T20:27:58Z", "path": "GAE/src/com/gallatinsystems/survey/dao/SurveyUtils.java", "diffHunk": "@@ -177,19 +179,61 @@ public static QuestionGroup copyQuestionGroup(QuestionGroup sourceGroup,\n         log.log(Level.INFO, \"Copying \" + qList.size() + \" `Question`\");\n \n         int qCount = 1;\n-        List<Question> qCopyList = new ArrayList<Question>();\n+        List<Question> qCopyList = new ArrayList<>();\n         for (Question question : qList) {\n-            final Question questionCopy = SurveyUtils.copyQuestion(question, copyGroupId, qCount++,\n-                    newSurveyId, idsInUse, immutable);\n+            final Question questionCopy = copyQuestionWithoutTranslations(idsInUse, immutable, copiedTranslations,", "originalCommit": "df847ae2e95eb2da5f52a35198bceeb5c3ab2ed0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA0NzU2NA==", "url": "https://github.com/akvo/akvo-flow/pull/3672#discussion_r527047564", "bodyText": "ok I renamed them", "author": "valllllll2000", "createdAt": "2020-11-19T17:00:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjM5OTM5OQ=="}], "type": "inlineReview"}, {"oid": "438b5e71ba7a840ae29332a32b5774f080a85259", "url": "https://github.com/akvo/akvo-flow/commit/438b5e71ba7a840ae29332a32b5774f080a85259", "message": "[#3669] No need to save the translation copies when creating them\n\n* The translation entities are saved later on in a batch after then have been updated with the correct parentIds", "committedDate": "2020-11-19T14:19:10Z", "type": "commit"}, {"oid": "45a202c23b0dce145cc0dd6fac66e16bba36c189", "url": "https://github.com/akvo/akvo-flow/commit/45a202c23b0dce145cc0dd6fac66e16bba36c189", "message": "[#3669] renamed methods + added documentation", "committedDate": "2020-11-19T16:55:00Z", "type": "commit"}, {"oid": "685dfb2583a39836a7c5ba4ed12e0077060c8f3c", "url": "https://github.com/akvo/akvo-flow/commit/685dfb2583a39836a7c5ba4ed12e0077060c8f3c", "message": "Merge branch 'issue/3669-survey-copy-error-fix' of github.com:akvo/akvo-flow into issue/3669-survey-copy-error-fix", "committedDate": "2020-11-19T16:59:06Z", "type": "commit"}, {"oid": "d31c8058ab840bbda2bc2c9c3125787476a20bab", "url": "https://github.com/akvo/akvo-flow/commit/d31c8058ab840bbda2bc2c9c3125787476a20bab", "message": "[#3669] added more tests for the case where non immatable surveys are copied", "committedDate": "2020-11-19T17:13:39Z", "type": "commit"}, {"oid": "9cedfffa740f9b915d32b454785d9db0dbce9552", "url": "https://github.com/akvo/akvo-flow/commit/9cedfffa740f9b915d32b454785d9db0dbce9552", "message": "[#3669] make sure translations are correctly copied with survey group", "committedDate": "2020-11-19T17:52:48Z", "type": "commit"}, {"oid": "e499ea8d3aefcb5253721b839658d62a4dd0c8e9", "url": "https://github.com/akvo/akvo-flow/commit/e499ea8d3aefcb5253721b839658d62a4dd0c8e9", "message": "[#3669] extracted tests methods", "committedDate": "2020-11-19T17:55:09Z", "type": "commit"}, {"oid": "d557ef5604900605ba4b5be1fa43ff4ecea92d8b", "url": "https://github.com/akvo/akvo-flow/commit/d557ef5604900605ba4b5be1fa43ff4ecea92d8b", "message": "[#3669] Merge branch 'issue/3669-survey-copy-error-fix' of https://github.com/akvo/akvo-flow into issue/3669-survey-copy-error-fix", "committedDate": "2020-11-20T10:53:24Z", "type": "commit"}]}