{"pr_number": 10022, "pr_title": "[#9651] Enhance Jmeter result population upon running test", "pr_createdAt": "2020-04-15T04:39:43Z", "pr_url": "https://github.com/TEAMMATES/teammates/pull/10022", "timeline": [{"oid": "391dab0940131cd2590264669a3231f75cb9ee7e", "url": "https://github.com/TEAMMATES/teammates/commit/391dab0940131cd2590264669a3231f75cb9ee7e", "message": "add default version of jmetergenerator.properties for populating result analysis", "committedDate": "2019-04-20T09:42:49Z", "type": "commit"}, {"oid": "258d96794b12964d891955511744613a9c0a2469", "url": "https://github.com/TEAMMATES/teammates/commit/258d96794b12964d891955511744613a9c0a2469", "message": "update on generating result in the console", "committedDate": "2019-04-20T09:42:49Z", "type": "commit"}, {"oid": "c2cb51af553c4e8047beccebb18a1f89cbd8e6dd", "url": "https://github.com/TEAMMATES/teammates/commit/c2cb51af553c4e8047beccebb18a1f89cbd8e6dd", "message": "generate and delete from a statistics.json file", "committedDate": "2019-04-20T09:42:49Z", "type": "commit"}, {"oid": "492918f7ee54df01e82da697291cdf6b14c74f08", "url": "https://github.com/TEAMMATES/teammates/commit/492918f7ee54df01e82da697291cdf6b14c74f08", "message": "update table to take into account threshold", "committedDate": "2019-04-20T09:45:32Z", "type": "commit"}, {"oid": "2cb0b200411d1e83d9db833994dcbc343df7ec48", "url": "https://github.com/TEAMMATES/teammates/commit/2cb0b200411d1e83d9db833994dcbc343df7ec48", "message": "fix styling and add java docs", "committedDate": "2019-04-20T10:31:30Z", "type": "commit"}, {"oid": "75e381234d59045762782ab8305761321d29b7c9", "url": "https://github.com/TEAMMATES/teammates/commit/75e381234d59045762782ab8305761321d29b7c9", "message": "update method of populating result", "committedDate": "2019-04-20T10:31:30Z", "type": "commit"}, {"oid": "e6f9f6207db7be34e6904cf1d47935dfce38d5f0", "url": "https://github.com/TEAMMATES/teammates/commit/e6f9f6207db7be34e6904cf1d47935dfce38d5f0", "message": "add assert error when any tests fails", "committedDate": "2019-04-20T10:31:31Z", "type": "commit"}, {"oid": "f4c87ad9df198a9d04e006bb2b2a73c9e2f6747f", "url": "https://github.com/TEAMMATES/teammates/commit/f4c87ad9df198a9d04e006bb2b2a73c9e2f6747f", "message": "update ReportAnalysis location being generated", "committedDate": "2019-04-20T10:31:31Z", "type": "commit"}, {"oid": "582991b7c2e7641b94cbc05bd6ca861ab51959bc", "url": "https://github.com/TEAMMATES/teammates/commit/582991b7c2e7641b94cbc05bd6ca861ab51959bc", "message": "add @override method and refactor names", "committedDate": "2019-04-20T14:03:26Z", "type": "commit"}, {"oid": "aa7ab8ccdc2b19ae0ab5088989b79e4acf22f8d2", "url": "https://github.com/TEAMMATES/teammates/commit/aa7ab8ccdc2b19ae0ab5088989b79e4acf22f8d2", "message": "add an abstract method to handle filename", "committedDate": "2019-04-20T15:35:19Z", "type": "commit"}, {"oid": "4628476d35f21c85f631850705af3c2f33fce882", "url": "https://github.com/TEAMMATES/teammates/commit/4628476d35f21c85f631850705af3c2f33fce882", "message": "add a renaming function of the default statistics flle so that we can keep unique files", "committedDate": "2019-04-20T15:35:51Z", "type": "commit"}, {"oid": "c6471f5d9f442b92b3057482952f01fddb4eb97f", "url": "https://github.com/TEAMMATES/teammates/commit/c6471f5d9f442b92b3057482952f01fddb4eb97f", "message": "update result analysis and rename function", "committedDate": "2019-04-20T16:39:44Z", "type": "commit"}, {"oid": "65845d909c71736f383f33d4635db5e733c3c5b6", "url": "https://github.com/TEAMMATES/teammates/commit/65845d909c71736f383f33d4635db5e733c3c5b6", "message": "update naming conventions", "committedDate": "2019-04-21T16:05:41Z", "type": "commit"}, {"oid": "aec925078a0d0e02938ca9cfec47c1efe6462b7a", "url": "https://github.com/TEAMMATES/teammates/commit/aec925078a0d0e02938ca9cfec47c1efe6462b7a", "message": "update test cases to show in seconds and percentage instead", "committedDate": "2019-04-21T18:10:22Z", "type": "commit"}, {"oid": "d2e96aeba2c03b1a65694e7a46e8918c711c2454", "url": "https://github.com/TEAMMATES/teammates/commit/d2e96aeba2c03b1a65694e7a46e8918c711c2454", "message": "Merge branch 'master' into jmeter-result-population", "committedDate": "2019-04-21T20:15:45Z", "type": "commit"}, {"oid": "63de6e1792bb42594bfa8a9b3b2406c0c2962848", "url": "https://github.com/TEAMMATES/teammates/commit/63de6e1792bb42594bfa8a9b3b2406c0c2962848", "message": "fix errors from solving merge conflict", "committedDate": "2019-04-22T01:39:05Z", "type": "commit"}, {"oid": "73ca50e64cf7d622d9ca8dc6a8198499ee278ec8", "url": "https://github.com/TEAMMATES/teammates/commit/73ca50e64cf7d622d9ca8dc6a8198499ee278ec8", "message": "update errorPct, naming conventions and remove testName", "committedDate": "2019-04-24T13:04:12Z", "type": "commit"}, {"oid": "424371b50d046234fd25f41d91ca39e521ff8760", "url": "https://github.com/TEAMMATES/teammates/commit/424371b50d046234fd25f41d91ca39e521ff8760", "message": "update exceptions caught", "committedDate": "2019-04-24T16:11:21Z", "type": "commit"}, {"oid": "487dabfc0c9ea2016a28acafebefeccf69718230", "url": "https://github.com/TEAMMATES/teammates/commit/487dabfc0c9ea2016a28acafebefeccf69718230", "message": "update displayLnpResults method to populate in gradlew", "committedDate": "2019-04-25T10:25:01Z", "type": "commit"}, {"oid": "9d6d2faaee4f8b1d8f10830efea00a534e9e0470", "url": "https://github.com/TEAMMATES/teammates/commit/9d6d2faaee4f8b1d8f10830efea00a534e9e0470", "message": "minor comment changes and set summariser to false", "committedDate": "2019-04-28T15:30:34Z", "type": "commit"}, {"oid": "d64843adb1ee3dab27ae53f176a2c02a2bd46dad", "url": "https://github.com/TEAMMATES/teammates/commit/d64843adb1ee3dab27ae53f176a2c02a2bd46dad", "message": "Merge branch 'master' into jmeter-result-population", "committedDate": "2020-04-02T23:32:21Z", "type": "commit"}, {"oid": "5a069cb5fb6473edf23c6c51d9b4d074a2e92e39", "url": "https://github.com/TEAMMATES/teammates/commit/5a069cb5fb6473edf23c6c51d9b4d074a2e92e39", "message": "Update LnP test files to override limit methods", "committedDate": "2020-04-03T01:26:29Z", "type": "commit"}, {"oid": "249f984b3c60eec01a150b89a3721b37967bcae4", "url": "https://github.com/TEAMMATES/teammates/commit/249f984b3c60eec01a150b89a3721b37967bcae4", "message": "Merge branch 'jmeter-result-population' into jmeter-result-population-re", "committedDate": "2020-04-15T04:31:24Z", "type": "commit"}, {"oid": "afd438ec9927c8147f171992e56fb6703ec3cdf5", "url": "https://github.com/TEAMMATES/teammates/commit/afd438ec9927c8147f171992e56fb6703ec3cdf5", "message": "Fix lint", "committedDate": "2020-04-15T16:55:46Z", "type": "commit"}, {"oid": "ac169826603d7401048750e3974056313c806629", "url": "https://github.com/TEAMMATES/teammates/commit/ac169826603d7401048750e3974056313c806629", "message": "Merge branch 'master' into jmeter-result-population-re", "committedDate": "2020-04-21T03:49:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTk3NTkxOA==", "url": "https://github.com/TEAMMATES/teammates/pull/10022#discussion_r411975918", "bodyText": "Will this cause race condition if multiple LNP is run concurrently?", "author": "xpdavid", "createdAt": "2020-04-21T08:20:55Z", "path": "src/e2e/java/teammates/e2e/cases/lnp/BaseLNPTestCase.java", "diffHunk": "@@ -213,14 +277,18 @@ protected void runJmeter(boolean shouldCreateJmxFile) throws IOException {\n         resultCollector.setFilename(resultsFile);\n         testPlan.add(testPlan.getArray()[0], resultCollector);\n \n-        // Run JMeter Test\n+        // Run Jmeter Test\n         jmeter.configure(testPlan);\n         jmeter.run();\n \n-        // TODO: As mentioned in the docs, good to fail the test if there is an Exception, or if the `success` value of\n-        //  requests is `false`. An example of when this occurs is if the JMeter test properties are not set or if `email`\n-        //  is used for logging in instead of `googleid`. Tests should fail if this assertion fails:\n-        //      assertTrue(resultsErrorRate < this.getAcceptableErrorRate());\n+        try {\n+            ReportGenerator reportGenerator = new ReportGenerator(resultsFile, null);\n+            reportGenerator.generate();\n+        } catch (ConfigurationException | GenerationException e) {\n+            log.warning(e.getMessage());\n+        }\n+\n+        renameStatisticsFile();", "originalCommit": "ac169826603d7401048750e3974056313c806629", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjk0NDUxNQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10022#discussion_r412944515", "bodyText": "Are you referring to the renameStatisticsFile() method?", "author": "daekoon", "createdAt": "2020-04-22T12:38:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTk3NTkxOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzI1OTkyNA==", "url": "https://github.com/TEAMMATES/teammates/pull/10022#discussion_r413259924", "bodyText": "As they all output to file call Statistics.json?", "author": "xpdavid", "createdAt": "2020-04-22T19:29:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTk3NTkxOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzY3MDIwOQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10022#discussion_r413670209", "bodyText": "I don't think multiple LNP tests should be run concurrently. If that happens, the results won't be accurate since the load on the system is higher than what would be shown in the results.\nThat being said, to be safe, we can still look into whether the default statistics.json file can use a dynamically generated filename instead (probably needs support from the Jmeter API or the .properties config file).", "author": "amrut-prabhu", "createdAt": "2020-04-23T09:42:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTk3NTkxOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDA4MDc0Mg==", "url": "https://github.com/TEAMMATES/teammates/pull/10022#discussion_r414080742", "bodyText": "That being said, to be safe, we can still look into whether the default statistics.json file can use a dynamically generated filename instead (probably needs support from the Jmeter API or the .properties config file).\n\nI think this is the correct why to tackle the problem regardless of whether we want to run it concurrently or not. Tests need to be Independent.", "author": "xpdavid", "createdAt": "2020-04-23T19:53:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTk3NTkxOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjU1MTk5OQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10022#discussion_r416551999", "bodyText": "Added timestamps to the temp files generated (and the statistics file) to avoid race conditions when running two tests concurrently, and additional functionality to make the tests remove old results (can be specified)", "author": "daekoon", "createdAt": "2020-04-28T11:54:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTk3NTkxOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzc2ODA1OA==", "url": "https://github.com/TEAMMATES/teammates/pull/10022#discussion_r417768058", "bodyText": "Why we still have static filename here?\nhttps://github.com/TEAMMATES/teammates/pull/10022/files#diff-6509e6ed4f2a3ea02c0d46c61b1ff10fR203", "author": "xpdavid", "createdAt": "2020-04-30T05:50:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTk3NTkxOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODk2Mjg2OA==", "url": "https://github.com/TEAMMATES/teammates/pull/10022#discussion_r418962868", "bodyText": "Running the ReportGenerator.generate() makes the ReportGenerator class create an statistics.json file at the predefined path (LNP results folder in this case, predefined in reportgenerator.properties)\nThere seems to be no option to change the name of the statistics file generated from the ReportGenerator. (Checked ReportGenerator class, reportgenerator.properties file, ResultCollector class, ExporterConfiguration class and various API). Which leaves us with the next best option, to rename the generated statistics.json file.\nI believe that the potential race condition caused by this static filename will be minimal. This file only gets generated once the LnP test is done during the report generation (doesn't take long), and then gets immediately renamed, so the duration for which this file is vulnuerable to race condition is minimal.", "author": "daekoon", "createdAt": "2020-05-02T14:04:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTk3NTkxOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTk3NzIxMQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10022#discussion_r411977211", "bodyText": "I think a better approach is to create a LNPSpecificiation somewhat class to hold the limit and put into the super class of the LNPTest.", "author": "xpdavid", "createdAt": "2020-04-21T08:22:36Z", "path": "src/e2e/java/teammates/e2e/cases/lnp/FeedbackSessionSubmitLNPTest.java", "diffHunk": "@@ -252,6 +252,16 @@ protected ListedHashTree getLnpTestPlan() {\n         return testPlan;\n     }\n \n+    @Override\n+    protected double getErrorRateLimit() {", "originalCommit": "ac169826603d7401048750e3974056313c806629", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjY0NDA1MQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10022#discussion_r416644051", "bodyText": "Moved logic for specification and result verification to LNPSpecification class.", "author": "daekoon", "createdAt": "2020-04-28T14:09:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTk3NzIxMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTk3ODc1NQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10022#discussion_r411978755", "bodyText": "Continue from my point, by SRP principle, Statistics should not be responsible to check limit.", "author": "xpdavid", "createdAt": "2020-04-21T08:24:43Z", "path": "src/e2e/java/teammates/e2e/util/LNPResultsStatistics.java", "diffHunk": "@@ -0,0 +1,69 @@\n+package teammates.e2e.util;\n+\n+import org.testng.Reporter;\n+\n+/**\n+ * Represents the L&P test results statistics.\n+ */\n+public class LNPResultsStatistics {\n+\n+    private double errorPct;\n+    private double meanResTime;\n+    private double pct1ResTime; // 90th percentile\n+    private double throughput;\n+    private int errorCount;\n+    private int sampleCount;\n+    private String resultsErrorMessage = \"\";\n+\n+    /**\n+     * Verify the LNP results statistics with the specified threshold.\n+     */\n+    public void verifyLnpTestSuccess(double errorRateLimit, double meanResTimeLimit) {", "originalCommit": "ac169826603d7401048750e3974056313c806629", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1b4b95977d8d53af2559914c04fec17cab3785a7", "url": "https://github.com/TEAMMATES/teammates/commit/1b4b95977d8d53af2559914c04fec17cab3785a7", "message": "Merge branch 'master' into jmeter-result-population-re", "committedDate": "2020-04-22T12:38:04Z", "type": "commit"}, {"oid": "5e76e0c341fed4506c8c742713c07e4be4209c2b", "url": "https://github.com/TEAMMATES/teammates/commit/5e76e0c341fed4506c8c742713c07e4be4209c2b", "message": "Merge branch 'master' into jmeter-result-population-re", "committedDate": "2020-04-24T00:45:43Z", "type": "commit"}, {"oid": "e46abc5a728f66e7647c9db9d85892ec064e3410", "url": "https://github.com/TEAMMATES/teammates/commit/e46abc5a728f66e7647c9db9d85892ec064e3410", "message": "Add timeStamp to LnP test data files to prevent concurrency issues", "committedDate": "2020-04-28T05:22:11Z", "type": "commit"}, {"oid": "d7dc9b7407110151f8f72640b879eee865b14d99", "url": "https://github.com/TEAMMATES/teammates/commit/d7dc9b7407110151f8f72640b879eee865b14d99", "message": "Fix a bug which caused error messages to be displayed when the results were within limit", "committedDate": "2020-04-28T07:14:15Z", "type": "commit"}, {"oid": "b60242c34815d494e85833df75628665c7ef994c", "url": "https://github.com/TEAMMATES/teammates/commit/b60242c34815d494e85833df75628665c7ef994c", "message": "Update errorRateLimit and menRespTimeLimit to a more realistic value", "committedDate": "2020-04-28T07:15:01Z", "type": "commit"}, {"oid": "e4d35580cb63515042dbc961b0213e25499c8e37", "url": "https://github.com/TEAMMATES/teammates/commit/e4d35580cb63515042dbc961b0213e25499c8e37", "message": "Make LnP tests clean up previous results as specified", "committedDate": "2020-04-28T11:50:47Z", "type": "commit"}, {"oid": "1aec5c6cd5e0b2ec7263d153a68e8e6cbec18f20", "url": "https://github.com/TEAMMATES/teammates/commit/1aec5c6cd5e0b2ec7263d153a68e8e6cbec18f20", "message": "Abstract out specification and result verification logic to LNPSpecification", "committedDate": "2020-04-28T14:08:50Z", "type": "commit"}, {"oid": "6ad72bde63269fef0fbd82faef2be902ff5537ae", "url": "https://github.com/TEAMMATES/teammates/commit/6ad72bde63269fef0fbd82faef2be902ff5537ae", "message": "Merge branch 'master' into jmeter-result-population-re", "committedDate": "2020-04-28T15:20:31Z", "type": "commit"}, {"oid": "15713d281b214305c969ad748867c36e20c086c6", "url": "https://github.com/TEAMMATES/teammates/commit/15713d281b214305c969ad748867c36e20c086c6", "message": "Merge branch 'master' into jmeter-result-population-re", "committedDate": "2020-05-06T13:05:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjQyOTg1NA==", "url": "https://github.com/TEAMMATES/teammates/pull/10022#discussion_r422429854", "bodyText": "It would be better to use builder pattern to construct a specification.", "author": "xpdavid", "createdAt": "2020-05-09T00:28:31Z", "path": "src/e2e/java/teammates/e2e/util/LNPSpecification.java", "diffHunk": "@@ -0,0 +1,59 @@\n+package teammates.e2e.util;\n+\n+/**\n+ * Stores the specifications for a LNP test, and verifies whether the results meet the criteria.\n+ */\n+public class LNPSpecification {\n+\n+    private double errorRateLimit;\n+    private double meanResTimeLimit;\n+    private String resultsErrorMessage = \"\";\n+\n+    /**\n+     * Create a specification class with the specified limits.\n+     * @param errorRateLimit Maximum allowable threshold for the percentage of failed requests\n+     *                       (0 to 100) to the test endpoint.\n+     * @param meanResTimeLimit Maximum allowable threshold for the mean response time\n+     *                         (in seconds) for the test endpoint.\n+     */\n+    public LNPSpecification(double errorRateLimit, double meanResTimeLimit) {", "originalCommit": "15713d281b214305c969ad748867c36e20c086c6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjY0MzA3Ng==", "url": "https://github.com/TEAMMATES/teammates/pull/10022#discussion_r422643076", "bodyText": "I've added in a comment regarding this for future reference.", "author": "daekoon", "createdAt": "2020-05-10T13:04:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjQyOTg1NA=="}], "type": "inlineReview"}, {"oid": "6dd452672d8685417111aa40b52daf0dc7b43239", "url": "https://github.com/TEAMMATES/teammates/commit/6dd452672d8685417111aa40b52daf0dc7b43239", "message": "Add comment to LNPSpecification class regarding Builder pattern", "committedDate": "2020-05-10T13:02:36Z", "type": "commit"}, {"oid": "9a2d3cad49cb2387f4e3a23b6320464cd667b037", "url": "https://github.com/TEAMMATES/teammates/commit/9a2d3cad49cb2387f4e3a23b6320464cd667b037", "message": "Merge branch 'jmeter-result-population-re' of github.com:daekoon/teammates into jmeter-result-population-re", "committedDate": "2020-05-10T13:02:48Z", "type": "commit"}]}