{"pr_number": 9987, "pr_title": "[#9536] Admin Search Page E2E Tests", "pr_createdAt": "2020-03-16T14:51:06Z", "pr_url": "https://github.com/TEAMMATES/teammates/pull/9987", "timeline": [{"oid": "7b05632ca0bdfbf94636827b57eba51279bfdcca", "url": "https://github.com/TEAMMATES/teammates/commit/7b05632ca0bdfbf94636827b57eba51279bfdcca", "message": "Add putDocuments method to BackDoor", "committedDate": "2020-03-16T14:21:26Z", "type": "commit"}, {"oid": "cdde64cfcb3ccab13352f9b23496c8ddf1db3099", "url": "https://github.com/TEAMMATES/teammates/commit/cdde64cfcb3ccab13352f9b23496c8ddf1db3099", "message": "Add E2ETests for AdminSearchPage", "committedDate": "2020-03-16T14:23:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODQ3Njc1OA==", "url": "https://github.com/TEAMMATES/teammates/pull/9987#discussion_r398476758", "bodyText": "Student1 is a rather generic term. This may result in unexpected results when there are other data in the system.", "author": "wkurniawan07", "createdAt": "2020-03-26T10:47:42Z", "path": "src/e2e/java/teammates/e2e/cases/e2e/AdminSearchPageE2ETest.java", "diffHunk": "@@ -0,0 +1,188 @@\n+package teammates.e2e.cases.e2e;\n+\n+import java.time.Instant;\n+\n+import org.openqa.selenium.WebElement;\n+import org.testng.annotations.Test;\n+\n+import teammates.common.datatransfer.attributes.AccountAttributes;\n+import teammates.common.datatransfer.attributes.FeedbackSessionAttributes;\n+import teammates.common.datatransfer.attributes.InstructorAttributes;\n+import teammates.common.datatransfer.attributes.StudentAttributes;\n+import teammates.common.util.AppUrl;\n+import teammates.common.util.Const;\n+import teammates.common.util.StringHelper;\n+import teammates.e2e.pageobjects.AdminHomePage;\n+import teammates.e2e.pageobjects.AdminSearchPage;\n+import teammates.e2e.pageobjects.AppPage;\n+\n+/**\n+ * SUT: {@link Const.WebPageURIs#ADMIN_SEARCH_PAGE}.\n+ */\n+public class AdminSearchPageE2ETest extends BaseE2ETestCase {\n+    private AdminSearchPage searchPage;\n+\n+    @Override\n+    protected void prepareTestData() {\n+        testData = loadDataBundle(\"/AdminSearchPageE2ETest.json\");\n+        removeAndRestoreDataBundle(testData);\n+        putDocuments(testData);\n+    }\n+\n+    @Test\n+    public void allTests() {\n+        AppUrl url = createUrl(Const.WebPageURIs.ADMIN_SEARCH_PAGE);\n+        loginAdminToPage(url, AdminHomePage.class);\n+        searchPage = AppPage.getNewPageInstance(browser, url, AdminSearchPage.class);\n+\n+        browser.waitForPageLoad();\n+        StudentAttributes student = testData.students.get(\"student1InCourse1\");\n+        AccountAttributes studentAccount = testData.accounts.get(\"student1InCourse1\");\n+        InstructorAttributes instructor = testData.instructors.get(\"instructor1OfCourse1\");\n+        AccountAttributes instructorAccount = testData.accounts.get(\"instructor1OfCourse1\");\n+\n+        ______TS(\"Typical case: Search student keyword\");\n+        String searchContent = \"Student1\";", "originalCommit": "9623cc0a7ed310fb8c708368de910fdf3c187db5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODQ3NzU3NA==", "url": "https://github.com/TEAMMATES/teammates/pull/9987#discussion_r398477574", "bodyText": "May need more example cases. I don't think resetting instructor google ID is the only action possible from this page.", "author": "wkurniawan07", "createdAt": "2020-03-26T10:49:02Z", "path": "src/e2e/java/teammates/e2e/cases/e2e/AdminSearchPageE2ETest.java", "diffHunk": "@@ -0,0 +1,188 @@\n+package teammates.e2e.cases.e2e;\n+\n+import java.time.Instant;\n+\n+import org.openqa.selenium.WebElement;\n+import org.testng.annotations.Test;\n+\n+import teammates.common.datatransfer.attributes.AccountAttributes;\n+import teammates.common.datatransfer.attributes.FeedbackSessionAttributes;\n+import teammates.common.datatransfer.attributes.InstructorAttributes;\n+import teammates.common.datatransfer.attributes.StudentAttributes;\n+import teammates.common.util.AppUrl;\n+import teammates.common.util.Const;\n+import teammates.common.util.StringHelper;\n+import teammates.e2e.pageobjects.AdminHomePage;\n+import teammates.e2e.pageobjects.AdminSearchPage;\n+import teammates.e2e.pageobjects.AppPage;\n+\n+/**\n+ * SUT: {@link Const.WebPageURIs#ADMIN_SEARCH_PAGE}.\n+ */\n+public class AdminSearchPageE2ETest extends BaseE2ETestCase {\n+    private AdminSearchPage searchPage;\n+\n+    @Override\n+    protected void prepareTestData() {\n+        testData = loadDataBundle(\"/AdminSearchPageE2ETest.json\");\n+        removeAndRestoreDataBundle(testData);\n+        putDocuments(testData);\n+    }\n+\n+    @Test\n+    public void allTests() {\n+        AppUrl url = createUrl(Const.WebPageURIs.ADMIN_SEARCH_PAGE);\n+        loginAdminToPage(url, AdminHomePage.class);\n+        searchPage = AppPage.getNewPageInstance(browser, url, AdminSearchPage.class);\n+\n+        browser.waitForPageLoad();\n+        StudentAttributes student = testData.students.get(\"student1InCourse1\");\n+        AccountAttributes studentAccount = testData.accounts.get(\"student1InCourse1\");\n+        InstructorAttributes instructor = testData.instructors.get(\"instructor1OfCourse1\");\n+        AccountAttributes instructorAccount = testData.accounts.get(\"instructor1OfCourse1\");\n+\n+        ______TS(\"Typical case: Search student keyword\");\n+        String searchContent = \"Student1\";\n+        searchPage.inputSearchContent(searchContent);\n+        searchPage.clickSearchButton();\n+        verifyStudentRowContent(student, studentAccount);\n+        verifyStudentExpandedLinks(student);\n+\n+        ______TS(\"Typical case: Search for instructor email\");\n+        searchPage.clearSearchBox();\n+        searchContent = \"searchUI.instructor1@course1.tmt\";\n+        searchPage.inputSearchContent(searchContent);\n+        searchPage.clickSearchButton();\n+        verifyInstructorRowContent(instructor, instructorAccount);\n+        verifyInstructorExpandedLinks(instructor);\n+\n+        ______TS(\"Typical case: Reset instructor google id\");\n+        searchPage.resetInstructorGoogleId(instructor);\n+        instructor.googleId = null;\n+        verifyInstructorRowContent(instructor, instructorAccount);\n+    }", "originalCommit": "9623cc0a7ed310fb8c708368de910fdf3c187db5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODY2NzU3NQ==", "url": "https://github.com/TEAMMATES/teammates/pull/9987#discussion_r398667575", "bodyText": "From the admin-search-page-component.ts I believe the only actions for this page are show links, hide links and reset student and instructor google id. There is also a manage account link and a homepage link which I checked but did not click.", "author": "jtankw3", "createdAt": "2020-03-26T15:32:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODQ3NzU3NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODQ3ODI4Mw==", "url": "https://github.com/TEAMMATES/teammates/pull/9987#discussion_r398478283", "bodyText": "Reason for this?", "author": "wkurniawan07", "createdAt": "2020-03-26T10:50:17Z", "path": "src/main/java/teammates/ui/webapi/action/SearchAccountsAction.java", "diffHunk": "@@ -267,7 +267,7 @@ private String generateResultUrl(StudentAttributes student, String fsName) {\n             if (ib.getGoogleId() != null) {\n                 ib.setHomePageLink(Config.getFrontEndAppUrl(Const.WebPageURIs.INSTRUCTOR_HOME_PAGE)\n                         .withUserId(instructor.googleId)\n-                        .toAbsoluteString());\n+                        .toString());", "originalCommit": "9623cc0a7ed310fb8c708368de910fdf3c187db5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODY2MTA0NA==", "url": "https://github.com/TEAMMATES/teammates/pull/9987#discussion_r398661044", "bodyText": "As the instructor manage account link and the student manage account link and homepage link all use relative url, I believe it would be more consistent to use a relative url for the instructor homepage link.\nIt is also more convenient for testing as you would not be redirected to localhost:4200 when accessing from localhost:8080", "author": "jtankw3", "createdAt": "2020-03-26T15:24:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODQ3ODI4Mw=="}], "type": "inlineReview"}, {"oid": "a71942d32b6c4226eceae881dd49e24359ad4e3e", "url": "https://github.com/TEAMMATES/teammates/commit/a71942d32b6c4226eceae881dd49e24359ad4e3e", "message": "Merge branch 'master' of https://github.com/TEAMMATES/teammates into admin-search-e2eTests", "committedDate": "2020-03-27T06:48:07Z", "type": "commit"}, {"oid": "237c751568d9b05e137435fc26b12e45ae3e9c00", "url": "https://github.com/TEAMMATES/teammates/commit/237c751568d9b05e137435fc26b12e45ae3e9c00", "message": "Add example cases to AdminSearchPageE2ETest", "committedDate": "2020-03-27T07:09:01Z", "type": "forcePushed"}, {"oid": "b70d2e28a6cb4935b43fd627aecb6eb86a89e1b3", "url": "https://github.com/TEAMMATES/teammates/commit/b70d2e28a6cb4935b43fd627aecb6eb86a89e1b3", "message": "Add example case to AdminSearchPageE2ETest", "committedDate": "2020-03-27T08:06:47Z", "type": "commit"}, {"oid": "b70d2e28a6cb4935b43fd627aecb6eb86a89e1b3", "url": "https://github.com/TEAMMATES/teammates/commit/b70d2e28a6cb4935b43fd627aecb6eb86a89e1b3", "message": "Add example case to AdminSearchPageE2ETest", "committedDate": "2020-03-27T08:06:47Z", "type": "forcePushed"}, {"oid": "6a161a252129a8fe09f9b896a56e1ffd3bdd6da5", "url": "https://github.com/TEAMMATES/teammates/commit/6a161a252129a8fe09f9b896a56e1ffd3bdd6da5", "message": "Merge branch 'master' into admin-search-e2eTests", "committedDate": "2020-03-30T04:30:26Z", "type": "commit"}]}