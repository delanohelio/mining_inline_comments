{"pr_number": 10287, "pr_title": "[#10264] Remove Student Google ID from Output", "pr_createdAt": "2020-07-08T04:18:24Z", "pr_url": "https://github.com/TEAMMATES/teammates/pull/10287", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTQ0NzI3NQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10287#discussion_r451447275", "bodyText": "This is insufficient as googleId still leaks", "author": "wkurniawan07", "createdAt": "2020-07-08T10:39:08Z", "path": "src/main/java/teammates/ui/webapi/action/GetStudentsAction.java", "diffHunk": "@@ -43,18 +44,14 @@ public ActionResult execute() {\n         if (teamName == null) {\n             // request to get all students of a course by instructor\n             List<StudentAttributes> studentsForCourse = logic.getStudentsForCourse(courseId);\n-            return new JsonResult(new StudentsData(studentsForCourse));\n+            StudentsData studentsData = new StudentsData(studentsForCourse);\n+            studentsData.getStudents().forEach(StudentData::hideInformationForInstructor);\n+            return new JsonResult(studentsData);\n         } else {\n             // request to get team members by current student\n             List<StudentAttributes> studentsForTeam = logic.getStudentsForTeam(teamName, courseId);\n             StudentsData studentsData = new StudentsData(studentsForTeam);\n-\n-            // hide information for students\n-            studentsData.getStudents().forEach(s -> {\n-                s.setComments(null);\n-                s.setJoinState(null);\n-            });\n-\n+            studentsData.getStudents().forEach(StudentData::hideInformationForStudent);", "originalCommit": "57a83972d927d5d21aaffbbfe7fe6b6d85c3b299", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTQ0ODc2OQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10287#discussion_r451448769", "bodyText": "I don't think this is necessary because the registration key is not set as part of constructor (i.e. it needs to be explicitly set).\nBut having said that, googleId also needs to be treated the same, i.e. needs to be explicitly set. This will also make the line before this redundant.", "author": "wkurniawan07", "createdAt": "2020-07-08T10:42:04Z", "path": "src/main/java/teammates/ui/webapi/output/StudentData.java", "diffHunk": "@@ -116,12 +116,29 @@ public void hideLastName() {\n         setLastName(null);\n     }\n \n+    /**\n+     * Hides some attributes to instructor on a search.\n+     */\n+    public void hideInformationForInstructorSearch() {\n+        hideInformationForInstructor();\n+        setComments(null);\n+        setInstitute(null);\n+    }\n+\n     /**\n      * Hides some attributes to instructor.\n      */\n     public void hideInformationForInstructor() {\n         setGoogleId(null);\n+        setKey(null);", "originalCommit": "57a83972d927d5d21aaffbbfe7fe6b6d85c3b299", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTQ1MDY1Mg==", "url": "https://github.com/TEAMMATES/teammates/pull/10287#discussion_r451450652", "bodyText": "This is not necessary if the information is not sensitive because:\n\nIt does not save any DB retrieval cost\nIt does save the byte transferred, but comments and institute are never that large to warrant that kind of saving\nThese information are accessible from some other instructor endpoints that are not search, which defeats any goal of information hiding\nHaving this method requires some maintenance effort, e.g. \"why these fields?\", \"why only for instructor search?\"\n\nAdd: I realize I included institute in the issue description (although I did put it as \"good to hide\"). Let's invert the way we look at this: in which situation do we need institute, comments, etc.? Only during those time then we include the said fields.", "author": "wkurniawan07", "createdAt": "2020-07-08T10:45:54Z", "path": "src/main/java/teammates/ui/webapi/output/StudentData.java", "diffHunk": "@@ -116,12 +116,29 @@ public void hideLastName() {\n         setLastName(null);\n     }\n \n+    /**\n+     * Hides some attributes to instructor on a search.\n+     */\n+    public void hideInformationForInstructorSearch() {", "originalCommit": "57a83972d927d5d21aaffbbfe7fe6b6d85c3b299", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTYwMjc0MQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10287#discussion_r451602741", "bodyText": "There was already a method called hideInformationForInstructor which wasn't appropriately named because it was only used in the student search so I just renamed it to hideInformationForInstructorSearch.\nI removed googleId from being set in the constructor and renamed the methods more appropriately. I'll fix the tests first then push the changes.", "author": "madanalogy", "createdAt": "2020-07-08T14:46:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTQ1MDY1Mg=="}], "type": "inlineReview"}, {"oid": "4a71e3752492a3b3f4ce224834d29e0ce70e316b", "url": "https://github.com/TEAMMATES/teammates/commit/4a71e3752492a3b3f4ce224834d29e0ce70e316b", "message": "Remove unnecessary student googleId output", "committedDate": "2020-07-08T14:51:08Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjAwNTk0OQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10287#discussion_r452005949", "bodyText": "Even this is not necessary. This is not really hiding anything.", "author": "wkurniawan07", "createdAt": "2020-07-09T07:03:29Z", "path": "src/main/java/teammates/ui/webapi/action/SearchStudentsAction.java", "diffHunk": "@@ -93,9 +93,9 @@ public ActionResult execute() {\n             if (userInfo.isAdmin && entity.equals(Const.EntityType.ADMIN)) {\n                 studentData.addAdditionalInformationForAdminSearch(\n                         StringHelper.encrypt(s.getKey()),\n-                        getInstituteFromCourseId(s.getCourse()));\n+                        getInstituteFromCourseId(s.getCourse()), s.getGoogleId());\n             } else {\n-                studentData.hideInformationForInstructor();\n+                studentData.hideInformationForSearch();", "originalCommit": "86fc456c3ddc6a4fef4d0e3b97c7641f59ce03c9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjE2NzY2Mw==", "url": "https://github.com/TEAMMATES/teammates/pull/10287#discussion_r452167663", "bodyText": "This was legacy code, comments are hidden from output in student search for instructor. I don't really know why. Would you like me to remove it?", "author": "madanalogy", "createdAt": "2020-07-09T12:05:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjAwNTk0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjM3ODIzMg==", "url": "https://github.com/TEAMMATES/teammates/pull/10287#discussion_r452378232", "bodyText": "comment should not be hidden I think. The point raised by @wkurniawan07 should justify:\n\nThese information are accessible from some other instructor endpoints that are not search, which defeats any goal of information hiding", "author": "xpdavid", "createdAt": "2020-07-09T17:29:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjAwNTk0OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjAwNjI1Mg==", "url": "https://github.com/TEAMMATES/teammates/pull/10287#discussion_r452006252", "bodyText": "Need to assertNull the registration key as well", "author": "wkurniawan07", "createdAt": "2020-07-09T07:04:13Z", "path": "src/test/java/teammates/test/cases/webapi/GetStudentActionTest.java", "diffHunk": "@@ -32,6 +32,7 @@ protected String getRequestMethod() {\n \n     private void assertStudentDataMatches(StudentData studentData, StudentAttributes student,\n                                           boolean isRequestFromInstructor) {\n+        assertNull(studentData.getGoogleId());", "originalCommit": "86fc456c3ddc6a4fef4d0e3b97c7641f59ce03c9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1646911bf61820f67bbe29762ed5ea696b90069d", "url": "https://github.com/TEAMMATES/teammates/commit/1646911bf61820f67bbe29762ed5ea696b90069d", "message": "Remove googleId from StudentData output", "committedDate": "2020-07-10T03:27:20Z", "type": "forcePushed"}, {"oid": "c3169e8006251ed6aaed31b28ac2b261e013a5ee", "url": "https://github.com/TEAMMATES/teammates/commit/c3169e8006251ed6aaed31b28ac2b261e013a5ee", "message": "Remove googleId from StudentData output", "committedDate": "2020-07-10T07:38:56Z", "type": "commit"}, {"oid": "7aed6ca688f7b744c264673c59a38a5655397a6a", "url": "https://github.com/TEAMMATES/teammates/commit/7aed6ca688f7b744c264673c59a38a5655397a6a", "message": "Refactor frontend use of JoinState", "committedDate": "2020-07-10T07:54:25Z", "type": "forcePushed"}, {"oid": "5671e67a5e063a08fa2cbe596936668be99eebfe", "url": "https://github.com/TEAMMATES/teammates/commit/5671e67a5e063a08fa2cbe596936668be99eebfe", "message": "Refactor frontend use of JoinState", "committedDate": "2020-07-10T10:53:26Z", "type": "commit"}, {"oid": "5671e67a5e063a08fa2cbe596936668be99eebfe", "url": "https://github.com/TEAMMATES/teammates/commit/5671e67a5e063a08fa2cbe596936668be99eebfe", "message": "Refactor frontend use of JoinState", "committedDate": "2020-07-10T10:53:26Z", "type": "forcePushed"}, {"oid": "15fab3988b514364ed5769309f098c269fe760a7", "url": "https://github.com/TEAMMATES/teammates/commit/15fab3988b514364ed5769309f098c269fe760a7", "message": "Merge branch 'master' into 10264-googleId", "committedDate": "2020-07-10T13:06:08Z", "type": "commit"}, {"oid": "49d6d0fc11ed7b19d9e66839f94e7bd800a06521", "url": "https://github.com/TEAMMATES/teammates/commit/49d6d0fc11ed7b19d9e66839f94e7bd800a06521", "message": "Merge branch 'master' into 10264-googleId", "committedDate": "2020-07-10T17:17:26Z", "type": "commit"}]}