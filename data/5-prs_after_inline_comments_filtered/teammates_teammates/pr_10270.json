{"pr_number": 10270, "pr_title": "[#10245] Add send email feature for admin search", "pr_createdAt": "2020-07-01T10:26:50Z", "pr_url": "https://github.com/TEAMMATES/teammates/pull/10270", "timeline": [{"oid": "ecdfc394048fbbce1e22dfca41dfd6284833073a", "url": "https://github.com/TEAMMATES/teammates/commit/ecdfc394048fbbce1e22dfca41dfd6284833073a", "message": "Test fix", "committedDate": "2020-07-01T15:42:48Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQ3MzQ5NA==", "url": "https://github.com/TEAMMATES/teammates/pull/10270#discussion_r448473494", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    return AuthType.PUBLIC;\n          \n          \n            \n                    return AuthType.LOGGED_IN;", "author": "madanalogy", "createdAt": "2020-07-01T16:16:31Z", "path": "src/main/java/teammates/ui/webapi/action/GenerateEmailAction.java", "diffHunk": "@@ -0,0 +1,60 @@\n+package teammates.ui.webapi.action;\n+\n+import teammates.common.datatransfer.attributes.CourseAttributes;\n+import teammates.common.datatransfer.attributes.FeedbackSessionAttributes;\n+import teammates.common.datatransfer.attributes.StudentAttributes;\n+import teammates.common.exception.InvalidHttpParameterException;\n+import teammates.common.exception.UnauthorizedAccessException;\n+import teammates.common.util.Assumption;\n+import teammates.common.util.Const;\n+import teammates.common.util.EmailType;\n+import teammates.common.util.EmailWrapper;\n+import teammates.ui.webapi.output.GenerateEmailData;\n+\n+/**\n+ * Generate email content.\n+ */\n+public class GenerateEmailAction extends Action {\n+\n+    @Override\n+    protected AuthType getMinAuthLevel() {\n+        return AuthType.PUBLIC;", "originalCommit": "ecdfc394048fbbce1e22dfca41dfd6284833073a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQ3NTQxNg==", "url": "https://github.com/TEAMMATES/teammates/pull/10270#discussion_r448475416", "bodyText": "I'm thinking /email might be more appropriate. Worthwhile getting more input on this from senior devs.", "author": "madanalogy", "createdAt": "2020-07-01T16:19:45Z", "path": "src/main/java/teammates/common/util/Const.java", "diffHunk": "@@ -704,6 +706,7 @@ private Const() {\n         public static final String LOCAL_DATE_TIME = \"/localdatetime\";\n         public static final String SESSION_LINKS_RECOVERY = \"/sessionlinksrecovery\";\n         public static final String NATIONALITIES = \"/nationalities\";\n+        public static final String GENERATE_EMAIL = \"/generateemail\";", "originalCommit": "ecdfc394048fbbce1e22dfca41dfd6284833073a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODYxNTg1NA==", "url": "https://github.com/TEAMMATES/teammates/pull/10270#discussion_r448615854", "bodyText": "email is better. In REST, you are dealing with Resource not RPC.", "author": "xpdavid", "createdAt": "2020-07-01T21:05:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQ3NTQxNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODYxNDkyMw==", "url": "https://github.com/TEAMMATES/teammates/pull/10270#discussion_r448614923", "bodyText": "Is this the same as the method above? generateFeedbackSessionReminderEmails ?", "author": "xpdavid", "createdAt": "2020-07-01T21:03:25Z", "path": "src/main/java/teammates/logic/api/EmailGenerator.java", "diffHunk": "@@ -108,6 +108,21 @@\n         return emails;\n     }\n \n+    /**\n+     * Generates the feedback session reminder emails for the given {@code student}.\n+     */\n+    public EmailWrapper generateFeedbackSessionStudentReminderEmail(", "originalCommit": "ecdfc394048fbbce1e22dfca41dfd6284833073a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODcyNjU4Mg==", "url": "https://github.com/TEAMMATES/teammates/pull/10270#discussion_r448726582", "bodyText": "No. This is only for a particular student. The method above generates for all students and instructors.", "author": "ccyccyccy", "createdAt": "2020-07-02T03:22:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODYxNDkyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODcyNzY0Ng==", "url": "https://github.com/TEAMMATES/teammates/pull/10270#discussion_r448727646", "bodyText": "But the code is duplicated (almost the same?); By right, generateFeedbackSessionReminderEmails should be able to do generateFeedbackSessionReminderEmails can do.", "author": "xpdavid", "createdAt": "2020-07-02T03:27:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODYxNDkyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODczMDg0OQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10270#discussion_r448730849", "bodyText": "Yes generateFeedbackSessionReminderEmails can do what generateFeedbackSessionStudentReminderEmail does. But I didn't want to generate emails for everyone even though we only need one of them. Seems quite wasteful.\nI think it's more like generateFeedbackSessionReminderEmails can reuse generateFeedbackSessionStudentReminderEmail? I could refactor that.", "author": "ccyccyccy", "createdAt": "2020-07-02T03:41:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODYxNDkyMw=="}], "type": "inlineReview"}, {"oid": "0b1a7738b7ba88cce99dc350b23d8bffd13103ad", "url": "https://github.com/TEAMMATES/teammates/commit/0b1a7738b7ba88cce99dc350b23d8bffd13103ad", "message": "Rename generateemail endpoint to email", "committedDate": "2020-07-02T03:44:04Z", "type": "forcePushed"}, {"oid": "cd1ddbebe5db7242dc1f3799c7ee74b3524c8dcd", "url": "https://github.com/TEAMMATES/teammates/commit/cd1ddbebe5db7242dc1f3799c7ee74b3524c8dcd", "message": "Add API for email request", "committedDate": "2020-07-06T02:41:58Z", "type": "commit"}, {"oid": "16cb0394993556d74ba4d39ebe6aaddf4aed9014", "url": "https://github.com/TEAMMATES/teammates/commit/16cb0394993556d74ba4d39ebe6aaddf4aed9014", "message": "Add frontend buttons for email feature", "committedDate": "2020-07-06T02:44:11Z", "type": "commit"}, {"oid": "99a2ac40f78ee922ca5a3a9d1525fa9aa90020e1", "url": "https://github.com/TEAMMATES/teammates/commit/99a2ac40f78ee922ca5a3a9d1525fa9aa90020e1", "message": "Test fix", "committedDate": "2020-07-06T02:44:12Z", "type": "commit"}, {"oid": "a4a044245d39957ab2ac2673cf83d6174e8742d8", "url": "https://github.com/TEAMMATES/teammates/commit/a4a044245d39957ab2ac2673cf83d6174e8742d8", "message": "Rename generateemail endpoint to email", "committedDate": "2020-07-06T02:44:12Z", "type": "commit"}, {"oid": "0e33ea93f509538a8044ee76c285e49cbcdea6df", "url": "https://github.com/TEAMMATES/teammates/commit/0e33ea93f509538a8044ee76c285e49cbcdea6df", "message": "Change auth type\n\nCo-authored-by: Ahmed Bahajjaj <Ahmed_Bahajjaj@u.nus.edu>", "committedDate": "2020-07-06T02:44:12Z", "type": "commit"}, {"oid": "bbd4d819dc6cd5bac56cf364974c4d7878f0f5a8", "url": "https://github.com/TEAMMATES/teammates/commit/bbd4d819dc6cd5bac56cf364974c4d7878f0f5a8", "message": "Link EmailType from backend to frontend", "committedDate": "2020-07-06T02:44:12Z", "type": "commit"}, {"oid": "c46fcb6762c92a12dc56dc984d2929f3cba4c799", "url": "https://github.com/TEAMMATES/teammates/commit/c46fcb6762c92a12dc56dc984d2929f3cba4c799", "message": "Change params of getEmail", "committedDate": "2020-07-06T02:44:12Z", "type": "commit"}, {"oid": "f9683c9e5b542fa7f19dfdee462c09269351702d", "url": "https://github.com/TEAMMATES/teammates/commit/f9683c9e5b542fa7f19dfdee462c09269351702d", "message": "Fix year not showing", "committedDate": "2020-07-06T03:28:59Z", "type": "commit"}, {"oid": "f9c51705a1b8fb554c39ffea0fc2f9ba7abf1221", "url": "https://github.com/TEAMMATES/teammates/commit/f9c51705a1b8fb554c39ffea0fc2f9ba7abf1221", "message": "Refactor data shape returned by generating strings to display", "committedDate": "2020-07-06T05:10:56Z", "type": "forcePushed"}, {"oid": "d0ddb5e899db92d586c1368ff3fabb881f867484", "url": "https://github.com/TEAMMATES/teammates/commit/d0ddb5e899db92d586c1368ff3fabb881f867484", "message": "Refactor data shape returned by generating strings to display", "committedDate": "2020-07-06T06:01:46Z", "type": "commit"}, {"oid": "d0ddb5e899db92d586c1368ff3fabb881f867484", "url": "https://github.com/TEAMMATES/teammates/commit/d0ddb5e899db92d586c1368ff3fabb881f867484", "message": "Refactor data shape returned by generating strings to display", "committedDate": "2020-07-06T06:01:46Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDExNzc0MQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10270#discussion_r450117741", "bodyText": "Unknown is not exactly accurate because some other types (e.g. INSTRUCTOR_COURSE_JOIN, NEW_INSTRUCTOR_ACCOUNT) are known but we just don't cater for them, maybe not now, maybe never. Email type ... is not accepted. is more accurate.", "author": "wkurniawan07", "createdAt": "2020-07-06T10:03:30Z", "path": "src/main/java/teammates/ui/webapi/action/GenerateEmailAction.java", "diffHunk": "@@ -0,0 +1,60 @@\n+package teammates.ui.webapi.action;\n+\n+import teammates.common.datatransfer.attributes.CourseAttributes;\n+import teammates.common.datatransfer.attributes.FeedbackSessionAttributes;\n+import teammates.common.datatransfer.attributes.StudentAttributes;\n+import teammates.common.exception.InvalidHttpParameterException;\n+import teammates.common.exception.UnauthorizedAccessException;\n+import teammates.common.util.Assumption;\n+import teammates.common.util.Const;\n+import teammates.common.util.EmailType;\n+import teammates.common.util.EmailWrapper;\n+import teammates.ui.webapi.output.EmailData;\n+\n+/**\n+ * Generate email content.\n+ */\n+public class GenerateEmailAction extends Action {\n+\n+    @Override\n+    protected AuthType getMinAuthLevel() {\n+        return AuthType.LOGGED_IN;\n+    }\n+\n+    @Override\n+    public void checkSpecificAccessControl() {\n+        if (!userInfo.isAdmin) {\n+            throw new UnauthorizedAccessException(\"Admin privilege is required to access this resource.\");\n+        }\n+    }\n+\n+    @Override\n+    public ActionResult execute() {\n+        String courseId = getNonNullRequestParamValue(Const.ParamsNames.COURSE_ID);\n+        String studentEmail = getNonNullRequestParamValue(Const.ParamsNames.STUDENT_EMAIL);\n+        String emailType = getNonNullRequestParamValue(Const.ParamsNames.EMAIL_TYPE);\n+        String feedbackSessionName = getRequestParamValue(Const.ParamsNames.FEEDBACK_SESSION_NAME);\n+\n+        CourseAttributes course = logic.getCourse(courseId);\n+        Assumption.assertNotNull(course);\n+\n+        StudentAttributes student = logic.getStudentForEmail(courseId, studentEmail);\n+        Assumption.assertNotNull(student);\n+\n+        EmailWrapper email;\n+\n+        if (emailType.equals(EmailType.STUDENT_COURSE_JOIN.name())) {\n+            email = emailGenerator.generateStudentCourseJoinEmail(course, student);\n+        } else if (emailType.equals(EmailType.FEEDBACK_SESSION_REMINDER.name())) {\n+            if (feedbackSessionName == null) {\n+                throw new InvalidHttpParameterException(\"Feedback session name not specified\");\n+            }\n+            FeedbackSessionAttributes feedbackSession = logic.getFeedbackSession(feedbackSessionName, courseId);\n+            email = emailGenerator.generateFeedbackSessionStudentReminderEmail(feedbackSession, student);\n+        } else {\n+            throw new InvalidHttpParameterException(\"Unknown emailType \" + emailType);", "originalCommit": "d0ddb5e899db92d586c1368ff3fabb881f867484", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "233ee124e3683e4ccf3e42db2195cfe01388067e", "url": "https://github.com/TEAMMATES/teammates/commit/233ee124e3683e4ccf3e42db2195cfe01388067e", "message": "Remove comment", "committedDate": "2020-07-06T13:39:22Z", "type": "commit"}, {"oid": "acfe8f3b04473e5bc5343a2c4bb4e0b6f04e4f91", "url": "https://github.com/TEAMMATES/teammates/commit/acfe8f3b04473e5bc5343a2c4bb4e0b6f04e4f91", "message": "Move formatProperties to searchservice.ts", "committedDate": "2020-07-06T14:19:36Z", "type": "commit"}, {"oid": "a5554ffaa916cdd2955b6d0e05ef7ecf7f9f8dc1", "url": "https://github.com/TEAMMATES/teammates/commit/a5554ffaa916cdd2955b6d0e05ef7ecf7f9f8dc1", "message": "Change error message for unaccepted email type", "committedDate": "2020-07-06T14:20:47Z", "type": "commit"}, {"oid": "e2739b966f363c5fe8e14c65bc45036137091950", "url": "https://github.com/TEAMMATES/teammates/commit/e2739b966f363c5fe8e14c65bc45036137091950", "message": "Abstration for email opening link", "committedDate": "2020-07-06T14:41:09Z", "type": "commit"}, {"oid": "83f8794002fe02ba7bf91aafa37064afb5a6e377", "url": "https://github.com/TEAMMATES/teammates/commit/83f8794002fe02ba7bf91aafa37064afb5a6e377", "message": "Lint fix", "committedDate": "2020-07-06T15:35:47Z", "type": "commit"}, {"oid": "d47ce941601fc6d87568a5a0203b5ad8cca8a0a1", "url": "https://github.com/TEAMMATES/teammates/commit/d47ce941601fc6d87568a5a0203b5ad8cca8a0a1", "message": "Fix bad merge", "committedDate": "2020-07-08T08:00:20Z", "type": "commit"}, {"oid": "51e4ead529251ee014ce4524a7cef2af0583df89", "url": "https://github.com/TEAMMATES/teammates/commit/51e4ead529251ee014ce4524a7cef2af0583df89", "message": "Remove useless enum", "committedDate": "2020-07-08T08:11:50Z", "type": "commit"}, {"oid": "208c71b215e9372c060d1508b807ebe53193fd9f", "url": "https://github.com/TEAMMATES/teammates/commit/208c71b215e9372c060d1508b807ebe53193fd9f", "message": "Merge branch 'master' into 10245-email-feature", "committedDate": "2020-07-08T13:28:44Z", "type": "commit"}]}