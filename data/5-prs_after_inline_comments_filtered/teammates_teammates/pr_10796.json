{"pr_number": 10796, "pr_title": "[#9536] Migrate parts of instructor search/student list/records page E2E tests", "pr_createdAt": "2020-10-18T17:30:32Z", "pr_url": "https://github.com/TEAMMATES/teammates/pull/10796", "timeline": [{"oid": "d04088fa428418c8f5609893b7de4c3ecde052e1", "url": "https://github.com/TEAMMATES/teammates/commit/d04088fa428418c8f5609893b7de4c3ecde052e1", "message": "Standardize search code for students and comments", "committedDate": "2020-10-18T16:53:46Z", "type": "commit"}, {"oid": "0c727e213db7cb0e85bb13026d3ad510e9b81d8b", "url": "https://github.com/TEAMMATES/teammates/commit/0c727e213db7cb0e85bb13026d3ad510e9b81d8b", "message": "Add missing features (sorting + deleting) for students table", "committedDate": "2020-10-18T16:53:47Z", "type": "commit"}, {"oid": "0bd8e6c48431bac9027625402a7baab0d8753276", "url": "https://github.com/TEAMMATES/teammates/commit/0bd8e6c48431bac9027625402a7baab0d8753276", "message": "Improve student details edit page to display course ID", "committedDate": "2020-10-18T16:53:47Z", "type": "commit"}, {"oid": "0db7d16f4811cee0f108df573770e848fbf8669c", "url": "https://github.com/TEAMMATES/teammates/commit/0db7d16f4811cee0f108df573770e848fbf8669c", "message": "Add minimum E2E test for search page", "committedDate": "2020-10-18T16:53:48Z", "type": "commit"}, {"oid": "9e2ba0f95981499eabf0d5c41d0015615d1bfcc9", "url": "https://github.com/TEAMMATES/teammates/commit/9e2ba0f95981499eabf0d5c41d0015615d1bfcc9", "message": "Add minimum E2E test for student list page", "committedDate": "2020-10-18T16:53:48Z", "type": "commit"}, {"oid": "844fb4ef5d4e5362593df66c1511f858ef1e4a3e", "url": "https://github.com/TEAMMATES/teammates/commit/844fb4ef5d4e5362593df66c1511f858ef1e4a3e", "message": "Add identical test cases for delete student", "committedDate": "2020-10-18T16:53:48Z", "type": "commit"}, {"oid": "5a514fddaa2ae1a8de2237dd06db87cd9569ea9a", "url": "https://github.com/TEAMMATES/teammates/commit/5a514fddaa2ae1a8de2237dd06db87cd9569ea9a", "message": "Add identical test cases for testing links", "committedDate": "2020-10-18T18:08:33Z", "type": "commit"}, {"oid": "7a2a63253030f83a46bcaf6c200237e2e8aa3bbc", "url": "https://github.com/TEAMMATES/teammates/commit/7a2a63253030f83a46bcaf6c200237e2e8aa3bbc", "message": "Add test for link to enroll page", "committedDate": "2020-10-18T18:08:33Z", "type": "commit"}, {"oid": "067f684104a3d31a2fdd45927e35c92020b2ea27", "url": "https://github.com/TEAMMATES/teammates/commit/067f684104a3d31a2fdd45927e35c92020b2ea27", "message": "Add first round of E2E test for student records page", "committedDate": "2020-10-18T18:08:33Z", "type": "commit"}, {"oid": "41369aa0161804a945e1dbb4d8f1b7f7f98313ee", "url": "https://github.com/TEAMMATES/teammates/commit/41369aa0161804a945e1dbb4d8f1b7f7f98313ee", "message": "Add TODO for feedback response-related tests", "committedDate": "2020-10-18T18:08:33Z", "type": "commit"}, {"oid": "41369aa0161804a945e1dbb4d8f1b7f7f98313ee", "url": "https://github.com/TEAMMATES/teammates/commit/41369aa0161804a945e1dbb4d8f1b7f7f98313ee", "message": "Add TODO for feedback response-related tests", "committedDate": "2020-10-18T18:08:33Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzU1NDI4OA==", "url": "https://github.com/TEAMMATES/teammates/pull/10796#discussion_r507554288", "bodyText": "Maybe the 4 lines above can be abstracted as something like a searchForStudentsAndComments method in the page object to hide more of the element details in case maybe someday we stop using checkboxes or something.", "author": "jtankw3", "createdAt": "2020-10-19T08:13:10Z", "path": "src/e2e/java/teammates/e2e/cases/e2e/InstructorSearchPageE2ETest.java", "diffHunk": "@@ -0,0 +1,121 @@\n+package teammates.e2e.cases.e2e;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import org.testng.annotations.Test;\n+\n+import teammates.common.datatransfer.attributes.CourseAttributes;\n+import teammates.common.datatransfer.attributes.StudentAttributes;\n+import teammates.common.util.AppUrl;\n+import teammates.common.util.Const;\n+import teammates.e2e.pageobjects.InstructorCourseStudentDetailsEditPage;\n+import teammates.e2e.pageobjects.InstructorCourseStudentDetailsViewPage;\n+import teammates.e2e.pageobjects.InstructorSearchPage;\n+import teammates.e2e.pageobjects.InstructorStudentRecordsPage;\n+\n+/**\n+ * SUT: {@link Const.WebPageURIs#INSTRUCTOR_SEARCH_PAGE}.\n+ */\n+public class InstructorSearchPageE2ETest extends BaseE2ETestCase {\n+\n+    @Override\n+    protected void prepareTestData() {\n+        testData = loadDataBundle(\"/InstructorSearchPageE2ETest.json\");\n+        removeAndRestoreDataBundle(testData);\n+        putDocuments(testData);\n+    }\n+\n+    @Test\n+    public void allTests() {\n+\n+        String instructorId = testData.accounts.get(\"instructor1OfCourse1\").googleId;\n+        AppUrl searchPageUrl = createUrl(Const.WebPageURIs.INSTRUCTOR_SEARCH_PAGE).withUserId(instructorId);\n+\n+        InstructorSearchPage searchPage = loginAdminToPage(searchPageUrl, InstructorSearchPage.class);\n+\n+        ______TS(\"cannot click search button if no checkbox is selected\");\n+\n+        searchPage.clickStudentsCheckbox();\n+        searchPage.verifyCannotClickSearchButton();\n+\n+        ______TS(\"search with no result\");\n+\n+        searchPage.inputSearchContent(\"thiswillnothitanything\");\n+        searchPage.clickStudentsCheckbox();\n+        searchPage.clickCommentsCheckbox();\n+        searchPage.clickSearchButton();", "originalCommit": "41369aa0161804a945e1dbb4d8f1b7f7f98313ee", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzU1NzA0NQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10796#discussion_r507557045", "bodyText": "Maybe this method can also be inside the page object as adding the brackets seems like a implementation detail.", "author": "jtankw3", "createdAt": "2020-10-19T08:17:36Z", "path": "src/e2e/java/teammates/e2e/cases/e2e/InstructorSearchPageE2ETest.java", "diffHunk": "@@ -0,0 +1,121 @@\n+package teammates.e2e.cases.e2e;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import org.testng.annotations.Test;\n+\n+import teammates.common.datatransfer.attributes.CourseAttributes;\n+import teammates.common.datatransfer.attributes.StudentAttributes;\n+import teammates.common.util.AppUrl;\n+import teammates.common.util.Const;\n+import teammates.e2e.pageobjects.InstructorCourseStudentDetailsEditPage;\n+import teammates.e2e.pageobjects.InstructorCourseStudentDetailsViewPage;\n+import teammates.e2e.pageobjects.InstructorSearchPage;\n+import teammates.e2e.pageobjects.InstructorStudentRecordsPage;\n+\n+/**\n+ * SUT: {@link Const.WebPageURIs#INSTRUCTOR_SEARCH_PAGE}.\n+ */\n+public class InstructorSearchPageE2ETest extends BaseE2ETestCase {\n+\n+    @Override\n+    protected void prepareTestData() {\n+        testData = loadDataBundle(\"/InstructorSearchPageE2ETest.json\");\n+        removeAndRestoreDataBundle(testData);\n+        putDocuments(testData);\n+    }\n+\n+    @Test\n+    public void allTests() {\n+\n+        String instructorId = testData.accounts.get(\"instructor1OfCourse1\").googleId;\n+        AppUrl searchPageUrl = createUrl(Const.WebPageURIs.INSTRUCTOR_SEARCH_PAGE).withUserId(instructorId);\n+\n+        InstructorSearchPage searchPage = loginAdminToPage(searchPageUrl, InstructorSearchPage.class);\n+\n+        ______TS(\"cannot click search button if no checkbox is selected\");\n+\n+        searchPage.clickStudentsCheckbox();\n+        searchPage.verifyCannotClickSearchButton();\n+\n+        ______TS(\"search with no result\");\n+\n+        searchPage.inputSearchContent(\"thiswillnothitanything\");\n+        searchPage.clickStudentsCheckbox();\n+        searchPage.clickCommentsCheckbox();\n+        searchPage.clickSearchButton();\n+        searchPage.verifyStatusMessage(\"No results found.\");\n+\n+        ______TS(\"search for students\");\n+\n+        searchPage.clickCommentsCheckbox();\n+        searchPage.inputSearchContent(\"student2\");\n+        searchPage.clickSearchButton();\n+\n+        CourseAttributes course1 = testData.courses.get(\"typicalCourse1\");\n+        CourseAttributes course2 = testData.courses.get(\"typicalCourse2\");\n+        String course1Header = createHeaderText(course1);\n+        String course2Header = createHeaderText(course2);\n+\n+        StudentAttributes[] studentsInCourse1 = {\n+                testData.students.get(\"student2.2InCourse1\"),\n+                testData.students.get(\"student2InCourse1\"),\n+        };\n+        StudentAttributes[] studentsInCourse2 = {\n+                testData.students.get(\"student2.2InCourse2\"),\n+                testData.students.get(\"student2InCourse2\"),\n+        };\n+\n+        Map<String, StudentAttributes[]> courseHeaderToStudents = new HashMap<>();\n+        courseHeaderToStudents.put(course1Header, studentsInCourse1);\n+        courseHeaderToStudents.put(course2Header, studentsInCourse2);\n+\n+        searchPage.verifyStudentDetails(courseHeaderToStudents);\n+\n+        ______TS(\"link: view student details page\");\n+\n+        StudentAttributes studentToView = testData.students.get(\"student2.2InCourse1\");\n+        String studentEmail = studentToView.getEmail();\n+\n+        InstructorCourseStudentDetailsViewPage studentDetailsViewPage =\n+                searchPage.clickViewStudent(course1Header, studentEmail);\n+        studentDetailsViewPage.verifyIsCorrectPage(course1.getId(), studentEmail);\n+        studentDetailsViewPage.closeCurrentWindowAndSwitchToParentWindow();\n+\n+        ______TS(\"link: edit student details page\");\n+\n+        InstructorCourseStudentDetailsEditPage studentDetailsEditPage =\n+                searchPage.clickEditStudent(course1Header, studentEmail);\n+        studentDetailsEditPage.verifyIsCorrectPage(course1.getId(), studentEmail);\n+        studentDetailsEditPage.closeCurrentWindowAndSwitchToParentWindow();\n+\n+        ______TS(\"link: view all records page\");\n+\n+        InstructorStudentRecordsPage studentRecordsPage =\n+                searchPage.clickViewAllRecords(course1Header, studentEmail);\n+        studentRecordsPage.verifyIsCorrectPage(course1.getId(), studentToView.getName());\n+        studentRecordsPage.closeCurrentWindowAndSwitchToParentWindow();\n+\n+        ______TS(\"action: delete student\");\n+\n+        StudentAttributes studentToDelete = testData.students.get(\"student2InCourse1\");\n+\n+        searchPage.deleteStudent(course1Header, studentToDelete.getEmail());\n+\n+        StudentAttributes[] studentsAfterDelete = {\n+                testData.students.get(\"student2.2InCourse1\"),\n+        };\n+\n+        searchPage.verifyStudentDetails(course1Header, studentsAfterDelete);\n+        verifyAbsentInDatastore(studentToDelete);\n+\n+        // TODO add tests for search response comments\n+\n+    }\n+\n+    private String createHeaderText(CourseAttributes course) {\n+        return \"[\" + course.getId() + \"]\";\n+    }", "originalCommit": "41369aa0161804a945e1dbb4d8f1b7f7f98313ee", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzU2NTY3OQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10796#discussion_r507565679", "bodyText": "Same for this, I feel like the header formatting belongs more in the page object", "author": "jtankw3", "createdAt": "2020-10-19T08:31:03Z", "path": "src/e2e/java/teammates/e2e/cases/e2e/InstructorStudentListPageE2ETest.java", "diffHunk": "@@ -0,0 +1,131 @@\n+package teammates.e2e.cases.e2e;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import org.testng.annotations.Test;\n+\n+import teammates.common.datatransfer.attributes.CourseAttributes;\n+import teammates.common.datatransfer.attributes.InstructorAttributes;\n+import teammates.common.datatransfer.attributes.StudentAttributes;\n+import teammates.common.util.AppUrl;\n+import teammates.common.util.Const;\n+import teammates.e2e.pageobjects.InstructorCourseEnrollPage;\n+import teammates.e2e.pageobjects.InstructorCourseStudentDetailsEditPage;\n+import teammates.e2e.pageobjects.InstructorCourseStudentDetailsViewPage;\n+import teammates.e2e.pageobjects.InstructorStudentListPage;\n+import teammates.e2e.pageobjects.InstructorStudentRecordsPage;\n+\n+/**\n+ * SUT: {@link Const.WebPageURIs#INSTRUCTOR_STUDENT_LIST_PAGE}.\n+ */\n+public class InstructorStudentListPageE2ETest extends BaseE2ETestCase {\n+\n+    @Override\n+    protected void prepareTestData() {\n+        testData = loadDataBundle(\"/InstructorStudentListPageE2ETest.json\");\n+        removeAndRestoreDataBundle(testData);\n+    }\n+\n+    @Test\n+    public void testAll() {\n+\n+        ______TS(\"verify loaded data\");\n+\n+        InstructorAttributes instructor = testData.instructors.get(\"instructorOfCourse1\");\n+        String instructorId = instructor.googleId;\n+\n+        AppUrl listPageUrl = createUrl(Const.WebPageURIs.INSTRUCTOR_STUDENT_LIST_PAGE).withUserId(instructorId);\n+        InstructorStudentListPage listPage = loginAdminToPage(listPageUrl, InstructorStudentListPage.class);\n+\n+        CourseAttributes course1 = testData.courses.get(\"course1\");\n+        CourseAttributes course2 = testData.courses.get(\"course2\");\n+        CourseAttributes course3 = testData.courses.get(\"course3\");\n+        String course1Header = createHeaderText(course1);\n+        String course2Header = createHeaderText(course2);\n+        String course3Header = createHeaderText(course3);\n+\n+        StudentAttributes[] studentsInCourse1 = {};\n+\n+        // Note: by right, there should not be any student shown here as the instructor does not have sufficient privilege\n+        // However, due to issue #8000, the students will be listed anyway\n+        StudentAttributes[] studentsInCourse2 = {\n+                testData.students.get(\"Student1Course2\"),\n+                testData.students.get(\"Student2Course2\"),\n+                testData.students.get(\"Student3Course2\"),\n+        };\n+\n+        StudentAttributes[] studentsInCourse3 = {\n+                testData.students.get(\"Student1Course3\"),\n+                testData.students.get(\"Student2Course3\"),\n+                testData.students.get(\"Student3Course3\"),\n+                testData.students.get(\"Student4Course3\"),\n+        };\n+\n+        Map<String, StudentAttributes[]> courseHeaderToStudents = new HashMap<>();\n+        courseHeaderToStudents.put(course1Header, studentsInCourse1);\n+        courseHeaderToStudents.put(course2Header, studentsInCourse2);\n+        courseHeaderToStudents.put(course3Header, studentsInCourse3);\n+\n+        // Expand all headers first\n+\n+        for (String header : courseHeaderToStudents.keySet()) {\n+            listPage.clickCourseTabHeader(header);\n+        }\n+\n+        listPage.verifyStudentDetails(courseHeaderToStudents);\n+\n+        ______TS(\"link: enroll page\");\n+\n+        InstructorCourseEnrollPage enrollPage = listPage.clickEnrollStudents(course3Header);\n+        enrollPage.verifyIsCorrectPage(course3.getId());\n+\n+        listPage = loginAdminToPage(listPageUrl, InstructorStudentListPage.class);\n+        listPage.clickCourseTabHeader(course3Header);\n+\n+        ______TS(\"link: view student details page\");\n+\n+        StudentAttributes studentToView = testData.students.get(\"Student1Course3\");\n+        String studentEmail = studentToView.getEmail();\n+\n+        InstructorCourseStudentDetailsViewPage studentDetailsViewPage =\n+                listPage.clickViewStudent(course3Header, studentEmail);\n+        studentDetailsViewPage.verifyIsCorrectPage(course3.getId(), studentEmail);\n+        studentDetailsViewPage.closeCurrentWindowAndSwitchToParentWindow();\n+\n+        ______TS(\"link: edit student details page\");\n+\n+        InstructorCourseStudentDetailsEditPage studentDetailsEditPage =\n+                listPage.clickEditStudent(course3Header, studentEmail);\n+        studentDetailsEditPage.verifyIsCorrectPage(course3.getId(), studentEmail);\n+        studentDetailsEditPage.closeCurrentWindowAndSwitchToParentWindow();\n+\n+        ______TS(\"link: view all records page\");\n+\n+        InstructorStudentRecordsPage studentRecordsPage =\n+                listPage.clickViewAllRecords(course3Header, studentEmail);\n+        studentRecordsPage.verifyIsCorrectPage(course3.getId(), studentToView.getName());\n+        studentRecordsPage.closeCurrentWindowAndSwitchToParentWindow();\n+\n+        ______TS(\"action: delete student\");\n+\n+        StudentAttributes studentToDelete = testData.students.get(\"Student3Course3\");\n+\n+        listPage.deleteStudent(course3Header, studentToDelete.getEmail());\n+\n+        StudentAttributes[] studentsAfterDelete = {\n+                testData.students.get(\"Student1Course3\"),\n+                testData.students.get(\"Student2Course3\"),\n+                testData.students.get(\"Student4Course3\"),\n+        };\n+\n+        listPage.verifyStudentDetails(course3Header, studentsAfterDelete);\n+        verifyAbsentInDatastore(studentToDelete);\n+\n+    }\n+\n+    private String createHeaderText(CourseAttributes course) {\n+        return String.format(\"[%s]: %s\", course.getId(), course.getName());", "originalCommit": "41369aa0161804a945e1dbb4d8f1b7f7f98313ee", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzU2NjgxNg==", "url": "https://github.com/TEAMMATES/teammates/pull/10796#discussion_r507566816", "bodyText": "Should we use a instructor with the appropriate privilege instead?", "author": "jtankw3", "createdAt": "2020-10-19T08:32:54Z", "path": "src/e2e/java/teammates/e2e/cases/e2e/InstructorStudentListPageE2ETest.java", "diffHunk": "@@ -0,0 +1,131 @@\n+package teammates.e2e.cases.e2e;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import org.testng.annotations.Test;\n+\n+import teammates.common.datatransfer.attributes.CourseAttributes;\n+import teammates.common.datatransfer.attributes.InstructorAttributes;\n+import teammates.common.datatransfer.attributes.StudentAttributes;\n+import teammates.common.util.AppUrl;\n+import teammates.common.util.Const;\n+import teammates.e2e.pageobjects.InstructorCourseEnrollPage;\n+import teammates.e2e.pageobjects.InstructorCourseStudentDetailsEditPage;\n+import teammates.e2e.pageobjects.InstructorCourseStudentDetailsViewPage;\n+import teammates.e2e.pageobjects.InstructorStudentListPage;\n+import teammates.e2e.pageobjects.InstructorStudentRecordsPage;\n+\n+/**\n+ * SUT: {@link Const.WebPageURIs#INSTRUCTOR_STUDENT_LIST_PAGE}.\n+ */\n+public class InstructorStudentListPageE2ETest extends BaseE2ETestCase {\n+\n+    @Override\n+    protected void prepareTestData() {\n+        testData = loadDataBundle(\"/InstructorStudentListPageE2ETest.json\");\n+        removeAndRestoreDataBundle(testData);\n+    }\n+\n+    @Test\n+    public void testAll() {\n+\n+        ______TS(\"verify loaded data\");\n+\n+        InstructorAttributes instructor = testData.instructors.get(\"instructorOfCourse1\");\n+        String instructorId = instructor.googleId;\n+\n+        AppUrl listPageUrl = createUrl(Const.WebPageURIs.INSTRUCTOR_STUDENT_LIST_PAGE).withUserId(instructorId);\n+        InstructorStudentListPage listPage = loginAdminToPage(listPageUrl, InstructorStudentListPage.class);\n+\n+        CourseAttributes course1 = testData.courses.get(\"course1\");\n+        CourseAttributes course2 = testData.courses.get(\"course2\");\n+        CourseAttributes course3 = testData.courses.get(\"course3\");\n+        String course1Header = createHeaderText(course1);\n+        String course2Header = createHeaderText(course2);\n+        String course3Header = createHeaderText(course3);\n+\n+        StudentAttributes[] studentsInCourse1 = {};\n+\n+        // Note: by right, there should not be any student shown here as the instructor does not have sufficient privilege\n+        // However, due to issue #8000, the students will be listed anyway", "originalCommit": "41369aa0161804a945e1dbb4d8f1b7f7f98313ee", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzY2MjM3MQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10796#discussion_r507662371", "bodyText": "No; the entire point is to ensure that there should be nothing displayed here.", "author": "wkurniawan07", "createdAt": "2020-10-19T11:09:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzU2NjgxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzY3ODY2OQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10796#discussion_r507678669", "bodyText": "Oh I see what you mean now.", "author": "jtankw3", "createdAt": "2020-10-19T11:40:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzU2NjgxNg=="}], "type": "inlineReview"}, {"oid": "fb89ff9e03b92b9072198a779447ae78a0f1e580", "url": "https://github.com/TEAMMATES/teammates/commit/fb89ff9e03b92b9072198a779447ae78a0f1e580", "message": "Move createHeaderText to page object", "committedDate": "2020-10-19T10:56:01Z", "type": "commit"}, {"oid": "1e4c873e46994effe05ebd480dcafb0328806c5b", "url": "https://github.com/TEAMMATES/teammates/commit/1e4c873e46994effe05ebd480dcafb0328806c5b", "message": "Abstract out search action", "committedDate": "2020-10-19T11:07:12Z", "type": "commit"}, {"oid": "b4a2cef436fe0d89a4a98392538de0e1f83b05e5", "url": "https://github.com/TEAMMATES/teammates/commit/b4a2cef436fe0d89a4a98392538de0e1f83b05e5", "message": "Merge branch 'master' into search-e2e", "committedDate": "2020-10-20T23:03:08Z", "type": "commit"}]}