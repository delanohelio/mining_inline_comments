{"pr_number": 10879, "pr_title": "[#10870] Improve error messages for 403 errors", "pr_createdAt": "2020-12-16T12:46:14Z", "pr_url": "https://github.com/TEAMMATES/teammates/pull/10879", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDc1MTA5Mg==", "url": "https://github.com/TEAMMATES/teammates/pull/10879#discussion_r544751092", "bodyText": "Is there any specific reason why the default is false? I think it should be true since this is the behavior for all other error message types (whatever you write is displayed to the user). There's also a lot more cases of you passing in true as the 2nd parameter compared to using it as false, although this isn't really a compelling argument.", "author": "ChooJeremy", "createdAt": "2020-12-17T01:50:03Z", "path": "src/main/java/teammates/common/exception/UnauthorizedAccessException.java", "diffHunk": "@@ -6,8 +6,34 @@\n @SuppressWarnings(\"serial\")\n public class UnauthorizedAccessException extends RuntimeException {\n \n+    /**\n+     * Indicates whether the error message will be shown to the user (as the API response).\n+     * If this flag is set to \"false\", a generic error message will be displayed instead.\n+     * The actual error message is always displayed to admin in the logs.\n+     *\n+     * <p>As this exception involves access control, the error message need to be redacted\n+     * in most cases because the full error message can give clues as to what needs to be done\n+     * in order to get the access (which should be unauthorized).\n+     * While it is true that there is little that user can do to elevate his/her privilege\n+     * even with that knowledge, we still need to do our part.\n+     *\n+     * <p>There are, however, some cases whereby the error message would be legitimately helpful\n+     * to users, e.g. when submitting responses to a feedback session that has not opened yet.\n+     * For such cases, it is appropriate to set this flag as \"true\".\n+     */\n+    private final boolean showErrorMessage;\n+\n     public UnauthorizedAccessException(String message) {\n+        this(message, false);", "originalCommit": "652d45e25b11e5ff8a3e87e61b934f285c1a9685", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDc1NDI0Nw==", "url": "https://github.com/TEAMMATES/teammates/pull/10879#discussion_r544754247", "bodyText": "There's also a lot more cases of you passing in true as the 2nd parameter compared to using it as false\n\nI'm not sure where you get this from, because only 5 out of 55 UnauthorizedAccessException being created have true as the 2nd param.", "author": "wkurniawan07", "createdAt": "2020-12-17T01:59:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDc1MTA5Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDgxOTU0OQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10879#discussion_r544819549", "bodyText": "I'm not sure where you get this from, because only 5 out of 55 UnauthorizedAccessException being created have true as the 2nd param.\n\nAh ok, I only looked though the changes so I just found more cases of it being true than not. (I realize this is on a very biased sample)\nDropping that, what about keeping it to default false for consistency with other exception types?", "author": "ChooJeremy", "createdAt": "2020-12-17T05:19:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDc1MTA5Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDgyMDM2NA==", "url": "https://github.com/TEAMMATES/teammates/pull/10879#discussion_r544820364", "bodyText": "It's not about consistency. If you understand the reason why it needs to be redacted in the first place, you should know why the default is false. Admittedly, even that reason is debatable.", "author": "wkurniawan07", "createdAt": "2020-12-17T05:22:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDc1MTA5Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTI4MzczMA==", "url": "https://github.com/TEAMMATES/teammates/pull/10879#discussion_r545283730", "bodyText": "very minor nit: perhaps can rename this function to testActionUnauthorized and also the test case name to ______TS(\"Unauthorized Access Case: updating another student's profile\");", "author": "rrtheonlyone", "createdAt": "2020-12-17T17:49:48Z", "path": "src/test/java/teammates/ui/webapi/UpdateStudentProfileActionTest.java", "diffHunk": "@@ -215,5 +200,18 @@ private StudentProfileUpdateRequest createInvalidUpdateRequestForProfileWithScri\n     protected void testAccessControl() {\n         verifyInaccessibleWithoutLogin();\n         verifyInaccessibleForUnregisteredUsers();\n+        testActionForbidden();\n+    }\n+\n+    private void testActionForbidden() {", "originalCommit": "652d45e25b11e5ff8a3e87e61b934f285c1a9685", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTUxMDYyMg==", "url": "https://github.com/TEAMMATES/teammates/pull/10879#discussion_r545510622", "bodyText": "Strictly speaking, unauthorized is for when there is no login credentials whereas forbidden is for when there is wrong login credentials (think 401 vs 403, although we treat them the same in the API layer). This test case is closer to 403.", "author": "wkurniawan07", "createdAt": "2020-12-18T01:18:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTI4MzczMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTU0NzE1Ng==", "url": "https://github.com/TEAMMATES/teammates/pull/10879#discussion_r545547156", "bodyText": "Ohh I see what you mean", "author": "rrtheonlyone", "createdAt": "2020-12-18T03:17:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTI4MzczMA=="}], "type": "inlineReview"}, {"oid": "42fcf1f5df1d151fd020104eea46e5712c1f8473", "url": "https://github.com/TEAMMATES/teammates/commit/42fcf1f5df1d151fd020104eea46e5712c1f8473", "message": "Move misplaced access control check", "committedDate": "2020-12-18T09:30:59Z", "type": "commit"}, {"oid": "672e0919ce7abf93655e0bbdecbb73daca9f3d5c", "url": "https://github.com/TEAMMATES/teammates/commit/672e0919ce7abf93655e0bbdecbb73daca9f3d5c", "message": "Remove unnecessary masquerade mode check", "committedDate": "2020-12-18T09:30:59Z", "type": "commit"}, {"oid": "9a1b10d25c770e50a37aa6d1896f18d155747f58", "url": "https://github.com/TEAMMATES/teammates/commit/9a1b10d25c770e50a37aa6d1896f18d155747f58", "message": "Add flag to UnauthorizedAccessException to display the error message to user", "committedDate": "2020-12-18T09:31:00Z", "type": "commit"}, {"oid": "9a1b10d25c770e50a37aa6d1896f18d155747f58", "url": "https://github.com/TEAMMATES/teammates/commit/9a1b10d25c770e50a37aa6d1896f18d155747f58", "message": "Add flag to UnauthorizedAccessException to display the error message to user", "committedDate": "2020-12-18T09:31:00Z", "type": "forcePushed"}]}