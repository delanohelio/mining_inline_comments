{"pr_number": 2558, "pr_title": "Fix small compile errors in API mixins", "pr_createdAt": "2020-04-08T02:33:38Z", "pr_url": "https://github.com/SpongePowered/Sponge/pull/2558", "timeline": [{"oid": "792b19bc5b1919cf4ea603c6f8e08338787dd91b", "url": "https://github.com/SpongePowered/Sponge/commit/792b19bc5b1919cf4ea603c6f8e08338787dd91b", "message": "Fix small compile errors in API mixins", "committedDate": "2020-04-08T02:32:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTIyODQ4NQ==", "url": "https://github.com/SpongePowered/Sponge/pull/2558#discussion_r405228485", "bodyText": "So funny enough, this is not implemented correctly in API 7...\nhttps://github.com/SpongePowered/SpongeAPI/blob/api-8/src/main/java/org/spongepowered/api/entity/living/player/User.java#L95\nIt is supposed to NEVER load a world. It queries if the World is online and bombs if it isn't.", "author": "Zidane", "createdAt": "2020-04-08T02:52:03Z", "path": "src/mixins/java/org/spongepowered/common/mixin/api/mcp/entity/player/ServerPlayerEntityMixin_API.java", "diffHunk": "@@ -448,7 +449,13 @@ public void remove() {\n     @Override\n     public boolean setLocation(final Vector3d position, final UUID world) {", "originalCommit": "792b19bc5b1919cf4ea603c6f8e08338787dd91b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTIyODU4MQ==", "url": "https://github.com/SpongePowered/Sponge/pull/2558#discussion_r405228581", "bodyText": "Minor niptick\nthis.\nThanks", "author": "Zidane", "createdAt": "2020-04-08T02:52:24Z", "path": "src/mixins/java/org/spongepowered/common/mixin/api/mcp/scoreboard/ScoreCriteria_RenderTypeMixin_API.java", "diffHunk": "@@ -25,24 +25,28 @@\n package org.spongepowered.common.mixin.api.mcp.scoreboard;\n \n import net.minecraft.scoreboard.ScoreCriteria;\n+import org.spongepowered.api.CatalogKey;\n import org.spongepowered.api.scoreboard.objective.displaymode.ObjectiveDisplayMode;\n-import org.spongepowered.asm.mixin.Final;\n import org.spongepowered.asm.mixin.Mixin;\n import org.spongepowered.asm.mixin.Shadow;\n+import org.spongepowered.asm.mixin.injection.At;\n+import org.spongepowered.asm.mixin.injection.Inject;\n+import org.spongepowered.asm.mixin.injection.callback.CallbackInfo;\n+import org.spongepowered.common.SpongeImplHooks;\n \n @Mixin(ScoreCriteria.RenderType.class)\n public abstract class ScoreCriteria_RenderTypeMixin_API implements ObjectiveDisplayMode {\n+    @Inject(method = \"<init>\", at = @At(\"TAIL\"))\n+    private void api$setKey(CallbackInfo ci) {\n+        api$key = SpongeImplHooks.getActiveModContainer().createCatalogKey(this.shadow$getId());", "originalCommit": "792b19bc5b1919cf4ea603c6f8e08338787dd91b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTIyODc3NQ==", "url": "https://github.com/SpongePowered/Sponge/pull/2558#discussion_r405228775", "bodyText": "Whereas you are correct (and is the case for names on both sides of the field)...don't leave comments in the code for these. Just adds noise.", "author": "Zidane", "createdAt": "2020-04-08T02:53:08Z", "path": "src/mixins/java/org/spongepowered/common/mixin/api/mcp/tileentity/CommandBlockTileEntityMixin_API.java", "diffHunk": "@@ -59,8 +59,8 @@ public DataContainer toContainer() {\n         container.set(Constants.TileEntity.CommandBlock.STORED_COMMAND, this.getCommandBlockLogic().getCommand());\n         container.set(Constants.TileEntity.CommandBlock.SUCCESS_COUNT, this.getCommandBlockLogic().getSuccessCount());\n         container.set(Constants.TileEntity.CUSTOM_NAME, this.getCommandBlockLogic().getName());\n-        container.set(Constants.TileEntity.CommandBlock.DOES_TRACK_OUTPUT, this.getCommandBlockLogic().shouldTrackOutput());\n-        if (this.getCommandBlockLogic().shouldTrackOutput()) {\n+        container.set(Constants.TileEntity.CommandBlock.DOES_TRACK_OUTPUT, this.getCommandBlockLogic().shouldReceiveErrors()); // bad MCP name for shouldTrackOutput", "originalCommit": "792b19bc5b1919cf4ea603c6f8e08338787dd91b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTIyODkxNw==", "url": "https://github.com/SpongePowered/Sponge/pull/2558#discussion_r405228917", "bodyText": "Same as above. Leave the comments out for these.", "author": "Zidane", "createdAt": "2020-04-08T02:53:41Z", "path": "src/mixins/java/org/spongepowered/common/mixin/api/mcp/world/raid/Raid_StatusMixin_API.java", "diffHunk": "@@ -42,7 +42,7 @@\n         api$key = SpongeImplHooks.getActiveModContainer().createCatalogKey(this.shadow$func_221277_a());\n     }\n \n-    @Shadow public abstract String shadow$func_221277_a();\n+    @Shadow public abstract String shadow$func_221277_a(); // MCP 1.15.2: getName", "originalCommit": "792b19bc5b1919cf4ea603c6f8e08338787dd91b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "cf3e25d1b0710ba567665b10a374fd70e23f3725", "url": "https://github.com/SpongePowered/Sponge/commit/cf3e25d1b0710ba567665b10a374fd70e23f3725", "message": "Fix style for reviews", "committedDate": "2020-04-08T03:06:51Z", "type": "commit"}, {"oid": "1a4242a42677580ea024a7eda4514202fd7a47bb", "url": "https://github.com/SpongePowered/Sponge/commit/1a4242a42677580ea024a7eda4514202fd7a47bb", "message": "Correct the implementation of Player.setLocation\n\nUser.setLocation() is not supposed to load worlds.", "committedDate": "2020-04-08T03:19:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODU0ODg1Ng==", "url": "https://github.com/SpongePowered/Sponge/pull/2558#discussion_r408548856", "bodyText": "this.", "author": "Zidane", "createdAt": "2020-04-15T02:45:28Z", "path": "src/mixins/java/org/spongepowered/common/mixin/api/mcp/util/SoundCategoryMixin_API.java", "diffHunk": "@@ -25,30 +25,28 @@\n package org.spongepowered.common.mixin.api.mcp.util;\n \n import net.minecraft.util.SoundCategory;\n-import org.spongepowered.asm.mixin.Implements;\n-import org.spongepowered.asm.mixin.Interface;\n-import org.spongepowered.asm.mixin.Intrinsic;\n+import org.spongepowered.api.CatalogKey;\n import org.spongepowered.asm.mixin.Mixin;\n import org.spongepowered.asm.mixin.Shadow;\n+import org.spongepowered.asm.mixin.injection.At;\n+import org.spongepowered.asm.mixin.injection.Inject;\n+import org.spongepowered.asm.mixin.injection.callback.CallbackInfo;\n+import org.spongepowered.common.SpongeImplHooks;\n \n @Mixin(SoundCategory.class)\n-@Implements(@Interface(iface = org.spongepowered.api.effect.sound.SoundCategory.class, prefix = \"category$\"))\n public abstract class SoundCategoryMixin_API implements org.spongepowered.api.effect.sound.SoundCategory {\n \n+    @Inject(method = \"<init>\", at = @At(\"TAIL\"))\n+    private void api$setKey(CallbackInfo ci) {\n+        api$key = SpongeImplHooks.getActiveModContainer().createCatalogKey(this.shadow$getName());\n+    }\n+\n     @Shadow public abstract String shadow$getName();\n \n-    private String id;\n+    private CatalogKey api$key;\n \n     @Override\n-    public String getId() {\n-        if (this.id == null) {\n-            this.id = \"minecraft:\" + this.shadow$getName();\n-        }\n-        return this.id;\n-    }\n-\n-    @Intrinsic\n-    public String category$getName() {\n-        return this.shadow$getName();\n+    public CatalogKey getKey() {\n+        return api$key;", "originalCommit": "1a4242a42677580ea024a7eda4514202fd7a47bb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODU0ODkwNw==", "url": "https://github.com/SpongePowered/Sponge/pull/2558#discussion_r408548907", "bodyText": "this.", "author": "Zidane", "createdAt": "2020-04-15T02:45:39Z", "path": "src/mixins/java/org/spongepowered/common/mixin/api/mcp/scoreboard/ScoreCriteria_RenderTypeMixin_API.java", "diffHunk": "@@ -25,24 +25,28 @@\n package org.spongepowered.common.mixin.api.mcp.scoreboard;\n \n import net.minecraft.scoreboard.ScoreCriteria;\n+import org.spongepowered.api.CatalogKey;\n import org.spongepowered.api.scoreboard.objective.displaymode.ObjectiveDisplayMode;\n-import org.spongepowered.asm.mixin.Final;\n import org.spongepowered.asm.mixin.Mixin;\n import org.spongepowered.asm.mixin.Shadow;\n+import org.spongepowered.asm.mixin.injection.At;\n+import org.spongepowered.asm.mixin.injection.Inject;\n+import org.spongepowered.asm.mixin.injection.callback.CallbackInfo;\n+import org.spongepowered.common.SpongeImplHooks;\n \n @Mixin(ScoreCriteria.RenderType.class)\n public abstract class ScoreCriteria_RenderTypeMixin_API implements ObjectiveDisplayMode {\n+    @Inject(method = \"<init>\", at = @At(\"TAIL\"))\n+    private void api$setKey(CallbackInfo ci) {\n+        this.api$key = SpongeImplHooks.getActiveModContainer().createCatalogKey(this.shadow$getId());\n+    }\n \n-    @Shadow @Final private String renderType;\n+    @Shadow public abstract String shadow$getId();\n \n-    @Override\n-    public String getId() {\n-        return this.renderType;\n-    }\n+    private CatalogKey api$key;\n \n     @Override\n-    public String getName() {\n-        return this.renderType;\n+    public CatalogKey getKey() {\n+        return api$key;", "originalCommit": "1a4242a42677580ea024a7eda4514202fd7a47bb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODU0OTAyMg==", "url": "https://github.com/SpongePowered/Sponge/pull/2558#discussion_r408549022", "bodyText": "Only final change is to not throw an exception here. Simply return false. Shouldn't bring the server down.", "author": "Zidane", "createdAt": "2020-04-15T02:46:05Z", "path": "src/mixins/java/org/spongepowered/common/mixin/api/mcp/entity/player/ServerPlayerEntityMixin_API.java", "diffHunk": "@@ -447,9 +448,9 @@ public void remove() {\n \n     @Override\n     public boolean setLocation(final Vector3d position, final UUID world) {\n-        final WorldProperties prop = Sponge.getServer().getWorldManager().getProperties(world).orElseThrow(() -> new IllegalArgumentException(\"Invalid World: No world found for UUID\"));\n-        final World loaded = Sponge.getServer().getWorldManager().loadWorld(prop).orElseThrow(() -> new IllegalArgumentException(\"Invalid World: Could not load world for UUID\"));\n-        return this.setLocation(Location.of(loaded, position));\n+        final World targetWorld = Sponge.getServer().getWorldManager().getWorld(world).orElseThrow(() -> new IllegalArgumentException(\"Invalid World: No loaded world found for UUID\"));", "originalCommit": "1a4242a42677580ea024a7eda4514202fd7a47bb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODU0OTYyNA==", "url": "https://github.com/SpongePowered/Sponge/pull/2558#discussion_r408549624", "bodyText": "Sorry, nope. If you're adding injections, belongs in a specific mixin in core. It does clutter some things up because it basically means calling the getKey() will call a bridge method to the mixin that adds the field.\nBUT because all you're doing is initializing the field, you can just call the methods to initialize the field, without an injection point.", "author": "gabizou", "createdAt": "2020-04-15T02:48:30Z", "path": "src/mixins/java/org/spongepowered/common/mixin/api/mcp/scoreboard/ScoreCriteria_RenderTypeMixin_API.java", "diffHunk": "@@ -25,24 +25,28 @@\n package org.spongepowered.common.mixin.api.mcp.scoreboard;\n \n import net.minecraft.scoreboard.ScoreCriteria;\n+import org.spongepowered.api.CatalogKey;\n import org.spongepowered.api.scoreboard.objective.displaymode.ObjectiveDisplayMode;\n-import org.spongepowered.asm.mixin.Final;\n import org.spongepowered.asm.mixin.Mixin;\n import org.spongepowered.asm.mixin.Shadow;\n+import org.spongepowered.asm.mixin.injection.At;\n+import org.spongepowered.asm.mixin.injection.Inject;\n+import org.spongepowered.asm.mixin.injection.callback.CallbackInfo;\n+import org.spongepowered.common.SpongeImplHooks;\n \n @Mixin(ScoreCriteria.RenderType.class)\n public abstract class ScoreCriteria_RenderTypeMixin_API implements ObjectiveDisplayMode {\n+    @Inject(method = \"<init>\", at = @At(\"TAIL\"))\n+    private void api$setKey(CallbackInfo ci) {\n+        this.api$key = SpongeImplHooks.getActiveModContainer().createCatalogKey(this.shadow$getId());\n+    }", "originalCommit": "1a4242a42677580ea024a7eda4514202fd7a47bb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODU1MDAzMg==", "url": "https://github.com/SpongePowered/Sponge/pull/2558#discussion_r408550032", "bodyText": "Same with this.", "author": "gabizou", "createdAt": "2020-04-15T02:49:53Z", "path": "src/mixins/java/org/spongepowered/common/mixin/api/mcp/util/SoundCategoryMixin_API.java", "diffHunk": "@@ -25,30 +25,28 @@\n package org.spongepowered.common.mixin.api.mcp.util;\n \n import net.minecraft.util.SoundCategory;\n-import org.spongepowered.asm.mixin.Implements;\n-import org.spongepowered.asm.mixin.Interface;\n-import org.spongepowered.asm.mixin.Intrinsic;\n+import org.spongepowered.api.CatalogKey;\n import org.spongepowered.asm.mixin.Mixin;\n import org.spongepowered.asm.mixin.Shadow;\n+import org.spongepowered.asm.mixin.injection.At;\n+import org.spongepowered.asm.mixin.injection.Inject;\n+import org.spongepowered.asm.mixin.injection.callback.CallbackInfo;\n+import org.spongepowered.common.SpongeImplHooks;\n \n @Mixin(SoundCategory.class)\n-@Implements(@Interface(iface = org.spongepowered.api.effect.sound.SoundCategory.class, prefix = \"category$\"))\n public abstract class SoundCategoryMixin_API implements org.spongepowered.api.effect.sound.SoundCategory {\n \n+    @Inject(method = \"<init>\", at = @At(\"TAIL\"))\n+    private void api$setKey(CallbackInfo ci) {\n+        api$key = SpongeImplHooks.getActiveModContainer().createCatalogKey(this.shadow$getName());", "originalCommit": "1a4242a42677580ea024a7eda4514202fd7a47bb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "2595f77cd00679a140ea1832f91d937b397615dc", "url": "https://github.com/SpongePowered/Sponge/commit/2595f77cd00679a140ea1832f91d937b397615dc", "message": "Zidane reviews", "committedDate": "2020-04-15T02:54:25Z", "type": "commit"}, {"oid": "5e14b21bf09db72e4f99eb679f14987bac14cbcc", "url": "https://github.com/SpongePowered/Sponge/commit/5e14b21bf09db72e4f99eb679f14987bac14cbcc", "message": "Gabizou reviews", "committedDate": "2020-04-15T03:00:24Z", "type": "commit"}, {"oid": "e6ef24ef7bf3dfc041bec0aa8b3123be92e6673a", "url": "https://github.com/SpongePowered/Sponge/commit/e6ef24ef7bf3dfc041bec0aa8b3123be92e6673a", "message": "Zidane reviews, pt 2.", "committedDate": "2020-04-15T03:05:02Z", "type": "commit"}]}