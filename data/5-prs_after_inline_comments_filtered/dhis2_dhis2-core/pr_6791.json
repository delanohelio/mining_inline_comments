{"pr_number": 6791, "pr_title": "fix: trap all validation analytics errors", "pr_createdAt": "2020-11-30T17:55:12Z", "pr_url": "https://github.com/dhis2/dhis2-core/pull/6791", "timeline": [{"oid": "439b6a2c62300155c61f544b2d678c0056360a8c", "url": "https://github.com/dhis2/dhis2-core/commit/439b6a2c62300155c61f544b2d678c0056360a8c", "message": "fix: trap all analytics errors", "committedDate": "2020-11-30T17:54:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzM2ODg5Ng==", "url": "https://github.com/dhis2/dhis2-core/pull/6791#discussion_r533368896", "bodyText": "Could this hide real exceptions? Do we want to return the validation result if exceptions happened and we might get a partial result?", "author": "larshelge", "createdAt": "2020-12-01T12:23:57Z", "path": "dhis-2/dhis-services/dhis-service-reporting/src/main/java/org/hisp/dhis/validation/DataValidationTask.java", "diffHunk": "@@ -673,10 +673,16 @@ else if ( existingPeriodInterval > periodInterval )\n         {\n             grid = analyticsService.getAggregatedDataValues( params );\n         }\n-        catch ( PersistenceException ex )\n+        catch ( PersistenceException ex ) // No data\n         {\n             return map;\n         }\n+        catch ( RuntimeException ex ) // Other error\n+        {\n+            log.error( DebugUtils.getStackTrace( ex ) );\n+\n+            return map;", "originalCommit": "439b6a2c62300155c61f544b2d678c0056360a8c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzQ4ODU0Mw==", "url": "https://github.com/dhis2/dhis2-core/pull/6791#discussion_r533488543", "bodyText": "Good questions. Without this fix, any real exceptions are not caught here, and the entire validation run aborts. The exceptions are caught at a higher level and logged in the backend, and no validation results at all are returned, as if all validation rules succeeded. For example, run data quality on SL Demo and select all rules. You will never see any results because some rules hit errors in analytics.\nWith this fix, any real exceptions are caught here and logged in the backend (so the logging part is the same as without the fix). However no analytics results are returned into the validation formula computation, which proceeds based on datavalue table values (if any), and also proceeds to evaluate any other validation rules which may find valid results based on datavalue and/or analytics data. For example run data quality on SL Demo and select all rules. You will get results.", "author": "jimgrace", "createdAt": "2020-12-01T15:12:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzM2ODg5Ng=="}], "type": "inlineReview"}]}