{"pr_number": 5758, "pr_title": " fix: Use name instead of UID for pivot column download [DHIS2-9026]", "pr_createdAt": "2020-06-17T15:19:55Z", "pr_url": "https://github.com/dhis2/dhis2-core/pull/5758", "timeline": [{"oid": "e90a7f64425ecce86026b8acac9057a2e32e0780", "url": "https://github.com/dhis2/dhis2-core/commit/e90a7f64425ecce86026b8acac9057a2e32e0780", "message": "fix: Adding fix and tests for this issue [DHIS2-9026]\n\nCreating a simple object to map raw dimenions and its related type so it can be used in later stage when setting the report headers during the export.", "committedDate": "2020-06-17T14:47:55Z", "type": "commit"}, {"oid": "d6b68ed85cde6f60dc4b4b5a0dfcff837406cea5", "url": "https://github.com/dhis2/dhis2-core/commit/d6b68ed85cde6f60dc4b4b5a0dfcff837406cea5", "message": "fix: Merging conflicts from master [DHIS2-9026]", "committedDate": "2020-06-17T14:54:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjAyODcwNw==", "url": "https://github.com/dhis2/dhis2-core/pull/5758#discussion_r442028707", "bodyText": "Maybe rename to addDimensionDescriptor to make it similar to other naming in the system.", "author": "larshelge", "createdAt": "2020-06-18T07:40:01Z", "path": "dhis-2/dhis-api/src/main/java/org/hisp/dhis/visualization/Visualization.java", "diffHunk": "@@ -1025,6 +1028,30 @@ public void setYearlySeries( List<String> yearlySeries )\n         this.yearlySeries = yearlySeries;\n     }\n \n+    /**\n+     * Returns the list of DimensionDescriptor held internaly to the current Visualization object.\n+     * See {@link #holdDimensionDescriptor}.\n+     *\n+     * @return the list of DimensionDescriptor's held.\n+     */\n+    public List<DimensionDescriptor> getDimensionDescriptors()\n+    {\n+        return dimensionDescriptors;\n+    }\n+\n+    /**\n+     * This method will hold the mapping of a dimension and its respective formal\n+     * type.\n+     *\n+     * @param dimension: the dimension, which should also be found in\n+     *        \"{@link #columnDimensions}\" and \"{@link #rowDimensions}\".\n+     * @param dimensionType: the formal dimension type. See {@link DimensionType}\n+     */\n+    public void holdDimensionDescriptor( final String dimension, final DimensionType dimensionType )", "originalCommit": "d6b68ed85cde6f60dc4b4b5a0dfcff837406cea5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjE0NDAyNQ==", "url": "https://github.com/dhis2/dhis2-core/pull/5758#discussion_r442144025", "bodyText": "Done", "author": "maikelarabori", "createdAt": "2020-06-18T11:00:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjAyODcwNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjAyOTQ4MA==", "url": "https://github.com/dhis2/dhis2-core/pull/5758#discussion_r442029480", "bodyText": "Remove \"0\" here.", "author": "larshelge", "createdAt": "2020-06-18T07:41:22Z", "path": "dhis-2/dhis-api/src/main/java/org/hisp/dhis/visualization/Visualization.java", "diffHunk": "@@ -342,6 +343,8 @@\n \n     private transient List<List<DimensionalItemObject>> gridRows = new ArrayList<>();\n \n+    private transient List<DimensionDescriptor> dimensionDescriptors = new ArrayList<>( 0 );", "originalCommit": "d6b68ed85cde6f60dc4b4b5a0dfcff837406cea5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjE0NDA2NA==", "url": "https://github.com/dhis2/dhis2-core/pull/5758#discussion_r442144064", "bodyText": "Done", "author": "maikelarabori", "createdAt": "2020-06-18T11:00:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjAyOTQ4MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjAzMDE0Mg==", "url": "https://github.com/dhis2/dhis2-core/pull/5758#discussion_r442030142", "bodyText": "Do you think you could add a description about what is going here in the PR and in Javadoc?", "author": "larshelge", "createdAt": "2020-06-18T07:42:35Z", "path": "dhis-2/dhis-api/src/main/java/org/hisp/dhis/visualization/DimensionDescriptor.java", "diffHunk": "@@ -0,0 +1,105 @@\n+package org.hisp.dhis.visualization;\n+\n+/*\n+ * Copyright (c) 2004-2020, University of Oslo\n+ * All rights reserved.\n+ *\n+ * Redistribution and use in source and binary forms, with or without\n+ * modification, are permitted provided that the following conditions are met:\n+ * Redistributions of source code must retain the above copyright notice, this\n+ * list of conditions and the following disclaimer.\n+ *\n+ * Redistributions in binary form must reproduce the above copyright notice,\n+ * this list of conditions and the following disclaimer in the documentation\n+ * and/or other materials provided with the distribution.\n+ * Neither the name of the HISP project nor the names of its contributors may\n+ * be used to endorse or promote products derived from this software without\n+ * specific prior written permission.\n+ *\n+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\n+ * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n+ * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n+ * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR\n+ * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n+ * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n+ * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON\n+ * ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\n+ * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n+ */\n+\n+import static org.apache.commons.collections4.CollectionUtils.isNotEmpty;\n+import static org.apache.commons.lang3.StringUtils.EMPTY;\n+import static org.apache.commons.lang3.StringUtils.defaultIfEmpty;\n+import static org.apache.commons.lang3.StringUtils.equalsIgnoreCase;\n+import static org.apache.commons.lang3.StringUtils.trimToEmpty;\n+import static org.hisp.dhis.common.DimensionalObject.ATTRIBUTEOPTIONCOMBO_DIM_ID;\n+import static org.hisp.dhis.common.DimensionalObject.CATEGORYOPTIONCOMBO_DIM_ID;\n+import static org.hisp.dhis.common.DimensionalObject.DATA_X_DIM_ID;\n+import static org.hisp.dhis.common.DimensionalObject.ORGUNIT_DIM_ID;\n+import static org.hisp.dhis.common.DimensionalObject.PERIOD_DIM_ID;\n+\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.hisp.dhis.common.DimensionType;\n+\n+import lombok.AllArgsConstructor;\n+import lombok.Getter;\n+import lombok.Setter;\n+\n+@Getter\n+@Setter\n+@AllArgsConstructor\n+public class DimensionDescriptor\n+{\n+    private String value;\n+\n+    private DimensionType type;\n+\n+    public boolean hasAbbreviation( final String abbreviation )\n+    {\n+        return trimToEmpty( abbreviation ).equalsIgnoreCase( trimToEmpty( getValue() ) );\n+    }\n+\n+    public static String retrieveDescriptiveValue( final List<DimensionDescriptor> dimensionDescriptors,\n+        final String valueToRetrieve, final Map<String, String> metaData )\n+    {\n+        String descriptiveValue = EMPTY;\n+\n+        if ( isNotEmpty( dimensionDescriptors ) )\n+        {\n+            for ( final DimensionDescriptor dimensionDescriptor : dimensionDescriptors )\n+            {\n+                if ( dimensionDescriptor.hasAbbreviation( valueToRetrieve ) )\n+                {\n+                    return !equalsIgnoreCase( dimensionDescriptor.getDescriptiveValue(), EMPTY )\n+                        ? dimensionDescriptor.getDescriptiveValue()\n+                        : defaultIfEmpty( metaData.get( valueToRetrieve ), valueToRetrieve );\n+                }\n+            }\n+        }\n+\n+        return descriptiveValue;\n+    }\n+\n+    private String getDescriptiveValue()", "originalCommit": "d6b68ed85cde6f60dc4b4b5a0dfcff837406cea5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjE0NDEyMQ==", "url": "https://github.com/dhis2/dhis2-core/pull/5758#discussion_r442144121", "bodyText": "Done", "author": "maikelarabori", "createdAt": "2020-06-18T11:00:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjAzMDE0Mg=="}], "type": "inlineReview"}, {"oid": "70f993e6d854c5323a6570422d105bbdd257305c", "url": "https://github.com/dhis2/dhis2-core/commit/70f993e6d854c5323a6570422d105bbdd257305c", "message": "Merge branch 'master' of https://github.com/dhis2/dhis2-core into DHIS2-9026", "committedDate": "2020-06-18T10:35:05Z", "type": "commit"}, {"oid": "fe4ab2e49f521265d5c453d2ce4f49e3071604df", "url": "https://github.com/dhis2/dhis2-core/commit/fe4ab2e49f521265d5c453d2ce4f49e3071604df", "message": "fix: Clean-up the code and addressing code review comments [DHIS2-9026]", "committedDate": "2020-06-18T11:23:55Z", "type": "commit"}, {"oid": "e125fb9efceefd4c20b7eb2148951b191e4722c5", "url": "https://github.com/dhis2/dhis2-core/commit/e125fb9efceefd4c20b7eb2148951b191e4722c5", "message": "Merge branch 'master' of https://github.com/dhis2/dhis2-core into DHIS2-9026", "committedDate": "2020-07-07T11:24:09Z", "type": "commit"}, {"oid": "5132ab915fec78944073ba21edcd71d66cbd6ac2", "url": "https://github.com/dhis2/dhis2-core/commit/5132ab915fec78944073ba21edcd71d66cbd6ac2", "message": "Merge branch 'master' of https://github.com/dhis2/dhis2-core into DHIS2-9026", "committedDate": "2020-07-16T08:33:43Z", "type": "commit"}, {"oid": "ea4d2d8fb1c22d3fb9b17f17774f3c7760dcefe2", "url": "https://github.com/dhis2/dhis2-core/commit/ea4d2d8fb1c22d3fb9b17f17774f3c7760dcefe2", "message": "chore: Merging master", "committedDate": "2020-08-31T14:40:31Z", "type": "commit"}, {"oid": "5d762e6bac91e4d87b78c2d52e4f24c35cda42a3", "url": "https://github.com/dhis2/dhis2-core/commit/5d762e6bac91e4d87b78c2d52e4f24c35cda42a3", "message": "Merge branch 'master' of https://github.com/dhis2/dhis2-core into DHIS2-9026", "committedDate": "2020-09-01T12:01:55Z", "type": "commit"}, {"oid": "768d5ae4a65f6f6da81a9ffd637ee7a6f9cc8deb", "url": "https://github.com/dhis2/dhis2-core/commit/768d5ae4a65f6f6da81a9ffd637ee7a6f9cc8deb", "message": "Merge branch 'master' of https://github.com/dhis2/dhis2-core into DHIS2-9026", "committedDate": "2020-09-01T14:40:54Z", "type": "commit"}, {"oid": "8b4db91e67faca24bc24b41a5dde2e5d9d1cefd7", "url": "https://github.com/dhis2/dhis2-core/commit/8b4db91e67faca24bc24b41a5dde2e5d9d1cefd7", "message": "Merge branch 'master' of https://github.com/dhis2/dhis2-core into DHIS2-9026", "committedDate": "2020-09-02T07:51:05Z", "type": "commit"}, {"oid": "f0706b00c65775f724810de512badccb6c8956b5", "url": "https://github.com/dhis2/dhis2-core/commit/f0706b00c65775f724810de512badccb6c8956b5", "message": "chore: Fixing code formatting", "committedDate": "2020-09-02T15:14:45Z", "type": "commit"}, {"oid": "d2da38e97b864dda6c20cb09cf6c98a7005a2472", "url": "https://github.com/dhis2/dhis2-core/commit/d2da38e97b864dda6c20cb09cf6c98a7005a2472", "message": "Merge branch 'master' of https://github.com/dhis2/dhis2-core into DHIS2-9026", "committedDate": "2020-09-03T07:10:23Z", "type": "commit"}]}