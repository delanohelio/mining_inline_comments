{"pr_number": 4734, "pr_title": "fix: Allow \"unresolved\" Indicators to survive validation", "pr_createdAt": "2020-01-20T11:45:16Z", "pr_url": "https://github.com/dhis2/dhis2-core/pull/4734", "timeline": [{"oid": "58a9b656525a615f1f61dbc8051c2f394a826e72", "url": "https://github.com/dhis2/dhis2-core/commit/58a9b656525a615f1f61dbc8051c2f394a826e72", "message": "fix: better test documentation", "committedDate": "2020-01-21T11:56:16Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQ4OTUwNw==", "url": "https://github.com/dhis2/dhis2-core/pull/4734#discussion_r369489507", "bodyText": "This check is sort of pointless, in the sense that if there are no indicators in the query, we should not get here at all (i.e. break before the call to expression service), and if we get here, there should be indicators present, and then this check would always fail and hence could be removed (indicators would never be empty).", "author": "larshelge", "createdAt": "2020-01-22T10:48:47Z", "path": "dhis-2/dhis-services/dhis-service-analytics/src/main/java/org/hisp/dhis/analytics/data/DefaultAnalyticsService.java", "diffHunk": "@@ -1345,7 +1345,7 @@ private void addRawData( DataQueryParams params, Grid grid )\n         List<DimensionalItemObject> items = Lists\n                 .newArrayList( expressionService.getIndicatorDimensionalItemObjects( preprocessIndicators( indicators ) ) );\n \n-        if ( items.isEmpty() )\n+        if ( items.isEmpty() && params.getIndicators().isEmpty() )", "originalCommit": "58a9b656525a615f1f61dbc8051c2f394a826e72", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQ5OTMzNQ==", "url": "https://github.com/dhis2/dhis2-core/pull/4734#discussion_r369499335", "bodyText": "The logic behind that check is the following: When we call the expressionService with indicators that contain ONLY static values (constants or numbers), the expression service will return 0 items, because it is not able to resolve the num/den of the indicator. So the condition items.isEmpty() is going to be true and we will exit and return no values.\nSo, doing this params.getIndicators().isEmpty() allows the system to proceed and calculate the static values.", "author": "luciano-fiandesio", "createdAt": "2020-01-22T11:11:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQ4OTUwNw=="}], "type": "inlineReview"}, {"oid": "6ee1d2f1b21852302f2ea5fd137edbb5978b1767", "url": "https://github.com/dhis2/dhis2-core/commit/6ee1d2f1b21852302f2ea5fd137edbb5978b1767", "message": "fix: analytics: retain unresolved Indicators\n\n- DHIS2-7862\n- If an analytics query contains Indicators which contain constants or\n  static values (e.g. 100, 1), do not exit early and continue processing\nthe indicator expressions.", "committedDate": "2020-01-23T11:42:21Z", "type": "commit"}, {"oid": "6ee1d2f1b21852302f2ea5fd137edbb5978b1767", "url": "https://github.com/dhis2/dhis2-core/commit/6ee1d2f1b21852302f2ea5fd137edbb5978b1767", "message": "fix: analytics: retain unresolved Indicators\n\n- DHIS2-7862\n- If an analytics query contains Indicators which contain constants or\n  static values (e.g. 100, 1), do not exit early and continue processing\nthe indicator expressions.", "committedDate": "2020-01-23T11:42:21Z", "type": "forcePushed"}]}