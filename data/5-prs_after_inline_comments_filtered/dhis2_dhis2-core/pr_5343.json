{"pr_number": 5343, "pr_title": "fix: Replace general error message with more specific one", "pr_createdAt": "2020-04-09T08:51:04Z", "pr_url": "https://github.com/dhis2/dhis2-core/pull/5343", "timeline": [{"oid": "05923977c7a3bdc344b5980f71fbc23d397b5f17", "url": "https://github.com/dhis2/dhis2-core/commit/05923977c7a3bdc344b5980f71fbc23d397b5f17", "message": "fix: remove general error message with more specific one", "committedDate": "2020-04-09T08:50:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ1ODkzOQ==", "url": "https://github.com/dhis2/dhis2-core/pull/5343#discussion_r408458939", "bodyText": "Start with uppercase \"O\".", "author": "larshelge", "createdAt": "2020-04-14T21:54:01Z", "path": "dhis-2/dhis-web/dhis-web-api/src/main/java/org/hisp/dhis/webapi/controller/sms/SmsController.java", "diffHunk": "@@ -243,14 +252,23 @@ private User getUserByPhoneNumber( String phoneNumber, String text ) throws WebM\n \n         List<User> users = userService.getUsersByPhoneNumber( phoneNumber );\n \n-        if ( users == null || users.isEmpty() )\n+        User currentUser = currentUserService.getCurrentUser();\n+\n+        if ( currentUser != null && !phoneNumber.equals( currentUser.getPhoneNumber() ) )\n         {\n-            if ( unregisteredParser != null )\n+            if ( users == null || users.isEmpty() )\n             {\n-                return null;\n+                if ( unregisteredParser != null )\n+                {\n+                    return null;\n+                }\n+\n+                // No user belong to this phone number\n+                throw new WebMessageException( WebMessageUtils.conflict( \"User's phone number is not registered in the system\" ) );\n             }\n \n-            throw new WebMessageException( WebMessageUtils.conflict( \"User not registered in the system\" ) );\n+            // current user does not belong to this number\n+            throw new WebMessageException( WebMessageUtils.conflict( \"originator's number does not match user's phone number\" ) );", "originalCommit": "05923977c7a3bdc344b5980f71fbc23d397b5f17", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTU3ODQyNA==", "url": "https://github.com/dhis2/dhis2-core/pull/5343#discussion_r409578424", "bodyText": "We can also say \"Phone number\" to make it clearer.", "author": "larshelge", "createdAt": "2020-04-16T13:59:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ1ODkzOQ=="}], "type": "inlineReview"}, {"oid": "cab23b59409125b1f80b9508bc546aff7b36b31f", "url": "https://github.com/dhis2/dhis2-core/commit/cab23b59409125b1f80b9508bc546aff7b36b31f", "message": "Merge branch 'master' into DHIS2-8610", "committedDate": "2020-04-16T16:52:44Z", "type": "commit"}, {"oid": "a9038da7775c38588703173d3047e25937dcab2b", "url": "https://github.com/dhis2/dhis2-core/commit/a9038da7775c38588703173d3047e25937dcab2b", "message": "Change exception message to use uppercase", "committedDate": "2020-04-16T16:57:35Z", "type": "commit"}]}