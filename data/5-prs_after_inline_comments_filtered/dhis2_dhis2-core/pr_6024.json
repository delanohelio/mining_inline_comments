{"pr_number": 6024, "pr_title": "fix: Get tei api refactor tests and configs", "pr_createdAt": "2020-08-28T09:28:08Z", "pr_url": "https://github.com/dhis2/dhis2-core/pull/6024", "timeline": [{"oid": "e6b9d9caef932ac8782270ff903661bd7b828428", "url": "https://github.com/dhis2/dhis2-core/commit/e6b9d9caef932ac8782270ff903661bd7b828428", "message": "trying different profile for defaultconfigprovider", "committedDate": "2020-08-28T09:27:24Z", "type": "commit"}, {"oid": "95f6f48fdf1d65e6bd028ea27557b3b035856b4b", "url": "https://github.com/dhis2/dhis2-core/commit/95f6f48fdf1d65e6bd028ea27557b3b035856b4b", "message": "Disable OIDC configuration check if test run", "committedDate": "2020-08-28T10:08:02Z", "type": "commit"}, {"oid": "d7c4b06fa5e6242de9567c3b0a07ed229f2b086d", "url": "https://github.com/dhis2/dhis2-core/commit/d7c4b06fa5e6242de9567c3b0a07ed229f2b086d", "message": "Changed flyway to accept mixed mode to include both non-ts and ts statements within a migration group", "committedDate": "2020-08-28T10:26:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTEzNzExOA==", "url": "https://github.com/dhis2/dhis2-core/pull/6024#discussion_r479137118", "bodyText": "@netroms Do you see any problem with doing this? Should only be in effect during tests.", "author": "ameenhere", "createdAt": "2020-08-28T11:07:19Z", "path": "dhis-2/dhis-services/dhis-service-core/src/main/java/org/hisp/dhis/security/oidc/OidcDisabledCondition.java", "diffHunk": "@@ -41,6 +41,10 @@\n     @Override\n     public boolean matches( ConditionContext context, AnnotatedTypeMetadata metadata )\n     {\n+        if ( isTestRun( context ) )", "originalCommit": "d7c4b06fa5e6242de9567c3b0a07ed229f2b086d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDE1MjIyMw==", "url": "https://github.com/dhis2/dhis2-core/pull/6024#discussion_r480152223", "bodyText": "I'm not quite sure this is necessary, this oidc feature will only affect a very specific code path when doing the oidc authentication.", "author": "netroms", "createdAt": "2020-08-31T14:03:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTEzNzExOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDUwMzI3Nw==", "url": "https://github.com/dhis2/dhis2-core/pull/6024#discussion_r480503277", "bodyText": "One of the integration test file failed to load context because it tries to instantiate \"DefaultDhisConfigurationProvider\" from here, even though \"TestDhisConfigurationProvider\" should have been loaded instead. This was the simplest way to stop spring from loading DefaultDhisConfigurationProvider. So if it does not do any harm, then let it stay here to ensure the test passes always :)", "author": "ameenhere", "createdAt": "2020-09-01T00:38:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTEzNzExOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDgzMTczMg==", "url": "https://github.com/dhis2/dhis2-core/pull/6024#discussion_r480831732", "bodyText": "Ah, I can see that now. Well then it makes a lot of sense :) Thanks Ameen!", "author": "netroms", "createdAt": "2020-09-01T05:28:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTEzNzExOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTEzOTAyMA==", "url": "https://github.com/dhis2/dhis2-core/pull/6024#discussion_r479139020", "bodyText": "@luciano-fiandesio  Group ensures the \"migration group\" is executed in a single transaction. This would be ideal for instance to rollback to a clean state in case of migration failures.\nBut we have introduced certain non-transaction statements in our migrations. We can enable \"Mixed\" mode so that it wraps in transaction on a best effort basis.", "author": "ameenhere", "createdAt": "2020-08-28T11:08:51Z", "path": "dhis-2/dhis-support/dhis-support-db-migration/src/main/java/org/hisp/dhis/db/migration/config/FlywayConfig.java", "diffHunk": "@@ -62,8 +62,9 @@ public Flyway flyway( DhisConfigurationProvider configurationProvider, DataSourc\n             Boolean.parseBoolean( configurationProvider.getProperty( FLYWAY_OUT_OF_ORDER_MIGRATION ) ) );\n         classicConfiguration.setIgnoreMissingMigrations( true );\n         classicConfiguration.setIgnoreFutureMigrations( false );\n-        classicConfiguration.setGroup( false );\n+        classicConfiguration.setGroup( true );", "originalCommit": "d7c4b06fa5e6242de9567c3b0a07ed229f2b086d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "cddb8931fba14ffb166e7867eb3bbbab639b235f", "url": "https://github.com/dhis2/dhis2-core/commit/cddb8931fba14ffb166e7867eb3bbbab639b235f", "message": "Fix enrollment followup tests, to use getBoolean and wasNull instead of getString", "committedDate": "2020-08-28T11:37:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTE4MTc4NA==", "url": "https://github.com/dhis2/dhis2-core/pull/6024#discussion_r479181784", "bodyText": "This returns \"t\" and Boolean.parseBoolean( \"t\" ) is false. Changed it to use resultSet.wasNull() to preserve null", "author": "ameenhere", "createdAt": "2020-08-28T11:45:03Z", "path": "dhis-2/dhis-services/dhis-service-dxf2/src/main/java/org/hisp/dhis/dxf2/events/trackedentity/store/mapper/EnrollmentRowCallbackHandler.java", "diffHunk": "@@ -108,8 +108,8 @@ private Enrollment getEnrollment( ResultSet rs )\n         enrollment.setStatus( EnrollmentStatus.fromStatusString( rs.getString( getColumnName( STATUS ) ) ) );\n         enrollment.setEnrollmentDate( rs.getTimestamp( getColumnName( ENROLLMENTDATE ) ) );\n         enrollment.setIncidentDate( rs.getTimestamp( getColumnName( INCIDENTDATE ) ) );\n-        final String followup = rs.getString( getColumnName( FOLLOWUP ) );", "originalCommit": "cddb8931fba14ffb166e7867eb3bbbab639b235f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTE4MjEzMw==", "url": "https://github.com/dhis2/dhis2-core/pull/6024#discussion_r479182133", "bodyText": "This returns \"t\" and Boolean.parseBoolean( \"t\" ) is false. Changed it to use resultSet.wasNull() to preserve null", "author": "ameenhere", "createdAt": "2020-08-28T11:45:21Z", "path": "dhis-2/dhis-services/dhis-service-dxf2/src/main/java/org/hisp/dhis/dxf2/events/trackedentity/store/mapper/EventRowCallbackHandler.java", "diffHunk": "@@ -67,8 +67,8 @@ private Event getEvent( ResultSet rs )\n         event.setEvent( rs.getString( getColumnName( COLUMNS.UID ) ) );\n         event.setId( rs.getLong( getColumnName( COLUMNS.ID ) ) );\n         event.setTrackedEntityInstance( rs.getString( getColumnName( COLUMNS.TEI_UID ) ) );\n-        final String followup = rs.getString( getColumnName( COLUMNS.ENROLLMENT_FOLLOWUP ) );", "originalCommit": "cddb8931fba14ffb166e7867eb3bbbab639b235f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "69fb30f992f74df38cff2cdadaaa96e205d09c26", "url": "https://github.com/dhis2/dhis2-core/commit/69fb30f992f74df38cff2cdadaaa96e205d09c26", "message": "Force hibernate flush and clear to reload entities saved using jdbctemplate in tests", "committedDate": "2020-08-28T12:53:13Z", "type": "commit"}, {"oid": "f815432b54a6e1ea566993b583bf4deb4bd65971", "url": "https://github.com/dhis2/dhis2-core/commit/f815432b54a6e1ea566993b583bf4deb4bd65971", "message": "LGTM alert fix", "committedDate": "2020-08-28T12:55:26Z", "type": "commit"}]}