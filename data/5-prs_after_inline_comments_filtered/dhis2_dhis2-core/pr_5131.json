{"pr_number": 5131, "pr_title": "fix: Soft delete TEI, Enrollment and events", "pr_createdAt": "2020-03-18T12:43:21Z", "pr_url": "https://github.com/dhis2/dhis2-core/pull/5131", "timeline": [{"oid": "1f063c5e77f51cc5ca17e851df952c60690846be", "url": "https://github.com/dhis2/dhis2-core/commit/1f063c5e77f51cc5ca17e851df952c60690846be", "message": "Add delete TEI and Enrollment tests", "committedDate": "2020-03-18T12:42:01Z", "type": "commit"}, {"oid": "9e749289a997bb717825b1daca51e78c40c70fab", "url": "https://github.com/dhis2/dhis2-core/commit/9e749289a997bb717825b1daca51e78c40c70fab", "message": "Implement soft delete store", "committedDate": "2020-03-20T13:35:29Z", "type": "commit"}, {"oid": "a15eaae1a9840468822d26585d3908b2ffc14f2d", "url": "https://github.com/dhis2/dhis2-core/commit/a15eaae1a9840468822d26585d3908b2ffc14f2d", "message": "Fix tests", "committedDate": "2020-03-20T13:43:03Z", "type": "commit"}, {"oid": "1acc3a5d983441a8d5a45ae812f4f89970ac3c5a", "url": "https://github.com/dhis2/dhis2-core/commit/1acc3a5d983441a8d5a45ae812f4f89970ac3c5a", "message": "Fix sonar code smells", "committedDate": "2020-03-20T14:20:30Z", "type": "commit"}, {"oid": "920e0e29c572d4968d571f790fa614765f20409b", "url": "https://github.com/dhis2/dhis2-core/commit/920e0e29c572d4968d571f790fa614765f20409b", "message": "Fix tests", "committedDate": "2020-03-23T09:45:53Z", "type": "commit"}, {"oid": "aad7dfb28e0046f77f108f11440917ee1eb86129", "url": "https://github.com/dhis2/dhis2-core/commit/aad7dfb28e0046f77f108f11440917ee1eb86129", "message": "Merge remote-tracking branch 'origin/master' into DHIS2-7415", "committedDate": "2020-03-23T10:05:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzY5MjY3Ng==", "url": "https://github.com/dhis2/dhis2-core/pull/5131#discussion_r397692676", "bodyText": "Remove commented out code.", "author": "larshelge", "createdAt": "2020-03-25T08:54:44Z", "path": "dhis-2/dhis-services/dhis-service-core/src/test/java/org/hisp/dhis/trackedentity/TrackedEntityInstanceServiceTest.java", "diffHunk": "@@ -109,6 +169,35 @@ public void testDeleteTrackedEntityInstance()\n         assertNull( entityInstanceService.getTrackedEntityInstance( teiB.getUid() ) );\r\n     }\r\n \r\n+    @Test\r\n+    public void testDeleteTrackedEntityInstanceAndLinkedEnrollmentsAndEvents()\r\n+    {\r\n+        long idA = entityInstanceService.addTrackedEntityInstance( entityInstanceA1 );\r\n+        long psIdA = programInstanceService.addProgramInstance( programInstanceA );\r\n+        long psiIdA = programStageInstanceService.addProgramStageInstance( programStageInstanceA );\r\n+//        programInstanceA.setId( idA );\r", "originalCommit": "aad7dfb28e0046f77f108f11440917ee1eb86129", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "abae66ebf296c5e77d17e72fee178cd8234c4d09", "url": "https://github.com/dhis2/dhis2-core/commit/abae66ebf296c5e77d17e72fee178cd8234c4d09", "message": "Code review fixes", "committedDate": "2020-03-26T10:03:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDA5NjIzOA==", "url": "https://github.com/dhis2/dhis2-core/pull/5131#discussion_r400096238", "bodyText": "Are you sure there are no side effects of removing setting the status to CANCELLED ? Maybe you can set it before you send it onwards to the deletion store?", "author": "mortenoh", "createdAt": "2020-03-30T10:46:39Z", "path": "dhis-2/dhis-services/dhis-service-core/src/main/java/org/hisp/dhis/program/DefaultProgramInstanceService.java", "diffHunk": "@@ -112,23 +112,7 @@ public long addProgramInstance( ProgramInstance programInstance )\n     @Transactional\r\n     public void deleteProgramInstance( ProgramInstance programInstance )\r\n     {\r\n-        deleteProgramInstance( programInstance, false );\r\n-    }\r\n-\r\n-    @Override\r\n-    @Transactional\r\n-    public void deleteProgramInstance( ProgramInstance programInstance, boolean forceDelete )\r\n-    {\r\n-        if ( forceDelete )\r\n-        {\r\n-            programInstanceStore.delete( programInstance );\r\n-        }\r\n-        else\r\n-        {\r\n-            programInstance.setDeleted( true );\r\n-            programInstance.setStatus( ProgramStatus.CANCELLED );\r\n-            programInstanceStore.update( programInstance );\r\n-        }\r\n+        programInstanceStore.delete( programInstance );\r", "originalCommit": "abae66ebf296c5e77d17e72fee178cd8234c4d09", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "27a89af420dd17e9fd8003027dc1f02ebcd21844", "url": "https://github.com/dhis2/dhis2-core/commit/27a89af420dd17e9fd8003027dc1f02ebcd21844", "message": "Code review fixes", "committedDate": "2020-03-30T12:36:30Z", "type": "forcePushed"}, {"oid": "c6371109f5b04aa1ec6c8f97a46a3dd0e836893c", "url": "https://github.com/dhis2/dhis2-core/commit/c6371109f5b04aa1ec6c8f97a46a3dd0e836893c", "message": "Fix code review comments", "committedDate": "2020-04-01T07:22:59Z", "type": "forcePushed"}, {"oid": "abae66ebf296c5e77d17e72fee178cd8234c4d09", "url": "https://github.com/dhis2/dhis2-core/commit/abae66ebf296c5e77d17e72fee178cd8234c4d09", "message": "Code review fixes", "committedDate": "2020-03-26T10:03:41Z", "type": "forcePushed"}, {"oid": "c7bfe2d9414308085cd785cd58584373b9642cdf", "url": "https://github.com/dhis2/dhis2-core/commit/c7bfe2d9414308085cd785cd58584373b9642cdf", "message": "Code review fixes", "committedDate": "2020-04-01T07:42:11Z", "type": "commit"}, {"oid": "b97c9f797c168b0455fa57e8435f82d99d9d8e51", "url": "https://github.com/dhis2/dhis2-core/commit/b97c9f797c168b0455fa57e8435f82d99d9d8e51", "message": "Merge remote-tracking branch 'origin/master' into HEAD", "committedDate": "2020-04-01T07:53:34Z", "type": "commit"}, {"oid": "01266c84fef6387bef2936abb58fa45ac33a6431", "url": "https://github.com/dhis2/dhis2-core/commit/01266c84fef6387bef2936abb58fa45ac33a6431", "message": "Fix style", "committedDate": "2020-04-01T08:37:01Z", "type": "commit"}, {"oid": "9af491548be57fc4cee4158cbd9831f908f48930", "url": "https://github.com/dhis2/dhis2-core/commit/9af491548be57fc4cee4158cbd9831f908f48930", "message": "Fix style", "committedDate": "2020-04-06T07:54:09Z", "type": "commit"}, {"oid": "d3deba89e896f849e491af7d7fc21a79eb48ab3a", "url": "https://github.com/dhis2/dhis2-core/commit/d3deba89e896f849e491af7d7fc21a79eb48ab3a", "message": "Merge remote-tracking branch 'origin/master' into DHIS2-7415", "committedDate": "2020-04-06T07:57:57Z", "type": "commit"}, {"oid": "25a6c5924d142120f40143613ca780e485751936", "url": "https://github.com/dhis2/dhis2-core/commit/25a6c5924d142120f40143613ca780e485751936", "message": "Fix compilation", "committedDate": "2020-04-06T08:07:14Z", "type": "commit"}, {"oid": "79e97e6d119c6be4aea7d425b8cc05db9193fcd6", "url": "https://github.com/dhis2/dhis2-core/commit/79e97e6d119c6be4aea7d425b8cc05db9193fcd6", "message": "Merge remote-tracking branch 'origin/master' into DHIS2-7415", "committedDate": "2020-04-08T07:32:25Z", "type": "commit"}, {"oid": "945d9fa67f68b1cba3d2420a7caf46c7cfe20907", "url": "https://github.com/dhis2/dhis2-core/commit/945d9fa67f68b1cba3d2420a7caf46c7cfe20907", "message": "Fix line endings", "committedDate": "2020-04-08T07:41:19Z", "type": "commit"}]}