{"pr_number": 4834, "pr_title": "chore: (2.34) Refactor sync implementation", "pr_createdAt": "2020-02-07T13:44:40Z", "pr_url": "https://github.com/dhis2/dhis2-core/pull/4834", "timeline": [{"oid": "a6147acbd28d461341a0ab80f74e2010218c4170", "url": "https://github.com/dhis2/dhis2-core/commit/a6147acbd28d461341a0ab80f74e2010218c4170", "message": "chore: (2.34) Refactor sync implementation\n\n- Clean the implementation of sync jobs\n- Prepare for adding a paging feature for Completeness sync\n- Prepare for adding new job parameteres for Metadata, Completeness and Data Values sync\n\nDHIS2-6062", "committedDate": "2020-02-07T13:41:52Z", "type": "commit"}, {"oid": "9d97a16f94b550fdb4be6a2755ca1129885c7186", "url": "https://github.com/dhis2/dhis2-core/commit/9d97a16f94b550fdb4be6a2755ca1129885c7186", "message": "chore: (2.34) Code cleanup\n\nDHIS2-6062", "committedDate": "2020-02-10T08:09:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjkyNTE3MQ==", "url": "https://github.com/dhis2/dhis2-core/pull/4834#discussion_r376925171", "bodyText": "We are putting status in a component, that could lead to some strange behaviour in concurrent calls.\nIs there a way to create it inside the methods or passing it as a parameter?", "author": "enricocolasante", "createdAt": "2020-02-10T08:43:19Z", "path": "dhis-2/dhis-services/dhis-service-dxf2/src/main/java/org/hisp/dhis/dxf2/sync/TrackerSynchronization.java", "diffHunk": "@@ -65,6 +64,8 @@\n     private final RestTemplate restTemplate;\n     private final RenderService renderService;\n \n+    private TrackedEntityInstanceQueryParams queryParams;", "originalCommit": "9d97a16f94b550fdb4be6a2755ca1129885c7186", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjkzNjQ3Mg==", "url": "https://github.com/dhis2/dhis2-core/pull/4834#discussion_r376936472", "bodyText": "The code is runned sequentially. It is not run concurrently and it is not built to be run concurrently. If there is a new requirement to run it concurrently, then the whole logic needs to be revised and probably significantly rewritten.", "author": "huzvak", "createdAt": "2020-02-10T09:08:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjkyNTE3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjkzNzk4NA==", "url": "https://github.com/dhis2/dhis2-core/pull/4834#discussion_r376937984", "bodyText": "\ud83d\udc4d", "author": "enricocolasante", "createdAt": "2020-02-10T09:12:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjkyNTE3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk0MTM2NQ==", "url": "https://github.com/dhis2/dhis2-core/pull/4834#discussion_r376941365", "bodyText": "@huzvak @enricocolasante I think that Enrico is correct in highlighting that variable. If 2 threads will use that bean, the variable will get overridden by the second concurrent call.", "author": "luciano-fiandesio", "createdAt": "2020-02-10T09:18:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjkyNTE3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzYwMTMwMw==", "url": "https://github.com/dhis2/dhis2-core/pull/4834#discussion_r377601303", "bodyText": "Yes. I agree. But in Scheduler, there is a logic that there should never be 2 instances/threads of sync job running at the same time. But I will take a look into it anyway and will improve it in next commit and PR.", "author": "huzvak", "createdAt": "2020-02-11T12:22:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjkyNTE3MQ=="}], "type": "inlineReview"}]}