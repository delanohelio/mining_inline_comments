{"pr_number": 6655, "pr_title": "fix: correct validation rule for Event's TEI value", "pr_createdAt": "2020-11-13T09:16:57Z", "pr_url": "https://github.com/dhis2/dhis2-core/pull/6655", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjg1NTY0OQ==", "url": "https://github.com/dhis2/dhis2-core/pull/6655#discussion_r522855649", "bodyText": "Just so we dont forget, lets make a jira issue for it (TECH)", "author": "stian-sandvold", "createdAt": "2020-11-13T10:17:09Z", "path": "dhis-2/dhis-services/dhis-service-tracker/src/main/java/org/hisp/dhis/tracker/preprocess/DefaultTrackerPreprocessService.java", "diffHunk": "@@ -48,15 +48,29 @@\n {\n     private List<RuleActionApplier> appliers = new ArrayList<>();\n \n+    private List<BundlePreProcessor> preProcessors = new ArrayList<>();\n+\n     @Autowired( required = false )\n     public void setAppliers( List<RuleActionApplier> appliers )\n     {\n         this.appliers = appliers;\n     }\n \n+    @Autowired( required = false )\n+    public void setPreProcessors( List<BundlePreProcessor> preProcessors )\n+    {\n+        this.preProcessors = preProcessors;\n+    }\n+\n     @Override\n     public TrackerBundle preprocess( TrackerBundle bundle )\n     {\n+        // TODO we may consider \"merging\" the BundlePreProcessor with the RuleActionApplier, since", "originalCommit": "f56dda1c05e6d5abe8b6e0fe68962dbd706a3fca", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjg5ODY1OA==", "url": "https://github.com/dhis2/dhis2-core/pull/6655#discussion_r522898658", "bodyText": "Done: https://jira.dhis2.org/browse/TECH-477", "author": "luciano-fiandesio", "createdAt": "2020-11-13T11:41:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjg1NTY0OQ=="}], "type": "inlineReview"}, {"oid": "298ef50d4dfb8ddc83ba4143dd65126208826a36", "url": "https://github.com/dhis2/dhis2-core/commit/298ef50d4dfb8ddc83ba4143dd65126208826a36", "message": "fix: correct validation rule for Event's TEI value\n\nFixes an issue with validating the `trackedEntity` value of an incoming Event.\n\nAdditionally, this PR introduces a `BundlePreProcessor` interface to alter the payload prior to validation.\nA new PreProcessor is created to infer the `trackedEntity` value of an Event from the parent Enrollment.\n\nref: DHIS2-9958", "committedDate": "2020-11-13T11:03:45Z", "type": "commit"}, {"oid": "d69d6dbe30cb25024df2bf1bb9f45267a89a3fc0", "url": "https://github.com/dhis2/dhis2-core/commit/d69d6dbe30cb25024df2bf1bb9f45267a89a3fc0", "message": "fix: unit test failing", "committedDate": "2020-11-13T11:03:45Z", "type": "commit"}, {"oid": "fa590517352d8bc408547141b5492f59241453ba", "url": "https://github.com/dhis2/dhis2-core/commit/fa590517352d8bc408547141b5492f59241453ba", "message": "fix: add tei to preheat in preprocessor", "committedDate": "2020-11-13T11:10:22Z", "type": "commit"}, {"oid": "fa590517352d8bc408547141b5492f59241453ba", "url": "https://github.com/dhis2/dhis2-core/commit/fa590517352d8bc408547141b5492f59241453ba", "message": "fix: add tei to preheat in preprocessor", "committedDate": "2020-11-13T11:10:22Z", "type": "forcePushed"}, {"oid": "3265843c6aedbd05f3c289f8f6d4f9d9fe7ac5b3", "url": "https://github.com/dhis2/dhis2-core/commit/3265843c6aedbd05f3c289f8f6d4f9d9fe7ac5b3", "message": "fix: unignored and fixed test", "committedDate": "2020-11-13T11:37:23Z", "type": "commit"}, {"oid": "3b437373cb1e4727d93a91077dc92a45f2d0136d", "url": "https://github.com/dhis2/dhis2-core/commit/3b437373cb1e4727d93a91077dc92a45f2d0136d", "message": "fix: fixed tests", "committedDate": "2020-11-13T12:04:48Z", "type": "commit"}]}