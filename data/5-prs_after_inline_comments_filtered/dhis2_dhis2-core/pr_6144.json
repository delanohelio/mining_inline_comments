{"pr_number": 6144, "pr_title": "fix: DryRun flag and ProgramNotificationPostProcessor (DHIS2-9484)", "pr_createdAt": "2020-09-11T15:45:32Z", "pr_url": "https://github.com/dhis2/dhis2-core/pull/6144", "timeline": [{"oid": "5405c75b203a78fda9c459caae7e211330c2c166", "url": "https://github.com/dhis2/dhis2-core/commit/5405c75b203a78fda9c459caae7e211330c2c166", "message": "fix: now dryrun flag is considered while importing\nfix: added ProgramNotificationPostProcessor in eventInsertPostProcessorMap", "committedDate": "2020-09-11T15:44:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ5MzM4Mw==", "url": "https://github.com/dhis2/dhis2-core/pull/6144#discussion_r487493383", "bodyText": "Can we move the ProgramNotificationPostProcessor class to shared/postprocess package?", "author": "luciano-fiandesio", "createdAt": "2020-09-13T07:24:21Z", "path": "dhis-2/dhis-services/dhis-service-dxf2/src/main/java/org/hisp/dhis/dxf2/config/ServiceConfig.java", "diffHunk": "@@ -255,6 +255,7 @@ public RetryTemplate retryTemplate()\n     public Map<ImportStrategy, List<Class<? extends Processor>>> eventInsertPostProcessorMap()\n     {\n         return ImmutableMap.of( CREATE, newArrayList(\n+            ProgramNotificationPostProcessor.class,", "originalCommit": "5405c75b203a78fda9c459caae7e211330c2c166", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzcxNTk2NA==", "url": "https://github.com/dhis2/dhis2-core/pull/6144#discussion_r487715964", "bodyText": "Yep, we already talked about it, I forgot \ud83d\udc4d", "author": "gnespolino", "createdAt": "2020-09-14T07:48:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ5MzM4Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ5MzkyOQ==", "url": "https://github.com/dhis2/dhis2-core/pull/6144#discussion_r487493929", "bodyText": "This seems a bit of an overkill, especially from a readability point of view. Why not use the getOrDefault method of the Map interface:\nfinal ProgramStageInstance programStageInstance = getProgramStageInstance( ctx, event );\n\n...\n\nprivate ProgramStageInstance getProgramStageInstance( WorkContext ctx, Event event )\n    {\n        return ctx.getProgramStageInstanceMap().getOrDefault( event.getUid(),\n            new ProgramStageInstanceMapper( ctx ).map( event ) );\n    }", "author": "luciano-fiandesio", "createdAt": "2020-09-13T07:29:57Z", "path": "dhis-2/dhis-services/dhis-service-dxf2/src/main/java/org/hisp/dhis/dxf2/events/importer/update/postprocess/ProgramNotificationPostProcessor.java", "diffHunk": "@@ -68,4 +82,31 @@ public void process( final Event event, final WorkContext ctx )\n             }\n         }\n     }\n+\n+    private ProgramStageInstance getProgramStageInstance( WorkContextWithEvent workContextWithEvent )", "originalCommit": "5405c75b203a78fda9c459caae7e211330c2c166", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ5NDE3Mg==", "url": "https://github.com/dhis2/dhis2-core/pull/6144#discussion_r487494172", "bodyText": "Also, note that the ProgramStageInstanceMap uses event.getUid() as key. The original ProgramNotificationPostProcessor had a bug, since it was using event.getEvent()", "author": "luciano-fiandesio", "createdAt": "2020-09-13T07:32:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ5MzkyOQ=="}], "type": "inlineReview"}, {"oid": "5c0e699c36f813d6f9072ca799ba2f5dfe67692d", "url": "https://github.com/dhis2/dhis2-core/commit/5c0e699c36f813d6f9072ca799ba2f5dfe67692d", "message": "fix: peer review\n\nProgramNotificationPostProcessor in shared package\nSmall change for better readability", "committedDate": "2020-09-14T09:25:25Z", "type": "commit"}]}