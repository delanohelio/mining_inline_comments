{"pr_number": 5565, "pr_title": "fix: reuse orgunit from TEI instead of converting, then getting org unit", "pr_createdAt": "2020-05-10T16:39:55Z", "pr_url": "https://github.com/dhis2/dhis2-core/pull/5565", "timeline": [{"oid": "97744b34b4874e84b73d6969f21986fdb321150c", "url": "https://github.com/dhis2/dhis2-core/commit/97744b34b4874e84b73d6969f21986fdb321150c", "message": "fix: reuse orgunit from TEI instead of converting, then getting org unit", "committedDate": "2020-05-10T16:39:30Z", "type": "commit"}, {"oid": "3e9b9f653e201be07248d503a2fefafcffdf704b", "url": "https://github.com/dhis2/dhis2-core/commit/3e9b9f653e201be07248d503a2fefafcffdf704b", "message": "fix: add back access check from getTei", "committedDate": "2020-05-10T17:16:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjgwODc5NQ==", "url": "https://github.com/dhis2/dhis2-core/pull/5565#discussion_r422808795", "bodyText": "Shouldn't we use ImportSummary here, rather than throw an Exception?", "author": "luciano-fiandesio", "createdAt": "2020-05-11T06:27:14Z", "path": "dhis-2/dhis-services/dhis-service-dxf2/src/main/java/org/hisp/dhis/dxf2/events/enrollment/AbstractEnrollmentService.java", "diffHunk": "@@ -1201,8 +1200,12 @@ private boolean doValidationOfMandatoryAttributes( User user )\n             validateAttributeType( attribute, importOptions, importConflicts );\n         }\n \n-        TrackedEntityInstance instance = trackedEntityInstanceService.getTrackedEntityInstance( trackedEntityInstance, TrackedEntityInstanceParams.TRUE,\n-            importOptions.getUser() );\n+        List<String> errors = trackerAccessManager.canRead( importOptions.getUser(), trackedEntityInstance );\n+\n+        if ( !errors.isEmpty() )\n+        {\n+            throw new IllegalQueryException( errors.toString() );", "originalCommit": "3e9b9f653e201be07248d503a2fefafcffdf704b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjgxMDU0NQ==", "url": "https://github.com/dhis2/dhis2-core/pull/5565#discussion_r422810545", "bodyText": "Yes, 100%, but it would break how it currently works. The getTrackedEntityinstance raised did this IllegalQueryException, and I didn't want to break compatibility (it also broke several tests). Since this is getting backported, I say stay with what we have right now without changing how the API contract behaves. For the new importer this is already gone long time ago.", "author": "mortenoh", "createdAt": "2020-05-11T06:31:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjgwODc5NQ=="}], "type": "inlineReview"}]}