{"pr_number": 1172, "pr_title": "Feature: Clean up participation and restart tour", "pr_createdAt": "2020-01-06T22:15:29Z", "pr_url": "https://github.com/ls1intum/Artemis/pull/1172", "timeline": [{"oid": "13eb22e290c2a9c98337f5dc13ec24ac31d4a54d", "url": "https://github.com/ls1intum/Artemis/commit/13eb22e290c2a9c98337f5dc13ec24ac31d4a54d", "message": "Implement restart of guided tutorial", "committedDate": "2020-01-06T18:20:05Z", "type": "commit"}, {"oid": "774a05a5071bc78c30849bc563c8774b61373fc2", "url": "https://github.com/ls1intum/Artemis/commit/774a05a5071bc78c30849bc563c8774b61373fc2", "message": "Merge branch 'develop' into feature/guided-tour/restart-tour", "committedDate": "2020-01-06T18:21:20Z", "type": "commit"}, {"oid": "bfff24efd9a99352b67dc1ca7f23853a0f4b0a9c", "url": "https://github.com/ls1intum/Artemis/commit/bfff24efd9a99352b67dc1ca7f23853a0f4b0a9c", "message": "Optimize subscriptions and remove method from PersonClass task", "committedDate": "2020-01-06T21:59:09Z", "type": "commit"}, {"oid": "0035e7a938438adbd325f6ddef6df4942cb42988", "url": "https://github.com/ls1intum/Artemis/commit/0035e7a938438adbd325f6ddef6df4942cb42988", "message": "Add missing param in JavaDoc", "committedDate": "2020-01-06T22:21:51Z", "type": "commit"}, {"oid": "23071302d12615a1ccd708ffe6cbc46203a1d418", "url": "https://github.com/ls1intum/Artemis/commit/23071302d12615a1ccd708ffe6cbc46203a1d418", "message": "Add missing null check", "committedDate": "2020-01-07T10:13:39Z", "type": "commit"}, {"oid": "10b6d703b10a86a5ea65747b35601221e0480ca1", "url": "https://github.com/ls1intum/Artemis/commit/10b6d703b10a86a5ea65747b35601221e0480ca1", "message": "Add server tests", "committedDate": "2020-01-07T10:48:48Z", "type": "commit"}, {"oid": "c83d72ca702cf7bea2dd60089dacc29cdfd77e8b", "url": "https://github.com/ls1intum/Artemis/commit/c83d72ca702cf7bea2dd60089dacc29cdfd77e8b", "message": "Add and update client tests", "committedDate": "2020-01-07T12:48:27Z", "type": "commit"}, {"oid": "31ed6433e7e810fd89cf3f1ff6da41c219b418e5", "url": "https://github.com/ls1intum/Artemis/commit/31ed6433e7e810fd89cf3f1ff6da41c219b418e5", "message": "Refactor client tests", "committedDate": "2020-01-07T14:21:51Z", "type": "commit"}, {"oid": "d677842b0f5fc74431449f482254cf62e1147d8e", "url": "https://github.com/ls1intum/Artemis/commit/d677842b0f5fc74431449f482254cf62e1147d8e", "message": "Merge branch 'develop' into feature/guided-tour/restart-tour", "committedDate": "2020-01-07T14:23:29Z", "type": "commit"}, {"oid": "a8d68b2b936cf0474d2ea2637475f465df9d5549", "url": "https://github.com/ls1intum/Artemis/commit/a8d68b2b936cf0474d2ea2637475f465df9d5549", "message": "Add test for currentCourse and currentExercise", "committedDate": "2020-01-07T14:36:39Z", "type": "commit"}, {"oid": "faae29e8b835fa5c5137c158d6bd5f70a47e310b", "url": "https://github.com/ls1intum/Artemis/commit/faae29e8b835fa5c5137c158d6bd5f70a47e310b", "message": "Add TODOs", "committedDate": "2020-01-07T16:08:41Z", "type": "commit"}, {"oid": "2cd48b281a4a18795d047f8191a907594420f29e", "url": "https://github.com/ls1intum/Artemis/commit/2cd48b281a4a18795d047f8191a907594420f29e", "message": "Merge branch 'develop' into feature/guided-tour/restart-tour\n\n# Conflicts:\n#\tsrc/main/webapp/app/guided-tour/guided-tour.component.ts", "committedDate": "2020-01-07T21:55:05Z", "type": "commit"}, {"oid": "25345b631b440284b337c3c83aefa85a899d3c7d", "url": "https://github.com/ls1intum/Artemis/commit/25345b631b440284b337c3c83aefa85a899d3c7d", "message": "Enable deletion of StudentParticipation", "committedDate": "2020-01-08T01:24:13Z", "type": "commit"}, {"oid": "3d12490ff065dc9a0cd687b1c08039463f41e17c", "url": "https://github.com/ls1intum/Artemis/commit/3d12490ff065dc9a0cd687b1c08039463f41e17c", "message": "Allow USER and TA to delete their own participations", "committedDate": "2020-01-08T14:25:35Z", "type": "commit"}, {"oid": "cb1c994bed59ad1c93750464a99b7a08e71a354e", "url": "https://github.com/ls1intum/Artemis/commit/cb1c994bed59ad1c93750464a99b7a08e71a354e", "message": "Update ParticipationResource method and fix server tests", "committedDate": "2020-01-08T14:45:45Z", "type": "commit"}, {"oid": "7f45fb70ea82789ed564ca8541de7ab885b4c6a5", "url": "https://github.com/ls1intum/Artemis/commit/7f45fb70ea82789ed564ca8541de7ab885b4c6a5", "message": "Add client tests", "committedDate": "2020-01-09T01:09:58Z", "type": "commit"}, {"oid": "ff9917a55e8e099a8cc5251d5ea05dfe4bb0e83c", "url": "https://github.com/ls1intum/Artemis/commit/ff9917a55e8e099a8cc5251d5ea05dfe4bb0e83c", "message": "Remove commented code", "committedDate": "2020-01-09T01:15:43Z", "type": "commit"}, {"oid": "c9382c40f324265d1a9dcd41d389733b560f9ae1", "url": "https://github.com/ls1intum/Artemis/commit/c9382c40f324265d1a9dcd41d389733b560f9ae1", "message": "Fix test build error", "committedDate": "2020-01-09T01:48:07Z", "type": "commit"}, {"oid": "e0f909f9fbbbb70baf6daaad3b4522698498e5de", "url": "https://github.com/ls1intum/Artemis/commit/e0f909f9fbbbb70baf6daaad3b4522698498e5de", "message": "Change permission check", "committedDate": "2020-01-09T20:52:52Z", "type": "commit"}, {"oid": "a8dc3df018e094b4049eef093ed96fb17ac89596", "url": "https://github.com/ls1intum/Artemis/commit/a8dc3df018e094b4049eef093ed96fb17ac89596", "message": "Merge branch 'develop' into feature/guided-tour/restart-tour", "committedDate": "2020-01-10T00:20:39Z", "type": "commit"}, {"oid": "aa21ac8285888f741255db90bc0d8c30bdeb5621", "url": "https://github.com/ls1intum/Artemis/commit/aa21ac8285888f741255db90bc0d8c30bdeb5621", "message": "Merge branch 'develop' into feature/guided-tour/restart-tour", "committedDate": "2020-01-10T15:57:18Z", "type": "commit"}, {"oid": "38874c021d56bce6583c5cbd15724cc859ca957f", "url": "https://github.com/ls1intum/Artemis/commit/38874c021d56bce6583c5cbd15724cc859ca957f", "message": "Fix client test after merge", "committedDate": "2020-01-10T16:40:26Z", "type": "commit"}, {"oid": "b4d83bbe5987f47e35256744d3482e75b41a8c1f", "url": "https://github.com/ls1intum/Artemis/commit/b4d83bbe5987f47e35256744d3482e75b41a8c1f", "message": "Merge branch 'develop' into feature/guided-tour/restart-tour", "committedDate": "2020-01-10T17:13:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTQ0OTk0MQ==", "url": "https://github.com/ls1intum/Artemis/pull/1172#discussion_r365449941", "bodyText": "can we add an additional check for now, that this can only happen in tutorial exercises for normal users and TAs?\nI think we store them in the yml file anyway, so we should be able to write a util function that checks this.\nI imagine some logic like:\n\nIf isAtLeastInstructor(...) { //do normal delete }\nelse if isTA or isStudent(...) { // check if the partcipation belongs to a tutorial exercise }\n\nAnother (maybe cleaner) alternative would be to introduce a new API endpoint for the case of deleting participations for tutorial exercises.", "author": "krusche", "createdAt": "2020-01-10T22:08:45Z", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ParticipationResource.java", "diffHunk": "@@ -586,7 +586,15 @@ else if (participation.getExercise() instanceof ProgrammingExercise) {\n         }\n \n         User user = userService.getUserWithGroupsAndAuthorities();\n-        checkAccessPermissionAtInstructor(participation, user);\n+\n+        // Allow USER's and TA's to delete their own StudentParticipations\n+        if (user.getId().equals(participation.getStudent().getId())) {\n+            checkAccessPermissionAtLeastStudent(participation, user);", "originalCommit": "b4d83bbe5987f47e35256744d3482e75b41a8c1f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTQ1NDUyMw==", "url": "https://github.com/ls1intum/Artemis/pull/1172#discussion_r365454523", "bodyText": "At first I have implemented a new API endpoint for deleting participations for tutorial exercises, but then I remembered that you once mentioned that it should be possible for tutors and student to delete their own participation in the future. As suggested by you, I will add another check logic here :)", "author": "lovaiible", "createdAt": "2020-01-10T22:24:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTQ0OTk0MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTQ1MDcxMA==", "url": "https://github.com/ls1intum/Artemis/pull/1172#discussion_r365450710", "bodyText": "why do you call this mock settings? isn't this just simple test data?", "author": "krusche", "createdAt": "2020-01-10T22:11:17Z", "path": "src/test/java/de/tum/in/www1/artemis/GuidedTourSettingResourceTest.java", "diffHunk": "@@ -39,17 +39,7 @@ public void tearDown() {\n         database.resetDatabase();\n     }\n \n-    @Test\n-    @WithMockUser(value = \"student1\")\n-    public void guidedTourSettingsIsInitiallyNull() throws Exception {\n-        User user = request.get(\"/api/account\", HttpStatus.OK, User.class);\n-        assertThat(user.getGuidedTourSettings().isEmpty()).isTrue();\n-    }\n-\n-    @Test\n-    @WithMockUser(value = \"student1\")\n-    @SuppressWarnings(\"unchecked\")\n-    public void updateGuidedTourSettings() throws Exception {\n+    public Set<GuidedTourSetting> createMockSettings() {", "originalCommit": "b4d83bbe5987f47e35256744d3482e75b41a8c1f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTQ1NDY3Ng==", "url": "https://github.com/ls1intum/Artemis/pull/1172#discussion_r365454676", "bodyText": "Agreed, I will change the naming of the method :)", "author": "lovaiible", "createdAt": "2020-01-10T22:24:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTQ1MDcxMA=="}], "type": "inlineReview"}, {"oid": "8fad61d8f6f2882e44d945b9da206562543734b8", "url": "https://github.com/ls1intum/Artemis/commit/8fad61d8f6f2882e44d945b9da206562543734b8", "message": "Merge branch 'develop' into feature/guided-tour/restart-tour", "committedDate": "2020-01-13T04:06:19Z", "type": "commit"}, {"oid": "d6993f8a7d6a6790b083b2c59e4d60cc061c7de0", "url": "https://github.com/ls1intum/Artemis/commit/d6993f8a7d6a6790b083b2c59e4d60cc061c7de0", "message": "Apply feedback", "committedDate": "2020-01-13T04:11:09Z", "type": "commit"}, {"oid": "b11f7ed1068a6e09929d7ad8e22cdb6bee0c53b0", "url": "https://github.com/ls1intum/Artemis/commit/b11f7ed1068a6e09929d7ad8e22cdb6bee0c53b0", "message": "Add guided tour mapping check on the server", "committedDate": "2020-01-14T03:42:51Z", "type": "commit"}, {"oid": "50fe1c1888b889c89ff00d68f5e9fa3316c1ecf3", "url": "https://github.com/ls1intum/Artemis/commit/50fe1c1888b889c89ff00d68f5e9fa3316c1ecf3", "message": "Fix tests and code formatting", "committedDate": "2020-01-15T22:04:43Z", "type": "commit"}, {"oid": "f5e392a08d4aaa1ccdec8ecf7ea353b00ddafcf2", "url": "https://github.com/ls1intum/Artemis/commit/f5e392a08d4aaa1ccdec8ecf7ea353b00ddafcf2", "message": "Merge branch 'develop' into feature/guided-tour/restart-tour", "committedDate": "2020-01-15T22:16:29Z", "type": "commit"}, {"oid": "a0a233519ac76210653221806d4621f32e0ab2b8", "url": "https://github.com/ls1intum/Artemis/commit/a0a233519ac76210653221806d4621f32e0ab2b8", "message": "Merge branch 'develop' into feature/guided-tour/restart-tour", "committedDate": "2020-01-17T20:17:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODU3OTMwNw==", "url": "https://github.com/ls1intum/Artemis/pull/1172#discussion_r368579307", "bodyText": "Please add some short JavaDoc", "author": "ungaralex", "createdAt": "2020-01-20T14:36:15Z", "path": "src/main/java/de/tum/in/www1/artemis/config/GuidedTourConfiguration.java", "diffHunk": "@@ -0,0 +1,55 @@\n+package de.tum.in.www1.artemis.config;\n+\n+import java.util.*;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.boot.context.properties.ConfigurationProperties;\n+import org.springframework.boot.context.properties.EnableConfigurationProperties;\n+import org.springframework.stereotype.Component;\n+\n+import de.tum.in.www1.artemis.domain.Exercise;\n+import de.tum.in.www1.artemis.domain.ProgrammingExercise;\n+\n+@Component\n+@EnableConfigurationProperties\n+@ConfigurationProperties(prefix = \"info.guided-tour\")\n+public class GuidedTourConfiguration {\n+\n+    private final Logger log = LoggerFactory.getLogger(GuidedTourConfiguration.class);\n+\n+    private String courseShortName = \"\";\n+\n+    private List<HashMap<String, String>> tours = new ArrayList<>();\n+\n+    public GuidedTourConfiguration() {\n+\n+    }\n+\n+    public List<HashMap<String, String>> getTours() {\n+        return this.tours;\n+    }\n+\n+    public void setTours(List<HashMap<String, String>> tours) {\n+        this.tours = tours;\n+    }\n+\n+    public String getCourseShortName() {\n+        return courseShortName;\n+    }\n+\n+    public void setCourseShortName(String courseShortName) {\n+        this.courseShortName = courseShortName;\n+    }\n+\n+    public boolean isExerciseForTutorial(Exercise exercise) {", "originalCommit": "a0a233519ac76210653221806d4621f32e0ab2b8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODU4NjA1MA==", "url": "https://github.com/ls1intum/Artemis/pull/1172#discussion_r368586050", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \n          \n          \n            \n                /**\n          \n          \n            \n                 * Mapping of tourKey -> tourIdentifier \n          \n          \n            \n                 */", "author": "ungaralex", "createdAt": "2020-01-20T14:49:24Z", "path": "src/main/java/de/tum/in/www1/artemis/config/GuidedTourConfiguration.java", "diffHunk": "@@ -0,0 +1,55 @@\n+package de.tum.in.www1.artemis.config;\n+\n+import java.util.*;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.boot.context.properties.ConfigurationProperties;\n+import org.springframework.boot.context.properties.EnableConfigurationProperties;\n+import org.springframework.stereotype.Component;\n+\n+import de.tum.in.www1.artemis.domain.Exercise;\n+import de.tum.in.www1.artemis.domain.ProgrammingExercise;\n+\n+@Component\n+@EnableConfigurationProperties\n+@ConfigurationProperties(prefix = \"info.guided-tour\")\n+public class GuidedTourConfiguration {\n+\n+    private final Logger log = LoggerFactory.getLogger(GuidedTourConfiguration.class);\n+\n+    private String courseShortName = \"\";\n+\n+    private List<HashMap<String, String>> tours = new ArrayList<>();\n+\n+    public GuidedTourConfiguration() {\n+\n+    }\n+\n+    public List<HashMap<String, String>> getTours() {\n+        return this.tours;\n+    }\n+", "originalCommit": "a0a233519ac76210653221806d4621f32e0ab2b8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODU4NzM3MA==", "url": "https://github.com/ls1intum/Artemis/pull/1172#discussion_r368587370", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    for (HashMap<String, String> guidedTourMapping : this.getTours()) {\n          \n          \n            \n                    return tours.stream()\n          \n          \n            \n                            .flatMap(tour -> tour.values().stream())\n          \n          \n            \n                            .anyMatch(tourIdentifier -> tourIdentifier.equals(exerciseIdentifier));", "author": "ungaralex", "createdAt": "2020-01-20T14:51:57Z", "path": "src/main/java/de/tum/in/www1/artemis/config/GuidedTourConfiguration.java", "diffHunk": "@@ -0,0 +1,55 @@\n+package de.tum.in.www1.artemis.config;\n+\n+import java.util.*;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.boot.context.properties.ConfigurationProperties;\n+import org.springframework.boot.context.properties.EnableConfigurationProperties;\n+import org.springframework.stereotype.Component;\n+\n+import de.tum.in.www1.artemis.domain.Exercise;\n+import de.tum.in.www1.artemis.domain.ProgrammingExercise;\n+\n+@Component\n+@EnableConfigurationProperties\n+@ConfigurationProperties(prefix = \"info.guided-tour\")\n+public class GuidedTourConfiguration {\n+\n+    private final Logger log = LoggerFactory.getLogger(GuidedTourConfiguration.class);\n+\n+    private String courseShortName = \"\";\n+\n+    private List<HashMap<String, String>> tours = new ArrayList<>();\n+\n+    public GuidedTourConfiguration() {\n+\n+    }\n+\n+    public List<HashMap<String, String>> getTours() {\n+        return this.tours;\n+    }\n+\n+    public void setTours(List<HashMap<String, String>> tours) {\n+        this.tours = tours;\n+    }\n+\n+    public String getCourseShortName() {\n+        return courseShortName;\n+    }\n+\n+    public void setCourseShortName(String courseShortName) {\n+        this.courseShortName = courseShortName;\n+    }\n+\n+    public boolean isExerciseForTutorial(Exercise exercise) {\n+        String exerciseIdentifier = exercise instanceof ProgrammingExercise ? exercise.getShortName() : exercise.getTitle();\n+\n+        for (HashMap<String, String> guidedTourMapping : this.getTours()) {", "originalCommit": "a0a233519ac76210653221806d4621f32e0ab2b8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODU5NjM5MA==", "url": "https://github.com/ls1intum/Artemis/pull/1172#discussion_r368596390", "bodyText": "You should implement equals and hashCode in GuidedTourSetting and then delete the setting from the set in the user entity using this.guidedTourSettings.remove(setting). Looping over the set is not best practice.\nOne additional question: Shouldn't we move the guided tour related methods to a GuidedTourService? Not really in the scope of this PR, but if I were to work on guided tours, my initial intuition would be to look for such a service, and not in the UserService. Additionally, this service already has almost 600 LoC.", "author": "ungaralex", "createdAt": "2020-01-20T15:10:35Z", "path": "src/main/java/de/tum/in/www1/artemis/service/UserService.java", "diffHunk": "@@ -551,4 +550,22 @@ public User updateGuidedTourSettings(Set<GuidedTourSetting> guidedTourSettings)\n         }\n         return userRepository.save(loggedInUser);\n     }\n+\n+    /**\n+     * Delete a given guided tour setting of the currently logged in user\n+     * @param guidedTourSettingsKey the key of the guided tour setting that should be deleted\n+     * @return the updated user object without the deleted guided tour setting\n+     */\n+    public User deleteGuidedTourSetting(String guidedTourSettingsKey) {\n+        User loggedInUser = getUserWithGroupsAuthoritiesAndGuidedTourSettings();\n+        Set<GuidedTourSetting> guidedTourSettings = loggedInUser.getGuidedTourSettings();\n+        for (GuidedTourSetting setting : guidedTourSettings) {\n+            if (setting.getGuidedTourKey().equals(guidedTourSettingsKey)) {\n+                loggedInUser.removeGuidedTourSetting(setting);\n+                guidedTourSettingsRepository.save(setting);\n+                break;\n+            }\n+        }\n+        return userRepository.save(loggedInUser);\n+    }", "originalCommit": "a0a233519ac76210653221806d4621f32e0ab2b8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODkwOTc5Ng==", "url": "https://github.com/ls1intum/Artemis/pull/1172#discussion_r368909796", "bodyText": "As discussed, this is not possible because I don't have the guidedTourSetting object but only the key as string :(", "author": "lovaiible", "createdAt": "2020-01-21T10:07:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODU5NjM5MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODU5OTcxMQ==", "url": "https://github.com/ls1intum/Artemis/pull/1172#discussion_r368599711", "bodyText": "You don't need this since the save operation on the user repository will already update the bidirectional relation and the orphanRemoval=true setting will remove the GuidedTourSetting on flush.", "author": "ungaralex", "createdAt": "2020-01-20T15:17:09Z", "path": "src/main/java/de/tum/in/www1/artemis/service/UserService.java", "diffHunk": "@@ -551,4 +550,22 @@ public User updateGuidedTourSettings(Set<GuidedTourSetting> guidedTourSettings)\n         }\n         return userRepository.save(loggedInUser);\n     }\n+\n+    /**\n+     * Delete a given guided tour setting of the currently logged in user\n+     * @param guidedTourSettingsKey the key of the guided tour setting that should be deleted\n+     * @return the updated user object without the deleted guided tour setting\n+     */\n+    public User deleteGuidedTourSetting(String guidedTourSettingsKey) {\n+        User loggedInUser = getUserWithGroupsAuthoritiesAndGuidedTourSettings();\n+        Set<GuidedTourSetting> guidedTourSettings = loggedInUser.getGuidedTourSettings();\n+        for (GuidedTourSetting setting : guidedTourSettings) {\n+            if (setting.getGuidedTourKey().equals(guidedTourSettingsKey)) {\n+                loggedInUser.removeGuidedTourSetting(setting);\n+                guidedTourSettingsRepository.save(setting);", "originalCommit": "a0a233519ac76210653221806d4621f32e0ab2b8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODkxMDAzNQ==", "url": "https://github.com/ls1intum/Artemis/pull/1172#discussion_r368910035", "bodyText": "It works without the save operation. Thank you for the suggestion :)", "author": "lovaiible", "createdAt": "2020-01-21T10:07:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODU5OTcxMQ=="}], "type": "inlineReview"}, {"oid": "ad247c614369c2c5a0a4237ef1c31afe82dcbe18", "url": "https://github.com/ls1intum/Artemis/commit/ad247c614369c2c5a0a4237ef1c31afe82dcbe18", "message": "Merge branch 'develop' into feature/guided-tour/restart-tour", "committedDate": "2020-01-21T00:18:14Z", "type": "commit"}, {"oid": "c3e82c564674df48008357f6af4ba6ee1a273e96", "url": "https://github.com/ls1intum/Artemis/commit/c3e82c564674df48008357f6af4ba6ee1a273e96", "message": "Apply feedback", "committedDate": "2020-01-21T10:05:41Z", "type": "commit"}, {"oid": "c5f89541740cfdf74e9ecb6393cf1eaf74301c03", "url": "https://github.com/ls1intum/Artemis/commit/c5f89541740cfdf74e9ecb6393cf1eaf74301c03", "message": "Add 'restart tutorial' label to account menu", "committedDate": "2020-01-21T10:41:11Z", "type": "commit"}, {"oid": "4c9ea534a3e56cffed8b92edd46c87627bc00981", "url": "https://github.com/ls1intum/Artemis/commit/4c9ea534a3e56cffed8b92edd46c87627bc00981", "message": "Add loading indicator when restarting a tutorial", "committedDate": "2020-01-21T14:26:24Z", "type": "commit"}, {"oid": "6ab32964aba36e63660edc261878d96dcd534141", "url": "https://github.com/ls1intum/Artemis/commit/6ab32964aba36e63660edc261878d96dcd534141", "message": "Apply spotless", "committedDate": "2020-01-21T14:30:16Z", "type": "commit"}, {"oid": "0a8a4390739ec3f62950eb1638c9ff4c8f901c76", "url": "https://github.com/ls1intum/Artemis/commit/0a8a4390739ec3f62950eb1638c9ff4c8f901c76", "message": "Move deletion of participation for guided tour to its own REST call", "committedDate": "2020-01-21T15:09:07Z", "type": "commit"}, {"oid": "06765f01b7429302876bbb8bc6693b2975898488", "url": "https://github.com/ls1intum/Artemis/commit/06765f01b7429302876bbb8bc6693b2975898488", "message": "Apply prettier", "committedDate": "2020-01-21T15:10:36Z", "type": "commit"}, {"oid": "0efed4b651621d23c0580b69d50627a38cd213df", "url": "https://github.com/ls1intum/Artemis/commit/0efed4b651621d23c0580b69d50627a38cd213df", "message": "Apply spotless", "committedDate": "2020-01-21T15:11:38Z", "type": "commit"}, {"oid": "b2ec5860981c899c9a54f95533a706eb43ee0b77", "url": "https://github.com/ls1intum/Artemis/commit/b2ec5860981c899c9a54f95533a706eb43ee0b77", "message": "Merge branch 'develop' into feature/guided-tour/restart-tour", "committedDate": "2020-01-21T15:36:36Z", "type": "commit"}, {"oid": "28664cfed784595bd3527c69d9e37eb2509c2521", "url": "https://github.com/ls1intum/Artemis/commit/28664cfed784595bd3527c69d9e37eb2509c2521", "message": "Merge branch 'develop' into feature/guided-tour/restart-tour\n\n# Conflicts:\n#\tsrc/main/java/de/tum/in/www1/artemis/service/UserService.java", "committedDate": "2020-01-22T01:12:04Z", "type": "commit"}, {"oid": "b77b2bda34c1f3f2c8bbcea6ab0253556e443666", "url": "https://github.com/ls1intum/Artemis/commit/b77b2bda34c1f3f2c8bbcea6ab0253556e443666", "message": "Adjust code", "committedDate": "2020-01-22T01:19:39Z", "type": "commit"}, {"oid": "1e488ad70669040e8e558ccf21bc7813c3d509fa", "url": "https://github.com/ls1intum/Artemis/commit/1e488ad70669040e8e558ccf21bc7813c3d509fa", "message": "Merge branch 'develop' into feature/guided-tour/restart-tour", "committedDate": "2020-01-27T21:30:20Z", "type": "commit"}, {"oid": "ab7ad6ec71066dfcf387d04d961e057bb788491f", "url": "https://github.com/ls1intum/Artemis/commit/ab7ad6ec71066dfcf387d04d961e057bb788491f", "message": "Fix error in PR review", "committedDate": "2020-01-28T09:54:18Z", "type": "commit"}, {"oid": "a07a49dc26ec2276680bd45d2a48871f62f4f1c6", "url": "https://github.com/ls1intum/Artemis/commit/a07a49dc26ec2276680bd45d2a48871f62f4f1c6", "message": "Merge branch 'develop' into feature/guided-tour/restart-tour", "committedDate": "2020-01-28T09:55:05Z", "type": "commit"}, {"oid": "c8c45581772b7dc902735f3b578f4d771f3fb6ad", "url": "https://github.com/ls1intum/Artemis/commit/c8c45581772b7dc902735f3b578f4d771f3fb6ad", "message": "Update client test and run prettier", "committedDate": "2020-01-28T10:25:27Z", "type": "commit"}, {"oid": "9f9483cfadbd99c8c51884d46e3ec91206cb1274", "url": "https://github.com/ls1intum/Artemis/commit/9f9483cfadbd99c8c51884d46e3ec91206cb1274", "message": "Merge branch 'develop' into feature/guided-tour/restart-tour", "committedDate": "2020-01-28T11:18:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc0ODU1Mw==", "url": "https://github.com/ls1intum/Artemis/pull/1172#discussion_r371748553", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    User currentUser = userService.deleteGuidedTourSetting(settingsKey);\n          \n          \n            \n                    // Note: there is no explicit permission check here, because every user can delete the guided tour settings, e.g. by restarting a tutorial\n          \n          \n            \n                    User currentUser = userService.deleteGuidedTourSetting(settingsKey);", "author": "krusche", "createdAt": "2020-01-28T11:30:57Z", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/GuidedTourSettingsResource.java", "diffHunk": "@@ -46,4 +46,17 @@ public GuidedTourSettingsResource(UserService userService) {\n         User currentUser = userService.updateGuidedTourSettings(guidedTourSettings);\n         return new ResponseEntity<>(currentUser.getGuidedTourSettings(), null, HttpStatus.OK);\n     }\n+\n+    /**\n+     * DELETE /guided-tour-settings/:settingsKey : delete guided tour setting of the current user\n+     * @param settingsKey the guided tour settings key that of the setting that should be deleted\n+     * @return the guided tour settings\n+     */\n+    @DeleteMapping(\"/guided-tour-settings/{settingsKey}\")\n+    @PreAuthorize(\"hasAnyRole('USER', 'TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Set<GuidedTourSetting>> deleteGuidedTourSetting(@PathVariable String settingsKey) {\n+        log.debug(\"REST request to delete GuidedTourSetting : {}\", settingsKey);\n+        User currentUser = userService.deleteGuidedTourSetting(settingsKey);", "originalCommit": "9f9483cfadbd99c8c51884d46e3ec91206cb1274", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc0ODg0OA==", "url": "https://github.com/ls1intum/Artemis/pull/1172#discussion_r371748848", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * Delete a given guided tour setting of the currently logged in user\n          \n          \n            \n                 * Delete a given guided tour setting of the currently logged in user (e.g. when the user restarts a guided tutorial)", "author": "krusche", "createdAt": "2020-01-28T11:31:41Z", "path": "src/main/java/de/tum/in/www1/artemis/service/UserService.java", "diffHunk": "@@ -641,6 +640,23 @@ public User updateGuidedTourSettings(Set<GuidedTourSetting> guidedTourSettings)\n         return userRepository.save(loggedInUser);\n     }\n \n+    /**\n+     * Delete a given guided tour setting of the currently logged in user", "originalCommit": "9f9483cfadbd99c8c51884d46e3ec91206cb1274", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc0OTIxNQ==", "url": "https://github.com/ls1intum/Artemis/pull/1172#discussion_r371749215", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private List<HashMap<String, String>> tours = new ArrayList<>();\n          \n          \n            \n                private List<Map<String, String>> tours = new ArrayList<>();", "author": "krusche", "createdAt": "2020-01-28T11:32:36Z", "path": "src/main/java/de/tum/in/www1/artemis/config/GuidedTourConfiguration.java", "diffHunk": "@@ -0,0 +1,55 @@\n+package de.tum.in.www1.artemis.config;\n+\n+import java.util.*;\n+\n+import org.springframework.boot.context.properties.ConfigurationProperties;\n+import org.springframework.boot.context.properties.EnableConfigurationProperties;\n+import org.springframework.stereotype.Component;\n+\n+import de.tum.in.www1.artemis.domain.Exercise;\n+import de.tum.in.www1.artemis.domain.ProgrammingExercise;\n+\n+@Component\n+@EnableConfigurationProperties\n+@ConfigurationProperties(prefix = \"info.guided-tour\")\n+public class GuidedTourConfiguration {\n+\n+    private String courseShortName = \"\";\n+\n+    private List<HashMap<String, String>> tours = new ArrayList<>();", "originalCommit": "9f9483cfadbd99c8c51884d46e3ec91206cb1274", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc0OTI4Nw==", "url": "https://github.com/ls1intum/Artemis/pull/1172#discussion_r371749287", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public List<HashMap<String, String>> getTours() {\n          \n          \n            \n                public List<Map<String, String>> getTours() {", "author": "krusche", "createdAt": "2020-01-28T11:32:45Z", "path": "src/main/java/de/tum/in/www1/artemis/config/GuidedTourConfiguration.java", "diffHunk": "@@ -0,0 +1,55 @@\n+package de.tum.in.www1.artemis.config;\n+\n+import java.util.*;\n+\n+import org.springframework.boot.context.properties.ConfigurationProperties;\n+import org.springframework.boot.context.properties.EnableConfigurationProperties;\n+import org.springframework.stereotype.Component;\n+\n+import de.tum.in.www1.artemis.domain.Exercise;\n+import de.tum.in.www1.artemis.domain.ProgrammingExercise;\n+\n+@Component\n+@EnableConfigurationProperties\n+@ConfigurationProperties(prefix = \"info.guided-tour\")\n+public class GuidedTourConfiguration {\n+\n+    private String courseShortName = \"\";\n+\n+    private List<HashMap<String, String>> tours = new ArrayList<>();\n+\n+    public GuidedTourConfiguration() {\n+\n+    }\n+\n+    /**\n+     * Get the list of of the mapping tourKey -> exerciseIdentifier from the info.guided-tour configuration in the application.yml file\n+     * @return List of mappings of tourKey -> exerciseIdentifier\n+     */\n+    public List<HashMap<String, String>> getTours() {", "originalCommit": "9f9483cfadbd99c8c51884d46e3ec91206cb1274", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc0OTg0Ng==", "url": "https://github.com/ls1intum/Artemis/pull/1172#discussion_r371749846", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * DELETE guided-tour/participations/:participationId : delete the \"participationId\" participation of student participations for guided tours.\n          \n          \n            \n                 * DELETE guided-tour/participations/:participationId : delete the \"participationId\" participation of student participations for guided tutorials (e.g. when restarting a tutorial)\n          \n          \n            \n                 * Please note: all users can delete their own participation when it belongs to a guided tutorial", "author": "krusche", "createdAt": "2020-01-28T11:34:12Z", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ParticipationResource.java", "diffHunk": "@@ -586,7 +587,50 @@ else if (participation.getExercise() instanceof ProgrammingExercise) {\n         }\n \n         User user = userService.getUserWithGroupsAndAuthorities();\n-        checkAccessPermissionAtInstructor(participation, user);\n+\n+        checkAccessPermissionAtLeastInstructor(participation, user);\n+\n+        String username = participation.getStudent().getFirstName();\n+        var auditEvent = new AuditEvent(user.getLogin(), Constants.DELETE_PARTICIPATION, \"participation=\" + participation.getId());\n+        auditEventRepository.add(auditEvent);\n+        log.info(\"Delete Participation {} of exercise {} for {}, deleteBuildPlan: {}, deleteRepository: {} by {}\", participationId, participation.getExercise().getTitle(),\n+                username, deleteBuildPlan, deleteRepository, principal.getName());\n+        participationService.delete(participationId, deleteBuildPlan, deleteRepository);\n+        return ResponseEntity.ok().headers(HeaderUtil.createEntityDeletionAlert(applicationName, true, \"participation\", username)).build();\n+    }\n+\n+    /**\n+     * DELETE guided-tour/participations/:participationId : delete the \"participationId\" participation of student participations for guided tours.", "originalCommit": "9f9483cfadbd99c8c51884d46e3ec91206cb1274", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "c362840f1646484c4d1831b0d208b70832f26082", "url": "https://github.com/ls1intum/Artemis/commit/c362840f1646484c4d1831b0d208b70832f26082", "message": "Small changes from PR\r\n\r\nmostly additional comments", "committedDate": "2020-01-28T11:35:35Z", "type": "commit"}, {"oid": "fc620e383b5e97bf47722ecdc754b5306f2cdd0a", "url": "https://github.com/ls1intum/Artemis/commit/fc620e383b5e97bf47722ecdc754b5306f2cdd0a", "message": "forget change from HashMap to Map", "committedDate": "2020-01-28T11:37:52Z", "type": "commit"}]}