{"pr_number": 1200, "pr_title": "Feature/programming exercises/override results", "pr_createdAt": "2020-01-21T00:13:25Z", "pr_url": "https://github.com/ls1intum/Artemis/pull/1200", "timeline": [{"oid": "10da74b367e6e9b71d10f04c4bd32644ba504118", "url": "https://github.com/ls1intum/Artemis/commit/10da74b367e6e9b71d10f04c4bd32644ba504118", "message": "allow instructors to override manual results of programm exercises", "committedDate": "2020-01-16T07:14:12Z", "type": "commit"}, {"oid": "d586ad83107226e35eb24cf78d19fbc7f5ea5f7f", "url": "https://github.com/ls1intum/Artemis/commit/d586ad83107226e35eb24cf78d19fbc7f5ea5f7f", "message": "do not set forms to readonly when user can override", "committedDate": "2020-01-17T18:21:45Z", "type": "commit"}, {"oid": "a8e901f5908323e6877435afce788997fe61bf8a", "url": "https://github.com/ls1intum/Artemis/commit/a8e901f5908323e6877435afce788997fe61bf8a", "message": "Merge branch 'develop' into feature/programming-exercises/override-results", "committedDate": "2020-01-17T18:49:03Z", "type": "commit"}, {"oid": "3c1c0ddad924a3409bf3f2ff8d70a4d0e1db7382", "url": "https://github.com/ls1intum/Artemis/commit/3c1c0ddad924a3409bf3f2ff8d70a4d0e1db7382", "message": "fix code style", "committedDate": "2020-01-17T18:50:34Z", "type": "commit"}, {"oid": "c56f70b25131026b92722aa3f79c91ac11ff4550", "url": "https://github.com/ls1intum/Artemis/commit/c56f70b25131026b92722aa3f79c91ac11ff4550", "message": "Merge branch 'develop' into feature/programming-exercises/override-results", "committedDate": "2020-01-21T00:07:10Z", "type": "commit"}, {"oid": "add8aa0f05b86993215af1cc54675ae23296d72d", "url": "https://github.com/ls1intum/Artemis/commit/add8aa0f05b86993215af1cc54675ae23296d72d", "message": "Merge branch 'develop' into feature/programming-exercises/override-results", "committedDate": "2020-01-22T12:05:09Z", "type": "commit"}, {"oid": "104b2870459ef90f63b90399dca0c18531c5ed1d", "url": "https://github.com/ls1intum/Artemis/commit/104b2870459ef90f63b90399dca0c18531c5ed1d", "message": "Merge branch 'develop' into feature/programming-exercises/override-results", "committedDate": "2020-01-22T12:10:54Z", "type": "commit"}, {"oid": "64fec88388a9eaaf174f05dbd886d8cee64ad33a", "url": "https://github.com/ls1intum/Artemis/commit/64fec88388a9eaaf174f05dbd886d8cee64ad33a", "message": "implement canOverride logic for file upload exericses", "committedDate": "2020-01-22T12:59:41Z", "type": "commit"}, {"oid": "6fdca3c9e27d296dadfadb9ceddb3e3ccd078c46", "url": "https://github.com/ls1intum/Artemis/commit/6fdca3c9e27d296dadfadb9ceddb3e3ccd078c46", "message": "Merge branch 'develop' into feature/programming-exercises/override-results", "committedDate": "2020-01-22T13:00:07Z", "type": "commit"}, {"oid": "eec8ea42128ab2ca2fda9d36a7cfb530e0d34854", "url": "https://github.com/ls1intum/Artemis/commit/eec8ea42128ab2ca2fda9d36a7cfb530e0d34854", "message": "update logic for canoverride", "committedDate": "2020-01-22T23:04:33Z", "type": "commit"}, {"oid": "e69f7eba5d938aab394924f5d5839e7d140871e7", "url": "https://github.com/ls1intum/Artemis/commit/e69f7eba5d938aab394924f5d5839e7d140871e7", "message": "make sure results can only be overriden in specific cases on server side\n\nalso remove duplicated code and unifiy submission / result resources and services", "committedDate": "2020-01-23T20:23:54Z", "type": "commit"}, {"oid": "f0d057a0b783e46142d9e8183ae1368eb44b23ad", "url": "https://github.com/ls1intum/Artemis/commit/f0d057a0b783e46142d9e8183ae1368eb44b23ad", "message": "Merge branch 'develop' into feature/programming-exercises/override-results\n\n# Conflicts:\n#\tsrc/main/java/de/tum/in/www1/artemis/service/ProgrammingSubmissionService.java", "committedDate": "2020-01-23T20:28:03Z", "type": "commit"}, {"oid": "0c2ecc51130d7d9e7099f876ec02cc1ca47d8480", "url": "https://github.com/ls1intum/Artemis/commit/0c2ecc51130d7d9e7099f876ec02cc1ca47d8480", "message": "fix problems after merge", "committedDate": "2020-01-23T20:37:21Z", "type": "commit"}, {"oid": "121553db979f8debd22bc705f0efda13b203ddb0", "url": "https://github.com/ls1intum/Artemis/commit/121553db979f8debd22bc705f0efda13b203ddb0", "message": "fix tests", "committedDate": "2020-01-23T20:49:20Z", "type": "commit"}, {"oid": "81b5cea881abd71ed1ec5f35ec0c5e654244435e", "url": "https://github.com/ls1intum/Artemis/commit/81b5cea881abd71ed1ec5f35ec0c5e654244435e", "message": "improve java docs", "committedDate": "2020-01-23T20:54:40Z", "type": "commit"}, {"oid": "39ee988101a2a70abd5e217a26eecdee795e3026", "url": "https://github.com/ls1intum/Artemis/commit/39ee988101a2a70abd5e217a26eecdee795e3026", "message": "fix javadoc", "committedDate": "2020-01-23T21:01:24Z", "type": "commit"}, {"oid": "e7127f0c9076a71144abe431b3d7551352999da5", "url": "https://github.com/ls1intum/Artemis/commit/e7127f0c9076a71144abe431b3d7551352999da5", "message": "Merge branch 'develop' into feature/programming-exercises/override-results", "committedDate": "2020-01-24T20:19:19Z", "type": "commit"}, {"oid": "f5be0080a1ee182ac238c76c533c58d0ec1343f6", "url": "https://github.com/ls1intum/Artemis/commit/f5be0080a1ee182ac238c76c533c58d0ec1343f6", "message": "Merge branch 'develop' into feature/programming-exercises/override-results", "committedDate": "2020-01-25T13:30:52Z", "type": "commit"}, {"oid": "fd1340e493a3e5bd66f1bc45eae0233bcf508097", "url": "https://github.com/ls1intum/Artemis/commit/fd1340e493a3e5bd66f1bc45eae0233bcf508097", "message": "add tests for file upload assessment resource\n\nfix small logic error\nchange from bad request to forbidden when save, submit or override is not allowed", "committedDate": "2020-01-25T17:35:02Z", "type": "commit"}, {"oid": "6b5f2d3a6d278ad7b046d1346d1892ad3ed8dfb8", "url": "https://github.com/ls1intum/Artemis/commit/6b5f2d3a6d278ad7b046d1346d1892ad3ed8dfb8", "message": "add tests for the logic for overriding modeling assessments", "committedDate": "2020-01-25T21:24:43Z", "type": "commit"}, {"oid": "593f0ad7d39fd896e1397f0eba3cfdcf860df557", "url": "https://github.com/ls1intum/Artemis/commit/593f0ad7d39fd896e1397f0eba3cfdcf860df557", "message": "add tests for the logic for overriding text assessments", "committedDate": "2020-01-25T21:31:20Z", "type": "commit"}, {"oid": "22937abadb8ed6eeb2683a1c0a05d884b2e2ac49", "url": "https://github.com/ls1intum/Artemis/commit/22937abadb8ed6eeb2683a1c0a05d884b2e2ac49", "message": "fix logic in Result Resource regarding overriding existing assessments\n\nfix TODO for duplicated code\nadd tests for the logic for overriding programming assessments", "committedDate": "2020-01-25T22:04:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTAyNjQxNA==", "url": "https://github.com/ls1intum/Artemis/pull/1200#discussion_r371026414", "bodyText": "What if there is no assessment due date? I noticed this when testing, for exercises without assessment due date, a tutor cannot override his own assessment. The override button can be clicked but the tutor just receives a 403 from the backend then.", "author": "madwau", "createdAt": "2020-01-26T20:15:30Z", "path": "src/main/java/de/tum/in/www1/artemis/service/AssessmentService.java", "diffHunk": "@@ -94,6 +96,31 @@ public Result updateAssessmentAfterComplaint(Result originalResult, Exercise exe\n         return resultRepository.save(originalResult);\n     }\n \n+    /**\n+     * checks if the user can override an already submitted result. This is only possible if the same tutor overrides before the assessment due date\n+     * or if an instructor overrides it.\n+     *\n+     * If the result does not yet exist or is not yet submitted, this method returns true\n+     *\n+     * @param existingResult the existing result in case the result is updated (submitted or overridden)\n+     * @param exercise the exercise to which the submission and result belong and which potentially includes an assessment due date\n+     * @param user the user who initiates a request\n+     * @param isAtLeastInstructor whether the given user is an instructor for the given exercise\n+     * @return true of the the given user can override a potentially existing result\n+     */\n+    public boolean isAllowedToOverrideExistingResult(@NotNull Result existingResult, Exercise exercise, User user, boolean isAtLeastInstructor) {\n+        // if the assessor is null, the user can save / submit / override the existing result\n+        final var isAssessor = existingResult.getAssessor() == null || user.equals(existingResult.getAssessor());\n+        if (existingResult.getCompletionDate() == null) {\n+            // if the result exists, but was not yet submitted (i.e. completionDate not set), the tutor and the instructor can override, independent of the assessment due date\n+            return isAssessor || isAtLeastInstructor;\n+        }\n+        // if the result was already submitted, the tutor can only override before a potentially existing assessment due date\n+        var assessmentDueDate = exercise.getAssessmentDueDate();\n+        final var isBeforeAssessmentDueDate = assessmentDueDate != null && ZonedDateTime.now().isBefore(assessmentDueDate);", "originalCommit": "22937abadb8ed6eeb2683a1c0a05d884b2e2ac49", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTEyMDgyNA==", "url": "https://github.com/ls1intum/Artemis/pull/1200#discussion_r371120824", "bodyText": "That's intended. The general idea is that as soon as a student can see the result, it should not change anymore. So if the assessment due date has passed or there is no assessment due date, tutors cannot change the assessment any more after submitting it.\nIf the buttons are still shown on the client side, we should hide them", "author": "krusche", "createdAt": "2020-01-27T08:59:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTAyNjQxNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTE4MzA3OQ==", "url": "https://github.com/ls1intum/Artemis/pull/1200#discussion_r371183079", "bodyText": "Ok, makes sense, thanks for clarifying.", "author": "madwau", "createdAt": "2020-01-27T11:16:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTAyNjQxNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTAyNzUxMQ==", "url": "https://github.com/ls1intum/Artemis/pull/1200#discussion_r371027511", "bodyText": "Maybe the name of this method and the one below can be slightly changed to differentiate them from the method with the same name in the assessment service that has slightly different preconditions? For the latter, a concrete existing result is passed in as a parameter while the former do not actually require a result to exist to return a useful boolean value. Maybe something like isAllowedToCreateOrUpdateResult or isAllowedToCreateOrOverrideResult?", "author": "madwau", "createdAt": "2020-01-26T20:35:13Z", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/AssessmentResource.java", "diffHunk": "@@ -35,4 +60,67 @@ void validateExercise(Exercise exercise) throws BadRequestAlertException {\n             throw new BadRequestAlertException(\"The course belonging to this exercise does not exist\", getEntityName(), \"courseNotFound\");\n         }\n     }\n+\n+    /**\n+     * checks if the user can override an already submitted result. This is only possible if the same tutor overrides before the assessment due date\n+     * or if an instructor overrides it.\n+     *\n+     * If the result does not yet exist or is not yet submitted, this method returns true\n+     *\n+     * @param submission the submission that might include an existing result which would include information about the assessor\n+     * @param exercise the exercise to which the submission and result belong and which potentially includes an assessment due date\n+     * @param user the user who initiates a request\n+     * @param isAtLeastInstructor whether the given user is an instructor for the given exercise\n+     * @return true of the the given user can override a potentially existing result\n+     */\n+    protected boolean isAllowedToOverrideExistingResult(Submission submission, Exercise exercise, User user, boolean isAtLeastInstructor) {", "originalCommit": "22937abadb8ed6eeb2683a1c0a05d884b2e2ac49", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTEyMTA3OA==", "url": "https://github.com/ls1intum/Artemis/pull/1200#discussion_r371121078", "bodyText": "good point, will adapt it", "author": "krusche", "createdAt": "2020-01-27T08:59:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTAyNzUxMQ=="}], "type": "inlineReview"}, {"oid": "dc190810ac697f973db8890357812b95f2f2f7e0", "url": "https://github.com/ls1intum/Artemis/commit/dc190810ac697f973db8890357812b95f2f2f7e0", "message": "Merge branch 'develop' into feature/programming-exercises/override-results", "committedDate": "2020-01-27T11:29:59Z", "type": "commit"}, {"oid": "96eea4d8c250114cb3b5fd3e4c400373b09dc441", "url": "https://github.com/ls1intum/Artemis/commit/96eea4d8c250114cb3b5fd3e4c400373b09dc441", "message": "implement feedback from PR. Thanks!\n\nspecial logic for programming exercises", "committedDate": "2020-01-27T16:33:08Z", "type": "commit"}, {"oid": "56a9cc1cf030c992cb7dbbd9058aebb2e38ad73d", "url": "https://github.com/ls1intum/Artemis/commit/56a9cc1cf030c992cb7dbbd9058aebb2e38ad73d", "message": "Merge branch 'develop' into feature/programming-exercises/override-results", "committedDate": "2020-01-27T16:33:15Z", "type": "commit"}, {"oid": "6b7ef6b09f57809b48bae27b449b7bab2533ee16", "url": "https://github.com/ls1intum/Artemis/commit/6b7ef6b09f57809b48bae27b449b7bab2533ee16", "message": "Merge branch 'develop' into feature/programming-exercises/override-results", "committedDate": "2020-01-27T17:11:15Z", "type": "commit"}, {"oid": "e6db3f10ead561d7eaaa228fa907157c2ebdd544", "url": "https://github.com/ls1intum/Artemis/commit/e6db3f10ead561d7eaaa228fa907157c2ebdd544", "message": "fix canOverride and isAssessor for manual programming exercise results", "committedDate": "2020-01-27T20:54:17Z", "type": "commit"}, {"oid": "733dd030895df0c62f80c43642e60dae016f39f9", "url": "https://github.com/ls1intum/Artemis/commit/733dd030895df0c62f80c43642e60dae016f39f9", "message": "fix javadoc", "committedDate": "2020-01-27T21:12:31Z", "type": "commit"}, {"oid": "b990344919d8bb4330c83ae5023baea7758290b2", "url": "https://github.com/ls1intum/Artemis/commit/b990344919d8bb4330c83ae5023baea7758290b2", "message": "Merge branch 'develop' into feature/programming-exercises/override-results\n\n# Conflicts:\n#\tsrc/main/java/de/tum/in/www1/artemis/web/rest/ResultResource.java", "committedDate": "2020-01-27T21:27:33Z", "type": "commit"}, {"oid": "2da09da03d10815fa38b6588abff04fbac419369", "url": "https://github.com/ls1intum/Artemis/commit/2da09da03d10815fa38b6588abff04fbac419369", "message": "Merge branch 'develop' into feature/programming-exercises/override-results", "committedDate": "2020-01-27T21:31:23Z", "type": "commit"}, {"oid": "ca4ec9425c8f9ac6ac969a6e11adfee8ecf2bbbe", "url": "https://github.com/ls1intum/Artemis/commit/ca4ec9425c8f9ac6ac969a6e11adfee8ecf2bbbe", "message": "Fix NPE for manual programming result dialog", "committedDate": "2020-01-27T23:38:05Z", "type": "commit"}, {"oid": "e5b0966e35f1d012b3bb29820d6d758e91b9b711", "url": "https://github.com/ls1intum/Artemis/commit/e5b0966e35f1d012b3bb29820d6d758e91b9b711", "message": "Fix participation NPE for manual programming result dialog", "committedDate": "2020-01-27T23:55:27Z", "type": "commit"}, {"oid": "1111e48723001a42b6234d515339078f3627a52f", "url": "https://github.com/ls1intum/Artemis/commit/1111e48723001a42b6234d515339078f3627a52f", "message": "Merge branch 'develop' into feature/programming-exercises/override-results", "committedDate": "2020-01-28T09:00:21Z", "type": "commit"}, {"oid": "98d953ecced50cd8db17fc06f65d409fce9cad40", "url": "https://github.com/ls1intum/Artemis/commit/98d953ecced50cd8db17fc06f65d409fce9cad40", "message": "workaround to fix missing assessor after websocket update", "committedDate": "2020-01-28T09:38:59Z", "type": "commit"}, {"oid": "92a40960ceb5b6ff6ca43a66d93d7f0426d179eb", "url": "https://github.com/ls1intum/Artemis/commit/92a40960ceb5b6ff6ca43a66d93d7f0426d179eb", "message": "add additional check on server side", "committedDate": "2020-01-28T09:56:19Z", "type": "commit"}, {"oid": "3c7a3f1ad4e49bca9bc095a9d0f250d244de9c28", "url": "https://github.com/ls1intum/Artemis/commit/3c7a3f1ad4e49bca9bc095a9d0f250d244de9c28", "message": "fix logic error due to missing assessor\n\nthis also fixes the tests", "committedDate": "2020-01-28T10:29:38Z", "type": "commit"}]}