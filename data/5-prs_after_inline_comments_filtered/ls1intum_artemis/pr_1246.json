{"pr_number": 1246, "pr_title": "Chore/test coverage/participation resource", "pr_createdAt": "2020-02-18T08:33:57Z", "pr_url": "https://github.com/ls1intum/Artemis/pull/1246", "timeline": [{"oid": "b12955a6087094c25ce4cf208958bb4f3f36c2bc", "url": "https://github.com/ls1intum/Artemis/commit/b12955a6087094c25ce4cf208958bb4f3f36c2bc", "message": "additional test cases for participation resource", "committedDate": "2020-02-18T08:06:08Z", "type": "commit"}, {"oid": "dcbca597490f9c1869acebea5683c82c56e3092d", "url": "https://github.com/ls1intum/Artemis/commit/dcbca597490f9c1869acebea5683c82c56e3092d", "message": "More test cases for creating participation", "committedDate": "2020-02-18T09:02:19Z", "type": "commit"}, {"oid": "2ce38ee7f22851198339b047a476e1361006a0ef", "url": "https://github.com/ls1intum/Artemis/commit/2ce38ee7f22851198339b047a476e1361006a0ef", "message": "Added test case for programming exercise participation", "committedDate": "2020-02-18T12:12:06Z", "type": "commit"}, {"oid": "e8d2c2e1ade4e59dfa0173834e39bcc438c4f2ab", "url": "https://github.com/ls1intum/Artemis/commit/e8d2c2e1ade4e59dfa0173834e39bcc438c4f2ab", "message": "Add test cases for resume programming exercise participation", "committedDate": "2020-02-18T13:00:14Z", "type": "commit"}, {"oid": "4475f11fd81df228b1c7cdd9f58902ac24bd33d4", "url": "https://github.com/ls1intum/Artemis/commit/4475f11fd81df228b1c7cdd9f58902ac24bd33d4", "message": "Fix broken tests and move common code", "committedDate": "2020-02-18T14:29:17Z", "type": "commit"}, {"oid": "4e4cfda5a3c9b859f8af3f9d1c81ea2392f72005", "url": "https://github.com/ls1intum/Artemis/commit/4e4cfda5a3c9b859f8af3f9d1c81ea2392f72005", "message": "Fully cover resume programming participation with tests", "committedDate": "2020-02-18T15:55:35Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDc5MTcyNQ==", "url": "https://github.com/ls1intum/Artemis/pull/1246#discussion_r380791725", "bodyText": "I check before to ensure that we don't have uncaught NullPointerException", "author": "maxr96", "createdAt": "2020-02-18T16:36:22Z", "path": "src/main/java/de/tum/in/www1/artemis/service/ProgrammingExerciseParticipationService.java", "diffHunk": "@@ -111,13 +111,18 @@ public TemplateProgrammingExerciseParticipation findTemplateParticipationByProgr\n      */\n     @Transactional(readOnly = true)\n     public ProgrammingExerciseStudentParticipation findStudentParticipationByExerciseIdAndStudentId(Long exerciseId, String username) throws EntityNotFoundException {\n-        Optional<ProgrammingExerciseStudentParticipation> participation = studentParticipationRepository.findByExerciseIdAndStudentLogin(exerciseId, username);\n-        if (participation.isEmpty()) {\n+        Optional<ProgrammingExerciseStudentParticipation> optionalParticipation = studentParticipationRepository.findByExerciseIdAndStudentLogin(exerciseId, username);\n+        if (optionalParticipation.isEmpty()) {\n             throw new EntityNotFoundException(\"participation could not be found by exerciseId \" + exerciseId + \" and user \" + username);\n         }\n+        var participation = optionalParticipation.get();\n+        // If the exercise associated with participation is not programming exercise return null\n+        if (participation.getProgrammingExercise() == null) {", "originalCommit": "4e4cfda5a3c9b859f8af3f9d1c81ea2392f72005", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzc3MDg1MQ==", "url": "https://github.com/ls1intum/Artemis/pull/1246#discussion_r383770851", "bodyText": "please revert, your test case is wrong if you experience a null pointer exception. Also returning null would lead to other problems here", "author": "krusche", "createdAt": "2020-02-25T09:54:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDc5MTcyNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDgyMDY1Mg==", "url": "https://github.com/ls1intum/Artemis/pull/1246#discussion_r384820652", "bodyText": "Reverted", "author": "maxr96", "createdAt": "2020-02-26T23:02:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDc5MTcyNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDc5MjQxNA==", "url": "https://github.com/ls1intum/Artemis/pull/1246#discussion_r380792414", "bodyText": "This part was never reachable before since we checked in the method above is optional is empty and throw an exception.", "author": "maxr96", "createdAt": "2020-02-18T16:37:31Z", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ParticipationResource.java", "diffHunk": "@@ -196,15 +196,10 @@ public ParticipationResource(ParticipationService participationService, Programm\n \n         ProgrammingExerciseStudentParticipation participation = programmingExerciseParticipationService.findStudentParticipationByExerciseIdAndStudentId(exerciseId,\n                 principal.getName());\n-        if (participation == null) {", "originalCommit": "4e4cfda5a3c9b859f8af3f9d1c81ea2392f72005", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzc3Mjk3Mg==", "url": "https://github.com/ls1intum/Artemis/pull/1246#discussion_r383772972", "bodyText": "please revert and use the new version of develop", "author": "krusche", "createdAt": "2020-02-25T09:57:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDc5MjQxNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDgyMDU3OA==", "url": "https://github.com/ls1intum/Artemis/pull/1246#discussion_r384820578", "bodyText": "Done", "author": "maxr96", "createdAt": "2020-02-26T23:02:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDc5MjQxNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDc5MjkzNA==", "url": "https://github.com/ls1intum/Artemis/pull/1246#discussion_r380792934", "bodyText": "Only in the case if participation is null, which means that exercise attached to the participation is not of Programming Exercise type we reach this part", "author": "maxr96", "createdAt": "2020-02-18T16:38:20Z", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ParticipationResource.java", "diffHunk": "@@ -215,21 +210,20 @@ public ParticipationResource(ParticipationService participationService, Programm\n             participation = participationService.resumeExercise(participation);\n             // Note: in this case we might need an empty commit to make sure the build plan works correctly for subsequent student commits\n             participation = participationService.performEmptyCommit(participation);\n-            if (participation != null) {\n-                addLatestResultToParticipation(participation);\n+            addLatestResultToParticipation(participation);\n+            participation.getExercise().filterSensitiveInformation();\n+            return ResponseEntity.ok().headers(HeaderUtil.createEntityUpdateAlert(applicationName, true, ENTITY_NAME, participation.getStudent().getName())).body(participation);\n+        }\n+        else {", "originalCommit": "4e4cfda5a3c9b859f8af3f9d1c81ea2392f72005", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzc3MzE3NQ==", "url": "https://github.com/ls1intum/Artemis/pull/1246#discussion_r383773175", "bodyText": "revert", "author": "krusche", "createdAt": "2020-02-25T09:58:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDc5MjkzNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDgyMDU0Nw==", "url": "https://github.com/ls1intum/Artemis/pull/1246#discussion_r384820547", "bodyText": "Done", "author": "maxr96", "createdAt": "2020-02-26T23:02:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDc5MjkzNA=="}], "type": "inlineReview"}, {"oid": "346ac1f57528b034848b57e83cbad6efaf20eea2", "url": "https://github.com/ls1intum/Artemis/commit/346ac1f57528b034848b57e83cbad6efaf20eea2", "message": "Remove unused code", "committedDate": "2020-02-18T16:38:58Z", "type": "commit"}, {"oid": "038b00b5c6da384403f1a04ca41aa7be195c6d23", "url": "https://github.com/ls1intum/Artemis/commit/038b00b5c6da384403f1a04ca41aa7be195c6d23", "message": "Merge branch 'develop' into chore/test-coverage/participation-resource", "committedDate": "2020-02-18T16:52:47Z", "type": "commit"}, {"oid": "ed95884d9153c31df235c0cbd31d40147b33c3c4", "url": "https://github.com/ls1intum/Artemis/commit/ed95884d9153c31df235c0cbd31d40147b33c3c4", "message": "Merge branch 'develop' into chore/test-coverage/participation-resource", "committedDate": "2020-02-23T20:45:53Z", "type": "commit"}, {"oid": "8d144842b865747397588f98eb7c012bda824e82", "url": "https://github.com/ls1intum/Artemis/commit/8d144842b865747397588f98eb7c012bda824e82", "message": "Add test case for getting all participations for exercise", "committedDate": "2020-02-23T21:17:57Z", "type": "commit"}, {"oid": "7b460ce819bb8bcd5d7f46270b0090484b5a989b", "url": "https://github.com/ls1intum/Artemis/commit/7b460ce819bb8bcd5d7f46270b0090484b5a989b", "message": "Add test case for getting all participations with results for exercise", "committedDate": "2020-02-23T22:50:15Z", "type": "commit"}, {"oid": "28d943035ee76f34ffd4c52a457f9de6147de49f", "url": "https://github.com/ls1intum/Artemis/commit/28d943035ee76f34ffd4c52a457f9de6147de49f", "message": "Add test case for getting all participations for course", "committedDate": "2020-02-24T11:53:04Z", "type": "commit"}, {"oid": "29b8f580b23c21313402064467b4401af455326e", "url": "https://github.com/ls1intum/Artemis/commit/29b8f580b23c21313402064467b4401af455326e", "message": "Add test case for update participation", "committedDate": "2020-02-24T21:44:37Z", "type": "commit"}, {"oid": "cf9bf95ef7433425e03e0be528757a7a77f93367", "url": "https://github.com/ls1intum/Artemis/commit/cf9bf95ef7433425e03e0be528757a7a77f93367", "message": "Add test case for get participation", "committedDate": "2020-02-24T22:13:17Z", "type": "commit"}, {"oid": "1471e766f5bb03221a1ec9b2616e42cde5e3ac43", "url": "https://github.com/ls1intum/Artemis/commit/1471e766f5bb03221a1ec9b2616e42cde5e3ac43", "message": "Add test case for get participation build artifact", "committedDate": "2020-02-24T23:15:35Z", "type": "commit"}, {"oid": "2c959daf286e886227d26a5174e573182d76a48e", "url": "https://github.com/ls1intum/Artemis/commit/2c959daf286e886227d26a5174e573182d76a48e", "message": "Add test case for get participation status", "committedDate": "2020-02-25T00:47:06Z", "type": "commit"}, {"oid": "ae5f8bdec5ca6fbb708ebf44ed0ee4a796e7abbf", "url": "https://github.com/ls1intum/Artemis/commit/ae5f8bdec5ca6fbb708ebf44ed0ee4a796e7abbf", "message": "Add test case for get submissions of participation", "committedDate": "2020-02-25T00:54:03Z", "type": "commit"}, {"oid": "8a1643c30818c8aec55c322c9f271b934b1e1d1b", "url": "https://github.com/ls1intum/Artemis/commit/8a1643c30818c8aec55c322c9f271b934b1e1d1b", "message": "Add test case for cleanup build plan", "committedDate": "2020-02-25T01:01:32Z", "type": "commit"}, {"oid": "68ff6ee1a667978bc7b6bb0bad1ca48c464885e3", "url": "https://github.com/ls1intum/Artemis/commit/68ff6ee1a667978bc7b6bb0bad1ca48c464885e3", "message": "Add test case for get participation", "committedDate": "2020-02-25T07:48:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzcwNjE0NQ==", "url": "https://github.com/ls1intum/Artemis/pull/1246#discussion_r383706145", "bodyText": "The endpoint was not reachable as it could not map the value from the path, so I changed it", "author": "maxr96", "createdAt": "2020-02-25T07:49:25Z", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ParticipationResource.java", "diffHunk": "@@ -561,12 +550,12 @@ else if (quizExercise.isSubmissionAllowed()) {\n     /**\n      * GET /participations/:participationId/status: get build status of the user's participation for the \"participationId\" participation.\n      *\n-     * @param id the participation participationId\n+     * @param participationId the participation participationId\n      * @return the ResponseEntity with status 200 (OK) and with body the participation, or with status 404 (Not Found)\n      */\n-    @GetMapping(value = \"/participations/{participationId}/status\")\n-    public ResponseEntity<?> getParticipationStatus(@PathVariable Long id) {\n-        StudentParticipation participation = participationService.findOneStudentParticipation(id);\n+    @GetMapping(\"/participations/{participationId}/status\")\n+    public ResponseEntity<?> getParticipationStatus(@PathVariable Long participationId) {", "originalCommit": "68ff6ee1a667978bc7b6bb0bad1ca48c464885e3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzc3NDg4NQ==", "url": "https://github.com/ls1intum/Artemis/pull/1246#discussion_r383774885", "bodyText": "please delete the whole end point", "author": "krusche", "createdAt": "2020-02-25T10:00:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzcwNjE0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDgyMDQ5Mw==", "url": "https://github.com/ls1intum/Artemis/pull/1246#discussion_r384820493", "bodyText": "I merged this changed from the develop", "author": "maxr96", "createdAt": "2020-02-26T23:02:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzcwNjE0NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzcwNjMwMg==", "url": "https://github.com/ls1intum/Artemis/pull/1246#discussion_r383706302", "bodyText": "This should occur first to catch nulls", "author": "maxr96", "createdAt": "2020-02-25T07:49:51Z", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ParticipationResource.java", "diffHunk": "@@ -267,13 +257,12 @@ private void addLatestResultToParticipation(Participation participation) {\n         if (participation.getId() == null) {\n             return createParticipation(participation);\n         }\n+        if (participation.getPresentationScore() == null || participation.getPresentationScore() < 0) {", "originalCommit": "68ff6ee1a667978bc7b6bb0bad1ca48c464885e3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzc3MzUzOQ==", "url": "https://github.com/ls1intum/Artemis/pull/1246#discussion_r383773539", "bodyText": "ok", "author": "krusche", "createdAt": "2020-02-25T09:58:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzcwNjMwMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzc3NTUyMA==", "url": "https://github.com/ls1intum/Artemis/pull/1246#discussion_r383775520", "bodyText": "good! this change is also needed in the other PR", "author": "krusche", "createdAt": "2020-02-25T10:01:52Z", "path": "src/test/java/de/tum/in/www1/artemis/ParticipationIntegrationTest.java", "diffHunk": "@@ -67,11 +87,21 @@ public void initTestCase() {\n         }\n         modelingExercise.setTitle(\"UML Class Diagram\");\n         exerciseRepo.save(modelingExercise);\n+\n+        programmingExercise = ModelFactory.generateProgrammingExercise(ZonedDateTime.now().minusDays(1), ZonedDateTime.now().plusDays(1), course);\n+        programmingExercise = exerciseRepo.save(programmingExercise);\n+        course.addExercises(programmingExercise);\n+        course = courseRepo.save(course);\n+\n+        doReturn(\"Success\").when(continuousIntegrationService).copyBuildPlan(any(), any(), any(), any(), any());\n+        doNothing().when(continuousIntegrationService).configureBuildPlan(any());\n+        doNothing().when(continuousIntegrationService).performEmptySetupCommit(any());\n     }\n \n     @AfterEach\n     public void tearDown() {\n         database.resetDatabase();\n+        Feature.PROGRAMMING_EXERCISES.enable();", "originalCommit": "68ff6ee1a667978bc7b6bb0bad1ca48c464885e3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDgxNTk0Nw==", "url": "https://github.com/ls1intum/Artemis/pull/1246#discussion_r384815947", "bodyText": "Added this to the other PR as well", "author": "maxr96", "createdAt": "2020-02-26T22:50:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzc3NTUyMA=="}], "type": "inlineReview"}, {"oid": "1cd93cb55cb8dee7ee73d1dfdd55ff8fb73fbefd", "url": "https://github.com/ls1intum/Artemis/commit/1cd93cb55cb8dee7ee73d1dfdd55ff8fb73fbefd", "message": "Merge branch 'develop' into chore/test-coverage/participation-resource\n\n# Conflicts:\n#\tsrc/main/java/de/tum/in/www1/artemis/web/rest/ParticipationResource.java", "committedDate": "2020-02-26T22:49:27Z", "type": "commit"}, {"oid": "2663242e0a7645296a2e418d9580bd76343cf85e", "url": "https://github.com/ls1intum/Artemis/commit/2663242e0a7645296a2e418d9580bd76343cf85e", "message": "Remove the tests that are not used anymore and add additional tests", "committedDate": "2020-02-26T22:59:21Z", "type": "commit"}, {"oid": "3ede44c78a165ec7b9631c024f91cc3d78dfcc5d", "url": "https://github.com/ls1intum/Artemis/commit/3ede44c78a165ec7b9631c024f91cc3d78dfcc5d", "message": "Add test case for getting participation when submission is allowed", "committedDate": "2020-02-26T23:38:24Z", "type": "commit"}, {"oid": "10c5eeb1c5c513a48cf66622ee1b0aeab8e82896", "url": "https://github.com/ls1intum/Artemis/commit/10c5eeb1c5c513a48cf66622ee1b0aeab8e82896", "message": "Two additional test cases for get participation", "committedDate": "2020-02-27T00:03:44Z", "type": "commit"}, {"oid": "38008f5fb837ed6e5cb1f77c886b83624a03021a", "url": "https://github.com/ls1intum/Artemis/commit/38008f5fb837ed6e5cb1f77c886b83624a03021a", "message": "Merge branch 'develop' into chore/test-coverage/participation-resource", "committedDate": "2020-02-29T15:12:44Z", "type": "commit"}, {"oid": "41cecfa4177fd35c04509f50cc1b0fdd6bdc7b17", "url": "https://github.com/ls1intum/Artemis/commit/41cecfa4177fd35c04509f50cc1b0fdd6bdc7b17", "message": "Merge branch 'develop' into chore/test-coverage/participation-resource", "committedDate": "2020-02-29T16:13:45Z", "type": "commit"}]}