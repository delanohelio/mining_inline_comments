{"pr_number": 2043, "pr_title": "Improve Distributed Quiz Exercise Cache Code", "pr_createdAt": "2020-08-20T14:26:25Z", "pr_url": "https://github.com/ls1intum/Artemis/pull/2043", "timeline": [{"oid": "8e874afd9eb4488a0dab2858af69f35636f68645", "url": "https://github.com/ls1intum/Artemis/commit/8e874afd9eb4488a0dab2858af69f35636f68645", "message": "Make task classes final", "committedDate": "2020-08-20T13:51:27Z", "type": "commit"}, {"oid": "0b02bbecd629210591507f0e9d8b0bdad32d25eb", "url": "https://github.com/ls1intum/Artemis/commit/0b02bbecd629210591507f0e9d8b0bdad32d25eb", "message": "Remove redundant explicit required attribute on Autowired", "committedDate": "2020-08-20T13:52:12Z", "type": "commit"}, {"oid": "aa4ca553aa78765bcfa01d3adec31c2b206026fc", "url": "https://github.com/ls1intum/Artemis/commit/aa4ca553aa78765bcfa01d3adec31c2b206026fc", "message": "Set EmptzyQuizExerciseCache id to null, document it and throw on clear()", "committedDate": "2020-08-20T13:55:20Z", "type": "commit"}, {"oid": "bf15a4a34bb51adeb651a307b68f8872a2d7977f", "url": "https://github.com/ls1intum/Artemis/commit/bf15a4a34bb51adeb651a307b68f8872a2d7977f", "message": "Rename to exerciseId", "committedDate": "2020-08-20T13:55:47Z", "type": "commit"}, {"oid": "fdaf9b2c1ad2f731d61719ca6b934a6e12e6073c", "url": "https://github.com/ls1intum/Artemis/commit/fdaf9b2c1ad2f731d61719ca6b934a6e12e6073c", "message": "Fix if code style", "committedDate": "2020-08-20T13:57:04Z", "type": "commit"}, {"oid": "e3d367a6f36c8f7aaf7400d3992b14a49fd25d63", "url": "https://github.com/ls1intum/Artemis/commit/e3d367a6f36c8f7aaf7400d3992b14a49fd25d63", "message": "Rename and document the cache serializer", "committedDate": "2020-08-20T13:57:45Z", "type": "commit"}, {"oid": "3feb2500de99e6a9a06cecb7fbfc3139c60f5729", "url": "https://github.com/ls1intum/Artemis/commit/3feb2500de99e6a9a06cecb7fbfc3139c60f5729", "message": "Document the distributed cache more", "committedDate": "2020-08-20T13:58:09Z", "type": "commit"}, {"oid": "f24737114f4cf55fad8cf216be9cb0eab08c8fb1", "url": "https://github.com/ls1intum/Artemis/commit/f24737114f4cf55fad8cf216be9cb0eab08c8fb1", "message": "Add a bit more documentation to the QuizExerciseCache itself", "committedDate": "2020-08-20T13:59:02Z", "type": "commit"}, {"oid": "5ee064df7f50a4a817998bf03f9ef4317b12e8ac", "url": "https://github.com/ls1intum/Artemis/commit/5ee064df7f50a4a817998bf03f9ef4317b12e8ac", "message": "Introduce QuizCache class to encapsulate the quiz cache behavior", "committedDate": "2020-08-20T14:01:30Z", "type": "commit"}, {"oid": "0921653f317bdac099dc69ab5fda1b12a501e95b", "url": "https://github.com/ls1intum/Artemis/commit/0921653f317bdac099dc69ab5fda1b12a501e95b", "message": "Create a new quiz cache in the constructor", "committedDate": "2020-08-20T14:27:52Z", "type": "commit"}, {"oid": "f57b544269ea1592171513f30cb58d66ebf0fc68", "url": "https://github.com/ls1intum/Artemis/commit/f57b544269ea1592171513f30cb58d66ebf0fc68", "message": "Improve code style", "committedDate": "2020-08-20T15:07:32Z", "type": "commit"}, {"oid": "90888b6e19214ffcd1d2c3c4f5b0f17c97fc22ba", "url": "https://github.com/ls1intum/Artemis/commit/90888b6e19214ffcd1d2c3c4f5b0f17c97fc22ba", "message": "Merge branch 'develop' into chore/quiz-exercise-cache", "committedDate": "2020-08-24T12:37:30Z", "type": "commit"}, {"oid": "ca919d673798fcabbd68dc756e224bac29adf895", "url": "https://github.com/ls1intum/Artemis/commit/ca919d673798fcabbd68dc756e224bac29adf895", "message": "Improve handling null", "committedDate": "2020-08-25T22:22:14Z", "type": "commit"}, {"oid": "67d190869c75ee324205fa6f9b11a3b6e7e65a7a", "url": "https://github.com/ls1intum/Artemis/commit/67d190869c75ee324205fa6f9b11a3b6e7e65a7a", "message": "Change LOG into log again", "committedDate": "2020-08-25T22:23:47Z", "type": "commit"}, {"oid": "bfd0e4ba19bad328b14a1d460e79653f8c65b189", "url": "https://github.com/ls1intum/Artemis/commit/bfd0e4ba19bad328b14a1d460e79653f8c65b189", "message": "Remove unnecessary empty lines", "committedDate": "2020-08-26T15:58:16Z", "type": "commit"}, {"oid": "16d690415963bdaab432f2657354eafb72bc8900", "url": "https://github.com/ls1intum/Artemis/commit/16d690415963bdaab432f2657354eafb72bc8900", "message": "Test more different situations and interactions with live quiz exercises", "committedDate": "2020-08-26T16:11:32Z", "type": "commit"}, {"oid": "265d8f660400e7b2d442c39624372b1f53e9c7e2", "url": "https://github.com/ls1intum/Artemis/commit/265d8f660400e7b2d442c39624372b1f53e9c7e2", "message": "Submit the submission in the test", "committedDate": "2020-08-26T16:29:44Z", "type": "commit"}, {"oid": "0869d090fe90a78f0c12945c227f03ffdaf4703f", "url": "https://github.com/ls1intum/Artemis/commit/0869d090fe90a78f0c12945c227f03ffdaf4703f", "message": "Increase the waiting periods", "committedDate": "2020-08-26T17:38:34Z", "type": "commit"}, {"oid": "46d1c431f48f2b3d63042d3aec55cb447e31927a", "url": "https://github.com/ls1intum/Artemis/commit/46d1c431f48f2b3d63042d3aec55cb447e31927a", "message": "Merge branch 'develop' into chore/quiz-exercise-cache", "committedDate": "2020-08-26T17:56:33Z", "type": "commit"}, {"oid": "89dcf8da3c35e3c4d6b63196c47c147cc66bf390", "url": "https://github.com/ls1intum/Artemis/commit/89dcf8da3c35e3c4d6b63196c47c147cc66bf390", "message": "Improve test consistency and document times", "committedDate": "2020-08-26T22:04:07Z", "type": "commit"}, {"oid": "519c530ec1e6eb72f178d31ec760e3dad87af528", "url": "https://github.com/ls1intum/Artemis/commit/519c530ec1e6eb72f178d31ec760e3dad87af528", "message": "Improve order of operations when updating exercise scheduling", "committedDate": "2020-08-26T22:06:01Z", "type": "commit"}, {"oid": "87a3c00f21d4ec970eceeafb60b22a33f5f4ef43", "url": "https://github.com/ls1intum/Artemis/commit/87a3c00f21d4ec970eceeafb60b22a33f5f4ef43", "message": "Improve usage of the near cache, cache directly after write", "committedDate": "2020-08-26T22:19:15Z", "type": "commit"}, {"oid": "0cc6e007a25ab8976ef6cff63fcc33637ee66583", "url": "https://github.com/ls1intum/Artemis/commit/0cc6e007a25ab8976ef6cff63fcc33637ee66583", "message": "Simplify the process cached submissions loop", "committedDate": "2020-08-26T22:20:20Z", "type": "commit"}, {"oid": "817e8b81840cdb9acc11cf89618d4cdc7f3153c0", "url": "https://github.com/ls1intum/Artemis/commit/817e8b81840cdb9acc11cf89618d4cdc7f3153c0", "message": "Merge branch 'develop' into chore/quiz-exercise-cache", "committedDate": "2020-08-27T20:35:50Z", "type": "commit"}, {"oid": "20f71dd079d3886ee38e1aa4116cfa60b4434043", "url": "https://github.com/ls1intum/Artemis/commit/20f71dd079d3886ee38e1aa4116cfa60b4434043", "message": "Merge branch 'develop' into chore/quiz-exercise-cache", "committedDate": "2020-08-27T20:46:50Z", "type": "commit"}, {"oid": "2d8cd2879f492751aaf7cf486f93e764ac0ce8dc", "url": "https://github.com/ls1intum/Artemis/commit/2d8cd2879f492751aaf7cf486f93e764ac0ce8dc", "message": "Merge branch 'develop' into chore/quiz-exercise-cache", "committedDate": "2020-08-28T11:39:36Z", "type": "commit"}, {"oid": "3d37dfe054ccf8f01a0501ba72e2ed228277c778", "url": "https://github.com/ls1intum/Artemis/commit/3d37dfe054ccf8f01a0501ba72e2ed228277c778", "message": "Merge branch 'develop' into chore/quiz-exercise-cache", "committedDate": "2020-09-15T10:07:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODU0OTUxMQ==", "url": "https://github.com/ls1intum/Artemis/pull/2043#discussion_r488549511", "bodyText": "Codacy found an issue: The constant name 'log' doesn't match '[A-Z][A-Z_0-9]*'", "author": "artemis-bot", "createdAt": "2020-09-15T10:12:07Z", "path": "src/main/java/de/tum/in/www1/artemis/service/scheduled/quiz/QuizCache.java", "diffHunk": "@@ -0,0 +1,264 @@\n+package de.tum.in.www1.artemis.service.scheduled.quiz;\n+\n+import java.util.*;\n+import java.util.function.UnaryOperator;\n+import java.util.stream.Collectors;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import com.hazelcast.config.*;\n+import com.hazelcast.core.HazelcastInstance;\n+import com.hazelcast.map.IMap;\n+import com.hazelcast.topic.ITopic;\n+\n+import de.tum.in.www1.artemis.config.Constants;\n+import de.tum.in.www1.artemis.domain.quiz.QuizExercise;\n+\n+/**\n+ * This class manages all {@link QuizExerciseCache}s for all cached quiz exercises.\n+ * <p>\n+ * It encapsulates the Hazelcast objects to avoid unsafe actions on them and to prevent mistakes.\n+ * Hazelcast distributed objects are more database like, which means that modifications of the objects themselves\n+ * will not have any effect until they are send to all other instances, e.g. by replacing the value in the data structure.\n+ * <p>\n+ * To handle this better, we provide methods in this class that make {@linkplain #getReadCacheFor(Long) read-operations} and \n+ * {@linkplain #getTransientWriteCacheFor(Long) write operations on transient properties} easier and less error prone; \n+ * and that allow for {@linkplain #performCacheWrite(Long, UnaryOperator) atomic writes} (including an \n+ * {@linkplain #performCacheWriteIfPresent(Long, UnaryOperator) if-present variant}).\n+ */\n+final class QuizCache {\n+\n+    private static final Logger log = LoggerFactory.getLogger(QuizCache.class);", "originalCommit": "3d37dfe054ccf8f01a0501ba72e2ed228277c778", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODU0OTUyMQ==", "url": "https://github.com/ls1intum/Artemis/pull/2043#discussion_r488549521", "bodyText": "Codacy found an issue: The constant name 'log' doesn't match '[A-Z][A-Z_0-9]*'", "author": "artemis-bot", "createdAt": "2020-09-15T10:12:09Z", "path": "src/main/java/de/tum/in/www1/artemis/service/scheduled/quiz/QuizScheduleService.java", "diffHunk": "@@ -46,16 +43,10 @@\n @Service\n public class QuizScheduleService {\n \n-    static final Logger log = LoggerFactory.getLogger(QuizScheduleService.class);\n+    private static final Logger log = LoggerFactory.getLogger(QuizScheduleService.class);", "originalCommit": "3d37dfe054ccf8f01a0501ba72e2ed228277c778", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODU0OTUyNw==", "url": "https://github.com/ls1intum/Artemis/pull/2043#discussion_r488549527", "bodyText": "Codacy found an issue: The constant name 'log' doesn't match '[A-Z][A-Z_0-9]*'", "author": "artemis-bot", "createdAt": "2020-09-15T10:12:10Z", "path": "src/main/java/de/tum/in/www1/artemis/service/scheduled/quiz/EmptyQuizExerciseCache.java", "diffHunk": "@@ -14,16 +14,27 @@\n import de.tum.in.www1.artemis.domain.quiz.QuizSubmission;\n \n /**\n- * Empty cache object representing a cache miss\n+ * Empty cache object representing a cache miss.\n+ * <p> \n+ * This allows to handle a not-cached quiz exercise elegantly, because most operations on the cache are read operations on the\n+ * exercise object or the submission, participation or result map. This immutable, singleton class returning only null or empty\n+ * data structures on read operations allows being used as as default, if no real cache exists. This saves us much branching and\n+ * checking in the {@link QuizScheduleService}, as we can either just return the {@link EmptyQuizExerciseCache} or create a new\n+ * real {@link QuizExerciseCache} for write operations, if no cache can be found.\n+ * <p>\n+ * All method that modify a {@link QuizExerciseCache} throw an {@link UnsupportedOperationException} for the empty cache. \n  */\n final class EmptyQuizExerciseCache extends QuizExerciseCache {\n \n-    static final Logger log = LoggerFactory.getLogger(EmptyQuizExerciseCache.class);\n+    private static final Logger log = LoggerFactory.getLogger(EmptyQuizExerciseCache.class);", "originalCommit": "3d37dfe054ccf8f01a0501ba72e2ed228277c778", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}