{"pr_number": 1883, "pr_title": "[Feature] Embed Images in Markdown Editor", "pr_createdAt": "2020-07-14T17:45:33Z", "pr_url": "https://github.com/ls1intum/Artemis/pull/1883", "timeline": [{"oid": "8fc46c959d5b7eb33028b935b552b0769aa5c42a", "url": "https://github.com/ls1intum/Artemis/commit/8fc46c959d5b7eb33028b935b552b0769aa5c42a", "message": "change deprecated ngbtabs to nav", "committedDate": "2020-05-03T16:48:53Z", "type": "commit"}, {"oid": "ce6de51bba88a468413e2e3198fae72d0d841d62", "url": "https://github.com/ls1intum/Artemis/commit/ce6de51bba88a468413e2e3198fae72d0d841d62", "message": "update showdown-katex version, show blockquotes, fix linebreaks", "committedDate": "2020-05-03T17:38:02Z", "type": "commit"}, {"oid": "88b2eb14d4b4ef7e47522ca12c5789735a4e22e7", "url": "https://github.com/ls1intum/Artemis/commit/88b2eb14d4b4ef7e47522ca12c5789735a4e22e7", "message": "prettier", "committedDate": "2020-05-03T17:46:23Z", "type": "commit"}, {"oid": "cec8abc166445c66b093033b2b36df2337d5b864", "url": "https://github.com/ls1intum/Artemis/commit/cec8abc166445c66b093033b2b36df2337d5b864", "message": "Merge branch 'develop' of https://github.com/ls1intum/Artemis into feature/markdown-editor/refactoring", "committedDate": "2020-05-03T17:47:03Z", "type": "commit"}, {"oid": "b38b1ec093e26a40d93cd9c983509dd3ba17094c", "url": "https://github.com/ls1intum/Artemis/commit/b38b1ec093e26a40d93cd9c983509dd3ba17094c", "message": "fix tests", "committedDate": "2020-05-03T18:53:35Z", "type": "commit"}, {"oid": "1fcb448234f7854c5be027c083e5104995518f98", "url": "https://github.com/ls1intum/Artemis/commit/1fcb448234f7854c5be027c083e5104995518f98", "message": "Merge branch 'develop' of https://github.com/ls1intum/Artemis into feature/markdown-editor/embed-files", "committedDate": "2020-05-04T14:09:11Z", "type": "commit"}, {"oid": "dca129933510fed0e04c48e74cb7577a9c7727c8", "url": "https://github.com/ls1intum/Artemis/commit/dca129933510fed0e04c48e74cb7577a9c7727c8", "message": "init file upload", "committedDate": "2020-05-04T14:10:39Z", "type": "commit"}, {"oid": "a54f2576947e5882fbbb6618fb1f3f08da9dffa4", "url": "https://github.com/ls1intum/Artemis/commit/a54f2576947e5882fbbb6618fb1f3f08da9dffa4", "message": "Merge branch 'develop' of https://github.com/ls1intum/Artemis into feature/markdown-editor/embed-files", "committedDate": "2020-05-04T17:55:47Z", "type": "commit"}, {"oid": "f8495b67f8af17727302dbece26edaa8a086fbfd", "url": "https://github.com/ls1intum/Artemis/commit/f8495b67f8af17727302dbece26edaa8a086fbfd", "message": "Merge branch 'develop' of https://github.com/ls1intum/Artemis into feature/markdown-editor/embed-files", "committedDate": "2020-05-05T10:37:49Z", "type": "commit"}, {"oid": "2402ca59c12a3d9b1a57fc3ccd0259d734133d82", "url": "https://github.com/ls1intum/Artemis/commit/2402ca59c12a3d9b1a57fc3ccd0259d734133d82", "message": "Merge branch 'develop' of https://github.com/ls1intum/Artemis into feature/markdown-editor/embed-files", "committedDate": "2020-05-05T19:35:32Z", "type": "commit"}, {"oid": "61672eecdc67262bd56e423e932ace3ae9c3bc05", "url": "https://github.com/ls1intum/Artemis/commit/61672eecdc67262bd56e423e932ace3ae9c3bc05", "message": "init file input styling and logic", "committedDate": "2020-05-05T21:05:38Z", "type": "commit"}, {"oid": "1848698af8984d4d102866e51fa08aa9ad11c9a9", "url": "https://github.com/ls1intum/Artemis/commit/1848698af8984d4d102866e51fa08aa9ad11c9a9", "message": "add tooltip and link for markdown guide", "committedDate": "2020-05-06T16:12:40Z", "type": "commit"}, {"oid": "fcf360ceb2d95242198c2ba6d697a19b22cac36c", "url": "https://github.com/ls1intum/Artemis/commit/fcf360ceb2d95242198c2ba6d697a19b22cac36c", "message": "upload bar styling", "committedDate": "2020-05-06T20:19:24Z", "type": "commit"}, {"oid": "700aed4c329c012be27ccd5b3f21523ea9a275a8", "url": "https://github.com/ls1intum/Artemis/commit/700aed4c329c012be27ccd5b3f21523ea9a275a8", "message": "Merge branch 'develop' of https://github.com/ls1intum/Artemis into feature/markdown-editor/embed-files", "committedDate": "2020-05-07T09:54:53Z", "type": "commit"}, {"oid": "680def9fdc505ed3185aab84c8447ea5f923482c", "url": "https://github.com/ls1intum/Artemis/commit/680def9fdc505ed3185aab84c8447ea5f923482c", "message": "upload file on input and add link to editor", "committedDate": "2020-05-07T19:34:12Z", "type": "commit"}, {"oid": "738d22c3128004af83f55f0731d902f778e6e685", "url": "https://github.com/ls1intum/Artemis/commit/738d22c3128004af83f55f0731d902f778e6e685", "message": "Merge branch 'develop' of https://github.com/ls1intum/Artemis into feature/markdown-editor/embed-files", "committedDate": "2020-05-07T19:35:13Z", "type": "commit"}, {"oid": "cc6a644d3054297ea273f5d68d765f0760f3fa50", "url": "https://github.com/ls1intum/Artemis/commit/cc6a644d3054297ea273f5d68d765f0760f3fa50", "message": "add alt while loading", "committedDate": "2020-05-07T21:59:37Z", "type": "commit"}, {"oid": "8608282e8264cacbd48e4c991e8cf74ca1f21861", "url": "https://github.com/ls1intum/Artemis/commit/8608282e8264cacbd48e4c991e8cf74ca1f21861", "message": "init drop upload", "committedDate": "2020-05-08T11:41:26Z", "type": "commit"}, {"oid": "9e37b65a7a374e47a681f69d351148dd8101fe70", "url": "https://github.com/ls1intum/Artemis/commit/9e37b65a7a374e47a681f69d351148dd8101fe70", "message": "support multiple files", "committedDate": "2020-05-11T09:30:55Z", "type": "commit"}, {"oid": "30c42b1c2436c2bc8269be83ef935332a950ad59", "url": "https://github.com/ls1intum/Artemis/commit/30c42b1c2436c2bc8269be83ef935332a950ad59", "message": "adapt change from refactoring", "committedDate": "2020-05-11T12:56:43Z", "type": "commit"}, {"oid": "cb8067b5916b77d329b64d3b83149d2f5e0a589e", "url": "https://github.com/ls1intum/Artemis/commit/cb8067b5916b77d329b64d3b83149d2f5e0a589e", "message": "Merge branch 'develop' of https://github.com/ls1intum/Artemis into feature/markdown-editor/embed-files\n\n# Conflicts:\n#\tsrc/main/webapp/app/shared/markdown-editor/markdown-editor.component.html\n#\tyarn.lock", "committedDate": "2020-05-11T18:45:47Z", "type": "commit"}, {"oid": "d26808c783845a417e1b2914f9a29cb98f464c95", "url": "https://github.com/ls1intum/Artemis/commit/d26808c783845a417e1b2914f9a29cb98f464c95", "message": "restore yarn lock", "committedDate": "2020-05-11T18:52:36Z", "type": "commit"}, {"oid": "0cf552c7c5c0f3749bc98bdeb1f7feaa70056ff5", "url": "https://github.com/ls1intum/Artemis/commit/0cf552c7c5c0f3749bc98bdeb1f7feaa70056ff5", "message": "handle multiple files via input and drop", "committedDate": "2020-05-11T19:45:06Z", "type": "commit"}, {"oid": "78712a0ff255fc8c6ee1eeeaae09846b3da4decc", "url": "https://github.com/ls1intum/Artemis/commit/78712a0ff255fc8c6ee1eeeaae09846b3da4decc", "message": "change to img", "committedDate": "2020-05-11T21:21:29Z", "type": "commit"}, {"oid": "33a8a0fcf8b30786d00f117dcd3900f0d263563a", "url": "https://github.com/ls1intum/Artemis/commit/33a8a0fcf8b30786d00f117dcd3900f0d263563a", "message": "disable drop if file upload disabled", "committedDate": "2020-05-12T08:14:19Z", "type": "commit"}, {"oid": "d525e7ec476a24233ca069458e94d17e1e743fd8", "url": "https://github.com/ls1intum/Artemis/commit/d525e7ec476a24233ca069458e94d17e1e743fd8", "message": "prettier", "committedDate": "2020-05-12T08:32:11Z", "type": "commit"}, {"oid": "4b2859d1cbb8d734c288ffc916631b9670375e44", "url": "https://github.com/ls1intum/Artemis/commit/4b2859d1cbb8d734c288ffc916631b9670375e44", "message": "remove unused code", "committedDate": "2020-05-12T10:57:51Z", "type": "commit"}, {"oid": "42db8b282269d92b2d49798c29bc1ebc9902ec0c", "url": "https://github.com/ls1intum/Artemis/commit/42db8b282269d92b2d49798c29bc1ebc9902ec0c", "message": "handle error and different file types", "committedDate": "2020-05-12T11:43:54Z", "type": "commit"}, {"oid": "380d418ded969ce031e90eaafd70436a940f887e", "url": "https://github.com/ls1intum/Artemis/commit/380d418ded969ce031e90eaafd70436a940f887e", "message": "Merge branch 'develop' into feature/markdown-editor/embed-files", "committedDate": "2020-05-12T11:54:45Z", "type": "commit"}, {"oid": "8d19b11a6ea8cfb5ae10f6705d51036a3e078895", "url": "https://github.com/ls1intum/Artemis/commit/8d19b11a6ea8cfb5ae10f6705d51036a3e078895", "message": "init pasting logic", "committedDate": "2020-05-12T15:20:00Z", "type": "commit"}, {"oid": "5f68bf340911b93c2152be959fc1882705a073e5", "url": "https://github.com/ls1intum/Artemis/commit/5f68bf340911b93c2152be959fc1882705a073e5", "message": "handle only images", "committedDate": "2020-05-13T13:05:59Z", "type": "commit"}, {"oid": "e2a8da5ddd9573c7996461a577d7817cc5a80f60", "url": "https://github.com/ls1intum/Artemis/commit/e2a8da5ddd9573c7996461a577d7817cc5a80f60", "message": "Merge branch 'develop' of https://github.com/ls1intum/Artemis into feature/markdown-editor/embed-files", "committedDate": "2020-05-25T19:12:41Z", "type": "commit"}, {"oid": "7c73aa42baaa0d0a859cf57ab0dca89d57c6a525", "url": "https://github.com/ls1intum/Artemis/commit/7c73aa42baaa0d0a859cf57ab0dca89d57c6a525", "message": "Merge branch 'develop' of https://github.com/ls1intum/Artemis into feature/markdown-editor/embed-files", "committedDate": "2020-07-08T16:24:50Z", "type": "commit"}, {"oid": "3048ceb56e220382c7d1407e9beeb9424d2cd42e", "url": "https://github.com/ls1intum/Artemis/commit/3048ceb56e220382c7d1407e9beeb9424d2cd42e", "message": "Merge branch 'develop' of https://github.com/ls1intum/Artemis into feature/markdown-editor/embed-files", "committedDate": "2020-07-10T13:23:47Z", "type": "commit"}, {"oid": "5bd10c3226f801dd16a00d85773021e196c3b1c8", "url": "https://github.com/ls1intum/Artemis/commit/5bd10c3226f801dd16a00d85773021e196c3b1c8", "message": "Merge branch 'develop' of https://github.com/ls1intum/Artemis into feature/markdown-editor/embed-files", "committedDate": "2020-07-12T18:04:03Z", "type": "commit"}, {"oid": "395ff34bc448485678bf6fd5e056d58ae0873126", "url": "https://github.com/ls1intum/Artemis/commit/395ff34bc448485678bf6fd5e056d58ae0873126", "message": "Merge branch 'develop' of https://github.com/ls1intum/Artemis into feature/markdown-editor/embed-files", "committedDate": "2020-07-14T07:52:01Z", "type": "commit"}, {"oid": "93a618d91bc425d117f6907973c329320d02a896", "url": "https://github.com/ls1intum/Artemis/commit/93a618d91bc425d117f6907973c329320d02a896", "message": "Merge branch 'develop' of https://github.com/ls1intum/Artemis into feature/markdown-editor/embed-files", "committedDate": "2020-07-14T14:39:48Z", "type": "commit"}, {"oid": "36d68a1da3b6104387bb90eed6819d3107b02985", "url": "https://github.com/ls1intum/Artemis/commit/36d68a1da3b6104387bb90eed6819d3107b02985", "message": "allow all requests for pictures", "committedDate": "2020-07-14T17:33:02Z", "type": "commit"}, {"oid": "260314974453f642c7fb44fbbc08e06934d8429d", "url": "https://github.com/ls1intum/Artemis/commit/260314974453f642c7fb44fbbc08e06934d8429d", "message": "revert small change", "committedDate": "2020-07-14T17:45:12Z", "type": "commit"}, {"oid": "1a02ffd02bf3c257508c172424818201e6d4654f", "url": "https://github.com/ls1intum/Artemis/commit/1a02ffd02bf3c257508c172424818201e6d4654f", "message": "prettier", "committedDate": "2020-07-14T18:09:35Z", "type": "commit"}, {"oid": "b3e8e3744654b85d2fab89858713627be34a60b8", "url": "https://github.com/ls1intum/Artemis/commit/b3e8e3744654b85d2fab89858713627be34a60b8", "message": "add endpoints", "committedDate": "2020-07-15T13:42:07Z", "type": "commit"}, {"oid": "c6f6ed2a497d8de68885ba219e1bf39deddda752", "url": "https://github.com/ls1intum/Artemis/commit/c6f6ed2a497d8de68885ba219e1bf39deddda752", "message": "add new service method", "committedDate": "2020-07-15T13:44:37Z", "type": "commit"}, {"oid": "d928fe1b79642bbcd08620c4fa1c98c37dbcba18", "url": "https://github.com/ls1intum/Artemis/commit/d928fe1b79642bbcd08620c4fa1c98c37dbcba18", "message": "prettier", "committedDate": "2020-07-15T14:01:07Z", "type": "commit"}, {"oid": "63759afb547d2c7b0425aca9d6ab5e3fb48f6c17", "url": "https://github.com/ls1intum/Artemis/commit/63759afb547d2c7b0425aca9d6ab5e3fb48f6c17", "message": "Merge branch 'develop' into feature/markdown-editor/embed-files", "committedDate": "2020-07-15T14:07:55Z", "type": "commit"}, {"oid": "42b041ca7437325e1695e8fcaaeea9d7db8cb4cc", "url": "https://github.com/ls1intum/Artemis/commit/42b041ca7437325e1695e8fcaaeea9d7db8cb4cc", "message": "spotless", "committedDate": "2020-07-15T15:47:37Z", "type": "commit"}, {"oid": "5fc44f39d6347737ad34934243e2a55cbb0cbfa1", "url": "https://github.com/ls1intum/Artemis/commit/5fc44f39d6347737ad34934243e2a55cbb0cbfa1", "message": "refactor saveFiles,\nextract method to reuse code", "committedDate": "2020-07-15T18:59:38Z", "type": "commit"}, {"oid": "2c7faf57cfae29225170d831e91dcfeac66d025b", "url": "https://github.com/ls1intum/Artemis/commit/2c7faf57cfae29225170d831e91dcfeac66d025b", "message": "add tests for markdown file upload and normal file upload", "committedDate": "2020-07-15T19:37:14Z", "type": "commit"}, {"oid": "9ef774f28abfc248a4d45d466cc345c91269f4bb", "url": "https://github.com/ls1intum/Artemis/commit/9ef774f28abfc248a4d45d466cc345c91269f4bb", "message": "Merge branch 'develop' into feature/markdown-editor/embed-files", "committedDate": "2020-07-15T20:02:28Z", "type": "commit"}, {"oid": "18c6b46674bf1ed500345ad019020470280bc57c", "url": "https://github.com/ls1intum/Artemis/commit/18c6b46674bf1ed500345ad019020470280bc57c", "message": "remove async from doc", "committedDate": "2020-07-16T10:44:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTcyMjcwNA==", "url": "https://github.com/ls1intum/Artemis/pull/1883#discussion_r455722704", "bodyText": "We should think about the permission concept here. For now I suggest that we only allow this to ADMIN, INSTRUCTOR and TA roles.", "author": "krusche", "createdAt": "2020-07-16T11:39:36Z", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/FileResource.java", "diffHunk": "@@ -161,6 +110,34 @@ public FileResource(FileService fileService, ResourceLoader resourceLoader, Lect\n         return responseEntityForFilePath(FilePathService.getTempFilepath() + filename);\n     }\n \n+    /**\n+     * POST /markdownFileUpload : Upload a new file for markdown.\n+     *\n+     * @param file The file to save\n+     * @param keepFileName specifies if original file name should be kept\n+     * @return The path of the file\n+     * @throws URISyntaxException if response path can't be converted into URI\n+     */\n+    @PostMapping(\"/markdownFileUpload\")\n+    @PreAuthorize(\"hasAnyRole('ADMIN', 'INSTRUCTOR', 'TA', 'USER')\")", "originalCommit": "18c6b46674bf1ed500345ad019020470280bc57c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTcyMjk3MA==", "url": "https://github.com/ls1intum/Artemis/pull/1883#discussion_r455722970", "bodyText": "This also means the image upload should be deactivate for the questions and answer component for now", "author": "krusche", "createdAt": "2020-07-16T11:40:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTcyMjcwNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTczNzE2Nw==", "url": "https://github.com/ls1intum/Artemis/pull/1883#discussion_r455737167", "bodyText": "I deactivated it for questions and answers and removed the user role", "author": "filip-gregurevic", "createdAt": "2020-07-16T12:08:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTcyMjcwNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTcyMjc4OQ==", "url": "https://github.com/ls1intum/Artemis/pull/1883#discussion_r455722789", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                @PreAuthorize(\"hasAnyRole('ADMIN', 'INSTRUCTOR', 'TA', 'USER')\")\n          \n          \n            \n                @PreAuthorize(\"hasAnyRole('ADMIN', 'INSTRUCTOR', 'TA')\")", "author": "krusche", "createdAt": "2020-07-16T11:39:43Z", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/FileResource.java", "diffHunk": "@@ -161,6 +110,34 @@ public FileResource(FileService fileService, ResourceLoader resourceLoader, Lect\n         return responseEntityForFilePath(FilePathService.getTempFilepath() + filename);\n     }\n \n+    /**\n+     * POST /markdownFileUpload : Upload a new file for markdown.\n+     *\n+     * @param file The file to save\n+     * @param keepFileName specifies if original file name should be kept\n+     * @return The path of the file\n+     * @throws URISyntaxException if response path can't be converted into URI\n+     */\n+    @PostMapping(\"/markdownFileUpload\")\n+    @PreAuthorize(\"hasAnyRole('ADMIN', 'INSTRUCTOR', 'TA', 'USER')\")", "originalCommit": "18c6b46674bf1ed500345ad019020470280bc57c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTcyNDA2Mw==", "url": "https://github.com/ls1intum/Artemis/pull/1883#discussion_r455724063", "bodyText": "Does this mean that really every user can download those files? I don't think this would be a good solution.\nCould we apply the same principle as for lecture downloads, so that only students within the same course (or students who have access to the exercise) can download markdown files?\nOr would this be too complicated for now?", "author": "krusche", "createdAt": "2020-07-16T11:42:19Z", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/FileResource.java", "diffHunk": "@@ -161,6 +110,34 @@ public FileResource(FileService fileService, ResourceLoader resourceLoader, Lect\n         return responseEntityForFilePath(FilePathService.getTempFilepath() + filename);\n     }\n \n+    /**\n+     * POST /markdownFileUpload : Upload a new file for markdown.\n+     *\n+     * @param file The file to save\n+     * @param keepFileName specifies if original file name should be kept\n+     * @return The path of the file\n+     * @throws URISyntaxException if response path can't be converted into URI\n+     */\n+    @PostMapping(\"/markdownFileUpload\")\n+    @PreAuthorize(\"hasAnyRole('ADMIN', 'INSTRUCTOR', 'TA', 'USER')\")\n+    public ResponseEntity<String> saveMarkdownFile(@RequestParam(value = \"file\") MultipartFile file, @RequestParam(\"keepFileName\") Boolean keepFileName) throws URISyntaxException {\n+        log.debug(\"REST request to upload file for markdown: {}\", file.getOriginalFilename());\n+        return handleSaveFile(file, keepFileName, true);\n+    }\n+\n+    /**\n+     * GET /files/markdown/:filename : Get the markdown file with the given filename\n+     *\n+     * @param filename The filename of the file to get\n+     * @return The requested file, or 404 if the file doesn't exist\n+     */\n+    @GetMapping(\"/files/markdown/{filename:.+}\")\n+    @PreAuthorize(\"permitAll()\")", "originalCommit": "18c6b46674bf1ed500345ad019020470280bc57c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTczODMzMA==", "url": "https://github.com/ls1intum/Artemis/pull/1883#discussion_r455738330", "bodyText": "Every user who knows the url of the file can access it. Adding authentication here would be quite hard to do since there is no good way (as far as I know) of adding the authentication to the code generated by markdown accessing the file.", "author": "filip-gregurevic", "createdAt": "2020-07-16T12:10:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTcyNDA2Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTcyNTE0MQ==", "url": "https://github.com/ls1intum/Artemis/pull/1883#discussion_r455725141", "bodyText": "How do you handle if two people upload a file with the same name? Does the file name include some random string to prevent that the 2nd file is overridden by the 1st one?", "author": "krusche", "createdAt": "2020-07-16T11:44:34Z", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/FileResource.java", "diffHunk": "@@ -311,6 +288,89 @@ private boolean validateTemporaryAccessToken(String temporaryAccessToken, String\n         return true;\n     }\n \n+    /**\n+     * Helper method which handles the file creation for both normal file uploads and for markdown\n+     * @param file The file to be uplaoded\n+     * @param keepFileName specifies if original file name should be kept\n+     * @param markdown boolean which is set to true, when we are uploading a file within the markdown editor\n+     * @return The path of the file\n+     * @throws URISyntaxException if response path can't be converted into URI\n+     */\n+    @NotNull\n+    private ResponseEntity<String> handleSaveFile(@RequestParam(\"file\") MultipartFile file, @RequestParam(\"keepFileName\") Boolean keepFileName, boolean markdown)\n+            throws URISyntaxException {\n+        // NOTE: Maximum file size is set in resources/config/application.yml\n+        // Currently set to 10 MB\n+\n+        // check for file type\n+        String fileExtension = FilenameUtils.getExtension(file.getOriginalFilename());\n+        if (fileExtension == null || this.allowedFileExtensions.stream().noneMatch(fileExtension::equalsIgnoreCase)) {\n+            return ResponseEntity.badRequest().body(\"Unsupported file type! Allowed file types: \" + String.join(\", \", this.allowedFileExtensions));\n+        }\n+\n+        final String filePath;\n+        final String fileNameAddition;\n+        final StringBuilder responsePath = new StringBuilder();\n+\n+        // set the appropriate values depending on the use case\n+        if (markdown) {\n+            filePath = FilePathService.getMarkdownFilepath();\n+            fileNameAddition = \"Markdown_\";", "originalCommit": "18c6b46674bf1ed500345ad019020470280bc57c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTczODkwMA==", "url": "https://github.com/ls1intum/Artemis/pull/1883#discussion_r455738900", "bodyText": "The request is for now always sent so that it does not necessarily keep the file name. In this case a timestamp and a random string is included.", "author": "filip-gregurevic", "createdAt": "2020-07-16T12:11:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTcyNTE0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTc0OTI0NA==", "url": "https://github.com/ls1intum/Artemis/pull/1883#discussion_r455749244", "bodyText": "what do you mean with \"the request is for now always sent\"?", "author": "krusche", "createdAt": "2020-07-16T12:30:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTcyNTE0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTc4OTIwNA==", "url": "https://github.com/ls1intum/Artemis/pull/1883#discussion_r455789204", "bodyText": "There is the option to keep the file name. In this case the file with the same name would be overwritten. This is not used at the moment, but it might be used at some point in the future. Right now the name of a markdown file will always include a random string", "author": "filip-gregurevic", "createdAt": "2020-07-16T13:33:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTcyNTE0MQ=="}], "type": "inlineReview"}, {"oid": "7810c6a539b189382204046febd2b8cb5fa71ec5", "url": "https://github.com/ls1intum/Artemis/commit/7810c6a539b189382204046febd2b8cb5fa71ec5", "message": "disable file upload for student questions markdown", "committedDate": "2020-07-16T12:03:28Z", "type": "commit"}, {"oid": "b7aa379ed75321fad6efbec2cab6c792e03a4ad4", "url": "https://github.com/ls1intum/Artemis/commit/b7aa379ed75321fad6efbec2cab6c792e03a4ad4", "message": "Update integration tests", "committedDate": "2020-07-16T14:14:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTkwNTQ4NA==", "url": "https://github.com/ls1intum/Artemis/pull/1883#discussion_r455905484", "bodyText": "just a small thing but maybe something like markdown-file-upload  instead of camelCase", "author": "stefanwaldhauser", "createdAt": "2020-07-16T16:12:43Z", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/FileResource.java", "diffHunk": "@@ -161,6 +110,34 @@ public FileResource(FileService fileService, ResourceLoader resourceLoader, Lect\n         return responseEntityForFilePath(FilePathService.getTempFilepath() + filename);\n     }\n \n+    /**\n+     * POST /markdownFileUpload : Upload a new file for markdown.\n+     *\n+     * @param file The file to save\n+     * @param keepFileName specifies if original file name should be kept\n+     * @return The path of the file\n+     * @throws URISyntaxException if response path can't be converted into URI\n+     */\n+    @PostMapping(\"/markdownFileUpload\")", "originalCommit": "b7aa379ed75321fad6efbec2cab6c792e03a4ad4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTk0Mjk0OQ==", "url": "https://github.com/ls1intum/Artemis/pull/1883#discussion_r455942949", "bodyText": "changed that now \ud83d\udc4d", "author": "filip-gregurevic", "createdAt": "2020-07-16T17:13:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTkwNTQ4NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTkxMzE0MQ==", "url": "https://github.com/ls1intum/Artemis/pull/1883#discussion_r455913141", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private ResponseEntity<String> handleSaveFile(@RequestParam(\"file\") MultipartFile file, @RequestParam(\"keepFileName\") Boolean keepFileName, boolean markdown)\n          \n          \n            \n                private ResponseEntity<String> handleSaveFile(@RequestParam(\"file\") MultipartFile file, @RequestParam(\"keepFileName\") boolean keepFileName, boolean markdown)", "author": "stefanwaldhauser", "createdAt": "2020-07-16T16:24:12Z", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/FileResource.java", "diffHunk": "@@ -311,6 +288,89 @@ private boolean validateTemporaryAccessToken(String temporaryAccessToken, String\n         return true;\n     }\n \n+    /**\n+     * Helper method which handles the file creation for both normal file uploads and for markdown\n+     * @param file The file to be uplaoded\n+     * @param keepFileName specifies if original file name should be kept\n+     * @param markdown boolean which is set to true, when we are uploading a file within the markdown editor\n+     * @return The path of the file\n+     * @throws URISyntaxException if response path can't be converted into URI\n+     */\n+    @NotNull\n+    private ResponseEntity<String> handleSaveFile(@RequestParam(\"file\") MultipartFile file, @RequestParam(\"keepFileName\") Boolean keepFileName, boolean markdown)", "originalCommit": "b7aa379ed75321fad6efbec2cab6c792e03a4ad4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTkzMjgxOQ==", "url": "https://github.com/ls1intum/Artemis/pull/1883#discussion_r455932819", "bodyText": "I've seen Boolean used quite often when it is passed as a request param. But since I am not an expert in this field, I can also change it to boolean. @stefanwaldhauser could you please explain why this change is necessary?", "author": "filip-gregurevic", "createdAt": "2020-07-16T16:56:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTkxMzE0MQ=="}], "type": "inlineReview"}, {"oid": "4e2005e172fa172a66d4726faf8e0df41587d21f", "url": "https://github.com/ls1intum/Artemis/commit/4e2005e172fa172a66d4726faf8e0df41587d21f", "message": "Update src/main/webapp/i18n/de/markdownEditor.json\n\nCo-authored-by: Stefan Waldhauser <hello@stefanwaldhauser.me>", "committedDate": "2020-07-16T16:33:18Z", "type": "commit"}, {"oid": "f61c5d10f32ba58844f74794ac2a5fc4273248a8", "url": "https://github.com/ls1intum/Artemis/commit/f61c5d10f32ba58844f74794ac2a5fc4273248a8", "message": "add type for options", "committedDate": "2020-07-16T17:07:40Z", "type": "commit"}, {"oid": "30f2b48b81471e9967db0a3a4158ac90a58af5da", "url": "https://github.com/ls1intum/Artemis/commit/30f2b48b81471e9967db0a3a4158ac90a58af5da", "message": "no camel case", "committedDate": "2020-07-16T17:12:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjA1NTMwNg==", "url": "https://github.com/ls1intum/Artemis/pull/1883#discussion_r456055306", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private ResponseEntity<String> handleSaveFile(@RequestParam(\"file\") MultipartFile file, @RequestParam(\"keepFileName\") Boolean keepFileName, boolean markdown)\n          \n          \n            \n                private ResponseEntity<String> handleSaveFile(MultipartFile file, boolean keepFileName, boolean markdown)", "author": "krusche", "createdAt": "2020-07-16T20:23:14Z", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/FileResource.java", "diffHunk": "@@ -311,6 +288,89 @@ private boolean validateTemporaryAccessToken(String temporaryAccessToken, String\n         return true;\n     }\n \n+    /**\n+     * Helper method which handles the file creation for both normal file uploads and for markdown\n+     * @param file The file to be uplaoded\n+     * @param keepFileName specifies if original file name should be kept\n+     * @param markdown boolean which is set to true, when we are uploading a file within the markdown editor\n+     * @return The path of the file\n+     * @throws URISyntaxException if response path can't be converted into URI\n+     */\n+    @NotNull\n+    private ResponseEntity<String> handleSaveFile(@RequestParam(\"file\") MultipartFile file, @RequestParam(\"keepFileName\") Boolean keepFileName, boolean markdown)", "originalCommit": "30f2b48b81471e9967db0a3a4158ac90a58af5da", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjA1NjMwMQ==", "url": "https://github.com/ls1intum/Artemis/pull/1883#discussion_r456056301", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public ResponseEntity<String> saveMarkdownFile(@RequestParam(value = \"file\") MultipartFile file, @RequestParam(\"keepFileName\") Boolean keepFileName) throws URISyntaxException {\n          \n          \n            \n                public ResponseEntity<String> saveMarkdownFile(@RequestParam(value = \"file\") MultipartFile file, @RequestParam(defaultValue = \"false\") boolean keepFileName) throws URISyntaxException {", "author": "krusche", "createdAt": "2020-07-16T20:25:09Z", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/FileResource.java", "diffHunk": "@@ -161,6 +110,34 @@ public FileResource(FileService fileService, ResourceLoader resourceLoader, Lect\n         return responseEntityForFilePath(FilePathService.getTempFilepath() + filename);\n     }\n \n+    /**\n+     * POST /markdown-file-upload : Upload a new file for markdown.\n+     *\n+     * @param file The file to save\n+     * @param keepFileName specifies if original file name should be kept\n+     * @return The path of the file\n+     * @throws URISyntaxException if response path can't be converted into URI\n+     */\n+    @PostMapping(\"/markdown-file-upload\")\n+    @PreAuthorize(\"hasAnyRole('ADMIN', 'INSTRUCTOR', 'TA')\")\n+    public ResponseEntity<String> saveMarkdownFile(@RequestParam(value = \"file\") MultipartFile file, @RequestParam(\"keepFileName\") Boolean keepFileName) throws URISyntaxException {", "originalCommit": "30f2b48b81471e9967db0a3a4158ac90a58af5da", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjA1NjUwMQ==", "url": "https://github.com/ls1intum/Artemis/pull/1883#discussion_r456056501", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public ResponseEntity<String> saveFile(@RequestParam(value = \"file\") MultipartFile file, @RequestParam(\"keepFileName\") Boolean keepFileName) throws URISyntaxException {\n          \n          \n            \n                public ResponseEntity<String> saveFile(@RequestParam(value = \"file\") MultipartFile file, @RequestParam(defaultValue = \"false\") boolean keepFileName) throws URISyntaxException {", "author": "krusche", "createdAt": "2020-07-16T20:25:31Z", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/FileResource.java", "diffHunk": "@@ -92,60 +93,8 @@ public FileResource(FileService fileService, ResourceLoader resourceLoader, Lect\n     @PreAuthorize(\"hasAnyRole('ADMIN', 'INSTRUCTOR', 'TA')\")\n     public ResponseEntity<String> saveFile(@RequestParam(value = \"file\") MultipartFile file, @RequestParam(\"keepFileName\") Boolean keepFileName) throws URISyntaxException {", "originalCommit": "30f2b48b81471e9967db0a3a4158ac90a58af5da", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "c17ff04625ebc05a1e07f21b422cec792cb0c1b2", "url": "https://github.com/ls1intum/Artemis/commit/c17ff04625ebc05a1e07f21b422cec792cb0c1b2", "message": "Update src/main/java/de/tum/in/www1/artemis/web/rest/FileResource.java\n\nCo-authored-by: Stephan Krusche <krusche@in.tum.de>", "committedDate": "2020-07-16T20:28:23Z", "type": "commit"}, {"oid": "42c763b58944f5bc03cfc4bff595452d7e232dad", "url": "https://github.com/ls1intum/Artemis/commit/42c763b58944f5bc03cfc4bff595452d7e232dad", "message": "Update src/main/java/de/tum/in/www1/artemis/web/rest/FileResource.java\n\nCo-authored-by: Stephan Krusche <krusche@in.tum.de>", "committedDate": "2020-07-16T20:28:58Z", "type": "commit"}, {"oid": "328dc8e73d6c818f4c20ea48dbb1a62ddbefa61b", "url": "https://github.com/ls1intum/Artemis/commit/328dc8e73d6c818f4c20ea48dbb1a62ddbefa61b", "message": "Update src/main/java/de/tum/in/www1/artemis/web/rest/FileResource.java\n\nCo-authored-by: Stephan Krusche <krusche@in.tum.de>", "committedDate": "2020-07-16T20:29:33Z", "type": "commit"}, {"oid": "9f3b649db4fc534919f033a2f12405f76e0aba74", "url": "https://github.com/ls1intum/Artemis/commit/9f3b649db4fc534919f033a2f12405f76e0aba74", "message": "spotless", "committedDate": "2020-07-16T21:35:59Z", "type": "commit"}]}