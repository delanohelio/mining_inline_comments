{"pr_number": 1433, "pr_title": "Feature/tutor course dashboard/show locks", "pr_createdAt": "2020-05-07T23:01:51Z", "pr_url": "https://github.com/ls1intum/Artemis/pull/1433", "timeline": [{"oid": "d454ff43af0e7aee409689dee8f9da33257d191c", "url": "https://github.com/ls1intum/Artemis/commit/d454ff43af0e7aee409689dee8f9da33257d191c", "message": "Adds possibility to show number of locks in dashboard", "committedDate": "2020-05-07T22:34:30Z", "type": "commit"}, {"oid": "49a6f9d96f27d2d3049290510cf9db6bfe652813", "url": "https://github.com/ls1intum/Artemis/commit/49a6f9d96f27d2d3049290510cf9db6bfe652813", "message": "Merge branch 'develop' into feature/tutor-course-dashboard/show-locks", "committedDate": "2020-05-07T22:35:56Z", "type": "commit"}, {"oid": "6434ccaa5e1b92cf566186c6c82a9a2c0f5e4499", "url": "https://github.com/ls1intum/Artemis/commit/6434ccaa5e1b92cf566186c6c82a9a2c0f5e4499", "message": "Remove unused imports", "committedDate": "2020-05-08T08:40:02Z", "type": "commit"}, {"oid": "a705a19221302d434376aa55294e7e9d31d663e1", "url": "https://github.com/ls1intum/Artemis/commit/a705a19221302d434376aa55294e7e9d31d663e1", "message": "Merge branch 'develop' into feature/tutor-course-dashboard/show-locks", "committedDate": "2020-05-10T08:04:49Z", "type": "commit"}, {"oid": "7b39d97239f09f8d995dd2c25f0bd82785dab296", "url": "https://github.com/ls1intum/Artemis/commit/7b39d97239f09f8d995dd2c25f0bd82785dab296", "message": "Few minor fixes", "committedDate": "2020-05-10T12:40:32Z", "type": "commit"}, {"oid": "c0d6735d3ac1efafb5c509c771a2d36c9daa65cb", "url": "https://github.com/ls1intum/Artemis/commit/c0d6735d3ac1efafb5c509c771a2d36c9daa65cb", "message": "Fix unused expression error", "committedDate": "2020-05-10T15:36:36Z", "type": "commit"}, {"oid": "6606f3d5074f4e3feed3139877c07a92851cb195", "url": "https://github.com/ls1intum/Artemis/commit/6606f3d5074f4e3feed3139877c07a92851cb195", "message": "Fix part two", "committedDate": "2020-05-10T15:51:04Z", "type": "commit"}, {"oid": "6f5a16d4d693ceb0c92821905e8048ab5e5af3df", "url": "https://github.com/ls1intum/Artemis/commit/6f5a16d4d693ceb0c92821905e8048ab5e5af3df", "message": "Add missing button for instructor", "committedDate": "2020-05-10T18:00:44Z", "type": "commit"}, {"oid": "a3a3ed42588388577aa3048d28e61458f2fa99f3", "url": "https://github.com/ls1intum/Artemis/commit/a3a3ed42588388577aa3048d28e61458f2fa99f3", "message": "Merge branch 'develop' into feature/tutor-course-dashboard/show-locks", "committedDate": "2020-05-11T10:38:39Z", "type": "commit"}, {"oid": "b91d5381cfd32a153593538743a402af2c237b7f", "url": "https://github.com/ls1intum/Artemis/commit/b91d5381cfd32a153593538743a402af2c237b7f", "message": "Introduces requested changes from PR", "committedDate": "2020-05-11T19:24:17Z", "type": "commit"}, {"oid": "5973b623fda5684ac5476f833cfee952cf9b6e47", "url": "https://github.com/ls1intum/Artemis/commit/5973b623fda5684ac5476f833cfee952cf9b6e47", "message": "Merge branch 'develop' into feature/tutor-course-dashboard/show-locks", "committedDate": "2020-05-11T19:24:39Z", "type": "commit"}, {"oid": "48d7c021511b8dbe74ee3cb62c9f4039379cc08f", "url": "https://github.com/ls1intum/Artemis/commit/48d7c021511b8dbe74ee3cb62c9f4039379cc08f", "message": "Fix Java Code Style", "committedDate": "2020-05-11T19:33:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzY3NTI2MQ==", "url": "https://github.com/ls1intum/Artemis/pull/1433#discussion_r423675261", "bodyText": "bad performance!", "author": "krusche", "createdAt": "2020-05-12T11:57:26Z", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/CourseResource.java", "diffHunk": "@@ -636,6 +654,60 @@ private void validateComplaintsConfig(Course course) {\n         return ResponseUtil.wrapOrNotFound(Optional.of(course));\n     }\n \n+    /**\n+     * GET /courses/:courseId/submissions Get all submissions for course\n+     *\n+     * @param courseId the id of the course\n+     * @return the ResponseEntity with status 200 (OK) and with body the course, or with status 404 (Not Found)\n+     * @throws AccessForbiddenException if the current user doesn't have the permission to access the course\n+     */\n+    @GetMapping(\"/courses/{courseId}/submissions\")\n+    @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<List<Submission>> getSubmissionsForCourse(@PathVariable Long courseId) throws AccessForbiddenException {", "originalCommit": "48d7c021511b8dbe74ee3cb62c9f4039379cc08f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjYwNjU0NA==", "url": "https://github.com/ls1intum/Artemis/pull/1433#discussion_r426606544", "bodyText": "Refactored", "author": "balazs-czopf", "createdAt": "2020-05-18T12:58:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzY3NTI2MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzY3NjMzMw==", "url": "https://github.com/ls1intum/Artemis/pull/1433#discussion_r423676333", "bodyText": "Make sure to filter (i.e. hide) elements that should not be visible to tutors, e.g. they are not allowed to see the author of the submission", "author": "krusche", "createdAt": "2020-05-12T11:59:25Z", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/CourseResource.java", "diffHunk": "@@ -636,6 +654,60 @@ private void validateComplaintsConfig(Course course) {\n         return ResponseUtil.wrapOrNotFound(Optional.of(course));\n     }\n \n+    /**\n+     * GET /courses/:courseId/submissions Get all submissions for course\n+     *\n+     * @param courseId the id of the course\n+     * @return the ResponseEntity with status 200 (OK) and with body the course, or with status 404 (Not Found)\n+     * @throws AccessForbiddenException if the current user doesn't have the permission to access the course\n+     */\n+    @GetMapping(\"/courses/{courseId}/submissions\")\n+    @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<List<Submission>> getSubmissionsForCourse(@PathVariable Long courseId) throws AccessForbiddenException {\n+        log.debug(\"REST request to get all submissions for course : {}\", courseId);\n+        long start = System.currentTimeMillis();\n+        Course course = courseService.findOneWithExercises(courseId);\n+        User user = userService.getUserWithGroupsAndAuthorities();\n+        if (!authCheckService.isAtLeastInstructorInCourse(course, user)) {\n+            throw new AccessForbiddenException(\"You are not allowed to access this resource\");\n+        }\n+\n+        List<Exercise> exercises = exerciseService.findAllForCourse(course, user);\n+        List<Submission> submissions = new ArrayList<>();\n+\n+        for (Exercise exercise : exercises) {\n+            if (exercise instanceof ModelingExercise) {\n+                List<ModelingSubmission> modelingSubmissions = modelingSubmissionService.getModelingSubmissions(exercise.getId(), true);\n+                for (ModelingSubmission modelingSubmission : modelingSubmissions) {\n+                    modelingSubmission.getParticipation().setExercise(exercise);\n+                }\n+                submissions.addAll(modelingSubmissions);\n+            }\n+            else if (exercise instanceof TextExercise) {\n+                List<TextSubmission> textSubmissions = textSubmissionService.getTextSubmissionsByExerciseId(exercise.getId(), true);\n+                for (TextSubmission textSubmission : textSubmissions) {\n+                    textSubmission.getParticipation().setExercise(exercise);\n+                }\n+                submissions.addAll(textSubmissions);\n+            }\n+            else if (exercise instanceof FileUploadExercise) {\n+                List<FileUploadSubmission> fileUploadSubmissions = fileUploadSubmissionService.getFileUploadSubmissions(exercise.getId(), true);\n+                for (FileUploadSubmission fileUploadSubmission : fileUploadSubmissions) {\n+                    fileUploadSubmission.getParticipation().setExercise(exercise);\n+                }\n+                submissions.addAll(fileUploadSubmissions);\n+            }\n+\n+            Set<Submission> set = new HashSet<>(submissions);\n+            submissions.clear();\n+            submissions.addAll(set);\n+\n+        }\n+        long end = System.currentTimeMillis();\n+        log.info(\"Finished /courses/\" + courseId + \"/submissions call in \" + (end - start) + \"ms\");\n+        return ResponseEntity.ok(submissions);", "originalCommit": "48d7c021511b8dbe74ee3cb62c9f4039379cc08f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjYwNzI2OQ==", "url": "https://github.com/ls1intum/Artemis/pull/1433#discussion_r426607269", "bodyText": "Thanks for the hint, done so.", "author": "balazs-czopf", "createdAt": "2020-05-18T12:59:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzY3NjMzMw=="}], "type": "inlineReview"}, {"oid": "e5c73443774d4d801a2da343b64cb83efc6f8ce0", "url": "https://github.com/ls1intum/Artemis/commit/e5c73443774d4d801a2da343b64cb83efc6f8ce0", "message": "Merge branch 'develop' into feature/tutor-course-dashboard/show-locks", "committedDate": "2020-05-18T09:00:34Z", "type": "commit"}, {"oid": "b2be2909b29208b4665394de2b3bdea57e5e0afc", "url": "https://github.com/ls1intum/Artemis/commit/b2be2909b29208b4665394de2b3bdea57e5e0afc", "message": "Remove unused imports", "committedDate": "2020-05-18T09:12:21Z", "type": "commit"}, {"oid": "6f15e4f5eec6f36acd59f8e95653215a4ba99e13", "url": "https://github.com/ls1intum/Artemis/commit/6f15e4f5eec6f36acd59f8e95653215a4ba99e13", "message": "Optimize performance", "committedDate": "2020-05-18T12:58:23Z", "type": "commit"}, {"oid": "2d542cffc9151959e8c7794185e6b0fc11202d11", "url": "https://github.com/ls1intum/Artemis/commit/2d542cffc9151959e8c7794185e6b0fc11202d11", "message": "fix java code style", "committedDate": "2020-05-18T13:10:36Z", "type": "commit"}, {"oid": "05665ec0a8e3158c80609b5ffe2465580be526d3", "url": "https://github.com/ls1intum/Artemis/commit/05665ec0a8e3158c80609b5ffe2465580be526d3", "message": "Remove unused services", "committedDate": "2020-05-18T13:46:07Z", "type": "commit"}, {"oid": "c7a9554d55012d39881192764e108d81ced50182", "url": "https://github.com/ls1intum/Artemis/commit/c7a9554d55012d39881192764e108d81ced50182", "message": "Merge branch 'develop' into feature/tutor-course-dashboard/show-locks", "committedDate": "2020-05-18T13:47:15Z", "type": "commit"}, {"oid": "82c5ffec4befd54d33b191c8d8137db3754de35a", "url": "https://github.com/ls1intum/Artemis/commit/82c5ffec4befd54d33b191c8d8137db3754de35a", "message": "Merge branch 'develop' into feature/tutor-course-dashboard/show-locks", "committedDate": "2020-05-18T14:07:52Z", "type": "commit"}, {"oid": "9390017132d725de3c5b8a89a15548ad1f4e20f2", "url": "https://github.com/ls1intum/Artemis/commit/9390017132d725de3c5b8a89a15548ad1f4e20f2", "message": "Merge branch 'develop' into feature/tutor-course-dashboard/show-locks\n\n# Conflicts:\n#\tsrc/main/java/de/tum/in/www1/artemis/service/SubmissionService.java\n#\tsrc/main/webapp/app/course/dashboards/tutor-course-dashboard/tutor-course-dashboard.component.html\n#\tsrc/main/webapp/app/course/manage/course-management.service.ts", "committedDate": "2020-05-21T09:27:29Z", "type": "commit"}, {"oid": "1298745f39ec0537489d25d42fecc0eb6bcd3faa", "url": "https://github.com/ls1intum/Artemis/commit/1298745f39ec0537489d25d42fecc0eb6bcd3faa", "message": "Remove double submission link buttons", "committedDate": "2020-05-21T09:37:52Z", "type": "commit"}, {"oid": "f3ed5696a1e6716469057c4483db55b4e83ae268", "url": "https://github.com/ls1intum/Artemis/commit/f3ed5696a1e6716469057c4483db55b4e83ae268", "message": "Merge branch 'develop' into feature/tutor-course-dashboard/show-locks", "committedDate": "2020-05-25T10:31:53Z", "type": "commit"}, {"oid": "6c029322361346bd71c1978b93728008feec6111", "url": "https://github.com/ls1intum/Artemis/commit/6c029322361346bd71c1978b93728008feec6111", "message": "add test cases", "committedDate": "2020-05-25T19:25:57Z", "type": "commit"}, {"oid": "d40ba14708c0a54b839bd4151a3f4e348df67e69", "url": "https://github.com/ls1intum/Artemis/commit/d40ba14708c0a54b839bd4151a3f4e348df67e69", "message": "Merge branch 'develop' into feature/tutor-course-dashboard/show-locks", "committedDate": "2020-05-26T09:25:02Z", "type": "commit"}, {"oid": "485cbe8bae0adc027c5dd2380f79651e4c701e26", "url": "https://github.com/ls1intum/Artemis/commit/485cbe8bae0adc027c5dd2380f79651e4c701e26", "message": "fix java code style", "committedDate": "2020-05-26T09:30:43Z", "type": "commit"}, {"oid": "cf69e2df36d63065d390940f681d27af5b69c011", "url": "https://github.com/ls1intum/Artemis/commit/cf69e2df36d63065d390940f681d27af5b69c011", "message": "fix wrong id", "committedDate": "2020-05-26T10:14:44Z", "type": "commit"}, {"oid": "c85aba61697f5226ec1695a1c256c54ff99b4e6f", "url": "https://github.com/ls1intum/Artemis/commit/c85aba61697f5226ec1695a1c256c54ff99b4e6f", "message": "Merge branch 'develop' into feature/tutor-course-dashboard/show-locks\n\n# Conflicts:\n#\tsrc/main/webapp/app/assessment/assessment-shared.module.ts", "committedDate": "2020-05-26T18:58:14Z", "type": "commit"}, {"oid": "55803800c349a5784cb45ad12816b3728a3d0ff1", "url": "https://github.com/ls1intum/Artemis/commit/55803800c349a5784cb45ad12816b3728a3d0ff1", "message": "Merge branch 'develop' into feature/tutor-course-dashboard/show-locks", "committedDate": "2020-05-27T19:15:46Z", "type": "commit"}, {"oid": "1be31c2a43dca54f918c4eb285113231af329d12", "url": "https://github.com/ls1intum/Artemis/commit/1be31c2a43dca54f918c4eb285113231af329d12", "message": "add test cases", "committedDate": "2020-05-27T19:50:54Z", "type": "commit"}, {"oid": "ef5bf06658659186f01a2452a2ad6e3dd3c0b44b", "url": "https://github.com/ls1intum/Artemis/commit/ef5bf06658659186f01a2452a2ad6e3dd3c0b44b", "message": "Basic test suite setup", "committedDate": "2020-05-27T20:26:33Z", "type": "commit"}, {"oid": "a54f1be8aa9a5fcd242306c84a33d71c7a122bc3", "url": "https://github.com/ls1intum/Artemis/commit/a54f1be8aa9a5fcd242306c84a33d71c7a122bc3", "message": "fix test suite", "committedDate": "2020-05-27T20:55:06Z", "type": "commit"}, {"oid": "0e34c7fad5f800027e4826191d073906e70cc8a6", "url": "https://github.com/ls1intum/Artemis/commit/0e34c7fad5f800027e4826191d073906e70cc8a6", "message": "Fix test suite name", "committedDate": "2020-05-27T21:02:48Z", "type": "commit"}, {"oid": "1f31649ca98d732c2ed4c0ae842f3496b1de400f", "url": "https://github.com/ls1intum/Artemis/commit/1f31649ca98d732c2ed4c0ae842f3496b1de400f", "message": "Fix translation error", "committedDate": "2020-05-28T13:18:13Z", "type": "commit"}, {"oid": "5f4392f7dc06ff8ccf9198ca93ef88254809c72d", "url": "https://github.com/ls1intum/Artemis/commit/5f4392f7dc06ff8ccf9198ca93ef88254809c72d", "message": "Merge branch 'develop' into feature/tutor-course-dashboard/show-locks", "committedDate": "2020-05-29T08:29:41Z", "type": "commit"}, {"oid": "2d4a18a06e50703359a9e5994fa7d04ab58b9bb9", "url": "https://github.com/ls1intum/Artemis/commit/2d4a18a06e50703359a9e5994fa7d04ab58b9bb9", "message": "Merge branch 'develop' into feature/tutor-course-dashboard/show-locks", "committedDate": "2020-06-01T09:50:19Z", "type": "commit"}, {"oid": "211e2fdc5030b648b75f430db16cd71b6409da6c", "url": "https://github.com/ls1intum/Artemis/commit/211e2fdc5030b648b75f430db16cd71b6409da6c", "message": "Merge branch 'develop' into feature/tutor-course-dashboard/show-locks", "committedDate": "2020-06-01T17:51:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzQ0NzU3Ng==", "url": "https://github.com/ls1intum/Artemis/pull/1433#discussion_r433447576", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    log.info(\"Finished /courses/\" + courseId + \"/submissions call in \" + (end - start) + \"ms\");\n          \n          \n            \n                    log.debug(\"Finished /courses/\" + courseId + \"/submissions call in \" + (end - start) + \"ms\");", "author": "krusche", "createdAt": "2020-06-01T19:39:22Z", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/CourseResource.java", "diffHunk": "@@ -659,6 +665,35 @@ public void fetchParticipationsWithSubmissionsAndResultsForCourses(List<Course>\n         return ResponseUtil.wrapOrNotFound(Optional.of(course));\n     }\n \n+    /**\n+     * GET /courses/:courseId/lockedSubmissions Get locked submissions for course for user\n+     *\n+     * @param courseId the id of the course\n+     * @return the ResponseEntity with status 200 (OK) and with body the course, or with status 404 (Not Found)\n+     * @throws AccessForbiddenException if the current user doesn't have the permission to access the course\n+     */\n+    @GetMapping(\"/courses/{courseId}/lockedSubmissions\")\n+    @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<List<Submission>> getLockedSubmissionsForCourse(@PathVariable Long courseId) throws AccessForbiddenException {\n+        log.debug(\"REST request to get all locked submissions for course : {}\", courseId);\n+        long start = System.currentTimeMillis();\n+        Course course = courseService.findOneWithExercises(courseId);\n+        User user = userService.getUserWithGroupsAndAuthorities();\n+        if (!authCheckService.isAtLeastTeachingAssistantInCourse(course, user)) {\n+            throw new AccessForbiddenException(\"You are not allowed to access this resource\");\n+        }\n+\n+        List<Submission> submissions = submissionService.getLockedSubmissions(courseId);\n+\n+        for (Submission submission : submissions) {\n+            submissionService.hideDetails(submission, user);\n+        }\n+\n+        long end = System.currentTimeMillis();\n+        log.info(\"Finished /courses/\" + courseId + \"/submissions call in \" + (end - start) + \"ms\");", "originalCommit": "211e2fdc5030b648b75f430db16cd71b6409da6c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzQ0NzY5OA==", "url": "https://github.com/ls1intum/Artemis/pull/1433#discussion_r433447698", "bodyText": "we don't really need info here. The time is tracked anyway in the metrics", "author": "krusche", "createdAt": "2020-06-01T19:39:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzQ0NzU3Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzQ2NjgxNg==", "url": "https://github.com/ls1intum/Artemis/pull/1433#discussion_r433466816", "bodyText": "Changed it accordingly.", "author": "balazs-czopf", "createdAt": "2020-06-01T20:19:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzQ0NzU3Ng=="}], "type": "inlineReview"}, {"oid": "c66b2c7170f7100ebd94ae7d849e65d4ee1859c8", "url": "https://github.com/ls1intum/Artemis/commit/c66b2c7170f7100ebd94ae7d849e65d4ee1859c8", "message": "Requested changes from PR", "committedDate": "2020-06-01T20:14:53Z", "type": "commit"}, {"oid": "a672b9e0dea35f79794bc6982a278c2bfdd94e5f", "url": "https://github.com/ls1intum/Artemis/commit/a672b9e0dea35f79794bc6982a278c2bfdd94e5f", "message": "Merge branch 'develop' into feature/tutor-course-dashboard/show-locks", "committedDate": "2020-06-01T20:27:58Z", "type": "commit"}]}