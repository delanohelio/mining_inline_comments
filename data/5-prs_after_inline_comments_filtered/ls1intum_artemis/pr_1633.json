{"pr_number": 1633, "pr_title": "TextExercise creation/update for exam-mode", "pr_createdAt": "2020-06-11T11:59:24Z", "pr_url": "https://github.com/ls1intum/Artemis/pull/1633", "timeline": [{"oid": "3b0ba826fb10a68738487f757b94a34b115b475b", "url": "https://github.com/ls1intum/Artemis/commit/3b0ba826fb10a68738487f757b94a34b115b475b", "message": "Create new exam route for creating text-exercises", "committedDate": "2020-06-11T11:52:26Z", "type": "commit"}, {"oid": "0df6f1cc98749380579b6d7ed9ddcc12c18aebc8", "url": "https://github.com/ls1intum/Artemis/commit/0df6f1cc98749380579b6d7ed9ddcc12c18aebc8", "message": "Create new exam route for updating a text-exercises", "committedDate": "2020-06-11T11:59:11Z", "type": "commit"}, {"oid": "154e60b22018d5c4d13ad178ea905924dedab738", "url": "https://github.com/ls1intum/Artemis/commit/154e60b22018d5c4d13ad178ea905924dedab738", "message": "Adjust text-exercise exam route to incluse examId", "committedDate": "2020-06-11T12:26:41Z", "type": "commit"}, {"oid": "630b22201c2a17e5201d58ee29193220493ffcb3", "url": "https://github.com/ls1intum/Artemis/commit/630b22201c2a17e5201d58ee29193220493ffcb3", "message": "Add case distinction for exams in text-exercise route and resolver", "committedDate": "2020-06-11T12:27:22Z", "type": "commit"}, {"oid": "c7384ff0cfb21ba1963e6d4bd02d067e66c7c986", "url": "https://github.com/ls1intum/Artemis/commit/c7384ff0cfb21ba1963e6d4bd02d067e66c7c986", "message": "Add getter for exerciseGroup", "committedDate": "2020-06-11T13:57:39Z", "type": "commit"}, {"oid": "008a94f525074fc8000e1ad7da0adf0b63534622", "url": "https://github.com/ls1intum/Artemis/commit/008a94f525074fc8000e1ad7da0adf0b63534622", "message": "Hide categories row if text-exercise is in exam mode", "committedDate": "2020-06-11T14:40:22Z", "type": "commit"}, {"oid": "1a296e304a209e65967c9b1be50371a4e432cb8e", "url": "https://github.com/ls1intum/Artemis/commit/1a296e304a209e65967c9b1be50371a4e432cb8e", "message": "Add ExerciseGroupService", "committedDate": "2020-06-11T15:24:11Z", "type": "commit"}, {"oid": "102ab8b7d3cd569291934f4b7e442df4df256e0c", "url": "https://github.com/ls1intum/Artemis/commit/102ab8b7d3cd569291934f4b7e442df4df256e0c", "message": "Adjust server endpoint for the creation of text-exercises in exam-mode", "committedDate": "2020-06-11T15:26:24Z", "type": "commit"}, {"oid": "885de3ab876ecba32022689a6cceadc8ee80f450", "url": "https://github.com/ls1intum/Artemis/commit/885de3ab876ecba32022689a6cceadc8ee80f450", "message": "Merge branch 'exam-mode/variants/exercise-creation' of https://github.com/ls1intum/Artemis into exam-mode/variants/exercise-creation", "committedDate": "2020-06-11T15:27:32Z", "type": "commit"}, {"oid": "45e818620d243783ba13f2e4a920f2e8590444f0", "url": "https://github.com/ls1intum/Artemis/commit/45e818620d243783ba13f2e4a920f2e8590444f0", "message": "Add getter for exerciseGroup", "committedDate": "2020-06-11T16:40:29Z", "type": "commit"}, {"oid": "ece6a40120c930cc5454be6c965827b1b47ff808", "url": "https://github.com/ls1intum/Artemis/commit/ece6a40120c930cc5454be6c965827b1b47ff808", "message": "Deactivate notificationText input", "committedDate": "2020-06-11T16:58:46Z", "type": "commit"}, {"oid": "e55515a482250fcab5c0b2f1e879181dce9263b4", "url": "https://github.com/ls1intum/Artemis/commit/e55515a482250fcab5c0b2f1e879181dce9263b4", "message": "Fix typo in route", "committedDate": "2020-06-11T17:33:06Z", "type": "commit"}, {"oid": "f4d8501e1bf2979219cfdca64ba3b7cb07a6fdfb", "url": "https://github.com/ls1intum/Artemis/commit/f4d8501e1bf2979219cfdca64ba3b7cb07a6fdfb", "message": "Add module for text-exercise and fix route typo", "committedDate": "2020-06-12T11:18:58Z", "type": "commit"}, {"oid": "ab3030ee1749ac659d11d0d4120ac83ddf630e5a", "url": "https://github.com/ls1intum/Artemis/commit/ab3030ee1749ac659d11d0d4120ac83ddf630e5a", "message": "ModelFactory for Exam and ExamGroup", "committedDate": "2020-06-12T11:54:39Z", "type": "commit"}, {"oid": "8b166588792c10404ae69234046030880bf996c7", "url": "https://github.com/ls1intum/Artemis/commit/8b166588792c10404ae69234046030880bf996c7", "message": "Add setter for exerciseGroup", "committedDate": "2020-06-12T13:16:21Z", "type": "commit"}, {"oid": "07fc456ef645fa3b558547ffec1e5bccf65179ad", "url": "https://github.com/ls1intum/Artemis/commit/07fc456ef645fa3b558547ffec1e5bccf65179ad", "message": "Extend testing utilities by exam entities generation. Tear down exerciseRepo before examMode repos because of foreign key constraints.", "committedDate": "2020-06-12T13:19:45Z", "type": "commit"}, {"oid": "e46d8e987d7144307d3cb535758b89fe51d5803b", "url": "https://github.com/ls1intum/Artemis/commit/e46d8e987d7144307d3cb535758b89fe51d5803b", "message": "Adapt and create integration test for text exercise creation", "committedDate": "2020-06-12T13:20:44Z", "type": "commit"}, {"oid": "757e6c88a5eb1cb454a1cf9c5de4b0804ec23317", "url": "https://github.com/ls1intum/Artemis/commit/757e6c88a5eb1cb454a1cf9c5de4b0804ec23317", "message": "Revert pushed local config", "committedDate": "2020-06-12T13:31:34Z", "type": "commit"}, {"oid": "ad881fbddb5c5b0f49ae1a2929c59f9e69064325", "url": "https://github.com/ls1intum/Artemis/commit/ad881fbddb5c5b0f49ae1a2929c59f9e69064325", "message": "Add integration test for exercise with set course and exerciseGroup", "committedDate": "2020-06-12T13:54:25Z", "type": "commit"}, {"oid": "f5a10af1aa73533a0d13e8e9f2a2deb2ae25f7e4", "url": "https://github.com/ls1intum/Artemis/commit/f5a10af1aa73533a0d13e8e9f2a2deb2ae25f7e4", "message": "Add integration tests for text exercise update", "committedDate": "2020-06-12T14:39:20Z", "type": "commit"}, {"oid": "6557d292f8b45df160a7f314c6f451d677d1cec2", "url": "https://github.com/ls1intum/Artemis/commit/6557d292f8b45df160a7f314c6f451d677d1cec2", "message": "Fix tear down order", "committedDate": "2020-06-12T16:46:58Z", "type": "commit"}, {"oid": "2ce9c722816e55685d5b3c91cd75a856b4adba36", "url": "https://github.com/ls1intum/Artemis/commit/2ce9c722816e55685d5b3c91cd75a856b4adba36", "message": "Add client tests", "committedDate": "2020-06-12T18:58:34Z", "type": "commit"}, {"oid": "c200514cb3ce713f248b6ea8ca980fe4324f0123", "url": "https://github.com/ls1intum/Artemis/commit/c200514cb3ce713f248b6ea8ca980fe4324f0123", "message": "Fix JS Style", "committedDate": "2020-06-12T19:15:52Z", "type": "commit"}, {"oid": "0346f18c54319d6eb175ccf593a0045bef8796e8", "url": "https://github.com/ls1intum/Artemis/commit/0346f18c54319d6eb175ccf593a0045bef8796e8", "message": "Merge branch 'develop' into exam-mode/variants/exercise-creation", "committedDate": "2020-06-12T19:16:17Z", "type": "commit"}, {"oid": "74f387c649c89b58e700dddbbb9abe652bbfe6d8", "url": "https://github.com/ls1intum/Artemis/commit/74f387c649c89b58e700dddbbb9abe652bbfe6d8", "message": "Move exerciseGroup check to exercise entity", "committedDate": "2020-06-12T19:37:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc0NDA2MQ==", "url": "https://github.com/ls1intum/Artemis/pull/1633#discussion_r439744061", "bodyText": "Isn't this a duplication of lines 122 - 137?", "author": "julian-christl", "createdAt": "2020-06-13T14:40:32Z", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/TextExerciseResource.java", "diffHunk": "@@ -149,17 +167,30 @@ public TextExerciseResource(TextExerciseRepository textExerciseRepository, TextE\n         if (textExercise.getId() == null) {\n             return createTextExercise(textExercise);\n         }\n-        // fetch course from database to make sure client didn't change groups\n-        Course course = courseService.findOne(textExercise.getCourse().getId());\n+\n+        // Course and exerciseGroup must not be set simultaneously\n+        if (textExercise.getCourse() != null && textExercise.getExerciseGroup() != null) {\n+            throw new BadRequestAlertException(\"An update for a textExercise cannot have a course and an exerciseGroup\", ENTITY_NAME, \"courseAndExerciseGroupSet\");\n+        }\n+\n+        // If an exerciseGroup is set, the textExercise is updated in exam-mode\n+        boolean isExamMode = textExercise.hasExerciseGroup();\n+\n+        // Fetch course from database over exerciseGroup or already set course to make sure client didn't change groups\n+        Course course = retrieveCourseThroughExerciseGroupOrGivenCourse(textExercise);\n+\n+        // Check that the user is authorized to update the exercise\n         User user = userService.getUserWithGroupsAndAuthorities();\n-        if (!authCheckService.isInstructorInCourse(course, user) && !authCheckService.isAdmin()) {\n+        if (!authCheckService.isAtLeastInstructorInCourse(course, user)) {\n             return forbidden();\n         }", "originalCommit": "74f387c649c89b58e700dddbbb9abe652bbfe6d8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTgyNjEzMQ==", "url": "https://github.com/ls1intum/Artemis/pull/1633#discussion_r439826131", "bodyText": "Yes, I refactored this and created a new method, which can be used for all exercise types.", "author": "kloessst", "createdAt": "2020-06-14T12:43:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc0NDA2MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc0NDE2OA==", "url": "https://github.com/ls1intum/Artemis/pull/1633#discussion_r439744168", "bodyText": "As far as I remember we discussed this in our kickoff meeting that this might be an usecase and we therefore don't want fo forbid it.", "author": "julian-christl", "createdAt": "2020-06-13T14:41:44Z", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/TextExerciseResource.java", "diffHunk": "@@ -149,17 +167,30 @@ public TextExerciseResource(TextExerciseRepository textExerciseRepository, TextE\n         if (textExercise.getId() == null) {\n             return createTextExercise(textExercise);\n         }\n-        // fetch course from database to make sure client didn't change groups\n-        Course course = courseService.findOne(textExercise.getCourse().getId());\n+\n+        // Course and exerciseGroup must not be set simultaneously\n+        if (textExercise.getCourse() != null && textExercise.getExerciseGroup() != null) {\n+            throw new BadRequestAlertException(\"An update for a textExercise cannot have a course and an exerciseGroup\", ENTITY_NAME, \"courseAndExerciseGroupSet\");\n+        }\n+\n+        // If an exerciseGroup is set, the textExercise is updated in exam-mode\n+        boolean isExamMode = textExercise.hasExerciseGroup();\n+\n+        // Fetch course from database over exerciseGroup or already set course to make sure client didn't change groups\n+        Course course = retrieveCourseThroughExerciseGroupOrGivenCourse(textExercise);\n+\n+        // Check that the user is authorized to update the exercise\n         User user = userService.getUserWithGroupsAndAuthorities();\n-        if (!authCheckService.isInstructorInCourse(course, user) && !authCheckService.isAdmin()) {\n+        if (!authCheckService.isAtLeastInstructorInCourse(course, user)) {\n             return forbidden();\n         }\n         TextExercise textExerciseBeforeUpdate = textExerciseService.findOne(textExercise.getId());\n         if (textExerciseBeforeUpdate.isAutomaticAssessmentEnabled() != textExercise.isAutomaticAssessmentEnabled() && !authCheckService.isAdmin()) {\n             return forbidden();\n         }\n \n+        // TODO: Should we forbid conversion between exam <-> normal text-exercise?", "originalCommit": "74f387c649c89b58e700dddbbb9abe652bbfe6d8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTgxNjM0NQ==", "url": "https://github.com/ls1intum/Artemis/pull/1633#discussion_r439816345", "bodyText": "First of all thanks for your feedback!\nI must have missed that point. If such a conversion is wanted we need to take other entities such as participation, submission, result and feedback also into account. They are indirectly attached to the exercise and must be reset on conversion.\nI think an import exercise for exam feature would make more sense. Here we would just need to copy the exercise entity, remove the course and add the exerciseGroup.\nSuch a feature is not part of this PR but we should have a discussion about this.", "author": "kloessst", "createdAt": "2020-06-14T10:47:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc0NDE2OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTgzMDIyMA==", "url": "https://github.com/ls1intum/Artemis/pull/1633#discussion_r439830220", "bodyText": "Yes, conversion or such thing would be Priority 2 or even Priority 3.", "author": "julian-christl", "createdAt": "2020-06-14T13:29:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc0NDE2OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc0NDQyNA==", "url": "https://github.com/ls1intum/Artemis/pull/1633#discussion_r439744424", "bodyText": "I think that's a fair discussion point. In the one hand if there is an issue during the exam we might want to fix it. On the other hand how do we deal with this in the offline mode? Or do we save on which version of the exercises the student submitted? Do we even have versions of exercises it they get changed?", "author": "julian-christl", "createdAt": "2020-06-13T14:45:18Z", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/TextExerciseResource.java", "diffHunk": "@@ -169,7 +200,9 @@ public TextExerciseResource(TextExerciseRepository textExerciseRepository, TextE\n             result.getExampleSubmissions().forEach(exampleSubmission -> exampleSubmission.setTutorParticipations(null));\n         }\n \n-        if (notificationText != null) {\n+        // TODO: Should we leave this activated in case the exercise is changed during the exam?", "originalCommit": "74f387c649c89b58e700dddbbb9abe652bbfe6d8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTgxNjk2NA==", "url": "https://github.com/ls1intum/Artemis/pull/1633#discussion_r439816964", "bodyText": "Honestly I'm not sure if we could reuse this notification functionality for the exam. Do students even see notifications if they are in exam mode?\nI don't think Artemis supports versioning of exercises at the moment so this would also require additional work. We should discuss this with the team.", "author": "kloessst", "createdAt": "2020-06-14T10:55:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc0NDQyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTgzMTMwMQ==", "url": "https://github.com/ls1intum/Artemis/pull/1633#discussion_r439831301", "bodyText": "I created a meeting page for the next meeting and added this as a discussion point.", "author": "julian-christl", "createdAt": "2020-06-14T13:42:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc0NDQyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDM3NjY5Ng==", "url": "https://github.com/ls1intum/Artemis/pull/1633#discussion_r440376696", "bodyText": "we do not want to support this at the moment. Exercises should not be changed during the exam!", "author": "krusche", "createdAt": "2020-06-15T18:48:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc0NDQyNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc0NDU4NQ==", "url": "https://github.com/ls1intum/Artemis/pull/1633#discussion_r439744585", "bodyText": "Could it be useful to put the check from line 122-125 within this method? To ensure that we only retrieve a Course when the Exercise is actually valid.", "author": "julian-christl", "createdAt": "2020-06-13T14:48:01Z", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/TextExerciseResource.java", "diffHunk": "@@ -350,4 +383,22 @@ public TextExerciseResource(TextExerciseRepository textExerciseRepository, TextE\n             return ResponseEntity.badRequest().build();\n         }\n     }\n+\n+    /**\n+     * Retrieve the Course for a given TextExercise.\n+     * If the exercise is part of an exam, retrieve the course through ExerciseGroup -> Exam -> Course.\n+     * Otherwise the Course is already set and the id can be used to retrieve the Course again from the database.\n+     *\n+     * @param textExercise the TextExercise for which the course is retrieved\n+     * @return the Course for the TextExercise\n+     */\n+    private Course retrieveCourseThroughExerciseGroupOrGivenCourse(TextExercise textExercise) {", "originalCommit": "74f387c649c89b58e700dddbbb9abe652bbfe6d8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTgyNjMwOA==", "url": "https://github.com/ls1intum/Artemis/pull/1633#discussion_r439826308", "bodyText": "Applied your suggestion, refactored and moved the method. This can be reused for all exerciseTypes now.", "author": "kloessst", "createdAt": "2020-06-14T12:45:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc0NDU4NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc0NTA0Mw==", "url": "https://github.com/ls1intum/Artemis/pull/1633#discussion_r439745043", "bodyText": "What does this test do? By reading the test I think I know it but please improve the method name and/or document the behaviour.", "author": "julian-christl", "createdAt": "2020-06-13T14:54:13Z", "path": "src/test/java/de/tum/in/www1/artemis/TextExerciseIntegrationTest.java", "diffHunk": "@@ -100,6 +102,41 @@ public void createTextExercise() throws Exception {\n \n         assertThat(newTextExercise.getTitle()).as(\"text exercise title was correctly set\").isEqualTo(title);\n         assertThat(newTextExercise.getDifficulty()).as(\"text exercise difficulty was correctly set\").isEqualTo(difficulty);\n+        assertThat(newTextExercise.getCourse()).as(\"course was set for normal exercise\").isNotNull();\n+        assertThat(newTextExercise.getExerciseGroup()).as(\"exerciseGroup was not set for normal exercise\").isNull();\n+        assertThat(newTextExercise.getCourse().getId()).as(\"exerciseGroupId was set correctly\").isEqualTo(course.getId());\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void createTextExerciseForExam() throws Exception {\n+        var now = ZonedDateTime.now();\n+        ExerciseGroup exerciseGroup = database.addExerciseGroupWithExamAndCourse(true);\n+        TextExercise textExercise = ModelFactory.generateTextExerciseForExam(now.minusDays(1), now.minusHours(2), now.minusHours(1), exerciseGroup);\n+\n+        String title = \"New Exam Text Exercise\";\n+        DifficultyLevel difficulty = DifficultyLevel.HARD;\n+        textExercise.setTitle(title);\n+        textExercise.setDifficulty(difficulty);\n+\n+        TextExercise newTextExercise = request.postWithResponseBody(\"/api/text-exercises/\", textExercise, TextExercise.class, HttpStatus.CREATED);\n+\n+        assertThat(newTextExercise.getTitle()).as(\"text exercise title was correctly set\").isEqualTo(title);\n+        assertThat(newTextExercise.getDifficulty()).as(\"text exercise difficulty was correctly set\").isEqualTo(difficulty);\n+        assertThat(newTextExercise.getCourse()).as(\"course was not set for exam exercise\").isNull();\n+        assertThat(newTextExercise.getExerciseGroup()).as(\"exerciseGroup was set for exam exercise\").isNotNull();\n+        assertThat(newTextExercise.getExerciseGroup().getId()).as(\"exerciseGroupId was set correctly\").isEqualTo(exerciseGroup.getId());\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void createTextExercise_courseAndExerciseGroupSet() throws Exception {", "originalCommit": "74f387c649c89b58e700dddbbb9abe652bbfe6d8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTgxNTIyOA==", "url": "https://github.com/ls1intum/Artemis/pull/1633#discussion_r439815228", "bodyText": "Changed method name to clarify behavior", "author": "kloessst", "createdAt": "2020-06-14T10:33:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc0NTA0Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc0NTEzMg==", "url": "https://github.com/ls1intum/Artemis/pull/1633#discussion_r439745132", "bodyText": "What does this test do? By reading the test I think I know it but please improve the method name and/or document the behaviour.", "author": "julian-christl", "createdAt": "2020-06-13T14:55:44Z", "path": "src/test/java/de/tum/in/www1/artemis/TextExerciseIntegrationTest.java", "diffHunk": "@@ -128,6 +165,43 @@ public void updateTextExercise() throws Exception {\n \n         assertThat(updatedTextExercise.getTitle()).as(\"text exercise title was correctly updated\").isEqualTo(title);\n         assertThat(updatedTextExercise.getDifficulty()).as(\"text exercise difficulty was correctly updated\").isEqualTo(difficulty);\n+        assertThat(updatedTextExercise.getCourse()).as(\"course was set for normal exercise\").isNotNull();\n+        assertThat(updatedTextExercise.getExerciseGroup()).as(\"exerciseGroup was not set for normal exercise\").isNull();\n+        assertThat(updatedTextExercise.getCourse().getId()).as(\"courseId was not updated\").isEqualTo(course.getId());\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void updateTextExerciseForExam() throws Exception {\n+        var now = ZonedDateTime.now();\n+        ExerciseGroup exerciseGroup = database.addExerciseGroupWithExamAndCourse(true);\n+        TextExercise textExercise = ModelFactory.generateTextExerciseForExam(now.minusDays(1), now.minusHours(2), now.minusHours(1), exerciseGroup);\n+        textExerciseRepository.save(textExercise);\n+\n+        // Update certain attributes of text exercise\n+        String updateTitle = \"After\";\n+        DifficultyLevel updateDifficulty = DifficultyLevel.HARD;\n+        textExercise.setTitle(updateTitle);\n+        textExercise.setDifficulty(updateDifficulty);\n+\n+        TextExercise updatedTextExercise = request.putWithResponseBody(\"/api/text-exercises/\", textExercise, TextExercise.class, HttpStatus.OK);\n+\n+        assertThat(updatedTextExercise.getTitle()).as(\"text exercise title was correctly updated\").isEqualTo(updateTitle);\n+        assertThat(updatedTextExercise.getDifficulty()).as(\"text exercise difficulty was correctly updated\").isEqualTo(updateDifficulty);\n+        assertThat(updatedTextExercise.getCourse()).as(\"course was not set for exam exercise\").isNull();\n+        assertThat(updatedTextExercise.getExerciseGroup()).as(\"exerciseGroup was set for exam exercise\").isNotNull();\n+        assertThat(updatedTextExercise.getExerciseGroup().getId()).as(\"exerciseGroupId was not updated\").isEqualTo(exerciseGroup.getId());\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void updateTextExercise_courseAndExerciseGroupSet() throws Exception {", "originalCommit": "74f387c649c89b58e700dddbbb9abe652bbfe6d8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTgxNTI2Ng==", "url": "https://github.com/ls1intum/Artemis/pull/1633#discussion_r439815266", "bodyText": "Changed method name to clarify behavior", "author": "kloessst", "createdAt": "2020-06-14T10:33:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc0NTEzMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc0NTIwMA==", "url": "https://github.com/ls1intum/Artemis/pull/1633#discussion_r439745200", "bodyText": "Would it then be interesting to add a two tests which test the behaviour when updating an exam exercises to a course exercise and vice versa?", "author": "julian-christl", "createdAt": "2020-06-13T14:56:49Z", "path": "src/test/java/de/tum/in/www1/artemis/TextExerciseIntegrationTest.java", "diffHunk": "@@ -128,6 +165,43 @@ public void updateTextExercise() throws Exception {\n \n         assertThat(updatedTextExercise.getTitle()).as(\"text exercise title was correctly updated\").isEqualTo(title);\n         assertThat(updatedTextExercise.getDifficulty()).as(\"text exercise difficulty was correctly updated\").isEqualTo(difficulty);\n+        assertThat(updatedTextExercise.getCourse()).as(\"course was set for normal exercise\").isNotNull();\n+        assertThat(updatedTextExercise.getExerciseGroup()).as(\"exerciseGroup was not set for normal exercise\").isNull();\n+        assertThat(updatedTextExercise.getCourse().getId()).as(\"courseId was not updated\").isEqualTo(course.getId());\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void updateTextExerciseForExam() throws Exception {\n+        var now = ZonedDateTime.now();\n+        ExerciseGroup exerciseGroup = database.addExerciseGroupWithExamAndCourse(true);\n+        TextExercise textExercise = ModelFactory.generateTextExerciseForExam(now.minusDays(1), now.minusHours(2), now.minusHours(1), exerciseGroup);\n+        textExerciseRepository.save(textExercise);\n+\n+        // Update certain attributes of text exercise\n+        String updateTitle = \"After\";\n+        DifficultyLevel updateDifficulty = DifficultyLevel.HARD;\n+        textExercise.setTitle(updateTitle);\n+        textExercise.setDifficulty(updateDifficulty);\n+\n+        TextExercise updatedTextExercise = request.putWithResponseBody(\"/api/text-exercises/\", textExercise, TextExercise.class, HttpStatus.OK);\n+\n+        assertThat(updatedTextExercise.getTitle()).as(\"text exercise title was correctly updated\").isEqualTo(updateTitle);\n+        assertThat(updatedTextExercise.getDifficulty()).as(\"text exercise difficulty was correctly updated\").isEqualTo(updateDifficulty);\n+        assertThat(updatedTextExercise.getCourse()).as(\"course was not set for exam exercise\").isNull();\n+        assertThat(updatedTextExercise.getExerciseGroup()).as(\"exerciseGroup was set for exam exercise\").isNotNull();\n+        assertThat(updatedTextExercise.getExerciseGroup().getId()).as(\"exerciseGroupId was not updated\").isEqualTo(exerciseGroup.getId());\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void updateTextExercise_courseAndExerciseGroupSet() throws Exception {\n+        Course course = database.addCourseWithOneReleasedTextExercise();\n+        ExerciseGroup exerciseGroup = database.addExerciseGroupWithExamAndCourse(true);\n+        TextExercise textExercise = textExerciseRepository.findByCourseId(course.getId()).get(0);\n+        textExercise.setExerciseGroup(exerciseGroup);\n+\n+        request.postWithResponseBody(\"/api/text-exercises/\", textExercise, TextExercise.class, HttpStatus.BAD_REQUEST);\n     }\n ", "originalCommit": "74f387c649c89b58e700dddbbb9abe652bbfe6d8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTgxNzIwMw==", "url": "https://github.com/ls1intum/Artemis/pull/1633#discussion_r439817203", "bodyText": "See my comment about conversion vs. import. If this is actually wanted we need to have integration tests for this. I will add them when this becomes clear.", "author": "kloessst", "createdAt": "2020-06-14T10:58:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc0NTIwMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc0NTMzNw==", "url": "https://github.com/ls1intum/Artemis/pull/1633#discussion_r439745337", "bodyText": "If you pass exercise here shouldn't you make sure that the course of the exercise is null?\nYou could pass a course exercise to this method, can't you?", "author": "julian-christl", "createdAt": "2020-06-13T14:59:42Z", "path": "src/test/java/de/tum/in/www1/artemis/util/ModelFactory.java", "diffHunk": "@@ -104,6 +111,22 @@ public static Exercise populateExercise(Exercise exercise, ZonedDateTime release\n         return exercise;\n     }\n \n+    public static Exercise populateExerciseForExam(Exercise exercise, ZonedDateTime releaseDate, ZonedDateTime dueDate, ZonedDateTime assessmentDueDate,", "originalCommit": "74f387c649c89b58e700dddbbb9abe652bbfe6d8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTgyMTEzMA==", "url": "https://github.com/ls1intum/Artemis/pull/1633#discussion_r439821130", "bodyText": "ModelFactory is used create entities for testing.\nI think it's the responsibility of the test case writer, that he ensures a correct test case setup.\nAlso I don't want to add complexity by having case distinctions within the entity setups.\nBut you also have a valid point. I explicitly set course to null now in the method to ensure that a valid exam exercise is created.", "author": "kloessst", "createdAt": "2020-06-14T11:45:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc0NTMzNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTgzMTQ4MQ==", "url": "https://github.com/ls1intum/Artemis/pull/1633#discussion_r439831481", "bodyText": "Yes, that was my intention. I should've said this in the first place, sorry.", "author": "julian-christl", "createdAt": "2020-06-14T13:44:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc0NTMzNw=="}], "type": "inlineReview"}, {"oid": "abf1e28ef5d46ac16766ac29b43203e958dad900", "url": "https://github.com/ls1intum/Artemis/commit/abf1e28ef5d46ac16766ac29b43203e958dad900", "message": "Choose better test method name to clarify behavior", "committedDate": "2020-06-14T10:30:35Z", "type": "commit"}, {"oid": "940f1eaa373e775e0edbac18240974756f6b8833", "url": "https://github.com/ls1intum/Artemis/commit/940f1eaa373e775e0edbac18240974756f6b8833", "message": "Ensure creation of a valid Exercise for Exam", "committedDate": "2020-06-14T11:45:35Z", "type": "commit"}, {"oid": "ea063b18e2f91f82f1b147079d07fae124506e56", "url": "https://github.com/ls1intum/Artemis/commit/ea063b18e2f91f82f1b147079d07fae124506e56", "message": "Refactored exercise validation and course retrieval", "committedDate": "2020-06-14T12:48:00Z", "type": "commit"}, {"oid": "6c6b9d589267e3564f7633002c9720e70c630d39", "url": "https://github.com/ls1intum/Artemis/commit/6c6b9d589267e3564f7633002c9720e70c630d39", "message": "Fix Doc", "committedDate": "2020-06-14T13:19:57Z", "type": "commit"}, {"oid": "b3d02dbe7a87b7d20ebe9e7e45766d90e38fc9ab", "url": "https://github.com/ls1intum/Artemis/commit/b3d02dbe7a87b7d20ebe9e7e45766d90e38fc9ab", "message": "Fix circular dependency", "committedDate": "2020-06-14T14:44:16Z", "type": "commit"}, {"oid": "809e502f402ac14c0dd6afbe4485d529f1b5502c", "url": "https://github.com/ls1intum/Artemis/commit/809e502f402ac14c0dd6afbe4485d529f1b5502c", "message": "Add integration test to check for exercise without course and exerciseGroup", "committedDate": "2020-06-14T14:56:16Z", "type": "commit"}, {"oid": "20c7e1eaa7218b64e2638fa12502212d98ad4a2d", "url": "https://github.com/ls1intum/Artemis/commit/20c7e1eaa7218b64e2638fa12502212d98ad4a2d", "message": "Forbid conversion between exam and course exercise. Add integration tests.", "committedDate": "2020-06-14T16:12:24Z", "type": "commit"}, {"oid": "f1e6e331ae910d3567c49938d4a26344a89b10d7", "url": "https://github.com/ls1intum/Artemis/commit/f1e6e331ae910d3567c49938d4a26344a89b10d7", "message": "Merge develop and resolve conflicts.", "committedDate": "2020-06-14T22:46:49Z", "type": "commit"}, {"oid": "8e4bbacd98c796b9991fb58bd95fa016c3a698b4", "url": "https://github.com/ls1intum/Artemis/commit/8e4bbacd98c796b9991fb58bd95fa016c3a698b4", "message": "Merge branch 'develop' into exam-mode/variants/exercise-creation", "committedDate": "2020-06-15T14:51:22Z", "type": "commit"}, {"oid": "1bd5d1325da15d298d1321deaa7df8b199d90290", "url": "https://github.com/ls1intum/Artemis/commit/1bd5d1325da15d298d1321deaa7df8b199d90290", "message": "Fix update of text exercise. Use case distinction to check whether the user is allowed to access the exercise", "committedDate": "2020-06-15T15:11:59Z", "type": "commit"}, {"oid": "568dbf77fafb64bafffa7478e3019c6ab1e43fb1", "url": "https://github.com/ls1intum/Artemis/commit/568dbf77fafb64bafffa7478e3019c6ab1e43fb1", "message": "Merge branch 'exam-mode/variants/exercise-creation' of https://github.com/ls1intum/Artemis into exam-mode/variants/exercise-creation", "committedDate": "2020-06-15T15:12:47Z", "type": "commit"}, {"oid": "94ca8abb4df2fc2f8db57530a489112946b26c17", "url": "https://github.com/ls1intum/Artemis/commit/94ca8abb4df2fc2f8db57530a489112946b26c17", "message": "Spotless apply", "committedDate": "2020-06-15T15:15:32Z", "type": "commit"}, {"oid": "b23cc16daec47610d0e0016e03d6c17e18af7774", "url": "https://github.com/ls1intum/Artemis/commit/b23cc16daec47610d0e0016e03d6c17e18af7774", "message": "Merge develop. Resolve conflicts", "committedDate": "2020-06-15T15:36:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMwMTE0MQ==", "url": "https://github.com/ls1intum/Artemis/pull/1633#discussion_r440301141", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (!textExercise.hasExerciseGroup()) {\n          \n          \n            \n                    if (textExercise.hasCourse()) {\n          \n      \n    \n    \n  \n\nI think this check is easier and would allow the comment above to be much shorter", "author": "JonasPetry", "createdAt": "2020-06-15T16:31:19Z", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/TextExerciseResource.java", "diffHunk": "@@ -127,7 +134,11 @@ public TextExerciseResource(TextExerciseRepository textExerciseRepository, TextE\n \n         TextExercise result = textExerciseRepository.save(textExercise);\n         textClusteringScheduleService.ifPresent(service -> service.scheduleExerciseForClusteringIfRequired(result));\n-        groupNotificationService.notifyTutorGroupAboutExerciseCreated(textExercise);\n+\n+        // If an exerciseGroup is set, we assume that the exercise is created for an exam. Then don't notify tutors when the exercise is created\n+        if (!textExercise.hasExerciseGroup()) {", "originalCommit": "b23cc16daec47610d0e0016e03d6c17e18af7774", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMwMTkyOQ==", "url": "https://github.com/ls1intum/Artemis/pull/1633#discussion_r440301929", "bodyText": "See comment above", "author": "JonasPetry", "createdAt": "2020-06-15T16:32:45Z", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/TextExerciseResource.java", "diffHunk": "@@ -169,7 +189,9 @@ public TextExerciseResource(TextExerciseRepository textExerciseRepository, TextE\n             result.getExampleSubmissions().forEach(exampleSubmission -> exampleSubmission.setTutorParticipations(null));\n         }\n \n-        if (notificationText != null) {\n+        // TODO: Should we leave this activated in case the exercise is changed during the exam?\n+        // Don't notify students about changes if the exercise was updated in exam-mode\n+        if (notificationText != null && !textExercise.hasExerciseGroup()) {", "originalCommit": "b23cc16daec47610d0e0016e03d6c17e18af7774", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "04793ae7f7d52583474f306a84514de8eb725cd8", "url": "https://github.com/ls1intum/Artemis/commit/04793ae7f7d52583474f306a84514de8eb725cd8", "message": "Adjust check for exam mode to ensure better understanding", "committedDate": "2020-06-15T16:46:59Z", "type": "commit"}, {"oid": "94de0f7e74eacda26fc42e4d565b25e3fabc95c3", "url": "https://github.com/ls1intum/Artemis/commit/94de0f7e74eacda26fc42e4d565b25e3fabc95c3", "message": "Deactivate accessing of exercise details for exam exercises. Use case distinction or alternate route in the future to enable this for exam exercises", "committedDate": "2020-06-15T17:10:25Z", "type": "commit"}, {"oid": "e9743c3d63c6c02f65877d6daa7130ec9e52c8ba", "url": "https://github.com/ls1intum/Artemis/commit/e9743c3d63c6c02f65877d6daa7130ec9e52c8ba", "message": "spotless apply", "committedDate": "2020-06-15T17:31:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDM1NjgwNw==", "url": "https://github.com/ls1intum/Artemis/pull/1633#discussion_r440356807", "bodyText": "Just a question because I did it differently in my PR: You never really use mandatory right? It is always set to true in your test cases?", "author": "sascha11110", "createdAt": "2020-06-15T18:11:46Z", "path": "src/test/java/de/tum/in/www1/artemis/util/DatabaseUtilService.java", "diffHunk": "@@ -516,8 +516,8 @@ public Exam addExam(Course course) {\n         return exam;\n     }\n \n-    public ExerciseGroup addExerciseGroup(Exam exam) {\n-        ExerciseGroup exerciseGroup = ModelFactory.generateExerciseGroup(exam);\n+    public ExerciseGroup addExerciseGroup(Exam exam, boolean mandatory) {", "originalCommit": "e9743c3d63c6c02f65877d6daa7130ec9e52c8ba", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDM2NTQ2OA==", "url": "https://github.com/ls1intum/Artemis/pull/1633#discussion_r440365468", "bodyText": "Yes but this might be useful when mandatory/optional feature is implemented", "author": "kloessst", "createdAt": "2020-06-15T18:27:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDM1NjgwNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDM3MzA0MQ==", "url": "https://github.com/ls1intum/Artemis/pull/1633#discussion_r440373041", "bodyText": "Ok then the merge order of your and my PR will decide whether this will survive :-D", "author": "sascha11110", "createdAt": "2020-06-15T18:41:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDM1NjgwNw=="}], "type": "inlineReview"}, {"oid": "b4cbc2ca640d94caa76ff0ab3ae8b2361fe9a315", "url": "https://github.com/ls1intum/Artemis/commit/b4cbc2ca640d94caa76ff0ab3ae8b2361fe9a315", "message": "Reduce number of DB queries. Exam loads the course eagerly.", "committedDate": "2020-06-15T18:30:13Z", "type": "commit"}, {"oid": "dbf85a872844e02ef860ffb19896ed388d9bf58d", "url": "https://github.com/ls1intum/Artemis/commit/dbf85a872844e02ef860ffb19896ed388d9bf58d", "message": "Change client routes and fix access modifier", "committedDate": "2020-06-15T18:38:18Z", "type": "commit"}, {"oid": "068ed217cc844509f70af1d48b96447b3e4d35c8", "url": "https://github.com/ls1intum/Artemis/commit/068ed217cc844509f70af1d48b96447b3e4d35c8", "message": "Fix delete for exam text-exercises", "committedDate": "2020-06-15T18:55:07Z", "type": "commit"}]}