{"pr_number": 2038, "pr_title": "[Feature] Open student submission in online editor", "pr_createdAt": "2020-08-18T08:12:23Z", "pr_url": "https://github.com/ls1intum/Artemis/pull/2038", "timeline": [{"oid": "6f390ef96205033d268cdf1f7a915a9183789199", "url": "https://github.com/ls1intum/Artemis/commit/6f390ef96205033d268cdf1f7a915a9183789199", "message": "Merge branch 'develop' into feature/online-editor/open-student-submission-in-online-editor", "committedDate": "2020-08-27T12:05:43Z", "type": "commit"}, {"oid": "8a6e370d5fc17ca254cac4502f9e395647a0239a", "url": "https://github.com/ls1intum/Artemis/commit/8a6e370d5fc17ca254cac4502f9e395647a0239a", "message": "Merge branch 'develop' into feature/online-editor/open-student-submission-in-online-editor", "committedDate": "2020-08-27T19:00:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODYzMzUyNg==", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r478633526", "bodyText": "Codacy found an issue: Linguistics Antipattern - The setter 'setParticipationForProgrammingExercise' should not return any type except void linguistically", "author": "artemis-bot", "createdAt": "2020-08-27T19:04:08Z", "path": "src/test/java/de/tum/in/www1/artemis/programmingexercise/ProgrammingAssessmentIntegrationTest.java", "diffHunk": "@@ -207,6 +373,15 @@ private void overrideAssessment(HttpStatus httpStatus) throws Exception {\n         result.setFeedbacks(feedbacks);\n         result.setParticipation(participation);\n         result.setSubmission(programmingSubmission);\n+        result.setResultString(\"This is a overridden result\");\n         request.putWithResponseBody(\"/api/participations/\" + participation.getId() + \"/manual-results\", result, Result.class, httpStatus);\n     }\n+\n+    private ProgrammingExerciseStudentParticipation setParticipationForProgrammingExercise(AssessmentType assessmentType) {", "originalCommit": "8a6e370d5fc17ca254cac4502f9e395647a0239a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODYzMzUzMw==", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r478633533", "bodyText": "Codacy found an issue: The JUnit 5 test method name 'createManualProgrammingExerciseResult_resultExists' doesn't match '[a-z][a-zA-Z0-9]*'", "author": "artemis-bot", "createdAt": "2020-08-27T19:04:09Z", "path": "src/test/java/de/tum/in/www1/artemis/programmingexercise/ProgrammingAssessmentIntegrationTest.java", "diffHunk": "@@ -194,6 +214,152 @@ public void testOverrideAssessment_submitSameTutorNoAssessmentDueDatePossible()\n         overrideAssessment(HttpStatus.OK);\n     }\n \n+    @Test\n+    @WithMockUser(value = \"student1\", roles = \"USER\")\n+    public void programmingExerciseManualResult_noManualReviewsAllowed_forbidden() throws Exception {\n+        request.put(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results\", result, HttpStatus.FORBIDDEN);\n+        request.put(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results?submit=true\", result, HttpStatus.FORBIDDEN);\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void programmingExerciseManualResult_noManualReviewsWithoutSubmission() throws Exception {\n+        // When it is the first manual result, a new submission is created with latest commit hash\n+        Result response = request.putWithResponseBody(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results\", result, Result.class,\n+                HttpStatus.OK);\n+        String commitHash = ((ProgrammingSubmission) response.getSubmission()).getCommitHash();\n+        assertThat(dummyHash.equalsIgnoreCase(commitHash));\n+\n+        // Check when a manual result already exists that submission is fetched\n+        result.setSubmission(null);\n+        request.put(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results\", result, HttpStatus.OK);\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"tutor1\", roles = \"TA\")\n+    public void createManualProgrammingExerciseResult_save() throws Exception {\n+        Result response = request.putWithResponseBody(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results\", result, Result.class,\n+                HttpStatus.OK);\n+\n+        assertThat(response.getResultString()).isEqualTo(result.getResultString());\n+        assertThat(response.getSubmission()).isNotNull();\n+        assertThat(response.getParticipation()).isEqualTo(result.getParticipation());\n+        assertThat(response.getFeedbacks().size()).isEqualTo(result.getFeedbacks().size());\n+        assertThat(response.isRated().equals(Boolean.FALSE));\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"tutor1\", roles = \"TA\")\n+    public void createManualProgrammingExerciseResult_submit() throws Exception {\n+        Result response = request.putWithResponseBody(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results?submit=true\", result,\n+                Result.class, HttpStatus.OK);\n+\n+        assertThat(response.getResultString()).isEqualTo(result.getResultString());\n+        assertThat(response.getSubmission()).isNotNull();\n+        assertThat(response.getParticipation()).isEqualTo(result.getParticipation());\n+        assertThat(response.getFeedbacks().size()).isEqualTo(result.getFeedbacks().size());\n+        assertThat(response.isRated().equals(Boolean.TRUE));\n+        assertThat(response.getCompletionDate().equals(ZonedDateTime.now()));\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"tutor1\", roles = \"TA\")\n+    public void createManualProgrammingExerciseResult_manualResultsNotAllowed() throws Exception {\n+        var participation = setParticipationForProgrammingExercise(AssessmentType.AUTOMATIC);\n+        result.setParticipation(participation);\n+\n+        request.putWithResponseBody(\"/api/participations/\" + participation.getId() + \"/manual-results\", result, Result.class, HttpStatus.FORBIDDEN);\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"tutor1\", roles = \"TA\")\n+    public void createManualProgrammingExerciseResult_resultExists() throws Exception {", "originalCommit": "8a6e370d5fc17ca254cac4502f9e395647a0239a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODYzMzU0NQ==", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r478633545", "bodyText": "Codacy found an issue: The method 'saveProgrammingAssessment(Long, boolean, Result)' has an NPath complexity of 4536, current threshold is 200", "author": "artemis-bot", "createdAt": "2020-08-27T19:04:10Z", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ProgrammingAssessmentResource.java", "diffHunk": "@@ -71,6 +89,106 @@ public ProgrammingAssessmentResource(AuthorizationCheckService authCheckService,\n         return ResponseEntity.ok(result);\n     }\n \n+    /**\n+     * Cancel an assessment of a given submission for the current user, i.e. delete the corresponding result / release the lock. Then the submission is available for assessment\n+     * again.\n+     *\n+     * @param submissionId the id of the submission for which the current assessment should be canceled\n+     * @return 200 Ok response if canceling was successful, 403 Forbidden if current user is not the assessor of the submission\n+     */\n+    @PutMapping(\"/programming-submissions/{submissionId}/cancel-assessment\")\n+    @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Void> cancelAssessment(@PathVariable Long submissionId) {\n+        return super.cancelAssessment(submissionId);\n+    }\n+\n+    /**\n+     * Save or submit feedback for programming exercise.\n+     *\n+     * @param participationId the id of the participation that should be sent to the client\n+     * @param submit       defines if assessment is submitted or saved\n+     * @param newResult    result with ist of feedbacks to be saved to the database\n+     * @return the result saved to the database\n+     */\n+    @ResponseStatus(HttpStatus.OK)\n+    @PutMapping(\"/participations/{participationId}/manual-results\")\n+    @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Result> saveProgrammingAssessment(@PathVariable Long participationId, @RequestParam(value = \"submit\", defaultValue = \"false\") boolean submit,", "originalCommit": "8a6e370d5fc17ca254cac4502f9e395647a0239a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODYzMzU1MQ==", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r478633551", "bodyText": "Codacy found an issue: The JUnit 5 test method name 'createManualProgrammingExerciseResult_resultPropertyMissing' doesn't match '[a-z][a-zA-Z0-9]*'", "author": "artemis-bot", "createdAt": "2020-08-27T19:04:11Z", "path": "src/test/java/de/tum/in/www1/artemis/programmingexercise/ProgrammingAssessmentIntegrationTest.java", "diffHunk": "@@ -194,6 +214,152 @@ public void testOverrideAssessment_submitSameTutorNoAssessmentDueDatePossible()\n         overrideAssessment(HttpStatus.OK);\n     }\n \n+    @Test\n+    @WithMockUser(value = \"student1\", roles = \"USER\")\n+    public void programmingExerciseManualResult_noManualReviewsAllowed_forbidden() throws Exception {\n+        request.put(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results\", result, HttpStatus.FORBIDDEN);\n+        request.put(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results?submit=true\", result, HttpStatus.FORBIDDEN);\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void programmingExerciseManualResult_noManualReviewsWithoutSubmission() throws Exception {\n+        // When it is the first manual result, a new submission is created with latest commit hash\n+        Result response = request.putWithResponseBody(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results\", result, Result.class,\n+                HttpStatus.OK);\n+        String commitHash = ((ProgrammingSubmission) response.getSubmission()).getCommitHash();\n+        assertThat(dummyHash.equalsIgnoreCase(commitHash));\n+\n+        // Check when a manual result already exists that submission is fetched\n+        result.setSubmission(null);\n+        request.put(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results\", result, HttpStatus.OK);\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"tutor1\", roles = \"TA\")\n+    public void createManualProgrammingExerciseResult_save() throws Exception {\n+        Result response = request.putWithResponseBody(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results\", result, Result.class,\n+                HttpStatus.OK);\n+\n+        assertThat(response.getResultString()).isEqualTo(result.getResultString());\n+        assertThat(response.getSubmission()).isNotNull();\n+        assertThat(response.getParticipation()).isEqualTo(result.getParticipation());\n+        assertThat(response.getFeedbacks().size()).isEqualTo(result.getFeedbacks().size());\n+        assertThat(response.isRated().equals(Boolean.FALSE));\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"tutor1\", roles = \"TA\")\n+    public void createManualProgrammingExerciseResult_submit() throws Exception {\n+        Result response = request.putWithResponseBody(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results?submit=true\", result,\n+                Result.class, HttpStatus.OK);\n+\n+        assertThat(response.getResultString()).isEqualTo(result.getResultString());\n+        assertThat(response.getSubmission()).isNotNull();\n+        assertThat(response.getParticipation()).isEqualTo(result.getParticipation());\n+        assertThat(response.getFeedbacks().size()).isEqualTo(result.getFeedbacks().size());\n+        assertThat(response.isRated().equals(Boolean.TRUE));\n+        assertThat(response.getCompletionDate().equals(ZonedDateTime.now()));\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"tutor1\", roles = \"TA\")\n+    public void createManualProgrammingExerciseResult_manualResultsNotAllowed() throws Exception {\n+        var participation = setParticipationForProgrammingExercise(AssessmentType.AUTOMATIC);\n+        result.setParticipation(participation);\n+\n+        request.putWithResponseBody(\"/api/participations/\" + participation.getId() + \"/manual-results\", result, Result.class, HttpStatus.FORBIDDEN);\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"tutor1\", roles = \"TA\")\n+    public void createManualProgrammingExerciseResult_resultExists() throws Exception {\n+        // Save result in order to generate a new id\n+        result = resultRepository.save(result);\n+        Long id = result.getId();\n+\n+        Result response = request.putWithResponseBody(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results\", result, Result.class,\n+                HttpStatus.OK);\n+        // Make sure that no new id was generated and the result is updated\n+        assertThat(id.equals(response.getId())).isTrue();\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"tutor1\", roles = \"TA\")\n+    public void createManualProgrammingExerciseResult_resultPropertyMissing() throws Exception {", "originalCommit": "8a6e370d5fc17ca254cac4502f9e395647a0239a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODYzMzU1OA==", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r478633558", "bodyText": "Codacy found an issue: The JUnit 5 test method name 'createManualProgrammingExerciseResult_submit' doesn't match '[a-z][a-zA-Z0-9]*'", "author": "artemis-bot", "createdAt": "2020-08-27T19:04:12Z", "path": "src/test/java/de/tum/in/www1/artemis/programmingexercise/ProgrammingAssessmentIntegrationTest.java", "diffHunk": "@@ -194,6 +214,152 @@ public void testOverrideAssessment_submitSameTutorNoAssessmentDueDatePossible()\n         overrideAssessment(HttpStatus.OK);\n     }\n \n+    @Test\n+    @WithMockUser(value = \"student1\", roles = \"USER\")\n+    public void programmingExerciseManualResult_noManualReviewsAllowed_forbidden() throws Exception {\n+        request.put(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results\", result, HttpStatus.FORBIDDEN);\n+        request.put(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results?submit=true\", result, HttpStatus.FORBIDDEN);\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void programmingExerciseManualResult_noManualReviewsWithoutSubmission() throws Exception {\n+        // When it is the first manual result, a new submission is created with latest commit hash\n+        Result response = request.putWithResponseBody(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results\", result, Result.class,\n+                HttpStatus.OK);\n+        String commitHash = ((ProgrammingSubmission) response.getSubmission()).getCommitHash();\n+        assertThat(dummyHash.equalsIgnoreCase(commitHash));\n+\n+        // Check when a manual result already exists that submission is fetched\n+        result.setSubmission(null);\n+        request.put(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results\", result, HttpStatus.OK);\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"tutor1\", roles = \"TA\")\n+    public void createManualProgrammingExerciseResult_save() throws Exception {\n+        Result response = request.putWithResponseBody(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results\", result, Result.class,\n+                HttpStatus.OK);\n+\n+        assertThat(response.getResultString()).isEqualTo(result.getResultString());\n+        assertThat(response.getSubmission()).isNotNull();\n+        assertThat(response.getParticipation()).isEqualTo(result.getParticipation());\n+        assertThat(response.getFeedbacks().size()).isEqualTo(result.getFeedbacks().size());\n+        assertThat(response.isRated().equals(Boolean.FALSE));\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"tutor1\", roles = \"TA\")\n+    public void createManualProgrammingExerciseResult_submit() throws Exception {", "originalCommit": "8a6e370d5fc17ca254cac4502f9e395647a0239a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODYzMzU2OA==", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r478633568", "bodyText": "Codacy found an issue: The JUnit 5 test method name 'updateManualProgrammingExerciseResult_newResult' doesn't match '[a-z][a-zA-Z0-9]*'", "author": "artemis-bot", "createdAt": "2020-08-27T19:04:13Z", "path": "src/test/java/de/tum/in/www1/artemis/programmingexercise/ProgrammingAssessmentIntegrationTest.java", "diffHunk": "@@ -194,6 +214,152 @@ public void testOverrideAssessment_submitSameTutorNoAssessmentDueDatePossible()\n         overrideAssessment(HttpStatus.OK);\n     }\n \n+    @Test\n+    @WithMockUser(value = \"student1\", roles = \"USER\")\n+    public void programmingExerciseManualResult_noManualReviewsAllowed_forbidden() throws Exception {\n+        request.put(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results\", result, HttpStatus.FORBIDDEN);\n+        request.put(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results?submit=true\", result, HttpStatus.FORBIDDEN);\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void programmingExerciseManualResult_noManualReviewsWithoutSubmission() throws Exception {\n+        // When it is the first manual result, a new submission is created with latest commit hash\n+        Result response = request.putWithResponseBody(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results\", result, Result.class,\n+                HttpStatus.OK);\n+        String commitHash = ((ProgrammingSubmission) response.getSubmission()).getCommitHash();\n+        assertThat(dummyHash.equalsIgnoreCase(commitHash));\n+\n+        // Check when a manual result already exists that submission is fetched\n+        result.setSubmission(null);\n+        request.put(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results\", result, HttpStatus.OK);\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"tutor1\", roles = \"TA\")\n+    public void createManualProgrammingExerciseResult_save() throws Exception {\n+        Result response = request.putWithResponseBody(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results\", result, Result.class,\n+                HttpStatus.OK);\n+\n+        assertThat(response.getResultString()).isEqualTo(result.getResultString());\n+        assertThat(response.getSubmission()).isNotNull();\n+        assertThat(response.getParticipation()).isEqualTo(result.getParticipation());\n+        assertThat(response.getFeedbacks().size()).isEqualTo(result.getFeedbacks().size());\n+        assertThat(response.isRated().equals(Boolean.FALSE));\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"tutor1\", roles = \"TA\")\n+    public void createManualProgrammingExerciseResult_submit() throws Exception {\n+        Result response = request.putWithResponseBody(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results?submit=true\", result,\n+                Result.class, HttpStatus.OK);\n+\n+        assertThat(response.getResultString()).isEqualTo(result.getResultString());\n+        assertThat(response.getSubmission()).isNotNull();\n+        assertThat(response.getParticipation()).isEqualTo(result.getParticipation());\n+        assertThat(response.getFeedbacks().size()).isEqualTo(result.getFeedbacks().size());\n+        assertThat(response.isRated().equals(Boolean.TRUE));\n+        assertThat(response.getCompletionDate().equals(ZonedDateTime.now()));\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"tutor1\", roles = \"TA\")\n+    public void createManualProgrammingExerciseResult_manualResultsNotAllowed() throws Exception {\n+        var participation = setParticipationForProgrammingExercise(AssessmentType.AUTOMATIC);\n+        result.setParticipation(participation);\n+\n+        request.putWithResponseBody(\"/api/participations/\" + participation.getId() + \"/manual-results\", result, Result.class, HttpStatus.FORBIDDEN);\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"tutor1\", roles = \"TA\")\n+    public void createManualProgrammingExerciseResult_resultExists() throws Exception {\n+        // Save result in order to generate a new id\n+        result = resultRepository.save(result);\n+        Long id = result.getId();\n+\n+        Result response = request.putWithResponseBody(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results\", result, Result.class,\n+                HttpStatus.OK);\n+        // Make sure that no new id was generated and the result is updated\n+        assertThat(id.equals(response.getId())).isTrue();\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"tutor1\", roles = \"TA\")\n+    public void createManualProgrammingExerciseResult_resultPropertyMissing() throws Exception {\n+        Result result = new Result();\n+\n+        // Result string is missing\n+        request.putWithResponseBody(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results\", result, Result.class, HttpStatus.BAD_REQUEST);\n+\n+        // Result string is too long\n+        result.setResultString(\n+                \"Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.   \\n\"\n+                        + \"Duis autem vel eum iriure dolor in hendrerit in vulputate velit esse molestie consequat, vel illum dolore eu feugiat nulla facilisis at vero eros et accumsan et iusto odio dignissim qui blandit praesent luptatum zzril delenit augue duis dolore te feugait nulla facilisi. Lorem ipsum dolor sit amet, consectetuer adipiscing elit, sed diam nonummy nibh euismod tincidunt ut laoreet dolore magna aliquam erat volutpat.   \\n\"\n+                        + \"Ut wisi enim ad minim veniam, quis nostrud exerci tation ullamcorper suscipit lobortis nisl ut aliquip ex ea commodo consequat. Duis autem vel eum iriure dolor in hendrerit in vulputate velit esse molestie consequat, vel illum dolore...\");\n+        request.putWithResponseBody(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results\", result, Result.class, HttpStatus.BAD_REQUEST);\n+\n+        // Result score is missing\n+        result.setResultString(\"Good work here\");\n+        request.putWithResponseBody(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results\", result, Result.class, HttpStatus.BAD_REQUEST);\n+\n+        // Feedbacks have empty text\n+        result.setScore(100L);\n+        List<Feedback> feedbacks = ModelFactory.generateFeedback();\n+        result.setFeedbacks(feedbacks);\n+        request.putWithResponseBody(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results\", result, Result.class, HttpStatus.BAD_REQUEST);\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"tutor1\", roles = \"TA\")\n+    public void updateManualProgrammingExerciseResult() throws Exception {\n+        ProgrammingSubmission programmingSubmission = (ProgrammingSubmission) new ProgrammingSubmission().commitHash(\"abc\").submitted(true).submissionDate(ZonedDateTime.now());\n+        database.addProgrammingSubmission(programmingExercise, programmingSubmission, \"student1\");\n+        var participation = setParticipationForProgrammingExercise(AssessmentType.SEMI_AUTOMATIC);\n+\n+        result.setParticipation(participation);\n+        result.setSubmission(programmingSubmission);\n+        // Result has to be manual to be updated\n+        result.setAssessmentType(AssessmentType.MANUAL);\n+        result = resultRepository.save(result);\n+\n+        // Remove feedbacks, change text and score.\n+        result.setFeedbacks(result.getFeedbacks().subList(0, 1));\n+        result.setResultString(\"Changed text\");\n+        result.setScore(77L);\n+\n+        Result response = request.putWithResponseBody(\"/api/participations/\" + participation.getId() + \"/manual-results\", result, Result.class, HttpStatus.OK);\n+        assertThat(response.getResultString()).isEqualTo(result.getResultString());\n+        assertThat(response.getParticipation()).isEqualTo(result.getParticipation());\n+        assertThat(response.getFeedbacks().size()).isEqualTo(result.getFeedbacks().size());\n+\n+        // Submission in response is lazy loaded therefore, we fetch submission and check if relation is correct\n+        ProgrammingSubmission submissionFetch = programmingSubmissionService.findByIdWithEagerResultAndFeedback(programmingSubmission.getId());\n+        assertThat(response.getId().equals(submissionFetch.getResult().getId()));\n+        assertThat(submissionFetch.getId().equals(programmingSubmission.getId()));\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"tutor1\", roles = \"TA\")\n+    public void updateManualProgrammingExerciseResult_newResult() throws Exception {", "originalCommit": "8a6e370d5fc17ca254cac4502f9e395647a0239a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODYzMzU3Nw==", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r478633577", "bodyText": "Codacy found an issue: The JUnit 5 test method name 'programmingExerciseManualResult_noManualReviewsAllowed_forbidden' doesn't match '[a-z][a-zA-Z0-9]*'", "author": "artemis-bot", "createdAt": "2020-08-27T19:04:14Z", "path": "src/test/java/de/tum/in/www1/artemis/programmingexercise/ProgrammingAssessmentIntegrationTest.java", "diffHunk": "@@ -194,6 +214,152 @@ public void testOverrideAssessment_submitSameTutorNoAssessmentDueDatePossible()\n         overrideAssessment(HttpStatus.OK);\n     }\n \n+    @Test\n+    @WithMockUser(value = \"student1\", roles = \"USER\")\n+    public void programmingExerciseManualResult_noManualReviewsAllowed_forbidden() throws Exception {", "originalCommit": "8a6e370d5fc17ca254cac4502f9e395647a0239a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODYzMzU5NA==", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r478633594", "bodyText": "Codacy found an issue: The JUnit 5 test method name 'createManualProgrammingExerciseResult_save' doesn't match '[a-z][a-zA-Z0-9]*'", "author": "artemis-bot", "createdAt": "2020-08-27T19:04:15Z", "path": "src/test/java/de/tum/in/www1/artemis/programmingexercise/ProgrammingAssessmentIntegrationTest.java", "diffHunk": "@@ -194,6 +214,152 @@ public void testOverrideAssessment_submitSameTutorNoAssessmentDueDatePossible()\n         overrideAssessment(HttpStatus.OK);\n     }\n \n+    @Test\n+    @WithMockUser(value = \"student1\", roles = \"USER\")\n+    public void programmingExerciseManualResult_noManualReviewsAllowed_forbidden() throws Exception {\n+        request.put(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results\", result, HttpStatus.FORBIDDEN);\n+        request.put(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results?submit=true\", result, HttpStatus.FORBIDDEN);\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void programmingExerciseManualResult_noManualReviewsWithoutSubmission() throws Exception {\n+        // When it is the first manual result, a new submission is created with latest commit hash\n+        Result response = request.putWithResponseBody(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results\", result, Result.class,\n+                HttpStatus.OK);\n+        String commitHash = ((ProgrammingSubmission) response.getSubmission()).getCommitHash();\n+        assertThat(dummyHash.equalsIgnoreCase(commitHash));\n+\n+        // Check when a manual result already exists that submission is fetched\n+        result.setSubmission(null);\n+        request.put(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results\", result, HttpStatus.OK);\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"tutor1\", roles = \"TA\")\n+    public void createManualProgrammingExerciseResult_save() throws Exception {", "originalCommit": "8a6e370d5fc17ca254cac4502f9e395647a0239a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODYzMzYxMg==", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r478633612", "bodyText": "Codacy found an issue: The JUnit 5 test method name 'createManualProgrammingExerciseResult_manualResultsNotAllowed' doesn't match '[a-z][a-zA-Z0-9]*'", "author": "artemis-bot", "createdAt": "2020-08-27T19:04:16Z", "path": "src/test/java/de/tum/in/www1/artemis/programmingexercise/ProgrammingAssessmentIntegrationTest.java", "diffHunk": "@@ -194,6 +214,152 @@ public void testOverrideAssessment_submitSameTutorNoAssessmentDueDatePossible()\n         overrideAssessment(HttpStatus.OK);\n     }\n \n+    @Test\n+    @WithMockUser(value = \"student1\", roles = \"USER\")\n+    public void programmingExerciseManualResult_noManualReviewsAllowed_forbidden() throws Exception {\n+        request.put(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results\", result, HttpStatus.FORBIDDEN);\n+        request.put(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results?submit=true\", result, HttpStatus.FORBIDDEN);\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void programmingExerciseManualResult_noManualReviewsWithoutSubmission() throws Exception {\n+        // When it is the first manual result, a new submission is created with latest commit hash\n+        Result response = request.putWithResponseBody(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results\", result, Result.class,\n+                HttpStatus.OK);\n+        String commitHash = ((ProgrammingSubmission) response.getSubmission()).getCommitHash();\n+        assertThat(dummyHash.equalsIgnoreCase(commitHash));\n+\n+        // Check when a manual result already exists that submission is fetched\n+        result.setSubmission(null);\n+        request.put(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results\", result, HttpStatus.OK);\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"tutor1\", roles = \"TA\")\n+    public void createManualProgrammingExerciseResult_save() throws Exception {\n+        Result response = request.putWithResponseBody(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results\", result, Result.class,\n+                HttpStatus.OK);\n+\n+        assertThat(response.getResultString()).isEqualTo(result.getResultString());\n+        assertThat(response.getSubmission()).isNotNull();\n+        assertThat(response.getParticipation()).isEqualTo(result.getParticipation());\n+        assertThat(response.getFeedbacks().size()).isEqualTo(result.getFeedbacks().size());\n+        assertThat(response.isRated().equals(Boolean.FALSE));\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"tutor1\", roles = \"TA\")\n+    public void createManualProgrammingExerciseResult_submit() throws Exception {\n+        Result response = request.putWithResponseBody(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results?submit=true\", result,\n+                Result.class, HttpStatus.OK);\n+\n+        assertThat(response.getResultString()).isEqualTo(result.getResultString());\n+        assertThat(response.getSubmission()).isNotNull();\n+        assertThat(response.getParticipation()).isEqualTo(result.getParticipation());\n+        assertThat(response.getFeedbacks().size()).isEqualTo(result.getFeedbacks().size());\n+        assertThat(response.isRated().equals(Boolean.TRUE));\n+        assertThat(response.getCompletionDate().equals(ZonedDateTime.now()));\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"tutor1\", roles = \"TA\")\n+    public void createManualProgrammingExerciseResult_manualResultsNotAllowed() throws Exception {", "originalCommit": "8a6e370d5fc17ca254cac4502f9e395647a0239a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODYzMzYyMA==", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r478633620", "bodyText": "Codacy found an issue: The JUnit 5 test method name 'programmingExerciseManualResult_noManualReviewsWithoutSubmission' doesn't match '[a-z][a-zA-Z0-9]*'", "author": "artemis-bot", "createdAt": "2020-08-27T19:04:17Z", "path": "src/test/java/de/tum/in/www1/artemis/programmingexercise/ProgrammingAssessmentIntegrationTest.java", "diffHunk": "@@ -194,6 +214,152 @@ public void testOverrideAssessment_submitSameTutorNoAssessmentDueDatePossible()\n         overrideAssessment(HttpStatus.OK);\n     }\n \n+    @Test\n+    @WithMockUser(value = \"student1\", roles = \"USER\")\n+    public void programmingExerciseManualResult_noManualReviewsAllowed_forbidden() throws Exception {\n+        request.put(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results\", result, HttpStatus.FORBIDDEN);\n+        request.put(\"/api/participations/\" + programmingExerciseStudentParticipation.getId() + \"/manual-results?submit=true\", result, HttpStatus.FORBIDDEN);\n+    }\n+\n+    @Test\n+    @WithMockUser(value = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void programmingExerciseManualResult_noManualReviewsWithoutSubmission() throws Exception {", "originalCommit": "8a6e370d5fc17ca254cac4502f9e395647a0239a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6ff6e94a89ca9118c5c80eec7feb885ec2800c17", "url": "https://github.com/ls1intum/Artemis/commit/6ff6e94a89ca9118c5c80eec7feb885ec2800c17", "message": "added a new route for the tutors/instructors to open the student submission in the online editor", "committedDate": "2020-05-20T14:10:55Z", "type": "commit"}, {"oid": "c43cedb112c1831d9502f75ff301f7187021ee8c", "url": "https://github.com/ls1intum/Artemis/commit/c43cedb112c1831d9502f75ff301f7187021ee8c", "message": "Merge branch 'develop' into feature/online-editor/open-student-submission-in-online-editor", "committedDate": "2020-05-25T18:18:33Z", "type": "commit"}, {"oid": "3f51f4caebc8eb831fc1c3d84b9fa9d63f04f286", "url": "https://github.com/ls1intum/Artemis/commit/3f51f4caebc8eb831fc1c3d84b9fa9d63f04f286", "message": "added buttons for the assessment of tutors", "committedDate": "2020-05-26T07:07:52Z", "type": "commit"}, {"oid": "ac774134ea92b99e282efad8c3ca2101c395e137", "url": "https://github.com/ls1intum/Artemis/commit/ac774134ea92b99e282efad8c3ca2101c395e137", "message": "duplicated the student code editor container to start working on a separated component", "committedDate": "2020-05-27T15:04:23Z", "type": "commit"}, {"oid": "e237e443be864a08f74909e67b7840254f49d647", "url": "https://github.com/ls1intum/Artemis/commit/e237e443be864a08f74909e67b7840254f49d647", "message": "removed changes which were introduced for testing and added input variable, which indicates if the code editor should readonly or not", "committedDate": "2020-05-27T15:05:53Z", "type": "commit"}, {"oid": "baea3bac8df8599dd595d08df2ff838f604e3e78", "url": "https://github.com/ls1intum/Artemis/commit/baea3bac8df8599dd595d08df2ff838f604e3e78", "message": "adjusted the navigation, now the new component can be access via new route", "committedDate": "2020-05-27T15:07:13Z", "type": "commit"}, {"oid": "d35c50c9b442db6ca397ff26bc9a23fefc1b6d0e", "url": "https://github.com/ls1intum/Artemis/commit/d35c50c9b442db6ca397ff26bc9a23fefc1b6d0e", "message": "changed default value of isTutorAssessment to false", "committedDate": "2020-05-28T20:52:53Z", "type": "commit"}, {"oid": "f408a54b1393f20d429faaa114529fe07ffcd2f3", "url": "https://github.com/ls1intum/Artemis/commit/f408a54b1393f20d429faaa114529fe07ffcd2f3", "message": "duplicated the code-editor-action.component and adjusted it for the tutor assessment usecase(not finished)", "committedDate": "2020-05-28T20:58:25Z", "type": "commit"}, {"oid": "2114174c111469126f01ae2f1071a0191572bb45", "url": "https://github.com/ls1intum/Artemis/commit/2114174c111469126f01ae2f1071a0191572bb45", "message": "removed unused import", "committedDate": "2020-05-28T21:05:24Z", "type": "commit"}, {"oid": "7165d1129045c2e2b0fd9df2cf5c2a1182bc467b", "url": "https://github.com/ls1intum/Artemis/commit/7165d1129045c2e2b0fd9df2cf5c2a1182bc467b", "message": "duplicated the programming-assessment-manual-result-dialog.component and adjusted it for our usecase(not finished)", "committedDate": "2020-05-28T21:07:12Z", "type": "commit"}, {"oid": "bd1aa552adaf3f3d6dc0c83419d709d8921b249b", "url": "https://github.com/ls1intum/Artemis/commit/bd1aa552adaf3f3d6dc0c83419d709d8921b249b", "message": "added setActionState, is used for transmission of the Actionstate from code-editor-action.component to programming-assessment-manual-result-in-code-editor.component", "committedDate": "2020-05-28T21:10:30Z", "type": "commit"}, {"oid": "6e08bbdd3112073ad03a4f5bed78ceadf4fb5a5a", "url": "https://github.com/ls1intum/Artemis/commit/6e08bbdd3112073ad03a4f5bed78ceadf4fb5a5a", "message": "added the \"new\" tutor action buttons and the manual assessment to the code-editor-tutor-assessment-container.component.html", "committedDate": "2020-05-28T21:11:41Z", "type": "commit"}, {"oid": "cd3d30fafaf03227659d3f96a84857a4596c716b", "url": "https://github.com/ls1intum/Artemis/commit/cd3d30fafaf03227659d3f96a84857a4596c716b", "message": "added variable isTutorAssessment, dependent on the value of this variable the programming-assessment-manual-review component will be visualized or not", "committedDate": "2020-05-28T21:13:21Z", "type": "commit"}, {"oid": "fa5abcd187f62657eec034319913b9d22aaf4f9e", "url": "https://github.com/ls1intum/Artemis/commit/fa5abcd187f62657eec034319913b9d22aaf4f9e", "message": "added new States for transmission of actions like submit or save", "committedDate": "2020-05-28T21:14:31Z", "type": "commit"}, {"oid": "6676fd768a22b2a58b3b332a2c8423c81ac0e6fe", "url": "https://github.com/ls1intum/Artemis/commit/6676fd768a22b2a58b3b332a2c8423c81ac0e6fe", "message": "added components to the ArtemisProgrammingAssessmentModule", "committedDate": "2020-06-02T16:25:45Z", "type": "commit"}, {"oid": "5d86a0addd9fd4734c19b06a93df5dfa6e39d4a0", "url": "https://github.com/ls1intum/Artemis/commit/5d86a0addd9fd4734c19b06a93df5dfa6e39d4a0", "message": "Merge branch 'develop' into feature/online-editor/open-student-submission-in-online-editor\n\n# Conflicts:\n#\tsrc/main/webapp/app/course/manage/course-management.module.ts", "committedDate": "2020-06-02T16:36:20Z", "type": "commit"}, {"oid": "9e7f4837e127e71198eb4df8dd2e8fdd2ed1c8e7", "url": "https://github.com/ls1intum/Artemis/commit/9e7f4837e127e71198eb4df8dd2e8fdd2ed1c8e7", "message": "added second Result badge for visualizing the result of the manual assessment", "committedDate": "2020-06-06T10:34:17Z", "type": "commit"}, {"oid": "016fd3d26491f3ca0bf7989bd357ef4a60e7a218", "url": "https://github.com/ls1intum/Artemis/commit/016fd3d26491f3ca0bf7989bd357ef4a60e7a218", "message": "enabled the possibility to visualize/insert manual feedback in the tutor code editor, without overwriting existing automatic feedbacks", "committedDate": "2020-06-06T12:32:55Z", "type": "commit"}, {"oid": "18ddcde4b265d20e461795bdd6e6e2f84a188bf8", "url": "https://github.com/ls1intum/Artemis/commit/18ddcde4b265d20e461795bdd6e6e2f84a188bf8", "message": "Merge branch 'develop' of https://github.com/ls1intum/Artemis into feature/online-editor/open-student-submission-in-online-editor\n\n# Conflicts:\n#\tsrc/main/webapp/app/exercises/programming/shared/code-editor/code-editor.module.ts\n#\tsrc/main/webapp/app/exercises/programming/shared/code-editor/layout/code-editor-grid.component.ts", "committedDate": "2020-07-30T20:39:05Z", "type": "commit"}, {"oid": "987583678a9778b6a72b4d3d6dba7b3437b0c522", "url": "https://github.com/ls1intum/Artemis/commit/987583678a9778b6a72b4d3d6dba7b3437b0c522", "message": "Merge branch 'develop' of https://github.com/ls1intum/Artemis into feature/online-editor/open-student-submission-in-online-editor", "committedDate": "2020-08-04T19:29:26Z", "type": "commit"}, {"oid": "8b6848e8cf4c1c6d21615d47db79516b052df6ad", "url": "https://github.com/ls1intum/Artemis/commit/8b6848e8cf4c1c6d21615d47db79516b052df6ad", "message": "clean up and add missing functionalities", "committedDate": "2020-08-12T10:35:57Z", "type": "commit"}, {"oid": "31d6a6beff3b6c84283d7298715eea0d6068cb2c", "url": "https://github.com/ls1intum/Artemis/commit/31d6a6beff3b6c84283d7298715eea0d6068cb2c", "message": "add event emitters for output", "committedDate": "2020-08-16T01:37:10Z", "type": "commit"}, {"oid": "a849ebe249224cba2d028fca4b0176088e5bd20a", "url": "https://github.com/ls1intum/Artemis/commit/a849ebe249224cba2d028fca4b0176088e5bd20a", "message": "use assessment-layout component and create needed functions and attributes", "committedDate": "2020-08-16T01:39:10Z", "type": "commit"}, {"oid": "091225826e58c4279d166a251f710d9caaa856c8", "url": "https://github.com/ls1intum/Artemis/commit/091225826e58c4279d166a251f710d9caaa856c8", "message": "cleanup and add documentation", "committedDate": "2020-08-17T12:23:41Z", "type": "commit"}, {"oid": "d7ee0ec7e151873065452552a57354384eb0c900", "url": "https://github.com/ls1intum/Artemis/commit/d7ee0ec7e151873065452552a57354384eb0c900", "message": "add correct updateAssessmentAfterComplaint", "committedDate": "2020-08-17T12:24:28Z", "type": "commit"}, {"oid": "0c80baef6e0d42bd0d6cc0f7addeb14bae4fc4b1", "url": "https://github.com/ls1intum/Artemis/commit/0c80baef6e0d42bd0d6cc0f7addeb14bae4fc4b1", "message": "remove code editor tutor actions", "committedDate": "2020-08-17T12:37:28Z", "type": "commit"}, {"oid": "6ad075d046527113b5eaf1f9f4cbb0d0ade47391", "url": "https://github.com/ls1intum/Artemis/commit/6ad075d046527113b5eaf1f9f4cbb0d0ade47391", "message": "remove assessment states in model", "committedDate": "2020-08-17T12:44:52Z", "type": "commit"}, {"oid": "95384acbfb0e82e7eec0fd7fbdeb77cb59af01b0", "url": "https://github.com/ls1intum/Artemis/commit/95384acbfb0e82e7eec0fd7fbdeb77cb59af01b0", "message": "amend", "committedDate": "2020-08-17T12:47:04Z", "type": "commit"}, {"oid": "f9f204e22bba1c1e1bd2b07ec2b10dddbc1bbad2", "url": "https://github.com/ls1intum/Artemis/commit/f9f204e22bba1c1e1bd2b07ec2b10dddbc1bbad2", "message": "add navigate back functionality", "committedDate": "2020-08-17T13:40:30Z", "type": "commit"}, {"oid": "cf41a23e1c76cb516955c690d41bda005683b0d8", "url": "https://github.com/ls1intum/Artemis/commit/cf41a23e1c76cb516955c690d41bda005683b0d8", "message": "add next submission functionality", "committedDate": "2020-08-17T14:09:44Z", "type": "commit"}, {"oid": "e23b9c80c1359054aafa5481faf94247a36a1844", "url": "https://github.com/ls1intum/Artemis/commit/e23b9c80c1359054aafa5481faf94247a36a1844", "message": "add cancel functionality", "committedDate": "2020-08-17T14:30:25Z", "type": "commit"}, {"oid": "7db2d4a5f5d3ca6dff9f74e75a40ed42902b16fc", "url": "https://github.com/ls1intum/Artemis/commit/7db2d4a5f5d3ca6dff9f74e75a40ed42902b16fc", "message": "add to module and fix warnings", "committedDate": "2020-08-17T14:30:45Z", "type": "commit"}, {"oid": "3f548b4958bd74678765b3e7dfd779f5306f04c7", "url": "https://github.com/ls1intum/Artemis/commit/3f548b4958bd74678765b3e7dfd779f5306f04c7", "message": "add new endpoint for save and submit programming exercises\nadd service functions for new endpoint", "committedDate": "2020-08-18T07:22:26Z", "type": "commit"}, {"oid": "1c67b0ff3bdf867f8da9040d11eff2bc686851b1", "url": "https://github.com/ls1intum/Artemis/commit/1c67b0ff3bdf867f8da9040d11eff2bc686851b1", "message": "trigger new endpoint on client", "committedDate": "2020-08-18T07:23:33Z", "type": "commit"}, {"oid": "c562531e4c55c8101453d2778751ef54c06e8e74", "url": "https://github.com/ls1intum/Artemis/commit/c562531e4c55c8101453d2778751ef54c06e8e74", "message": "run prettier", "committedDate": "2020-08-18T07:23:50Z", "type": "commit"}, {"oid": "fe62f313e8ac63ea7a3409f129bc373e21b8b5f4", "url": "https://github.com/ls1intum/Artemis/commit/fe62f313e8ac63ea7a3409f129bc373e21b8b5f4", "message": "Merge branch 'develop' of https://github.com/ls1intum/Artemis into feature/online-editor/open-student-submission-in-online-editor", "committedDate": "2020-08-18T07:24:19Z", "type": "commit"}, {"oid": "3a0deb03fcabf861f59728b4b4884ccd1f746bde", "url": "https://github.com/ls1intum/Artemis/commit/3a0deb03fcabf861f59728b4b4884ccd1f746bde", "message": "rework save and submit functionality", "committedDate": "2020-08-18T15:04:11Z", "type": "commit"}, {"oid": "1ee36c472f7381280f99ce54af4651adcf887295", "url": "https://github.com/ls1intum/Artemis/commit/1ee36c472f7381280f99ce54af4651adcf887295", "message": "fix nullpointer", "committedDate": "2020-08-18T16:11:59Z", "type": "commit"}, {"oid": "8750b83ea381c9f489530b6643b795aacaa90edc", "url": "https://github.com/ls1intum/Artemis/commit/8750b83ea381c9f489530b6643b795aacaa90edc", "message": "remove not needed arguments", "committedDate": "2020-08-19T19:06:11Z", "type": "commit"}, {"oid": "0f8b19797131b0f98a67b6f20d5b5ec29a6e542d", "url": "https://github.com/ls1intum/Artemis/commit/0f8b19797131b0f98a67b6f20d5b5ec29a6e542d", "message": "fix issue with file editor\nfix issue with assessNext function\nadded getComplaint", "committedDate": "2020-08-19T19:12:33Z", "type": "commit"}, {"oid": "db66d2dee95a3e724e64b6706a4a9a06cfbe3f1e", "url": "https://github.com/ls1intum/Artemis/commit/db66d2dee95a3e724e64b6706a4a9a06cfbe3f1e", "message": "add check as manual results can have no completionDate in database (only when save is used)", "committedDate": "2020-08-19T19:13:12Z", "type": "commit"}, {"oid": "6bd548f67757ac22210190d1434e7d565a2bb9e3", "url": "https://github.com/ls1intum/Artemis/commit/6bd548f67757ac22210190d1434e7d565a2bb9e3", "message": "fix that automatic result is deleted when cancelling assessment", "committedDate": "2020-08-20T00:22:06Z", "type": "commit"}, {"oid": "9dcc59b00654ee60dfc8905d0af73afb2a5e1833", "url": "https://github.com/ls1intum/Artemis/commit/9dcc59b00654ee60dfc8905d0af73afb2a5e1833", "message": "fix nullpointer", "committedDate": "2020-08-20T00:22:32Z", "type": "commit"}, {"oid": "839a89dd11136e6914ed2f48c40d4db1bb14679e", "url": "https://github.com/ls1intum/Artemis/commit/839a89dd11136e6914ed2f48c40d4db1bb14679e", "message": "remove duplicated alert and console.log", "committedDate": "2020-08-20T00:24:21Z", "type": "commit"}, {"oid": "80e08e4a68dc840b87c685126a4864bc3c0fee4f", "url": "https://github.com/ls1intum/Artemis/commit/80e08e4a68dc840b87c685126a4864bc3c0fee4f", "message": "add check that resultstring must be filled", "committedDate": "2020-08-20T00:24:59Z", "type": "commit"}, {"oid": "869cf9d7c14a8e1c456664f35b20203ebce7c3d9", "url": "https://github.com/ls1intum/Artemis/commit/869cf9d7c14a8e1c456664f35b20203ebce7c3d9", "message": "Merge branch 'develop' of https://github.com/ls1intum/Artemis into feature/online-editor/open-student-submission-in-online-editor", "committedDate": "2020-08-20T01:08:35Z", "type": "commit"}, {"oid": "b44cd3b231e41c6743349109da26138abff9a0a9", "url": "https://github.com/ls1intum/Artemis/commit/b44cd3b231e41c6743349109da26138abff9a0a9", "message": "make complaints work", "committedDate": "2020-08-20T02:27:17Z", "type": "commit"}, {"oid": "6423f9733a427898bcef9bcbe69941171bee8c68", "url": "https://github.com/ls1intum/Artemis/commit/6423f9733a427898bcef9bcbe69941171bee8c68", "message": "add new endpoint to fetch all results with feedbacks of a participation", "committedDate": "2020-08-20T07:37:25Z", "type": "commit"}, {"oid": "16cbbe8e51f7fc6f2279a6c4a43b4b7b19b67d5c", "url": "https://github.com/ls1intum/Artemis/commit/16cbbe8e51f7fc6f2279a6c4a43b4b7b19b67d5c", "message": "use new endpoint to retrieve information about automatic result and manual\ndisplay automatic result", "committedDate": "2020-08-20T07:38:27Z", "type": "commit"}, {"oid": "12f8d27a72e55fbedf94b90fb3690265d7c54156", "url": "https://github.com/ls1intum/Artemis/commit/12f8d27a72e55fbedf94b90fb3690265d7c54156", "message": "Merge branch 'develop' of https://github.com/ls1intum/Artemis into feature/online-editor/open-student-submission-in-online-editor\n\n# Conflicts:\n#\tsrc/main/webapp/app/exercises/programming/participate/code-editor-student-container.component.html\n#\tsrc/main/webapp/app/exercises/programming/participate/programming-participation.module.ts\n#\tsrc/main/webapp/app/exercises/programming/shared/code-editor/ace/code-editor-ace.component.ts\n#\tsrc/main/webapp/app/exercises/programming/shared/code-editor/container/code-editor-container.component.ts\n#\tsrc/main/webapp/app/exercises/programming/shared/code-editor/layout/code-editor-grid.component.ts", "committedDate": "2020-08-22T04:34:55Z", "type": "commit"}, {"oid": "889c7baf145ebcf4b465a0a0fa8d99c9cdaf8595", "url": "https://github.com/ls1intum/Artemis/commit/889c7baf145ebcf4b465a0a0fa8d99c9cdaf8595", "message": "cleanup after merge", "committedDate": "2020-08-22T05:32:07Z", "type": "commit"}, {"oid": "33637bf05fd7f995046a8781d237e202877d797e", "url": "https://github.com/ls1intum/Artemis/commit/33637bf05fd7f995046a8781d237e202877d797e", "message": "use new code-editor component and clean up", "committedDate": "2020-08-22T05:32:42Z", "type": "commit"}, {"oid": "f130d74e4471ef64b29b5479c21c76e17fd6951f", "url": "https://github.com/ls1intum/Artemis/commit/f130d74e4471ef64b29b5479c21c76e17fd6951f", "message": "fix modules", "committedDate": "2020-08-22T18:31:35Z", "type": "commit"}, {"oid": "b299691f6c89731479d72b653faa70ba23bbb889", "url": "https://github.com/ls1intum/Artemis/commit/b299691f6c89731479d72b653faa70ba23bbb889", "message": "try to fix tests", "committedDate": "2020-08-22T18:32:30Z", "type": "commit"}, {"oid": "cf19252785572576c7762a5cc5efd72656238c84", "url": "https://github.com/ls1intum/Artemis/commit/cf19252785572576c7762a5cc5efd72656238c84", "message": "add back section in grid component", "committedDate": "2020-08-22T19:30:36Z", "type": "commit"}, {"oid": "be1a72a68b71b2e61c8bfd735c0fb4b3e2bf39a5", "url": "https://github.com/ls1intum/Artemis/commit/be1a72a68b71b2e61c8bfd735c0fb4b3e2bf39a5", "message": "add extra section and disable build output for assessment", "committedDate": "2020-08-22T19:31:45Z", "type": "commit"}, {"oid": "a269dce1b17bd2088bbc058cf8f7b5a31b79ee03", "url": "https://github.com/ls1intum/Artemis/commit/a269dce1b17bd2088bbc058cf8f7b5a31b79ee03", "message": "move manual assessment back to code editor grid", "committedDate": "2020-08-22T19:34:16Z", "type": "commit"}, {"oid": "4a751ba8b57cafff2c9c53df69a6f01ada784f59", "url": "https://github.com/ls1intum/Artemis/commit/4a751ba8b57cafff2c9c53df69a6f01ada784f59", "message": "remove empty space in dom", "committedDate": "2020-08-23T14:50:11Z", "type": "commit"}, {"oid": "05383ba53cb761dad57a71786fbb330b70818bd8", "url": "https://github.com/ls1intum/Artemis/commit/05383ba53cb761dad57a71786fbb330b70818bd8", "message": "fetch also assessor", "committedDate": "2020-08-23T14:50:25Z", "type": "commit"}, {"oid": "0bcdadc47d918fe2abc4dea0d6fe91a5a3c92b17", "url": "https://github.com/ls1intum/Artemis/commit/0bcdadc47d918fe2abc4dea0d6fe91a5a3c92b17", "message": "fix route for exam exercises", "committedDate": "2020-08-23T16:57:21Z", "type": "commit"}, {"oid": "b3a7c92b0e3e60cdf7c6f41dc0043622090633ac", "url": "https://github.com/ls1intum/Artemis/commit/b3a7c92b0e3e60cdf7c6f41dc0043622090633ac", "message": "add calls to get latest result, latest automatic result and latest manual result\nmove participation fetch to onInit\nuse refactored navigate back\nadd checkPermissions", "committedDate": "2020-08-23T17:20:28Z", "type": "commit"}, {"oid": "29fcb76b9d86f0875ccf88fdb1e3e1f9210d0ba7", "url": "https://github.com/ls1intum/Artemis/commit/29fcb76b9d86f0875ccf88fdb1e3e1f9210d0ba7", "message": "remove not used code\nadd check that assessor cannot edit resultstring and add new feedback", "committedDate": "2020-08-23T17:25:43Z", "type": "commit"}, {"oid": "bbf4f3021a5ed2437f23812abc8ffe5d7e136446", "url": "https://github.com/ls1intum/Artemis/commit/bbf4f3021a5ed2437f23812abc8ffe5d7e136446", "message": "run spotless and prettier", "committedDate": "2020-08-23T17:28:55Z", "type": "commit"}, {"oid": "1eb4167cce1e92841d27cca000bebdb8cc0e0ea3", "url": "https://github.com/ls1intum/Artemis/commit/1eb4167cce1e92841d27cca000bebdb8cc0e0ea3", "message": "try to make codacy happy", "committedDate": "2020-08-24T06:39:37Z", "type": "commit"}, {"oid": "7a3dd9afc7ee7968dd8b3ebd14108b5368d94869", "url": "https://github.com/ls1intum/Artemis/commit/7a3dd9afc7ee7968dd8b3ebd14108b5368d94869", "message": "do not display action buttons", "committedDate": "2020-08-24T06:46:06Z", "type": "commit"}, {"oid": "2092b3b065b2104e7c1fe9fab237a23210bb806b", "url": "https://github.com/ls1intum/Artemis/commit/2092b3b065b2104e7c1fe9fab237a23210bb806b", "message": "move manual result tests to ProgrammingAssessmentIntegrationTest, adapt tests and add tests", "committedDate": "2020-08-24T18:11:42Z", "type": "commit"}, {"oid": "3d89d452fe7938fe07d2860a2ecee99f740d6464", "url": "https://github.com/ls1intum/Artemis/commit/3d89d452fe7938fe07d2860a2ecee99f740d6464", "message": "remove not used endpoints and rename new endpoints to 'manual-results'", "committedDate": "2020-08-24T18:18:05Z", "type": "commit"}, {"oid": "ddd965fc1f208ba68ac22a2a7c1fa5610dc40f3d", "url": "https://github.com/ls1intum/Artemis/commit/ddd965fc1f208ba68ac22a2a7c1fa5610dc40f3d", "message": "removed not used dialog/modal code for manual assessment", "committedDate": "2020-08-24T18:32:32Z", "type": "commit"}, {"oid": "ad95f709121f48fd09a6fce3dd2e7ef94a295885", "url": "https://github.com/ls1intum/Artemis/commit/ad95f709121f48fd09a6fce3dd2e7ef94a295885", "message": "comment out test for dialog/modal component and run spotless", "committedDate": "2020-08-24T18:33:43Z", "type": "commit"}, {"oid": "48df1aa8d38302decbe20be1d74c1b00e70b5ec8", "url": "https://github.com/ls1intum/Artemis/commit/48df1aa8d38302decbe20be1d74c1b00e70b5ec8", "message": "remove not needed alerts as parent component has it\nfix typo\nadd copy of participation for manual results", "committedDate": "2020-08-24T19:09:05Z", "type": "commit"}, {"oid": "5fda6d499b27a1ab19fa83712c7d99afef8f9899", "url": "https://github.com/ls1intum/Artemis/commit/5fda6d499b27a1ab19fa83712c7d99afef8f9899", "message": "fix failing test and comment out not working tests for the moment", "committedDate": "2020-08-25T07:34:22Z", "type": "commit"}, {"oid": "6c3db7940f50a901e316d47c33abcd452ee454cd", "url": "https://github.com/ls1intum/Artemis/commit/6c3db7940f50a901e316d47c33abcd452ee454cd", "message": "add margin in navbar and make sure that manualResult is always up to date", "committedDate": "2020-08-25T08:28:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjMwMjIyNw==", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476302227", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (submit) {\n          \n          \n            \n                    if (submit) {", "author": "MaisiKoleni", "createdAt": "2020-08-25T09:14:29Z", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ProgrammingAssessmentResource.java", "diffHunk": "@@ -71,6 +89,114 @@ public ProgrammingAssessmentResource(AuthorizationCheckService authCheckService,\n         return ResponseEntity.ok(result);\n     }\n \n+    /**\n+     * Cancel an assessment of a given submission for the current user, i.e. delete the corresponding result / release the lock. Then the submission is available for assessment\n+     * again.\n+     *\n+     * @param submissionId the id of the submission for which the current assessment should be canceled\n+     * @return 200 Ok response if canceling was successful, 403 Forbidden if current user is not the assessor of the submission\n+     */\n+    @PutMapping(\"/programming-submissions/{submissionId}/cancel-assessment\")\n+    @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Void> cancelAssessment(@PathVariable Long submissionId) {\n+        return super.cancelAssessment(submissionId);\n+    }\n+\n+    /**\n+     * Save or submit feedback for programming exercise.\n+     *\n+     * @param participationId the id of the participation that should be sent to the client\n+     * @param submit       defines if assessment is submitted or saved\n+     * @param newResult    result with ist of feedbacks to be saved to the database\n+     * @return the result saved to the database\n+     */\n+    @ResponseStatus(HttpStatus.OK)\n+    @PutMapping(\"/participations/{participationId}/manual-results\")\n+    @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Result> saveProgrammingAssessment(@PathVariable Long participationId, @RequestParam(value = \"submit\", defaultValue = \"false\") boolean submit,\n+            @RequestBody Result newResult) {\n+        log.debug(\"REST request to save a new result : {}\", newResult);\n+        final var participation = participationService.findOneWithEagerResultsAndCourse(participationId);\n+\n+        User user = userService.getUserWithGroupsAndAuthorities();\n+\n+        Optional<Result> latestExistingResult = participation.getResults().stream().filter(result -> result.getAssessmentType() == AssessmentType.MANUAL).findFirst();\n+        if (latestExistingResult.isPresent()) {\n+            // prevent that tutors create multiple manual results\n+            // TODO: Double check if this is the right way to do, or if we should create a new Manual Result\n+            newResult.setId(latestExistingResult.get().getId());\n+            // load assessor\n+            latestExistingResult = resultRepository.findWithEagerSubmissionAndFeedbackAndAssessorById(latestExistingResult.get().getId());\n+        }\n+\n+        // make sure that the participation cannot be manipulated on the client side\n+        newResult.setParticipation(participation);\n+\n+        ProgrammingExercise exercise = (ProgrammingExercise) participation.getExercise();\n+        checkAuthorization(exercise, user);\n+\n+        final var isAtLeastInstructor = authCheckService.isAtLeastInstructorForExercise(exercise, user);\n+        if (!assessmentService.isAllowedToCreateOrOverrideResult(latestExistingResult.orElse(null), exercise, participation, user, isAtLeastInstructor)) {\n+            log.debug(\"The user \" + user.getLogin() + \" is not allowed to override the assessment for the participation \" + participation.getId() + \" for User \" + user.getLogin());\n+            return forbidden(\"assessment\", \"assessmentSaveNotAllowed\", \"The user is not allowed to override the assessment\");\n+        }\n+\n+        final var course = exercise.getCourseViaExerciseGroupOrCourseMember();\n+        if (!authCheckService.isAtLeastTeachingAssistantInCourse(course, user) || !exercise.areManualResultsAllowed()) {\n+            return forbidden();\n+        }\n+\n+        if (newResult.getResultString() == null) {\n+            throw new BadRequestAlertException(\"Result string is required.\", ENTITY_NAME, \"resultStringNull\");\n+        }\n+        else if (newResult.getResultString().length() > 255) {\n+            throw new BadRequestAlertException(\"Result string is too long.\", ENTITY_NAME, \"resultStringNull\");\n+        }\n+        else if (newResult.getScore() == null) {\n+            throw new BadRequestAlertException(\"Score is required.\", ENTITY_NAME, \"scoreNull\");\n+        }\n+        else if (newResult.getScore() < 100 && newResult.isSuccessful()) {\n+            throw new BadRequestAlertException(\"Only result with score 100% can be successful.\", ENTITY_NAME, \"scoreAndSuccessfulNotMatching\");\n+        }\n+        else if (!newResult.getFeedbacks().isEmpty() && newResult.getFeedbacks().stream().anyMatch(feedback -> feedback.getText() == null)) {\n+            throw new BadRequestAlertException(\"In case feedback is present, feedback text and detail text are mandatory.\", ENTITY_NAME, \"feedbackTextOrDetailTextNull\");\n+        }\n+\n+        ProgrammingSubmission submission;\n+        if (latestExistingResult.isEmpty()) {\n+            // TODO: Double check if we can create a new result when the existing result has already a completion date (submitted)\n+            // Create manual submission with last commit hash und current time stamp.\n+            submission = programmingSubmissionService.createSubmissionWithLastCommitHashForParticipation((ProgrammingExerciseStudentParticipation) participation,\n+                    SubmissionType.MANUAL);\n+            newResult.setSubmission(submission);\n+        }\n+        else {\n+            submission = programmingSubmissionService.findByIdWithEagerResultAndFeedback(latestExistingResult.get().getSubmission().getId());\n+            newResult.setSubmission(submission);\n+            if (newResult.getSubmission() == null) {\n+                throw new BadRequestAlertException(\"The submission is not connected to the result.\", ENTITY_NAME, \"submissionMissing\");\n+            }\n+        }\n+\n+        Result result = programmingAssessmentService.saveManualAssessment(newResult);\n+\n+        if (submit) {\n+", "originalCommit": "5fda6d499b27a1ab19fa83712c7d99afef8f9899", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQzNDY2Mw==", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476434663", "bodyText": "done \ud83d\ude04", "author": "fde312", "createdAt": "2020-08-25T13:08:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjMwMjIyNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjI2MDkxMQ==", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476260911", "bodyText": "I would add AndAssessor to the method name :-)", "author": "sascha11110", "createdAt": "2020-08-25T08:11:38Z", "path": "src/main/java/de/tum/in/www1/artemis/repository/ProgrammingExerciseStudentParticipationRepository.java", "diffHunk": "@@ -24,6 +24,9 @@\n     @Query(\"select p from ProgrammingExerciseStudentParticipation p left join fetch p.results pr left join fetch pr.feedbacks left join fetch pr.submission where p.id = :participationId and (pr.id = (select max(id) from p.results) or pr.id = null)\")\n     Optional<ProgrammingExerciseStudentParticipation> findByIdWithLatestResultAndFeedbacksAndRelatedSubmissions(@Param(\"participationId\") Long participationId);\n \n+    @Query(\"select p from ProgrammingExerciseStudentParticipation p left join fetch p.results pr left join fetch pr.feedbacks left join fetch pr.submission left join fetch pr.assessor where p.id = :participationId\")\n+    Optional<ProgrammingExerciseStudentParticipation> findByIdWithResultsAndFeedbacksAndRelatedSubmissions(@Param(\"participationId\") Long participationId);", "originalCommit": "5fda6d499b27a1ab19fa83712c7d99afef8f9899", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQzNjUzNw==", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476436537", "bodyText": "done. I also renamed the method name in the Service :)", "author": "fde312", "createdAt": "2020-08-25T13:11:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjI2MDkxMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjI2MjU2Mw==", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476262563", "bodyText": "I think you should remove this line?", "author": "sascha11110", "createdAt": "2020-08-25T08:14:10Z", "path": "src/main/java/de/tum/in/www1/artemis/service/ProgrammingAssessmentService.java", "diffHunk": "@@ -33,4 +40,55 @@ public Result updateAssessmentAfterComplaint(Result originalResult, Exercise exe\n         originalResult.setScore(assessmentUpdate.getScore());\n         return super.updateAssessmentAfterComplaint(originalResult, exercise, assessmentUpdate);\n     }\n+\n+    /**\n+     * This function is used for saving a manual assessment/result. It sets the assessment type to MANUAL and sets the assessor attribute. Furthermore, it saves the result in the\n+     * database.\n+     *\n+     // * @param submission the modeling submission to which the feedback belongs to", "originalCommit": "5fda6d499b27a1ab19fa83712c7d99afef8f9899", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQzNzM1OQ==", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476437359", "bodyText": "jupe :)", "author": "fde312", "createdAt": "2020-08-25T13:12:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjI2MjU2Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjI3Mjg3OA==", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476272878", "bodyText": "You should clarify this question in this PR :-)\nI think the reason for setting it explicitly to false is that there is no default value in Result.java and that the database sets it to NULL if a value is missing.", "author": "sascha11110", "createdAt": "2020-08-25T08:30:49Z", "path": "src/main/java/de/tum/in/www1/artemis/service/ProgrammingAssessmentService.java", "diffHunk": "@@ -33,4 +40,55 @@ public Result updateAssessmentAfterComplaint(Result originalResult, Exercise exe\n         originalResult.setScore(assessmentUpdate.getScore());\n         return super.updateAssessmentAfterComplaint(originalResult, exercise, assessmentUpdate);\n     }\n+\n+    /**\n+     * This function is used for saving a manual assessment/result. It sets the assessment type to MANUAL and sets the assessor attribute. Furthermore, it saves the result in the\n+     * database.\n+     *\n+     // * @param submission the modeling submission to which the feedback belongs to\n+     * @param result the new result of a programming exercise\n+     * @return result that was saved in the database\n+     */\n+    @Transactional\n+    public Result saveManualAssessment(Result result) {\n+        Boolean isFeedbackEmpty = result.getFeedbacks().isEmpty();\n+        result.setHasFeedback(!isFeedbackEmpty);\n+\n+        User user = userService.getUserWithGroupsAndAuthorities();\n+        // TODO: Double check why we set here complaint false\n+        result.setHasComplaint(false);", "originalCommit": "5fda6d499b27a1ab19fa83712c7d99afef8f9899", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQzOTQwMQ==", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476439401", "bodyText": "You are right, I forgot to remove my comment! :)", "author": "fde312", "createdAt": "2020-08-25T13:15:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjI3Mjg3OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjI3NzA3NA==", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476277074", "bodyText": "Remove this lines?", "author": "sascha11110", "createdAt": "2020-08-25T08:37:39Z", "path": "src/main/java/de/tum/in/www1/artemis/service/ProgrammingAssessmentService.java", "diffHunk": "@@ -33,4 +40,55 @@ public Result updateAssessmentAfterComplaint(Result originalResult, Exercise exe\n         originalResult.setScore(assessmentUpdate.getScore());\n         return super.updateAssessmentAfterComplaint(originalResult, exercise, assessmentUpdate);\n     }\n+\n+    /**\n+     * This function is used for saving a manual assessment/result. It sets the assessment type to MANUAL and sets the assessor attribute. Furthermore, it saves the result in the\n+     * database.\n+     *\n+     // * @param submission the modeling submission to which the feedback belongs to\n+     * @param result the new result of a programming exercise\n+     * @return result that was saved in the database\n+     */\n+    @Transactional\n+    public Result saveManualAssessment(Result result) {\n+        Boolean isFeedbackEmpty = result.getFeedbacks().isEmpty();\n+        result.setHasFeedback(!isFeedbackEmpty);\n+\n+        User user = userService.getUserWithGroupsAndAuthorities();\n+        // TODO: Double check why we set here complaint false\n+        result.setHasComplaint(false);\n+        result.setAssessmentType(AssessmentType.MANUAL);\n+        result.setAssessor(user);\n+\n+        result.setCompletionDate(null);\n+        result.setRated(false);\n+\n+        result.getFeedbacks().forEach(feedback -> {\n+            feedback.setResult(result);\n+        });\n+\n+        // Note: This also saves the feedback objects in the database because of the 'cascade = CascadeType.ALL' option.\n+        return resultRepository.save(result);\n+    }\n+\n+    /**\n+     * This function is used for submitting a manual assessment/result. It gets the result that belongs to the given resultId, updates the completion date, sets the assessment type\n+     * to MANUAL and sets the assessor attribute. Afterwards, it saves the update result in the database again.\n+     *\n+     * @param resultId the id of the result that should be submitted\n+     * @return the ResponseEntity with result as body\n+     */\n+    @Transactional\n+    public Result submitManualAssessment(long resultId) {\n+        Result result = resultRepository.findWithEagerSubmissionAndFeedbackAndAssessorById(resultId)\n+                .orElseThrow(() -> new EntityNotFoundException(\"No result for the given resultId could be found\"));\n+        // Every manual assessed programming submission is rated\n+        result.setRated(true);\n+        result.setCompletionDate(ZonedDateTime.now());\n+\n+        // Double calculatedScore = calculateTotalScore(result.getFeedbacks());\n+        // return submitResult(result, exercise, calculatedScore);", "originalCommit": "5fda6d499b27a1ab19fa83712c7d99afef8f9899", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ0MDYwOQ==", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476440609", "bodyText": "We will keep that, as we want to use this later on when we established to give points for manual results (similar to text and modeling) :)", "author": "fde312", "createdAt": "2020-08-25T13:17:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjI3NzA3NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ0MDgzNQ==", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476440835", "bodyText": "I added a todo for this, so this is more clear why its commented out for the moment", "author": "fde312", "createdAt": "2020-08-25T13:18:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjI3NzA3NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjI4MTQzOA==", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476281438", "bodyText": "Clarify this in this PR :-)", "author": "sascha11110", "createdAt": "2020-08-25T08:44:26Z", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ProgrammingAssessmentResource.java", "diffHunk": "@@ -71,6 +89,114 @@ public ProgrammingAssessmentResource(AuthorizationCheckService authCheckService,\n         return ResponseEntity.ok(result);\n     }\n \n+    /**\n+     * Cancel an assessment of a given submission for the current user, i.e. delete the corresponding result / release the lock. Then the submission is available for assessment\n+     * again.\n+     *\n+     * @param submissionId the id of the submission for which the current assessment should be canceled\n+     * @return 200 Ok response if canceling was successful, 403 Forbidden if current user is not the assessor of the submission\n+     */\n+    @PutMapping(\"/programming-submissions/{submissionId}/cancel-assessment\")\n+    @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Void> cancelAssessment(@PathVariable Long submissionId) {\n+        return super.cancelAssessment(submissionId);\n+    }\n+\n+    /**\n+     * Save or submit feedback for programming exercise.\n+     *\n+     * @param participationId the id of the participation that should be sent to the client\n+     * @param submit       defines if assessment is submitted or saved\n+     * @param newResult    result with ist of feedbacks to be saved to the database\n+     * @return the result saved to the database\n+     */\n+    @ResponseStatus(HttpStatus.OK)\n+    @PutMapping(\"/participations/{participationId}/manual-results\")\n+    @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Result> saveProgrammingAssessment(@PathVariable Long participationId, @RequestParam(value = \"submit\", defaultValue = \"false\") boolean submit,\n+            @RequestBody Result newResult) {\n+        log.debug(\"REST request to save a new result : {}\", newResult);\n+        final var participation = participationService.findOneWithEagerResultsAndCourse(participationId);\n+\n+        User user = userService.getUserWithGroupsAndAuthorities();\n+\n+        Optional<Result> latestExistingResult = participation.getResults().stream().filter(result -> result.getAssessmentType() == AssessmentType.MANUAL).findFirst();\n+        if (latestExistingResult.isPresent()) {\n+            // prevent that tutors create multiple manual results\n+            // TODO: Double check if this is the right way to do, or if we should create a new Manual Result", "originalCommit": "5fda6d499b27a1ab19fa83712c7d99afef8f9899", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ0MTUxMQ==", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476441511", "bodyText": "Removed the comment! :)", "author": "fde312", "createdAt": "2020-08-25T13:19:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjI4MTQzOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjI4NjAxMg==", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476286012", "bodyText": "I think the first check is already done in checkAuthorization()", "author": "sascha11110", "createdAt": "2020-08-25T08:51:25Z", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ProgrammingAssessmentResource.java", "diffHunk": "@@ -71,6 +89,114 @@ public ProgrammingAssessmentResource(AuthorizationCheckService authCheckService,\n         return ResponseEntity.ok(result);\n     }\n \n+    /**\n+     * Cancel an assessment of a given submission for the current user, i.e. delete the corresponding result / release the lock. Then the submission is available for assessment\n+     * again.\n+     *\n+     * @param submissionId the id of the submission for which the current assessment should be canceled\n+     * @return 200 Ok response if canceling was successful, 403 Forbidden if current user is not the assessor of the submission\n+     */\n+    @PutMapping(\"/programming-submissions/{submissionId}/cancel-assessment\")\n+    @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Void> cancelAssessment(@PathVariable Long submissionId) {\n+        return super.cancelAssessment(submissionId);\n+    }\n+\n+    /**\n+     * Save or submit feedback for programming exercise.\n+     *\n+     * @param participationId the id of the participation that should be sent to the client\n+     * @param submit       defines if assessment is submitted or saved\n+     * @param newResult    result with ist of feedbacks to be saved to the database\n+     * @return the result saved to the database\n+     */\n+    @ResponseStatus(HttpStatus.OK)\n+    @PutMapping(\"/participations/{participationId}/manual-results\")\n+    @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Result> saveProgrammingAssessment(@PathVariable Long participationId, @RequestParam(value = \"submit\", defaultValue = \"false\") boolean submit,\n+            @RequestBody Result newResult) {\n+        log.debug(\"REST request to save a new result : {}\", newResult);\n+        final var participation = participationService.findOneWithEagerResultsAndCourse(participationId);\n+\n+        User user = userService.getUserWithGroupsAndAuthorities();\n+\n+        Optional<Result> latestExistingResult = participation.getResults().stream().filter(result -> result.getAssessmentType() == AssessmentType.MANUAL).findFirst();\n+        if (latestExistingResult.isPresent()) {\n+            // prevent that tutors create multiple manual results\n+            // TODO: Double check if this is the right way to do, or if we should create a new Manual Result\n+            newResult.setId(latestExistingResult.get().getId());\n+            // load assessor\n+            latestExistingResult = resultRepository.findWithEagerSubmissionAndFeedbackAndAssessorById(latestExistingResult.get().getId());\n+        }\n+\n+        // make sure that the participation cannot be manipulated on the client side\n+        newResult.setParticipation(participation);\n+\n+        ProgrammingExercise exercise = (ProgrammingExercise) participation.getExercise();\n+        checkAuthorization(exercise, user);\n+\n+        final var isAtLeastInstructor = authCheckService.isAtLeastInstructorForExercise(exercise, user);\n+        if (!assessmentService.isAllowedToCreateOrOverrideResult(latestExistingResult.orElse(null), exercise, participation, user, isAtLeastInstructor)) {\n+            log.debug(\"The user \" + user.getLogin() + \" is not allowed to override the assessment for the participation \" + participation.getId() + \" for User \" + user.getLogin());\n+            return forbidden(\"assessment\", \"assessmentSaveNotAllowed\", \"The user is not allowed to override the assessment\");\n+        }\n+\n+        final var course = exercise.getCourseViaExerciseGroupOrCourseMember();\n+        if (!authCheckService.isAtLeastTeachingAssistantInCourse(course, user) || !exercise.areManualResultsAllowed()) {", "originalCommit": "5fda6d499b27a1ab19fa83712c7d99afef8f9899", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjYyODQzNA==", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476628434", "bodyText": "Good catch! Fixed in  9a64c0d", "author": "fde312", "createdAt": "2020-08-25T17:44:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjI4NjAxMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjI4NzE2OQ==", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476287169", "bodyText": "Same as above :-)", "author": "sascha11110", "createdAt": "2020-08-25T08:53:16Z", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ProgrammingAssessmentResource.java", "diffHunk": "@@ -71,6 +89,114 @@ public ProgrammingAssessmentResource(AuthorizationCheckService authCheckService,\n         return ResponseEntity.ok(result);\n     }\n \n+    /**\n+     * Cancel an assessment of a given submission for the current user, i.e. delete the corresponding result / release the lock. Then the submission is available for assessment\n+     * again.\n+     *\n+     * @param submissionId the id of the submission for which the current assessment should be canceled\n+     * @return 200 Ok response if canceling was successful, 403 Forbidden if current user is not the assessor of the submission\n+     */\n+    @PutMapping(\"/programming-submissions/{submissionId}/cancel-assessment\")\n+    @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Void> cancelAssessment(@PathVariable Long submissionId) {\n+        return super.cancelAssessment(submissionId);\n+    }\n+\n+    /**\n+     * Save or submit feedback for programming exercise.\n+     *\n+     * @param participationId the id of the participation that should be sent to the client\n+     * @param submit       defines if assessment is submitted or saved\n+     * @param newResult    result with ist of feedbacks to be saved to the database\n+     * @return the result saved to the database\n+     */\n+    @ResponseStatus(HttpStatus.OK)\n+    @PutMapping(\"/participations/{participationId}/manual-results\")\n+    @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Result> saveProgrammingAssessment(@PathVariable Long participationId, @RequestParam(value = \"submit\", defaultValue = \"false\") boolean submit,\n+            @RequestBody Result newResult) {\n+        log.debug(\"REST request to save a new result : {}\", newResult);\n+        final var participation = participationService.findOneWithEagerResultsAndCourse(participationId);\n+\n+        User user = userService.getUserWithGroupsAndAuthorities();\n+\n+        Optional<Result> latestExistingResult = participation.getResults().stream().filter(result -> result.getAssessmentType() == AssessmentType.MANUAL).findFirst();\n+        if (latestExistingResult.isPresent()) {\n+            // prevent that tutors create multiple manual results\n+            // TODO: Double check if this is the right way to do, or if we should create a new Manual Result\n+            newResult.setId(latestExistingResult.get().getId());\n+            // load assessor\n+            latestExistingResult = resultRepository.findWithEagerSubmissionAndFeedbackAndAssessorById(latestExistingResult.get().getId());\n+        }\n+\n+        // make sure that the participation cannot be manipulated on the client side\n+        newResult.setParticipation(participation);\n+\n+        ProgrammingExercise exercise = (ProgrammingExercise) participation.getExercise();\n+        checkAuthorization(exercise, user);\n+\n+        final var isAtLeastInstructor = authCheckService.isAtLeastInstructorForExercise(exercise, user);\n+        if (!assessmentService.isAllowedToCreateOrOverrideResult(latestExistingResult.orElse(null), exercise, participation, user, isAtLeastInstructor)) {\n+            log.debug(\"The user \" + user.getLogin() + \" is not allowed to override the assessment for the participation \" + participation.getId() + \" for User \" + user.getLogin());\n+            return forbidden(\"assessment\", \"assessmentSaveNotAllowed\", \"The user is not allowed to override the assessment\");\n+        }\n+\n+        final var course = exercise.getCourseViaExerciseGroupOrCourseMember();\n+        if (!authCheckService.isAtLeastTeachingAssistantInCourse(course, user) || !exercise.areManualResultsAllowed()) {\n+            return forbidden();\n+        }\n+\n+        if (newResult.getResultString() == null) {\n+            throw new BadRequestAlertException(\"Result string is required.\", ENTITY_NAME, \"resultStringNull\");\n+        }\n+        else if (newResult.getResultString().length() > 255) {\n+            throw new BadRequestAlertException(\"Result string is too long.\", ENTITY_NAME, \"resultStringNull\");\n+        }\n+        else if (newResult.getScore() == null) {\n+            throw new BadRequestAlertException(\"Score is required.\", ENTITY_NAME, \"scoreNull\");\n+        }\n+        else if (newResult.getScore() < 100 && newResult.isSuccessful()) {\n+            throw new BadRequestAlertException(\"Only result with score 100% can be successful.\", ENTITY_NAME, \"scoreAndSuccessfulNotMatching\");\n+        }\n+        else if (!newResult.getFeedbacks().isEmpty() && newResult.getFeedbacks().stream().anyMatch(feedback -> feedback.getText() == null)) {\n+            throw new BadRequestAlertException(\"In case feedback is present, feedback text and detail text are mandatory.\", ENTITY_NAME, \"feedbackTextOrDetailTextNull\");\n+        }\n+\n+        ProgrammingSubmission submission;\n+        if (latestExistingResult.isEmpty()) {\n+            // TODO: Double check if we can create a new result when the existing result has already a completion date (submitted)", "originalCommit": "5fda6d499b27a1ab19fa83712c7d99afef8f9899", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjYyNDc5OA==", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476624798", "bodyText": "Done :)", "author": "fde312", "createdAt": "2020-08-25T17:37:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjI4NzE2OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjI4ODI0MA==", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476288240", "bodyText": "Remove this line :-)", "author": "sascha11110", "createdAt": "2020-08-25T08:54:53Z", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ProgrammingAssessmentResource.java", "diffHunk": "@@ -71,6 +89,114 @@ public ProgrammingAssessmentResource(AuthorizationCheckService authCheckService,\n         return ResponseEntity.ok(result);\n     }\n \n+    /**\n+     * Cancel an assessment of a given submission for the current user, i.e. delete the corresponding result / release the lock. Then the submission is available for assessment\n+     * again.\n+     *\n+     * @param submissionId the id of the submission for which the current assessment should be canceled\n+     * @return 200 Ok response if canceling was successful, 403 Forbidden if current user is not the assessor of the submission\n+     */\n+    @PutMapping(\"/programming-submissions/{submissionId}/cancel-assessment\")\n+    @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Void> cancelAssessment(@PathVariable Long submissionId) {\n+        return super.cancelAssessment(submissionId);\n+    }\n+\n+    /**\n+     * Save or submit feedback for programming exercise.\n+     *\n+     * @param participationId the id of the participation that should be sent to the client\n+     * @param submit       defines if assessment is submitted or saved\n+     * @param newResult    result with ist of feedbacks to be saved to the database\n+     * @return the result saved to the database\n+     */\n+    @ResponseStatus(HttpStatus.OK)\n+    @PutMapping(\"/participations/{participationId}/manual-results\")\n+    @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Result> saveProgrammingAssessment(@PathVariable Long participationId, @RequestParam(value = \"submit\", defaultValue = \"false\") boolean submit,\n+            @RequestBody Result newResult) {\n+        log.debug(\"REST request to save a new result : {}\", newResult);\n+        final var participation = participationService.findOneWithEagerResultsAndCourse(participationId);\n+\n+        User user = userService.getUserWithGroupsAndAuthorities();\n+\n+        Optional<Result> latestExistingResult = participation.getResults().stream().filter(result -> result.getAssessmentType() == AssessmentType.MANUAL).findFirst();\n+        if (latestExistingResult.isPresent()) {\n+            // prevent that tutors create multiple manual results\n+            // TODO: Double check if this is the right way to do, or if we should create a new Manual Result\n+            newResult.setId(latestExistingResult.get().getId());\n+            // load assessor\n+            latestExistingResult = resultRepository.findWithEagerSubmissionAndFeedbackAndAssessorById(latestExistingResult.get().getId());\n+        }\n+\n+        // make sure that the participation cannot be manipulated on the client side\n+        newResult.setParticipation(participation);\n+\n+        ProgrammingExercise exercise = (ProgrammingExercise) participation.getExercise();\n+        checkAuthorization(exercise, user);\n+\n+        final var isAtLeastInstructor = authCheckService.isAtLeastInstructorForExercise(exercise, user);\n+        if (!assessmentService.isAllowedToCreateOrOverrideResult(latestExistingResult.orElse(null), exercise, participation, user, isAtLeastInstructor)) {\n+            log.debug(\"The user \" + user.getLogin() + \" is not allowed to override the assessment for the participation \" + participation.getId() + \" for User \" + user.getLogin());\n+            return forbidden(\"assessment\", \"assessmentSaveNotAllowed\", \"The user is not allowed to override the assessment\");\n+        }\n+\n+        final var course = exercise.getCourseViaExerciseGroupOrCourseMember();\n+        if (!authCheckService.isAtLeastTeachingAssistantInCourse(course, user) || !exercise.areManualResultsAllowed()) {\n+            return forbidden();\n+        }\n+\n+        if (newResult.getResultString() == null) {\n+            throw new BadRequestAlertException(\"Result string is required.\", ENTITY_NAME, \"resultStringNull\");\n+        }\n+        else if (newResult.getResultString().length() > 255) {\n+            throw new BadRequestAlertException(\"Result string is too long.\", ENTITY_NAME, \"resultStringNull\");\n+        }\n+        else if (newResult.getScore() == null) {\n+            throw new BadRequestAlertException(\"Score is required.\", ENTITY_NAME, \"scoreNull\");\n+        }\n+        else if (newResult.getScore() < 100 && newResult.isSuccessful()) {\n+            throw new BadRequestAlertException(\"Only result with score 100% can be successful.\", ENTITY_NAME, \"scoreAndSuccessfulNotMatching\");\n+        }\n+        else if (!newResult.getFeedbacks().isEmpty() && newResult.getFeedbacks().stream().anyMatch(feedback -> feedback.getText() == null)) {\n+            throw new BadRequestAlertException(\"In case feedback is present, feedback text and detail text are mandatory.\", ENTITY_NAME, \"feedbackTextOrDetailTextNull\");\n+        }\n+\n+        ProgrammingSubmission submission;\n+        if (latestExistingResult.isEmpty()) {\n+            // TODO: Double check if we can create a new result when the existing result has already a completion date (submitted)\n+            // Create manual submission with last commit hash und current time stamp.\n+            submission = programmingSubmissionService.createSubmissionWithLastCommitHashForParticipation((ProgrammingExerciseStudentParticipation) participation,\n+                    SubmissionType.MANUAL);\n+            newResult.setSubmission(submission);\n+        }\n+        else {\n+            submission = programmingSubmissionService.findByIdWithEagerResultAndFeedback(latestExistingResult.get().getSubmission().getId());\n+            newResult.setSubmission(submission);\n+            if (newResult.getSubmission() == null) {\n+                throw new BadRequestAlertException(\"The submission is not connected to the result.\", ENTITY_NAME, \"submissionMissing\");\n+            }\n+        }\n+\n+        Result result = programmingAssessmentService.saveManualAssessment(newResult);\n+\n+        if (submit) {\n+", "originalCommit": "5fda6d499b27a1ab19fa83712c7d99afef8f9899", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjI5MDA1Nw==", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476290057", "bodyText": "I know we have many places in the code where we set the participant manually to null but there is a method for that in StudentParticipation.java: filterSensitiveInformation()", "author": "sascha11110", "createdAt": "2020-08-25T08:57:39Z", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ProgrammingAssessmentResource.java", "diffHunk": "@@ -71,6 +89,114 @@ public ProgrammingAssessmentResource(AuthorizationCheckService authCheckService,\n         return ResponseEntity.ok(result);\n     }\n \n+    /**\n+     * Cancel an assessment of a given submission for the current user, i.e. delete the corresponding result / release the lock. Then the submission is available for assessment\n+     * again.\n+     *\n+     * @param submissionId the id of the submission for which the current assessment should be canceled\n+     * @return 200 Ok response if canceling was successful, 403 Forbidden if current user is not the assessor of the submission\n+     */\n+    @PutMapping(\"/programming-submissions/{submissionId}/cancel-assessment\")\n+    @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Void> cancelAssessment(@PathVariable Long submissionId) {\n+        return super.cancelAssessment(submissionId);\n+    }\n+\n+    /**\n+     * Save or submit feedback for programming exercise.\n+     *\n+     * @param participationId the id of the participation that should be sent to the client\n+     * @param submit       defines if assessment is submitted or saved\n+     * @param newResult    result with ist of feedbacks to be saved to the database\n+     * @return the result saved to the database\n+     */\n+    @ResponseStatus(HttpStatus.OK)\n+    @PutMapping(\"/participations/{participationId}/manual-results\")\n+    @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Result> saveProgrammingAssessment(@PathVariable Long participationId, @RequestParam(value = \"submit\", defaultValue = \"false\") boolean submit,\n+            @RequestBody Result newResult) {\n+        log.debug(\"REST request to save a new result : {}\", newResult);\n+        final var participation = participationService.findOneWithEagerResultsAndCourse(participationId);\n+\n+        User user = userService.getUserWithGroupsAndAuthorities();\n+\n+        Optional<Result> latestExistingResult = participation.getResults().stream().filter(result -> result.getAssessmentType() == AssessmentType.MANUAL).findFirst();\n+        if (latestExistingResult.isPresent()) {\n+            // prevent that tutors create multiple manual results\n+            // TODO: Double check if this is the right way to do, or if we should create a new Manual Result\n+            newResult.setId(latestExistingResult.get().getId());\n+            // load assessor\n+            latestExistingResult = resultRepository.findWithEagerSubmissionAndFeedbackAndAssessorById(latestExistingResult.get().getId());\n+        }\n+\n+        // make sure that the participation cannot be manipulated on the client side\n+        newResult.setParticipation(participation);\n+\n+        ProgrammingExercise exercise = (ProgrammingExercise) participation.getExercise();\n+        checkAuthorization(exercise, user);\n+\n+        final var isAtLeastInstructor = authCheckService.isAtLeastInstructorForExercise(exercise, user);\n+        if (!assessmentService.isAllowedToCreateOrOverrideResult(latestExistingResult.orElse(null), exercise, participation, user, isAtLeastInstructor)) {\n+            log.debug(\"The user \" + user.getLogin() + \" is not allowed to override the assessment for the participation \" + participation.getId() + \" for User \" + user.getLogin());\n+            return forbidden(\"assessment\", \"assessmentSaveNotAllowed\", \"The user is not allowed to override the assessment\");\n+        }\n+\n+        final var course = exercise.getCourseViaExerciseGroupOrCourseMember();\n+        if (!authCheckService.isAtLeastTeachingAssistantInCourse(course, user) || !exercise.areManualResultsAllowed()) {\n+            return forbidden();\n+        }\n+\n+        if (newResult.getResultString() == null) {\n+            throw new BadRequestAlertException(\"Result string is required.\", ENTITY_NAME, \"resultStringNull\");\n+        }\n+        else if (newResult.getResultString().length() > 255) {\n+            throw new BadRequestAlertException(\"Result string is too long.\", ENTITY_NAME, \"resultStringNull\");\n+        }\n+        else if (newResult.getScore() == null) {\n+            throw new BadRequestAlertException(\"Score is required.\", ENTITY_NAME, \"scoreNull\");\n+        }\n+        else if (newResult.getScore() < 100 && newResult.isSuccessful()) {\n+            throw new BadRequestAlertException(\"Only result with score 100% can be successful.\", ENTITY_NAME, \"scoreAndSuccessfulNotMatching\");\n+        }\n+        else if (!newResult.getFeedbacks().isEmpty() && newResult.getFeedbacks().stream().anyMatch(feedback -> feedback.getText() == null)) {\n+            throw new BadRequestAlertException(\"In case feedback is present, feedback text and detail text are mandatory.\", ENTITY_NAME, \"feedbackTextOrDetailTextNull\");\n+        }\n+\n+        ProgrammingSubmission submission;\n+        if (latestExistingResult.isEmpty()) {\n+            // TODO: Double check if we can create a new result when the existing result has already a completion date (submitted)\n+            // Create manual submission with last commit hash und current time stamp.\n+            submission = programmingSubmissionService.createSubmissionWithLastCommitHashForParticipation((ProgrammingExerciseStudentParticipation) participation,\n+                    SubmissionType.MANUAL);\n+            newResult.setSubmission(submission);\n+        }\n+        else {\n+            submission = programmingSubmissionService.findByIdWithEagerResultAndFeedback(latestExistingResult.get().getSubmission().getId());\n+            newResult.setSubmission(submission);\n+            if (newResult.getSubmission() == null) {\n+                throw new BadRequestAlertException(\"The submission is not connected to the result.\", ENTITY_NAME, \"submissionMissing\");\n+            }\n+        }\n+\n+        Result result = programmingAssessmentService.saveManualAssessment(newResult);\n+\n+        if (submit) {\n+\n+            result = programmingAssessmentService.submitManualAssessment(result.getId());\n+        }\n+        // remove information about the student for tutors to ensure double-blind assessment\n+        if (!isAtLeastInstructor) {\n+            ((StudentParticipation) result.getParticipation()).setParticipant(null);", "originalCommit": "5fda6d499b27a1ab19fa83712c7d99afef8f9899", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjYyODUxNA==", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476628514", "bodyText": "Thank you! I did not know that! Fixed in 9a64c0d", "author": "fde312", "createdAt": "2020-08-25T17:44:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjI5MDA1Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjI5MTEwOA==", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476291108", "bodyText": "Same as above :-)\nI don't think so as we in some places remove the assessor explicitly via filterSensitiveInformation() in Result.java", "author": "sascha11110", "createdAt": "2020-08-25T08:59:11Z", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ProgrammingAssessmentResource.java", "diffHunk": "@@ -71,6 +89,114 @@ public ProgrammingAssessmentResource(AuthorizationCheckService authCheckService,\n         return ResponseEntity.ok(result);\n     }\n \n+    /**\n+     * Cancel an assessment of a given submission for the current user, i.e. delete the corresponding result / release the lock. Then the submission is available for assessment\n+     * again.\n+     *\n+     * @param submissionId the id of the submission for which the current assessment should be canceled\n+     * @return 200 Ok response if canceling was successful, 403 Forbidden if current user is not the assessor of the submission\n+     */\n+    @PutMapping(\"/programming-submissions/{submissionId}/cancel-assessment\")\n+    @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Void> cancelAssessment(@PathVariable Long submissionId) {\n+        return super.cancelAssessment(submissionId);\n+    }\n+\n+    /**\n+     * Save or submit feedback for programming exercise.\n+     *\n+     * @param participationId the id of the participation that should be sent to the client\n+     * @param submit       defines if assessment is submitted or saved\n+     * @param newResult    result with ist of feedbacks to be saved to the database\n+     * @return the result saved to the database\n+     */\n+    @ResponseStatus(HttpStatus.OK)\n+    @PutMapping(\"/participations/{participationId}/manual-results\")\n+    @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Result> saveProgrammingAssessment(@PathVariable Long participationId, @RequestParam(value = \"submit\", defaultValue = \"false\") boolean submit,\n+            @RequestBody Result newResult) {\n+        log.debug(\"REST request to save a new result : {}\", newResult);\n+        final var participation = participationService.findOneWithEagerResultsAndCourse(participationId);\n+\n+        User user = userService.getUserWithGroupsAndAuthorities();\n+\n+        Optional<Result> latestExistingResult = participation.getResults().stream().filter(result -> result.getAssessmentType() == AssessmentType.MANUAL).findFirst();\n+        if (latestExistingResult.isPresent()) {\n+            // prevent that tutors create multiple manual results\n+            // TODO: Double check if this is the right way to do, or if we should create a new Manual Result\n+            newResult.setId(latestExistingResult.get().getId());\n+            // load assessor\n+            latestExistingResult = resultRepository.findWithEagerSubmissionAndFeedbackAndAssessorById(latestExistingResult.get().getId());\n+        }\n+\n+        // make sure that the participation cannot be manipulated on the client side\n+        newResult.setParticipation(participation);\n+\n+        ProgrammingExercise exercise = (ProgrammingExercise) participation.getExercise();\n+        checkAuthorization(exercise, user);\n+\n+        final var isAtLeastInstructor = authCheckService.isAtLeastInstructorForExercise(exercise, user);\n+        if (!assessmentService.isAllowedToCreateOrOverrideResult(latestExistingResult.orElse(null), exercise, participation, user, isAtLeastInstructor)) {\n+            log.debug(\"The user \" + user.getLogin() + \" is not allowed to override the assessment for the participation \" + participation.getId() + \" for User \" + user.getLogin());\n+            return forbidden(\"assessment\", \"assessmentSaveNotAllowed\", \"The user is not allowed to override the assessment\");\n+        }\n+\n+        final var course = exercise.getCourseViaExerciseGroupOrCourseMember();\n+        if (!authCheckService.isAtLeastTeachingAssistantInCourse(course, user) || !exercise.areManualResultsAllowed()) {\n+            return forbidden();\n+        }\n+\n+        if (newResult.getResultString() == null) {\n+            throw new BadRequestAlertException(\"Result string is required.\", ENTITY_NAME, \"resultStringNull\");\n+        }\n+        else if (newResult.getResultString().length() > 255) {\n+            throw new BadRequestAlertException(\"Result string is too long.\", ENTITY_NAME, \"resultStringNull\");\n+        }\n+        else if (newResult.getScore() == null) {\n+            throw new BadRequestAlertException(\"Score is required.\", ENTITY_NAME, \"scoreNull\");\n+        }\n+        else if (newResult.getScore() < 100 && newResult.isSuccessful()) {\n+            throw new BadRequestAlertException(\"Only result with score 100% can be successful.\", ENTITY_NAME, \"scoreAndSuccessfulNotMatching\");\n+        }\n+        else if (!newResult.getFeedbacks().isEmpty() && newResult.getFeedbacks().stream().anyMatch(feedback -> feedback.getText() == null)) {\n+            throw new BadRequestAlertException(\"In case feedback is present, feedback text and detail text are mandatory.\", ENTITY_NAME, \"feedbackTextOrDetailTextNull\");\n+        }\n+\n+        ProgrammingSubmission submission;\n+        if (latestExistingResult.isEmpty()) {\n+            // TODO: Double check if we can create a new result when the existing result has already a completion date (submitted)\n+            // Create manual submission with last commit hash und current time stamp.\n+            submission = programmingSubmissionService.createSubmissionWithLastCommitHashForParticipation((ProgrammingExerciseStudentParticipation) participation,\n+                    SubmissionType.MANUAL);\n+            newResult.setSubmission(submission);\n+        }\n+        else {\n+            submission = programmingSubmissionService.findByIdWithEagerResultAndFeedback(latestExistingResult.get().getSubmission().getId());\n+            newResult.setSubmission(submission);\n+            if (newResult.getSubmission() == null) {\n+                throw new BadRequestAlertException(\"The submission is not connected to the result.\", ENTITY_NAME, \"submissionMissing\");\n+            }\n+        }\n+\n+        Result result = programmingAssessmentService.saveManualAssessment(newResult);\n+\n+        if (submit) {\n+\n+            result = programmingAssessmentService.submitManualAssessment(result.getId());\n+        }\n+        // remove information about the student for tutors to ensure double-blind assessment\n+        if (!isAtLeastInstructor) {\n+            ((StudentParticipation) result.getParticipation()).setParticipant(null);\n+        }\n+        if (submit && ((result.getParticipation()).getExercise().getAssessmentDueDate() == null\n+                || result.getParticipation().getExercise().getAssessmentDueDate().isBefore(ZonedDateTime.now()))) {\n+            ltiService.onNewResult((ProgrammingExerciseStudentParticipation) result.getParticipation());\n+            // TODO: Is it intended that the result with information about the assessor is broadcasted (this is also for other exercises type the case)", "originalCommit": "5fda6d499b27a1ab19fa83712c7d99afef8f9899", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjYyODY1OQ==", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476628659", "bodyText": "Done :)", "author": "fde312", "createdAt": "2020-08-25T17:44:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjI5MTEwOA=="}], "type": "inlineReview"}, {"oid": "850a2b1c76bb4ab078744c03b43614b034b27c52", "url": "https://github.com/ls1intum/Artemis/commit/850a2b1c76bb4ab078744c03b43614b034b27c52", "message": "add additional client tests", "committedDate": "2020-08-25T11:53:25Z", "type": "commit"}, {"oid": "1ae95ac8a84f4b3ec47b88a371c743c3fc331d0d", "url": "https://github.com/ls1intum/Artemis/commit/1ae95ac8a84f4b3ec47b88a371c743c3fc331d0d", "message": "renaming of test", "committedDate": "2020-08-25T11:59:18Z", "type": "commit"}, {"oid": "fcbf7d48a59cfccee44fdc65fec1aad8d14e4470", "url": "https://github.com/ls1intum/Artemis/commit/fcbf7d48a59cfccee44fdc65fec1aad8d14e4470", "message": "move some navbar elements below tutor-code-editor and add translation", "committedDate": "2020-08-25T13:07:35Z", "type": "commit"}, {"oid": "ba7be88a95904330674441414756698f373a6937", "url": "https://github.com/ls1intum/Artemis/commit/ba7be88a95904330674441414756698f373a6937", "message": "address feedback in PR", "committedDate": "2020-08-25T13:31:38Z", "type": "commit"}, {"oid": "d2b3373fcd891258a372add5b829447ca0c170af", "url": "https://github.com/ls1intum/Artemis/commit/d2b3373fcd891258a372add5b829447ca0c170af", "message": "Merge branch 'develop' of https://github.com/ls1intum/Artemis into feature/online-editor/open-student-submission-in-online-editor", "committedDate": "2020-08-25T13:32:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjUyOTg4Mw==", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476529883", "bodyText": "I am not that familiar with hibernate, but why are you using @transactional here?", "author": "TobiasPr", "createdAt": "2020-08-25T15:16:39Z", "path": "src/main/java/de/tum/in/www1/artemis/service/ProgrammingAssessmentService.java", "diffHunk": "@@ -33,4 +40,53 @@ public Result updateAssessmentAfterComplaint(Result originalResult, Exercise exe\n         originalResult.setScore(assessmentUpdate.getScore());\n         return super.updateAssessmentAfterComplaint(originalResult, exercise, assessmentUpdate);\n     }\n+\n+    /**\n+     * This function is used for saving a manual assessment/result. It sets the assessment type to MANUAL and sets the assessor attribute. Furthermore, it saves the result in the\n+     * database.\n+     *\n+     * @param result the new result of a programming exercise\n+     * @return result that was saved in the database\n+     */\n+    @Transactional\n+    public Result saveManualAssessment(Result result) {\n+        Boolean isFeedbackEmpty = result.getFeedbacks().isEmpty();\n+        result.setHasFeedback(!isFeedbackEmpty);\n+\n+        User user = userService.getUserWithGroupsAndAuthorities();\n+        result.setHasComplaint(false);\n+        result.setAssessmentType(AssessmentType.MANUAL);\n+        result.setAssessor(user);\n+\n+        result.setCompletionDate(null);\n+        result.setRated(false);\n+\n+        result.getFeedbacks().forEach(feedback -> {\n+            feedback.setResult(result);\n+        });\n+\n+        // Note: This also saves the feedback objects in the database because of the 'cascade = CascadeType.ALL' option.\n+        return resultRepository.save(result);\n+    }\n+\n+    /**\n+     * This function is used for submitting a manual assessment/result. It gets the result that belongs to the given resultId, updates the completion date, sets the assessment type\n+     * to MANUAL and sets the assessor attribute. Afterwards, it saves the update result in the database again.\n+     *\n+     * @param resultId the id of the result that should be submitted\n+     * @return the ResponseEntity with result as body\n+     */\n+    @Transactional", "originalCommit": "d2b3373fcd891258a372add5b829447ca0c170af", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjYyMTQ0NQ==", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476621445", "bodyText": "To be honst, I am neither. I orientated myself to how it is done for the other exercise types. There, we used @Transactional see https://github.com/ls1intum/Artemis/blob/develop/src/main/java/de/tum/in/www1/artemis/service/ModelingAssessmentService.java#L79\nthat's why I used it as well to keep it consistent to the other exercises.", "author": "fde312", "createdAt": "2020-08-25T17:32:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjUyOTg4Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjUzNzI1MQ==", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476537251", "bodyText": "Wouldn't it be easier to check the submission directly for null, before setting the submission of the newResult and getting it again? Just for readability", "author": "TobiasPr", "createdAt": "2020-08-25T15:26:42Z", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ProgrammingAssessmentResource.java", "diffHunk": "@@ -71,6 +89,112 @@ public ProgrammingAssessmentResource(AuthorizationCheckService authCheckService,\n         return ResponseEntity.ok(result);\n     }\n \n+    /**\n+     * Cancel an assessment of a given submission for the current user, i.e. delete the corresponding result / release the lock. Then the submission is available for assessment\n+     * again.\n+     *\n+     * @param submissionId the id of the submission for which the current assessment should be canceled\n+     * @return 200 Ok response if canceling was successful, 403 Forbidden if current user is not the assessor of the submission\n+     */\n+    @PutMapping(\"/programming-submissions/{submissionId}/cancel-assessment\")\n+    @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Void> cancelAssessment(@PathVariable Long submissionId) {\n+        return super.cancelAssessment(submissionId);\n+    }\n+\n+    /**\n+     * Save or submit feedback for programming exercise.\n+     *\n+     * @param participationId the id of the participation that should be sent to the client\n+     * @param submit       defines if assessment is submitted or saved\n+     * @param newResult    result with ist of feedbacks to be saved to the database\n+     * @return the result saved to the database\n+     */\n+    @ResponseStatus(HttpStatus.OK)\n+    @PutMapping(\"/participations/{participationId}/manual-results\")\n+    @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Result> saveProgrammingAssessment(@PathVariable Long participationId, @RequestParam(value = \"submit\", defaultValue = \"false\") boolean submit,\n+            @RequestBody Result newResult) {\n+        log.debug(\"REST request to save a new result : {}\", newResult);\n+        final var participation = participationService.findOneWithEagerResultsAndCourse(participationId);\n+\n+        User user = userService.getUserWithGroupsAndAuthorities();\n+\n+        Optional<Result> latestExistingResult = participation.getResults().stream().filter(result -> result.getAssessmentType() == AssessmentType.MANUAL).findFirst();\n+        if (latestExistingResult.isPresent()) {\n+            // prevent that tutors create multiple manual results\n+            newResult.setId(latestExistingResult.get().getId());\n+            // load assessor\n+            latestExistingResult = resultRepository.findWithEagerSubmissionAndFeedbackAndAssessorById(latestExistingResult.get().getId());\n+        }\n+\n+        // make sure that the participation cannot be manipulated on the client side\n+        newResult.setParticipation(participation);\n+\n+        ProgrammingExercise exercise = (ProgrammingExercise) participation.getExercise();\n+        checkAuthorization(exercise, user);\n+\n+        final var isAtLeastInstructor = authCheckService.isAtLeastInstructorForExercise(exercise, user);\n+        if (!assessmentService.isAllowedToCreateOrOverrideResult(latestExistingResult.orElse(null), exercise, participation, user, isAtLeastInstructor)) {\n+            log.debug(\"The user \" + user.getLogin() + \" is not allowed to override the assessment for the participation \" + participation.getId() + \" for User \" + user.getLogin());\n+            return forbidden(\"assessment\", \"assessmentSaveNotAllowed\", \"The user is not allowed to override the assessment\");\n+        }\n+\n+        final var course = exercise.getCourseViaExerciseGroupOrCourseMember();\n+        if (!authCheckService.isAtLeastTeachingAssistantInCourse(course, user) || !exercise.areManualResultsAllowed()) {\n+            return forbidden();\n+        }\n+\n+        if (newResult.getResultString() == null) {\n+            throw new BadRequestAlertException(\"Result string is required.\", ENTITY_NAME, \"resultStringNull\");\n+        }\n+        else if (newResult.getResultString().length() > 255) {\n+            throw new BadRequestAlertException(\"Result string is too long.\", ENTITY_NAME, \"resultStringNull\");\n+        }\n+        else if (newResult.getScore() == null) {\n+            throw new BadRequestAlertException(\"Score is required.\", ENTITY_NAME, \"scoreNull\");\n+        }\n+        else if (newResult.getScore() < 100 && newResult.isSuccessful()) {\n+            throw new BadRequestAlertException(\"Only result with score 100% can be successful.\", ENTITY_NAME, \"scoreAndSuccessfulNotMatching\");\n+        }\n+        else if (!newResult.getFeedbacks().isEmpty() && newResult.getFeedbacks().stream().anyMatch(feedback -> feedback.getText() == null)) {\n+            throw new BadRequestAlertException(\"In case feedback is present, feedback text and detail text are mandatory.\", ENTITY_NAME, \"feedbackTextOrDetailTextNull\");\n+        }\n+\n+        ProgrammingSubmission submission;\n+        if (latestExistingResult.isEmpty()) {\n+            // TODO: Double check if we can create a new result when the existing result has already a completion date (submitted)\n+            // Create manual submission with last commit hash und current time stamp.\n+            submission = programmingSubmissionService.createSubmissionWithLastCommitHashForParticipation((ProgrammingExerciseStudentParticipation) participation,\n+                    SubmissionType.MANUAL);\n+            newResult.setSubmission(submission);\n+        }\n+        else {\n+            submission = programmingSubmissionService.findByIdWithEagerResultAndFeedback(latestExistingResult.get().getSubmission().getId());\n+            newResult.setSubmission(submission);\n+            if (newResult.getSubmission() == null) {", "originalCommit": "d2b3373fcd891258a372add5b829447ca0c170af", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjYyODQwOA==", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476628408", "bodyText": "Good catch! Fixed in  2f9193f", "author": "fde312", "createdAt": "2020-08-25T17:44:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjUzNzI1MQ=="}], "type": "inlineReview"}, {"oid": "2f9193f0ee0a39c0976d93d190f4ad9e5447f019", "url": "https://github.com/ls1intum/Artemis/commit/2f9193f0ee0a39c0976d93d190f4ad9e5447f019", "message": "adress change from PR feedback", "committedDate": "2020-08-25T17:25:49Z", "type": "commit"}, {"oid": "9a64c0dd97f480444778c475e5616565e29335da", "url": "https://github.com/ls1intum/Artemis/commit/9a64c0dd97f480444778c475e5616565e29335da", "message": "address missed PR feedback from Sascha", "committedDate": "2020-08-25T17:46:21Z", "type": "commit"}, {"oid": "ca5aec6561b09d6f5fbb2477f8619ced68ec7026", "url": "https://github.com/ls1intum/Artemis/commit/ca5aec6561b09d6f5fbb2477f8619ced68ec7026", "message": "Merge branch 'develop' of https://github.com/ls1intum/Artemis into feature/online-editor/open-student-submission-in-online-editor", "committedDate": "2020-08-25T17:47:21Z", "type": "commit"}, {"oid": "8d2ee2f3ee689b85f34bf985f989e30af890eed1", "url": "https://github.com/ls1intum/Artemis/commit/8d2ee2f3ee689b85f34bf985f989e30af890eed1", "message": "run prettier", "committedDate": "2020-08-25T19:11:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjcwNzI2MQ==", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476707261", "bodyText": "You can do this in one line like result.setHasFeedback(!result.getFeedbacks().isEmpty());", "author": "kloessst", "createdAt": "2020-08-25T20:07:48Z", "path": "src/main/java/de/tum/in/www1/artemis/service/ProgrammingAssessmentService.java", "diffHunk": "@@ -33,4 +40,53 @@ public Result updateAssessmentAfterComplaint(Result originalResult, Exercise exe\n         originalResult.setScore(assessmentUpdate.getScore());\n         return super.updateAssessmentAfterComplaint(originalResult, exercise, assessmentUpdate);\n     }\n+\n+    /**\n+     * This function is used for saving a manual assessment/result. It sets the assessment type to MANUAL and sets the assessor attribute. Furthermore, it saves the result in the\n+     * database.\n+     *\n+     * @param result the new result of a programming exercise\n+     * @return result that was saved in the database\n+     */\n+    @Transactional\n+    public Result saveManualAssessment(Result result) {\n+        Boolean isFeedbackEmpty = result.getFeedbacks().isEmpty();\n+        result.setHasFeedback(!isFeedbackEmpty);", "originalCommit": "8d2ee2f3ee689b85f34bf985f989e30af890eed1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Njc0MDY5NA==", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476740694", "bodyText": "Done in 46457a4", "author": "fde312", "createdAt": "2020-08-25T21:13:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjcwNzI2MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjcxNzY5Mw==", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476717693", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        // Create manual submission with last commit hash und current time stamp.\n          \n          \n            \n                        // Create manual submission with last commit hash and current time stamp.", "author": "kloessst", "createdAt": "2020-08-25T20:28:33Z", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ProgrammingAssessmentResource.java", "diffHunk": "@@ -71,6 +89,111 @@ public ProgrammingAssessmentResource(AuthorizationCheckService authCheckService,\n         return ResponseEntity.ok(result);\n     }\n \n+    /**\n+     * Cancel an assessment of a given submission for the current user, i.e. delete the corresponding result / release the lock. Then the submission is available for assessment\n+     * again.\n+     *\n+     * @param submissionId the id of the submission for which the current assessment should be canceled\n+     * @return 200 Ok response if canceling was successful, 403 Forbidden if current user is not the assessor of the submission\n+     */\n+    @PutMapping(\"/programming-submissions/{submissionId}/cancel-assessment\")\n+    @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Void> cancelAssessment(@PathVariable Long submissionId) {\n+        return super.cancelAssessment(submissionId);\n+    }\n+\n+    /**\n+     * Save or submit feedback for programming exercise.\n+     *\n+     * @param participationId the id of the participation that should be sent to the client\n+     * @param submit       defines if assessment is submitted or saved\n+     * @param newResult    result with ist of feedbacks to be saved to the database\n+     * @return the result saved to the database\n+     */\n+    @ResponseStatus(HttpStatus.OK)\n+    @PutMapping(\"/participations/{participationId}/manual-results\")\n+    @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Result> saveProgrammingAssessment(@PathVariable Long participationId, @RequestParam(value = \"submit\", defaultValue = \"false\") boolean submit,\n+            @RequestBody Result newResult) {\n+        log.debug(\"REST request to save a new result : {}\", newResult);\n+        final var participation = participationService.findOneWithEagerResultsAndCourse(participationId);\n+\n+        User user = userService.getUserWithGroupsAndAuthorities();\n+\n+        Optional<Result> latestExistingResult = participation.getResults().stream().filter(result -> result.getAssessmentType() == AssessmentType.MANUAL).findFirst();\n+        if (latestExistingResult.isPresent()) {\n+            // prevent that tutors create multiple manual results\n+            newResult.setId(latestExistingResult.get().getId());\n+            // load assessor\n+            latestExistingResult = resultRepository.findWithEagerSubmissionAndFeedbackAndAssessorById(latestExistingResult.get().getId());\n+        }\n+\n+        // make sure that the participation cannot be manipulated on the client side\n+        newResult.setParticipation(participation);\n+\n+        ProgrammingExercise exercise = (ProgrammingExercise) participation.getExercise();\n+        checkAuthorization(exercise, user);\n+\n+        final var isAtLeastInstructor = authCheckService.isAtLeastInstructorForExercise(exercise, user);\n+        if (!assessmentService.isAllowedToCreateOrOverrideResult(latestExistingResult.orElse(null), exercise, participation, user, isAtLeastInstructor)) {\n+            log.debug(\"The user \" + user.getLogin() + \" is not allowed to override the assessment for the participation \" + participation.getId() + \" for User \" + user.getLogin());\n+            return forbidden(\"assessment\", \"assessmentSaveNotAllowed\", \"The user is not allowed to override the assessment\");\n+        }\n+\n+        if (!exercise.areManualResultsAllowed()) {\n+            return forbidden();\n+        }\n+\n+        if (newResult.getResultString() == null) {\n+            throw new BadRequestAlertException(\"Result string is required.\", ENTITY_NAME, \"resultStringNull\");\n+        }\n+        else if (newResult.getResultString().length() > 255) {\n+            throw new BadRequestAlertException(\"Result string is too long.\", ENTITY_NAME, \"resultStringNull\");\n+        }\n+        else if (newResult.getScore() == null) {\n+            throw new BadRequestAlertException(\"Score is required.\", ENTITY_NAME, \"scoreNull\");\n+        }\n+        else if (newResult.getScore() < 100 && newResult.isSuccessful()) {\n+            throw new BadRequestAlertException(\"Only result with score 100% can be successful.\", ENTITY_NAME, \"scoreAndSuccessfulNotMatching\");\n+        }\n+        else if (!newResult.getFeedbacks().isEmpty() && newResult.getFeedbacks().stream().anyMatch(feedback -> feedback.getText() == null)) {\n+            throw new BadRequestAlertException(\"In case feedback is present, feedback text and detail text are mandatory.\", ENTITY_NAME, \"feedbackTextOrDetailTextNull\");\n+        }\n+\n+        ProgrammingSubmission submission;\n+        if (latestExistingResult.isEmpty()) {\n+            // Create manual submission with last commit hash und current time stamp.", "originalCommit": "8d2ee2f3ee689b85f34bf985f989e30af890eed1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Njc0MTA5Mw==", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476741093", "bodyText": "Done in 46457a4", "author": "fde312", "createdAt": "2020-08-25T21:14:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjcxNzY5Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjcxOTExMw==", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476719113", "bodyText": "I think the service will throw an EntityNotFoundException if no submission was found so you don't need the check", "author": "kloessst", "createdAt": "2020-08-25T20:31:12Z", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ProgrammingAssessmentResource.java", "diffHunk": "@@ -71,6 +89,111 @@ public ProgrammingAssessmentResource(AuthorizationCheckService authCheckService,\n         return ResponseEntity.ok(result);\n     }\n \n+    /**\n+     * Cancel an assessment of a given submission for the current user, i.e. delete the corresponding result / release the lock. Then the submission is available for assessment\n+     * again.\n+     *\n+     * @param submissionId the id of the submission for which the current assessment should be canceled\n+     * @return 200 Ok response if canceling was successful, 403 Forbidden if current user is not the assessor of the submission\n+     */\n+    @PutMapping(\"/programming-submissions/{submissionId}/cancel-assessment\")\n+    @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Void> cancelAssessment(@PathVariable Long submissionId) {\n+        return super.cancelAssessment(submissionId);\n+    }\n+\n+    /**\n+     * Save or submit feedback for programming exercise.\n+     *\n+     * @param participationId the id of the participation that should be sent to the client\n+     * @param submit       defines if assessment is submitted or saved\n+     * @param newResult    result with ist of feedbacks to be saved to the database\n+     * @return the result saved to the database\n+     */\n+    @ResponseStatus(HttpStatus.OK)\n+    @PutMapping(\"/participations/{participationId}/manual-results\")\n+    @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")\n+    public ResponseEntity<Result> saveProgrammingAssessment(@PathVariable Long participationId, @RequestParam(value = \"submit\", defaultValue = \"false\") boolean submit,\n+            @RequestBody Result newResult) {\n+        log.debug(\"REST request to save a new result : {}\", newResult);\n+        final var participation = participationService.findOneWithEagerResultsAndCourse(participationId);\n+\n+        User user = userService.getUserWithGroupsAndAuthorities();\n+\n+        Optional<Result> latestExistingResult = participation.getResults().stream().filter(result -> result.getAssessmentType() == AssessmentType.MANUAL).findFirst();\n+        if (latestExistingResult.isPresent()) {\n+            // prevent that tutors create multiple manual results\n+            newResult.setId(latestExistingResult.get().getId());\n+            // load assessor\n+            latestExistingResult = resultRepository.findWithEagerSubmissionAndFeedbackAndAssessorById(latestExistingResult.get().getId());\n+        }\n+\n+        // make sure that the participation cannot be manipulated on the client side\n+        newResult.setParticipation(participation);\n+\n+        ProgrammingExercise exercise = (ProgrammingExercise) participation.getExercise();\n+        checkAuthorization(exercise, user);\n+\n+        final var isAtLeastInstructor = authCheckService.isAtLeastInstructorForExercise(exercise, user);\n+        if (!assessmentService.isAllowedToCreateOrOverrideResult(latestExistingResult.orElse(null), exercise, participation, user, isAtLeastInstructor)) {\n+            log.debug(\"The user \" + user.getLogin() + \" is not allowed to override the assessment for the participation \" + participation.getId() + \" for User \" + user.getLogin());\n+            return forbidden(\"assessment\", \"assessmentSaveNotAllowed\", \"The user is not allowed to override the assessment\");\n+        }\n+\n+        if (!exercise.areManualResultsAllowed()) {\n+            return forbidden();\n+        }\n+\n+        if (newResult.getResultString() == null) {\n+            throw new BadRequestAlertException(\"Result string is required.\", ENTITY_NAME, \"resultStringNull\");\n+        }\n+        else if (newResult.getResultString().length() > 255) {\n+            throw new BadRequestAlertException(\"Result string is too long.\", ENTITY_NAME, \"resultStringNull\");\n+        }\n+        else if (newResult.getScore() == null) {\n+            throw new BadRequestAlertException(\"Score is required.\", ENTITY_NAME, \"scoreNull\");\n+        }\n+        else if (newResult.getScore() < 100 && newResult.isSuccessful()) {\n+            throw new BadRequestAlertException(\"Only result with score 100% can be successful.\", ENTITY_NAME, \"scoreAndSuccessfulNotMatching\");\n+        }\n+        else if (!newResult.getFeedbacks().isEmpty() && newResult.getFeedbacks().stream().anyMatch(feedback -> feedback.getText() == null)) {\n+            throw new BadRequestAlertException(\"In case feedback is present, feedback text and detail text are mandatory.\", ENTITY_NAME, \"feedbackTextOrDetailTextNull\");\n+        }\n+\n+        ProgrammingSubmission submission;\n+        if (latestExistingResult.isEmpty()) {\n+            // Create manual submission with last commit hash und current time stamp.\n+            submission = programmingSubmissionService.createSubmissionWithLastCommitHashForParticipation((ProgrammingExerciseStudentParticipation) participation,\n+                    SubmissionType.MANUAL);\n+            newResult.setSubmission(submission);\n+        }\n+        else {\n+            submission = programmingSubmissionService.findByIdWithEagerResultAndFeedback(latestExistingResult.get().getSubmission().getId());\n+            if (submission == null) {", "originalCommit": "8d2ee2f3ee689b85f34bf985f989e30af890eed1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Njc0NTQxMQ==", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476745411", "bodyText": "you are right, very good catch! Done in 46457a4", "author": "fde312", "createdAt": "2020-08-25T21:20:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjcxOTExMw=="}], "type": "inlineReview"}, {"oid": "46457a417e11edaf720592bcc95b02cca818a6a0", "url": "https://github.com/ls1intum/Artemis/commit/46457a417e11edaf720592bcc95b02cca818a6a0", "message": "address feedback of PR", "committedDate": "2020-08-25T21:36:34Z", "type": "commit"}, {"oid": "e0dd64ef5c32ed0643bfb91a40dff9028595ea9f", "url": "https://github.com/ls1intum/Artemis/commit/e0dd64ef5c32ed0643bfb91a40dff9028595ea9f", "message": "Merge branch 'develop' of https://github.com/ls1intum/Artemis into feature/online-editor/open-student-submission-in-online-editor", "committedDate": "2020-08-25T21:36:43Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Njc4NzYxNw==", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476787617", "bodyText": "why should a user be allowed to call this resource?", "author": "krusche", "createdAt": "2020-08-25T22:11:16Z", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ProgrammingExerciseParticipationResource.java", "diffHunk": "@@ -76,6 +76,30 @@ public ProgrammingExerciseParticipationResource(ProgrammingExerciseParticipation\n         return ResponseEntity.ok(participation.get());\n     }\n \n+    /**\n+     * Get the given student participation with its results and feedbacks.\n+     *\n+     * @param participationId for which to retrieve the student participation with results and feedbacks.\n+     * @return the ResponseEntity with status 200 (OK) and the participation with its results in the body.\n+     */\n+    @GetMapping(\"/programming-exercise-participations/{participationId}/student-participation-with-results-and-feedbacks\")\n+    @PreAuthorize(\"hasAnyRole('USER', 'TA', 'INSTRUCTOR', 'ADMIN')\")", "originalCommit": "e0dd64ef5c32ed0643bfb91a40dff9028595ea9f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjgwNzExMA==", "url": "https://github.com/ls1intum/Artemis/pull/2038#discussion_r476807110", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                @PreAuthorize(\"hasAnyRole('USER', 'TA', 'INSTRUCTOR', 'ADMIN')\")\n          \n          \n            \n                @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")", "author": "fde312", "createdAt": "2020-08-25T22:37:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Njc4NzYxNw=="}], "type": "inlineReview"}, {"oid": "a1f10a0bd2c0ff19dc6ec38e7a75cc16364f2548", "url": "https://github.com/ls1intum/Artemis/commit/a1f10a0bd2c0ff19dc6ec38e7a75cc16364f2548", "message": "remove User from PreAuthorize", "committedDate": "2020-08-25T22:39:00Z", "type": "commit"}]}