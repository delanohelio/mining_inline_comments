{"pr_number": 1844, "pr_title": "Show result in exam summary page after result publication date", "pr_createdAt": "2020-07-09T11:05:43Z", "pr_url": "https://github.com/ls1intum/Artemis/pull/1844", "timeline": [{"oid": "39225b0ded24af6c437f20b4c69dfaf9f00799d2", "url": "https://github.com/ls1intum/Artemis/commit/39225b0ded24af6c437f20b4c69dfaf9f00799d2", "message": "first draft", "committedDate": "2020-07-06T14:25:09Z", "type": "commit"}, {"oid": "c408280120c47d4752b106a1392e5c27afd6ea38", "url": "https://github.com/ls1intum/Artemis/commit/c408280120c47d4752b106a1392e5c27afd6ea38", "message": "import router module", "committedDate": "2020-07-06T18:47:30Z", "type": "commit"}, {"oid": "f3c6d08af2027f54c3e3661cb1ed3291a81a9d10", "url": "https://github.com/ls1intum/Artemis/commit/f3c6d08af2027f54c3e3661cb1ed3291a81a9d10", "message": "Merge branch 'develop' into exam/management/results-summary-page", "committedDate": "2020-07-09T11:06:50Z", "type": "commit"}, {"oid": "4faf11f5cc421c530020be6c31421fb90b11c332", "url": "https://github.com/ls1intum/Artemis/commit/4faf11f5cc421c530020be6c31421fb90b11c332", "message": "Return proper link in exam-participation-summary.component.ts", "committedDate": "2020-07-09T11:13:47Z", "type": "commit"}, {"oid": "2fb41cafe72f0d27a10da6df5b6d14bb28b2210b", "url": "https://github.com/ls1intum/Artemis/commit/2fb41cafe72f0d27a10da6df5b6d14bb28b2210b", "message": "Add default value for isPublished()", "committedDate": "2020-07-09T18:57:03Z", "type": "commit"}, {"oid": "4e73a46a4b9e6c31288d7c52404ecfcdcd8691c6", "url": "https://github.com/ls1intum/Artemis/commit/4e73a46a4b9e6c31288d7c52404ecfcdcd8691c6", "message": "Get course for links from the url", "committedDate": "2020-07-09T20:02:45Z", "type": "commit"}, {"oid": "b5182adbe1771767914312610ba05daedfc81424", "url": "https://github.com/ls1intum/Artemis/commit/b5182adbe1771767914312610ba05daedfc81424", "message": "Merge develop", "committedDate": "2020-07-10T09:15:29Z", "type": "commit"}, {"oid": "6615fbe8f7a23ee77e0281f182d4cca8228fa77d", "url": "https://github.com/ls1intum/Artemis/commit/6615fbe8f7a23ee77e0281f182d4cca8228fa77d", "message": "Only display the score if publishResultsDate is set and in the past", "committedDate": "2020-07-10T09:17:29Z", "type": "commit"}, {"oid": "1cbd2e17cd25b1511574033469b26f35566ae4a3", "url": "https://github.com/ls1intum/Artemis/commit/1cbd2e17cd25b1511574033469b26f35566ae4a3", "message": "Merge remote-tracking branch 'origin/develop' into exam/management/results-summary-page", "committedDate": "2020-07-11T14:27:17Z", "type": "commit"}, {"oid": "5ce52e46f5deef03fafe15704c740f43ba4bc336", "url": "https://github.com/ls1intum/Artemis/commit/5ce52e46f5deef03fafe15704c740f43ba4bc336", "message": "translate", "committedDate": "2020-07-11T15:52:16Z", "type": "commit"}, {"oid": "53fb1c755ab03b1a6a749c25dd0ace671901af02", "url": "https://github.com/ls1intum/Artemis/commit/53fb1c755ab03b1a6a749c25dd0ace671901af02", "message": "Display result of quiz exercises in exam-summary after dueDate", "committedDate": "2020-07-13T13:14:18Z", "type": "commit"}, {"oid": "350bb6d9db1f8fe960febc91bd53f19f31ae22df", "url": "https://github.com/ls1intum/Artemis/commit/350bb6d9db1f8fe960febc91bd53f19f31ae22df", "message": "Merge branch 'develop' into exam/management/results-summary-page", "committedDate": "2020-07-13T15:51:38Z", "type": "commit"}, {"oid": "efd45488feb1981396465056aeaf062326c8b310", "url": "https://github.com/ls1intum/Artemis/commit/efd45488feb1981396465056aeaf062326c8b310", "message": "Don't show the assessment for exam-textexercises before the publishResultDate in the client", "committedDate": "2020-07-13T16:07:48Z", "type": "commit"}, {"oid": "930f15f4c5dc97b5376a39860765c9dfd8b9fb3d", "url": "https://github.com/ls1intum/Artemis/commit/930f15f4c5dc97b5376a39860765c9dfd8b9fb3d", "message": "Throw forbidden if a student tries to access exam-exercise-feedback before the publishResultDate", "committedDate": "2020-07-13T16:08:58Z", "type": "commit"}, {"oid": "17d45e2f38208b391e24f9b2f16f7124631521db", "url": "https://github.com/ls1intum/Artemis/commit/17d45e2f38208b391e24f9b2f16f7124631521db", "message": "Adjust error logic in TextExerciseResource", "committedDate": "2020-07-13T17:26:53Z", "type": "commit"}, {"oid": "63c716745d456378382d5eb9fdb3e13d3170b207", "url": "https://github.com/ls1intum/Artemis/commit/63c716745d456378382d5eb9fdb3e13d3170b207", "message": "Throw forbidden if student tries to access a modeling exercise after the exam has ended and before the results are published", "committedDate": "2020-07-13T17:45:01Z", "type": "commit"}, {"oid": "0e98d82ccfd9b3b35dd98eec3f0459b6bf5e2503", "url": "https://github.com/ls1intum/Artemis/commit/0e98d82ccfd9b3b35dd98eec3f0459b6bf5e2503", "message": "Merge remote-tracking branch 'origin/develop' into exam/management/results-summary-page", "committedDate": "2020-07-14T07:02:03Z", "type": "commit"}, {"oid": "b0887a0918f1a419f242b80d9d12f44030b97b17", "url": "https://github.com/ls1intum/Artemis/commit/b0887a0918f1a419f242b80d9d12f44030b97b17", "message": "Merge branch 'develop' into exam/management/results-summary-page", "committedDate": "2020-07-14T08:58:39Z", "type": "commit"}, {"oid": "cafaaf2086fd10ba487a244b5e15f408e6788018", "url": "https://github.com/ls1intum/Artemis/commit/cafaaf2086fd10ba487a244b5e15f408e6788018", "message": "Move auth check for exam results into AuthorizationCheckService", "committedDate": "2020-07-14T09:33:06Z", "type": "commit"}, {"oid": "bdd6e7b1eac3b929458f2c83bea4d12aaa0247f4", "url": "https://github.com/ls1intum/Artemis/commit/bdd6e7b1eac3b929458f2c83bea4d12aaa0247f4", "message": "Test that access is restricted", "committedDate": "2020-07-14T10:11:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDM5MDI2MA==", "url": "https://github.com/ls1intum/Artemis/pull/1844#discussion_r454390260", "bodyText": "isPublished might be a little bit confusing with regard to isVisible. I guess something like resultsPublished would be more intuitive here.", "author": "sascha11110", "createdAt": "2020-07-14T14:17:47Z", "path": "src/main/java/de/tum/in/www1/artemis/domain/exam/Exam.java", "diffHunk": "@@ -356,4 +375,11 @@ public Boolean isStarted() {\n         }\n         return startDate.isBefore(ZonedDateTime.now());\n     }\n+\n+    public Boolean isPublished() {", "originalCommit": "bdd6e7b1eac3b929458f2c83bea4d12aaa0247f4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQyOTY3Mw==", "url": "https://github.com/ls1intum/Artemis/pull/1844#discussion_r454429673", "bodyText": "Done", "author": "JonasPetry", "createdAt": "2020-07-14T15:09:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDM5MDI2MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQwNDAzNg==", "url": "https://github.com/ls1intum/Artemis/pull/1844#discussion_r454404036", "bodyText": "Maybe I'm too dumb for that, but I think this is really hard to understand. Maybe the following is easier to understand? Please double check as I'm not that confident that I really get what you check here.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    return !this.isOnlyStudentInCourse(exercise.getCourseViaExerciseGroupOrCourseMember(), user) || (!exercise.hasExerciseGroup()\n          \n          \n            \n                            || !exercise.getExerciseGroup().getExam().getEndDate().isBefore(ZonedDateTime.now()) || exercise.getExerciseGroup().getExam().isPublished());\n          \n          \n            \n                    return this.isAtLeastTeachingAssistantInCourse(exercise.getCourseViaExerciseGroupOrCourseMember(), user) || (exercise.hasExerciseGroup()\n          \n          \n            \n                            && exercise.getExerciseGroup().getExam().getEndDate().isBefore(ZonedDateTime.now()) && exercise.getExerciseGroup().getExam().isPublished());", "author": "sascha11110", "createdAt": "2020-07-14T14:35:54Z", "path": "src/main/java/de/tum/in/www1/artemis/service/AuthorizationCheckService.java", "diffHunk": "@@ -333,4 +337,18 @@ public boolean isUserAllowedToGetResult(Exercise exercise, StudentParticipation\n                 && (exercise.getAssessmentDueDate() == null || exercise.getAssessmentDueDate().isBefore(ZonedDateTime.now())) && result.getAssessor() != null\n                 && result.getCompletionDate() != null;\n     }\n+\n+    /**\n+     * Checks if the user is only student in the course.\n+     *\n+     * If the exam is over and the results are not published, he is not allowed to request a result.\n+     *\n+     * @param exercise - Exercise that the result is requested for\n+     * @param user - User that requests the result\n+     * @return true if user is allowed to see the result, false otherwise\n+     */\n+    public boolean isAllowedToGetExamResult(Exercise exercise, User user) {\n+        return !this.isOnlyStudentInCourse(exercise.getCourseViaExerciseGroupOrCourseMember(), user) || (!exercise.hasExerciseGroup()\n+                || !exercise.getExerciseGroup().getExam().getEndDate().isBefore(ZonedDateTime.now()) || exercise.getExerciseGroup().getExam().isPublished());", "originalCommit": "bdd6e7b1eac3b929458f2c83bea4d12aaa0247f4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQ1Njk3Mw==", "url": "https://github.com/ls1intum/Artemis/pull/1844#discussion_r454456973", "bodyText": "After committing your proposed changes I realised, that there was an error. Nevertheless I've adjusted this condition to make it easier to read and added a clause for each condition in the description", "author": "JonasPetry", "createdAt": "2020-07-14T15:47:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQwNDAzNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQwNTM0NA==", "url": "https://github.com/ls1intum/Artemis/pull/1844#discussion_r454405344", "bodyText": "I would improve the documentation here as it might be hard to understand what the separate conditions actually check (first see my next comment).\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * Checks if the user is only student in the course.\n          \n          \n            \n                 *\n          \n          \n            \n                 * If the exam is over and the results are not published, he is not allowed to request a result.\n          \n          \n            \n                 * Checks if the user is allowed to see the exam result. Returns true if\n          \n          \n            \n                 * - the current user is at least teaching assistant in the course\n          \n          \n            \n                 * - OR if the exam has already ended and the results were published", "author": "sascha11110", "createdAt": "2020-07-14T14:37:32Z", "path": "src/main/java/de/tum/in/www1/artemis/service/AuthorizationCheckService.java", "diffHunk": "@@ -333,4 +337,18 @@ public boolean isUserAllowedToGetResult(Exercise exercise, StudentParticipation\n                 && (exercise.getAssessmentDueDate() == null || exercise.getAssessmentDueDate().isBefore(ZonedDateTime.now())) && result.getAssessor() != null\n                 && result.getCompletionDate() != null;\n     }\n+\n+    /**\n+     * Checks if the user is only student in the course.\n+     *\n+     * If the exam is over and the results are not published, he is not allowed to request a result.", "originalCommit": "bdd6e7b1eac3b929458f2c83bea4d12aaa0247f4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQzOTk1MQ==", "url": "https://github.com/ls1intum/Artemis/pull/1844#discussion_r454439951", "bodyText": "The idea was that a student is also allowed to see it if the the exam has not ended yet. I've adjusted that in the documentation", "author": "JonasPetry", "createdAt": "2020-07-14T15:23:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQwNTM0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQwNjExMA==", "url": "https://github.com/ls1intum/Artemis/pull/1844#discussion_r454406110", "bodyText": "Simply use forbidden() here :-)", "author": "sascha11110", "createdAt": "2020-07-14T14:38:35Z", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ModelingSubmissionResource.java", "diffHunk": "@@ -382,6 +409,11 @@ else if (!authCheckService.isAtLeastInstructorForExercise(exercise)) {\n             return forbidden();\n         }\n \n+        // Exam exercises cannot be seen by students between the endDate and the publishResultDate\n+        if (!authCheckService.isAllowedToGetExamResult(modelingExercise, user)) {\n+            return ResponseEntity.status(HttpStatus.FORBIDDEN).build();", "originalCommit": "bdd6e7b1eac3b929458f2c83bea4d12aaa0247f4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQ1MjIzNA==", "url": "https://github.com/ls1intum/Artemis/pull/1844#discussion_r454452234", "bodyText": "Done", "author": "sjagla27", "createdAt": "2020-07-14T15:40:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQwNjExMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQwODI4OA==", "url": "https://github.com/ls1intum/Artemis/pull/1844#discussion_r454408288", "bodyText": "Simply use forbidden() here", "author": "sascha11110", "createdAt": "2020-07-14T14:41:22Z", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/TextExerciseResource.java", "diffHunk": "@@ -354,6 +388,11 @@ else if (!authCheckService.isAtLeastTeachingAssistantForExercise(optionalTextExe\n             return ResponseEntity.status(HttpStatus.FORBIDDEN).build();\n         }\n \n+        // Exam exercises cannot be seen by students between the endDate and the publishResultDate\n+        if (!authCheckService.isAllowedToGetExamResult(textExercise, user)) {\n+            return ResponseEntity.status(HttpStatus.FORBIDDEN).build();", "originalCommit": "bdd6e7b1eac3b929458f2c83bea4d12aaa0247f4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQ1MjMwOQ==", "url": "https://github.com/ls1intum/Artemis/pull/1844#discussion_r454452309", "bodyText": "Done", "author": "sjagla27", "createdAt": "2020-07-14T15:40:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQwODI4OA=="}], "type": "inlineReview"}, {"oid": "e4c662effe874113e6d6f919382a897c3f3749f2", "url": "https://github.com/ls1intum/Artemis/commit/e4c662effe874113e6d6f919382a897c3f3749f2", "message": "Update src/main/java/de/tum/in/www1/artemis/service/AuthorizationCheckService.java\r\n\r\nUpdate conditional statement\n\nCo-authored-by: Sascha Beele <sascha@beele.io>", "committedDate": "2020-07-14T15:19:04Z", "type": "commit"}, {"oid": "e9996dc0c851d94591a0a24a7786a39dc27d600c", "url": "https://github.com/ls1intum/Artemis/commit/e9996dc0c851d94591a0a24a7786a39dc27d600c", "message": "addressed feedback", "committedDate": "2020-07-14T15:28:56Z", "type": "commit"}, {"oid": "0ebd60299849f976cedd64c2a26e95a021773131", "url": "https://github.com/ls1intum/Artemis/commit/0ebd60299849f976cedd64c2a26e95a021773131", "message": "Update logic & documentation to specify whether a student is allowed to see a result", "committedDate": "2020-07-14T15:40:20Z", "type": "commit"}, {"oid": "a20e3180f9fbdd5d8e4e4c20d2e6ffbabcbc7c22", "url": "https://github.com/ls1intum/Artemis/commit/a20e3180f9fbdd5d8e4e4c20d2e6ffbabcbc7c22", "message": "Uppdate wrong javadoc in Exam.java", "committedDate": "2020-07-14T15:44:32Z", "type": "commit"}, {"oid": "16687b4f4d6dee24c230bba01e200114ad8f086f", "url": "https://github.com/ls1intum/Artemis/commit/16687b4f4d6dee24c230bba01e200114ad8f086f", "message": "Merge branch 'develop' into exam/management/results-summary-page", "committedDate": "2020-07-14T15:45:15Z", "type": "commit"}, {"oid": "f966dae1498672cd1fff9db13ff8c8fef1165e6b", "url": "https://github.com/ls1intum/Artemis/commit/f966dae1498672cd1fff9db13ff8c8fef1165e6b", "message": "Move examResultsPublished into exercise.model.ts and refactored all corresponding files", "committedDate": "2020-07-14T16:03:34Z", "type": "commit"}, {"oid": "d1013626edc5e77bcf1cc524f2809f4d142b228c", "url": "https://github.com/ls1intum/Artemis/commit/d1013626edc5e77bcf1cc524f2809f4d142b228c", "message": "Move examResultsPublished into extra method in exercise.model.ts and refactored all corresponding files", "committedDate": "2020-07-14T16:55:23Z", "type": "commit"}, {"oid": "47228f331b4ca94f7deb546dc341116ff3ba480a", "url": "https://github.com/ls1intum/Artemis/commit/47228f331b4ca94f7deb546dc341116ff3ba480a", "message": "Remove future check for ValidVisibleDate", "committedDate": "2020-07-14T18:19:20Z", "type": "commit"}, {"oid": "2362ccc79e25f1d844e0ad2207478d810809be19", "url": "https://github.com/ls1intum/Artemis/commit/2362ccc79e25f1d844e0ad2207478d810809be19", "message": "Merge remote-tracking branch 'origin/develop' into exam/management/results-summary-page", "committedDate": "2020-07-14T19:51:22Z", "type": "commit"}, {"oid": "fd69b0cf52f541e3e4d6388dfb40e2576bdd8b3b", "url": "https://github.com/ls1intum/Artemis/commit/fd69b0cf52f541e3e4d6388dfb40e2576bdd8b3b", "message": "Readd future check for ValidVisibleDate\n\nCo-authored-by: Sascha Beele <sascha@beele.io>", "committedDate": "2020-07-14T19:53:36Z", "type": "commit"}]}