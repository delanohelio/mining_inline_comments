{"pr_number": 805, "pr_title": "Improve performance of query endpoint and ZAAS client", "pr_createdAt": "2020-08-27T11:41:31Z", "pr_url": "https://github.com/zowe/api-layer/pull/805", "timeline": [{"oid": "82a055ff9017a7909ef83567521ab886573abde7", "url": "https://github.com/zowe/api-layer/commit/82a055ff9017a7909ef83567521ab886573abde7", "message": "leverage caching effectively\nthis fixes a cache miss\n\nSigned-off-by: jandadav <janda.david@gmail.com>", "committedDate": "2020-08-27T11:52:09Z", "type": "commit"}, {"oid": "025351768cc310c1b379e9abd6e0d58cb0e7e17d", "url": "https://github.com/zowe/api-layer/commit/025351768cc310c1b379e9abd6e0d58cb0e7e17d", "message": "Reuse HttpClients\n\nSigned-off-by: jandadav <janda.david@gmail.com>", "committedDate": "2020-08-27T11:52:09Z", "type": "commit"}, {"oid": "025351768cc310c1b379e9abd6e0d58cb0e7e17d", "url": "https://github.com/zowe/api-layer/commit/025351768cc310c1b379e9abd6e0d58cb0e7e17d", "message": "Reuse HttpClients\n\nSigned-off-by: jandadav <janda.david@gmail.com>", "committedDate": "2020-08-27T11:52:09Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODQyNDc4OQ==", "url": "https://github.com/zowe/api-layer/pull/805#discussion_r478424789", "bodyText": "There is a TODO left. Beside that, it looks fine", "author": "taban03", "createdAt": "2020-08-27T13:37:11Z", "path": "zaas-client/src/main/java/org/zowe/apiml/zaasclient/service/internal/HttpsClientProvider.java", "diffHunk": "@@ -58,30 +63,30 @@ public HttpsClientProvider(ConfigProperties configProperties) throws ZaasConfigu\n     }\n \n     @Override\n-    public CloseableHttpClient getHttpsClientWithTrustStore() throws ZaasConfigurationException {\n-        return sharedHttpClientConfiguration(getSSLContext())\n-            .build();\n-    }\n-\n-    @Override\n-    public CloseableHttpClient getHttpsClientWithTrustStore(BasicCookieStore cookieStore) throws ZaasConfigurationException {\n-        return sharedHttpClientConfiguration(getSSLContext())\n-            .setDefaultCookieStore(cookieStore)\n-            .build();\n+    public synchronized CloseableHttpClient getHttpsClientWithTrustStore() throws ZaasConfigurationException {\n+        if (httpsClientWithTruststore == null) {\n+            httpsClientWithTruststore = sharedHttpClientConfiguration(getSSLContext())\n+                .build();\n+        }\n+        return httpsClientWithTruststore;\n     }\n \n+    //TODO how is this working compared to the other method to get the client?", "originalCommit": "025351768cc310c1b379e9abd6e0d58cb0e7e17d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODQyNzUyOA==", "url": "https://github.com/zowe/api-layer/pull/805#discussion_r478427528", "bodyText": "Yes, i left that TODO intentionally so it's not forgotten. I will address it with additional tests, but not in this PR. It does not have anything to do with performance. It's just the way the client is built which seems incorrect.", "author": "jandadav", "createdAt": "2020-08-27T13:41:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODQyNDc4OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODQzNTQyMg==", "url": "https://github.com/zowe/api-layer/pull/805#discussion_r478435422", "bodyText": "If you agree, i'd keep it in and it will be removed later when i manage to verify if it's a problem. So far the code works, so i did not change it.", "author": "jandadav", "createdAt": "2020-08-27T13:52:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODQyNDc4OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODQzOTYwOQ==", "url": "https://github.com/zowe/api-layer/pull/805#discussion_r478439609", "bodyText": "I'm ok with that.", "author": "taban03", "createdAt": "2020-08-27T13:57:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODQyNDc4OQ=="}], "type": "inlineReview"}]}