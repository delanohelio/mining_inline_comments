{"pr_number": 1025, "pr_title": "Expressions and dummy implementation of SAF resource check", "pr_createdAt": "2020-12-18T16:36:37Z", "pr_url": "https://github.com/zowe/api-layer/pull/1025", "timeline": [{"oid": "8415bcc3dce50f1666ce3e3abd5f066829c76c5b", "url": "https://github.com/zowe/api-layer/commit/8415bcc3dce50f1666ce3e3abd5f066829c76c5b", "message": "expressions and dummy implementation\n\nSigned-off-by: Pavel Jare\u0161 <pavel.jares@broadcom.com>", "committedDate": "2020-12-18T16:19:49Z", "type": "commit"}, {"oid": "f2876abcc3c42c250da0e70a9ca8fc0e2380b069", "url": "https://github.com/zowe/api-layer/commit/f2876abcc3c42c250da0e70a9ca8fc0e2380b069", "message": "Sonar fixes\n\nSigned-off-by: Pavel Jare\u0161 <pavel.jares@broadcom.com>", "committedDate": "2020-12-18T16:58:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjY1MjczOA==", "url": "https://github.com/zowe/api-layer/pull/1025#discussion_r546652738", "bodyText": "Logger will be used?", "author": "achmelo", "createdAt": "2020-12-21T11:24:11Z", "path": "apiml-security-common/src/main/java/org/zowe/apiml/security/common/auth/saf/SafResourceAccessConfig.java", "diffHunk": "@@ -0,0 +1,27 @@\n+/*\n+ * This program and the accompanying materials are made available under the terms of the\n+ * Eclipse Public License v2.0 which accompanies this distribution, and is available at\n+ * https://www.eclipse.org/legal/epl-v20.html\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ *\n+ * Copyright Contributors to the Zowe Project.\n+ */\n+package org.zowe.apiml.security.common.auth.saf;\n+\n+import lombok.extern.slf4j.Slf4j;\n+import org.springframework.context.annotation.Bean;\n+import org.springframework.context.annotation.Configuration;\n+\n+import java.io.IOException;\n+\n+@Configuration\n+@Slf4j\n+public class SafResourceAccessConfig {", "originalCommit": "f2876abcc3c42c250da0e70a9ca8fc0e2380b069", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjY1Mjc3NA==", "url": "https://github.com/zowe/api-layer/pull/1025#discussion_r546652774", "bodyText": "could be a conditional bean? but can be done in the next PR, once another implementation is available", "author": "achmelo", "createdAt": "2020-12-21T11:24:17Z", "path": "apiml-security-common/src/main/java/org/zowe/apiml/security/common/auth/saf/SafResourceAccessConfig.java", "diffHunk": "@@ -0,0 +1,27 @@\n+/*\n+ * This program and the accompanying materials are made available under the terms of the\n+ * Eclipse Public License v2.0 which accompanies this distribution, and is available at\n+ * https://www.eclipse.org/legal/epl-v20.html\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ *\n+ * Copyright Contributors to the Zowe Project.\n+ */\n+package org.zowe.apiml.security.common.auth.saf;\n+\n+import lombok.extern.slf4j.Slf4j;\n+import org.springframework.context.annotation.Bean;\n+import org.springframework.context.annotation.Configuration;\n+\n+import java.io.IOException;\n+\n+@Configuration\n+@Slf4j\n+public class SafResourceAccessConfig {\n+\n+    @Bean\n+    public SafResourceAccessVerifying safResourceAccessVerifying() throws IOException {", "originalCommit": "f2876abcc3c42c250da0e70a9ca8fc0e2380b069", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzI2MDQzMQ==", "url": "https://github.com/zowe/api-layer/pull/1025#discussion_r547260431", "bodyText": "I have changed it for this issue, but with the next pr it will created again with a if clausule.", "author": "pj892031", "createdAt": "2020-12-22T12:51:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjY1Mjc3NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjY1MjgwMg==", "url": "https://github.com/zowe/api-layer/pull/1025#discussion_r546652802", "bodyText": "Could you please add some comment or rename the load and set methods so we better know what they are doing. For future maintenance.", "author": "achmelo", "createdAt": "2020-12-21T11:24:23Z", "path": "apiml-security-common/src/main/java/org/zowe/apiml/security/common/auth/saf/SafResourceAccessDummy.java", "diffHunk": "@@ -0,0 +1,125 @@\n+/*\n+ * This program and the accompanying materials are made available under the terms of the\n+ * Eclipse Public License v2.0 which accompanies this distribution, and is available at\n+ * https://www.eclipse.org/legal/epl-v20.html\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ *\n+ * Copyright Contributors to the Zowe Project.\n+ */\n+package org.zowe.apiml.security.common.auth.saf;\n+\n+import lombok.Builder;\n+import lombok.Value;\n+import org.springframework.security.core.Authentication;\n+import org.yaml.snakeyaml.Yaml;\n+\n+import java.io.*;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+public class SafResourceAccessDummy implements SafResourceAccessVerifying {\n+\n+    private static final String SAF_ACCESS = \"safAccess\";\n+    private static final String DEFAULT_FILE_LOCATION = \"saf.yml\";\n+    private static final String DEFAULT_RESOURCE_LOCATION = \"mock-saf.yml\";\n+\n+    private Map<ResourceUser, AccessLevel> resourceUserToAccessLevel = new HashMap<>();\n+\n+    public SafResourceAccessDummy() throws IOException {\n+        File file = getFile();\n+        if (file.exists()) {\n+            try (\n+                FileInputStream fis = new FileInputStream(file);\n+                BufferedInputStream bis = new BufferedInputStream(fis)\n+            ) {\n+                load(bis);\n+            }\n+        } else {\n+            try (InputStream inputStream = this.getClass().getClassLoader().getResourceAsStream(DEFAULT_RESOURCE_LOCATION)) {\n+                load(inputStream);\n+            }\n+        }\n+    }\n+\n+    protected File getFile() {\n+        return new File(DEFAULT_FILE_LOCATION);\n+    }\n+\n+    public SafResourceAccessDummy(InputStream inputStream) {\n+        load(inputStream);\n+    }\n+\n+    @Override\n+    public boolean hasSafResourceAccess(Authentication authentication, String resourceClass, String resourceName, String accessLevel) {\n+        ResourceUser resourceUser = ResourceUser.builder()\n+            .resourceClass(resourceClass)\n+            .resourceName(resourceName)\n+            .userId(authentication.getName())\n+            .build();\n+        AccessLevel currentLevel = resourceUserToAccessLevel.get(resourceUser);\n+        if (currentLevel == null) return false;\n+        return currentLevel.compareTo(AccessLevel.valueOf(accessLevel)) >= 0;\n+    }\n+\n+    private void load(InputStream inputStream) {", "originalCommit": "f2876abcc3c42c250da0e70a9ca8fc0e2380b069", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "cc8d08d0d91c619d0d3f7cfe5f9862e45e620081", "url": "https://github.com/zowe/api-layer/commit/cc8d08d0d91c619d0d3f7cfe5f9862e45e620081", "message": "Merge branch 'master' into protectors/safHasResourceSecurityExpression", "committedDate": "2020-12-22T08:47:12Z", "type": "commit"}, {"oid": "4e33318ce4dd7b1f49760b595047c072567cf63f", "url": "https://github.com/zowe/api-layer/commit/4e33318ce4dd7b1f49760b595047c072567cf63f", "message": "fix by code review\n\nSigned-off-by: Pavel Jare\u0161 <pavel.jares@broadcom.com>", "committedDate": "2020-12-22T11:32:55Z", "type": "commit"}, {"oid": "5d6889715171100309d736eb5e228559dc484889", "url": "https://github.com/zowe/api-layer/commit/5d6889715171100309d736eb5e228559dc484889", "message": "Merge branch 'master' into protectors/safHasResourceSecurityExpression", "committedDate": "2020-12-22T14:04:03Z", "type": "commit"}, {"oid": "e546973a1ad13615bc5bcdd79f4f421a9ad4a1c3", "url": "https://github.com/zowe/api-layer/commit/e546973a1ad13615bc5bcdd79f4f421a9ad4a1c3", "message": "Merge branch 'master' into protectors/safHasResourceSecurityExpression", "committedDate": "2020-12-22T22:54:33Z", "type": "commit"}]}