{"pr_number": 639, "pr_title": "Fixes #629", "pr_createdAt": "2020-07-02T18:33:11Z", "pr_url": "https://github.com/smallrye/smallrye-reactive-messaging/pull/639", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTM4OTM4Mw==", "url": "https://github.com/smallrye/smallrye-reactive-messaging/pull/639#discussion_r449389383", "bodyText": "Is it done?", "author": "cescoffier", "createdAt": "2020-07-03T05:56:02Z", "path": "smallrye-reactive-messaging-provider/src/test/java/io/smallrye/reactive/messaging/blocking/BlockingExceptionTest.java", "diffHunk": "@@ -0,0 +1,39 @@\n+package io.smallrye.reactive.messaging.blocking;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.awaitility.Awaitility.await;\n+\n+import org.jboss.logmanager.Level;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.RegisterExtension;\n+\n+import io.smallrye.reactive.messaging.WeldTestBaseWithoutTails;\n+import io.smallrye.reactive.messaging.blocking.beans.IncomingBlockingExceptionBean;\n+import io.smallrye.testing.logging.LogCapture;\n+\n+public class BlockingExceptionTest extends WeldTestBaseWithoutTails {\n+\n+    @RegisterExtension\n+    static LogCapture logCapture = LogCapture.with(r -> \"io.smallrye.reactive.messaging.provider\".equals(r.getLoggerName()),\n+            Level.ERROR);\n+\n+    @Test\n+    public void testIncomingBlockingWithException() {\n+        addBeanClass(BlockingSubscriberTest.ProduceIn.class);\n+        addBeanClass(IncomingBlockingExceptionBean.class);\n+        initialize();\n+\n+        IncomingBlockingExceptionBean bean = container.getBeanManager().createInstance()\n+                .select(IncomingBlockingExceptionBean.class).get();\n+\n+        await().until(() -> bean.list().size() == 5);\n+        assertThat(bean.list()).contains(\"a\", \"b\", \"d\", \"e\", \"f\");\n+\n+        //TODO: Assert the log output contains an exception", "originalCommit": "427675d7b44f3b47db21d5401cd7c5aa68ca8af2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDIwNTU2Mw==", "url": "https://github.com/smallrye/smallrye-reactive-messaging/pull/639#discussion_r450205563", "bodyText": "Oops, removed", "author": "kenfinnigan", "createdAt": "2020-07-06T13:04:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTM4OTM4Mw=="}], "type": "inlineReview"}, {"oid": "4567a87953f2399f70dded242c1275b9a495f1ba", "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/4567a87953f2399f70dded242c1275b9a495f1ba", "message": "Fixes #629\n\n- @Blocking and @Incoming method exceptions are now logged\n- JUnit 4/5 co-existing now for unit tests\n- Add SmallRye Testing to capture log output from a test", "committedDate": "2020-07-06T13:00:31Z", "type": "commit"}, {"oid": "b8afb891c9f1c19e8464c866cb507ccfe9ebae6e", "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/b8afb891c9f1c19e8464c866cb507ccfe9ebae6e", "message": "Fixes based on feedback", "committedDate": "2020-07-06T13:03:47Z", "type": "commit"}, {"oid": "b8afb891c9f1c19e8464c866cb507ccfe9ebae6e", "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/b8afb891c9f1c19e8464c866cb507ccfe9ebae6e", "message": "Fixes based on feedback", "committedDate": "2020-07-06T13:03:47Z", "type": "forcePushed"}]}