{"pr_number": 760, "pr_title": "Kafka test reorg and disable auto commit", "pr_createdAt": "2020-09-19T14:51:04Z", "pr_url": "https://github.com/smallrye/smallrye-reactive-messaging/pull/760", "timeline": [{"oid": "63438664baee6e5ab0aa54f4a5c7b58df31534f9", "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/63438664baee6e5ab0aa54f4a5c7b58df31534f9", "message": "Disable auto commit by default", "committedDate": "2020-09-19T15:21:22Z", "type": "forcePushed"}, {"oid": "49ae4fa6e77e8ea29a19a9a63eb69a8db29ca28b", "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/49ae4fa6e77e8ea29a19a9a63eb69a8db29ca28b", "message": "Fix race in NoKafkataTest", "committedDate": "2020-09-19T18:11:40Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTY5NzQyMw==", "url": "https://github.com/smallrye/smallrye-reactive-messaging/pull/760#discussion_r491697423", "bodyText": "It looks like enable.auto.commit will always have a value now, no need for getOrDefault on line 96.\nAlso , why not use the defined constant ConsumerConfig.ENABLE_AUTO_COMMIT_CONFIG instead of the literal enable.auto.commit on line 91?", "author": "pcasaes", "createdAt": "2020-09-20T14:34:43Z", "path": "smallrye-reactive-messaging-kafka/src/main/java/io/smallrye/reactive/messaging/kafka/impl/KafkaSource.java", "diffHunk": "@@ -86,9 +86,14 @@ public KafkaSource(Vertx vertx,\n             kafkaConfiguration.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, config.getKeyDeserializer());\n         }\n \n+        if (!kafkaConfiguration.containsKey(\"enable.auto.commit\")) {\n+            log.disableAutoCommit(config.getChannel());\n+            kafkaConfiguration.put(\"enable.auto.commit\", \"false\");\n+        }\n+\n         String commitStrategy = config\n                 .getCommitStrategy()\n-                .orElse(Boolean.parseBoolean(kafkaConfiguration.getOrDefault(ConsumerConfig.ENABLE_AUTO_COMMIT_CONFIG, \"true\"))\n+                .orElse(Boolean.parseBoolean(kafkaConfiguration.getOrDefault(ConsumerConfig.ENABLE_AUTO_COMMIT_CONFIG, \"false\"))", "originalCommit": "49ae4fa6e77e8ea29a19a9a63eb69a8db29ca28b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTcxNTE4Mw==", "url": "https://github.com/smallrye/smallrye-reactive-messaging/pull/760#discussion_r491715183", "bodyText": "Done!", "author": "cescoffier", "createdAt": "2020-09-20T17:46:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTY5NzQyMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTY5NzU0Mg==", "url": "https://github.com/smallrye/smallrye-reactive-messaging/pull/760#discussion_r491697542", "bodyText": "Might be worded a bit better:\n\nIt's recommended to NOT use auto-commit and let the connector handle commits", "author": "pcasaes", "createdAt": "2020-09-20T14:35:48Z", "path": "smallrye-reactive-messaging-kafka/src/main/java/io/smallrye/reactive/messaging/kafka/KafkaConnector.java", "diffHunk": "@@ -57,6 +57,7 @@\n @ConnectorAttribute(name = \"value.deserializer\", type = \"string\", direction = Direction.INCOMING, description = \"The deserializer classname used to deserialize the record's value\", mandatory = true)\n @ConnectorAttribute(name = \"fetch.min.bytes\", type = \"int\", direction = Direction.INCOMING, description = \"The minimum amount of data the server should return for a fetch request. The default setting of 1 byte means that fetch requests are answered as soon as a single byte of data is available or the fetch request times out waiting for data to arrive.\", defaultValue = \"1\")\n @ConnectorAttribute(name = \"group.id\", type = \"string\", direction = Direction.INCOMING, description = \"A unique string that identifies the consumer group the application belongs to. If not set, a unique, generated id is used\")\n+@ConnectorAttribute(name = \"enable.auto.commit\", type = \"boolean\", direction = Direction.INCOMING, description = \"Whether or not auto-commit is enabled. It's recommended to NOT use auto-commit and let's the connector handle commit\", defaultValue = \"false\")", "originalCommit": "49ae4fa6e77e8ea29a19a9a63eb69a8db29ca28b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTcxNTMxNQ==", "url": "https://github.com/smallrye/smallrye-reactive-messaging/pull/760#discussion_r491715315", "bodyText": "Fixed !", "author": "cescoffier", "createdAt": "2020-09-20T17:48:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTY5NzU0Mg=="}], "type": "inlineReview"}, {"oid": "afe23c0bf4ab595e65e66ceac5bcb46892b97aa4", "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/afe23c0bf4ab595e65e66ceac5bcb46892b97aa4", "message": "Remove a dependency not used anymore since AMQP tests uses junit 5", "committedDate": "2020-09-20T17:40:18Z", "type": "commit"}, {"oid": "f1ba59f93a44be0946053f53f589554582fd001e", "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/f1ba59f93a44be0946053f53f589554582fd001e", "message": "Fixed type in logged messages", "committedDate": "2020-09-20T17:40:18Z", "type": "commit"}, {"oid": "903156613b161a7964fab322dc543a9e17a164b2", "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/903156613b161a7964fab322dc543a9e17a164b2", "message": "Remove non-kafka properties from configurations\n\nRemove group.id from admin config\nRemove tracing.enabled from both the consumer and admin config", "committedDate": "2020-09-20T17:40:18Z", "type": "commit"}, {"oid": "6dda2d99e3240dba132afda2a0ec5c5416373f65", "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/6dda2d99e3240dba132afda2a0ec5c5416373f65", "message": "Fix typo in exception class name", "committedDate": "2020-09-20T17:40:18Z", "type": "commit"}, {"oid": "ef702030342e5e393518b7016e5f3b8b63c3e1d8", "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/ef702030342e5e393518b7016e5f3b8b63c3e1d8", "message": "Major refactoring of the Kafka tests\n\n- Switch to junit 5\n- New config goodies\n- Move base classes to their own package and refactor code to avoid duplications", "committedDate": "2020-09-20T17:40:18Z", "type": "commit"}, {"oid": "81b32c82fed297d571653eb1f0784cb6cb60780e", "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/81b32c82fed297d571653eb1f0784cb6cb60780e", "message": "Fix race in NoKafkataTest", "committedDate": "2020-09-20T17:46:12Z", "type": "forcePushed"}, {"oid": "dec83646f3502cef15e1b438c068f1062324c3e1", "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/dec83646f3502cef15e1b438c068f1062324c3e1", "message": "Fix race in NoKafkataTest", "committedDate": "2020-09-20T17:47:47Z", "type": "forcePushed"}, {"oid": "a36d153d697f964019d62b400e1aef1c0fa3408d", "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/a36d153d697f964019d62b400e1aef1c0fa3408d", "message": "Disable auto commit by default", "committedDate": "2020-09-20T18:03:55Z", "type": "commit"}, {"oid": "1b1c3edd5aacd6eabdb4614d686e9ae9dd60efdd", "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/1b1c3edd5aacd6eabdb4614d686e9ae9dd60efdd", "message": "Missed some update to Mutiny 0.8.0", "committedDate": "2020-09-20T18:03:55Z", "type": "commit"}, {"oid": "987f27a0429704a061170a4f9261afcc28661286", "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/987f27a0429704a061170a4f9261afcc28661286", "message": "Close admin clients", "committedDate": "2020-09-20T18:03:55Z", "type": "commit"}, {"oid": "443a28e2b95bccdfece8aeaf4368e439e093e498", "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/443a28e2b95bccdfece8aeaf4368e439e093e498", "message": "Fix race in NoKafkataTest", "committedDate": "2020-09-20T18:03:55Z", "type": "commit"}, {"oid": "443a28e2b95bccdfece8aeaf4368e439e093e498", "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/443a28e2b95bccdfece8aeaf4368e439e093e498", "message": "Fix race in NoKafkataTest", "committedDate": "2020-09-20T18:03:55Z", "type": "forcePushed"}]}