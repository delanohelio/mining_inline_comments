{"pr_number": 672, "pr_title": "Set fetch size to before pause value when resuming kafka source", "pr_createdAt": "2020-07-20T07:10:50Z", "pr_url": "https://github.com/smallrye/smallrye-reactive-messaging/pull/672", "timeline": [{"oid": "8752c5943fb561d653d9bb9f187895781d2f3c7d", "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/8752c5943fb561d653d9bb9f187895781d2f3c7d", "message": "Set fetch size to before pause value when resuming kafka source", "committedDate": "2020-07-20T07:10:41Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzEyMDg0Nw==", "url": "https://github.com/smallrye/smallrye-reactive-messaging/pull/672#discussion_r457120847", "bodyText": "Why 128?", "author": "cescoffier", "createdAt": "2020-07-20T07:14:42Z", "path": "smallrye-reactive-messaging-kafka/src/main/java/io/smallrye/reactive/messaging/kafka/impl/KafkaSource.java", "diffHunk": "@@ -129,6 +129,10 @@ public KafkaSource(Vertx vertx,\n                                                     \"10000\")))\n                             + 11_000L; // it's possible that it might expire 10 seconds before when we need it to\n \n+                    // When resuming the consumer we must set the fetch amount to what it was before pausing\n+                    // When partitions is greater than 1 this value will be 128 otherwise it will be 1.\n+                    final int resumeFetchAmount = config.getPartitions() > 1 ? 128 : 1;", "originalCommit": "8752c5943fb561d653d9bb9f187895781d2f3c7d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzE0MzgxNg==", "url": "https://github.com/smallrye/smallrye-reactive-messaging/pull/672#discussion_r457143816", "bodyText": "When partitions is greater than 1 the initial fetch is the concurrency value from MultiMerge which by default is 128.", "author": "pcasaes", "createdAt": "2020-07-20T07:49:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzEyMDg0Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzEyMTMxOQ==", "url": "https://github.com/smallrye/smallrye-reactive-messaging/pull/672#discussion_r457121319", "bodyText": "What happens when the amount is consumed? Would it get more?", "author": "cescoffier", "createdAt": "2020-07-20T07:15:23Z", "path": "smallrye-reactive-messaging-kafka/src/main/java/io/smallrye/reactive/messaging/kafka/impl/KafkaSource.java", "diffHunk": "@@ -140,11 +144,11 @@ public KafkaSource(Vertx vertx,\n                                 .with(\n                                         a -> {\n                                             log.executedConsumerAssignedRebalanceListener(group);\n-                                            kafkaConsumer.resume();\n+                                            kafkaConsumer.fetch(resumeFetchAmount);", "originalCommit": "8752c5943fb561d653d9bb9f187895781d2f3c7d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzE0Njg4Nw==", "url": "https://github.com/smallrye/smallrye-reactive-messaging/pull/672#discussion_r457146887", "bodyText": "It will get more. That's the current behavior without the consumer re-balance.", "author": "pcasaes", "createdAt": "2020-07-20T07:53:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzEyMTMxOQ=="}], "type": "inlineReview"}, {"oid": "194fc2c961cacfb5f0395f1ad1a6fb1d6e47c8bc", "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/194fc2c961cacfb5f0395f1ad1a6fb1d6e47c8bc", "message": "Set fetch size to before pause value when resuming kafka source", "committedDate": "2020-09-19T04:54:21Z", "type": "commit"}, {"oid": "194fc2c961cacfb5f0395f1ad1a6fb1d6e47c8bc", "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/194fc2c961cacfb5f0395f1ad1a6fb1d6e47c8bc", "message": "Set fetch size to before pause value when resuming kafka source", "committedDate": "2020-09-19T04:54:21Z", "type": "forcePushed"}]}