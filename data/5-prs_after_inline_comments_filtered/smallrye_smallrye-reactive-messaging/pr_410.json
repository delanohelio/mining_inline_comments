{"pr_number": 410, "pr_title": "AMQP connector: configuration via global AmqpClientOptions bean", "pr_createdAt": "2020-02-10T16:53:22Z", "pr_url": "https://github.com/smallrye/smallrye-reactive-messaging/pull/410", "timeline": [{"oid": "6541b3bc1a58ff383040a8bc3380445ac2fa5dbc", "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/6541b3bc1a58ff383040a8bc3380445ac2fa5dbc", "message": "amqp connector: configuration via global AmqpClientOptions bean", "committedDate": "2020-02-11T11:48:15Z", "type": "commit"}, {"oid": "6541b3bc1a58ff383040a8bc3380445ac2fa5dbc", "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/6541b3bc1a58ff383040a8bc3380445ac2fa5dbc", "message": "amqp connector: configuration via global AmqpClientOptions bean", "committedDate": "2020-02-11T11:48:15Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDA1OTE5OQ==", "url": "https://github.com/smallrye/smallrye-reactive-messaging/pull/410#discussion_r380059199", "bodyText": "Wondering about the case of amqp? But you know better than me on this.", "author": "cescoffier", "createdAt": "2020-02-17T09:12:08Z", "path": "smallrye-reactive-messaging-amqp/src/main/java/io/smallrye/reactive/messaging/amqp/AmqpConnector.java", "diffHunk": "@@ -114,21 +118,26 @@ private AmqpClient createClient(Config config) {\n         AmqpClient client;\n         Optional<String> clientOptionsName = config.getOptionalValue(\"client-options-name\", String.class);\n         if (clientOptionsName.isPresent()) {\n-            String optionsName = clientOptionsName.get();\n-            Instance<AmqpClientOptions> options = clientOptions.select(NamedLiteral.of(optionsName));\n-            if (options.isUnsatisfied()) {\n-                throw new IllegalStateException(\n-                        \"Cannot find a \" + AmqpClientOptions.class.getName() + \" bean named \" + optionsName);\n-            }\n-            LOGGER.debug(\"Creating amqp client from bean named '{}'\", optionsName);\n-            client = AmqpClient.create(new io.vertx.axle.core.Vertx(vertx.getDelegate()), options.get());\n+            client = createClientFromClientOptionsBean(clientOptionsName.get());\n+        } else if (this.defaultClientOptionsName != null && this.defaultClientOptionsName.isPresent()) {\n+            client = createClientFromClientOptionsBean(this.defaultClientOptionsName.get());\n         } else {\n             client = getClient(config);\n         }\n         clients.add(client);\n         return client;\n     }\n \n+    private AmqpClient createClientFromClientOptionsBean(String optionsBeanName) {\n+        Instance<AmqpClientOptions> options = clientOptions.select(NamedLiteral.of(optionsBeanName));\n+        if (options.isUnsatisfied()) {\n+            throw new IllegalStateException(\n+                    \"Cannot find a \" + AmqpClientOptions.class.getName() + \" bean named \" + optionsBeanName);\n+        }\n+        LOGGER.debug(\"Creating amqp client from bean named '{}'\", optionsBeanName);", "originalCommit": "6541b3bc1a58ff383040a8bc3380445ac2fa5dbc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "43f6e31a68f483befb8cdf0fe0adc2207d9969f3", "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/43f6e31a68f483befb8cdf0fe0adc2207d9969f3", "message": "add documentation", "committedDate": "2020-02-17T11:18:16Z", "type": "commit"}]}