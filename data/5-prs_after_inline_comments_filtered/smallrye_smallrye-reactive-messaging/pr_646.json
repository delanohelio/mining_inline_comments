{"pr_number": 646, "pr_title": "Implement readiness and liveness health check support for the Kafka connector", "pr_createdAt": "2020-07-06T09:04:10Z", "pr_url": "https://github.com/smallrye/smallrye-reactive-messaging/pull/646", "timeline": [{"oid": "a59fd5218c08bebb2ffb7daa73d0c1d3f252e4be", "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/a59fd5218c08bebb2ffb7daa73d0c1d3f252e4be", "message": "Implement readiness and liveness health check support for the Kafka connector", "committedDate": "2020-07-06T09:08:43Z", "type": "forcePushed"}, {"oid": "14044a9e1539ffed7ff24de99e55832cfedcf0f8", "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/14044a9e1539ffed7ff24de99e55832cfedcf0f8", "message": "Implement readiness and liveness health check support for the Kafka connector", "committedDate": "2020-07-06T10:03:55Z", "type": "forcePushed"}, {"oid": "bd146329b180058ff32c3ee143a2e45dae7a1e0c", "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/bd146329b180058ff32c3ee143a2e45dae7a1e0c", "message": "Implement readiness and liveness health check support for the Kafka connector", "committedDate": "2020-07-06T10:12:45Z", "type": "forcePushed"}, {"oid": "76bbd41287daba0445fc6e84a8b6e58d9dcca73b", "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/76bbd41287daba0445fc6e84a8b6e58d9dcca73b", "message": "Implement readiness and liveness health check support for the Kafka connector", "committedDate": "2020-07-06T11:47:17Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDIxNTQ1NQ==", "url": "https://github.com/smallrye/smallrye-reactive-messaging/pull/646#discussion_r450215455", "bodyText": "As this is now being used in at least a couple of places, should we be capturing the topic name instead of calling configuration more than once?", "author": "kenfinnigan", "createdAt": "2020-07-06T13:21:22Z", "path": "smallrye-reactive-messaging-kafka/src/main/java/io/smallrye/reactive/messaging/kafka/impl/KafkaSource.java", "diffHunk": "@@ -187,4 +211,48 @@ public void closeQuietly() {\n             log.exceptionOnClose(e);\n         }\n     }\n+\n+    public void isAlive(HealthReport.HealthReportBuilder builder) {\n+        if (configuration.getHealthEnabled()) {\n+            List<Throwable> actualFailures;\n+            boolean isCurrentlyConnected;\n+            synchronized (this) {\n+                actualFailures = new ArrayList<>(failures);\n+            }\n+            if (!actualFailures.isEmpty()) {\n+                builder.add(configuration.getChannel(), false,\n+                        actualFailures.stream().map(Throwable::getMessage).collect(Collectors.joining()));\n+            } else {\n+                builder.add(configuration.getChannel(), true);\n+            }\n+        }\n+\n+        // If health is disable do not add anything to the builder.\n+    }\n+\n+    private String getTopic() {\n+        return configuration.getTopic().orElseGet(configuration::getChannel);", "originalCommit": "76bbd41287daba0445fc6e84a8b6e58d9dcca73b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDIzODI3Mg==", "url": "https://github.com/smallrye/smallrye-reactive-messaging/pull/646#discussion_r450238272", "bodyText": "Yes, good idea! Just did it.", "author": "cescoffier", "createdAt": "2020-07-06T13:56:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDIxNTQ1NQ=="}], "type": "inlineReview"}, {"oid": "88fce71cc1caeb6ee8092cc3653a68023e08f743", "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/88fce71cc1caeb6ee8092cc3653a68023e08f743", "message": "Implement readiness and liveness health check support for the Kafka connector", "committedDate": "2020-07-06T13:56:15Z", "type": "commit"}, {"oid": "88fce71cc1caeb6ee8092cc3653a68023e08f743", "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/88fce71cc1caeb6ee8092cc3653a68023e08f743", "message": "Implement readiness and liveness health check support for the Kafka connector", "committedDate": "2020-07-06T13:56:15Z", "type": "forcePushed"}]}