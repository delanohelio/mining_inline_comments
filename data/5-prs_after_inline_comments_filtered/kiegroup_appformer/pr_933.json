{"pr_number": 933, "pr_title": "AF-2456: Support Gradual Export in Data Transfer API", "pr_createdAt": "2020-03-25T16:59:12Z", "pr_url": "https://github.com/kiegroup/appformer/pull/933", "timeline": [{"oid": "a74b4a7f646b14ef763d402579c8e86d10cbb7a9", "url": "https://github.com/kiegroup/appformer/commit/a74b4a7f646b14ef763d402579c8e86d10cbb7a9", "message": "Export navigation adjustments", "committedDate": "2020-03-25T16:59:57Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjkxMjQ1Mg==", "url": "https://github.com/kiegroup/appformer/pull/933#discussion_r402912452", "bodyText": "Suggested change", "author": "caponetto", "createdAt": "2020-04-03T10:32:29Z", "path": "dashbuilder/dashbuilder-client/dashbuilder-cms-client/src/main/java/org/dashbuilder/client/cms/screen/transfer/DataTransferExportPopUp.java", "diffHunk": "@@ -0,0 +1,81 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.dashbuilder.client.cms.screen.transfer;\n+\n+import javax.annotation.PostConstruct;\n+import javax.enterprise.context.ApplicationScoped;\n+import javax.inject.Inject;\n+\n+import org.dashbuilder.transfer.DataTransferAssets;\n+import org.dashbuilder.transfer.DataTransferExportModel;\n+import org.dashbuilder.transfer.DataTransferServices;\n+import org.jboss.errai.common.client.api.Caller;\n+import org.uberfire.client.mvp.UberElemental;\n+import org.uberfire.mvp.ParameterizedCommand;\n+\n+@ApplicationScoped\n+public class DataTransferExportPopUp {\n+\n+    private View view;\n+\n+    private Caller<DataTransferServices> dataTransferServices;\n+\n+    private ParameterizedCommand<DataTransferExportModel> dataTransferExportModelCallback;\n+\n+    public interface View extends UberElemental<DataTransferExportPopUp> {\n+\n+        void show();\n+\n+        void setAssetsToExport(DataTransferAssets assetsToExport);\n+\n+        void showError(Throwable error);\n+\n+    }\n+\n+    @Inject\n+    public DataTransferExportPopUp(View view,\n+                                   Caller<DataTransferServices> dataTransferServices) {\n+        this.view = view;\n+        this.dataTransferServices = dataTransferServices;\n+    }\n+\n+    @PostConstruct\n+    public void init() {\n+        view.init(this);\n+    }\n+\n+    public void setCallback(ParameterizedCommand<DataTransferExportModel> dataTransferExportModelCallback) {\n+        this.dataTransferExportModelCallback = dataTransferExportModelCallback;\n+\n+    }\n+\n+    public void load() {\n+        view.show();\n+        dataTransferServices.call((DataTransferAssets v) -> view.setAssetsToExport(v),\n+                                  (message, error) -> {\n+                                      view.showError(error);\n+                                      return false;\n+                                  })\n+                            .assetsToExport();\n+", "originalCommit": "a74b4a7f646b14ef763d402579c8e86d10cbb7a9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjkxMjUwNg==", "url": "https://github.com/kiegroup/appformer/pull/933#discussion_r402912506", "bodyText": "Suggested change", "author": "caponetto", "createdAt": "2020-04-03T10:32:36Z", "path": "dashbuilder/dashbuilder-client/dashbuilder-cms-client/src/main/java/org/dashbuilder/client/cms/screen/transfer/DataTransferExportPopUp.java", "diffHunk": "@@ -0,0 +1,81 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.dashbuilder.client.cms.screen.transfer;\n+\n+import javax.annotation.PostConstruct;\n+import javax.enterprise.context.ApplicationScoped;\n+import javax.inject.Inject;\n+\n+import org.dashbuilder.transfer.DataTransferAssets;\n+import org.dashbuilder.transfer.DataTransferExportModel;\n+import org.dashbuilder.transfer.DataTransferServices;\n+import org.jboss.errai.common.client.api.Caller;\n+import org.uberfire.client.mvp.UberElemental;\n+import org.uberfire.mvp.ParameterizedCommand;\n+\n+@ApplicationScoped\n+public class DataTransferExportPopUp {\n+\n+    private View view;\n+\n+    private Caller<DataTransferServices> dataTransferServices;\n+\n+    private ParameterizedCommand<DataTransferExportModel> dataTransferExportModelCallback;\n+\n+    public interface View extends UberElemental<DataTransferExportPopUp> {\n+\n+        void show();\n+\n+        void setAssetsToExport(DataTransferAssets assetsToExport);\n+\n+        void showError(Throwable error);\n+\n+    }\n+\n+    @Inject\n+    public DataTransferExportPopUp(View view,\n+                                   Caller<DataTransferServices> dataTransferServices) {\n+        this.view = view;\n+        this.dataTransferServices = dataTransferServices;\n+    }\n+\n+    @PostConstruct\n+    public void init() {\n+        view.init(this);\n+    }\n+\n+    public void setCallback(ParameterizedCommand<DataTransferExportModel> dataTransferExportModelCallback) {\n+        this.dataTransferExportModelCallback = dataTransferExportModelCallback;\n+", "originalCommit": "a74b4a7f646b14ef763d402579c8e86d10cbb7a9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjkxMjU3Mg==", "url": "https://github.com/kiegroup/appformer/pull/933#discussion_r402912572", "bodyText": "Suggested change", "author": "caponetto", "createdAt": "2020-04-03T10:32:43Z", "path": "dashbuilder/dashbuilder-client/dashbuilder-cms-client/src/main/java/org/dashbuilder/client/cms/screen/transfer/DataTransferExportPopUp.java", "diffHunk": "@@ -0,0 +1,81 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.dashbuilder.client.cms.screen.transfer;\n+\n+import javax.annotation.PostConstruct;\n+import javax.enterprise.context.ApplicationScoped;\n+import javax.inject.Inject;\n+\n+import org.dashbuilder.transfer.DataTransferAssets;\n+import org.dashbuilder.transfer.DataTransferExportModel;\n+import org.dashbuilder.transfer.DataTransferServices;\n+import org.jboss.errai.common.client.api.Caller;\n+import org.uberfire.client.mvp.UberElemental;\n+import org.uberfire.mvp.ParameterizedCommand;\n+\n+@ApplicationScoped\n+public class DataTransferExportPopUp {\n+\n+    private View view;\n+\n+    private Caller<DataTransferServices> dataTransferServices;\n+\n+    private ParameterizedCommand<DataTransferExportModel> dataTransferExportModelCallback;\n+\n+    public interface View extends UberElemental<DataTransferExportPopUp> {\n+\n+        void show();\n+\n+        void setAssetsToExport(DataTransferAssets assetsToExport);\n+\n+        void showError(Throwable error);\n+\n+    }\n+\n+    @Inject\n+    public DataTransferExportPopUp(View view,\n+                                   Caller<DataTransferServices> dataTransferServices) {\n+        this.view = view;\n+        this.dataTransferServices = dataTransferServices;\n+    }\n+\n+    @PostConstruct\n+    public void init() {\n+        view.init(this);\n+    }\n+\n+    public void setCallback(ParameterizedCommand<DataTransferExportModel> dataTransferExportModelCallback) {\n+        this.dataTransferExportModelCallback = dataTransferExportModelCallback;\n+\n+    }\n+\n+    public void load() {\n+        view.show();\n+        dataTransferServices.call((DataTransferAssets v) -> view.setAssetsToExport(v),\n+                                  (message, error) -> {\n+                                      view.showError(error);\n+                                      return false;\n+                                  })\n+                            .assetsToExport();\n+\n+    }\n+\n+    public void receiveSelectedAssets(DataTransferExportModel dataTransferExportModel) {\n+        dataTransferExportModelCallback.execute(dataTransferExportModel);\n+", "originalCommit": "a74b4a7f646b14ef763d402579c8e86d10cbb7a9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjk0NTA1Ng==", "url": "https://github.com/kiegroup/appformer/pull/933#discussion_r402945056", "bodyText": "Please add the copyright header to this file.", "author": "caponetto", "createdAt": "2020-04-03T11:39:25Z", "path": "dashbuilder/dashbuilder-shared/dashbuilder-services-api/src/main/java/org/dashbuilder/transfer/DataTransferExportModel.java", "diffHunk": "@@ -0,0 +1,70 @@\n+package org.dashbuilder.transfer;", "originalCommit": "a74b4a7f646b14ef763d402579c8e86d10cbb7a9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjk0NjEzNA==", "url": "https://github.com/kiegroup/appformer/pull/933#discussion_r402946134", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        DataTransferExportPopUp dataTransferExportPopUp) {\n          \n          \n            \n                        final DataTransferExportPopUp dataTransferExportPopUp) {", "author": "caponetto", "createdAt": "2020-04-03T11:41:43Z", "path": "dashbuilder/dashbuilder-client/dashbuilder-cms-client/src/main/java/org/dashbuilder/client/cms/screen/transfer/DataTransferScreen.java", "diffHunk": "@@ -50,11 +55,13 @@ public DataTransferScreen() {\n     public DataTransferScreen(\n             final View view,\n             final DataTransferPopUp popUp,\n-            final Caller<DataTransferServices> dataTransferServices) {\n+            final Caller<DataTransferServices> dataTransferServices,\n+            DataTransferExportPopUp dataTransferExportPopUp) {", "originalCommit": "a74b4a7f646b14ef763d402579c8e86d10cbb7a9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjk1MDI2MA==", "url": "https://github.com/kiegroup/appformer/pull/933#discussion_r402950260", "bodyText": "I'd suggest to extract each table on its own class following a common contract.\nThus, DataTransferExportPopUpView could add and treat each part of the Accordion in a generic way.\nAlso, it would allow to add any other kind of exporting item more easily.\nJust a thought :)", "author": "caponetto", "createdAt": "2020-04-03T11:51:03Z", "path": "dashbuilder/dashbuilder-client/dashbuilder-cms-client/src/main/java/org/dashbuilder/client/cms/screen/transfer/DataTransferExportPopUpView.java", "diffHunk": "@@ -0,0 +1,298 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.dashbuilder.client.cms.screen.transfer;\n+\n+import java.util.List;\n+import java.util.stream.Collectors;\n+import java.util.stream.IntStream;\n+import java.util.stream.Stream;\n+\n+import javax.enterprise.context.Dependent;\n+import javax.enterprise.event.Event;\n+import javax.inject.Inject;\n+\n+import elemental2.dom.Element;\n+import elemental2.dom.Element.OnclickCallbackFn;\n+import elemental2.dom.HTMLCollection;\n+import elemental2.dom.HTMLDivElement;\n+import elemental2.dom.HTMLElement;\n+import elemental2.dom.HTMLInputElement;\n+import elemental2.dom.HTMLTableCellElement;\n+import elemental2.dom.HTMLTableElement;\n+import elemental2.dom.HTMLTableRowElement;\n+import elemental2.dom.NodeList;\n+import org.dashbuilder.client.cms.resources.i18n.ContentManagerConstants;\n+import org.dashbuilder.client.cms.screen.util.DomFactory;\n+import org.dashbuilder.dataset.def.DataSetDef;\n+import org.dashbuilder.transfer.DataTransferAssets;\n+import org.dashbuilder.transfer.DataTransferExportModel;\n+import org.gwtbootstrap3.client.ui.ModalFooter;\n+import org.gwtbootstrap3.extras.toggleswitch.client.ui.ToggleSwitch;\n+import org.jboss.errai.common.client.dom.elemental2.Elemental2DomUtil;\n+import org.jboss.errai.ui.shared.api.annotations.DataField;\n+import org.jboss.errai.ui.shared.api.annotations.Templated;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.uberfire.ext.editor.commons.client.file.popups.CommonModalBuilder;\n+import org.uberfire.ext.widgets.common.client.common.popups.BaseModal;\n+import org.uberfire.ext.widgets.common.client.common.popups.footers.ModalFooterOKCancelButtons;\n+import org.uberfire.workbench.events.NotificationEvent;\n+\n+@Templated\n+@Dependent\n+public class DataTransferExportPopUpView implements DataTransferExportPopUp.View {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(DataTransferExportPopUpView.class);\n+\n+    private ContentManagerConstants i18n = ContentManagerConstants.INSTANCE;\n+    private DataTransferExportPopUp presenter;\n+    private BaseModal modal;\n+    \n+    @Inject\n+    ToggleSwitch toggleSwitch;\n+    \n+    @Inject\n+    Elemental2DomUtil elem2Dom;\n+    \n+    @Inject\n+    @DataField \n+    HTMLDivElement toggleSwitchContainer;\n+\n+    @Inject\n+    @DataField\n+    HTMLTableElement datasetsTable;\n+\n+    @Inject\n+    @DataField\n+    HTMLTableElement pagesTable;\n+\n+    @Inject\n+    @DataField\n+    private HTMLDivElement dataTransferExportModalBody;\n+\n+    @Inject\n+    @DataField\n+    HTMLInputElement searchDatasets;\n+\n+    @Inject\n+    @DataField\n+    HTMLInputElement searchPages;\n+\n+    @Inject\n+    @DataField\n+    HTMLInputElement selectAllDatasets;\n+\n+    @Inject\n+    @DataField\n+    HTMLInputElement selectAllPages;\n+\n+    @Inject\n+    @DataField\n+    HTMLDivElement progressIndicator;\n+\n+    @Inject\n+    @DataField\n+    HTMLDivElement dataSelectionAccordion;\n+\n+    @Inject\n+    private Event<NotificationEvent> workbenchNotification;\n+\n+    @Inject\n+    DomFactory domFactory;\n+\n+    private DataTransferAssets assetsToExport;\n+\n+    @Override\n+    public HTMLElement getElement() {\n+        return dataTransferExportModalBody;\n+    }\n+\n+    @Override\n+    public void init(DataTransferExportPopUp presenter) {\n+        this.presenter = presenter;\n+        ModalFooter modalFooter = new ModalFooterOKCancelButtons(this::getSelectedAssets,\n+                                                                 () -> modal.hide());\n+        modal = new CommonModalBuilder().addHeader(i18n.dataTransferExportPopUpViewTitle())\n+                                        .addBody(dataTransferExportModalBody)\n+                                        .addFooter(modalFooter)\n+                                        .build();\n+\n+        selectAllPages.onclick = e -> {\n+            allInputsForTable(pagesTable).forEach(chk -> chk.checked = selectAllPages.checked);\n+            return null;\n+        };\n+\n+        selectAllDatasets.onclick = e -> {\n+            allInputsForTable(datasetsTable).forEach(chk -> chk.checked = selectAllDatasets.checked);\n+            return null;\n+        };\n+\n+        searchPages.onkeyup = e -> {\n+            filterTable(searchPages, pagesTable);\n+            return null;\n+        };\n+\n+        searchDatasets.onkeyup = e -> {\n+            filterTable(searchDatasets, datasetsTable);\n+            return null;\n+        };\n+        \n+        elem2Dom.appendWidgetToElement(toggleSwitchContainer, toggleSwitch);\n+        toggleSwitch.setValue(true);\n+\n+    }\n+\n+    @Override\n+    public void show() {\n+        modal.show();\n+        loading();\n+    }\n+\n+    @Override\n+    public void setAssetsToExport(DataTransferAssets assetsToExport) {\n+        this.assetsToExport = assetsToExport;\n+        finishedLoading();\n+    }\n+\n+    private void fillPagesTable() {", "originalCommit": "a74b4a7f646b14ef763d402579c8e86d10cbb7a9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjk1Mjk2MQ==", "url": "https://github.com/kiegroup/appformer/pull/933#discussion_r402952961", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    // TODO Auto-generated method stub", "author": "caponetto", "createdAt": "2020-04-03T11:57:04Z", "path": "dashbuilder/dashbuilder-backend/dashbuilder-services/src/main/java/org/dashbuilder/transfer/DataTransferServicesImpl.java", "diffHunk": "@@ -181,19 +198,39 @@ public FileVisitResult visitFile(Path path, BasicFileAttributes attrs) {\n             }\n         });\n \n-        ioService.deleteIfExists(\n-                root.resolve(expectedPath));\n+        ioService.deleteIfExists(root.resolve(expectedPath));\n \n         return imported;\n     }\n \n-    private List<String> importFiles(Path path) throws Exception  {\n-        String tempPath = new StringBuilder()\n-            .append(System.getProperty(\"java.io.tmpdir\"))\n-            .append(File.separator)\n-            .append(FILE_PATH)\n-            .append(File.separator)\n-            .toString();\n+    @Override\n+    public DataTransferAssets assetsToExport() {\n+        List<String> pages = listPaths(perspectivesFS,\n+                                       p -> p.endsWith(FILE_EXT)).stream()\n+                                                                 .map(p -> p.getName(p.getNameCount() - 2))\n+                                                                 .map(Object::toString)\n+                                                                 .collect(Collectors.toList());\n+\n+        List<DataSetDef> datasetsDefs = listPaths(datasetsFS,\n+                                                  p -> p.endsWith(DATASET_EXT)).stream()\n+                                                                               .map(this::getFileContent)\n+                                                                               .map(this::parseDataSetDefinition)\n+                                                                               .collect(Collectors.toList());\n+        return new DataTransferAssets(datasetsDefs, pages);\n+    }\n+\n+    @Override\n+    public Map<String, String> validateExport(DataTransferExportModel exportsModel) {\n+        // TODO Auto-generated method stub", "originalCommit": "a74b4a7f646b14ef763d402579c8e86d10cbb7a9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjk1MzQ4Nw==", "url": "https://github.com/kiegroup/appformer/pull/933#discussion_r402953487", "bodyText": "Double-checking: is it ok to return null here?", "author": "caponetto", "createdAt": "2020-04-03T11:58:16Z", "path": "dashbuilder/dashbuilder-backend/dashbuilder-services/src/main/java/org/dashbuilder/transfer/DataTransferServicesImpl.java", "diffHunk": "@@ -181,19 +198,39 @@ public FileVisitResult visitFile(Path path, BasicFileAttributes attrs) {\n             }\n         });\n \n-        ioService.deleteIfExists(\n-                root.resolve(expectedPath));\n+        ioService.deleteIfExists(root.resolve(expectedPath));\n \n         return imported;\n     }\n \n-    private List<String> importFiles(Path path) throws Exception  {\n-        String tempPath = new StringBuilder()\n-            .append(System.getProperty(\"java.io.tmpdir\"))\n-            .append(File.separator)\n-            .append(FILE_PATH)\n-            .append(File.separator)\n-            .toString();\n+    @Override\n+    public DataTransferAssets assetsToExport() {\n+        List<String> pages = listPaths(perspectivesFS,\n+                                       p -> p.endsWith(FILE_EXT)).stream()\n+                                                                 .map(p -> p.getName(p.getNameCount() - 2))\n+                                                                 .map(Object::toString)\n+                                                                 .collect(Collectors.toList());\n+\n+        List<DataSetDef> datasetsDefs = listPaths(datasetsFS,\n+                                                  p -> p.endsWith(DATASET_EXT)).stream()\n+                                                                               .map(this::getFileContent)\n+                                                                               .map(this::parseDataSetDefinition)\n+                                                                               .collect(Collectors.toList());\n+        return new DataTransferAssets(datasetsDefs, pages);\n+    }\n+\n+    @Override\n+    public Map<String, String> validateExport(DataTransferExportModel exportsModel) {\n+        // TODO Auto-generated method stub\n+        return null;", "originalCommit": "a74b4a7f646b14ef763d402579c8e86d10cbb7a9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTkzMzYwMA==", "url": "https://github.com/kiegroup/appformer/pull/933#discussion_r409933600", "bodyText": "This method was removed, I would try to send this PR implementing two JIRAs, but it would be too much work for a PR review, but I forgot to remove this method.", "author": "jesuino", "createdAt": "2020-04-17T01:02:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjk1MzQ4Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjk1NTcyNA==", "url": "https://github.com/kiegroup/appformer/pull/933#discussion_r402955724", "bodyText": "Consider extracting System.getProperty(\"java.io.tmpdir\") to a constant.\nI see it being used more than once on this class.", "author": "caponetto", "createdAt": "2020-04-03T12:02:44Z", "path": "dashbuilder/dashbuilder-backend/dashbuilder-services/src/main/java/org/dashbuilder/transfer/DataTransferServicesImpl.java", "diffHunk": "@@ -108,22 +114,37 @@ public DataTransferServicesImpl(\n     }\n \n     @Override\n-    public String doExport() throws java.io.IOException {\n-        String zipLocation = new StringBuilder()\n-            .append(System.getProperty(\"java.io.tmpdir\"))\n-            .append(File.separator)\n-            .append(FILE_PATH)\n-            .append(File.separator)\n-            .append(EXPORT_FILE_NAME)\n-            .toString();\n+    public String doExport(DataTransferExportModel exportModel) throws java.io.IOException {\n+        String zipLocation = new StringBuilder().append(System.getProperty(\"java.io.tmpdir\"))", "originalCommit": "a74b4a7f646b14ef763d402579c8e86d10cbb7a9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjk1Nzk2Ng==", "url": "https://github.com/kiegroup/appformer/pull/933#discussion_r402957966", "bodyText": "Consider using DirectoryStream here.", "author": "caponetto", "createdAt": "2020-04-03T12:06:44Z", "path": "dashbuilder/dashbuilder-backend/dashbuilder-services/src/main/java/org/dashbuilder/transfer/DataTransferServicesImpl.java", "diffHunk": "@@ -384,4 +415,70 @@ private File createVersionFile() throws java.io.IOException {\n \n         return version;\n     }\n+\n+    private List<Path> listPaths(FileSystem fs, Predicate<String> pathTester) {\n+        List<Path> files = new ArrayList<>();\n+        Path root = fs.getRootDirectories().iterator().next();\n+        Files.walkFileTree(root, new SimpleFileVisitor<Path>() {\n+\n+            @Override\n+            public FileVisitResult visitFile(Path path, BasicFileAttributes attrs) {\n+                try {\n+                    if (pathTester.test(path.toString())) {\n+                        files.add(path);\n+                    }\n+                    return FileVisitResult.CONTINUE;\n+\n+                } catch (Exception e) {\n+                    LOGGER.error(e.getMessage(), e);\n+                    return FileVisitResult.TERMINATE;\n+                }\n+            }\n+        });", "originalCommit": "a74b4a7f646b14ef763d402579c8e86d10cbb7a9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTkyNDkyMw==", "url": "https://github.com/kiegroup/appformer/pull/933#discussion_r409924923", "bodyText": "I tried using it, The code was clearer:\n        final Filter<Path> dirTest = p -> {\n            return pathTester.test(p.toString());\n        };\n        try (DirectoryStream<Path> dirStream = Files.newDirectoryStream(root, dirTest)) {\n            dirStream.forEach(files::add);\n        } catch (Exception e) {\n            throw new IllegalArgumentException(\"Error walking directory\", e);\n        }\n\nbut for some reason it was not going through some paths, specifically pages paths (plugin_content) hence it was not correctly helping me to filter the assets I wanted, so I went back to Files.walk", "author": "jesuino", "createdAt": "2020-04-17T00:30:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjk1Nzk2Ng=="}], "type": "inlineReview"}, {"oid": "10be9a94d516455fa2a51da0cff46e83a164d80f", "url": "https://github.com/kiegroup/appformer/commit/10be9a94d516455fa2a51da0cff46e83a164d80f", "message": "Changing from PopUp to Wizard", "committedDate": "2020-04-20T20:25:17Z", "type": "forcePushed"}, {"oid": "d69d8664df26eb75dd81da41958168b149dde09d", "url": "https://github.com/kiegroup/appformer/commit/d69d8664df26eb75dd81da41958168b149dde09d", "message": "Changing from PopUp to Wizard", "committedDate": "2020-04-20T20:45:19Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzc0NDEyNw==", "url": "https://github.com/kiegroup/appformer/pull/933#discussion_r413744127", "bodyText": "I think it won't work for other languages, like Japanese.", "author": "caponetto", "createdAt": "2020-04-23T11:42:05Z", "path": "dashbuilder/dashbuilder-client/dashbuilder-cms-client/src/main/java/org/dashbuilder/client/cms/screen/transfer/export/wizard/ExportSummaryWizardPageView.java", "diffHunk": "@@ -0,0 +1,111 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.dashbuilder.client.cms.screen.transfer.export.wizard;\n+\n+import javax.enterprise.context.ApplicationScoped;\n+import javax.inject.Inject;\n+import javax.inject.Named;\n+\n+import com.google.gwt.event.dom.client.ClickEvent;\n+import elemental2.dom.HTMLAnchorElement;\n+import elemental2.dom.HTMLButtonElement;\n+import elemental2.dom.HTMLDivElement;\n+import elemental2.dom.HTMLElement;\n+import elemental2.dom.HTMLHeadingElement;\n+import org.dashbuilder.transfer.DataTransferExportModel;\n+import org.jboss.errai.ui.shared.api.annotations.DataField;\n+import org.jboss.errai.ui.shared.api.annotations.EventHandler;\n+import org.jboss.errai.ui.shared.api.annotations.Templated;\n+\n+@Templated\n+@ApplicationScoped\n+public class ExportSummaryWizardPageView implements ExportSummaryWizardPage.View {\n+\n+    @Inject\n+    @DataField\n+    HTMLDivElement exportWizardSummary;\n+\n+    @Inject\n+    @DataField\n+    @Named(\"span\")\n+    HTMLElement datasetsInformation;\n+\n+    @Inject\n+    @DataField\n+    @Named(\"span\")\n+    HTMLElement pagesInformation;\n+\n+    @Inject\n+    @DataField\n+    HTMLAnchorElement datasetsInfoAnchor;\n+\n+    @Inject\n+    @DataField\n+    HTMLAnchorElement pagesInfoAnchor;\n+\n+    @Inject\n+    @DataField\n+    HTMLButtonElement downloadExport;\n+    \n+    @Inject\n+    @DataField\n+    @Named(\"h1\")\n+    HTMLHeadingElement exportHeading;\n+    \n+    private ExportSummaryWizardPage presenter;\n+\n+    @Override\n+    public void init(ExportSummaryWizardPage presenter) {\n+        this.presenter = presenter;\n+    }\n+\n+    @Override\n+    public HTMLElement getElement() {\n+        return exportWizardSummary;\n+    }\n+\n+    @EventHandler(\"downloadExport\")\n+    public void downloadAction(ClickEvent click) {\n+        presenter.confirmDownload();\n+    }\n+\n+    @EventHandler(\"datasetsInfoAnchor\")\n+    public void datasetsInfoAnchorClicked(ClickEvent click) {\n+        presenter.goToDataSetsPage();\n+    }\n+\n+    @EventHandler(\"pagesInfoAnchor\")\n+    public void pagesInfoAnchorClicked(ClickEvent click) {\n+        presenter.goToPagesPage();\n+    }\n+\n+    @Override\n+    public void show(DataTransferExportModel dataTransferExportModel) {\n+        pagesInformation.textContent = checkPlural(dataTransferExportModel.getPages().size(), \"page\");\n+        datasetsInformation.textContent = checkPlural(dataTransferExportModel.getDatasetDefinitions().size(),\n+                                                      \"dataset\");\n+    }\n+\n+    private String checkPlural(int size, String text) {\n+        String finalText = size + \" \" + text;\n+        if (size == 1) {\n+            return finalText;\n+        }\n+        return finalText.concat(\"s\");", "originalCommit": "d69d8664df26eb75dd81da41958168b149dde09d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzc0NTQwMg==", "url": "https://github.com/kiegroup/appformer/pull/933#discussion_r413745402", "bodyText": "Consider using i18n for \"page\" and \"dataset\".", "author": "caponetto", "createdAt": "2020-04-23T11:44:24Z", "path": "dashbuilder/dashbuilder-client/dashbuilder-cms-client/src/main/java/org/dashbuilder/client/cms/screen/transfer/export/wizard/ExportSummaryWizardPageView.java", "diffHunk": "@@ -0,0 +1,111 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.dashbuilder.client.cms.screen.transfer.export.wizard;\n+\n+import javax.enterprise.context.ApplicationScoped;\n+import javax.inject.Inject;\n+import javax.inject.Named;\n+\n+import com.google.gwt.event.dom.client.ClickEvent;\n+import elemental2.dom.HTMLAnchorElement;\n+import elemental2.dom.HTMLButtonElement;\n+import elemental2.dom.HTMLDivElement;\n+import elemental2.dom.HTMLElement;\n+import elemental2.dom.HTMLHeadingElement;\n+import org.dashbuilder.transfer.DataTransferExportModel;\n+import org.jboss.errai.ui.shared.api.annotations.DataField;\n+import org.jboss.errai.ui.shared.api.annotations.EventHandler;\n+import org.jboss.errai.ui.shared.api.annotations.Templated;\n+\n+@Templated\n+@ApplicationScoped\n+public class ExportSummaryWizardPageView implements ExportSummaryWizardPage.View {\n+\n+    @Inject\n+    @DataField\n+    HTMLDivElement exportWizardSummary;\n+\n+    @Inject\n+    @DataField\n+    @Named(\"span\")\n+    HTMLElement datasetsInformation;\n+\n+    @Inject\n+    @DataField\n+    @Named(\"span\")\n+    HTMLElement pagesInformation;\n+\n+    @Inject\n+    @DataField\n+    HTMLAnchorElement datasetsInfoAnchor;\n+\n+    @Inject\n+    @DataField\n+    HTMLAnchorElement pagesInfoAnchor;\n+\n+    @Inject\n+    @DataField\n+    HTMLButtonElement downloadExport;\n+    \n+    @Inject\n+    @DataField\n+    @Named(\"h1\")\n+    HTMLHeadingElement exportHeading;\n+    \n+    private ExportSummaryWizardPage presenter;\n+\n+    @Override\n+    public void init(ExportSummaryWizardPage presenter) {\n+        this.presenter = presenter;\n+    }\n+\n+    @Override\n+    public HTMLElement getElement() {\n+        return exportWizardSummary;\n+    }\n+\n+    @EventHandler(\"downloadExport\")\n+    public void downloadAction(ClickEvent click) {\n+        presenter.confirmDownload();\n+    }\n+\n+    @EventHandler(\"datasetsInfoAnchor\")\n+    public void datasetsInfoAnchorClicked(ClickEvent click) {\n+        presenter.goToDataSetsPage();\n+    }\n+\n+    @EventHandler(\"pagesInfoAnchor\")\n+    public void pagesInfoAnchorClicked(ClickEvent click) {\n+        presenter.goToPagesPage();\n+    }\n+\n+    @Override\n+    public void show(DataTransferExportModel dataTransferExportModel) {\n+        pagesInformation.textContent = checkPlural(dataTransferExportModel.getPages().size(), \"page\");\n+        datasetsInformation.textContent = checkPlural(dataTransferExportModel.getDatasetDefinitions().size(),\n+                                                      \"dataset\");", "originalCommit": "d69d8664df26eb75dd81da41958168b149dde09d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzc0OTA5MA==", "url": "https://github.com/kiegroup/appformer/pull/933#discussion_r413749090", "bodyText": "Is it a TODO?", "author": "caponetto", "createdAt": "2020-04-23T11:50:51Z", "path": "dashbuilder/dashbuilder-client/dashbuilder-cms-client/src/main/java/org/dashbuilder/client/cms/screen/transfer/export/wizard/ExportSummaryWizardPage.java", "diffHunk": "@@ -0,0 +1,116 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.dashbuilder.client.cms.screen.transfer.export.wizard;\n+\n+import java.util.function.Supplier;\n+\n+import javax.annotation.PostConstruct;\n+import javax.enterprise.context.ApplicationScoped;\n+import javax.inject.Inject;\n+\n+import com.google.gwt.user.client.ui.Widget;\n+import org.dashbuilder.transfer.DataTransferExportModel;\n+import org.jboss.errai.common.client.ui.ElementWrapperWidget;\n+import org.uberfire.client.callbacks.Callback;\n+import org.uberfire.client.mvp.UberElemental;\n+import org.uberfire.ext.widgets.core.client.wizards.WizardPage;\n+import org.uberfire.mvp.Command;\n+import org.uberfire.mvp.ParameterizedCommand;\n+\n+@ApplicationScoped\n+public class ExportSummaryWizardPage implements WizardPage {\n+\n+    @Inject\n+    View view;\n+\n+    private Supplier<DataTransferExportModel> exportModelSupplier;\n+    private ParameterizedCommand<DataTransferExportModel> dataTransferExportModelCallback;\n+    private DataTransferExportModel dataTransferExportModel;\n+\n+    private Command goToDataSetsCommand = () -> {\n+    };\n+\n+    private Command goToPagesPage = () -> {\n+    };\n+\n+    public interface View extends UberElemental<ExportSummaryWizardPage> {\n+\n+        void show(DataTransferExportModel dataTransferExportModel);\n+\n+    }\n+\n+    @PostConstruct\n+    public void init() {\n+        view.init(this);\n+    }\n+\n+    @Override\n+    public Widget asWidget() {\n+        return ElementWrapperWidget.getWidget(view.getElement());\n+    }\n+\n+    @Override\n+    public String getTitle() {\n+        return \"Export Summary\";\n+    }\n+\n+    @Override\n+    public void isComplete(Callback<Boolean> callback) {\n+        // add validation here when it is ready", "originalCommit": "d69d8664df26eb75dd81da41958168b149dde09d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzc1MDEzNQ==", "url": "https://github.com/kiegroup/appformer/pull/933#discussion_r413750135", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private Command goToPagesPage = () -> {\n          \n          \n            \n                private Command goToPagesCommand = () -> {", "author": "caponetto", "createdAt": "2020-04-23T11:52:33Z", "path": "dashbuilder/dashbuilder-client/dashbuilder-cms-client/src/main/java/org/dashbuilder/client/cms/screen/transfer/export/wizard/ExportSummaryWizardPage.java", "diffHunk": "@@ -0,0 +1,116 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.dashbuilder.client.cms.screen.transfer.export.wizard;\n+\n+import java.util.function.Supplier;\n+\n+import javax.annotation.PostConstruct;\n+import javax.enterprise.context.ApplicationScoped;\n+import javax.inject.Inject;\n+\n+import com.google.gwt.user.client.ui.Widget;\n+import org.dashbuilder.transfer.DataTransferExportModel;\n+import org.jboss.errai.common.client.ui.ElementWrapperWidget;\n+import org.uberfire.client.callbacks.Callback;\n+import org.uberfire.client.mvp.UberElemental;\n+import org.uberfire.ext.widgets.core.client.wizards.WizardPage;\n+import org.uberfire.mvp.Command;\n+import org.uberfire.mvp.ParameterizedCommand;\n+\n+@ApplicationScoped\n+public class ExportSummaryWizardPage implements WizardPage {\n+\n+    @Inject\n+    View view;\n+\n+    private Supplier<DataTransferExportModel> exportModelSupplier;\n+    private ParameterizedCommand<DataTransferExportModel> dataTransferExportModelCallback;\n+    private DataTransferExportModel dataTransferExportModel;\n+\n+    private Command goToDataSetsCommand = () -> {\n+    };\n+\n+    private Command goToPagesPage = () -> {", "originalCommit": "d69d8664df26eb75dd81da41958168b149dde09d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzc1MDkzNA==", "url": "https://github.com/kiegroup/appformer/pull/933#discussion_r413750934", "bodyText": "Consider using i18n for \"Select Datasets\".", "author": "caponetto", "createdAt": "2020-04-23T11:53:50Z", "path": "dashbuilder/dashbuilder-client/dashbuilder-cms-client/src/main/java/org/dashbuilder/client/cms/screen/transfer/export/wizard/DataSetsWizardPage.java", "diffHunk": "@@ -0,0 +1,68 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.dashbuilder.client.cms.screen.transfer.export.wizard;\n+\n+import java.util.List;\n+\n+import javax.enterprise.context.ApplicationScoped;\n+import javax.inject.Inject;\n+\n+import com.google.gwt.user.client.ui.Widget;\n+import org.dashbuilder.client.cms.screen.transfer.export.wizard.widget.DataSetsTable;\n+import org.dashbuilder.dataset.def.DataSetDef;\n+import org.jboss.errai.common.client.ui.ElementWrapperWidget;\n+import org.uberfire.client.callbacks.Callback;\n+import org.uberfire.ext.widgets.core.client.wizards.WizardPage;\n+\n+@ApplicationScoped\n+public class DataSetsWizardPage implements WizardPage {\n+\n+    @Inject\n+    DataSetsTable dataSetsTable;\n+\n+    @Override\n+    public Widget asWidget() {\n+        return ElementWrapperWidget.getWidget(dataSetsTable.getElement());\n+    }\n+\n+    @Override\n+    public String getTitle() {\n+        return \"Select Datasets\";", "originalCommit": "d69d8664df26eb75dd81da41958168b149dde09d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzc1NjMxMQ==", "url": "https://github.com/kiegroup/appformer/pull/933#discussion_r413756311", "bodyText": "Are you using this variable?\nCan it be injected on the constructor just like the others?", "author": "caponetto", "createdAt": "2020-04-23T12:02:29Z", "path": "dashbuilder/dashbuilder-client/dashbuilder-cms-client/src/main/java/org/dashbuilder/client/cms/screen/transfer/DataTransferView.java", "diffHunk": "@@ -55,6 +54,8 @@\n     private Elemental2DomUtil elem2Dom;\n     private Event<NotificationEvent> workbenchNotification;\n     private PathUrlFactory pathUrlFactory;\n+    \n+    @Inject PagesTable pagesTable;", "originalCommit": "d69d8664df26eb75dd81da41958168b149dde09d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzc2MDk3Mg==", "url": "https://github.com/kiegroup/appformer/pull/933#discussion_r413760972", "bodyText": "Consider using i18n for \"Export Wizard\".", "author": "caponetto", "createdAt": "2020-04-23T12:10:04Z", "path": "dashbuilder/dashbuilder-client/dashbuilder-cms-client/src/main/java/org/dashbuilder/client/cms/screen/transfer/export/wizard/ExportWizard.java", "diffHunk": "@@ -0,0 +1,129 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.dashbuilder.client.cms.screen.transfer.export.wizard;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import javax.annotation.PostConstruct;\n+import javax.enterprise.context.ApplicationScoped;\n+import javax.enterprise.event.Event;\n+import javax.enterprise.event.Observes;\n+import javax.inject.Inject;\n+\n+import com.google.gwt.user.client.ui.Widget;\n+import org.dashbuilder.transfer.DataTransferAssets;\n+import org.dashbuilder.transfer.DataTransferExportModel;\n+import org.uberfire.client.callbacks.Callback;\n+import org.uberfire.ext.widgets.core.client.wizards.AbstractWizard;\n+import org.uberfire.ext.widgets.core.client.wizards.WizardPage;\n+import org.uberfire.ext.widgets.core.client.wizards.WizardPageSelectedEvent;\n+import org.uberfire.mvp.ParameterizedCommand;\n+\n+@ApplicationScoped\n+public class ExportWizard extends AbstractWizard {\n+\n+    @Inject\n+    DataSetsWizardPage dataSetsWizardPage;\n+\n+    @Inject\n+    PagesWizardPage pagesWizardPage;\n+\n+    @Inject\n+    ExportSummaryWizardPage exportSummaryWizardPage;\n+\n+    @Inject\n+    Event<WizardPageSelectedEvent> wizardPageSelectedEvent;\n+\n+    private List<WizardPage> wizardPages;\n+\n+    private boolean canConclude;\n+\n+    @PostConstruct\n+    void init() {\n+        wizardPages = new ArrayList<>();\n+        wizardPages.add(dataSetsWizardPage);\n+        wizardPages.add(pagesWizardPage);\n+        wizardPages.add(exportSummaryWizardPage);\n+\n+        exportSummaryWizardPage.setExportSummary(this::getDataTransferExportModel);\n+        exportSummaryWizardPage.setGoToDataSetsCommand(() -> goTo(dataSetsWizardPage));\n+        exportSummaryWizardPage.setGoToPagesCommand(() -> goTo(pagesWizardPage));\n+    }\n+\n+    public void start(DataTransferAssets assets) {\n+        dataSetsWizardPage.setDataSets(assets.getDatasetsDefinitions());\n+        pagesWizardPage.setPages(assets.getPages());\n+\n+        this.start();\n+    }\n+\n+    @Override\n+    public List<WizardPage> getPages() {\n+        return wizardPages;\n+    }\n+\n+    @Override\n+    public Widget getPageWidget(int pageNumber) {\n+        return wizardPages.get(pageNumber).asWidget();\n+    }\n+\n+    @Override\n+    public String getTitle() {\n+        return \"Export Wizard\";", "originalCommit": "d69d8664df26eb75dd81da41958168b149dde09d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzc2Nzk2Mw==", "url": "https://github.com/kiegroup/appformer/pull/933#discussion_r413767963", "bodyText": "Consider using i18n for \"Loading Export Wizard\".", "author": "caponetto", "createdAt": "2020-04-23T12:21:00Z", "path": "dashbuilder/dashbuilder-client/dashbuilder-cms-client/src/main/java/org/dashbuilder/client/cms/screen/transfer/DataTransferScreen.java", "diffHunk": "@@ -70,49 +81,53 @@ public View part() {\n     @PostConstruct\n     public void init() {\n         view.init(this);\n+        exportWizard.setCallback(this::callExportService);\n     }\n \n     public void doExport() {\n-        try {\n-            dataTransferServices.call(\n-                (RemoteCallback<String>) path -> {\n-                    view.exportOK();\n-                    view.download(path);\n-\n-                }, (ErrorCallback<Exception>) (message, throwable) -> {\n-                    view.exportError(throwable);\n-                    return false;\n-\n-                }).doExport();\n+        callExportService(DataTransferExportModel.exportAll());\n+    }\n \n-        } catch (Exception e) {\n-            view.exportError(e);\n-        }\n+    public void doGradualExport() {\n+        busyIndicatorView.showBusyIndicator(\"Loading Export Wizard\");", "originalCommit": "d69d8664df26eb75dd81da41958168b149dde09d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzc3MTIwNw==", "url": "https://github.com/kiegroup/appformer/pull/933#discussion_r413771207", "bodyText": "Could this call take noticeable time? If so, consider using BusyIndicator here as well.", "author": "caponetto", "createdAt": "2020-04-23T12:25:53Z", "path": "dashbuilder/dashbuilder-client/dashbuilder-cms-client/src/main/java/org/dashbuilder/client/cms/screen/transfer/DataTransferScreen.java", "diffHunk": "@@ -127,4 +142,22 @@ public String getExportFileName() {\n     public String getImportFileName() {\n         return DataTransferServices.IMPORT_FILE_NAME;\n     }\n-}\n+\n+    private void callExportService(DataTransferExportModel dataTransferExportModel) {\n+        try {\n+            dataTransferServices.call((RemoteCallback<String>) path -> {", "originalCommit": "d69d8664df26eb75dd81da41958168b149dde09d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "99820b5d5dc802107e6d814671e6632247ea0cf6", "url": "https://github.com/kiegroup/appformer/commit/99820b5d5dc802107e6d814671e6632247ea0cf6", "message": "i18n correctly and minor corrections", "committedDate": "2020-04-24T20:48:44Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzI1NTE2Ng==", "url": "https://github.com/kiegroup/appformer/pull/933#discussion_r417255166", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * Copyright 202 Red Hat, Inc. and/or its affiliates.\n          \n          \n            \n             * Copyright 2020 Red Hat, Inc. and/or its affiliates.", "author": "caponetto", "createdAt": "2020-04-29T11:49:15Z", "path": "dashbuilder/dashbuilder-shared/dashbuilder-services-api/src/main/java/org/dashbuilder/transfer/ExportModelValidationService.java", "diffHunk": "@@ -0,0 +1,38 @@\n+/*\n+ * Copyright 202 Red Hat, Inc. and/or its affiliates.", "originalCommit": "fcf9c5b4296277f31107e6642cc5d30b8db6fe1b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzI1NTMwMA==", "url": "https://github.com/kiegroup/appformer/pull/933#discussion_r417255300", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * Copyright 202 Red Hat, Inc. and/or its affiliates.\n          \n          \n            \n             * Copyright 2020 Red Hat, Inc. and/or its affiliates.", "author": "caponetto", "createdAt": "2020-04-29T11:49:31Z", "path": "dashbuilder/dashbuilder-backend/dashbuilder-services/src/main/java/org/dashbuilder/transfer/ExportModelValidationServiceImpl.java", "diffHunk": "@@ -0,0 +1,87 @@\n+/*\n+ * Copyright 202 Red Hat, Inc. and/or its affiliates.", "originalCommit": "fcf9c5b4296277f31107e6642cc5d30b8db6fe1b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzI1NTg2MQ==", "url": "https://github.com/kiegroup/appformer/pull/933#discussion_r417255861", "bodyText": "Consider adding what's returned.", "author": "caponetto", "createdAt": "2020-04-29T11:50:44Z", "path": "dashbuilder/dashbuilder-shared/dashbuilder-services-api/src/main/java/org/dashbuilder/transfer/ExportModelValidationService.java", "diffHunk": "@@ -0,0 +1,38 @@\n+/*\n+ * Copyright 202 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.dashbuilder.transfer;\n+\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.jboss.errai.bus.server.annotations.Remote;\n+\n+/**\n+ * Perform validations on an ExportModel\n+ *\n+ */\n+@Remote\n+public interface ExportModelValidationService {\n+\n+    /**\n+     * Check if there is datasets not exported for the given export model\n+     * \n+     * @param exportModel\n+     * @return", "originalCommit": "fcf9c5b4296277f31107e6642cc5d30b8db6fe1b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "82d355a81ad264dbe5d6cc86c238cb1fb5916d66", "url": "https://github.com/kiegroup/appformer/commit/82d355a81ad264dbe5d6cc86c238cb1fb5916d66", "message": "Comments minor fixes", "committedDate": "2020-05-04T20:17:35Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDY3OTc4Ng==", "url": "https://github.com/kiegroup/appformer/pull/933#discussion_r420679786", "bodyText": "is the isExportNavigation() still relevant? the navigation is always exported in the custom export", "author": "barboras7", "createdAt": "2020-05-06T10:09:18Z", "path": "dashbuilder/dashbuilder-backend/dashbuilder-services/src/main/java/org/dashbuilder/transfer/DataTransferServicesImpl.java", "diffHunk": "@@ -108,22 +114,37 @@ public DataTransferServicesImpl(\n     }\n \n     @Override\n-    public String doExport() throws java.io.IOException {\n-        String zipLocation = new StringBuilder()\n-            .append(System.getProperty(\"java.io.tmpdir\"))\n-            .append(File.separator)\n-            .append(FILE_PATH)\n-            .append(File.separator)\n-            .append(EXPORT_FILE_NAME)\n-            .toString();\n+    public String doExport(DataTransferExportModel exportModel) throws java.io.IOException {\n+        String zipLocation = new StringBuilder().append(TMP_DIR)\n+                                                .append(File.separator)\n+                                                .append(FILE_PATH)\n+                                                .append(File.separator)\n+                                                .append(EXPORT_FILE_NAME)\n+                                                .toString();\n+\n+        Predicate<Path> readmeFilter = p -> p.toString().toLowerCase().endsWith(\"readme.md\");\n+        Predicate<Path> datasetsFilter = def -> true;\n+        Predicate<Path> pagesFilter = page -> true;\n+        boolean exportNavigation = true;\n+\n+        if (!exportModel.isExportAll()) {\n+            datasetsFilter = filterDatasets(exportModel.getDatasetDefinitions());\n+            pagesFilter = filterPages(exportModel.getPages());\n+            exportNavigation = exportModel.isExportNavigation();", "originalCommit": "b07f076cea68660be763a5d5056e9d928657876a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDkzOTMzNg==", "url": "https://github.com/kiegroup/appformer/pull/933#discussion_r420939336", "bodyText": "I would let it in case we want to allow users to select this option in future. For example, I did create [1] so users could export a single page along its dependencies so they can it on runtime. In that case navigation would not be needed.\n[1] https://issues.redhat.com/browse/AF-2459", "author": "jesuino", "createdAt": "2020-05-06T16:48:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDY3OTc4Ng=="}], "type": "inlineReview"}, {"oid": "65d2327089f0cd11e8d2a192e16d72914b344064", "url": "https://github.com/kiegroup/appformer/commit/65d2327089f0cd11e8d2a192e16d72914b344064", "message": "AF-2456: Support Gradual Export in Data Transfer API", "committedDate": "2020-05-11T13:06:15Z", "type": "commit"}, {"oid": "4a0d3d4c77b671e9acd4c3e6b092bc1a1a5dbb4b", "url": "https://github.com/kiegroup/appformer/commit/4a0d3d4c77b671e9acd4c3e6b092bc1a1a5dbb4b", "message": "Export navigation adjustments", "committedDate": "2020-05-11T13:06:15Z", "type": "commit"}, {"oid": "2bb1e5354d8b2d4249b75e87a0d5e4cb8761a924", "url": "https://github.com/kiegroup/appformer/commit/2bb1e5354d8b2d4249b75e87a0d5e4cb8761a924", "message": "Changing from PopUp to Wizard", "committedDate": "2020-05-11T13:09:23Z", "type": "commit"}, {"oid": "273f310214667b23f4cc2c172072c174f7d0edfc", "url": "https://github.com/kiegroup/appformer/commit/273f310214667b23f4cc2c172072c174f7d0edfc", "message": "i18n correctly and minor corrections", "committedDate": "2020-05-11T13:10:03Z", "type": "commit"}, {"oid": "d863679893a098fd2e06912a33033cc54b1ac273", "url": "https://github.com/kiegroup/appformer/commit/d863679893a098fd2e06912a33033cc54b1ac273", "message": "AF-2458: Validate Exported Dashboards", "committedDate": "2020-05-11T13:10:03Z", "type": "commit"}, {"oid": "61a3f5760e97054e0be085b7a03ac7451dd1841a", "url": "https://github.com/kiegroup/appformer/commit/61a3f5760e97054e0be085b7a03ac7451dd1841a", "message": "Comments minor fixes", "committedDate": "2020-05-11T13:10:04Z", "type": "commit"}, {"oid": "54bf8e0681f81a07315d12d78582583e3c2ab23a", "url": "https://github.com/kiegroup/appformer/commit/54bf8e0681f81a07315d12d78582583e3c2ab23a", "message": "Fix on page select", "committedDate": "2020-05-11T13:10:04Z", "type": "commit"}, {"oid": "f47be2a2c35557d63568897e9899406ec1257cc5", "url": "https://github.com/kiegroup/appformer/commit/f47be2a2c35557d63568897e9899406ec1257cc5", "message": "Removing Warning state and improving export wizard", "committedDate": "2020-05-11T13:10:04Z", "type": "commit"}, {"oid": "9582833a1dd2938ed65dfbcb8cf0ce7f11b6d964", "url": "https://github.com/kiegroup/appformer/commit/9582833a1dd2938ed65dfbcb8cf0ce7f11b6d964", "message": "Avoid validation of null UUID", "committedDate": "2020-05-11T13:10:04Z", "type": "commit"}, {"oid": "83584de59e0e5a2e847d4ee97661fbf3fa8a431d", "url": "https://github.com/kiegroup/appformer/commit/83584de59e0e5a2e847d4ee97661fbf3fa8a431d", "message": "leftovers after rebase", "committedDate": "2020-05-11T17:33:35Z", "type": "commit"}, {"oid": "83584de59e0e5a2e847d4ee97661fbf3fa8a431d", "url": "https://github.com/kiegroup/appformer/commit/83584de59e0e5a2e847d4ee97661fbf3fa8a431d", "message": "leftovers after rebase", "committedDate": "2020-05-11T17:33:35Z", "type": "forcePushed"}, {"oid": "35eeb29f56eb660ce71d6716279860b6ea5c1274", "url": "https://github.com/kiegroup/appformer/commit/35eeb29f56eb660ce71d6716279860b6ea5c1274", "message": "Add data transfer to a Dashbuilder menu", "committedDate": "2020-05-11T17:55:54Z", "type": "commit"}]}