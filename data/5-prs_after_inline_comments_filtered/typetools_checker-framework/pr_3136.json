{"pr_number": 3136, "pr_title": "Call typeProcessingOver even if an error occurred", "pr_createdAt": "2020-03-07T19:47:31Z", "pr_url": "https://github.com/typetools/checker-framework/pull/3136", "timeline": [{"oid": "8ac098e3bf8d14644d3376cd0e40c6a5850c4604", "url": "https://github.com/typetools/checker-framework/commit/8ac098e3bf8d14644d3376cd0e40c6a5850c4604", "message": "Add missing calls to super.typeProcessingOver()", "committedDate": "2020-03-07T18:16:47Z", "type": "commit"}, {"oid": "579567988d7cb4bdb8137be125d6f116cbe751c4", "url": "https://github.com/typetools/checker-framework/commit/579567988d7cb4bdb8137be125d6f116cbe751c4", "message": "Call typeProcessingOver even if an error occurred", "committedDate": "2020-03-07T18:33:13Z", "type": "commit"}, {"oid": "372b7fd0794432068500ef716428153dc1643359", "url": "https://github.com/typetools/checker-framework/commit/372b7fd0794432068500ef716428153dc1643359", "message": "Remove comment that is no longer accurate", "committedDate": "2020-03-07T18:53:14Z", "type": "commit"}, {"oid": "dc119cf3e78f16e516fdb03d2fe787eb442fef91", "url": "https://github.com/typetools/checker-framework/commit/dc119cf3e78f16e516fdb03d2fe787eb442fef91", "message": "Merge ../checker-framework-branch-master into typeProcessingOver-when-errors", "committedDate": "2020-03-10T03:07:33Z", "type": "commit"}, {"oid": "9a4c145da79d35baf58002a173c8476a13a1b740", "url": "https://github.com/typetools/checker-framework/commit/9a4c145da79d35baf58002a173c8476a13a1b740", "message": "Fix typo", "committedDate": "2020-03-10T17:43:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDUwMDQxMg==", "url": "https://github.com/typetools/checker-framework/pull/3136#discussion_r390500412", "bodyText": "What uses do you imagine for the parameter? Instead of nothing, this passes just the success/failure bit. Why not the number of errors or the error messages themselves?\nOnly two of the checkers actually do something with the boolean. As an alternative, those two checkers could create a Log instance and look at the number of errors themselves.\nSo if you don't have a larger plan for this parameter, just changing those two checkers would be a smaller change.", "author": "wmdietl", "createdAt": "2020-03-10T17:49:52Z", "path": "javacutil/src/main/java/org/checkerframework/javacutil/AbstractTypeProcessor.java", "diffHunk": "@@ -139,10 +139,10 @@ public void typeProcessingStart() {}\n      * <p>Subclasses may override this method to do any aggregate analysis (e.g. generate report,\n      * persistence) or resource deallocation.\n      *\n-     * <p>If an error (a Java error or a processor error) is reported, this method is not guaranteed\n-     * to be invoked.\n+     * @param hasError true if compilation issued an error, either from the Java compiler or from a\n+     *     pluggable type-checker\n      */\n-    public void typeProcessingOver() {}\n+    public void typeProcessingOver(boolean hasError) {}", "originalCommit": "9a4c145da79d35baf58002a173c8476a13a1b740", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDUyNDI4Ng==", "url": "https://github.com/typetools/checker-framework/pull/3136#discussion_r390524286", "bodyText": "This is preparatory to #3137.  I separated it so that it was two smaller pull requests each with one topic.  This is what #3137 needs.  A future pull request could do more, like your suggestion.", "author": "mernst", "createdAt": "2020-03-10T18:28:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDUwMDQxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDUyNTAyNw==", "url": "https://github.com/typetools/checker-framework/pull/3136#discussion_r390525027", "bodyText": "Or, you could just review #3137 instead of this one.", "author": "mernst", "createdAt": "2020-03-10T18:29:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDUwMDQxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDU3NjAxNA==", "url": "https://github.com/typetools/checker-framework/pull/3136#discussion_r390576014", "bodyText": "How does #3137 need this? The implementation in SourceChecker there is:\n    public void typeProcessingOver(boolean hasError) {\n        writeJsonDiagnostics();\n        super.typeProcessingOver(hasError);\n    }\nSo we could remove the boolean parameter, change the logic to always call typeProcessingOver, and change the two checkers that depend on success/failure to use the Log to do that.", "author": "wmdietl", "createdAt": "2020-03-10T20:00:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDUwMDQxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDY2MDEyOA==", "url": "https://github.com/typetools/checker-framework/pull/3136#discussion_r390660128", "bodyText": "#3137 depends on typeProcessingOver being called even if an error occurred (which is the topic of this pull request).  #3137 does not depend on the hasError boolean, though this pull request does depend on the hasError boolean.  Sorry if that was unclear.\nI count three checkers that use the boolean, not two:  AnnotationStatistics, CFGProcessor, and JavaCodeStatistics.\nThe boolean helps them preserve behavior, and is all they need.  I don't think it is simpler to make most clients create a log that they don't need, and I don't want this pull request to change their behavior.\nIf there is a need for the log in the future, then we should change the functionality, but it doesn't seem desirable to me right now.", "author": "mernst", "createdAt": "2020-03-10T23:02:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDUwMDQxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTI5MjA2Ng==", "url": "https://github.com/typetools/checker-framework/pull/3136#discussion_r391292066", "bodyText": "I've made some changes in #3158. Please see whether you like them. I find it nicer without the boolean.\nA few javadoc issues probably still need to be sorted out.", "author": "wmdietl", "createdAt": "2020-03-11T21:59:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDUwMDQxMg=="}], "type": "inlineReview"}, {"oid": "b5244ae8b9b12ccc8633abe2dbd015ee09e1bd4d", "url": "https://github.com/typetools/checker-framework/commit/b5244ae8b9b12ccc8633abe2dbd015ee09e1bd4d", "message": "Merge ../checker-framework-branch-master into typeProcessingOver-when-errors", "committedDate": "2020-03-12T13:07:42Z", "type": "commit"}, {"oid": "c938512befbb46585430ef2039fb665f7f032d72", "url": "https://github.com/typetools/checker-framework/commit/c938512befbb46585430ef2039fb665f7f032d72", "message": "Use log instead of passing boolean", "committedDate": "2020-03-12T13:21:19Z", "type": "commit"}, {"oid": "723987cdaedc432418d3403eb99986d2e52b4f86", "url": "https://github.com/typetools/checker-framework/commit/723987cdaedc432418d3403eb99986d2e52b4f86", "message": "Merge ../checker-framework-branch-master into typeProcessingOver-when-errors", "committedDate": "2020-03-12T13:48:52Z", "type": "commit"}, {"oid": "5615db9090074b2e24b2bc5548e26cef5bb387b4", "url": "https://github.com/typetools/checker-framework/commit/5615db9090074b2e24b2bc5548e26cef5bb387b4", "message": "Add import statement", "committedDate": "2020-03-12T14:17:29Z", "type": "commit"}, {"oid": "c27c923c0a262fd1861a4c48af5d79eb9cf64deb", "url": "https://github.com/typetools/checker-framework/commit/c27c923c0a262fd1861a4c48af5d79eb9cf64deb", "message": "Remove old hasError parameter.", "committedDate": "2020-03-12T14:59:31Z", "type": "commit"}, {"oid": "31d9b84e17e4d730f892873e9d8cf6258fd1857a", "url": "https://github.com/typetools/checker-framework/commit/31d9b84e17e4d730f892873e9d8cf6258fd1857a", "message": "Update javadoc.", "committedDate": "2020-03-12T15:05:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTY4NzY1Ng==", "url": "https://github.com/typetools/checker-framework/pull/3136#discussion_r391687656", "bodyText": "This change should be in a separate PR.", "author": "wmdietl", "createdAt": "2020-03-12T15:08:37Z", "path": "dataflow/src/main/java/org/checkerframework/dataflow/cfg/CFGProcessor.java", "diffHunk": "@@ -35,8 +37,8 @@\n     /** Tree node for the specified method. */\n     private @Nullable MethodTree methodTree;\n \n-    /** Result of CFG process. */\n-    private @Nullable CFGProcessResult result;\n+    /** Result of CFG process; is set by {@link #typeProcessingOver}. */\n+    private @MonotonicNonNull CFGProcessResult result = null;", "originalCommit": "31d9b84e17e4d730f892873e9d8cf6258fd1857a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "a1fe8fa627de4770bbcb3bd3098e7902ae79cb8c", "url": "https://github.com/typetools/checker-framework/commit/a1fe8fa627de4770bbcb3bd3098e7902ae79cb8c", "message": "Merge ../checker-framework-branch-master into typeProcessingOver-when-errors", "committedDate": "2020-03-12T17:54:48Z", "type": "commit"}, {"oid": "99efa2cd1d3aa49300a61a29c42937229c3cbb23", "url": "https://github.com/typetools/checker-framework/commit/99efa2cd1d3aa49300a61a29c42937229c3cbb23", "message": "Merge branch 'typeProcessingOver-when-errors' of github.com:mernst/checker-framework into typeProcessingOver-when-errors", "committedDate": "2020-03-12T17:54:59Z", "type": "commit"}, {"oid": "632e9b61997352b09931af2ae68c8b4ba958d81c", "url": "https://github.com/typetools/checker-framework/commit/632e9b61997352b09931af2ae68c8b4ba958d81c", "message": "Add side-effect specification", "committedDate": "2020-03-12T18:58:33Z", "type": "commit"}]}