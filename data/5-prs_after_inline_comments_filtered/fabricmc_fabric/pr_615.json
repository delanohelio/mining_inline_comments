{"pr_number": 615, "pr_title": "migrate to fabric-keybindings-v1 and remove builder", "pr_createdAt": "2020-05-10T14:11:05Z", "pr_url": "https://github.com/FabricMC/fabric/pull/615", "timeline": [{"oid": "ac049955ee759de2878f17d4ffe6e6efe39e87c7", "url": "https://github.com/FabricMC/fabric/commit/ac049955ee759de2878f17d4ffe6e6efe39e87c7", "message": "Edited Clone of #244\n- Fixed checkstyle issues\n- Migrated to fabric-keybindings-v1\n- Removed sticky keybindings from #244 as it sounds useless and you can just around it by simply adding that functionality yourself, I might add it back if someone can tell me the advantages of sticky keys except bloat\n- Added a test mod\n- Added FabricKeyBinding#getBoundKeyOf for getting vanilla bound keys with ease\n- Renamed `registered` to `automaticallyRegister` as that is more of a better name\n- Added a couple Objects.requireNonNull validations", "committedDate": "2020-05-10T14:07:52Z", "type": "commit"}, {"oid": "2708863a9199ff14fa7afc0855f645097c87b63a", "url": "https://github.com/FabricMC/fabric/commit/2708863a9199ff14fa7afc0855f645097c87b63a", "message": "Add back StickyFabricKeyBinding as it is in vanilla, did not notice.", "committedDate": "2020-05-10T14:20:33Z", "type": "commit"}, {"oid": "2708863a9199ff14fa7afc0855f645097c87b63a", "url": "https://github.com/FabricMC/fabric/commit/2708863a9199ff14fa7afc0855f645097c87b63a", "message": "Add back StickyFabricKeyBinding as it is in vanilla, did not notice.", "committedDate": "2020-05-10T14:20:33Z", "type": "forcePushed"}, {"oid": "ba96129d19b92f64d76e973bc057a5736b73e32e", "url": "https://github.com/FabricMC/fabric/commit/ba96129d19b92f64d76e973bc057a5736b73e32e", "message": "Remove extra \"key.\"", "committedDate": "2020-05-10T14:23:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjY3MzE0Mg==", "url": "https://github.com/FabricMC/fabric/pull/615#discussion_r422673142", "bodyText": "Hmm, maybe instead of this, we have a build and a buildAndRegister method", "author": "i509VCB", "createdAt": "2020-05-10T17:16:47Z", "path": "fabric-keybindings-v1/src/main/java/net/fabricmc/fabric/api/client/keybinding/v1/FabricKeyBinding.java", "diffHunk": "@@ -0,0 +1,219 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.api.client.keybinding.v1;\n+\n+import java.util.Objects;\n+import java.util.function.BooleanSupplier;\n+\n+import com.google.common.base.Preconditions;\n+\n+import net.minecraft.client.options.KeyBinding;\n+import net.minecraft.client.util.InputUtil;\n+import net.minecraft.util.Identifier;\n+\n+import net.fabricmc.fabric.impl.client.keybinding.StickyFabricKeyBinding;\n+import net.fabricmc.fabric.mixin.client.keybinding.KeyCodeAccessor;\n+\n+/**\n+ * Expanded version of {@link KeyBinding} for use by Fabric mods.\n+ *\n+ * <p>*ALL* instantiated FabricKeyBindings should be registered in\n+ * {@link KeyBindingRegistry#register(FabricKeyBinding)}!\n+ * </p>\n+ *\n+ * <pre><code>\n+ * FabricKeyBinding.Builder builder = FabricKeyBinding.builder();\n+ * FabricKeyBinding left = builder\n+ * \t\t\t.id(new Identifier(\"example\", \"left\"))\n+ * \t\t\t.code(Keys.Left)\n+ * \t\t\t.build();\n+ * FabricKeyBinding right = builder\n+ * \t\t\t.id(new Identifier(\"example\", \"right\"))\n+ * \t\t\t.code(Keys.Right)\n+ * \t\t\t.build();\n+ * KeyBindingRegistry.register(left);\n+ * KeyBindingRegistry.register(right);\n+ * </code></pre>\n+ */\n+public class FabricKeyBinding extends KeyBinding {\n+\tprivate final Identifier id;\n+\n+\tprotected FabricKeyBinding(Identifier id, String translationKey, InputUtil.Type type, int code, String category) {\n+\t\tsuper(translationKey, type, code, category);\n+\t\tthis.id = id;\n+\t}\n+\n+\t/**\n+\t * Original identifier used to register this key.\n+\t *\n+\t * <p>May be different from the {@link #getId()}.</p>\n+\t */\n+\tpublic Identifier getIdentifier() {\n+\t\treturn id;\n+\t}\n+\n+\t/**\n+\t * Creates a new builder for constructing custom key bindings.\n+\t */\n+\tpublic static Builder builder() {\n+\t\treturn new Builder();\n+\t}\n+\n+\t/**\n+\t * Returns the configured KeyCode assigned to the KeyBinding from the player's settings.\n+\t *\n+\t * @return configured KeyCode\n+\t */\n+\tpublic InputUtil.KeyCode getBoundKey() {\n+\t\treturn getBoundKeyOf(this);\n+\t}\n+\n+\t/**\n+\t * Returns the configured KeyCode assigned to the KeyBinding from the player's settings.\n+\t *\n+\t * @param keyBinding the keybinding\n+\t * @return configured KeyCode\n+\t */\n+\tpublic static InputUtil.KeyCode getBoundKeyOf(KeyBinding keyBinding) {\n+\t\treturn ((KeyCodeAccessor) keyBinding).getKeyCode();\n+\t}\n+\n+\tpublic static class Builder {\n+\t\tprivate static final int UNASSIGNED = InputUtil.UNKNOWN_KEYCODE.getKeyCode();\n+\n+\t\tprivate InputUtil.Type type = InputUtil.Type.KEYSYM;\n+\t\tprivate Identifier id = null;\n+\t\tprivate String translationKey;\n+\t\tprivate boolean unassigned = false;\n+\t\tprivate boolean automaticallyRegister = false;\n+\t\tprivate BooleanSupplier toggleFlagSupplier = null;\n+\t\tprivate int code = UNASSIGNED;\n+\t\tprivate String category = KeyCategories.MISC;\n+\n+\t\tprivate Builder() {\n+\t\t}\n+\n+\t\t/**\n+\t\t * Sets the key binding id and translation key for this builder.\n+\t\t * <br>\n+\t\t * Key bindings will be assigned a translation key of the format \"key.{namespace}.{path}\"\n+\t\t *\n+\t\t * @param id Unique identifier for the bound key.\n+\t\t */\n+\t\tpublic Builder id(Identifier id) {\n+\t\t\tthis.id = Objects.requireNonNull(id, \"Keybinding's id can not be null!\");\n+\t\t\tthis.translationKey = String.format(\"key.%s.%s\", id.getNamespace(), id.getPath());\n+\t\t\treturn this;\n+\t\t}\n+\n+\t\t/**\n+\t\t * Sets the translation key for the key's category. {@link KeyCategories} for\n+\t\t * all possible values, vanilla values.\n+\t\t *\n+\t\t * @param category The category under which key bindings created by this builder will be grouped.\n+\t\t */\n+\t\tpublic Builder category(String category) {\n+\t\t\tthis.category = Objects.requireNonNull(category, \"Keybinding's category can not be null!\");\n+\t\t\treturn this;\n+\t\t}\n+\n+\t\t/**\n+\t\t * Sets the default key to be used for the key binding created using this builder.\n+\t\t *\n+\t\t * @param keyCode The default key code. Must be a valid key. May not be -1.\n+\t\t */\n+\t\tpublic Builder code(int keyCode) {\n+\t\t\tPreconditions.checkState(keyCode != UNASSIGNED, \"UNASSIGNED is not a valid key code.\");\n+\t\t\tthis.code = keyCode;\n+\t\t\tthis.unassigned = false;\n+\t\t\treturn this;\n+\t\t}\n+\n+\t\t/**\n+\t\t * Indicates to this builder that keybindings built through it are intended to be unbound.\n+\t\t */\n+\t\tpublic Builder unassigned() {\n+\t\t\tthis.code = UNASSIGNED;\n+\t\t\tthis.unassigned = true;\n+\t\t\treturn this;\n+\t\t}\n+\n+\t\t/**\n+\t\t * Sets this builder to create sticky keybindings that will toggle their state when pressed.\n+\t\t */\n+\t\tpublic Builder sticky() {\n+\t\t\treturn sticky(() -> true);\n+\t\t}\n+\n+\t\t/**\n+\t\t * Sets a sticking action to be used by the constructed key binding which can be used to switch between\n+\t\t * a sticky (toggle) and a regular key binding.\n+\t\t *\n+\t\t * @param toggleFlagSupplier A getter function to determine whether to toggle or not. True for toggling behaviour, false otherwise.\n+\t\t */\n+\t\tpublic Builder sticky(BooleanSupplier toggleFlagSupplier) {\n+\t\t\tthis.toggleFlagSupplier = toggleFlagSupplier;\n+\t\t\treturn this;\n+\t\t}\n+\n+\t\t/**\n+\t\t * Sets this builder to auto-register any key bindings created using it.\n+\t\t *\n+\t\t * <p>Mods who intend to register their own key bindings manually may choose not to use this.</p>\n+\t\t */\n+\t\tpublic Builder automaticallyRegister() {", "originalCommit": "ba96129d19b92f64d76e973bc057a5736b73e32e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjY4MjUzNw==", "url": "https://github.com/FabricMC/fabric/pull/615#discussion_r422682537", "bodyText": "I would do build().register() if that's nice", "author": "shedaniel", "createdAt": "2020-05-10T18:37:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjY3MzE0Mg=="}], "type": "inlineReview"}, {"oid": "c27abb4c19b93a20b7ee676cc9505ad300e040cf", "url": "https://github.com/FabricMC/fabric/commit/c27abb4c19b93a20b7ee676cc9505ad300e040cf", "message": "Bump to 1.0.0", "committedDate": "2020-05-11T01:12:24Z", "type": "commit"}, {"oid": "0500ee7f13bb3800b13dbd23c2559c7d3a3c9ae1", "url": "https://github.com/FabricMC/fabric/commit/0500ee7f13bb3800b13dbd23c2559c7d3a3c9ae1", "message": "build().register()", "committedDate": "2020-05-11T01:15:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI4NTAxNA==", "url": "https://github.com/FabricMC/fabric/pull/615#discussion_r423285014", "bodyText": "Can probably remove this override?", "author": "liach", "createdAt": "2020-05-11T20:00:36Z", "path": "fabric-keybindings-v0/src/main/java/net/fabricmc/fabric/api/client/keybinding/FabricKeyBinding.java", "diffHunk": "@@ -20,27 +20,31 @@\n import net.minecraft.client.util.InputUtil;\n import net.minecraft.util.Identifier;\n \n-import net.fabricmc.fabric.mixin.client.keybinding.KeyCodeAccessor;\n-\n /**\n  * Expanded version of {@link KeyBinding} for use by Fabric mods.\n  *\n  * <p>*ALL* instantiated FabricKeyBindings should be registered in\n- * {@link KeyBindingRegistry#register(FabricKeyBinding)}!\n+ * {@link KeyBindingRegistry#register(FabricKeyBinding)}!</p>\n+ *\n+ * @deprecated Please migrate to v1. Please use {@link net.fabricmc.fabric.api.client.keybinding.v1.FabricKeyBinding} instead.\n  */\n-public class FabricKeyBinding extends KeyBinding {\n+@Deprecated\n+public class FabricKeyBinding extends net.fabricmc.fabric.api.client.keybinding.v1.FabricKeyBinding {\n \tprotected FabricKeyBinding(Identifier id, InputUtil.Type type, int code, String category) {\n-\t\tsuper(\"key.\" + id.toString().replace(':', '.'), type, code, category);\n+\t\tsuper(id, String.format(\"key.%s.%s\", id.getNamespace(), id.getPath()), type, code, category);\n \t}\n \n \t/**\n \t * Returns the configured KeyCode assigned to the KeyBinding from the player's settings.\n+\t *\n \t * @return configured KeyCode\n \t */\n+\t@Override\n \tpublic InputUtil.KeyCode getBoundKey() {\n-\t\treturn ((KeyCodeAccessor) this).getKeyCode();\n+\t\treturn super.getBoundKey();", "originalCommit": "0500ee7f13bb3800b13dbd23c2559c7d3a3c9ae1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI5MDE1OQ==", "url": "https://github.com/FabricMC/fabric/pull/615#discussion_r423290159", "bodyText": "will it preserve backwards compatibility if I do this? (I am not sure so I did this)", "author": "shedaniel", "createdAt": "2020-05-11T20:10:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI4NTAxNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI5MDg3Mg==", "url": "https://github.com/FabricMC/fabric/pull/615#discussion_r423290872", "bodyText": "Make the v0 use a delegate class internally like how I did FabricBlockSettings v1", "author": "i509VCB", "createdAt": "2020-05-11T20:12:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI4NTAxNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI5MTg0NA==", "url": "https://github.com/FabricMC/fabric/pull/615#discussion_r423291844", "bodyText": "but the v0 one extends Keybinding anyways", "author": "shedaniel", "createdAt": "2020-05-11T20:13:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI4NTAxNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI5MzUzOQ==", "url": "https://github.com/FabricMC/fabric/pull/615#discussion_r423293539", "bodyText": "It should preserve backward compatibility... the call to old keybinding's getBoundKey should be invokevirtual in existing bytecode\nHmm, I guess we can give the new method a new name like getDefaultCode instead", "author": "liach", "createdAt": "2020-05-11T20:17:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI4NTAxNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzMwNDQyMw==", "url": "https://github.com/FabricMC/fabric/pull/615#discussion_r423304423", "bodyText": "is not the default code, it returns the current code, bound key is the best name for this imo", "author": "shedaniel", "createdAt": "2020-05-11T20:37:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI4NTAxNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI4NTI5MQ==", "url": "https://github.com/FabricMC/fabric/pull/615#discussion_r423285291", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \tpublic Identifier getIdentifier() {\n          \n          \n            \n            \tpublic Identifier getId() {", "author": "liach", "createdAt": "2020-05-11T20:01:05Z", "path": "fabric-keybindings-v1/src/main/java/net/fabricmc/fabric/api/client/keybinding/v1/FabricKeyBinding.java", "diffHunk": "@@ -0,0 +1,214 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.api.client.keybinding.v1;\n+\n+import java.util.Objects;\n+import java.util.function.BooleanSupplier;\n+\n+import com.google.common.base.Preconditions;\n+\n+import net.minecraft.client.options.KeyBinding;\n+import net.minecraft.client.util.InputUtil;\n+import net.minecraft.util.Identifier;\n+\n+import net.fabricmc.fabric.impl.client.keybinding.StickyFabricKeyBinding;\n+import net.fabricmc.fabric.mixin.client.keybinding.KeyCodeAccessor;\n+\n+/**\n+ * Expanded version of {@link KeyBinding} for use by Fabric mods.\n+ *\n+ * <p>*ALL* instantiated FabricKeyBindings should be registered in\n+ * {@link KeyBindingRegistry#register(FabricKeyBinding)}!\n+ * </p>\n+ *\n+ * <pre><code>\n+ * FabricKeyBinding.Builder builder = FabricKeyBinding.builder();\n+ * FabricKeyBinding left = builder\n+ * \t\t\t.id(new Identifier(\"example\", \"left\"))\n+ * \t\t\t.code(Keys.Left)\n+ * \t\t\t.build();\n+ * FabricKeyBinding right = builder\n+ * \t\t\t.id(new Identifier(\"example\", \"right\"))\n+ * \t\t\t.code(Keys.Right)\n+ * \t\t\t.build();\n+ * KeyBindingRegistry.register(left);\n+ * KeyBindingRegistry.register(right);\n+ * </code></pre>\n+ */\n+public class FabricKeyBinding extends KeyBinding {\n+\tprivate final Identifier id;\n+\n+\tprotected FabricKeyBinding(Identifier id, String translationKey, InputUtil.Type type, int code, String category) {\n+\t\tsuper(translationKey, type, code, category);\n+\t\tthis.id = id;\n+\t}\n+\n+\t/**\n+\t * Original identifier used to register this key.\n+\t *\n+\t * <p>May be different from the {@link #getId()}.</p>\n+\t */\n+\tpublic Identifier getIdentifier() {", "originalCommit": "0500ee7f13bb3800b13dbd23c2559c7d3a3c9ae1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI4ODQzOQ==", "url": "https://github.com/FabricMC/fabric/pull/615#discussion_r423288439", "bodyText": "May be different from the {@link #getId()}.\n\nThere already seems to be one.", "author": "Juuxel", "createdAt": "2020-05-11T20:07:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI4NTI5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI5MjYzNA==", "url": "https://github.com/FabricMC/fabric/pull/615#discussion_r423292634", "bodyText": "Hmm, then need to fix that in yarn probably. In api that thing is called translationKey, which should be right if it starts with key.\nhttps://maven.fabricmc.net/docs/yarn-20w19a+build.1/net/minecraft/client/options/KeyBinding.html#KeyBinding-java.lang.String-net.minecraft.client.util.InputUtil.Type-int-java.lang.String-", "author": "liach", "createdAt": "2020-05-11T20:15:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI4NTI5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTAyNDg5Mg==", "url": "https://github.com/FabricMC/fabric/pull/615#discussion_r429024892", "bodyText": "I'll keep this because this PR is for 1.15", "author": "shedaniel", "createdAt": "2020-05-22T03:31:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI4NTI5MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI4NjAwOQ==", "url": "https://github.com/FabricMC/fabric/pull/615#discussion_r423286009", "bodyText": "I personally disagree with the addition of this method. Imo error-prone and violating oop design.", "author": "liach", "createdAt": "2020-05-11T20:02:36Z", "path": "fabric-keybindings-v1/src/main/java/net/fabricmc/fabric/api/client/keybinding/v1/FabricKeyBinding.java", "diffHunk": "@@ -0,0 +1,214 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.api.client.keybinding.v1;\n+\n+import java.util.Objects;\n+import java.util.function.BooleanSupplier;\n+\n+import com.google.common.base.Preconditions;\n+\n+import net.minecraft.client.options.KeyBinding;\n+import net.minecraft.client.util.InputUtil;\n+import net.minecraft.util.Identifier;\n+\n+import net.fabricmc.fabric.impl.client.keybinding.StickyFabricKeyBinding;\n+import net.fabricmc.fabric.mixin.client.keybinding.KeyCodeAccessor;\n+\n+/**\n+ * Expanded version of {@link KeyBinding} for use by Fabric mods.\n+ *\n+ * <p>*ALL* instantiated FabricKeyBindings should be registered in\n+ * {@link KeyBindingRegistry#register(FabricKeyBinding)}!\n+ * </p>\n+ *\n+ * <pre><code>\n+ * FabricKeyBinding.Builder builder = FabricKeyBinding.builder();\n+ * FabricKeyBinding left = builder\n+ * \t\t\t.id(new Identifier(\"example\", \"left\"))\n+ * \t\t\t.code(Keys.Left)\n+ * \t\t\t.build();\n+ * FabricKeyBinding right = builder\n+ * \t\t\t.id(new Identifier(\"example\", \"right\"))\n+ * \t\t\t.code(Keys.Right)\n+ * \t\t\t.build();\n+ * KeyBindingRegistry.register(left);\n+ * KeyBindingRegistry.register(right);\n+ * </code></pre>\n+ */\n+public class FabricKeyBinding extends KeyBinding {\n+\tprivate final Identifier id;\n+\n+\tprotected FabricKeyBinding(Identifier id, String translationKey, InputUtil.Type type, int code, String category) {\n+\t\tsuper(translationKey, type, code, category);\n+\t\tthis.id = id;\n+\t}\n+\n+\t/**\n+\t * Original identifier used to register this key.\n+\t *\n+\t * <p>May be different from the {@link #getId()}.</p>\n+\t */\n+\tpublic Identifier getIdentifier() {\n+\t\treturn id;\n+\t}\n+\n+\t/**\n+\t * Registers the keybinding with {@link KeyBindingRegistry#register(FabricKeyBinding)}.\n+\t *\n+\t * @return self\n+\t */\n+\tpublic <T extends FabricKeyBinding> T register() {\n+\t\tKeyBindingRegistry.INSTANCE.register(this);\n+\t\treturn (T) this;", "originalCommit": "0500ee7f13bb3800b13dbd23c2559c7d3a3c9ae1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzYxNDk5Nw==", "url": "https://github.com/FabricMC/fabric/pull/615#discussion_r423614997", "bodyText": "@shedaniel the other two points are rejected but this you need to explain or change. Imo this is dangerous as it allows random error-prone casts, just ask users call KeybindingRegistry.INSTANCE.register on their own", "author": "liach", "createdAt": "2020-05-12T10:02:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI4NjAwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzYxNjUxOQ==", "url": "https://github.com/FabricMC/fabric/pull/615#discussion_r423616519", "bodyText": "will do.", "author": "shedaniel", "createdAt": "2020-05-12T10:05:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI4NjAwOQ=="}], "type": "inlineReview"}, {"oid": "8abe49276d8eb9db0bdea489a698e0f45e8bee0e", "url": "https://github.com/FabricMC/fabric/commit/8abe49276d8eb9db0bdea489a698e0f45e8bee0e", "message": "Remove `register()`\n\nSigned-off-by: shedaniel <daniel@shedaniel.me>", "committedDate": "2020-05-12T10:26:49Z", "type": "commit"}, {"oid": "0f7f80b043845aa1eba7bb3bc758fce7cd27af96", "url": "https://github.com/FabricMC/fabric/commit/0f7f80b043845aa1eba7bb3bc758fce7cd27af96", "message": "Fix test\n\nSigned-off-by: shedaniel <daniel@shedaniel.me>", "committedDate": "2020-05-12T10:44:47Z", "type": "commit"}, {"oid": "ea69a720b23f43ff81916f5457e03d318b480ca2", "url": "https://github.com/FabricMC/fabric/commit/ea69a720b23f43ff81916f5457e03d318b480ca2", "message": "Rename module\n\nSigned-off-by: shedaniel <daniel@shedaniel.me>", "committedDate": "2020-05-13T01:40:09Z", "type": "commit"}, {"oid": "cacfb980e96ad4cdf31d74cbe6882dc9a28753b4", "url": "https://github.com/FabricMC/fabric/commit/cacfb980e96ad4cdf31d74cbe6882dc9a28753b4", "message": "Fix checkstyle violation\n\nSigned-off-by: shedaniel <daniel@shedaniel.me>", "committedDate": "2020-05-13T01:45:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTAzODE2OA==", "url": "https://github.com/FabricMC/fabric/pull/615#discussion_r429038168", "bodyText": "Is there a specific reason to reuse the builder instance? It may be nicer to supply the required parameter (id) on creation, it is only one after all and recreating the builder doesn't look too bad to me.", "author": "sfPlayer1", "createdAt": "2020-05-22T04:36:31Z", "path": "fabric-key-binding-api-v1/src/main/java/net/fabricmc/fabric/api/client/keybinding/v1/FabricKeyBinding.java", "diffHunk": "@@ -0,0 +1,204 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.api.client.keybinding.v1;\n+\n+import java.util.Objects;\n+import java.util.function.BooleanSupplier;\n+\n+import com.google.common.base.Preconditions;\n+\n+import net.minecraft.client.options.KeyBinding;\n+import net.minecraft.client.util.InputUtil;\n+import net.minecraft.util.Identifier;\n+\n+import net.fabricmc.fabric.impl.client.keybinding.StickyFabricKeyBinding;\n+import net.fabricmc.fabric.mixin.client.keybinding.KeyCodeAccessor;\n+\n+/**\n+ * Expanded version of {@link KeyBinding} for use by Fabric mods.\n+ *\n+ * <p>*ALL* instantiated FabricKeyBindings should be registered in\n+ * {@link KeyBindingRegistry#register(FabricKeyBinding)}!\n+ * </p>\n+ *\n+ * <pre><code>\n+ * FabricKeyBinding.Builder builder = FabricKeyBinding.builder();\n+ * FabricKeyBinding left = builder\n+ * \t\t\t.id(new Identifier(\"example\", \"left\"))\n+ * \t\t\t.code(Keys.Left)\n+ * \t\t\t.build();\n+ * FabricKeyBinding right = builder\n+ * \t\t\t.id(new Identifier(\"example\", \"right\"))\n+ * \t\t\t.code(Keys.Right)\n+ * \t\t\t.build();", "originalCommit": "cacfb980e96ad4cdf31d74cbe6882dc9a28753b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTA1MjMwNg==", "url": "https://github.com/FabricMC/fabric/pull/615#discussion_r429052306", "bodyText": "you shouldn't reuse the builder instance, will update this example", "author": "shedaniel", "createdAt": "2020-05-22T05:40:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTAzODE2OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTAzODI2Ng==", "url": "https://github.com/FabricMC/fabric/pull/615#discussion_r429038266", "bodyText": "final?", "author": "sfPlayer1", "createdAt": "2020-05-22T04:37:02Z", "path": "fabric-key-binding-api-v1/src/main/java/net/fabricmc/fabric/api/client/keybinding/v1/FabricKeyBinding.java", "diffHunk": "@@ -0,0 +1,204 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.api.client.keybinding.v1;\n+\n+import java.util.Objects;\n+import java.util.function.BooleanSupplier;\n+\n+import com.google.common.base.Preconditions;\n+\n+import net.minecraft.client.options.KeyBinding;\n+import net.minecraft.client.util.InputUtil;\n+import net.minecraft.util.Identifier;\n+\n+import net.fabricmc.fabric.impl.client.keybinding.StickyFabricKeyBinding;\n+import net.fabricmc.fabric.mixin.client.keybinding.KeyCodeAccessor;\n+\n+/**\n+ * Expanded version of {@link KeyBinding} for use by Fabric mods.\n+ *\n+ * <p>*ALL* instantiated FabricKeyBindings should be registered in\n+ * {@link KeyBindingRegistry#register(FabricKeyBinding)}!\n+ * </p>\n+ *\n+ * <pre><code>\n+ * FabricKeyBinding.Builder builder = FabricKeyBinding.builder();\n+ * FabricKeyBinding left = builder\n+ * \t\t\t.id(new Identifier(\"example\", \"left\"))\n+ * \t\t\t.code(Keys.Left)\n+ * \t\t\t.build();\n+ * FabricKeyBinding right = builder\n+ * \t\t\t.id(new Identifier(\"example\", \"right\"))\n+ * \t\t\t.code(Keys.Right)\n+ * \t\t\t.build();\n+ * KeyBindingRegistry.register(left);\n+ * KeyBindingRegistry.register(right);\n+ * </code></pre>\n+ */\n+public class FabricKeyBinding extends KeyBinding {", "originalCommit": "cacfb980e96ad4cdf31d74cbe6882dc9a28753b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTA1MTQ2OQ==", "url": "https://github.com/FabricMC/fabric/pull/615#discussion_r429051469", "bodyText": "need to extend this for v0.", "author": "shedaniel", "createdAt": "2020-05-22T05:37:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTAzODI2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTA1MzY4NQ==", "url": "https://github.com/FabricMC/fabric/pull/615#discussion_r429053685", "bodyText": "Any reasonable way to avoid this? Allowing sub classes may make future changes more difficult.", "author": "sfPlayer1", "createdAt": "2020-05-22T05:46:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTAzODI2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTA1NDMxMw==", "url": "https://github.com/FabricMC/fabric/pull/615#discussion_r429054313", "bodyText": "Would making an interface for detecting if it is a fabric keybind be alright? need to do that for it to work rn, might look at how it works to tweak it", "author": "shedaniel", "createdAt": "2020-05-22T05:49:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTAzODI2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTA2ODMyMA==", "url": "https://github.com/FabricMC/fabric/pull/615#discussion_r429068320", "bodyText": "If there's no simple solution we can leave it not final", "author": "sfPlayer1", "createdAt": "2020-05-22T06:37:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTAzODI2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTE4OTQ2Mg==", "url": "https://github.com/FabricMC/fabric/pull/615#discussion_r429189462", "bodyText": "Made an interface called ModdedKeyBinding for both the v1 and v0 keybinding to extend, I can't think of a better name for that class.", "author": "shedaniel", "createdAt": "2020-05-22T11:19:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTAzODI2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTE5NjIyMA==", "url": "https://github.com/FabricMC/fabric/pull/615#discussion_r429196220", "bodyText": "nvm I reverted this.", "author": "shedaniel", "createdAt": "2020-05-22T11:36:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTAzODI2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTMwMDYwMQ==", "url": "https://github.com/FabricMC/fabric/pull/615#discussion_r429300601", "bodyText": "We might be above to just never return the fabric version of the keybind to the player, and return the vanilla ones, I don't see a clear reason how getIdentitier() is useful, vanilla keybindings don't have them anyways", "author": "shedaniel", "createdAt": "2020-05-22T15:03:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTAzODI2Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTAzODQyNw==", "url": "https://github.com/FabricMC/fabric/pull/615#discussion_r429038427", "bodyText": "This method should be first or last, depending on what we do elsewhere", "author": "sfPlayer1", "createdAt": "2020-05-22T04:37:42Z", "path": "fabric-key-binding-api-v1/src/main/java/net/fabricmc/fabric/api/client/keybinding/v1/FabricKeyBinding.java", "diffHunk": "@@ -0,0 +1,204 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.api.client.keybinding.v1;\n+\n+import java.util.Objects;\n+import java.util.function.BooleanSupplier;\n+\n+import com.google.common.base.Preconditions;\n+\n+import net.minecraft.client.options.KeyBinding;\n+import net.minecraft.client.util.InputUtil;\n+import net.minecraft.util.Identifier;\n+\n+import net.fabricmc.fabric.impl.client.keybinding.StickyFabricKeyBinding;\n+import net.fabricmc.fabric.mixin.client.keybinding.KeyCodeAccessor;\n+\n+/**\n+ * Expanded version of {@link KeyBinding} for use by Fabric mods.\n+ *\n+ * <p>*ALL* instantiated FabricKeyBindings should be registered in\n+ * {@link KeyBindingRegistry#register(FabricKeyBinding)}!\n+ * </p>\n+ *\n+ * <pre><code>\n+ * FabricKeyBinding.Builder builder = FabricKeyBinding.builder();\n+ * FabricKeyBinding left = builder\n+ * \t\t\t.id(new Identifier(\"example\", \"left\"))\n+ * \t\t\t.code(Keys.Left)\n+ * \t\t\t.build();\n+ * FabricKeyBinding right = builder\n+ * \t\t\t.id(new Identifier(\"example\", \"right\"))\n+ * \t\t\t.code(Keys.Right)\n+ * \t\t\t.build();\n+ * KeyBindingRegistry.register(left);\n+ * KeyBindingRegistry.register(right);\n+ * </code></pre>\n+ */\n+public class FabricKeyBinding extends KeyBinding {\n+\tprivate final Identifier id;\n+\n+\tprotected FabricKeyBinding(Identifier id, String translationKey, InputUtil.Type type, int code, String category) {\n+\t\tsuper(translationKey, type, code, category);\n+\t\tthis.id = id;\n+\t}\n+\n+\t/**\n+\t * Original identifier used to register this key.\n+\t *\n+\t * <p>May be different from the {@link #getId()}.</p>\n+\t */\n+\tpublic Identifier getIdentifier() {\n+\t\treturn id;\n+\t}\n+\n+\t/**\n+\t * Creates a new builder for constructing custom key bindings.\n+\t */\n+\tpublic static Builder builder() {\n+\t\treturn new Builder();\n+\t}", "originalCommit": "cacfb980e96ad4cdf31d74cbe6882dc9a28753b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTE4OTE1OA==", "url": "https://github.com/FabricMC/fabric/pull/615#discussion_r429189158", "bodyText": "Should be first, I changed the javadoc to make it not reuse the builder and you shouldn't be.", "author": "shedaniel", "createdAt": "2020-05-22T11:19:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTAzODQyNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTAzODgxMQ==", "url": "https://github.com/FabricMC/fabric/pull/615#discussion_r429038811", "bodyText": "Wouldn't a .buildAndRegister be better than exposing and requiring the registration separately? Is there any good reason not to want to register directly?", "author": "sfPlayer1", "createdAt": "2020-05-22T04:40:01Z", "path": "fabric-key-binding-api-v1/src/main/java/net/fabricmc/fabric/api/client/keybinding/v1/FabricKeyBinding.java", "diffHunk": "@@ -0,0 +1,204 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.api.client.keybinding.v1;\n+\n+import java.util.Objects;\n+import java.util.function.BooleanSupplier;\n+\n+import com.google.common.base.Preconditions;\n+\n+import net.minecraft.client.options.KeyBinding;\n+import net.minecraft.client.util.InputUtil;\n+import net.minecraft.util.Identifier;\n+\n+import net.fabricmc.fabric.impl.client.keybinding.StickyFabricKeyBinding;\n+import net.fabricmc.fabric.mixin.client.keybinding.KeyCodeAccessor;\n+\n+/**\n+ * Expanded version of {@link KeyBinding} for use by Fabric mods.\n+ *\n+ * <p>*ALL* instantiated FabricKeyBindings should be registered in\n+ * {@link KeyBindingRegistry#register(FabricKeyBinding)}!\n+ * </p>\n+ *\n+ * <pre><code>\n+ * FabricKeyBinding.Builder builder = FabricKeyBinding.builder();\n+ * FabricKeyBinding left = builder\n+ * \t\t\t.id(new Identifier(\"example\", \"left\"))\n+ * \t\t\t.code(Keys.Left)\n+ * \t\t\t.build();\n+ * FabricKeyBinding right = builder\n+ * \t\t\t.id(new Identifier(\"example\", \"right\"))\n+ * \t\t\t.code(Keys.Right)\n+ * \t\t\t.build();\n+ * KeyBindingRegistry.register(left);\n+ * KeyBindingRegistry.register(right);", "originalCommit": "cacfb980e96ad4cdf31d74cbe6882dc9a28753b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTE4ODkyNw==", "url": "https://github.com/FabricMC/fabric/pull/615#discussion_r429188927", "bodyText": "I am making this register both the keybinding and the category automatically now", "author": "shedaniel", "createdAt": "2020-05-22T11:18:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTAzODgxMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTAzODk4Mg==", "url": "https://github.com/FabricMC/fabric/pull/615#discussion_r429038982", "bodyText": "Maybe something like \"... aren't assigned to any key by default\" to more clearly state the effect?", "author": "sfPlayer1", "createdAt": "2020-05-22T04:40:59Z", "path": "fabric-key-binding-api-v1/src/main/java/net/fabricmc/fabric/api/client/keybinding/v1/FabricKeyBinding.java", "diffHunk": "@@ -0,0 +1,204 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.api.client.keybinding.v1;\n+\n+import java.util.Objects;\n+import java.util.function.BooleanSupplier;\n+\n+import com.google.common.base.Preconditions;\n+\n+import net.minecraft.client.options.KeyBinding;\n+import net.minecraft.client.util.InputUtil;\n+import net.minecraft.util.Identifier;\n+\n+import net.fabricmc.fabric.impl.client.keybinding.StickyFabricKeyBinding;\n+import net.fabricmc.fabric.mixin.client.keybinding.KeyCodeAccessor;\n+\n+/**\n+ * Expanded version of {@link KeyBinding} for use by Fabric mods.\n+ *\n+ * <p>*ALL* instantiated FabricKeyBindings should be registered in\n+ * {@link KeyBindingRegistry#register(FabricKeyBinding)}!\n+ * </p>\n+ *\n+ * <pre><code>\n+ * FabricKeyBinding.Builder builder = FabricKeyBinding.builder();\n+ * FabricKeyBinding left = builder\n+ * \t\t\t.id(new Identifier(\"example\", \"left\"))\n+ * \t\t\t.code(Keys.Left)\n+ * \t\t\t.build();\n+ * FabricKeyBinding right = builder\n+ * \t\t\t.id(new Identifier(\"example\", \"right\"))\n+ * \t\t\t.code(Keys.Right)\n+ * \t\t\t.build();\n+ * KeyBindingRegistry.register(left);\n+ * KeyBindingRegistry.register(right);\n+ * </code></pre>\n+ */\n+public class FabricKeyBinding extends KeyBinding {\n+\tprivate final Identifier id;\n+\n+\tprotected FabricKeyBinding(Identifier id, String translationKey, InputUtil.Type type, int code, String category) {\n+\t\tsuper(translationKey, type, code, category);\n+\t\tthis.id = id;\n+\t}\n+\n+\t/**\n+\t * Original identifier used to register this key.\n+\t *\n+\t * <p>May be different from the {@link #getId()}.</p>\n+\t */\n+\tpublic Identifier getIdentifier() {\n+\t\treturn id;\n+\t}\n+\n+\t/**\n+\t * Creates a new builder for constructing custom key bindings.\n+\t */\n+\tpublic static Builder builder() {\n+\t\treturn new Builder();\n+\t}\n+\n+\t/**\n+\t * Returns the configured KeyCode assigned to the KeyBinding from the player's settings.\n+\t *\n+\t * @return configured KeyCode\n+\t */\n+\tpublic InputUtil.KeyCode getBoundKey() {\n+\t\treturn getBoundKeyOf(this);\n+\t}\n+\n+\t/**\n+\t * Returns the configured KeyCode assigned to the KeyBinding from the player's settings.\n+\t *\n+\t * @param keyBinding the keybinding\n+\t * @return configured KeyCode\n+\t */\n+\tpublic static InputUtil.KeyCode getBoundKeyOf(KeyBinding keyBinding) {\n+\t\treturn ((KeyCodeAccessor) keyBinding).getKeyCode();\n+\t}\n+\n+\tpublic static class Builder {\n+\t\tprivate static final int UNASSIGNED = InputUtil.UNKNOWN_KEYCODE.getKeyCode();\n+\n+\t\tprivate InputUtil.Type type = InputUtil.Type.KEYSYM;\n+\t\tprivate Identifier id = null;\n+\t\tprivate String translationKey;\n+\t\tprivate boolean unassigned = false;\n+\t\tprivate BooleanSupplier toggleFlagSupplier = null;\n+\t\tprivate int code = UNASSIGNED;\n+\t\tprivate String category = KeyCategories.MISC;\n+\n+\t\tprivate Builder() {\n+\t\t}\n+\n+\t\t/**\n+\t\t * Sets the key binding id and translation key for this builder.\n+\t\t * <br>\n+\t\t * Key bindings will be assigned a translation key of the format \"key.{namespace}.{path}\"\n+\t\t *\n+\t\t * @param id Unique identifier for the bound key.\n+\t\t */\n+\t\tpublic Builder id(Identifier id) {\n+\t\t\tthis.id = Objects.requireNonNull(id, \"Keybinding's id can not be null!\");\n+\t\t\tthis.translationKey = String.format(\"key.%s.%s\", id.getNamespace(), id.getPath());\n+\t\t\treturn this;\n+\t\t}\n+\n+\t\t/**\n+\t\t * Sets the translation key for the key's category. {@link KeyCategories} for\n+\t\t * all possible values, vanilla values.\n+\t\t *\n+\t\t * @param category The category under which key bindings created by this builder will be grouped.\n+\t\t */\n+\t\tpublic Builder category(String category) {\n+\t\t\tthis.category = Objects.requireNonNull(category, \"Keybinding's category can not be null!\");\n+\t\t\treturn this;\n+\t\t}\n+\n+\t\t/**\n+\t\t * Sets the default key to be used for the key binding created using this builder.\n+\t\t *\n+\t\t * @param keyCode The default key code. Must be a valid key. May not be -1.\n+\t\t */\n+\t\tpublic Builder code(int keyCode) {\n+\t\t\tPreconditions.checkState(keyCode != UNASSIGNED, \"UNASSIGNED is not a valid key code.\");\n+\t\t\tthis.code = keyCode;\n+\t\t\tthis.unassigned = false;\n+\t\t\treturn this;\n+\t\t}\n+\n+\t\t/**\n+\t\t * Indicates to this builder that keybindings built through it are intended to be unbound.", "originalCommit": "cacfb980e96ad4cdf31d74cbe6882dc9a28753b4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTAzOTUzNg==", "url": "https://github.com/FabricMC/fabric/pull/615#discussion_r429039536", "bodyText": "Is the any way we can verify the integer more? Maybe check against some reasonable lower and upper bound?", "author": "sfPlayer1", "createdAt": "2020-05-22T04:43:56Z", "path": "fabric-key-binding-api-v1/src/main/java/net/fabricmc/fabric/api/client/keybinding/v1/FabricKeyBinding.java", "diffHunk": "@@ -0,0 +1,204 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.api.client.keybinding.v1;\n+\n+import java.util.Objects;\n+import java.util.function.BooleanSupplier;\n+\n+import com.google.common.base.Preconditions;\n+\n+import net.minecraft.client.options.KeyBinding;\n+import net.minecraft.client.util.InputUtil;\n+import net.minecraft.util.Identifier;\n+\n+import net.fabricmc.fabric.impl.client.keybinding.StickyFabricKeyBinding;\n+import net.fabricmc.fabric.mixin.client.keybinding.KeyCodeAccessor;\n+\n+/**\n+ * Expanded version of {@link KeyBinding} for use by Fabric mods.\n+ *\n+ * <p>*ALL* instantiated FabricKeyBindings should be registered in\n+ * {@link KeyBindingRegistry#register(FabricKeyBinding)}!\n+ * </p>\n+ *\n+ * <pre><code>\n+ * FabricKeyBinding.Builder builder = FabricKeyBinding.builder();\n+ * FabricKeyBinding left = builder\n+ * \t\t\t.id(new Identifier(\"example\", \"left\"))\n+ * \t\t\t.code(Keys.Left)\n+ * \t\t\t.build();\n+ * FabricKeyBinding right = builder\n+ * \t\t\t.id(new Identifier(\"example\", \"right\"))\n+ * \t\t\t.code(Keys.Right)\n+ * \t\t\t.build();\n+ * KeyBindingRegistry.register(left);\n+ * KeyBindingRegistry.register(right);\n+ * </code></pre>\n+ */\n+public class FabricKeyBinding extends KeyBinding {\n+\tprivate final Identifier id;\n+\n+\tprotected FabricKeyBinding(Identifier id, String translationKey, InputUtil.Type type, int code, String category) {\n+\t\tsuper(translationKey, type, code, category);\n+\t\tthis.id = id;\n+\t}\n+\n+\t/**\n+\t * Original identifier used to register this key.\n+\t *\n+\t * <p>May be different from the {@link #getId()}.</p>\n+\t */\n+\tpublic Identifier getIdentifier() {\n+\t\treturn id;\n+\t}\n+\n+\t/**\n+\t * Creates a new builder for constructing custom key bindings.\n+\t */\n+\tpublic static Builder builder() {\n+\t\treturn new Builder();\n+\t}\n+\n+\t/**\n+\t * Returns the configured KeyCode assigned to the KeyBinding from the player's settings.\n+\t *\n+\t * @return configured KeyCode\n+\t */\n+\tpublic InputUtil.KeyCode getBoundKey() {\n+\t\treturn getBoundKeyOf(this);\n+\t}\n+\n+\t/**\n+\t * Returns the configured KeyCode assigned to the KeyBinding from the player's settings.\n+\t *\n+\t * @param keyBinding the keybinding\n+\t * @return configured KeyCode\n+\t */\n+\tpublic static InputUtil.KeyCode getBoundKeyOf(KeyBinding keyBinding) {\n+\t\treturn ((KeyCodeAccessor) keyBinding).getKeyCode();\n+\t}\n+\n+\tpublic static class Builder {\n+\t\tprivate static final int UNASSIGNED = InputUtil.UNKNOWN_KEYCODE.getKeyCode();\n+\n+\t\tprivate InputUtil.Type type = InputUtil.Type.KEYSYM;\n+\t\tprivate Identifier id = null;\n+\t\tprivate String translationKey;\n+\t\tprivate boolean unassigned = false;\n+\t\tprivate BooleanSupplier toggleFlagSupplier = null;\n+\t\tprivate int code = UNASSIGNED;\n+\t\tprivate String category = KeyCategories.MISC;\n+\n+\t\tprivate Builder() {\n+\t\t}\n+\n+\t\t/**\n+\t\t * Sets the key binding id and translation key for this builder.\n+\t\t * <br>\n+\t\t * Key bindings will be assigned a translation key of the format \"key.{namespace}.{path}\"\n+\t\t *\n+\t\t * @param id Unique identifier for the bound key.\n+\t\t */\n+\t\tpublic Builder id(Identifier id) {\n+\t\t\tthis.id = Objects.requireNonNull(id, \"Keybinding's id can not be null!\");\n+\t\t\tthis.translationKey = String.format(\"key.%s.%s\", id.getNamespace(), id.getPath());\n+\t\t\treturn this;\n+\t\t}\n+\n+\t\t/**\n+\t\t * Sets the translation key for the key's category. {@link KeyCategories} for\n+\t\t * all possible values, vanilla values.\n+\t\t *\n+\t\t * @param category The category under which key bindings created by this builder will be grouped.\n+\t\t */\n+\t\tpublic Builder category(String category) {\n+\t\t\tthis.category = Objects.requireNonNull(category, \"Keybinding's category can not be null!\");\n+\t\t\treturn this;\n+\t\t}\n+\n+\t\t/**\n+\t\t * Sets the default key to be used for the key binding created using this builder.\n+\t\t *\n+\t\t * @param keyCode The default key code. Must be a valid key. May not be -1.\n+\t\t */\n+\t\tpublic Builder code(int keyCode) {\n+\t\t\tPreconditions.checkState(keyCode != UNASSIGNED, \"UNASSIGNED is not a valid key code.\");", "originalCommit": "cacfb980e96ad4cdf31d74cbe6882dc9a28753b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTE2MTcyMw==", "url": "https://github.com/FabricMC/fabric/pull/615#discussion_r429161723", "bodyText": "Just checked, it seems like there isn't a limit on what the integer can be, Minecraft will just create a new code if it doesn't exist already, meaning that it can basically accept any code.", "author": "shedaniel", "createdAt": "2020-05-22T10:12:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTAzOTUzNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTAzOTcyNQ==", "url": "https://github.com/FabricMC/fabric/pull/615#discussion_r429039725", "bodyText": "Does MC not allow switching key binds between mouse and keyboard?", "author": "sfPlayer1", "createdAt": "2020-05-22T04:44:51Z", "path": "fabric-key-binding-api-v1/src/main/java/net/fabricmc/fabric/api/client/keybinding/v1/FabricKeyBinding.java", "diffHunk": "@@ -0,0 +1,204 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.api.client.keybinding.v1;\n+\n+import java.util.Objects;\n+import java.util.function.BooleanSupplier;\n+\n+import com.google.common.base.Preconditions;\n+\n+import net.minecraft.client.options.KeyBinding;\n+import net.minecraft.client.util.InputUtil;\n+import net.minecraft.util.Identifier;\n+\n+import net.fabricmc.fabric.impl.client.keybinding.StickyFabricKeyBinding;\n+import net.fabricmc.fabric.mixin.client.keybinding.KeyCodeAccessor;\n+\n+/**\n+ * Expanded version of {@link KeyBinding} for use by Fabric mods.\n+ *\n+ * <p>*ALL* instantiated FabricKeyBindings should be registered in\n+ * {@link KeyBindingRegistry#register(FabricKeyBinding)}!\n+ * </p>\n+ *\n+ * <pre><code>\n+ * FabricKeyBinding.Builder builder = FabricKeyBinding.builder();\n+ * FabricKeyBinding left = builder\n+ * \t\t\t.id(new Identifier(\"example\", \"left\"))\n+ * \t\t\t.code(Keys.Left)\n+ * \t\t\t.build();\n+ * FabricKeyBinding right = builder\n+ * \t\t\t.id(new Identifier(\"example\", \"right\"))\n+ * \t\t\t.code(Keys.Right)\n+ * \t\t\t.build();\n+ * KeyBindingRegistry.register(left);\n+ * KeyBindingRegistry.register(right);\n+ * </code></pre>\n+ */\n+public class FabricKeyBinding extends KeyBinding {\n+\tprivate final Identifier id;\n+\n+\tprotected FabricKeyBinding(Identifier id, String translationKey, InputUtil.Type type, int code, String category) {\n+\t\tsuper(translationKey, type, code, category);\n+\t\tthis.id = id;\n+\t}\n+\n+\t/**\n+\t * Original identifier used to register this key.\n+\t *\n+\t * <p>May be different from the {@link #getId()}.</p>\n+\t */\n+\tpublic Identifier getIdentifier() {\n+\t\treturn id;\n+\t}\n+\n+\t/**\n+\t * Creates a new builder for constructing custom key bindings.\n+\t */\n+\tpublic static Builder builder() {\n+\t\treturn new Builder();\n+\t}\n+\n+\t/**\n+\t * Returns the configured KeyCode assigned to the KeyBinding from the player's settings.\n+\t *\n+\t * @return configured KeyCode\n+\t */\n+\tpublic InputUtil.KeyCode getBoundKey() {\n+\t\treturn getBoundKeyOf(this);\n+\t}\n+\n+\t/**\n+\t * Returns the configured KeyCode assigned to the KeyBinding from the player's settings.\n+\t *\n+\t * @param keyBinding the keybinding\n+\t * @return configured KeyCode\n+\t */\n+\tpublic static InputUtil.KeyCode getBoundKeyOf(KeyBinding keyBinding) {\n+\t\treturn ((KeyCodeAccessor) keyBinding).getKeyCode();\n+\t}\n+\n+\tpublic static class Builder {\n+\t\tprivate static final int UNASSIGNED = InputUtil.UNKNOWN_KEYCODE.getKeyCode();\n+\n+\t\tprivate InputUtil.Type type = InputUtil.Type.KEYSYM;\n+\t\tprivate Identifier id = null;\n+\t\tprivate String translationKey;\n+\t\tprivate boolean unassigned = false;\n+\t\tprivate BooleanSupplier toggleFlagSupplier = null;\n+\t\tprivate int code = UNASSIGNED;\n+\t\tprivate String category = KeyCategories.MISC;\n+\n+\t\tprivate Builder() {\n+\t\t}\n+\n+\t\t/**\n+\t\t * Sets the key binding id and translation key for this builder.\n+\t\t * <br>\n+\t\t * Key bindings will be assigned a translation key of the format \"key.{namespace}.{path}\"\n+\t\t *\n+\t\t * @param id Unique identifier for the bound key.\n+\t\t */\n+\t\tpublic Builder id(Identifier id) {\n+\t\t\tthis.id = Objects.requireNonNull(id, \"Keybinding's id can not be null!\");\n+\t\t\tthis.translationKey = String.format(\"key.%s.%s\", id.getNamespace(), id.getPath());\n+\t\t\treturn this;\n+\t\t}\n+\n+\t\t/**\n+\t\t * Sets the translation key for the key's category. {@link KeyCategories} for\n+\t\t * all possible values, vanilla values.\n+\t\t *\n+\t\t * @param category The category under which key bindings created by this builder will be grouped.\n+\t\t */\n+\t\tpublic Builder category(String category) {\n+\t\t\tthis.category = Objects.requireNonNull(category, \"Keybinding's category can not be null!\");\n+\t\t\treturn this;\n+\t\t}\n+\n+\t\t/**\n+\t\t * Sets the default key to be used for the key binding created using this builder.\n+\t\t *\n+\t\t * @param keyCode The default key code. Must be a valid key. May not be -1.\n+\t\t */\n+\t\tpublic Builder code(int keyCode) {\n+\t\t\tPreconditions.checkState(keyCode != UNASSIGNED, \"UNASSIGNED is not a valid key code.\");\n+\t\t\tthis.code = keyCode;\n+\t\t\tthis.unassigned = false;\n+\t\t\treturn this;\n+\t\t}\n+\n+\t\t/**\n+\t\t * Indicates to this builder that keybindings built through it are intended to be unbound.\n+\t\t */\n+\t\tpublic Builder unassigned() {\n+\t\t\tthis.code = UNASSIGNED;\n+\t\t\tthis.unassigned = true;\n+\t\t\treturn this;\n+\t\t}\n+\n+\t\t/**\n+\t\t * Sets this builder to create sticky keybindings that will toggle their state when pressed.\n+\t\t */\n+\t\tpublic Builder sticky() {\n+\t\t\treturn sticky(() -> true);\n+\t\t}\n+\n+\t\t/**\n+\t\t * Sets a sticking action to be used by the constructed key binding which can be used to switch between\n+\t\t * a sticky (toggle) and a regular key binding.\n+\t\t *\n+\t\t * @param toggleFlagSupplier A getter function to determine whether to toggle or not. True for toggling behaviour, false otherwise.\n+\t\t */\n+\t\tpublic Builder sticky(BooleanSupplier toggleFlagSupplier) {\n+\t\t\tthis.toggleFlagSupplier = toggleFlagSupplier;\n+\t\t\treturn this;\n+\t\t}\n+\n+\t\t/**\n+\t\t * Sets the key's type. Maybe be one of [{@link InputUtil.Type#KEYSYM} (keyboard), {@link InputUtil.Type#SCANCODE}, {@link InputUtil.Type#MOUSE}]", "originalCommit": "cacfb980e96ad4cdf31d74cbe6882dc9a28753b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTA1MTgyNA==", "url": "https://github.com/FabricMC/fabric/pull/615#discussion_r429051824", "bodyText": "this is the type of the code specified above, this is just for the default binding", "author": "shedaniel", "createdAt": "2020-05-22T05:38:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTAzOTcyNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTA1MzA5Mg==", "url": "https://github.com/FabricMC/fabric/pull/615#discussion_r429053092", "bodyText": "Can we combine this with the code (int) method then, maybe having per-type methods?", "author": "sfPlayer1", "createdAt": "2020-05-22T05:44:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTAzOTcyNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTA1NDU3NQ==", "url": "https://github.com/FabricMC/fabric/pull/615#discussion_r429054575", "bodyText": "I'll just combine it, don't know if a mod would like to extend the enum", "author": "shedaniel", "createdAt": "2020-05-22T05:50:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTAzOTcyNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTAzOTk4Mw==", "url": "https://github.com/FabricMC/fabric/pull/615#discussion_r429039983", "bodyText": "If we add register to the builder's build(), this method could get moved as a static helper to KeyCategories.", "author": "sfPlayer1", "createdAt": "2020-05-22T04:46:00Z", "path": "fabric-key-binding-api-v1/src/main/java/net/fabricmc/fabric/api/client/keybinding/v1/KeyBindingRegistry.java", "diffHunk": "@@ -0,0 +1,44 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.api.client.keybinding.v1;\n+\n+import net.fabricmc.fabric.impl.client.keybinding.KeyBindingRegistryImpl;\n+\n+/**\n+ * Interface for registering key bindings.\n+ *\n+ * @see FabricKeyBinding\n+ */\n+public interface KeyBindingRegistry {\n+\tKeyBindingRegistry INSTANCE = KeyBindingRegistryImpl.INSTANCE;\n+\n+\t/**\n+\t * Add a new key binding category.\n+\t *\n+\t * @param categoryName The key binding category name.\n+\t * @return True if a new category was added.\n+\t */\n+\tboolean addCategory(String categoryName);", "originalCommit": "cacfb980e96ad4cdf31d74cbe6882dc9a28753b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTE2ODEzMw==", "url": "https://github.com/FabricMC/fabric/pull/615#discussion_r429168133", "bodyText": "should we just automatically register the category if it doesn't exist?", "author": "shedaniel", "createdAt": "2020-05-22T10:27:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTAzOTk4Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTE3MDc3NQ==", "url": "https://github.com/FabricMC/fabric/pull/615#discussion_r429170775", "bodyText": "Seems like we are already doing that with a warning that doesn't make sense, I think I will just remove that warning.", "author": "shedaniel", "createdAt": "2020-05-22T10:33:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTAzOTk4Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTQzMDkzNQ==", "url": "https://github.com/FabricMC/fabric/pull/615#discussion_r429430935", "bodyText": "Just registering the category makes sense", "author": "dexman545", "createdAt": "2020-05-22T20:00:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTAzOTk4Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTA0MDI2Nw==", "url": "https://github.com/FabricMC/fabric/pull/615#discussion_r429040267", "bodyText": "There are some naming inconsistencies between bound vs assigned.", "author": "sfPlayer1", "createdAt": "2020-05-22T04:47:27Z", "path": "fabric-key-binding-api-v1/src/main/java/net/fabricmc/fabric/api/client/keybinding/v1/FabricKeyBinding.java", "diffHunk": "@@ -0,0 +1,204 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.api.client.keybinding.v1;\n+\n+import java.util.Objects;\n+import java.util.function.BooleanSupplier;\n+\n+import com.google.common.base.Preconditions;\n+\n+import net.minecraft.client.options.KeyBinding;\n+import net.minecraft.client.util.InputUtil;\n+import net.minecraft.util.Identifier;\n+\n+import net.fabricmc.fabric.impl.client.keybinding.StickyFabricKeyBinding;\n+import net.fabricmc.fabric.mixin.client.keybinding.KeyCodeAccessor;\n+\n+/**\n+ * Expanded version of {@link KeyBinding} for use by Fabric mods.\n+ *\n+ * <p>*ALL* instantiated FabricKeyBindings should be registered in\n+ * {@link KeyBindingRegistry#register(FabricKeyBinding)}!\n+ * </p>\n+ *\n+ * <pre><code>\n+ * FabricKeyBinding.Builder builder = FabricKeyBinding.builder();\n+ * FabricKeyBinding left = builder\n+ * \t\t\t.id(new Identifier(\"example\", \"left\"))\n+ * \t\t\t.code(Keys.Left)\n+ * \t\t\t.build();\n+ * FabricKeyBinding right = builder\n+ * \t\t\t.id(new Identifier(\"example\", \"right\"))\n+ * \t\t\t.code(Keys.Right)\n+ * \t\t\t.build();\n+ * KeyBindingRegistry.register(left);\n+ * KeyBindingRegistry.register(right);\n+ * </code></pre>\n+ */\n+public class FabricKeyBinding extends KeyBinding {\n+\tprivate final Identifier id;\n+\n+\tprotected FabricKeyBinding(Identifier id, String translationKey, InputUtil.Type type, int code, String category) {\n+\t\tsuper(translationKey, type, code, category);\n+\t\tthis.id = id;\n+\t}\n+\n+\t/**\n+\t * Original identifier used to register this key.\n+\t *\n+\t * <p>May be different from the {@link #getId()}.</p>\n+\t */\n+\tpublic Identifier getIdentifier() {\n+\t\treturn id;\n+\t}\n+\n+\t/**\n+\t * Creates a new builder for constructing custom key bindings.\n+\t */\n+\tpublic static Builder builder() {\n+\t\treturn new Builder();\n+\t}\n+\n+\t/**\n+\t * Returns the configured KeyCode assigned to the KeyBinding from the player's settings.\n+\t *\n+\t * @return configured KeyCode\n+\t */\n+\tpublic InputUtil.KeyCode getBoundKey() {", "originalCommit": "cacfb980e96ad4cdf31d74cbe6882dc9a28753b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTA1MTk5OQ==", "url": "https://github.com/FabricMC/fabric/pull/615#discussion_r429051999", "bodyText": "We have been using bound in the new yarn, where is assigned used", "author": "shedaniel", "createdAt": "2020-05-22T05:39:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTA0MDI2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTA1MjU4NQ==", "url": "https://github.com/FabricMC/fabric/pull/615#discussion_r429052585", "bodyText": "Search the file for \"assign\", there are multiple uses both in code and docs", "author": "sfPlayer1", "createdAt": "2020-05-22T05:41:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTA0MDI2Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTA0MDYzMA==", "url": "https://github.com/FabricMC/fabric/pull/615#discussion_r429040630", "bodyText": "I'd use a little nested class instead of BooleanSupplier that can then use a better method name and document it.", "author": "sfPlayer1", "createdAt": "2020-05-22T04:49:22Z", "path": "fabric-key-binding-api-v1/src/main/java/net/fabricmc/fabric/api/client/keybinding/v1/FabricKeyBinding.java", "diffHunk": "@@ -0,0 +1,204 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.api.client.keybinding.v1;\n+\n+import java.util.Objects;\n+import java.util.function.BooleanSupplier;\n+\n+import com.google.common.base.Preconditions;\n+\n+import net.minecraft.client.options.KeyBinding;\n+import net.minecraft.client.util.InputUtil;\n+import net.minecraft.util.Identifier;\n+\n+import net.fabricmc.fabric.impl.client.keybinding.StickyFabricKeyBinding;\n+import net.fabricmc.fabric.mixin.client.keybinding.KeyCodeAccessor;\n+\n+/**\n+ * Expanded version of {@link KeyBinding} for use by Fabric mods.\n+ *\n+ * <p>*ALL* instantiated FabricKeyBindings should be registered in\n+ * {@link KeyBindingRegistry#register(FabricKeyBinding)}!\n+ * </p>\n+ *\n+ * <pre><code>\n+ * FabricKeyBinding.Builder builder = FabricKeyBinding.builder();\n+ * FabricKeyBinding left = builder\n+ * \t\t\t.id(new Identifier(\"example\", \"left\"))\n+ * \t\t\t.code(Keys.Left)\n+ * \t\t\t.build();\n+ * FabricKeyBinding right = builder\n+ * \t\t\t.id(new Identifier(\"example\", \"right\"))\n+ * \t\t\t.code(Keys.Right)\n+ * \t\t\t.build();\n+ * KeyBindingRegistry.register(left);\n+ * KeyBindingRegistry.register(right);\n+ * </code></pre>\n+ */\n+public class FabricKeyBinding extends KeyBinding {\n+\tprivate final Identifier id;\n+\n+\tprotected FabricKeyBinding(Identifier id, String translationKey, InputUtil.Type type, int code, String category) {\n+\t\tsuper(translationKey, type, code, category);\n+\t\tthis.id = id;\n+\t}\n+\n+\t/**\n+\t * Original identifier used to register this key.\n+\t *\n+\t * <p>May be different from the {@link #getId()}.</p>\n+\t */\n+\tpublic Identifier getIdentifier() {\n+\t\treturn id;\n+\t}\n+\n+\t/**\n+\t * Creates a new builder for constructing custom key bindings.\n+\t */\n+\tpublic static Builder builder() {\n+\t\treturn new Builder();\n+\t}\n+\n+\t/**\n+\t * Returns the configured KeyCode assigned to the KeyBinding from the player's settings.\n+\t *\n+\t * @return configured KeyCode\n+\t */\n+\tpublic InputUtil.KeyCode getBoundKey() {\n+\t\treturn getBoundKeyOf(this);\n+\t}\n+\n+\t/**\n+\t * Returns the configured KeyCode assigned to the KeyBinding from the player's settings.\n+\t *\n+\t * @param keyBinding the keybinding\n+\t * @return configured KeyCode\n+\t */\n+\tpublic static InputUtil.KeyCode getBoundKeyOf(KeyBinding keyBinding) {\n+\t\treturn ((KeyCodeAccessor) keyBinding).getKeyCode();\n+\t}\n+\n+\tpublic static class Builder {\n+\t\tprivate static final int UNASSIGNED = InputUtil.UNKNOWN_KEYCODE.getKeyCode();\n+\n+\t\tprivate InputUtil.Type type = InputUtil.Type.KEYSYM;\n+\t\tprivate Identifier id = null;\n+\t\tprivate String translationKey;\n+\t\tprivate boolean unassigned = false;\n+\t\tprivate BooleanSupplier toggleFlagSupplier = null;\n+\t\tprivate int code = UNASSIGNED;\n+\t\tprivate String category = KeyCategories.MISC;\n+\n+\t\tprivate Builder() {\n+\t\t}\n+\n+\t\t/**\n+\t\t * Sets the key binding id and translation key for this builder.\n+\t\t * <br>\n+\t\t * Key bindings will be assigned a translation key of the format \"key.{namespace}.{path}\"\n+\t\t *\n+\t\t * @param id Unique identifier for the bound key.\n+\t\t */\n+\t\tpublic Builder id(Identifier id) {\n+\t\t\tthis.id = Objects.requireNonNull(id, \"Keybinding's id can not be null!\");\n+\t\t\tthis.translationKey = String.format(\"key.%s.%s\", id.getNamespace(), id.getPath());\n+\t\t\treturn this;\n+\t\t}\n+\n+\t\t/**\n+\t\t * Sets the translation key for the key's category. {@link KeyCategories} for\n+\t\t * all possible values, vanilla values.\n+\t\t *\n+\t\t * @param category The category under which key bindings created by this builder will be grouped.\n+\t\t */\n+\t\tpublic Builder category(String category) {\n+\t\t\tthis.category = Objects.requireNonNull(category, \"Keybinding's category can not be null!\");\n+\t\t\treturn this;\n+\t\t}\n+\n+\t\t/**\n+\t\t * Sets the default key to be used for the key binding created using this builder.\n+\t\t *\n+\t\t * @param keyCode The default key code. Must be a valid key. May not be -1.\n+\t\t */\n+\t\tpublic Builder code(int keyCode) {\n+\t\t\tPreconditions.checkState(keyCode != UNASSIGNED, \"UNASSIGNED is not a valid key code.\");\n+\t\t\tthis.code = keyCode;\n+\t\t\tthis.unassigned = false;\n+\t\t\treturn this;\n+\t\t}\n+\n+\t\t/**\n+\t\t * Indicates to this builder that keybindings built through it are intended to be unbound.\n+\t\t */\n+\t\tpublic Builder unassigned() {\n+\t\t\tthis.code = UNASSIGNED;\n+\t\t\tthis.unassigned = true;\n+\t\t\treturn this;\n+\t\t}\n+\n+\t\t/**\n+\t\t * Sets this builder to create sticky keybindings that will toggle their state when pressed.\n+\t\t */\n+\t\tpublic Builder sticky() {\n+\t\t\treturn sticky(() -> true);\n+\t\t}\n+\n+\t\t/**\n+\t\t * Sets a sticking action to be used by the constructed key binding which can be used to switch between\n+\t\t * a sticky (toggle) and a regular key binding.\n+\t\t *\n+\t\t * @param toggleFlagSupplier A getter function to determine whether to toggle or not. True for toggling behaviour, false otherwise.\n+\t\t */\n+\t\tpublic Builder sticky(BooleanSupplier toggleFlagSupplier) {", "originalCommit": "cacfb980e96ad4cdf31d74cbe6882dc9a28753b4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "479de279b72eca7c79992bc728231a6e436ead5c", "url": "https://github.com/FabricMC/fabric/commit/479de279b72eca7c79992bc728231a6e436ead5c", "message": "major refactor\n\nSigned-off-by: shedaniel <daniel@shedaniel.me>", "committedDate": "2020-05-22T11:17:39Z", "type": "commit"}, {"oid": "9ae383b1ddc6f80d8c38382cc5d733d1ad7f003e", "url": "https://github.com/FabricMC/fabric/commit/9ae383b1ddc6f80d8c38382cc5d733d1ad7f003e", "message": "revert some stuff\n\nSigned-off-by: shedaniel <daniel@shedaniel.me>", "committedDate": "2020-05-22T11:37:11Z", "type": "commit"}, {"oid": "46ac2e06eb8d9f2d810f9e35aa9431beac4ba291", "url": "https://github.com/FabricMC/fabric/commit/46ac2e06eb8d9f2d810f9e35aa9431beac4ba291", "message": "fix build\n\nSigned-off-by: shedaniel <daniel@shedaniel.me>", "committedDate": "2020-05-22T11:45:39Z", "type": "commit"}, {"oid": "08344b14d727fd68eec2003afff2f3d276ea8cd8", "url": "https://github.com/FabricMC/fabric/commit/08344b14d727fd68eec2003afff2f3d276ea8cd8", "message": "major stuff\n\nSigned-off-by: shedaniel <daniel@shedaniel.me>", "committedDate": "2020-05-23T06:40:20Z", "type": "commit"}, {"oid": "3b4be8b48a8783b9a011cb327b5e3e7955888746", "url": "https://github.com/FabricMC/fabric/commit/3b4be8b48a8783b9a011cb327b5e3e7955888746", "message": "fix license, of course\n\nSigned-off-by: shedaniel <daniel@shedaniel.me>", "committedDate": "2020-05-23T06:46:59Z", "type": "commit"}, {"oid": "1ff6f673b5a8090ebcb93f1d33d4af863c7533c4", "url": "https://github.com/FabricMC/fabric/commit/1ff6f673b5a8090ebcb93f1d33d4af863c7533c4", "message": "Add resource loader v0\n\nSigned-off-by: shedaniel <daniel@shedaniel.me>", "committedDate": "2020-05-23T10:06:17Z", "type": "commit"}, {"oid": "3d61c3dc414c187b5d2bfc7250f8080bdbb1ce90", "url": "https://github.com/FabricMC/fabric/commit/3d61c3dc414c187b5d2bfc7250f8080bdbb1ce90", "message": "Let's not break the api.\n\nSigned-off-by: shedaniel <daniel@shedaniel.me>", "committedDate": "2020-05-23T10:10:20Z", "type": "commit"}, {"oid": "fdef23a31b0758d41d2669428a08c725f42ff7cd", "url": "https://github.com/FabricMC/fabric/commit/fdef23a31b0758d41d2669428a08c725f42ff7cd", "message": "Rename to buildAndRegister\n\nSigned-off-by: shedaniel <daniel@shedaniel.me>", "committedDate": "2020-05-23T10:11:32Z", "type": "commit"}, {"oid": "9ea84382414defb4395e33e7adda0cd69ddbc643", "url": "https://github.com/FabricMC/fabric/commit/9ea84382414defb4395e33e7adda0cd69ddbc643", "message": "resolve reviews\n\nSigned-off-by: shedaniel <daniel@shedaniel.me>", "committedDate": "2020-05-23T12:25:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU3Mzc4Mg==", "url": "https://github.com/FabricMC/fabric/pull/615#discussion_r429573782", "bodyText": "Use the GLFW constants GLFW.GLFW_KEY_P will be clearer and act as a better example", "author": "modmuss50", "createdAt": "2020-05-23T19:56:10Z", "path": "fabric-key-binding-api-v1/src/testmod/java/net/fabricmc/fabric/test/client/keybinding/KeybindingsTest.java", "diffHunk": "@@ -0,0 +1,62 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.test.client.keybinding;\n+\n+import net.minecraft.client.options.KeyBinding;\n+import net.minecraft.client.util.InputUtil;\n+import net.minecraft.text.LiteralText;\n+import net.minecraft.util.Identifier;\n+\n+import net.fabricmc.api.ClientModInitializer;\n+import net.fabricmc.fabric.api.client.keybinding.v1.KeyBindingHelper;\n+import net.fabricmc.fabric.api.event.client.ClientTickCallback;\n+\n+public class KeybindingsTest implements ClientModInitializer {\n+\t@Override\n+\tpublic void onInitializeClient() {\n+\t\tKeyBinding binding1 = KeyBindingHelper.builder()\n+\t\t\t\t.identifier(new Identifier(\"fabric-key-binding-api-v1-testmod:test_keybinding_1\"))\n+\t\t\t\t.category(\"category.first.test\")\n+\t\t\t\t.key(InputUtil.Type.KEYSYM, 80) // P", "originalCommit": "9ea84382414defb4395e33e7adda0cd69ddbc643", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY0NjIyNw==", "url": "https://github.com/FabricMC/fabric/pull/615#discussion_r429646227", "bodyText": "fixed.", "author": "shedaniel", "createdAt": "2020-05-24T15:08:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU3Mzc4Mg=="}], "type": "inlineReview"}, {"oid": "2f3f9995e6e7e00ea12e9254056d00aaa47da0fb", "url": "https://github.com/FabricMC/fabric/commit/2f3f9995e6e7e00ea12e9254056d00aaa47da0fb", "message": "Use GLFW\n\nSigned-off-by: shedaniel <daniel@shedaniel.me>", "committedDate": "2020-05-24T15:07:29Z", "type": "commit"}, {"oid": "859156c813a1efc28c160b47047c6b457db50e63", "url": "https://github.com/FabricMC/fabric/commit/859156c813a1efc28c160b47047c6b457db50e63", "message": "Dump the builder entirely\n\nSigned-off-by: shedaniel <daniel@shedaniel.me>", "committedDate": "2020-05-27T14:37:06Z", "type": "commit"}, {"oid": "c26bedbaa884425ca80af014f4d70b718572c5b7", "url": "https://github.com/FabricMC/fabric/commit/c26bedbaa884425ca80af014f4d70b718572c5b7", "message": "Rename to Key Binding\n\nSigned-off-by: shedaniel <daniel@shedaniel.me>", "committedDate": "2020-06-06T05:17:39Z", "type": "commit"}]}