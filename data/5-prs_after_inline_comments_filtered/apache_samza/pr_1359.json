{"pr_number": 1359, "pr_title": "SAMZA-2523: Update Util#envVarEscape to escape more characters", "pr_createdAt": "2020-05-11T22:58:00Z", "pr_url": "https://github.com/apache/samza/pull/1359", "timeline": [{"oid": "264207f135c8452b8b95d6d52e8eb81ced08cae8", "url": "https://github.com/apache/samza/commit/264207f135c8452b8b95d6d52e8eb81ced08cae8", "message": "SAMZA-2523: Update Util#envVarEscape to escape more characters\n\nSymptom: Job to fail to launch.\nCause: Backslash and grave accent in submission config is not properly escaped, causing launch.sh to break.\nChanges: Update Util#envVarEscape to escape backslash as well as grave accent.\nTests: Unit tests updated to test such cases.\nAPI Changes: None\nUpgrade Instructions: None\nUsage Instructions: None", "committedDate": "2020-05-11T22:53:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzM4ODk0OA==", "url": "https://github.com/apache/samza/pull/1359#discussion_r423388948", "bodyText": "Are these escape sequences comprehensive enough to cover all the special characters that are currently used in samza-sql statements? (Some other special characters include: % , (, [).", "author": "shanthoosh", "createdAt": "2020-05-12T00:08:15Z", "path": "samza-core/src/main/java/org/apache/samza/util/Util.java", "diffHunk": "@@ -45,7 +45,11 @@\n    * Make an environment variable string safe to pass.\n    */\n   public static String envVarEscape(String str) {\n-    return str.replace(\"\\\"\", \"\\\\\\\"\").replace(\"'\", \"\\\\'\");\n+    return str", "originalCommit": "264207f135c8452b8b95d6d52e8eb81ced08cae8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzM5MTI1OA==", "url": "https://github.com/apache/samza/pull/1359#discussion_r423391258", "bodyText": "%, ( and [ are not special characters in terms of env var.", "author": "kw2542", "createdAt": "2020-05-12T00:16:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzM4ODk0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzM5NzAwNw==", "url": "https://github.com/apache/samza/pull/1359#discussion_r423397007", "bodyText": "The point I am trying to make is passing samza-sql statements over as env_arguments is kind of fragile. To be comprehensive, you need to figure out all the special characters in bash that are used in sql and then escape them. Special characters that are used in bash  .", "author": "shanthoosh", "createdAt": "2020-05-12T00:36:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzM4ODk0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzQwNDYyOA==", "url": "https://github.com/apache/samza/pull/1359#discussion_r423404628", "bodyText": "I understand your point. Special characters in bash does not mean we need to escape it because:\n\nit must be valid SQL syntax\nthey are already encapsulated in bash string, only those that will impact the string encapsulation needs to be escaped.\n\nI can only find backslash and grave accent for now, do you know if there are other characters that we need to escape here?", "author": "kw2542", "createdAt": "2020-05-12T01:04:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzM4ODk0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzQxOTcxOA==", "url": "https://github.com/apache/samza/pull/1359#discussion_r423419718", "bodyText": "From this bash wiki here: https://mywiki.wooledge.org/BashGuide/SpecialCharacters\n$, #  are special charactors. They're used in samza-sql statements espciecially in udf's,   ( ) means sub-shell group in bash. It's also used in samza-sql.\n\n\nMoreover join is a linux command and samza-sql uses this keyword extensively for stream-table join and stream-to-stream join.   . Do you know if we had to escape that too.", "author": "shanthoosh", "createdAt": "2020-05-12T02:01:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzM4ODk0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzQ0MDAxOA==", "url": "https://github.com/apache/samza/pull/1359#discussion_r423440018", "bodyText": "I may not be clear before, let me explain, all of these env var are already encapsulated in a string in bash, i.e.\nexport SAMZA_SUBMISSION_CONFIG=\"the config\"\n\nwhat we need to escape are those characters that will change how bash interpret strings, single and double quotes are the most obvious ones, which are the characters we have been escaping. However, backslash and grave accent are also special characters that will change how string looks in bash, other special characters such as $, #, (, ) are special in bash itself but no longer special once they are wrapper inside a string.", "author": "kw2542", "createdAt": "2020-05-12T03:26:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzM4ODk0OA=="}], "type": "inlineReview"}]}