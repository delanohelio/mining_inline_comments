{"pr_number": 4424, "pr_title": "[WFCORE-482] Improve the comment on why the privileged action is requ\u2026", "pr_createdAt": "2020-12-08T17:33:30Z", "pr_url": "https://github.com/wildfly/wildfly-core/pull/4424", "timeline": [{"oid": "962ba961961554e9874eeb6ef1eb73309ad373b1", "url": "https://github.com/wildfly/wildfly-core/commit/962ba961961554e9874eeb6ef1eb73309ad373b1", "message": "[WFCORE-482] Improve the comment on why the privileged action is required. Also reduce the file permissions to the log4j2-jboss-logmanager instead of ALL FILES.\n\nhttps://issues.redhat.com/browse/WFCORE-482", "committedDate": "2020-12-08T17:31:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODc3MDMzMw==", "url": "https://github.com/wildfly/wildfly-core/pull/4424#discussion_r538770333", "bodyText": "Does this testsuite support using -Djboss.dist to run against a different distribution? If so I don't think this will work as that dist would probably be a fat server.", "author": "bstansberry", "createdAt": "2020-12-08T20:07:10Z", "path": "testsuite/standalone/src/test/java/org/jboss/as/test/integration/logging/profiles/Log4j2LoggingProfilesTestCase.java", "diffHunk": "@@ -47,12 +48,27 @@ protected void processDeployment(final JavaArchive deployment) {\n                 new RuntimePermission(\"getClassLoader\"),\n                 // The FilePermissions is also for the org.apache.logging.log4j.util.ProviderUtil as it needs to read the JAR\n                 // for the service loader.\n-                new FilePermission(\"<<ALL FILES>>\", \"read\"),\n+                new FilePermission(resolveFilePermissions(), \"read\"),\n                 // Required for the EnvironmentPropertySource System.getenv().\n                 new RuntimePermission(\"getenv.*\"),\n                 // Required for the SystemPropertiesPropertySource System.getProperties().\n                 new PropertyPermission(\"*\", \"read,write\"),\n         };\n         addPermissions(deployment, permissions);\n     }\n+\n+    private static String resolveFilePermissions() {", "originalCommit": "962ba961961554e9874eeb6ef1eb73309ad373b1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODc3MjczNA==", "url": "https://github.com/wildfly/wildfly-core/pull/4424#discussion_r538772734", "bodyText": "Oh right no it won't. I forgot that was an option. I'll see if there is a way to make both work, otherwise we'll need <<ALL FILES>>.", "author": "jamezp", "createdAt": "2020-12-08T20:11:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODc3MDMzMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODg0OTMzOQ==", "url": "https://github.com/wildfly/wildfly-core/pull/4424#discussion_r538849339", "bodyText": "@jamezp yeah, sorry; i led you totally in a wrong direction.\nMy focus on my comment on this line on the other PR was more about what to document in the docs, not so much this test. This test would be a great way to prove that something you document actually works, but I forgot the permissions.xml expression resolution one use of which you'd be documenting does not work unless the server is full WildFly.", "author": "bstansberry", "createdAt": "2020-12-08T22:17:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODc3MDMzMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODkyNDczNQ==", "url": "https://github.com/wildfly/wildfly-core/pull/4424#discussion_r538924735", "bodyText": "@bstansberry Actually it doesn't look like the jboss.dist is honored for core. I'm gonna search through the pom's, but I see this in the system properties:\njboss.dist = /home/jperkins/projects/wildfly/wildfly-core/dist/target/wildfly-core-14.0.0.Beta4-SNAPSHOT\nmodule.path = /home/jperkins/projects/wildfly/wildfly-core/testsuite/standalone/target/wildfly-core/modules\n\nThe surefire config sets the jboss.home \n  \n    \n      wildfly-core/testsuite/pom.xml\n    \n    \n         Line 325\n      in\n      a8975aa\n    \n    \n    \n    \n\n        \n          \n           <jboss.home>${basedir}/target/wildfly-core</jboss.home> \n        \n    \n  \n\n. Only the Elytron profile sets the module.path, but somehow the test still passed then. It doesn't look like the module.path is ever overridden.", "author": "jamezp", "createdAt": "2020-12-09T01:01:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODc3MDMzMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODkzMTg5OQ==", "url": "https://github.com/wildfly/wildfly-core/pull/4424#discussion_r538931899", "bodyText": "Oh the module.path is only overridden for the wildfly-maven-plugin to execute CLI commands. So it doesn't look like it will ever be overridden for core tests. Is this something separate I should look at fixing?", "author": "jamezp", "createdAt": "2020-12-09T01:20:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODc3MDMzMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTU4NjIzOQ==", "url": "https://github.com/wildfly/wildfly-core/pull/4424#discussion_r539586239", "bodyText": "I have no idea :)\nI'd say if we can find something that doesn't do perform the function it should then we can fix it!", "author": "bstansberry", "createdAt": "2020-12-09T19:29:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODc3MDMzMw=="}], "type": "inlineReview"}]}