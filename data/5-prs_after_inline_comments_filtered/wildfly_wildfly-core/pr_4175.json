{"pr_number": 4175, "pr_title": "[WFCORE-4901] TCCL not set to application classloader when MBean Noti\u2026", "pr_createdAt": "2020-04-21T15:16:35Z", "pr_url": "https://github.com/wildfly/wildfly-core/pull/4175", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjMxNDM3MA==", "url": "https://github.com/wildfly/wildfly-core/pull/4175#discussion_r412314370", "bodyText": "Minor: can you call this \"testNotificationTccl\"?  Or something like that.", "author": "bstansberry", "createdAt": "2020-04-21T16:39:55Z", "path": "jmx/src/test/java/org/jboss/as/jmx/PluggableMBeanServerTestCase.java", "diffHunk": "@@ -105,6 +112,33 @@ public void testReservedDomainMBeanRegistrationFails() throws Exception {\n         reservedDomainTest(\"jboss.as.expr:bean=test-null\", NAME);\n     }\n \n+    @Test\n+    public void testTccl() throws Exception {", "originalCommit": "bcb1ecbc6ea7a2922b92f85dd6291d90edce15d9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjcwMjA3NA==", "url": "https://github.com/wildfly/wildfly-core/pull/4175#discussion_r412702074", "bodyText": "@bstansberry  I've changed it to testNotificationTccl", "author": "moulalis", "createdAt": "2020-04-22T06:22:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjMxNDM3MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjMxNTg0MA==", "url": "https://github.com/wildfly/wildfly-core/pull/4175#discussion_r412315840", "bodyText": "If you change the return type of this method to ClassLoader, then you can add this:\nreturn WildFlySecurityManager.getCurrentContextClassLoaderPrivileged();\n\nAnd then the test can validate that it returns newOutTccl. That both serves as a sanity check that newOutTccl was in place before the notification handling, and confirms that it got restored.", "author": "bstansberry", "createdAt": "2020-04-21T16:42:15Z", "path": "jmx/src/test/java/org/jboss/as/jmx/PluggableMBeanServerTestCase.java", "diffHunk": "@@ -165,6 +199,10 @@ public void preDeregister() throws Exception {\n         public void postDeregister() {\n         }\n \n+        @Override\n+        public void proceed() {\n+            sendNotification(new Notification(\"testtccl\", 1, 1));", "originalCommit": "bcb1ecbc6ea7a2922b92f85dd6291d90edce15d9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjcwMDQ3OA==", "url": "https://github.com/wildfly/wildfly-core/pull/4175#discussion_r412700478", "bodyText": "@bstansberry  I've Renamed it to testNotificationTccl. Initailly I did the same as returntype ClassLoader, But I thought this is not invoking notification was just a test,  so I wrote it inside notification, In that way it actually invoked notification and test the same. Is that okay to have this or still you want me to change?", "author": "moulalis", "createdAt": "2020-04-22T06:19:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjMxNTg0MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjcwMjQ1Nw==", "url": "https://github.com/wildfly/wildfly-core/pull/4175#discussion_r412702457", "bodyText": "@bstansberry  Initailly I did the same as returntype ClassLoader, But I thought this is not invoking notification was just a test, so I wrote it inside notification, In that way it actually invoked notification and test the same. Is that okay to have this or still you want me to change?", "author": "moulalis", "createdAt": "2020-04-22T06:23:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjMxNTg0MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzQ1NTI4MA==", "url": "https://github.com/wildfly/wildfly-core/pull/4175#discussion_r413455280", "bodyText": "What your NotificationListener is doing is fine -- it checks that the expected TCCL is in place when it is invoked. I was suggesting an additional check that the expected TCCL (newOutTccl) is in place after the notification call is done.\nBut this is ok as is.", "author": "bstansberry", "createdAt": "2020-04-23T02:05:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjMxNTg0MA=="}], "type": "inlineReview"}, {"oid": "6b661ba0beb1af1c9f3923b9f6edb23cc528f2d1", "url": "https://github.com/wildfly/wildfly-core/commit/6b661ba0beb1af1c9f3923b9f6edb23cc528f2d1", "message": "[WFCORE-4901] TCCL not set to application classloader when MBean Notification is invoked\n\n[WFCORE-4901] TCCL not set to application classloader when MBean Notification is invoked", "committedDate": "2020-04-22T06:13:08Z", "type": "commit"}, {"oid": "6b661ba0beb1af1c9f3923b9f6edb23cc528f2d1", "url": "https://github.com/wildfly/wildfly-core/commit/6b661ba0beb1af1c9f3923b9f6edb23cc528f2d1", "message": "[WFCORE-4901] TCCL not set to application classloader when MBean Notification is invoked\n\n[WFCORE-4901] TCCL not set to application classloader when MBean Notification is invoked", "committedDate": "2020-04-22T06:13:08Z", "type": "forcePushed"}]}