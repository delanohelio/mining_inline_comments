{"pr_number": 3204, "pr_title": "Create ExprArrowCriticalState.java", "pr_createdAt": "2020-07-24T16:42:10Z", "pr_url": "https://github.com/SkriptLang/Skript/pull/3204", "timeline": [{"oid": "02d53db9543650c5b53258b88e4bcdeb5e9cf128", "url": "https://github.com/SkriptLang/Skript/commit/02d53db9543650c5b53258b88e4bcdeb5e9cf128", "message": "Create ExprArrowCriticalState.java", "committedDate": "2020-07-24T16:41:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDE3MzUzNw==", "url": "https://github.com/SkriptLang/Skript/pull/3204#discussion_r460173537", "bodyText": "You accidentally put 'mode state'", "author": "APickledWalrus", "createdAt": "2020-07-24T16:53:59Z", "path": "src/main/java/ch/njol/skript/expressions/ExprArrowCriticalState.java", "diffHunk": "@@ -0,0 +1,78 @@\n+/**\n+ * This file is part of Skript.\n+ *\n+ * Skript is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * Skript is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with Skript.  If not, see <http://www.gnu.org/licenses/>.\n+ *\n+ *\n+ * Copyright 2011-2017 Peter G\u00fcttinger and contributors\n+ */\n+package ch.njol.skript.expressions;\n+\n+import org.bukkit.entity.Arrow;\n+import org.bukkit.entity.Entity;\n+import org.bukkit.event.Event;\n+import org.eclipse.jdt.annotation.Nullable;\n+\n+import ch.njol.skript.classes.Changer.ChangeMode;\n+import ch.njol.skript.doc.Description;\n+import ch.njol.skript.doc.Examples;\n+import ch.njol.skript.doc.Name;\n+import ch.njol.skript.expressions.base.SimplePropertyExpression;\n+import ch.njol.util.coll.CollectionUtils;\n+\n+@Name(\"Arrow Critical State\")\n+@Description(\"An arrow's critical state.\")\n+@Examples(\"set critical mode state of last shot arrow to true\")", "originalCommit": "02d53db9543650c5b53258b88e4bcdeb5e9cf128", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDE4NTA5Nw==", "url": "https://github.com/SkriptLang/Skript/pull/3204#discussion_r460185097", "bodyText": "Oop", "author": "DeltaRays", "createdAt": "2020-07-24T17:17:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDE3MzUzNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDE3NTI2MA==", "url": "https://github.com/SkriptLang/Skript/pull/3204#discussion_r460175260", "bodyText": "Instead of having two loops, you might be able to it with just one (e.g)\nboolean state = delta != null ? (Boolean) delta[0] : false;", "author": "APickledWalrus", "createdAt": "2020-07-24T16:57:21Z", "path": "src/main/java/ch/njol/skript/expressions/ExprArrowCriticalState.java", "diffHunk": "@@ -0,0 +1,78 @@\n+/**\n+ * This file is part of Skript.\n+ *\n+ * Skript is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * Skript is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with Skript.  If not, see <http://www.gnu.org/licenses/>.\n+ *\n+ *\n+ * Copyright 2011-2017 Peter G\u00fcttinger and contributors\n+ */\n+package ch.njol.skript.expressions;\n+\n+import org.bukkit.entity.Arrow;\n+import org.bukkit.entity.Entity;\n+import org.bukkit.event.Event;\n+import org.eclipse.jdt.annotation.Nullable;\n+\n+import ch.njol.skript.classes.Changer.ChangeMode;\n+import ch.njol.skript.doc.Description;\n+import ch.njol.skript.doc.Examples;\n+import ch.njol.skript.doc.Name;\n+import ch.njol.skript.expressions.base.SimplePropertyExpression;\n+import ch.njol.util.coll.CollectionUtils;\n+\n+@Name(\"Arrow Critical State\")\n+@Description(\"An arrow's critical state.\")\n+@Examples(\"set critical mode state of last shot arrow to true\")\n+public class ExprArrowCriticalState extends SimplePropertyExpression<Entity, Boolean> {\n+\t\n+\tstatic {\n+\t\tregister(ExprArrowCriticalState.class, Boolean.class, \"[the] critical arrow (state|ability|mode)\", \"entities\");\n+\t}\n+\t\n+\t@Nullable\n+\t@Override\n+\tpublic Boolean convert(Entity arrow) {\n+\t\treturn arrow instanceof Arrow ? ((Arrow) arrow).isCritical() : null;\n+\t}\n+\t\n+\t@Nullable\n+\t@Override\n+\tpublic Class<?>[] acceptChange(ChangeMode mode) {\n+\t\treturn (mode == ChangeMode.SET || mode == ChangeMode.RESET) ? CollectionUtils.array(Boolean.class) : null;\n+\t}\n+\t\n+\t@Override\n+\tpublic void change(Event e, @Nullable Object[] delta, ChangeMode mode) {\n+\t\tif (delta == null || delta.length < 1) {", "originalCommit": "02d53db9543650c5b53258b88e4bcdeb5e9cf128", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDE4NTcxOA==", "url": "https://github.com/SkriptLang/Skript/pull/3204#discussion_r460185718", "bodyText": "Yeah, the issue is that the code doesn't work because 'last shot arrow' only works when you 'artificially' shoot the arrow (with the shoot effect)", "author": "DeltaRays", "createdAt": "2020-07-24T17:18:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDE3NTI2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDE4NjIwNg==", "url": "https://github.com/SkriptLang/Skript/pull/3204#discussion_r460186206", "bodyText": "So I don't know whether I should make it so it uses projectiles or make it so when a projectile is shot the last shot projectile is set to that", "author": "DeltaRays", "createdAt": "2020-07-24T17:19:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDE3NTI2MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDE3NTk0MA==", "url": "https://github.com/SkriptLang/Skript/pull/3204#discussion_r460175940", "bodyText": "Move if check onto a separate line \ud83d\ude42", "author": "APickledWalrus", "createdAt": "2020-07-24T16:58:38Z", "path": "src/main/java/ch/njol/skript/expressions/ExprArrowCriticalState.java", "diffHunk": "@@ -0,0 +1,78 @@\n+/**\n+ * This file is part of Skript.\n+ *\n+ * Skript is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * Skript is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with Skript.  If not, see <http://www.gnu.org/licenses/>.\n+ *\n+ *\n+ * Copyright 2011-2017 Peter G\u00fcttinger and contributors\n+ */\n+package ch.njol.skript.expressions;\n+\n+import org.bukkit.entity.Arrow;\n+import org.bukkit.entity.Entity;\n+import org.bukkit.event.Event;\n+import org.eclipse.jdt.annotation.Nullable;\n+\n+import ch.njol.skript.classes.Changer.ChangeMode;\n+import ch.njol.skript.doc.Description;\n+import ch.njol.skript.doc.Examples;\n+import ch.njol.skript.doc.Name;\n+import ch.njol.skript.expressions.base.SimplePropertyExpression;\n+import ch.njol.util.coll.CollectionUtils;\n+\n+@Name(\"Arrow Critical State\")\n+@Description(\"An arrow's critical state.\")\n+@Examples(\"set critical mode state of last shot arrow to true\")\n+public class ExprArrowCriticalState extends SimplePropertyExpression<Entity, Boolean> {\n+\t\n+\tstatic {\n+\t\tregister(ExprArrowCriticalState.class, Boolean.class, \"[the] critical arrow (state|ability|mode)\", \"entities\");\n+\t}\n+\t\n+\t@Nullable\n+\t@Override\n+\tpublic Boolean convert(Entity arrow) {\n+\t\treturn arrow instanceof Arrow ? ((Arrow) arrow).isCritical() : null;\n+\t}\n+\t\n+\t@Nullable\n+\t@Override\n+\tpublic Class<?>[] acceptChange(ChangeMode mode) {\n+\t\treturn (mode == ChangeMode.SET || mode == ChangeMode.RESET) ? CollectionUtils.array(Boolean.class) : null;\n+\t}\n+\t\n+\t@Override\n+\tpublic void change(Event e, @Nullable Object[] delta, ChangeMode mode) {\n+\t\tif (delta == null || delta.length < 1) {\n+\t\t\tfor (Entity entity : getExpr().getAll(e)) {\n+\t\t\t\tif (entity instanceof Arrow) ((Arrow) entity).setCritical(false);\n+\t\t\t}\n+\t\t} else {\n+\t\t\tfor (Entity entity : getExpr().getAll(e)) {\n+\t\t\t\tif (entity instanceof Arrow) ((Arrow) entity).setCritical((Boolean) delta[0]);", "originalCommit": "02d53db9543650c5b53258b88e4bcdeb5e9cf128", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "535d181296fefb12d9f054108bca338db8759c7b", "url": "https://github.com/SkriptLang/Skript/commit/535d181296fefb12d9f054108bca338db8759c7b", "message": "Fixed the critical state", "committedDate": "2020-07-24T18:01:46Z", "type": "commit"}, {"oid": "5b587668a2070a15553cc8a720a3ecedf147aa5d", "url": "https://github.com/SkriptLang/Skript/commit/5b587668a2070a15553cc8a720a3ecedf147aa5d", "message": "Updated the example and added @Since(\"INSERT VERSION\")", "committedDate": "2020-07-24T18:05:35Z", "type": "commit"}, {"oid": "6e11c5f092f81f58999ea1e6ee8567b963c54f52", "url": "https://github.com/SkriptLang/Skript/commit/6e11c5f092f81f58999ea1e6ee8567b963c54f52", "message": "Added support for tridents", "committedDate": "2020-07-24T18:45:12Z", "type": "commit"}, {"oid": "a9df4783df2fc044655f88000b38c6b1c9fb5ced", "url": "https://github.com/SkriptLang/Skript/commit/a9df4783df2fc044655f88000b38c6b1c9fb5ced", "message": "Changed a few names from Arrow to Projectile", "committedDate": "2020-07-24T18:47:38Z", "type": "commit"}, {"oid": "0de4513195290d921d5b27664b15577ccfdcbaa6", "url": "https://github.com/SkriptLang/Skript/commit/0de4513195290d921d5b27664b15577ccfdcbaa6", "message": "Formatted the lines", "committedDate": "2020-07-24T20:31:49Z", "type": "commit"}, {"oid": "5fe8ef855b40a84a36d1a6977ff239789ed2bfcb", "url": "https://github.com/SkriptLang/Skript/commit/5fe8ef855b40a84a36d1a6977ff239789ed2bfcb", "message": "Merge branch 'master' into ArrowCriticalState", "committedDate": "2020-07-25T18:07:41Z", "type": "commit"}, {"oid": "edc7279946b642cea0f96d490c63c4a6fe96215d", "url": "https://github.com/SkriptLang/Skript/commit/edc7279946b642cea0f96d490c63c4a6fe96215d", "message": "Merge remote-tracking branch 'origin/ArrowCriticalState' into ArrowCriticalState", "committedDate": "2020-07-25T19:22:44Z", "type": "commit"}, {"oid": "41b7ad499658d67f3504ac1c00700865b0b42d59", "url": "https://github.com/SkriptLang/Skript/commit/41b7ad499658d67f3504ac1c00700865b0b42d59", "message": "Began working on ProjectileIsCritical", "committedDate": "2020-07-25T19:28:34Z", "type": "commit"}, {"oid": "d616ad6caf3a155a5984fdde7df5afa2aa794e02", "url": "https://github.com/SkriptLang/Skript/commit/d616ad6caf3a155a5984fdde7df5afa2aa794e02", "message": "Removed is critical (is it worth adding)", "committedDate": "2020-07-25T19:31:15Z", "type": "commit"}, {"oid": "29d3aed51f2c9fab7f644741a8073d0325d181d8", "url": "https://github.com/SkriptLang/Skript/commit/29d3aed51f2c9fab7f644741a8073d0325d181d8", "message": "Merge branch 'master' into ArrowCriticalState", "committedDate": "2020-07-26T09:49:50Z", "type": "commit"}, {"oid": "b0a072f2bc3f778378a1baf2b438b18a87256e01", "url": "https://github.com/SkriptLang/Skript/commit/b0a072f2bc3f778378a1baf2b438b18a87256e01", "message": "Updated the ProjectileCriticalState copyright comment", "committedDate": "2020-07-26T09:51:59Z", "type": "commit"}, {"oid": "93a1f8e82e41aef7cfd4566826ec8ea2a561adfc", "url": "https://github.com/SkriptLang/Skript/commit/93a1f8e82e41aef7cfd4566826ec8ea2a561adfc", "message": "Merge remote-tracking branch 'origin/ArrowCriticalState' into ArrowCriticalState", "committedDate": "2020-07-26T09:52:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzI1NjU4Ng==", "url": "https://github.com/SkriptLang/Skript/pull/3204#discussion_r463256586", "bodyText": "Accident empty line ;)", "author": "APickledWalrus", "createdAt": "2020-07-30T20:37:09Z", "path": "src/main/java/ch/njol/skript/expressions/ExprProjectileCriticalState.java", "diffHunk": "@@ -0,0 +1,88 @@\n+/**\n+ * This file is part of Skript.\n+ *\n+ * Skript is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * Skript is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with Skript.  If not, see <http://www.gnu.org/licenses/>.\n+ *\n+ *\n+ * Copyright 2011-2017 Peter G\u00fcttinger and contributors\n+ */\n+package ch.njol.skript.expressions;\n+\n+import org.bukkit.entity.AbstractArrow;\n+import org.bukkit.entity.Arrow;\n+import org.bukkit.entity.Projectile;\n+import org.bukkit.event.Event;\n+import org.eclipse.jdt.annotation.Nullable;\n+\n+import ch.njol.skript.Skript;\n+import ch.njol.skript.classes.Changer.ChangeMode;\n+import ch.njol.skript.doc.Description;\n+import ch.njol.skript.doc.Examples;\n+import ch.njol.skript.doc.Name;\n+import ch.njol.skript.doc.Since;\n+import ch.njol.skript.expressions.base.SimplePropertyExpression;\n+import ch.njol.util.coll.CollectionUtils;\n+\n+@Name(\"Projectile Critical State\")\n+@Description(\"A projectile's critical state. The only currently accepted projectiles are arrows and tridents.\")\n+@Examples({\"on shoot:\",\n+\t\"\\tevent-projectile is an arrow\",\n+\t\"\\tset projectile critical mode of event-projectile to true\"})\n+@Since(\"INSERT VERSION\")\n+public class ExprProjectileCriticalState extends SimplePropertyExpression<Projectile, Boolean> {\n+\t\n+\tstatic {\n+\t\tregister(ExprProjectileCriticalState.class, Boolean.class, \"[the] (projectile|arrow) critical (state|ability|mode)\", \"projectiles\");\n+\t}\n+\t\n+\tboolean abstractArrowExists = Skript.classExists(\"org.bukkit.entity.AbstractArrow\");\n+\t\n+\t@Nullable\n+\t@Override\n+\tpublic Boolean convert(Projectile arrow) {\n+\t\t", "originalCommit": "93a1f8e82e41aef7cfd4566826ec8ea2a561adfc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzI1NjY0Mw==", "url": "https://github.com/SkriptLang/Skript/pull/3204#discussion_r463256643", "bodyText": "should be a constant", "author": "APickledWalrus", "createdAt": "2020-07-30T20:37:18Z", "path": "src/main/java/ch/njol/skript/expressions/ExprProjectileCriticalState.java", "diffHunk": "@@ -0,0 +1,88 @@\n+/**\n+ * This file is part of Skript.\n+ *\n+ * Skript is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * Skript is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with Skript.  If not, see <http://www.gnu.org/licenses/>.\n+ *\n+ *\n+ * Copyright 2011-2017 Peter G\u00fcttinger and contributors\n+ */\n+package ch.njol.skript.expressions;\n+\n+import org.bukkit.entity.AbstractArrow;\n+import org.bukkit.entity.Arrow;\n+import org.bukkit.entity.Projectile;\n+import org.bukkit.event.Event;\n+import org.eclipse.jdt.annotation.Nullable;\n+\n+import ch.njol.skript.Skript;\n+import ch.njol.skript.classes.Changer.ChangeMode;\n+import ch.njol.skript.doc.Description;\n+import ch.njol.skript.doc.Examples;\n+import ch.njol.skript.doc.Name;\n+import ch.njol.skript.doc.Since;\n+import ch.njol.skript.expressions.base.SimplePropertyExpression;\n+import ch.njol.util.coll.CollectionUtils;\n+\n+@Name(\"Projectile Critical State\")\n+@Description(\"A projectile's critical state. The only currently accepted projectiles are arrows and tridents.\")\n+@Examples({\"on shoot:\",\n+\t\"\\tevent-projectile is an arrow\",\n+\t\"\\tset projectile critical mode of event-projectile to true\"})\n+@Since(\"INSERT VERSION\")\n+public class ExprProjectileCriticalState extends SimplePropertyExpression<Projectile, Boolean> {\n+\t\n+\tstatic {\n+\t\tregister(ExprProjectileCriticalState.class, Boolean.class, \"[the] (projectile|arrow) critical (state|ability|mode)\", \"projectiles\");\n+\t}\n+\t\n+\tboolean abstractArrowExists = Skript.classExists(\"org.bukkit.entity.AbstractArrow\");", "originalCommit": "93a1f8e82e41aef7cfd4566826ec8ea2a561adfc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "c9254be2a0d9b5e46748b33a44bfae342dfff973", "url": "https://github.com/SkriptLang/Skript/commit/c9254be2a0d9b5e46748b33a44bfae342dfff973", "message": "Merge branch 'master' into ArrowCriticalState", "committedDate": "2020-07-31T11:13:54Z", "type": "commit"}, {"oid": "8fd8a62445023f23dc106394f67a148cbc1f38b4", "url": "https://github.com/SkriptLang/Skript/commit/8fd8a62445023f23dc106394f67a148cbc1f38b4", "message": "Updated everything (thanks apickledwalrus)", "committedDate": "2020-07-31T11:14:45Z", "type": "commit"}, {"oid": "5c2b5113d377abee3d5f0b76f27e7e8fa0ffaecf", "url": "https://github.com/SkriptLang/Skript/commit/5c2b5113d377abee3d5f0b76f27e7e8fa0ffaecf", "message": "Merge remote-tracking branch 'origin/ArrowCriticalState' into ArrowCriticalState", "committedDate": "2020-07-31T11:15:44Z", "type": "commit"}, {"oid": "d45eb9916ed1f0ca3699e9c15e0fd6fc3281428b", "url": "https://github.com/SkriptLang/Skript/commit/d45eb9916ed1f0ca3699e9c15e0fd6fc3281428b", "message": "Merge branch 'master' into ArrowCriticalState", "committedDate": "2020-08-02T16:24:35Z", "type": "commit"}, {"oid": "b1a1cc70cd7f3a5227bed982f37298c153837601", "url": "https://github.com/SkriptLang/Skript/commit/b1a1cc70cd7f3a5227bed982f37298c153837601", "message": "Merge branch 'master' into ArrowCriticalState", "committedDate": "2020-09-08T18:46:03Z", "type": "commit"}, {"oid": "e4c982d16ac9b5f6b29e69cf5e82c411daf6e3e7", "url": "https://github.com/SkriptLang/Skript/commit/e4c982d16ac9b5f6b29e69cf5e82c411daf6e3e7", "message": "Merge branch 'master' into ArrowCriticalState", "committedDate": "2020-09-26T09:55:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTQ4NDM0MQ==", "url": "https://github.com/SkriptLang/Skript/pull/3204#discussion_r495484341", "bodyText": "You should have curly braces on this else if statement IMO", "author": "APickledWalrus", "createdAt": "2020-09-26T18:49:04Z", "path": "src/main/java/ch/njol/skript/expressions/ExprProjectileCriticalState.java", "diffHunk": "@@ -0,0 +1,87 @@\n+/**\n+ * This file is part of Skript.\n+ *\n+ * Skript is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * Skript is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with Skript.  If not, see <http://www.gnu.org/licenses/>.\n+ *\n+ *\n+ * Copyright 2011-2017 Peter G\u00fcttinger and contributors\n+ */\n+package ch.njol.skript.expressions;\n+\n+import org.bukkit.entity.AbstractArrow;\n+import org.bukkit.entity.Arrow;\n+import org.bukkit.entity.Projectile;\n+import org.bukkit.event.Event;\n+import org.eclipse.jdt.annotation.Nullable;\n+\n+import ch.njol.skript.Skript;\n+import ch.njol.skript.classes.Changer.ChangeMode;\n+import ch.njol.skript.doc.Description;\n+import ch.njol.skript.doc.Examples;\n+import ch.njol.skript.doc.Name;\n+import ch.njol.skript.doc.Since;\n+import ch.njol.skript.expressions.base.SimplePropertyExpression;\n+import ch.njol.util.coll.CollectionUtils;\n+\n+@Name(\"Projectile Critical State\")\n+@Description(\"A projectile's critical state. The only currently accepted projectiles are arrows and tridents.\")\n+@Examples({\"on shoot:\",\n+\t\"\\tevent-projectile is an arrow\",\n+\t\"\\tset projectile critical mode of event-projectile to true\"})\n+@Since(\"INSERT VERSION\")\n+public class ExprProjectileCriticalState extends SimplePropertyExpression<Projectile, Boolean> {\n+\t\n+\tprivate static final boolean abstractArrowExists = Skript.classExists(\"org.bukkit.entity.AbstractArrow\");\n+\t\n+\tstatic {\n+\t\tregister(ExprProjectileCriticalState.class, Boolean.class, \"[the] (projectile|arrow) critical (state|ability|mode)\", \"projectiles\");\n+\t}\n+\t\n+\t@Nullable\n+\t@Override\n+\tpublic Boolean convert(Projectile arrow) {\n+\t\tif (abstractArrowExists)\n+\t\t\treturn arrow instanceof AbstractArrow ? ((AbstractArrow) arrow).isCritical() : null;\n+\t\treturn arrow instanceof Arrow ? ((Arrow) arrow).isCritical() : null;\n+\t}\n+\t\n+\t@Nullable\n+\t@Override\n+\tpublic Class<?>[] acceptChange(ChangeMode mode) {\n+\t\treturn (mode == ChangeMode.SET) ? CollectionUtils.array(Boolean.class) : null;\n+\t}\n+\t\n+\t@Override\n+\tpublic void change(Event e, @Nullable Object[] delta, ChangeMode mode) {\n+\t\tboolean state = delta != null ? (Boolean) delta[0] : false;\n+\t\tfor (Projectile entity : getExpr().getAll(e)) {\n+\t\t\tif (abstractArrowExists) {\n+\t\t\t\tif (entity instanceof AbstractArrow)\n+\t\t\t\t\t((AbstractArrow) entity).setCritical(state);\n+\t\t\t} else if (entity instanceof Arrow)", "originalCommit": "e4c982d16ac9b5f6b29e69cf5e82c411daf6e3e7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTQ4NTkxMA==", "url": "https://github.com/SkriptLang/Skript/pull/3204#discussion_r495485910", "bodyText": "Ngl I was expecting 'add a default case'", "author": "DeltaRays", "createdAt": "2020-09-26T19:06:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTQ4NDM0MQ=="}], "type": "inlineReview"}, {"oid": "b1ea16ca5e2b9d28a48fa2f3a0ca027550668971", "url": "https://github.com/SkriptLang/Skript/commit/b1ea16ca5e2b9d28a48fa2f3a0ca027550668971", "message": "Default case :sunglasses: (Curly braces)", "committedDate": "2020-09-26T19:07:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTUwMzI4Nw==", "url": "https://github.com/SkriptLang/Skript/pull/3204#discussion_r495503287", "bodyText": "You shouldn't do anything if delta is null. I missed that in my original review.", "author": "APickledWalrus", "createdAt": "2020-09-26T22:51:11Z", "path": "src/main/java/ch/njol/skript/expressions/ExprProjectileCriticalState.java", "diffHunk": "@@ -0,0 +1,88 @@\n+/**\n+ * This file is part of Skript.\n+ *\n+ * Skript is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * Skript is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with Skript.  If not, see <http://www.gnu.org/licenses/>.\n+ *\n+ *\n+ * Copyright 2011-2017 Peter G\u00fcttinger and contributors\n+ */\n+package ch.njol.skript.expressions;\n+\n+import org.bukkit.entity.AbstractArrow;\n+import org.bukkit.entity.Arrow;\n+import org.bukkit.entity.Projectile;\n+import org.bukkit.event.Event;\n+import org.eclipse.jdt.annotation.Nullable;\n+\n+import ch.njol.skript.Skript;\n+import ch.njol.skript.classes.Changer.ChangeMode;\n+import ch.njol.skript.doc.Description;\n+import ch.njol.skript.doc.Examples;\n+import ch.njol.skript.doc.Name;\n+import ch.njol.skript.doc.Since;\n+import ch.njol.skript.expressions.base.SimplePropertyExpression;\n+import ch.njol.util.coll.CollectionUtils;\n+\n+@Name(\"Projectile Critical State\")\n+@Description(\"A projectile's critical state. The only currently accepted projectiles are arrows and tridents.\")\n+@Examples({\"on shoot:\",\n+\t\"\\tevent-projectile is an arrow\",\n+\t\"\\tset projectile critical mode of event-projectile to true\"})\n+@Since(\"INSERT VERSION\")\n+public class ExprProjectileCriticalState extends SimplePropertyExpression<Projectile, Boolean> {\n+\t\n+\tprivate static final boolean abstractArrowExists = Skript.classExists(\"org.bukkit.entity.AbstractArrow\");\n+\t\n+\tstatic {\n+\t\tregister(ExprProjectileCriticalState.class, Boolean.class, \"[the] (projectile|arrow) critical (state|ability|mode)\", \"projectiles\");\n+\t}\n+\t\n+\t@Nullable\n+\t@Override\n+\tpublic Boolean convert(Projectile arrow) {\n+\t\tif (abstractArrowExists)\n+\t\t\treturn arrow instanceof AbstractArrow ? ((AbstractArrow) arrow).isCritical() : null;\n+\t\treturn arrow instanceof Arrow ? ((Arrow) arrow).isCritical() : null;\n+\t}\n+\t\n+\t@Nullable\n+\t@Override\n+\tpublic Class<?>[] acceptChange(ChangeMode mode) {\n+\t\treturn (mode == ChangeMode.SET) ? CollectionUtils.array(Boolean.class) : null;\n+\t}\n+\t\n+\t@Override\n+\tpublic void change(Event e, @Nullable Object[] delta, ChangeMode mode) {\n+\t\tboolean state = delta != null ? (Boolean) delta[0] : false;", "originalCommit": "b1ea16ca5e2b9d28a48fa2f3a0ca027550668971", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "42f6f553c0ed27411da1f2999bc01e4016bdb5de", "url": "https://github.com/SkriptLang/Skript/commit/42f6f553c0ed27411da1f2999bc01e4016bdb5de", "message": "Update ExprProjectileCriticalState.java", "committedDate": "2020-09-27T04:41:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTYwNDQ5NA==", "url": "https://github.com/SkriptLang/Skript/pull/3204#discussion_r495604494", "bodyText": "can't this all be one line? if (abstractArrowExists && entity instanceof AbstractArrow)", "author": "Pikachu920", "createdAt": "2020-09-27T19:06:48Z", "path": "src/main/java/ch/njol/skript/expressions/ExprProjectileCriticalState.java", "diffHunk": "@@ -0,0 +1,89 @@\n+/**\n+ * This file is part of Skript.\n+ *\n+ * Skript is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * Skript is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with Skript.  If not, see <http://www.gnu.org/licenses/>.\n+ *\n+ *\n+ * Copyright 2011-2017 Peter G\u00fcttinger and contributors\n+ */\n+package ch.njol.skript.expressions;\n+\n+import org.bukkit.entity.AbstractArrow;\n+import org.bukkit.entity.Arrow;\n+import org.bukkit.entity.Projectile;\n+import org.bukkit.event.Event;\n+import org.eclipse.jdt.annotation.Nullable;\n+\n+import ch.njol.skript.Skript;\n+import ch.njol.skript.classes.Changer.ChangeMode;\n+import ch.njol.skript.doc.Description;\n+import ch.njol.skript.doc.Examples;\n+import ch.njol.skript.doc.Name;\n+import ch.njol.skript.doc.Since;\n+import ch.njol.skript.expressions.base.SimplePropertyExpression;\n+import ch.njol.util.coll.CollectionUtils;\n+\n+@Name(\"Projectile Critical State\")\n+@Description(\"A projectile's critical state. The only currently accepted projectiles are arrows and tridents.\")\n+@Examples({\"on shoot:\",\n+\t\"\\tevent-projectile is an arrow\",\n+\t\"\\tset projectile critical mode of event-projectile to true\"})\n+@Since(\"INSERT VERSION\")\n+public class ExprProjectileCriticalState extends SimplePropertyExpression<Projectile, Boolean> {\n+\t\n+\tprivate static final boolean abstractArrowExists = Skript.classExists(\"org.bukkit.entity.AbstractArrow\");\n+\t\n+\tstatic {\n+\t\tregister(ExprProjectileCriticalState.class, Boolean.class, \"[the] (projectile|arrow) critical (state|ability|mode)\", \"projectiles\");\n+\t}\n+\t\n+\t@Nullable\n+\t@Override\n+\tpublic Boolean convert(Projectile arrow) {\n+\t\tif (abstractArrowExists)\n+\t\t\treturn arrow instanceof AbstractArrow ? ((AbstractArrow) arrow).isCritical() : null;\n+\t\treturn arrow instanceof Arrow ? ((Arrow) arrow).isCritical() : null;\n+\t}\n+\t\n+\t@Nullable\n+\t@Override\n+\tpublic Class<?>[] acceptChange(ChangeMode mode) {\n+\t\treturn (mode == ChangeMode.SET) ? CollectionUtils.array(Boolean.class) : null;\n+\t}\n+\t\n+\t@Override\n+\tpublic void change(Event e, @Nullable Object[] delta, ChangeMode mode) {\n+\t\tif (delta == null) return;\n+\t\tboolean state = (Boolean) delta[0];\n+\t\tfor (Projectile entity : getExpr().getAll(e)) {\n+\t\t\tif (abstractArrowExists) {", "originalCommit": "42f6f553c0ed27411da1f2999bc01e4016bdb5de", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTgzNTkwNQ==", "url": "https://github.com/SkriptLang/Skript/pull/3204#discussion_r495835905", "bodyText": "Yeah sorry I was used to languages in which it checks for all the conditions so it would cause issues if AbstractArror wasn't set", "author": "DeltaRays", "createdAt": "2020-09-28T10:20:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTYwNDQ5NA=="}], "type": "inlineReview"}, {"oid": "9030cfa95a57f3a89a1967e7b2daeb8524df2bd8", "url": "https://github.com/SkriptLang/Skript/commit/9030cfa95a57f3a89a1967e7b2daeb8524df2bd8", "message": "Update ExprProjectileCriticalState.java", "committedDate": "2020-09-28T10:21:03Z", "type": "commit"}, {"oid": "5101b62ef8cf33ec2438957ddb7c269da7a7e2e2", "url": "https://github.com/SkriptLang/Skript/commit/5101b62ef8cf33ec2438957ddb7c269da7a7e2e2", "message": "Merge branch 'master' into ArrowCriticalState", "committedDate": "2020-09-29T22:06:20Z", "type": "commit"}, {"oid": "4ae6e2c305949cab283dca20a7f689faa7c6dd32", "url": "https://github.com/SkriptLang/Skript/commit/4ae6e2c305949cab283dca20a7f689faa7c6dd32", "message": "Update copyright header", "committedDate": "2020-09-29T22:06:45Z", "type": "commit"}, {"oid": "69567cff1641b62b5d83b17075d19d9bd9548b5b", "url": "https://github.com/SkriptLang/Skript/commit/69567cff1641b62b5d83b17075d19d9bd9548b5b", "message": "Merge branch 'dev-2.5' into ArrowCriticalState", "committedDate": "2020-09-29T22:07:29Z", "type": "commit"}]}