{"pr_number": 3281, "pr_title": "Fix setting item amount of slots", "pr_createdAt": "2020-08-06T21:38:27Z", "pr_url": "https://github.com/SkriptLang/Skript/pull/3281", "timeline": [{"oid": "05be906686d0f742a3eb6570da565c935a8b4a37", "url": "https://github.com/SkriptLang/Skript/commit/05be906686d0f742a3eb6570da565c935a8b4a37", "message": "Introducing block state modification", "committedDate": "2020-08-03T08:11:23Z", "type": "commit"}, {"oid": "2ea350b47773ff6ebaf48bf6a3c44833778e7838", "url": "https://github.com/SkriptLang/Skript/commit/2ea350b47773ff6ebaf48bf6a3c44833778e7838", "message": "Revert \"Introducing block state modification\"\n\nThis reverts commit 05be9066", "committedDate": "2020-08-03T08:24:46Z", "type": "commit"}, {"oid": "29a0869b3b6553fc1043066413d30c2ffe486916", "url": "https://github.com/SkriptLang/Skript/commit/29a0869b3b6553fc1043066413d30c2ffe486916", "message": "Merge branch 'master' of https://github.com/SkriptLang/Skript", "committedDate": "2020-08-06T18:58:31Z", "type": "commit"}, {"oid": "23785c76083b6eca9c26a3c9cd0d7674def09aa8", "url": "https://github.com/SkriptLang/Skript/commit/23785c76083b6eca9c26a3c9cd0d7674def09aa8", "message": "Merge branch 'master' of https://github.com/SkriptLang/Skript", "committedDate": "2020-08-06T20:48:52Z", "type": "commit"}, {"oid": "7214afcc167507530f1c281db2de13fcf20054b8", "url": "https://github.com/SkriptLang/Skript/commit/7214afcc167507530f1c281db2de13fcf20054b8", "message": "Slot - add methods to get/set amount", "committedDate": "2020-08-06T21:33:03Z", "type": "commit"}, {"oid": "c38b485890abfc34c98e8a912ae57dd0faf5dfe3", "url": "https://github.com/SkriptLang/Skript/commit/c38b485890abfc34c98e8a912ae57dd0faf5dfe3", "message": "ExprItemAmount - add \"slot\" as an option to get/set item amount for slots", "committedDate": "2020-08-06T21:33:35Z", "type": "commit"}, {"oid": "f0184696b1041a5667e353939200ee3b68b52908", "url": "https://github.com/SkriptLang/Skript/commit/f0184696b1041a5667e353939200ee3b68b52908", "message": "InventorySlot - revert line endings", "committedDate": "2020-08-06T21:34:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc2MDcwMw==", "url": "https://github.com/SkriptLang/Skript/pull/3281#discussion_r466760703", "bodyText": "Considering the behaviour of the item amount syntax, shouldn't this properly set the item's amount?", "author": "FranKusmiruk", "createdAt": "2020-08-07T00:49:29Z", "path": "src/main/java/ch/njol/skript/util/slot/ItemFrameSlot.java", "diffHunk": "@@ -48,6 +48,14 @@ public void setItem(@Nullable ItemStack item) {\n \t\tframe.setItem(item);\n \t}\n \t\n+\t@Override\n+\tpublic int getAmount() {\n+\t\treturn 1;", "originalCommit": "f0184696b1041a5667e353939200ee3b68b52908", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc2MjI0MQ==", "url": "https://github.com/SkriptLang/Skript/pull/3281#discussion_r466762241", "bodyText": "Item frames can only hold an item stack with size 1;", "author": "ShaneBeee", "createdAt": "2020-08-07T00:55:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc2MDcwMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc2MDc2Ng==", "url": "https://github.com/SkriptLang/Skript/pull/3281#discussion_r466760766", "bodyText": "Is updating the inventory needed?", "author": "FranKusmiruk", "createdAt": "2020-08-07T00:49:46Z", "path": "src/main/java/ch/njol/skript/util/slot/EquipmentSlot.java", "diffHunk": "@@ -185,6 +185,21 @@ public void setItem(final @Nullable ItemStack item) {\n \t\t\tPlayerUtils.updateInventory((Player) e.getHolder());\n \t}\n \t\n+\t@Override\n+\tpublic int getAmount() {\n+\t\tItemStack item = slot.get(e);\n+\t\treturn item != null ? item.getAmount() : 0;\n+\t}\n+\t\n+\t@Override\n+\tpublic void setAmount(int amount) {\n+\t\tItemStack item = slot.get(e);\n+\t\tif (item != null)\n+\t\t\titem.setAmount(amount);\n+\t\tif (e.getHolder() instanceof Player)\n+\t\t\tPlayerUtils.updateInventory((Player) e.getHolder());", "originalCommit": "f0184696b1041a5667e353939200ee3b68b52908", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc2MjYyMg==", "url": "https://github.com/SkriptLang/Skript/pull/3281#discussion_r466762622", "bodyText": "I was going off of the setItem method, just made an assumption.\nI can test without. Will report back", "author": "ShaneBeee", "createdAt": "2020-08-07T00:57:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc2MDc2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc2MzgyMg==", "url": "https://github.com/SkriptLang/Skript/pull/3281#discussion_r466763822", "bodyText": "Ok I removed it, tested, it works. So I will remove and push shortly!", "author": "ShaneBeee", "createdAt": "2020-08-07T01:01:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc2MDc2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc2NjE1MQ==", "url": "https://github.com/SkriptLang/Skript/pull/3281#discussion_r466766151", "bodyText": "Pushed and ready to go!", "author": "ShaneBeee", "createdAt": "2020-08-07T01:10:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc2MDc2Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc2MTcyNA==", "url": "https://github.com/SkriptLang/Skript/pull/3281#discussion_r466761724", "bodyText": "Does this actually set the amount of the ItemStack? Bukkit has this habit of passing a clone of the original object instead of the reference to keep immutability, kinda stupid but it's done practically everywhere so just making sure.", "author": "FranKusmiruk", "createdAt": "2020-08-07T00:53:38Z", "path": "src/main/java/ch/njol/skript/util/slot/DroppedItemSlot.java", "diffHunk": "@@ -48,7 +48,17 @@ public void setItem(@Nullable ItemStack item) {\n \t\tassert item != null;\n \t\tentity.setItemStack(item);\n \t}\n-\n+\t\n+\t@Override\n+\tpublic int getAmount() {\n+\t\treturn entity.getItemStack().getAmount();\n+\t}\n+\t\n+\t@Override\n+\tpublic void setAmount(int amount) {\n+\t\tentity.getItemStack().setAmount(amount);", "originalCommit": "f0184696b1041a5667e353939200ee3b68b52908", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc2Mjg1NQ==", "url": "https://github.com/SkriptLang/Skript/pull/3281#discussion_r466762855", "bodyText": "When I tested, it worked.", "author": "ShaneBeee", "createdAt": "2020-08-07T00:58:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc2MTcyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc2MzE5Mg==", "url": "https://github.com/SkriptLang/Skript/pull/3281#discussion_r466763192", "bodyText": "If you so feel, I could get item stack, set amount, and set back the item stack, just for safety and the random event something changes in the future.", "author": "ShaneBeee", "createdAt": "2020-08-07T00:59:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc2MTcyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc2Mzc0Mw==", "url": "https://github.com/SkriptLang/Skript/pull/3281#discussion_r466763743", "bodyText": "So Bukkit is actually passing the reference, it should be fine then, if they change this behaviour it's up to them at that point aynways so we can leave it this way.", "author": "FranKusmiruk", "createdAt": "2020-08-07T01:01:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc2MTcyNA=="}], "type": "inlineReview"}, {"oid": "e24335b50e1ef17193cd0a82592756b1716679c8", "url": "https://github.com/SkriptLang/Skript/commit/e24335b50e1ef17193cd0a82592756b1716679c8", "message": "EquipmentSlot - remove unneeded inventory update", "committedDate": "2020-08-07T01:02:56Z", "type": "commit"}, {"oid": "45681b4d675efbe9a81110a316be99fbb3bdd1f6", "url": "https://github.com/SkriptLang/Skript/commit/45681b4d675efbe9a81110a316be99fbb3bdd1f6", "message": "Merge branch 'master' into fix/item-amount-in-slots", "committedDate": "2020-08-07T01:03:26Z", "type": "commit"}, {"oid": "79485333753eea53dbe8e43221694a49862757cd", "url": "https://github.com/SkriptLang/Skript/commit/79485333753eea53dbe8e43221694a49862757cd", "message": "EquipmentSlot - set the item again (with entities, the item amount was not updating)", "committedDate": "2020-08-07T01:38:57Z", "type": "commit"}, {"oid": "96845569f9a392f8c5f5182ee4d23f623e311c37", "url": "https://github.com/SkriptLang/Skript/commit/96845569f9a392f8c5f5182ee4d23f623e311c37", "message": "add regression test", "committedDate": "2020-08-07T01:39:06Z", "type": "commit"}, {"oid": "454cd6d0b8d68755414964220343ef668fb4073c", "url": "https://github.com/SkriptLang/Skript/commit/454cd6d0b8d68755414964220343ef668fb4073c", "message": "Merge remote-tracking branch 'origin/fix/item-amount-in-slots' into fix/item-amount-in-slots", "committedDate": "2020-08-07T01:39:34Z", "type": "commit"}, {"oid": "2c8acb1f9ea1d382ce3a3d13c678f0b8936746c3", "url": "https://github.com/SkriptLang/Skript/commit/2c8acb1f9ea1d382ce3a3d13c678f0b8936746c3", "message": "Merge branch 'master' into fix/item-amount-in-slots", "committedDate": "2020-08-07T01:45:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzM0NTE1Mg==", "url": "https://github.com/SkriptLang/Skript/pull/3281#discussion_r467345152", "bodyText": "Don't think we need an else here right? Actually you could probably just use a ternary for this", "author": "Wealthyturtle", "createdAt": "2020-08-08T01:32:40Z", "path": "src/main/java/ch/njol/skript/expressions/ExprItemAmount.java", "diffHunk": "@@ -57,8 +56,11 @@ protected String getPropertyName() {\n \t}\n \t\n \t@Override\n-\tpublic Number convert(final ItemType item) {\n-\t\treturn item.getAmount();\n+\tpublic Number convert(final Object item) {\n+    \tif (item instanceof ItemType)\n+    \t\treturn ((ItemType) item).getAmount();\n+    \telse", "originalCommit": "2c8acb1f9ea1d382ce3a3d13c678f0b8936746c3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzM1MDk4Mw==", "url": "https://github.com/SkriptLang/Skript/pull/3281#discussion_r467350983", "bodyText": "Changed \ud83d\udc4d", "author": "ShaneBeee", "createdAt": "2020-08-08T02:34:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzM0NTE1Mg=="}], "type": "inlineReview"}, {"oid": "cd82a34218ac2b904858a012023edd4e02b1845a", "url": "https://github.com/SkriptLang/Skript/commit/cd82a34218ac2b904858a012023edd4e02b1845a", "message": "ExprItemAmount - shorter return line", "committedDate": "2020-08-08T02:34:45Z", "type": "commit"}]}