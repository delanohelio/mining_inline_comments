{"pr_number": 3178, "pr_title": "Cleanup Redundant Code", "pr_createdAt": "2020-07-20T02:29:33Z", "pr_url": "https://github.com/SkriptLang/Skript/pull/3178", "timeline": [{"oid": "0f2bc66d6421211ca25ef615bf12f7ab73fc3746", "url": "https://github.com/SkriptLang/Skript/commit/0f2bc66d6421211ca25ef615bf12f7ab73fc3746", "message": "Merge pull request #23 from SkriptLang/master\n\nMerge Upstream", "committedDate": "2020-07-20T02:03:20Z", "type": "commit"}, {"oid": "0c108f6a0b9cc8b06f4c7e8e8afefc88a40496c2", "url": "https://github.com/SkriptLang/Skript/commit/0c108f6a0b9cc8b06f4c7e8e8afefc88a40496c2", "message": "Part 1", "committedDate": "2020-07-20T02:06:27Z", "type": "commit"}, {"oid": "bee47e06e459ad25252066e9980a3d6d911d947d", "url": "https://github.com/SkriptLang/Skript/commit/bee47e06e459ad25252066e9980a3d6d911d947d", "message": "Part 2", "committedDate": "2020-07-20T03:08:40Z", "type": "commit"}, {"oid": "d0fc1f9ae80b8d7caf367a2c5939634632323a5f", "url": "https://github.com/SkriptLang/Skript/commit/d0fc1f9ae80b8d7caf367a2c5939634632323a5f", "message": "Part 3", "committedDate": "2020-07-20T03:20:49Z", "type": "commit"}, {"oid": "90f4d4ced3cb98ebad41b50df37643f0146f30a3", "url": "https://github.com/SkriptLang/Skript/commit/90f4d4ced3cb98ebad41b50df37643f0146f30a3", "message": "Merge branch 'master' into cleanup2", "committedDate": "2020-07-21T00:39:18Z", "type": "commit"}, {"oid": "87e65316e36715856afe07d704cdc58a83bf4c5e", "url": "https://github.com/SkriptLang/Skript/commit/87e65316e36715856afe07d704cdc58a83bf4c5e", "message": "Part 4", "committedDate": "2020-07-21T01:21:46Z", "type": "commit"}, {"oid": "0125583029f41e15c0b11b2b83e6294d1a0a1578", "url": "https://github.com/SkriptLang/Skript/commit/0125583029f41e15c0b11b2b83e6294d1a0a1578", "message": "Merge branch 'cleanup2' of https://github.com/Wealthyturtle/Skript into cleanup2", "committedDate": "2020-07-21T01:21:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc4NDIyNQ==", "url": "https://github.com/SkriptLang/Skript/pull/3178#discussion_r457784225", "bodyText": "this does not function the same as old behavior, the old behavior would replace a null date with the current date, while this implementation just returns null for a null date", "author": "Pikachu920", "createdAt": "2020-07-21T01:35:45Z", "path": "src/main/java/ch/njol/skript/expressions/ExprDateAgoLater.java", "diffHunk": "@@ -46,20 +46,24 @@\n                 \"%timespan% (later|(from|after) [the] [date] %-date%)\");\n     }\n \n-    @SuppressWarnings(\"null\")\n+    @Nullable\n     private Expression<Timespan> timespan;\n-    @SuppressWarnings(\"null\")\n+    @Nullable\n     private Expression<Date> date;\n \n     private boolean ago;\n \n-    @Nullable\n+\t@SuppressWarnings(\"null\")\n+\t@Nullable\n     @Override\n     protected Date[] get(Event e) {\n+\t\tif (this.timespan == null || this.date == null) {", "originalCommit": "0125583029f41e15c0b11b2b83e6294d1a0a1578", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjE3NDE1NA==", "url": "https://github.com/SkriptLang/Skript/pull/3178#discussion_r462174154", "bodyText": "Will this.date ever be null? Like, the Expression<Date> variable itself, not its content.", "author": "Wealthyturtle", "createdAt": "2020-07-29T09:44:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc4NDIyNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjQyNzI0Nw==", "url": "https://github.com/SkriptLang/Skript/pull/3178#discussion_r462427247", "bodyText": "yes, in the second pattern the date expr is nullable", "author": "Pikachu920", "createdAt": "2020-07-29T16:24:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc4NDIyNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjgzNTgyMw==", "url": "https://github.com/SkriptLang/Skript/pull/3178#discussion_r462835823", "bodyText": "Fixed in next commit", "author": "Wealthyturtle", "createdAt": "2020-07-30T08:29:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc4NDIyNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc4NTcwMA==", "url": "https://github.com/SkriptLang/Skript/pull/3178#discussion_r457785700", "bodyText": "why is it safe to remove the exception that may be thrown here? it's not guaranteed that this API exists", "author": "Pikachu920", "createdAt": "2020-07-21T01:41:20Z", "path": "src/main/java/ch/njol/skript/bukkitutil/BukkitUnsafe.java", "diffHunk": "@@ -60,10 +60,7 @@\n \tprivate static final boolean knownNullPtr = !Skript.isRunningMinecraft(1, 11);\n \t\n \tstatic {\n-\t\tUnsafeValues values = Bukkit.getUnsafe();\n-\t\tif (values == null)\n-\t\t\tthrow new Error(\"UnsafeValues not available\");\n-\t\tunsafe = values;\n+\t\tunsafe = Bukkit.getUnsafe();", "originalCommit": "0125583029f41e15c0b11b2b83e6294d1a0a1578", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc5NTcxMQ==", "url": "https://github.com/SkriptLang/Skript/pull/3178#discussion_r457795711", "bodyText": "Wait, when would this API not exist? If the user is running some non-Bukkit software?", "author": "Wealthyturtle", "createdAt": "2020-07-21T02:17:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc4NTcwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjI1MDM5Mg==", "url": "https://github.com/SkriptLang/Skript/pull/3178#discussion_r462250392", "bodyText": "It's in the class docs: \"Their existence and behavior is not guaranteed across future versions.\"", "author": "Pikachu920", "createdAt": "2020-07-29T12:10:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc4NTcwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjI2MDU3MQ==", "url": "https://github.com/SkriptLang/Skript/pull/3178#discussion_r462260571", "bodyText": "I re-did the code section for that, I think it should solve this?", "author": "Wealthyturtle", "createdAt": "2020-07-29T12:29:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc4NTcwMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc4NTk4MQ==", "url": "https://github.com/SkriptLang/Skript/pull/3178#discussion_r457785981", "bodyText": "has getOfflinePlayer always been guaranteed to be non-null? if not, this may not be the same as old behavior", "author": "Pikachu920", "createdAt": "2020-07-21T01:42:31Z", "path": "src/main/java/ch/njol/skript/classes/data/BukkitClasses.java", "diffHunk": "@@ -843,16 +842,14 @@ public boolean canBeInstantiated() {\n \t\t\t\t\tprotected OfflinePlayer deserialize(final Fields fields) throws StreamCorruptedException {\n \t\t\t\t\t\tif (fields.contains(\"uuid\") && uuidSupported) {\n \t\t\t\t\t\t\tfinal UUID uuid = fields.getObject(\"uuid\", UUID.class);\n-\t\t\t\t\t\t\tOfflinePlayer p;\n-\t\t\t\t\t\t\tif (uuid == null || (p = Bukkit.getOfflinePlayer(uuid)) == null)\n+\t\t\t\t\t\t\tif (uuid == null)\n \t\t\t\t\t\t\t\tthrow new StreamCorruptedException();\n-\t\t\t\t\t\t\treturn p;\n+\t\t\t\t\t\t\treturn Bukkit.getOfflinePlayer(uuid);", "originalCommit": "0125583029f41e15c0b11b2b83e6294d1a0a1578", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc4NzczOQ==", "url": "https://github.com/SkriptLang/Skript/pull/3178#discussion_r457787739", "bodyText": "Bukkit.getOfflinePlayer(uuid) is @NotNull", "author": "Wealthyturtle", "createdAt": "2020-07-21T01:48:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc4NTk4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc5NDAwNw==", "url": "https://github.com/SkriptLang/Skript/pull/3178#discussion_r457794007", "bodyText": "Same thing here,", "author": "Wealthyturtle", "createdAt": "2020-07-21T02:11:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc4NTk4MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc4Njc1MQ==", "url": "https://github.com/SkriptLang/Skript/pull/3178#discussion_r457786751", "bodyText": "i think getChunkAt may return null in some circumstances, do you know if this is true?", "author": "Pikachu920", "createdAt": "2020-07-21T01:45:12Z", "path": "src/main/java/ch/njol/skript/classes/data/BukkitClasses.java", "diffHunk": "@@ -1245,10 +1242,9 @@ public boolean canBeInstantiated() {\n \t\t\t\t\tprotected Chunk deserialize(final Fields fields) throws StreamCorruptedException {\n \t\t\t\t\t\tfinal World w = fields.getObject(\"world\", World.class);\n \t\t\t\t\t\tfinal int x = fields.getPrimitive(\"x\", int.class), z = fields.getPrimitive(\"z\", int.class);\n-\t\t\t\t\t\tChunk c;\n-\t\t\t\t\t\tif (w == null || (c = w.getChunkAt(x, z)) == null)\n+\t\t\t\t\t\tif (w == null)\n \t\t\t\t\t\t\tthrow new StreamCorruptedException();\n-\t\t\t\t\t\treturn c;\n+\t\t\t\t\t\treturn w.getChunkAt(x, z);", "originalCommit": "0125583029f41e15c0b11b2b83e6294d1a0a1578", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc4Nzg5MA==", "url": "https://github.com/SkriptLang/Skript/pull/3178#discussion_r457787890", "bodyText": "I'm not sure... but the docs says that it's @NotNull as well", "author": "Wealthyturtle", "createdAt": "2020-07-21T01:49:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc4Njc1MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc5MzI5NQ==", "url": "https://github.com/SkriptLang/Skript/pull/3178#discussion_r457793295", "bodyText": "I did some investigation, according to https://helpch.at/docs/1.9/ although it doesn't say it's @NotNull (no null notations used at that time), but it never mentions returning null being a possibility, unlike some other functions that do mention null is a possible return value.", "author": "Wealthyturtle", "createdAt": "2020-07-21T02:08:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc4Njc1MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc4NzI1Mw==", "url": "https://github.com/SkriptLang/Skript/pull/3178#discussion_r457787253", "bodyText": "getBlockFace is marked as non-null, but has it always been?", "author": "Pikachu920", "createdAt": "2020-07-21T01:46:58Z", "path": "src/main/java/ch/njol/skript/classes/data/BukkitEventValues.java", "diffHunk": "@@ -673,9 +672,7 @@ public Block get(final PlayerInteractEvent e) {\n \t\t\t@Override\n \t\t\t@Nullable\n \t\t\tpublic Direction get(final PlayerInteractEvent e) {\n-\t\t\t\tif (e.getBlockFace() != null)\n-\t\t\t\t\treturn new Direction(new double[] {e.getBlockFace().getModX(), e.getBlockFace().getModY(), e.getBlockFace().getModZ()});\n-\t\t\t\treturn Direction.ZERO; // Same as 'BlockFace.SELF' or literal 'at'\n+\t\t\t\treturn new Direction(new double[] {e.getBlockFace().getModX(), e.getBlockFace().getModY(), e.getBlockFace().getModZ()});", "originalCommit": "0125583029f41e15c0b11b2b83e6294d1a0a1578", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc5NDgxOQ==", "url": "https://github.com/SkriptLang/Skript/pull/3178#discussion_r457794819", "bodyText": "No mention of null here.", "author": "Wealthyturtle", "createdAt": "2020-07-21T02:14:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc4NzI1Mw=="}], "type": "inlineReview"}, {"oid": "ae7bf4f559ece4c40982587d71cab56bedfd56ac", "url": "https://github.com/SkriptLang/Skript/commit/ae7bf4f559ece4c40982587d71cab56bedfd56ac", "message": "Merge branch 'master' into cleanup2", "committedDate": "2020-07-29T09:15:03Z", "type": "commit"}, {"oid": "88c6f2959b0bdc4adeef3bcdfe85172615cfa082", "url": "https://github.com/SkriptLang/Skript/commit/88c6f2959b0bdc4adeef3bcdfe85172615cfa082", "message": "Make Changes", "committedDate": "2020-07-29T09:55:08Z", "type": "commit"}, {"oid": "9728803eac5dc4d35cfdb798e5527288c41da8c0", "url": "https://github.com/SkriptLang/Skript/commit/9728803eac5dc4d35cfdb798e5527288c41da8c0", "message": "Update BukkitUnsafe.java", "committedDate": "2020-07-29T12:28:57Z", "type": "commit"}, {"oid": "c6039823537bd780beb2760eb863c254ef4387e9", "url": "https://github.com/SkriptLang/Skript/commit/c6039823537bd780beb2760eb863c254ef4387e9", "message": "OCD Fixes", "committedDate": "2020-07-29T12:33:49Z", "type": "commit"}, {"oid": "43876d56b8315dae8b5037cbb8e26bc529236aad", "url": "https://github.com/SkriptLang/Skript/commit/43876d56b8315dae8b5037cbb8e26bc529236aad", "message": "Fix Errors", "committedDate": "2020-07-30T08:07:17Z", "type": "commit"}, {"oid": "479b7c4e65f79d69ff8e8e58b3fd47ddb222a325", "url": "https://github.com/SkriptLang/Skript/commit/479b7c4e65f79d69ff8e8e58b3fd47ddb222a325", "message": "Update ExprDateAgoLater.java", "committedDate": "2020-07-30T08:29:09Z", "type": "commit"}, {"oid": "043f4ee7817faf26ee4b63816b4b66068985d6e0", "url": "https://github.com/SkriptLang/Skript/commit/043f4ee7817faf26ee4b63816b4b66068985d6e0", "message": "Update ExprDateAgoLater.java", "committedDate": "2020-07-30T08:30:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzI2MzE2MA==", "url": "https://github.com/SkriptLang/Skript/pull/3178#discussion_r463263160", "bodyText": "This annotation should be after the other ones", "author": "APickledWalrus", "createdAt": "2020-07-30T20:50:11Z", "path": "src/main/java/ch/njol/skript/expressions/ExprEntities.java", "diffHunk": "@@ -135,6 +135,7 @@ public boolean isLoopOf(String s) {\n \t\treturn false;\n \t}\n \n+\t@SuppressWarnings(\"null\")", "originalCommit": "043f4ee7817faf26ee4b63816b4b66068985d6e0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzI2MzM3OQ==", "url": "https://github.com/SkriptLang/Skript/pull/3178#discussion_r463263379", "bodyText": "Should be after override", "author": "APickledWalrus", "createdAt": "2020-07-30T20:50:36Z", "path": "src/main/java/ch/njol/skript/events/EvtResourcePackResponse.java", "diffHunk": "@@ -61,6 +61,7 @@ public boolean init(final Literal<?>[] args, final int matchedPattern, final Par\n \t\treturn true;\n \t}\n \n+\t@SuppressWarnings(\"null\")", "originalCommit": "043f4ee7817faf26ee4b63816b4b66068985d6e0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzI2MzUxOA==", "url": "https://github.com/SkriptLang/Skript/pull/3178#discussion_r463263518", "bodyText": "This one too ;)", "author": "APickledWalrus", "createdAt": "2020-07-30T20:50:52Z", "path": "src/main/java/ch/njol/skript/effects/EffPlayerVisibility.java", "diffHunk": "@@ -74,6 +78,7 @@ public boolean init(Expression<?>[] exprs, int matchedPattern, Kleenean isDelaye\n \t\treturn true;\n \t}\n \n+    @SuppressWarnings(\"null\")", "originalCommit": "043f4ee7817faf26ee4b63816b4b66068985d6e0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "d6d5a6508a3bf313c01a9f46b6b17ccf9307d0b8", "url": "https://github.com/SkriptLang/Skript/commit/d6d5a6508a3bf313c01a9f46b6b17ccf9307d0b8", "message": "Move SuppressWarnings", "committedDate": "2020-07-30T22:38:25Z", "type": "commit"}, {"oid": "1fd5e73361400a233f7c4013d5c24630fe39473e", "url": "https://github.com/SkriptLang/Skript/commit/1fd5e73361400a233f7c4013d5c24630fe39473e", "message": "Merge branch 'master' into cleanup2", "committedDate": "2020-07-30T22:41:25Z", "type": "commit"}, {"oid": "14f464732871b7f39dde1f76940fdaa59213f1cc", "url": "https://github.com/SkriptLang/Skript/commit/14f464732871b7f39dde1f76940fdaa59213f1cc", "message": "Update BukkitUnsafe.java", "committedDate": "2020-07-30T23:46:42Z", "type": "commit"}, {"oid": "52d1e36c7f42a0db4ba38cb4d77fe0e24d57fbea", "url": "https://github.com/SkriptLang/Skript/commit/52d1e36c7f42a0db4ba38cb4d77fe0e24d57fbea", "message": "Merge branch 'master' into cleanup2", "committedDate": "2020-07-31T08:17:58Z", "type": "commit"}, {"oid": "c31dc8646a751ed8e83e16d791ea9bf89752cf11", "url": "https://github.com/SkriptLang/Skript/commit/c31dc8646a751ed8e83e16d791ea9bf89752cf11", "message": "Change Order", "committedDate": "2020-08-01T00:08:00Z", "type": "commit"}, {"oid": "b23027b1adddb49c1c8459a7e811b893fc8b572f", "url": "https://github.com/SkriptLang/Skript/commit/b23027b1adddb49c1c8459a7e811b893fc8b572f", "message": "Update BukkitUnsafe.java", "committedDate": "2020-08-01T00:08:33Z", "type": "commit"}]}