{"pr_number": 3066, "pr_title": "Add more preload functionality", "pr_createdAt": "2020-06-21T17:14:45Z", "pr_url": "https://github.com/SkriptLang/Skript/pull/3066", "timeline": [{"oid": "3a029b5910453b4314a20afc9430a517570ed23a", "url": "https://github.com/SkriptLang/Skript/commit/3a029b5910453b4314a20afc9430a517570ed23a", "message": "Add PostStructureCreateEvent", "committedDate": "2020-06-21T16:37:25Z", "type": "commit"}, {"oid": "e76f496f5173a618eb4e4bdc5a80021b61699851", "url": "https://github.com/SkriptLang/Skript/commit/e76f496f5173a618eb4e4bdc5a80021b61699851", "message": "Fix line endings 1/2", "committedDate": "2020-06-21T17:42:58Z", "type": "commit"}, {"oid": "c4a755af60418e4eb61b9ac6080dacace0005f12", "url": "https://github.com/SkriptLang/Skript/commit/c4a755af60418e4eb61b9ac6080dacace0005f12", "message": "Fix line endings 2/2", "committedDate": "2020-06-21T17:43:30Z", "type": "commit"}, {"oid": "807d59f66f94f3b4828183cadf62369ab1ae9d71", "url": "https://github.com/SkriptLang/Skript/commit/807d59f66f94f3b4828183cadf62369ab1ae9d71", "message": "Fix line endings 3/4", "committedDate": "2020-06-21T17:46:11Z", "type": "commit"}, {"oid": "a81c8693866b8a8c12640a6eca5925b0f8a503ac", "url": "https://github.com/SkriptLang/Skript/commit/a81c8693866b8a8c12640a6eca5925b0f8a503ac", "message": "Fix line endings 4/4\ndid you really think I was gonna be able to do this in one try", "committedDate": "2020-06-21T17:48:17Z", "type": "commit"}, {"oid": "5d56bd35782c385b7e63b0dca51dadbb77c6adfe", "url": "https://github.com/SkriptLang/Skript/commit/5d56bd35782c385b7e63b0dca51dadbb77c6adfe", "message": "5/6\nplease, git, please", "committedDate": "2020-06-21T18:14:11Z", "type": "commit"}, {"oid": "016ec364fe9cbe9824654f32bf8862662f44421b", "url": "https://github.com/SkriptLang/Skript/commit/016ec364fe9cbe9824654f32bf8862662f44421b", "message": "6/6", "committedDate": "2020-06-21T18:15:04Z", "type": "commit"}, {"oid": "f455bbb22ef53aeead6aa6b8c9d2167d8a74cdeb", "url": "https://github.com/SkriptLang/Skript/commit/f455bbb22ef53aeead6aa6b8c9d2167d8a74cdeb", "message": "revert", "committedDate": "2020-06-21T18:18:23Z", "type": "commit"}, {"oid": "6fdd640820bdee6120d0e8b8825271db9465af65", "url": "https://github.com/SkriptLang/Skript/commit/6fdd640820bdee6120d0e8b8825271db9465af65", "message": "Revert \"5/6 please, git, please\"\n\nThis reverts commit 5d56bd35", "committedDate": "2020-06-21T18:18:28Z", "type": "commit"}, {"oid": "92d984fe92344ed73a7c0d95b7fbbc0019b90062", "url": "https://github.com/SkriptLang/Skript/commit/92d984fe92344ed73a7c0d95b7fbbc0019b90062", "message": "Revert \"Fix line endings 4/4 did you really think I was gonna be able to do this in one try\"\n\nThis reverts commit a81c8693", "committedDate": "2020-06-21T18:18:33Z", "type": "commit"}, {"oid": "764afcf6f143064de7b25eac73be475de371be57", "url": "https://github.com/SkriptLang/Skript/commit/764afcf6f143064de7b25eac73be475de371be57", "message": "Revert \"Fix line endings 3/4\"\n\nThis reverts commit 807d59f6", "committedDate": "2020-06-21T18:18:37Z", "type": "commit"}, {"oid": "ceade6ec727af1b1750fd775998331212413ebef", "url": "https://github.com/SkriptLang/Skript/commit/ceade6ec727af1b1750fd775998331212413ebef", "message": "Revert \"Fix line endings 2/2\"\n\nThis reverts commit c4a755af", "committedDate": "2020-06-21T18:18:41Z", "type": "commit"}, {"oid": "06a2adefdd5e91cbad52a5094167c099a751cadc", "url": "https://github.com/SkriptLang/Skript/commit/06a2adefdd5e91cbad52a5094167c099a751cadc", "message": "Revert \"Fix line endings 1/2\"\n\nThis reverts commit e76f496f", "committedDate": "2020-06-21T18:18:45Z", "type": "commit"}, {"oid": "5ff59d24772b5d56319f075aa5a322ac5aab4b17", "url": "https://github.com/SkriptLang/Skript/commit/5ff59d24772b5d56319f075aa5a322ac5aab4b17", "message": "Revert \"Add PostStructureCreateEvent\"\n\nThis reverts commit 3a029b59", "committedDate": "2020-06-21T18:18:49Z", "type": "commit"}, {"oid": "234f181222ad6dc6e801f2de738abd6c0964f060", "url": "https://github.com/SkriptLang/Skript/commit/234f181222ad6dc6e801f2de738abd6c0964f060", "message": "Update ScriptLoader.java", "committedDate": "2020-06-21T18:21:42Z", "type": "commit"}, {"oid": "0ef9d70f97dae0b74420b7d103984a5e3763cc43", "url": "https://github.com/SkriptLang/Skript/commit/0ef9d70f97dae0b74420b7d103984a5e3763cc43", "message": "Create PostStructureCreateEvent.java", "committedDate": "2020-06-21T18:22:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI0NDQ5Nw==", "url": "https://github.com/SkriptLang/Skript/pull/3066#discussion_r443244497", "bodyText": "Use brackets for codestyle", "author": "JRoy", "createdAt": "2020-06-21T18:28:15Z", "path": "src/main/java/ch/njol/skript/ScriptLoader.java", "diffHunk": "@@ -939,6 +984,9 @@ public String run(final Matcher m) {\n \t\t\t\t\t}\r\n \t\t\t\t}\r\n \t\t\t\t\r\n+\t\t\t\tif (callPostStructureEvent)\r\n+\t\t\t\t\tBukkit.getPluginManager().callEvent(new PostStructureCreateEvent(config));\r\n+\t\t\t\t\r", "originalCommit": "0ef9d70f97dae0b74420b7d103984a5e3763cc43", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI0NDUxMg==", "url": "https://github.com/SkriptLang/Skript/pull/3066#discussion_r443244512", "bodyText": "brackets", "author": "JRoy", "createdAt": "2020-06-21T18:28:31Z", "path": "src/main/java/ch/njol/skript/ScriptLoader.java", "diffHunk": "@@ -158,6 +159,50 @@ public static boolean getCallPreloadEvent() {\n \tpublic static Set<SkriptAddon> getPreloadListeners() {\r\n \t\treturn Collections.unmodifiableSet(preloadListeners);\r\n \t}\r\n+\t\r\n+\t/**\r\n+\t * If true, a {@link PostStructureCreateEvent} will be called\r\n+\t * right after the structure of a script is generated,\r\n+\t * but before the script is parsed.\r\n+\t */\r\n+\tprivate static boolean callPostStructureEvent;\r\n+\r\n+\t/**\r\n+\t * A set of all the SkriptAddons that have called\r\n+\t * {@link ScriptLoader#setCallPostStructureEvent(boolean, SkriptAddon)}\r\n+\t * with true.\r\n+\t */\r\n+\tprivate static Set<SkriptAddon> postStructureListeners = new HashSet<>();\r\n+\r\n+\t/**\r\n+\t * Sets {@link ScriptLoader#callPostStructureEvent} to the provided boolean,\r\n+\t * and adds/removes the provided SkriptAddon from {@link ScriptLoader#postStructureListeners}\r\n+\t * depending on the provided boolean (true adds, false removes).\r\n+\t * @param state The new value for {@link ScriptLoader#postStructureListeners}\r\n+\t * @param addon A non-null SkriptAddon\r\n+\t */\r\n+\tpublic static void setCallPostStructureEvent(boolean state, SkriptAddon addon) {\r\n+\t\tValidate.notNull(addon);\r\n+\t\tcallPostStructureEvent = state;\r\n+\t\tif (state)\r\n+\t\t\tpostStructureListeners.add(addon);\r\n+\t\telse\r\n+\t\t\tpostStructureListeners.remove(addon);\r", "originalCommit": "0ef9d70f97dae0b74420b7d103984a5e3763cc43", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI0NDk5Nw==", "url": "https://github.com/SkriptLang/Skript/pull/3066#discussion_r443244997", "bodyText": "I don't understand the use case for this here, why not always call the event. If nobody is listening to it, there's very little overhead anyway (especially on Paper). The Set of addons seems kind of pointless since they're really not useful.", "author": "JRoy", "createdAt": "2020-06-21T18:34:21Z", "path": "src/main/java/ch/njol/skript/ScriptLoader.java", "diffHunk": "@@ -158,6 +159,50 @@ public static boolean getCallPreloadEvent() {\n \tpublic static Set<SkriptAddon> getPreloadListeners() {\r\n \t\treturn Collections.unmodifiableSet(preloadListeners);\r\n \t}\r\n+\t\r\n+\t/**\r\n+\t * If true, a {@link PostStructureCreateEvent} will be called\r\n+\t * right after the structure of a script is generated,\r\n+\t * but before the script is parsed.\r\n+\t */\r\n+\tprivate static boolean callPostStructureEvent;\r\n+\r\n+\t/**\r\n+\t * A set of all the SkriptAddons that have called\r\n+\t * {@link ScriptLoader#setCallPostStructureEvent(boolean, SkriptAddon)}\r\n+\t * with true.\r\n+\t */\r\n+\tprivate static Set<SkriptAddon> postStructureListeners = new HashSet<>();\r\n+\r\n+\t/**\r\n+\t * Sets {@link ScriptLoader#callPostStructureEvent} to the provided boolean,\r\n+\t * and adds/removes the provided SkriptAddon from {@link ScriptLoader#postStructureListeners}\r\n+\t * depending on the provided boolean (true adds, false removes).\r\n+\t * @param state The new value for {@link ScriptLoader#postStructureListeners}\r\n+\t * @param addon A non-null SkriptAddon\r\n+\t */\r\n+\tpublic static void setCallPostStructureEvent(boolean state, SkriptAddon addon) {\r\n+\t\tValidate.notNull(addon);\r\n+\t\tcallPostStructureEvent = state;\r\n+\t\tif (state)\r\n+\t\t\tpostStructureListeners.add(addon);\r\n+\t\telse\r\n+\t\t\tpostStructureListeners.remove(addon);\r\n+\t}\r\n+\r\n+\tpublic static boolean getCallPostStructureEvent() {\r\n+\t\treturn callPostStructureEvent;\r\n+\t}\r\n+\r\n+\t/**\r\n+\t * Returns an unmodifiable list of all the addons\r\n+\t * that have called {@link ScriptLoader#setCallPostStructureEvent(boolean, SkriptAddon)}\r\n+\t * with true.\r\n+\t */\r\n+\t@SuppressWarnings(\"null\")\r\n+\tpublic static Set<SkriptAddon> getPostStructureListeners() {\r\n+\t\treturn Collections.unmodifiableSet(postStructureListeners);\r\n+\t}\r", "originalCommit": "0ef9d70f97dae0b74420b7d103984a5e3763cc43", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI0NjQwNg==", "url": "https://github.com/SkriptLang/Skript/pull/3066#discussion_r443246406", "bodyText": "I agree with this. I was looking at this last night (we talked about it in discord a little), and this seemed kind of pointless. It also seems like an addon could disable the event being called, which could break other addons that depend on it.", "author": "APickledWalrus", "createdAt": "2020-06-21T18:51:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI0NDk5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI1NjM0OA==", "url": "https://github.com/SkriptLang/Skript/pull/3066#discussion_r443256348", "bodyText": "it's to be consistent with how i implemented the preload event and i implemented the preload event that way because there is a similar toggle to not call function events. looking back though i wouldn't have done this now", "author": "Pikachu920", "createdAt": "2020-06-21T20:59:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI0NDk5Nw=="}], "type": "inlineReview"}, {"oid": "0b2667b78bfec60feecfebf1bab6d62025727775", "url": "https://github.com/SkriptLang/Skript/commit/0b2667b78bfec60feecfebf1bab6d62025727775", "message": "Merge branch 'master' into master", "committedDate": "2020-06-29T15:29:10Z", "type": "commit"}, {"oid": "bf89231fbe5d9ade7f8f53671d85b39c0643d379", "url": "https://github.com/SkriptLang/Skript/commit/bf89231fbe5d9ade7f8f53671d85b39c0643d379", "message": "Delete PostStructureCreateEvent.java", "committedDate": "2020-06-29T15:31:00Z", "type": "commit"}, {"oid": "a672c6611dcb6eaef225d42320af5c8ce5a8e788", "url": "https://github.com/SkriptLang/Skript/commit/a672c6611dcb6eaef225d42320af5c8ce5a8e788", "message": "Update PreScriptLoadEvent.java", "committedDate": "2020-06-29T15:31:25Z", "type": "commit"}, {"oid": "2912f23f3e0d6fce9fa0cfd73743ab9cd0d766eb", "url": "https://github.com/SkriptLang/Skript/commit/2912f23f3e0d6fce9fa0cfd73743ab9cd0d766eb", "message": "Update ScriptLoader.java", "committedDate": "2020-06-29T15:31:48Z", "type": "commit"}, {"oid": "be604898481b8e934ddb0df6a82e2dc0cc4169ac", "url": "https://github.com/SkriptLang/Skript/commit/be604898481b8e934ddb0df6a82e2dc0cc4169ac", "message": "Update ScriptLoader.java", "committedDate": "2020-06-30T18:29:08Z", "type": "commit"}, {"oid": "2abdb06ecc1062c106894029f259020f7b7b2f03", "url": "https://github.com/SkriptLang/Skript/commit/2abdb06ecc1062c106894029f259020f7b7b2f03", "message": "Merge branch 'master' into master", "committedDate": "2020-07-03T14:23:39Z", "type": "commit"}, {"oid": "dba7a9bb459e900ff7e7b0babaf84a5b5e876021", "url": "https://github.com/SkriptLang/Skript/commit/dba7a9bb459e900ff7e7b0babaf84a5b5e876021", "message": "Merge branch 'master' into master", "committedDate": "2020-07-10T09:00:19Z", "type": "commit"}, {"oid": "7231525119d5054bfa0a4fbe754411cbda7bd9a8", "url": "https://github.com/SkriptLang/Skript/commit/7231525119d5054bfa0a4fbe754411cbda7bd9a8", "message": "Merge branch 'master' into master", "committedDate": "2020-07-15T17:40:04Z", "type": "commit"}]}