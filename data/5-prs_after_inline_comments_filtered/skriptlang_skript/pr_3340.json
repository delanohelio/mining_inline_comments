{"pr_number": 3340, "pr_title": "Adding heal amount expression", "pr_createdAt": "2020-08-28T13:42:12Z", "pr_url": "https://github.com/SkriptLang/Skript/pull/3340", "timeline": [{"oid": "912ae0dffd64bca84ba35d1f63dc2ea180c9c1f3", "url": "https://github.com/SkriptLang/Skript/commit/912ae0dffd64bca84ba35d1f63dc2ea180c9c1f3", "message": "ExprHealAmount - Adding heal amount expression", "committedDate": "2020-08-28T13:12:11Z", "type": "commit"}, {"oid": "fb69cd7c19cf2789a93f88543043b13039ae7909", "url": "https://github.com/SkriptLang/Skript/commit/fb69cd7c19cf2789a93f88543043b13039ae7909", "message": "Merge branch 'master' into feature/regain-amount", "committedDate": "2020-08-28T20:04:08Z", "type": "commit"}, {"oid": "fbb342b9726f39f0be0816c76c80bef5c33cb866", "url": "https://github.com/SkriptLang/Skript/commit/fbb342b9726f39f0be0816c76c80bef5c33cb866", "message": "Merge branch 'master' into feature/regain-amount", "committedDate": "2020-08-29T10:15:18Z", "type": "commit"}, {"oid": "ff78557ff9d5edcc4a43ad7d0eeac8f3cbfa9968", "url": "https://github.com/SkriptLang/Skript/commit/ff78557ff9d5edcc4a43ad7d0eeac8f3cbfa9968", "message": "Merge branch 'master' into feature/regain-amount", "committedDate": "2020-08-29T11:08:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTY1MDExOA==", "url": "https://github.com/SkriptLang/Skript/pull/3340#discussion_r479650118", "bodyText": "The amount of a healing event sounds weird, how about the amount of health healed in a healing event?", "author": "Wealthyturtle", "createdAt": "2020-08-29T13:30:58Z", "path": "src/main/java/ch/njol/skript/expressions/ExprHealAmount.java", "diffHunk": "@@ -0,0 +1,120 @@\n+/**\n+ * This file is part of Skript.\n+ *\n+ * Skript is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * Skript is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with Skript.  If not, see <http://www.gnu.org/licenses/>.\n+ *\n+ *\n+ * Copyright 2011-2017 Peter G\u00fcttinger and contributors\n+ */\n+\n+package ch.njol.skript.expressions;\n+\n+import org.bukkit.event.Event;\n+import org.bukkit.event.entity.EntityRegainHealthEvent;\n+import org.eclipse.jdt.annotation.Nullable;\n+\n+import ch.njol.skript.ScriptLoader;\n+import ch.njol.skript.Skript;\n+import ch.njol.skript.classes.Changer;\n+import ch.njol.skript.doc.Description;\n+import ch.njol.skript.doc.Events;\n+import ch.njol.skript.doc.Examples;\n+import ch.njol.skript.doc.Name;\n+import ch.njol.skript.doc.Since;\n+import ch.njol.skript.lang.Expression;\n+import ch.njol.skript.lang.ExpressionType;\n+import ch.njol.skript.lang.SkriptParser;\n+import ch.njol.skript.lang.util.SimpleExpression;\n+import ch.njol.skript.log.ErrorQuality;\n+import ch.njol.util.Kleenean;\n+\n+@Name(\"Heal Amount\")\n+@Description(\"The amount of a healing event, which can be changed.\")", "originalCommit": "ff78557ff9d5edcc4a43ad7d0eeac8f3cbfa9968", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTY1MDI1OA==", "url": "https://github.com/SkriptLang/Skript/pull/3340#discussion_r479650258", "bodyText": "Also, is which can be changed actually necessary? Lots of expressions are changeable, but it's not explicitly specified.", "author": "Wealthyturtle", "createdAt": "2020-08-29T13:32:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTY1MDExOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTY2MjYyNg==", "url": "https://github.com/SkriptLang/Skript/pull/3340#discussion_r479662626", "bodyText": "Thanks for the remarks, will be modified in the next commit.", "author": "Romitou", "createdAt": "2020-08-29T15:54:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTY1MDExOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTY1MDMyMw==", "url": "https://github.com/SkriptLang/Skript/pull/3340#discussion_r479650323", "bodyText": "I believe you can return CollectionUtils.array(Number.class) here", "author": "Wealthyturtle", "createdAt": "2020-08-29T13:33:12Z", "path": "src/main/java/ch/njol/skript/expressions/ExprHealAmount.java", "diffHunk": "@@ -0,0 +1,120 @@\n+/**\n+ * This file is part of Skript.\n+ *\n+ * Skript is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * Skript is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with Skript.  If not, see <http://www.gnu.org/licenses/>.\n+ *\n+ *\n+ * Copyright 2011-2017 Peter G\u00fcttinger and contributors\n+ */\n+\n+package ch.njol.skript.expressions;\n+\n+import org.bukkit.event.Event;\n+import org.bukkit.event.entity.EntityRegainHealthEvent;\n+import org.eclipse.jdt.annotation.Nullable;\n+\n+import ch.njol.skript.ScriptLoader;\n+import ch.njol.skript.Skript;\n+import ch.njol.skript.classes.Changer;\n+import ch.njol.skript.doc.Description;\n+import ch.njol.skript.doc.Events;\n+import ch.njol.skript.doc.Examples;\n+import ch.njol.skript.doc.Name;\n+import ch.njol.skript.doc.Since;\n+import ch.njol.skript.lang.Expression;\n+import ch.njol.skript.lang.ExpressionType;\n+import ch.njol.skript.lang.SkriptParser;\n+import ch.njol.skript.lang.util.SimpleExpression;\n+import ch.njol.skript.log.ErrorQuality;\n+import ch.njol.util.Kleenean;\n+\n+@Name(\"Heal Amount\")\n+@Description(\"The amount of a healing event, which can be changed.\")\n+@Examples({\"increase heal amount by 2\",\n+\t\"remove 0.5 from heal amount\"})\n+@Since(\"INSERT VERSION\")\n+@Events(\"heal\")\n+\n+public class ExprHealAmount extends SimpleExpression<Number> {\n+\t\n+\tstatic {\n+\t\tSkript.registerExpression(ExprHealAmount.class, Number.class, ExpressionType.SIMPLE, \"[the] heal amount\");\n+\t}\n+\t\n+\t@SuppressWarnings(\"null\")\n+\tprivate Kleenean delay;\n+\t\n+\t@Override\n+\tpublic boolean init(Expression<?>[] exprs, int matchedPattern, Kleenean isDelayed, SkriptParser.ParseResult parseResult) {\n+\t\tif (!ScriptLoader.isCurrentEvent(EntityRegainHealthEvent.class)) {\n+\t\t\tSkript.error(\"The expression 'heal amount' may only be used in heal event\", ErrorQuality.SEMANTIC_ERROR);\n+\t\t\treturn false;\n+\t\t}\n+\t\tdelay = isDelayed;\n+\t\treturn true;\n+\t}\n+\t\n+\t@Nullable\n+\t@Override\n+\tprotected Number[] get(Event e) {\n+\t\treturn new Number[]{((EntityRegainHealthEvent) e).getAmount()};\n+\t}\n+\t\n+\t@Nullable\n+\t@Override\n+\tpublic Class<?>[] acceptChange(Changer.ChangeMode mode) {\n+\t\tif (delay != Kleenean.FALSE) {\n+\t\t\tSkript.error(\"The heal amount cannot be changed after the event has already passed\");\n+\t\t\treturn null;\n+\t\t}\n+\t\tif (mode == Changer.ChangeMode.REMOVE_ALL || mode == Changer.ChangeMode.RESET)\n+\t\t\treturn null;\n+\t\treturn new Class[]{Number.class};", "originalCommit": "ff78557ff9d5edcc4a43ad7d0eeac8f3cbfa9968", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTY1MDU1NQ==", "url": "https://github.com/SkriptLang/Skript/pull/3340#discussion_r479650555", "bodyText": "Why would SET be equal to DELETE here?", "author": "Wealthyturtle", "createdAt": "2020-08-29T13:35:55Z", "path": "src/main/java/ch/njol/skript/expressions/ExprHealAmount.java", "diffHunk": "@@ -0,0 +1,120 @@\n+/**\n+ * This file is part of Skript.\n+ *\n+ * Skript is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * Skript is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with Skript.  If not, see <http://www.gnu.org/licenses/>.\n+ *\n+ *\n+ * Copyright 2011-2017 Peter G\u00fcttinger and contributors\n+ */\n+\n+package ch.njol.skript.expressions;\n+\n+import org.bukkit.event.Event;\n+import org.bukkit.event.entity.EntityRegainHealthEvent;\n+import org.eclipse.jdt.annotation.Nullable;\n+\n+import ch.njol.skript.ScriptLoader;\n+import ch.njol.skript.Skript;\n+import ch.njol.skript.classes.Changer;\n+import ch.njol.skript.doc.Description;\n+import ch.njol.skript.doc.Events;\n+import ch.njol.skript.doc.Examples;\n+import ch.njol.skript.doc.Name;\n+import ch.njol.skript.doc.Since;\n+import ch.njol.skript.lang.Expression;\n+import ch.njol.skript.lang.ExpressionType;\n+import ch.njol.skript.lang.SkriptParser;\n+import ch.njol.skript.lang.util.SimpleExpression;\n+import ch.njol.skript.log.ErrorQuality;\n+import ch.njol.util.Kleenean;\n+\n+@Name(\"Heal Amount\")\n+@Description(\"The amount of a healing event, which can be changed.\")\n+@Examples({\"increase heal amount by 2\",\n+\t\"remove 0.5 from heal amount\"})\n+@Since(\"INSERT VERSION\")\n+@Events(\"heal\")\n+\n+public class ExprHealAmount extends SimpleExpression<Number> {\n+\t\n+\tstatic {\n+\t\tSkript.registerExpression(ExprHealAmount.class, Number.class, ExpressionType.SIMPLE, \"[the] heal amount\");\n+\t}\n+\t\n+\t@SuppressWarnings(\"null\")\n+\tprivate Kleenean delay;\n+\t\n+\t@Override\n+\tpublic boolean init(Expression<?>[] exprs, int matchedPattern, Kleenean isDelayed, SkriptParser.ParseResult parseResult) {\n+\t\tif (!ScriptLoader.isCurrentEvent(EntityRegainHealthEvent.class)) {\n+\t\t\tSkript.error(\"The expression 'heal amount' may only be used in heal event\", ErrorQuality.SEMANTIC_ERROR);\n+\t\t\treturn false;\n+\t\t}\n+\t\tdelay = isDelayed;\n+\t\treturn true;\n+\t}\n+\t\n+\t@Nullable\n+\t@Override\n+\tprotected Number[] get(Event e) {\n+\t\treturn new Number[]{((EntityRegainHealthEvent) e).getAmount()};\n+\t}\n+\t\n+\t@Nullable\n+\t@Override\n+\tpublic Class<?>[] acceptChange(Changer.ChangeMode mode) {\n+\t\tif (delay != Kleenean.FALSE) {\n+\t\t\tSkript.error(\"The heal amount cannot be changed after the event has already passed\");\n+\t\t\treturn null;\n+\t\t}\n+\t\tif (mode == Changer.ChangeMode.REMOVE_ALL || mode == Changer.ChangeMode.RESET)\n+\t\t\treturn null;\n+\t\treturn new Class[]{Number.class};\n+\t}\n+\t\n+\t@Override\n+\tpublic void change(Event e, @Nullable Object[] delta, Changer.ChangeMode mode) {\n+\t\tdouble value = delta == null ? 0 : ((Number) delta[0]).doubleValue();\n+\t\tswitch (mode) {\n+\t\t\tcase SET:\n+\t\t\tcase DELETE:", "originalCommit": "ff78557ff9d5edcc4a43ad7d0eeac8f3cbfa9968", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTY2MjY1MA==", "url": "https://github.com/SkriptLang/Skript/pull/3340#discussion_r479662650", "bodyText": "Because if delta is null, the value will be set to 0:\ndouble value = delta == null ? 0 : ((Number) delta[0]).doubleValue();", "author": "Romitou", "createdAt": "2020-08-29T15:54:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTY1MDU1NQ=="}], "type": "inlineReview"}, {"oid": "ef7f901b58834d0a9539eac8e54e3ae32f82ee01", "url": "https://github.com/SkriptLang/Skript/commit/ef7f901b58834d0a9539eac8e54e3ae32f82ee01", "message": "ExprHealAmount - Changes due to code reviews", "committedDate": "2020-08-29T16:08:43Z", "type": "commit"}, {"oid": "3a50e1d98225370f3b877febbb383c86a1d10ad6", "url": "https://github.com/SkriptLang/Skript/commit/3a50e1d98225370f3b877febbb383c86a1d10ad6", "message": "Merge branch 'master' into feature/regain-amount", "committedDate": "2020-08-30T06:09:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTgwNjkzNw==", "url": "https://github.com/SkriptLang/Skript/pull/3340#discussion_r479806937", "bodyText": "only tiny little nitpick, but there shouldn't be a space here.", "author": "ShaneBeee", "createdAt": "2020-08-30T19:31:05Z", "path": "src/main/java/ch/njol/skript/expressions/ExprHealAmount.java", "diffHunk": "@@ -0,0 +1,121 @@\n+/**\n+ * This file is part of Skript.\n+ *\n+ * Skript is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * Skript is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with Skript.  If not, see <http://www.gnu.org/licenses/>.\n+ *\n+ *\n+ * Copyright 2011-2017 Peter G\u00fcttinger and contributors\n+ */\n+\n+package ch.njol.skript.expressions;\n+\n+import org.bukkit.event.Event;\n+import org.bukkit.event.entity.EntityRegainHealthEvent;\n+import org.eclipse.jdt.annotation.Nullable;\n+\n+import ch.njol.skript.ScriptLoader;\n+import ch.njol.skript.Skript;\n+import ch.njol.skript.classes.Changer;\n+import ch.njol.skript.doc.Description;\n+import ch.njol.skript.doc.Events;\n+import ch.njol.skript.doc.Examples;\n+import ch.njol.skript.doc.Name;\n+import ch.njol.skript.doc.Since;\n+import ch.njol.skript.lang.Expression;\n+import ch.njol.skript.lang.ExpressionType;\n+import ch.njol.skript.lang.SkriptParser;\n+import ch.njol.skript.lang.util.SimpleExpression;\n+import ch.njol.skript.log.ErrorQuality;\n+import ch.njol.util.Kleenean;\n+import ch.njol.util.coll.CollectionUtils;\n+\n+@Name(\"Heal Amount\")\n+@Description(\"The amount of health healed in a healing event.\")\n+@Examples({\"increase heal amount by 2\",\n+\t\"remove 0.5 from heal amount\"})\n+@Since(\"INSERT VERSION\")\n+@Events(\"heal\")\n+", "originalCommit": "3a50e1d98225370f3b877febbb383c86a1d10ad6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTgwNzE1NA==", "url": "https://github.com/SkriptLang/Skript/pull/3340#discussion_r479807154", "bodyText": "Indeed!", "author": "Romitou", "createdAt": "2020-08-30T19:33:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTgwNjkzNw=="}], "type": "inlineReview"}, {"oid": "911e170ec69a6ad680776c95ddcc09b6b3d7690a", "url": "https://github.com/SkriptLang/Skript/commit/911e170ec69a6ad680776c95ddcc09b6b3d7690a", "message": "ExprHealAmount - Removal of unnecessary space", "committedDate": "2020-08-30T19:36:27Z", "type": "commit"}, {"oid": "3833e8592258a7074b1b8a30d0b88f2224861c4f", "url": "https://github.com/SkriptLang/Skript/commit/3833e8592258a7074b1b8a30d0b88f2224861c4f", "message": "Merge branch 'master' into feature/regain-amount", "committedDate": "2020-09-01T14:44:52Z", "type": "commit"}, {"oid": "b44fb4e626ebd8b2efe485b53fd9cc33d7817880", "url": "https://github.com/SkriptLang/Skript/commit/b44fb4e626ebd8b2efe485b53fd9cc33d7817880", "message": "Merge branch 'master' into feature/regain-amount", "committedDate": "2020-09-04T19:00:15Z", "type": "commit"}, {"oid": "fc6d4aacf6b46cf8af9fa9ee782dedab82045e50", "url": "https://github.com/SkriptLang/Skript/commit/fc6d4aacf6b46cf8af9fa9ee782dedab82045e50", "message": "Merge branch 'dev-2.5' into feature/regain-amount", "committedDate": "2020-09-24T22:21:08Z", "type": "commit"}, {"oid": "fa49926fe03e44737159d176a22ee12f7e4e7698", "url": "https://github.com/SkriptLang/Skript/commit/fa49926fe03e44737159d176a22ee12f7e4e7698", "message": "Merge branch 'dev-2.5' into feature/regain-amount", "committedDate": "2020-09-26T19:05:40Z", "type": "commit"}, {"oid": "bd6bc6c37da2a7304aee96b5188fa67b8a10848a", "url": "https://github.com/SkriptLang/Skript/commit/bd6bc6c37da2a7304aee96b5188fa67b8a10848a", "message": "Merge branch 'dev-2.5' into feature/regain-amount", "committedDate": "2020-09-29T21:27:05Z", "type": "commit"}, {"oid": "6ec7faf2282ef44f4ba567ed59f30678dadbd549", "url": "https://github.com/SkriptLang/Skript/commit/6ec7faf2282ef44f4ba567ed59f30678dadbd549", "message": "Merge branch 'dev-2.5' into feature/regain-amount", "committedDate": "2020-09-30T04:56:24Z", "type": "commit"}, {"oid": "31124d2fbd57d38058093ac7fac999212c077143", "url": "https://github.com/SkriptLang/Skript/commit/31124d2fbd57d38058093ac7fac999212c077143", "message": "Merge branch 'dev-2.5' into feature/regain-amount", "committedDate": "2020-10-03T15:28:12Z", "type": "commit"}, {"oid": "50aa63f2060ba82263956072afb1af90d36cf80a", "url": "https://github.com/SkriptLang/Skript/commit/50aa63f2060ba82263956072afb1af90d36cf80a", "message": ":page_facing_up: Updating licence header", "committedDate": "2020-10-04T19:45:14Z", "type": "commit"}, {"oid": "86498c8ea759ac82e96397a113bb1e78b20aec36", "url": "https://github.com/SkriptLang/Skript/commit/86498c8ea759ac82e96397a113bb1e78b20aec36", "message": "Merge branch 'dev-2.5' into feature/regain-amount", "committedDate": "2020-10-04T21:42:18Z", "type": "commit"}, {"oid": "e7b16d24573f6c3d20df60dfca0a74311a45b807", "url": "https://github.com/SkriptLang/Skript/commit/e7b16d24573f6c3d20df60dfca0a74311a45b807", "message": "Merge branch 'dev-2.5' into feature/regain-amount", "committedDate": "2020-10-05T04:59:14Z", "type": "commit"}, {"oid": "52ef8479fbf67e636c3a24c2cce324b7b04d2d8c", "url": "https://github.com/SkriptLang/Skript/commit/52ef8479fbf67e636c3a24c2cce324b7b04d2d8c", "message": "Merge branch 'dev-2.5' into feature/regain-amount", "committedDate": "2020-10-05T05:59:31Z", "type": "commit"}]}