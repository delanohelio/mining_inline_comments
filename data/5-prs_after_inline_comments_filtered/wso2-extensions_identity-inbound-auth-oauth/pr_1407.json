{"pr_number": 1407, "pr_title": "Deprecate OAuth 1.0 and /identity/connect/register endpoint ", "pr_createdAt": "2020-07-02T05:59:25Z", "pr_url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1407", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODc4Mjc3NA==", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1407#discussion_r448782774", "bodyText": "this is not needed. We don't need to disable the OSGi service component.", "author": "emswbandara", "createdAt": "2020-07-02T06:46:41Z", "path": "components/org.wso2.carbon.identity.oauth/src/main/java/org/wso2/carbon/identity/oauth/internal/OAuthServiceComponent.java", "diffHunk": "@@ -41,19 +43,32 @@\n import org.wso2.carbon.user.core.listener.UserOperationEventListener;\n import org.wso2.carbon.user.core.service.RealmService;\n \n+import static org.wso2.carbon.identity.oauth.Error.FORBIDDEN;\n+\n /**\n  * OAuth OSGi service component.\n  */\n @Component(\n         name = \"identity.oauth.component\",\n         immediate = true\n )\n+@Deprecated\n public class OAuthServiceComponent {\n \n     private static final Log log = LogFactory.getLog(OAuthServiceComponent.class);\n     private ServiceRegistration serviceRegistration = null;\n+    public static final String ENABLE_OAUTH1_CONFIG = \"LegacyFeatures.EnableOAuth1\";\n+\n+    protected void activate(ComponentContext context) throws IdentityOAuthClientException {\n+\n+        boolean isOAuth1Enabled = Boolean.parseBoolean(IdentityUtil.getProperty(ENABLE_OAUTH1_CONFIG));\n+        if (!isOAuth1Enabled) {\n+            if (log.isDebugEnabled()) {\n+                log.debug(\"OAuth 1.0 Endpoint is disabled.\");\n+            }\n+            throw new IdentityOAuthClientException(FORBIDDEN.getErrorCode(), \"OAuth 1.0 is not supported\");", "originalCommit": "31c7a2e7861cd75061da2628d16c3d472d194fcb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODc4NzQ2NQ==", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1407#discussion_r448787465", "bodyText": "Fixed e5dca5f", "author": "GANGANI", "createdAt": "2020-07-02T06:57:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODc4Mjc3NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDI2Mjg3Ng==", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1407#discussion_r454262876", "bodyText": "let's not hard-code the /api/identity/oauth2/dcr. Instead let's add \"Refer the WSO2 official documentation for more information <link>\"", "author": "emswbandara", "createdAt": "2020-07-14T10:36:13Z", "path": "components/org.wso2.carbon.identity.oidc.dcr/src/main/java/org/wso2/carbon/identity/oidc/dcr/processor/OIDCDCRProcessor.java", "diffHunk": "@@ -54,9 +54,14 @@\n         boolean isIdentityConnectDCREnabled = Boolean.parseBoolean(IdentityUtil.getProperty(ENABLE_OIDC_DCR_CONFIG));\n         if (!isIdentityConnectDCREnabled) {\n             if (log.isDebugEnabled()) {\n-                log.debug(\"Identity Connect DCR Endpoint is disabled.\");\n+                log.debug(\"Identity Connect DCR endpoint was deprecated. To enable the DCR API endpoint \" +\n+                        \"add the following config to deployment.toml file.\" +\n+                        \"[legacy_features]\" +\n+                        \"enable_identity_connect_dcr = true\");\n             }\n-            throw IdentityException.error(DCRException.class, ErrorCodes.FORBIDDEN.toString());\n+            String errorMessage =\n+                    \"/identity/connect/register API was deprecated. Refer /api/identity/oauth2/dcr endpoint\";", "originalCommit": "314858ac5d2f2a076285d111ebcef9858452a669", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjU5OTYyNw==", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1407#discussion_r456599627", "bodyText": "Fixed 515007e", "author": "GANGANI", "createdAt": "2020-07-17T18:13:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDI2Mjg3Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDI2NDM2Nw==", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1407#discussion_r454264367", "bodyText": "change as \"Identity Connect DCR endpoint is deprecated and hence disabled by default in the server. To enable it add the following config...\"", "author": "emswbandara", "createdAt": "2020-07-14T10:39:18Z", "path": "components/org.wso2.carbon.identity.oidc.dcr/src/main/java/org/wso2/carbon/identity/oidc/dcr/processor/OIDCDCRProcessor.java", "diffHunk": "@@ -54,9 +54,14 @@\n         boolean isIdentityConnectDCREnabled = Boolean.parseBoolean(IdentityUtil.getProperty(ENABLE_OIDC_DCR_CONFIG));\n         if (!isIdentityConnectDCREnabled) {\n             if (log.isDebugEnabled()) {\n-                log.debug(\"Identity Connect DCR Endpoint is disabled.\");\n+                log.debug(\"Identity Connect DCR endpoint was deprecated. To enable the DCR API endpoint \" +", "originalCommit": "314858ac5d2f2a076285d111ebcef9858452a669", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjU5OTc0NA==", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1407#discussion_r456599744", "bodyText": "Fixed 515007e", "author": "GANGANI", "createdAt": "2020-07-17T18:13:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDI2NDM2Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDA1MDk1Ng==", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1407#discussion_r484050956", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                    \"[[legacy_feature]]\" +\n          \n          \n            \n                                    \"id = identity/connect/dcr\" +\n          \n          \n            \n                                    \"enable = true\");\n          \n          \n            \n                                    \"[[legacy_feature]] \\n\" +\n          \n          \n            \n                                    \"id = identity/connect/dcr \\n\" +\n          \n          \n            \n                                    \"enable = true\");", "author": "dewniMW", "createdAt": "2020-09-06T10:18:09Z", "path": "components/org.wso2.carbon.identity.oidc.dcr/src/main/java/org/wso2/carbon/identity/oidc/dcr/processor/OIDCDCRProcessor.java", "diffHunk": "@@ -44,6 +48,24 @@\n         if (log.isDebugEnabled()) {\n             log.debug(\"Request processing started by OIDCDCRProcessor.\");\n         }\n+\n+        boolean isIdentityConnectDCREnabled =\n+                IdentityUtil.isLegacyFeatureEnabled(OIDCDCRConstants.OIDC_DCR_ID, OIDCDCRConstants.OIDC_DCR_VERSION);\n+\n+        if (!isIdentityConnectDCREnabled) {\n+            if (log.isDebugEnabled()) {\n+                log.debug(\"Identity Connect DCR endpoint was deprecated. To enable the DCR API endpoint \" +\n+                        \"add the following config to deployment.toml file.\" +\n+                        \"[[legacy_feature]]\" +\n+                        \"id = identity/connect/dcr\" +\n+                        \"enable = true\");", "originalCommit": "7dd0042d3e59d060043ee15ee150f718feca6739", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDYzODQyMA==", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1407#discussion_r484638420", "bodyText": "Fixed 54221d9", "author": "GANGANI", "createdAt": "2020-09-08T04:06:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDA1MDk1Ng=="}], "type": "inlineReview"}, {"oid": "b5b4f265a5f648ecd25361f5147cccb8b7a3ed0a", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/commit/b5b4f265a5f648ecd25361f5147cccb8b7a3ed0a", "message": "Deprecate OAuth 1.0", "committedDate": "2020-09-08T03:58:40Z", "type": "commit"}, {"oid": "9367a56c928b1e76d743d6d772dce663d95df79a", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/commit/9367a56c928b1e76d743d6d772dce663d95df79a", "message": "Add config check", "committedDate": "2020-09-08T03:58:41Z", "type": "commit"}, {"oid": "84dfa7a454753b379d3ea13f1aa6eed75c4f04c9", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/commit/84dfa7a454753b379d3ea13f1aa6eed75c4f04c9", "message": "Correct the config check", "committedDate": "2020-09-08T03:58:41Z", "type": "commit"}, {"oid": "7b31c941ba8b5991cd2260a17789caa411ceb221", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/commit/7b31c941ba8b5991cd2260a17789caa411ceb221", "message": "CorRemove unnecessary variable", "committedDate": "2020-09-08T03:58:41Z", "type": "commit"}, {"oid": "db2ed191238d2f29c8705f6e0ba37017427a1aef", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/commit/db2ed191238d2f29c8705f6e0ba37017427a1aef", "message": "Remove unused import", "committedDate": "2020-09-08T03:58:41Z", "type": "commit"}, {"oid": "a60a8da3298738fe50725eaaa15d0962ea203ce8", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/commit/a60a8da3298738fe50725eaaa15d0962ea203ce8", "message": "Disable OAuth1 in ui", "committedDate": "2020-09-08T03:58:41Z", "type": "commit"}, {"oid": "25a4cb64ff3eeb1a04d03560e2bfb56dd856faeb", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/commit/25a4cb64ff3eeb1a04d03560e2bfb56dd856faeb", "message": "Change OAuth1 disabling logic", "committedDate": "2020-09-08T03:58:41Z", "type": "commit"}, {"oid": "41d2eeccfe063fc1f276e4ae4c903dec3f346ad8", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/commit/41d2eeccfe063fc1f276e4ae4c903dec3f346ad8", "message": "Change error message", "committedDate": "2020-09-08T03:58:41Z", "type": "commit"}, {"oid": "bb5fb020ecaae9c5019b8befa261d2401f44fa8a", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/commit/bb5fb020ecaae9c5019b8befa261d2401f44fa8a", "message": "Change error status message", "committedDate": "2020-09-08T03:58:41Z", "type": "commit"}, {"oid": "11e39190e1ed7dcfb3ed25ac2665cb2cd5c1649d", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/commit/11e39190e1ed7dcfb3ed25ac2665cb2cd5c1649d", "message": "Improve error message", "committedDate": "2020-09-08T03:58:41Z", "type": "commit"}, {"oid": "5262e7c328d8e7a34734e5ff5969c6804717a7d6", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/commit/5262e7c328d8e7a34734e5ff5969c6804717a7d6", "message": "Call isLegacyFeatureEnabled() method", "committedDate": "2020-09-08T03:58:41Z", "type": "commit"}, {"oid": "43f5296c98ba31b37cae1153e979ab7af6a5658c", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/commit/43f5296c98ba31b37cae1153e979ab7af6a5658c", "message": "Upgrade the framework version", "committedDate": "2020-09-08T03:58:41Z", "type": "commit"}, {"oid": "d3cd06b54d98e198dc6911c3271174b55f16d810", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/commit/d3cd06b54d98e198dc6911c3271174b55f16d810", "message": "Change constant and upgrade the framework version", "committedDate": "2020-09-08T03:58:41Z", "type": "commit"}, {"oid": "7035eac43d6b0840cb18eaf3e02edaa8fb951542", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/commit/7035eac43d6b0840cb18eaf3e02edaa8fb951542", "message": "Change debug log", "committedDate": "2020-09-08T03:58:42Z", "type": "commit"}, {"oid": "7035eac43d6b0840cb18eaf3e02edaa8fb951542", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/commit/7035eac43d6b0840cb18eaf3e02edaa8fb951542", "message": "Change debug log", "committedDate": "2020-09-08T03:58:42Z", "type": "forcePushed"}, {"oid": "54221d9ca83bffb0964b332d92e9573fd1c053bf", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/commit/54221d9ca83bffb0964b332d92e9573fd1c053bf", "message": "Update debug log", "committedDate": "2020-09-08T04:05:23Z", "type": "commit"}, {"oid": "108c4f3095ee59ce244021a8ed7a515ca07520ff", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/commit/108c4f3095ee59ce244021a8ed7a515ca07520ff", "message": "Update error message", "committedDate": "2020-09-08T04:40:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njk5MzExMw==", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1407#discussion_r486993113", "bodyText": "Redundant new line", "author": "tharindu-bandara", "createdAt": "2020-09-11T11:50:16Z", "path": "components/org.wso2.carbon.identity.oauth.dcr/src/main/java/org/wso2/carbon/identity/oauth/dcr/util/ErrorCodes.java", "diffHunk": "@@ -22,5 +22,7 @@\n  */\n public enum ErrorCodes {\n     META_DATA_VALIDATION_FAILED,\n-    BAD_REQUEST;\n+    BAD_REQUEST,\n+    FORBIDDEN;\n+", "originalCommit": "108c4f3095ee59ce244021a8ed7a515ca07520ff", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzM1NjI3Mw==", "url": "https://github.com/wso2-extensions/identity-inbound-auth-oauth/pull/1407#discussion_r487356273", "bodyText": "These code changes were reverted recently. I'll fix this with the new PR.", "author": "GANGANI", "createdAt": "2020-09-12T02:31:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njk5MzExMw=="}], "type": "inlineReview"}]}