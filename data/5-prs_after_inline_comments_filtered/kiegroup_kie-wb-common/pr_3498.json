{"pr_number": 3498, "pr_title": "KOGITO-3891 & KOGITO-540: Editors refactoring & BPMN editor readonly", "pr_createdAt": "2020-11-23T00:55:45Z", "pr_url": "https://github.com/kiegroup/kie-wb-common/pull/3498", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTQ3MzM5MA==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3498#discussion_r529473390", "bodyText": "TODO, putting a comment here so we do not forget about these tests", "author": "domhanak", "createdAt": "2020-11-24T11:26:57Z", "path": "kie-wb-common-dmn/kie-wb-common-dmn-project-client/src/test/java/org/kie/workbench/common/dmn/project/client/editor/DMNDiagramEditorTest.java", "diffHunk": "@@ -16,614 +16,10 @@\n \n package org.kie.workbench.common.dmn.project.client.editor;\n \n-import java.lang.annotation.Annotation;\n-import java.util.function.Consumer;\n-import java.util.function.Supplier;\n+// TODO @RunWith(GwtMockitoTestRunner.class)\n+// TODO @WithClassesToStub(PathPlaceRequest.class)\n+public class DMNDiagramEditorTest {", "originalCommit": "1635263895eddfecc1a5ea04640f084fc208fd77", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5MTk2NDA2Ng==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3498#discussion_r591964066", "bodyText": "done!", "author": "romartin", "createdAt": "2021-03-10T23:51:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTQ3MzM5MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTQ3NDAyOA==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3498#discussion_r529474028", "bodyText": "same as above", "author": "domhanak", "createdAt": "2020-11-24T11:28:07Z", "path": "kie-wb-common-dmn/kie-wb-common-dmn-project-client/src/test/java/org/kie/workbench/common/dmn/project/client/session/DMNEditorSessionCommandsTest.java", "diffHunk": "@@ -16,36 +16,9 @@\n \n package org.kie.workbench.common.dmn.project.client.session;\n \n-import org.junit.Test;\n-import org.junit.runner.RunWith;\n-import org.kie.workbench.common.dmn.client.widgets.toolbar.DMNPerformAutomaticLayoutCommand;\n-import org.kie.workbench.common.dmn.project.client.session.command.SaveDiagramSessionCommand;\n-import org.kie.workbench.common.dmn.project.client.validation.DMNValidateSessionCommand;\n-import org.kie.workbench.common.stunner.core.client.session.command.impl.ClearSessionCommand;\n-import org.kie.workbench.common.stunner.core.client.session.command.impl.CopySelectionSessionCommand;\n-import org.kie.workbench.common.stunner.core.client.session.command.impl.CutSelectionSessionCommand;\n-import org.kie.workbench.common.stunner.core.client.session.command.impl.DeleteSelectionSessionCommand;\n-import org.kie.workbench.common.stunner.core.client.session.command.impl.ExportToJpgSessionCommand;\n-import org.kie.workbench.common.stunner.core.client.session.command.impl.ExportToPdfSessionCommand;\n-import org.kie.workbench.common.stunner.core.client.session.command.impl.ExportToPngSessionCommand;\n-import org.kie.workbench.common.stunner.core.client.session.command.impl.ExportToRawFormatSessionCommand;\n-import org.kie.workbench.common.stunner.core.client.session.command.impl.ExportToSvgSessionCommand;\n-import org.kie.workbench.common.stunner.core.client.session.command.impl.PasteSelectionSessionCommand;\n-import org.kie.workbench.common.stunner.core.client.session.command.impl.RedoSessionCommand;\n-import org.kie.workbench.common.stunner.core.client.session.command.impl.SwitchGridSessionCommand;\n-import org.kie.workbench.common.stunner.core.client.session.command.impl.UndoSessionCommand;\n-import org.kie.workbench.common.stunner.core.client.session.command.impl.VisitGraphSessionCommand;\n-import org.kie.workbench.common.stunner.kogito.client.session.EditorSessionCommands;\n-import org.kie.workbench.common.stunner.kogito.client.session.EditorSessionCommandsTest;\n-import org.mockito.InOrder;\n-import org.mockito.runners.MockitoJUnitRunner;\n-\n-import static org.mockito.Matchers.eq;\n-import static org.mockito.Mockito.inOrder;\n-import static org.mockito.Mockito.verify;\n-\n-@RunWith(MockitoJUnitRunner.class)\n-public class DMNEditorSessionCommandsTest extends EditorSessionCommandsTest {\n+// TODO\n+// @RunWith(MockitoJUnitRunner.class)\n+public class DMNEditorSessionCommandsTest /*extends EditorSessionCommandsTest {", "originalCommit": "1635263895eddfecc1a5ea04640f084fc208fd77", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5MTk2NDIyMw==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3498#discussion_r591964223", "bodyText": "done!", "author": "romartin", "createdAt": "2021-03-10T23:51:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTQ3NDAyOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTQ3OTM3OQ==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3498#discussion_r529479379", "bodyText": "Could we have a javadoc for this class?", "author": "domhanak", "createdAt": "2020-11-24T11:37:19Z", "path": "kie-wb-common-stunner/kie-wb-common-stunner-client/kie-wb-common-stunner-widgets/src/main/java/org/kie/workbench/common/stunner/client/widgets/editor/StunnerEditor.java", "diffHunk": "@@ -0,0 +1,246 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.kie.workbench.common.stunner.client.widgets.editor;\n+\n+import java.util.function.Consumer;\n+\n+import javax.annotation.PreDestroy;\n+import javax.enterprise.context.ApplicationScoped;\n+import javax.inject.Inject;\n+\n+import com.google.gwt.core.client.Scheduler;\n+import com.google.gwt.user.client.ui.IsWidget;\n+import org.jboss.errai.ioc.client.api.ManagedInstance;\n+import org.kie.workbench.common.stunner.client.widgets.presenters.Viewer;\n+import org.kie.workbench.common.stunner.client.widgets.presenters.session.SessionDiagramPresenter;\n+import org.kie.workbench.common.stunner.client.widgets.presenters.session.SessionPresenter;\n+import org.kie.workbench.common.stunner.client.widgets.presenters.session.impl.SessionEditorPresenter;\n+import org.kie.workbench.common.stunner.client.widgets.presenters.session.impl.SessionViewerPresenter;\n+import org.kie.workbench.common.stunner.core.client.canvas.CanvasHandler;\n+import org.kie.workbench.common.stunner.core.client.i18n.ClientTranslationService;\n+import org.kie.workbench.common.stunner.core.client.service.ClientRuntimeError;\n+import org.kie.workbench.common.stunner.core.client.session.ClientSession;\n+import org.kie.workbench.common.stunner.core.client.session.impl.EditorSession;\n+import org.kie.workbench.common.stunner.core.client.session.impl.ViewerSession;\n+import org.kie.workbench.common.stunner.core.definition.exception.DefinitionNotFoundException;\n+import org.kie.workbench.common.stunner.core.diagram.Diagram;\n+import org.kie.workbench.common.stunner.core.diagram.DiagramParsingException;\n+import org.kie.workbench.common.stunner.core.i18n.CoreTranslationMessages;\n+import org.uberfire.client.workbench.widgets.common.ErrorPopupPresenter;\n+import org.uberfire.ext.widgets.common.client.ace.AceEditorMode;\n+import org.uberfire.ext.widgets.core.client.editors.texteditor.TextEditorView;\n+\n+@ApplicationScoped\n+public class StunnerEditor {", "originalCommit": "1635263895eddfecc1a5ea04640f084fc208fd77", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5MTk2NTgyNQ==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3498#discussion_r591965825", "bodyText": "IMO Javadocs are not much useful... they get out of date constantly and most of the javadocs text is not usually helpping too much, long discussions I've seen around this.\nAnyway, maybe on other situations it's ok, but in the case for this StunnerEditor type, I think the API is really clear (open(), close(), destroy(), etc), easy to read and to use, so don't really think it's necessary to add javadocs anyway", "author": "romartin", "createdAt": "2021-03-10T23:56:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTQ3OTM3OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTQ4NTE5MQ==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3498#discussion_r529485191", "bodyText": "Does it make sense to add some cases where opening ends in failure? For exampletestOpenFailure() ?", "author": "domhanak", "createdAt": "2020-11-24T11:47:43Z", "path": "kie-wb-common-stunner/kie-wb-common-stunner-client/kie-wb-common-stunner-widgets/src/test/java/org/kie/workbench/common/stunner/client/widgets/editor/StunnerEditorTest.java", "diffHunk": "@@ -0,0 +1,268 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.kie.workbench.common.stunner.client.widgets.editor;\n+\n+import java.util.function.Consumer;\n+\n+import com.google.gwt.user.client.ui.Widget;\n+import com.google.gwtmockito.GwtMockitoTestRunner;\n+import org.jboss.errai.ioc.client.api.ManagedInstance;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.kie.workbench.common.stunner.client.widgets.presenters.Viewer;\n+import org.kie.workbench.common.stunner.client.widgets.presenters.session.SessionPresenter;\n+import org.kie.workbench.common.stunner.client.widgets.presenters.session.impl.SessionEditorPresenter;\n+import org.kie.workbench.common.stunner.client.widgets.presenters.session.impl.SessionViewerPresenter;\n+import org.kie.workbench.common.stunner.core.client.ManagedInstanceStub;\n+import org.kie.workbench.common.stunner.core.client.canvas.AbstractCanvasHandler;\n+import org.kie.workbench.common.stunner.core.client.i18n.ClientTranslationService;\n+import org.kie.workbench.common.stunner.core.client.service.ClientRuntimeError;\n+import org.kie.workbench.common.stunner.core.client.session.impl.EditorSession;\n+import org.kie.workbench.common.stunner.core.client.session.impl.ViewerSession;\n+import org.kie.workbench.common.stunner.core.diagram.DiagramImpl;\n+import org.kie.workbench.common.stunner.core.diagram.DiagramParsingException;\n+import org.kie.workbench.common.stunner.core.diagram.Metadata;\n+import org.kie.workbench.common.stunner.core.diagram.MetadataImpl;\n+import org.kie.workbench.common.stunner.core.graph.Graph;\n+import org.mockito.Mock;\n+import org.uberfire.client.workbench.widgets.common.ErrorPopupPresenter;\n+import org.uberfire.ext.widgets.common.client.ace.AceEditorMode;\n+import org.uberfire.ext.widgets.core.client.editors.texteditor.TextEditorView;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertFalse;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertTrue;\n+import static org.mockito.Matchers.any;\n+import static org.mockito.Matchers.anyBoolean;\n+import static org.mockito.Matchers.anyString;\n+import static org.mockito.Matchers.eq;\n+import static org.mockito.Mockito.doAnswer;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.never;\n+import static org.mockito.Mockito.spy;\n+import static org.mockito.Mockito.times;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.when;\n+\n+@RunWith(GwtMockitoTestRunner.class)\n+public class StunnerEditorTest {", "originalCommit": "1635263895eddfecc1a5ea04640f084fc208fd77", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5MTk2NjY0NQ==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3498#discussion_r591966645", "bodyText": "done, there exist the tests for invalid stuff, see testHandleParsingError or testHandleError", "author": "romartin", "createdAt": "2021-03-10T23:57:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTQ4NTE5MQ=="}], "type": "inlineReview"}, {"oid": "55b03618111596d49f8bfd8d7973f02851d5d238", "url": "https://github.com/kiegroup/kie-wb-common/commit/55b03618111596d49f8bfd8d7973f02851d5d238", "message": "KOGITO-3891 & KOGITO-540: Editors refactoring & BPMN editor readonly support", "committedDate": "2020-11-27T21:27:13Z", "type": "forcePushed"}, {"oid": "b3a7fc60353e31282be510ee86f2acb440c8e838", "url": "https://github.com/kiegroup/kie-wb-common/commit/b3a7fc60353e31282be510ee86f2acb440c8e838", "message": "Tests", "committedDate": "2020-12-01T00:58:00Z", "type": "forcePushed"}, {"oid": "64ea710dd24391c0c48afc841d010697308aa137", "url": "https://github.com/kiegroup/kie-wb-common/commit/64ea710dd24391c0c48afc841d010697308aa137", "message": "KOGITO-3891 & KOGITO-540: Editors refactoring & BPMN editor readonly support", "committedDate": "2021-01-14T22:59:11Z", "type": "forcePushed"}, {"oid": "031f11eb7e135eb3cdc5287935694670538b5d8d", "url": "https://github.com/kiegroup/kie-wb-common/commit/031f11eb7e135eb3cdc5287935694670538b5d8d", "message": "KOGITO-3891 & KOGITO-540: Editors refactoring & BPMN editor readonly support", "committedDate": "2021-01-22T23:49:31Z", "type": "forcePushed"}, {"oid": "1c95e36d4a51ebc79e932408b180083c2a1a44d6", "url": "https://github.com/kiegroup/kie-wb-common/commit/1c95e36d4a51ebc79e932408b180083c2a1a44d6", "message": "KOGITO-3891 & KOGITO-540: Editors refactoring & BPMN editor readonly support", "committedDate": "2021-01-26T22:11:58Z", "type": "forcePushed"}, {"oid": "dd0938d41708776173fa326bd4c8a727ba6323e1", "url": "https://github.com/kiegroup/kie-wb-common/commit/dd0938d41708776173fa326bd4c8a727ba6323e1", "message": "KOGITO-3891 & KOGITO-540: Editors refactoring & BPMN editor readonly support", "committedDate": "2021-01-27T00:53:50Z", "type": "forcePushed"}, {"oid": "fc1cda09336931f827f21a52ca1db97ec347d958", "url": "https://github.com/kiegroup/kie-wb-common/commit/fc1cda09336931f827f21a52ca1db97ec347d958", "message": "KOGITO-3891 & KOGITO-540: Editors refactoring & BPMN editor readonly support", "committedDate": "2021-01-27T01:35:38Z", "type": "forcePushed"}, {"oid": "c342d163a406e567a3c745a0256d5fb4e3ea4e29", "url": "https://github.com/kiegroup/kie-wb-common/commit/c342d163a406e567a3c745a0256d5fb4e3ea4e29", "message": "KOGITO-3891 & KOGITO-540: Editors refactoring & BPMN editor readonly support", "committedDate": "2021-02-03T00:25:14Z", "type": "forcePushed"}, {"oid": "37fffcd3b274a1c1d8d837603c8a00a8b3cd9b21", "url": "https://github.com/kiegroup/kie-wb-common/commit/37fffcd3b274a1c1d8d837603c8a00a8b3cd9b21", "message": "KOGITO-3891 & KOGITO-540: Editors refactoring & BPMN editor readonly support", "committedDate": "2021-02-09T22:52:26Z", "type": "forcePushed"}, {"oid": "b1c88bf7f7d5e2b1e4e1009ae1c7e7306c43c831", "url": "https://github.com/kiegroup/kie-wb-common/commit/b1c88bf7f7d5e2b1e4e1009ae1c7e7306c43c831", "message": "KOGITO-3891 & KOGITO-540: Editors refactoring & BPMN editor readonly support", "committedDate": "2021-02-23T21:25:10Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NTAxNzY0MQ==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3498#discussion_r585017641", "bodyText": "What is a status of this TODO please?", "author": "jomarko", "createdAt": "2021-03-01T20:12:47Z", "path": "kie-wb-common-dmn/kie-wb-common-dmn-project-client/src/test/java/org/kie/workbench/common/dmn/project/client/editor/DMNDiagramEditorTest.java", "diffHunk": "@@ -398,142 +311,136 @@ public void testInitialiseKieEditorForSession() {\n \n     @Test\n     public void testInitialiseKieEditorForSessionWhenInitializingKieEditorForSessionThenDiagramAlreadyLoaded() {\n-        doNothing().when(diagramEditor).superInitialiseKieEditorForSession(any());\n         final InOrder inOrder = inOrder(diagramEditor);\n-\n         diagramEditor.initialiseKieEditorForSession(diagram);\n-\n         inOrder.verify(diagramEditor).onDiagramLoad();\n         inOrder.verify(diagramEditor).superInitialiseKieEditorForSession(any());\n     }\n \n     @Test\n     public void testSetupSearchComponent() {\n-\n         diagramEditor.setupSearchComponent();\n-\n         verify(searchBarComponent).init(editorSearchIndex);\n         verify(multiPage).addTabBarWidget(searchBarComponentWidget);\n     }\n \n-    @Test\n-    public void testOnDiagramLoadWhenCanvasHandlerIsNotNull() {\n-        when(sessionManager.getCurrentSession()).thenReturn(dmnEditorSession);\n-        when(dmnEditorSession.getCanvasHandler()).thenReturn(canvasHandler);\n-        when(canvasHandler.getDiagram()).thenReturn(diagram);\n-\n-        open();\n-\n-        verify(decisionNavigatorDock, atLeast(1)).reload();\n-        verify(expressionEditor, atLeast(1)).setToolbarStateHandler(Mockito.<DMNProjectToolbarStateHandler>any());\n-        verify(dataTypesPage, atLeast(1)).reload();\n-        verify(layoutHelper).applyLayout(diagram, layoutExecutor);\n-        verify(includedModelsPage, atLeast(1)).reload();\n-        verify(lazyCanvasFocusUtils, atLeast(1)).releaseFocus();\n-    }\n-\n-    @Test\n-    @SuppressWarnings(\"unchecked\")\n-    public void testOnDiagramLoadWhenCanvasHandlerIsNull() {\n-        diagramEditor.onDiagramLoad();\n-\n-        verify(expressionEditor, never()).setToolbarStateHandler(Mockito.<DMNProjectToolbarStateHandler>any());\n-        verify(decisionNavigatorDock, never()).reload();\n-        verify(decisionNavigatorDock, never()).open();\n-        verify(dataTypesPage, never()).reload();\n-        verify(includedModelsPage, never()).reload();\n-        verify(lazyCanvasFocusUtils, never()).releaseFocus();\n-    }\n-\n     @Test\n     public void testOnFocus() {\n-        doNothing().when(diagramEditor).superDoFocus();\n-\n+        when(stunnerEditor.isClosed()).thenReturn(false);\n         diagramEditor.onFocus();\n-\n-        verify(diagramEditor).superDoFocus();\n+        verify(stunnerEditor).focus();\n+        verify(stunnerEditor, never()).lostFocus();\n         verify(diagramEditor).onDiagramLoad();\n         verify(dataTypesPage).onFocus();\n+        verify(dataTypesPage, never()).onLostFocus();\n         verify(dataTypesPage).enableShortcuts();\n+        verify(dataTypesPage, never()).disableShortcuts();\n     }\n \n     @Test\n     public void testOnLostFocus() {\n+        when(stunnerEditor.isClosed()).thenReturn(false);\n         diagramEditor.onLostFocus();\n-\n+        verify(stunnerEditor).lostFocus();\n+        verify(stunnerEditor, never()).focus();\n         verify(dataTypesPage).onLostFocus();\n-    }\n-\n-    @Test\n-    public void testOnEditExpressionEvent() {\n-        when(editExpressionEvent.getSession()).thenReturn(dmnEditorSession);\n-        when(sessionManager.getCurrentSession()).thenReturn(dmnEditorSession);\n-        when(dmnEditorSession.getCanvasHandler()).thenReturn(canvasHandler);\n-\n-        open();\n-\n-        diagramEditor.onEditExpressionEvent(editExpressionEvent);\n-\n-        verify(searchBarComponent).disableSearch();\n-        verify(sessionCommandManager).execute(eq(canvasHandler),\n-                                              Mockito.<NavigateToExpressionEditorCommand>any());\n+        verify(dataTypesPage, never()).onFocus();\n     }\n \n     @Test\n     public void testOnDataTypePageNavTabActiveEvent() {\n         diagramEditor.onDataTypePageNavTabActiveEvent(mock(DataTypePageTabActiveEvent.class));\n-\n         verify(multiPage).selectPage(DATA_TYPES_PAGE_INDEX);\n     }\n \n     @Test\n     public void testOnDataTypeEditModeToggleWhenEditModeIsEnabled() {\n         final DataTypeEditModeToggleEvent editModeToggleEvent = mock(DataTypeEditModeToggleEvent.class);\n-\n         doNothing().when(diagramEditor).disableMenuItem(any());\n         when(editModeToggleEvent.isEditModeEnabled()).thenReturn(true);\n-\n         diagramEditor.getOnDataTypeEditModeToggleCallback(editModeToggleEvent).onInvoke();\n-\n         verify(diagramEditor).disableMenuItem(MenuItems.SAVE);\n     }\n \n     @Test\n     public void testOnDataTypeEditModeToggleWhenEditModeIsNotEnabled() {\n         final DataTypeEditModeToggleEvent editModeToggleEvent = mock(DataTypeEditModeToggleEvent.class);\n-\n         doNothing().when(diagramEditor).enableMenuItem(any());\n         when(editModeToggleEvent.isEditModeEnabled()).thenReturn(false);\n-\n         diagramEditor.getOnDataTypeEditModeToggleCallback(editModeToggleEvent).onInvoke();\n-\n         verify(diagramEditor).enableMenuItem(MenuItems.SAVE);\n     }\n \n     @Test\n     public void testShowDocks() {\n         diagramEditor.showDocks();\n-\n         verify(decisionNavigatorDock).open();\n         verify(docks).show();\n     }\n \n     @Test\n     public void testHideDocks() {\n         diagramEditor.hideDocks();\n-\n         verify(decisionNavigatorDock).close();\n         verify(decisionNavigatorDock).resetContent();\n         verify(docks).hide();\n     }\n \n     @Override\n     public void testDocksQualifiers() {\n-        final Annotation[] qualifiers = presenter.getDockQualifiers();\n+        final Annotation[] qualifiers = diagramEditor.getDockQualifiers();\n         assertEquals(1, qualifiers.length);\n         assertEquals(DMNEditor.class, qualifiers[0].annotationType());\n     }\n \n+    /*\n+\n+   // TODO: Complete all below", "originalCommit": "b1c88bf7f7d5e2b1e4e1009ae1c7e7306c43c831", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5MTkzNDkzMQ==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3498#discussion_r591934931", "bodyText": "done", "author": "romartin", "createdAt": "2021-03-10T23:00:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NTAxNzY0MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NTAyMTAxNw==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3498#discussion_r585021017", "bodyText": "not sure if this is needed, however if yes, then 2021", "author": "jomarko", "createdAt": "2021-03-01T20:18:20Z", "path": "kie-wb-common-dmn/kie-wb-common-dmn-webapp-kogito-common/src/main/java/org/kie/workbench/common/dmn/webapp/kogito/common/client/editor/DMNDiagramEditorView.java", "diffHunk": "@@ -1,5 +1,5 @@\n /*\n- * Copyright 2019 Red Hat, Inc. and/or its affiliates.\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.", "originalCommit": "b1c88bf7f7d5e2b1e4e1009ae1c7e7306c43c831", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5MTkzNTAwMg==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3498#discussion_r591935002", "bodyText": "done", "author": "romartin", "createdAt": "2021-03-10T23:00:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NTAyMTAxNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NTAyNDY0Mg==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3498#discussion_r585024642", "bodyText": "is this a proper year please?", "author": "jomarko", "createdAt": "2021-03-01T20:24:39Z", "path": "kie-wb-common-dmn/kie-wb-common-dmn-webapp-kogito-runtime/src/test/java/org/kie/workbench/common/dmn/showcase/client/editor/DMNDiagramEditorTest.java", "diffHunk": "@@ -1,5 +1,5 @@\n /*\n- * Copyright 2019 Red Hat, Inc. and/or its affiliates.\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.", "originalCommit": "b1c88bf7f7d5e2b1e4e1009ae1c7e7306c43c831", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5MTkzNTI3MA==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3498#discussion_r591935270", "bodyText": "done", "author": "romartin", "createdAt": "2021-03-10T23:00:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NTAyNDY0Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NTAyNDkzNg==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3498#discussion_r585024936", "bodyText": "What is status of this TODO please?", "author": "jomarko", "createdAt": "2021-03-01T20:25:09Z", "path": "kie-wb-common-dmn/kie-wb-common-dmn-webapp-kogito-runtime/src/test/java/org/kie/workbench/common/dmn/showcase/client/editor/DMNDiagramEditorTest.java", "diffHunk": "@@ -15,98 +15,8 @@\n  */\n package org.kie.workbench.common.dmn.showcase.client.editor;\n \n-import java.util.Collections;\n+// TODO @RunWith(GwtMockitoTestRunner.class)", "originalCommit": "b1c88bf7f7d5e2b1e4e1009ae1c7e7306c43c831", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NTAyNTI1Nw==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3498#discussion_r585025257", "bodyText": "what is status of this todo please?", "author": "jomarko", "createdAt": "2021-03-01T20:25:40Z", "path": "kie-wb-common-dmn/kie-wb-common-dmn-webapp-kogito-testing/src/main/java/org/kie/workbench/common/dmn/showcase/client/editor/DMNDiagramEditor.java", "diffHunk": "@@ -240,9 +190,10 @@ private Path makeMetadataPath(final Metadata metadata) {\n         return PathFactory.newPath(fileName, uri + \"/\" + URIUtil.encode(fileName));\n     }\n \n+    // TODO: This was called by menus... who calls this now?", "originalCommit": "b1c88bf7f7d5e2b1e4e1009ae1c7e7306c43c831", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5MTkzNTMzNw==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3498#discussion_r591935337", "bodyText": "resolved", "author": "romartin", "createdAt": "2021-03-10T23:00:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NTAyNTI1Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NTAyNTY2Mw==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3498#discussion_r585025663", "bodyText": "will not comment this kind of change furthermore, however I am not sure if we should change the year for existing files.", "author": "jomarko", "createdAt": "2021-03-01T20:26:18Z", "path": "kie-wb-common-dmn/kie-wb-common-dmn-webapp-kogito-testing/src/test/java/org/kie/workbench/common/dmn/showcase/client/editor/DMNDiagramEditorTest.java", "diffHunk": "@@ -1,5 +1,5 @@\n /*\n- * Copyright 2019 Red Hat, Inc. and/or its affiliates.\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.", "originalCommit": "b1c88bf7f7d5e2b1e4e1009ae1c7e7306c43c831", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5MTkzNTU2NA==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3498#discussion_r591935564", "bodyText": "done", "author": "romartin", "createdAt": "2021-03-10T23:01:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NTAyNTY2Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NTAyNTgzMg==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3498#discussion_r585025832", "bodyText": "what is a status of this todo please?", "author": "jomarko", "createdAt": "2021-03-01T20:26:34Z", "path": "kie-wb-common-dmn/kie-wb-common-dmn-webapp-kogito-testing/src/test/java/org/kie/workbench/common/dmn/showcase/client/editor/DMNDiagramEditorTest.java", "diffHunk": "@@ -15,251 +15,7 @@\n  */\n package org.kie.workbench.common.dmn.showcase.client.editor;\n \n-import com.google.gwtmockito.GwtMockitoTestRunner;\n-import elemental2.dom.HTMLElement;\n-import org.appformer.client.context.EditorContextProvider;\n-import org.jboss.errai.common.client.ui.ElementWrapperWidget;\n-import org.junit.Test;\n-import org.junit.runner.RunWith;\n-import org.kie.workbench.common.dmn.client.editors.types.listview.common.DataTypeEditModeToggleEvent;\n-import org.kie.workbench.common.dmn.showcase.client.navigator.DMNVFSService;\n-import org.kie.workbench.common.dmn.webapp.kogito.common.client.editor.AbstractDMNDiagramEditor;\n-import org.kie.workbench.common.dmn.webapp.kogito.common.client.editor.AbstractDMNDiagramEditorTest;\n-import org.kie.workbench.common.stunner.core.client.canvas.util.CanvasFileExport;\n-import org.kie.workbench.common.stunner.core.client.service.ServiceCallback;\n-import org.kie.workbench.common.stunner.kogito.client.PromiseMock;\n-import org.mockito.ArgumentCaptor;\n-import org.mockito.Captor;\n-import org.mockito.Mock;\n-import org.uberfire.backend.vfs.Path;\n-import org.uberfire.client.promise.Promises;\n-import org.uberfire.ext.editor.commons.client.file.popups.CopyPopUpPresenter;\n-import org.uberfire.ext.editor.commons.client.file.popups.DeletePopUpPresenter;\n-import org.uberfire.ext.editor.commons.client.file.popups.RenamePopUpPresenter;\n-import org.uberfire.ext.editor.commons.client.menu.BasicFileMenuBuilderImpl;\n-import org.uberfire.ext.editor.commons.client.menu.RestoreVersionCommandProvider;\n-import org.uberfire.ext.widgets.common.client.common.BusyIndicatorView;\n-import org.uberfire.mvp.Command;\n-import org.uberfire.mvp.PlaceRequest;\n-import org.uberfire.promise.SyncPromises;\n-import org.uberfire.util.URIUtil;\n-import org.uberfire.workbench.events.NotificationEvent;\n-import org.uberfire.workbench.model.menu.MenuItem;\n+// TODO @RunWith(GwtMockitoTestRunner.class)", "originalCommit": "b1c88bf7f7d5e2b1e4e1009ae1c7e7306c43c831", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5MTkzNTcxNQ==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3498#discussion_r591935715", "bodyText": "rolled-back and fixed, done!", "author": "romartin", "createdAt": "2021-03-10T23:01:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NTAyNTgzMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NTAyOTQ5NA==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3498#discussion_r585029494", "bodyText": "is getCanvasHandler() always non null? asking because it is a public method (without a javadoc or a assertion) and we always call some other method in a fluent API way.", "author": "jomarko", "createdAt": "2021-03-01T20:32:39Z", "path": "kie-wb-common-stunner/kie-wb-common-stunner-client/kie-wb-common-stunner-widgets/src/main/java/org/kie/workbench/common/stunner/client/widgets/editor/StunnerEditor.java", "diffHunk": "@@ -0,0 +1,261 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.kie.workbench.common.stunner.client.widgets.editor;\n+\n+import java.util.function.Consumer;\n+\n+import javax.annotation.PreDestroy;\n+import javax.enterprise.context.Dependent;\n+import javax.inject.Inject;\n+\n+import com.google.gwt.core.client.Scheduler;\n+import com.google.gwt.user.client.ui.IsWidget;\n+import org.jboss.errai.ioc.client.api.ManagedInstance;\n+import org.kie.workbench.common.stunner.client.widgets.presenters.Viewer;\n+import org.kie.workbench.common.stunner.client.widgets.presenters.session.SessionDiagramPresenter;\n+import org.kie.workbench.common.stunner.client.widgets.presenters.session.SessionPresenter;\n+import org.kie.workbench.common.stunner.client.widgets.presenters.session.impl.SessionEditorPresenter;\n+import org.kie.workbench.common.stunner.client.widgets.presenters.session.impl.SessionViewerPresenter;\n+import org.kie.workbench.common.stunner.core.client.canvas.CanvasHandler;\n+import org.kie.workbench.common.stunner.core.client.i18n.ClientTranslationService;\n+import org.kie.workbench.common.stunner.core.client.service.ClientRuntimeError;\n+import org.kie.workbench.common.stunner.core.client.session.ClientSession;\n+import org.kie.workbench.common.stunner.core.client.session.impl.EditorSession;\n+import org.kie.workbench.common.stunner.core.client.session.impl.ViewerSession;\n+import org.kie.workbench.common.stunner.core.definition.exception.DefinitionNotFoundException;\n+import org.kie.workbench.common.stunner.core.diagram.Diagram;\n+import org.kie.workbench.common.stunner.core.diagram.DiagramParsingException;\n+import org.kie.workbench.common.stunner.core.i18n.CoreTranslationMessages;\n+import org.uberfire.client.workbench.widgets.common.ErrorPopupPresenter;\n+import org.uberfire.ext.widgets.common.client.ace.AceEditorMode;\n+import org.uberfire.ext.widgets.core.client.editors.texteditor.TextEditorView;\n+\n+@Dependent\n+public class StunnerEditor {\n+\n+    private final ManagedInstance<SessionEditorPresenter<EditorSession>> editorSessionPresenterInstances;\n+    private final ManagedInstance<SessionViewerPresenter<ViewerSession>> viewerSessionPresenterInstances;\n+    private final ClientTranslationService translationService;\n+    private final ManagedInstance<TextEditorView> xmlEditorViews;\n+    private final ErrorPopupPresenter errorPopupPresenter;\n+    private final StunnerEditorView view;\n+\n+    private SessionDiagramPresenter diagramPresenter;\n+    private TextEditorView xmlEditorView;\n+    private boolean isReadOnly;\n+    private Consumer<DiagramParsingException> parsingExceptionProcessor;\n+    private Consumer<Throwable> exceptionProcessor;\n+    private Consumer<Integer> onResetContentHashProcessor;\n+    private int contentHash;\n+\n+    // CDI proxy.\n+    public StunnerEditor() {\n+        this(null, null, null, null, null, null);\n+    }\n+\n+    @Inject\n+    public StunnerEditor(ManagedInstance<SessionEditorPresenter<EditorSession>> editorSessionPresenterInstances,\n+                         ManagedInstance<SessionViewerPresenter<ViewerSession>> viewerSessionPresenterInstances,\n+                         ClientTranslationService translationService,\n+                         ManagedInstance<TextEditorView> xmlEditorViews,\n+                         ErrorPopupPresenter errorPopupPresenter,\n+                         StunnerEditorView view) {\n+        this.editorSessionPresenterInstances = editorSessionPresenterInstances;\n+        this.viewerSessionPresenterInstances = viewerSessionPresenterInstances;\n+        this.translationService = translationService;\n+        this.xmlEditorViews = xmlEditorViews;\n+        this.errorPopupPresenter = errorPopupPresenter;\n+        this.isReadOnly = false;\n+        this.view = view;\n+        this.parsingExceptionProcessor = e -> {\n+        };\n+        this.exceptionProcessor = e -> {\n+        };\n+        this.onResetContentHashProcessor = e -> {\n+        };\n+    }\n+\n+    public void setReadOnly(boolean readOnly) {\n+        isReadOnly = readOnly;\n+    }\n+\n+    public void setOnResetContentHashProcessor(Consumer<Integer> onResetContentHashProcessor) {\n+        this.onResetContentHashProcessor = onResetContentHashProcessor;\n+    }\n+\n+    public void setParsingExceptionProcessor(Consumer<DiagramParsingException> parsingExceptionProcessor) {\n+        this.parsingExceptionProcessor = parsingExceptionProcessor;\n+    }\n+\n+    public void setExceptionProcessor(Consumer<Throwable> exceptionProcessor) {\n+        this.exceptionProcessor = exceptionProcessor;\n+    }\n+\n+    public void open(final Diagram diagram,\n+                     final Viewer.Callback callback) {\n+        // Close in case any diagram already being opened.\n+        close();\n+        // Instantiate.\n+        if (!isReadOnly) {\n+            diagramPresenter = editorSessionPresenterInstances.get();\n+        } else {\n+            diagramPresenter = viewerSessionPresenterInstances.get();\n+        }\n+        diagramPresenter.displayNotifications(type -> true);\n+        diagramPresenter.withPalette(!isReadOnly);\n+        diagramPresenter.withToolbar(false);\n+        view.setWidget(diagramPresenter.getView());\n+        // Open.\n+        diagramPresenter.open(diagram, new SessionPresenter.SessionPresenterCallback() {\n+            @Override\n+            public void onSuccess() {\n+                callback.onSuccess();\n+                resetContentHash();\n+            }\n+\n+            @Override\n+            public void onError(ClientRuntimeError error) {\n+                handleError(error);\n+                callback.onError(error);\n+            }\n+        });\n+    }\n+\n+    public int getCurrentContentHash() {\n+        if (isXmlEditorEnabled()) {\n+            return xmlEditorView.getContent().hashCode();\n+        }\n+        if (null == getSession()) {\n+            return 0;\n+        }\n+        if (null == getCanvasHandler().getDiagram()) {", "originalCommit": "b1c88bf7f7d5e2b1e4e1009ae1c7e7306c43c831", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5MTkzODQ3Ng==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3498#discussion_r591938476", "bodyText": "well if the session is present, this class assumes the canvasHandler will be akways not null, as this class manages the session and the presenters and keeps both up to date. From the API perspective, if you call getCanvasHandler() it could be null or even throw a NPE, but because there is no session also", "author": "romartin", "createdAt": "2021-03-10T23:07:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NTAyOTQ5NA=="}], "type": "inlineReview"}, {"oid": "2cb704c56069f287ba5c275604e57ee8fd77122e", "url": "https://github.com/kiegroup/kie-wb-common/commit/2cb704c56069f287ba5c275604e57ee8fd77122e", "message": "KOGITO-3891 & KOGITO-540: Editors refactoring & BPMN editor readonly support", "committedDate": "2021-03-09T23:12:26Z", "type": "forcePushed"}, {"oid": "a5c00e0a47dd8dec86028b86b61fb7db279274ae", "url": "https://github.com/kiegroup/kie-wb-common/commit/a5c00e0a47dd8dec86028b86b61fb7db279274ae", "message": "KOGITO-3891 & KOGITO-540: Editors refactoring & BPMN editor readonly support", "committedDate": "2021-03-10T23:48:34Z", "type": "forcePushed"}, {"oid": "e89831a11670a84cd13610ed76a133c308ef3916", "url": "https://github.com/kiegroup/kie-wb-common/commit/e89831a11670a84cd13610ed76a133c308ef3916", "message": "KOGITO-3891 & KOGITO-540: Editors refactoring & BPMN editor readonly support", "committedDate": "2021-03-21T21:07:26Z", "type": "forcePushed"}, {"oid": "30ed5073bf7cd9bdcef450561af7208499c341a8", "url": "https://github.com/kiegroup/kie-wb-common/commit/30ed5073bf7cd9bdcef450561af7208499c341a8", "message": "KOGITO-3891 & KOGITO-540: Editors refactoring & BPMN editor readonly support", "committedDate": "2021-03-25T23:39:05Z", "type": "commit"}, {"oid": "30ed5073bf7cd9bdcef450561af7208499c341a8", "url": "https://github.com/kiegroup/kie-wb-common/commit/30ed5073bf7cd9bdcef450561af7208499c341a8", "message": "KOGITO-3891 & KOGITO-540: Editors refactoring & BPMN editor readonly support", "committedDate": "2021-03-25T23:39:05Z", "type": "forcePushed"}]}