{"pr_number": 2646, "pr_title": "Fix #2510: Yaml containing aliases rejected due to FasterXML bug", "pr_createdAt": "2020-12-02T16:36:56Z", "pr_url": "https://github.com/fabric8io/kubernetes-client/pull/2646", "timeline": [{"oid": "db4b6ce919cbcdbfb86cbe388b1c536557cd410d", "url": "https://github.com/fabric8io/kubernetes-client/commit/db4b6ce919cbcdbfb86cbe388b1c536557cd410d", "message": "Fix #2510: Yaml containing aliases rejected due to FasterXML bug\n\n+ Fallback to SnakeYAML while deserializing Kubernetes YAML manifests\n+ Refactored SerializationUtils#dumpAsYaml(...) to use SnakeYAML instead\n  of Jackson\n+ Moved `SerializationUtils` to `io.fabric8.kubernetes.client.utils`", "committedDate": "2020-12-02T17:04:45Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDA0MTY1NQ==", "url": "https://github.com/fabric8io/kubernetes-client/pull/2646#discussion_r540041655", "bodyText": "This class (Yaml) is not thread safe, should be instantiated for each request.\nnit: it's not a mapper either.\nThe field should be removed. See proposed changes in lines 62-64 for the thread-safety issue.", "author": "manusa", "createdAt": "2020-12-10T10:12:01Z", "path": "kubernetes-client/src/main/java/io/fabric8/kubernetes/client/utils/Serialization.java", "diffHunk": "@@ -46,6 +48,7 @@ private Serialization() { }\n     JSON_MAPPER.registerModule(new JavaTimeModule());\n   }\n   private static final ObjectMapper YAML_MAPPER = new ObjectMapper(new YAMLFactory());\n+  private static final Yaml SNAKE_YAML_MAPPER = new Yaml();", "originalCommit": "db4b6ce919cbcdbfb86cbe388b1c536557cd410d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDA0MjA4NQ==", "url": "https://github.com/fabric8io/kubernetes-client/pull/2646#discussion_r540042085", "bodyText": "https://github.com/fabric8io/kubernetes-client/pull/2646/files#r540041655\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              public static Yaml snakeYamlMapper() {\n          \n          \n            \n                return SNAKE_YAML_MAPPER;\n          \n          \n            \n              }\n          \n          \n            \n              public static Yaml newSnakeYaml() {\n          \n          \n            \n                return new Yaml();\n          \n          \n            \n              }", "author": "manusa", "createdAt": "2020-12-10T10:12:26Z", "path": "kubernetes-client/src/main/java/io/fabric8/kubernetes/client/utils/Serialization.java", "diffHunk": "@@ -56,6 +59,10 @@ public static ObjectMapper yamlMapper() {\n     return YAML_MAPPER;\n   }\n \n+  public static Yaml snakeYamlMapper() {\n+    return SNAKE_YAML_MAPPER;\n+  }", "originalCommit": "db4b6ce919cbcdbfb86cbe388b1c536557cd410d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "a7d65db4c7f0b70bd9efeb2e7918e87419ff208b", "url": "https://github.com/fabric8io/kubernetes-client/commit/a7d65db4c7f0b70bd9efeb2e7918e87419ff208b", "message": "Fix #2510: Yaml containing aliases rejected due to FasterXML bug\n\nModify the way we deserialize Yaml objects. Load them into raw HashMap\nusing SnakeYAML and then use Jackson to convert them to JSON and finally\nthe required object", "committedDate": "2020-12-11T07:02:29Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDc1NDAxNA==", "url": "https://github.com/fabric8io/kubernetes-client/pull/2646#discussion_r540754014", "bodyText": "nit: these comments are very redundant", "author": "manusa", "createdAt": "2020-12-11T07:53:33Z", "path": "kubernetes-client/src/main/java/io/fabric8/kubernetes/client/utils/Serialization.java", "diffHunk": "@@ -294,4 +294,21 @@ private static String readSpecFileFromInputStream(InputStream inputStream) {\n       throw new RuntimeException(\"Unable to read InputStream.\" + e);\n     }\n   }\n+\n+  private static <T> T unmarshalYaml(InputStream is, TypeReference<T> type) throws JsonProcessingException {\n+    final Yaml yaml = new Yaml();\n+    // Load YAML into HashMap using SnakeYAML", "originalCommit": "a7d65db4c7f0b70bd9efeb2e7918e87419ff208b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "db1923b62b44b774077cf5359b0492ab6eda75bb", "url": "https://github.com/fabric8io/kubernetes-client/commit/db1923b62b44b774077cf5359b0492ab6eda75bb", "message": "Fix #2510: Yaml containing aliases rejected due to FasterXML bug\n\nModify the way we deserialize Yaml objects. Load them into raw HashMap\nusing SnakeYAML and then use Jackson to convert them to JSON and finally\nthe required object", "committedDate": "2020-12-11T09:18:38Z", "type": "commit"}, {"oid": "db1923b62b44b774077cf5359b0492ab6eda75bb", "url": "https://github.com/fabric8io/kubernetes-client/commit/db1923b62b44b774077cf5359b0492ab6eda75bb", "message": "Fix #2510: Yaml containing aliases rejected due to FasterXML bug\n\nModify the way we deserialize Yaml objects. Load them into raw HashMap\nusing SnakeYAML and then use Jackson to convert them to JSON and finally\nthe required object", "committedDate": "2020-12-11T09:18:38Z", "type": "forcePushed"}]}