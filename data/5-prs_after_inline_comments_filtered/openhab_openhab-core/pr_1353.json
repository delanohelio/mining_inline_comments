{"pr_number": 1353, "pr_title": "[ThingManagerImpl] Prevent multiple handler inits on thing enabling", "pr_createdAt": "2020-02-02T14:49:31Z", "pr_url": "https://github.com/openhab/openhab-core/pull/1353", "timeline": [{"oid": "c318a96f065d68e937c37c1bed178ba1718ae019", "url": "https://github.com/openhab/openhab-core/commit/c318a96f065d68e937c37c1bed178ba1718ae019", "message": "[ThingManagerImpl] Prevent multiple handler inits on thing enabling\n\nWhen a thing is enabled, the `ThingManagerImpl` takes care of calling `ThingHandler#initialize()`.\nThat makes totally sense if the thing was disabled before. However, if `setEnabled(thingUID, true)` is called for a thing which was already enabled, it causes an additional initialization.\nSince concurrent hanlder initializations may cause trouble, it is safer to prevent this. Therefore enabling a thing (including starting its thing handler) should only be performed if the thing is disabled.\n\nSigned-off-by: Michael Reitler <michael.dicke@smail.inf.h-brs.de>", "committedDate": "2020-02-02T14:54:22Z", "type": "commit"}, {"oid": "c318a96f065d68e937c37c1bed178ba1718ae019", "url": "https://github.com/openhab/openhab-core/commit/c318a96f065d68e937c37c1bed178ba1718ae019", "message": "[ThingManagerImpl] Prevent multiple handler inits on thing enabling\n\nWhen a thing is enabled, the `ThingManagerImpl` takes care of calling `ThingHandler#initialize()`.\nThat makes totally sense if the thing was disabled before. However, if `setEnabled(thingUID, true)` is called for a thing which was already enabled, it causes an additional initialization.\nSince concurrent hanlder initializations may cause trouble, it is safer to prevent this. Therefore enabling a thing (including starting its thing handler) should only be performed if the thing is disabled.\n\nSigned-off-by: Michael Reitler <michael.dicke@smail.inf.h-brs.de>", "committedDate": "2020-02-02T14:54:22Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDA3OTg2Nw==", "url": "https://github.com/openhab/openhab-core/pull/1353#discussion_r374079867", "bodyText": "Actually this check is a lot better than before. But it will not prevent multiple initializations for sure. There will be still some milliseconds left before the ThingStatus will be set to INITIALIZING. The initialization process itself is covered by a mutex lock. We maybe have to introduce a similar lock for enabling / disabling process too.", "author": "cweitkamp", "createdAt": "2020-02-03T12:40:51Z", "path": "bundles/org.openhab.core.thing/src/main/java/org/openhab/core/thing/internal/ThingManagerImpl.java", "diffHunk": "@@ -1201,8 +1201,8 @@ public void setEnabled(ThingUID thingUID, boolean enabled) {\n \n         if (enabled) {\n             // Enable a thing\n-            if (thing.getStatus().equals(ThingStatus.ONLINE)) {\n-                logger.debug(\"Thing {} is already in the required state.\", thingUID);\n+            if (thing.isEnabled()) {", "originalCommit": "c318a96f065d68e937c37c1bed178ba1718ae019", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}