{"pr_number": 1750, "pr_title": "[automation] Allow dashes in rule file names", "pr_createdAt": "2020-10-24T21:31:47Z", "pr_url": "https://github.com/openhab/openhab-core/pull/1750", "timeline": [{"oid": "1f49d1f6e127d6fcf3bd7ef244ff1a5ccbb05ee9", "url": "https://github.com/openhab/openhab-core/commit/1f49d1f6e127d6fcf3bd7ef244ff1a5ccbb05ee9", "message": "Allow dashes in rule file names\n\nSigned-off-by: Kai Kreuzer <kai@openhab.org>", "committedDate": "2020-10-24T21:30:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTU3MTkxNw==", "url": "https://github.com/openhab/openhab-core/pull/1750#discussion_r511571917", "bodyText": "We can store contextString.lastIndexOf('-') in a local variable and reuse it:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            if (contextString.contains(\"-\")) {\n          \n          \n            \n                                modelName = contextString.substring(0, contextString.lastIndexOf('-'));\n          \n          \n            \n                                String ruleIndex = contextString.substring(contextString.lastIndexOf('-') + 1);\n          \n          \n            \n                            int index = contextString.lastIndexOf('-');\n          \n          \n            \n                            if (index != -1) {\n          \n          \n            \n                                modelName = contextString.substring(0, index);\n          \n          \n            \n                                String ruleIndex = contextString.substring(index + 1);", "author": "cweitkamp", "createdAt": "2020-10-25T09:36:31Z", "path": "bundles/org.openhab.core.model.script.runtime/src/org/openhab/core/model/script/runtime/internal/engine/DSLScriptEngine.java", "diffHunk": "@@ -87,10 +87,9 @@ public Object eval(String script) throws ScriptException {\n             if (script.stripLeading().startsWith(DSLScriptContextProvider.CONTEXT_IDENTIFIER)) {\n                 String contextString = script.stripLeading().substring(\n                         DSLScriptContextProvider.CONTEXT_IDENTIFIER.length(), script.stripLeading().indexOf('\\n'));\n-                String[] segments = contextString.split(\"-\");\n-                if (segments.length == 2) {\n-                    modelName = segments[0];\n-                    String ruleIndex = segments[1];\n+                if (contextString.contains(\"-\")) {\n+                    modelName = contextString.substring(0, contextString.lastIndexOf('-'));\n+                    String ruleIndex = contextString.substring(contextString.lastIndexOf('-') + 1);", "originalCommit": "1f49d1f6e127d6fcf3bd7ef244ff1a5ccbb05ee9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTU5NjIyMA==", "url": "https://github.com/openhab/openhab-core/pull/1750#discussion_r511596220", "bodyText": "addressed", "author": "kaikreuzer", "createdAt": "2020-10-25T13:18:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTU3MTkxNw=="}], "type": "inlineReview"}, {"oid": "dec28445444f0a314ee7105d780543d26e269f41", "url": "https://github.com/openhab/openhab-core/commit/dec28445444f0a314ee7105d780543d26e269f41", "message": "addressed review comment\n\nSigned-off-by: Kai Kreuzer <kai@openhab.org>", "committedDate": "2020-10-25T13:17:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTYzMjU2NA==", "url": "https://github.com/openhab/openhab-core/pull/1750#discussion_r511632564", "bodyText": "Thanks. But I could be improved a little bit more. It is possible to skip the contains(\"-\") check when calculation the indexLastDash = lastIndexOf(\"-\") first and check for -1 on it.", "author": "cweitkamp", "createdAt": "2020-10-25T18:35:32Z", "path": "bundles/org.openhab.core.model.script.runtime/src/org/openhab/core/model/script/runtime/internal/engine/DSLScriptEngine.java", "diffHunk": "@@ -87,10 +87,10 @@ public Object eval(String script) throws ScriptException {\n             if (script.stripLeading().startsWith(DSLScriptContextProvider.CONTEXT_IDENTIFIER)) {\n                 String contextString = script.stripLeading().substring(\n                         DSLScriptContextProvider.CONTEXT_IDENTIFIER.length(), script.stripLeading().indexOf('\\n'));\n-                String[] segments = contextString.split(\"-\");\n-                if (segments.length == 2) {\n-                    modelName = segments[0];\n-                    String ruleIndex = segments[1];\n+                if (contextString.contains(\"-\")) {\n+                    int indexLastDash = contextString.lastIndexOf('-');", "originalCommit": "dec28445444f0a314ee7105d780543d26e269f41", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTYzMjc1OQ==", "url": "https://github.com/openhab/openhab-core/pull/1750#discussion_r511632759", "bodyText": "I preferred it this way as it is imho better readable and the few cpu cycles should not really matter :-)", "author": "kaikreuzer", "createdAt": "2020-10-25T18:36:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTYzMjU2NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTYzNDgxNQ==", "url": "https://github.com/openhab/openhab-core/pull/1750#discussion_r511634815", "bodyText": "Okay. Then I will agree on it too.", "author": "cweitkamp", "createdAt": "2020-10-25T18:56:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTYzMjU2NA=="}], "type": "inlineReview"}]}