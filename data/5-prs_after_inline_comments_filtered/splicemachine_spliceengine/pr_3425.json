{"pr_number": 3425, "pr_title": "SPLICE-1806 NullPointerException in the PipingCallBuffer (2.8)", "pr_createdAt": "2020-04-13T19:08:41Z", "pr_url": "https://github.com/splicemachine/spliceengine/pull/3425", "timeline": [{"oid": "d7578edbe00758a45ede63c441f1ddcc145448c6", "url": "https://github.com/splicemachine/spliceengine/commit/d7578edbe00758a45ede63c441f1ddcc145448c6", "message": "SPLICE-1806 NullPointerException in the PipingCallBuffer", "committedDate": "2020-04-13T19:06:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTI1NzA2Mg==", "url": "https://github.com/splicemachine/spliceengine/pull/3425#discussion_r409257062", "bodyText": "Does skipping offline regions ever result in a case where we miss data? That is, is tableLocations ever used in a way that ignores a region that's temporarily down (due to an RS failure, say) such that the missing region doesn't get detected and reported later?", "author": "carolp-503", "createdAt": "2020-04-16T03:18:55Z", "path": "hbase_storage/hbase1.1.2.2.5/src/main/java/com/splicemachine/storage/ClientPartition.java", "diffHunk": "@@ -153,32 +153,26 @@ public boolean checkAndPut(byte[] key,byte[] family,byte[] qualifier,byte[] expe\n             List<Partition> partitions;\n             if (!refresh) {\n                 partitions = partitionInfoCache.getIfPresent(tableName);\n-                if (partitions == null) {\n-                    partitions = formatPartitions(getAllRegionLocations(false));\n-                    assert partitions!=null:\"partitions are null\";\n-                    partitionInfoCache.put(tableName, partitions);\n+                if (partitions != null) {\n+                    return partitions;\n                 }\n-                return partitions;\n             }\n-            partitions = formatPartitions(getAllRegionLocations(true));\n-            partitionInfoCache.invalidate(tableName);\n-            assert partitions!=null:\"partitions are null\";\n-            partitionInfoCache.put(tableName,partitions);\n+            List<HRegionLocation> tableLocations = ((ClusterConnection) connection).locateRegions(tableName, !refresh, false);\n+            partitions = new ArrayList<>(tableLocations.size());\n+            for (HRegionLocation location : tableLocations){\n+                if (location.getServerName() == null) {     // ensure no offline regions\n+                    continue;\n+                }", "originalCommit": "d7578edbe00758a45ede63c441f1ddcc145448c6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}