{"pr_number": 4264, "pr_title": "DB-10368 Add SPLIT_PART function", "pr_createdAt": "2020-10-12T10:44:58Z", "pr_url": "https://github.com/splicemachine/spliceengine/pull/4264", "timeline": [{"oid": "86354332834113f4ce311033a2396933ef657733", "url": "https://github.com/splicemachine/spliceengine/commit/86354332834113f4ce311033a2396933ef657733", "message": "DB-10368 Add SPLIT_PART function", "committedDate": "2020-10-12T10:40:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzc5ODM4OQ==", "url": "https://github.com/splicemachine/spliceengine/pull/4264#discussion_r503798389", "bodyText": "what happens if partIndex is negative?", "author": "hatyo", "createdAt": "2020-10-13T09:20:16Z", "path": "db-engine/src/main/java/com/splicemachine/db/iapi/types/SQLChar.java", "diffHunk": "@@ -2644,6 +2645,57 @@ public ConcatableDataValue substring(\n         return stringResult;\n     }\n \n+    /**\n+     * The SQL split_part() is used to split a given string based on a delimiter and pick out the desired field from the string, start from the left of the string.\n+     *\n+     * @param delimiter the delimiter of the defined string\n+     * @param fieldNumber number of a result field\n+     * @param result The result of a previous call to this method, null if not called yet.\n+     *\n+     * @return  A StringDataValue containing the result of the split_part()\n+     *\n+     * @exception StandardException     Thrown on error\n+     */\n+    public StringDataValue split_part(\n+            StringDataValue delimiter,\n+            NumberDataValue fieldNumber,\n+            StringDataValue result)\n+            throws StandardException\n+    {\n+        StringDataValue stringResult;\n+\n+        if (result == null)\n+        {\n+            result = getNewVarchar();\n+        }\n+\n+        stringResult = (StringDataValue) result;\n+\n+        // The result is null if the receiver (this) is null\n+        // or either operand is null.\n+\n+        if (this.isNull() ||\n+                delimiter == null || delimiter.isNull() || delimiter.getString() == null ||\n+                fieldNumber == null || fieldNumber.isNull())\n+        {\n+            stringResult.setToNull();\n+            return stringResult;\n+        }\n+\n+        String valueParts[] = getString().split(Pattern.quote(delimiter.getString()));\n+        int partIndex = fieldNumber.getInt();", "originalCommit": "86354332834113f4ce311033a2396933ef657733", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDUzNTM5OA==", "url": "https://github.com/splicemachine/spliceengine/pull/4264#discussion_r504535398", "bodyText": "done", "author": "ipraznik-splice", "createdAt": "2020-10-14T09:29:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzc5ODM4OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzgwNTExOQ==", "url": "https://github.com/splicemachine/spliceengine/pull/4264#discussion_r503805119", "bodyText": "Could you please rewrite:\nString.format(\"select split_part(e, ' ', %d), e from \", fieldNumber) + tableWatcherB\nto:\nString.format(\"select split_part(e, ' ', %d), e from %s\", fieldNumber, tableWatcherB)", "author": "hatyo", "createdAt": "2020-10-13T09:29:53Z", "path": "splice_machine/src/test/java/com/splicemachine/derby/impl/sql/execute/operations/TernaryOperationIT.java", "diffHunk": "@@ -484,5 +481,49 @@ public void testSTRIPNegative() throws Exception {\n             Assert.assertTrue(\"Unexpected error code: \" + e.getSQLState(),  SQLState.LANG_SYNTAX_ERROR.startsWith(e.getSQLState()));\n         }\n     }\n+\n+    private void executeAndCheckSplitPart(int fieldNumber) throws SQLException {\n+        int count = 0;\n+        String sCell1 = null;\n+        String sCell2 = null;\n+        ResultSet rs;\n+\n+        rs = methodWatcher.executeQuery(String.format(\"select split_part(e, ' ', %d), e from \", fieldNumber) + tableWatcherB);", "originalCommit": "86354332834113f4ce311033a2396933ef657733", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDUzNTQ4Nw==", "url": "https://github.com/splicemachine/spliceengine/pull/4264#discussion_r504535487", "bodyText": "done", "author": "ipraznik-splice", "createdAt": "2020-10-14T09:29:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzgwNTExOQ=="}], "type": "inlineReview"}, {"oid": "c377cd5c2d34460a36f5d2860692756f277c2887", "url": "https://github.com/splicemachine/spliceengine/commit/c377cd5c2d34460a36f5d2860692756f277c2887", "message": "DB-10368 PR feedback", "committedDate": "2020-10-14T09:27:10Z", "type": "commit"}]}