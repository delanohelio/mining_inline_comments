{"pr_number": 4190, "pr_title": "Broadcast URI not set to vxlan, but vlan (Fix #3040)", "pr_createdAt": "2020-06-30T17:25:31Z", "pr_url": "https://github.com/apache/cloudstack/pull/4190", "timeline": [{"oid": "2c3a41c7a63dfd1dd271578eacec26442ee039f9", "url": "https://github.com/apache/cloudstack/commit/2c3a41c7a63dfd1dd271578eacec26442ee039f9", "message": "Fix issue #3040: Broadcast URI not set to vxlan, but vlan", "committedDate": "2020-06-30T18:07:03Z", "type": "commit"}, {"oid": "2c3a41c7a63dfd1dd271578eacec26442ee039f9", "url": "https://github.com/apache/cloudstack/commit/2c3a41c7a63dfd1dd271578eacec26442ee039f9", "message": "Fix issue #3040: Broadcast URI not set to vxlan, but vlan", "committedDate": "2020-06-30T18:07:03Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODM0MTQ1Ng==", "url": "https://github.com/apache/cloudstack/pull/4190#discussion_r448341456", "bodyText": "I got wondering if there could be more than one isolation method on a network. Considering that this is a List of isolation methods. I assume that to get into a VLAN conditional (the ones that this method is called) there will be only one isolation method, either VLAN or VXLAN.", "author": "GabrielBrascher", "createdAt": "2020-07-01T12:52:35Z", "path": "engine/orchestration/src/main/java/org/apache/cloudstack/engine/orchestration/NetworkOrchestrator.java", "diffHunk": "@@ -2475,6 +2475,21 @@ public Network doInTransaction(final TransactionStatus status) {\n         return network;\n     }\n \n+    /**\n+     * Encodes VLAN/VXLAN ID into a Broadcast URI according to the isolation method from the Physical Network.\n+     * @return Broadcast URI, e.g. 'vlan://vlan_ID' or 'vxlan://vlxan_ID'\n+     */\n+    protected URI encodeVlanIdIntoBroadcastUri(String vlanId, PhysicalNetwork pNtwk) {\n+        if(StringUtils.isNotBlank(pNtwk.getIsolationMethods().get(0))) {", "originalCommit": "2c3a41c7a63dfd1dd271578eacec26442ee039f9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTk3MDE1Ng==", "url": "https://github.com/apache/cloudstack/pull/4190#discussion_r485970156", "bodyText": "@GabrielBrascher Should we check if pNtwk is null? This could potentially cause a NPE; and the getIsolationMethods() is also a valid list with at least one item", "author": "rhtyd", "createdAt": "2020-09-09T23:08:37Z", "path": "engine/orchestration/src/main/java/org/apache/cloudstack/engine/orchestration/NetworkOrchestrator.java", "diffHunk": "@@ -2475,6 +2475,21 @@ public Network doInTransaction(final TransactionStatus status) {\n         return network;\n     }\n \n+    /**\n+     * Encodes VLAN/VXLAN ID into a Broadcast URI according to the isolation method from the Physical Network.\n+     * @return Broadcast URI, e.g. 'vlan://vlan_ID' or 'vxlan://vlxan_ID'\n+     */\n+    protected URI encodeVlanIdIntoBroadcastUri(String vlanId, PhysicalNetwork pNtwk) {\n+        if(StringUtils.isNotBlank(pNtwk.getIsolationMethods().get(0))) {", "originalCommit": "2c3a41c7a63dfd1dd271578eacec26442ee039f9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTk4MTY0MQ==", "url": "https://github.com/apache/cloudstack/pull/4190#discussion_r485981641", "bodyText": "@rhtyd thanks for the review :-)\nAnswering your question: I did not add null verification on the respective parameter due to the fact that both methods that call this one already validate the private network\n\n\nthe physical network pNtwk is validated at NetworkOrchestrator.java#L2196;\n\n\nthe other method that calls encodeVlanIdIntoBroadcastUri also validates the private network at this line NetworkOrchestrator.java#L2397.\n\n\nHowever, considering that this method could be reused, I have no problem in adding null validations.", "author": "GabrielBrascher", "createdAt": "2020-09-09T23:47:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTk3MDE1Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjA4NDcxMA==", "url": "https://github.com/apache/cloudstack/pull/4190#discussion_r486084710", "bodyText": "Actually, NetworkOrchestrator.java#L2397 is not exactly a null validation. I will add a null verification @rhtyd.", "author": "GabrielBrascher", "createdAt": "2020-09-10T06:01:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTk3MDE1Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzIxMDM2Mw==", "url": "https://github.com/apache/cloudstack/pull/4190#discussion_r493210363", "bodyText": "@GabrielBrascher please add the null validation, thnx", "author": "rhtyd", "createdAt": "2020-09-23T05:42:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTk3MDE1Ng=="}], "type": "inlineReview"}, {"oid": "13314d3abb194d3b7c02242fc2c016cc61b9a1c1", "url": "https://github.com/apache/cloudstack/commit/13314d3abb194d3b7c02242fc2c016cc61b9a1c1", "message": "Add PhysicalNetwork null validation on encodeVlanIdIntoBroadcastUri", "committedDate": "2020-09-21T11:59:43Z", "type": "commit"}]}