{"pr_number": 4374, "pr_title": "Fixing searchAndCount searchAndDistinctCount when sc is null", "pr_createdAt": "2020-10-05T14:59:24Z", "pr_url": "https://github.com/apache/cloudstack/pull/4374", "timeline": [{"oid": "a430bf6627418f1ded322efb704eab968c276502", "url": "https://github.com/apache/cloudstack/commit/a430bf6627418f1ded322efb704eab968c276502", "message": "Fixing searchAndCount searchAndDistinctCount when sc is null", "committedDate": "2020-10-05T15:40:00Z", "type": "forcePushed"}, {"oid": "120ee250364a4333fe77dad6dedb8297ee12b669", "url": "https://github.com/apache/cloudstack/commit/120ee250364a4333fe77dad6dedb8297ee12b669", "message": "Fixing searchAndCount searchAndDistinctCount when sc is null", "committedDate": "2020-10-05T15:42:01Z", "type": "commit"}, {"oid": "120ee250364a4333fe77dad6dedb8297ee12b669", "url": "https://github.com/apache/cloudstack/commit/120ee250364a4333fe77dad6dedb8297ee12b669", "message": "Fixing searchAndCount searchAndDistinctCount when sc is null", "committedDate": "2020-10-05T15:42:01Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDA1MTg1Nw==", "url": "https://github.com/apache/cloudstack/pull/4374#discussion_r500051857", "bodyText": "can use checkAndSetRemovedIsNull() here ?", "author": "sureshanaparti", "createdAt": "2020-10-06T07:11:05Z", "path": "framework/db/src/main/java/com/cloud/utils/db/GenericDaoBase.java", "diffHunk": "@@ -519,7 +509,6 @@ public T lockOneRandomRow(final SearchCriteria<T> sc, final boolean exclusive) {\n         if (_removed != null) {\n             sc.addAnd(_removed.second().field.getName(), SearchCriteria.Op.NULL);", "originalCommit": "120ee250364a4333fe77dad6dedb8297ee12b669", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDA1OTE1MQ==", "url": "https://github.com/apache/cloudstack/pull/4374#discussion_r500059151", "bodyText": "Makes it a bit difficult since it is of a different type M not T", "author": "davidjumani", "createdAt": "2020-10-06T07:25:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDA1MTg1Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDA2NTQ1Ng==", "url": "https://github.com/apache/cloudstack/pull/4374#discussion_r500065456", "bodyText": "ok @davidjumani", "author": "sureshanaparti", "createdAt": "2020-10-06T07:36:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDA1MTg1Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDA1NzA0Mw==", "url": "https://github.com/apache/cloudstack/pull/4374#discussion_r500057043", "bodyText": "removed & _removed seems to be redundant here & wherever used in similar way, can you directly set / unset _removed as per its usage ? If the purpose is to include / exclude removed records, you can use methods with naming *IncludingRemovedBy() [for ex: getDistinctCountIncludingRemovedBy()] to be in sync with the other methods.", "author": "sureshanaparti", "createdAt": "2020-10-06T07:21:20Z", "path": "framework/db/src/main/java/com/cloud/utils/db/GenericDaoBase.java", "diffHunk": "@@ -1935,6 +1918,23 @@ public boolean configure(final String name, final Map<String, Object> params) th\n         return builder.create();\n     }\n \n+    private SearchCriteria<T> checkAndSetRemovedIsNull(SearchCriteria<T> sc) {\n+        if (_removed != null) {\n+            if (sc == null) {\n+                sc = createSearchCriteria();\n+            }\n+            sc.addAnd(_removed.second().field.getName(), SearchCriteria.Op.NULL);\n+        }\n+        return sc;\n+    }\n+\n+    public Integer getDistinctCount(SearchCriteria<T> sc, boolean removed) {\n+        if (!removed) {", "originalCommit": "120ee250364a4333fe77dad6dedb8297ee12b669", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDA2MDM2NA==", "url": "https://github.com/apache/cloudstack/pull/4374#discussion_r500060364", "bodyText": "As of now getDistinctCount returns including removed so changing it would require changing where it's been referenced, would it be better to create getDistinctCountExcludingRemoved  ?\nEdit : Nevermind. Isn't used much elsewhere. Will make the changes", "author": "davidjumani", "createdAt": "2020-10-06T07:27:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDA1NzA0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDA2NjczNA==", "url": "https://github.com/apache/cloudstack/pull/4374#discussion_r500066734", "bodyText": "getDistinctCountExcludingRemoved is not in line with other methods, so I do not recommend.", "author": "sureshanaparti", "createdAt": "2020-10-06T07:38:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDA1NzA0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDA2ODk3MQ==", "url": "https://github.com/apache/cloudstack/pull/4374#discussion_r500068971", "bodyText": "Default method should not include removed records, explicitly mentioned methods \"*IncludingRemovedBy()\" should. so, may be you can change current method to \"*IncludingRemovedBy()\" and add other method with current name.", "author": "sureshanaparti", "createdAt": "2020-10-06T07:42:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDA1NzA0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDA3MzAwMQ==", "url": "https://github.com/apache/cloudstack/pull/4374#discussion_r500073001", "bodyText": "Added! Thanks @sureshanaparti", "author": "davidjumani", "createdAt": "2020-10-06T07:49:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDA1NzA0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDA5MDMzMg==", "url": "https://github.com/apache/cloudstack/pull/4374#discussion_r500090332", "bodyText": "Perfect, changes LGTM.", "author": "sureshanaparti", "createdAt": "2020-10-06T08:19:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDA1NzA0Mw=="}], "type": "inlineReview"}, {"oid": "9a7be557449cde600067a64a930237d410aab0ce", "url": "https://github.com/apache/cloudstack/commit/9a7be557449cde600067a64a930237d410aab0ce", "message": "Adding getCountIncludingRemoved and getDistinctCountIncludingRemoved", "committedDate": "2020-10-06T07:46:56Z", "type": "commit"}]}