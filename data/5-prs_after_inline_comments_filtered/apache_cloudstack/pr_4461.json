{"pr_number": 4461, "pr_title": "Fix destroying k8s cluster on shared networks", "pr_createdAt": "2020-11-11T09:45:28Z", "pr_url": "https://github.com/apache/cloudstack/pull/4461", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTI3ODEzNw==", "url": "https://github.com/apache/cloudstack/pull/4461#discussion_r521278137", "bodyText": "I know I'm not a nice guy, but can we please have new code in separate methods:\nprivate void checkForRulesToDelete(){\n    NetworkVO kubernetesClusterNetwork = networkDao.findById(kubernetesCluster.getNetworkId());\n    if (kubernetesClusterNetwork != null && kubernetesClusterNetwork.getGuestType() != Network.GuestType.Shared) {\n        deleteKubernetesClusterNetworkRules();\n    }\n}\n\nand then\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                NetworkVO kubernetesClusterNetwork = networkDao.findById(kubernetesCluster.getNetworkId());\n          \n          \n            \n                                if (kubernetesClusterNetwork != null && kubernetesClusterNetwork.getGuestType() != Network.GuestType.Shared) {\n          \n          \n            \n                                    deleteKubernetesClusterNetworkRules();\n          \n          \n            \n                                }\n          \n          \n            \n                                checkForRulesToDelete();", "author": "DaanHoogland", "createdAt": "2020-11-11T10:59:04Z", "path": "plugins/integrations/kubernetes-service/src/main/java/com/cloud/kubernetes/cluster/actionworkers/KubernetesClusterDestroyWorker.java", "diffHunk": "@@ -239,7 +240,10 @@ public boolean destroy() throws CloudRuntimeException {\n                 }\n             } else {\n                 try {\n-                    deleteKubernetesClusterNetworkRules();\n+                    NetworkVO kubernetesClusterNetwork = networkDao.findById(kubernetesCluster.getNetworkId());\n+                    if (kubernetesClusterNetwork != null && kubernetesClusterNetwork.getGuestType() != Network.GuestType.Shared) {\n+                        deleteKubernetesClusterNetworkRules();\n+                    }", "originalCommit": "452dd2f7e6ff2ddc0be2e3ed2b67014d2317c74e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "b0bceaa7693b53246c1f6e397dbae7b588a2f5f2", "url": "https://github.com/apache/cloudstack/commit/b0bceaa7693b53246c1f6e397dbae7b588a2f5f2", "message": "Fix destroying k8s cluster on shared networks", "committedDate": "2020-11-18T09:56:17Z", "type": "commit"}, {"oid": "7b09f3c3e16ce06dfeccf200b778a8a4763b5fc1", "url": "https://github.com/apache/cloudstack/commit/7b09f3c3e16ce06dfeccf200b778a8a4763b5fc1", "message": "Extracted code", "committedDate": "2020-11-18T09:56:58Z", "type": "commit"}, {"oid": "7b09f3c3e16ce06dfeccf200b778a8a4763b5fc1", "url": "https://github.com/apache/cloudstack/commit/7b09f3c3e16ce06dfeccf200b778a8a4763b5fc1", "message": "Extracted code", "committedDate": "2020-11-18T09:56:58Z", "type": "forcePushed"}]}