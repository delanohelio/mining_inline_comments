{"pr_number": 588, "pr_title": "remove fastjson", "pr_createdAt": "2020-05-17T14:49:55Z", "pr_url": "https://github.com/FISCO-BCOS/web3sdk/pull/588", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjI3MDE1OQ==", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/588#discussion_r426270159", "bodyText": "[PMD] Potential violation of Law of Demeter (method chain calls) (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nLawOfDemeter\nDesign\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.23.0/pmd_rules_java_design.html#lawofdemeter\n\nYou can close this issue if no need to fix it. Learn more.", "author": "sider", "createdAt": "2020-05-17T14:50:49Z", "path": "src/main/java/org/fisco/bcos/web3j/crypto/gm/KeyInfo.java", "diffHunk": "@@ -104,18 +135,12 @@ public int loadKeyInfo(String keyFile) {\n         System.out.println(\"\");\n         System.out.println(\"===key info:\" + keyInfoJsonStr);\n         try {\n-            JSONObject keyInfoJsonObj = JSONObject.parseObject(keyInfoJsonStr);\n-            if (keyInfoJsonObj == null) {\n-                System.out.println(\"load json str from key info failed\");\n-                logger.error(\"load json str from key info failed\");\n-                return RetCode.parseJsonFailed;\n-            }\n-            if (keyInfoJsonObj.containsKey(privJsonKey))\n-                privateKey = keyInfoJsonObj.getString(privJsonKey);\n-            if (keyInfoJsonObj.containsKey(pubJsonKey))\n-                publicKey = keyInfoJsonObj.getString(pubJsonKey);\n-            if (keyInfoJsonObj.containsKey(accountJsonKey))\n-                account = keyInfoJsonObj.getString(accountJsonKey);\n+            Key key = ObjectMapperFactory.getObjectMapper().readValue(keyInfoJsonStr, Key.class);", "originalCommit": "72d74534065eb364b841c73c0be4fce4b2da0562", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjI3MDE2MA==", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/588#discussion_r426270160", "bodyText": "[PMD] Potential violation of Law of Demeter (method chain calls) (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nLawOfDemeter\nDesign\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.23.0/pmd_rules_java_design.html#lawofdemeter\n\nYou can close this issue if no need to fix it. Learn more.", "author": "sider", "createdAt": "2020-05-17T14:50:50Z", "path": "src/main/java/org/fisco/bcos/web3j/crypto/gm/KeyInfo.java", "diffHunk": "@@ -160,12 +185,12 @@ private static int writeFile(String keyFile, String content) {\n     public int storeKeyInfo(String keyFile) {\n         try {\n             // Map<String, String> keyMap = new HashMap<String, String>();\n-            JSONObject keyMapJson = new JSONObject();\n-            keyMapJson.put(privJsonKey, privateKey);\n-            keyMapJson.put(pubJsonKey, publicKey);\n-            keyMapJson.put(accountJsonKey, account);\n+            Key key = new Key();\n+            key.setPrivateKey(getPrivateKey());\n+            key.setPublicKey(getPublicKey());\n+            key.setAccount(getAccount());\n \n-            String keyJsonInfo = keyMapJson.toString();\n+            String keyJsonInfo = ObjectMapperFactory.getObjectMapper().writeValueAsString(key);", "originalCommit": "72d74534065eb364b841c73c0be4fce4b2da0562", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjI3MDE2Mg==", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/588#discussion_r426270162", "bodyText": "[PMD] The class 'Key' is suspected to be a Data Class (WOC=0.000%, NOPA=0, NOAM=6, WMC=6) (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nDataClass\nDesign\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.23.0/pmd_rules_java_design.html#dataclass\n\nYou can close this issue if no need to fix it. Learn more.", "author": "sider", "createdAt": "2020-05-17T14:50:51Z", "path": "src/main/java/org/fisco/bcos/web3j/crypto/gm/KeyInfo.java", "diffHunk": "@@ -15,6 +16,36 @@\n     public static final String pubJsonKey = \"publicKey\";\n     public static final String accountJsonKey = \"account\";\n \n+    private static class Key {", "originalCommit": "72d74534065eb364b841c73c0be4fce4b2da0562", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3f052e1fce9382790d33ea50a045e2914c22cc7f", "url": "https://github.com/FISCO-BCOS/web3sdk/commit/3f052e1fce9382790d33ea50a045e2914c22cc7f", "message": "remove fastjson", "committedDate": "2020-05-17T15:00:45Z", "type": "forcePushed"}, {"oid": "4e972581e7dbca2aad5602d9c7f17649fa7aea02", "url": "https://github.com/FISCO-BCOS/web3sdk/commit/4e972581e7dbca2aad5602d9c7f17649fa7aea02", "message": "remove fastjson", "committedDate": "2020-05-17T15:01:37Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjI3MTI5MA==", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/588#discussion_r426271290", "bodyText": "[PMD] It is somewhat confusing to have a field name matching the declaring class name (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nAvoidFieldNameMatchingTypeName\nError Prone\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.23.0/pmd_rules_java_errorprone.html#avoidfieldnamematchingtypename\n\nYou can close this issue if no need to fix it. Learn more.", "author": "sider", "createdAt": "2020-05-17T15:02:37Z", "path": "src/main/java/org/fisco/bcos/web3j/crypto/gm/KeyInfo.java", "diffHunk": "@@ -15,6 +16,36 @@\n     public static final String pubJsonKey = \"publicKey\";\n     public static final String accountJsonKey = \"account\";\n \n+    private static class Account {\n+        private String privateKey;\n+        private String publicKey;\n+        private String account;", "originalCommit": "4e972581e7dbca2aad5602d9c7f17649fa7aea02", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjI3MTI5MQ==", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/588#discussion_r426271291", "bodyText": "[PMD] The class 'Account' is suspected to be a Data Class (WOC=0.000%, NOPA=0, NOAM=6, WMC=6) (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nDataClass\nDesign\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.23.0/pmd_rules_java_design.html#dataclass\n\nYou can close this issue if no need to fix it. Learn more.", "author": "sider", "createdAt": "2020-05-17T15:02:38Z", "path": "src/main/java/org/fisco/bcos/web3j/crypto/gm/KeyInfo.java", "diffHunk": "@@ -15,6 +16,36 @@\n     public static final String pubJsonKey = \"publicKey\";\n     public static final String accountJsonKey = \"account\";\n \n+    private static class Account {", "originalCommit": "4e972581e7dbca2aad5602d9c7f17649fa7aea02", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjI3MTI5NA==", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/588#discussion_r426271294", "bodyText": "[PMD] Potential violation of Law of Demeter (method chain calls) (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nLawOfDemeter\nDesign\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.23.0/pmd_rules_java_design.html#lawofdemeter\n\nYou can close this issue if no need to fix it. Learn more.", "author": "sider", "createdAt": "2020-05-17T15:02:39Z", "path": "src/main/java/org/fisco/bcos/web3j/crypto/gm/KeyInfo.java", "diffHunk": "@@ -104,18 +135,12 @@ public int loadKeyInfo(String keyFile) {\n         System.out.println(\"\");\n         System.out.println(\"===key info:\" + keyInfoJsonStr);\n         try {\n-            JSONObject keyInfoJsonObj = JSONObject.parseObject(keyInfoJsonStr);\n-            if (keyInfoJsonObj == null) {\n-                System.out.println(\"load json str from key info failed\");\n-                logger.error(\"load json str from key info failed\");\n-                return RetCode.parseJsonFailed;\n-            }\n-            if (keyInfoJsonObj.containsKey(privJsonKey))\n-                privateKey = keyInfoJsonObj.getString(privJsonKey);\n-            if (keyInfoJsonObj.containsKey(pubJsonKey))\n-                publicKey = keyInfoJsonObj.getString(pubJsonKey);\n-            if (keyInfoJsonObj.containsKey(accountJsonKey))\n-                account = keyInfoJsonObj.getString(accountJsonKey);\n+            Account key = ObjectMapperFactory.getObjectMapper().readValue(keyInfoJsonStr, Account.class);", "originalCommit": "4e972581e7dbca2aad5602d9c7f17649fa7aea02", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "b137f50fa7935dcbb3bfdb4b4ad2bd0fe007d81f", "url": "https://github.com/FISCO-BCOS/web3sdk/commit/b137f50fa7935dcbb3bfdb4b4ad2bd0fe007d81f", "message": "remove fastjson", "committedDate": "2020-05-17T15:12:24Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjI3MjQxNQ==", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/588#discussion_r426272415", "bodyText": "[PMD] Potential violation of Law of Demeter (method chain calls) (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nLawOfDemeter\nDesign\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.23.0/pmd_rules_java_design.html#lawofdemeter\n\nYou can close this issue if no need to fix it. Learn more.", "author": "sider", "createdAt": "2020-05-17T15:13:37Z", "path": "src/main/java/org/fisco/bcos/web3j/crypto/gm/KeyInfo.java", "diffHunk": "@@ -160,12 +186,12 @@ private static int writeFile(String keyFile, String content) {\n     public int storeKeyInfo(String keyFile) {\n         try {\n             // Map<String, String> keyMap = new HashMap<String, String>();\n-            JSONObject keyMapJson = new JSONObject();\n-            keyMapJson.put(privJsonKey, privateKey);\n-            keyMapJson.put(pubJsonKey, publicKey);\n-            keyMapJson.put(accountJsonKey, account);\n+            Account key = new Account();\n+            key.setPrivateKey(getPrivateKey());\n+            key.setPublicKey(getPublicKey());\n+            key.setAccount(getAccount());\n \n-            String keyJsonInfo = keyMapJson.toString();\n+            String keyJsonInfo = ObjectMapperFactory.getObjectMapper().writeValueAsString(key);", "originalCommit": "b137f50fa7935dcbb3bfdb4b4ad2bd0fe007d81f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjI3MjQxOQ==", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/588#discussion_r426272419", "bodyText": "[PMD] Potential violation of Law of Demeter (method chain calls) (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nLawOfDemeter\nDesign\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.23.0/pmd_rules_java_design.html#lawofdemeter\n\nYou can close this issue if no need to fix it. Learn more.", "author": "sider", "createdAt": "2020-05-17T15:13:38Z", "path": "src/main/java/org/fisco/bcos/web3j/crypto/gm/KeyInfo.java", "diffHunk": "@@ -104,18 +135,13 @@ public int loadKeyInfo(String keyFile) {\n         System.out.println(\"\");\n         System.out.println(\"===key info:\" + keyInfoJsonStr);\n         try {\n-            JSONObject keyInfoJsonObj = JSONObject.parseObject(keyInfoJsonStr);\n-            if (keyInfoJsonObj == null) {\n-                System.out.println(\"load json str from key info failed\");\n-                logger.error(\"load json str from key info failed\");\n-                return RetCode.parseJsonFailed;\n-            }\n-            if (keyInfoJsonObj.containsKey(privJsonKey))\n-                privateKey = keyInfoJsonObj.getString(privJsonKey);\n-            if (keyInfoJsonObj.containsKey(pubJsonKey))\n-                publicKey = keyInfoJsonObj.getString(pubJsonKey);\n-            if (keyInfoJsonObj.containsKey(accountJsonKey))\n-                account = keyInfoJsonObj.getString(accountJsonKey);\n+            Account key =\n+                    ObjectMapperFactory.getObjectMapper().readValue(keyInfoJsonStr, Account.class);", "originalCommit": "b137f50fa7935dcbb3bfdb4b4ad2bd0fe007d81f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "524b5ba3096b7c38de376f9f8badc9200f9a00b3", "url": "https://github.com/FISCO-BCOS/web3sdk/commit/524b5ba3096b7c38de376f9f8badc9200f9a00b3", "message": "remove fastjson", "committedDate": "2020-05-22T12:42:04Z", "type": "commit"}, {"oid": "524b5ba3096b7c38de376f9f8badc9200f9a00b3", "url": "https://github.com/FISCO-BCOS/web3sdk/commit/524b5ba3096b7c38de376f9f8badc9200f9a00b3", "message": "remove fastjson", "committedDate": "2020-05-22T12:42:04Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDEwNTM0NQ==", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/588#discussion_r430105345", "bodyText": "[PMD] Found 'DD'-anomaly for variable 'message' (lines '176'-'178'). (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nDataflowAnomalyAnalysis\nError Prone\n5\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.23.0/pmd_rules_java_errorprone.html#dataflowanomalyanalysis\n\nYou can close this issue if no need to fix it. Learn more.", "author": "sider", "createdAt": "2020-05-26T00:33:27Z", "path": "src/main/java/org/fisco/bcos/web3j/protocol/channel/StatusCode.java", "diffHunk": "@@ -171,6 +172,8 @@ public static String getStatusMessage(String status, String errorMessage) {\n             case ContractFrozen:\n                 message = \"contract has been frozen\";\n                 break;\n+            case AccountFrozen:\n+                message = \" account has been frozen\";", "originalCommit": "fd5393d3c9d2e0abb1166e527eaa62b35e4186a0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDEwNTQwNA==", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/588#discussion_r430105404", "bodyText": "[PMD] Found 'DD'-anomaly for variable 'message' (lines '176'-'178'). (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nDataflowAnomalyAnalysis\nError Prone\n5\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.23.0/pmd_rules_java_errorprone.html#dataflowanomalyanalysis\n\nYou can close this issue if no need to fix it. Learn more.", "author": "sider", "createdAt": "2020-05-26T00:33:49Z", "path": "src/main/java/org/fisco/bcos/web3j/protocol/channel/StatusCode.java", "diffHunk": "@@ -171,6 +172,8 @@ public static String getStatusMessage(String status, String errorMessage) {\n             case ContractFrozen:\n                 message = \"contract has been frozen\";\n                 break;\n+            case AccountFrozen:\n+                message = \" account has been frozen\";", "originalCommit": "fd5393d3c9d2e0abb1166e527eaa62b35e4186a0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "7f8d800144e2674979c14d000063bdd45fe03ac5", "url": "https://github.com/FISCO-BCOS/web3sdk/commit/7f8d800144e2674979c14d000063bdd45fe03ac5", "message": "add transaction receipt code", "committedDate": "2020-05-26T01:56:11Z", "type": "forcePushed"}, {"oid": "56310012137966b19cb6adfa594e363ca3e1b4f5", "url": "https://github.com/FISCO-BCOS/web3sdk/commit/56310012137966b19cb6adfa594e363ca3e1b4f5", "message": "add transaction receipt code", "committedDate": "2020-05-26T01:59:16Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDEyMDU3Nw==", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/588#discussion_r430120577", "bodyText": "[PMD] Found 'DD'-anomaly for variable 'message' (lines '176'-'178'). (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nDataflowAnomalyAnalysis\nError Prone\n5\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.23.0/pmd_rules_java_errorprone.html#dataflowanomalyanalysis\n\nYou can close this issue if no need to fix it. Learn more.", "author": "sider", "createdAt": "2020-05-26T02:00:11Z", "path": "src/main/java/org/fisco/bcos/web3j/protocol/channel/StatusCode.java", "diffHunk": "@@ -171,6 +172,8 @@ public static String getStatusMessage(String status, String errorMessage) {\n             case ContractFrozen:\n                 message = \"contract has been frozen\";\n                 break;\n+            case AccountFrozen:\n+                message = \"account has been frozen\";", "originalCommit": "56310012137966b19cb6adfa594e363ca3e1b4f5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDEyMDYxNw==", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/588#discussion_r430120617", "bodyText": "[PMD] Found 'DD'-anomaly for variable 'message' (lines '176'-'178'). (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nDataflowAnomalyAnalysis\nError Prone\n5\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.23.0/pmd_rules_java_errorprone.html#dataflowanomalyanalysis\n\nYou can close this issue if no need to fix it. Learn more.", "author": "sider", "createdAt": "2020-05-26T02:00:22Z", "path": "src/main/java/org/fisco/bcos/web3j/protocol/channel/StatusCode.java", "diffHunk": "@@ -171,6 +172,8 @@ public static String getStatusMessage(String status, String errorMessage) {\n             case ContractFrozen:\n                 message = \"contract has been frozen\";\n                 break;\n+            case AccountFrozen:\n+                message = \"account has been frozen\";", "originalCommit": "56310012137966b19cb6adfa594e363ca3e1b4f5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6f6da20eada624c03590b2db8f8cfd002d240431", "url": "https://github.com/FISCO-BCOS/web3sdk/commit/6f6da20eada624c03590b2db8f8cfd002d240431", "message": "add transaction receipt code", "committedDate": "2020-05-26T02:58:47Z", "type": "commit"}, {"oid": "6f6da20eada624c03590b2db8f8cfd002d240431", "url": "https://github.com/FISCO-BCOS/web3sdk/commit/6f6da20eada624c03590b2db8f8cfd002d240431", "message": "add transaction receipt code", "committedDate": "2020-05-26T02:58:47Z", "type": "forcePushed"}]}