{"pr_number": 586, "pr_title": "Add QPS limit when querying account to prevent performanceDT pressure test failure when QPS limit is turned on", "pr_createdAt": "2020-05-15T09:07:56Z", "pr_url": "https://github.com/FISCO-BCOS/web3sdk/pull/586", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTY2ODg2Nw==", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/586#discussion_r425668867", "bodyText": "[PMD] Potential violation of Law of Demeter (object not created locally) (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nLawOfDemeter\nDesign\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.23.0/pmd_rules_java_design.html#lawofdemeter\n\nYou can close this issue if no need to fix it. Learn more.", "author": "sider", "createdAt": "2020-05-15T09:08:56Z", "path": "src/test/java/org/fisco/bcos/channel/test/parallel/precompile/PerformanceDTTest.java", "diffHunk": "@@ -230,6 +230,7 @@ public void userAddTest(BigInteger count, BigInteger qps) {\n \n             for (Integer i = 0; i < count.intValue(); ++i) {\n                 final int index = i;\n+                limiter.acquire();", "originalCommit": "5f94605c5585acbb76d501f1d36b3619c5bd17fe", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTY2ODg4MA==", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/586#discussion_r425668880", "bodyText": "[PMD] Potential violation of Law of Demeter (object not created locally) (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nLawOfDemeter\nDesign\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.23.0/pmd_rules_java_design.html#lawofdemeter\n\nYou can close this issue if no need to fix it. Learn more.", "author": "sider", "createdAt": "2020-05-15T09:08:57Z", "path": "src/test/java/org/fisco/bcos/channel/test/parallel/parallelok/PerformanceDTTest.java", "diffHunk": "@@ -440,6 +440,7 @@ public void userTransferTest(BigInteger count, BigInteger qps, BigInteger deci)\n             AtomicInteger geted = new AtomicInteger(0);\n             for (int i = 0; i < allUser.size(); ++i) {\n                 final Integer _i = i;\n+                limiter.acquire();", "originalCommit": "5f94605c5585acbb76d501f1d36b3619c5bd17fe", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "0b0a501a689ac19cc5910dfe9a1e06c3d57d3372", "url": "https://github.com/FISCO-BCOS/web3sdk/commit/0b0a501a689ac19cc5910dfe9a1e06c3d57d3372", "message": "Add QPS limit when querying account to prevent performanceDT pressure test failure when QPS limit is turned on", "committedDate": "2020-05-15T09:10:00Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTY3MDI0OQ==", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/586#discussion_r425670249", "bodyText": "[PMD] Potential violation of Law of Demeter (object not created locally) (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nLawOfDemeter\nDesign\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.23.0/pmd_rules_java_design.html#lawofdemeter\n\nYou can close this issue if no need to fix it. Learn more.", "author": "sider", "createdAt": "2020-05-15T09:11:25Z", "path": "src/test/java/org/fisco/bcos/channel/test/parallel/parallelok/PerformanceDTTest.java", "diffHunk": "@@ -433,13 +433,15 @@ public void userTransferTest(BigInteger count, BigInteger qps, BigInteger deci)\n             threadPool.setMaxPoolSize(500);\n             threadPool.setQueueCapacity(Math.max(count.intValue(), allUser.size()) + 1000);\n             threadPool.initialize();\n+            RateLimiter limiter = RateLimiter.create(qps.intValue());\n \n             Lock lock = new ReentrantLock();\n \n             final ParallelOk _parallelok = parallelok;\n             AtomicInteger geted = new AtomicInteger(0);\n             for (int i = 0; i < allUser.size(); ++i) {\n                 final Integer _i = i;\n+                limiter.acquire();", "originalCommit": "0b0a501a689ac19cc5910dfe9a1e06c3d57d3372", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "ee1f4337063721822de72728aaa6a92ae1e0eefa", "url": "https://github.com/FISCO-BCOS/web3sdk/commit/ee1f4337063721822de72728aaa6a92ae1e0eefa", "message": "Add QPS limit when querying account to prevent performanceDT pressure test failure when QPS limit is turned on", "committedDate": "2020-05-15T09:15:22Z", "type": "commit"}, {"oid": "ee1f4337063721822de72728aaa6a92ae1e0eefa", "url": "https://github.com/FISCO-BCOS/web3sdk/commit/ee1f4337063721822de72728aaa6a92ae1e0eefa", "message": "Add QPS limit when querying account to prevent performanceDT pressure test failure when QPS limit is turned on", "committedDate": "2020-05-15T09:15:22Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTY3MzMyNA==", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/586#discussion_r425673324", "bodyText": "[PMD] Potential violation of Law of Demeter (object not created locally) (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nLawOfDemeter\nDesign\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.23.0/pmd_rules_java_design.html#lawofdemeter\n\nYou can close this issue if no need to fix it. Learn more.", "author": "sider", "createdAt": "2020-05-15T09:16:44Z", "path": "src/test/java/org/fisco/bcos/channel/test/parallel/precompile/PerformanceDTTest.java", "diffHunk": "@@ -419,11 +419,13 @@ public void userTransferTest(BigInteger count, BigInteger qps, BigInteger deci)\n             threadPool.setMaxPoolSize(500);\n             threadPool.setQueueCapacity(Math.max(count.intValue(), allUser.size()));\n             threadPool.initialize();\n+            RateLimiter limiter = RateLimiter.create(qps.intValue());\n \n             final DagTransfer _dagTransfer = dagTransfer;\n             AtomicInteger geted = new AtomicInteger(0);\n             for (int i = 0; i < allUser.size(); ++i) {\n                 final Integer _i = i;\n+                limiter.acquire();", "originalCommit": "ee1f4337063721822de72728aaa6a92ae1e0eefa", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}