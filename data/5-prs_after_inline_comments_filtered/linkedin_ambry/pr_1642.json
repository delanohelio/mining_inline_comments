{"pr_number": 1642, "pr_title": "Return copy of Set references in ExchangeMetadataResponse get methods to avoid concurrentModificationException", "pr_createdAt": "2020-10-02T21:35:10Z", "pr_url": "https://github.com/linkedin/ambry/pull/1642", "timeline": [{"oid": "43c9b0478a4d73a9cda89b7283c888abe15a9131", "url": "https://github.com/linkedin/ambry/commit/43c9b0478a4d73a9cda89b7283c888abe15a9131", "message": "Return copy of Set references in ExchangeMetadataResponse class to avoid concurrent modification exception.", "committedDate": "2020-10-02T21:21:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTA3MjA2Ng==", "url": "https://github.com/linkedin/ambry/pull/1642#discussion_r499072066", "bodyText": "I was under the impression the stream way to collect to set is deep copy, so this should be ok (better to confirm it)", "author": "jsjtzyy", "createdAt": "2020-10-02T22:16:07Z", "path": "ambry-replication/src/main/java/com/github/ambry/replication/ReplicaThread.java", "diffHunk": "@@ -1629,7 +1630,7 @@ synchronized boolean isEmpty() {\n     }\n \n     /**\n-     *  get the keys corresponding to the missing messages in local store\n+     *  Get the keys corresponding to the missing messages in local store\n      */\n     Set<StoreKey> getMissingStoreKeys() {\n       return missingStoreMessages == null ? Collections.emptySet()", "originalCommit": "43c9b0478a4d73a9cda89b7283c888abe15a9131", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTc0MTUyNQ==", "url": "https://github.com/linkedin/ambry/pull/1642#discussion_r499741525", "bodyText": "Should this method be synchronized too? It seems like missingStoreMessages can be mutated and using a stream is just like iterating through it and subject to a ConcurrentModificationException.", "author": "cgtz", "createdAt": "2020-10-05T16:57:13Z", "path": "ambry-replication/src/main/java/com/github/ambry/replication/ReplicaThread.java", "diffHunk": "@@ -1629,7 +1630,7 @@ synchronized boolean isEmpty() {\n     }\n \n     /**\n-     *  get the keys corresponding to the missing messages in local store\n+     *  Get the keys corresponding to the missing messages in local store\n      */\n     Set<StoreKey> getMissingStoreKeys() {", "originalCommit": "43c9b0478a4d73a9cda89b7283c888abe15a9131", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTc0OTQwMg==", "url": "https://github.com/linkedin/ambry/pull/1642#discussion_r499749402", "bodyText": "+1, good point.", "author": "jsjtzyy", "createdAt": "2020-10-05T17:11:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTc0MTUyNQ=="}], "type": "inlineReview"}, {"oid": "74421fab61b0256a38eef36416deb9933a7d4d37", "url": "https://github.com/linkedin/ambry/commit/74421fab61b0256a38eef36416deb9933a7d4d37", "message": "Address casey's comment to synchronize getMissingStoreKeys() method", "committedDate": "2020-10-05T17:23:37Z", "type": "commit"}]}