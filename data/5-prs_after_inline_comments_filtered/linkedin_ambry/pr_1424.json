{"pr_number": 1424, "pr_title": "Add new version to MessageInfoAndMetadataListSerDe to delivery lifeVersion on wire", "pr_createdAt": "2020-03-13T04:21:30Z", "pr_url": "https://github.com/linkedin/ambry/pull/1424", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjM1MTg0Nw==", "url": "https://github.com/linkedin/ambry/pull/1424#discussion_r392351847", "bodyText": "Short.BYTES?", "author": "zzmao", "createdAt": "2020-03-13T16:54:01Z", "path": "ambry-protocol/src/main/java/com.github.ambry.protocol/MessageInfoAndMetdataListSerde.java", "diffHunk": "@@ -116,6 +122,10 @@ int getMessageInfoAndMetadataListSize() {\n         // operationTime\n         size += Long.BYTES;\n       }\n+      if (version >= VERSION_6) {\n+        // lifeVersion\n+        size += 2;", "originalCommit": "4af963c394634dca38913558503de227665401f3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjM1MjA0Mw==", "url": "https://github.com/linkedin/ambry/pull/1424#discussion_r392352043", "bodyText": "Change all +=1 ->  += Byte.Bytes?", "author": "zzmao", "createdAt": "2020-03-13T16:54:21Z", "path": "ambry-protocol/src/main/java/com.github.ambry.protocol/MessageInfoAndMetdataListSerde.java", "diffHunk": "@@ -93,13 +95,17 @@ int getMessageInfoAndMetadataListSize() {\n       size += Long.BYTES;\n       // whether deleted\n       size += 1;\n-      if (version < VERSION_1 || version > VERSION_5) {\n+      if (version < VERSION_1 || version > VERSION_MAX) {\n         throw new IllegalArgumentException(\"Unknown version in MessageInfoList \" + version);\n       }\n       if (version >= VERSION_5) {\n         // whether ttl updated\n         size += 1;\n       }\n+      if (version >= VERSION_6) {\n+        // whether undelete\n+        size += 1;", "originalCommit": "4af963c394634dca38913558503de227665401f3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjUxMzI5NQ==", "url": "https://github.com/linkedin/ambry/pull/1424#discussion_r392513295", "bodyText": "Probably not related to your change. Just wonder why this check is not performed at the beginning of this method as  opposed to doing it in the whole loop.", "author": "jsjtzyy", "createdAt": "2020-03-13T22:28:03Z", "path": "ambry-protocol/src/main/java/com.github.ambry.protocol/MessageInfoAndMetdataListSerde.java", "diffHunk": "@@ -146,12 +156,15 @@ void serializeMessageInfoAndMetadataList(ByteBuffer outputBuffer) {\n         outputBuffer.putLong(messageInfo.getSize());\n         outputBuffer.putLong(messageInfo.getExpirationTimeInMs());\n         outputBuffer.put(messageInfo.isDeleted() ? UPDATED : (byte) ~UPDATED);\n-        if (version < VERSION_1 || version > VERSION_5) {\n+        if (version < VERSION_1 || version > VERSION_MAX) {\n           throw new IllegalArgumentException(\"Unknown version in MessageInfoList \" + version);", "originalCommit": "2830e13c7ca6e6e023c65b1b946934f7666f52da", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjUxNjY4Nw==", "url": "https://github.com/linkedin/ambry/pull/1424#discussion_r392516687", "bodyText": "I didn't notice that, I suppose checking at the beginning of the method makes more sense. I will update.", "author": "justinlin-linkedin", "createdAt": "2020-03-13T22:41:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjUxMzI5NQ=="}], "type": "inlineReview"}, {"oid": "3bb66166a6455bdf945c25781d98e0a7a23e6933", "url": "https://github.com/linkedin/ambry/commit/3bb66166a6455bdf945c25781d98e0a7a23e6933", "message": "Add new version to MessageInfoAndMetadataListSerDe to delivery lifeVersion on wire", "committedDate": "2020-03-13T22:42:06Z", "type": "commit"}, {"oid": "c6f6bfa27e2454925c61b9aa91acd5c11c5dab2c", "url": "https://github.com/linkedin/ambry/commit/c6f6bfa27e2454925c61b9aa91acd5c11c5dab2c", "message": "Address comments and more tests", "committedDate": "2020-03-13T22:42:06Z", "type": "commit"}, {"oid": "c6f6bfa27e2454925c61b9aa91acd5c11c5dab2c", "url": "https://github.com/linkedin/ambry/commit/c6f6bfa27e2454925c61b9aa91acd5c11c5dab2c", "message": "Address comments and more tests", "committedDate": "2020-03-13T22:42:06Z", "type": "forcePushed"}]}