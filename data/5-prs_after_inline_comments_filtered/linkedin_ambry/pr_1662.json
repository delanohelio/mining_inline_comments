{"pr_number": 1662, "pr_title": "Fix CompositeByteBuf memory leak and test failure in RouterServerSSLTest", "pr_createdAt": "2020-10-15T18:36:16Z", "pr_url": "https://github.com/linkedin/ambry/pull/1662", "timeline": [{"oid": "1caddcb94513d829550db000f1d5a0217ed1a659", "url": "https://github.com/linkedin/ambry/commit/1caddcb94513d829550db000f1d5a0217ed1a659", "message": "Fix CompositeByteBuf memory leak and test failure in RouterServerSSLTest", "committedDate": "2020-10-15T18:33:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTc2Mzk1NA==", "url": "https://github.com/linkedin/ambry/pull/1662#discussion_r505763954", "bodyText": "why do CompositeByteBufs have to be treated differently here as opposed to just calling addComponent(true, content)?\nIs there a reason not to nest CompositeByteBufs?", "author": "cgtz", "createdAt": "2020-10-15T18:44:30Z", "path": "ambry-protocol/src/main/java/com/github/ambry/protocol/CompositeSend.java", "diffHunk": "@@ -71,8 +71,9 @@ public CompositeSend(List<Send> compositeSendList) {\n             if (content instanceof CompositeByteBuf) {\n               Iterator<ByteBuf> iterator = ((CompositeByteBuf) content).iterator();\n               while (iterator.hasNext()) {\n-                ((CompositeByteBuf) compositeSendContent).addComponent(true, iterator.next());\n+                ((CompositeByteBuf) compositeSendContent).addComponent(true, iterator.next().retain());\n               }\n+              content.release();\n             } else {\n               ((CompositeByteBuf) compositeSendContent).addComponent(true, content);", "originalCommit": "1caddcb94513d829550db000f1d5a0217ed1a659", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTgyOTk3Nw==", "url": "https://github.com/linkedin/ambry/pull/1662#discussion_r505829977", "bodyText": "I guess my original ideal is not to nest compositebytebuf, I just don't like nesting things. Anyway, it shouldn't be any difference here. I will nest compositebytebuf.", "author": "justinlin-linkedin", "createdAt": "2020-10-15T20:41:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTc2Mzk1NA=="}], "type": "inlineReview"}, {"oid": "644eb4ebaaba6904ec52985be0a89f299cdaa0b8", "url": "https://github.com/linkedin/ambry/commit/644eb4ebaaba6904ec52985be0a89f299cdaa0b8", "message": "Address comments", "committedDate": "2020-10-15T20:40:36Z", "type": "commit"}, {"oid": "5cd9ce56ad15a6844ccd66f6e16b4cc8d6bc6f88", "url": "https://github.com/linkedin/ambry/commit/5cd9ce56ad15a6844ccd66f6e16b4cc8d6bc6f88", "message": "Fix typo", "committedDate": "2020-10-15T21:17:13Z", "type": "commit"}]}