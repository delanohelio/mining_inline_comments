{"pr_number": 1349, "pr_title": "Make writable partition selection account for partitions with more than 3 replicas", "pr_createdAt": "2020-01-03T18:25:53Z", "pr_url": "https://github.com/linkedin/ambry/pull/1349", "timeline": [{"oid": "ac8e85b672b088c2102f876b7a273bce0596ed72", "url": "https://github.com/linkedin/ambry/commit/ac8e85b672b088c2102f876b7a273bce0596ed72", "message": "WIP: Make writable partiton selection account for partitions with more than 3 replicas\n\nCurrently, selecting writable partiton for PUT operation only picks\npartitions with highest local replica count. This will become a problem\nwhen \"move replica\" is rolled out. In the intermediate state of \"move\nreplica\", particular partion may have 6 replicas and if we stick with\ncurrent logic. All the write traffic will be routed to this particular\npartition. Hence, this PR we make changes to allow partition selection\nto pick partitons with replicas count >= min replica count(specified in\nClusterMapConfig). In most cases, min replica count = 3.", "committedDate": "2020-01-03T18:24:03Z", "type": "commit"}, {"oid": "b7a4a403394f7691448d8eb94af52467fd256b6d", "url": "https://github.com/linkedin/ambry/commit/b7a4a403394f7691448d8eb94af52467fd256b6d", "message": "fixed test failure", "committedDate": "2020-01-03T20:07:20Z", "type": "commit"}, {"oid": "5f926287785dac067a6ad09522c6a89c6a343e7f", "url": "https://github.com/linkedin/ambry/commit/5f926287785dac067a6ad09522c6a89c6a343e7f", "message": "minor fix for integration test failure", "committedDate": "2020-01-03T23:36:00Z", "type": "commit"}, {"oid": "1f6310164af708b4e9ecedababec72c5c73a603e", "url": "https://github.com/linkedin/ambry/commit/1f6310164af708b4e9ecedababec72c5c73a603e", "message": "added one more unit test", "committedDate": "2020-01-04T18:16:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDM5MjMxOQ==", "url": "https://github.com/linkedin/ambry/pull/1349#discussion_r370392319", "bodyText": "Minor: might need formatting.", "author": "lightningrob", "createdAt": "2020-01-23T22:37:51Z", "path": "ambry-api/src/main/java/com.github.ambry/config/ClusterMapConfig.java", "diffHunk": "@@ -261,5 +269,6 @@ public ClusterMapConfig(VerifiableProperties verifiableProperties) {\n         verifiableProperties.getLongInRange(\"clustermap.replica.catchup.acceptable.lag.bytes\", 0L, 0L, Long.MAX_VALUE);\n     clustermapReplicaCatchupTarget =\n         verifiableProperties.getIntInRange(\"clustermap.replica.catchup.target\", 0, 0, Integer.MAX_VALUE);\n+    clustermapWritablePartitionMinReplicaCount = verifiableProperties.getIntInRange(\"clustermap.writable.partition.min.replica.count\", 3, 0, Integer.MAX_VALUE);", "originalCommit": "1f6310164af708b4e9ecedababec72c5c73a603e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDM5ODE0Mw==", "url": "https://github.com/linkedin/ambry/pull/1349#discussion_r370398143", "bodyText": "sure, I am on it", "author": "jsjtzyy", "createdAt": "2020-01-23T22:54:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDM5MjMxOQ=="}], "type": "inlineReview"}, {"oid": "f1ac05f479a8824513619df082ea92b78d666a3b", "url": "https://github.com/linkedin/ambry/commit/f1ac05f479a8824513619df082ea92b78d666a3b", "message": "comment", "committedDate": "2020-01-23T22:55:51Z", "type": "commit"}]}