{"pr_number": 2343, "pr_title": "bugfix for gh-2239:  Merging views with global elements", "pr_createdAt": "2020-11-17T10:04:32Z", "pr_url": "https://github.com/gchq/Gaffer/pull/2343", "timeline": [{"oid": "2185759cd672308b7a623da6c85b6be0216fe4e3", "url": "https://github.com/gchq/Gaffer/commit/2185759cd672308b7a623da6c85b6be0216fe4e3", "message": "Only expand Global* elements in a View if the schema contains an entry with that element in.  This supports stores such as the FederatedStore where the first Store a query gets run against is in some way a proxy of some other store(s) and doesn't have the schema information to do the expansion.", "committedDate": "2020-11-17T10:15:33Z", "type": "commit"}, {"oid": "8541087241882cab0064d85382b9d005a93f5fef", "url": "https://github.com/gchq/Gaffer/commit/8541087241882cab0064d85382b9d005a93f5fef", "message": "gh-2239:  Updating to try and pass the checkstyle", "committedDate": "2020-11-17T11:16:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTEyODQ1OQ==", "url": "https://github.com/gchq/Gaffer/pull/2343#discussion_r525128459", "bodyText": "Is this change needed? If it's just for the test then it would be better to indirectly call it from one of the public methods", "author": "d47853", "createdAt": "2020-11-17T12:49:30Z", "path": "core/graph/src/main/java/uk/gov/gchq/gaffer/graph/Graph.java", "diffHunk": "@@ -350,22 +354,32 @@ public JobDetail executeJob(final Job job, final Context context) throws Operati\n         return new GraphResult<>(result, clonedContext);\n     }\n \n-    private void updateOperationChainView(final Operations<?> operations) {\n+    void updateOperationChainView(final Operations<?> operations) {", "originalCommit": "8541087241882cab0064d85382b9d005a93f5fef", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjcxMTc1Ng==", "url": "https://github.com/gchq/Gaffer/pull/2343#discussion_r526711756", "bodyText": "Sure thing, this is what I was trying to get at in the PR description - I'll refactor the test to work on the execute method and revert the visibility of the method.", "author": "sw96411", "createdAt": "2020-11-19T09:27:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTEyODQ1OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTEyODU5Mw==", "url": "https://github.com/gchq/Gaffer/pull/2343#discussion_r525128593", "bodyText": "There are a lot of changes to this file, most are whitespace from what I can tell. Please could you revert some of the whitespace changes so it's easier to review?", "author": "d47853", "createdAt": "2020-11-17T12:49:44Z", "path": "core/graph/src/test/java/uk/gov/gchq/gaffer/graph/GraphTest.java", "diffHunk": "@@ -166,73 +167,41 @@ public void shouldConstructGraphFromSchemaModules() {\n         storeProperties.setStoreClass(TestStoreImpl.class.getName());\n \n         final Schema schemaModule1 = new Schema.Builder()\n-                .type(TestTypes.PROP_STRING, new TypeDefinition.Builder()\n-                        .clazz(String.class)\n-                        .build())\n-                .type(\"vertex\", new TypeDefinition.Builder()\n-                        .clazz(String.class)\n-                        .build())\n-                .edge(TestGroups.EDGE, new SchemaEdgeDefinition.Builder()\n-                        .property(TestPropertyNames.PROP_1, TestTypes.PROP_STRING)\n-                        .aggregate(false)\n-                        .source(\"vertex\")\n-                        .destination(\"vertex\")\n-                        .directed(DIRECTED_EITHER)\n-                        .build())\n+                .type(TestTypes.PROP_STRING, new TypeDefinition.Builder().clazz(String.class).build())", "originalCommit": "8541087241882cab0064d85382b9d005a93f5fef", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjcxMjcwNA==", "url": "https://github.com/gchq/Gaffer/pull/2343#discussion_r526712704", "bodyText": "Sorry about that - was trying to setup my save actions to work with the Gaffer checkstyle and it looks like it's started merging lines (this also seems to have caused the measured test coverage % to drop) - I'll sort that out", "author": "sw96411", "createdAt": "2020-11-19T09:28:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTEyODU5Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTEzMTkyOA==", "url": "https://github.com/gchq/Gaffer/pull/2343#discussion_r525131928", "bodyText": "Might be worth adding some integration tests into the federated store to check the behaviour", "author": "d47853", "createdAt": "2020-11-17T12:55:22Z", "path": "core/graph/src/test/java/uk/gov/gchq/gaffer/graph/GraphTest.java", "diffHunk": "@@ -2418,20 +1970,94 @@ public void shouldNotAddDefaultSecurityHooksIfAlreadyAdded() {\n         TestStore.mockStore = mock(Store.class);\n         given(TestStore.mockStore.isSupported(NamedOperation.class)).willReturn(true);\n         // When\n-        final GraphConfig config = new GraphConfig.Builder()\n-                .graphId(\"test\")\n-                .addHook(new FunctionAuthoriser(Lists.newArrayList(Identity.class)))\n+        final GraphConfig config = new GraphConfig.Builder().graphId(\"test\")\n+                .addHook(new FunctionAuthoriser(Lists.newArrayList(Identity.class))).build();\n+\n+        final Graph graph = new Graph.Builder().addSchemas(StreamUtil.schemas(getClass()))\n+                .storeProperties(storeProperties).config(config).build();\n+\n+        // Then\n+        assertEquals(Arrays.asList(NamedOperationResolver.class, NamedViewResolver.class, FunctionAuthoriser.class),\n+                graph.getGraphHooks());\n+        assertEquals(Identity.class,\n+                ((FunctionAuthoriser) graph.getConfig().getHooks().get(2)).getUnauthorisedFunctions().get(0));\n+    }\n+\n+    @Test\n+    public void shouldExpandGlobalEdges() {", "originalCommit": "8541087241882cab0064d85382b9d005a93f5fef", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "5f7c3e7ffa0a973b5f5f1c0bf377d8a62dea810c", "url": "https://github.com/gchq/Gaffer/commit/5f7c3e7ffa0a973b5f5f1c0bf377d8a62dea810c", "message": "gh-2239: Testing via execute method, formatting matches as close as possible to original", "committedDate": "2020-11-19T18:25:51Z", "type": "commit"}, {"oid": "9ae90fb60e0239773da89d59d191c287736f522d", "url": "https://github.com/gchq/Gaffer/commit/9ae90fb60e0239773da89d59d191c287736f522d", "message": "gh-2239;  Adding a test to ensure that global entities and expanded in the subgraphs of a federated graph", "committedDate": "2020-11-20T09:46:04Z", "type": "commit"}, {"oid": "466f41542b60664cff9457c7094330c4edeb99d1", "url": "https://github.com/gchq/Gaffer/commit/466f41542b60664cff9457c7094330c4edeb99d1", "message": "Ensuring 100% test coverage of updateOperationChain in Graph.java", "committedDate": "2020-11-26T11:48:36Z", "type": "commit"}, {"oid": "8d19fbfb264556ffc34c495bced7e00361d32bd2", "url": "https://github.com/gchq/Gaffer/commit/8d19fbfb264556ffc34c495bced7e00361d32bd2", "message": "gh-2239:  Reverting change made to version of fedeerated-store in error", "committedDate": "2020-11-26T13:20:20Z", "type": "commit"}, {"oid": "e27afaea876d48b801ae7d20779491e4e4d7686e", "url": "https://github.com/gchq/Gaffer/commit/e27afaea876d48b801ae7d20779491e4e4d7686e", "message": "Merge branch 'develop' into gh-2239-global-no-schema", "committedDate": "2020-11-30T10:12:07Z", "type": "commit"}]}