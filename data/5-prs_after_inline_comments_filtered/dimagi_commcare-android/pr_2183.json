{"pr_number": 2183, "pr_title": "Upgrade to the Firebase Crashlytics SDK", "pr_createdAt": "2020-02-17T11:43:51Z", "pr_url": "https://github.com/dimagi/commcare-android/pull/2183", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjU4Njg5MQ==", "url": "https://github.com/dimagi/commcare-android/pull/2183#discussion_r382586891", "bodyText": "We can't set the user name anymore ? Using Fabric to Firebase Integration as it's set up current we are able to see both username and userID in firebase.", "author": "shubham1g5", "createdAt": "2020-02-21T13:43:08Z", "path": "app/src/org/commcare/utils/CrashUtil.java", "diffHunk": "@@ -29,35 +21,36 @@\n \n     public static void reportException(Throwable e) {\n         if (crashlyticsEnabled) {\n-            Crashlytics.logException(e);\n+            FirebaseCrashlytics.getInstance().recordException(e);\n         }\n     }\n \n-    public static void init(Context context) {\n+    public static void init() {\n         if (crashlyticsEnabled) {\n-            Fabric.with(context, new Crashlytics());\n-            Crashlytics.setString(DEVICE_ID, ReportingUtils.getDeviceId());\n+            FirebaseCrashlytics crashlytics = FirebaseCrashlytics.getInstance();\n+            crashlytics.setCrashlyticsCollectionEnabled(true);\n+            crashlytics.setCustomKey(DEVICE_ID, ReportingUtils.getDeviceId());\n         }\n     }\n \n     public static void registerAppData() {\n         if (crashlyticsEnabled) {\n-            Crashlytics.setString(DOMAIN, ReportingUtils.getDomain());\n-            Crashlytics.setInt(APP_VERSION, ReportingUtils.getAppVersion());\n-            Crashlytics.setString(APP_NAME, ReportingUtils.getAppName());\n+            FirebaseCrashlytics crashlytics = FirebaseCrashlytics.getInstance();\n+            crashlytics.setCustomKey(DOMAIN, ReportingUtils.getDomain());\n+            crashlytics.setCustomKey(APP_VERSION, ReportingUtils.getAppVersion());\n+            crashlytics.setCustomKey(APP_NAME, ReportingUtils.getAppName());\n         }\n     }\n \n     public static void registerUserData() {\n         if (crashlyticsEnabled) {\n-            Crashlytics.setUserName(ReportingUtils.getUser());", "originalCommit": "f6977047d85d36216b2c74bf5681e6d6a756c451", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDkzOTkwOQ==", "url": "https://github.com/dimagi/commcare-android/pull/2183#discussion_r384939909", "bodyText": "Yeah, setUserIdentifier is now setUserId. setUserName and setUserEmail are removed.. I'll add the user name as a custom key.", "author": "ShivamPokhriyal", "createdAt": "2020-02-27T06:49:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjU4Njg5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTA2MDg0Nw==", "url": "https://github.com/dimagi/commcare-android/pull/2183#discussion_r385060847", "bodyText": "Unfortunately custom keys in firebase are not searchable and we definitely want to be able to search by username. Any ideas how can we achieve that with Firebase Crashlytics ?", "author": "shubham1g5", "createdAt": "2020-02-27T11:11:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjU4Njg5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjQ1NzgxMA==", "url": "https://github.com/dimagi/commcare-android/pull/2183#discussion_r386457810", "bodyText": "I guess this view(search using user name) may change when fabric is unavailable since firebasecrashlytics allows only 1 user identifier. We can though link firebase to bigquery which will allow us to search using custom keys as well.\nPS: Link requires project owner permissions in firebase so I cannot try it out.", "author": "ShivamPokhriyal", "createdAt": "2020-03-02T15:22:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjU4Njg5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjgyNjkwNA==", "url": "https://github.com/dimagi/commcare-android/pull/2183#discussion_r386826904", "bodyText": "@ShivamPokhriyal  Gave you the required permissions. Would also be good to understand the cost implications of linking to bigquery.", "author": "shubham1g5", "createdAt": "2020-03-03T06:51:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjU4Njg5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDM0MjY0Ng==", "url": "https://github.com/dimagi/commcare-android/pull/2183#discussion_r420342646", "bodyText": "In case the bigquery stuff doesn't work out, can we set the userIdentifier as username so that we can still retain search by username.", "author": "shubham1g5", "createdAt": "2020-05-05T19:08:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjU4Njg5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDU1NDM3Ng==", "url": "https://github.com/dimagi/commcare-android/pull/2183#discussion_r420554376", "bodyText": "It does work out fairly well actually. You can see some queries using custom keys here. Though, it sounds good to add username as userIdentifier, or perhaps a combination of userId and userName like(userId::userName) as userIdentifier?", "author": "ShivamPokhriyal", "createdAt": "2020-05-06T05:35:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjU4Njg5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDU3ODY2NQ==", "url": "https://github.com/dimagi/commcare-android/pull/2183#discussion_r420578665", "bodyText": "It does work out fairly well actually. You can see some queries using custom keys here.\n\nAwesome, is it free to use or are there any cost implications for us to use it ?\n\nperhaps a combination of userId and userName like(userId::userName) as userIdentifier?\n\nDoes this allows us to search by any of the params or we will need to know the userId of the user to be able to search ?", "author": "shubham1g5", "createdAt": "2020-05-06T06:53:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjU4Njg5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjk5MDM0MQ==", "url": "https://github.com/dimagi/commcare-android/pull/2183#discussion_r422990341", "bodyText": "Awesome, is it free to use or are there any cost implications for us to use it ?\n\nIt appears to me that using BigQuery over crashlytics data is completely free.\n\nDoes this allows us to search by any of the params or we will need to know the userId of the user to be able to search ?\n\nYes it does. You can check out the complete schema here and it has user.name, user.email and user.id fields there.", "author": "ShivamPokhriyal", "createdAt": "2020-05-11T12:03:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjU4Njg5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzQ0NzcwNQ==", "url": "https://github.com/dimagi/commcare-android/pull/2183#discussion_r423447705", "bodyText": "Yes it does. You can check out the complete schema here and it has user.name, user.email and user.id fields there.\n\nI meant if we set the useridentifier as userId::userName will be able to search by any of the params in firebase ? If not, I think it's best to set it to username only to facilitate quick search from Crashlytics itself without needing BigQuery.", "author": "shubham1g5", "createdAt": "2020-05-12T03:58:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjU4Njg5MQ=="}], "type": "inlineReview"}, {"oid": "3d9fb621787eac8de012b36d267da505a3d63e43", "url": "https://github.com/dimagi/commcare-android/commit/3d9fb621787eac8de012b36d267da505a3d63e43", "message": "Upgrade to the Firebase Crashlytics SDK", "committedDate": "2020-05-12T05:05:19Z", "type": "commit"}, {"oid": "e809d17ea3eccfecf8282813b06ab3a37b18a34d", "url": "https://github.com/dimagi/commcare-android/commit/e809d17ea3eccfecf8282813b06ab3a37b18a34d", "message": "Remove fabric secret keys", "committedDate": "2020-05-12T05:05:19Z", "type": "commit"}, {"oid": "cc26aac05853e929b4dae7931f67858d861e71b9", "url": "https://github.com/dimagi/commcare-android/commit/cc26aac05853e929b4dae7931f67858d861e71b9", "message": "Add user name as custom key in FirebaseCrashlytics logging", "committedDate": "2020-05-12T05:05:19Z", "type": "commit"}, {"oid": "f5a2d4ba53fc7173d077932b8e000335d0baaf44", "url": "https://github.com/dimagi/commcare-android/commit/f5a2d4ba53fc7173d077932b8e000335d0baaf44", "message": "Add username to firebase user identifier", "committedDate": "2020-05-12T05:20:02Z", "type": "commit"}, {"oid": "f5a2d4ba53fc7173d077932b8e000335d0baaf44", "url": "https://github.com/dimagi/commcare-android/commit/f5a2d4ba53fc7173d077932b8e000335d0baaf44", "message": "Add username to firebase user identifier", "committedDate": "2020-05-12T05:20:02Z", "type": "forcePushed"}]}