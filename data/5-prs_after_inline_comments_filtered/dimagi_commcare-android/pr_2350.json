{"pr_number": 2350, "pr_title": "fix update completion indicator in case of background update", "pr_createdAt": "2020-09-18T10:22:18Z", "pr_url": "https://github.com/dimagi/commcare-android/pull/2350", "timeline": [{"oid": "3f2879e686a499a9c21869f3cbdeabe32c2055e3", "url": "https://github.com/dimagi/commcare-android/commit/3f2879e686a499a9c21869f3cbdeabe32c2055e3", "message": "fix update completion indicator in case of background update", "committedDate": "2020-09-18T10:20:42Z", "type": "commit"}, {"oid": "f02e591cd867c1ed9846a5de7dbed095385a574a", "url": "https://github.com/dimagi/commcare-android/commit/f02e591cd867c1ed9846a5de7dbed095385a574a", "message": "throw unknown failure in case update is not ready", "committedDate": "2020-09-18T10:25:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDg2ODcyMA==", "url": "https://github.com/dimagi/commcare-android/pull/2350#discussion_r490868720", "bodyText": "Why are we using this one if ResourceInstallUtils.isUpdateReadyToInstall() gives the correct result?", "author": "ShivamPokhriyal", "createdAt": "2020-09-18T10:59:22Z", "path": "app/src/org/commcare/activities/UpdateActivity.java", "diffHunk": "@@ -177,17 +177,22 @@ private void connectToUpdateWorker() {\n                                 data.getInt(UpdateWorker.Progress_Total, -1));\n                     } else {\n                         // Worker getting fired when not running imply completion of worker\n-                        ResultAndError<AppInstallStatus> lastUpdateResult = getlastStageUpdateResult();\n-                        if (lastUpdateResult != null) {\n-                            handleTaskCompletion(getlastStageUpdateResult());\n-                        }\n+                        handleTaskCompletion(getlastStageUpdateResult());\n                     }\n                 });\n     }\n \n     private ResultAndError<AppInstallStatus> getlastStageUpdateResult() {\n         UpdateStats updateStats = UpdateStats.loadUpdateStats(CommCareApplication.instance().getCurrentApp());\n-        return updateStats.getLastStageUpdateResult();\n+        ResultAndError<AppInstallStatus> lastUpdateResult = updateStats.getLastStageUpdateResult();", "originalCommit": "f02e591cd867c1ed9846a5de7dbed095385a574a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDg2OTgxOA==", "url": "https://github.com/dimagi/commcare-android/pull/2350#discussion_r490869818", "bodyText": "ResourceInstallUtils.isUpdateReadyToInstall() is just an indication of the update's success or failure while in case of failures, the exact reason/type of the failure is contained in lastUpdateResult", "author": "shubham1g5", "createdAt": "2020-09-18T11:01:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDg2ODcyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDg3NDQ0Mw==", "url": "https://github.com/dimagi/commcare-android/pull/2350#discussion_r490874443", "bodyText": "got it. Thanks for explaining that!", "author": "ShivamPokhriyal", "createdAt": "2020-09-18T11:10:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDg2ODcyMA=="}], "type": "inlineReview"}]}