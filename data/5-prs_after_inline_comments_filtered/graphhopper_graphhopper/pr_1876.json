{"pr_number": 1876, "pr_title": "Improve picking up default graph", "pr_createdAt": "2020-01-28T14:35:53Z", "pr_url": "https://github.com/graphhopper/graphhopper/pull/1876", "timeline": [{"oid": "0fc2e284c7a02a1c24d481d8a955b42d337ec4f1", "url": "https://github.com/graphhopper/graphhopper/commit/0fc2e284c7a02a1c24d481d8a955b42d337ec4f1", "message": "found improvement for bit range calculation; fix issue with configured EncodingManager to make #1862 easier", "committedDate": "2020-01-28T14:32:54Z", "type": "commit"}, {"oid": "256a243acd458aafcb444f640b2500770434ee32", "url": "https://github.com/graphhopper/graphhopper/commit/256a243acd458aafcb444f640b2500770434ee32", "message": "made all tests pass", "committedDate": "2020-01-28T22:01:03Z", "type": "commit"}, {"oid": "8f89a40e65f4dc05040b2f2077e068635767801b", "url": "https://github.com/graphhopper/graphhopper/commit/8f89a40e65f4dc05040b2f2077e068635767801b", "message": "merged master", "committedDate": "2020-01-28T22:11:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjA4ODU3Mw==", "url": "https://github.com/graphhopper/graphhopper/pull/1876#discussion_r372088573", "bodyText": "@easbar can you have a look into this test. After merging master I'm getting:\njava.lang.IllegalStateException: Configured CH profile: fastest|car|edge_based=false is not contained in loaded weightings for CH[fastest|car|edge_based=false|u_turn_costs=-1, fastest|bike|edge_based=false|u_turn_costs=-1].\nYou configured: [fastest|car|edge_based=false, fastest|bike|edge_based=false]\n\nAnd cannot make it working. IMO both profiles are identical.\nIs this due to the compatibility layer? Should we remove this :) ?\nAnd I also noticed that Objects.hash and Objects.equals is used in CHProfile which is not available in Java 7 but replacing this should be simple. Sorry it should be Java 7 ...", "author": "karussell", "createdAt": "2020-01-28T22:13:47Z", "path": "core/src/test/java/com/graphhopper/storage/GraphHopperStorageCHTest.java", "diffHunk": "@@ -61,8 +61,10 @@ private GraphHopperStorage newGHStorage(boolean is3D, boolean forEdgeBasedTraver\n     private GraphHopperStorage newGHStorage(Directory dir, boolean is3D, boolean forEdgeBasedTraversal, int segmentSize) {\n         GraphHopperStorage graph = new GraphBuilder(encodingManager)\n                 .setDir(dir).set3D(is3D).withTurnCosts(true).setSegmentSize(segmentSize).build();\n-        FastestWeighting weighting = new FastestWeighting(carEncoder, new DefaultTurnCostProvider(carEncoder, graph.getTurnCostStorage()));\n-        graph.addCHGraph(new CHProfile(weighting, forEdgeBasedTraversal));\n+        for (FlagEncoder encoder : encodingManager.fetchEdgeEncoders()) {\n+            FastestWeighting weighting = new FastestWeighting(encoder, new DefaultTurnCostProvider(encoder, graph.getTurnCostStorage()));\n+            graph.addCHGraph(new CHProfile(weighting, forEdgeBasedTraversal));\n+        }", "originalCommit": "8f89a40e65f4dc05040b2f2077e068635767801b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjEwMTEyNg==", "url": "https://github.com/graphhopper/graphhopper/pull/1876#discussion_r372101126", "bodyText": "Ah, thanks a lot! This way I learn the new stuff pretty fast :)", "author": "karussell", "createdAt": "2020-01-28T22:44:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjA4ODU3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjEwMjQ5NQ==", "url": "https://github.com/graphhopper/graphhopper/pull/1876#discussion_r372102495", "bodyText": "And cannot make it working. IMO both profiles are identical.\n\nI think I fixed this with the last commit. The problem was just an inconsistent way of how the weightings for CH profiles were created for the graphs.\n\nIs this due to the compatibility layer? Should we remove this :) ?\n\nNo this was not because of the compatibility layer. The problem was rather that in one case the weighting had a no turn cost provider and in the other a default turn cost provider.", "author": "easbar", "createdAt": "2020-01-28T22:48:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjA4ODU3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjEwNDU2OQ==", "url": "https://github.com/graphhopper/graphhopper/pull/1876#discussion_r372104569", "bodyText": "This error would have been caught by this check: #1863 (comment) (had we not removed it...)\nBut if we really want to improve something here I think we should refactor these graph storage tests, I am often spending time figuring out which of the createGHStorage methods is actually being called, because they are overriding and calling each other, which can be very confusing.", "author": "easbar", "createdAt": "2020-01-28T22:54:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjA4ODU3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjExMjgyMw==", "url": "https://github.com/graphhopper/graphhopper/pull/1876#discussion_r372112823", "bodyText": "But if we really want to improve something here\n\nYeah, I noticed this too. The number of methods is just too much there.\n\nThis error would have been caught by this check: #1863 (comment) (had we not removed it...)\n\nHaha :) ... maybe we reintroduce it when time shows this is ugly.", "author": "karussell", "createdAt": "2020-01-28T23:17:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjA4ODU3Mw=="}], "type": "inlineReview"}, {"oid": "efc032b6ba9cada3a2115b9cb746da7a76dfc8db", "url": "https://github.com/graphhopper/graphhopper/commit/efc032b6ba9cada3a2115b9cb746da7a76dfc8db", "message": "Fixes test", "committedDate": "2020-01-28T22:42:52Z", "type": "commit"}, {"oid": "b11171c0229a6f833876c6a055ce8e48d200d75a", "url": "https://github.com/graphhopper/graphhopper/commit/b11171c0229a6f833876c6a055ce8e48d200d75a", "message": "test fix regarding TurnCost.key", "committedDate": "2020-01-28T22:44:01Z", "type": "commit"}]}