{"pr_number": 1935, "pr_title": "Add 100m radius restriction to point hint matches", "pr_createdAt": "2020-02-28T09:39:43Z", "pr_url": "https://github.com/graphhopper/graphhopper/pull/1935", "timeline": [{"oid": "a9334f666aa1a35dfe829e37f1717090272d03a4", "url": "https://github.com/graphhopper/graphhopper/commit/a9334f666aa1a35dfe829e37f1717090272d03a4", "message": "Add 100m radius restriction to point hint matches", "committedDate": "2020-02-28T09:30:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTcxNjI0Nw==", "url": "https://github.com/graphhopper/graphhopper/pull/1935#discussion_r385716247", "bodyText": "This would be better to duplicate and keep private", "author": "karussell", "createdAt": "2020-02-28T14:12:52Z", "path": "core/src/main/java/com/graphhopper/storage/GraphEdgeIdFinder.java", "diffHunk": "@@ -239,7 +239,7 @@ public BlockArea setQueryGraph(QueryGraph queryGraph) {\n         }\n     }\n \n-    private static BBox createBBox(NodeAccess na, EdgeIteratorState edgeState) {\n+    public static BBox createBBox(NodeAccess na, EdgeIteratorState edgeState) {", "originalCommit": "a9334f666aa1a35dfe829e37f1717090272d03a4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTczMDgyNw==", "url": "https://github.com/graphhopper/graphhopper/pull/1935#discussion_r385730827", "bodyText": "Fixed", "author": "samruston", "createdAt": "2020-02-28T14:40:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTcxNjI0Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTcxNjUxNQ==", "url": "https://github.com/graphhopper/graphhopper/pull/1935#discussion_r385716515", "bodyText": "Can you make the radius configurable i.e. just move to a constructor parameter (and call it with 100 in the templates or something)?", "author": "karussell", "createdAt": "2020-02-28T14:13:22Z", "path": "core/src/main/java/com/graphhopper/routing/util/NameSimilarityEdgeFilter.java", "diffHunk": "@@ -81,21 +86,26 @@\n     private static final Pattern WORD_CHAR = Pattern.compile(\"\\\\p{LD}+\");\n     private static final JaroWinkler jaroWinkler = new JaroWinkler();\n     private static final double JARO_WINKLER_ACCEPT_FACTOR = .9;\n+    private static final double WITHIN_RADIUS_METERS = 100;\n     private final EdgeFilter edgeFilter;\n     private final String pointHint;\n     private final Map<String, String> rewriteMap;\n+    private final Circle pointCircle;\n+    private final NodeAccess nodeAccess;\n \n-    public NameSimilarityEdgeFilter(EdgeFilter edgeFilter, String pointHint) {\n-        this(edgeFilter, pointHint, DEFAULT_REWRITE_MAP);\n+    public NameSimilarityEdgeFilter(EdgeFilter edgeFilter, NodeAccess nodeAccess, GHPoint point, String pointHint) {\n+        this(edgeFilter, nodeAccess, pointHint, point, DEFAULT_REWRITE_MAP);\n     }\n \n     /**\n      * @param rewriteMap maps abbreviations to its longer form\n      */\n-    public NameSimilarityEdgeFilter(EdgeFilter edgeFilter, String pointHint, Map<String, String> rewriteMap) {\n+    public NameSimilarityEdgeFilter(EdgeFilter edgeFilter, NodeAccess nodeAccess, String pointHint, GHPoint point, Map<String, String> rewriteMap) {\n         this.edgeFilter = edgeFilter;\n         this.rewriteMap = rewriteMap;\n+        this.nodeAccess = nodeAccess;\n         this.pointHint = prepareName(removeRelation(pointHint == null ? \"\" : pointHint));\n+        this.pointCircle = new Circle(point.lat, point.lon, WITHIN_RADIUS_METERS);", "originalCommit": "a9334f666aa1a35dfe829e37f1717090272d03a4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTczMDc5MA==", "url": "https://github.com/graphhopper/graphhopper/pull/1935#discussion_r385730790", "bodyText": "Fixed", "author": "samruston", "createdAt": "2020-02-28T14:40:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTcxNjUxNQ=="}], "type": "inlineReview"}, {"oid": "77fd321eb5107514cd969053d0838a9c0c3c8799", "url": "https://github.com/graphhopper/graphhopper/commit/77fd321eb5107514cd969053d0838a9c0c3c8799", "message": "Added requested changes", "committedDate": "2020-02-28T14:38:07Z", "type": "commit"}]}