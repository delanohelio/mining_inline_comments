{"pr_number": 1579, "pr_title": "Migrate RC to depend directly on Installations SDK.", "pr_createdAt": "2020-05-21T00:46:05Z", "pr_url": "https://github.com/firebase/firebase-android-sdk/pull/1579", "timeline": [{"oid": "95cb9bdb679f79606aa98132e31c42abe5b1edee", "url": "https://github.com/firebase/firebase-android-sdk/commit/95cb9bdb679f79606aa98132e31c42abe5b1edee", "message": "Begin migrating to direct FIS dependency.", "committedDate": "2020-05-19T23:50:27Z", "type": "commit"}, {"oid": "fa509ae887d1917fc9476da8ec70cbdbd111a88e", "url": "https://github.com/firebase/firebase-android-sdk/commit/fa509ae887d1917fc9476da8ec70cbdbd111a88e", "message": "Migrate RC to directly depend on Installations SDK.", "committedDate": "2020-05-20T01:56:31Z", "type": "commit"}, {"oid": "a30b91988c2152cdb4f72fafa858bc5450600861", "url": "https://github.com/firebase/firebase-android-sdk/commit/a30b91988c2152cdb4f72fafa858bc5450600861", "message": "Migrate RC tests and ktx to FIS dependency.", "committedDate": "2020-05-21T00:45:01Z", "type": "commit"}, {"oid": "847cbac4aadb2cc2b5559d452753433cfda7525b", "url": "https://github.com/firebase/firebase-android-sdk/commit/847cbac4aadb2cc2b5559d452753433cfda7525b", "message": "Migrate RC Bandwagoner app to direct FIS dependency.", "committedDate": "2020-05-21T00:45:24Z", "type": "commit"}, {"oid": "62fbcb3d6d19e5484c8ac47a8a508c1a7b3e7c98", "url": "https://github.com/firebase/firebase-android-sdk/commit/62fbcb3d6d19e5484c8ac47a8a508c1a7b3e7c98", "message": "Remove google-services plugin from checked in bandwagoner app.", "committedDate": "2020-05-21T18:26:13Z", "type": "commit"}, {"oid": "4e0fb246217eb2bf7323fcca028cb7bf37546d0a", "url": "https://github.com/firebase/firebase-android-sdk/commit/4e0fb246217eb2bf7323fcca028cb7bf37546d0a", "message": "Update IID -> FIS in integration test.", "committedDate": "2020-05-21T21:51:11Z", "type": "commit"}, {"oid": "baadaa848412cd7bb3c963748d2f7279c6cfc411", "url": "https://github.com/firebase/firebase-android-sdk/commit/baadaa848412cd7bb3c963748d2f7279c6cfc411", "message": "Update docs to reference Installations SDK.", "committedDate": "2020-06-01T19:38:48Z", "type": "commit"}, {"oid": "34e356d24970438c4c14ba1c3ea0fbab1ff877ee", "url": "https://github.com/firebase/firebase-android-sdk/commit/34e356d24970438c4c14ba1c3ea0fbab1ff877ee", "message": "Run formatter.", "committedDate": "2020-06-01T19:50:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTYyMDAwMw==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1579#discussion_r435620003", "bodyText": "nit: Firebase Installation", "author": "ankitaj224", "createdAt": "2020-06-04T23:56:19Z", "path": "firebase-config/src/main/java/com/google/firebase/remoteconfig/FirebaseRemoteConfig.java", "diffHunk": "@@ -301,10 +303,10 @@ public boolean activateFetched() {\n    * FirebaseRemoteConfigSettings.Builder#setMinimumFetchIntervalInSeconds(long)}; the static\n    * default is 12 hours.\n    *\n-   * <p>To identify the current app instance, the fetch request creates a Firebase Instance ID\n-   * token, which periodically sends data to the Firebase backend. To stop the periodic sync, call\n-   * {@link com.google.firebase.iid.FirebaseInstanceId#deleteInstanceId}. To create a new token and\n-   * resume the periodic sync, call {@code fetchConfig} again.\n+   * <p>To identify the current app instance, the fetch request creates a Firebase Instance ID,", "originalCommit": "34e356d24970438c4c14ba1c3ea0fbab1ff877ee", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjEwNTczOA==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1579#discussion_r436105738", "bodyText": "Or even singular lowercase \"Firebase installation\"", "author": "egilmorez", "createdAt": "2020-06-05T18:52:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTYyMDAwMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTYyMDA3Mw==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1579#discussion_r435620073", "bodyText": "nit: Firebase Installation", "author": "ankitaj224", "createdAt": "2020-06-04T23:56:37Z", "path": "firebase-config/src/main/java/com/google/firebase/remoteconfig/FirebaseRemoteConfig.java", "diffHunk": "@@ -324,10 +326,10 @@ public boolean activateFetched() {\n    * <p>Depending on the time elapsed since the last fetch from the Firebase Remote Config backend,\n    * configs are either served from local storage, or fetched from the backend.\n    *\n-   * <p>To identify the current app instance, the fetch request creates a Firebase Instance ID\n-   * token, which periodically sends data to the Firebase backend. To stop the periodic sync, call\n-   * {@link com.google.firebase.iid.FirebaseInstanceId#deleteInstanceId}. To create a new token and\n-   * resume the periodic sync, call {@code fetchConfig} again.\n+   * <p>To identify the current app instance, the fetch request creates a Firebase Instance ID,", "originalCommit": "34e356d24970438c4c14ba1c3ea0fbab1ff877ee", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjEwNTgwNw==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1579#discussion_r436105807", "bodyText": "Or even singular lowercase \"Firebase installation\"", "author": "egilmorez", "createdAt": "2020-06-05T18:52:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTYyMDA3Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTYyMTYzMA==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1579#discussion_r435621630", "bodyText": "instanceId.getToken is FCM token and FIS getToken is FIS Auth Token.\nThose are diff tokens. Just want to be sure this change is intended.", "author": "ankitaj224", "createdAt": "2020-06-05T00:02:30Z", "path": "firebase-config/src/main/java/com/google/firebase/remoteconfig/internal/ConfigFetchHandler.java", "diffHunk": "@@ -286,16 +297,17 @@ private String createThrottledMessage(long throttledDurationInMillis) {\n    *     error connecting to the server.\n    */\n   @WorkerThread\n-  private FetchResponse fetchFromBackend(InstanceIdResult instanceId, Date currentTime)\n+  private FetchResponse fetchFromBackend(\n+      String installationId, String installationToken, Date currentTime)\n       throws FirebaseRemoteConfigException {\n     try {\n       HttpURLConnection urlConnection = frcBackendApiClient.createHttpURLConnection();\n \n       FetchResponse response =\n           frcBackendApiClient.fetch(\n               urlConnection,\n-              instanceId.getId(),\n-              instanceId.getToken(),\n+              installationId,\n+              installationToken,", "originalCommit": "34e356d24970438c4c14ba1c3ea0fbab1ff877ee", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjIwMTA4MA==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1579#discussion_r436201080", "bodyText": "Yep, thanks for checking. The RC backend's already been updated to accept either.", "author": "danasilver", "createdAt": "2020-06-05T23:06:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTYyMTYzMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjIwNjA1Nw==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1579#discussion_r436206057", "bodyText": "Sounds good. Thanks for confirming :)", "author": "ankitaj224", "createdAt": "2020-06-05T23:30:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTYyMTYzMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzExNTAyOA==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1579#discussion_r437115028", "bodyText": "Potentially add the term \"auth\" to the variable name?", "author": "andirayo", "createdAt": "2020-06-09T03:17:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTYyMTYzMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjEwNTQ4NQ==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1579#discussion_r436105485", "bodyText": "Strictly speaking, we are trying to use lowercase \"Firebase installation ID.\"\nThis fights our tendency to productize every single thing from Notifications to Extensions, and it is singular, as a reference to this installation vs. the product offering overall.", "author": "egilmorez", "createdAt": "2020-06-05T18:51:44Z", "path": "firebase-config/src/main/java/com/google/firebase/remoteconfig/FirebaseRemoteConfig.java", "diffHunk": "@@ -66,10 +66,10 @@\n    * <p>{@link FirebaseRemoteConfig} uses the default {@link FirebaseApp}, so if no {@link\n    * FirebaseApp} has been initialized yet, this method throws an {@link IllegalStateException}.\n    *\n-   * <p>To identify the current app instance, the fetch request creates a Firebase Instance ID\n-   * token, which periodically sends data to the Firebase backend. To stop the periodic sync, call\n-   * {@link com.google.firebase.iid.FirebaseInstanceId#deleteInstanceId}. To create a new token and\n-   * resume the periodic sync, call {@code fetchConfig} again.\n+   * <p>To identify the current app instance, the fetch request creates a Firebase Installations ID,", "originalCommit": "34e356d24970438c4c14ba1c3ea0fbab1ff877ee", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "512df9d2135fea8a580549dfc8aafbe004de5f09", "url": "https://github.com/firebase/firebase-android-sdk/commit/512df9d2135fea8a580549dfc8aafbe004de5f09", "message": "Fix installation docs.", "committedDate": "2020-06-05T22:12:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzA3NTIwMw==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1579#discussion_r437075203", "bodyText": "How about LOGGING_TAG?", "author": "andirayo", "createdAt": "2020-06-09T00:42:38Z", "path": "firebase-config/bandwagoner/src/main/java/com/googletest/firebase/remoteconfig/bandwagoner/ApiFragment.java", "diffHunk": "@@ -46,20 +49,25 @@\n public class ApiFragment extends Fragment {\n \n   private FirebaseRemoteConfig frc;\n+  private FirebaseInstallationsApi firebaseInstallations;\n   private View rootView;\n   private EditText minimumFetchIntervalText;\n   private EditText parameterKeyText;\n   private TextView parameterValueText;\n   private TextView apiCallProgressText;\n   private TextView apiCallResultsText;\n \n+  private static final String TAG = \"Bandwagoner\";", "originalCommit": "512df9d2135fea8a580549dfc8aafbe004de5f09", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzY5NjI0NA==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1579#discussion_r437696244", "bodyText": "TAG is the standard name for the logging tag constant on Android. See the logcat docs and our other usage in Firebase Android", "author": "danasilver", "createdAt": "2020-06-09T20:24:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzA3NTIwMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzA3NTUyOA==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1579#discussion_r437075528", "bodyText": "How about fidTask or installationIdTask?", "author": "andirayo", "createdAt": "2020-06-09T00:43:54Z", "path": "firebase-config/bandwagoner/src/main/java/com/googletest/firebase/remoteconfig/bandwagoner/ApiFragment.java", "diffHunk": "@@ -87,9 +95,25 @@ public View onCreateView(\n     TextView sdkVersionText = rootView.findViewById(R.id.sdk_version_text);\n \n     TextView iidText = rootView.findViewById(R.id.iid_text);\n-    iidText.setText(\"IID: \" + FirebaseInstanceId.getInstance().getId());\n \n-    apiCallResultsText.setText(FirebaseInstanceId.getInstance().getToken());\n+    Task<String> idTask = firebaseInstallations.getId();", "originalCommit": "512df9d2135fea8a580549dfc8aafbe004de5f09", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzA3NTcwNw==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1579#discussion_r437075707", "bodyText": "How about installationAuthTokenTask?", "author": "andirayo", "createdAt": "2020-06-09T00:44:36Z", "path": "firebase-config/bandwagoner/src/main/java/com/googletest/firebase/remoteconfig/bandwagoner/ApiFragment.java", "diffHunk": "@@ -87,9 +95,25 @@ public View onCreateView(\n     TextView sdkVersionText = rootView.findViewById(R.id.sdk_version_text);\n \n     TextView iidText = rootView.findViewById(R.id.iid_text);\n-    iidText.setText(\"IID: \" + FirebaseInstanceId.getInstance().getId());\n \n-    apiCallResultsText.setText(FirebaseInstanceId.getInstance().getToken());\n+    Task<String> idTask = firebaseInstallations.getId();\n+    Task<InstallationTokenResult> tokenTask = firebaseInstallations.getToken(false);", "originalCommit": "512df9d2135fea8a580549dfc8aafbe004de5f09", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzA3NjcwMg==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1579#discussion_r437076702", "bodyText": "How about ignoredTasks?\nI am not sure what Android naming convention is here, but do you also use the underscore \"_\" prefix?\n_ignoredTasks", "author": "andirayo", "createdAt": "2020-06-09T00:48:13Z", "path": "firebase-config/bandwagoner/src/main/java/com/googletest/firebase/remoteconfig/bandwagoner/ApiFragment.java", "diffHunk": "@@ -87,9 +95,25 @@ public View onCreateView(\n     TextView sdkVersionText = rootView.findViewById(R.id.sdk_version_text);\n \n     TextView iidText = rootView.findViewById(R.id.iid_text);\n-    iidText.setText(\"IID: \" + FirebaseInstanceId.getInstance().getId());\n \n-    apiCallResultsText.setText(FirebaseInstanceId.getInstance().getToken());\n+    Task<String> idTask = firebaseInstallations.getId();\n+    Task<InstallationTokenResult> tokenTask = firebaseInstallations.getToken(false);\n+\n+    Tasks.whenAllComplete(idTask, tokenTask)\n+        .addOnCompleteListener(\n+            unusedCompletedTasks -> {", "originalCommit": "512df9d2135fea8a580549dfc8aafbe004de5f09", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzc3MzE3OA==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1579#discussion_r437773178", "bodyText": "Not sure there's a real convention in Android or Java, but we use \"unused\" consistently as a prefix in Remote Config at least, so I'd lean towards keeping it.", "author": "danasilver", "createdAt": "2020-06-09T23:15:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzA3NjcwMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzA3Njk2OA==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1579#discussion_r437076968", "bodyText": "How about \"installation authentication token\"?", "author": "andirayo", "createdAt": "2020-06-09T00:49:19Z", "path": "firebase-config/bandwagoner/src/main/java/com/googletest/firebase/remoteconfig/bandwagoner/ApiFragment.java", "diffHunk": "@@ -87,9 +95,25 @@ public View onCreateView(\n     TextView sdkVersionText = rootView.findViewById(R.id.sdk_version_text);\n \n     TextView iidText = rootView.findViewById(R.id.iid_text);\n-    iidText.setText(\"IID: \" + FirebaseInstanceId.getInstance().getId());\n \n-    apiCallResultsText.setText(FirebaseInstanceId.getInstance().getToken());\n+    Task<String> idTask = firebaseInstallations.getId();\n+    Task<InstallationTokenResult> tokenTask = firebaseInstallations.getToken(false);\n+\n+    Tasks.whenAllComplete(idTask, tokenTask)\n+        .addOnCompleteListener(\n+            unusedCompletedTasks -> {\n+              if (idTask.isSuccessful()) {\n+                iidText.setText(String.format(\"Installation ID: %s\", idTask.getResult()));\n+              } else {\n+                Log.e(TAG, \"Error getting Installation ID\", idTask.getException());\n+              }\n+\n+              if (tokenTask.isSuccessful()) {\n+                apiCallResultsText.setText(tokenTask.getResult().getToken());\n+              } else {\n+                Log.e(TAG, \"Error getting Installation Token\", tokenTask.getException());", "originalCommit": "512df9d2135fea8a580549dfc8aafbe004de5f09", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzExMDI4NQ==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1579#discussion_r437110285", "bodyText": "How about this:\n\"Note: Also initializes the Firebase installations SDK that creates installation IDs to identify Firebase installations and periodically sends data to Firebase servers. Remote Config requires installation IDs for Fetch requests. To stop [...]\"", "author": "andirayo", "createdAt": "2020-06-09T02:58:18Z", "path": "firebase-config/src/main/java/com/google/firebase/remoteconfig/FirebaseRemoteConfig.java", "diffHunk": "@@ -66,10 +66,10 @@\n    * <p>{@link FirebaseRemoteConfig} uses the default {@link FirebaseApp}, so if no {@link\n    * FirebaseApp} has been initialized yet, this method throws an {@link IllegalStateException}.\n    *\n-   * <p>To identify the current app instance, the fetch request creates a Firebase Instance ID\n-   * token, which periodically sends data to the Firebase backend. To stop the periodic sync, call\n-   * {@link com.google.firebase.iid.FirebaseInstanceId#deleteInstanceId}. To create a new token and\n-   * resume the periodic sync, call {@code fetchConfig} again.\n+   * <p>To identify the current app instance, the fetch request creates a Firebase installation ID,", "originalCommit": "512df9d2135fea8a580549dfc8aafbe004de5f09", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzExMDkwNw==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1579#discussion_r437110907", "bodyText": "What means \"token\" in this context?\nIs this a (FIS) authentication token?\nIf yes, do developers need to know about this implementation detail.\nIf no, can you please specify what \"token\" is meant here?\nHow about this:\n\"Note: If you send another Fetch request after the deletion, Remote Config and Firebase installations will create a new installation ID for this Firebase installation and resume the periodic sync.\"", "author": "andirayo", "createdAt": "2020-06-09T03:00:46Z", "path": "firebase-config/src/main/java/com/google/firebase/remoteconfig/FirebaseRemoteConfig.java", "diffHunk": "@@ -66,10 +66,10 @@\n    * <p>{@link FirebaseRemoteConfig} uses the default {@link FirebaseApp}, so if no {@link\n    * FirebaseApp} has been initialized yet, this method throws an {@link IllegalStateException}.\n    *\n-   * <p>To identify the current app instance, the fetch request creates a Firebase Instance ID\n-   * token, which periodically sends data to the Firebase backend. To stop the periodic sync, call\n-   * {@link com.google.firebase.iid.FirebaseInstanceId#deleteInstanceId}. To create a new token and\n-   * resume the periodic sync, call {@code fetchConfig} again.\n+   * <p>To identify the current app instance, the fetch request creates a Firebase installation ID,\n+   * which periodically sends data to the Firebase backend. To stop the periodic sync, call {@link\n+   * com.google.firebase.installations.FirebaseInstallations#delete}. To create a new token and", "originalCommit": "512df9d2135fea8a580549dfc8aafbe004de5f09", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzc3NjQyMg==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1579#discussion_r437776422", "bodyText": "It's a FIS auth token, yes. The note might be helpful to give context to the #delete method developers can call, and give additional background for developers using a FIS auth token to identify test devices in the ABT console (where we call out that they need to use a FIS auth token). I think the note you wrote sounds good and provides the right level of context.", "author": "danasilver", "createdAt": "2020-06-09T23:25:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzExMDkwNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzExMTAzMQ==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1579#discussion_r437111031", "bodyText": "Similar to above.", "author": "andirayo", "createdAt": "2020-06-09T03:01:11Z", "path": "firebase-config/src/main/java/com/google/firebase/remoteconfig/FirebaseRemoteConfig.java", "diffHunk": "@@ -301,10 +303,10 @@ public boolean activateFetched() {\n    * FirebaseRemoteConfigSettings.Builder#setMinimumFetchIntervalInSeconds(long)}; the static\n    * default is 12 hours.\n    *\n-   * <p>To identify the current app instance, the fetch request creates a Firebase Instance ID\n-   * token, which periodically sends data to the Firebase backend. To stop the periodic sync, call\n-   * {@link com.google.firebase.iid.FirebaseInstanceId#deleteInstanceId}. To create a new token and\n-   * resume the periodic sync, call {@code fetchConfig} again.\n+   * <p>To identify the current app instance, the fetch request creates a Firebase installation ID,\n+   * which periodically sends data to the Firebase backend. To stop the periodic sync, call {@link\n+   * com.google.firebase.installations.FirebaseInstallations#delete}. To create a new token and\n+   * resume the periodic sync, call {@code fetch} again.", "originalCommit": "512df9d2135fea8a580549dfc8aafbe004de5f09", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzExMTQ4Mw==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1579#discussion_r437111483", "bodyText": "How about removing this duplicated Javadoc and instead refer to the other method, e.g. \"For documentation please refer to {@link fetch()}.\"", "author": "andirayo", "createdAt": "2020-06-09T03:02:47Z", "path": "firebase-config/src/main/java/com/google/firebase/remoteconfig/FirebaseRemoteConfig.java", "diffHunk": "@@ -324,10 +326,10 @@ public boolean activateFetched() {\n    * <p>Depending on the time elapsed since the last fetch from the Firebase Remote Config backend,\n    * configs are either served from local storage, or fetched from the backend.\n    *\n-   * <p>To identify the current app instance, the fetch request creates a Firebase Instance ID\n-   * token, which periodically sends data to the Firebase backend. To stop the periodic sync, call\n-   * {@link com.google.firebase.iid.FirebaseInstanceId#deleteInstanceId}. To create a new token and\n-   * resume the periodic sync, call {@code fetchConfig} again.\n+   * <p>To identify the current app instance, the fetch request creates a Firebase installation ID,\n+   * which periodically sends data to the Firebase backend. To stop the periodic sync, call {@link\n+   * com.google.firebase.installations.FirebaseInstallations#delete}. To create a new token and\n+   * resume the periodic sync, call {@code fetch} again.", "originalCommit": "512df9d2135fea8a580549dfc8aafbe004de5f09", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzc5NTE0MA==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1579#discussion_r437795140", "bodyText": "@egilmorez What do you think? Is there a general practice for duplicated docs?", "author": "danasilver", "createdAt": "2020-06-10T00:30:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzExMTQ4Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTExODQzOA==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1579#discussion_r439118438", "bodyText": "Chatted about this with @rachelsaunders. Generally you want to avoid linking between methods with specific implementation details since it requires the user to parse out what does/doesn't apply to that method.", "author": "danasilver", "createdAt": "2020-06-11T23:08:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzExMTQ4Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzExNDA1NQ==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1579#discussion_r437114055", "bodyText": "+1 for variable naming :)\nI would recommend to have it consistent with variables above to not confuse readers.\ninstallationTokenTask sounds good.\nI would preferinstallationAuthTokenTask to prevent possible(?) confusion with FCM tokens.", "author": "andirayo", "createdAt": "2020-06-09T03:13:24Z", "path": "firebase-config/src/main/java/com/google/firebase/remoteconfig/internal/ConfigFetchHandler.java", "diffHunk": "@@ -189,21 +189,32 @@ public ConfigFetchHandler(\n                   createThrottledMessage(backoffEndTime.getTime() - currentTime.getTime()),\n                   backoffEndTime.getTime()));\n     } else {\n-      Task<InstanceIdResult> instanceIdTask = firebaseInstanceId.getInstanceId();\n+      Task<String> installationIdTask = firebaseInstallations.getId();\n+      Task<InstallationTokenResult> installationTokenTask = firebaseInstallations.getToken(false);", "originalCommit": "512df9d2135fea8a580549dfc8aafbe004de5f09", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzc3MDg5Mg==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1579#discussion_r437770892", "bodyText": "Yeah, sounds good. I like the specificity.", "author": "danasilver", "createdAt": "2020-06-09T23:08:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzExNDA1NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzExNDI1NQ==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1579#discussion_r437114255", "bodyText": "How about mentioning \"Firebase Installations\" so that developers have all the info to potentially raise issues with Firebase?", "author": "andirayo", "createdAt": "2020-06-09T03:14:20Z", "path": "firebase-config/src/main/java/com/google/firebase/remoteconfig/internal/ConfigFetchHandler.java", "diffHunk": "@@ -189,21 +189,32 @@ public ConfigFetchHandler(\n                   createThrottledMessage(backoffEndTime.getTime() - currentTime.getTime()),\n                   backoffEndTime.getTime()));\n     } else {\n-      Task<InstanceIdResult> instanceIdTask = firebaseInstanceId.getInstanceId();\n+      Task<String> installationIdTask = firebaseInstallations.getId();\n+      Task<InstallationTokenResult> installationTokenTask = firebaseInstallations.getToken(false);\n       fetchResponseTask =\n-          instanceIdTask.continueWithTask(\n-              executor,\n-              (completedIidTask) -> {\n-                if (!completedIidTask.isSuccessful()) {\n-                  return Tasks.forException(\n-                      new FirebaseRemoteConfigClientException(\n-                          \"Failed to get Firebase Instance ID token for fetch.\",\n-                          completedIidTask.getException()));\n-                }\n-\n-                InstanceIdResult instanceIdResult = completedIidTask.getResult();\n-                return fetchFromBackendAndCacheResponse(instanceIdResult, currentTime);\n-              });\n+          Tasks.whenAllComplete(installationIdTask, installationTokenTask)\n+              .continueWithTask(\n+                  executor,\n+                  (completedInstallationsTasks) -> {\n+                    if (!installationIdTask.isSuccessful()) {\n+                      return Tasks.forException(\n+                          new FirebaseRemoteConfigClientException(\n+                              \"Failed to get Firebase Installation ID for fetch.\",", "originalCommit": "512df9d2135fea8a580549dfc8aafbe004de5f09", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTE1Mzg0Ng==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1579#discussion_r439153846", "bodyText": "Good call", "author": "danasilver", "createdAt": "2020-06-12T01:03:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzExNDI1NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzExNDY4MQ==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1579#discussion_r437114681", "bodyText": "I know we already talked about this, but I strongly recommend to only upload the FIS auth token, because the auth token contains all the information needed on server side, particularly the FID.\nThus, uploading both values is redundancy and might lead to inconsistencies on server side.\nAs far as I understood our conversations, you are planning to get rid of uploading the FID in the future, but want to upload it for now to keep the current processes consistent.\nThat is absolutely fine. I just wanted to mention it again.", "author": "andirayo", "createdAt": "2020-06-09T03:16:11Z", "path": "firebase-config/src/main/java/com/google/firebase/remoteconfig/internal/ConfigFetchHandler.java", "diffHunk": "@@ -189,21 +189,32 @@ public ConfigFetchHandler(\n                   createThrottledMessage(backoffEndTime.getTime() - currentTime.getTime()),\n                   backoffEndTime.getTime()));\n     } else {\n-      Task<InstanceIdResult> instanceIdTask = firebaseInstanceId.getInstanceId();\n+      Task<String> installationIdTask = firebaseInstallations.getId();\n+      Task<InstallationTokenResult> installationTokenTask = firebaseInstallations.getToken(false);\n       fetchResponseTask =\n-          instanceIdTask.continueWithTask(\n-              executor,\n-              (completedIidTask) -> {\n-                if (!completedIidTask.isSuccessful()) {\n-                  return Tasks.forException(\n-                      new FirebaseRemoteConfigClientException(\n-                          \"Failed to get Firebase Instance ID token for fetch.\",\n-                          completedIidTask.getException()));\n-                }\n-\n-                InstanceIdResult instanceIdResult = completedIidTask.getResult();\n-                return fetchFromBackendAndCacheResponse(instanceIdResult, currentTime);\n-              });\n+          Tasks.whenAllComplete(installationIdTask, installationTokenTask)\n+              .continueWithTask(\n+                  executor,\n+                  (completedInstallationsTasks) -> {\n+                    if (!installationIdTask.isSuccessful()) {\n+                      return Tasks.forException(\n+                          new FirebaseRemoteConfigClientException(\n+                              \"Failed to get Firebase Installation ID for fetch.\",\n+                              installationIdTask.getException()));\n+                    }\n+\n+                    if (!installationTokenTask.isSuccessful()) {\n+                      return Tasks.forException(\n+                          new FirebaseRemoteConfigClientException(\n+                              \"Failed to get Firebase Installation token for fetch.\",\n+                              installationTokenTask.getException()));\n+                    }\n+\n+                    String installationId = installationIdTask.getResult();\n+                    String installationToken = installationTokenTask.getResult().getToken();\n+                    return fetchFromBackendAndCacheResponse(\n+                        installationId, installationToken, currentTime);", "originalCommit": "512df9d2135fea8a580549dfc8aafbe004de5f09", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzc3MDE2MA==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1579#discussion_r437770160", "bodyText": "Thanks for calling it out!", "author": "danasilver", "createdAt": "2020-06-09T23:06:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzExNDY4MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzExNTYzOA==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1579#discussion_r437115638", "bodyText": "Please use values that have a roughly correct format in order to make it easier for readers to understand what data is used / required here.\nExamples:\nFID: \"'fL71_VyL3uo9jNMWu1L60S\"\nauth token: \"eyJhbGciOiJF.eyJmaWQiOiJmaXMt.AB2LPV8wRQIhAPs4NvEgA3uhubH\"", "author": "andirayo", "createdAt": "2020-06-09T03:20:14Z", "path": "firebase-config/src/test/java/com/google/firebase/remoteconfig/FirebaseRemoteConfigTest.java", "diffHunk": "@@ -96,10 +96,14 @@\n \n   private static final String ETAG = \"ETag\";\n \n-  private static final String INSTANCE_ID_STRING = \"fake instance id\";\n-  private static final String INSTANCE_ID_TOKEN_STRING = \"fake instance id token\";\n-  private static final InstanceIdResult INSTANCE_ID_RESULT =\n-      new FakeInstanceIdResult(INSTANCE_ID_STRING, INSTANCE_ID_TOKEN_STRING);\n+  private static final String INSTALLATION_ID = \"fake instance id\";\n+  private static final String INSTALLATION_TOKEN = \"fake instance id token\";", "originalCommit": "512df9d2135fea8a580549dfc8aafbe004de5f09", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzExNTcxMg==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1579#discussion_r437115712", "bodyText": "Same as above.", "author": "andirayo", "createdAt": "2020-06-09T03:20:37Z", "path": "firebase-config/src/test/java/com/google/firebase/remoteconfig/internal/ConfigFetchHandlerTest.java", "diffHunk": "@@ -98,8 +98,14 @@\n @RunWith(RobolectricTestRunner.class)\n @Config(manifest = Config.NONE)\n public class ConfigFetchHandlerTest {\n-  private static final String INSTANCE_ID_STRING = \"fake instance id\";\n-  private static final String INSTANCE_ID_TOKEN_STRING = \"fake instance id token\";\n+  private static final String INSTALLATION_ID = \"fake installation id\";\n+  private static final String INSTALLATION_TOKEN = \"fake installation token\";", "originalCommit": "512df9d2135fea8a580549dfc8aafbe004de5f09", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "01b4f739609749e34a26e3b97a0340cc86999f3e", "url": "https://github.com/firebase/firebase-android-sdk/commit/01b4f739609749e34a26e3b97a0340cc86999f3e", "message": "Update some variables and comments for FIS.", "committedDate": "2020-06-10T00:44:14Z", "type": "commit"}, {"oid": "0481a94fa50002471362ced9ea39ed4ff54f90a3", "url": "https://github.com/firebase/firebase-android-sdk/commit/0481a94fa50002471362ced9ea39ed4ff54f90a3", "message": "Update error messages to directly mention Firebase Installations.", "committedDate": "2020-06-12T01:04:39Z", "type": "commit"}, {"oid": "df620df3d28cf116f1cf5af36a8f393ab517f396", "url": "https://github.com/firebase/firebase-android-sdk/commit/df620df3d28cf116f1cf5af36a8f393ab517f396", "message": "Update tests with installations", "committedDate": "2020-06-12T01:58:06Z", "type": "commit"}, {"oid": "5dcf29409463c8756d9a2da0a298d471872d4a55", "url": "https://github.com/firebase/firebase-android-sdk/commit/5dcf29409463c8756d9a2da0a298d471872d4a55", "message": "Update missing auth token test.", "committedDate": "2020-06-16T23:56:31Z", "type": "commit"}]}