{"pr_number": 1150, "pr_title": "Add an ObjectValue builder", "pr_createdAt": "2020-01-21T23:03:18Z", "pr_url": "https://github.com/firebase/firebase-android-sdk/pull/1150", "timeline": [{"oid": "550a831502e884355e2d312817dc8defe084fa4e", "url": "https://github.com/firebase/firebase-android-sdk/commit/550a831502e884355e2d312817dc8defe084fa4e", "message": "Add an ObjectValue builder", "committedDate": "2020-01-21T22:59:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTczMDIyNw==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1150#discussion_r369730227", "bodyText": "This is pretty verbose. How about ObjectValue.newBuilder()?", "author": "wilhuff", "createdAt": "2020-01-22T18:32:04Z", "path": "firebase-firestore/src/main/java/com/google/firebase/firestore/UserDataConverter.java", "diffHunk": "@@ -117,7 +117,7 @@ public ParsedUpdateData parseUpdateData(Map<String, Object> data) {\n \n     ParseAccumulator accumulator = new ParseAccumulator(UserData.Source.Update);\n     ParseContext context = accumulator.rootContext();\n-    ObjectValue updateData = ObjectValue.emptyObject();\n+    ObjectValue.Builder updateData = ObjectValue.Builder.emptyBuilder();", "originalCommit": "550a831502e884355e2d312817dc8defe084fa4e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTg1NzMzOA==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1150#discussion_r369857338", "bodyText": "Works for me. I got inspired by the rest of the Protobuf API.", "author": "schmidt-sebastian", "createdAt": "2020-01-22T23:14:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTczMDIyNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTczMTE4Nw==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1150#discussion_r369731187", "bodyText": "Trailing .build() here seems wrong.", "author": "wilhuff", "createdAt": "2020-01-22T18:34:03Z", "path": "firebase-firestore/src/main/java/com/google/firebase/firestore/model/mutation/TransformMutation.java", "diffHunk": "@@ -227,11 +228,12 @@ private ObjectValue transformObject(ObjectValue objectValue, List<FieldValue> tr\n     hardAssert(\n         transformResults.size() == fieldTransforms.size(), \"Transform results length mismatch.\");\n \n+    ObjectValue.Builder builder = objectValue.toBuilder();\n     for (int i = 0; i < fieldTransforms.size(); i++) {\n       FieldTransform fieldTransform = fieldTransforms.get(i);\n       FieldPath fieldPath = fieldTransform.getFieldPath();\n-      objectValue = objectValue.set(fieldPath, transformResults.get(i));\n+      builder.set(fieldPath, transformResults.get(i)).build();", "originalCommit": "550a831502e884355e2d312817dc8defe084fa4e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTg1NzM4MA==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1150#discussion_r369857380", "bodyText": "Removed", "author": "schmidt-sebastian", "createdAt": "2020-01-22T23:14:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTczMTE4Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTczMjI0Nw==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1150#discussion_r369732247", "bodyText": "The caller doesn't necessarily have to pass an empty object, do they? Seems like empty could be objectValue, as it is below.", "author": "wilhuff", "createdAt": "2020-01-22T18:36:06Z", "path": "firebase-firestore/src/test/java/com/google/firebase/firestore/model/FieldValueTest.java", "diffHunk": "@@ -356,4 +374,12 @@ public void testValueOrdering() {\n         .addEqualityGroup(wrapObject(map(\"foo\", \"0\")))\n         .testCompare();\n   }\n+\n+  private ObjectValue setField(ObjectValue empty, String a, FieldValue mod) {", "originalCommit": "550a831502e884355e2d312817dc8defe084fa4e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTg1NzQ3NQ==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1150#discussion_r369857475", "bodyText": "Yeah, it should have been objectValue.", "author": "schmidt-sebastian", "createdAt": "2020-01-22T23:15:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTczMjI0Nw=="}], "type": "inlineReview"}, {"oid": "b48b1408b8f933dc80aac2464d51bf77ac3c8144", "url": "https://github.com/firebase/firebase-android-sdk/commit/b48b1408b8f933dc80aac2464d51bf77ac3c8144", "message": "Review feedback", "committedDate": "2020-01-22T23:18:51Z", "type": "commit"}, {"oid": "4025ada23f348a27c9d243623d496e5dbfcdc2fb", "url": "https://github.com/firebase/firebase-android-sdk/commit/4025ada23f348a27c9d243623d496e5dbfcdc2fb", "message": "Renames", "committedDate": "2020-01-22T23:21:52Z", "type": "commit"}]}