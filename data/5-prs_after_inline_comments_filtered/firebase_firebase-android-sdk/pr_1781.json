{"pr_number": 1781, "pr_title": "Improve action click browser handling for FIAM and implement dismiss listener", "pr_createdAt": "2020-07-17T22:09:55Z", "pr_url": "https://github.com/firebase/firebase-android-sdk/pull/1781", "timeline": [{"oid": "5699a96df74e490f60574569d0ebf8c11ee3f67c", "url": "https://github.com/firebase/firebase-android-sdk/commit/5699a96df74e490f60574569d0ebf8c11ee3f67c", "message": "heal eye stab wound", "committedDate": "2020-07-28T18:24:43Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzU5MTM4OQ==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1781#discussion_r457591389", "bodyText": "Can we add some documentation for our future selves about why we need to check for custom tabs?", "author": "prakhar1989", "createdAt": "2020-07-20T17:57:05Z", "path": "firebase-inappmessaging-display/src/main/java/com/google/firebase/inappmessaging/display/FirebaseInAppMessagingDisplay.java", "diffHunk": "@@ -535,4 +547,32 @@ private void notifyFiamDismiss() {\n       fiamListener.onFiamDismiss();\n     }\n   }\n+\n+  private void launchUriIntent(Activity activity, Uri uri) {\n+    if (supportsCustomTabs(activity)) {\n+      CustomTabsIntent customTabsIntent = new CustomTabsIntent.Builder().build();\n+      Intent intent = customTabsIntent.intent;\n+      intent.addFlags(Intent.FLAG_ACTIVITY_NO_HISTORY);\n+      intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);\n+      customTabsIntent.launchUrl(activity, uri);\n+    } else {\n+      Intent browserIntent = new Intent(Intent.ACTION_VIEW, uri);\n+      ResolveInfo info = activity.getPackageManager().resolveActivity(browserIntent, 0);\n+      browserIntent.addFlags(Intent.FLAG_ACTIVITY_NO_HISTORY);\n+      browserIntent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);\n+      if (info != null) {\n+        activity.startActivity(browserIntent);\n+      } else {\n+        Logging.loge(\"Device cannot resolve intent for: \" + Intent.ACTION_VIEW);\n+      }\n+    }\n+  }\n+\n+  private boolean supportsCustomTabs(Activity activity) {", "originalCommit": "6be6b1cbfbb6e372bf96b228222557f9fdf64bc0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzU5MjI1OA==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1781#discussion_r457592258", "bodyText": "Some documentation for the if/else branches", "author": "prakhar1989", "createdAt": "2020-07-20T17:58:35Z", "path": "firebase-inappmessaging-display/src/main/java/com/google/firebase/inappmessaging/display/FirebaseInAppMessagingDisplay.java", "diffHunk": "@@ -535,4 +547,32 @@ private void notifyFiamDismiss() {\n       fiamListener.onFiamDismiss();\n     }\n   }\n+\n+  private void launchUriIntent(Activity activity, Uri uri) {\n+    if (supportsCustomTabs(activity)) {\n+      CustomTabsIntent customTabsIntent = new CustomTabsIntent.Builder().build();\n+      Intent intent = customTabsIntent.intent;\n+      intent.addFlags(Intent.FLAG_ACTIVITY_NO_HISTORY);\n+      intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);\n+      customTabsIntent.launchUrl(activity, uri);\n+    } else {", "originalCommit": "6be6b1cbfbb6e372bf96b228222557f9fdf64bc0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzU5Mjk0Ng==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1781#discussion_r457592946", "bodyText": "Worth adding a log here: \"Calling callback for action\"?", "author": "prakhar1989", "createdAt": "2020-07-20T17:59:46Z", "path": "firebase-inappmessaging-display/src/main/java/com/google/firebase/inappmessaging/display/FirebaseInAppMessagingDisplay.java", "diffHunk": "@@ -332,8 +328,24 @@ public void onClick(View v) {\n                 callbacks = null;\n               }\n             };\n+      } else if (action != null && TextUtils.isEmpty(action.getActionUrl())) {\n+        // If the message has an action but no action url, attempt to call developer callback\n+        Logging.logi(\"No action url found for action. Callback will be called if present\");\n+        actionListener =\n+            new View.OnClickListener() {\n+              @Override\n+              public void onClick(View v) {\n+                if (callbacks != null) {\n+                  callbacks.messageClicked(action);", "originalCommit": "6be6b1cbfbb6e372bf96b228222557f9fdf64bc0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzYwNzY3NQ==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1781#discussion_r457607675", "bodyText": "replace i.e with e.g since there are other ways to dismiss as well? (eg. hitting the back button)?", "author": "prakhar1989", "createdAt": "2020-07-20T18:26:40Z", "path": "firebase-inappmessaging/src/main/java/com/google/firebase/inappmessaging/FirebaseInAppMessagingDismissListener.java", "diffHunk": "@@ -0,0 +1,24 @@\n+// Copyright 2020 Google LLC\n+//\n+// Licensed under the Apache License, Version 2.0 (the \"License\");\n+// you may not use this file except in compliance with the License.\n+// You may obtain a copy of the License at\n+//\n+//      http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing, software\n+// distributed under the License is distributed on an \"AS IS\" BASIS,\n+// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+// See the License for the specific language governing permissions and\n+// limitations under the License.\n+\n+package com.google.firebase.inappmessaging;\n+\n+import androidx.annotation.NonNull;\n+import com.google.firebase.inappmessaging.model.InAppMessage;\n+\n+public interface FirebaseInAppMessagingDismissListener {\n+\n+  // Triggered when a message is dismissed (ie: \"x\" button, in the modal view)", "originalCommit": "6be6b1cbfbb6e372bf96b228222557f9fdf64bc0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e542d5301da86f039f764687bdf9cd6413d46e0a", "url": "https://github.com/firebase/firebase-android-sdk/commit/e542d5301da86f039f764687bdf9cd6413d46e0a", "message": "improve click behavior and add dismiss listener", "committedDate": "2020-08-06T21:42:01Z", "type": "commit"}, {"oid": "8b1e379159b8beb3611389c73d11fb7109f98c1c", "url": "https://github.com/firebase/firebase-android-sdk/commit/8b1e379159b8beb3611389c73d11fb7109f98c1c", "message": "stab self in eye", "committedDate": "2020-08-06T21:42:01Z", "type": "commit"}, {"oid": "86ce62f3d4face367af17fa09e7cdc662c1802fe", "url": "https://github.com/firebase/firebase-android-sdk/commit/86ce62f3d4face367af17fa09e7cdc662c1802fe", "message": "heal eye stab wound", "committedDate": "2020-08-06T21:42:01Z", "type": "commit"}, {"oid": "d3b3b3aa10974ad20d0b5049f8e3046e01927bdd", "url": "https://github.com/firebase/firebase-android-sdk/commit/d3b3b3aa10974ad20d0b5049f8e3046e01927bdd", "message": "go back to the old version because the new one kills everything", "committedDate": "2020-08-06T21:42:01Z", "type": "commit"}, {"oid": "f2b6f9a027a30080fe3af03018d3c7139d41e7b3", "url": "https://github.com/firebase/firebase-android-sdk/commit/f2b6f9a027a30080fe3af03018d3c7139d41e7b3", "message": "address review comments", "committedDate": "2020-08-06T21:47:28Z", "type": "commit"}, {"oid": "f2b6f9a027a30080fe3af03018d3c7139d41e7b3", "url": "https://github.com/firebase/firebase-android-sdk/commit/f2b6f9a027a30080fe3af03018d3c7139d41e7b3", "message": "address review comments", "committedDate": "2020-08-06T21:47:28Z", "type": "forcePushed"}]}