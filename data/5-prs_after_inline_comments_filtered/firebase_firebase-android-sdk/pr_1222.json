{"pr_number": 1222, "pr_title": "Make server timestamp methods static, rename ServerTimestamps", "pr_createdAt": "2020-02-07T16:35:34Z", "pr_url": "https://github.com/firebase/firebase-android-sdk/pull/1222", "timeline": [{"oid": "de3c9441ef509735ff2754823cb05b3a2a8caf60", "url": "https://github.com/firebase/firebase-android-sdk/commit/de3c9441ef509735ff2754823cb05b3a2a8caf60", "message": "Make ServerTimestampValue methods static", "committedDate": "2020-02-07T16:32:25Z", "type": "commit"}, {"oid": "f4f26c45881194d5e3aa3daba8187e3961fed7e9", "url": "https://github.com/firebase/firebase-android-sdk/commit/f4f26c45881194d5e3aa3daba8187e3961fed7e9", "message": "format", "committedDate": "2020-02-07T16:33:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjUwOTI1NA==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1222#discussion_r376509254", "bodyText": "The Java style guide suggests to use braces even for one line statements: https://engdoc.corp.google.com/eng/doc/devguide/java/style/index.md?cl=head#s4.1-braces", "author": "schmidt-sebastian", "createdAt": "2020-02-07T17:18:55Z", "path": "firebase-firestore/src/main/java/com/google/firebase/firestore/UserDataWriter.java", "diffHunk": "@@ -90,14 +92,14 @@ Object convertValue(Value value) {\n     return result;\n   }\n \n-  private Object convertServerTimestamp(ServerTimestampValue value) {\n+  private Object convertServerTimestamp(Value serverTimestampValue) {\n     switch (serverTimestampBehavior) {\n       case PREVIOUS:\n-        return value.getPreviousValue() == null ? null : convertValue(value.getPreviousValue());\n+        Value previousValue = getPreviousValue(serverTimestampValue);\n+        if (previousValue == null) return null;", "originalCommit": "f4f26c45881194d5e3aa3daba8187e3961fed7e9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjUzNjU0OA==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1222#discussion_r376536548", "bodyText": "Fixed. It's lame that Java and C++ don't align on this point.", "author": "wilhuff", "createdAt": "2020-02-07T18:22:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjUwOTI1NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjUwOTk0NQ==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1222#discussion_r376509945", "bodyText": ":) Much better.", "author": "schmidt-sebastian", "createdAt": "2020-02-07T17:20:28Z", "path": "firebase-firestore/src/main/java/com/google/firebase/firestore/UserDataWriter.java", "diffHunk": "@@ -90,14 +92,14 @@ Object convertValue(Value value) {\n     return result;\n   }\n \n-  private Object convertServerTimestamp(ServerTimestampValue value) {\n+  private Object convertServerTimestamp(Value serverTimestampValue) {\n     switch (serverTimestampBehavior) {\n       case PREVIOUS:\n-        return value.getPreviousValue() == null ? null : convertValue(value.getPreviousValue());\n+        Value previousValue = getPreviousValue(serverTimestampValue);\n+        if (previousValue == null) return null;\n+        return convertValue(previousValue);\n       case ESTIMATE:\n-        return !timestampsInSnapshots\n-            ? value.getLocalWriteTime().toDate()\n-            : value.getLocalWriteTime();\n+        return convertTimestamp(getLocalWriteTime(serverTimestampValue));", "originalCommit": "f4f26c45881194d5e3aa3daba8187e3961fed7e9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "57314fe8912fbee4e6544ba14a9ed85eae8bc5ba", "url": "https://github.com/firebase/firebase-android-sdk/commit/57314fe8912fbee4e6544ba14a9ed85eae8bc5ba", "message": "Feedback", "committedDate": "2020-02-07T18:23:15Z", "type": "commit"}]}