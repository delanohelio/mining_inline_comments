{"pr_number": 1555, "pr_title": "Disable FIS network calls to use cached response.", "pr_createdAt": "2020-05-12T23:07:14Z", "pr_url": "https://github.com/firebase/firebase-android-sdk/pull/1555", "timeline": [{"oid": "4283a2bb3b4434510e061a0d9c4b080595658c2a", "url": "https://github.com/firebase/firebase-android-sdk/commit/4283a2bb3b4434510e061a0d9c4b080595658c2a", "message": "Dropping guava and appcompat dependency from FIS SDK.", "committedDate": "2020-02-06T17:59:09Z", "type": "commit"}, {"oid": "984884cd6f9a90a8172d0957bd13e68e3f06db2f", "url": "https://github.com/firebase/firebase-android-sdk/commit/984884cd6f9a90a8172d0957bd13e68e3f06db2f", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk", "committedDate": "2020-02-06T18:16:08Z", "type": "commit"}, {"oid": "a82387701d2549bb5fc3b5dc2530a83ed0680d02", "url": "https://github.com/firebase/firebase-android-sdk/commit/a82387701d2549bb5fc3b5dc2530a83ed0680d02", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk", "committedDate": "2020-02-11T18:58:16Z", "type": "commit"}, {"oid": "afcb14c913c8dedd87faf6b71fdc7dd4384a6c39", "url": "https://github.com/firebase/firebase-android-sdk/commit/afcb14c913c8dedd87faf6b71fdc7dd4384a6c39", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk", "committedDate": "2020-02-13T23:37:48Z", "type": "commit"}, {"oid": "5574e30b8e3f6c9d09bfca149a6f7853c4141d25", "url": "https://github.com/firebase/firebase-android-sdk/commit/5574e30b8e3f6c9d09bfca149a6f7853c4141d25", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk", "committedDate": "2020-03-05T16:49:33Z", "type": "commit"}, {"oid": "a5dd4dc54f2b7941ffe4b5cd76b6c8ab5764f7a1", "url": "https://github.com/firebase/firebase-android-sdk/commit/a5dd4dc54f2b7941ffe4b5cd76b6c8ab5764f7a1", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk", "committedDate": "2020-03-09T16:31:08Z", "type": "commit"}, {"oid": "45312e68fe8516dc4d48a2bfdb422f5023c1241b", "url": "https://github.com/firebase/firebase-android-sdk/commit/45312e68fe8516dc4d48a2bfdb422f5023c1241b", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk", "committedDate": "2020-03-10T18:13:59Z", "type": "commit"}, {"oid": "f0be4fa07222c687044f66d8cb2859e156611896", "url": "https://github.com/firebase/firebase-android-sdk/commit/f0be4fa07222c687044f66d8cb2859e156611896", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk", "committedDate": "2020-03-10T21:55:48Z", "type": "commit"}, {"oid": "ac0397ba816265b24da3eca4645761a37d4b46b6", "url": "https://github.com/firebase/firebase-android-sdk/commit/ac0397ba816265b24da3eca4645761a37d4b46b6", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk", "committedDate": "2020-03-11T18:14:18Z", "type": "commit"}, {"oid": "8f6b46e3346cad5d3a4128ad1316e9e0831c0a2b", "url": "https://github.com/firebase/firebase-android-sdk/commit/8f6b46e3346cad5d3a4128ad1316e9e0831c0a2b", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk", "committedDate": "2020-03-12T19:40:52Z", "type": "commit"}, {"oid": "686a998ab40a6c855d81b30f7686ef20aef1713c", "url": "https://github.com/firebase/firebase-android-sdk/commit/686a998ab40a6c855d81b30f7686ef20aef1713c", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk", "committedDate": "2020-03-16T17:31:01Z", "type": "commit"}, {"oid": "3bf7c24892fc6d66b4b33cb943ac2fe9e3e11598", "url": "https://github.com/firebase/firebase-android-sdk/commit/3bf7c24892fc6d66b4b33cb943ac2fe9e3e11598", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk", "committedDate": "2020-03-18T21:05:27Z", "type": "commit"}, {"oid": "07ff7ddc966270c28df8d123ef95e63a9f058494", "url": "https://github.com/firebase/firebase-android-sdk/commit/07ff7ddc966270c28df8d123ef95e63a9f058494", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk", "committedDate": "2020-03-30T21:58:00Z", "type": "commit"}, {"oid": "f982f2d752d3567a1164b6f3bb00a1dfc601ab91", "url": "https://github.com/firebase/firebase-android-sdk/commit/f982f2d752d3567a1164b6f3bb00a1dfc601ab91", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk", "committedDate": "2020-03-31T22:05:19Z", "type": "commit"}, {"oid": "672526aca799c55e7f83aaa0f08c7e698be388ed", "url": "https://github.com/firebase/firebase-android-sdk/commit/672526aca799c55e7f83aaa0f08c7e698be388ed", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk", "committedDate": "2020-04-05T05:34:09Z", "type": "commit"}, {"oid": "1adf4a2621f9367521f806ea893770921713e49f", "url": "https://github.com/firebase/firebase-android-sdk/commit/1adf4a2621f9367521f806ea893770921713e49f", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk", "committedDate": "2020-04-07T20:56:39Z", "type": "commit"}, {"oid": "4435ed00d6c6d59ae1dd2442e034c75873bf8ed8", "url": "https://github.com/firebase/firebase-android-sdk/commit/4435ed00d6c6d59ae1dd2442e034c75873bf8ed8", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk", "committedDate": "2020-04-10T21:22:37Z", "type": "commit"}, {"oid": "99f1f827dac599f04bd69eea5a49c1596eadf49a", "url": "https://github.com/firebase/firebase-android-sdk/commit/99f1f827dac599f04bd69eea5a49c1596eadf49a", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk", "committedDate": "2020-04-13T22:51:18Z", "type": "commit"}, {"oid": "08d91f888d6ce2f18b5fdf6ef20936c9bc7974c2", "url": "https://github.com/firebase/firebase-android-sdk/commit/08d91f888d6ce2f18b5fdf6ef20936c9bc7974c2", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk", "committedDate": "2020-05-01T16:39:27Z", "type": "commit"}, {"oid": "747598f42b4fc9fa882b8feb3e8c8d1b652739ec", "url": "https://github.com/firebase/firebase-android-sdk/commit/747598f42b4fc9fa882b8feb3e8c8d1b652739ec", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk", "committedDate": "2020-05-01T18:36:33Z", "type": "commit"}, {"oid": "28cc955fd37c7127dd30ccdcee326328e32b499d", "url": "https://github.com/firebase/firebase-android-sdk/commit/28cc955fd37c7127dd30ccdcee326328e32b499d", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk", "committedDate": "2020-05-05T22:00:57Z", "type": "commit"}, {"oid": "519ae71d474bab8a8483f2b5269d53f1536e107d", "url": "https://github.com/firebase/firebase-android-sdk/commit/519ae71d474bab8a8483f2b5269d53f1536e107d", "message": "Fix OverlappingFileLockException.\n\nAccess the data shared by multiple threads only after acquiring cross-process and multi-thread safe locks.", "committedDate": "2020-05-08T17:37:48Z", "type": "commit"}, {"oid": "98e0e25dfa3de3310fd68207622af5d02e1a4f1d", "url": "https://github.com/firebase/firebase-android-sdk/commit/98e0e25dfa3de3310fd68207622af5d02e1a4f1d", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk", "committedDate": "2020-05-08T17:38:10Z", "type": "commit"}, {"oid": "cba321b43380cb858bc362889c9a75b088763238", "url": "https://github.com/firebase/firebase-android-sdk/commit/cba321b43380cb858bc362889c9a75b088763238", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk", "committedDate": "2020-05-08T22:18:10Z", "type": "commit"}, {"oid": "28598b0c6d552f653e4d55cc181a1df960552814", "url": "https://github.com/firebase/firebase-android-sdk/commit/28598b0c6d552f653e4d55cc181a1df960552814", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk", "committedDate": "2020-05-12T22:29:04Z", "type": "commit"}, {"oid": "fdb05134dc2e5fc64b01df8b1979f1188e0e54ac", "url": "https://github.com/firebase/firebase-android-sdk/commit/fdb05134dc2e5fc64b01df8b1979f1188e0e54ac", "message": "Disable FIS network calls to use cached response.", "committedDate": "2020-05-12T23:05:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDA5NDc5Mw==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1555#discussion_r424094793", "bodyText": "Aren't you worried that this might trigger unexpected errors?\nHave you tested this already or should we test it maybe?", "author": "andirayo", "createdAt": "2020-05-12T23:42:19Z", "path": "firebase-installations/src/main/java/com/google/firebase/installations/remote/FirebaseInstallationServiceClient.java", "diffHunk": "@@ -407,6 +407,7 @@ private static void logBadConfigError() {\n   private HttpURLConnection openHttpURLConnection(URL url, String apiKey) throws IOException {\n     HttpURLConnection httpURLConnection = (HttpURLConnection) url.openConnection();\n     httpURLConnection.setConnectTimeout(NETWORK_TIMEOUT_MILLIS);\n+    httpURLConnection.setUseCaches(false);", "originalCommit": "fdb05134dc2e5fc64b01df8b1979f1188e0e54ac", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU5NTM4Ng==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1555#discussion_r424595386", "bodyText": "Additionally, are we sure that POSTs actually respect this value? I would imagine that posts are just never cached", "author": "vkryachko", "createdAt": "2020-05-13T17:05:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDA5NDc5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTQ2MTgxNA==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1555#discussion_r425461814", "bodyText": "Since Android 4.4, it uses okhttp for all Http calls.\nsetUseCaches is set to true by default.\nThe ResponseCache implementation decides which resources should be cached, and for how long they should be cached. If a request resource cannot be retrieved from the cache, then the protocol handlers will fetch the resource from its original location. The settings for URLConnection#useCaches controls whether the protocol is allowed to use a cached response.\nFrom the user reported stack trace:\ncom.android.okhttp.internal.huc.JavaApiConverter.createOkResponseForCacheGet(JavaApiConverter.java:216) \nAnd the javadocs of JavaApiConverter.createOkResponseForCacheGet: Creates an OkHttp Response using the supplied Request and CacheResponse to supply the data\nLooks like there is response caching internally.\nRegarding POST not being cached:\nFrom the rfc : Responses to POST method are not cacheable, unless the response includes appropriate Cache-Control or Expires header fields.\nCache-Control is set to private for getToken response.\n@vkryachko Do you see any issue in disabling the cache?", "author": "ankitaj224", "createdAt": "2020-05-14T22:16:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDA5NDc5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTQ4MzU4Ng==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1555#discussion_r425483586", "bodyText": "Also, I think we can benefit from setting Cache-Control request header as  no-cache", "author": "ankitaj224", "createdAt": "2020-05-14T23:24:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDA5NDc5Mw=="}], "type": "inlineReview"}, {"oid": "5ce053a56a7b91f874a9df381ced6dc0aad484be", "url": "https://github.com/firebase/firebase-android-sdk/commit/5ce053a56a7b91f874a9df381ced6dc0aad484be", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk into cacheFis", "committedDate": "2020-05-21T17:55:53Z", "type": "commit"}, {"oid": "c318bcc66c1062eb921ec171217095739b76f522", "url": "https://github.com/firebase/firebase-android-sdk/commit/c318bcc66c1062eb921ec171217095739b76f522", "message": "Setting Request Cache-Control", "committedDate": "2020-05-21T18:46:04Z", "type": "commit"}, {"oid": "c66119959bff2cfb0ba4841c35f517b319c04a98", "url": "https://github.com/firebase/firebase-android-sdk/commit/c66119959bff2cfb0ba4841c35f517b319c04a98", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk into cacheFis", "committedDate": "2020-05-25T17:43:18Z", "type": "commit"}]}