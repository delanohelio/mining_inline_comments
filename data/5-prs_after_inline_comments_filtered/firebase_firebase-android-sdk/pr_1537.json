{"pr_number": 1537, "pr_title": "Log the available Firebase options along with the error stream.", "pr_createdAt": "2020-05-08T18:25:49Z", "pr_url": "https://github.com/firebase/firebase-android-sdk/pull/1537", "timeline": [{"oid": "4283a2bb3b4434510e061a0d9c4b080595658c2a", "url": "https://github.com/firebase/firebase-android-sdk/commit/4283a2bb3b4434510e061a0d9c4b080595658c2a", "message": "Dropping guava and appcompat dependency from FIS SDK.", "committedDate": "2020-02-06T17:59:09Z", "type": "commit"}, {"oid": "984884cd6f9a90a8172d0957bd13e68e3f06db2f", "url": "https://github.com/firebase/firebase-android-sdk/commit/984884cd6f9a90a8172d0957bd13e68e3f06db2f", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk", "committedDate": "2020-02-06T18:16:08Z", "type": "commit"}, {"oid": "a82387701d2549bb5fc3b5dc2530a83ed0680d02", "url": "https://github.com/firebase/firebase-android-sdk/commit/a82387701d2549bb5fc3b5dc2530a83ed0680d02", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk", "committedDate": "2020-02-11T18:58:16Z", "type": "commit"}, {"oid": "afcb14c913c8dedd87faf6b71fdc7dd4384a6c39", "url": "https://github.com/firebase/firebase-android-sdk/commit/afcb14c913c8dedd87faf6b71fdc7dd4384a6c39", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk", "committedDate": "2020-02-13T23:37:48Z", "type": "commit"}, {"oid": "5574e30b8e3f6c9d09bfca149a6f7853c4141d25", "url": "https://github.com/firebase/firebase-android-sdk/commit/5574e30b8e3f6c9d09bfca149a6f7853c4141d25", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk", "committedDate": "2020-03-05T16:49:33Z", "type": "commit"}, {"oid": "a5dd4dc54f2b7941ffe4b5cd76b6c8ab5764f7a1", "url": "https://github.com/firebase/firebase-android-sdk/commit/a5dd4dc54f2b7941ffe4b5cd76b6c8ab5764f7a1", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk", "committedDate": "2020-03-09T16:31:08Z", "type": "commit"}, {"oid": "45312e68fe8516dc4d48a2bfdb422f5023c1241b", "url": "https://github.com/firebase/firebase-android-sdk/commit/45312e68fe8516dc4d48a2bfdb422f5023c1241b", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk", "committedDate": "2020-03-10T18:13:59Z", "type": "commit"}, {"oid": "f0be4fa07222c687044f66d8cb2859e156611896", "url": "https://github.com/firebase/firebase-android-sdk/commit/f0be4fa07222c687044f66d8cb2859e156611896", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk", "committedDate": "2020-03-10T21:55:48Z", "type": "commit"}, {"oid": "ac0397ba816265b24da3eca4645761a37d4b46b6", "url": "https://github.com/firebase/firebase-android-sdk/commit/ac0397ba816265b24da3eca4645761a37d4b46b6", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk", "committedDate": "2020-03-11T18:14:18Z", "type": "commit"}, {"oid": "8f6b46e3346cad5d3a4128ad1316e9e0831c0a2b", "url": "https://github.com/firebase/firebase-android-sdk/commit/8f6b46e3346cad5d3a4128ad1316e9e0831c0a2b", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk", "committedDate": "2020-03-12T19:40:52Z", "type": "commit"}, {"oid": "686a998ab40a6c855d81b30f7686ef20aef1713c", "url": "https://github.com/firebase/firebase-android-sdk/commit/686a998ab40a6c855d81b30f7686ef20aef1713c", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk", "committedDate": "2020-03-16T17:31:01Z", "type": "commit"}, {"oid": "3bf7c24892fc6d66b4b33cb943ac2fe9e3e11598", "url": "https://github.com/firebase/firebase-android-sdk/commit/3bf7c24892fc6d66b4b33cb943ac2fe9e3e11598", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk", "committedDate": "2020-03-18T21:05:27Z", "type": "commit"}, {"oid": "07ff7ddc966270c28df8d123ef95e63a9f058494", "url": "https://github.com/firebase/firebase-android-sdk/commit/07ff7ddc966270c28df8d123ef95e63a9f058494", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk", "committedDate": "2020-03-30T21:58:00Z", "type": "commit"}, {"oid": "f982f2d752d3567a1164b6f3bb00a1dfc601ab91", "url": "https://github.com/firebase/firebase-android-sdk/commit/f982f2d752d3567a1164b6f3bb00a1dfc601ab91", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk", "committedDate": "2020-03-31T22:05:19Z", "type": "commit"}, {"oid": "672526aca799c55e7f83aaa0f08c7e698be388ed", "url": "https://github.com/firebase/firebase-android-sdk/commit/672526aca799c55e7f83aaa0f08c7e698be388ed", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk", "committedDate": "2020-04-05T05:34:09Z", "type": "commit"}, {"oid": "1adf4a2621f9367521f806ea893770921713e49f", "url": "https://github.com/firebase/firebase-android-sdk/commit/1adf4a2621f9367521f806ea893770921713e49f", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk", "committedDate": "2020-04-07T20:56:39Z", "type": "commit"}, {"oid": "4435ed00d6c6d59ae1dd2442e034c75873bf8ed8", "url": "https://github.com/firebase/firebase-android-sdk/commit/4435ed00d6c6d59ae1dd2442e034c75873bf8ed8", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk", "committedDate": "2020-04-10T21:22:37Z", "type": "commit"}, {"oid": "99f1f827dac599f04bd69eea5a49c1596eadf49a", "url": "https://github.com/firebase/firebase-android-sdk/commit/99f1f827dac599f04bd69eea5a49c1596eadf49a", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk", "committedDate": "2020-04-13T22:51:18Z", "type": "commit"}, {"oid": "08d91f888d6ce2f18b5fdf6ef20936c9bc7974c2", "url": "https://github.com/firebase/firebase-android-sdk/commit/08d91f888d6ce2f18b5fdf6ef20936c9bc7974c2", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk", "committedDate": "2020-05-01T16:39:27Z", "type": "commit"}, {"oid": "747598f42b4fc9fa882b8feb3e8c8d1b652739ec", "url": "https://github.com/firebase/firebase-android-sdk/commit/747598f42b4fc9fa882b8feb3e8c8d1b652739ec", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk", "committedDate": "2020-05-01T18:36:33Z", "type": "commit"}, {"oid": "28cc955fd37c7127dd30ccdcee326328e32b499d", "url": "https://github.com/firebase/firebase-android-sdk/commit/28cc955fd37c7127dd30ccdcee326328e32b499d", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk", "committedDate": "2020-05-05T22:00:57Z", "type": "commit"}, {"oid": "519ae71d474bab8a8483f2b5269d53f1536e107d", "url": "https://github.com/firebase/firebase-android-sdk/commit/519ae71d474bab8a8483f2b5269d53f1536e107d", "message": "Fix OverlappingFileLockException.\n\nAccess the data shared by multiple threads only after acquiring cross-process and multi-thread safe locks.", "committedDate": "2020-05-08T17:37:48Z", "type": "commit"}, {"oid": "98e0e25dfa3de3310fd68207622af5d02e1a4f1d", "url": "https://github.com/firebase/firebase-android-sdk/commit/98e0e25dfa3de3310fd68207622af5d02e1a4f1d", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk", "committedDate": "2020-05-08T17:38:10Z", "type": "commit"}, {"oid": "6ed9c0cbdac40e8289dcd9439bcdf94534eab2fd", "url": "https://github.com/firebase/firebase-android-sdk/commit/6ed9c0cbdac40e8289dcd9439bcdf94534eab2fd", "message": "Log the available Firebase options along with the error stream.", "committedDate": "2020-05-08T18:18:04Z", "type": "commit"}, {"oid": "0e496fdd4739bf4c9e5cb1900080f84dac90ffd5", "url": "https://github.com/firebase/firebase-android-sdk/commit/0e496fdd4739bf4c9e5cb1900080f84dac90ffd5", "message": "Cleanup diff PR changes", "committedDate": "2020-05-08T18:23:09Z", "type": "commit"}, {"oid": "4d7ed5e2a9fd57c33c0934b359bed6f7fc36273b", "url": "https://github.com/firebase/firebase-android-sdk/commit/4d7ed5e2a9fd57c33c0934b359bed6f7fc36273b", "message": "Minor fix.", "committedDate": "2020-05-08T18:24:13Z", "type": "commit"}, {"oid": "9ae13d54632e945d586768ce49ee6842adfdb107", "url": "https://github.com/firebase/firebase-android-sdk/commit/9ae13d54632e945d586768ce49ee6842adfdb107", "message": "Using Textutils.", "committedDate": "2020-05-08T18:35:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjMwNjU3NA==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1537#discussion_r422306574", "bodyText": "I don't think that this TextUtils.isEmpty(appId) ? \"\" : appId is necessary.\nJust add appId and String.format will replace it by an empty String.", "author": "andirayo", "createdAt": "2020-05-08T18:40:31Z", "path": "firebase-installations/src/main/java/com/google/firebase/installations/remote/FirebaseInstallationServiceClient.java", "diffHunk": "@@ -522,13 +525,21 @@ static long parseTokenExpirationTimestamp(String expiresIn) {\n         : Long.parseLong(expiresIn.substring(0, expiresIn.length() - 1));\n   }\n \n-  private static void logFisCommunicationError(HttpURLConnection conn) {\n+  private static void logFisCommunicationError(HttpURLConnection conn, String firebaseOptions) {\n     String logString = readErrorResponse(conn);\n     if (!TextUtils.isEmpty(logString)) {\n       Log.w(FIS_TAG, logString);\n+      Log.w(FIS_TAG, firebaseOptions);\n     }\n   }\n \n+  private String availableFirebaseOptions(\n+      @Nullable String appId, @NonNull String apiKey, @NonNull String projectId) {\n+    return String.format(\n+        \"Firebase options used while communicating with Firebase server APIs: %s, %s, %s\",\n+        TextUtils.isEmpty(appId) ? \"\" : appId, apiKey, projectId);", "originalCommit": "9ae13d54632e945d586768ce49ee6842adfdb107", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjMxNzg5Nw==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1537#discussion_r422317897", "bodyText": "Unless otherwise specified, passing a null argument to any method or constructor in this class will cause a NullPointerException to be thrown.\nhttps://developer.android.com/reference/java/util/Formatter\nIts safe to format on our end correctly vs depending on underlying Formatter impl.", "author": "ankitaj224", "createdAt": "2020-05-08T19:03:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjMwNjU3NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjMyMzgwNA==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1537#discussion_r422323804", "bodyText": "https://screenshot.googleplex.com/JVHfUAGMKGt", "author": "andirayo", "createdAt": "2020-05-08T19:15:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjMwNjU3NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjMwNzI5Nw==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1537#discussion_r422307297", "bodyText": "... %s, %s (%s)\", apiKey, projectId, appId", "author": "andirayo", "createdAt": "2020-05-08T18:41:55Z", "path": "firebase-installations/src/main/java/com/google/firebase/installations/remote/FirebaseInstallationServiceClient.java", "diffHunk": "@@ -522,13 +525,21 @@ static long parseTokenExpirationTimestamp(String expiresIn) {\n         : Long.parseLong(expiresIn.substring(0, expiresIn.length() - 1));\n   }\n \n-  private static void logFisCommunicationError(HttpURLConnection conn) {\n+  private static void logFisCommunicationError(HttpURLConnection conn, String firebaseOptions) {\n     String logString = readErrorResponse(conn);\n     if (!TextUtils.isEmpty(logString)) {\n       Log.w(FIS_TAG, logString);\n+      Log.w(FIS_TAG, firebaseOptions);\n     }\n   }\n \n+  private String availableFirebaseOptions(\n+      @Nullable String appId, @NonNull String apiKey, @NonNull String projectId) {\n+    return String.format(\n+        \"Firebase options used while communicating with Firebase server APIs: %s, %s, %s\",", "originalCommit": "9ae13d54632e945d586768ce49ee6842adfdb107", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjMwODM4OQ==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1537#discussion_r422308389", "bodyText": "I would prefer this order, given that API key is the most important value and App ID is not always available.", "author": "andirayo", "createdAt": "2020-05-08T18:44:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjMwNzI5Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjMwNzgwNg==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1537#discussion_r422307806", "bodyText": "rather than repeating availableFirebaseOptions( 3 times, I recommend calling #availableFirebaseOptions from within the #logFisCommunicationError method.", "author": "andirayo", "createdAt": "2020-05-08T18:43:00Z", "path": "firebase-installations/src/main/java/com/google/firebase/installations/remote/FirebaseInstallationServiceClient.java", "diffHunk": "@@ -165,7 +165,8 @@ public InstallationResponse createFirebaseInstallation(\n           return readCreateResponse(httpURLConnection);\n         }\n \n-        logFisCommunicationError(httpURLConnection);\n+        logFisCommunicationError(\n+            httpURLConnection, availableFirebaseOptions(appId, apiKey, projectID));", "originalCommit": "9ae13d54632e945d586768ce49ee6842adfdb107", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjMwNzk0Ng==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1537#discussion_r422307946", "bodyText": "I recommend calling #availableFirebaseOptions here.", "author": "andirayo", "createdAt": "2020-05-08T18:43:18Z", "path": "firebase-installations/src/main/java/com/google/firebase/installations/remote/FirebaseInstallationServiceClient.java", "diffHunk": "@@ -522,13 +525,21 @@ static long parseTokenExpirationTimestamp(String expiresIn) {\n         : Long.parseLong(expiresIn.substring(0, expiresIn.length() - 1));\n   }\n \n-  private static void logFisCommunicationError(HttpURLConnection conn) {\n+  private static void logFisCommunicationError(HttpURLConnection conn, String firebaseOptions) {\n     String logString = readErrorResponse(conn);\n     if (!TextUtils.isEmpty(logString)) {\n       Log.w(FIS_TAG, logString);\n+      Log.w(FIS_TAG, firebaseOptions);", "originalCommit": "9ae13d54632e945d586768ce49ee6842adfdb107", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6b2f634aaacb8660166dffe32da49d7033ca77fa", "url": "https://github.com/firebase/firebase-android-sdk/commit/6b2f634aaacb8660166dffe32da49d7033ca77fa", "message": "Addressing Rayo's comments.", "committedDate": "2020-05-08T19:04:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjMyNDUxNw==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1537#discussion_r422324517", "bodyText": "It's not that I feel strongly about it, but this is not really necessary.\nHow about this compromise:\nreturn String.format(\n        \"Firebase options used while communicating with Firebase server APIs: %s, %s%s\",\n        apiKey, projectId, TextUtils.isEmpty(appId) ? \"\" : \", \" + appId);", "author": "andirayo", "createdAt": "2020-05-08T19:17:18Z", "path": "firebase-installations/src/main/java/com/google/firebase/installations/remote/FirebaseInstallationServiceClient.java", "diffHunk": "@@ -522,13 +522,25 @@ static long parseTokenExpirationTimestamp(String expiresIn) {\n         : Long.parseLong(expiresIn.substring(0, expiresIn.length() - 1));\n   }\n \n-  private static void logFisCommunicationError(HttpURLConnection conn) {\n+  private static void logFisCommunicationError(\n+      HttpURLConnection conn,\n+      @Nullable String appId,\n+      @NonNull String apiKey,\n+      @NonNull String projectId) {\n     String logString = readErrorResponse(conn);\n     if (!TextUtils.isEmpty(logString)) {\n       Log.w(FIS_TAG, logString);\n+      Log.w(FIS_TAG, availableFirebaseOptions(appId, apiKey, projectId));\n     }\n   }\n \n+  private static String availableFirebaseOptions(\n+      @Nullable String appId, @NonNull String apiKey, @NonNull String projectId) {\n+    return String.format(\n+        \"Firebase options used while communicating with Firebase server APIs: %s, %s, %s\",\n+        apiKey, projectId, TextUtils.isEmpty(appId) ? \"\" : appId);", "originalCommit": "6b2f634aaacb8660166dffe32da49d7033ca77fa", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "22b7350b01c3203bb04306f155c2ce7355016749", "url": "https://github.com/firebase/firebase-android-sdk/commit/22b7350b01c3203bb04306f155c2ce7355016749", "message": "Fix string format.", "committedDate": "2020-05-08T21:51:14Z", "type": "commit"}]}