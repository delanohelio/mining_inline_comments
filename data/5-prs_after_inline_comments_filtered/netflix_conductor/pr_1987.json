{"pr_number": 1987, "pr_title": "Fix bug in the event polling with Rx Executor scheduler", "pr_createdAt": "2020-11-29T01:55:54Z", "pr_url": "https://github.com/Netflix/conductor/pull/1987", "timeline": [{"oid": "9f41e2145cbbf472a3f213ad17d513df20db092b", "url": "https://github.com/Netflix/conductor/commit/9f41e2145cbbf472a3f213ad17d513df20db092b", "message": "Fix bug in the event polling with Rx Executor scheduler", "committedDate": "2020-11-05T00:10:51Z", "type": "commit"}, {"oid": "c13cdc9da46084ec32e477005557422144d73141", "url": "https://github.com/Netflix/conductor/commit/c13cdc9da46084ec32e477005557422144d73141", "message": "Fix bug in the event polling with Rx Executor scheduler", "committedDate": "2020-11-30T02:40:15Z", "type": "commit"}, {"oid": "d7c56354eeda8f128601cf6cceb90ee01bcc204a", "url": "https://github.com/Netflix/conductor/commit/d7c56354eeda8f128601cf6cceb90ee01bcc204a", "message": "Merge remote-tracking branch 'origin/event-poll-scheduler-fix' into event-poll-scheduler-fix\n\n# Conflicts:\n#\tcore/src/main/java/com/netflix/conductor/core/config/Configuration.java", "committedDate": "2020-11-30T03:42:13Z", "type": "commit"}, {"oid": "7eb149f0317a36cc2260754009405fc751625d8b", "url": "https://github.com/Netflix/conductor/commit/7eb149f0317a36cc2260754009405fc751625d8b", "message": "Fix unit test", "committedDate": "2020-11-30T03:43:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjk5OTkwMQ==", "url": "https://github.com/Netflix/conductor/pull/1987#discussion_r532999901", "bodyText": "@mdepak Based on the documentation here, http://reactivex.io/RxJava/javadoc/rx/schedulers/Schedulers.html#computation--\n\nDo not perform IO-bound work on this scheduler. Use io() instead.\n\nand the fact that IO needs to be performed as seen here\nDoes it make sense to use io() instead here?", "author": "aravindanr", "createdAt": "2020-12-01T00:49:16Z", "path": "core/src/main/java/com/netflix/conductor/core/events/queue/EventPollSchedulerProvider.java", "diffHunk": "@@ -37,11 +37,14 @@ public EventPollSchedulerProvider(Configuration configuration) {\n \n     @Override\n     public Scheduler get() {\n-        ThreadFactory threadFactory = new ThreadFactoryBuilder()\n-                .setNameFormat(\"event-queue-poll-scheduler-thread-%d\")\n-                .build();\n-        Executor executorService = Executors.newFixedThreadPool(configuration.getEventSchedulerPollThreadCount(), threadFactory);\n-\n-        return Schedulers.from(executorService);\n+        if (configuration.getEventSchedulerPollThreadCount() != null) {\n+            ThreadFactory threadFactory = new ThreadFactoryBuilder()\n+                    .setNameFormat(\"event-queue-poll-scheduler-thread-%d\")\n+                    .build();\n+            Executor executorService = Executors.newFixedThreadPool(configuration.getEventSchedulerPollThreadCount(), threadFactory);\n+            return Schedulers.from(executorService);\n+        } else {\n+            return Schedulers.computation();", "originalCommit": "7eb149f0317a36cc2260754009405fc751625d8b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzczNDk5MA==", "url": "https://github.com/Netflix/conductor/pull/1987#discussion_r533734990", "bodyText": "@aravindanr  io() is a good candidate but the potential problem with this is it can grow the thread pool exponentially in case the IO wait is taking too long because of a problem with the Queue system and could cause OOM. RxJava 2.x doc has a more detailed explanation regarding the same http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/schedulers/Schedulers.html#io--\nThe objective of this fix is to ensure that the event processing functionality works as expected by default without tuning up the thread pool size. Meanwhile, I plan to debug why Executor scheduler is not working as expected, and its behavior in the later versions of RxJava. Please let me know your feedback.", "author": "mdepak", "createdAt": "2020-12-01T21:32:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjk5OTkwMQ=="}], "type": "inlineReview"}, {"oid": "86827ef56072abc8a07ca5183b8119e43e53a5a0", "url": "https://github.com/Netflix/conductor/commit/86827ef56072abc8a07ca5183b8119e43e53a5a0", "message": "Merge remote-tracking branch 'upstream/2.31' into event-poll-scheduler-fix\n\n# Conflicts:\n#\tcore/src/main/java/com/netflix/conductor/core/config/Configuration.java", "committedDate": "2021-05-25T01:29:56Z", "type": "commit"}, {"oid": "deb5ff9e1ee3fff68da2d1369b3a4c069d3eecb6", "url": "https://github.com/Netflix/conductor/commit/deb5ff9e1ee3fff68da2d1369b3a4c069d3eecb6", "message": "Merge remote-tracking branch 'upstream/2.31' into event-poll-scheduler-fix\n\n# Conflicts:\n#\tcore/src/main/java/com/netflix/conductor/core/config/Configuration.java", "committedDate": "2021-05-25T01:32:58Z", "type": "commit"}, {"oid": "798839964c022d973b9a7ad09f86d3bb842afcba", "url": "https://github.com/Netflix/conductor/commit/798839964c022d973b9a7ad09f86d3bb842afcba", "message": "Fix compilation error in unit test", "committedDate": "2021-06-07T06:03:49Z", "type": "commit"}, {"oid": "b9ebb035d2b0bf3f216ac81baf38904f8a7c12a3", "url": "https://github.com/Netflix/conductor/commit/b9ebb035d2b0bf3f216ac81baf38904f8a7c12a3", "message": "Merge branch 'event-poll-scheduler-fix' of https://github.com/mdepak/conductor into event-poll-scheduler-fix", "committedDate": "2021-06-07T06:04:00Z", "type": "commit"}]}