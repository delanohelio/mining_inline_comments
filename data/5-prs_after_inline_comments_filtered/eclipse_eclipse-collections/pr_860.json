{"pr_number": 860, "pr_title": "Added flatCollect support primitive collections #794", "pr_createdAt": "2020-04-13T15:41:52Z", "pr_url": "https://github.com/eclipse/eclipse-collections/pull/860", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjIxNDM2NA==", "url": "https://github.com/eclipse/eclipse-collections/pull/860#discussion_r426214364", "bodyText": "This is a minor formatting inconsistency. All of the other instances have target on the same line as function.", "author": "donraab", "createdAt": "2020-05-17T03:56:04Z", "path": "eclipse-collections/src/main/java/org/eclipse/collections/impl/UnmodifiableRichIterable.java", "diffHunk": "@@ -370,6 +405,14 @@ public IntIterable collectInt(IntFunction<? super T> intFunction)\n         return this.iterable.collectInt(intFunction, target);\n     }\n \n+    @Override\n+    public <R extends MutableIntCollection> R flatCollectInt(\n+            Function<? super T, ? extends IntIterable> function,\n+            R target)", "originalCommit": "c1e679946c490ad27565c913b00c7277200a4141", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjIxNDQxNg==", "url": "https://github.com/eclipse/eclipse-collections/pull/860#discussion_r426214416", "bodyText": "Is the cast really necessary here?", "author": "donraab", "createdAt": "2020-05-17T03:57:26Z", "path": "eclipse-collections/src/main/java/org/eclipse/collections/impl/bag/AbstractBag.java", "diffHunk": "@@ -335,6 +351,31 @@ public int count(Predicate<? super T> predicate)\n         return target;\n     }\n \n+    @Override\n+    public <R extends MutableBooleanCollection> R flatCollectBoolean(\n+            Function<? super T, ? extends BooleanIterable> function, R target)\n+    {\n+        if (target instanceof MutableBooleanBag)\n+        {\n+            MutableBooleanBag targetBag = (MutableBooleanBag) target;\n+            this.forEachWithOccurrences((each, occurrences) -> {\n+                BooleanIterable values = function.valueOf(each);\n+                values.forEach((BooleanProcedure) value -> targetBag.addOccurrences(value, occurrences));", "originalCommit": "c1e679946c490ad27565c913b00c7277200a4141", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjIxNDQ1OA==", "url": "https://github.com/eclipse/eclipse-collections/pull/860#discussion_r426214458", "bodyText": "Is the cast necessary here?", "author": "donraab", "createdAt": "2020-05-17T03:57:50Z", "path": "eclipse-collections/src/main/java/org/eclipse/collections/impl/bag/AbstractBag.java", "diffHunk": "@@ -335,6 +351,31 @@ public int count(Predicate<? super T> predicate)\n         return target;\n     }\n \n+    @Override\n+    public <R extends MutableBooleanCollection> R flatCollectBoolean(\n+            Function<? super T, ? extends BooleanIterable> function, R target)\n+    {\n+        if (target instanceof MutableBooleanBag)\n+        {\n+            MutableBooleanBag targetBag = (MutableBooleanBag) target;\n+            this.forEachWithOccurrences((each, occurrences) -> {\n+                BooleanIterable values = function.valueOf(each);\n+                values.forEach((BooleanProcedure) value -> targetBag.addOccurrences(value, occurrences));\n+            });\n+        }\n+        else\n+        {\n+            this.forEachWithOccurrences((each, occurrences) -> {\n+                BooleanIterable value = function.valueOf(each);\n+                for (int i = 0; i < occurrences; i++)\n+                {\n+                    value.forEach((BooleanProcedure) target::add);\n+                }", "originalCommit": "c1e679946c490ad27565c913b00c7277200a4141", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjIxNDg0Mg==", "url": "https://github.com/eclipse/eclipse-collections/pull/860#discussion_r426214842", "bodyText": "Minor formatting inconsistency.", "author": "donraab", "createdAt": "2020-05-17T04:05:57Z", "path": "eclipse-collections/src/main/java/org/eclipse/collections/impl/collection/AbstractSynchronizedRichIterable.java", "diffHunk": "@@ -423,6 +473,17 @@ public BooleanIterable collectBoolean(BooleanFunction<? super T> booleanFunction\n         }\n     }\n \n+    @Override\n+    public <R extends MutableIntCollection> R flatCollectInt(\n+            Function<? super T, ? extends IntIterable> function,\n+            R target)", "originalCommit": "c1e679946c490ad27565c913b00c7277200a4141", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjIxNTQzNw==", "url": "https://github.com/eclipse/eclipse-collections/pull/860#discussion_r426215437", "bodyText": "Is the cast necessary?", "author": "donraab", "createdAt": "2020-05-17T04:17:42Z", "path": "unit-tests-java8/src/test/java/org/eclipse/collections/test/RichIterableTestCase.java", "diffHunk": "@@ -381,6 +400,137 @@ default void RichIterable_containsAllIterable()\n         assertTrue(iterable0.containsAllIterable(Lists.immutable.empty()));\n     }\n \n+    @Test\n+    default void RichIterable_flatCollectBoolean()\n+    {\n+        RichIterable<BooleanBooleanPair> iterable = this.newWith(\n+                PrimitiveTuples.pair(true, false),\n+                PrimitiveTuples.pair(false, true));\n+\n+        BooleanArrayList target = new BooleanArrayList();\n+        iterable.flatCollectBoolean((Function<BooleanBooleanPair, BooleanIterable>) each -> BooleanArrayList.newListWith(", "originalCommit": "c1e679946c490ad27565c913b00c7277200a4141", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjIxNTQ4Ng==", "url": "https://github.com/eclipse/eclipse-collections/pull/860#discussion_r426215486", "bodyText": "Use a bag instead so order doesn't matter.", "author": "donraab", "createdAt": "2020-05-17T04:18:59Z", "path": "unit-tests-java8/src/test/java/org/eclipse/collections/test/RichIterableTestCase.java", "diffHunk": "@@ -381,6 +400,137 @@ default void RichIterable_containsAllIterable()\n         assertTrue(iterable0.containsAllIterable(Lists.immutable.empty()));\n     }\n \n+    @Test\n+    default void RichIterable_flatCollectBoolean()\n+    {\n+        RichIterable<BooleanBooleanPair> iterable = this.newWith(\n+                PrimitiveTuples.pair(true, false),\n+                PrimitiveTuples.pair(false, true));\n+\n+        BooleanArrayList target = new BooleanArrayList();\n+        iterable.flatCollectBoolean((Function<BooleanBooleanPair, BooleanIterable>) each -> BooleanArrayList.newListWith(\n+                each.getOne(),\n+                each.getTwo()), target);\n+\n+        assertSize(4, target);\n+        assertTrue(target.containsAll(true, false, false, true));\n+    }\n+\n+    @Test\n+    default void RichIterable_flatCollectByte()\n+    {\n+        RichIterable<ByteBytePair> iterable =\n+                this.newWith(\n+                        PrimitiveTuples.pair((byte) 1, (byte) 2),\n+                        PrimitiveTuples.pair((byte) 3, (byte) 4));\n+\n+        ByteArrayList target = new ByteArrayList();", "originalCommit": "c1e679946c490ad27565c913b00c7277200a4141", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjIxNTY0OQ==", "url": "https://github.com/eclipse/eclipse-collections/pull/860#discussion_r426215649", "bodyText": "Use an equality test with the target bag, which will cover size and containsAll.", "author": "donraab", "createdAt": "2020-05-17T04:22:16Z", "path": "unit-tests-java8/src/test/java/org/eclipse/collections/test/RichIterableTestCase.java", "diffHunk": "@@ -381,6 +400,137 @@ default void RichIterable_containsAllIterable()\n         assertTrue(iterable0.containsAllIterable(Lists.immutable.empty()));\n     }\n \n+    @Test\n+    default void RichIterable_flatCollectBoolean()\n+    {\n+        RichIterable<BooleanBooleanPair> iterable = this.newWith(\n+                PrimitiveTuples.pair(true, false),\n+                PrimitiveTuples.pair(false, true));\n+\n+        BooleanArrayList target = new BooleanArrayList();\n+        iterable.flatCollectBoolean((Function<BooleanBooleanPair, BooleanIterable>) each -> BooleanArrayList.newListWith(\n+                each.getOne(),\n+                each.getTwo()), target);\n+\n+        assertSize(4, target);\n+        assertTrue(target.containsAll(true, false, false, true));\n+    }\n+\n+    @Test\n+    default void RichIterable_flatCollectByte()\n+    {\n+        RichIterable<ByteBytePair> iterable =\n+                this.newWith(\n+                        PrimitiveTuples.pair((byte) 1, (byte) 2),\n+                        PrimitiveTuples.pair((byte) 3, (byte) 4));\n+\n+        ByteArrayList target = new ByteArrayList();\n+        iterable.flatCollectByte((Function<ByteBytePair, ByteIterable>) each -> ByteArrayList.newListWith(\n+                each.getOne(),\n+                each.getTwo()), target);\n+\n+        assertSize(4, target);", "originalCommit": "c1e679946c490ad27565c913b00c7277200a4141", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjIxNTcxOA==", "url": "https://github.com/eclipse/eclipse-collections/pull/860#discussion_r426215718", "bodyText": "Use a bag for the target so order doesn't matter.", "author": "donraab", "createdAt": "2020-05-17T04:23:13Z", "path": "unit-tests-java8/src/test/java/org/eclipse/collections/test/bag/BagTestCase.java", "diffHunk": "@@ -42,6 +69,141 @@\n         return forEach;\n     }\n \n+    @Override\n+    default void RichIterable_flatCollectInt()\n+    {\n+        Bag<Integer> bag = this.newWith(3, 3, 3, 2, 2, 1);\n+        IntArrayList target = new IntArrayList();", "originalCommit": "c1e679946c490ad27565c913b00c7277200a4141", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjIxNTczNA==", "url": "https://github.com/eclipse/eclipse-collections/pull/860#discussion_r426215734", "bodyText": "Use an equality test with the target which covers size and containsAll.", "author": "donraab", "createdAt": "2020-05-17T04:23:45Z", "path": "unit-tests-java8/src/test/java/org/eclipse/collections/test/bag/BagTestCase.java", "diffHunk": "@@ -42,6 +69,141 @@\n         return forEach;\n     }\n \n+    @Override\n+    default void RichIterable_flatCollectInt()\n+    {\n+        Bag<Integer> bag = this.newWith(3, 3, 3, 2, 2, 1);\n+        IntArrayList target = new IntArrayList();\n+        bag.flatCollectInt((Function<Integer, IntIterable>) IntArrayList::newListWith, target);\n+        Verify.assertSize(6, target);", "originalCommit": "c1e679946c490ad27565c913b00c7277200a4141", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjIxNTgwOQ==", "url": "https://github.com/eclipse/eclipse-collections/pull/860#discussion_r426215809", "bodyText": "Why is this using an anonymous inner class?", "author": "donraab", "createdAt": "2020-05-17T04:25:11Z", "path": "unit-tests-java8/src/test/java/org/eclipse/collections/test/stack/StackIterableTestCase.java", "diffHunk": "@@ -60,6 +89,143 @@ default void InternalIterable_forEach()\n         assertEquals(this.newWith(1, 2, 2, 3, 3, 3), result);\n     }\n \n+    @Override\n+    default void RichIterable_flatCollectBoolean()\n+    {\n+        RichIterable<Twin<Boolean>> booleans = this.newWith(Tuples.twin(true, true), Tuples.twin(false, false));\n+        BooleanArrayList target = new BooleanArrayList();\n+        booleans.flatCollectBoolean(new Function<Twin<Boolean>, BooleanIterable>()", "originalCommit": "c1e679946c490ad27565c913b00c7277200a4141", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjIxNTgxOA==", "url": "https://github.com/eclipse/eclipse-collections/pull/860#discussion_r426215818", "bodyText": "Use a bag as a target so order doesn't matter.", "author": "donraab", "createdAt": "2020-05-17T04:25:27Z", "path": "unit-tests-java8/src/test/java/org/eclipse/collections/test/stack/StackIterableTestCase.java", "diffHunk": "@@ -60,6 +89,143 @@ default void InternalIterable_forEach()\n         assertEquals(this.newWith(1, 2, 2, 3, 3, 3), result);\n     }\n \n+    @Override\n+    default void RichIterable_flatCollectBoolean()\n+    {\n+        RichIterable<Twin<Boolean>> booleans = this.newWith(Tuples.twin(true, true), Tuples.twin(false, false));\n+        BooleanArrayList target = new BooleanArrayList();", "originalCommit": "c1e679946c490ad27565c913b00c7277200a4141", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjIxNTg0OQ==", "url": "https://github.com/eclipse/eclipse-collections/pull/860#discussion_r426215849", "bodyText": "Use an equality test with the target which covers size and containsAll.", "author": "donraab", "createdAt": "2020-05-17T04:25:50Z", "path": "unit-tests-java8/src/test/java/org/eclipse/collections/test/stack/StackIterableTestCase.java", "diffHunk": "@@ -60,6 +89,143 @@ default void InternalIterable_forEach()\n         assertEquals(this.newWith(1, 2, 2, 3, 3, 3), result);\n     }\n \n+    @Override\n+    default void RichIterable_flatCollectBoolean()\n+    {\n+        RichIterable<Twin<Boolean>> booleans = this.newWith(Tuples.twin(true, true), Tuples.twin(false, false));\n+        BooleanArrayList target = new BooleanArrayList();\n+        booleans.flatCollectBoolean(new Function<Twin<Boolean>, BooleanIterable>()\n+        {\n+            @Override\n+            public BooleanIterable valueOf(Twin<Boolean> each)\n+            {\n+                return BooleanArrayList.newListWith(each.getOne(), each.getTwo());\n+            }\n+        }, target);\n+        assertSize(4, target);", "originalCommit": "c1e679946c490ad27565c913b00c7277200a4141", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjI4OTgyNQ==", "url": "https://github.com/eclipse/eclipse-collections/pull/860#discussion_r426289825", "bodyText": "Same pattern here as well with \"target\" and \"result\".", "author": "prathasirisha", "createdAt": "2020-05-17T18:21:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjIxNTg0OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjI4Nzk4Nw==", "url": "https://github.com/eclipse/eclipse-collections/pull/860#discussion_r426287987", "bodyText": "Please use \"actual\" and \"expected\" to be consistent with the rest of the class.\nSame comment for the rest of this class.", "author": "prathasirisha", "createdAt": "2020-05-17T17:59:57Z", "path": "unit-tests-java8/src/test/java/org/eclipse/collections/test/bag/BagTestCase.java", "diffHunk": "@@ -42,6 +69,141 @@\n         return forEach;\n     }\n \n+    @Override\n+    default void RichIterable_flatCollectInt()\n+    {\n+        Bag<Integer> bag = this.newWith(3, 3, 3, 2, 2, 1);\n+        IntArrayList target = new IntArrayList();", "originalCommit": "c1e679946c490ad27565c913b00c7277200a4141", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjI4OTU4Ng==", "url": "https://github.com/eclipse/eclipse-collections/pull/860#discussion_r426289586", "bodyText": "It seems like \"target\" is the equivalent of \"expected\" in this class (see example method: RichIterable_select_reject). But the usage in here makes me believe that \"target\" is \"actual\".\nIn short,  you would want this to be \"result\" and not \"target\" to be consistent with the rest of the class.\n\"result\" -> \"actual\"\n\"target\" -> \"expected\"\ne.g. assertEquals( expected, actual)", "author": "prathasirisha", "createdAt": "2020-05-17T18:18:20Z", "path": "unit-tests-java8/src/test/java/org/eclipse/collections/test/RichIterableTestCase.java", "diffHunk": "@@ -381,6 +400,137 @@ default void RichIterable_containsAllIterable()\n         assertTrue(iterable0.containsAllIterable(Lists.immutable.empty()));\n     }\n \n+    @Test\n+    default void RichIterable_flatCollectBoolean()\n+    {\n+        RichIterable<BooleanBooleanPair> iterable = this.newWith(\n+                PrimitiveTuples.pair(true, false),\n+                PrimitiveTuples.pair(false, true));\n+\n+        BooleanArrayList target = new BooleanArrayList();\n+        iterable.flatCollectBoolean((Function<BooleanBooleanPair, BooleanIterable>) each -> BooleanArrayList.newListWith(\n+                each.getOne(),\n+                each.getTwo()), target);\n+\n+        assertSize(4, target);", "originalCommit": "c1e679946c490ad27565c913b00c7277200a4141", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjI4OTYzMg==", "url": "https://github.com/eclipse/eclipse-collections/pull/860#discussion_r426289632", "bodyText": "same comment as above and in the rest of this class.", "author": "prathasirisha", "createdAt": "2020-05-17T18:19:01Z", "path": "unit-tests-java8/src/test/java/org/eclipse/collections/test/RichIterableTestCase.java", "diffHunk": "@@ -381,6 +400,137 @@ default void RichIterable_containsAllIterable()\n         assertTrue(iterable0.containsAllIterable(Lists.immutable.empty()));\n     }\n \n+    @Test\n+    default void RichIterable_flatCollectBoolean()\n+    {\n+        RichIterable<BooleanBooleanPair> iterable = this.newWith(\n+                PrimitiveTuples.pair(true, false),\n+                PrimitiveTuples.pair(false, true));\n+\n+        BooleanArrayList target = new BooleanArrayList();\n+        iterable.flatCollectBoolean((Function<BooleanBooleanPair, BooleanIterable>) each -> BooleanArrayList.newListWith(\n+                each.getOne(),\n+                each.getTwo()), target);\n+\n+        assertSize(4, target);\n+        assertTrue(target.containsAll(true, false, false, true));\n+    }\n+\n+    @Test\n+    default void RichIterable_flatCollectByte()\n+    {\n+        RichIterable<ByteBytePair> iterable =\n+                this.newWith(\n+                        PrimitiveTuples.pair((byte) 1, (byte) 2),\n+                        PrimitiveTuples.pair((byte) 3, (byte) 4));\n+\n+        ByteArrayList target = new ByteArrayList();\n+        iterable.flatCollectByte((Function<ByteBytePair, ByteIterable>) each -> ByteArrayList.newListWith(\n+                each.getOne(),\n+                each.getTwo()), target);\n+\n+        assertSize(4, target);\n+        assertTrue(target.containsAll((byte) 1, (byte) 2, (byte) 3, (byte) 4));\n+    }\n+\n+    @Test\n+    default void RichIterable_flatCollectShort()\n+    {\n+        RichIterable<ShortShortPair> iterable =\n+                this.newWith(\n+                        PrimitiveTuples.pair((short) 1, (short) 2),\n+                        PrimitiveTuples.pair((short) 3, (short) 4));\n+\n+        ShortArrayList target = new ShortArrayList();\n+        iterable.flatCollectShort((Function<ShortShortPair, ShortIterable>) each -> ShortArrayList.newListWith(each.getOne(), each.getTwo()), target);\n+        assertSize(4, target);\n+        assertTrue(target.containsAll((short) 1, (short) 2, (short) 3, (short) 4));\n+    }\n+\n+    @Test\n+    default void RichIterable_flatCollectInt()\n+    {\n+        RichIterable<IntIntPair> iterable =\n+                this.newWith(\n+                        PrimitiveTuples.pair(1, 2),\n+                        PrimitiveTuples.pair(3, 4));\n+\n+        IntArrayList target = new IntArrayList();\n+        iterable.flatCollectInt((Function<IntIntPair, IntIterable>) each -> IntArrayList.newListWith(\n+                each.getOne(),\n+                each.getTwo()), target);\n+\n+        assertSize(4, target);", "originalCommit": "c1e679946c490ad27565c913b00c7277200a4141", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "b35556ebc596fd61536fbab26576c1b2d033c921", "url": "https://github.com/eclipse/eclipse-collections/commit/b35556ebc596fd61536fbab26576c1b2d033c921", "message": "Added flatCollect support primitive collections #794\n\nSigned-off-by: Alxander Goldberg <alexander.goldberg@bnymellon.com>", "committedDate": "2020-05-27T15:20:06Z", "type": "commit"}]}