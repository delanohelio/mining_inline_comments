{"pr_number": 865, "pr_title": "Pull up implementations of aggregateBy() as default methods.", "pr_createdAt": "2020-04-14T20:54:52Z", "pr_url": "https://github.com/eclipse/eclipse-collections/pull/865", "timeline": [{"oid": "a9ac39985554eb3284eb573b6fc134d9c52c57f4", "url": "https://github.com/eclipse/eclipse-collections/commit/a9ac39985554eb3284eb573b6fc134d9c52c57f4", "message": "Pull up implementations of aggregateBy() as default methods.\n\nSigned-off-by: Craig P. Motlin <cmotlin@gmail.com>", "committedDate": "2020-04-14T22:08:36Z", "type": "forcePushed"}, {"oid": "f1d761eedde80ec830d31aa3c0926622c51ef4cc", "url": "https://github.com/eclipse/eclipse-collections/commit/f1d761eedde80ec830d31aa3c0926622c51ef4cc", "message": "Pull up implementations of aggregateBy() as default methods.\n\nSigned-off-by: Craig P. Motlin <cmotlin@gmail.com>", "committedDate": "2020-04-29T17:23:53Z", "type": "forcePushed"}, {"oid": "83a8afb5eaa53fdfb0c7b7d82bec5e2937a7b3a6", "url": "https://github.com/eclipse/eclipse-collections/commit/83a8afb5eaa53fdfb0c7b7d82bec5e2937a7b3a6", "message": "Pull up implementations of aggregateBy() as default methods.\n\nSigned-off-by: Craig P. Motlin <cmotlin@gmail.com>", "committedDate": "2020-04-30T04:15:11Z", "type": "forcePushed"}, {"oid": "76da56fba9c0f104f489fd2c1cc326b3103db450", "url": "https://github.com/eclipse/eclipse-collections/commit/76da56fba9c0f104f489fd2c1cc326b3103db450", "message": "Pull up implementations of aggregateBy() as default methods.\n\nSigned-off-by: Craig P. Motlin <cmotlin@gmail.com>", "committedDate": "2020-05-02T03:03:26Z", "type": "forcePushed"}, {"oid": "7a65de54a3aa134d939b413664c81a02adfcd335", "url": "https://github.com/eclipse/eclipse-collections/commit/7a65de54a3aa134d939b413664c81a02adfcd335", "message": "Pull up implementations of aggregateBy() as default methods.\n\nSigned-off-by: Craig P. Motlin <cmotlin@gmail.com>", "committedDate": "2020-05-02T15:13:57Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTAzMTI1MQ==", "url": "https://github.com/eclipse/eclipse-collections/pull/865#discussion_r419031251", "bodyText": "Similar to the other pull request that was pulling up default methods, I would prefer to remove only purely structural code.", "author": "donraab", "createdAt": "2020-05-03T01:28:03Z", "path": "eclipse-collections/src/main/java/org/eclipse/collections/impl/bimap/mutable/AbstractMutableBiMap.java", "diffHunk": "@@ -657,18 +655,6 @@ public void forEachValue(Procedure<? super V> procedure)\n         return new HashBiMap<>(this.delegate.groupByUniqueKey(function));\n     }\n \n-    @Override", "originalCommit": "7a65de54a3aa134d939b413664c81a02adfcd335", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTAzMTM5Mg==", "url": "https://github.com/eclipse/eclipse-collections/pull/865#discussion_r419031392", "bodyText": "Similar to the comment above. This is the more standard pattern for implementing unmodifiable behavior.", "author": "donraab", "createdAt": "2020-05-03T01:29:38Z", "path": "eclipse-collections/src/main/java/org/eclipse/collections/impl/map/mutable/UnmodifiableMutableMap.java", "diffHunk": "@@ -1148,22 +1148,4 @@ public MutableShortBag collectShort(ShortFunction<? super V> shortFunction)\n     {\n         return this.getMutableMap().zipWithIndex();\n     }\n-", "originalCommit": "7a65de54a3aa134d939b413664c81a02adfcd335", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTE4NTU1MA==", "url": "https://github.com/eclipse/eclipse-collections/pull/865#discussion_r419185550", "bodyText": "Catching up on your other comments, I take the point about it being more difficult to perform the code review when I remove methods, and it requires reasoning about whether that's ok. I have to point out that this is not that much of a standard pattern for implementing unmodifiable behavior. I just tried going into UnmodifiableMutableMap and pressing Cmd+I (to implement, not override) and I see many methods implemented that are otherwise not implemented using this pattern.\n\nflatCollectWith\nflatCollectWith (target)\ncountBy\ncountBy(target)\ncountByWith\ncountByWith(target)\ncountByEach\ncountByEach(target)\nforEach(Procedure)\nforEach(Consumer)\ngetAny\nminOptional()\nmaxOptional()\nminOptional(Comparator)\nmaxOptional(Comparator)\nminByOptional\nmaxByOptional\nsummarizeInt\nsummarizeFloat\nsummarizeLong\nsummarizeDouble\nreduceInPlace(Collector)\nreduceInPlace(Supplier, BiConsumer)\nreduce\ngroupByAndCollect", "author": "motlin", "createdAt": "2020-05-04T01:24:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTAzMTM5Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTE4NzEwNQ==", "url": "https://github.com/eclipse/eclipse-collections/pull/865#discussion_r419187105", "bodyText": "Looking at this list of methods, most of them were probably added as default methods, which we started doing after the 8.0 release. I saw a few since 9.0 and 10.0 marks in the JavaDoc. It's an interesting question whether their behavior should be overridden in UnmodifiableMutableMap. If you pull this method up, then you should probably pull all of the API's up. If we agree this makes sense, I would rather this be done as a separate PR for UnmodifiableMutableMap.\nAll of these older methods are implemented directly in UnmodifiableMutableMap, just as aggregateBy is today.\n    public <R> MutableBagMultimap<R, V> groupBy(Function<? super V, ? extends R> function)\n    public <R, C extends MutableMultimap<R, V>> C groupBy(Function<? super V, ? extends R> function, C target)\n    public <R> MutableBagMultimap<R, V> groupByEach(Function<? super V, ? extends Iterable<R>> function)\n    public <R, C extends MutableMultimap<R, V>> C groupByEach(Function<? super V, ? extends Iterable<R>> function, C target)\n    public <VV> MutableMap<VV, V> groupByUniqueKey(Function<? super V, ? extends VV> function)\n    public <VV, R extends MutableMapIterable<VV, V>> R groupByUniqueKey(Function<? super V, ? extends VV> function, R target)", "author": "donraab", "createdAt": "2020-05-04T01:38:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTAzMTM5Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTE4ODQ4Mg==", "url": "https://github.com/eclipse/eclipse-collections/pull/865#discussion_r419188482", "bodyText": "Yes, I plan on pulling all those up and more. I started with a few \"easy\" methods to see how it goes.", "author": "motlin", "createdAt": "2020-05-04T01:51:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTAzMTM5Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTE4OTUwNQ==", "url": "https://github.com/eclipse/eclipse-collections/pull/865#discussion_r419189505", "bodyText": "Ok, I think I can get comfortable with the unmodifiable moves here.", "author": "donraab", "createdAt": "2020-05-04T01:59:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTAzMTM5Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTAzMTQzMQ==", "url": "https://github.com/eclipse/eclipse-collections/pull/865#discussion_r419031431", "bodyText": "Same as the other unmodifiable comment above.", "author": "donraab", "createdAt": "2020-05-03T01:30:12Z", "path": "eclipse-collections/src/main/java/org/eclipse/collections/impl/stack/mutable/UnmodifiableStack.java", "diffHunk": "@@ -951,24 +951,6 @@ public int hashCode()\n         return this.mutableStack.hashCode();\n     }\n \n-    @Override", "originalCommit": "7a65de54a3aa134d939b413664c81a02adfcd335", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "850a3cf86c7116e053c2cf91811caca08d78754b", "url": "https://github.com/eclipse/eclipse-collections/commit/850a3cf86c7116e053c2cf91811caca08d78754b", "message": "Pull up implementations of aggregateBy() as default methods.\n\nSigned-off-by: Craig P. Motlin <cmotlin@gmail.com>", "committedDate": "2020-05-04T02:13:56Z", "type": "forcePushed"}, {"oid": "d2817e2338eb7cad5514b33f0f97043ce77ad7ed", "url": "https://github.com/eclipse/eclipse-collections/commit/d2817e2338eb7cad5514b33f0f97043ce77ad7ed", "message": "Pull up implementations of aggregateBy() as default methods.\n\nSigned-off-by: Craig P. Motlin <cmotlin@gmail.com>", "committedDate": "2020-05-04T03:05:10Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTIwMDI2OQ==", "url": "https://github.com/eclipse/eclipse-collections/pull/865#discussion_r419200269", "bodyText": "I think this might be able to be deleted as it inherits from MutableMapIterable which has the same implementation.", "author": "donraab", "createdAt": "2020-05-04T03:24:05Z", "path": "eclipse-collections-api/src/main/java/org/eclipse/collections/api/map/MutableMap.java", "diffHunk": "@@ -184,16 +184,35 @@\n     }\n \n     @Override\n-    <K2, V2> MutableMap<K2, V2> aggregateInPlaceBy(\n-            Function<? super V, ? extends K2> groupBy,", "originalCommit": "d2817e2338eb7cad5514b33f0f97043ce77ad7ed", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTIwMDMxNQ==", "url": "https://github.com/eclipse/eclipse-collections/pull/865#discussion_r419200315", "bodyText": "Same as above.", "author": "donraab", "createdAt": "2020-05-04T03:24:19Z", "path": "eclipse-collections-api/src/main/java/org/eclipse/collections/api/map/MutableMap.java", "diffHunk": "@@ -184,16 +184,35 @@\n     }\n \n     @Override\n-    <K2, V2> MutableMap<K2, V2> aggregateInPlaceBy(\n-            Function<? super V, ? extends K2> groupBy,\n-            Function0<? extends V2> zeroValueFactory,\n-            Procedure2<? super V2, ? super V> mutatingAggregator);\n+    default <KK, VV> MutableMap<KK, VV> aggregateInPlaceBy(\n+            Function<? super V, ? extends KK> groupBy,\n+            Function0<? extends VV> zeroValueFactory,\n+            Procedure2<? super VV, ? super V> mutatingAggregator)\n+    {\n+        MutableMap<KK, VV> map = Maps.mutable.empty();\n+        this.forEach(each ->\n+        {\n+            KK key = groupBy.valueOf(each);\n+            VV value = map.getIfAbsentPut(key, zeroValueFactory);\n+            mutatingAggregator.value(value, each);\n+        });\n+        return map;\n+    }\n \n     @Override\n-    <K2, V2> MutableMap<K2, V2> aggregateBy(\n-            Function<? super V, ? extends K2> groupBy,\n-            Function0<? extends V2> zeroValueFactory,\n-            Function2<? super V2, ? super V, ? extends V2> nonMutatingAggregator);\n+    default <KK, VV> MutableMap<KK, VV> aggregateBy(", "originalCommit": "d2817e2338eb7cad5514b33f0f97043ce77ad7ed", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "dea1b6c243b4a6b88f181022dd9656eb7232ccfc", "url": "https://github.com/eclipse/eclipse-collections/commit/dea1b6c243b4a6b88f181022dd9656eb7232ccfc", "message": "Pull up implementations of aggregateBy() as default methods.\n\nSigned-off-by: Craig P. Motlin <cmotlin@gmail.com>", "committedDate": "2020-05-06T16:23:32Z", "type": "forcePushed"}, {"oid": "90c963bd2467364d3e1fab70e2073423b2e8b07a", "url": "https://github.com/eclipse/eclipse-collections/commit/90c963bd2467364d3e1fab70e2073423b2e8b07a", "message": "Pull up implementations of aggregateBy() as default methods.\n\nSigned-off-by: Craig P. Motlin <cmotlin@gmail.com>", "committedDate": "2020-05-12T02:25:18Z", "type": "forcePushed"}, {"oid": "0b89a5563280a1c4fe3548e42fe13fce942cdbab", "url": "https://github.com/eclipse/eclipse-collections/commit/0b89a5563280a1c4fe3548e42fe13fce942cdbab", "message": "Pull up implementations of aggregateBy() as default methods.\n\nSigned-off-by: Craig P. Motlin <cmotlin@gmail.com>", "committedDate": "2020-05-12T13:08:06Z", "type": "forcePushed"}, {"oid": "a667d95bd937fd586abaaaceb3cf751ca2e162dc", "url": "https://github.com/eclipse/eclipse-collections/commit/a667d95bd937fd586abaaaceb3cf751ca2e162dc", "message": "Pull up implementations of aggregateBy() as default methods.\n\nSigned-off-by: Craig P. Motlin <cmotlin@gmail.com>", "committedDate": "2020-05-13T13:38:49Z", "type": "forcePushed"}, {"oid": "76199ceb2db94fbc0ddac3c84b77760f9830cc0e", "url": "https://github.com/eclipse/eclipse-collections/commit/76199ceb2db94fbc0ddac3c84b77760f9830cc0e", "message": "Pull up implementations of aggregateBy() as default methods.\n\nSigned-off-by: Craig P. Motlin <cmotlin@gmail.com>", "committedDate": "2020-05-17T19:03:51Z", "type": "commit"}, {"oid": "76199ceb2db94fbc0ddac3c84b77760f9830cc0e", "url": "https://github.com/eclipse/eclipse-collections/commit/76199ceb2db94fbc0ddac3c84b77760f9830cc0e", "message": "Pull up implementations of aggregateBy() as default methods.\n\nSigned-off-by: Craig P. Motlin <cmotlin@gmail.com>", "committedDate": "2020-05-17T19:03:51Z", "type": "forcePushed"}]}