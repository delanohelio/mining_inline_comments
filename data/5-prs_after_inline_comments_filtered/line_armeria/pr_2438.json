{"pr_number": 2438, "pr_title": "Add MediaTypeNames", "pr_createdAt": "2020-01-31T17:14:44Z", "pr_url": "https://github.com/line/armeria/pull/2438", "timeline": [{"oid": "9414eec0842085bf1fb803593e26f29148766db4", "url": "https://github.com/line/armeria/commit/9414eec0842085bf1fb803593e26f29148766db4", "message": "Implement MediaTypeNames\n\nMotivation:\n\nAs described in #2421, armeria currently does not provide String type\nconstants for MediaType\n\nModifications:\n\nIntroduce new class for String Constants in MediaType, MediaTypeNames\n\nResult:\n\nImplement MediaTypeNames class and its test (MediaTypeNamesTest)", "committedDate": "2020-01-31T17:12:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzc1NTYyNQ==", "url": "https://github.com/line/armeria/pull/2438#discussion_r373755625", "bodyText": "I think you can use reflection for completeness.", "author": "trustin", "createdAt": "2020-02-01T03:54:18Z", "path": "core/src/test/java/com/linecorp/armeria/common/MediaTypeNamesTest.java", "diffHunk": "@@ -0,0 +1,52 @@\n+/*\n+ *  Copyright 2020 LINE Corporation\n+ *\n+ *  LINE Corporation licenses this file to you under the Apache License,\n+ *  version 2.0 (the \"License; charset=utf-8\"; you may not use this file except in compliance\n+ *  with the License. You may obtain a copy of the License at:\n+ *\n+ *    https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ *  WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ *  License for the specific language governing permissions and limitations\n+ *  under the License.\n+ */\n+\n+package com.linecorp.armeria.common;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertSame;\n+\n+import org.junit.jupiter.api.Test;\n+\n+/**\n+ * Test sync with MediaType and MediaTypeNames\n+ */\n+class MediaTypeNamesTest {\n+\n+    @Test\n+    void matchMediaTypeToMediaTypeNames() throws Exception {", "originalCommit": "9414eec0842085bf1fb803593e26f29148766db4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzgzMzc2MQ==", "url": "https://github.com/line/armeria/pull/2438#discussion_r373833761", "bodyText": "Oh! Let me use reflection referencing MediaTypeTest", "author": "JunoJunho", "createdAt": "2020-02-02T10:04:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzc1NTYyNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzc1NTY5OQ==", "url": "https://github.com/line/armeria/pull/2438#discussion_r373755699", "bodyText": "Missing Javadoc. Could use the string in verbatim, e.g.\n/**\n * {@value #ANY_TYPE}.\n */\n// or..\n/**\n * {@code \"*/*\"}.\n */", "author": "trustin", "createdAt": "2020-02-01T03:55:50Z", "path": "core/src/main/java/com/linecorp/armeria/common/MediaTypeNames.java", "diffHunk": "@@ -0,0 +1,155 @@\n+/*\n+ *  Copyright 2020 LINE Corporation\n+ *\n+ *  LINE Corporation licenses this file to you under the Apache License,\n+ *  version 2.0 (the \"License; charset=utf-8\"; you may not use this file except in compliance\n+ *  with the License. You may obtain a copy of the License at:\n+ *\n+ *    https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ *  WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ *  License for the specific language governing permissions and limitations\n+ *  under the License.\n+ */\n+\n+package com.linecorp.armeria.common;\n+\n+public final class MediaTypeNames {\n+\n+    public static final String ANY_TYPE = \"*/*\";", "originalCommit": "9414eec0842085bf1fb803593e26f29148766db4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzg0NTgxOQ==", "url": "https://github.com/line/armeria/pull/2438#discussion_r373845819", "bodyText": "For all constants? What your intention is showing the value in javadoc?\nI think first suggestion is better because it seems good to later when editing this code.", "author": "JunoJunho", "createdAt": "2020-02-02T13:26:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzc1NTY5OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQwODg1NQ==", "url": "https://github.com/line/armeria/pull/2438#discussion_r374408855", "bodyText": "When working with IDE, it will show the value of the constant in quick documentation, auto-completion hints, etc.", "author": "trustin", "createdAt": "2020-02-03T23:58:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzc1NTY5OQ=="}], "type": "inlineReview"}, {"oid": "dd61475fa2f8daa8d0d9fcc4988f04e42453c3bc", "url": "https://github.com/line/armeria/commit/dd61475fa2f8daa8d0d9fcc4988f04e42453c3bc", "message": "Update test, javadoc", "committedDate": "2020-02-02T13:56:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzg5Nzc5NQ==", "url": "https://github.com/line/armeria/pull/2438#discussion_r373897795", "bodyText": "FluentIterable is a discouraged precursor by its Javadoc. How about using Stream.of(clazz.getDeclaredFields()).filter...?", "author": "minwoox", "createdAt": "2020-02-03T02:00:12Z", "path": "core/src/test/java/com/linecorp/armeria/common/MediaTypeNamesTest.java", "diffHunk": "@@ -0,0 +1,86 @@\n+/*\n+ *  Copyright 2020 LINE Corporation\n+ *\n+ *  LINE Corporation licenses this file to you under the Apache License,\n+ *  version 2.0 (the \"License; charset=utf-8\"; you may not use this file except in compliance\n+ *  with the License. You may obtain a copy of the License at:\n+ *\n+ *    https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ *  WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ *  License for the specific language governing permissions and limitations\n+ *  under the License.\n+ */\n+\n+package com.linecorp.armeria.common;\n+\n+import static java.lang.reflect.Modifier.isFinal;\n+import static java.lang.reflect.Modifier.isPublic;\n+import static java.lang.reflect.Modifier.isStatic;\n+import static java.util.Arrays.asList;\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNotNull;\n+\n+import java.lang.reflect.Field;\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.Map.Entry;\n+\n+import org.junit.jupiter.api.Test;\n+\n+import com.google.common.collect.FluentIterable;\n+\n+/**\n+ * Test sync with MediaType and MediaTypeNames.\n+ */\n+class MediaTypeNamesTest {\n+\n+    // reflection\n+    @Test\n+    void matchMediaTypeToMediaTypeNames() throws Exception {\n+        final FluentIterable<Field> mediaTypeFields = getConstantFields(MediaType.class);\n+        final FluentIterable<Field> mediaTypeNamesFields = getConstantFields(MediaTypeNames.class);\n+\n+        final Map<String, MediaType> mediaTypeConstantsMap =\n+                getConstantFieldMap(mediaTypeFields, MediaType.class);\n+        final Map<String, String> mediaTypeNamesConstantsMap =\n+                getConstantFieldMap(mediaTypeNamesFields, String.class);\n+\n+        for (Entry<String, MediaType> mediaTypeEntry : mediaTypeConstantsMap.entrySet()) {\n+            final String mediaTypeName = mediaTypeNamesConstantsMap.get(mediaTypeEntry.getKey());\n+            assertNotNull(\"MediaTypeName should be defined in MediaType constants\", mediaTypeName);\n+            assertEquals(mediaTypeName, mediaTypeEntry.getValue().toString());\n+        }\n+    }\n+\n+    // reflection\n+    @SuppressWarnings(\"Guava\")\n+    private static <T> FluentIterable<Field> getConstantFields(Class<T> clazz) {\n+        return FluentIterable.from(asList(clazz.getDeclaredFields())).filter(input -> {", "originalCommit": "dd61475fa2f8daa8d0d9fcc4988f04e42453c3bc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzkwNDY4Ng==", "url": "https://github.com/line/armeria/pull/2438#discussion_r373904686", "bodyText": "Found out that this code is from MediaTypeTest. How about making the method as package-private and reusing here?", "author": "minwoox", "createdAt": "2020-02-03T02:51:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzg5Nzc5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDEyMDU3OQ==", "url": "https://github.com/line/armeria/pull/2438#discussion_r374120579", "bodyText": "Yes, it is from guava test and it is no problem since they are used in verified way (in Guava).\nI will make the method as package-private and re-using.", "author": "JunoJunho", "createdAt": "2020-02-03T14:07:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzg5Nzc5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDEyMTA4Ng==", "url": "https://github.com/line/armeria/pull/2438#discussion_r374121086", "bodyText": "But little-bit edit is applied (Class parameter) I think it is okay to me. If any issue, please tell me.", "author": "JunoJunho", "createdAt": "2020-02-03T14:08:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzg5Nzc5NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzg5Nzk2NA==", "url": "https://github.com/line/armeria/pull/2438#discussion_r373897964", "bodyText": "Could you use AssertJ?\nassertThat(mediaTypeName).isNotNull();\nassertThat(mediaTypeName).isEqualTo(mediaTypeEntry.getValue().toString());", "author": "minwoox", "createdAt": "2020-02-03T02:01:47Z", "path": "core/src/test/java/com/linecorp/armeria/common/MediaTypeNamesTest.java", "diffHunk": "@@ -0,0 +1,86 @@\n+/*\n+ *  Copyright 2020 LINE Corporation\n+ *\n+ *  LINE Corporation licenses this file to you under the Apache License,\n+ *  version 2.0 (the \"License; charset=utf-8\"; you may not use this file except in compliance\n+ *  with the License. You may obtain a copy of the License at:\n+ *\n+ *    https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ *  WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ *  License for the specific language governing permissions and limitations\n+ *  under the License.\n+ */\n+\n+package com.linecorp.armeria.common;\n+\n+import static java.lang.reflect.Modifier.isFinal;\n+import static java.lang.reflect.Modifier.isPublic;\n+import static java.lang.reflect.Modifier.isStatic;\n+import static java.util.Arrays.asList;\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNotNull;\n+\n+import java.lang.reflect.Field;\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.Map.Entry;\n+\n+import org.junit.jupiter.api.Test;\n+\n+import com.google.common.collect.FluentIterable;\n+\n+/**\n+ * Test sync with MediaType and MediaTypeNames.\n+ */\n+class MediaTypeNamesTest {\n+\n+    // reflection\n+    @Test\n+    void matchMediaTypeToMediaTypeNames() throws Exception {\n+        final FluentIterable<Field> mediaTypeFields = getConstantFields(MediaType.class);\n+        final FluentIterable<Field> mediaTypeNamesFields = getConstantFields(MediaTypeNames.class);\n+\n+        final Map<String, MediaType> mediaTypeConstantsMap =\n+                getConstantFieldMap(mediaTypeFields, MediaType.class);\n+        final Map<String, String> mediaTypeNamesConstantsMap =\n+                getConstantFieldMap(mediaTypeNamesFields, String.class);\n+\n+        for (Entry<String, MediaType> mediaTypeEntry : mediaTypeConstantsMap.entrySet()) {\n+            final String mediaTypeName = mediaTypeNamesConstantsMap.get(mediaTypeEntry.getKey());\n+            assertNotNull(\"MediaTypeName should be defined in MediaType constants\", mediaTypeName);\n+            assertEquals(mediaTypeName, mediaTypeEntry.getValue().toString());", "originalCommit": "dd61475fa2f8daa8d0d9fcc4988f04e42453c3bc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDExOTMyNw==", "url": "https://github.com/line/armeria/pull/2438#discussion_r374119327", "bodyText": "Let me apply it.", "author": "JunoJunho", "createdAt": "2020-02-03T14:05:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzg5Nzk2NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzkwMTE3MA==", "url": "https://github.com/line/armeria/pull/2438#discussion_r373901170", "bodyText": "Could you migrate @Produces(\"application/json-seq\") to @Produces(JSON_SEQ) and other similar things in our code base?\n\n  \n    \n      armeria/core/src/main/java/com/linecorp/armeria/server/annotation/ProducesJsonSequences.java\n    \n    \n         Line 28\n      in\n      6f3c61e\n    \n    \n    \n    \n\n        \n          \n           @Produces(\"application/json-seq\")", "author": "ikhoon", "createdAt": "2020-02-03T02:27:20Z", "path": "core/src/main/java/com/linecorp/armeria/common/MediaTypeNames.java", "diffHunk": "@@ -0,0 +1,472 @@\n+/*\n+ *  Copyright 2020 LINE Corporation\n+ *\n+ *  LINE Corporation licenses this file to you under the Apache License,\n+ *  version 2.0 (the \"License; charset=utf-8\"; you may not use this file except in compliance\n+ *  with the License. You may obtain a copy of the License at:\n+ *\n+ *    https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ *  WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ *  License for the specific language governing permissions and limitations\n+ *  under the License.\n+ */\n+\n+package com.linecorp.armeria.common;\n+\n+/**\n+ * String constants defined in {@link MediaType} class.\n+ */\n+public final class MediaTypeNames {\n+\n+    /**\n+     * {@value #ANY_TYPE}.\n+     */\n+    public static final String ANY_TYPE = \"*/*\";\n+    /**\n+     * {@value #ANY_TEXT_TYPE}.\n+     */\n+    public static final String ANY_TEXT_TYPE = \"text/*\";\n+    /**\n+     * {@value #ANY_IMAGE_TYPE}.\n+     */\n+    public static final String ANY_IMAGE_TYPE = \"image/*\";\n+    /**\n+     * {@value #ANY_AUDIO_TYPE}.\n+     */\n+    public static final String ANY_AUDIO_TYPE = \"audio/*\";\n+    /**\n+     * {@value #ANY_VIDEO_TYPE}.\n+     */\n+    public static final String ANY_VIDEO_TYPE = \"video/*\";\n+    /**\n+     * {@value #ANY_APPLICATION_TYPE}.\n+     */\n+    public static final String ANY_APPLICATION_TYPE = \"application/*\";\n+\n+    /* text types */\n+\n+    /**\n+     * {@value #CACHE_MANIFEST_UTF_8}.\n+     */\n+    public static final String CACHE_MANIFEST_UTF_8 = \"text/cache-manifest; charset=utf-8\";\n+    /**\n+     * {@value #CSS_UTF_8}.\n+     */\n+    public static final String CSS_UTF_8 = \"text/css; charset=utf-8\";\n+    /**\n+     * {@value #CSV_UTF_8}.\n+     */\n+    public static final String CSV_UTF_8 = \"text/csv; charset=utf-8\";\n+    /**\n+     * {@value #HTML_UTF_8}.\n+     */\n+    public static final String HTML_UTF_8 = \"text/html; charset=utf-8\";\n+    /**\n+     * {@value #I_CALENDAR_UTF_8}.\n+     */\n+    public static final String I_CALENDAR_UTF_8 = \"text/calendar; charset=utf-8\";\n+    /**\n+     * {@value #PLAIN_TEXT_UTF_8}.\n+     */\n+    public static final String PLAIN_TEXT_UTF_8 = \"text/plain; charset=utf-8\";\n+    /**\n+     * {@value #EVENT_STREAM}.\n+     */\n+    public static final String EVENT_STREAM = \"text/event-stream\";\n+    /**\n+     * {@value #TEXT_JAVASCRIPT_UTF_8}.\n+     */\n+    public static final String TEXT_JAVASCRIPT_UTF_8 = \"text/javascript; charset=utf-8\";\n+    /**\n+     * {@value #TSV_UTF_8}.\n+     */\n+    public static final String TSV_UTF_8 = \"text/tab-separated-values; charset=utf-8\";\n+    /**\n+     * {@value #VCARD_UTF_8}.\n+     */\n+    public static final String VCARD_UTF_8 = \"text/vcard; charset=utf-8\";\n+    /**\n+     * {@value #WML_UTF_8}.\n+     */\n+    public static final String WML_UTF_8 = \"text/vnd.wap.wml; charset=utf-8\";\n+    /**\n+     * {@value #XML_UTF_8}.\n+     */\n+    public static final String XML_UTF_8 = \"text/xml; charset=utf-8\";\n+    /**\n+     * {@value #VTT_UTF_8}.\n+     */\n+    public static final String VTT_UTF_8 = \"text/vtt; charset=utf-8\";\n+\n+    /* image types */\n+\n+    /**\n+     * {@value #BMP}.\n+     */\n+    public static final String BMP = \"image/bmp\";\n+    /**\n+     * {@value #CRW}.\n+     */\n+    public static final String CRW = \"image/x-canon-crw\";\n+    /**\n+     * {@value #GIF}.\n+     */\n+    public static final String GIF = \"image/gif\";\n+    /**\n+     * {@value #ICO}.\n+     */\n+    public static final String ICO = \"image/vnd.microsoft.icon\";\n+    /**\n+     * {@value #JPEG}.\n+     */\n+    public static final String JPEG = \"image/jpeg\";\n+    /**\n+     * {@value #PNG}.\n+     */\n+    public static final String PNG = \"image/png\";\n+    /**\n+     * {@value #PSD}.\n+     */\n+    public static final String PSD = \"image/vnd.adobe.photoshop\";\n+    /**\n+     * {@value #SVG_UTF_8}.\n+     */\n+    public static final String SVG_UTF_8 = \"image/svg+xml; charset=utf-8\";\n+    /**\n+     * {@value #TIFF}.\n+     */\n+    public static final String TIFF = \"image/tiff\";\n+    /**\n+     * {@value #WEBP}.\n+     */\n+    public static final String WEBP = \"image/webp\";\n+\n+    /* audio types */\n+\n+    /**\n+     * {@value #MP4_AUDIO}.\n+     */\n+    public static final String MP4_AUDIO = \"audio/mp4\";\n+    /**\n+     * {@value #MPEG_AUDIO}.\n+     */\n+    public static final String MPEG_AUDIO = \"audio/mpeg\";\n+    /**\n+     * {@value #OGG_AUDIO}.\n+     */\n+    public static final String OGG_AUDIO = \"audio/ogg\";\n+    /**\n+     * {@value #WEBM_AUDIO}.\n+     */\n+    public static final String WEBM_AUDIO = \"audio/webm\";\n+    /**\n+     * {@value #L16_AUDIO}.\n+     */\n+    public static final String L16_AUDIO = \"audio/l16\";\n+    /**\n+     * {@value #L24_AUDIO}.\n+     */\n+    public static final String L24_AUDIO = \"audio/l24\";\n+    /**\n+     * {@value #BASIC_AUDIO}.\n+     */\n+    public static final String BASIC_AUDIO = \"audio/basic\";\n+    /**\n+     * {@value #AAC_AUDIO}.\n+     */\n+    public static final String AAC_AUDIO = \"audio/aac\";\n+    /**\n+     * {@value #VORBIS_AUDIO}.\n+     */\n+    public static final String VORBIS_AUDIO = \"audio/vorbis\";\n+    /**\n+     * {@value #WMA_AUDIO}.\n+     */\n+    public static final String WMA_AUDIO = \"audio/x-ms-wma\";\n+    /**\n+     * {@value #WAX_AUDIO}.\n+     */\n+    public static final String WAX_AUDIO = \"audio/x-ms-wax\";\n+    /**\n+     * {@value #VND_REAL_AUDIO}.\n+     */\n+    public static final String VND_REAL_AUDIO = \"audio/vnd.rn-realaudio\";\n+    /**\n+     * {@value #VND_WAVE_AUDIO}.\n+     */\n+    public static final String VND_WAVE_AUDIO = \"audio/vnd.wave\";\n+\n+    /* video types */\n+\n+    /**\n+     * {@value #MP4_VIDEO}.\n+     */\n+    public static final String MP4_VIDEO = \"video/mp4\";\n+    /**\n+     * {@value #MPEG_VIDEO}.\n+     */\n+    public static final String MPEG_VIDEO = \"video/mpeg\";\n+    /**\n+     * {@value #OGG_VIDEO}.\n+     */\n+    public static final String OGG_VIDEO = \"video/ogg\";\n+    /**\n+     * {@value #QUICKTIME}.\n+     */\n+    public static final String QUICKTIME = \"video/quicktime\";\n+    /**\n+     * {@value #WEBM_VIDEO}.\n+     */\n+    public static final String WEBM_VIDEO = \"video/webm\";\n+    /**\n+     * {@value #WMV}.\n+     */\n+    public static final String WMV = \"video/x-ms-wmv\";\n+    /**\n+     * {@value #FLV_VIDEO}.\n+     */\n+    public static final String FLV_VIDEO = \"video/x-flv\";\n+    /**\n+     * {@value #THREE_GPP_VIDEO}.\n+     */\n+    public static final String THREE_GPP_VIDEO = \"video/3gpp\";\n+    /**\n+     * {@value #THREE_GPP2_VIDEO}.\n+     */\n+    public static final String THREE_GPP2_VIDEO = \"video/3gpp2\";\n+\n+    /* application types */\n+\n+    /**\n+     * {@value #APPLICATION_XML_UTF_8}.\n+     */\n+    public static final String APPLICATION_XML_UTF_8 = \"application/xml; charset=utf-8\";\n+    /**\n+     * {@value #ATOM_UTF_8}.\n+     */\n+    public static final String ATOM_UTF_8 = \"application/atom+xml; charset=utf-8\";\n+    /**\n+     * {@value #BZIP2}.\n+     */\n+    public static final String BZIP2 = \"application/x-bzip2\";\n+    /**\n+     * {@value #DART_UTF_8}.\n+     */\n+    public static final String DART_UTF_8 = \"application/dart; charset=utf-8\";\n+    /**\n+     * {@value #APPLE_PASSBOOK}.\n+     */\n+    public static final String APPLE_PASSBOOK = \"application/vnd.apple.pkpass\";\n+    /**\n+     * {@value #EOT}.\n+     */\n+    public static final String EOT = \"application/vnd.ms-fontobject\";\n+    /**\n+     * {@value #EPUB}.\n+     */\n+    public static final String EPUB = \"application/epub+zip\";\n+    /**\n+     * {@value #FORM_DATA}.\n+     */\n+    public static final String FORM_DATA = \"application/x-www-form-urlencoded\";\n+    /**\n+     * {@value #KEY_ARCHIVE}.\n+     */\n+    public static final String KEY_ARCHIVE = \"application/pkcs12\";\n+    /**\n+     * {@value #APPLICATION_BINARY}.\n+     */\n+    public static final String APPLICATION_BINARY = \"application/binary\";\n+    /**\n+     * {@value #GEO_JSON}.\n+     */\n+    public static final String GEO_JSON = \"application/geo+json\";\n+    /**\n+     * {@value #GZIP}.\n+     */\n+    public static final String GZIP = \"application/x-gzip\";\n+    /**\n+     * {@value #HAL_JSON}.\n+     */\n+    public static final String HAL_JSON = \"application/hal+json\";\n+    /**\n+     * {@value #JAVASCRIPT_UTF_8}.\n+     */\n+    public static final String JAVASCRIPT_UTF_8 = \"application/javascript; charset=utf-8\";\n+    /**\n+     * {@value #JOSE}.\n+     */\n+    public static final String JOSE = \"application/jose\";\n+    /**\n+     * {@value #JOSE_JSON}.\n+     */\n+    public static final String JOSE_JSON = \"application/jose+json\";\n+    /**\n+     * {@value #JSON_UTF_8}.\n+     */\n+    public static final String JSON_UTF_8 = \"application/json; charset=utf-8\";\n+    /**\n+     * {@value #JSON}.\n+     */\n+    public static final String JSON = \"application/json\";\n+    /**\n+     * {@value #JSON_PATCH}.\n+     */\n+    public static final String JSON_PATCH = \"application/json-patch+json\";\n+    /**\n+     * {@value #JSON_SEQ}.\n+     */\n+    public static final String JSON_SEQ = \"application/json-seq\";", "originalCommit": "dd61475fa2f8daa8d0d9fcc4988f04e42453c3bc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDEwNzU0Mg==", "url": "https://github.com/line/armeria/pull/2438#discussion_r374107542", "bodyText": "Let me find and apply it.", "author": "JunoJunho", "createdAt": "2020-02-03T13:42:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzkwMTE3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDExOTIzNA==", "url": "https://github.com/line/armeria/pull/2438#discussion_r374119234", "bodyText": "I applied them all but test code (I am not sure applying test code since some are applied some are not. It seems weird to me).", "author": "JunoJunho", "createdAt": "2020-02-03T14:04:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzkwMTE3MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzkwNDg3Ng==", "url": "https://github.com/line/armeria/pull/2438#discussion_r373904876", "bodyText": "The clazz parameter seems unused.\nHow about using stream API & ImmutableMap instead of mutable HashMap?\nprivate static <T> Map<String, T> getConstantFieldMap(Iterable<Field> iterable) {\n    return StreamSupport\n            .stream(iterable.spliterator(), false)\n            .collect(toImmutableMap(Field::getName, field -> {\n                try {\n                    @SuppressWarnings(\"unchecked\")\n                    final T cast = (T) field.get(null);\n                    return cast;\n                } catch (Exception ex) {\n                    throw new RuntimeException(ex);\n                }\n            }));\n}", "author": "ikhoon", "createdAt": "2020-02-03T02:53:16Z", "path": "core/src/test/java/com/linecorp/armeria/common/MediaTypeNamesTest.java", "diffHunk": "@@ -0,0 +1,86 @@\n+/*\n+ *  Copyright 2020 LINE Corporation\n+ *\n+ *  LINE Corporation licenses this file to you under the Apache License,\n+ *  version 2.0 (the \"License; charset=utf-8\"; you may not use this file except in compliance\n+ *  with the License. You may obtain a copy of the License at:\n+ *\n+ *    https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ *  WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ *  License for the specific language governing permissions and limitations\n+ *  under the License.\n+ */\n+\n+package com.linecorp.armeria.common;\n+\n+import static java.lang.reflect.Modifier.isFinal;\n+import static java.lang.reflect.Modifier.isPublic;\n+import static java.lang.reflect.Modifier.isStatic;\n+import static java.util.Arrays.asList;\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNotNull;\n+\n+import java.lang.reflect.Field;\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.Map.Entry;\n+\n+import org.junit.jupiter.api.Test;\n+\n+import com.google.common.collect.FluentIterable;\n+\n+/**\n+ * Test sync with MediaType and MediaTypeNames.\n+ */\n+class MediaTypeNamesTest {\n+\n+    // reflection\n+    @Test\n+    void matchMediaTypeToMediaTypeNames() throws Exception {\n+        final FluentIterable<Field> mediaTypeFields = getConstantFields(MediaType.class);\n+        final FluentIterable<Field> mediaTypeNamesFields = getConstantFields(MediaTypeNames.class);\n+\n+        final Map<String, MediaType> mediaTypeConstantsMap =\n+                getConstantFieldMap(mediaTypeFields, MediaType.class);\n+        final Map<String, String> mediaTypeNamesConstantsMap =\n+                getConstantFieldMap(mediaTypeNamesFields, String.class);\n+\n+        for (Entry<String, MediaType> mediaTypeEntry : mediaTypeConstantsMap.entrySet()) {\n+            final String mediaTypeName = mediaTypeNamesConstantsMap.get(mediaTypeEntry.getKey());\n+            assertNotNull(\"MediaTypeName should be defined in MediaType constants\", mediaTypeName);\n+            assertEquals(mediaTypeName, mediaTypeEntry.getValue().toString());\n+        }\n+    }\n+\n+    // reflection\n+    @SuppressWarnings(\"Guava\")\n+    private static <T> FluentIterable<Field> getConstantFields(Class<T> clazz) {\n+        return FluentIterable.from(asList(clazz.getDeclaredFields())).filter(input -> {\n+            final int modifiers = input.getModifiers();\n+            return isPublic(modifiers) &&\n+                   isStatic(modifiers) &&\n+                   isFinal(modifiers) &&\n+                   String.class.equals(input.getType());\n+        });\n+    }\n+\n+    // reflection\n+    @SuppressWarnings(\"Guava\")\n+    private static <T> Map<String, T> getConstantFieldMap(FluentIterable<Field> iterable, Class<T> clazz) {", "originalCommit": "dd61475fa2f8daa8d0d9fcc4988f04e42453c3bc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDEyOTg3NQ==", "url": "https://github.com/line/armeria/pull/2438#discussion_r374129875", "bodyText": "Oh! I did not know that I can use without parameter. Let me apply this code snippet! Thanks!", "author": "JunoJunho", "createdAt": "2020-02-03T14:24:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzkwNDg3Ng=="}], "type": "inlineReview"}, {"oid": "544478cc741f15a19145cf821a55c0ae49649839", "url": "https://github.com/line/armeria/commit/544478cc741f15a19145cf821a55c0ae49649839", "message": "Uppdate", "committedDate": "2020-02-03T14:32:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQwOTM3NQ==", "url": "https://github.com/line/armeria/pull/2438#discussion_r374409375", "bodyText": ".isNotNull() is redundant, because .isEqualTo() next line will check nullness anyway.", "author": "trustin", "createdAt": "2020-02-03T23:59:55Z", "path": "core/src/test/java/com/linecorp/armeria/common/MediaTypeNamesTest.java", "diffHunk": "@@ -0,0 +1,67 @@\n+/*\n+ *  Copyright 2020 LINE Corporation\n+ *\n+ *  LINE Corporation licenses this file to you under the Apache License,\n+ *  version 2.0 (the \"License; charset=utf-8\"; you may not use this file except in compliance\n+ *  with the License. You may obtain a copy of the License at:\n+ *\n+ *    https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ *  WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ *  License for the specific language governing permissions and limitations\n+ *  under the License.\n+ */\n+\n+package com.linecorp.armeria.common;\n+\n+import static com.google.common.collect.ImmutableMap.toImmutableMap;\n+import static com.linecorp.armeria.common.MediaTypeTest.getConstantFields;\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+import java.lang.reflect.Field;\n+import java.util.Map;\n+import java.util.Map.Entry;\n+import java.util.stream.StreamSupport;\n+\n+import org.junit.jupiter.api.Test;\n+\n+import com.google.common.collect.FluentIterable;\n+\n+/**\n+ * Test sync with MediaType and MediaTypeNames.\n+ */\n+class MediaTypeNamesTest {\n+\n+    // reflection\n+    @Test\n+    void matchMediaTypeToMediaTypeNames() throws Exception {\n+        final FluentIterable<Field> mediaTypeFields = getConstantFields(MediaType.class);\n+        final FluentIterable<Field> mediaTypeNamesFields = getConstantFields(MediaTypeNames.class,\n+                                                                             String.class);\n+\n+        final Map<String, MediaType> mediaTypeConstantsMap = getConstantFieldMap(mediaTypeFields);\n+        final Map<String, String> mediaTypeNamesConstantsMap = getConstantFieldMap(mediaTypeNamesFields);\n+\n+        for (Entry<String, MediaType> mediaTypeEntry : mediaTypeConstantsMap.entrySet()) {\n+            final String mediaTypeName = mediaTypeNamesConstantsMap.get(mediaTypeEntry.getKey());\n+            assertThat(mediaTypeName).isNotNull();", "originalCommit": "544478cc741f15a19145cf821a55c0ae49649839", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDY2NjcyOA==", "url": "https://github.com/line/armeria/pull/2438#discussion_r374666728", "bodyText": "Oh! Let me apply it.", "author": "JunoJunho", "createdAt": "2020-02-04T13:24:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQwOTM3NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQwOTYyOQ==", "url": "https://github.com/line/armeria/pull/2438#discussion_r374409629", "bodyText": "Iterables.stream(iterable) ?", "author": "trustin", "createdAt": "2020-02-04T00:00:54Z", "path": "core/src/test/java/com/linecorp/armeria/common/MediaTypeNamesTest.java", "diffHunk": "@@ -0,0 +1,67 @@\n+/*\n+ *  Copyright 2020 LINE Corporation\n+ *\n+ *  LINE Corporation licenses this file to you under the Apache License,\n+ *  version 2.0 (the \"License; charset=utf-8\"; you may not use this file except in compliance\n+ *  with the License. You may obtain a copy of the License at:\n+ *\n+ *    https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ *  WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ *  License for the specific language governing permissions and limitations\n+ *  under the License.\n+ */\n+\n+package com.linecorp.armeria.common;\n+\n+import static com.google.common.collect.ImmutableMap.toImmutableMap;\n+import static com.linecorp.armeria.common.MediaTypeTest.getConstantFields;\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+import java.lang.reflect.Field;\n+import java.util.Map;\n+import java.util.Map.Entry;\n+import java.util.stream.StreamSupport;\n+\n+import org.junit.jupiter.api.Test;\n+\n+import com.google.common.collect.FluentIterable;\n+\n+/**\n+ * Test sync with MediaType and MediaTypeNames.\n+ */\n+class MediaTypeNamesTest {\n+\n+    // reflection\n+    @Test\n+    void matchMediaTypeToMediaTypeNames() throws Exception {\n+        final FluentIterable<Field> mediaTypeFields = getConstantFields(MediaType.class);\n+        final FluentIterable<Field> mediaTypeNamesFields = getConstantFields(MediaTypeNames.class,\n+                                                                             String.class);\n+\n+        final Map<String, MediaType> mediaTypeConstantsMap = getConstantFieldMap(mediaTypeFields);\n+        final Map<String, String> mediaTypeNamesConstantsMap = getConstantFieldMap(mediaTypeNamesFields);\n+\n+        for (Entry<String, MediaType> mediaTypeEntry : mediaTypeConstantsMap.entrySet()) {\n+            final String mediaTypeName = mediaTypeNamesConstantsMap.get(mediaTypeEntry.getKey());\n+            assertThat(mediaTypeName).isNotNull();\n+            assertThat(mediaTypeName).isEqualTo(mediaTypeEntry.getValue().toString());\n+        }\n+    }\n+\n+    private static <T> Map<String, T> getConstantFieldMap(Iterable<Field> iterable) {\n+        return StreamSupport\n+                .stream(iterable.spliterator(), false)", "originalCommit": "544478cc741f15a19145cf821a55c0ae49649839", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDY2NzA5Mg==", "url": "https://github.com/line/armeria/pull/2438#discussion_r374667092", "bodyText": "Current guava does not support such method?", "author": "JunoJunho", "createdAt": "2020-02-04T13:24:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQwOTYyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDcxNjA4NQ==", "url": "https://github.com/line/armeria/pull/2438#discussion_r374716085", "bodyText": "I could not find this method.", "author": "JunoJunho", "createdAt": "2020-02-04T14:51:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQwOTYyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTAyNDgzNw==", "url": "https://github.com/line/armeria/pull/2438#discussion_r375024837", "bodyText": "Ugh, sorry. I must be mistaken. \ud83d\ude05", "author": "trustin", "createdAt": "2020-02-05T02:04:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQwOTYyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTAyNzA1Ng==", "url": "https://github.com/line/armeria/pull/2438#discussion_r375027056", "bodyText": "In guava it's Streams.stream :)", "author": "anuraaga", "createdAt": "2020-02-05T02:13:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQwOTYyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTYxNDQzNA==", "url": "https://github.com/line/armeria/pull/2438#discussion_r375614434", "bodyText": "@JunoJunho Could you fix this?", "author": "trustin", "createdAt": "2020-02-06T02:37:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQwOTYyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTYxOTc0Mg==", "url": "https://github.com/line/armeria/pull/2438#discussion_r375619742", "bodyText": "In guava it's Streams.stream :)\n\nGood to know \ud83d\udc4d", "author": "ikhoon", "createdAt": "2020-02-06T03:02:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQwOTYyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTY0Mjc3Ng==", "url": "https://github.com/line/armeria/pull/2438#discussion_r375642776", "bodyText": "Let me handle this.", "author": "JunoJunho", "createdAt": "2020-02-06T05:09:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQwOTYyOQ=="}], "type": "inlineReview"}, {"oid": "778c4839e0a0d5d3b8f11879215bac9181e42021", "url": "https://github.com/line/armeria/commit/778c4839e0a0d5d3b8f11879215bac9181e42021", "message": "Update", "committedDate": "2020-02-04T14:52:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTAyNjMxMA==", "url": "https://github.com/line/armeria/pull/2438#discussion_r375026310", "bodyText": "Special thanks to this \u2764\ufe0f", "author": "ikhoon", "createdAt": "2020-02-05T02:10:23Z", "path": "core/src/main/java/com/linecorp/armeria/server/annotation/ConsumesJson.java", "diffHunk": "@@ -20,11 +20,13 @@\n import java.lang.annotation.RetentionPolicy;\n import java.lang.annotation.Target;\n \n+import com.linecorp.armeria.common.MediaTypeNames;\n+\n /**\n- * An alias for {@code @Consumes(\"application/json\")}.\n+ * An alias for {@code @Consumes(MediaTypeNames.JSON)}.\n  */\n @Retention(RetentionPolicy.RUNTIME)\n @Target({ ElementType.TYPE, ElementType.METHOD })\n-@Consumes(\"application/json\")\n+@Consumes(MediaTypeNames.JSON)", "originalCommit": "778c4839e0a0d5d3b8f11879215bac9181e42021", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTAyNzU1NA==", "url": "https://github.com/line/armeria/pull/2438#discussion_r375027554", "bodyText": "Though if we can I think it's good to migrate these to return Stream, we don't use FluentIterable anywhere else in our code", "author": "anuraaga", "createdAt": "2020-02-05T02:16:12Z", "path": "core/src/test/java/com/linecorp/armeria/common/MediaTypeTest.java", "diffHunk": "@@ -116,20 +116,21 @@ public void testConstants_areUnique() {\n \n     // reflection\n     @SuppressWarnings(\"Guava\")\n-    private static FluentIterable<Field> getConstantFields() {\n-        return FluentIterable.from(asList(MediaType.class.getDeclaredFields())).filter(input -> {\n+    static <T, R> FluentIterable<Field> getConstantFields(Class<T> clazz, Class<R>... filterClazz) {", "originalCommit": "778c4839e0a0d5d3b8f11879215bac9181e42021", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTAyOTQ3MQ==", "url": "https://github.com/line/armeria/pull/2438#discussion_r375029471", "bodyText": "it's good to migrate these to return Stream\n\n+1 \ud83d\ude04", "author": "minwoox", "createdAt": "2020-02-05T02:24:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTAyNzU1NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTA0NDgwNg==", "url": "https://github.com/line/armeria/pull/2438#discussion_r375044806", "bodyText": "Maybe better leaving at it is, given the entire test case has been forked from Guava?", "author": "trustin", "createdAt": "2020-02-05T03:38:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTAyNzU1NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTEwOTQ0MQ==", "url": "https://github.com/line/armeria/pull/2438#discussion_r375109441", "bodyText": "Ah yeah it's fine to leave it then, can just clean up the Streams.stream part.", "author": "anuraaga", "createdAt": "2020-02-05T08:13:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTAyNzU1NA=="}], "type": "inlineReview"}, {"oid": "e0941a795ac133adaf224e02c80b2e0cc31a95b4", "url": "https://github.com/line/armeria/commit/e0941a795ac133adaf224e02c80b2e0cc31a95b4", "message": "Merge remote-tracking branch 'upstream/master' into implement-MediaTypeNames", "committedDate": "2020-02-05T12:01:31Z", "type": "commit"}, {"oid": "66d14d42094dee377d3ea65fc823632c9f008a44", "url": "https://github.com/line/armeria/commit/66d14d42094dee377d3ea65fc823632c9f008a44", "message": "Update for guava", "committedDate": "2020-02-06T05:52:23Z", "type": "commit"}, {"oid": "66d14d42094dee377d3ea65fc823632c9f008a44", "url": "https://github.com/line/armeria/commit/66d14d42094dee377d3ea65fc823632c9f008a44", "message": "Update for guava", "committedDate": "2020-02-06T05:52:23Z", "type": "forcePushed"}]}