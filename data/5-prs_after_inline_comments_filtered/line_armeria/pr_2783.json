{"pr_number": 2783, "pr_title": "Support java.time.Period type for `@Param` annotation", "pr_createdAt": "2020-06-06T16:16:17Z", "pr_url": "https://github.com/line/armeria/pull/2783", "timeline": [{"oid": "a384736a0500d4cfad176027a4d8620d1263b3d6", "url": "https://github.com/line/armeria/commit/a384736a0500d4cfad176027a4d8620d1263b3d6", "message": "Add Period to supported element types", "committedDate": "2020-06-06T14:11:30Z", "type": "commit"}, {"oid": "8a49b87dd72871b32bfeb4183916d3bedf5f4a06", "url": "https://github.com/line/armeria/commit/8a49b87dd72871b32bfeb4183916d3bedf5f4a06", "message": "Add Period to annotated value resolver tests", "committedDate": "2020-06-06T14:11:30Z", "type": "commit"}, {"oid": "dc9b08a8f910f17aa9cfd688b868c3781941753f", "url": "https://github.com/line/armeria/commit/dc9b08a8f910f17aa9cfd688b868c3781941753f", "message": "Add Period to annotated DocService tests", "committedDate": "2020-06-06T14:11:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI4MTU4Mg==", "url": "https://github.com/line/armeria/pull/2783#discussion_r436281582", "bodyText": "Could you update the documentation?\n\n  \n    \n      armeria/site/src/pages/docs/server-annotated-service.mdx\n    \n    \n        Lines 177 to 186\n      in\n      2f27081\n    \n    \n    \n    \n\n        \n          \n           - `boolean` or `Boolean` \n        \n\n        \n          \n           - `byte` or `Byte` \n        \n\n        \n          \n           - `short` or `Short` \n        \n\n        \n          \n           - `integer` or `Integer` \n        \n\n        \n          \n           - `long` or `Long` \n        \n\n        \n          \n           - `float` or `Float` \n        \n\n        \n          \n           - `double` or `Double` \n        \n\n        \n          \n           - `String` \n        \n\n        \n          \n           - `Enum` \n        \n\n        \n          \n           - `UUID`", "author": "ikhoon", "createdAt": "2020-06-06T16:29:20Z", "path": "core/src/main/java/com/linecorp/armeria/internal/server/annotation/AnnotatedServiceTypeUtil.java", "diffHunk": "@@ -50,6 +51,7 @@\n                     .put(Double.class, Double::valueOf)\n                     .put(String.class, Function.identity())\n                     .put(UUID.class, UUID::fromString)\n+                    .put(Period.class, Period::parse)", "originalCommit": "dc9b08a8f910f17aa9cfd688b868c3781941753f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI4MjcxNA==", "url": "https://github.com/line/armeria/pull/2783#discussion_r436282714", "bodyText": "OMG, thanks!", "author": "ghkim3221", "createdAt": "2020-06-06T16:44:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI4MTU4Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI4MjMzOQ==", "url": "https://github.com/line/armeria/pull/2783#discussion_r436282339", "bodyText": "Do we need to add a DocService test?\nI think we can test the Period converter by registering an annotated service that takes a Period as a @Param and calling it by a WebClient.\nFor example:\n\n  \n    \n      armeria/core/src/test/java/com/linecorp/armeria/internal/server/annotation/AnnotatedServiceRequestConverterTest.java\n    \n    \n        Lines 917 to 923\n      in\n      52fd361\n    \n    \n    \n    \n\n        \n          \n           @Test \n        \n\n        \n          \n           void testDefaultRequestConverter_uuid() { \n        \n\n        \n          \n               final WebClient client = WebClient.of(server.httpUri()); \n        \n\n        \n          \n               final UUID uuid = UUID.randomUUID(); \n        \n\n        \n          \n               final AggregatedHttpResponse response = client.get(\"/2/default/uuid/\" + uuid).aggregate().join(); \n        \n\n        \n          \n               assertThat(response.contentUtf8()).isEqualTo(uuid.toString()); \n        \n\n        \n          \n           }", "author": "ikhoon", "createdAt": "2020-06-06T16:39:43Z", "path": "core/src/test/java/com/linecorp/armeria/internal/server/annotation/AnnotatedDocServiceTest.java", "diffHunk": "@@ -307,6 +309,19 @@ private static void addJsonMethodInfo(Map<Class<?>, Set<MethodInfo>> methodInfos\n         methods.add(methodInfo2);\n     }\n \n+    private static void addPeriodMethodInfo(Map<Class<?>, Set<MethodInfo>> methodInfos) {", "originalCommit": "dc9b08a8f910f17aa9cfd688b868c3781941753f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI4Mzk1NA==", "url": "https://github.com/line/armeria/pull/2783#discussion_r436283954", "bodyText": "I added DocService test because @minwoox's suggestion. (Did I understand wrong?)\nAnd I add test case for converting. Thank you for kind instructions.", "author": "ghkim3221", "createdAt": "2020-06-06T17:01:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI4MjMzOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQyOTc5OQ==", "url": "https://github.com/line/armeria/pull/2783#discussion_r436429799", "bodyText": "I see. I missed the comment.", "author": "ikhoon", "createdAt": "2020-06-08T02:16:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI4MjMzOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQzMzQ5NA==", "url": "https://github.com/line/armeria/pull/2783#discussion_r436433494", "bodyText": "What I meant was that we need to check whether the type is rendered well or not on the DocService page.\nI have checked it and it seems OK. Thanks!", "author": "minwoox", "createdAt": "2020-06-08T02:40:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI4MjMzOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjY4MjM4MQ==", "url": "https://github.com/line/armeria/pull/2783#discussion_r436682381", "bodyText": "I see. Thanks!", "author": "ghkim3221", "createdAt": "2020-06-08T13:08:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI4MjMzOQ=="}], "type": "inlineReview"}, {"oid": "9d6d50e45d2bfa3b014f26ecb4c083c493baba52", "url": "https://github.com/line/armeria/commit/9d6d50e45d2bfa3b014f26ecb4c083c493baba52", "message": "Update document", "committedDate": "2020-06-06T16:44:37Z", "type": "commit"}, {"oid": "ff70e8fdae6a9828b5c9121a126549c2c555c3f4", "url": "https://github.com/line/armeria/commit/ff70e8fdae6a9828b5c9121a126549c2c555c3f4", "message": "Add test case for converting Period in annotated service", "committedDate": "2020-06-06T16:58:36Z", "type": "commit"}]}