{"pr_number": 2960, "pr_title": "Add DocServiceConfigurator into boot2-webflux-autoconfigure", "pr_createdAt": "2020-08-01T17:56:00Z", "pr_url": "https://github.com/line/armeria/pull/2960", "timeline": [{"oid": "c84c55db9daf415ba39162c381443760b2f5eda1", "url": "https://github.com/line/armeria/commit/c84c55db9daf415ba39162c381443760b2f5eda1", "message": "Add DocServiceConfigurator into boot2-webflux-autoconfigure", "committedDate": "2020-08-01T17:57:52Z", "type": "commit"}, {"oid": "c84c55db9daf415ba39162c381443760b2f5eda1", "url": "https://github.com/line/armeria/commit/c84c55db9daf415ba39162c381443760b2f5eda1", "message": "Add DocServiceConfigurator into boot2-webflux-autoconfigure", "committedDate": "2020-08-01T17:57:52Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDE2NDg0Mw==", "url": "https://github.com/line/armeria/pull/2960#discussion_r464164843", "bodyText": "If fails to find DocServiceConfigurator, how about calling configureArmeriaService(sb, settings)?", "author": "ikhoon", "createdAt": "2020-08-03T02:33:07Z", "path": "spring/boot2-webflux-autoconfigure/src/main/java/com/linecorp/armeria/spring/web/reactive/ArmeriaReactiveWebServerFactory.java", "diffHunk": "@@ -192,9 +193,13 @@ public WebServer getWebServer(HttpHandler httpHandler) {\n                                                   Ints.saturatedCast(minResponseSize)));\n         }\n \n+        final DocServiceBuilder docServiceBuilder = DocService.builder();\n+        findBeans(DocServiceConfigurator.class).forEach(\n+                configurator -> configurator.configure(docServiceBuilder));", "originalCommit": "c84c55db9daf415ba39162c381443760b2f5eda1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDE2NTA4Mw==", "url": "https://github.com/line/armeria/pull/2960#discussion_r464165083", "bodyText": "Is it possible to add a test case for DocServiceConfigurator to prevent future mistakes?", "author": "ikhoon", "createdAt": "2020-08-03T02:34:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDE2NDg0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDYzMTYwNg==", "url": "https://github.com/line/armeria/pull/2960#discussion_r464631606", "bodyText": "If fails to find DocServiceConfigurator, how about calling configureArmeriaService(sb, settings)?\n\nCould you explain it in more detail?\nI referred to ArmeriaAutoConfiguration.", "author": "matsumana", "createdAt": "2020-08-03T20:00:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDE2NDg0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDc1MzA1Mg==", "url": "https://github.com/line/armeria/pull/2960#discussion_r464753052", "bodyText": "My explanation was not enough. \ud83d\ude05 What I meant was:\nList<DocServiceConfigurator> docServiceConfigurators = findBeans(DocServiceConfigurator.class);\nif (docServiceConfigurators.isEmpty()) {\n   configureArmeriaService(sb, settings);\n} else {\n   final DocServiceBuilder docServiceBuilder = DocService.builder();\n   docServiceConfigurators.forEach(\n       ... // Same as you did \n   );\n}", "author": "ikhoon", "createdAt": "2020-08-04T01:53:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDE2NDg0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDc3NjU4Mg==", "url": "https://github.com/line/armeria/pull/2960#discussion_r464776582", "bodyText": "Thank you for your explanation.\nI need to pass DocServiceBuilder to configureArmeriaService if I can find DocServiceConfigurator.\nYou mean that would it be better to create overload method like the following?\nfinal ArmeriaSettings settings = findBean(ArmeriaSettings.class);\nif (settings != null) {\n    final List<DocServiceConfigurator> docServiceConfigurators =\n            findBeans(DocServiceConfigurator.class);\n    if (docServiceConfigurators.isEmpty()) {\n        configureArmeriaService(sb, settings);\n    } else {\n        final DocServiceBuilder docServiceBuilder = DocService.builder();\n        configureArmeriaService(sb, docServiceBuilder, settings);\n        docServiceConfigurators.forEach(configurator -> configurator.configure(docServiceBuilder));\n    }\n}\n\nprivate void configureArmeriaService(ServerBuilder sb, ArmeriaSettings settings) {\n    final DocServiceBuilder docServiceBuilder = DocService.builder();\n    configureArmeriaService(sb, docServiceBuilder, settings);\n}\n\nprivate void configureArmeriaService(ServerBuilder sb, DocServiceBuilder docServiceBuilder,\n                                        ArmeriaSettings settings) {\n    ...\n}", "author": "matsumana", "createdAt": "2020-08-04T03:25:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDE2NDg0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDc4MDI0MQ==", "url": "https://github.com/line/armeria/pull/2960#discussion_r464780241", "bodyText": "The current code looks OK to me.  DocService has to be built even if there are no DocServiceConfigurator, so there's no point of handling the case of empty list specially.", "author": "trustin", "createdAt": "2020-08-04T03:40:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDE2NDg0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDc4MDU4Ng==", "url": "https://github.com/line/armeria/pull/2960#discussion_r464780586", "bodyText": "Let me mark this thread as resolved. No change is necessary.", "author": "trustin", "createdAt": "2020-08-04T03:41:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDE2NDg0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDc4MTI1Ng==", "url": "https://github.com/line/armeria/pull/2960#discussion_r464781256", "bodyText": "Sorry for the wrong direction. \ud83d\ude2d I thought configureArmeriaService is an API that is outside of this code.\nPlease ignore this review. Your code was good from the start! \ud83d\ude47\u200d\u2642\ufe0f", "author": "ikhoon", "createdAt": "2020-08-04T03:44:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDE2NDg0Mw=="}], "type": "inlineReview"}, {"oid": "f28bcefa9a4a0446166cfea3ff22b6b6b2b6693a", "url": "https://github.com/line/armeria/commit/f28bcefa9a4a0446166cfea3ff22b6b6b2b6693a", "message": "Add test for DocServiceConfigurator", "committedDate": "2020-08-03T19:10:57Z", "type": "commit"}, {"oid": "9e5a3af2987731df088e608e7d089b3866562e83", "url": "https://github.com/line/armeria/commit/9e5a3af2987731df088e608e7d089b3866562e83", "message": "Organize copy task using group", "committedDate": "2020-08-03T19:13:35Z", "type": "commit"}]}