{"pr_number": 2985, "pr_title": "Fix a bug where HAProxy server handler throws `NPE` if an address fam\u2026", "pr_createdAt": "2020-08-10T04:35:40Z", "pr_url": "https://github.com/line/armeria/pull/2985", "timeline": [{"oid": "870d8cc4c2dcfa94c98794a7d7d92ad0ba385cce", "url": "https://github.com/line/armeria/commit/870d8cc4c2dcfa94c98794a7d7d92ad0ba385cce", "message": "Fix a bug where HAProxy server handler throws `NPE` if an address family is `AF_UNSPEC`\n\nMotivation:\n\nArmeria HAProxy handler considers that a HAProxyMessage contains addresses information.\nHowever, if the address family is `AF_UNSPEC`, the addresses are null always.\nFrom the HAProxy spec, the receiver can accept the connection or reject it.\nThere seems to be no harm ignoring the addresses information.\n\nModifications:\n\n- Ignore proxied addresses information if AddressFamily is `AF_UNSPEC`\n\nResult:\n\n- HAProxy handler does not throw NullPointerException anymore.\n- Fixes #2984", "committedDate": "2020-08-10T04:34:37Z", "type": "commit"}, {"oid": "f028cc0be90a2e4726dc49049377908ed3cf3b97", "url": "https://github.com/line/armeria/commit/f028cc0be90a2e4726dc49049377908ed3cf3b97", "message": "Fix checkstyle", "committedDate": "2020-08-10T05:54:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzcyNjI2MQ==", "url": "https://github.com/line/armeria/pull/2985#discussion_r467726261", "bodyText": "should we also ignore AF_UNIX as well?\n^ Ignore this, an UnknownHostException will be thrown which seems reasonable \ud83d\udc4d", "author": "jrhee17", "createdAt": "2020-08-10T07:21:58Z", "path": "core/src/main/java/com/linecorp/armeria/server/HttpServerPipelineConfigurator.java", "diffHunk": "@@ -370,14 +371,20 @@ protected void decode(ChannelHandlerContext ctx, HAProxyMessage msg, List<Object\n                              msg.destinationAddress(), msg.destinationPort(),\n                              proxiedCandidates);\n             }\n+\n+            final ProxiedAddresses proxiedAddresses;\n+            if (msg.proxiedProtocol().addressFamily() == AddressFamily.AF_UNSPEC) {", "originalCommit": "f028cc0be90a2e4726dc49049377908ed3cf3b97", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1165205512b9bc95f313b2d997c1d7d596c9760b", "url": "https://github.com/line/armeria/commit/1165205512b9bc95f313b2d997c1d7d596c9760b", "message": "Release HAProxyMessage in test", "committedDate": "2020-08-11T09:41:25Z", "type": "commit"}]}