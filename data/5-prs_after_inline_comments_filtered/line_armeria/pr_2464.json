{"pr_number": 2464, "pr_title": "Fix a bug where making IPv6 DnsQuestion when it's not supported", "pr_createdAt": "2020-02-06T12:57:03Z", "pr_url": "https://github.com/line/armeria/pull/2464", "timeline": [{"oid": "5717dc0d7f06fabe4c7dd0f4894bef1650d7bcce", "url": "https://github.com/line/armeria/commit/5717dc0d7f06fabe4c7dd0f4894bef1650d7bcce", "message": "Fix a bug where making IPv6 DnsQuestion when it's not supported\nMotivation:\nIf there's no network interfaces which support IPv6, we must not send a dns query for that.\n\nModification:\n- Check the network interfaces in `DnsAddressEndpointGourp` not to make IPv6 dns query.\n\nResult:\n- Close #2444 perhaps?", "committedDate": "2020-02-06T12:56:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTg2MTc1NQ==", "url": "https://github.com/line/armeria/pull/2464#discussion_r375861755", "bodyText": "I think this code has been around for a long time - does it mean it's not a regression? It seems like it used to work though, but possibly an interaction with something else rather than a regression. Just want to check.", "author": "anuraaga", "createdAt": "2020-02-06T14:23:34Z", "path": "core/src/main/java/com/linecorp/armeria/client/endpoint/dns/DnsAddressEndpointGroup.java", "diffHunk": "@@ -105,7 +106,7 @@ public static DnsAddressEndpointGroupBuilder builder(String hostname) {\n             String hostname, @Nullable ResolvedAddressTypes resolvedAddressTypes) {\n \n         if (resolvedAddressTypes == null) {\n-            if (NetUtil.isIpV4StackPreferred()) {\n+            if (NetUtil.isIpV4StackPreferred() || !anyInterfaceSupportsIpV6()) {", "originalCommit": "5717dc0d7f06fabe4c7dd0f4894bef1650d7bcce", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTg2OTIyNQ==", "url": "https://github.com/line/armeria/pull/2464#discussion_r375869225", "bodyText": "Yeah, I might make this too impromptu. Let me dig this more tomorrow. \ud83d\ude05", "author": "minwoox", "createdAt": "2020-02-06T14:36:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTg2MTc1NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjI2Mzk1Nw==", "url": "https://github.com/line/armeria/pull/2464#discussion_r376263957", "bodyText": "@anuraaga, it now skips link-local addresses as well. Shall we merge, release and see if the problem goes away?", "author": "trustin", "createdAt": "2020-02-07T08:22:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTg2MTc1NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjI2NDcyNQ==", "url": "https://github.com/line/armeria/pull/2464#discussion_r376264725", "bodyText": "Yeah let's try", "author": "anuraaga", "createdAt": "2020-02-07T08:24:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTg2MTc1NQ=="}], "type": "inlineReview"}, {"oid": "54eecb92e93459abccc7046d633ad57dcc4c141a", "url": "https://github.com/line/armeria/commit/54eecb92e93459abccc7046d633ad57dcc4c141a", "message": "Add more conditions to check for IPv6", "committedDate": "2020-02-07T08:19:25Z", "type": "commit"}]}