{"pr_number": 3004, "pr_title": "Make `RequestContext.setAttr()` return an old value / Remove `*AttrIf\u2026", "pr_createdAt": "2020-08-19T05:52:56Z", "pr_url": "https://github.com/line/armeria/pull/3004", "timeline": [{"oid": "6b8ce13a7e0d83aac3b0bb76196b816e40bee771", "url": "https://github.com/line/armeria/commit/6b8ce13a7e0d83aac3b0bb76196b816e40bee771", "message": "Make `RequestContext.setAttr()` return an old value / Remove `*AttrIfAbsent()`\n\nMotivation:\n\n- A user would expect the behavior similar to `Map.put()` when setting a\n  context attribute. However, `RequestContext.setAttr()` does not return\n  anything.\n- The behavior of `setAttrIfAbsent()` and `computeAttrIfAbsent()` where\n  they set the attribute only when 'own attribute' is absent can be\n  confusing to a user. (That is, it will set an attribute even if\n  there's already an attribute in the root context.)\n  - Adding more variants of those methods would increase the cognitive\n    load of the context API. Given that they are not really used often,\n    it's better removing them entirely for simplicity.\n\nModifications:\n\n- Made `RequestContext.setAttr()` return the old attribute value,\n  looking up the root context if necessary.\n- Removed `RequestContext.setAttrIfAbsent()` and `computeAttrIfAbsent()`\n\nResult:\n\n- Closes #2997\n- `RequestContext.setAttr()` now returns the old attribute value,\n  looking up the root context if necessary.\n- (Breaking) `RequestContext.setAttrIfAbsent()` and\n  `computeAttrIfAbsent()` have been removed. Use `hasOwnAttr()` and\n  `setAttr()` instead:\n\n  ```java\n  if (ctx.hasOwnAttr(MY_ATTR)) {\n      ctx.setAttr(MY_ATTR, newValue);\n  }\n  ```", "committedDate": "2020-08-19T05:44:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjgyNjQ5OA==", "url": "https://github.com/line/armeria/pull/3004#discussion_r472826498", "bodyText": "Glad that we can remove this. \ud83d\ude09", "author": "minwoox", "createdAt": "2020-08-19T07:54:21Z", "path": "core/src/main/java/com/linecorp/armeria/common/DefaultAttributeMap.java", "diffHunk": "@@ -132,19 +131,13 @@ private static int index(AttributeKey<?> key) {\n     }\n \n     @Nullable\n-    <T> T setAttrIfAbsent(AttributeKey<T> key, @Nullable T value) {", "originalCommit": "6b8ce13a7e0d83aac3b0bb76196b816e40bee771", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}