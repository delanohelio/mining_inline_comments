{"pr_number": 3060, "pr_title": "Handle request timeout correctly for HTTP", "pr_createdAt": "2020-09-14T13:04:34Z", "pr_url": "https://github.com/line/armeria/pull/3060", "timeline": [{"oid": "4cdc7da88721c1dc3345d323b0f10ecc336034ec", "url": "https://github.com/line/armeria/commit/4cdc7da88721c1dc3345d323b0f10ecc336034ec", "message": "handle http1 request timeout response", "committedDate": "2020-09-16T15:09:14Z", "type": "forcePushed"}, {"oid": "fdb2ba09c3da08ab7688d5247d2f6b5d01bb0cfe", "url": "https://github.com/line/armeria/commit/fdb2ba09c3da08ab7688d5247d2f6b5d01bb0cfe", "message": "also handle really missing res case", "committedDate": "2021-04-17T00:49:32Z", "type": "forcePushed"}, {"oid": "35716c2c3fdf3e298241f796f0ddf3f32e0483b0", "url": "https://github.com/line/armeria/commit/35716c2c3fdf3e298241f796f0ddf3f32e0483b0", "message": "handle warning log for request timeout", "committedDate": "2021-04-28T15:42:39Z", "type": "forcePushed"}, {"oid": "53d322c46a198a540c368ccc8bcb610648fafdbb", "url": "https://github.com/line/armeria/commit/53d322c46a198a540c368ccc8bcb610648fafdbb", "message": "handle warning log for request timeout", "committedDate": "2021-04-28T21:15:53Z", "type": "commit"}, {"oid": "53d322c46a198a540c368ccc8bcb610648fafdbb", "url": "https://github.com/line/armeria/commit/53d322c46a198a540c368ccc8bcb610648fafdbb", "message": "handle warning log for request timeout", "committedDate": "2021-04-28T21:15:53Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMzY1NDU2Mg==", "url": "https://github.com/line/armeria/pull/3060#discussion_r623654562", "bodyText": "Revert?\n\n  \n    \n      \n        Suggested change", "author": "trustin", "createdAt": "2021-04-30T07:01:10Z", "path": "core/src/main/java/com/linecorp/armeria/client/Http1ResponseDecoder.java", "diffHunk": "@@ -154,6 +154,7 @@ public void channelRead(ChannelHandlerContext ctx, Object msg) throws Exception\n             switch (state) {\n                 case NEED_HEADERS:\n                     if (msg instanceof HttpResponse) {\n+", "originalCommit": "53d322c46a198a540c368ccc8bcb610648fafdbb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMzY1NTE3MA==", "url": "https://github.com/line/armeria/pull/3060#discussion_r623655170", "bodyText": "A little bit of Javadoc would be nice, with a link to the related GH issue.", "author": "trustin", "createdAt": "2021-04-30T07:02:18Z", "path": "core/src/main/java/com/linecorp/armeria/internal/common/ArmeriaHttpUtil.java", "diffHunk": "@@ -1124,5 +1125,10 @@ public static String authorityHeader(String host, int port, int defaultPort) {\n         }\n     }\n \n+    public static boolean isRequestTimeoutResponse(HttpResponse httpResponse) {", "originalCommit": "53d322c46a198a540c368ccc8bcb610648fafdbb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "ae4bd57d912451e422f49e60bc91cc35ac7e9345", "url": "https://github.com/line/armeria/commit/ae4bd57d912451e422f49e60bc91cc35ac7e9345", "message": "Merge branch 'master' into pr-3060@jrhee17+bugfix/handle-request-timeout", "committedDate": "2021-04-30T07:07:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMzY3NTY0Mg==", "url": "https://github.com/line/armeria/pull/3060#discussion_r623675642", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                    if (res == null && ArmeriaHttpUtil.isRequestTimeoutResponse((HttpResponse) msg)) {\n          \n          \n            \n                                    if (res == null && ArmeriaHttpUtil.isRequestTimeoutResponse(nettyRes) {", "author": "ikhoon", "createdAt": "2021-04-30T07:33:32Z", "path": "core/src/main/java/com/linecorp/armeria/client/Http1ResponseDecoder.java", "diffHunk": "@@ -166,6 +167,10 @@ public void channelRead(ChannelHandlerContext ctx, Object msg) throws Exception\n                         }\n \n                         final HttpResponseWrapper res = getResponse(resId);\n+                        if (res == null && ArmeriaHttpUtil.isRequestTimeoutResponse((HttpResponse) msg)) {", "originalCommit": "ae4bd57d912451e422f49e60bc91cc35ac7e9345", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMzY4MDc2Nw==", "url": "https://github.com/line/armeria/pull/3060#discussion_r623680767", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            public class Http1ResponseDecoderTest {\n          \n          \n            \n            class Http1ResponseDecoderTest {", "author": "ikhoon", "createdAt": "2021-04-30T07:43:02Z", "path": "core/src/test/java/com/linecorp/armeria/client/Http1ResponseDecoderTest.java", "diffHunk": "@@ -0,0 +1,51 @@\n+/*\n+ * Copyright 2020 LINE Corporation\n+ *\n+ * LINE Corporation licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package com.linecorp.armeria.client;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+import org.junit.jupiter.api.Test;\n+\n+import io.netty.channel.embedded.EmbeddedChannel;\n+import io.netty.handler.codec.http.DefaultHttpHeaders;\n+import io.netty.handler.codec.http.DefaultHttpResponse;\n+import io.netty.handler.codec.http.HttpHeaderNames;\n+import io.netty.handler.codec.http.HttpHeaders;\n+import io.netty.handler.codec.http.HttpResponseStatus;\n+import io.netty.handler.codec.http.HttpVersion;\n+\n+public class Http1ResponseDecoderTest {", "originalCommit": "ae4bd57d912451e422f49e60bc91cc35ac7e9345", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "9a1facc528dd7c5f854387d0d00c160ec2382552", "url": "https://github.com/line/armeria/commit/9a1facc528dd7c5f854387d0d00c160ec2382552", "message": "remove public for junit5, add javadoc, remove newline", "committedDate": "2021-04-30T09:19:10Z", "type": "commit"}, {"oid": "b958f5af23eb69c58b6602db5e3a1626017edaea", "url": "https://github.com/line/armeria/commit/b958f5af23eb69c58b6602db5e3a1626017edaea", "message": "revert another newline delete, fix grammar", "committedDate": "2021-04-30T09:20:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMzczOTk3OQ==", "url": "https://github.com/line/armeria/pull/3060#discussion_r623739979", "bodyText": "\ud83d\udc4d", "author": "ikhoon", "createdAt": "2021-04-30T09:23:55Z", "path": "core/src/main/java/com/linecorp/armeria/internal/common/ArmeriaHttpUtil.java", "diffHunk": "@@ -1124,5 +1125,14 @@ public static String authorityHeader(String host, int port, int defaultPort) {\n         }\n     }\n \n+    /**\n+     * A 408 request timeout response can be received even without a request.\n+     * More details can be found at https://github.com/line/armeria/issues/3055.", "originalCommit": "b958f5af23eb69c58b6602db5e3a1626017edaea", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMzc0MDQ4NQ==", "url": "https://github.com/line/armeria/pull/3060#discussion_r623740485", "bodyText": "nit:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * A 408 request timeout response can be received even without a request.\n          \n          \n            \n                 * A 408 Request Timeout response can be received even without a request.", "author": "ikhoon", "createdAt": "2021-04-30T09:24:36Z", "path": "core/src/main/java/com/linecorp/armeria/internal/common/ArmeriaHttpUtil.java", "diffHunk": "@@ -1124,5 +1125,14 @@ public static String authorityHeader(String host, int port, int defaultPort) {\n         }\n     }\n \n+    /**\n+     * A 408 request timeout response can be received even without a request.", "originalCommit": "b958f5af23eb69c58b6602db5e3a1626017edaea", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "2c0e186ed206e7c877a11b06617a11382fd61332", "url": "https://github.com/line/armeria/commit/2c0e186ed206e7c877a11b06617a11382fd61332", "message": "capitalization", "committedDate": "2021-04-30T09:28:38Z", "type": "commit"}]}