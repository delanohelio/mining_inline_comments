{"pr_number": 2454, "pr_title": "Do not use type parameter for builder self type in public API", "pr_createdAt": "2020-02-05T09:42:28Z", "pr_url": "https://github.com/line/armeria/pull/2454", "timeline": [{"oid": "7e5bc3df96e26ae89e24d92a141e13f21a43d706", "url": "https://github.com/line/armeria/commit/7e5bc3df96e26ae89e24d92a141e13f21a43d706", "message": "Do not use type parameter for builder self type in public API\n\nMotivation:\n\nBuilder self type parameter is very useful when writing builders with\ntype hierarchy, but it often results in bad-looking Javadoc, because the\nreturn type is not shown as the actual return type but just as a type\nparameter name, such as `B` or `SELF`.\n\nModifications:\n\n- Remove self type parameters from all public builder types and\n  explicitly override the return types.\n- Miscellaneous:\n  - Add `ServerBuilder.gracefulShutdownTimeoutMillis(long, long)` and\n    deprecate `gracefulShutdownTimeout(long, long)`.\n\nResult:\n\n- More intuitive Javadoc\n- Devs need to be cautious when adding a new method to builders.", "committedDate": "2020-02-05T09:41:39Z", "type": "commit"}, {"oid": "ccb30a811f0d2d7e36053bc1f71129d36ab5ae08", "url": "https://github.com/line/armeria/commit/ccb30a811f0d2d7e36053bc1f71129d36ab5ae08", "message": "Checkstyle", "committedDate": "2020-02-05T09:56:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTYxMDYzMQ==", "url": "https://github.com/line/armeria/pull/2454#discussion_r375610631", "bodyText": "nit: I think we need to change this as well because it's duration.", "author": "minwoox", "createdAt": "2020-02-06T02:19:52Z", "path": "core/src/main/java/com/linecorp/armeria/server/ServerBuilder.java", "diffHunk": "@@ -588,29 +588,48 @@ public ServerBuilder http1MaxChunkSize(int http1MaxChunkSize) {\n      * requests to go away before actually shutting down.\n      *\n      * @param quietPeriodMillis the number of milliseconds to wait for active\n-     *     requests to go end before shutting down. 0 means the server will\n-     *     stop right away without waiting.\n+     *                          requests to go end before shutting down. 0 means the server will\n+     *                          stop right away without waiting.\n      * @param timeoutMillis the number of milliseconds to wait before shutting\n-     *     down the server regardless of active requests. This should be set to\n-     *     a time greater than {@code quietPeriodMillis} to ensure the server\n-     *     shuts down even if there is a stuck request.\n+     *                      down the server regardless of active requests. This should be set to\n+     *                      a time greater than {@code quietPeriodMillis} to ensure the server\n+     *                      shuts down even if there is a stuck request.\n      */\n-    public ServerBuilder gracefulShutdownTimeout(long quietPeriodMillis, long timeoutMillis) {\n+    public ServerBuilder gracefulShutdownTimeoutMillis(long quietPeriodMillis, long timeoutMillis) {\n         return gracefulShutdownTimeout(\n                 Duration.ofMillis(quietPeriodMillis), Duration.ofMillis(timeoutMillis));\n     }\n \n+    /**\n+     * Sets the amount of time to wait after calling {@link Server#stop()} for\n+     * requests to go away before actually shutting down.\n+     *\n+     * @param quietPeriodMillis the number of milliseconds to wait for active\n+     *                          requests to go end before shutting down. 0 means the server will\n+     *                          stop right away without waiting.\n+     * @param timeoutMillis the number of milliseconds to wait before shutting\n+     *                      down the server regardless of active requests. This should be set to\n+     *                      a time greater than {@code quietPeriodMillis} to ensure the server\n+     *                      shuts down even if there is a stuck request.\n+     *\n+     * @deprecated Use {@link #gracefulShutdownTimeoutMillis(long, long)}.\n+     */\n+    @Deprecated\n+    public ServerBuilder gracefulShutdownTimeout(long quietPeriodMillis, long timeoutMillis) {\n+        return gracefulShutdownTimeoutMillis(quietPeriodMillis, timeoutMillis);\n+    }\n+\n     /**\n      * Sets the amount of time to wait after calling {@link Server#stop()} for\n      * requests to go away before actually shutting down.\n      *\n      * @param quietPeriod the number of milliseconds to wait for active\n-     *     requests to go end before shutting down. {@link Duration#ZERO} means\n-     *     the server will stop right away without waiting.\n+     *                    requests to go end before shutting down. {@link Duration#ZERO} means\n+     *                    the server will stop right away without waiting.\n      * @param timeout the number of milliseconds to wait before shutting", "originalCommit": "ccb30a811f0d2d7e36053bc1f71129d36ab5ae08", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "2ef9a2125f19097bd8a7cbdef6ec54ea4507534c", "url": "https://github.com/line/armeria/commit/2ef9a2125f19097bd8a7cbdef6ec54ea4507534c", "message": "Merge branch 'master' into client_builder_return_type", "committedDate": "2020-02-06T08:24:36Z", "type": "commit"}, {"oid": "2d915f42779e3bf4e61fbee65622b58193158f94", "url": "https://github.com/line/armeria/commit/2d915f42779e3bf4e61fbee65622b58193158f94", "message": "Address the comment from @minwoox", "committedDate": "2020-02-06T08:28:39Z", "type": "commit"}]}