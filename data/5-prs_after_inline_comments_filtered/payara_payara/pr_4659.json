{"pr_number": 4659, "pr_title": "ECOSYS-157 OpenID Connect Caller's name and groups are null", "pr_createdAt": "2020-05-08T08:45:19Z", "pr_url": "https://github.com/payara/Payara/pull/4659", "timeline": [{"oid": "d04701c6b65e8549ed91c6f9c93538a40cabe223", "url": "https://github.com/payara/Payara/commit/d04701c6b65e8549ed91c6f9c93538a40cabe223", "message": "ECOSYS-157 OpenID Connect Caller's name and groups are null", "committedDate": "2020-05-08T07:52:13Z", "type": "commit"}, {"oid": "b72d4f7d2e307a7e5720abe44824e9db862e0163", "url": "https://github.com/payara/Payara/commit/b72d4f7d2e307a7e5720abe44824e9db862e0163", "message": "ECOSYS-157 OpenId test case fix", "committedDate": "2020-05-08T12:53:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzg4NzU4OQ==", "url": "https://github.com/payara/Payara/pull/4659#discussion_r423887589", "bodyText": "Hi, what is the reason of adding extra redirectURI.contains(request.getServletPath()) check?\nit breaks existing applications, (I just debugged it),\nif redirectURI is \"https://localhost:8181/myapp/\" and a welcome file is specified, i.e.\n\nfaces/About.xhtml\n\nrequest.getServletPath() returns \"/faces\" and this check fails. In case of index.html it returns \"/index.html\". Setting welcome-file to \"/\" makes authentication work again, but breaks user experience.", "author": "NikitaZ", "createdAt": "2020-05-12T16:54:36Z", "path": "appserver/payara-appserver-modules/security-openid/src/main/java/fish/payara/security/openid/OpenIdAuthenticationMechanism.java", "diffHunk": "@@ -235,21 +236,22 @@ private AuthenticationStatus authenticate(\n \n         Optional<OpenIdState> receivedState = OpenIdState.from(request.getParameter(STATE));\n         String redirectURI = configuration.buildRedirectURI(request);\n-        if (receivedState.isPresent()\n-                && request.getRequestURL().toString().equals(redirectURI)) {\n-\n+        if (receivedState.isPresent() && redirectURI.contains(request.getServletPath())) {", "originalCommit": "b72d4f7d2e307a7e5720abe44824e9db862e0163", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzg5MDExOA==", "url": "https://github.com/payara/Payara/pull/4659#discussion_r423890118", "bodyText": "I don't think I want to set redirectURI to https://localhost:8181/myapp/faces/About.xhtml, it breaks the idea of welcome-file, if it changes one also have to change configuration at openID provider (Google Cloud in my case). Or we have to add a servlet for redirect URI and then forward to proper page which again reinvents welcome-file. Please, advice!", "author": "NikitaZ", "createdAt": "2020-05-12T16:58:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzg4NzU4OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjcwNzYxMg==", "url": "https://github.com/payara/Payara/pull/4659#discussion_r426707612", "bodyText": "Thanks Nikita,\nI also confirm the issue, if the callback URL is mapped to home. Updated the PR.", "author": "jGauravGupta", "createdAt": "2020-05-18T15:24:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzg4NzU4OQ=="}], "type": "inlineReview"}, {"oid": "998710cb12a6d9806cb2b4cb5bbc7326066a15fe", "url": "https://github.com/payara/Payara/commit/998710cb12a6d9806cb2b4cb5bbc7326066a15fe", "message": "ECOSYS-157 Remove redirectURI extra check", "committedDate": "2020-05-18T15:20:14Z", "type": "commit"}]}