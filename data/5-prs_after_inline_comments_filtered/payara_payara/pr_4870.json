{"pr_number": 4870, "pr_title": "FISH-37 URL in DataSourceDefinition overrides serverName", "pr_createdAt": "2020-09-03T09:28:49Z", "pr_url": "https://github.com/payara/Payara/pull/4870", "timeline": [{"oid": "adbf2be4fd02b2f79f5c7f8d977df14ac72b3eb6", "url": "https://github.com/payara/Payara/commit/adbf2be4fd02b2f79f5c7f8d977df14ac72b3eb6", "message": "FISH-37 URL in DataSourceDefinition overrides serverName\n\nIf URL has been set it should override the serverName, causing that to be set to null\nto prevent that being using when the DataSource is initialised\n\nFixes #4385", "committedDate": "2020-09-03T09:15:07Z", "type": "commit"}, {"oid": "7d074a71f66775c60bd0c6e38a13fa6bbe1350c0", "url": "https://github.com/payara/Payara/commit/7d074a71f66775c60bd0c6e38a13fa6bbe1350c0", "message": "FISH-37 Written additional test case for serverName not being overriden", "committedDate": "2020-09-03T09:34:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzUwMTczNg==", "url": "https://github.com/payara/Payara/pull/4870#discussion_r483501736", "bodyText": "Can you make a small change to the DataSourceDefinitionDescriptor.setServerName(String serverName) method please to reflect this.\nThat method sets a boolean of serverNameSet to true, which when you're setting it to null probably shouldn't be the case :)", "author": "Pandrex247", "createdAt": "2020-09-04T09:28:09Z", "path": "appserver/jdbc/jdbc-runtime/src/main/java/org/glassfish/jdbcruntime/deployment/annotation/handlers/DataSourceDefinitionHandler.java", "diffHunk": "@@ -394,11 +394,12 @@ private DataSourceDefinitionDescriptor createDescriptor(DataSourceDefinition def\n             desc.setDatabaseName(defn.databaseName());\n         }\n \n-        if ((desc.getPortNumber() != -1 && desc.getDatabaseName() != null && desc.getServerName() != null)) {\n+        if (desc.getPortNumber() != -1 && desc.getDatabaseName() != null && desc.getServerName() != null) {\n             //standard properties are set, ignore URL\n         } else {\n             if (defn.url() != null && !defn.url().equals(\"\")) {\n                 desc.setUrl(defn.url());\n+                desc.setServerName(null); //To prevent serverName overriding the URL, always use the URL if the standard properties are not set", "originalCommit": "7d074a71f66775c60bd0c6e38a13fa6bbe1350c0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "36739b4a5d8682babbef8f7b3fd86272d654a4d8", "url": "https://github.com/payara/Payara/commit/36739b4a5d8682babbef8f7b3fd86272d654a4d8", "message": "FISH-37 serverNameSet set to false if serverName set to null", "committedDate": "2020-09-04T10:26:33Z", "type": "commit"}]}