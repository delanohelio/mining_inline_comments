{"pr_number": 4641, "pr_title": "QACI-95 Refactor Payara Samples", "pr_createdAt": "2020-04-25T12:53:34Z", "pr_url": "https://github.com/payara/Payara/pull/4641", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQzNDUxOQ==", "url": "https://github.com/payara/Payara/pull/4641#discussion_r419434519", "bodyText": "The only test I see that requires a clean domain is the dataGridEncryptionWarning test, which surely could also be acheived by making the other test that creates the key clean up after itself properly?", "author": "Pandrex247", "createdAt": "2020-05-04T13:27:20Z", "path": "appserver/tests/payara-samples/samples/asadmin/src/test/java/fish/payara/samples/asadmin/SetHazelcastConfigurationTest.java", "diffHunk": "@@ -39,15 +39,22 @@\n  */\n package fish.payara.samples.asadmin;\n \n+import fish.payara.nucleus.hazelcast.HazelcastRuntimeConfiguration;\n+import fish.payara.samples.Unstable;\n+\n import org.glassfish.embeddable.CommandResult;\n import org.junit.Before;\n import org.junit.Test;\n-\n-import fish.payara.nucleus.hazelcast.HazelcastRuntimeConfiguration;\n+import org.junit.experimental.categories.Category;\n \n /**\n  * Verifies the correctness of the {@code SetHazelcastConfiguration} command.\n  */\n+@Category(Unstable.class)\n+// Fails from two reasons:\n+// 1) Requires completely new domain. Side effects of other tests break this one.", "originalCommit": "726655546a49325165a0e288228490a54061b3e1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTc1NzMyNA==", "url": "https://github.com/payara/Payara/pull/4641#discussion_r419757324", "bodyText": "Both should clean up after their run. Or better we should have some architecture in tests so instead of testing \"random\" features in random order we could join them to some scenarios, use cases, categories/groups (?) and each category would start with a new domain. Then we can have a control over it, but imagine we would have thousand of tests in payara samples - which of those test result states interact with any other? The current state of things is not maintainable in larger scope.", "author": "dmatej", "createdAt": "2020-05-04T22:06:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQzNDUxOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQzNTA2Mw==", "url": "https://github.com/payara/Payara/pull/4641#discussion_r419435063", "bodyText": "Why are we introducing things that don't work on what is arguably the primary java version?", "author": "Pandrex247", "createdAt": "2020-05-04T13:28:05Z", "path": "appserver/tests/payara-samples/samples/asadmin/src/test/java/fish/payara/samples/asadmin/SetHazelcastConfigurationTest.java", "diffHunk": "@@ -39,15 +39,22 @@\n  */\n package fish.payara.samples.asadmin;\n \n+import fish.payara.nucleus.hazelcast.HazelcastRuntimeConfiguration;\n+import fish.payara.samples.Unstable;\n+\n import org.glassfish.embeddable.CommandResult;\n import org.junit.Before;\n import org.junit.Test;\n-\n-import fish.payara.nucleus.hazelcast.HazelcastRuntimeConfiguration;\n+import org.junit.experimental.categories.Category;\n \n /**\n  * Verifies the correctness of the {@code SetHazelcastConfiguration} command.\n  */\n+@Category(Unstable.class)\n+// Fails from two reasons:\n+// 1) Requires completely new domain. Side effects of other tests break this one.\n+// 2) On JDK8 fails because of usage of @Category annotation which has problems with", "originalCommit": "726655546a49325165a0e288228490a54061b3e1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ1NjI0Mg==", "url": "https://github.com/payara/Payara/pull/4641#discussion_r419456242", "bodyText": "Agree. Eventually we might start using JUnit5 but this should be a planned step.", "author": "jbee", "createdAt": "2020-05-04T13:57:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQzNTA2Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTczMDE1Nw==", "url": "https://github.com/payara/Payara/pull/4641#discussion_r419730157", "bodyText": "First Categories are used in JUnit4 as a standard for maybe 15 years and they do work.\nProbably this issue is caused by interaction with this in PayaraArquillianTestRunner or some of our other custom implementations \"hacking\" JUnit4 standards. But it is worthless to investigate, because the test does not work at all.\nAnd if it would, we would not need the category ;)", "author": "dmatej", "createdAt": "2020-05-04T21:09:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQzNTA2Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTc0NjAwMg==", "url": "https://github.com/payara/Payara/pull/4641#discussion_r419746002", "bodyText": "https://dzone.com/articles/closer-look-junit-categories (2010)", "author": "dmatej", "createdAt": "2020-05-04T21:41:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQzNTA2Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTkzNDI5NQ==", "url": "https://github.com/payara/Payara/pull/4641#discussion_r419934295", "bodyText": "Okay, thought the issue here was related to use of a feature that was introduced later.", "author": "jbee", "createdAt": "2020-05-05T08:10:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQzNTA2Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDAxODQzNA==", "url": "https://github.com/payara/Payara/pull/4641#discussion_r420018434", "bodyText": "Maybe we should use categories instead of NotMicroCompatible too, but ... I think there will be more work with Andrew's point around repeatibility of tests. Probably it could spark some more stable (and faster and cheaper) architecture of tests, I will think about it :-)", "author": "dmatej", "createdAt": "2020-05-05T10:45:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQzNTA2Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ0NzE2Nw==", "url": "https://github.com/payara/Payara/pull/4641#discussion_r419447167", "bodyText": "Why less indent? 8 spaces is the default for breaking up long lines.\nAlso what's with the random empty comments?", "author": "Pandrex247", "createdAt": "2020-05-04T13:45:05Z", "path": "appserver/tests/payara-samples/samples/payara-expression-config-properties/src/test/java/fish/payara/samples/microprofile/config/expression/PayaraExpressionConfigPropertiesTest.java", "diffHunk": "@@ -71,14 +70,16 @@\n     @Deployment(testable = false)\n     public static WebArchive createDeployment() {\n         return ShrinkWrap.create(WebArchive.class, \"microprofile-config-expression.war\")\n-                .addPackage(\"fish.payara.samples.microprofile.config.expression\")\n-                .addAsManifestResource(new File(\"src/main/resources/META-INF/payara-expression-config.properties\"));\n+            .addPackage(ConfigServlet.class.getPackage()) //", "originalCommit": "726655546a49325165a0e288228490a54061b3e1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTc0MDEyNA==", "url": "https://github.com/payara/Payara/pull/4641#discussion_r419740124", "bodyText": "It is called a \"phantom comment\". In some circumstances it is best possible way to protected readable code from automatic reformatting.\nI don't see 2 block indent useful and always used 1 block, but yes, in Eclipse default is 2 blocks (8 spaces). Honestly I don't see it as a most important thing worth of discussion.", "author": "dmatej", "createdAt": "2020-05-04T21:29:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ0NzE2Nw=="}], "type": "inlineReview"}, {"oid": "0e7db0f1ab281136ddfbff3de3b59f184b5fb20a", "url": "https://github.com/payara/Payara/commit/0e7db0f1ab281136ddfbff3de3b59f184b5fb20a", "message": "QACI-95 Excluded javax dependencies brought by smallrye-config", "committedDate": "2020-07-20T06:20:06Z", "type": "forcePushed"}, {"oid": "49267331a176fad3d62ee4f54ef8f515344eff0f", "url": "https://github.com/payara/Payara/commit/49267331a176fad3d62ee4f54ef8f515344eff0f", "message": "QACI-95 Payara Embedded tests moved from Payara Samples to Payara Embedded", "committedDate": "2020-07-20T19:12:36Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzYzNzIyNQ==", "url": "https://github.com/payara/Payara/pull/4641#discussion_r457637225", "bodyText": "Probably better link:\nhttps://bugs.java.com/bugdatabase/view_bug.do?bug_id=JDK-7183985", "author": "dmatej", "createdAt": "2020-07-20T19:20:25Z", "path": "appserver/tests/payara-samples/samples/asadmin/src/test/java/fish/payara/samples/asadmin/SetHazelcastConfigurationTest.java", "diffHunk": "@@ -39,15 +39,22 @@\n  */\n package fish.payara.samples.asadmin;\n \n+import fish.payara.nucleus.hazelcast.HazelcastRuntimeConfiguration;\n+import fish.payara.samples.Unstable;\n+\n import org.glassfish.embeddable.CommandResult;\n import org.junit.Before;\n import org.junit.Test;\n-\n-import fish.payara.nucleus.hazelcast.HazelcastRuntimeConfiguration;\n+import org.junit.experimental.categories.Category;\n \n /**\n  * Verifies the correctness of the {@code SetHazelcastConfiguration} command.\n  */\n+@Category(Unstable.class)\n+// Fails from two reasons:\n+// 1) Requires completely new domain. Side effects of other tests break this one.\n+// 2) On JDK8 fails because of usage of @Category annotation which has problems with\n+//    this bug: https://bugs.java.com/bugdatabase/view_bug.do?bug_id=8209742 (fixed in JDK11)", "originalCommit": "49267331a176fad3d62ee4f54ef8f515344eff0f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzYzNzc0OA==", "url": "https://github.com/payara/Payara/pull/4641#discussion_r457637748", "bodyText": "Deleted trailing spaces.", "author": "dmatej", "createdAt": "2020-07-20T19:21:17Z", "path": "appserver/tests/payara-samples/samples/asadmin/src/test/java/fish/payara/samples/asadmin/SetHealthCheckServiceConfigurationTest.java", "diffHunk": "@@ -83,13 +83,13 @@ public void setUp() {\n ", "originalCommit": "49267331a176fad3d62ee4f54ef8f515344eff0f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzYzODgwNw==", "url": "https://github.com/payara/Payara/pull/4641#discussion_r457638807", "bodyText": "Fixed to respect the current implementation.", "author": "dmatej", "createdAt": "2020-07-20T19:23:17Z", "path": "appserver/tests/payara-samples/samples/asadmin/src/test/java/fish/payara/samples/asadmin/SetHealthCheckServiceConfigurationTest.java", "diffHunk": "@@ -261,17 +261,17 @@ public void hogginThreadsThresholdDynamicAffectsConfigAndService() {\n \n     @Test\n     public void hogginThreadsRetryCountBelowMinimumCausesError() {\n-        CommandResult result = asadmin(\"set-healthcheck-service-configuration\", \n+        CommandResult result = asadmin(\"set-healthcheck-service-configuration\",\n                 \"--service\", \"ht\",\n                 \"--enabled\", \"true\",\n-                \"--hogging-threads-retry-count\", \"0\");", "originalCommit": "49267331a176fad3d62ee4f54ef8f515344eff0f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzY0MDE3NA==", "url": "https://github.com/payara/Payara/pull/4641#discussion_r457640174", "bodyText": "I noticed the Jenkins build is much slower now. What is the cause? Is PayaraArquillianTestRunner slower than Arquillian? (just a first idea)\nEDIT: probably no. The reason is probably in enabling tests with secure endponts.", "author": "dmatej", "createdAt": "2020-07-20T19:25:55Z", "path": "appserver/tests/payara-samples/samples/ejb-invoker-secure-endpoint/src/test/java/fish/payara/samples/ejb/invoker/security/RemoteBeanBasicAuthTest.java", "diffHunk": "@@ -55,7 +56,8 @@\n  * BASIC Auth.\n  *\n  */\n-@RunWith(Arquillian.class)", "originalCommit": "49267331a176fad3d62ee4f54ef8f515344eff0f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "b25ef7ae7ed2c0307770201acee3ebd918b332ef", "url": "https://github.com/payara/Payara/commit/b25ef7ae7ed2c0307770201acee3ebd918b332ef", "message": "QACI-95 Payara Embedded tests moved from Payara Samples to Payara Embedded", "committedDate": "2020-07-26T10:03:01Z", "type": "forcePushed"}, {"oid": "695d6b42e019714137154ab23b5fc78b58b18c61", "url": "https://github.com/payara/Payara/commit/695d6b42e019714137154ab23b5fc78b58b18c61", "message": "QACI-95 Another attempt for test stabilization\n\n- using annotations NotMicroCompatible and Category to respect capabilities\n  of the tested impl and dependencies of tests.\n- NotMicroCompatible has argument for string explanation\n- killed tabs and trimmed whitespaces again\n- arquillian update\n- disabled trimming of stacktraces in tests (how can you find what is broken?)\n- note: the SetHazelcastConfigurationTest crashes on JDK8 with profiles\n        unstable+payara-micro-managed. It is caused by the bug in JDK8,\n        fixed in JDK11.\n- using profile to detect if environment is suitable to run the test\n  - added profile auto-skip-test to expression-config-properties which\n    automatically skips the test if there are not configured env properties\n    in expected way. This test is a candidate for TestContainers as it\n    requires external environment configuration.\n- module samples-programmatic renamed to samples-micro-programmatic, which is not\n  executed if the payara-server-remote profile is activated.\n- similar for embedded-vs-jersey", "committedDate": "2020-08-03T08:16:36Z", "type": "commit"}, {"oid": "c61b0b4be32b6e2b4cb0b78f7d185e1642fccc0f", "url": "https://github.com/payara/Payara/commit/c61b0b4be32b6e2b4cb0b78f7d185e1642fccc0f", "message": "QACI-95 PayaraExpressionConfigPropertiesTest - dependencies on system state", "committedDate": "2020-08-03T08:16:36Z", "type": "commit"}, {"oid": "eff7a62be6060519ccd12c84792dfe9580a5de6b", "url": "https://github.com/payara/Payara/commit/eff7a62be6060519ccd12c84792dfe9580a5de6b", "message": "QACI-95 Stabilization of PayaraExpressionConfigPropertiesTest\n\n- somehow interacts with another test, so it must be executed before it.\n- always use target, not src dir", "committedDate": "2020-08-03T08:16:36Z", "type": "commit"}, {"oid": "1ec52ced1254a8579a4c5b2613f42aeb75d30cc3", "url": "https://github.com/payara/Payara/commit/1ec52ced1254a8579a4c5b2613f42aeb75d30cc3", "message": "QACI-95 Excluded javax dependencies brought by smallrye-config", "committedDate": "2020-08-03T08:16:36Z", "type": "commit"}, {"oid": "a7d3f007c6386c1d51d3d96d67cdaf067ede9803", "url": "https://github.com/payara/Payara/commit/a7d3f007c6386c1d51d3d96d67cdaf067ede9803", "message": "QACI-95 Rotate the server.log to avoid collisions with warnings from other tests", "committedDate": "2020-08-03T08:16:36Z", "type": "commit"}, {"oid": "f09817511d3f1fc0231cc7a229c2b7140d41f452", "url": "https://github.com/payara/Payara/commit/f09817511d3f1fc0231cc7a229c2b7140d41f452", "message": "QACI-95 Payara Embedded tests moved from Payara Samples to Payara Embedded", "committedDate": "2020-08-03T08:16:36Z", "type": "commit"}, {"oid": "f09817511d3f1fc0231cc7a229c2b7140d41f452", "url": "https://github.com/payara/Payara/commit/f09817511d3f1fc0231cc7a229c2b7140d41f452", "message": "QACI-95 Payara Embedded tests moved from Payara Samples to Payara Embedded", "committedDate": "2020-08-03T08:16:36Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTE5NzY4Nw==", "url": "https://github.com/payara/Payara/pull/4641#discussion_r465197687", "bodyText": "This test consumed logs also from previous executions. Some of them logged warnings.", "author": "dmatej", "createdAt": "2020-08-04T17:02:02Z", "path": "appserver/tests/payara-samples/samples/rest-management/src/test/java/fish/payara/samples/rest/management/ServerLogTest.java", "diffHunk": "@@ -39,24 +39,41 @@\n  */\r\n package fish.payara.samples.rest.management;\r\n \r\n+import static org.junit.Assert.assertEquals;\r\n import static org.junit.Assert.assertFalse;\r\n \r\n+import fish.payara.samples.ServerOperations;\r\n+\r\n import java.util.Scanner;\r\n \r\n+import javax.ws.rs.client.Entity;\r\n+import javax.ws.rs.core.Response;\r\n+\r\n+import org.junit.Before;\r\n import org.junit.Test;\r\n \r\n /**\r\n  * Tests to run against the server log\r\n  */\r\n public class ServerLogTest extends RestManagementTest {\r\n \r\n+    @Before\r\n+    public void resetLogging() throws Exception {\r", "originalCommit": "f09817511d3f1fc0231cc7a229c2b7140d41f452", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTE5ODA0Nw==", "url": "https://github.com/payara/Payara/pull/4641#discussion_r465198047", "bodyText": "Added possible explanation why it is not micro compatible.", "author": "dmatej", "createdAt": "2020-08-04T17:02:45Z", "path": "appserver/tests/payara-samples/test-utils/src/main/java/fish/payara/samples/NotMicroCompatible.java", "diffHunk": "@@ -48,15 +48,17 @@\n /**\n  * Annotation used to specify that a test is not applicable to Payara Micro\n  * Use in combination with <code>@RunWith(PayaraTestRunner.class)</code> or <code>@RunWith(PayaraArquillianTestRunner.class)</code> annotation\n- * \n+ *\n  * Can also be used in conjunction with <code>@SincePayara</code> to denote versioning\n- * \n+ *\n  * @see fish.payara.samples.*\n- * \n+ *\n  * @author Cuba Stanley\n  */\n @Target({ElementType.METHOD, ElementType.TYPE})\n @Retention(RetentionPolicy.RUNTIME)\n @Inherited\n-\n-public @interface NotMicroCompatible {}\n+public @interface NotMicroCompatible {", "originalCommit": "f09817511d3f1fc0231cc7a229c2b7140d41f452", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}