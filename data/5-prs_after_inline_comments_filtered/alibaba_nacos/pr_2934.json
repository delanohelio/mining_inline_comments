{"pr_number": 2934, "pr_title": "[#2933] fixed compatibility issues with older versions", "pr_createdAt": "2020-06-01T07:40:44Z", "pr_url": "https://github.com/alibaba/nacos/pull/2934", "timeline": [{"oid": "6fb27500219346bad0a113bdf39bee935c154d6e", "url": "https://github.com/alibaba/nacos/commit/6fb27500219346bad0a113bdf39bee935c154d6e", "message": "fix: fixed compatibility issues with older versions", "committedDate": "2020-06-01T07:35:21Z", "type": "commit"}, {"oid": "a7556fa7762a889863379cd8ca559813d9670205", "url": "https://github.com/alibaba/nacos/commit/a7556fa7762a889863379cd8ca559813d9670205", "message": "fix: fix old version information not available in new version reality issue", "committedDate": "2020-06-01T08:59:01Z", "type": "commit"}, {"oid": "31694246058ef6c226cba4bf7d39ad3fc4a65362", "url": "https://github.com/alibaba/nacos/commit/31694246058ef6c226cba4bf7d39ad3fc4a65362", "message": "refactor: optimize old version information synchronization logic", "committedDate": "2020-06-01T13:54:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzU3MTYxMw==", "url": "https://github.com/alibaba/nacos/pull/2934#discussion_r433571613", "bodyText": "Why  remove constant value\uff1fI think use constant value will be better", "author": "KomachiSion", "createdAt": "2020-06-02T01:25:25Z", "path": "common/src/main/java/com/alibaba/nacos/common/utils/ByteUtils.java", "diffHunk": "@@ -17,12 +17,13 @@\n package com.alibaba.nacos.common.utils;\n \n import java.nio.charset.Charset;\n-import java.nio.charset.StandardCharsets;\n+", "originalCommit": "31694246058ef6c226cba4bf7d39ad3fc4a65362", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzU4ODQ1Mw==", "url": "https://github.com/alibaba/nacos/pull/2934#discussion_r433588453", "bodyText": "JDK6 does not exist with this constant", "author": "chuntaojun", "createdAt": "2020-06-02T02:34:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzU3MTYxMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzU3MTg3Ng==", "url": "https://github.com/alibaba/nacos/pull/2934#discussion_r433571876", "bodyText": "like before said, I think use constant value will be better.", "author": "KomachiSion", "createdAt": "2020-06-02T01:26:28Z", "path": "common/src/main/java/com/alibaba/nacos/common/utils/StringUtils.java", "diffHunk": "@@ -41,7 +38,7 @@\n     public static final String EMPTY = \"\";\n \n     public static String newString4UTF8(byte[] bytes) {\n-        return new String(bytes, Charset.forName(StandardCharsets.UTF_8.name()));\n+        return new String(bytes, Charset.forName(\"UTF-8\"));", "originalCommit": "31694246058ef6c226cba4bf7d39ad3fc4a65362", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzU3Mjc5Nw==", "url": "https://github.com/alibaba/nacos/pull/2934#discussion_r433572797", "bodyText": "Move this TODO common to deprecated annotation may be better?", "author": "KomachiSion", "createdAt": "2020-06-02T01:29:49Z", "path": "naming/src/main/java/com/alibaba/nacos/naming/cluster/ServerListManager.java", "diffHunk": "@@ -0,0 +1,233 @@\n+/*\n+ * Copyright 1999-2018 Alibaba Group Holding Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.alibaba.nacos.naming.cluster;\n+\n+import com.alibaba.nacos.common.utils.JacksonUtils;\n+import com.alibaba.nacos.core.cluster.Member;\n+import com.alibaba.nacos.core.cluster.MemberChangeEvent;\n+import com.alibaba.nacos.core.cluster.MemberChangeListener;\n+import com.alibaba.nacos.core.cluster.MemberMetaDataConstants;\n+import com.alibaba.nacos.core.cluster.NodeState;\n+import com.alibaba.nacos.core.cluster.ServerMemberManager;\n+import com.alibaba.nacos.core.notify.NotifyCenter;\n+import com.alibaba.nacos.core.utils.ApplicationUtils;\n+import com.alibaba.nacos.naming.consistency.persistent.raft.RaftPeer;\n+import com.alibaba.nacos.naming.misc.GlobalExecutor;\n+import com.alibaba.nacos.naming.misc.Loggers;\n+import com.alibaba.nacos.naming.misc.Message;\n+import com.alibaba.nacos.naming.misc.NamingProxy;\n+import com.alibaba.nacos.naming.misc.ServerStatusSynchronizer;\n+import com.alibaba.nacos.naming.misc.SwitchDomain;\n+import com.alibaba.nacos.naming.misc.Synchronizer;\n+import com.alibaba.nacos.naming.misc.UtilsAndCommons;\n+import com.google.common.collect.Maps;\n+import org.apache.commons.lang3.StringUtils;\n+import org.springframework.stereotype.Component;\n+\n+import javax.annotation.PostConstruct;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.Optional;\n+\n+/**\n+ * The manager to globally refresh and operate server list.\n+ *\n+ * // TODO This object will be deleted sometime after version 1.3.0", "originalCommit": "31694246058ef6c226cba4bf7d39ad3fc4a65362", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzU3MzUwMg==", "url": "https://github.com/alibaba/nacos/pull/2934#discussion_r433573502", "bodyText": "Move this TODO common to deprecated annotation may be better?", "author": "KomachiSion", "createdAt": "2020-06-02T01:32:23Z", "path": "naming/src/main/java/com/alibaba/nacos/naming/controllers/OperatorController.java", "diffHunk": "@@ -200,12 +200,37 @@ public ObjectNode getHealthyServerList(@RequestParam(required = false) boolean h\n         return result;\n     }\n \n+    /**\n+     * This interface will be removed in a future release\n+     *\n+     * // TODO This object will be deleted sometime after version 1.3.0", "originalCommit": "31694246058ef6c226cba4bf7d39ad3fc4a65362", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzU3MzUzMQ==", "url": "https://github.com/alibaba/nacos/pull/2934#discussion_r433573531", "bodyText": "Move this TODO common to deprecated annotation may be better?", "author": "KomachiSion", "createdAt": "2020-06-02T01:32:31Z", "path": "naming/src/main/java/com/alibaba/nacos/naming/controllers/OperatorController.java", "diffHunk": "@@ -200,12 +200,37 @@ public ObjectNode getHealthyServerList(@RequestParam(required = false) boolean h\n         return result;\n     }\n \n+    /**\n+     * This interface will be removed in a future release\n+     *\n+     * // TODO This object will be deleted sometime after version 1.3.0\n+     *\n+     * @deprecated 1.3.0\n+     * @param serverStatus server status\n+     * @return \"ok\"\n+     */\n+    @Deprecated\n+    @RequestMapping(\"/server/status\")\n+    public String serverStatus(@RequestParam String serverStatus) {\n+        serverListManager.onReceiveServerStatus(serverStatus);\n+        return \"ok\";\n+    }\n+\n     @PutMapping(\"/log\")\n     public String setLogLevel(@RequestParam String logName, @RequestParam String logLevel) {\n         Loggers.setLogLevel(logName, logLevel);\n         return \"ok\";\n     }\n \n+    /**\n+     * This interface will be removed in a future release\n+     *\n+     * // TODO This object will be deleted sometime after version 1.3.0", "originalCommit": "31694246058ef6c226cba4bf7d39ad3fc4a65362", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "01bb02b943ce75441d57ab8f72fe2bbca5ead868", "url": "https://github.com/alibaba/nacos/commit/01bb02b943ce75441d57ab8f72fe2bbca5ead868", "message": "refactor: long volume, annotation optimization", "committedDate": "2020-06-02T02:32:18Z", "type": "commit"}]}