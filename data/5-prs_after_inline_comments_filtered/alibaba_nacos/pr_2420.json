{"pr_number": 2420, "pr_title": "Fea auto clean service", "pr_createdAt": "2020-03-06T08:39:06Z", "pr_url": "https://github.com/alibaba/nacos/pull/2420", "timeline": [{"oid": "502e9c759741af9c1425ed2589c074b211c2919f", "url": "https://github.com/alibaba/nacos/commit/502e9c759741af9c1425ed2589c074b211c2919f", "message": "feat(naming): Support for automatic removal of empty services", "committedDate": "2020-03-06T03:42:05Z", "type": "commit"}, {"oid": "f65e4fcbc06cb05bba8cb3d42f44bff088eb792a", "url": "https://github.com/alibaba/nacos/commit/f65e4fcbc06cb05bba8cb3d42f44bff088eb792a", "message": "refactor(naming): Optimize the empty service removal logic", "committedDate": "2020-03-06T08:32:59Z", "type": "commit"}, {"oid": "3e403c565532025ae95c7d064896b9f90b901598", "url": "https://github.com/alibaba/nacos/commit/3e403c565532025ae95c7d064896b9f90b901598", "message": "refactor: remove unuse dir", "committedDate": "2020-03-06T08:33:33Z", "type": "commit"}, {"oid": "f8fb011bd63bc85bfe8cfc204fae37d8f01de00b", "url": "https://github.com/alibaba/nacos/commit/f8fb011bd63bc85bfe8cfc204fae37d8f01de00b", "message": "fix(naming): Fixed finalizeCnt error count problem", "committedDate": "2020-03-06T08:36:50Z", "type": "commit"}, {"oid": "86e3b0dbc98f666a0f786541199ce52df6183211", "url": "https://github.com/alibaba/nacos/commit/86e3b0dbc98f666a0f786541199ce52df6183211", "message": "fix(naming): Fixed a namespace parameter passing error", "committedDate": "2020-03-06T11:33:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODkzNjQ0NQ==", "url": "https://github.com/alibaba/nacos/pull/2420#discussion_r388936445", "bodyText": "\u6700\u597d\u4e0d\u8981\u7528\u7f29\u5199\uff0c\u53ef\u4ee5\u7528finalizeCount", "author": "nkorange", "createdAt": "2020-03-06T14:34:37Z", "path": "naming/src/main/java/com/alibaba/nacos/naming/core/Service.java", "diffHunk": "@@ -57,6 +57,11 @@\n     @JSONField(serialize = false)\n     private ClientBeatCheckTask clientBeatCheckTask = new ClientBeatCheckTask(this);\n \n+    /**\n+     * Identify the information used to determine how many isEmpty judgments the service has experienced\n+     */\n+    private int finalizeCnt = 0;", "originalCommit": "86e3b0dbc98f666a0f786541199ce52df6183211", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODkzOTI2OA==", "url": "https://github.com/alibaba/nacos/pull/2420#discussion_r388939268", "bodyText": "Ok, got it", "author": "chuntaojun", "createdAt": "2020-03-06T14:39:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODkzNjQ0NQ=="}], "type": "inlineReview"}, {"oid": "4f264fed2db9e55c47699d9c6f41c6e9ce8630d7", "url": "https://github.com/alibaba/nacos/commit/4f264fed2db9e55c47699d9c6f41c6e9ce8630d7", "message": "style(naming): Variable name specification", "committedDate": "2020-03-07T03:39:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTI1OTczMg==", "url": "https://github.com/alibaba/nacos/pull/2420#discussion_r389259732", "bodyText": "\u8fd9\u4e2a\u6e05\u7406\u5468\u671f\u4e5f\u53ef\u4ee5\u505a\u6210\u53ef\u914d\u7f6e\u7684", "author": "nkorange", "createdAt": "2020-03-07T14:51:00Z", "path": "naming/src/main/java/com/alibaba/nacos/naming/core/ServiceManager.java", "diffHunk": "@@ -97,6 +117,19 @@ public void init() {\n \n         UtilsAndCommons.SERVICE_UPDATE_EXECUTOR.submit(new UpdatedServiceProcessor());\n \n+        if (emptyServiceAutoClean) {\n+\n+            // delay 60s, period 20s;\n+\n+            // This task is not recommended to be performed frequently in order to avoid\n+            // the possibility that the service cache information may just be deleted\n+            // and then created due to the heartbeat mechanism\n+\n+            GlobalExecutor.scheduleServiceAutoClean(new EmptyServiceAutoClean(), 60_000L, 20_000L);", "originalCommit": "86e3b0dbc98f666a0f786541199ce52df6183211", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "0886653a086de0fdc5ec5a1b7b093c8bb74fc34a", "url": "https://github.com/alibaba/nacos/commit/0886653a086de0fdc5ec5a1b7b093c8bb74fc34a", "message": "feat(naming): Support empty service cleanup task time configurable", "committedDate": "2020-03-07T16:00:44Z", "type": "commit"}, {"oid": "6a7b664bfb6e660b5684e1d5fb3c9538555dfdf3", "url": "https://github.com/alibaba/nacos/commit/6a7b664bfb6e660b5684e1d5fb3c9538555dfdf3", "message": "fix(naming): The fix configuration name is different", "committedDate": "2020-03-09T03:28:39Z", "type": "commit"}, {"oid": "aa9a0c045a85468a6d0d18e314169c71232f28bc", "url": "https://github.com/alibaba/nacos/commit/aa9a0c045a85468a6d0d18e314169c71232f28bc", "message": "Merge branch 'develop' into fea_auto_clean_service", "committedDate": "2020-03-09T03:35:12Z", "type": "commit"}, {"oid": "0a325bf9c78f884ab456f2f1fb5b223540046fde", "url": "https://github.com/alibaba/nacos/commit/0a325bf9c78f884ab456f2f1fb5b223540046fde", "message": "fix: fix merge confilt", "committedDate": "2020-03-09T07:38:03Z", "type": "commit"}, {"oid": "8466c347be743676b5b93cf5b75c896c1fa3bdbe", "url": "https://github.com/alibaba/nacos/commit/8466c347be743676b5b93cf5b75c896c1fa3bdbe", "message": "Merge branch 'fea_auto_clean_service' of https://github.com/chuntaojun/nacos into fea_auto_clean_service", "committedDate": "2020-03-09T07:39:44Z", "type": "commit"}, {"oid": "8b848873e4b6ecda9893400572b146803786e555", "url": "https://github.com/alibaba/nacos/commit/8b848873e4b6ecda9893400572b146803786e555", "message": "docs:", "committedDate": "2020-03-09T07:48:31Z", "type": "commit"}, {"oid": "b44e7d6f44e98404ae98d57d51691b698152c413", "url": "https://github.com/alibaba/nacos/commit/b44e7d6f44e98404ae98d57d51691b698152c413", "message": "docs: remove dir", "committedDate": "2020-03-09T07:52:46Z", "type": "commit"}, {"oid": "a6594932050e90ca2b0667c4790934fc1d7828dd", "url": "https://github.com/alibaba/nacos/commit/a6594932050e90ca2b0667c4790934fc1d7828dd", "message": "refactor: Uniform configuration format", "committedDate": "2020-03-09T07:57:22Z", "type": "commit"}, {"oid": "f30c5ab7575a0db59f1a97c996525277cd6ce601", "url": "https://github.com/alibaba/nacos/commit/f30c5ab7575a0db59f1a97c996525277cd6ce601", "message": "docs: Uniform configuration format", "committedDate": "2020-03-09T08:00:05Z", "type": "commit"}]}