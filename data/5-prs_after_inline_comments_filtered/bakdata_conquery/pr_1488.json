{"pr_number": 1488, "pr_title": "Fix/kw43/retrival of concept tree child label", "pr_createdAt": "2020-12-10T08:40:18Z", "pr_url": "https://github.com/bakdata/conquery/pull/1488", "timeline": [{"oid": "095db069667dba85bef6f735bf12f5c3c5a2d8ea", "url": "https://github.com/bakdata/conquery/commit/095db069667dba85bef6f735bf12f5c3c5a2d8ea", "message": "searches the concept for the child label instead of falsely resolving it through the central-registry", "committedDate": "2020-12-09T13:09:54Z", "type": "commit"}, {"oid": "d7c7951b015c23891e98027d92ad14a2e6cf2b4a", "url": "https://github.com/bakdata/conquery/commit/d7c7951b015c23891e98027d92ad14a2e6cf2b4a", "message": "fixes column namer test", "committedDate": "2020-12-10T10:17:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDExNjcwMg==", "url": "https://github.com/bakdata/conquery/pull/1488#discussion_r540116702", "bodyText": "Ich glaube du testest hier nirgends deinen neuen case mit einem Child? bzw hier hat sich nirgends ein label ge\u00e4dnert", "author": "awildturtok", "createdAt": "2020-12-10T12:08:13Z", "path": "backend/src/test/java/com/bakdata/conquery/models/query/DefaultColumnNameTest.java", "diffHunk": "@@ -8,159 +8,193 @@\n import java.util.ArrayList;\n import java.util.List;\n import java.util.Locale;\n+import java.util.Set;\n import java.util.function.Function;\n import java.util.stream.Collectors;\n import java.util.stream.IntStream;\n import java.util.stream.Stream;\n \n import com.bakdata.conquery.models.concepts.SelectHolder;\n+import com.bakdata.conquery.models.concepts.conditions.EqualCondition;\n import com.bakdata.conquery.models.concepts.select.Select;\n import com.bakdata.conquery.models.concepts.select.concept.UniversalSelect;\n import com.bakdata.conquery.models.concepts.tree.ConceptTreeChild;\n import com.bakdata.conquery.models.concepts.tree.ConceptTreeConnector;\n import com.bakdata.conquery.models.concepts.tree.TreeConcept;\n+import com.bakdata.conquery.models.exceptions.ConfigurationException;\n+import com.bakdata.conquery.models.exceptions.JSONException;\n+import com.bakdata.conquery.models.identifiable.ids.specific.ConceptId;\n import com.bakdata.conquery.models.identifiable.ids.specific.ConceptTreeChildId;\n+import com.bakdata.conquery.models.identifiable.ids.specific.DatasetId;\n import com.bakdata.conquery.models.query.concept.specific.CQConcept;\n import com.bakdata.conquery.models.query.queryplan.aggregators.Aggregator;\n import com.bakdata.conquery.models.query.resultinfo.SelectResultInfo;\n import com.bakdata.conquery.models.worker.DatasetRegistry;\n+import io.dropwizard.jersey.validation.Validators;\n+import lombok.SneakyThrows;\n import org.junit.jupiter.api.BeforeAll;\n import org.junit.jupiter.params.ParameterizedTest;\n import org.junit.jupiter.params.provider.Arguments;\n import org.junit.jupiter.params.provider.MethodSource;\n \n+import javax.validation.Validator;\n+\n public class DefaultColumnNameTest {\n \tprivate final static DatasetRegistry DATASET_REGISTRY = mock(DatasetRegistry.class);\n \tprivate final static PrintSettings SETTINGS = new PrintSettings(false, Locale.ENGLISH, DATASET_REGISTRY);\n+\tprivate final static Validator VALIDATOR = Validators.newValidator();\n \t\n \tprivate final static Function<TestConcept,Select> FIRST_CONCEPT_SELECT_EXTRACTOR = (concept) -> concept.getSelects().get(0);\n \tprivate final static Function<TestConcept,Select> FIRST_CONNCETOR_FIRST_SELECT_EXTRACTOR = (concept) -> concept.getConnectors().get(0).getSelects().get(0);\n \t\n-\t@BeforeAll\n-\tstatic void before() {\n-\t\tdoAnswer(invocation -> {\n-\t\t\tfinal ConceptTreeChildId id = invocation.getArgument(0);\n-\t\t\tConceptTreeChild child = new ConceptTreeChild();\n-\t\t\tchild.setLabel(id.getName());\n-\t\t\treturn child;\n-\t\t}).when(DATASET_REGISTRY).resolve(any());\n-\t}\n-\t\n \tprivate static Stream<Arguments> provideCombinations() {\n \t\treturn Stream.of(\n \t\t\t// ConceptSelect, without CQLabel, one Id\n \t\t\tArguments.of(\n-\t\t\t\tTestConcept.create(1, FIRST_CONCEPT_SELECT_EXTRACTOR),\n-\t\t\t\tTestCQConcept.create(false, 1),\n+\t\t\t\tTestConcept.create(1, FIRST_CONCEPT_SELECT_EXTRACTOR, 1),\n+\t\t\t\tfalse,\n \t\t\t\t\"TestConceptLabel - ID_0 - TestSelectLabel\"),\n \t\t\t// ConceptSelect without CQLabel, multiple Ids\n \t\t\tArguments.of(\n-\t\t\t\tTestConcept.create(1, FIRST_CONCEPT_SELECT_EXTRACTOR),\n-\t\t\t\tTestCQConcept.create(false, 3),\n+\t\t\t\tTestConcept.create(1, FIRST_CONCEPT_SELECT_EXTRACTOR, 3),\n+\t\t\t\tfalse,\n \t\t\t\t\"TestConceptLabel - ID_0+ID_1+ID_2 - TestSelectLabel\"),\n \t\t\t// ConceptSelect with CQLabel, one Id\n \t\t\tArguments.of(\n-\t\t\t\tTestConcept.create(1, FIRST_CONCEPT_SELECT_EXTRACTOR),\n-\t\t\t\tTestCQConcept.create(true, 1),\n+\t\t\t\tTestConcept.create(1, FIRST_CONCEPT_SELECT_EXTRACTOR, 1),\n+\t\t\t\ttrue,\n \t\t\t\t\"TestConceptLabel - TestCQLabel - TestSelectLabel\"),\n \t\t\t// ConceptSelect with CQLabel, multiple Ids\n \t\t\tArguments.of(\n-\t\t\t\tTestConcept.create(1, FIRST_CONCEPT_SELECT_EXTRACTOR),\n-\t\t\t\tTestCQConcept.create(true, 3),\n+\t\t\t\tTestConcept.create(1, FIRST_CONCEPT_SELECT_EXTRACTOR, 3),\n+\t\t\t\ttrue,\n \t\t\t\t\"TestConceptLabel - TestCQLabel - TestSelectLabel\"),\n \t\t\t\n \t\t\t// ConnectorSelect, without CQLabel, one Id, one Connector\n \t\t\tArguments.of(\n-\t\t\t\tTestConcept.create(1, FIRST_CONNCETOR_FIRST_SELECT_EXTRACTOR),\n-\t\t\t\tTestCQConcept.create(false, 1),\n+\t\t\t\tTestConcept.create(1, FIRST_CONNCETOR_FIRST_SELECT_EXTRACTOR, 1),\n+\t\t\t\tfalse,\n \t\t\t\t\"TestConceptLabel - ID_0 - TestSelectLabel\"),\n \t\t\t// ConnectorSelect without CQLabel, multiple Ids, one Connector\n \t\t\tArguments.of(\n-\t\t\t\tTestConcept.create(1, FIRST_CONNCETOR_FIRST_SELECT_EXTRACTOR),\n-\t\t\t\tTestCQConcept.create(false, 3),\n+\t\t\t\tTestConcept.create(1, FIRST_CONNCETOR_FIRST_SELECT_EXTRACTOR, 3),\n+\t\t\t\tfalse,\n \t\t\t\t\"TestConceptLabel - ID_0+ID_1+ID_2 - TestSelectLabel\"),\n \t\t\t// ConnectorSelect with CQLabel, one Id, one Connector\n \t\t\tArguments.of(\n-\t\t\t\tTestConcept.create(1, FIRST_CONNCETOR_FIRST_SELECT_EXTRACTOR),\n-\t\t\t\tTestCQConcept.create(true, 1),\n+\t\t\t\tTestConcept.create(1, FIRST_CONNCETOR_FIRST_SELECT_EXTRACTOR, 1),\n+\t\t\t\ttrue,\n \t\t\t\t\"TestConceptLabel - TestCQLabel - TestSelectLabel\"),\n \t\t\t// ConnectorSelect with CQLabel, multiple Ids, one Connector\n \t\t\tArguments.of(\n-\t\t\t\tTestConcept.create(1, FIRST_CONNCETOR_FIRST_SELECT_EXTRACTOR),\n-\t\t\t\tTestCQConcept.create(true, 3),\n+\t\t\t\tTestConcept.create(1, FIRST_CONNCETOR_FIRST_SELECT_EXTRACTOR, 3),\n+\t\t\t\ttrue,\n \t\t\t\t\"TestConceptLabel - TestCQLabel - TestSelectLabel\"),\n \t\t\t\n \t\t\t// ConnectorSelect, without CQLabel, one Id, multiple Connectors\n \t\t\tArguments.of(\n-\t\t\t\tTestConcept.create(3, FIRST_CONNCETOR_FIRST_SELECT_EXTRACTOR),\n-\t\t\t\tTestCQConcept.create(false, 1),\n+\t\t\t\tTestConcept.create(3, FIRST_CONNCETOR_FIRST_SELECT_EXTRACTOR, 1),\n+\t\t\t\tfalse,\n \t\t\t\t\"TestConceptLabel - ID_0 - TestConnectorLabel_0 TestSelectLabel\"),\n \t\t\t// ConnectorSelect without CQLabel, multiple Ids, multiple Connectors\n \t\t\tArguments.of(\n-\t\t\t\tTestConcept.create(3, FIRST_CONNCETOR_FIRST_SELECT_EXTRACTOR),\n-\t\t\t\tTestCQConcept.create(false, 3),\n+\t\t\t\tTestConcept.create(3, FIRST_CONNCETOR_FIRST_SELECT_EXTRACTOR, 3),\n+\t\t\t\tfalse,\n \t\t\t\t\"TestConceptLabel - ID_0+ID_1+ID_2 - TestConnectorLabel_0 TestSelectLabel\"),\n \t\t\t// ConnectorSelect with CQLabel, one Id, multiple Connectors\n \t\t\tArguments.of(\n-\t\t\t\tTestConcept.create(3, FIRST_CONNCETOR_FIRST_SELECT_EXTRACTOR),\n-\t\t\t\tTestCQConcept.create(true, 1),\n+\t\t\t\tTestConcept.create(3, FIRST_CONNCETOR_FIRST_SELECT_EXTRACTOR, 1),\n+\t\t\t\ttrue,\n \t\t\t\t\"TestConceptLabel - TestCQLabel - TestConnectorLabel_0 TestSelectLabel\"),\n \t\t\t// ConnectorSelect with CQLabel, multiple Ids, multiple Connectors\n \t\t\tArguments.of(\n-\t\t\t\tTestConcept.create(3, FIRST_CONNCETOR_FIRST_SELECT_EXTRACTOR),\n-\t\t\t\tTestCQConcept.create(true, 3),\n+\t\t\t\tTestConcept.create(3, FIRST_CONNCETOR_FIRST_SELECT_EXTRACTOR, 3),\n+\t\t\t\ttrue,", "originalCommit": "d7c7951b015c23891e98027d92ad14a2e6cf2b4a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDE0NDc0MQ==", "url": "https://github.com/bakdata/conquery/pull/1488#discussion_r540144741", "bodyText": "Ich hatte vorher die ConceptTreeChildren aus der DatasetRegistry bezogen, was nat\u00fcrlich normaler weise nicht geht. Jetzt hole ich mir das ConceptTreeChild aus dem Concept direkt", "author": "thoniTUB", "createdAt": "2020-12-10T12:53:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDExNjcwMg=="}], "type": "inlineReview"}]}