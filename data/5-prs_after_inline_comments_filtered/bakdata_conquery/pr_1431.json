{"pr_number": 1431, "pr_title": "Rework Buckets", "pr_createdAt": "2020-11-13T15:29:00Z", "pr_url": "https://github.com/bakdata/conquery/pull/1431", "timeline": [{"oid": "5a0925b97644f9d6791c76442b81a658299110bf", "url": "https://github.com/bakdata/conquery/commit/5a0925b97644f9d6791c76442b81a658299110bf", "message": "Undo fast (and out of order) sending of messages", "committedDate": "2021-01-21T11:25:29Z", "type": "commit"}, {"oid": "4f4583681393ddac1ac98b49742988d8ef250f75", "url": "https://github.com/bakdata/conquery/commit/4f4583681393ddac1ac98b49742988d8ef250f75", "message": "encapsulate Construction of ImportBucket", "committedDate": "2021-01-21T11:25:55Z", "type": "commit"}, {"oid": "63a92058a8127c0eae30d80129cb0dc49a3dcb3d", "url": "https://github.com/bakdata/conquery/commit/63a92058a8127c0eae30d80129cb0dc49a3dcb3d", "message": "minor code style issues", "committedDate": "2021-01-21T15:36:03Z", "type": "commit"}, {"oid": "eeb38c4343b2724a87118ebd7f422875b660dc14", "url": "https://github.com/bakdata/conquery/commit/eeb38c4343b2724a87118ebd7f422875b660dc14", "message": "automatic update to docs", "committedDate": "2021-02-01T10:43:32Z", "type": "commit"}, {"oid": "7d6249097a95f3f27a5589ede40a176584c45d55", "url": "https://github.com/bakdata/conquery/commit/7d6249097a95f3f27a5589ede40a176584c45d55", "message": "fix setLines/getLines not returning proper values", "committedDate": "2021-02-01T11:32:57Z", "type": "commit"}, {"oid": "49446e8bf304e9fe2868b0a7873d0494ba9b1538", "url": "https://github.com/bakdata/conquery/commit/49446e8bf304e9fe2868b0a7873d0494ba9b1538", "message": "documentation for StringTypeGuesser", "committedDate": "2021-02-01T13:07:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NzgyNTE4MA==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r567825180", "bodyText": "shenanigans :D", "author": "thoniTUB", "createdAt": "2021-02-01T13:29:44Z", "path": "backend/src/main/java/com/bakdata/conquery/models/events/stores/specific/string/StringTypeDictionary.java", "diffHunk": "@@ -19,6 +19,11 @@\n import lombok.Setter;\n import lombok.extern.slf4j.Slf4j;\n \n+/**\n+ * Strings are stored in a Dictionary, ids are handles into the Dictionary.\n+ *\n+ * @implNote this is NOT a {@link StringType}, but is the base class of it. This enables some shenanigans with encodings.", "originalCommit": "49446e8bf304e9fe2868b0a7873d0494ba9b1538", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NzgyODE0MA==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r567828140", "bodyText": "Wof\u00fcr ist das notwendig. Ist der resultierende ColumnStore dann valide, wenn er leer ist, aber dennoch Lines hat?", "author": "thoniTUB", "createdAt": "2021-02-01T13:34:12Z", "path": "backend/src/main/java/com/bakdata/conquery/models/events/stores/ColumnStore.java", "diffHunk": "@@ -51,31 +61,49 @@ public Object createScriptValue(JAVA_TYPE value) {\n \t\treturn value;\n \t}\n \n-\tpublic long estimateMemoryConsumption() {\n+\t/**\n+\t * Calculate estimate of total bytes used by this store.\n+\t */\n+\tpublic long estimateMemoryConsumptionBytes() {\n \t\tlong bits = estimateEventBits();\n \n-\t\treturn getLines() * bits;\n+\t\treturn Math.floorDiv(getLines() * bits, Byte.SIZE);\n \t}\n \n+\t/**\n+\t * Number of bits required to store a single value.\n+\t */\n \tpublic abstract long estimateEventBits();\n \n-\tpublic long estimateTypeSize() {\n+\t/**\n+\t * Bytes required to store auxilary data.\n+\t */\n+\tpublic long estimateTypeSizeBytes() {\n \t\treturn 0;\n \t}\n \n+\n+\tpublic abstract ColumnStore<JAVA_TYPE> doSelect(int[] starts, int[] lengths);\n+\n \t/**\n \t * Select the partition of this store.\n \t * The returning store has to accept queries up to {@code sum(lenghts)}, values may not be reordered.\n \t */\n-\tpublic abstract ColumnStore<JAVA_TYPE> select(int[] starts, int[] lengths);\n+\tpublic ColumnStore<JAVA_TYPE> select(int[] starts, int[] lengths){\n+\t\t//TODO FK: this is just WIP as getLines is only used for isEmpty and AdminEnd description, but detangling requires a lot of refactoring.\n+\t\tfinal ColumnStore<JAVA_TYPE> select = doSelect(starts, lengths);\n+\t\tselect.setLines(Arrays.stream(lengths).sum());\n+\t\treturn select;\n+\t}\n+\n+\n \n \t/**\n \t * Create an empty store that's only a description of the transformation.\n \t */\n \tpublic ColumnStore<JAVA_TYPE> createDescription() {\n-\t\tfinal ColumnStore<JAVA_TYPE> select = select(new int[0], new int[0]);\n+\t\tfinal ColumnStore<JAVA_TYPE> select = doSelect(new int[0], new int[0]);\n \t\tselect.setLines(getLines());\n-\t\tselect.setNullLines(getNullLines());\n \t\treturn select;", "originalCommit": "49446e8bf304e9fe2868b0a7873d0494ba9b1538", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Nzg2Nzk4Nw==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r567867987", "bodyText": "Ist nur eine description, deswegen ist das auch so komisch gewrapped. das will ich anders l\u00f6sen.", "author": "awildturtok", "createdAt": "2021-02-01T14:31:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NzgyODE0MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Nzg1NjYyNA==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r567856624", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\tif(maxValue == Integer.MAX_VALUE){\n          \n          \n            \n            \t\tif(maxValue >= Integer.MAX_VALUE){\n          \n      \n    \n    \n  \n\nNur dass es mich beruhigt, weil maxValue  ein Long ist", "author": "thoniTUB", "createdAt": "2021-02-01T14:16:22Z", "path": "backend/src/main/java/com/bakdata/conquery/models/events/parser/specific/IntegerParser.java", "diffHunk": "@@ -87,6 +87,10 @@ protected void registerValue(Long v) {\n \t\t\treturn new RebasingStore(minValue, Integer.MIN_VALUE, IntegerStore.create(getLines()));\n \t\t}\n \n+\t\tif(maxValue == Integer.MAX_VALUE){", "originalCommit": "49446e8bf304e9fe2868b0a7873d0494ba9b1538", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Nzg2Njg4MQ==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r567866881", "bodyText": "Ne, das ist falsch maxValue muss Long.MAX_VALUE sein, dann k\u00f6nnen wir es nicht abbilden. deswegen auch das todo, hier auf nullbits umzusteigen, falls n\u00f6tig.", "author": "awildturtok", "createdAt": "2021-02-01T14:30:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Nzg1NjYyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Nzg2NzAxMg==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r567867012", "bodyText": "Habs behoben", "author": "awildturtok", "createdAt": "2021-02-01T14:30:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Nzg1NjYyNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Nzg1ODEyMg==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r567858122", "bodyText": "dateStore.setLines(getLines()); delegated nicht an den unterliegenden store?", "author": "thoniTUB", "createdAt": "2021-02-01T14:18:23Z", "path": "backend/src/main/java/com/bakdata/conquery/models/events/parser/specific/DateParser.java", "diffHunk": "@@ -47,6 +47,9 @@ public Integer addLine(Integer v) {\n \t@Override\n \tprotected DateStore decideType() {\n \t\tColumnStore<Long> subDecision = subType.findBestType();\n-\t\treturn new DateStore(subDecision);\n+\t\tsubDecision.setLines(getLines());\n+\t\tfinal DateStore dateStore = new DateStore(subDecision);\n+\t\tdateStore.setLines(getLines());", "originalCommit": "49446e8bf304e9fe2868b0a7873d0494ba9b1538", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Nzg2ODMwOQ==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r567868309", "bodyText": "Nein, weil die Info eigentlich egal ist, das wird direkt der Folge PR das umzubauen.", "author": "awildturtok", "createdAt": "2021-02-01T14:32:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Nzg1ODEyMg=="}], "type": "inlineReview"}, {"oid": "4e8b343103e9af81d50f183bdb6ec8246cb64fdd", "url": "https://github.com/bakdata/conquery/commit/4e8b343103e9af81d50f183bdb6ec8246cb64fdd", "message": "fix typo for exceeding LongStore capacity", "committedDate": "2021-02-01T14:32:56Z", "type": "commit"}, {"oid": "3774b1017b937c1561a2b1ed3d987b99bff8cb4d", "url": "https://github.com/bakdata/conquery/commit/3774b1017b937c1561a2b1ed3d987b99bff8cb4d", "message": "remove redundant VarIntType.java classes", "committedDate": "2020-11-26T15:26:32Z", "type": "commit"}, {"oid": "6433c57cb23280c2781e239bcb8c95e1b9d1d09a", "url": "https://github.com/bakdata/conquery/commit/6433c57cb23280c2781e239bcb8c95e1b9d1d09a", "message": "find index type for Strings", "committedDate": "2020-11-26T15:33:50Z", "type": "commit"}, {"oid": "22fde31b27fded65057376f5c1203fbfeb3d1023", "url": "https://github.com/bakdata/conquery/commit/22fde31b27fded65057376f5c1203fbfeb3d1023", "message": "apply compression also to StringParser", "committedDate": "2020-11-26T15:50:08Z", "type": "commit"}, {"oid": "62f848672ed33862386c7732733976c941d101c0", "url": "https://github.com/bakdata/conquery/commit/62f848672ed33862386c7732733976c941d101c0", "message": "Inject Dataset into ObjectMapper", "committedDate": "2020-11-27T10:23:17Z", "type": "commit"}, {"oid": "af4929832a3dca807f4fd2dc8849be977db5149c", "url": "https://github.com/bakdata/conquery/commit/af4929832a3dca807f4fd2dc8849be977db5149c", "message": "Unify directly backed types via store", "committedDate": "2020-11-27T11:12:27Z", "type": "commit"}, {"oid": "f7e7246bc7d2237508a9145098d24b7f14a9fbfa", "url": "https://github.com/bakdata/conquery/commit/f7e7246bc7d2237508a9145098d24b7f14a9fbfa", "message": "inject valueMapping into StringTypeDictionary", "committedDate": "2020-11-27T11:31:46Z", "type": "commit"}, {"oid": "10b683587079a0e0a7b399bf97ee9f07aeabe7f9", "url": "https://github.com/bakdata/conquery/commit/10b683587079a0e0a7b399bf97ee9f07aeabe7f9", "message": "Recalculate underlying size instead, to reduce large int arrays IN SPAAAAAACE", "committedDate": "2020-11-27T12:13:25Z", "type": "commit"}, {"oid": "44ac410a88784550efd3a5d97319d608ab4e732f", "url": "https://github.com/bakdata/conquery/commit/44ac410a88784550efd3a5d97319d608ab4e732f", "message": "add property anno", "committedDate": "2020-11-27T14:06:30Z", "type": "commit"}, {"oid": "1441d9de6e7928d7dd2e6667cb50872d6742756b", "url": "https://github.com/bakdata/conquery/commit/1441d9de6e7928d7dd2e6667cb50872d6742756b", "message": "remove unused or now redundant tests", "committedDate": "2020-11-30T13:56:30Z", "type": "commit"}, {"oid": "008093734d4c112bbbe3e77f22e5a43049bfa9ab", "url": "https://github.com/bakdata/conquery/commit/008093734d4c112bbbe3e77f22e5a43049bfa9ab", "message": "remove duplicate store", "committedDate": "2020-11-30T14:41:04Z", "type": "commit"}, {"oid": "d6360a56ce6e6fe49f460bb84cc0f75406e1f8cf", "url": "https://github.com/bakdata/conquery/commit/d6360a56ce6e6fe49f460bb84cc0f75406e1f8cf", "message": "add anyOpen back", "committedDate": "2020-11-30T14:44:13Z", "type": "commit"}, {"oid": "734ff0c81365a830415a4d699c5af34b2cc9fcd2", "url": "https://github.com/bakdata/conquery/commit/734ff0c81365a830415a4d699c5af34b2cc9fcd2", "message": "remove now redundant DateRangeTypePacked.java store", "committedDate": "2020-11-30T14:56:57Z", "type": "commit"}, {"oid": "b56415285a1577ff16d44a1016fbbfd4cea7d15b", "url": "https://github.com/bakdata/conquery/commit/b56415285a1577ff16d44a1016fbbfd4cea7d15b", "message": "remove ChainedStringType.java", "committedDate": "2020-11-30T14:59:45Z", "type": "commit"}, {"oid": "299d43b5682a270a0c6ce88900c08d51a370f020", "url": "https://github.com/bakdata/conquery/commit/299d43b5682a270a0c6ce88900c08d51a370f020", "message": "cleanup", "committedDate": "2020-11-30T15:01:39Z", "type": "commit"}, {"oid": "a491ca3bd9b61297ea051a8b5d6a3930e6543589", "url": "https://github.com/bakdata/conquery/commit/a491ca3bd9b61297ea051a8b5d6a3930e6543589", "message": "cleanup StringType", "committedDate": "2020-11-30T15:17:33Z", "type": "commit"}, {"oid": "41bd1dcb8a7967daa8474ba1255143fe1cb4c627", "url": "https://github.com/bakdata/conquery/commit/41bd1dcb8a7967daa8474ba1255143fe1cb4c627", "message": "docs for Int et al Stores", "committedDate": "2020-11-30T15:22:55Z", "type": "commit"}, {"oid": "f3b9472da81abe8efaa8c3f52324c755949f7263", "url": "https://github.com/bakdata/conquery/commit/f3b9472da81abe8efaa8c3f52324c755949f7263", "message": "formatting", "committedDate": "2020-11-30T16:01:25Z", "type": "commit"}, {"oid": "cda07b9dfe675ba200db2000b25da33bd78dba52", "url": "https://github.com/bakdata/conquery/commit/cda07b9dfe675ba200db2000b25da33bd78dba52", "message": "rework DateRangeParser to have two stores as they are hard to select", "committedDate": "2020-12-01T10:55:27Z", "type": "commit"}, {"oid": "7025607bdb114f8d3ed5b9471c2c4b1297264970", "url": "https://github.com/bakdata/conquery/commit/7025607bdb114f8d3ed5b9471c2c4b1297264970", "message": "rename localEntity to entity to reflect API", "committedDate": "2020-12-01T11:12:28Z", "type": "commit"}, {"oid": "9b286344de381d2cb5e4ea95fb35cfbb0bfa86a8", "url": "https://github.com/bakdata/conquery/commit/9b286344de381d2cb5e4ea95fb35cfbb0bfa86a8", "message": "add missig SerializationTests and broaden to ColumnStore", "committedDate": "2020-12-01T11:30:34Z", "type": "commit"}, {"oid": "c71aecaf06db94b735c184b72601e9a95cb9e425", "url": "https://github.com/bakdata/conquery/commit/c71aecaf06db94b735c184b72601e9a95cb9e425", "message": "remove intermediate ColumnStoreAdapter.java class, merge with ColumnStore", "committedDate": "2020-12-01T11:46:14Z", "type": "commit"}, {"oid": "0a728eca849ed1f766a3eaea1a61015946ed9822", "url": "https://github.com/bakdata/conquery/commit/0a728eca849ed1f766a3eaea1a61015946ed9822", "message": "move loadDictionary into StringType", "committedDate": "2020-12-01T11:50:23Z", "type": "commit"}, {"oid": "ca186537eebd54ca0da7c5b2d3053a5ef1b98294", "url": "https://github.com/bakdata/conquery/commit/ca186537eebd54ca0da7c5b2d3053a5ef1b98294", "message": "completely inline ColumnStore.java class to avoid reduncancies", "committedDate": "2020-12-01T13:24:41Z", "type": "commit"}, {"oid": "830836b19f3eb2b03a09ccc9699fdbd44d36815e", "url": "https://github.com/bakdata/conquery/commit/830836b19f3eb2b03a09ccc9699fdbd44d36815e", "message": "heavy refactoring of CType.java, rename to ColumnStore.java", "committedDate": "2020-12-01T13:32:16Z", "type": "commit"}, {"oid": "42b9caaee24f6b53d0c0703fbfc9fa33c729786e", "url": "https://github.com/bakdata/conquery/commit/42b9caaee24f6b53d0c0703fbfc9fa33c729786e", "message": "merge packages", "committedDate": "2020-12-01T13:35:58Z", "type": "commit"}, {"oid": "509dec4dcf2336544bdd446d5c93b5a9edde09e3", "url": "https://github.com/bakdata/conquery/commit/509dec4dcf2336544bdd446d5c93b5a9edde09e3", "message": "cleanup packages", "committedDate": "2020-12-01T13:38:29Z", "type": "commit"}, {"oid": "7595358a935bbbc8b2ea579a4d112da5d073926d", "url": "https://github.com/bakdata/conquery/commit/7595358a935bbbc8b2ea579a4d112da5d073926d", "message": "remove IntegerType.java as it is now a duplicate", "committedDate": "2020-12-01T13:48:51Z", "type": "commit"}, {"oid": "d6c3756b8a87f6abff1283bee15f6ddc457f5ffc", "url": "https://github.com/bakdata/conquery/commit/d6c3756b8a87f6abff1283bee15f6ddc457f5ffc", "message": "remove redundant classes and test", "committedDate": "2020-12-01T13:53:26Z", "type": "commit"}, {"oid": "a56c11e2d89d83f2a1948c507113ff2fe05ca566", "url": "https://github.com/bakdata/conquery/commit/a56c11e2d89d83f2a1948c507113ff2fe05ca566", "message": "remove RealType.java", "committedDate": "2020-12-01T13:56:37Z", "type": "commit"}, {"oid": "abc40a757a7f1cb3202ca5939a341fc9f467a5e8", "url": "https://github.com/bakdata/conquery/commit/abc40a757a7f1cb3202ca5939a341fc9f467a5e8", "message": "Move DateStore to stores package", "committedDate": "2020-12-01T13:57:52Z", "type": "commit"}, {"oid": "49cd9d66f60494d43ff7abbc044262801611cb5a", "url": "https://github.com/bakdata/conquery/commit/49cd9d66f60494d43ff7abbc044262801611cb5a", "message": "Merge remote-tracking branch 'origin/develop' into feature/bye-bye-bucket-templates\n\n# Conflicts:\n#\tbackend/src/main/java/com/bakdata/conquery/io/result/csv/QueryToCSVRenderer.java\n#\tbackend/src/main/java/com/bakdata/conquery/models/events/Bucket.java\n#\tbackend/src/main/java/com/bakdata/conquery/models/events/BucketManager.java\n#\tbackend/src/main/java/com/bakdata/conquery/models/externalservice/ResultType.java\n#\tbackend/src/main/java/com/bakdata/conquery/models/types/parser/specific/DecimalParser.java\n#\tbackend/src/main/java/com/bakdata/conquery/models/types/parser/specific/string/MapTypeGuesser.java\n#\tbackend/src/main/java/com/bakdata/conquery/models/types/parser/specific/string/StringParser.java\n#\tbackend/src/main/java/com/bakdata/conquery/models/types/parser/specific/string/TrieTypeGuesser.java\n#\tbackend/src/main/java/com/bakdata/conquery/models/types/specific/StringTypeDictionary.java\n#\tbackend/src/main/java/com/bakdata/conquery/models/worker/Worker.java\n#\tbackend/src/test/java/com/bakdata/conquery/io/jackson/serializer/SerializationTestUtil.java\n#\tbackend/src/test/java/com/bakdata/conquery/models/SerializationTests.java\n#\tbackend/src/test/java/com/bakdata/conquery/models/types/SerializationTest.java", "committedDate": "2020-12-01T14:46:29Z", "type": "commit"}, {"oid": "d4b31e787179d0ed097f850393657f741f8e4b35", "url": "https://github.com/bakdata/conquery/commit/d4b31e787179d0ed097f850393657f741f8e4b35", "message": "automatic update to docs", "committedDate": "2020-12-01T14:49:27Z", "type": "commit"}, {"oid": "d360cda86d7debdf05eb8d61bab085cf0a26cbd6", "url": "https://github.com/bakdata/conquery/commit/d360cda86d7debdf05eb8d61bab085cf0a26cbd6", "message": "add trace of row for GroovyPredicate", "committedDate": "2020-12-02T16:47:14Z", "type": "commit"}, {"oid": "b8e981d64b669e26798f9a3488ba45b4f1a18121", "url": "https://github.com/bakdata/conquery/commit/b8e981d64b669e26798f9a3488ba45b4f1a18121", "message": "add length to log", "committedDate": "2020-12-02T16:53:51Z", "type": "commit"}, {"oid": "29a20783e5e65eeb66e166f58a5c939b921a7f88", "url": "https://github.com/bakdata/conquery/commit/29a20783e5e65eeb66e166f58a5c939b921a7f88", "message": "add map for Columns", "committedDate": "2020-12-03T08:45:59Z", "type": "commit"}, {"oid": "ea3aa804f3c7e4bb95e1a2d3f1f9f82ce6e3076f", "url": "https://github.com/bakdata/conquery/commit/ea3aa804f3c7e4bb95e1a2d3f1f9f82ce6e3076f", "message": "tighten up usage of parallel arrays", "committedDate": "2020-12-03T12:51:00Z", "type": "commit"}, {"oid": "0b52d2f23ffce8f325dcc5153dfb47f2828625a8", "url": "https://github.com/bakdata/conquery/commit/0b52d2f23ffce8f325dcc5153dfb47f2828625a8", "message": "remove unused primaryColumn", "committedDate": "2020-12-03T12:53:05Z", "type": "commit"}, {"oid": "0ac24abcfea4f82f6954c8ace92b272598fb0e33", "url": "https://github.com/bakdata/conquery/commit/0ac24abcfea4f82f6954c8ace92b272598fb0e33", "message": "automatic update to docs", "committedDate": "2020-12-03T12:55:36Z", "type": "commit"}, {"oid": "8e00a2f156412734e47ea97622fd6843a753bb12", "url": "https://github.com/bakdata/conquery/commit/8e00a2f156412734e47ea97622fd6843a753bb12", "message": "remove unused PRIMARY_POSITION", "committedDate": "2020-12-03T14:42:06Z", "type": "commit"}, {"oid": "ca61f1f4921348d90281e90b546adb77346f0020", "url": "https://github.com/bakdata/conquery/commit/ca61f1f4921348d90281e90b546adb77346f0020", "message": "automatic update to docs", "committedDate": "2020-12-03T14:45:05Z", "type": "commit"}, {"oid": "55a179044aea897e848b821bb55ec06133aa68a2", "url": "https://github.com/bakdata/conquery/commit/55a179044aea897e848b821bb55ec06133aa68a2", "message": "cleanup methods", "committedDate": "2020-12-03T16:07:29Z", "type": "commit"}, {"oid": "c555a8abacd18e2f3aa70e0d45fbbbf4ac9d285b", "url": "https://github.com/bakdata/conquery/commit/c555a8abacd18e2f3aa70e0d45fbbbf4ac9d285b", "message": "fix logging", "committedDate": "2020-12-03T16:35:14Z", "type": "commit"}, {"oid": "ad8362adf4ca2856e094a1b3e3b10a5c3824d2eb", "url": "https://github.com/bakdata/conquery/commit/ad8362adf4ca2856e094a1b3e3b10a5c3824d2eb", "message": "Merge remote-tracking branch 'origin/develop' into feature/bye-bye-bucket-templates", "committedDate": "2020-12-03T16:35:30Z", "type": "commit"}, {"oid": "7e7eb6bc4888b24303af81aeb8121c011a47de0d", "url": "https://github.com/bakdata/conquery/commit/7e7eb6bc4888b24303af81aeb8121c011a47de0d", "message": "load dictionaries on bucket loading", "committedDate": "2020-12-03T16:51:45Z", "type": "commit"}, {"oid": "9a914e64b5e4378d6a3c142d845ff6911d774f9c", "url": "https://github.com/bakdata/conquery/commit/9a914e64b5e4378d6a3c142d845ff6911d774f9c", "message": "fix parsing problems", "committedDate": "2020-12-03T17:31:37Z", "type": "commit"}, {"oid": "6690db2d60db74a740cf1ab86680780a4d731b27", "url": "https://github.com/bakdata/conquery/commit/6690db2d60db74a740cf1ab86680780a4d731b27", "message": "allow missing mapping in case they're not reuqired", "committedDate": "2020-12-03T19:35:15Z", "type": "commit"}, {"oid": "7ae76a9fa52f078f462aeba73160bbadf275a8b9", "url": "https://github.com/bakdata/conquery/commit/7ae76a9fa52f078f462aeba73160bbadf275a8b9", "message": "fix dict check", "committedDate": "2020-12-03T19:49:28Z", "type": "commit"}, {"oid": "219fbcfebacd89e87fcc91aff8a938081629a74b", "url": "https://github.com/bakdata/conquery/commit/219fbcfebacd89e87fcc91aff8a938081629a74b", "message": "add missing toString for StringParser", "committedDate": "2020-12-03T20:12:23Z", "type": "commit"}, {"oid": "bd2bab494e76442c37b23a26a35d968f291260b9", "url": "https://github.com/bakdata/conquery/commit/bd2bab494e76442c37b23a26a35d968f291260b9", "message": "remove getTypeId from ColumnStore et al", "committedDate": "2020-12-03T20:24:11Z", "type": "commit"}, {"oid": "1ca86da2475099f72192934d02b766fecc0f9934", "url": "https://github.com/bakdata/conquery/commit/1ca86da2475099f72192934d02b766fecc0f9934", "message": "delete unused classes", "committedDate": "2020-12-04T10:43:43Z", "type": "commit"}, {"oid": "37a0ce25a3eb8d6ef8da5ddbfc0322267d8d7511", "url": "https://github.com/bakdata/conquery/commit/37a0ce25a3eb8d6ef8da5ddbfc0322267d8d7511", "message": "Merge pull request #1450 from bakdata/feature/inject-ds-into-mapper\n\nInject Dataset into ObjectMapper", "committedDate": "2020-12-04T10:47:31Z", "type": "commit"}, {"oid": "926da27bb0962a833c299f2dc172353e3497aebd", "url": "https://github.com/bakdata/conquery/commit/926da27bb0962a833c299f2dc172353e3497aebd", "message": "Merge remote-tracking branch 'origin/develop' into feature/bye-bye-bucket-templates", "committedDate": "2020-12-04T10:57:21Z", "type": "commit"}, {"oid": "09589b93025e11017fcfd269fa550900f73bd7b3", "url": "https://github.com/bakdata/conquery/commit/09589b93025e11017fcfd269fa550900f73bd7b3", "message": "Merge remote-tracking branch 'origin/master' into feature/bye-bye-bucket-templates\n\n# Conflicts:\n#\tbackend/src/main/java/com/bakdata/conquery/models/common/BitMapCDateSet.java\n#\tbackend/src/main/java/com/bakdata/conquery/models/config/ConqueryConfig.java\n#\tbackend/src/main/java/com/bakdata/conquery/models/events/Bucket.java\n#\tbackend/src/main/java/com/bakdata/conquery/models/forms/managed/RelativeFormQueryPlan.java\n#\tbackend/src/main/java/com/bakdata/conquery/models/jobs/ImportJob.java\n#\tbackend/src/main/java/com/bakdata/conquery/models/messages/namespaces/specific/ImportBucket.java\n#\tbackend/src/main/resources/com/bakdata/conquery/models/events/generation/BucketTemplate.ftl\n#\tdocs/Config JSON.md\n#\tdocs/REST API JSONs.md", "committedDate": "2020-12-04T11:23:27Z", "type": "commit"}, {"oid": "7617a759a25e65787759950015c7c25daf216af8", "url": "https://github.com/bakdata/conquery/commit/7617a759a25e65787759950015c7c25daf216af8", "message": "docs", "committedDate": "2020-12-04T11:31:00Z", "type": "commit"}, {"oid": "a64e7605227e2c752b4175b387618b5ca25cdd52", "url": "https://github.com/bakdata/conquery/commit/a64e7605227e2c752b4175b387618b5ca25cdd52", "message": "change size estimation back to bits", "committedDate": "2020-12-04T11:45:12Z", "type": "commit"}, {"oid": "d4a501847ba38c191c8ed035b6a3458b8f427c41", "url": "https://github.com/bakdata/conquery/commit/d4a501847ba38c191c8ed035b6a3458b8f427c41", "message": "fix import rendering", "committedDate": "2020-12-04T11:47:41Z", "type": "commit"}, {"oid": "537608c499dad3affc298f172f1a0ddaedf4220a", "url": "https://github.com/bakdata/conquery/commit/537608c499dad3affc298f172f1a0ddaedf4220a", "message": "merge fixes", "committedDate": "2020-12-04T12:06:17Z", "type": "commit"}, {"oid": "1aa4b8de5832889f691b3b348dcc1fb0723b4ddf", "url": "https://github.com/bakdata/conquery/commit/1aa4b8de5832889f691b3b348dcc1fb0723b4ddf", "message": "automatic update to docs", "committedDate": "2020-12-04T12:08:53Z", "type": "commit"}, {"oid": "7e2e3e9c6b94787cbf63ce0a7e45169372a28c44", "url": "https://github.com/bakdata/conquery/commit/7e2e3e9c6b94787cbf63ce0a7e45169372a28c44", "message": "Merge remote-tracking branch 'origin/release/KW41' into feature/bye-bye-bucket-templates", "committedDate": "2020-12-04T12:10:57Z", "type": "commit"}, {"oid": "b187fc5945b42d895fa920dd6c6e583dca208632", "url": "https://github.com/bakdata/conquery/commit/b187fc5945b42d895fa920dd6c6e583dca208632", "message": "fix import size display again", "committedDate": "2020-12-04T12:23:21Z", "type": "commit"}, {"oid": "6c931daae6589e3537f30d9d3000fe36b283f16b", "url": "https://github.com/bakdata/conquery/commit/6c931daae6589e3537f30d9d3000fe36b283f16b", "message": "remove lambda", "committedDate": "2020-12-04T12:44:45Z", "type": "commit"}, {"oid": "848c7579f7ecc3179cf19785a0c877f6f7a88f0a", "url": "https://github.com/bakdata/conquery/commit/848c7579f7ecc3179cf19785a0c877f6f7a88f0a", "message": "cleanup toString as it was printing the entire set", "committedDate": "2020-12-04T12:51:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzMwNzA5Mw==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r537307093", "bodyText": "Ich habe gesehen, dass du einen neuen Serialisierungstest erstellt hast, aber da habe ich einen Bitstore nicht auf den ersten Blick gesehen.", "author": "thoniTUB", "createdAt": "2020-12-07T08:14:58Z", "path": "backend/src/main/java/com/bakdata/conquery/io/jackson/serializer/BitSetSerializer.java", "diffHunk": "@@ -0,0 +1,19 @@\n+package com.bakdata.conquery.io.jackson.serializer;\n+\n+import java.io.IOException;\n+import java.util.BitSet;\n+\n+import com.fasterxml.jackson.core.JsonGenerator;\n+import com.fasterxml.jackson.databind.SerializerProvider;\n+import com.fasterxml.jackson.databind.ser.std.StdSerializer;\n+\n+public class BitSetSerializer extends StdSerializer<BitSet> {", "originalCommit": "848c7579f7ecc3179cf19785a0c877f6f7a88f0a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzMxOTM0Nw==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r537319347", "bodyText": "BooleanStore", "author": "awildturtok", "createdAt": "2020-12-07T08:35:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzMwNzA5Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzMwODQwNg==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r537308406", "bodyText": "Einmal bitte auf develop rebasen", "author": "thoniTUB", "createdAt": "2020-12-07T08:17:21Z", "path": "backend/src/main/java/com/bakdata/conquery/io/xodus/NamespaceStorage.java", "diffHunk": "@@ -36,4 +37,7 @@ public static NamespaceStorage tryLoad(Validator validator, StorageConfig config\n \t\n \tPersistentIdMap getIdMapping();\n \tvoid updateIdMapping(PersistentIdMap idMap) throws JSONException;\n+\n+\tvoid setWorkerToBucketsMap(WorkerToBucketsMap map);", "originalCommit": "848c7579f7ecc3179cf19785a0c877f6f7a88f0a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "070f4782ef3711bf13959643f0a7193712d784c6", "url": "https://github.com/bakdata/conquery/commit/070f4782ef3711bf13959643f0a7193712d784c6", "message": "Merge remote-tracking branch 'origin/develop' into feature/bye-bye-bucket-templates\n\n# Conflicts:\n#\tbackend/src/main/java/com/bakdata/conquery/models/config/ConqueryConfig.java\n#\tdocs/Config JSON.md", "committedDate": "2020-12-07T08:40:31Z", "type": "commit"}, {"oid": "0561867a74178650e5ec890e12cfa15fe4eeb771", "url": "https://github.com/bakdata/conquery/commit/0561867a74178650e5ec890e12cfa15fe4eeb771", "message": "fix name", "committedDate": "2020-12-07T09:22:18Z", "type": "commit"}, {"oid": "ed1ca6c5a3ad3327a41f6b34754865f387324448", "url": "https://github.com/bakdata/conquery/commit/ed1ca6c5a3ad3327a41f6b34754865f387324448", "message": "Merge remote-tracking branch 'origin/develop' into feature/bye-bye-bucket-templates\n\n# Conflicts:\n#\tbackend/src/main/java/com/bakdata/conquery/models/events/Bucket.java\n#\tbackend/src/main/java/com/bakdata/conquery/models/query/queryplan/TableExportQueryPlan.java", "committedDate": "2020-12-10T14:10:19Z", "type": "commit"}, {"oid": "922669becc953b3ea74b437a08da49ee7957bd8c", "url": "https://github.com/bakdata/conquery/commit/922669becc953b3ea74b437a08da49ee7957bd8c", "message": "IntegerParser test all combinations", "committedDate": "2020-12-10T16:14:37Z", "type": "commit"}, {"oid": "f16191bb409dc18ed6b4aa9b6f61c7c9b9313adb", "url": "https://github.com/bakdata/conquery/commit/f16191bb409dc18ed6b4aa9b6f61c7c9b9313adb", "message": "parser test for Decimal", "committedDate": "2020-12-11T09:46:52Z", "type": "commit"}, {"oid": "3fa5029ef57ad7c1eea70937d4b935d2f8918ea0", "url": "https://github.com/bakdata/conquery/commit/3fa5029ef57ad7c1eea70937d4b935d2f8918ea0", "message": "change delegation of get/get$Type to reduce unneccessary boxing", "committedDate": "2020-12-16T11:52:19Z", "type": "commit"}, {"oid": "c4b98de06bff934cb25ab0a8dff99b4e9be848c4", "url": "https://github.com/bakdata/conquery/commit/c4b98de06bff934cb25ab0a8dff99b4e9be848c4", "message": "fix compile error", "committedDate": "2020-12-16T11:57:33Z", "type": "commit"}, {"oid": "fc7d1ba811feb6d139627456117d109d3fcce02e", "url": "https://github.com/bakdata/conquery/commit/fc7d1ba811feb6d139627456117d109d3fcce02e", "message": "don't rebase if not necessary", "committedDate": "2021-01-07T17:10:09Z", "type": "commit"}, {"oid": "3accd3f5f41a5a5656d1ae1800f5f64693923c5d", "url": "https://github.com/bakdata/conquery/commit/3accd3f5f41a5a5656d1ae1800f5f64693923c5d", "message": "clean up IntegerParser test to respect optional-only rebasing", "committedDate": "2021-01-14T13:15:30Z", "type": "commit"}, {"oid": "36e46e37eed287e59c904437bd605293136760c6", "url": "https://github.com/bakdata/conquery/commit/36e46e37eed287e59c904437bd605293136760c6", "message": "Fix faulty delegation in StringTypeEncoded", "committedDate": "2021-01-14T13:27:04Z", "type": "commit"}, {"oid": "f5e40c3362dcfc4c3a79baaece1e408d0e5b8194", "url": "https://github.com/bakdata/conquery/commit/f5e40c3362dcfc4c3a79baaece1e408d0e5b8194", "message": "fix DateParser not delegating properly", "committedDate": "2021-01-14T13:43:33Z", "type": "commit"}, {"oid": "40dd948f38571cfe6a2e6f0815752837d087af83", "url": "https://github.com/bakdata/conquery/commit/40dd948f38571cfe6a2e6f0815752837d087af83", "message": "fix accidentally using wrong value registering mechanism", "committedDate": "2021-01-14T13:51:03Z", "type": "commit"}, {"oid": "22876f47eaa0088d8fa84f7ad87ecf4b4dc8412a", "url": "https://github.com/bakdata/conquery/commit/22876f47eaa0088d8fa84f7ad87ecf4b4dc8412a", "message": "fix not checking for not-set dates of Enitity", "committedDate": "2021-01-14T16:04:00Z", "type": "commit"}, {"oid": "7fa82603e6b6184c3d8eb0178e278e9530b5061b", "url": "https://github.com/bakdata/conquery/commit/7fa82603e6b6184c3d8eb0178e278e9530b5061b", "message": "Merge branch 'develop' into feature/bye-bye-bucket-templates\n\n# Conflicts:\n#\tbackend/src/main/java/com/bakdata/conquery/io/xodus/ModificationShieldedWorkerStorage.java\n#\tbackend/src/main/java/com/bakdata/conquery/io/xodus/NamespacedStorageImpl.java\n#\tbackend/src/main/java/com/bakdata/conquery/models/datasets/Table.java\n#\tbackend/src/main/java/com/bakdata/conquery/models/events/Bucket.java\n#\tbackend/src/main/java/com/bakdata/conquery/models/events/BucketManager.java\n#\tbackend/src/main/java/com/bakdata/conquery/models/forms/managed/RelativeFormQueryPlan.java\n#\tbackend/src/main/java/com/bakdata/conquery/models/jobs/ImportJob.java\n#\tbackend/src/main/java/com/bakdata/conquery/models/preproc/Preprocessed.java\n#\tbackend/src/main/java/com/bakdata/conquery/models/preproc/Preprocessor.java\n#\tbackend/src/main/java/com/bakdata/conquery/models/query/queryplan/SecondaryIdQueryPlan.java\n#\tbackend/src/main/java/com/bakdata/conquery/resources/admin/rest/AdminDatasetResource.java\n#\tbackend/src/main/java/com/bakdata/conquery/resources/admin/rest/AdminProcessor.java\n#\tbackend/src/main/java/com/bakdata/conquery/resources/admin/ui/DatasetsUIResource.java\n#\tbackend/src/main/java/com/bakdata/conquery/resources/admin/ui/TablesUIResource.java\n#\tbackend/src/test/java/com/bakdata/conquery/integration/common/RequiredColumn.java\n#\tdocs/Concept JSONs.md\n#\tdocs/Table JSONs.md", "committedDate": "2021-01-14T16:29:17Z", "type": "commit"}, {"oid": "ae8a22953a4a1f29badb798020465d33cbeb3381", "url": "https://github.com/bakdata/conquery/commit/ae8a22953a4a1f29badb798020465d33cbeb3381", "message": "post merge fixes", "committedDate": "2021-01-14T16:35:21Z", "type": "commit"}, {"oid": "a6854c15bd3c37a57b5e915350def055cabd6c28", "url": "https://github.com/bakdata/conquery/commit/a6854c15bd3c37a57b5e915350def055cabd6c28", "message": "automatic update to docs", "committedDate": "2021-01-14T16:43:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODA2MjcwNQ==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r558062705", "bodyText": "Warum m\u00fcssen die ImportColumns registriert werden?", "author": "thoniTUB", "createdAt": "2021-01-15T08:50:29Z", "path": "backend/src/main/java/com/bakdata/conquery/io/xodus/NamespacedStorageImpl.java", "diffHunk": "@@ -129,16 +131,29 @@ protected void createStores(Multimap<Environment, KeyIncludingStore<?, ?>> envir\n \t\t\t\t\t\t  .onAdd(imp -> {\n \t\t\t\t\t\t\t  imp.loadExternalInfos(this);\n \n-\t\t\t\t\t\t\t  if (registerImports) {\n-\t\t\t\t\t\t\t\t  for (Concept<?> c : getAllConcepts()) {\n-\t\t\t\t\t\t\t\t\t  for (Connector con : c.getConnectors()) {\n-\t\t\t\t\t\t\t\t\t\t  if (con.getTable().getId().equals(imp.getTable())) {\n-\t\t\t\t\t\t\t\t\t\t\t  con.addImport(imp);\n-\t\t\t\t\t\t\t\t\t\t  }\n-\t\t\t\t\t\t\t\t\t  }\n-\t\t\t\t\t\t\t\t  }\n-\t\t\t\t\t\t\t  }\n-\t\t\t\t\t\t  });\n+\t\t\t\tif (registerImports) {\n+\t\t\t\t\tfor (Concept<?> c : getAllConcepts()) {\n+\t\t\t\t\t\tfor (Connector con : c.getConnectors()) {\n+\t\t\t\t\t\t\tif (con.getTable().getId().equals(imp.getTable())) {\n+\t\t\t\t\t\t\t\tcon.addImport(imp);\n+\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t}\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\n+\t\t\t\tcentralRegistry.register(imp);\n+\n+\t\t\t\tfor (ImportColumn column : imp.getColumns()) {", "originalCommit": "a6854c15bd3c37a57b5e915350def055cabd6c28", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODMxMzk5OA==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r558313998", "bodyText": "sieht nicht so aus als w\u00e4re das noch notwendig, habe es mal entfernt", "author": "awildturtok", "createdAt": "2021-01-15T13:43:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODA2MjcwNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODA2NjgzOA==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r558066838", "bodyText": "Ist mir noch nie aufgefallen, diese Datei", "author": "thoniTUB", "createdAt": "2021-01-15T08:53:13Z", "path": "backend/src/main/java/com/bakdata/conquery/models/config/CouchDBConfig.java", "diffHunk": "@@ -1,5 +0,0 @@\n-package com.bakdata.conquery.models.config;\n-\n-public class CouchDBConfig {", "originalCommit": "a6854c15bd3c37a57b5e915350def055cabd6c28", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODA2NzQ1NQ==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r558067455", "bodyText": "\ud83d\udc4d", "author": "thoniTUB", "createdAt": "2021-01-15T08:53:38Z", "path": "backend/src/main/java/com/bakdata/conquery/models/datasets/Column.java", "diffHunk": "@@ -21,7 +21,6 @@\n public class Column extends Labeled<ColumnId> {\n \n \tpublic static final int UNKNOWN_POSITION = -1;\n-\tpublic static final int PRIMARY_POSITION = -2;", "originalCommit": "a6854c15bd3c37a57b5e915350def055cabd6c28", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODA3MTc2OA==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r558071768", "bodyText": "\ud83d\udc4d", "author": "thoniTUB", "createdAt": "2021-01-15T08:56:25Z", "path": "backend/src/main/java/com/bakdata/conquery/models/datasets/ImportColumn.java", "diffHunk": "@@ -1,47 +1,30 @@\n package com.bakdata.conquery.models.datasets;\n \n import javax.validation.Valid;\n-import javax.validation.constraints.Min;\n import javax.validation.constraints.NotNull;\n \n+import com.bakdata.conquery.models.events.stores.ColumnStore;\n import com.bakdata.conquery.models.identifiable.NamedImpl;\n import com.bakdata.conquery.models.identifiable.ids.specific.ImportColumnId;\n-import com.bakdata.conquery.models.types.CType;\n import com.fasterxml.jackson.annotation.JsonBackReference;\n-import com.fasterxml.jackson.annotation.JsonIgnore;\n-import lombok.Getter;\n-import lombok.NoArgsConstructor;\n-import lombok.Setter;\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import lombok.Data;\n+import lombok.RequiredArgsConstructor;\n \n-@Getter @Setter @NoArgsConstructor\n+@Data\n+@RequiredArgsConstructor(onConstructor_ = {@JsonCreator})\n public class ImportColumn extends NamedImpl<ImportColumnId> {\n+\t// TODO reduce usage of this class, it does nothing except hold a description", "originalCommit": "a6854c15bd3c37a57b5e915350def055cabd6c28", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODA3MjIyNg==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r558072226", "bodyText": "und einen Namen", "author": "thoniTUB", "createdAt": "2021-01-15T08:56:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODA3MTc2OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODMxNTI2Nw==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r558315267", "bodyText": "Wobei die ganze Klasse aktuell nur noch zur Absch\u00e4tzung des Speichervrebrauchs benutzt wird", "author": "awildturtok", "createdAt": "2021-01-15T13:45:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODA3MTc2OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODA3NDAwNg==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r558074006", "bodyText": "Hier m\u00fcssen dann die Tables umgeschrieben werden, oder?", "author": "thoniTUB", "createdAt": "2021-01-15T08:57:42Z", "path": "backend/src/main/java/com/bakdata/conquery/models/datasets/Table.java", "diffHunk": "@@ -29,14 +29,7 @@\n \n \t@NsIdRef\n \tprivate Dataset dataset;\n-\n-\t@NotNull\n-\t@Valid\n-\t@JsonManagedReference\n-\tprivate Column primaryColumn; // TODO this is not used anywhere.", "originalCommit": "a6854c15bd3c37a57b5e915350def055cabd6c28", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODI2NjUxMA==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r558266510", "bodyText": "Habe schon einen branch f\u00fcr vorbereitet, ist ein jq einzeiler", "author": "awildturtok", "createdAt": "2021-01-15T12:10:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODA3NDAwNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODA3ODgwOA==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r558078808", "bodyText": "Es sieht so aus als hat das DictionaryMapping jetzt eine persistentere Rolle. Kannst du bitte noch Doku hinzuf\u00fcgen", "author": "thoniTUB", "createdAt": "2021-01-15T09:00:29Z", "path": "backend/src/main/java/com/bakdata/conquery/models/dictionary/DictionaryMapping.java", "diffHunk": "@@ -19,20 +17,21 @@\n @RequiredArgsConstructor(access = AccessLevel.PRIVATE)\n @Getter\n @Slf4j\n+@ToString\n public class DictionaryMapping {", "originalCommit": "a6854c15bd3c37a57b5e915350def055cabd6c28", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODMxNjI0OQ==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r558316249", "bodyText": "Ne hat die gleiche Rolle wie davor und lebt nur im ImportJob", "author": "awildturtok", "createdAt": "2021-01-15T13:46:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODA3ODgwOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODA4MTE5Nw==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r558081197", "bodyText": "Bitte Doku, weshalb das Encoding hier notwendig ist und warum es nicht fix sein kann.", "author": "thoniTUB", "createdAt": "2021-01-15T09:02:05Z", "path": "backend/src/main/java/com/bakdata/conquery/models/dictionary/EncodedDictionary.java", "diffHunk": "@@ -0,0 +1,23 @@\n+package com.bakdata.conquery.models.dictionary;\n+\n+import com.bakdata.conquery.models.events.stores.specific.string.StringTypeEncoded;\n+\n+public class EncodedDictionary {", "originalCommit": "a6854c15bd3c37a57b5e915350def055cabd6c28", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTY2OTk5Nw==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r559669997", "bodyText": "Das Encoding ist fix, aber Dictionaries haben keins", "author": "awildturtok", "createdAt": "2021-01-18T16:08:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODA4MTE5Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODA4MjQzMg==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r558082432", "bodyText": "new Object() ?", "author": "thoniTUB", "createdAt": "2021-01-15T09:02:50Z", "path": "backend/src/main/java/com/bakdata/conquery/models/dictionary/EncodedDictionary.java", "diffHunk": "@@ -0,0 +1,23 @@\n+package com.bakdata.conquery.models.dictionary;\n+\n+import com.bakdata.conquery.models.events.stores.specific.string.StringTypeEncoded;\n+\n+public class EncodedDictionary {\n+\n+\tprivate final Dictionary dict;\n+\tprivate final StringTypeEncoded.Encoding encoding;\n+\n+\tpublic EncodedDictionary(Dictionary dict, StringTypeEncoded.Encoding encoding) {\n+\t\tsuper();", "originalCommit": "a6854c15bd3c37a57b5e915350def055cabd6c28", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODM1ODE5MA==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r558358190", "bodyText": "Die Klasse erbt nichts explizt meinte ich damit ;)", "author": "thoniTUB", "createdAt": "2021-01-15T14:52:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODA4MjQzMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODE2NzQzMQ==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r558167431", "bodyText": "Doku f\u00fcr diesen SpecialStore bitte", "author": "thoniTUB", "createdAt": "2021-01-15T09:58:30Z", "path": "backend/src/main/java/com/bakdata/conquery/models/events/EmptyStore.java", "diffHunk": "@@ -0,0 +1,39 @@\n+package com.bakdata.conquery.models.events;\n+\n+import com.bakdata.conquery.io.cps.CPSType;\n+import com.bakdata.conquery.models.events.stores.ColumnStore;\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+\n+@CPSType(base = ColumnStore.class, id = \"EMPTY\")\n+public class EmptyStore<T> extends ColumnStore<T> {", "originalCommit": "a6854c15bd3c37a57b5e915350def055cabd6c28", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODE3MTgzOA==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r558171838", "bodyText": "Warum ist der hier special?", "author": "thoniTUB", "createdAt": "2021-01-15T10:01:17Z", "path": "backend/src/main/java/com/bakdata/conquery/models/events/parser/MajorTypeId.java", "diffHunk": "@@ -0,0 +1,37 @@\n+package com.bakdata.conquery.models.events.parser;\n+\n+import java.util.function.Function;\n+\n+import com.bakdata.conquery.models.config.ParserConfig;\n+import com.bakdata.conquery.models.events.parser.specific.BooleanParser;\n+import com.bakdata.conquery.models.events.parser.specific.DateParser;\n+import com.bakdata.conquery.models.events.parser.specific.DateRangeParser;\n+import com.bakdata.conquery.models.events.parser.specific.DecimalParser;\n+import com.bakdata.conquery.models.events.parser.specific.IntegerParser;\n+import com.bakdata.conquery.models.events.parser.specific.MoneyParser;\n+import com.bakdata.conquery.models.events.parser.specific.RealParser;\n+import com.bakdata.conquery.models.events.parser.specific.string.StringParser;\n+import lombok.Getter;\n+import lombok.RequiredArgsConstructor;\n+\n+@RequiredArgsConstructor\n+public enum MajorTypeId {\n+\n+\tSTRING(false, StringParser::new),\n+\tINTEGER(false, t -> new IntegerParser()),", "originalCommit": "a6854c15bd3c37a57b5e915350def055cabd6c28", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODM1OTg1MQ==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r558359851", "bodyText": "ists nicht, ich war nur faul", "author": "awildturtok", "createdAt": "2021-01-15T14:55:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODE3MTgzOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODM1OTkwNQ==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r558359905", "bodyText": "ist behoben", "author": "awildturtok", "createdAt": "2021-01-15T14:55:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODE3MTgzOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODIxMDQ5OQ==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r558210499", "bodyText": "Doku f\u00fcr die String Guesser bitte", "author": "thoniTUB", "createdAt": "2021-01-15T10:28:22Z", "path": "backend/src/main/java/com/bakdata/conquery/models/events/parser/specific/string/MapTypeGuesser.java", "diffHunk": "@@ -0,0 +1,51 @@\n+package com.bakdata.conquery.models.events.parser.specific.string;\n+\n+import com.bakdata.conquery.models.dictionary.MapDictionary;\n+import com.bakdata.conquery.models.events.stores.ColumnStore;\n+import com.bakdata.conquery.models.events.stores.specific.string.StringType;\n+import com.bakdata.conquery.models.events.stores.specific.string.StringTypeDictionary;\n+import com.bakdata.conquery.models.events.stores.specific.string.StringTypeEncoded;\n+import lombok.RequiredArgsConstructor;\n+\n+@RequiredArgsConstructor\n+public class MapTypeGuesser implements TypeGuesser {", "originalCommit": "a6854c15bd3c37a57b5e915350def055cabd6c28", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODIxOTc3Mg==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r558219772", "bodyText": "nullLines wird hier nur als Statistik genutzt, oder?\nK\u00f6nnte man dem Member nicht auch die tats\u00e4chlichen nullLines geben und so die Berechnung vereinfachen?", "author": "thoniTUB", "createdAt": "2021-01-15T10:36:37Z", "path": "backend/src/main/java/com/bakdata/conquery/models/events/stores/ColumnStore.java", "diffHunk": "@@ -0,0 +1,134 @@\n+package com.bakdata.conquery.models.events.stores;\n+\n+import java.math.BigDecimal;\n+import java.util.Arrays;\n+import java.util.function.Function;\n+\n+import javax.annotation.CheckForNull;\n+\n+import com.bakdata.conquery.io.cps.CPSBase;\n+import com.bakdata.conquery.models.common.daterange.CDateRange;\n+import com.fasterxml.jackson.annotation.JsonTypeInfo;\n+import lombok.Getter;\n+import lombok.RequiredArgsConstructor;\n+import lombok.Setter;\n+import lombok.ToString;\n+\n+@Getter\n+@Setter\n+@RequiredArgsConstructor\n+@JsonTypeInfo(use = JsonTypeInfo.Id.CUSTOM, property = \"type\")\n+@CPSBase\n+@ToString\n+public abstract class ColumnStore<JAVA_TYPE> {\n+\n+\tprivate int lines = 0;\n+\tprivate int nullLines = 0;", "originalCommit": "a6854c15bd3c37a57b5e915350def055cabd6c28", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTY2OTQ2NA==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r559669464", "bodyText": "Habs entfernt", "author": "awildturtok", "createdAt": "2021-01-18T16:07:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODIxOTc3Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODIyMDIyMA==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r558220220", "bodyText": "Doku", "author": "thoniTUB", "createdAt": "2021-01-15T10:37:28Z", "path": "backend/src/main/java/com/bakdata/conquery/models/events/stores/ColumnStore.java", "diffHunk": "@@ -0,0 +1,134 @@\n+package com.bakdata.conquery.models.events.stores;\n+\n+import java.math.BigDecimal;\n+import java.util.Arrays;\n+import java.util.function.Function;\n+\n+import javax.annotation.CheckForNull;\n+\n+import com.bakdata.conquery.io.cps.CPSBase;\n+import com.bakdata.conquery.models.common.daterange.CDateRange;\n+import com.fasterxml.jackson.annotation.JsonTypeInfo;\n+import lombok.Getter;\n+import lombok.RequiredArgsConstructor;\n+import lombok.Setter;\n+import lombok.ToString;\n+\n+@Getter\n+@Setter\n+@RequiredArgsConstructor\n+@JsonTypeInfo(use = JsonTypeInfo.Id.CUSTOM, property = \"type\")\n+@CPSBase\n+@ToString\n+public abstract class ColumnStore<JAVA_TYPE> {\n+\n+\tprivate int lines = 0;\n+\tprivate int nullLines = 0;\n+\n+\t/**\n+\t * Helper method to select partitions of an array. Resulting array is of length sum(lengths). Incoming type T has to be of ArrayType or this will fail.\n+\t */\n+\tpublic static <T> T selectArray(int[] starts, int[] lengths, T values, Function<Integer, T> provider) {\n+\t\tint length = Arrays.stream(lengths).sum();\n+\n+\t\tfinal T out = provider.apply(length);\n+\n+\t\tint pos = 0;\n+\n+\t\tfor (int index = 0; index < starts.length; index++) {\n+\t\t\tSystem.arraycopy(values, starts[index], out, pos, lengths[index]);\n+\t\t\tpos += lengths[index];\n+\t\t}\n+\n+\t\treturn out;\n+\t}\n+\n+\tpublic Object createPrintValue(JAVA_TYPE value) {\n+\t\treturn value != null ? createScriptValue(value) : \"\";\n+\t}\n+\n+\tpublic Object createScriptValue(JAVA_TYPE value) {\n+\t\treturn value;\n+\t}\n+\n+\tpublic long estimateMemoryConsumption() {\n+\t\tlong bytes = estimateEventBits();\n+\n+\t\treturn getLines() * bytes;\n+\t}\n+\n+\tpublic abstract long estimateEventBits();", "originalCommit": "a6854c15bd3c37a57b5e915350def055cabd6c28", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODIyMDY0Nw==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r558220647", "bodyText": "public?", "author": "thoniTUB", "createdAt": "2021-01-15T10:38:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODIyMDIyMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODIyNDgyMA==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r558224820", "bodyText": "Ist die storeSize nicht (lines-nullLines)*56 bytes?", "author": "thoniTUB", "createdAt": "2021-01-15T10:45:47Z", "path": "backend/src/main/java/com/bakdata/conquery/models/events/stores/base/DecimalStore.java", "diffHunk": "@@ -0,0 +1,61 @@\n+package com.bakdata.conquery.models.events.stores.base;\n+\n+import java.math.BigDecimal;\n+\n+import com.bakdata.conquery.io.cps.CPSType;\n+import com.bakdata.conquery.models.events.stores.ColumnStore;\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import lombok.Getter;\n+import lombok.ToString;\n+\n+@CPSType(id = \"DECIMALS\", base = ColumnStore.class)\n+@Getter\n+@ToString(onlyExplicitlyIncluded = true)\n+public class DecimalStore extends ColumnStore<BigDecimal> {\n+\n+\tprivate final BigDecimal[] values;\n+\n+\t@JsonCreator\n+\tpublic DecimalStore(BigDecimal[] values) {\n+\t\tthis.values = values;\n+\t}\n+\n+\tpublic static DecimalStore create(int size) {\n+\t\treturn new DecimalStore(new BigDecimal[size]);\n+\t}\n+\n+\t@Override\n+\tpublic long estimateEventBits() {\n+\t\treturn 500; // It's a lot but non-deterministic so we have no idea :)\n+\t}", "originalCommit": "a6854c15bd3c37a57b5e915350def055cabd6c28", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODI2NzE4OQ==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r558267189", "bodyText": "Woher hast du die Zahl? die 500 war davor auch schon drin", "author": "awildturtok", "createdAt": "2021-01-15T12:12:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODIyNDgyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODM2MjUzNg==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r558362536", "bodyText": "Ah 56 bytes scheint BigInteger zu sein. BigDecimal ist dann 32 byte * 8 = 256 bit\nhttp://javamoods.blogspot.com/2009/03/how-big-is-bigdecimal.html", "author": "thoniTUB", "createdAt": "2021-01-15T14:59:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODIyNDgyMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODIyODk1OQ==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r558228959", "bodyText": "Was passiert wenn value.equals(nullValue)?", "author": "thoniTUB", "createdAt": "2021-01-15T10:53:30Z", "path": "backend/src/main/java/com/bakdata/conquery/models/events/stores/base/IntegerStore.java", "diffHunk": "@@ -0,0 +1,66 @@\n+package com.bakdata.conquery.models.events.stores.base;\n+\n+import com.bakdata.conquery.io.cps.CPSType;\n+import com.bakdata.conquery.models.events.stores.ColumnStore;\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import lombok.Getter;\n+import lombok.ToString;\n+\n+\n+/**\n+ * Store values as ints, can only store 2^32-1 values, as MAX is used as NULL signifier.\n+ *\n+ * @apiNote do not instantiate this directly, but use {@link com.bakdata.conquery.models.events.parser.specific.IntegerParser}\n+ */\n+@CPSType(id = \"INTEGERS\", base = ColumnStore.class)\n+@Getter\n+@ToString(onlyExplicitlyIncluded = true)\n+public class IntegerStore extends ColumnStore<Long> {\n+\n+\tprivate final int nullValue;\n+\tprivate final int[] values;\n+\n+\t@JsonCreator\n+\tpublic IntegerStore(int[] values, int nullValue) {\n+\t\tthis.nullValue = nullValue;\n+\t\tthis.values = values;\n+\t}\n+\n+\tpublic static IntegerStore create(int size) {\n+\t\treturn new IntegerStore(new int[size], Integer.MAX_VALUE);\n+\t}\n+\n+\t@Override\n+\tpublic long estimateEventBits() {\n+\t\treturn Integer.SIZE;\n+\t}\n+\n+\tpublic IntegerStore select(int[] starts, int[] ends) {\n+\t\treturn new IntegerStore(ColumnStore.selectArray(starts, ends, values, int[]::new), nullValue);\n+\t}\n+\n+\t@Override\n+\tpublic void set(int event, Long value) {", "originalCommit": "a6854c15bd3c37a57b5e915350def055cabd6c28", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODI2NzQ2Nw==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r558267467", "bodyText": "Ist durch den Parser ausgeschlossen", "author": "awildturtok", "createdAt": "2021-01-15T12:12:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODIyODk1OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODI2NzU3NA==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r558267574", "bodyText": "ah au\u00dfer hier nat\u00fcrlich, du hast recht.", "author": "awildturtok", "createdAt": "2021-01-15T12:12:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODIyODk1OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTY1NDUxNQ==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r559654515", "bodyText": "ok, ich habe einen check und ein todo eingabut f\u00fcr den LongStore, dass ich das auf null-bits umstelle", "author": "awildturtok", "createdAt": "2021-01-18T15:44:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODIyODk1OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODIzMTg0OQ==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r558231849", "bodyText": "Die anderen Stores sind nicht Iterable oder?", "author": "thoniTUB", "createdAt": "2021-01-15T10:58:46Z", "path": "backend/src/main/java/com/bakdata/conquery/models/events/stores/specific/string/StringType.java", "diffHunk": "@@ -0,0 +1,36 @@\n+package com.bakdata.conquery.models.events.stores.specific.string;\n+\n+import com.bakdata.conquery.io.xodus.NamespacedStorage;\n+import com.bakdata.conquery.models.dictionary.Dictionary;\n+import com.bakdata.conquery.models.events.stores.ColumnStore;\n+import com.bakdata.conquery.models.identifiable.ids.specific.DictionaryId;\n+import com.fasterxml.jackson.annotation.JsonIgnore;\n+import lombok.NoArgsConstructor;\n+\n+/**\n+ * Every implementation must guarantee IDs between 0 and size.\n+ *\n+ * Abstract\n+ */\n+@NoArgsConstructor\n+public abstract class StringType extends ColumnStore<Integer> implements Iterable<String> {", "originalCommit": "a6854c15bd3c37a57b5e915350def055cabd6c28", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODI2ODA5MQ==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r558268091", "bodyText": "ne, ich will das eigentlich auch noch entfernen, weil das quatsch ist.", "author": "awildturtok", "createdAt": "2021-01-15T12:14:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODIzMTg0OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODIzMjI3Mw==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r558232273", "bodyText": "Sollte ein Store nach seiner bef\u00fcllung noch mutable sein?", "author": "thoniTUB", "createdAt": "2021-01-15T10:59:30Z", "path": "backend/src/main/java/com/bakdata/conquery/models/events/stores/ColumnStore.java", "diffHunk": "@@ -0,0 +1,134 @@\n+package com.bakdata.conquery.models.events.stores;\n+\n+import java.math.BigDecimal;\n+import java.util.Arrays;\n+import java.util.function.Function;\n+\n+import javax.annotation.CheckForNull;\n+\n+import com.bakdata.conquery.io.cps.CPSBase;\n+import com.bakdata.conquery.models.common.daterange.CDateRange;\n+import com.fasterxml.jackson.annotation.JsonTypeInfo;\n+import lombok.Getter;\n+import lombok.RequiredArgsConstructor;\n+import lombok.Setter;\n+import lombok.ToString;\n+\n+@Getter\n+@Setter\n+@RequiredArgsConstructor\n+@JsonTypeInfo(use = JsonTypeInfo.Id.CUSTOM, property = \"type\")\n+@CPSBase\n+@ToString\n+public abstract class ColumnStore<JAVA_TYPE> {", "originalCommit": "a6854c15bd3c37a57b5e915350def055cabd6c28", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODI2ODQ5OA==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r558268498", "bodyText": "W\u00e4re mir lieber wenn nicht, aber das DictionaryMapping erzwingt das, bzw dann m\u00fcssten wir ihn komplett neu schreiben. und das w\u00fcrde auch ein paar andere methoden komplizieren.", "author": "awildturtok", "createdAt": "2021-01-15T12:15:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODIzMjI3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODM2NDA4OQ==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r558364089", "bodyText": "okay, wenn er n\u00e4mlich immutable w\u00e4re, dann w\u00fcrde es das hier nicht geben", "author": "thoniTUB", "createdAt": "2021-01-15T15:01:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODIzMjI3Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODIzMzk3MA==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r558233970", "bodyText": "Oder erstmal eine DictionaryId, dann musst du sie dir nicht immer wieder zusammen bauen", "author": "thoniTUB", "createdAt": "2021-01-15T11:02:50Z", "path": "backend/src/main/java/com/bakdata/conquery/models/events/stores/specific/string/StringTypeDictionary.java", "diffHunk": "@@ -0,0 +1,144 @@\n+package com.bakdata.conquery.models.events.stores.specific.string;\n+\n+import java.util.Collections;\n+import java.util.Iterator;\n+import java.util.Objects;\n+\n+import com.bakdata.conquery.io.cps.CPSType;\n+import com.bakdata.conquery.io.jackson.InternalOnly;\n+import com.bakdata.conquery.io.xodus.NamespacedStorage;\n+import com.bakdata.conquery.models.dictionary.Dictionary;\n+import com.bakdata.conquery.models.dictionary.DictionaryEntry;\n+import com.bakdata.conquery.models.events.stores.ColumnStore;\n+import com.bakdata.conquery.models.identifiable.ids.specific.DatasetId;\n+import com.bakdata.conquery.models.identifiable.ids.specific.DictionaryId;\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import com.fasterxml.jackson.annotation.JsonIgnore;\n+import com.google.common.collect.Iterators;\n+import lombok.Getter;\n+import lombok.Setter;\n+import lombok.extern.slf4j.Slf4j;\n+\n+@Getter\n+@Setter\n+@Slf4j\n+@CPSType(base = ColumnStore.class, id = \"STRING_DICTIONARY\")\n+public class StringTypeDictionary extends ColumnStore<Integer> {\n+\n+\tprotected ColumnStore<Long> numberType;\n+\n+\t@JsonIgnore\n+\tprivate transient Dictionary dictionary;\n+\n+\t// todo use NsIdRef\n+\tprivate String name;", "originalCommit": "a6854c15bd3c37a57b5e915350def055cabd6c28", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODM2Njk5OQ==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r558366999", "bodyText": "Das ist die gleiche implementierung wie du sie letztens f\u00fcr develop schon gemacht hast? :D", "author": "awildturtok", "createdAt": "2021-01-15T15:06:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODIzMzk3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODM2ODQyMA==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r558368420", "bodyText": "resemblance is uncanny", "author": "thoniTUB", "createdAt": "2021-01-15T15:08:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODIzMzk3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NzgwOTcyNA==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r567809724", "bodyText": "Das kann man noch aggressiver mit IdSystem machen, w\u00fcrde ich mir aber f\u00fcr einen weiteren PR aufsparen.", "author": "awildturtok", "createdAt": "2021-02-01T13:06:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODIzMzk3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NzgwOTkxNg==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r567809916", "bodyText": "Indem man in 2 Phasen importiert, kann man die Dictionaries ohne gehudel einfach decoden.", "author": "awildturtok", "createdAt": "2021-02-01T13:06:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODIzMzk3MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODIzNDY3NQ==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r558234675", "bodyText": "bekommst du name, bzw. die id,  nicht aus dem dictionary", "author": "thoniTUB", "createdAt": "2021-01-15T11:04:13Z", "path": "backend/src/main/java/com/bakdata/conquery/models/events/stores/specific/string/StringTypeDictionary.java", "diffHunk": "@@ -0,0 +1,144 @@\n+package com.bakdata.conquery.models.events.stores.specific.string;\n+\n+import java.util.Collections;\n+import java.util.Iterator;\n+import java.util.Objects;\n+\n+import com.bakdata.conquery.io.cps.CPSType;\n+import com.bakdata.conquery.io.jackson.InternalOnly;\n+import com.bakdata.conquery.io.xodus.NamespacedStorage;\n+import com.bakdata.conquery.models.dictionary.Dictionary;\n+import com.bakdata.conquery.models.dictionary.DictionaryEntry;\n+import com.bakdata.conquery.models.events.stores.ColumnStore;\n+import com.bakdata.conquery.models.identifiable.ids.specific.DatasetId;\n+import com.bakdata.conquery.models.identifiable.ids.specific.DictionaryId;\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import com.fasterxml.jackson.annotation.JsonIgnore;\n+import com.google.common.collect.Iterators;\n+import lombok.Getter;\n+import lombok.Setter;\n+import lombok.extern.slf4j.Slf4j;\n+\n+@Getter\n+@Setter\n+@Slf4j\n+@CPSType(base = ColumnStore.class, id = \"STRING_DICTIONARY\")\n+public class StringTypeDictionary extends ColumnStore<Integer> {\n+\n+\tprotected ColumnStore<Long> numberType;\n+\n+\t@JsonIgnore\n+\tprivate transient Dictionary dictionary;\n+\n+\t// todo use NsIdRef\n+\tprivate String name;\n+\n+\t@InternalOnly\n+\tprivate DatasetId dataset;\n+\n+\tpublic StringTypeDictionary(ColumnStore<Long> numberType, Dictionary dictionary, String name) {\n+\t\tthis.numberType = numberType;\n+\t\tthis.dictionary = dictionary;\n+\t\tthis.name = name;\n+\t}", "originalCommit": "a6854c15bd3c37a57b5e915350def055cabd6c28", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODM3MjUwNA==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r558372504", "bodyText": "Musste gerade selber nachschauen, warum ich das so komisch mache: Die Id des Dictionaries ist erst sehr sp\u00e4t bekannt, und dann dient das hier als JsonCreator. Wenn wir die Dictionaries in NsIdRef bekommen kann das weg.", "author": "awildturtok", "createdAt": "2021-01-15T15:14:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODIzNDY3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTM2MzcwMQ==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r559363701", "bodyText": "Aber ich glaube, dass du dir ein sp\u00e4ter einen Neuimport sparen kannst, wenn du jetzt schon direkt die Id (de)serialisieren l\u00e4sst, an statt sie dir selber zusammen zu bauen", "author": "thoniTUB", "createdAt": "2021-01-18T07:36:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODIzNDY3NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODIzNTQyMQ==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r558235421", "bodyText": "Wann w\u00fcrde man diese Funktion nehmen?", "author": "thoniTUB", "createdAt": "2021-01-15T11:05:32Z", "path": "backend/src/main/java/com/bakdata/conquery/models/events/stores/specific/string/StringTypeDictionary.java", "diffHunk": "@@ -0,0 +1,144 @@\n+package com.bakdata.conquery.models.events.stores.specific.string;\n+\n+import java.util.Collections;\n+import java.util.Iterator;\n+import java.util.Objects;\n+\n+import com.bakdata.conquery.io.cps.CPSType;\n+import com.bakdata.conquery.io.jackson.InternalOnly;\n+import com.bakdata.conquery.io.xodus.NamespacedStorage;\n+import com.bakdata.conquery.models.dictionary.Dictionary;\n+import com.bakdata.conquery.models.dictionary.DictionaryEntry;\n+import com.bakdata.conquery.models.events.stores.ColumnStore;\n+import com.bakdata.conquery.models.identifiable.ids.specific.DatasetId;\n+import com.bakdata.conquery.models.identifiable.ids.specific.DictionaryId;\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import com.fasterxml.jackson.annotation.JsonIgnore;\n+import com.google.common.collect.Iterators;\n+import lombok.Getter;\n+import lombok.Setter;\n+import lombok.extern.slf4j.Slf4j;\n+\n+@Getter\n+@Setter\n+@Slf4j\n+@CPSType(base = ColumnStore.class, id = \"STRING_DICTIONARY\")\n+public class StringTypeDictionary extends ColumnStore<Integer> {\n+\n+\tprotected ColumnStore<Long> numberType;\n+\n+\t@JsonIgnore\n+\tprivate transient Dictionary dictionary;\n+\n+\t// todo use NsIdRef\n+\tprivate String name;\n+\n+\t@InternalOnly\n+\tprivate DatasetId dataset;\n+\n+\tpublic StringTypeDictionary(ColumnStore<Long> numberType, Dictionary dictionary, String name) {\n+\t\tthis.numberType = numberType;\n+\t\tthis.dictionary = dictionary;\n+\t\tthis.name = name;\n+\t}\n+\n+\t@JsonCreator\n+\tpublic StringTypeDictionary(ColumnStore<Long> numberType, DatasetId dataset, String name) {\n+\t\tthis.numberType = numberType;\n+\t\tthis.name = name;\n+\t\tthis.dataset = dataset;\n+\t}\n+\n+\t@Override\n+\tpublic Object createScriptValue(Integer value) {\n+\t\treturn getElement(value);\n+\t}\n+\n+\tpublic byte[] getElement(int value) {\n+\t\treturn dictionary.getElement(value);\n+\t}\n+\n+\t@Override\n+\tpublic Object createPrintValue(Integer value) {\n+\t\treturn getElement(value);\n+\t}\n+\n+\n+\tpublic void loadDictionaries(NamespacedStorage storage) {\n+\t\t// todo consider implementing this with Id-Injection instead of hand-wiring.\n+\t\tfinal DictionaryId dictionaryId = new DictionaryId(getDataset(), getName());\n+\t\tlog.trace(\"Loading Dictionary[{}]\", dictionaryId);\n+\t\tdictionary = Objects.requireNonNull(storage.getDictionary(dictionaryId));\n+\t}\n+\n+\tpublic int size() {\n+\t\treturn dictionary.size();\n+\t}\n+\n+\tpublic int getId(byte[] value) {\n+\t\treturn dictionary.getId(value);\n+\t}\n+\n+\tpublic Iterator<byte[]> iterator() {\n+\t\tif(dictionary == null){\n+\t\t\treturn Collections.emptyIterator();\n+\t\t}\n+\n+\t\treturn Iterators.transform(dictionary.iterator(), DictionaryEntry::getValue);\n+\t}\n+\n+\t@Override\n+\tpublic String toString() {\n+\t\treturn \"StringTypeDictionary[dictionary=\" + dictionary + \", numberType=\" + numberType + \"]\";\n+\t}\n+\n+\t@Override\n+\tpublic long estimateTypeSize() {\n+\t\treturn dictionary.estimateMemoryConsumption();\n+\t}\n+\n+\n+\tpublic void setUnderlyingDictionary(DictionaryId newDict) {\n+\t\tname = newDict.getDictionary();\n+\t\tthis.dataset = newDict.getDataset();\n+\t}\n+\n+\t@Override\n+\tpublic StringTypeDictionary select(int[] starts, int[] length) {\n+\t\treturn new StringTypeDictionary(numberType.select(starts, length), getDataset(), getName());\n+\t}\n+\n+\t@Override\n+\tpublic int getString(int event) {\n+\t\treturn (int) getNumberType().getInteger(event);\n+\t}\n+\n+\t@Override\n+\tpublic Integer get(int event) {\n+\t\treturn getString(event);\n+\t}\n+\n+\t@Override\n+\tpublic long estimateEventBits() {\n+\t\treturn numberType.estimateEventBits();\n+\t}\n+\n+\t@Override\n+\tpublic void set(int event, Integer value) {\n+\t\tif (value == null) {\n+\t\t\tnumberType.set(event, null);\n+\t\t}\n+\t\telse {\n+\t\t\tnumberType.set(event, value.longValue());\n+\t\t}\n+\t}\n+\n+\t@Override\n+\tpublic final boolean has(int event) {\n+\t\treturn numberType.has(event);\n+\t}\n+\n+\tpublic void setIndexStore(ColumnStore<Long> newType) {", "originalCommit": "a6854c15bd3c37a57b5e915350def055cabd6c28", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODM2ODg2MQ==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r558368861", "bodyText": "das passiert wenn das Dictionary neu gemapped wird. Hab doku dran gemacht", "author": "awildturtok", "createdAt": "2021-01-15T15:09:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODIzNTQyMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODI0NTYxNg==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r558245616", "bodyText": "Ein 1 Byte Encoding w\u00e4re noch cool", "author": "thoniTUB", "createdAt": "2021-01-15T11:26:35Z", "path": "backend/src/main/java/com/bakdata/conquery/models/events/stores/specific/string/StringTypeEncoded.java", "diffHunk": "@@ -147,35 +75,109 @@ public String next() {\n \t\t\t}\n \t\t};\n \t}\n-\t\n+\n \t@Override\n \tpublic String toString() {\n \t\treturn \"StringTypeEncoded[encoding=\" + encoding + \", subType=\" + subType + \"]\";\n \t}\n-\t\n+\n \t@Override\n-\tpublic long estimateMemoryBitWidth() {\n-\t\treturn subType.estimateMemoryBitWidth();\n+\tpublic long estimateEventBits() {\n+\t\treturn subType.estimateEventBits();\n \t}\n-\t\n+\n \t@Override\n \tpublic long estimateMemoryConsumption() {\n \t\treturn subType.estimateMemoryConsumption();\n \t}\n-\t\n+\n \t@Override\n \tpublic long estimateTypeSize() {\n \t\treturn subType.estimateTypeSize();\n \t}\n-\t\n+\n \t@Override\n \tpublic Dictionary getUnderlyingDictionary() {\n \t\treturn subType.getDictionary();\n \t}\n-\t\n+\n \t@Override\n-\tpublic void adaptUnderlyingDictionary(Dictionary newDict, VarIntType newNumberType) {\n-\t\tsubType.adaptUnderlyingDictionary(newDict, newNumberType);\n-\t\tthis.setPrimitiveType(newNumberType.getPrimitiveType());\n+\tpublic void setUnderlyingDictionary(DictionaryId newDict) {\n+\t\tsubType.setUnderlyingDictionary(newDict);\n+\t}\n+\n+\t@Override\n+\tpublic void setIndexStore(ColumnStore<Long> newType) {\n+\t\tsubType.setIndexStore(newType);\n+\t}\n+\n+\t@Override\n+\tpublic StringTypeEncoded select(int[] starts, int[] length) {\n+\t\treturn new StringTypeEncoded(subType.select(starts, length), getEncoding());\n+\t}\n+\n+\t@Override\n+\tpublic void set(int event, Integer value) {\n+\t\tsubType.set(event, value);\n+\t}\n+\n+\t@Override\n+\tpublic Integer get(int event) {\n+\t\treturn getString(event);\n+\t}\n+\n+\t@Override\n+\tpublic int getString(int event) {\n+\t\treturn subType.getString(event);\n+\t}\n+\n+\t@Override\n+\tpublic boolean has(int event) {\n+\t\treturn subType.has(event);\n+\t}\n+\n+\t@RequiredArgsConstructor\n+\tpublic static enum Encoding {\n+\t\t// Order is for precedence, least specific encodings go last.", "originalCommit": "a6854c15bd3c37a57b5e915350def055cabd6c28", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODM2OTA5Nw==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r558369097", "bodyText": "Was meinst du?", "author": "awildturtok", "createdAt": "2021-01-15T15:09:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODI0NTYxNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODI0NjYxOA==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r558246618", "bodyText": "prefix +suffix", "author": "thoniTUB", "createdAt": "2021-01-15T11:28:37Z", "path": "backend/src/main/java/com/bakdata/conquery/models/events/stores/specific/string/StringTypePrefixSuffix.java", "diffHunk": "@@ -0,0 +1,140 @@\n+package com.bakdata.conquery.models.events.stores.specific.string;\n+\n+import java.util.Iterator;\n+\n+import javax.annotation.Nonnull;\n+\n+import com.bakdata.conquery.io.cps.CPSType;\n+import com.bakdata.conquery.io.xodus.NamespacedStorage;\n+import com.bakdata.conquery.models.dictionary.Dictionary;\n+import com.bakdata.conquery.models.events.stores.ColumnStore;\n+import com.bakdata.conquery.models.identifiable.ids.specific.DictionaryId;\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import lombok.Getter;\n+import lombok.NonNull;\n+import lombok.Setter;\n+import lombok.ToString;\n+\n+@Getter\n+@Setter\n+@CPSType(base = ColumnStore.class, id = \"STRING_PREFIX\")\n+@ToString(of = {\"prefix\", \"suffix\", \"subType\"})\n+public class StringTypePrefixSuffix extends StringType {\n+\n+\t@Nonnull\n+\tprotected StringType subType;\n+\n+\t@NonNull\n+\tprivate String prefix;\n+\n+\t@NonNull\n+\tprivate String suffix;\n+\n+\t@JsonCreator\n+\tpublic StringTypePrefixSuffix(StringType subType, String prefix, String suffix) {\n+\t\tsuper();\n+\t\tthis.subType = subType;\n+\t\tthis.prefix = prefix;\n+\t\tthis.suffix = suffix;\n+\t}\n+\n+\t@Override\n+\tpublic String getElement(int value) {\n+\t\treturn prefix + subType.getElement(value) + suffix;\n+\t}\n+\n+\t@Override\n+\tpublic String createScriptValue(Integer value) {\n+\t\treturn prefix + subType.createScriptValue(value);\n+\t}\n+\n+\t@Override\n+\tpublic int getId(String value) {\n+\t\tif (value.startsWith(prefix)) {\n+\t\t\treturn subType.getId(value.substring(prefix.length()));\n+\t\t}\n+\t\treturn -1;\n+\t}\n+\n+\t@Override\n+\tpublic void setIndexStore(ColumnStore<Long> indexStore) {\n+\t\tsubType.setIndexStore(indexStore);\n+\t}\n+\n+\t@Override\n+\tpublic Iterator<String> iterator() {\n+\t\tIterator<String> subIt = subType.iterator();\n+\t\treturn new Iterator<String>() {\n+\t\t\t@Override\n+\t\t\tpublic boolean hasNext() {\n+\t\t\t\treturn subIt.hasNext();\n+\t\t\t}\n+\n+\t\t\t@Override\n+\t\t\tpublic String next() {\n+\t\t\t\treturn prefix + subIt.next();\n+\t\t\t}\n+\t\t};\n+\t}\n+\n+\n+\t@Override\n+\tpublic StringTypePrefixSuffix select(int[] starts, int[] length) {\n+\t\treturn new StringTypePrefixSuffix(subType.select(starts, length), getPrefix(), getSuffix());\n+\t}\n+\n+\t@Override\n+\tpublic void loadDictionaries(NamespacedStorage storage) {\n+\t\tsubType.loadDictionaries(storage);\n+\t}\n+\n+\t@Override\n+\tpublic int size() {\n+\t\treturn subType.size();\n+\t}\n+\n+\t@Override\n+\tpublic long estimateEventBits() {\n+\t\treturn subType.estimateEventBits();\n+\t}\n+\n+\t@Override\n+\tpublic long estimateMemoryConsumption() {\n+\t\treturn subType.estimateMemoryConsumption();", "originalCommit": "a6854c15bd3c37a57b5e915350def055cabd6c28", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODI0NzgwNQ==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r558247805", "bodyText": "Das ist von einem anderen Feature oder?", "author": "thoniTUB", "createdAt": "2021-01-15T11:31:09Z", "path": "backend/src/main/java/com/bakdata/conquery/models/jobs/CalculateCBlocksJob.java", "diffHunk": "@@ -99,18 +104,29 @@ private void calculateEntityDateIndices(CBlock cBlock, Bucket bucket) {\n \n \t\t\t\tCDateRange range = bucket.getAsDateRange(entry.getEvent(), column);\n \n-\t\t\t\tcBlock.getMinDate()[entry.getLocalEntity()] = Math.min(cBlock.getMinDate()[entry.getLocalEntity()], range.getMinValue());\n+\t\t\t\tif (range.hasLowerBound()) {\n+\t\t\t\t\tint min = Math.min(\n+\t\t\t\t\t\t\tcBlock.getMinDate().getOrDefault(entry.getEntity(), Integer.MAX_VALUE),\n+\t\t\t\t\t\t\trange.getMinValue()\n+\t\t\t\t\t);\n+\n+\t\t\t\t\tcBlock.getMinDate()\n+\t\t\t\t\t\t  .put(entry.getEntity(), min);\n+\t\t\t\t}\n+\n+\t\t\t\tif (range.hasUpperBound()) {\n+\t\t\t\t\tint max = Math.max(\n+\t\t\t\t\t\t\tcBlock.getMaxDate().getOrDefault(entry.getEntity(), Integer.MIN_VALUE),\n+\t\t\t\t\t\t\trange.getMaxValue()\n+\t\t\t\t\t);\n \n-\t\t\t\tcBlock.getMaxDate()[entry.getLocalEntity()] = Math.max(cBlock.getMaxDate()[entry.getLocalEntity()], range.getMaxValue());\n+\t\t\t\t\tcBlock.getMaxDate()\n+\t\t\t\t\t\t  .put(entry.getEntity(), max);\n+\t\t\t\t}", "originalCommit": "a6854c15bd3c37a57b5e915350def055cabd6c28", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODI2OTExMQ==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r558269111", "bodyText": "ne das ist der gleiche code wie davor, aber ohne dieses localEntity gehudel", "author": "awildturtok", "createdAt": "2021-01-15T12:16:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODI0NzgwNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODI1MzE0Mg==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r558253142", "bodyText": "\ud83d\udc4d", "author": "thoniTUB", "createdAt": "2021-01-15T11:42:20Z", "path": "backend/src/main/java/com/bakdata/conquery/models/query/queryplan/specific/DateRestrictingNode.java", "diffHunk": "@@ -56,26 +56,24 @@ public void nextTable(QueryExecutionContext ctx, TableId currentTable) {\n \tpublic boolean isOfInterest(Bucket bucket) {\n \t\tCBlock cBlock = Objects.requireNonNull(preCurrentRow.get(bucket.getId()));\n \n-\t\tif(validityDateColumn == null) {\n+\t\tif (validityDateColumn == null) {\n \t\t\t// If there is no validity date set for a concept there is nothing to restrict\n \t\t\treturn true;\n \t\t}\n \n-\t\tint localId = bucket.toLocal(entity.getId());\n+\t\tint entityId = entity.getId();", "originalCommit": "a6854c15bd3c37a57b5e915350def055cabd6c28", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODI1NDgyOA==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r558254828", "bodyText": "Ich wusste nicht, dass es hierf\u00fcr templates gibt", "author": "thoniTUB", "createdAt": "2021-01-15T11:46:00Z", "path": "backend/src/main/java/com/bakdata/conquery/resources/admin/ui/DatasetsUIResource.java", "diffHunk": "@@ -100,6 +102,16 @@ public View getDataset() {\n \t\t);\n \t}\n \n+\t@GET\n+\t@Path(\"mapping\")\n+\tpublic View getIdMapping() {\n+\t\tPersistentIdMap mapping = namespace.getStorage().getIdMapping();\n+\t\tif (mapping != null && mapping.getCsvIdToExternalIdMap() != null) {\n+\t\t\treturn new UIView<>(\"idmapping.html.ftl\", processor.getUIContext(), mapping.getCsvIdToExternalIdMap());\n+\t\t}\n+\t\treturn new UIView<>(\"add_idmapping.html.ftl\", processor.getUIContext(), namespace.getDataset().getId());", "originalCommit": "a6854c15bd3c37a57b5e915350def055cabd6c28", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODI1Njc2Mw==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r558256763", "bodyText": "Den wollen wir einfach nicht mehr?", "author": "thoniTUB", "createdAt": "2021-01-15T11:50:00Z", "path": "backend/src/test/java/com/bakdata/conquery/models/events/generation/GenerationTests.java", "diffHunk": "@@ -1,290 +0,0 @@\n-package com.bakdata.conquery.models.events.generation;\n-\n-import static org.assertj.core.api.Assertions.assertThat;\n-import static org.assertj.core.api.Assertions.assertThatCode;\n-\n-import java.io.IOException;\n-import java.lang.reflect.InvocationTargetException;\n-import java.math.BigDecimal;\n-import java.time.LocalDate;\n-import java.util.ArrayList;\n-import java.util.Arrays;\n-import java.util.List;\n-import java.util.Random;\n-import java.util.concurrent.ExecutorService;\n-import java.util.concurrent.Executors;\n-import java.util.concurrent.Future;\n-import java.util.concurrent.TimeUnit;\n-import java.util.stream.Collectors;\n-import java.util.stream.IntStream;\n-import java.util.stream.Stream;\n-\n-import com.bakdata.conquery.io.jackson.serializer.SerializationTestUtil;\n-import com.bakdata.conquery.models.common.CDate;\n-import com.bakdata.conquery.models.config.ConqueryConfig;\n-import com.bakdata.conquery.models.config.ParserConfig;\n-import com.bakdata.conquery.models.datasets.Column;\n-import com.bakdata.conquery.models.datasets.Import;\n-import com.bakdata.conquery.models.datasets.ImportColumn;\n-import com.bakdata.conquery.models.events.Bucket;\n-import com.bakdata.conquery.models.exceptions.JSONException;\n-import com.bakdata.conquery.models.identifiable.CentralRegistry;\n-import com.bakdata.conquery.models.identifiable.ids.specific.DatasetId;\n-import com.bakdata.conquery.models.identifiable.ids.specific.TableId;\n-import com.bakdata.conquery.models.types.MajorTypeId;\n-import com.bakdata.conquery.models.types.parser.Decision;\n-import com.bakdata.conquery.models.types.parser.Parser;\n-import com.bakdata.conquery.models.types.parser.specific.string.StringParser;\n-import com.bakdata.conquery.models.types.specific.AStringType;\n-import lombok.extern.slf4j.Slf4j;\n-import org.apache.commons.io.output.NullOutputStream;\n-import org.assertj.core.data.Offset;\n-import org.junit.jupiter.params.ParameterizedTest;\n-import org.junit.jupiter.params.provider.Arguments;\n-import org.junit.jupiter.params.provider.MethodSource;\n-\n-\n-@Slf4j\n-public class GenerationTests {", "originalCommit": "a6854c15bd3c37a57b5e915350def055cabd6c28", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODI2OTM4MA==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r558269380", "bodyText": "Der hat die Code Generierung getestet", "author": "awildturtok", "createdAt": "2021-01-15T12:17:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODI1Njc2Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODI2OTQ0Mg==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r558269442", "bodyText": "Die es jetzt nicht mehr gibt", "author": "awildturtok", "createdAt": "2021-01-15T12:17:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODI1Njc2Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODM0NTAwMA==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r558345000", "bodyText": "Stimmt \ud83d\ude48", "author": "thoniTUB", "createdAt": "2021-01-15T14:33:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODI1Njc2Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODI1NzM2MQ==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r558257361", "bodyText": "\ud83e\udd14", "author": "thoniTUB", "createdAt": "2021-01-15T11:51:16Z", "path": "backend/src/test/java/com/bakdata/conquery/models/events/parser/specific/DecimalParserTest.java", "diffHunk": "@@ -0,0 +1,14 @@\n+package com.bakdata.conquery.models.events.parser.specific;\n+\n+import com.bakdata.conquery.models.config.ParserConfig;\n+import org.junit.jupiter.api.Test;\n+\n+class DecimalParserTest {\n+\n+\t@Test\n+\tpublic void test(){\n+\t\tfinal DecimalParser parser = new DecimalParser(new ParserConfig());\n+\n+\t}", "originalCommit": "a6854c15bd3c37a57b5e915350def055cabd6c28", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODI2OTQ5Nw==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r558269497", "bodyText": "oh", "author": "awildturtok", "createdAt": "2021-01-15T12:17:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODI1NzM2MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODI1OTA2OQ==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r558259069", "bodyText": "Was genau wird hier getestet?", "author": "thoniTUB", "createdAt": "2021-01-15T11:55:10Z", "path": "backend/src/test/java/com/bakdata/conquery/models/events/stores/types/MajorTypesTest.java", "diffHunk": "@@ -0,0 +1,19 @@\n+package com.bakdata.conquery.models.events.stores.types;\n+\n+import com.bakdata.conquery.models.config.ParserConfig;\n+import com.bakdata.conquery.models.events.parser.MajorTypeId;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.MethodSource;\n+\n+public class MajorTypesTest {", "originalCommit": "a6854c15bd3c37a57b5e915350def055cabd6c28", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODI3MDMwMg==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r558270302", "bodyText": "Ah, guter Punkt das war ein alter Test der garantiert, dass es f\u00fcr jeden MajorType funktioniert. Mache Doku dazu", "author": "awildturtok", "createdAt": "2021-01-15T12:18:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODI1OTA2OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODI2MDM0Ng==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r558260346", "bodyText": "Ist dfas mit dem randomUUID so wichtig? kann man nicht einfach eine neue UUID erzeugen?", "author": "thoniTUB", "createdAt": "2021-01-15T11:57:39Z", "path": "backend/src/test/java/com/bakdata/conquery/models/events/stores/types/StringEncodingTest.java", "diffHunk": "@@ -37,35 +30,43 @@ private UUID randomUUID(Random random) {\n \t\tStringTypeEncoded.Encoding encoding = StringTypeEncoded.Encoding.Base64;\n \n \t\treturn Stream.generate(() -> randomUUID(random).toString().replace(\"-\", \"\"))", "originalCommit": "a6854c15bd3c37a57b5e915350def055cabd6c28", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "42af1cd25dae99437c39363dfb5065c27657d9c9", "url": "https://github.com/bakdata/conquery/commit/42af1cd25dae99437c39363dfb5065c27657d9c9", "message": "Undo ModificationShieldedWorkerStorage implementing WorkerStorage", "committedDate": "2021-01-15T14:36:35Z", "type": "commit"}, {"oid": "3bb7fcbd3ea2cc4627a297276d9034188d5ab321", "url": "https://github.com/bakdata/conquery/commit/3bb7fcbd3ea2cc4627a297276d9034188d5ab321", "message": "Review feedback", "committedDate": "2021-01-15T14:36:35Z", "type": "commit"}, {"oid": "dd3741b1eb4dc92268072bf325f2dd84da13ee32", "url": "https://github.com/bakdata/conquery/commit/dd3741b1eb4dc92268072bf325f2dd84da13ee32", "message": "code style issues", "committedDate": "2021-01-15T14:55:15Z", "type": "commit"}, {"oid": "d9dc9b5ff30cbe86760f95b8e56b3dc5c48c1ea3", "url": "https://github.com/bakdata/conquery/commit/d9dc9b5ff30cbe86760f95b8e56b3dc5c48c1ea3", "message": "Add config properly to Parsers", "committedDate": "2021-01-15T15:02:24Z", "type": "commit"}, {"oid": "c3c8004b7fb64bf47610a23d399f0b05ac3f7127", "url": "https://github.com/bakdata/conquery/commit/c3c8004b7fb64bf47610a23d399f0b05ac3f7127", "message": "Estimate size better", "committedDate": "2021-01-15T15:18:24Z", "type": "commit"}, {"oid": "976b6acd4bb70c1f38fff8dad04a833eaa33c4a3", "url": "https://github.com/bakdata/conquery/commit/976b6acd4bb70c1f38fff8dad04a833eaa33c4a3", "message": "Cleanup", "committedDate": "2021-01-15T15:40:05Z", "type": "commit"}, {"oid": "df0f14f691e4b9b1ca21ec8073f46db4dc41f4a6", "url": "https://github.com/bakdata/conquery/commit/df0f14f691e4b9b1ca21ec8073f46db4dc41f4a6", "message": "add person back", "committedDate": "2021-01-15T15:44:22Z", "type": "commit"}, {"oid": "b346250f6d6480acfd6ce26d1f8241123efa9ae6", "url": "https://github.com/bakdata/conquery/commit/b346250f6d6480acfd6ce26d1f8241123efa9ae6", "message": "add test for DecimalParser", "committedDate": "2021-01-15T16:36:58Z", "type": "commit"}, {"oid": "2e453c9fc5d3c516ea29432ff8485ba1e3273a70", "url": "https://github.com/bakdata/conquery/commit/2e453c9fc5d3c516ea29432ff8485ba1e3273a70", "message": "add is empty check for stores", "committedDate": "2021-01-18T14:26:01Z", "type": "commit"}, {"oid": "c306a2aa196e36b98b298b2e5a240d46f1dafdfd", "url": "https://github.com/bakdata/conquery/commit/c306a2aa196e36b98b298b2e5a240d46f1dafdfd", "message": "remove unused nullLines", "committedDate": "2021-01-18T15:06:22Z", "type": "commit"}, {"oid": "01accd8c121fb4e24ca87b7a97603977ff429d88", "url": "https://github.com/bakdata/conquery/commit/01accd8c121fb4e24ca87b7a97603977ff429d88", "message": "add JsonIgnore anno", "committedDate": "2021-01-18T15:35:36Z", "type": "commit"}, {"oid": "dc0d795da1ba86552e6169a61d36859500ae427e", "url": "https://github.com/bakdata/conquery/commit/dc0d795da1ba86552e6169a61d36859500ae427e", "message": "add check for null value", "committedDate": "2021-01-18T15:44:25Z", "type": "commit"}, {"oid": "5419a5474404b8768aa206ee25c90fa71926eaca", "url": "https://github.com/bakdata/conquery/commit/5419a5474404b8768aa206ee25c90fa71926eaca", "message": "more documentation", "committedDate": "2021-01-18T15:54:26Z", "type": "commit"}, {"oid": "151ab6ba45e9662612c0cadd131613f565b198c3", "url": "https://github.com/bakdata/conquery/commit/151ab6ba45e9662612c0cadd131613f565b198c3", "message": "Documentation for Stores", "committedDate": "2021-01-18T16:09:03Z", "type": "commit"}, {"oid": "22803c5773a3e4db3f1beab9af8ef970838158f4", "url": "https://github.com/bakdata/conquery/commit/22803c5773a3e4db3f1beab9af8ef970838158f4", "message": "remove unused importId from Bucket", "committedDate": "2021-01-18T16:15:14Z", "type": "commit"}, {"oid": "0fd8ac518596ec7cfa8866416598963ec4b5c051", "url": "https://github.com/bakdata/conquery/commit/0fd8ac518596ec7cfa8866416598963ec4b5c051", "message": "add documentation", "committedDate": "2021-01-18T16:47:50Z", "type": "commit"}, {"oid": "9a81749c1f3251bb3483d446a3c3d2da566b00e4", "url": "https://github.com/bakdata/conquery/commit/9a81749c1f3251bb3483d446a3c3d2da566b00e4", "message": "remove usage of TypeDescription in QueryEngine as that was a bug.", "committedDate": "2021-01-19T12:03:26Z", "type": "forcePushed"}, {"oid": "d9fb0b577713ae11017a9b8772945f71f8a2d66e", "url": "https://github.com/bakdata/conquery/commit/d9fb0b577713ae11017a9b8772945f71f8a2d66e", "message": "don't use typeDescription in QueryEngine", "committedDate": "2021-01-20T10:46:08Z", "type": "commit"}, {"oid": "d9fb0b577713ae11017a9b8772945f71f8a2d66e", "url": "https://github.com/bakdata/conquery/commit/d9fb0b577713ae11017a9b8772945f71f8a2d66e", "message": "don't use typeDescription in QueryEngine", "committedDate": "2021-01-20T10:46:08Z", "type": "forcePushed"}, {"oid": "befaff168f637373854aa71d86410bf4bf194d7f", "url": "https://github.com/bakdata/conquery/commit/befaff168f637373854aa71d86410bf4bf194d7f", "message": "Lazy Import Bucket", "committedDate": "2021-01-21T09:59:48Z", "type": "commit"}, {"oid": "c85b219e77c30ffb3df1dfb3df2d13664c62a0f7", "url": "https://github.com/bakdata/conquery/commit/c85b219e77c30ffb3df1dfb3df2d13664c62a0f7", "message": "first draft of ColumnStores", "committedDate": "2020-09-03T12:31:59Z", "type": "commit"}, {"oid": "bf1f1e2110a431bff24bf2a664a5a19141622b57", "url": "https://github.com/bakdata/conquery/commit/bf1f1e2110a431bff24bf2a664a5a19141622b57", "message": "Expand ColumnStore and apply usage for CTypes", "committedDate": "2020-09-03T14:35:07Z", "type": "commit"}, {"oid": "d81a101acbe064f11e0f87bbe97d0174c1a6afa2", "url": "https://github.com/bakdata/conquery/commit/d81a101acbe064f11e0f87bbe97d0174c1a6afa2", "message": "small fix", "committedDate": "2020-09-03T14:43:46Z", "type": "commit"}, {"oid": "33b030dc4fab683ddfc296a973e18d13c3172e10", "url": "https://github.com/bakdata/conquery/commit/33b030dc4fab683ddfc296a973e18d13c3172e10", "message": "add more stores for smaller units", "committedDate": "2020-09-04T09:52:52Z", "type": "commit"}, {"oid": "db10ea84c160094629b860c02323bcba595801a4", "url": "https://github.com/bakdata/conquery/commit/db10ea84c160094629b860c02323bcba595801a4", "message": "Add CPSType to ColumnStores", "committedDate": "2020-10-02T07:54:16Z", "type": "commit"}, {"oid": "06c2d19ae011d161f01a5702462d2b18c29cc1d0", "url": "https://github.com/bakdata/conquery/commit/06c2d19ae011d161f01a5702462d2b18c29cc1d0", "message": "Some exploratory work towards serializing Imports (this is really just for testing!)", "committedDate": "2020-10-02T07:55:45Z", "type": "commit"}, {"oid": "20384bfa6aee77104d076306ab4e04db571e427d", "url": "https://github.com/bakdata/conquery/commit/20384bfa6aee77104d076306ab4e04db571e427d", "message": "remove ImportColumn from ColumnStore", "committedDate": "2020-10-05T10:17:34Z", "type": "commit"}, {"oid": "a894c59765f18cbc7f77cf26804c7f3d9010cbde", "url": "https://github.com/bakdata/conquery/commit/a894c59765f18cbc7f77cf26804c7f3d9010cbde", "message": "some more column stores", "committedDate": "2020-10-05T10:20:19Z", "type": "commit"}, {"oid": "b82e2971a501c203881812f5e9dddd6a1dd1bbef", "url": "https://github.com/bakdata/conquery/commit/b82e2971a501c203881812f5e9dddd6a1dd1bbef", "message": "wip towards Column Ordered Preprocessed files", "committedDate": "2020-10-08T14:24:59Z", "type": "commit"}, {"oid": "7357aa488e64b1f885efe6667f47613c50dce4ba", "url": "https://github.com/bakdata/conquery/commit/7357aa488e64b1f885efe6667f47613c50dce4ba", "message": "Directly store ColumnStore in Preprocessed", "committedDate": "2020-10-12T14:47:59Z", "type": "commit"}, {"oid": "597fa45d0657d6d67b3c85889bc414820b7fba9c", "url": "https://github.com/bakdata/conquery/commit/597fa45d0657d6d67b3c85889bc414820b7fba9c", "message": "ColumnStore#select to split stores and application in ImportJob", "committedDate": "2020-10-13T09:58:55Z", "type": "commit"}, {"oid": "f2d81f48a6ea34c994d571bb33015143b6a61431", "url": "https://github.com/bakdata/conquery/commit/f2d81f48a6ea34c994d571bb33015143b6a61431", "message": "PackedDateRangeStore implementation", "committedDate": "2020-10-13T09:59:33Z", "type": "commit"}, {"oid": "549e206e21593092792e7d374d5a2da9ca58780a", "url": "https://github.com/bakdata/conquery/commit/549e206e21593092792e7d374d5a2da9ca58780a", "message": "wip", "committedDate": "2020-10-13T12:26:34Z", "type": "commit"}, {"oid": "4877da1e0c121ac114e96bd5dd07b4d20a2c230e", "url": "https://github.com/bakdata/conquery/commit/4877da1e0c121ac114e96bd5dd07b4d20a2c230e", "message": "wip", "committedDate": "2020-10-13T14:09:42Z", "type": "commit"}, {"oid": "56eb6f318afb2b219a33953c8a13bd969d0d3ab5", "url": "https://github.com/bakdata/conquery/commit/56eb6f318afb2b219a33953c8a13bd969d0d3ab5", "message": "wip", "committedDate": "2020-10-14T07:57:48Z", "type": "commit"}, {"oid": "48736896309a8dba0346982334109ed58cd73fd5", "url": "https://github.com/bakdata/conquery/commit/48736896309a8dba0346982334109ed58cd73fd5", "message": "wip, testing why StringStore dont work", "committedDate": "2020-10-21T07:25:34Z", "type": "commit"}, {"oid": "3e83d999308d1c71db733cfc2e5ca90537f1ca65", "url": "https://github.com/bakdata/conquery/commit/3e83d999308d1c71db733cfc2e5ca90537f1ca65", "message": "remove unused methods cleanup structure", "committedDate": "2020-10-21T11:07:35Z", "type": "commit"}, {"oid": "8431bab5a668c9b94c960cccbd7eec3964367e32", "url": "https://github.com/bakdata/conquery/commit/8431bab5a668c9b94c960cccbd7eec3964367e32", "message": "fix connector condition test", "committedDate": "2020-10-21T11:13:19Z", "type": "commit"}, {"oid": "4d07b5a047ea1dc56a6a240b7b1d1ff70df91642", "url": "https://github.com/bakdata/conquery/commit/4d07b5a047ea1dc56a6a240b7b1d1ff70df91642", "message": "massive cleanup of MULTIPLE_TABLES_ICD_KH_AU_QUERY test", "committedDate": "2020-10-21T12:42:37Z", "type": "commit"}, {"oid": "1c162621c8ac1be3634462698a826f13033e69f9", "url": "https://github.com/bakdata/conquery/commit/1c162621c8ac1be3634462698a826f13033e69f9", "message": "rework Bucket to be length based instead of start/end", "committedDate": "2020-10-21T15:11:07Z", "type": "commit"}, {"oid": "c23768442697c3ac9d8e380d773c9450ae5425fa", "url": "https://github.com/bakdata/conquery/commit/c23768442697c3ac9d8e380d773c9450ae5425fa", "message": "this now works!!!!", "committedDate": "2020-10-21T16:18:01Z", "type": "commit"}, {"oid": "97bb711622ca0df30766d363a9d07cb496a56a11", "url": "https://github.com/bakdata/conquery/commit/97bb711622ca0df30766d363a9d07cb496a56a11", "message": "cleanup Bucket class", "committedDate": "2020-10-22T09:34:52Z", "type": "commit"}, {"oid": "1187dce54af7e1aec3578f19282f97e9ec9639f1", "url": "https://github.com/bakdata/conquery/commit/1187dce54af7e1aec3578f19282f97e9ec9639f1", "message": "refactor buckets and entities, send bucket immediately instead of all at once", "committedDate": "2020-10-22T09:55:36Z", "type": "commit"}, {"oid": "44fe7838e30813dfd974fce57cc0ac535e49b968", "url": "https://github.com/bakdata/conquery/commit/44fe7838e30813dfd974fce57cc0ac535e49b968", "message": "cleanup of Input reading", "committedDate": "2020-10-22T10:36:10Z", "type": "commit"}, {"oid": "72ce311603aeb49b691e00ea255ee8db3e45450b", "url": "https://github.com/bakdata/conquery/commit/72ce311603aeb49b691e00ea255ee8db3e45450b", "message": "reset ImportJob to work again.", "committedDate": "2020-10-22T12:55:55Z", "type": "commit"}, {"oid": "53a533b132b0c3f7a0486d51e6f416e217432d5d", "url": "https://github.com/bakdata/conquery/commit/53a533b132b0c3f7a0486d51e6f416e217432d5d", "message": "reset ImportJob to work again.", "committedDate": "2020-10-22T13:00:51Z", "type": "commit"}, {"oid": "d1b427206e37fdb218f117b8257c5367f0adcffb", "url": "https://github.com/bakdata/conquery/commit/d1b427206e37fdb218f117b8257c5367f0adcffb", "message": "Merge remote-tracking branch 'origin/develop' into feature/bye-bye-bucket-templates\n\n# Conflicts:\n#\tbackend/src/main/java/com/bakdata/conquery/io/jackson/serializer/BucketDeserializer.java\n#\tbackend/src/main/java/com/bakdata/conquery/io/jackson/serializer/NsIdReferenceDeserializer.java\n#\tbackend/src/main/java/com/bakdata/conquery/models/datasets/ImportColumn.java\n#\tbackend/src/main/java/com/bakdata/conquery/models/dictionary/DictionaryMapping.java\n#\tbackend/src/main/java/com/bakdata/conquery/models/dictionary/DirectDictionary.java\n#\tbackend/src/main/java/com/bakdata/conquery/models/events/Bucket.java\n#\tbackend/src/main/java/com/bakdata/conquery/models/events/BucketManager.java\n#\tbackend/src/main/java/com/bakdata/conquery/models/events/CBlock.java\n#\tbackend/src/main/java/com/bakdata/conquery/models/jobs/CalculateCBlocksJob.java\n#\tbackend/src/main/java/com/bakdata/conquery/models/jobs/ImportJob.java\n#\tbackend/src/main/java/com/bakdata/conquery/models/messages/namespaces/specific/ImportBucket.java\n#\tbackend/src/main/java/com/bakdata/conquery/models/preproc/Preprocessed.java\n#\tbackend/src/main/java/com/bakdata/conquery/models/query/queryplan/ConceptQueryPlan.java\n#\tbackend/src/main/java/com/bakdata/conquery/models/query/queryplan/SecondaryIdQueryPlan.java\n#\tbackend/src/main/java/com/bakdata/conquery/models/query/queryplan/aggregators/specific/value/FirstValueAggregator.java\n#\tbackend/src/main/java/com/bakdata/conquery/models/query/queryplan/aggregators/specific/value/LastValueAggregator.java\n#\tbackend/src/main/java/com/bakdata/conquery/models/query/queryplan/specific/ConceptNode.java\n#\tbackend/src/main/java/com/bakdata/conquery/models/query/queryplan/specific/DateRestrictingNode.java\n#\tbackend/src/main/java/com/bakdata/conquery/models/types/CType.java\n#\tbackend/src/main/java/com/bakdata/conquery/models/types/parser/Transformer.java\n#\tbackend/src/main/java/com/bakdata/conquery/models/types/specific/RealTypeDouble.java\n#\tbackend/src/main/java/com/bakdata/conquery/models/types/specific/StringTypeDictionary.java\n#\tbackend/src/main/java/com/bakdata/conquery/models/types/specific/StringTypeSingleton.java\n#\tbackend/src/main/java/com/bakdata/conquery/resources/admin/rest/AdminProcessor.java\n#\tbackend/src/test/java/com/bakdata/conquery/models/events/generation/GenerationTests.java\n#\tbackend/src/test/java/com/bakdata/conquery/models/types/SerializationTest.java\n#\tbackend/src/test/java/com/bakdata/conquery/models/types/StringEncodingTest.java\n#\tbackend/src/test/resources/tests/query/SIMPLE_TREECONCEPT_CONNECTOR_CONDITION_QUERY/SIMPLE_TREECONCEPT_Query.test.json\n#\tbackend/src/test/resources/tests/query/SIMPLE_TREECONCEPT_CONNECTOR_CONDITION_QUERY/content.csv", "committedDate": "2020-10-22T14:32:31Z", "type": "commit"}, {"oid": "505081cd6d5d527f490257dffe8c75b05ae367dc", "url": "https://github.com/bakdata/conquery/commit/505081cd6d5d527f490257dffe8c75b05ae367dc", "message": "migrate CTypo to be ColumnStore and Transformer as the hoops we are jumping through to marry them is insane", "committedDate": "2020-10-23T12:42:59Z", "type": "commit"}, {"oid": "e00b17a529045f683dfd798c6babb9f8d7f74e92", "url": "https://github.com/bakdata/conquery/commit/e00b17a529045f683dfd798c6babb9f8d7f74e92", "message": "this compiles now", "committedDate": "2020-10-23T13:41:01Z", "type": "commit"}, {"oid": "eb3bd6f187c0561af613544394ebadcad24243c5", "url": "https://github.com/bakdata/conquery/commit/eb3bd6f187c0561af613544394ebadcad24243c5", "message": "cleanup store layout", "committedDate": "2020-10-23T14:28:03Z", "type": "commit"}, {"oid": "7c159e60b2f2533d9f0720afadd681f4e4982b30", "url": "https://github.com/bakdata/conquery/commit/7c159e60b2f2533d9f0720afadd681f4e4982b30", "message": "DateTypeVarInt is now working again", "committedDate": "2020-10-23T14:29:44Z", "type": "commit"}, {"oid": "944ab1f5dc2371067876ece5f080642b385cc27c", "url": "https://github.com/bakdata/conquery/commit/944ab1f5dc2371067876ece5f080642b385cc27c", "message": "Fix not being able to Deserialze RealTypeDouble and fix CBlock default min/max", "committedDate": "2020-10-23T15:18:22Z", "type": "commit"}, {"oid": "636ad3f3291dccf6c304b769d1f7f1949a79ec1a", "url": "https://github.com/bakdata/conquery/commit/636ad3f3291dccf6c304b769d1f7f1949a79ec1a", "message": "fix broken connector condition test", "committedDate": "2020-10-23T15:30:10Z", "type": "commit"}, {"oid": "ca9f8026feb0a16a20180d6b017128bbf5b34193", "url": "https://github.com/bakdata/conquery/commit/ca9f8026feb0a16a20180d6b017128bbf5b34193", "message": "fix StringTypeSingleton not properly implementing has", "committedDate": "2020-10-23T16:10:54Z", "type": "commit"}, {"oid": "314f81bfe2405bb7f47e4353083c6adc96855d22", "url": "https://github.com/bakdata/conquery/commit/314f81bfe2405bb7f47e4353083c6adc96855d22", "message": "simplify test", "committedDate": "2020-10-23T16:34:31Z", "type": "commit"}, {"oid": "f03ce06226e098955be159777a92e5cf361ce405", "url": "https://github.com/bakdata/conquery/commit/f03ce06226e098955be159777a92e5cf361ce405", "message": "fix not-deparsing values in StringTypeNumber", "committedDate": "2020-11-10T13:57:35Z", "type": "commit"}, {"oid": "98edca5586c18e34acd64c1e18ead177f37c679c", "url": "https://github.com/bakdata/conquery/commit/98edca5586c18e34acd64c1e18ead177f37c679c", "message": "cleanup ctor", "committedDate": "2020-11-10T13:59:29Z", "type": "commit"}, {"oid": "d21aaf2b11329c5895dcf1e2bce9286f5c39e4d0", "url": "https://github.com/bakdata/conquery/commit/d21aaf2b11329c5895dcf1e2bce9286f5c39e4d0", "message": "cleanup redundant Decision usage", "committedDate": "2020-11-10T14:07:36Z", "type": "commit"}, {"oid": "5b2256f062a6d7cdc23fccaf88e70a05f6d99be4", "url": "https://github.com/bakdata/conquery/commit/5b2256f062a6d7cdc23fccaf88e70a05f6d99be4", "message": "- fix IsPresentCondition test\n- cleanup code around IsPresentCondition", "committedDate": "2020-11-10T14:32:45Z", "type": "commit"}, {"oid": "d58e77ebbb31e073488785fa61143541779f393a", "url": "https://github.com/bakdata/conquery/commit/d58e77ebbb31e073488785fa61143541779f393a", "message": "implement DecimalTypeScaled", "committedDate": "2020-11-10T14:50:49Z", "type": "commit"}, {"oid": "3421b66c689d3245a68e5c3986f8ef69253e3a8a", "url": "https://github.com/bakdata/conquery/commit/3421b66c689d3245a68e5c3986f8ef69253e3a8a", "message": "Create only description of CType for PPHeader", "committedDate": "2020-11-10T17:17:55Z", "type": "commit"}, {"oid": "bf8340d4a3de1396734f0afff3f8e783838dfc67", "url": "https://github.com/bakdata/conquery/commit/bf8340d4a3de1396734f0afff3f8e783838dfc67", "message": "Add missing JsonCreator to DateRangeTypeQuarter", "committedDate": "2020-11-10T17:18:15Z", "type": "commit"}, {"oid": "1fb280bd7836e5e7251283d4cffdd8a2402f1ae0", "url": "https://github.com/bakdata/conquery/commit/1fb280bd7836e5e7251283d4cffdd8a2402f1ae0", "message": "Initialize value columns also", "committedDate": "2020-11-11T08:32:50Z", "type": "commit"}, {"oid": "ed1e27049052f59312e7777ea07a54084659c5d3", "url": "https://github.com/bakdata/conquery/commit/ed1e27049052f59312e7777ea07a54084659c5d3", "message": "add todo", "committedDate": "2020-11-11T09:23:28Z", "type": "commit"}, {"oid": "8720ac3e36dead42976c0b5fe37c708295f32a48", "url": "https://github.com/bakdata/conquery/commit/8720ac3e36dead42976c0b5fe37c708295f32a48", "message": "add missing JsonCreator and Getter annos", "committedDate": "2020-11-11T13:53:05Z", "type": "commit"}, {"oid": "7abb94adf536e64e17f3f1127f78cdf3aee4e82e", "url": "https://github.com/bakdata/conquery/commit/7abb94adf536e64e17f3f1127f78cdf3aee4e82e", "message": "remove unused code", "committedDate": "2020-11-11T15:56:04Z", "type": "commit"}, {"oid": "36cb41307e531ddd79fd4df487bb078b30fdbce0", "url": "https://github.com/bakdata/conquery/commit/36cb41307e531ddd79fd4df487bb078b30fdbce0", "message": "add missing JsonCreator anno", "committedDate": "2020-11-11T15:58:50Z", "type": "commit"}, {"oid": "07058bfc2dbd967891382f36494231347e59d004", "url": "https://github.com/bakdata/conquery/commit/07058bfc2dbd967891382f36494231347e59d004", "message": "decouple name of Dictionary/StringTypeDictionary", "committedDate": "2020-11-13T09:53:38Z", "type": "commit"}, {"oid": "25fed10f5587df48573c6a0850ad80c905a96bda", "url": "https://github.com/bakdata/conquery/commit/25fed10f5587df48573c6a0850ad80c905a96bda", "message": "load dictionaries via explicit data structure", "committedDate": "2020-11-13T15:02:35Z", "type": "commit"}, {"oid": "8776a83175bc98f668c4b6ff5605152d214f0bea", "url": "https://github.com/bakdata/conquery/commit/8776a83175bc98f668c4b6ff5605152d214f0bea", "message": "simplify calculateMap", "committedDate": "2020-11-13T15:11:23Z", "type": "commit"}, {"oid": "03dc4cd27778176c6f24baf2ae89931bfa785eb3", "url": "https://github.com/bakdata/conquery/commit/03dc4cd27778176c6f24baf2ae89931bfa785eb3", "message": "Fix not updating the names of shared dictionaries", "committedDate": "2020-11-13T15:20:22Z", "type": "commit"}, {"oid": "c3d0b3e2040792b3e88769249f300ba592d92f5e", "url": "https://github.com/bakdata/conquery/commit/c3d0b3e2040792b3e88769249f300ba592d92f5e", "message": "add afterburner for perf gainzz", "committedDate": "2020-11-13T17:09:21Z", "type": "commit"}, {"oid": "179c679deeaaa1e1c0fac6462c58b6877f0cb801", "url": "https://github.com/bakdata/conquery/commit/179c679deeaaa1e1c0fac6462c58b6877f0cb801", "message": "some more todos", "committedDate": "2020-11-13T23:13:22Z", "type": "commit"}, {"oid": "9352ac4a3169aa5f68c5e1ef505e4a85484b1c5c", "url": "https://github.com/bakdata/conquery/commit/9352ac4a3169aa5f68c5e1ef505e4a85484b1c5c", "message": "use static reader/writer for DataContainer as they use caching which could speed up Preprocessing and ImportJob", "committedDate": "2020-11-16T10:27:02Z", "type": "commit"}, {"oid": "d0d8cd53ec056d984a913af79b5d1196754144d9", "url": "https://github.com/bakdata/conquery/commit/d0d8cd53ec056d984a913af79b5d1196754144d9", "message": "decouple mapping from dict setting, this allows us to reduce complexity in ImportJob code", "committedDate": "2020-11-16T12:14:18Z", "type": "commit"}, {"oid": "4a02a8b6f16ba42c830cdc2c3abdbf960f97c2f6", "url": "https://github.com/bakdata/conquery/commit/4a02a8b6f16ba42c830cdc2c3abdbf960f97c2f6", "message": "remove special case usedBuckets field", "committedDate": "2020-11-16T12:21:34Z", "type": "commit"}, {"oid": "9eba3a4a9975b562a9c42e76c3174b8b61159ee4", "url": "https://github.com/bakdata/conquery/commit/9eba3a4a9975b562a9c42e76c3174b8b61159ee4", "message": "remove weird Function to retrieve dictionary as proxy", "committedDate": "2020-11-16T12:38:32Z", "type": "commit"}, {"oid": "22e38a57d9512c64be06eb150795b7f6a19bf9c9", "url": "https://github.com/bakdata/conquery/commit/22e38a57d9512c64be06eb150795b7f6a19bf9c9", "message": "track and remove Dictionaries related to Import", "committedDate": "2020-11-16T13:01:12Z", "type": "commit"}, {"oid": "92938ee0ac059ce976b56e6f885231294b84dc8e", "url": "https://github.com/bakdata/conquery/commit/92938ee0ac059ce976b56e6f885231294b84dc8e", "message": "refactor code, make introduce parallelization into ImportJob", "committedDate": "2020-11-16T15:45:22Z", "type": "commit"}, {"oid": "45c2be0c46cf8cf195743bf40ed773a69c742ed6", "url": "https://github.com/bakdata/conquery/commit/45c2be0c46cf8cf195743bf40ed773a69c742ed6", "message": "undo parallel sectioning", "committedDate": "2020-11-16T16:01:52Z", "type": "commit"}, {"oid": "6db0195dcb5e8a2521d2989ab6801a431dff6bd6", "url": "https://github.com/bakdata/conquery/commit/6db0195dcb5e8a2521d2989ab6801a431dff6bd6", "message": "remove weird dupe", "committedDate": "2020-11-16T16:39:48Z", "type": "commit"}, {"oid": "759d39273e98708383579d85e18f55d75783c6f2", "url": "https://github.com/bakdata/conquery/commit/759d39273e98708383579d85e18f55d75783c6f2", "message": "Some logging to find where the Dictionaries go missing", "committedDate": "2020-11-17T11:00:25Z", "type": "commit"}, {"oid": "cc413497909fc687bbda5d33170742b3d1b2a9fe", "url": "https://github.com/bakdata/conquery/commit/cc413497909fc687bbda5d33170742b3d1b2a9fe", "message": "fix typo", "committedDate": "2020-11-17T11:06:59Z", "type": "commit"}, {"oid": "2a058502d8037b85737e19d2d522361ccf3cc866", "url": "https://github.com/bakdata/conquery/commit/2a058502d8037b85737e19d2d522361ccf3cc866", "message": "fix not setting name and dataset of dictionary", "committedDate": "2020-11-17T11:33:38Z", "type": "commit"}, {"oid": "af5029d8bf19b01114f7162b2df4f4eb346fa5f5", "url": "https://github.com/bakdata/conquery/commit/af5029d8bf19b01114f7162b2df4f4eb346fa5f5", "message": "add some more logging", "committedDate": "2020-11-17T11:34:44Z", "type": "commit"}, {"oid": "4d0177ab2bec20fa094f496ca77308e80440dcef", "url": "https://github.com/bakdata/conquery/commit/4d0177ab2bec20fa094f496ca77308e80440dcef", "message": "add missing Getter", "committedDate": "2020-11-17T15:17:54Z", "type": "commit"}, {"oid": "51e1ccc29ecf1f215beb439810ebd950057d9807", "url": "https://github.com/bakdata/conquery/commit/51e1ccc29ecf1f215beb439810ebd950057d9807", "message": "add missing check for shared dictionary", "committedDate": "2020-11-17T15:51:01Z", "type": "commit"}, {"oid": "fa629a37d883794c9faf3a7ee0c203db818d79a8", "url": "https://github.com/bakdata/conquery/commit/fa629a37d883794c9faf3a7ee0c203db818d79a8", "message": "cleanup unused classes from code generation", "committedDate": "2020-11-17T16:00:38Z", "type": "commit"}, {"oid": "42471070cedf89524838007ddc49ec382d20c909", "url": "https://github.com/bakdata/conquery/commit/42471070cedf89524838007ddc49ec382d20c909", "message": "fix logic", "committedDate": "2020-11-17T16:11:03Z", "type": "commit"}, {"oid": "fdf3b6dffe93f7eae60e7c2efcc4714fa90e2654", "url": "https://github.com/bakdata/conquery/commit/fdf3b6dffe93f7eae60e7c2efcc4714fa90e2654", "message": "fix logic for detecting of missing dicts", "committedDate": "2020-11-17T16:24:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTk1MzUwNw==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r525953507", "bodyText": "NotImplementedException -> UnsupportedOperationException", "author": "thoniTUB", "createdAt": "2020-11-18T09:54:27Z", "path": "backend/src/main/java/com/bakdata/conquery/io/xodus/ModificationShieldedWorkerStorage.java", "diffHunk": "@@ -36,14 +38,54 @@ public CentralRegistry getCentralRegistry() {\n \t\treturn delegate.getCentralRegistry();\n \t}\n \n+\t@Override\n+\tpublic void loadData() {\n+\t\tthrow new NotImplementedException();", "originalCommit": "fdf3b6dffe93f7eae60e7c2efcc4714fa90e2654", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTk1NTEwMw==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r525955103", "bodyText": "Dadurch machst du potentiell aus Compiletime-Fehlern Runtime-Fehler. K\u00f6nnen wir das umgehen?", "author": "thoniTUB", "createdAt": "2020-11-18T09:56:40Z", "path": "backend/src/main/java/com/bakdata/conquery/io/xodus/ModificationShieldedWorkerStorage.java", "diffHunk": "@@ -19,12 +20,13 @@\n import com.bakdata.conquery.models.identifiable.ids.specific.ImportId;\n import com.bakdata.conquery.models.worker.WorkerInformation;\n import lombok.RequiredArgsConstructor;\n+import org.apache.commons.lang3.NotImplementedException;\n \n /**\n- * Provides a view on the storage that does not allow modification of the storage (update, delete). \n+ * Provides a view on the storage that does not allow modification of the storage (update, delete).\n  */\n @RequiredArgsConstructor\n-public class ModificationShieldedWorkerStorage {\n+public class ModificationShieldedWorkerStorage implements WorkerStorage {", "originalCommit": "fdf3b6dffe93f7eae60e7c2efcc4714fa90e2654", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzcxNjc3OQ==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r527716779", "bodyText": "Finde es ehrlich gesagt auch fragw\u00fcrdig, dass in einer Message der Worker sich nicht bearbeiten darf", "author": "awildturtok", "createdAt": "2020-11-20T14:13:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTk1NTEwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODA1NjE0NQ==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r558056145", "bodyText": "Na doch das darf er schon \u00fcber Methoden die der Worker selber nach drau\u00dfen, gibt, aber seinen Storage sollte er nicht nach drau\u00dfen geben und zur Modifikation freigeben", "author": "thoniTUB", "createdAt": "2021-01-15T08:45:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTk1NTEwMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTk3MzE3NQ==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r525973175", "bodyText": "Hier sind noch ein paar leere Bodies. Vllt eine Exception werfen", "author": "thoniTUB", "createdAt": "2020-11-18T10:23:29Z", "path": "backend/src/main/java/com/bakdata/conquery/models/dictionary/DirectDictionary.java", "diffHunk": "@@ -3,19 +3,32 @@\n import java.nio.charset.StandardCharsets;\n import java.util.Iterator;\n \n-import com.bakdata.conquery.models.types.specific.AStringType;\n-import com.bakdata.conquery.models.types.specific.VarIntType;\n+import com.bakdata.conquery.models.identifiable.ids.specific.DictionaryId;\n+import com.bakdata.conquery.models.types.specific.string.StringType;\n import com.google.common.collect.Iterators;\n \n-public class DirectDictionary extends AStringType<Integer> {\n+public class DirectDictionary extends StringType {\n \n \tprivate final Dictionary dict;\n \t\n \tpublic DirectDictionary(Dictionary dict) {\n-\t\tsuper(int.class);\n+\t\tsuper();\n \t\tthis.dict = dict;\n \t}\n-\t\n+\n+\n+\t// TODO why is this a StringType at all?\n+\n+\t@Override\n+\tpublic StringType select(int[] starts, int[] length) {\n+\t\treturn null;\n+\t}\n+\n+\t@Override\n+\tpublic void set(int event, Integer value) {\n+", "originalCommit": "fdf3b6dffe93f7eae60e7c2efcc4714fa90e2654", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTk3NDAzMA==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r525974030", "bodyText": "Ja es sieht eher aus, als w\u00fcrde die Klasse als Bridge fungieren", "author": "thoniTUB", "createdAt": "2020-11-18T10:24:44Z", "path": "backend/src/main/java/com/bakdata/conquery/models/dictionary/DirectDictionary.java", "diffHunk": "@@ -3,19 +3,32 @@\n import java.nio.charset.StandardCharsets;\n import java.util.Iterator;\n \n-import com.bakdata.conquery.models.types.specific.AStringType;\n-import com.bakdata.conquery.models.types.specific.VarIntType;\n+import com.bakdata.conquery.models.identifiable.ids.specific.DictionaryId;\n+import com.bakdata.conquery.models.types.specific.string.StringType;\n import com.google.common.collect.Iterators;\n \n-public class DirectDictionary extends AStringType<Integer> {\n+public class DirectDictionary extends StringType {\n \n \tprivate final Dictionary dict;\n \t\n \tpublic DirectDictionary(Dictionary dict) {\n-\t\tsuper(int.class);\n+\t\tsuper();\n \t\tthis.dict = dict;\n \t}\n-\t\n+\n+\n+\t// TODO why is this a StringType at all?", "originalCommit": "fdf3b6dffe93f7eae60e7c2efcc4714fa90e2654", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTk4MDEwNA==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r525980104", "bodyText": "Ist das Wrapping in ByteArrayList notwendig? Es wird in getId2Value und getElement nur wieder entpackt. Soweit ich das verstehe \u00e4ndern sich die eintr\u00e4ge auch nicht mehr nach dem sie drinne sind", "author": "thoniTUB", "createdAt": "2020-11-18T10:33:57Z", "path": "backend/src/main/java/com/bakdata/conquery/models/dictionary/MapDictionary.java", "diffHunk": "@@ -7,46 +7,39 @@\n import java.util.List;\n import java.util.ListIterator;\n \n+import javax.validation.constraints.NotNull;\n+\n import com.bakdata.conquery.io.cps.CPSType;\n import com.bakdata.conquery.models.identifiable.ids.specific.DatasetId;\n-import com.bakdata.conquery.models.identifiable.ids.specific.DictionaryId;\n import com.fasterxml.jackson.annotation.JsonCreator;\n import com.fasterxml.jackson.annotation.JsonProperty;\n import com.google.common.math.DoubleMath;\n import it.unimi.dsi.fastutil.Hash;\n import it.unimi.dsi.fastutil.bytes.ByteArrayList;\n import it.unimi.dsi.fastutil.objects.Object2IntOpenHashMap;\n-import lombok.AllArgsConstructor;\n \n @CPSType(id = \"MAP_DICTIONARY\", base = Dictionary.class)\n-@AllArgsConstructor\n public class MapDictionary extends Dictionary {\n \n \tprivate Object2IntOpenHashMap<ByteArrayList> value2Id;\n \tprivate List<ByteArrayList> id2Value;\n \n-\tpublic MapDictionary() {\n+\tpublic MapDictionary(DatasetId dataset, @NotNull String name) {\n+\t\tsuper(dataset, name);\n \t\tvalue2Id = new Object2IntOpenHashMap<>();\n \t\tvalue2Id.defaultReturnValue(-1);\n \t\tid2Value = new ArrayList<>();\n \t}\n \n-\tpublic MapDictionary(DictionaryId dictionaryId) {\n-\t\tthis();\n-\t\tthis.setName(dictionaryId.getDictionary());\n-\t\tthis.setDataset(dictionaryId.getDataset());\n-\t}\n-\n \t@JsonCreator\n \tpublic MapDictionary(DatasetId datasetId, String name, byte[][] id2Value) {\n+\t\tsuper(datasetId, name);\n \t\tif (id2Value == null) {\n \t\t\tid2Value = new byte[0][];\n \t\t}\n \t\tthis.id2Value = new ArrayList<>(id2Value.length);\n \t\tvalue2Id = new Object2IntOpenHashMap<>(id2Value.length);\n \t\tvalue2Id.defaultReturnValue(-1);\n-\t\tthis.setName(name);\n-\t\tthis.setDataset(datasetId);\n \n \t\tfor (int i = 0; i < id2Value.length; i++) {\n \t\t\tByteArrayList v = new ByteArrayList(id2Value[i]);", "originalCommit": "fdf3b6dffe93f7eae60e7c2efcc4714fa90e2654", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTk4MDQzMA==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r525980430", "bodyText": "Aber das ist etwas f\u00fcr einen extra PR", "author": "thoniTUB", "createdAt": "2020-11-18T10:34:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTk4MDEwNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTk4NDkxMA==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r525984910", "bodyText": "W\u00e4re hier nicht eine ArrayList oder besser int[] angemessen wo: start[2] == -1 wenn die entity nicht vorhanden ist", "author": "thoniTUB", "createdAt": "2020-11-18T10:41:25Z", "path": "backend/src/main/java/com/bakdata/conquery/models/events/Bucket.java", "diffHunk": "@@ -40,155 +33,131 @@\n @Getter\n @Setter\n @ToString\n-@JsonDeserialize(using = BucketDeserializer.class)\n-public abstract class Bucket extends IdentifiableImpl<BucketId> implements Iterable<Integer>, JsonSerializable {\n+@RequiredArgsConstructor(onConstructor_ = {@JsonCreator})\n+public class Bucket extends IdentifiableImpl<BucketId> {\n \n \t@Min(0)\n-\tprivate int bucket;\n-\t@NotNull\n+\tprivate final int bucket;\n+\n+\tprivate final ImportId importId;\n+\n+\t// todo try to reduce reliance on import and use internal components instead\n \t@NsIdRef\n \tprivate Import imp;\n+\n \t@Min(0)\n-\tprivate int numberOfEvents;\n-\t@ToString.Exclude\n-\tprivate int[] offsets;\n-\t@NotNull\n-\t@Setter\n-\t@ToString.Exclude\n-\tprotected BitStore nullBits;\n+\tprivate final int numberOfEvents;\n \n-\tpublic Bucket(int bucket, Import imp, int[] offsets) {\n-\t\tthis.bucket = bucket;\n-\t\tthis.imp = imp;\n-\t\tthis.offsets = offsets;\n-\t}\n+\tprivate final CType<?,?>[] stores;\n \n-\t@Override\n-\tpublic BucketId createId() {\n-\t\treturn new BucketId(imp.getId(), bucket);\n-\t}\n \n+\t/**\n+\t * start of each Entity in {@code stores}.\n+\t */\n+\tprivate final Map<Integer, Integer> start;", "originalCommit": "fdf3b6dffe93f7eae60e7c2efcc4714fa90e2654", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTk5MjAwMg==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r525992002", "bodyText": "Okay, ich sehe, dass du von localentity wegkommen m\u00f6chtest, aber das ist denke ich ein wichtiger Faktor um den Object overhead gering zu halten.", "author": "thoniTUB", "createdAt": "2020-11-18T10:52:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTk4NDkxMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzc2ODAwOQ==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r527768009", "bodyText": "Ich habe das durch einen copy-Konstruktor von Int2IntArrayMap im Constructor gel\u00f6st", "author": "awildturtok", "createdAt": "2020-11-20T15:28:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTk4NDkxMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODE0MzkzMQ==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r558143931", "bodyText": "Aber Int2IntArrayMap bewart dich nicht vor boxing und unboxing, oder wird das sofort wegoptimiert?", "author": "thoniTUB", "createdAt": "2021-01-15T09:44:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTk4NDkxMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODM1MTAwMA==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r558351000", "bodyText": "ich habs jetzt mit einem serializer gel\u00f6st", "author": "awildturtok", "createdAt": "2021-01-15T14:42:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTk4NDkxMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTk4OTU5MA==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r525989590", "bodyText": "Map<Column, Object> als R\u00fcckgabe. Momentan wird in den Column Conditions noch der Spaltenname an statt der SpaltenId gef\u00fchrt, was letztens zu einem Problem ohne Fehlermeldung gef\u00fchrt hat", "author": "thoniTUB", "createdAt": "2020-11-18T10:48:41Z", "path": "backend/src/main/java/com/bakdata/conquery/models/events/Bucket.java", "diffHunk": "@@ -40,155 +33,131 @@\n @Getter\n @Setter\n @ToString\n-@JsonDeserialize(using = BucketDeserializer.class)\n-public abstract class Bucket extends IdentifiableImpl<BucketId> implements Iterable<Integer>, JsonSerializable {\n+@RequiredArgsConstructor(onConstructor_ = {@JsonCreator})\n+public class Bucket extends IdentifiableImpl<BucketId> {\n \n \t@Min(0)\n-\tprivate int bucket;\n-\t@NotNull\n+\tprivate final int bucket;\n+\n+\tprivate final ImportId importId;\n+\n+\t// todo try to reduce reliance on import and use internal components instead\n \t@NsIdRef\n \tprivate Import imp;\n+\n \t@Min(0)\n-\tprivate int numberOfEvents;\n-\t@ToString.Exclude\n-\tprivate int[] offsets;\n-\t@NotNull\n-\t@Setter\n-\t@ToString.Exclude\n-\tprotected BitStore nullBits;\n+\tprivate final int numberOfEvents;\n \n-\tpublic Bucket(int bucket, Import imp, int[] offsets) {\n-\t\tthis.bucket = bucket;\n-\t\tthis.imp = imp;\n-\t\tthis.offsets = offsets;\n-\t}\n+\tprivate final CType<?,?>[] stores;\n \n-\t@Override\n-\tpublic BucketId createId() {\n-\t\treturn new BucketId(imp.getId(), bucket);\n-\t}\n \n+\t/**\n+\t * start of each Entity in {@code stores}.\n+\t */\n+\tprivate final Map<Integer, Integer> start;\n+\n+\t/**\n+\t * Number of events per Entity in {@code stores}.\n+\t */\n+\tprivate final Map<Integer, Integer> length;\n+\n+\tprivate final int bucketSize;\n \n-\tpublic abstract int getBucketSize();\n \n \t@Override\n-\tpublic PrimitiveIterator.OfInt iterator() {\n-\t\treturn IntStream.range(0, getBucketSize())\n-\t\t\t\t\t\t.filter(this::containsLocalEntity)\n-\t\t\t\t\t\t.map(this::toGlobal)\n-\t\t\t\t\t\t.iterator();\n+\tpublic BucketId createId() {\n+\t\treturn new BucketId(importId, bucket);\n \t}\n \n-\tpublic boolean containsLocalEntity(int localEntity) {\n-\t\treturn offsets[localEntity] != -1;\n+\t/**\n+\t * Iterate entities\n+\t */\n+\tpublic Collection<Integer> entities() {\n+\t\treturn start.keySet();\n \t}\n \n-\tpublic abstract void initFields(int numberOfEntities);\n-\n-\tpublic int toLocal(int entity) {\n-\t\treturn entity - getBucketSize() * bucket;\n+\tpublic boolean containsEntity(int localEntity) {\n+\t\treturn start.containsKey(localEntity);\n \t}\n \n-\tpublic int toGlobal(int entity) {\n-\t\treturn entity + getBucketSize() * bucket;\n+\tpublic Iterable<BucketEntry> entries() {\n+\t\treturn () -> start.keySet()\n+\t\t\t\t\t\t  .stream()\n+\t\t\t\t\t\t  .flatMap(entity -> IntStream.range(getEntityStart(entity), getEntityEnd(entity))\n+\t\t\t\t\t\t\t\t\t\t\t\t\t  .mapToObj(e -> new BucketEntry(entity, e))\n+\t\t\t\t\t\t  )\n+\t\t\t\t\t\t  .iterator();\n \t}\n \n-\n-\tpublic int getFirstEventOfLocal(int localEntity) {\n-\t\treturn offsets[localEntity];\n+\tpublic int getEntityStart(int entityId) {\n+\t\treturn start.get(entityId);\n \t}\n \n-\tpublic int getLastEventOfLocal(int localEntity) {\n-\t\tfor (localEntity++; localEntity < offsets.length; localEntity++) {\n-\t\t\tif (offsets[localEntity] != -1) {\n-\t\t\t\treturn offsets[localEntity];\n-\t\t\t}\n-\t\t}\n-\t\treturn numberOfEvents;\n+\tpublic int getEntityEnd(int entityId) {\n+\t\treturn start.get(entityId) + length.get(entityId);\n \t}\n \n-\t@Override\n-\tpublic void serialize(JsonGenerator gen, SerializerProvider serializers) throws IOException {\n-\t\tByteArrayOutputStream baos = new ByteArrayOutputStream();\n-\n-\t\tjava.io.OutputStream outputStream = baos;\n-\t\ttry (Output output = new Output(outputStream)) {\n-\t\t\twriteContent(output);\n-\t\t}\n-\t\tbyte[] content = baos.toByteArray();\n-\t\tgen.writeStartObject();\n-\t\tgen.writeNumberField(Fields.bucket, bucket);\n-\t\tgen.writeStringField(Fields.imp, imp.getId().toString());\n-\t\tgen.writeNumberField(Fields.numberOfEvents, numberOfEvents);\n-\t\tgen.writeFieldName(Fields.offsets);\n-\t\tgen.writeArray(offsets, 0, offsets.length);\n-\t\tgen.writeBinaryField(\"content\", content);\n-\t\tgen.writeEndObject();\n+\tpublic final boolean has(int event, Column column) {\n+\t\treturn stores[column.getPosition()].has(event);\n \t}\n \n-\tpublic Iterable<BucketEntry> entries() {\n-\t\treturn () -> IntStream\n-\t\t\t\t\t\t\t .range(0, getBucketSize())\n-\t\t\t\t\t\t\t .filter(this::containsLocalEntity)\n-\t\t\t\t\t\t\t .boxed()\n-\t\t\t\t\t\t\t .flatMap(le -> IntStream\n-\t\t\t\t\t\t\t\t\t\t\t\t\t.range(getFirstEventOfLocal(le), getLastEventOfLocal(le))\n-\t\t\t\t\t\t\t\t\t\t\t\t\t.mapToObj(e -> new BucketEntry(le, e))\n-\t\t\t\t\t\t\t )\n-\t\t\t\t\t\t\t .iterator();\n+\tpublic int getString(int event, Column column) {\n+\t\treturn stores[column.getPosition()].getString(event);\n \t}\n \n-\n-\tpublic boolean has(int event, Column column) {\n-\t\treturn has(event, column.getPosition());\n+\tpublic long getInteger(int event, Column column) {\n+\t\treturn stores[column.getPosition()].getInteger(event);\n \t}\n \n-\tpublic abstract boolean has(int event, int columnPosition);\n-\n-\tpublic abstract int getString(int event, Column column);\n-\n-\tpublic abstract long getInteger(int event, Column column);\n-\n-\tpublic abstract boolean getBoolean(int event, Column column);\n-\n-\tpublic abstract double getReal(int event, Column column);\n+\tpublic boolean getBoolean(int event, Column column) {\n+\t\treturn stores[column.getPosition()].getBoolean(event);\n+\t}\n \n-\tpublic abstract BigDecimal getDecimal(int event, Column column);\n+\tpublic double getReal(int event, Column column) {\n+\t\treturn stores[column.getPosition()].getReal(event);\n+\t}\n \n-\tpublic abstract long getMoney(int event, Column column);\n+\tpublic BigDecimal getDecimal(int event, Column column) {\n+\t\treturn stores[column.getPosition()].getDecimal(event);\n+\t}\n \n-\tpublic abstract int getDate(int event, Column column);\n+\tpublic long getMoney(int event, Column column) {\n+\t\treturn stores[column.getPosition()].getMoney(event);\n+\t}\n \n-\tpublic abstract CDateRange getDateRange(int event, Column column);\n+\tpublic int getDate(int event, Column column) {\n+\t\treturn stores[column.getPosition()].getDate(event);\n+\t}\n \n-\tpublic Object getRaw(int event, Column column) {\n-\t\treturn getRaw(event, column.getPosition());\n+\tpublic CDateRange getAsDateRange(int event, Column currentColumn) {\n+\t\treturn getDateRange(event, currentColumn);\n \t}\n \n-\tpublic abstract Object getRaw(int event, int columnPosition);\n+\tpublic CDateRange getDateRange(int event, Column column) {\n+\t\treturn stores[column.getPosition()].getDateRange(event);\n+\t}\n \n \tpublic Object getAsObject(int event, Column column) {\n-\t\treturn getAsObject(event, column.getPosition());\n+\t\treturn stores[column.getPosition()].getAsObject(event);\n \t}\n \n-\tpublic abstract Object getAsObject(int event, int columnPosition);\n-\n-\tpublic abstract boolean eventIsContainedIn(int event, Column column, CDateRange dateRange);\n-\n \tpublic boolean eventIsContainedIn(int event, Column column, BitMapCDateSet dateRanges) {\n-\t\treturn dateRanges.intersects(getAsDateRange(event, column));\n+\t\treturn dateRanges.intersects(stores[column.getPosition()].getDateRange(event));\n \t}\n \n-\tpublic abstract CDateRange getAsDateRange(int event, Column currentColumn);\n \n-\t@Override\n-\tpublic void serializeWithType(JsonGenerator gen, SerializerProvider serializers, TypeSerializer typeSer) throws IOException {\n-\t\tthis.serialize(gen, serializers);\n-\t}\n+\tpublic Map<String, Object> calculateMap(int event) {", "originalCommit": "fdf3b6dffe93f7eae60e7c2efcc4714fa90e2654", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzc5NjM5OA==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r527796398", "bodyText": "geht leider nicht", "author": "awildturtok", "createdAt": "2020-11-20T16:10:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTk4OTU5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODE0NjMzNw==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r558146337", "bodyText": "schade", "author": "thoniTUB", "createdAt": "2021-01-15T09:45:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTk4OTU5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODE1ODMzNg==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r558158336", "bodyText": "Kannst du nicht imp.getColumns()[i].createId() aufrufen, oder besser noch von der ImportColumn auf die TableColumnId schlie\u00dfen?\nIch sehe jetzt leider nicht direkt wo das Problem ist", "author": "thoniTUB", "createdAt": "2021-01-15T09:53:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTk4OTU5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Nzc5MDUzOA==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r567790538", "bodyText": "Das Problem sind eher die B\u00e4ume/Conditions als hier. Das m\u00fcsste man da erstmal l\u00f6sen. Habe auch ein Ticket f\u00fcr erstellt.", "author": "awildturtok", "createdAt": "2021-02-01T12:34:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTk4OTU5MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjAxNzk0MA==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r526017940", "bodyText": "Kann der CBlock nicht Teil eines Buckets sein?", "author": "thoniTUB", "createdAt": "2020-11-18T11:34:52Z", "path": "backend/src/main/java/com/bakdata/conquery/models/events/CBlock.java", "diffHunk": "@@ -37,28 +36,22 @@\n \t\n \t/**\n \t * Bloom filter per entity for the first 64 {@link ConceptTreeChild}.\n-\t *\n-\t * Per Entity.\n \t */\n-\tprivate long[] includedConcepts;\n-\n-\t// TODO: 02.09.2020 FK: Make chop this onto a per-column basis\n+\tprivate Int2LongArrayMap includedConcepts = new Int2LongArrayMap();", "originalCommit": "fdf3b6dffe93f7eae60e7c2efcc4714fa90e2654", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjIwMDY4OA==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r526200688", "bodyText": "Sodass man local ids beibehalten kann, aber diese in der Implementierung verkapselt sind und nicht nachdrau\u00dfen dringen?", "author": "thoniTUB", "createdAt": "2020-11-18T15:56:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjAxNzk0MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDQ0ODgxNw==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r530448817", "bodyText": "Finde ich eine lustige Idee, aber bitte in einem separaten PR", "author": "awildturtok", "createdAt": "2020-11-25T15:16:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjAxNzk0MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODE2NDAyNA==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r558164024", "bodyText": "Okay, ich habe ein Ticket erstellt", "author": "thoniTUB", "createdAt": "2021-01-15T09:56:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjAxNzk0MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjAyMTI2Mw==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r526021263", "bodyText": "Eine bessere ToString Methode bitte", "author": "thoniTUB", "createdAt": "2020-11-18T11:40:51Z", "path": "backend/src/main/java/com/bakdata/conquery/models/events/stores/base/ByteStore.java", "diffHunk": "@@ -0,0 +1,52 @@\n+package com.bakdata.conquery.models.events.stores.base;\n+\n+import com.bakdata.conquery.io.cps.CPSType;\n+import com.bakdata.conquery.models.events.ColumnStore;\n+import com.bakdata.conquery.models.events.stores.ColumnStoreAdapter;\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import lombok.Getter;\n+import lombok.ToString;\n+\n+\n+@CPSType(id = \"BYTES\", base = ColumnStore.class)\n+@Getter\n+@ToString(onlyExplicitlyIncluded = true)", "originalCommit": "fdf3b6dffe93f7eae60e7c2efcc4714fa90e2654", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjAyNjUzNw==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r526026537", "bodyText": "Das ist leider eine nifty Fehlerquelle. Du solltest null events separat flaggen. So schr\u00e4nkst du den Wertebereicht ein und dein get und set reagieren nicht darauf.", "author": "thoniTUB", "createdAt": "2020-11-18T11:49:51Z", "path": "backend/src/main/java/com/bakdata/conquery/models/events/stores/base/ByteStore.java", "diffHunk": "@@ -0,0 +1,52 @@\n+package com.bakdata.conquery.models.events.stores.base;\n+\n+import com.bakdata.conquery.io.cps.CPSType;\n+import com.bakdata.conquery.models.events.ColumnStore;\n+import com.bakdata.conquery.models.events.stores.ColumnStoreAdapter;\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import lombok.Getter;\n+import lombok.ToString;\n+\n+\n+@CPSType(id = \"BYTES\", base = ColumnStore.class)\n+@Getter\n+@ToString(onlyExplicitlyIncluded = true)\n+public class ByteStore extends ColumnStoreAdapter<Long> {\n+\n+\tprivate final byte nullValue;", "originalCommit": "fdf3b6dffe93f7eae60e7c2efcc4714fa90e2654", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjY3NzYwOA==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r532677608", "bodyText": "Habe doku daf\u00fcr angelegt, der soll n\u00e4mlich nicht eigenst\u00e4ndig erstellt werden", "author": "awildturtok", "createdAt": "2020-11-30T15:23:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjAyNjUzNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjE5ODM0Mw==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r526198343", "bodyText": "Es war ja vorher schon fragw\u00fcrdig ob die Funktion einen realistischen wert zur\u00fcckgibt, aber ist es jetzt \u00fcberhaupt noch ein ding?", "author": "thoniTUB", "createdAt": "2020-11-18T15:53:54Z", "path": "backend/src/main/java/com/bakdata/conquery/models/datasets/Import.java", "diffHunk": "@@ -174,6 +61,17 @@ public static Import createForPreprocessing(String table, String tag, PPColumn[]\n \t\treturn imp;\n \t}\n \n+\t@Override\n+\tpublic ImportId createId() {\n+\t\treturn new ImportId(table, getName());\n+\t}\n+\n+\tpublic void loadExternalInfos(NamespacedStorage storage) {\n+\t\tfor (ImportColumn col : columns) {\n+\t\t\tcol.getType().loadDictionaries(storage);\n+\t\t}\n+\t}\n+\n \tpublic long estimateMemoryConsumption() {\n \t\tlong mem = 0;\n \t\tfor (ImportColumn col : columns) {", "originalCommit": "fdf3b6dffe93f7eae60e7c2efcc4714fa90e2654", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjY3NzgyOA==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r532677828", "bodyText": "Sollte es schon, das w\u00e4re sonst schade.", "author": "awildturtok", "createdAt": "2020-11-30T15:23:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjE5ODM0Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjIwMTg1NQ==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r526201855", "bodyText": "Ich habe das gef\u00fchl @Valid macht nichts, oder gibt es einen Validator f\u00fcr primitive Arrays?", "author": "thoniTUB", "createdAt": "2020-11-18T15:57:32Z", "path": "backend/src/main/java/com/bakdata/conquery/models/events/CBlock.java", "diffHunk": "@@ -37,28 +36,22 @@\n \t\n \t/**\n \t * Bloom filter per entity for the first 64 {@link ConceptTreeChild}.\n-\t *\n-\t * Per Entity.\n \t */\n-\tprivate long[] includedConcepts;\n-\n-\t// TODO: 02.09.2020 FK: Make chop this onto a per-column basis\n+\tprivate Int2LongArrayMap includedConcepts = new Int2LongArrayMap();\n+\t\n \t/**\n \t * Statistic for fast lookup if entity is of interest.\n \t * Int array for memory performance.\n-\t *\n-\t * Per Entity.\n \t */\n-\tprivate int[] minDate, maxDate;\n+\tprivate Int2IntMap minDate = new Int2IntArrayMap();\n+\tprivate Int2IntMap maxDate = new Int2IntArrayMap();\n \t\n \t/**\n \t * Represents the path in a {@link TreeConcept} to optimize lookup.\n \t * Nodes in the tree are simply enumerated.\n-\t *\n-\t * Per Event.\n \t */\n-\t@Nullable\n-\tprivate int[][] mostSpecificChildren = null;\n+\t@Valid\n+\tprivate int[][] mostSpecificChildren;", "originalCommit": "fdf3b6dffe93f7eae60e7c2efcc4714fa90e2654", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjY3ODYwNQ==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r532678605", "bodyText": "ja gerade hier.. :D", "author": "awildturtok", "createdAt": "2020-11-30T15:24:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjIwMTg1NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjIwNDU3OA==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r526204578", "bodyText": "Der Cast/Box/Unbox sieht komisch aus", "author": "thoniTUB", "createdAt": "2020-11-18T16:00:56Z", "path": "backend/src/main/java/com/bakdata/conquery/models/events/stores/base/DateStore.java", "diffHunk": "@@ -0,0 +1,61 @@\n+package com.bakdata.conquery.models.events.stores.base;\n+\n+import com.bakdata.conquery.io.cps.CPSType;\n+import com.bakdata.conquery.models.common.CDate;\n+import com.bakdata.conquery.models.common.daterange.CDateRange;\n+import com.bakdata.conquery.models.events.ColumnStore;\n+import com.bakdata.conquery.models.events.stores.ColumnStoreAdapter;\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import lombok.Getter;\n+import lombok.ToString;\n+\n+@CPSType(id = \"DATES\", base = ColumnStore.class)\n+@Getter\n+@ToString(onlyExplicitlyIncluded = true)\n+public class DateStore extends ColumnStoreAdapter<Integer> {\n+\n+\tprivate final ColumnStore<Long> store;\n+\n+\t@JsonCreator\n+\tpublic DateStore(ColumnStore<Long> store) {\n+\t\tthis.store = store;\n+\t}\n+\n+\tpublic static DateStore create(int size) {\n+\t\treturn new DateStore(IntegerStore.create(size));\n+\t}\n+\n+\tpublic DateStore select(int[] starts, int[] ends) {\n+\t\treturn new DateStore(store.select(starts,ends));\n+\t}\n+\n+\t@Override\n+\tpublic void set(int event, Integer value) {\n+\t\tif (value == null) {\n+\t\t\tstore.set(event, null);\n+\t\t\treturn;\n+\t\t}\n+\n+\t\tstore.set(event, (long) value);\n+\t}\n+\n+\t@Override\n+\tpublic boolean has(int event) {\n+\t\treturn store.has(event);\n+\t}\n+\n+\t@Override\n+\tpublic CDateRange getDateRange(int event) {\n+\t\treturn CDateRange.exactly(get(event));\n+\t}\n+\n+\t@Override\n+\tpublic Integer get(int event) {\n+\t\treturn (int) store.getInteger(event);\n+\t}", "originalCommit": "fdf3b6dffe93f7eae60e7c2efcc4714fa90e2654", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjIwNzY4Ng==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r526207686", "bodyText": "must du hier nicht .intValue() aufrufen?", "author": "thoniTUB", "createdAt": "2020-11-18T16:04:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjIwNDU3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjY3ODk1Mw==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r532678953", "bodyText": "stimmt", "author": "awildturtok", "createdAt": "2020-11-30T15:24:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjIwNDU3OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjIxMDI0OQ==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r526210249", "bodyText": "Ich verstehe noch nicht so ganz warum das manchmal dieser Store ist. Manchmal ColumnStore<> und manchmal ein Array", "author": "thoniTUB", "createdAt": "2020-11-18T16:07:21Z", "path": "backend/src/main/java/com/bakdata/conquery/models/events/stores/date/PackedDateRangeStore.java", "diffHunk": "@@ -0,0 +1,54 @@\n+package com.bakdata.conquery.models.events.stores.date;\n+\n+import com.bakdata.conquery.io.cps.CPSType;\n+import com.bakdata.conquery.models.common.daterange.CDateRange;\n+import com.bakdata.conquery.models.events.ColumnStore;\n+import com.bakdata.conquery.models.events.stores.ColumnStoreAdapter;\n+import com.bakdata.conquery.models.events.stores.base.IntegerStore;\n+import com.bakdata.conquery.util.PackedUnsigned1616;\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import lombok.Getter;\n+import lombok.ToString;\n+\n+@CPSType(id = \"PACKED_DATE_RANGES\", base = ColumnStore.class)\n+@Getter\n+@ToString(onlyExplicitlyIncluded = true)\n+public class PackedDateRangeStore extends ColumnStoreAdapter<CDateRange> {\n+\n+\tprivate final IntegerStore store;", "originalCommit": "fdf3b6dffe93f7eae60e7c2efcc4714fa90e2654", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjY4MDU2Mg==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r532680562", "bodyText": "Inkonsistenz von meiner Seite: Es gibt ein paar Grundlegende Stores, auf die delegiert werden soll, aber f\u00fcr generizit\u00e4t soll immer der oberste Typ verwendet werden, also Byte/Int/Short -> Long etc. die haben dann auch das Array. Der castet die Werte hoch/runter", "author": "awildturtok", "createdAt": "2020-11-30T15:26:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjIxMDI0OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjIxMTAzNg==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r526211036", "bodyText": "Format", "author": "thoniTUB", "createdAt": "2020-11-18T16:08:26Z", "path": "backend/src/main/java/com/bakdata/conquery/models/jobs/CalculateCBlocksJob.java", "diffHunk": "@@ -98,18 +102,22 @@ private void calculateEntityDateIndices(CBlock cBlock, Bucket bucket) {\n \n \t\t\t\tCDateRange range = bucket.getAsDateRange(entry.getEvent(), column);\n \n-\t\t\t\tcBlock.getMinDate()[entry.getLocalEntity()] = Math.min(cBlock.getMinDate()[entry.getLocalEntity()], range.getMinValue());\n-\n-\t\t\t\tcBlock.getMaxDate()[entry.getLocalEntity()] = Math.max(cBlock.getMaxDate()[entry.getLocalEntity()], range.getMaxValue());\n+\t\t\t\tcBlock.getMinDate()\n+\t\t\t\t\t  .put(\n+\t\t\t\t\t\t\t  entry.getEntity(),\n+\t\t\t\t\t\t\t  Math.min(cBlock.getMinDate().getOrDefault(entry.getEntity(), Integer.MAX_VALUE), range.getMinValue())\n+\t\t\t\t\t  );\n+\n+\t\t\t\tcBlock.getMaxDate()\n+\t\t\t\t\t  .put(\n+\t\t\t\t\t\t\t  entry.getEntity(),\n+\t\t\t\t\t\t\t  Math.max(cBlock.getMaxDate()\n+\t\t\t\t\t\t\t\t\t\t\t .getOrDefault(entry.getEntity(), Integer.MIN_VALUE), range.getMaxValue())\n+\t\t\t\t\t  );", "originalCommit": "fdf3b6dffe93f7eae60e7c2efcc4714fa90e2654", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjIyNDY5Mg==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r526224692", "bodyText": "Bei ADD_IMPORT und hier IMPORT_BIT m\u00fcssen die Dictionaries geladen werden. Ich verstehe nicht warum", "author": "thoniTUB", "createdAt": "2020-11-18T16:26:31Z", "path": "backend/src/main/java/com/bakdata/conquery/models/messages/namespaces/specific/ImportBucket.java", "diffHunk": "@@ -1,72 +1,39 @@\n package com.bakdata.conquery.models.messages.namespaces.specific;\n \n-import java.io.ByteArrayInputStream;\n-import java.util.Arrays;\n-\n-import javax.annotation.Nonnull;\n-import javax.validation.constraints.NotEmpty;\n-import javax.validation.constraints.NotNull;\n-\n import com.bakdata.conquery.io.cps.CPSType;\n-import com.bakdata.conquery.models.datasets.Import;\n import com.bakdata.conquery.models.events.Bucket;\n-import com.bakdata.conquery.models.events.generation.BlockFactory;\n-import com.bakdata.conquery.models.identifiable.ids.specific.BucketId;\n import com.bakdata.conquery.models.messages.namespaces.NamespacedMessage;\n import com.bakdata.conquery.models.messages.namespaces.WorkerMessage;\n+import com.bakdata.conquery.models.types.CType;\n import com.bakdata.conquery.models.worker.Worker;\n import com.fasterxml.jackson.annotation.JsonCreator;\n-import com.jakewharton.byteunits.BinaryByteUnit;\n-import it.unimi.dsi.fastutil.ints.IntArrayList;\n import lombok.Getter;\n import lombok.RequiredArgsConstructor;\n import lombok.Setter;\n \n-@CPSType(id=\"IMPORT_BIT\", base=NamespacedMessage.class)\n-@RequiredArgsConstructor(onConstructor_ = @JsonCreator) @Getter @Setter\n+@CPSType(id = \"IMPORT_BIT\", base = NamespacedMessage.class)\n+@RequiredArgsConstructor(onConstructor_ = @JsonCreator)\n+@Getter\n+@Setter\n public class ImportBucket extends WorkerMessage.Slow {\n-\t\n-\t@Nonnull @NotNull\n-\tprivate final BucketId bucket;\n-\t@NotEmpty\n-\tprivate IntArrayList includedEntities = new IntArrayList();\n-\t@NotNull\n-\tprivate byte[][] bytes;\n-\t\n+\n+\tprivate final Bucket bucket;\n \n \t@Override\n \tpublic void react(Worker context) throws Exception {\n-\t\tgetProgressReporter().setMax(includedEntities.size());\n-\t\tImport imp = context.getStorage().getImport(bucket.getImp());\n-\t\t\n-\t\tBlockFactory factory = imp.getBlockFactory();\n-\t\tBucket[] buckets = new Bucket[includedEntities.size()];\n-\t\t\n-\t\tfor(int index=0;index<includedEntities.size();index++) {\n-\t\t\tint entity = includedEntities.getInt(index);\n-\t\t\t\n-\t\t\ttry(ByteArrayInputStream input = new ByteArrayInputStream(bytes[index])) {\n-\t\t\t\tbuckets[index] = factory.readSingleValue(bucket.getBucket(), imp, input);\n-\t\t\t\tif(input.available() > 0) {\n-\t\t\t\t\tthrow new IllegalStateException(\"After reading the block of \"+entity+\" there are still \"+input.available()+\" bytes remaining in its content\");\n-\t\t\t\t}\n-\t\t\t}\n-\t\t\tgetProgressReporter().report(1);\n+\t\t// todo get import via idRef instead.\n+\n+\t\t// todo encapsulate this better.\n+\t\tfor (CType<?, ?> store : bucket.getStores()) {\n+\t\t\tstore.loadDictionaries(context.getStorage());", "originalCommit": "fdf3b6dffe93f7eae60e7c2efcc4714fa90e2654", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjIzMzk5Mw==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r526233993", "bodyText": "Okay, es gibt sie noch die localId. Bin verwirrt", "author": "thoniTUB", "createdAt": "2020-11-18T16:38:26Z", "path": "backend/src/main/java/com/bakdata/conquery/models/query/queryplan/specific/DateRestrictingNode.java", "diffHunk": "@@ -59,16 +59,16 @@ public boolean isOfInterest(Bucket bucket) {\n \t\t\treturn true;\n \t\t}\n \n-\t\tint localId = bucket.toLocal(entity.getId());\n+\t\tint localId = entity.getId();\n \n \t\t// This means the Entity is not contained.\n-\t\tif(cBlock.getMinDate()[localId] > cBlock.getMaxDate()[localId]) {\n+\t\tif(cBlock.getMinDate().get(localId) > cBlock.getMaxDate().get(localId)) {", "originalCommit": "fdf3b6dffe93f7eae60e7c2efcc4714fa90e2654", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjcxNjYzNA==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r526716634", "bodyText": "das ist jetzt die entityId eigentlich, der Name ist nur noch nichgt richtig", "author": "awildturtok", "createdAt": "2020-11-19T09:34:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjIzMzk5Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjI0MTc0MA==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r526241740", "bodyText": "Ist dieser Container noch notwendig?", "author": "thoniTUB", "createdAt": "2020-11-18T16:48:14Z", "path": "backend/src/main/java/com/bakdata/conquery/models/types/parser/Decision.java", "diffHunk": "@@ -1,13 +1,13 @@\n package com.bakdata.conquery.models.types.parser;\n \n import com.bakdata.conquery.models.types.CType;\n-\n import lombok.Data;\n-import lombok.RequiredArgsConstructor;\n \n-@RequiredArgsConstructor\n @Data\n-public class Decision<MAJOR_JAVA_TYPE, JAVA_TYPE, CTYPE extends CType<MAJOR_JAVA_TYPE, JAVA_TYPE>> {\n-\tprivate final Transformer<MAJOR_JAVA_TYPE, JAVA_TYPE> transformer;\n+public class Decision<CTYPE extends CType<?, ?>> {\n \tprivate final CTYPE type;\n+\n+\tpublic Decision(CTYPE type) {\n+\t\tthis.type = type;\n+\t}", "originalCommit": "fdf3b6dffe93f7eae60e7c2efcc4714fa90e2654", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjcxNjk1Mw==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r526716953", "bodyText": "nein, hab mir noch nicht die Zeit genommen das zu entkapseln", "author": "awildturtok", "createdAt": "2020-11-19T09:34:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjI0MTc0MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjI0NjY1OA==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r526246658", "bodyText": "Hallo hier hinten", "author": "thoniTUB", "createdAt": "2020-11-18T16:54:26Z", "path": "backend/src/main/java/com/bakdata/conquery/models/types/parser/specific/MoneyParser.java", "diffHunk": "@@ -4,30 +4,28 @@\n \n import com.bakdata.conquery.models.config.ConqueryConfig;\n import com.bakdata.conquery.models.config.ParserConfig;\n+import com.bakdata.conquery.models.events.stores.base.LongStore;\n import com.bakdata.conquery.models.exceptions.ParsingException;\n import com.bakdata.conquery.models.types.CType;\n import com.bakdata.conquery.models.types.parser.Decision;\n-import com.bakdata.conquery.models.types.parser.NoopTransformer;\n import com.bakdata.conquery.models.types.parser.Parser;\n-import com.bakdata.conquery.models.types.parser.Transformer;\n import com.bakdata.conquery.models.types.specific.MoneyTypeLong;\n import com.bakdata.conquery.models.types.specific.MoneyTypeVarInt;\n import com.bakdata.conquery.models.types.specific.VarIntType;\n import com.bakdata.conquery.util.NumberParsing;\n import com.fasterxml.jackson.annotation.JsonIgnore;\n import lombok.Getter;\n-import lombok.NonNull;\n import lombok.ToString;\n \n @ToString(callSuper = true)\n public class MoneyParser extends Parser<Long> {\n \n+\t@JsonIgnore\n+\t@Getter(lazy = true)\n+\tprivate final BigDecimal moneyFactor = BigDecimal.valueOf(10)\n+\t\t\t\t\t\t\t\t\t\t\t\t\t .pow(ConqueryConfig.getInstance().getLocale().getCurrency().getDefaultFractionDigits());", "originalCommit": "fdf3b6dffe93f7eae60e7c2efcc4714fa90e2654", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjI1MzY4OA==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r526253688", "bodyText": "Dieses Lambda hatte ich doch schonmal entfernt.", "author": "thoniTUB", "createdAt": "2020-11-18T17:03:16Z", "path": "backend/src/main/java/com/bakdata/conquery/models/types/parser/specific/string/StringParser.java", "diffHunk": "@@ -1,58 +1,55 @@\n package com.bakdata.conquery.models.types.parser.specific.string;\n \n-import java.util.Collections;\n import java.util.Comparator;\n import java.util.EnumSet;\n-import java.util.LinkedHashMap;\n import java.util.List;\n import java.util.Map;\n import java.util.Map.Entry;\n import java.util.Objects;\n-import java.util.UUID;\n import java.util.stream.Collectors;\n import java.util.stream.Stream;\n \n import com.bakdata.conquery.models.config.ParserConfig;\n+import com.bakdata.conquery.models.events.stores.base.BooleanStore;\n import com.bakdata.conquery.models.exceptions.ParsingException;\n-import com.bakdata.conquery.models.identifiable.ids.specific.DatasetId;\n-import com.bakdata.conquery.models.identifiable.ids.specific.DictionaryId;\n+import com.bakdata.conquery.models.preproc.ColumnDescription;\n import com.bakdata.conquery.models.types.CType;\n import com.bakdata.conquery.models.types.parser.Decision;\n import com.bakdata.conquery.models.types.parser.Parser;\n-import com.bakdata.conquery.models.types.parser.Transformer;\n-import com.bakdata.conquery.models.types.parser.specific.VarIntParser;\n import com.bakdata.conquery.models.types.parser.specific.string.TypeGuesser.Guess;\n-import com.bakdata.conquery.models.types.specific.AStringType;\n-import com.bakdata.conquery.models.types.specific.StringTypeEncoded.Encoding;\n-import com.bakdata.conquery.models.types.specific.StringTypePrefix;\n-import com.bakdata.conquery.models.types.specific.StringTypeSingleton;\n-import com.bakdata.conquery.models.types.specific.StringTypeSuffix;\n-import com.bakdata.conquery.models.types.specific.VarIntType;\n+import com.bakdata.conquery.models.types.specific.string.StringType;\n+import com.bakdata.conquery.models.types.specific.string.StringTypeEncoded.Encoding;\n+import com.bakdata.conquery.models.types.specific.string.StringTypePrefix;\n+import com.bakdata.conquery.models.types.specific.string.StringTypeSingleton;\n+import com.bakdata.conquery.models.types.specific.string.StringTypeSuffix;\n import com.google.common.base.Strings;\n+import com.google.common.collect.BiMap;\n+import com.google.common.collect.HashBiMap;\n import com.jakewharton.byteunits.BinaryByteUnit;\n import lombok.Getter;\n-import lombok.NonNull;\n import lombok.extern.slf4j.Slf4j;\n import org.apache.commons.lang3.StringUtils;\n \n-@Slf4j @Getter\n+@Slf4j\n+@Getter\n public class StringParser extends Parser<Integer> {\n \n-\tprivate DictionaryId dictionaryId = new DictionaryId(new DatasetId(\"null\"), UUID.randomUUID().toString());\n-\tprivate VarIntParser indexType = new VarIntParser(); \n-\tprivate Map<String, Integer> strings = new LinkedHashMap<>();\n+\tprivate final String name;\n+\n+\tprivate BiMap<String, Integer> strings = HashBiMap.create();\n+\n \tprivate List<byte[]> decoded;\n \tprivate Encoding encoding;\n \tprivate String prefix = null;\n \tprivate String suffix = null;\n \n-\tpublic StringParser(ParserConfig config) {\n-\n+\tpublic StringParser(ColumnDescription description, ParserConfig config) {\n+\t\tthis.name = description.getName();\n \t}\n \n \t@Override\n \tprotected Integer parseValue(String value) throws ParsingException {\n-\t\treturn strings.computeIfAbsent(value, v-> {\n+\t\treturn strings.computeIfAbsent(value, v -> {\n \t\t\t//new values\n \n \t\t\t//set longest common prefix and suffix", "originalCommit": "fdf3b6dffe93f7eae60e7c2efcc4714fa90e2654", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjcxNzI1NA==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r526717254", "bodyText": "muss mal wieder develop mergen", "author": "awildturtok", "createdAt": "2020-11-19T09:35:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjI1MzY4OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjI2MjI2Mw==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r526262263", "bodyText": "Doku", "author": "thoniTUB", "createdAt": "2020-11-18T17:14:47Z", "path": "backend/src/main/java/com/bakdata/conquery/models/types/specific/ChainedStringType.java", "diffHunk": "@@ -0,0 +1,81 @@\n+package com.bakdata.conquery.models.types.specific;\n+\n+import java.util.function.Consumer;\n+\n+import javax.annotation.Nonnull;\n+\n+import com.bakdata.conquery.io.xodus.NamespacedStorage;\n+import com.bakdata.conquery.models.dictionary.Dictionary;\n+import com.bakdata.conquery.models.identifiable.ids.specific.DictionaryId;\n+import com.bakdata.conquery.models.types.specific.string.StringType;\n+import lombok.Getter;\n+import lombok.Setter;\n+import lombok.ToString;\n+\n+@Getter @Setter\n+@ToString\n+public abstract class ChainedStringType extends StringType {", "originalCommit": "fdf3b6dffe93f7eae60e7c2efcc4714fa90e2654", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjcxOTU0NA==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r526719544", "bodyText": "Ach die Klasse kommt ja von mir, ich glaube man braucht die gar nicht", "author": "awildturtok", "createdAt": "2020-11-19T09:38:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjI2MjI2Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjI2NDU2Nw==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r526264567", "bodyText": "Warum implementiert CType ColumnStore?", "author": "thoniTUB", "createdAt": "2020-11-18T17:17:57Z", "path": "backend/src/main/java/com/bakdata/conquery/models/types/specific/MoneyTypeLong.java", "diffHunk": "@@ -4,30 +4,53 @@\n \n import com.bakdata.conquery.io.cps.CPSType;\n import com.bakdata.conquery.models.config.ConqueryConfig;\n+import com.bakdata.conquery.models.events.ColumnStore;\n+import com.bakdata.conquery.models.events.stores.base.LongStore;\n import com.bakdata.conquery.models.types.CType;\n import com.bakdata.conquery.models.types.MajorTypeId;\n+import com.fasterxml.jackson.annotation.JsonCreator;\n import com.fasterxml.jackson.annotation.JsonIgnore;\n-\n import lombok.Getter;\n \n-@CPSType(base=CType.class, id=\"MONEY_LONG\")\n+@CPSType(base = ColumnStore.class, id = \"MONEY_LONG\")\n+@Getter\n public class MoneyTypeLong extends CType<Long, Long> {\n \n-\t@JsonIgnore @Getter(lazy = true)\n+\t@JsonIgnore\n+\t@Getter(lazy = true)\n \tprivate final BigDecimal moneyFactor = BigDecimal.valueOf(10)\n-\t\t.pow(ConqueryConfig.getInstance().getLocale().getCurrency().getDefaultFractionDigits());\n-\t\n-\tpublic MoneyTypeLong() {\n-\t\tsuper(MajorTypeId.MONEY, long.class);\n-\t}\n-\t\n-\t@Override\n-\tpublic boolean canStoreNull() {\n-\t\treturn true;\n+\t\t\t\t\t\t\t\t\t\t\t\t\t .pow(ConqueryConfig.getInstance().getLocale().getCurrency().getDefaultFractionDigits());\n+\n+\tprivate final LongStore store;", "originalCommit": "fdf3b6dffe93f7eae60e7c2efcc4714fa90e2654", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjcxODk2MQ==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r526718961", "bodyText": "Ich gehe davon aus, dass ich die Klassen entweder wieder strenger Trenne, oder zusammenfasse. Die Trennung war erstmal nur der einfachheit halber gemacht um mich nur um eine Stelle zu k\u00fcmmern anstatt immer beides zu pflegen. Denn an und f\u00fcr sich erf\u00fcllen sie den gleichen Zweck bzw sollten transparent f\u00fcr die QueryEngine sein", "author": "awildturtok", "createdAt": "2020-11-19T09:37:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjI2NDU2Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjI2NjkwMg==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r526266902", "bodyText": "Achtung aus kommentiert", "author": "thoniTUB", "createdAt": "2020-11-18T17:21:16Z", "path": "backend/src/test/java/com/bakdata/conquery/models/concepts/tree/perf/CachedGroovyPerformanceTest.java", "diffHunk": "@@ -1,86 +1,86 @@\n-package com.bakdata.conquery.models.concepts.tree.perf;\n-\n-import java.util.Arrays;\n-import java.util.Collections;\n-import java.util.List;\n-import java.util.stream.Collectors;\n-\n-import com.bakdata.conquery.models.concepts.tree.ConceptTreeCache;\n-import com.bakdata.conquery.models.concepts.tree.TreeChildPrefixIndex;\n-import com.bakdata.conquery.models.exceptions.ConceptConfigurationException;\n-import com.bakdata.conquery.models.types.specific.StringTypeDictionary;\n-import com.bakdata.conquery.models.types.specific.StringTypeEncoded;\n-import com.bakdata.conquery.models.types.specific.StringTypeEncoded.Encoding;\n-import com.bakdata.conquery.models.types.specific.VarIntTypeInt;\n-import com.bakdata.conquery.util.CalculatedValue;\n-import com.bakdata.conquery.util.dict.SuccinctTrie;\n-import lombok.extern.slf4j.Slf4j;\n-import org.apache.commons.lang3.RandomUtils;\n-\n-@Slf4j\n-public class CachedGroovyPerformanceTest extends AbstractSearchPerformanceTest<Integer> {\n-\n-\tprivate SuccinctTrie dict;\n-\tprivate ConceptTreeCache cache;\n-\tprivate List<Integer> ids;\n-\tprivate StringTypeEncoded type;\n-\n-\t@Override\n-\tpublic String getName() {\n-\t\treturn getClass().getSimpleName();\n-\t}\n-\n-\t@Override\n-\tpublic int[] getIterations(){\n-\t\treturn new int[]{1000, 10000, 100000, 500000};\n-\t}\n-\n-\n-\t@Override\n-\tpublic String getConceptSourceName() {\n-\t\treturn \"prefixes.concept.json\";\n-\t}\n-\n-\tpublic List<byte[]> getTestStrings() {\n-\t\treturn Arrays.asList(\n-\t\t\t\"63F\", \"J14B\", \"N01C\", \"I10C\", \"L36Z\", \"960Z\", \"M10B\", \"X07A\", \"F06E\", \"P04C\", \"R63E\", \"O65B\", \"G77B\", \"F60B\", \"I65A\", \"F57Z\", \"R16Z\", \"R01D\", \"I23B\", \"A11E\", \"B44D\", \"F14A\", \"N62B\", \"Q61C\", \"I43B\", \"L43Z\", \"B36A\", \"F12F\", \"Z64B\", \"G07B\"\n-\t\t)\n-\t\t.stream()\n-\t\t.map(String::getBytes)\n-\t\t.collect(Collectors.toList());\n-\t}\n-\n-\t@Override\n-\tpublic List<Integer> getTestKeys() {\n-\t\treturn ids;\n-\t}\n-\n-\t@Override\n-\tpublic void postprocessConcepts() {\n-\t\tdict = new SuccinctTrie();\n-\n-\t\tids = getTestStrings().stream().map(dict::add).collect(Collectors.toList());\n-\t\tdict.compress();\n-\n-\t\tTreeChildPrefixIndex.putIndexInto(newConcept);\n-\t\tTreeChildPrefixIndex.putIndexInto(referenceConcept);\n-\n-\t\ttype = new StringTypeEncoded(new StringTypeDictionary(new VarIntTypeInt(-1, +1)), Encoding.UTF8);\n-\t\ttype.getSubType().setDictionary(dict);\n-\t\tnewConcept.initializeIdCache(type, importId);\n-\n-\t\tcache = newConcept.getCache(importId);\n-\t}\n-\n-\t@Override\n-\tpublic void referenceSearch(Integer key) throws ConceptConfigurationException {\n-\t\treferenceConcept.findMostSpecificChild(type.getElement(key),  new CalculatedValue<>(() -> Collections.singletonMap(\"distinction\", RandomUtils.nextInt(8, 19 ))));\n-\t}\n-\n-\t@Override\n-\tpublic void newSearch(Integer key) throws ConceptConfigurationException {\n-\t\tcache.findMostSpecificChild(key, type.getElement(key), new CalculatedValue<>(() -> Collections.singletonMap(\"distinction\", RandomUtils.nextInt(8, 19 ))));\n-\t}\n-\n-}\n-\n+//package com.bakdata.conquery.models.concepts.tree.perf;", "originalCommit": "fdf3b6dffe93f7eae60e7c2efcc4714fa90e2654", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzMyOTI1NA==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r533329254", "bodyText": "gel\u00f6scht", "author": "awildturtok", "createdAt": "2020-12-01T11:13:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjI2NjkwMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjI2NzE4Mw==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r526267183", "bodyText": "Achtung aus kommentiert", "author": "thoniTUB", "createdAt": "2020-11-18T17:21:38Z", "path": "backend/src/test/java/com/bakdata/conquery/models/concepts/tree/PrefixIndexedTest.java", "diffHunk": "@@ -1,180 +1,180 @@\n-package com.bakdata.conquery.models.concepts.tree;\n-\n-import static org.assertj.core.api.Assertions.assertThat;\n-\n-import java.io.IOException;\n-import java.util.Collections;\n-import java.util.Map;\n-import java.util.stream.Stream;\n-\n-import com.bakdata.conquery.io.jackson.Jackson;\n-import com.bakdata.conquery.models.concepts.Concept;\n-import com.bakdata.conquery.models.datasets.Column;\n-import com.bakdata.conquery.models.datasets.Dataset;\n-import com.bakdata.conquery.models.datasets.Table;\n-import com.bakdata.conquery.models.exceptions.ConfigurationException;\n-import com.bakdata.conquery.models.exceptions.JSONException;\n-import com.bakdata.conquery.models.identifiable.CentralRegistry;\n-import com.bakdata.conquery.models.identifiable.ids.specific.ImportId;\n-import com.bakdata.conquery.models.types.MajorTypeId;\n-import com.bakdata.conquery.models.types.specific.StringTypeDictionary;\n-import com.bakdata.conquery.models.types.specific.StringTypeEncoded;\n-import com.bakdata.conquery.models.types.specific.StringTypeEncoded.Encoding;\n-import com.bakdata.conquery.models.types.specific.VarIntTypeInt;\n-import com.bakdata.conquery.models.worker.SingletonNamespaceCollection;\n-import com.bakdata.conquery.util.CalculatedValue;\n-import com.bakdata.conquery.util.dict.SuccinctTrie;\n-import com.fasterxml.jackson.databind.node.ObjectNode;\n-import com.github.powerlibraries.io.In;\n-import io.dropwizard.jersey.validation.Validators;\n-import lombok.extern.slf4j.Slf4j;\n-import org.junit.jupiter.api.BeforeAll;\n-import org.junit.jupiter.api.Test;\n-import org.junit.jupiter.params.ParameterizedTest;\n-import org.junit.jupiter.params.provider.Arguments;\n-import org.junit.jupiter.params.provider.MethodSource;\n-\n-@Slf4j\n-public class PrefixIndexedTest {\n-\n-\tprivate static final String CONCEPT_SOURCE = \"prefixes.concept.json\";\n-\n-\tprivate static SuccinctTrie dict;\n-\tprivate static TreeConcept indexedConcept;\n-\tprivate static TreeConcept oldConcept;\n-\tprivate static ImportId importId;\n-\tprivate static StringTypeEncoded type;\n-\t\n-\n-\tpublic static Stream<Arguments> getTestKeys() {\n-\t\tCalculatedValue<Map<String, Object>> rowMap = new CalculatedValue<>(Collections::emptyMap);\n-\n-\t\treturn Stream.of(\n-\t\t\t\t\"A047b\" , \"A0470\" , \"A0471\" , \"A0472\" , \"A0473\" , \"A0479\" , \"A3180\" , \"A3188\" , \"A4151\" , \"A4152\" , \"A4158\" , \"B2580\" , \"B2588\" , \"B3781\" , \"B3788\" , \"B9541\" , \"B9542\" , \"B9548\" , \"B9590\" , \"B9591\" , \"B9681\" , \"B9688\" , \"C4101\" , \"C4102\" , \"C4130\" , \"C4131\" , \"C4132\" , \"C7981\" , \"C7982\" , \"C7983\" , \"C7984\" , \"O029\" , \"Z935\" , \"M1202\" , \"E011\" , \"D370\" , \"P13\" , \"G259\" , \"J9921\" , \"I831\" , \"H950\" , \"E8331\" , \"H511\" , \"I11\" , \"S252\" , \"M0704\"\n-\t\t)\n-\t\t\t\t\t.map(key -> Arguments.of(key, rowMap));\n-\t}\n-\n-\n-\t@BeforeAll\n-\tpublic static void init() throws IOException, JSONException, ConfigurationException {\n-\t\tdict = new SuccinctTrie();\n-\n-\t\tgetTestKeys()\n-\t\t\t.map(args -> (String) args.get()[0])\n-\t\t\t.map(String::getBytes)\n-\t\t\t.forEach(dict::add);\n-\t\t\n-\t\tdict.compress();\n-\n-\t\tObjectNode node = Jackson.MAPPER.readerFor(ObjectNode.class).readValue(In.resource(PrefixIndexedTest.class, CONCEPT_SOURCE).asStream());\n-\n-\t\t// load concept tree from json\n-\t\tCentralRegistry registry = new CentralRegistry();\n-\n-\n-\t\tTable table = new Table();\n-\n-\t\ttable.setName(\"the_table\");\n-\t\tDataset dataset = new Dataset();\n-\n-\t\tdataset.setName(\"the_dataset\");\n-\n-\t\tregistry.register(dataset);\n-\n-\t\ttable.setDataset(dataset);\n-\n-\t\tColumn column = new Column();\n-\t\tcolumn.setName(\"the_column\");\n-\t\tcolumn.setType(MajorTypeId.STRING);\n-\n-\t\ttable.setColumns(new Column[]{column});\n-\t\tcolumn.setTable(table);\n-\n-\t\tregistry.register(table);\n-\t\tregistry.register(column);\n-\n-\t\timportId = new ImportId(table.getId(), \"import\");\n-\n-\t\t// load tree twice to to avoid references\n-\n-\t\tindexedConcept = new SingletonNamespaceCollection(registry).injectInto(dataset.injectInto(Jackson.MAPPER.readerFor(Concept.class))).readValue(node);\n-\n-\t\tindexedConcept.setDataset(dataset.getId());\n-\t\tindexedConcept.initElements(Validators.newValidator());\n-\n-\n-\t\tTreeChildPrefixIndex.putIndexInto(indexedConcept);\n-\t\ttype = new StringTypeEncoded(new StringTypeDictionary(new VarIntTypeInt(-1, +1)), Encoding.UTF8);\n-\t\ttype.getSubType().setDictionary(dict);\n-\t\tindexedConcept.initializeIdCache(type, importId);\n-\n-\t\toldConcept = new SingletonNamespaceCollection(registry).injectInto(dataset.injectInto(Jackson.MAPPER.readerFor(Concept.class))).readValue(node);\n-\n-\t\toldConcept.setDataset(dataset.getId());\n-\t\toldConcept.initElements(Validators.newValidator());\n-\n-\t\tassertThat(indexedConcept.getChildIndex()).isNotNull();\n-\t\tassertThat(oldConcept.getChildIndex()).isNull();\n-\t}\n-\n-\t@ParameterizedTest(name = \"{index}: {0}\")\n-\t@MethodSource(\"getTestKeys\")\n-\tpublic void basic(String key, CalculatedValue<Map<String, Object>> rowMap) throws JSONException {\n-\t\tlog.trace(\"Searching for {}\", key);\n-\n-\t\tConceptTreeChild idxResult = indexedConcept.findMostSpecificChild(key, rowMap);\n-\t\tConceptTreeChild oldResult = oldConcept.findMostSpecificChild(key, rowMap);\n-\n-\t\tif(oldResult == null) {\n-\t\t\tassertThat(idxResult).isNull();\n-\t\t}\n-\t\telse {\n-\t\t\tlog.trace(\"index_result: {}\", idxResult.getId());\n-\t\t\tlog.trace(\"normal_result: {}\", oldResult.getId());\n-\t\t\tassertThat(oldResult.getId())\n-\t\t\t\t\t.isEqualTo(idxResult.getId());\n-\t\t}\n-\t}\n-\n-\t@ParameterizedTest\n-\t@MethodSource(\"getTestKeys\")\n-\tpublic void withTail(String key, CalculatedValue<Map<String, Object>> rowMap) throws JSONException {\n-\t\tString keyWithTail = key + \".someTextAfterTheActualText\";\n-\n-\t\tlog.trace(\"Searching for {}\", key);\n-\n-\t\tConceptTreeChild idxResultTail = indexedConcept.findMostSpecificChild(keyWithTail, rowMap);\n-\t\tConceptTreeChild idxResult = indexedConcept.findMostSpecificChild(key, rowMap);\n-\n-\t\tassertThat(idxResult.getId()).isEqualTo(idxResultTail.getId());\n-\t}\n-\n-\t@ParameterizedTest\n-\t@MethodSource(\"getTestKeys\")\n-\tpublic void cached(String key, CalculatedValue<Map<String, Object>> rowMap) throws JSONException {\n-\t\tlog.trace(\"Searching for {}\", key);\n-\n-\t\tConceptTreeChild reference = indexedConcept.findMostSpecificChild(key, rowMap);\n-\t\tConceptTreeChild cached = indexedConcept.getCache(importId).findMostSpecificChild(type.getId(key), type.getElement(type.getId(key)), rowMap);\n-\t\tConceptTreeChild cached2 = indexedConcept.getCache(importId).findMostSpecificChild(type.getId(key), type.getElement(type.getId(key)), rowMap);\n-\n-\t\tassertThat(reference.getId())\n-\t\t\t\t.describedAs(\"%s hierarchical name\", key)\n-\t\t\t\t.isEqualTo(cached2.getId())\n-\t\t\t\t.isEqualTo(cached.getId())\n-\t\t;\n-\t}\n-\n-\n-\t@Test\n-\tpublic void missing() throws JSONException {\n-\t\tfinal String key = \"valueThatIsNotPresent\";\n-\n-\t\tlog.trace(\"Searching for Missing value {}\", key);\n-\n-\t\tConceptTreeChild idxResult = indexedConcept.findMostSpecificChild(key, new CalculatedValue<>(Collections::emptyMap));\n-\n-\t\tassertThat(idxResult).isNull();\n-\t}\n-}\n\\ No newline at end of file\n+//package com.bakdata.conquery.models.concepts.tree;", "originalCommit": "fdf3b6dffe93f7eae60e7c2efcc4714fa90e2654", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzMyOTMwNw==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r533329307", "bodyText": "gel\u00f6scht", "author": "awildturtok", "createdAt": "2020-12-01T11:13:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjI2NzE4Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjI2NzQ2OA==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r526267468", "bodyText": "Achtung aus kommentiert", "author": "thoniTUB", "createdAt": "2020-11-18T17:21:59Z", "path": "backend/src/test/java/com/bakdata/conquery/models/concepts/tree/perf/CachedPrefixPerformanceTest.java", "diffHunk": "@@ -1,88 +1,88 @@\n-package com.bakdata.conquery.models.concepts.tree.perf;\n-\n-import java.util.Arrays;\n-import java.util.Collections;\n-import java.util.List;\n-import java.util.Map;\n-import java.util.stream.Collectors;\n-\n-import com.bakdata.conquery.models.concepts.tree.ConceptTreeCache;\n-import com.bakdata.conquery.models.concepts.tree.TreeChildPrefixIndex;\n-import com.bakdata.conquery.models.exceptions.ConceptConfigurationException;\n-import com.bakdata.conquery.models.types.specific.StringTypeDictionary;\n-import com.bakdata.conquery.models.types.specific.StringTypeEncoded;\n-import com.bakdata.conquery.models.types.specific.StringTypeEncoded.Encoding;\n-import com.bakdata.conquery.models.types.specific.VarIntTypeInt;\n-import com.bakdata.conquery.util.CalculatedValue;\n-import com.bakdata.conquery.util.dict.SuccinctTrie;\n-import lombok.extern.slf4j.Slf4j;\n-\n-\n-@Slf4j\n-public class CachedPrefixPerformanceTest extends AbstractSearchPerformanceTest<Integer> {\n-\n-\tprivate final CalculatedValue<Map<String, Object>> rowMap = new CalculatedValue<>(Collections::emptyMap);\n-\n-\tprivate SuccinctTrie dict;\n-\tprivate ConceptTreeCache cache;\n-\tprivate List<Integer> ids;\n-\tprivate StringTypeEncoded type;\n-\n-\t@Override\n-\tpublic int[] getIterations(){\n-\t\treturn new int[]{1000, 10000, 100000, 500000};\n-\t}\n-\n-\t@Override\n-\tpublic String getName() {\n-\t\treturn getClass().getSimpleName();\n-\t}\n-\n-\t@Override\n-\tpublic String getConceptSourceName() {\n-\t\treturn \"prefixes.concept.json\";\n-\t}\n-\n-\tpublic List<byte[]> getTestStrings() {\n-\t\treturn Arrays.asList(\n-\t\t\t\t\"A047b\", \"A0470\", \"A0471\", \"A0472\", \"A0473\", \"A0479\", \"A3180\", \"A3188\", \"A4151\", \"A4152\", \"A4158\", \"B2580\", \"B2588\", \"B3781\", \"B3788\", \"B9541\", \"B9542\", \"B9548\", \"B9590\", \"B9591\", \"B9681\", \"B9688\", \"C4101\", \"C4102\", \"C4130\", \"C4131\", \"C4132\", \"C7981\", \"C7982\", \"C7983\", \"C7984\", \"O029\", \"Z935\", \"M1202\", \"E011\", \"D370\", \"P13\", \"G259\", \"J9921\", \"I831\", \"H950\", \"E8331\", \"H511\", \"I11\", \"S252\", \"M0704\"\n-\t\t)\n-\t\t.stream()\n-\t\t.map(String::getBytes)\n-\t\t.collect(Collectors.toList());\n-\t}\n-\n-\t@Override\n-\tpublic List<Integer> getTestKeys() {\n-\t\treturn ids;\n-\t}\n-\n-\n-\t@Override\n-\tpublic void postprocessConcepts() {\n-\t\tdict = new SuccinctTrie();\n-\n-\t\tids = getTestStrings().stream().map(dict::add).collect(Collectors.toList());\n-\t\tdict.compress();\n-\n-\t\tTreeChildPrefixIndex.putIndexInto(newConcept);\n-\t\tTreeChildPrefixIndex.putIndexInto(referenceConcept);\n-\n-\t\ttype = new StringTypeEncoded(new StringTypeDictionary(new VarIntTypeInt(-1, +1)), Encoding.UTF8);\n-\t\ttype.getSubType().setDictionary(dict);\n-\t\tnewConcept.initializeIdCache(type, importId);\n-\t\t\n-\t\tcache = newConcept.getCache(importId);\n-\t}\n-\n-\t@Override\n-\tpublic void referenceSearch(Integer key) throws ConceptConfigurationException {\n-\t\treferenceConcept.findMostSpecificChild(type.getElement(key), rowMap);\n-\t}\n-\n-\t@Override\n-\tpublic void newSearch(Integer key) throws ConceptConfigurationException {\n-\t\tcache.findMostSpecificChild(key, type.getElement(key), rowMap);\n-\t}\n-}\n-\n+//package com.bakdata.conquery.models.concepts.tree.perf;", "originalCommit": "fdf3b6dffe93f7eae60e7c2efcc4714fa90e2654", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzMyOTM1Mg==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r533329352", "bodyText": "gel\u00f6scht", "author": "awildturtok", "createdAt": "2020-12-01T11:13:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjI2NzQ2OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjI2Nzc0Ng==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r526267746", "bodyText": "Achtung aus kommentiert", "author": "thoniTUB", "createdAt": "2020-11-18T17:22:20Z", "path": "backend/src/test/java/com/bakdata/conquery/models/events/generation/GenerationTests.java", "diffHunk": "@@ -1,290 +1,290 @@\n-package com.bakdata.conquery.models.events.generation;\n-\n-import static org.assertj.core.api.Assertions.assertThat;\n-import static org.assertj.core.api.Assertions.assertThatCode;\n-\n-import java.io.IOException;\n-import java.lang.reflect.InvocationTargetException;\n-import java.math.BigDecimal;\n-import java.time.LocalDate;\n-import java.util.ArrayList;\n-import java.util.Arrays;\n-import java.util.List;\n-import java.util.Random;\n-import java.util.concurrent.ExecutorService;\n-import java.util.concurrent.Executors;\n-import java.util.concurrent.Future;\n-import java.util.concurrent.TimeUnit;\n-import java.util.stream.Collectors;\n-import java.util.stream.IntStream;\n-import java.util.stream.Stream;\n-\n-import com.bakdata.conquery.io.jackson.serializer.SerializationTestUtil;\n-import com.bakdata.conquery.models.common.CDate;\n-import com.bakdata.conquery.models.config.ConqueryConfig;\n-import com.bakdata.conquery.models.config.ParserConfig;\n-import com.bakdata.conquery.models.datasets.Column;\n-import com.bakdata.conquery.models.datasets.Import;\n-import com.bakdata.conquery.models.datasets.ImportColumn;\n-import com.bakdata.conquery.models.events.Bucket;\n-import com.bakdata.conquery.models.exceptions.JSONException;\n-import com.bakdata.conquery.models.identifiable.CentralRegistry;\n-import com.bakdata.conquery.models.identifiable.ids.specific.DatasetId;\n-import com.bakdata.conquery.models.identifiable.ids.specific.TableId;\n-import com.bakdata.conquery.models.types.MajorTypeId;\n-import com.bakdata.conquery.models.types.parser.Decision;\n-import com.bakdata.conquery.models.types.parser.Parser;\n-import com.bakdata.conquery.models.types.parser.specific.string.StringParser;\n-import com.bakdata.conquery.models.types.specific.AStringType;\n-import lombok.extern.slf4j.Slf4j;\n-import org.apache.commons.io.output.NullOutputStream;\n-import org.assertj.core.data.Offset;\n-import org.junit.jupiter.params.ParameterizedTest;\n-import org.junit.jupiter.params.provider.Arguments;\n-import org.junit.jupiter.params.provider.MethodSource;\n-\n-\n-@Slf4j\n-public class GenerationTests {\n-\n-\tprivate static final double requiredPrecision = Math.ulp(100f);\n-\n-\tpublic static Stream<Arguments> createRandomContent() {\n-\t\treturn IntStream\n-\t\t\t\t\t   .of(100)\n-\t\t\t\t\t   .mapToObj(numberOfValues -> {\n-\t\t\t\t\t\t\t\t\t Random r = new Random(7);\n-\t\t\t\t\t\t\t\t\t ArrayList<Object[]> arrays = new ArrayList<>();\n-\t\t\t\t\t\t\t\t\t for (int i = 0; i < numberOfValues; i++) {\n-\t\t\t\t\t\t\t\t\t\t Object[] event = new Object[20];\n-\t\t\t\t\t\t\t\t\t\t arrays.add(event);\n-\n-\t\t\t\t\t\t\t\t\t\t if (r.nextBoolean()) {\n-\t\t\t\t\t\t\t\t\t\t\t event[0] = (CDate.ofLocalDate(LocalDate.now()));\n-\t\t\t\t\t\t\t\t\t\t }\n-\t\t\t\t\t\t\t\t\t\t if (r.nextBoolean()) {\n-\t\t\t\t\t\t\t\t\t\t\t event[1] = Long.toHexString(r.nextLong());\n-\t\t\t\t\t\t\t\t\t\t }\n-\t\t\t\t\t\t\t\t\t\t if (r.nextBoolean()) {\n-\t\t\t\t\t\t\t\t\t\t\t event[2] = Integer.valueOf(r.nextInt()).toString();\n-\t\t\t\t\t\t\t\t\t\t }\n-\t\t\t\t\t\t\t\t\t\t if (r.nextBoolean()) {\n-\t\t\t\t\t\t\t\t\t\t\t event[3] = Integer.valueOf(r.nextInt()).toString();\n-\t\t\t\t\t\t\t\t\t\t }\n-\t\t\t\t\t\t\t\t\t\t if (r.nextBoolean()) {\n-\t\t\t\t\t\t\t\t\t\t\t event[4] = Long.valueOf(r.nextInt());\n-\t\t\t\t\t\t\t\t\t\t }\n-\t\t\t\t\t\t\t\t\t\t if (r.nextBoolean()) {\n-\t\t\t\t\t\t\t\t\t\t\t event[5] = Integer.valueOf((byte) r.nextInt()).toString();\n-\t\t\t\t\t\t\t\t\t\t }\n-\t\t\t\t\t\t\t\t\t\t if (r.nextBoolean()) {\n-\t\t\t\t\t\t\t\t\t\t\t event[6] = Integer.valueOf(r.nextInt()).toString();\n-\t\t\t\t\t\t\t\t\t\t }\n-\t\t\t\t\t\t\t\t\t\t if (r.nextBoolean()) {\n-\t\t\t\t\t\t\t\t\t\t\t event[7] = Long.valueOf((byte) r.nextInt());\n-\t\t\t\t\t\t\t\t\t\t }\n-\t\t\t\t\t\t\t\t\t\t if (r.nextBoolean()) {\n-\t\t\t\t\t\t\t\t\t\t\t event[8] = Long.valueOf((byte) r.nextInt());\n-\t\t\t\t\t\t\t\t\t\t }\n-\t\t\t\t\t\t\t\t\t\t if (r.nextBoolean()) {\n-\t\t\t\t\t\t\t\t\t\t\t event[9] = Integer.valueOf(r.nextInt()).toString();\n-\t\t\t\t\t\t\t\t\t\t }\n-\t\t\t\t\t\t\t\t\t\t if (r.nextBoolean()) {\n-\t\t\t\t\t\t\t\t\t\t\t event[10] = BigDecimal.valueOf(r.nextInt(4), r.nextInt(10) - 5);\n-\t\t\t\t\t\t\t\t\t\t }\n-\t\t\t\t\t\t\t\t\t\t if (r.nextBoolean()) {\n-\t\t\t\t\t\t\t\t\t\t\t event[11] = Long.valueOf((byte) r.nextInt());\n-\t\t\t\t\t\t\t\t\t\t }\n-\t\t\t\t\t\t\t\t\t\t event[12] = Long.valueOf(r.nextInt());\n-\t\t\t\t\t\t\t\t\t\t event[13] = Long.valueOf(r.nextInt());\n-\t\t\t\t\t\t\t\t\t\t //event[14] = null;\n-\t\t\t\t\t\t\t\t\t\t event[15] = Long.valueOf(r.nextInt());\n-\t\t\t\t\t\t\t\t\t\t if (r.nextBoolean()) {\n-\t\t\t\t\t\t\t\t\t\t\t event[16] = BigDecimal.valueOf(r.nextInt(4), r.nextInt(120) - 60);\n-\t\t\t\t\t\t\t\t\t\t }\n-\t\t\t\t\t\t\t\t\t\t if (r.nextBoolean()) {\n-\t\t\t\t\t\t\t\t\t\t\t event[17] = Integer.toString(r.nextInt(800));\n-\t\t\t\t\t\t\t\t\t\t }\n-\t\t\t\t\t\t\t\t\t\t // Inside ULP\n-\t\t\t\t\t\t\t\t\t\t if (r.nextBoolean()) {\n-\t\t\t\t\t\t\t\t\t\t\t event[18] = r.nextDouble() * 99d;\n-\t\t\t\t\t\t\t\t\t\t }\n-\t\t\t\t\t\t\t\t\t\t // Outside ULP\n-\t\t\t\t\t\t\t\t\t\t if (r.nextBoolean()) {\n-\t\t\t\t\t\t\t\t\t\t\t event[19] = r.nextDouble() * 1000d;\n-\t\t\t\t\t\t\t\t\t\t }\n-\n-\t\t\t\t\t\t\t\t\t }\n-\t\t\t\t\t\t\t\t\t arrays.trimToSize();\n-\n-\t\t\t\t\t\t\t\t\t return Arguments.of(numberOfValues, arrays);\n-\t\t\t\t\t\t\t\t }\n-\t\t\t\t\t   );\n-\t}\n-\n-\t@ParameterizedTest(name = \"{0}\")\n-\t@MethodSource(\"createRandomContent\")\n-\tpublic void testParallelSerialization(int numberOfValues, List<Object[]> arrays)\n-\t\t\tthrows ClassNotFoundException, IllegalAccessException, IllegalArgumentException, InvocationTargetException, IOException, NoSuchMethodException, SecurityException, JSONException, InterruptedException {\n-\t\tExecutorService pool = Executors.newFixedThreadPool(100);\n-\t\tList<Future<?>> futures = new ArrayList<>();\n-\t\tfor (int i = 0; i < 30; i++) {\n-\t\t\tList<Object[]> l = arrays.stream().map(v -> Arrays.copyOf(v, v.length)).collect(Collectors.toList());\n-\t\t\tfutures.add(pool.submit(() -> generateBucket(l)));\n-\t\t}\n-\t\tpool.shutdown();\n-\t\tfor (Future<?> f : futures) {\n-\t\t\tassertThatCode(() -> f.get()).doesNotThrowAnyException();\n-\t\t}\n-\t\tpool.awaitTermination(1, TimeUnit.HOURS);\n-\t}\n-\n-\tpublic Bucket generateBucket(List<Object[]> arrays) throws IOException {\n-\t\tfinal ParserConfig parserConfig = new ParserConfig();\n-\t\tparserConfig.setMinPrecision(requiredPrecision);\n-\n-\t\tParser[] parser = new Parser[]{\n-\t\t\t\tMajorTypeId.DATE.createParser(parserConfig),\n-\t\t\t\tMajorTypeId.STRING.createParser(parserConfig),\n-\t\t\t\tMajorTypeId.STRING.createParser(parserConfig),\n-\t\t\t\tMajorTypeId.STRING.createParser(parserConfig),\n-\t\t\t\tMajorTypeId.INTEGER.createParser(parserConfig),\n-\t\t\t\tMajorTypeId.STRING.createParser(parserConfig),\n-\t\t\t\tMajorTypeId.STRING.createParser(parserConfig),\n-\t\t\t\tMajorTypeId.INTEGER.createParser(parserConfig),\n-\t\t\t\tMajorTypeId.INTEGER.createParser(parserConfig),\n-\t\t\t\tMajorTypeId.STRING.createParser(parserConfig),\n-\t\t\t\tMajorTypeId.DECIMAL.createParser(parserConfig),\n-\t\t\t\tMajorTypeId.INTEGER.createParser(parserConfig),\n-\t\t\t\tMajorTypeId.INTEGER.createParser(parserConfig),\n-\t\t\t\tMajorTypeId.INTEGER.createParser(parserConfig),\n-\t\t\t\tMajorTypeId.INTEGER.createParser(parserConfig),\n-\t\t\t\tMajorTypeId.INTEGER.createParser(parserConfig),\n-\t\t\t\tMajorTypeId.DECIMAL.createParser(parserConfig),\n-\t\t\t\tMajorTypeId.STRING.createParser(parserConfig),\n-\t\t\t\tMajorTypeId.REAL.createParser(parserConfig),\n-\t\t\t\tMajorTypeId.REAL.createParser(parserConfig)\n-\t\t};\n-\n-\t\tassertThat(parser.length)\n-\t\t\t\t.describedAs(\"Length of Parsers and Rows.\")\n-\t\t\t\t.isEqualTo(arrays.get(0).length);\n-\n-\t\tfor (Object[] event : arrays) {\n-\t\t\tfor (int i = 0; i < parser.length; i++) {\n-\t\t\t\ttry {\n-\t\t\t\t\t//only parse strings, this test otherwise already creates parsed values\n-\t\t\t\t\tif (parser[i] instanceof StringParser && event[i] != null) {\n-\t\t\t\t\t\tevent[i] = parser[i].parse((String) event[i]);\n-\t\t\t\t\t}\n-\t\t\t\t\tparser[i].addLine(event[i]);\n-\t\t\t\t}\n-\t\t\t\tcatch (Exception e) {\n-\t\t\t\t\tthrow new IllegalArgumentException(\"Column \" + i, e);\n-\t\t\t\t}\n-\t\t\t}\n-\t\t}\n-\n-\t\tfinal int entityBucketSize = ConqueryConfig.getInstance().getCluster().getEntityBucketSize();\n-\n-\t\tImport imp = new Import(entityBucketSize);\n-\t\timp.setTable(new TableId(new DatasetId(\"test_dataset\"), \"table\"));\n-\t\timp.setName(\"import\");\n-\t\timp.setColumns(IntStream.range(0, parser.length)\n-\t\t\t\t\t\t\t\t.mapToObj(i -> column(imp, i))\n-\t\t\t\t\t\t\t\t.toArray(ImportColumn[]::new)\n-\t\t);\n-\n-\t\tDecision[] decisions = Arrays.stream(parser).map(Parser::findBestType).toArray(Decision[]::new);\n-\t\tfor (int i = 0; i < parser.length; i++) {\n-\t\t\timp.getColumns()[i].setType(decisions[i].getType());\n-\t\t\tlog.info(\"{}: {} mapped to {}\", imp.getColumns()[i], parser[i], imp.getColumns()[i].getType());\n-\t\t}\n-\n-\t\tList<Object[]> result = new ArrayList<>(arrays.size());\n-\t\tfor (Object[] event : arrays) {\n-\t\t\tObject[] line = Arrays.copyOf(event, event.length);\n-\t\t\tfor (int i = 0; i < imp.getColumns().length; i++) {\n-\t\t\t\tif (event[i] != null) {\n-\t\t\t\t\tline[i] = decisions[i].getTransformer().transform(event[i]);\n-\t\t\t\t}\n-\t\t\t}\n-\t\t\tresult.add(line);\n-\t\t}\n-\t\tfor (int i = 0; i < imp.getColumns().length; i++) {\n-\t\t\timp.getColumns()[i].getType().writeHeader(new NullOutputStream());\n-\t\t}\n-\n-\t\treturn imp.getBlockFactory().create(imp, result);\n-\t}\n-\n-\tprivate ImportColumn column(Import imp, int pos) {\n-\t\tImportColumn col = new ImportColumn();\n-\t\tcol.setName(String.format(\"@column%02d\", pos));\n-\t\tcol.setParent(imp);\n-\t\tcol.setPosition(pos);\n-\t\treturn col;\n-\t}\n-\n-\t@ParameterizedTest(name = \"{0}\")\n-\t@MethodSource(\"createRandomContent\")\n-\tpublic void testSerialization(int numberOfValues, List<Object[]> arrays)\n-\t\t\tthrows ClassNotFoundException, IllegalAccessException, IllegalArgumentException, InvocationTargetException, IOException, NoSuchMethodException, SecurityException, JSONException {\n-\t\tList<Object[]> originalArrays = new ArrayList<>(arrays);\n-\t\toriginalArrays.replaceAll(v -> Arrays.copyOf(v, v.length));\n-\n-\t\tBucket bucket = generateBucket(arrays);\n-\t\tfor (int i = 0; i < arrays.size(); i++) {\n-\t\t\tfor (int c = 0; c < arrays.get(i).length; c++) {\n-\t\t\t\tColumn fake = new Column();\n-\t\t\t\tfake.setPosition(c);\n-\n-\t\t\t\tObject orig = originalArrays.get(i)[c];\n-\t\t\t\tString message = \"checking \" + c + \" \" + bucket.getImp().getColumns()[c].getType() + \":\" + i + \" = \" + orig;\n-\n-\t\t\t\tif (orig == null) {\n-\t\t\t\t\tassertThat(bucket.has(i, fake))\n-\t\t\t\t\t\t\t.as(message)\n-\t\t\t\t\t\t\t.isFalse();\n-\t\t\t\t}\n-\t\t\t\telse {\n-\t\t\t\t\tImportColumn impCol = bucket.getImp().getColumns()[c];\n-\t\t\t\t\tassertThat(bucket.has(i, fake))\n-\t\t\t\t\t\t\t.as(message + \" is not null\")\n-\t\t\t\t\t\t\t.isTrue();\n-\n-\t\t\t\t\tif (orig instanceof BigDecimal) {\n-\t\t\t\t\t\tassertThat((BigDecimal) bucket.getAsObject(i, fake))\n-\t\t\t\t\t\t\t\t.as(message)\n-\t\t\t\t\t\t\t\t.usingComparator(BigDecimal::compareTo)\n-\t\t\t\t\t\t\t\t.isEqualTo(orig);\n-\t\t\t\t\t}\n-\t\t\t\t\telse if (impCol.getType().getTypeId() == MajorTypeId.STRING) {\n-\t\t\t\t\t\tassertThat(((AStringType<?>) impCol.getType()).getElement(bucket.getString(i, fake)))\n-\t\t\t\t\t\t\t\t.as(message)\n-\t\t\t\t\t\t\t\t.isEqualTo(orig);\n-\t\t\t\t\t}\n-\t\t\t\t\telse if (impCol.getType().getTypeId() == MajorTypeId.REAL) {\n-\t\t\t\t\t\tassertThat(bucket.getReal(i, fake))\n-\t\t\t\t\t\t\t\t.as(message)\n-\t\t\t\t\t\t\t\t.isCloseTo((Double) orig, Offset.offset(requiredPrecision));\n-\t\t\t\t\t}\n-\t\t\t\t\telse {\n-\t\t\t\t\t\tassertThat(bucket.getAsObject(i, fake))\n-\t\t\t\t\t\t\t\t.as(message)\n-\t\t\t\t\t\t\t\t.isEqualTo(orig);\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\n-\t\t\t}\n-\t\t\tbucket.calculateMap(i, bucket.getImp());\n-\t\t}\n-\t\tCentralRegistry registry = new CentralRegistry();\n-\t\tregistry.register(bucket.getImp());\n-\n-\t\tSerializationTestUtil\n-\t\t\t\t.forType(Bucket.class)\n-\t\t\t\t.registry(registry)\n-\t\t\t\t.test(bucket);\n-\t}\n-}\n+//package com.bakdata.conquery.models.events.generation;", "originalCommit": "fdf3b6dffe93f7eae60e7c2efcc4714fa90e2654", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzMyOTM5NA==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r533329394", "bodyText": "gel\u00f6scht", "author": "awildturtok", "createdAt": "2020-12-01T11:14:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjI2Nzc0Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzMyOTUxNg==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r533329516", "bodyText": "Daf\u00fcr schulde ich dir jetzt ParserTests", "author": "awildturtok", "createdAt": "2020-12-01T11:14:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjI2Nzc0Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjI2ODIxMQ==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r526268211", "bodyText": "Achtung aus kommentiert", "author": "thoniTUB", "createdAt": "2020-11-18T17:22:59Z", "path": "backend/src/test/java/com/bakdata/conquery/models/types/SerializationTest.java", "diffHunk": "@@ -1,96 +1,96 @@\n-package com.bakdata.conquery.models.types;\n-\n-import static org.assertj.core.api.Assertions.assertThat;\n-\n-import java.io.IOException;\n-import java.util.Arrays;\n-import java.util.List;\n-import java.util.Set;\n-import java.util.stream.Collectors;\n-\n-import com.bakdata.conquery.io.cps.CPSTypeIdResolver;\n-import com.bakdata.conquery.io.jackson.serializer.SerializationTestUtil;\n-import com.bakdata.conquery.models.common.Range.IntegerRange;\n-import com.bakdata.conquery.models.dictionary.Dictionary;\n-import com.bakdata.conquery.models.exceptions.JSONException;\n-import com.bakdata.conquery.models.types.specific.BooleanTypeBoolean;\n-import com.bakdata.conquery.models.types.specific.DateRangeTypeDateRange;\n-import com.bakdata.conquery.models.types.specific.DateRangeTypePacked;\n-import com.bakdata.conquery.models.types.specific.DateRangeTypeQuarter;\n-import com.bakdata.conquery.models.types.specific.DateTypeVarInt;\n-import com.bakdata.conquery.models.types.specific.DecimalTypeBigDecimal;\n-import com.bakdata.conquery.models.types.specific.DecimalTypeScaled;\n-import com.bakdata.conquery.models.types.specific.IntegerTypeLong;\n-import com.bakdata.conquery.models.types.specific.IntegerTypeVarInt;\n-import com.bakdata.conquery.models.types.specific.MoneyTypeLong;\n-import com.bakdata.conquery.models.types.specific.MoneyTypeVarInt;\n-import com.bakdata.conquery.models.types.specific.RealTypeDouble;\n-import com.bakdata.conquery.models.types.specific.RealTypeFloat;\n-import com.bakdata.conquery.models.types.specific.StringTypeDictionary;\n-import com.bakdata.conquery.models.types.specific.StringTypeEncoded;\n-import com.bakdata.conquery.models.types.specific.StringTypeEncoded.Encoding;\n-import com.bakdata.conquery.models.types.specific.StringTypeNumber;\n-import com.bakdata.conquery.models.types.specific.StringTypePrefix;\n-import com.bakdata.conquery.models.types.specific.StringTypeSingleton;\n-import com.bakdata.conquery.models.types.specific.StringTypeSuffix;\n-import com.bakdata.conquery.models.types.specific.VarIntTypeByte;\n-import com.bakdata.conquery.models.types.specific.VarIntTypeInt;\n-import com.bakdata.conquery.models.types.specific.VarIntTypeShort;\n-import com.fasterxml.jackson.core.JsonParseException;\n-import com.fasterxml.jackson.core.JsonProcessingException;\n-import com.fasterxml.jackson.databind.JsonMappingException;\n-import org.junit.jupiter.api.Test;\n-import org.junit.jupiter.params.ParameterizedTest;\n-import org.junit.jupiter.params.provider.MethodSource;\n-\n-public class SerializationTest {\n-\n-\tpublic static List<CType<?,?>> createCTypes() {\n-\t\treturn Arrays.asList(\n-\t\t\tnew DecimalTypeScaled(13, new IntegerTypeLong(-1,1)),\n-\t\t\tnew IntegerTypeVarInt(new VarIntTypeInt(-1, +1)),\n-\t\t\tnew MoneyTypeLong(),\n-\t\t\tnew DecimalTypeBigDecimal(),\n-\t\t\tnew BooleanTypeBoolean(),\n-\t\t\tnew MoneyTypeVarInt(new VarIntTypeInt(-1, +1)),\n-\t\t\tnew RealTypeDouble(),\n-\t\t\tnew DateTypeVarInt(new VarIntTypeInt(-1, +1)),\n-\t\t\tnew StringTypeDictionary(new VarIntTypeInt(-1, +1)),\n-\t\t\tnew StringTypeEncoded(new StringTypeDictionary(new VarIntTypeInt(-1, +1)),Encoding.Base16LowerCase),\n-\t\t\tnew StringTypePrefix(new StringTypeEncoded(new StringTypeDictionary(new VarIntTypeInt(-1, +1)),Encoding.Base16LowerCase), \"a\"),\n-\t\t\tnew StringTypeSuffix(new StringTypeEncoded(new StringTypeDictionary(new VarIntTypeInt(-1, +1)),Encoding.Base16LowerCase), \"a\"),\n-\t\t\tnew StringTypeNumber(new IntegerRange(0,7), new VarIntTypeInt(0, 7)),\n-\t\t\tnew StringTypeSingleton(\"a\"),\n-\t\t\tnew IntegerTypeLong(-1,+1),\n-\t\t\tnew DateRangeTypeDateRange(),\n-\t\t\tnew DateRangeTypeQuarter(),\n-\t\t\tnew DateRangeTypePacked(),\n-\t\t\tnew DateTypeVarInt(new VarIntTypeInt(-1, +1)),\n-\t\t\tnew VarIntTypeInt(-1, +1),\n-\t\t\tnew VarIntTypeByte((byte)-1, (byte)+1),\n-\t\t\tnew VarIntTypeShort((short)-1, (short)+1),\n-\t\t\tnew RealTypeFloat()\n-\t\t);\n-\t}\n-\t\n-\t@Test @SuppressWarnings({ \"unchecked\", \"rawtypes\" })\n-\tpublic void testAllTypesCovered() {\n-\t\tassertThat(\n-\t\t\tcreateCTypes()\n-\t\t\t\t.stream()\n-\t\t\t\t.map(Object::getClass)\n-\t\t\t\t.collect(Collectors.toSet())\n-\t\t)\n-\t\t.containsAll(\n-\t\t\t(Set)CPSTypeIdResolver.listImplementations(CType.class)\n-\t\t);\n-\t}\n-\n-\t@ParameterizedTest @MethodSource(\"createCTypes\")\n-\tpublic void testSerialization(CType<?,?> type) throws JsonParseException, JsonMappingException, JsonProcessingException, IOException, JSONException {\n-\t\tSerializationTestUtil\n-\t\t\t.forType(CType.class)\n-\t\t\t.ignoreClasses(Arrays.asList(Dictionary.class))\n-\t\t\t.test(type);\n-\t}\n-}\n+//package com.bakdata.conquery.models.types;", "originalCommit": "fdf3b6dffe93f7eae60e7c2efcc4714fa90e2654", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzMzODk4MA==", "url": "https://github.com/bakdata/conquery/pull/1431#discussion_r533338980", "bodyText": "wieder drin", "author": "awildturtok", "createdAt": "2020-12-01T11:30:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjI2ODIxMQ=="}], "type": "inlineReview"}, {"oid": "fa1172fe9dd5e2a69d8a0ac3933d82a57e5380ba", "url": "https://github.com/bakdata/conquery/commit/fa1172fe9dd5e2a69d8a0ac3933d82a57e5380ba", "message": "remove columnDescription from MajorTypeId ctor and instead use the names of the columns instead", "committedDate": "2020-11-19T09:57:19Z", "type": "commit"}, {"oid": "b307437d50e8efe6002b7afea23df73bd18e618e", "url": "https://github.com/bakdata/conquery/commit/b307437d50e8efe6002b7afea23df73bd18e618e", "message": "remove more unused code", "committedDate": "2020-11-19T10:01:10Z", "type": "commit"}, {"oid": "c49e480b397143d6b337f7ea0fba626e67bf14c1", "url": "https://github.com/bakdata/conquery/commit/c49e480b397143d6b337f7ea0fba626e67bf14c1", "message": "remove unused Type from primaryColumn", "committedDate": "2020-11-19T10:05:26Z", "type": "commit"}, {"oid": "99372eb3c9944d488cce7e91e0d48f3b4189d7cf", "url": "https://github.com/bakdata/conquery/commit/99372eb3c9944d488cce7e91e0d48f3b4189d7cf", "message": "Decimate DirectDictionary.java, removing StringType extension as that did nothing but confuse", "committedDate": "2020-11-20T15:22:02Z", "type": "commit"}, {"oid": "85c26894f9a33d9b2a2a17e24038d45f21c10d23", "url": "https://github.com/bakdata/conquery/commit/85c26894f9a33d9b2a2a17e24038d45f21c10d23", "message": "Copy-Constructor for efficient memory representation", "committedDate": "2020-11-20T15:29:01Z", "type": "commit"}, {"oid": "1a39be0511b2e9972bc565ee3b11ca59c40585bc", "url": "https://github.com/bakdata/conquery/commit/1a39be0511b2e9972bc565ee3b11ca59c40585bc", "message": "remove createForPreprocessing method and usage of ImportColumn in Preprocessed", "committedDate": "2020-11-20T16:10:47Z", "type": "commit"}, {"oid": "bd6f1a06fc0d8fe8e63a8a4c237518ca30b462f9", "url": "https://github.com/bakdata/conquery/commit/bd6f1a06fc0d8fe8e63a8a4c237518ca30b462f9", "message": "add todo for big refactoring", "committedDate": "2020-11-20T16:13:46Z", "type": "commit"}, {"oid": "6e26daa668cc754d0246d0047b8a70169a27bd2d", "url": "https://github.com/bakdata/conquery/commit/6e26daa668cc754d0246d0047b8a70169a27bd2d", "message": "rip out primaryColumn as actual column, use StringParser and dictionary instead", "committedDate": "2020-11-20T17:11:40Z", "type": "commit"}, {"oid": "db45338246c2199435fc9cbae83666f9bfd2d38e", "url": "https://github.com/bakdata/conquery/commit/db45338246c2199435fc9cbae83666f9bfd2d38e", "message": "wip", "committedDate": "2020-11-23T08:35:26Z", "type": "commit"}, {"oid": "c44d0f2a229748a380aff8027dda17e4c389df2b", "url": "https://github.com/bakdata/conquery/commit/c44d0f2a229748a380aff8027dda17e4c389df2b", "message": "Apply Type change to DateStore", "committedDate": "2020-11-25T12:08:12Z", "type": "commit"}, {"oid": "19c1c432e00e6e47262da437f0a379e505721b55", "url": "https://github.com/bakdata/conquery/commit/19c1c432e00e6e47262da437f0a379e505721b55", "message": "Implement empty Store", "committedDate": "2020-11-25T12:13:04Z", "type": "commit"}, {"oid": "33cf026865d0fcf1059ddd7ea16397c5b87d0052", "url": "https://github.com/bakdata/conquery/commit/33cf026865d0fcf1059ddd7ea16397c5b87d0052", "message": "Change test logging to Debug", "committedDate": "2020-11-25T12:13:32Z", "type": "commit"}, {"oid": "0ec7ae81706ed826792bbd7179c69d51c9c496cc", "url": "https://github.com/bakdata/conquery/commit/0ec7ae81706ed826792bbd7179c69d51c9c496cc", "message": "don't send PrimaryDictionary to workers", "committedDate": "2020-11-25T12:14:53Z", "type": "commit"}, {"oid": "e5ead6a2f55a2b0f44ac8e57e4e96bfdc4886809", "url": "https://github.com/bakdata/conquery/commit/e5ead6a2f55a2b0f44ac8e57e4e96bfdc4886809", "message": "cleanup bucket selection into separate method", "committedDate": "2020-11-25T12:21:30Z", "type": "commit"}, {"oid": "e3476950af9fe48240f063ca370c30cf9377b1b1", "url": "https://github.com/bakdata/conquery/commit/e3476950af9fe48240f063ca370c30cf9377b1b1", "message": "fit DateTypeVarInt into only upperMost-Type scheme", "committedDate": "2020-11-25T13:07:03Z", "type": "commit"}, {"oid": "1e2670401bbb960c2ffb986c693ef3af0c5f8907", "url": "https://github.com/bakdata/conquery/commit/1e2670401bbb960c2ffb986c693ef3af0c5f8907", "message": "Cleanup passing down of null values to subParser", "committedDate": "2020-11-25T14:12:03Z", "type": "commit"}, {"oid": "2bfe5dc72b449c910960556b0dc1dd24add7c430", "url": "https://github.com/bakdata/conquery/commit/2bfe5dc72b449c910960556b0dc1dd24add7c430", "message": "Add missing TypeId to VarIntType", "committedDate": "2020-11-25T14:19:08Z", "type": "commit"}, {"oid": "9e6d0c96f26ac906afb2638c5d336f739dfefd9e", "url": "https://github.com/bakdata/conquery/commit/9e6d0c96f26ac906afb2638c5d336f739dfefd9e", "message": "remove unused method", "committedDate": "2020-11-25T14:40:45Z", "type": "commit"}, {"oid": "a99eaf083e4b30c4af7768192b0aac767857a186", "url": "https://github.com/bakdata/conquery/commit/a99eaf083e4b30c4af7768192b0aac767857a186", "message": "Migrate DateTypeVarInt.java to DateStore", "committedDate": "2020-11-25T15:01:20Z", "type": "commit"}, {"oid": "609968c7b9fec5b1799518206aa413bafb5eed3a", "url": "https://github.com/bakdata/conquery/commit/609968c7b9fec5b1799518206aa413bafb5eed3a", "message": "Avoid direct usage of IntegerStore, instead use IntegerParser instead", "committedDate": "2020-11-25T15:31:17Z", "type": "commit"}, {"oid": "fbd4217096042336f3f91c2b5144394671a5b08d", "url": "https://github.com/bakdata/conquery/commit/fbd4217096042336f3f91c2b5144394671a5b08d", "message": "Fix BitSet selection and add test", "committedDate": "2020-11-26T10:58:42Z", "type": "commit"}, {"oid": "d9fc3143c670eadaf37f014a80363a6a2b241186", "url": "https://github.com/bakdata/conquery/commit/d9fc3143c670eadaf37f014a80363a6a2b241186", "message": "add (de-)serializer for BitSets", "committedDate": "2020-11-26T11:09:52Z", "type": "commit"}, {"oid": "602b396fc6e7a8dbf612815eaeee86ae986dd6be", "url": "https://github.com/bakdata/conquery/commit/602b396fc6e7a8dbf612815eaeee86ae986dd6be", "message": "move Serializers to proper package", "committedDate": "2020-11-26T11:14:35Z", "type": "commit"}, {"oid": "94a8a96de3fe96a606976a78fba2ac3ef5fbf6a9", "url": "https://github.com/bakdata/conquery/commit/94a8a96de3fe96a606976a78fba2ac3ef5fbf6a9", "message": "fix casting issues with createScriptValue", "committedDate": "2020-11-26T11:44:38Z", "type": "commit"}, {"oid": "b1143881d08ee07587d9353a963d942026588b53", "url": "https://github.com/bakdata/conquery/commit/b1143881d08ee07587d9353a963d942026588b53", "message": "add Rebasing store to further compress Integers", "committedDate": "2020-11-26T13:33:56Z", "type": "commit"}, {"oid": "b46081c097b70f98545af4db344a3ea1953ed964", "url": "https://github.com/bakdata/conquery/commit/b46081c097b70f98545af4db344a3ea1953ed964", "message": "fix a bug when allocating PackedStore", "committedDate": "2020-11-26T15:03:50Z", "type": "commit"}, {"oid": "b98ae932d8f5c8b673d371f6088001305efa8cc6", "url": "https://github.com/bakdata/conquery/commit/b98ae932d8f5c8b673d371f6088001305efa8cc6", "message": "fix using wrong sized store", "committedDate": "2020-11-26T15:05:16Z", "type": "commit"}, {"oid": "84a305c05c140b9c934c1796bb99c2d67f73bcbd", "url": "https://github.com/bakdata/conquery/commit/84a305c05c140b9c934c1796bb99c2d67f73bcbd", "message": "fix usage of PackUnsigned.MAX_VALUE", "committedDate": "2020-11-26T15:11:36Z", "type": "commit"}, {"oid": "9bfce790f01e346fce1b7739ba294692ec4b4061", "url": "https://github.com/bakdata/conquery/commit/9bfce790f01e346fce1b7739ba294692ec4b4061", "message": "final fix for PackedDateRange", "committedDate": "2020-11-26T15:17:10Z", "type": "commit"}]}