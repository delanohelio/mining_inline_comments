{"pr_number": 1139, "pr_title": "Feature/unified result output generation", "pr_createdAt": "2020-04-02T15:06:23Z", "pr_url": "https://github.com/bakdata/conquery/pull/1139", "timeline": [{"oid": "149b6b609c62de4f2c53c2020d4abf7ea4471962", "url": "https://github.com/bakdata/conquery/commit/149b6b609c62de4f2c53c2020d4abf7ea4471962", "message": "returns column description information in the ExecutionStatus API", "committedDate": "2020-02-07T14:44:51Z", "type": "commit"}, {"oid": "5bb08a4fb4d65a674cdf76baeb29c502c109eceb", "url": "https://github.com/bakdata/conquery/commit/5bb08a4fb4d65a674cdf76baeb29c502c109eceb", "message": "Merge branch 'develop' into feature/column-types-in-response-to-frontend", "committedDate": "2020-02-11T14:44:57Z", "type": "commit"}, {"oid": "096be320a7de06ce5fe3b790ca0b0d0830957ee4", "url": "https://github.com/bakdata/conquery/commit/096be320a7de06ce5fe3b790ca0b0d0830957ee4", "message": "also include descriptors for the id columns", "committedDate": "2020-02-12T13:14:45Z", "type": "commit"}, {"oid": "f5ffb9354c3a4a88a5404a380fa3ff9cdf79dec3", "url": "https://github.com/bakdata/conquery/commit/f5ffb9354c3a4a88a5404a380fa3ff9cdf79dec3", "message": "extracts result out put generation into an extra method", "committedDate": "2020-04-01T09:57:44Z", "type": "commit"}, {"oid": "0f575e8cbd19de0e32939e65462bc48a2f1449dc", "url": "https://github.com/bakdata/conquery/commit/0f575e8cbd19de0e32939e65462bc48a2f1449dc", "message": "enables subtypes for proxied forms and permission handling", "committedDate": "2020-04-01T13:51:23Z", "type": "commit"}, {"oid": "f8db6284903803fbd383ac557c16897a3a776205", "url": "https://github.com/bakdata/conquery/commit/f8db6284903803fbd383ac557c16897a3a776205", "message": "refactor download link creation", "committedDate": "2020-04-02T11:02:55Z", "type": "commit"}, {"oid": "116026d13ecbe7a57824e2f3484e753839cd90fc", "url": "https://github.com/bakdata/conquery/commit/116026d13ecbe7a57824e2f3484e753839cd90fc", "message": "injects validator to config object mapper", "committedDate": "2020-04-02T11:04:17Z", "type": "commit"}, {"oid": "527774660db43c965f757c6822b415814d871272", "url": "https://github.com/bakdata/conquery/commit/527774660db43c965f757c6822b415814d871272", "message": "fixes serdes problem", "committedDate": "2020-04-02T15:42:36Z", "type": "commit"}, {"oid": "54f67cd7d45d888ad641c3520fd67aacf7fec17e", "url": "https://github.com/bakdata/conquery/commit/54f67cd7d45d888ad641c3520fd67aacf7fec17e", "message": "Merge branch 'develop' into feature/column-types-in-response-to-frontend\n\n# Conflicts:\n#\tbackend/src/main/java/com/bakdata/conquery/ConqueryConstants.java\n#\tbackend/src/main/java/com/bakdata/conquery/models/config/ColumnNamerValidator.java\n#\tbackend/src/main/java/com/bakdata/conquery/models/execution/ExecutionStatus.java\n#\tbackend/src/main/java/com/bakdata/conquery/models/query/ManagedQuery.java", "committedDate": "2020-04-16T13:13:50Z", "type": "commit"}, {"oid": "d70654c4da93f8eea05ba959e927bbce5131b976", "url": "https://github.com/bakdata/conquery/commit/d70654c4da93f8eea05ba959e927bbce5131b976", "message": "Merge branch 'develop' into feature/column-types-in-response-to-frontend", "committedDate": "2020-04-16T13:17:58Z", "type": "commit"}, {"oid": "83181e48797fb5aace51932eeff78523ee4e4b0f", "url": "https://github.com/bakdata/conquery/commit/83181e48797fb5aace51932eeff78523ee4e4b0f", "message": "Merge d70654c4da93f8eea05ba959e927bbce5131b976 into 4d1c38f57c97f4838ec08a6ffa976c9623601e1a", "committedDate": "2020-04-16T13:18:02Z", "type": "commit"}, {"oid": "e9bc50c320e6749f680ab74b20116ac76a781bf3", "url": "https://github.com/bakdata/conquery/commit/e9bc50c320e6749f680ab74b20116ac76a781bf3", "message": "automatic update to docs", "committedDate": "2020-04-16T13:20:05Z", "type": "commit"}, {"oid": "23c3e2ad5063e30fa3af956066b9cc956b98a221", "url": "https://github.com/bakdata/conquery/commit/23c3e2ad5063e30fa3af956066b9cc956b98a221", "message": "Merge branch 'develop' into feature/unified-result-output-generation\n\n# Conflicts:\n#\tbackend/src/main/java/com/bakdata/conquery/tasks/QueryCleanupTask.java\n#\tfrontend/lib/js/external-forms/config-types.js", "committedDate": "2020-04-16T13:22:02Z", "type": "commit"}, {"oid": "86300b754a9b1ea1cdf79bc9bc5e68250f093565", "url": "https://github.com/bakdata/conquery/commit/86300b754a9b1ea1cdf79bc9bc5e68250f093565", "message": "fix deletion of wrong result info", "committedDate": "2020-04-16T13:56:58Z", "type": "commit"}, {"oid": "ba25c871eee454d1e4758c0310421aec0fe967c3", "url": "https://github.com/bakdata/conquery/commit/ba25c871eee454d1e4758c0310421aec0fe967c3", "message": "Merge 86300b754a9b1ea1cdf79bc9bc5e68250f093565 into 4d1c38f57c97f4838ec08a6ffa976c9623601e1a", "committedDate": "2020-04-16T13:57:08Z", "type": "commit"}, {"oid": "30d2324cf3e0a0d30f4cd08ce33d6aa15c1224a4", "url": "https://github.com/bakdata/conquery/commit/30d2324cf3e0a0d30f4cd08ce33d6aa15c1224a4", "message": "Merge branch 'develop' into feature/unified-result-output-generation\n\n# Conflicts:\n#\tbackend/src/main/java/com/bakdata/conquery/models/execution/ManagedExecution.java", "committedDate": "2020-04-16T13:58:29Z", "type": "commit"}, {"oid": "9e0b1d803d338cbc5248de6b362046c00bfc9f71", "url": "https://github.com/bakdata/conquery/commit/9e0b1d803d338cbc5248de6b362046c00bfc9f71", "message": "automatic update to docs", "committedDate": "2020-04-16T13:58:53Z", "type": "commit"}, {"oid": "89a798d60452339f45ee113a5b4dbd5d30cd06b4", "url": "https://github.com/bakdata/conquery/commit/89a798d60452339f45ee113a5b4dbd5d30cd06b4", "message": "fixes compile error", "committedDate": "2020-04-16T14:43:16Z", "type": "commit"}, {"oid": "c35fb9066aeeafd40592996e3479cd077e851dfe", "url": "https://github.com/bakdata/conquery/commit/c35fb9066aeeafd40592996e3479cd077e851dfe", "message": "adds fieldnames to Execution status for testing purposes", "committedDate": "2020-04-16T14:43:44Z", "type": "commit"}, {"oid": "b54074135ee5318988ab848e7b2a079770a3576e", "url": "https://github.com/bakdata/conquery/commit/b54074135ee5318988ab848e7b2a079770a3576e", "message": "defines the response of the post query to CREATED (201)", "committedDate": "2020-04-16T14:44:30Z", "type": "commit"}, {"oid": "864ee560e4d1f5ec5994c3e6a8c01869604a41bc", "url": "https://github.com/bakdata/conquery/commit/864ee560e4d1f5ec5994c3e6a8c01869604a41bc", "message": "Merge b54074135ee5318988ab848e7b2a079770a3576e into 4d1c38f57c97f4838ec08a6ffa976c9623601e1a", "committedDate": "2020-04-16T14:44:49Z", "type": "commit"}, {"oid": "1e339b00f2190ed3a866f4b549fb096ecf4be5e4", "url": "https://github.com/bakdata/conquery/commit/1e339b00f2190ed3a866f4b549fb096ecf4be5e4", "message": "automatic update to docs", "committedDate": "2020-04-16T14:46:48Z", "type": "commit"}, {"oid": "13266fb0dea5418f330c116397b2a8372c2ad630", "url": "https://github.com/bakdata/conquery/commit/13266fb0dea5418f330c116397b2a8372c2ad630", "message": "Merge branch 'feature/column-types-in-response-to-frontend' into feature/unified-result-output-generation", "committedDate": "2020-04-16T14:48:23Z", "type": "commit"}, {"oid": "6df0f9fae005de2227b2cc7f520f97575978bef0", "url": "https://github.com/bakdata/conquery/commit/6df0f9fae005de2227b2cc7f520f97575978bef0", "message": "Merge branch 'feature/unified-result-output-generation' of https://github.com/bakdata/conquery into feature/unified-result-output-generation\n\n# Conflicts:\n#\tdocs/REST API JSONs.md", "committedDate": "2020-04-16T15:02:46Z", "type": "commit"}, {"oid": "883c4db9304b30b881f224f76030abc554ce1a46", "url": "https://github.com/bakdata/conquery/commit/883c4db9304b30b881f224f76030abc554ce1a46", "message": "Merge 6df0f9fae005de2227b2cc7f520f97575978bef0 into 4d1c38f57c97f4838ec08a6ffa976c9623601e1a", "committedDate": "2020-04-16T15:03:00Z", "type": "commit"}, {"oid": "b2c3603664ed56719e3f52c7ff74cae59f4c13db", "url": "https://github.com/bakdata/conquery/commit/b2c3603664ed56719e3f52c7ff74cae59f4c13db", "message": "automatic update to docs", "committedDate": "2020-04-16T15:04:58Z", "type": "commit"}, {"oid": "fefe4eb1d9fb8a014e98795728253eb4b105708c", "url": "https://github.com/bakdata/conquery/commit/fefe4eb1d9fb8a014e98795728253eb4b105708c", "message": "Enable ColumnDescription in status for forms that consitst of a single subquery", "committedDate": "2020-04-20T14:13:23Z", "type": "commit"}, {"oid": "0bee01adfc41e387f9af49716b1e465fb92f0a9d", "url": "https://github.com/bakdata/conquery/commit/0bee01adfc41e387f9af49716b1e465fb92f0a9d", "message": "Merge branch 'develop' into feature/unified-result-output-generation", "committedDate": "2020-04-29T14:06:50Z", "type": "commit"}, {"oid": "7554b5f8beba1cc11795e5dfd5a2b6f1561a42a2", "url": "https://github.com/bakdata/conquery/commit/7554b5f8beba1cc11795e5dfd5a2b6f1561a42a2", "message": "names executions status sub class", "committedDate": "2020-04-29T15:39:16Z", "type": "commit"}, {"oid": "3f7daf1a7334aad07d4c4c7b2a290a65c61ddbd3", "url": "https://github.com/bakdata/conquery/commit/3f7daf1a7334aad07d4c4c7b2a290a65c61ddbd3", "message": "return url instead of string as download link", "committedDate": "2020-04-29T15:41:00Z", "type": "commit"}, {"oid": "4c5eb36e7015f3b2c5081d5b666bfbd515db78b7", "url": "https://github.com/bakdata/conquery/commit/4c5eb36e7015f3b2c5081d5b666bfbd515db78b7", "message": "clean up result info", "committedDate": "2020-04-29T15:59:06Z", "type": "commit"}, {"oid": "25e67335c1c25ee0ed20daa09775d7740b00f325", "url": "https://github.com/bakdata/conquery/commit/25e67335c1c25ee0ed20daa09775d7740b00f325", "message": "SimpleResultInfo cleanup", "committedDate": "2020-04-29T16:00:29Z", "type": "commit"}, {"oid": "6504835f7e53c35f985d5a0528133b97dd507bf3", "url": "https://github.com/bakdata/conquery/commit/6504835f7e53c35f985d5a0528133b97dd507bf3", "message": "Merge 25e67335c1c25ee0ed20daa09775d7740b00f325 into d80368c1e0fa3665f5b044a84fd7406cf815c0d5", "committedDate": "2020-04-29T16:00:38Z", "type": "commit"}, {"oid": "4cb8ab0ecdf14ad915d447422ecaef0a9e8bb224", "url": "https://github.com/bakdata/conquery/commit/4cb8ab0ecdf14ad915d447422ecaef0a9e8bb224", "message": "automatic update to docs", "committedDate": "2020-04-29T16:02:17Z", "type": "commit"}, {"oid": "1b48a72c2654326b7cd65d0866d46fe63db6518b", "url": "https://github.com/bakdata/conquery/commit/1b48a72c2654326b7cd65d0866d46fe63db6518b", "message": "refactor form processor so that new providers can be easily added", "committedDate": "2020-04-30T10:10:12Z", "type": "commit"}, {"oid": "76bedbe43a2a43b696f89f2082fe80c104f6ee31", "url": "https://github.com/bakdata/conquery/commit/76bedbe43a2a43b696f89f2082fe80c104f6ee31", "message": "Merge branch 'feature/unified-result-output-generation' of https://github.com/bakdata/conquery into feature/unified-result-output-generation", "committedDate": "2020-04-30T10:10:23Z", "type": "commit"}, {"oid": "ddf95d363cfd0eefbd35d6c9b1c08e9ddaf6638a", "url": "https://github.com/bakdata/conquery/commit/ddf95d363cfd0eefbd35d6c9b1c08e9ddaf6638a", "message": "More docu", "committedDate": "2020-04-30T10:19:07Z", "type": "commit"}, {"oid": "61c6fe4f537fd309f412189269a3e75390b0eaf9", "url": "https://github.com/bakdata/conquery/commit/61c6fe4f537fd309f412189269a3e75390b0eaf9", "message": "refactor result generation", "committedDate": "2020-04-30T11:27:13Z", "type": "commit"}, {"oid": "b2f4f0945356d07f07d2d9f4c629563e510fbc3d", "url": "https://github.com/bakdata/conquery/commit/b2f4f0945356d07f07d2d9f4c629563e510fbc3d", "message": "Merge 61c6fe4f537fd309f412189269a3e75390b0eaf9 into d80368c1e0fa3665f5b044a84fd7406cf815c0d5", "committedDate": "2020-04-30T11:27:36Z", "type": "commit"}, {"oid": "7706ddab2ead83f85963003c5ba1ae49a3dea71e", "url": "https://github.com/bakdata/conquery/commit/7706ddab2ead83f85963003c5ba1ae49a3dea71e", "message": "automatic update to docs", "committedDate": "2020-04-30T11:29:14Z", "type": "commit"}, {"oid": "f8d89ec02967fbc4ab5e0b2b772d5bcca62ff6da", "url": "https://github.com/bakdata/conquery/commit/f8d89ec02967fbc4ab5e0b2b772d5bcca62ff6da", "message": "remove unused class", "committedDate": "2020-04-30T11:30:14Z", "type": "commit"}, {"oid": "4a10a55224c06c895287215b97011dbb82a82971", "url": "https://github.com/bakdata/conquery/commit/4a10a55224c06c895287215b97011dbb82a82971", "message": "Merge branch 'feature/unified-result-output-generation' of https://github.com/bakdata/conquery into feature/unified-result-output-generation", "committedDate": "2020-04-30T11:30:33Z", "type": "commit"}, {"oid": "900bc771286a76c52b5e6d4468fa32d6405e9378", "url": "https://github.com/bakdata/conquery/commit/900bc771286a76c52b5e6d4468fa32d6405e9378", "message": "Allow subtype metadata in frontend form configurations", "committedDate": "2020-05-04T11:34:16Z", "type": "commit"}, {"oid": "2c551fa7865cc999ac9570f77ec12880b1de3eb0", "url": "https://github.com/bakdata/conquery/commit/2c551fa7865cc999ac9570f77ec12880b1de3eb0", "message": "Review changes", "committedDate": "2020-05-04T15:25:31Z", "type": "commit"}, {"oid": "13a55ade41766b1f42621dbd5a2871ccb2e3586d", "url": "https://github.com/bakdata/conquery/commit/13a55ade41766b1f42621dbd5a2871ccb2e3586d", "message": "adds a central authentication realm for self issued tokens that can be requested from everywhere in the application", "committedDate": "2020-05-04T15:26:09Z", "type": "commit"}, {"oid": "41c4f60af40b4b242ccc53ea86a11fb050ae33e4", "url": "https://github.com/bakdata/conquery/commit/41c4f60af40b4b242ccc53ea86a11fb050ae33e4", "message": "removes token authentication from local authentication realm", "committedDate": "2020-05-04T15:26:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQwOTEyNQ==", "url": "https://github.com/bakdata/conquery/pull/1139#discussion_r419409125", "bodyText": "den JSON Validator in die Json Deserialisierung injizieren? Das Xzibit Meme ist hier sehr passend :D", "author": "awildturtok", "createdAt": "2020-05-04T12:47:19Z", "path": "backend/src/main/java/com/bakdata/conquery/Conquery.java", "diffHunk": "@@ -54,6 +56,8 @@ public void initialize(Bootstrap<ConqueryConfig> bootstrap) {\n \t\tbootstrap.addCommand(new PreprocessorCommand());\n \t\tbootstrap.addCommand(new CollectEntitiesCommand());\n \t\tbootstrap.addCommand(new StandaloneCommand(this));\n+\t\t\n+\t\t((MutableInjectableValues)bootstrap.getObjectMapper().getInjectableValues()).add(Validator.class, bootstrap.getValidatorFactory().getValidator());", "originalCommit": "900bc771286a76c52b5e6d4468fa32d6405e9378", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDExMDg4MQ==", "url": "https://github.com/bakdata/conquery/pull/1139#discussion_r420110881", "bodyText": "Ich fand das ganz praktisch f\u00fcr auch f\u00fcr die Zukuft, wenn man andere Factories konfiguriert die Objekte erzeugen die mit input Daten umgehen m\u00fcssen. Dann m\u00fcssen diese Objekte nicht extra ein Initialisierungsmethode bekommen um den Validator zu kriegen.", "author": "thoniTUB", "createdAt": "2020-05-05T13:31:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQwOTEyNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQxMjI1Ng==", "url": "https://github.com/bakdata/conquery/pull/1139#discussion_r419412256", "bodyText": "warum kann der name nicht per default gesetzt sein?", "author": "awildturtok", "createdAt": "2020-05-04T12:52:24Z", "path": "backend/src/main/java/com/bakdata/conquery/models/execution/ManagedExecution.java", "diffHunk": "@@ -109,6 +114,9 @@ public ManagedExecution(UserId owner, DatasetId submittedDataset) {\n \n \t@Override\n \tpublic ManagedExecutionId createId() {\n+\t\tif(queryId == null) {", "originalCommit": "900bc771286a76c52b5e6d4468fa32d6405e9378", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDExMjEyNw==", "url": "https://github.com/bakdata/conquery/pull/1139#discussion_r420112127", "bodyText": "Ich habe das so gemacht, damit wir nicht eine CI-Endlosschleife bekommen, sollte diese Klasse mal zum Autodoc hinzugef\u00fcgt werden.", "author": "thoniTUB", "createdAt": "2020-05-05T13:33:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQxMjI1Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQxNDk1NQ==", "url": "https://github.com/bakdata/conquery/pull/1139#discussion_r419414955", "bodyText": "mdc clear am ende noch?", "author": "awildturtok", "createdAt": "2020-05-04T12:56:51Z", "path": "backend/src/main/java/com/bakdata/conquery/models/execution/ResultProcessor.java", "diffHunk": "@@ -0,0 +1,68 @@\n+package com.bakdata.conquery.models.execution;\n+\n+import static com.bakdata.conquery.models.auth.AuthorizationHelper.authorize;\n+import static com.bakdata.conquery.models.auth.AuthorizationHelper.authorizeDownloadDatasets;\n+\n+import java.nio.charset.Charset;\n+import java.nio.charset.StandardCharsets;\n+import java.util.NoSuchElementException;\n+\n+import javax.ws.rs.WebApplicationException;\n+import javax.ws.rs.core.Response;\n+import javax.ws.rs.core.Response.ResponseBuilder;\n+import javax.ws.rs.core.Response.Status;\n+import javax.ws.rs.core.StreamingOutput;\n+\n+import com.bakdata.conquery.models.auth.entities.User;\n+import com.bakdata.conquery.models.auth.permissions.Ability;\n+import com.bakdata.conquery.models.config.ConqueryConfig;\n+import com.bakdata.conquery.models.i18n.I18n;\n+import com.bakdata.conquery.models.identifiable.ids.specific.DatasetId;\n+import com.bakdata.conquery.models.identifiable.ids.specific.ManagedExecutionId;\n+import com.bakdata.conquery.models.identifiable.mapping.IdMappingState;\n+import com.bakdata.conquery.models.query.PrintSettings;\n+import com.bakdata.conquery.models.worker.Namespaces;\n+import com.bakdata.conquery.util.io.ConqueryMDC;\n+import lombok.extern.slf4j.Slf4j;\n+\n+/**\n+ * Holder for utility methods to obtain an result from an execution.\n+ * Acts as a bridge between HTTP-requests and {@link ManagedExecution}s.\n+ */\n+@Slf4j\n+public class ResultProcessor {\n+\t\n+\tpublic static ResponseBuilder getResult(User user, DatasetId datasetId, ManagedExecutionId queryId, String userAgent, Namespaces namespaces, ConqueryConfig config) {\n+\t\tConqueryMDC.setLocation(user.getName());", "originalCommit": "900bc771286a76c52b5e6d4468fa32d6405e9378", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ2NjQyMg==", "url": "https://github.com/bakdata/conquery/pull/1139#discussion_r419466422", "bodyText": "brauchst du hier beide jacksons?", "author": "awildturtok", "createdAt": "2020-05-04T14:11:33Z", "path": "backend/src/main/java/com/bakdata/conquery/models/forms/frontendconfiguration/FormProcessor.java", "diffHunk": "@@ -0,0 +1,148 @@\n+package com.bakdata.conquery.models.forms.frontendconfiguration;\n+\n+import java.lang.reflect.Modifier;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Map.Entry;\n+import java.util.function.Consumer;\n+\n+import com.bakdata.conquery.apiv1.forms.Form;\n+import com.bakdata.conquery.io.cps.CPSType;\n+import com.bakdata.conquery.io.cps.CPSTypeIdResolver;\n+import com.bakdata.conquery.io.xodus.MasterMetaStorage;\n+import com.bakdata.conquery.models.auth.entities.User;\n+import com.bakdata.conquery.models.auth.permissions.Ability;\n+import com.bakdata.conquery.models.auth.permissions.FormPermission;\n+import com.bakdata.conquery.models.forms.frontendconfiguration.FormFrontendConfigProvider.FormFrontendConfigInformation;\n+import com.bakdata.conquery.util.QueryUtils;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.ObjectReader;\n+import lombok.Getter;\n+import lombok.RequiredArgsConstructor;\n+import lombok.SneakyThrows;\n+import lombok.extern.slf4j.Slf4j;\n+\n+@RequiredArgsConstructor\n+@Getter\n+@Slf4j\n+public class FormProcessor {\n+\n+\tprivate final static String INFO_FORMAT = \"\\t%-20s %-60s %-20s\\n\";\n+\tprivate final static ObjectReader READER = io.dropwizard.jackson.Jackson.newObjectMapper().reader();", "originalCommit": "900bc771286a76c52b5e6d4468fa32d6405e9378", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDEyMTEwMw==", "url": "https://github.com/bakdata/conquery/pull/1139#discussion_r420121103", "bodyText": "Wie meinst du das mit beide Jacksons? Ich hab es jetzt dahin ge\u00e4ndert, dass ich eine Kopie von dem ConqueryJackson mache", "author": "thoniTUB", "createdAt": "2020-05-05T13:45:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ2NjQyMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ2NzY2OQ==", "url": "https://github.com/bakdata/conquery/pull/1139#discussion_r419467669", "bodyText": "kannst du das trennen in den scanner und die Processor Methoden f\u00fcr die Ressource?", "author": "awildturtok", "createdAt": "2020-05-04T14:13:24Z", "path": "backend/src/main/java/com/bakdata/conquery/models/forms/frontendconfiguration/FormProcessor.java", "diffHunk": "@@ -0,0 +1,148 @@\n+package com.bakdata.conquery.models.forms.frontendconfiguration;\n+\n+import java.lang.reflect.Modifier;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Map.Entry;\n+import java.util.function.Consumer;\n+\n+import com.bakdata.conquery.apiv1.forms.Form;\n+import com.bakdata.conquery.io.cps.CPSType;\n+import com.bakdata.conquery.io.cps.CPSTypeIdResolver;\n+import com.bakdata.conquery.io.xodus.MasterMetaStorage;\n+import com.bakdata.conquery.models.auth.entities.User;\n+import com.bakdata.conquery.models.auth.permissions.Ability;\n+import com.bakdata.conquery.models.auth.permissions.FormPermission;\n+import com.bakdata.conquery.models.forms.frontendconfiguration.FormFrontendConfigProvider.FormFrontendConfigInformation;\n+import com.bakdata.conquery.util.QueryUtils;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.ObjectReader;\n+import lombok.Getter;\n+import lombok.RequiredArgsConstructor;\n+import lombok.SneakyThrows;\n+import lombok.extern.slf4j.Slf4j;\n+\n+@RequiredArgsConstructor\n+@Getter\n+@Slf4j\n+public class FormProcessor {", "originalCommit": "900bc771286a76c52b5e6d4468fa32d6405e9378", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ3NDIyNQ==", "url": "https://github.com/bakdata/conquery/pull/1139#discussion_r419474225", "bodyText": "kannst auch nen StringJoiner draus machen aber kein Makel", "author": "awildturtok", "createdAt": "2020-05-04T14:22:35Z", "path": "backend/src/main/java/com/bakdata/conquery/models/forms/frontendconfiguration/FormProcessor.java", "diffHunk": "@@ -0,0 +1,148 @@\n+package com.bakdata.conquery.models.forms.frontendconfiguration;\n+\n+import java.lang.reflect.Modifier;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Map.Entry;\n+import java.util.function.Consumer;\n+\n+import com.bakdata.conquery.apiv1.forms.Form;\n+import com.bakdata.conquery.io.cps.CPSType;\n+import com.bakdata.conquery.io.cps.CPSTypeIdResolver;\n+import com.bakdata.conquery.io.xodus.MasterMetaStorage;\n+import com.bakdata.conquery.models.auth.entities.User;\n+import com.bakdata.conquery.models.auth.permissions.Ability;\n+import com.bakdata.conquery.models.auth.permissions.FormPermission;\n+import com.bakdata.conquery.models.forms.frontendconfiguration.FormFrontendConfigProvider.FormFrontendConfigInformation;\n+import com.bakdata.conquery.util.QueryUtils;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.ObjectReader;\n+import lombok.Getter;\n+import lombok.RequiredArgsConstructor;\n+import lombok.SneakyThrows;\n+import lombok.extern.slf4j.Slf4j;\n+\n+@RequiredArgsConstructor\n+@Getter\n+@Slf4j\n+public class FormProcessor {\n+\n+\tprivate final static String INFO_FORMAT = \"\\t%-20s %-60s %-20s\\n\";\n+\tprivate final static ObjectReader READER = io.dropwizard.jackson.Jackson.newObjectMapper().reader();\n+\tprivate static final Map<String, JsonNode> FRONTEND_FORM_CONFIGS = generateFEFormConfigMap();\n+\n+\tprivate final MasterMetaStorage storage;\n+\n+\tprivate static Map<String, Class<? extends Form>> findBackendMappingClasses() {\n+\t\t// Gather form implementations first\n+\t\tMap<String, Class<? extends Form>> forms = new HashMap<>();\n+\t\tfor (Class<?> subclass : CPSTypeIdResolver.SCAN_RESULT.getClassesImplementing(Form.class.getName()).loadClasses()) {\n+\t\t\tif (Modifier.isAbstract(subclass.getModifiers())) {\n+\t\t\t\tcontinue;\n+\t\t\t}\n+\t\t\tCPSType anno = subclass.getAnnotation(CPSType.class);\n+\t\t\tif (anno == null) {\n+\t\t\t\tlog.warn(\"Implemented Form {} has no CPSType annotation\", subclass);\n+\t\t\t\tcontinue;\n+\t\t\t}\n+\t\t\tforms.put(anno.id(), (Class<? extends Form>) subclass);\n+\t\t}\n+\t\treturn forms;\n+\t}\n+\n+\t/**\n+\t * Frontend form configurations can be provided from different sources. For\n+\t * these sources a stub of type {@link FormFrontendConfigProviderBase} must be\n+\t * implemented in order to be discovered by this function.\n+\t */\n+\t@SneakyThrows\n+\tprivate static List<FormFrontendConfigInformation> findFrontendFormConfigs() {\n+\t\tList<Class<?>> configProviders = CPSTypeIdResolver.SCAN_RESULT.getClassesImplementing(FormFrontendConfigProvider.class.getName())\n+\t\t\t.loadClasses();\n+\t\t\n+\t\tConsumer<Collection<FormFrontendConfigInformation>> providerChain = QueryUtils.getNoOpEntryPoint();\n+\t\t\n+\t\tfor (Class<?> configProvider : configProviders) {\n+\t\t\tint modifiers = configProvider.getModifiers();\n+\t\t\tif (Modifier.isAbstract(modifiers) || Modifier.isInterface(modifiers)) {\n+\t\t\t\tcontinue;\n+\t\t\t}\n+\t\t\t@SuppressWarnings(\"unchecked\")\n+\t\t\tClass<? extends FormFrontendConfigProvider> formConfigProvider = (Class<? extends FormFrontendConfigProviderBase>) configProvider;\n+\t\t\tConsumer<Collection<FormFrontendConfigInformation>> provider;\n+\t\t\t// Distinguish between interface implementations and implementations of the abstract class \n+\t\t\tif (FormFrontendConfigProviderBase.class.isAssignableFrom(formConfigProvider)) {\n+\t\t\t\tprovider = formConfigProvider.getConstructor(ObjectReader.class).newInstance(READER);\n+\t\t\t}\n+\t\t\telse {\n+\t\t\t\tprovider = formConfigProvider.getConstructor().newInstance();\n+\t\t\t}\n+\t\t\tproviderChain = providerChain.andThen(provider);\n+\t\t}\n+\t\tList<FormFrontendConfigInformation> frontendConfigs = new ArrayList<>();\n+\t\tproviderChain.accept(frontendConfigs);\n+\t\treturn frontendConfigs;\n+\t}\n+\n+\tprivate static Map<String, JsonNode> generateFEFormConfigMap() {\n+\t\tStringBuilder info = new StringBuilder(String.format(\"\\n\" + INFO_FORMAT, \"Form Type\", \"Frontend Config\", \"Backend Class\"));", "originalCommit": "900bc771286a76c52b5e6d4468fa32d6405e9378", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ3Njc1Mg==", "url": "https://github.com/bakdata/conquery/pull/1139#discussion_r419476752", "bodyText": "t ist nicht ein besonders sprechender Name?", "author": "awildturtok", "createdAt": "2020-05-04T14:25:53Z", "path": "backend/src/main/java/com/bakdata/conquery/models/forms/frontendconfiguration/ResourceFormConfigProvider.java", "diffHunk": "@@ -0,0 +1,41 @@\n+package com.bakdata.conquery.models.forms.frontendconfiguration;\n+\n+import java.io.IOException;\n+import java.util.Collection;\n+import java.util.regex.Pattern;\n+\n+import com.bakdata.conquery.io.cps.CPSTypeIdResolver;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.ObjectReader;\n+import io.github.classgraph.Resource;\n+import io.github.classgraph.ResourceList;\n+\n+/**\n+ * Loads form frontend configuration from the bundled resources that are in the class path.\n+ * In order to be found, the configuration file name must end with {@code *.frontend_conf.json}.\n+ */\n+public class ResourceFormConfigProvider extends FormFrontendConfigProviderBase{\n+\t\n+\n+\tpublic ResourceFormConfigProvider(ObjectReader reader) {\n+\t\tsuper(reader);\n+\t}\n+\n+\t@Override\n+\tpublic void accept(Collection<FormFrontendConfigInformation> t) {\n+\t\tResourceList frontendConfigs = CPSTypeIdResolver.SCAN_RESULT\n+\t\t\t.getResourcesMatchingPattern(Pattern.compile(\".*\\\\.frontend_conf\\\\.json\"));\n+\t\t\n+\t\tfor (Resource config : frontendConfigs) {\n+\t\t\ttry {\n+\t\t\t\tJsonNode configTree = reader.readTree(config.open());\n+\t\t\t\tt.add(new FormFrontendConfigInformation(\"Resource \" + config.getPath(), configTree));", "originalCommit": "900bc771286a76c52b5e6d4468fa32d6405e9378", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ3NzU0Nw==", "url": "https://github.com/bakdata/conquery/pull/1139#discussion_r419477547", "bodyText": "sollte es nicht eher form.json oder so sein? Beschreibt das nicht die Formulare vollst\u00e4ndig?", "author": "awildturtok", "createdAt": "2020-05-04T14:26:55Z", "path": "backend/src/main/java/com/bakdata/conquery/models/forms/frontendconfiguration/ResourceFormConfigProvider.java", "diffHunk": "@@ -0,0 +1,41 @@\n+package com.bakdata.conquery.models.forms.frontendconfiguration;\n+\n+import java.io.IOException;\n+import java.util.Collection;\n+import java.util.regex.Pattern;\n+\n+import com.bakdata.conquery.io.cps.CPSTypeIdResolver;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.ObjectReader;\n+import io.github.classgraph.Resource;\n+import io.github.classgraph.ResourceList;\n+\n+/**\n+ * Loads form frontend configuration from the bundled resources that are in the class path.\n+ * In order to be found, the configuration file name must end with {@code *.frontend_conf.json}.", "originalCommit": "900bc771286a76c52b5e6d4468fa32d6405e9378", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDExNTYxNw==", "url": "https://github.com/bakdata/conquery/pull/1139#discussion_r420115617", "bodyText": "Die Dateien werden an sich nur vom Frontend verarbeitet.", "author": "thoniTUB", "createdAt": "2020-05-05T13:38:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ3NzU0Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTg5NzQ4Mg==", "url": "https://github.com/bakdata/conquery/pull/1139#discussion_r419897482", "bodyText": "Das If w\u00fcrde ich umdrehen", "author": "awildturtok", "createdAt": "2020-05-05T06:50:40Z", "path": "backend/src/main/java/com/bakdata/conquery/models/forms/managed/ManagedForm.java", "diffHunk": "@@ -194,4 +198,48 @@ public FormSharedResult getInitializedShardResult(Entry<ManagedExecutionId, Quer\n \tpublic QueryDescription getSubmitted() {\n \t\treturn submittedForm;\n \t}\n+\n+\n+\n+\t@Override\n+\tpublic StreamingOutput getResult(IdMappingState mappingState, PrintSettings settings, Charset charset, String lineSeparator) {\n+\t\tif(subQueries.size() == 1) {", "originalCommit": "2c551fa7865cc999ac9570f77ec12880b1de3eb0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTg5ODE3NA==", "url": "https://github.com/bakdata/conquery/pull/1139#discussion_r419898174", "bodyText": "sehe ich das richtig, dass die columnDescription nur einmal erzeugt wird? Ist das eine aufw\u00e4ndige Berechnung? Ich w\u00fcrde das glaube ich einfach immer on-demand berechnen.", "author": "awildturtok", "createdAt": "2020-05-05T06:52:19Z", "path": "backend/src/main/java/com/bakdata/conquery/models/forms/managed/ManagedForm.java", "diffHunk": "@@ -194,4 +198,48 @@ public FormSharedResult getInitializedShardResult(Entry<ManagedExecutionId, Quer\n \tpublic QueryDescription getSubmitted() {\n \t\treturn submittedForm;\n \t}\n+\n+\n+\n+\t@Override\n+\tpublic StreamingOutput getResult(IdMappingState mappingState, PrintSettings settings, Charset charset, String lineSeparator) {\n+\t\tif(subQueries.size() == 1) {\n+\t\t\t// Get the query, only if there is only one query set in the whole execution\n+\t\t\treturn ResultCSVResource.resultAsStreamingOutput(this.getId(), settings, subQueries.values().iterator().next(), mappingState, charset, lineSeparator);\n+\t\t}\n+\t\tthrow new UnsupportedOperationException(\"Can't return the result query of a multi query form\");\n+\t}\n+\t\n+\t@Override\n+\tprotected void setAdditionalFieldsForStatusWithSource(@NonNull MasterMetaStorage storage, URLBuilder url, User user, WithSingleQuery status) {\n+\t\tsuper.setAdditionalFieldsForStatusWithSource(storage, url, user, status);\n+\t\t// Set the ColumnDescription if the Form only consits of a single subquery\n+\t\tif(subQueries == null) {\n+\t\t\t// If subqueries was not set the Execution was not initialized\n+\t\t\tthis.initExecutable(storage.getNamespaces());\n+\t\t}\n+\t\tif(subQueries.size() != 1) {\n+\t\t\t// The sub-query size might also be zero if the backend just delegates the form further to another backend. Forms with more subqueries are not yet supported\n+\t\t\tlog.trace(\"Column description is not generated for {} ({} from Form {}), because the form does not consits of a single subquery. Subquery size was {}.\", subQueries.size(),\n+\t\t\t\tthis.getClass().getSimpleName(), getId(), getSubmitted().getClass().getSimpleName());\n+\t\t\treturn;\n+\t\t}\n+\t\tList<ManagedQuery> subQuery = subQueries.entrySet().iterator().next().getValue();\n+\t\tif(subQuery.isEmpty()) {\n+\t\t\tlog.warn(\"The {} ({} from Form {}) does not have any subqueries after initialization. Not creating a column description.\",\n+\t\t\t\tthis.getClass().getSimpleName(),\n+\t\t\t\tgetId(),\n+\t\t\t\tgetSubmitted().getClass().getSimpleName());\n+\t\t\treturn;\n+\t\t}\n+\t\tstatus.setColumnDescriptions(subQuery.get(0).generateColumnDescriptions());", "originalCommit": "2c551fa7865cc999ac9570f77ec12880b1de3eb0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDEzMzM3OQ==", "url": "https://github.com/bakdata/conquery/pull/1139#discussion_r420133379", "bodyText": "Kommt immer fresh ;)", "author": "thoniTUB", "createdAt": "2020-05-05T14:02:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTg5ODE3NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTg5ODcxMw==", "url": "https://github.com/bakdata/conquery/pull/1139#discussion_r419898713", "bodyText": "Wo benutzt du openSubSubQueries? Und warum kannst du das nicht live tracken?", "author": "awildturtok", "createdAt": "2020-05-05T06:53:44Z", "path": "backend/src/main/java/com/bakdata/conquery/models/forms/managed/ManagedForm.java", "diffHunk": "@@ -84,23 +97,14 @@ public void initExecutable(@NonNull Namespaces namespaces) {\n \t\tsubQueries = submittedForm.createSubQueries(namespaces, super.getOwner(), super.getDataset());\n \t\tsubQueries.values().stream().flatMap(List::stream).forEach(flatSubQueries::add);\n \t\tflatSubQueries.values().forEach(mq -> mq.initExecutable(namespaces));\n-\t\topenSubQueries = new AtomicInteger(flatSubQueries.values().size());\n \t}\n \t\n \t@Override\n \tpublic void start() {\n+\t\topenSubQueries = new AtomicInteger(flatSubQueries.values().size());", "originalCommit": "2c551fa7865cc999ac9570f77ec12880b1de3eb0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDEzMTUxNw==", "url": "https://github.com/bakdata/conquery/pull/1139#discussion_r420131517", "bodyText": "In ManagedForm#addResult wird der Counter runtergez\u00e4hlt, \u00e4hnlich wie in ManagedQuery.executingThreads.\nWenn ich dort \u00fcber alle Subqueries iterieren w\u00fcrde um zu schauen ob alle beendet sind dann w\u00e4re die Synchronization aufwendiger, damit nicht mehrere Male finish aufgerufen wird.", "author": "thoniTUB", "createdAt": "2020-05-05T13:59:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTg5ODcxMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTM4MzY5Mw==", "url": "https://github.com/bakdata/conquery/pull/1139#discussion_r421383693", "bodyText": "Finde die l\u00f6sung in MQuery auch nicht besonders sch\u00f6n. F\u00e4nde es hier echt sch\u00f6ner die direkt zu z\u00e4hlen, du musst ja eigentlich nur auf openSubQueries synchronisieren und schaub ob es eine unfertige gibt.", "author": "awildturtok", "createdAt": "2020-05-07T09:55:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTg5ODcxMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTQ5MzQ3MQ==", "url": "https://github.com/bakdata/conquery/pull/1139#discussion_r421493471", "bodyText": "Okay, ich teste es mal", "author": "thoniTUB", "createdAt": "2020-05-07T13:14:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTg5ODcxMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTg5OTAyNg==", "url": "https://github.com/bakdata/conquery/pull/1139#discussion_r419899026", "bodyText": "W\u00fcrde hier schon ein Enum verwenden und den Json-Parser das machen lassen, das ist sicherer", "author": "awildturtok", "createdAt": "2020-05-05T06:54:24Z", "path": "backend/src/main/java/com/bakdata/conquery/models/query/ColumnDescriptor.java", "diffHunk": "@@ -0,0 +1,19 @@\n+package com.bakdata.conquery.models.query;\n+\n+import com.bakdata.conquery.models.identifiable.ids.specific.SelectId;\n+import lombok.Builder;\n+import lombok.Getter;\n+\n+/**\n+ * Container class for the query API provide meta data for reach column in the\n+ * csv result. This can be used for the result preview in the frontend.\n+ */\n+@Getter\n+@Builder\n+public class ColumnDescriptor {\n+\n+\tprivate String label;\n+\tprivate String type;", "originalCommit": "2c551fa7865cc999ac9570f77ec12880b1de3eb0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDEzNzM3NQ==", "url": "https://github.com/bakdata/conquery/pull/1139#discussion_r420137375", "bodyText": "Hatte ich erst so, aber du hast mir empfohlen den Typ flach zumachen, damit ich keinen extra member/flag f\u00fcr die ID-Spalten machen muss", "author": "thoniTUB", "createdAt": "2020-05-05T14:07:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTg5OTAyNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTg5OTM4MQ==", "url": "https://github.com/bakdata/conquery/pull/1139#discussion_r419899381", "bodyText": "das ist doch das gleiche wie executingThreads?", "author": "awildturtok", "createdAt": "2020-05-05T06:55:20Z", "path": "backend/src/main/java/com/bakdata/conquery/models/query/ManagedQuery.java", "diffHunk": "@@ -60,8 +72,12 @@\n \t\n \t//we don't want to store or send query results or other result metadata\n \t@JsonIgnore\n+\tprivate transient int involvedWorkers;", "originalCommit": "2c551fa7865cc999ac9570f77ec12880b1de3eb0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDE1MjM5Nw==", "url": "https://github.com/bakdata/conquery/pull/1139#discussion_r420152397", "bodyText": "Ich benutze das als Buffer, der beider Initialisierung der Execution gesetzt wird, und bei der Ausf\u00fchrung in executingThreads \u00fcberf\u00fchrt wird. Ich wollte die Initialisierung idempotent machen. Damit sollte es keine RaceCondition geben, zwischen Initialisierung und Ausf\u00fchrung. In ManagedForm muss ich unter Umst\u00e4nden die Executions/SubExecutions initialisieren bevor ich ColumnDescriptions sammeln kann.", "author": "thoniTUB", "createdAt": "2020-05-05T14:27:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTg5OTM4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTM4Njc0Nw==", "url": "https://github.com/bakdata/conquery/pull/1139#discussion_r421386747", "bodyText": "Theoretisch kann sich das aber \u00e4ndern, zwischen init und ausf\u00fchrung, zB wenn du einen neue slave hochf\u00e4hrst.", "author": "awildturtok", "createdAt": "2020-05-07T10:00:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTg5OTM4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzYxMTEzMw==", "url": "https://github.com/bakdata/conquery/pull/1139#discussion_r423611133", "bodyText": "Ich glaube die L\u00f6sung f\u00fcr das Problem ist aber ein gr\u00f6\u00dferes.", "author": "thoniTUB", "createdAt": "2020-05-12T09:56:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTg5OTM4MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTg5OTYxNA==", "url": "https://github.com/bakdata/conquery/pull/1139#discussion_r419899614", "bodyText": "was genau machst du hier?", "author": "awildturtok", "createdAt": "2020-05-05T06:56:00Z", "path": "backend/src/main/java/com/bakdata/conquery/models/query/ManagedQuery.java", "diffHunk": "@@ -96,6 +112,10 @@ public void addResult(@NonNull MasterMetaStorage storage, ShardResult result) {\n \t@Override\n \tpublic void start() {\n \t\tsuper.start();\n+\t\tsynchronized (getExecution()) {", "originalCommit": "2c551fa7865cc999ac9570f77ec12880b1de3eb0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDE1NDAzNA==", "url": "https://github.com/bakdata/conquery/pull/1139#discussion_r420154034", "bodyText": "Hier wird der initialisierung state in den execution state \u00fcbertragen", "author": "thoniTUB", "createdAt": "2020-05-05T14:29:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTg5OTYxNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTkwMDk4MA==", "url": "https://github.com/bakdata/conquery/pull/1139#discussion_r419900980", "bodyText": "Ich wei\u00df, dass wir h\u00e4ufig List<{key = X, values ...}> verwenden aber macht es hier nicht sinn eine Map zu benutzen?", "author": "awildturtok", "createdAt": "2020-05-05T06:59:41Z", "path": "backend/src/main/java/com/bakdata/conquery/models/query/ManagedQuery.java", "diffHunk": "@@ -121,13 +141,46 @@ public ResultInfoCollector collectResultInfos(PrintSettings config) {\n \t\n \t@Override\n \tprotected void setStatusBase(@NonNull MasterMetaStorage storage, URLBuilder url, @NonNull  User user, @NonNull ExecutionStatus status) {\n+\n \t\tsuper.setStatusBase(storage, url, user, status);\n \t\tstatus.setNumberOfResults(lastResultCount);\n \t}\n \t\n \t@Override\n-\tpublic Collection<ManagedQuery> toResultQuery() {\n-\t\treturn List.of(this);\n+\tprotected void setAdditionalFieldsForStatusWithSource(@NonNull MasterMetaStorage storage, URLBuilder url, User user, WithSingleQuery status) {\n+\t\tif(columnDescriptions == null) {\n+\t\t\tcolumnDescriptions = generateColumnDescriptions();\n+\t\t}\n+\t\t// Set flag if user can expand the query and in that case also the query\n+\t\tsuper.setAdditionalFieldsForStatusWithSource(storage, url, user, status);\n+\t\tif(status.isCanExpand()) {\n+\t\t\t// If the user can expand the query (can use all included concepts), also set the column description\n+\t\t\tstatus.setColumnDescriptions(columnDescriptions);\n+\t\t}\n+\t}\n+\n+\t/**\n+\t * Generates a description of each column that will appear in the resulting csv.\n+\t */\n+\tpublic List<ColumnDescriptor> generateColumnDescriptions() {", "originalCommit": "2c551fa7865cc999ac9570f77ec12880b1de3eb0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTkwMTg1Nw==", "url": "https://github.com/bakdata/conquery/pull/1139#discussion_r419901857", "bodyText": "hm, weil sie sortiert sein m\u00fcssen ist das nat\u00fcrlich schwierig. https://docs.oracle.com/javase/8/docs/api/java/util/LinkedHashMap.html kann das wohl aber nur medium gute l\u00f6sung :/", "author": "awildturtok", "createdAt": "2020-05-05T07:01:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTkwMDk4MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDE1NDc2Mw==", "url": "https://github.com/bakdata/conquery/pull/1139#discussion_r420154763", "bodyText": "Ja das w\u00fcrde im besten Fall auf unserer Serializierungsseite die gew\u00fcnschte Reihenfolge haben, was JS \u00fcber das Objekt iteriert ist explizit nicht gesichert.", "author": "thoniTUB", "createdAt": "2020-05-05T14:30:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTkwMDk4MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTkwNTM2NQ==", "url": "https://github.com/bakdata/conquery/pull/1139#discussion_r419905365", "bodyText": "Wof\u00fcr braucht der Collector nch die Settings?\nUnd warum ist das ein atomic Integer? W\u00fcrde es nicht mehr sinn machen auf der map zu snychronizen?", "author": "awildturtok", "createdAt": "2020-05-05T07:10:44Z", "path": "backend/src/main/java/com/bakdata/conquery/models/query/resultinfo/ResultInfoCollector.java", "diffHunk": "@@ -23,7 +22,7 @@ public void add(SimpleResultInfo info) {\n \t}", "originalCommit": "2c551fa7865cc999ac9570f77ec12880b1de3eb0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDYxNTExMw==", "url": "https://github.com/bakdata/conquery/pull/1139#discussion_r420615113", "bodyText": "Hab ich wegrefactored", "author": "thoniTUB", "createdAt": "2020-05-06T08:11:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTkwNTM2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTkwNjQ1MA==", "url": "https://github.com/bakdata/conquery/pull/1139#discussion_r419906450", "bodyText": "mMn w\u00e4re es hier sinnvoller einen Mapper Optional reinzugeben?", "author": "awildturtok", "createdAt": "2020-05-05T07:13:37Z", "path": "backend/src/main/java/com/bakdata/conquery/util/io/Cloner.java", "diffHunk": "@@ -1,18 +1,29 @@\n package com.bakdata.conquery.util.io;\n \n import java.io.IOException;\n+import java.util.Map;\n+import java.util.Map.Entry;\n \n import com.bakdata.conquery.io.jackson.Injectable;\n import com.bakdata.conquery.io.jackson.Jackson;\n+import com.bakdata.conquery.io.jackson.MutableInjectableValues;\n import com.bakdata.conquery.models.config.ConqueryConfig;\n import com.bakdata.conquery.models.query.IQuery;\n import com.bakdata.conquery.models.query.concept.CQElement;\n import com.bakdata.conquery.models.types.specific.AStringType;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n \n public class Cloner {\n-\tpublic static ConqueryConfig clone(ConqueryConfig config) {\n+\t\n+\tpublic static <T> ConqueryConfig clone(ConqueryConfig config, Map<Class<T> , T > injectables) {\n \t\ttry {\n-\t\t\tConqueryConfig clone = Jackson.BINARY_MAPPER.readValue(\n+\t\t\tObjectMapper mapper = Jackson.BINARY_MAPPER.copy();\n+\t\t\tMutableInjectableValues injectableHolder = ((MutableInjectableValues)Jackson.BINARY_MAPPER.getInjectableValues());", "originalCommit": "2c551fa7865cc999ac9570f77ec12880b1de3eb0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTkwNjc5OQ==", "url": "https://github.com/bakdata/conquery/pull/1139#discussion_r419906799", "bodyText": "Dann kann auch der default via overloading reingegeben werden.", "author": "awildturtok", "createdAt": "2020-05-05T07:14:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTkwNjQ1MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDYxNTQ0Mg==", "url": "https://github.com/bakdata/conquery/pull/1139#discussion_r420615442", "bodyText": "Das schaue ich mir nochmal an", "author": "thoniTUB", "createdAt": "2020-05-06T08:12:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTkwNjQ1MA=="}], "type": "inlineReview"}, {"oid": "646dcfdc665820d8749ae8d87c2cdcb5dc87b843", "url": "https://github.com/bakdata/conquery/commit/646dcfdc665820d8749ae8d87c2cdcb5dc87b843", "message": "clear mdc", "committedDate": "2020-05-05T15:07:55Z", "type": "commit"}, {"oid": "9f80ecd90d6f5d3fbc107505c32fe7895a1b3fa7", "url": "https://github.com/bakdata/conquery/commit/9f80ecd90d6f5d3fbc107505c32fe7895a1b3fa7", "message": "Review changes", "committedDate": "2020-05-05T18:36:16Z", "type": "commit"}, {"oid": "179794102ac5f38c87b975c13d1813b6d034a3ab", "url": "https://github.com/bakdata/conquery/commit/179794102ac5f38c87b975c13d1813b6d034a3ab", "message": "Merge 9f80ecd90d6f5d3fbc107505c32fe7895a1b3fa7 into 31d898012f5a9421a54f86b574ad7b022bfca148", "committedDate": "2020-05-05T18:36:26Z", "type": "commit"}, {"oid": "0a4152013b34e1b3da6b082067df4d076cd7af52", "url": "https://github.com/bakdata/conquery/commit/0a4152013b34e1b3da6b082067df4d076cd7af52", "message": "automatic update to docs", "committedDate": "2020-05-05T18:38:27Z", "type": "commit"}, {"oid": "8294931fe2947c2794cbc09ff3b6c6afcd5e99a1", "url": "https://github.com/bakdata/conquery/commit/8294931fe2947c2794cbc09ff3b6c6afcd5e99a1", "message": "Merge branch 'feature/unified-result-output-generation' into feature/auth-system-improvements", "committedDate": "2020-05-06T06:27:22Z", "type": "commit"}, {"oid": "a5da1703f8ee36543c2fec2c660562cc8832adb4", "url": "https://github.com/bakdata/conquery/commit/a5da1703f8ee36543c2fec2c660562cc8832adb4", "message": "adds missing credentials matcher and registered token type", "committedDate": "2020-05-06T07:32:30Z", "type": "commit"}, {"oid": "5a2a845a713ec7bfddf4f2511cf72612360e80f9", "url": "https://github.com/bakdata/conquery/commit/5a2a845a713ec7bfddf4f2511cf72612360e80f9", "message": "Merge branch 'hotfix/persist-query-patches' into feature/unified-result-output-generation\n\n# Conflicts:\n#\tbackend/src/test/java/com/bakdata/conquery/models/SerializationTests.java", "committedDate": "2020-05-06T11:02:18Z", "type": "commit"}, {"oid": "90a769cb26d480cd0e128069d0d0afdb4db88d66", "url": "https://github.com/bakdata/conquery/commit/90a769cb26d480cd0e128069d0d0afdb4db88d66", "message": "Merge branch 'feature/unified-result-output-generation' into feature/auth-system-improvements", "committedDate": "2020-05-06T11:02:37Z", "type": "commit"}, {"oid": "8a844068b9def54e77bcb6660ff6cb87ba38a354", "url": "https://github.com/bakdata/conquery/commit/8a844068b9def54e77bcb6660ff6cb87ba38a354", "message": "Merge 5a2a845a713ec7bfddf4f2511cf72612360e80f9 into 31d898012f5a9421a54f86b574ad7b022bfca148", "committedDate": "2020-05-06T11:03:09Z", "type": "commit"}, {"oid": "297d2afd77eacd4a400d8f6f55e9c9b8a10b15da", "url": "https://github.com/bakdata/conquery/commit/297d2afd77eacd4a400d8f6f55e9c9b8a10b15da", "message": "automatic update to docs", "committedDate": "2020-05-06T11:05:15Z", "type": "commit"}, {"oid": "1b9481a1210f96a2dd84c17997f4b112faf28721", "url": "https://github.com/bakdata/conquery/commit/1b9481a1210f96a2dd84c17997f4b112faf28721", "message": "remove storage not null restriction on execution fail", "committedDate": "2020-05-06T13:08:38Z", "type": "commit"}, {"oid": "ca1c3fdca64dfda5b74d918e13884bd2a0e5c593", "url": "https://github.com/bakdata/conquery/commit/ca1c3fdca64dfda5b74d918e13884bd2a0e5c593", "message": "cleanup", "committedDate": "2020-05-06T14:09:21Z", "type": "commit"}, {"oid": "dcec62f40e7863964a69102feb5f44dd396c732b", "url": "https://github.com/bakdata/conquery/commit/dcec62f40e7863964a69102feb5f44dd396c732b", "message": "Merge branch 'feature/unified-result-output-generation' into feature/auth-system-improvements", "committedDate": "2020-05-06T14:09:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTM1OTE3Mw==", "url": "https://github.com/bakdata/conquery/pull/1139#discussion_r421359173", "bodyText": "Wie kann es sein, dass der Storage null ist?", "author": "awildturtok", "createdAt": "2020-05-07T09:15:17Z", "path": "backend/src/main/java/com/bakdata/conquery/models/execution/ManagedExecution.java", "diffHunk": "@@ -136,11 +144,15 @@ protected void finish(@NonNull MasterMetaStorage storage, ExecutionState executi\n \n \t\t\t// No need to persist failed queries. (As they are most likely invalid)\n \t\t\tif(getState() == ExecutionState.DONE) {\n+\t\t\t\tif(storage == null) {", "originalCommit": "ca1c3fdca64dfda5b74d918e13884bd2a0e5c593", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTQ5MTEwMQ==", "url": "https://github.com/bakdata/conquery/pull/1139#discussion_r421491101", "bodyText": "Ich hab ihn bei einem Fail auf null gesetzt, da es ja dann so oder so nicht abgespeichert werden w\u00fcrde.", "author": "thoniTUB", "createdAt": "2020-05-07T13:11:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTM1OTE3Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTM4ODMxOQ==", "url": "https://github.com/bakdata/conquery/pull/1139#discussion_r421388319", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t\tpostfix = occurence.getAndIncrement();\n          \n          \n            \n            \t\t\t\tpostfix = ocurrenceCounter.computeIfAbsent(name, str -> new AtomicInteger(0)).getAndIncrement();", "author": "awildturtok", "createdAt": "2020-05-07T10:02:47Z", "path": "backend/src/main/java/com/bakdata/conquery/models/query/resultinfo/ResultInfo.java", "diffHunk": "@@ -2,27 +2,52 @@\n \n package com.bakdata.conquery.models.query.resultinfo;\n \n+import java.util.HashMap;\n+import java.util.concurrent.atomic.AtomicInteger;\n+\n import com.bakdata.conquery.models.externalservice.ResultType;\n import com.bakdata.conquery.models.query.PrintSettings;\n import com.fasterxml.jackson.annotation.JsonIgnore;\n import com.google.common.collect.ClassToInstanceMap;\n import com.google.common.collect.MutableClassToInstanceMap;\n-\n+import lombok.EqualsAndHashCode;\n import lombok.Getter;\n+import lombok.NonNull;\n+import lombok.RequiredArgsConstructor;\n import lombok.Setter;\n import lombok.ToString;\n \n-@Getter @Setter @ToString\n+@Getter @Setter @ToString @EqualsAndHashCode\n+@RequiredArgsConstructor\n public abstract class ResultInfo {\n+\tprivate final static int UNSET_PREFIX = -1;\n \t/**\n \t * Calculated same name index for this column. If 0, the postfix can be omitted.\n \t */\n-\tprivate int postfix;\n+\t@EqualsAndHashCode.Exclude\n+\tprivate int postfix = UNSET_PREFIX;\n+\t\n+\t/**\n+\t * Is injected by the {@link ResultInfoCollector} for {@link SelectResultInfo}s.\n+\t */\n+\t@EqualsAndHashCode.Exclude\n+\tprivate HashMap<String, AtomicInteger> ocurrenceCounter;\n \tprivate ClassToInstanceMap<Object> appendices = MutableClassToInstanceMap.create();\n \t\n+\t@NonNull\n \t@JsonIgnore\n \tpublic final String getUniqueName(PrintSettings settings) {\n-\t\treturn (postfix > 0) ? getName(settings) + \"_\" + postfix : getName(settings);\n+\t\tString name = getName(settings);\n+\t\tif(ocurrenceCounter == null) {\n+\t\t\treturn name;\n+\t\t}\n+\t\tsynchronized (ocurrenceCounter) {\n+\t\t\tif(postfix == UNSET_PREFIX) {\n+\t\t\t\tAtomicInteger occurence = ocurrenceCounter.computeIfAbsent(name, str -> new AtomicInteger(0));\n+\t\t\t\tpostfix = occurence.getAndIncrement();", "originalCommit": "ca1c3fdca64dfda5b74d918e13884bd2a0e5c593", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTM4ODQ3OQ==", "url": "https://github.com/bakdata/conquery/pull/1139#discussion_r421388479", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t\tAtomicInteger occurence = ocurrenceCounter.computeIfAbsent(name, str -> new AtomicInteger(0));", "author": "awildturtok", "createdAt": "2020-05-07T10:03:06Z", "path": "backend/src/main/java/com/bakdata/conquery/models/query/resultinfo/ResultInfo.java", "diffHunk": "@@ -2,27 +2,52 @@\n \n package com.bakdata.conquery.models.query.resultinfo;\n \n+import java.util.HashMap;\n+import java.util.concurrent.atomic.AtomicInteger;\n+\n import com.bakdata.conquery.models.externalservice.ResultType;\n import com.bakdata.conquery.models.query.PrintSettings;\n import com.fasterxml.jackson.annotation.JsonIgnore;\n import com.google.common.collect.ClassToInstanceMap;\n import com.google.common.collect.MutableClassToInstanceMap;\n-\n+import lombok.EqualsAndHashCode;\n import lombok.Getter;\n+import lombok.NonNull;\n+import lombok.RequiredArgsConstructor;\n import lombok.Setter;\n import lombok.ToString;\n \n-@Getter @Setter @ToString\n+@Getter @Setter @ToString @EqualsAndHashCode\n+@RequiredArgsConstructor\n public abstract class ResultInfo {\n+\tprivate final static int UNSET_PREFIX = -1;\n \t/**\n \t * Calculated same name index for this column. If 0, the postfix can be omitted.\n \t */\n-\tprivate int postfix;\n+\t@EqualsAndHashCode.Exclude\n+\tprivate int postfix = UNSET_PREFIX;\n+\t\n+\t/**\n+\t * Is injected by the {@link ResultInfoCollector} for {@link SelectResultInfo}s.\n+\t */\n+\t@EqualsAndHashCode.Exclude\n+\tprivate HashMap<String, AtomicInteger> ocurrenceCounter;\n \tprivate ClassToInstanceMap<Object> appendices = MutableClassToInstanceMap.create();\n \t\n+\t@NonNull\n \t@JsonIgnore\n \tpublic final String getUniqueName(PrintSettings settings) {\n-\t\treturn (postfix > 0) ? getName(settings) + \"_\" + postfix : getName(settings);\n+\t\tString name = getName(settings);\n+\t\tif(ocurrenceCounter == null) {\n+\t\t\treturn name;\n+\t\t}\n+\t\tsynchronized (ocurrenceCounter) {\n+\t\t\tif(postfix == UNSET_PREFIX) {\n+\t\t\t\tAtomicInteger occurence = ocurrenceCounter.computeIfAbsent(name, str -> new AtomicInteger(0));", "originalCommit": "ca1c3fdca64dfda5b74d918e13884bd2a0e5c593", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e2e90855161a95f603f3acd4ebe364026d290c04", "url": "https://github.com/bakdata/conquery/commit/e2e90855161a95f603f3acd4ebe364026d290c04", "message": "uses an extended type id to provide subtype information", "committedDate": "2020-05-07T13:03:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTQ5ODE5Ng==", "url": "https://github.com/bakdata/conquery/pull/1139#discussion_r421498196", "bodyText": "W\u00fcrde ich \u00fcber ein regex l\u00f6sen ^([\\w_]+)(-([\\w_]+))?$", "author": "awildturtok", "createdAt": "2020-05-07T13:21:24Z", "path": "backend/src/main/java/com/bakdata/conquery/io/cps/CPSTypeIdResolver.java", "diffHunk": "@@ -119,13 +127,40 @@ public void init(JavaType baseType) {\n \n \t@Override\n \tpublic JavaType typeFromId(DatabindContext context, String id) {\n-\t\tClass<?> result = cpsMap.getClassFromId(id);\n+\t\tClass<?> result = cpsMap.getClassFromId(truncateSubTypeInformation(id));\n \t\tif(result == null) {\n \t\t\tthrow new IllegalStateException(\"There is no type \"+id+\" for \"+baseType.getTypeName()+\". Try: \"+getDescForKnownTypeIds());\n \t\t}\n-\t\telse {\n-\t\t\treturn TypeFactory.defaultInstance().constructSpecializedType(baseType, result);\n+\t\tString subTypeInfo = extractSubTypeInformation(id);\n+\t\tif(!Strings.isNullOrEmpty(subTypeInfo)) {\n+\t\t\t\n+\t\t\tcontext.setAttribute(ATTRIBUTE_SUB_TYPE, subTypeInfo);\n \t\t}\n+\t\treturn TypeFactory.defaultInstance().constructSpecializedType(baseType, result);\n+\t}\n+\t\n+\tpublic static String truncateSubTypeInformation(@NonNull String fullType) {", "originalCommit": "e2e90855161a95f603f3acd4ebe364026d290c04", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzEzNDU0MQ==", "url": "https://github.com/bakdata/conquery/pull/1139#discussion_r423134541", "bodyText": "Haben uns geeinigt das nicht zu machen", "author": "thoniTUB", "createdAt": "2020-05-11T15:43:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTQ5ODE5Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTQ5ODc5MQ==", "url": "https://github.com/bakdata/conquery/pull/1139#discussion_r421498791", "bodyText": "der doppelte cast ist notwendig?", "author": "awildturtok", "createdAt": "2020-05-07T13:22:14Z", "path": "backend/src/main/java/com/bakdata/conquery/io/cps/CPSTypeIdResolver.java", "diffHunk": "@@ -134,9 +169,7 @@ public JavaType typeFromId(DatabindContext context, String id) {\n \t\t\tlog.warn(\"No implementations for {}\", base);\n \t\t\treturn Collections.emptySet();\n \t\t}\n-\t\telse {\n-\t\t\treturn (Set<Class<? extends T>>)(Set)map.getClasses();\n-\t\t}\n+\t\treturn (Set<Class<? extends T>>)(Set)map.getClasses();", "originalCommit": "e2e90855161a95f603f3acd4ebe364026d290c04", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzEzODE1OA==", "url": "https://github.com/bakdata/conquery/pull/1139#discussion_r423138158", "bodyText": "Weirder Weise ja weil getClasses nicht parametrisiert ist", "author": "thoniTUB", "createdAt": "2020-05-11T15:48:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTQ5ODc5MQ=="}], "type": "inlineReview"}, {"oid": "fc8acf2912d52946e9cc6028fb3bf98e5427bb48", "url": "https://github.com/bakdata/conquery/commit/fc8acf2912d52946e9cc6028fb3bf98e5427bb48", "message": "removes atomic counter", "committedDate": "2020-05-07T14:23:36Z", "type": "commit"}, {"oid": "7051fa0c4343bce24e79253f705909f6ea48589e", "url": "https://github.com/bakdata/conquery/commit/7051fa0c4343bce24e79253f705909f6ea48589e", "message": "changes the id separator", "committedDate": "2020-05-07T14:30:01Z", "type": "commit"}, {"oid": "6cd41643d2b02b0b7d54456ce3b976e1f4e29090", "url": "https://github.com/bakdata/conquery/commit/6cd41643d2b02b0b7d54456ce3b976e1f4e29090", "message": "corrects console output", "committedDate": "2020-05-11T07:15:26Z", "type": "commit"}, {"oid": "da82e6dc7b8aa09b64524fa2da040ea778a9ef1e", "url": "https://github.com/bakdata/conquery/commit/da82e6dc7b8aa09b64524fa2da040ea778a9ef1e", "message": "Merge branch 'feature/unified-result-output-generation' into feature/auth-system-improvements\n\n# Conflicts:\n#\tbackend/src/main/java/com/bakdata/conquery/io/cps/CPSTypeIdResolver.java", "committedDate": "2020-05-11T07:19:45Z", "type": "commit"}, {"oid": "3d5c907966e729c9d54da63ebf60b74f2936a57f", "url": "https://github.com/bakdata/conquery/commit/3d5c907966e729c9d54da63ebf60b74f2936a57f", "message": "Fixes local auth realm test", "committedDate": "2020-05-11T07:35:18Z", "type": "commit"}, {"oid": "ee99bb6e637006986239a7ec87c0195f3d1825a4", "url": "https://github.com/bakdata/conquery/commit/ee99bb6e637006986239a7ec87c0195f3d1825a4", "message": "removes unused class", "committedDate": "2020-05-11T08:00:41Z", "type": "commit"}, {"oid": "d86cd6106be28c9719370df14006e0975dcd2e02", "url": "https://github.com/bakdata/conquery/commit/d86cd6106be28c9719370df14006e0975dcd2e02", "message": "review changes", "committedDate": "2020-05-11T14:27:24Z", "type": "commit"}, {"oid": "3d6d40c8092f07646a0b839b1dfcc4b95ad211df", "url": "https://github.com/bakdata/conquery/commit/3d6d40c8092f07646a0b839b1dfcc4b95ad211df", "message": "fixes wrong getter usage", "committedDate": "2020-05-11T14:35:33Z", "type": "commit"}, {"oid": "4934410ca8a2472b0b5c542b7a1b4a6b463878aa", "url": "https://github.com/bakdata/conquery/commit/4934410ca8a2472b0b5c542b7a1b4a6b463878aa", "message": "further review changes", "committedDate": "2020-05-11T16:39:12Z", "type": "commit"}, {"oid": "aacb2d5bd4993d9646ce376a7d342156926f0462", "url": "https://github.com/bakdata/conquery/commit/aacb2d5bd4993d9646ce376a7d342156926f0462", "message": "adds catch for any exception and log messages", "committedDate": "2020-05-11T16:58:32Z", "type": "commit"}, {"oid": "495b625e0348d40a5e537f9e74c6666ece93dc73", "url": "https://github.com/bakdata/conquery/commit/495b625e0348d40a5e537f9e74c6666ece93dc73", "message": "Merge branch 'release/2.0.0' into feature/auth-system-improvements", "committedDate": "2020-05-12T06:37:09Z", "type": "commit"}, {"oid": "176439b5737f46d05f5cf55869c5b227d0aa27c7", "url": "https://github.com/bakdata/conquery/commit/176439b5737f46d05f5cf55869c5b227d0aa27c7", "message": "fixes import", "committedDate": "2020-05-12T06:47:07Z", "type": "commit"}, {"oid": "fcbef3e2aaeba6ce7944130df20b8ad4152dac4b", "url": "https://github.com/bakdata/conquery/commit/fcbef3e2aaeba6ce7944130df20b8ad4152dac4b", "message": "uses util function to create random secret string", "committedDate": "2020-05-12T07:34:39Z", "type": "commit"}, {"oid": "68dbc4a3efc5231bfbf6973412259e7200be525c", "url": "https://github.com/bakdata/conquery/commit/68dbc4a3efc5231bfbf6973412259e7200be525c", "message": "adds validation to proto users", "committedDate": "2020-05-12T07:39:58Z", "type": "commit"}, {"oid": "aef007d1a9755ad45d625fb3890ed22e7acadf56", "url": "https://github.com/bakdata/conquery/commit/aef007d1a9755ad45d625fb3890ed22e7acadf56", "message": "Merge 68dbc4a3efc5231bfbf6973412259e7200be525c into 6cd41643d2b02b0b7d54456ce3b976e1f4e29090", "committedDate": "2020-05-12T07:40:25Z", "type": "commit"}, {"oid": "91088cbdcc02ff15cbc0ef67fbdc720b053cf1db", "url": "https://github.com/bakdata/conquery/commit/91088cbdcc02ff15cbc0ef67fbdc720b053cf1db", "message": "automatic update to docs", "committedDate": "2020-05-12T07:42:19Z", "type": "commit"}, {"oid": "5eb9aad3ebb6ab5d5c8f2d95f6cff2b18fe3c31a", "url": "https://github.com/bakdata/conquery/commit/5eb9aad3ebb6ab5d5c8f2d95f6cff2b18fe3c31a", "message": "Merge branch 'release/2.0.0' into feature/unified-result-output-generation", "committedDate": "2020-05-12T07:43:40Z", "type": "commit"}, {"oid": "d9e43d2902f48599a6386ca2d91f3b3be506929d", "url": "https://github.com/bakdata/conquery/commit/d9e43d2902f48599a6386ca2d91f3b3be506929d", "message": "fixes import", "committedDate": "2020-05-12T07:45:37Z", "type": "commit"}, {"oid": "b129d798e7a0d7bdb9c0fea797b62cf6a224be20", "url": "https://github.com/bakdata/conquery/commit/b129d798e7a0d7bdb9c0fea797b62cf6a224be20", "message": "Merge branch 'feature/unified-result-output-generation' into feature/auth-system-improvements", "committedDate": "2020-05-12T07:55:35Z", "type": "commit"}, {"oid": "37e7f23cd31db15548793fbdb2ca67d0aabf3f49", "url": "https://github.com/bakdata/conquery/commit/37e7f23cd31db15548793fbdb2ca67d0aabf3f49", "message": "fixes NullpointerException", "committedDate": "2020-05-13T12:09:10Z", "type": "commit"}, {"oid": "7137596c1e0f7a89d7d3e54225d6b527bbb8d567", "url": "https://github.com/bakdata/conquery/commit/7137596c1e0f7a89d7d3e54225d6b527bbb8d567", "message": "Merge branch 'feature/unified-result-output-generation' into feature/auth-system-improvements", "committedDate": "2020-05-13T12:11:44Z", "type": "commit"}, {"oid": "b1fcfa907173c332e8d19897da610d53f9d6c269", "url": "https://github.com/bakdata/conquery/commit/b1fcfa907173c332e8d19897da610d53f9d6c269", "message": "reverts changes in frontend code", "committedDate": "2020-05-13T12:21:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQ1NjkzOQ==", "url": "https://github.com/bakdata/conquery/pull/1139#discussion_r424456939", "bodyText": "l\u00f6schen", "author": "awildturtok", "createdAt": "2020-05-13T13:54:57Z", "path": "backend/src/main/java/com/bakdata/conquery/models/forms/frontendconfiguration/FormScanner.java", "diffHunk": "@@ -0,0 +1,132 @@\n+package com.bakdata.conquery.models.forms.frontendconfiguration;\n+\n+import java.lang.reflect.Modifier;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.StringJoiner;\n+import java.util.function.Consumer;\n+\n+import com.bakdata.conquery.apiv1.forms.Form;\n+import com.bakdata.conquery.io.cps.CPSType;\n+import com.bakdata.conquery.io.cps.CPSTypeIdResolver;\n+import com.bakdata.conquery.io.jackson.Jackson;\n+import com.bakdata.conquery.models.forms.frontendconfiguration.FormFrontendConfigProvider.FormFrontendConfigInformation;\n+import com.bakdata.conquery.util.QueryUtils;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.ObjectReader;\n+import lombok.SneakyThrows;\n+import lombok.extern.slf4j.Slf4j;\n+\n+@Slf4j\n+public class FormScanner {\n+\n+\tprivate final static String INFO_FORMAT = \"\\t%-30s %-60s %-20s\";\n+\tprivate final static ObjectReader READER = Jackson.MAPPER.copy().reader();\n+\t\n+\tpublic static final Map<String, JsonNode> FRONTEND_FORM_CONFIGS = generateFEFormConfigMap();\n+\n+\tprivate static Map<String, Class<? extends Form>> findBackendMappingClasses() {\n+\t\t// Gather form implementations first\n+\t\tMap<String, Class<? extends Form>> forms = new HashMap<>();\n+\t\tfor (Class<?> subclass : CPSTypeIdResolver.SCAN_RESULT.getClassesImplementing(Form.class.getName()).loadClasses()) {\n+\t\t\tif (Modifier.isAbstract(subclass.getModifiers())) {\n+\t\t\t\tcontinue;\n+\t\t\t}\n+\t\t\tCPSType anno = subclass.getAnnotation(CPSType.class);\n+\t\t\tif (anno == null) {\n+\t\t\t\tlog.warn(\"Implemented Form {} has no CPSType annotation\", subclass);\n+\t\t\t\tcontinue;\n+\t\t\t}\n+\t\t\tforms.put(anno.id(), (Class<? extends Form>) subclass);\n+\t\t}\n+\t\treturn forms;\n+\t}\n+\n+\t/**\n+\t * Frontend form configurations can be provided from different sources. For\n+\t * these sources a stub of type {@link FormFrontendConfigProviderBase} must be\n+\t * implemented in order to be discovered by this function.\n+\t */\n+\t@SneakyThrows\n+\tprivate static List<FormFrontendConfigInformation> findFrontendFormConfigs() {\n+\t\tList<Class<?>> configProviders = CPSTypeIdResolver.SCAN_RESULT.getClassesImplementing(FormFrontendConfigProvider.class.getName())\n+\t\t\t.loadClasses();\n+\t\t\n+\t\tConsumer<Collection<FormFrontendConfigInformation>> providerChain = QueryUtils.getNoOpEntryPoint();\n+\t\t\n+\t\tfor (Class<?> configProvider : configProviders) {\n+\t\t\tint modifiers = configProvider.getModifiers();\n+\t\t\tif (Modifier.isAbstract(modifiers) || Modifier.isInterface(modifiers)) {\n+\t\t\t\tcontinue;\n+\t\t\t}\n+\t\t\t@SuppressWarnings(\"unchecked\")\n+\t\t\tClass<? extends FormFrontendConfigProvider> formConfigProvider = (Class<? extends FormFrontendConfigProviderBase>) configProvider;\n+\t\t\tConsumer<Collection<FormFrontendConfigInformation>> provider;\n+\t\t\t// Distinguish between interface implementations and implementations of the abstract class \n+\t\t\tif (FormFrontendConfigProviderBase.class.isAssignableFrom(formConfigProvider)) {\n+\t\t\t\tprovider = formConfigProvider.getConstructor(ObjectReader.class).newInstance(READER);\n+\t\t\t}\n+\t\t\telse {\n+\t\t\t\tprovider = formConfigProvider.getConstructor().newInstance();\n+\t\t\t}\n+\t\t\tproviderChain = providerChain.andThen(provider);\n+\t\t}\n+\t\tList<FormFrontendConfigInformation> frontendConfigs = new ArrayList<>();\n+\t\tproviderChain.accept(frontendConfigs);\n+\t\treturn frontendConfigs;\n+\t}\n+\n+\tprivate static Map<String, JsonNode> generateFEFormConfigMap() {\n+\t\tStringJoiner info = new StringJoiner(\"\\n\", \"\\n\", \"\\n\");\n+\t\tinfo.add(String.format(INFO_FORMAT, \"Form Type\", \"Frontend Config\", \"Backend Class\"));\n+\t\t\n+\n+\t\t// Collect backend implementations for specific forms\n+\t\tMap<String, Class<? extends Form>> forms = findBackendMappingClasses();\n+\n+\t\t// Collect frontend form configurations for the specific forms\n+\t\tList<FormFrontendConfigInformation> frontendConfigs = findFrontendFormConfigs();\n+\n+\t\t// Match frontend form configurations to backend implementations\n+\t\tMap<String, JsonNode> result = new HashMap<>();\n+\t\tfor (FormFrontendConfigInformation configInfo : frontendConfigs) {\n+\t\t\tJsonNode configTree = configInfo.getConfigTree();\n+\t\t\tString fullTypeIdentifier = null;\n+\t\t\tJsonNode type = configTree.get(\"type\");\n+\t\t\tif (!validTypeId(type)) {\n+\t\t\t\tlog.warn(\"Found invalid type id in {}. Was: {}\", configInfo.getOrigin(), type);\n+\t\t\t\tcontinue;\n+\t\t\t}\n+\t\t\tfullTypeIdentifier = type.asText();\n+\t\t\tString typeIdentifier = CPSTypeIdResolver.truncateSubTypeInformation(fullTypeIdentifier);\n+\t\t\tif (!forms.containsKey(typeIdentifier)) {\n+\t\t\t\tlog.warn(\"Frontend form config {} (type = {}) does not map to a backend class.\", configInfo, type);\n+\t\t\t\tcontinue;\n+\t\t\t}\n+//\t\t\tJsonNode subtype = configTree.get(\"subType\");", "originalCommit": "b1fcfa907173c332e8d19897da610d53f9d6c269", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQ1NzE1NQ==", "url": "https://github.com/bakdata/conquery/pull/1139#discussion_r424457155", "bodyText": "deklaration einziehen", "author": "awildturtok", "createdAt": "2020-05-13T13:55:15Z", "path": "backend/src/main/java/com/bakdata/conquery/models/forms/frontendconfiguration/FormScanner.java", "diffHunk": "@@ -0,0 +1,132 @@\n+package com.bakdata.conquery.models.forms.frontendconfiguration;\n+\n+import java.lang.reflect.Modifier;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.StringJoiner;\n+import java.util.function.Consumer;\n+\n+import com.bakdata.conquery.apiv1.forms.Form;\n+import com.bakdata.conquery.io.cps.CPSType;\n+import com.bakdata.conquery.io.cps.CPSTypeIdResolver;\n+import com.bakdata.conquery.io.jackson.Jackson;\n+import com.bakdata.conquery.models.forms.frontendconfiguration.FormFrontendConfigProvider.FormFrontendConfigInformation;\n+import com.bakdata.conquery.util.QueryUtils;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.ObjectReader;\n+import lombok.SneakyThrows;\n+import lombok.extern.slf4j.Slf4j;\n+\n+@Slf4j\n+public class FormScanner {\n+\n+\tprivate final static String INFO_FORMAT = \"\\t%-30s %-60s %-20s\";\n+\tprivate final static ObjectReader READER = Jackson.MAPPER.copy().reader();\n+\t\n+\tpublic static final Map<String, JsonNode> FRONTEND_FORM_CONFIGS = generateFEFormConfigMap();\n+\n+\tprivate static Map<String, Class<? extends Form>> findBackendMappingClasses() {\n+\t\t// Gather form implementations first\n+\t\tMap<String, Class<? extends Form>> forms = new HashMap<>();\n+\t\tfor (Class<?> subclass : CPSTypeIdResolver.SCAN_RESULT.getClassesImplementing(Form.class.getName()).loadClasses()) {\n+\t\t\tif (Modifier.isAbstract(subclass.getModifiers())) {\n+\t\t\t\tcontinue;\n+\t\t\t}\n+\t\t\tCPSType anno = subclass.getAnnotation(CPSType.class);\n+\t\t\tif (anno == null) {\n+\t\t\t\tlog.warn(\"Implemented Form {} has no CPSType annotation\", subclass);\n+\t\t\t\tcontinue;\n+\t\t\t}\n+\t\t\tforms.put(anno.id(), (Class<? extends Form>) subclass);\n+\t\t}\n+\t\treturn forms;\n+\t}\n+\n+\t/**\n+\t * Frontend form configurations can be provided from different sources. For\n+\t * these sources a stub of type {@link FormFrontendConfigProviderBase} must be\n+\t * implemented in order to be discovered by this function.\n+\t */\n+\t@SneakyThrows\n+\tprivate static List<FormFrontendConfigInformation> findFrontendFormConfigs() {\n+\t\tList<Class<?>> configProviders = CPSTypeIdResolver.SCAN_RESULT.getClassesImplementing(FormFrontendConfigProvider.class.getName())\n+\t\t\t.loadClasses();\n+\t\t\n+\t\tConsumer<Collection<FormFrontendConfigInformation>> providerChain = QueryUtils.getNoOpEntryPoint();\n+\t\t\n+\t\tfor (Class<?> configProvider : configProviders) {\n+\t\t\tint modifiers = configProvider.getModifiers();\n+\t\t\tif (Modifier.isAbstract(modifiers) || Modifier.isInterface(modifiers)) {\n+\t\t\t\tcontinue;\n+\t\t\t}\n+\t\t\t@SuppressWarnings(\"unchecked\")\n+\t\t\tClass<? extends FormFrontendConfigProvider> formConfigProvider = (Class<? extends FormFrontendConfigProviderBase>) configProvider;\n+\t\t\tConsumer<Collection<FormFrontendConfigInformation>> provider;\n+\t\t\t// Distinguish between interface implementations and implementations of the abstract class \n+\t\t\tif (FormFrontendConfigProviderBase.class.isAssignableFrom(formConfigProvider)) {\n+\t\t\t\tprovider = formConfigProvider.getConstructor(ObjectReader.class).newInstance(READER);\n+\t\t\t}\n+\t\t\telse {\n+\t\t\t\tprovider = formConfigProvider.getConstructor().newInstance();\n+\t\t\t}\n+\t\t\tproviderChain = providerChain.andThen(provider);\n+\t\t}\n+\t\tList<FormFrontendConfigInformation> frontendConfigs = new ArrayList<>();\n+\t\tproviderChain.accept(frontendConfigs);\n+\t\treturn frontendConfigs;\n+\t}\n+\n+\tprivate static Map<String, JsonNode> generateFEFormConfigMap() {\n+\t\tStringJoiner info = new StringJoiner(\"\\n\", \"\\n\", \"\\n\");\n+\t\tinfo.add(String.format(INFO_FORMAT, \"Form Type\", \"Frontend Config\", \"Backend Class\"));\n+\t\t\n+\n+\t\t// Collect backend implementations for specific forms\n+\t\tMap<String, Class<? extends Form>> forms = findBackendMappingClasses();\n+\n+\t\t// Collect frontend form configurations for the specific forms\n+\t\tList<FormFrontendConfigInformation> frontendConfigs = findFrontendFormConfigs();\n+\n+\t\t// Match frontend form configurations to backend implementations\n+\t\tMap<String, JsonNode> result = new HashMap<>();\n+\t\tfor (FormFrontendConfigInformation configInfo : frontendConfigs) {\n+\t\t\tJsonNode configTree = configInfo.getConfigTree();\n+\t\t\tString fullTypeIdentifier = null;\n+\t\t\tJsonNode type = configTree.get(\"type\");\n+\t\t\tif (!validTypeId(type)) {\n+\t\t\t\tlog.warn(\"Found invalid type id in {}. Was: {}\", configInfo.getOrigin(), type);\n+\t\t\t\tcontinue;\n+\t\t\t}\n+\t\t\tfullTypeIdentifier = type.asText();", "originalCommit": "b1fcfa907173c332e8d19897da610d53f9d6c269", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQ1ODEwNA==", "url": "https://github.com/bakdata/conquery/pull/1139#discussion_r424458104", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t\t\twholeDone = false;\n          \n          \n            \n            \t\t\t\t\treturn false;", "author": "awildturtok", "createdAt": "2020-05-13T13:56:31Z", "path": "backend/src/main/java/com/bakdata/conquery/models/forms/managed/ManagedForm.java", "diffHunk": "@@ -165,6 +170,19 @@ public void addResult(@NonNull MasterMetaStorage storage, FormSharedResult resul\n \t\t\n \t}\n \n+\n+\tprivate boolean allSubQueriesDone() {\n+\t\tboolean wholeDone = true;\n+\t\tsynchronized (getExecution()) {\t\t\t\n+\t\t\tfor (ManagedQuery q : flatSubQueries.values()) {\n+\t\t\t\tif (!q.getState().equals(ExecutionState.DONE)) {\n+\t\t\t\t\twholeDone = false;", "originalCommit": "b1fcfa907173c332e8d19897da610d53f9d6c269", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQ1ODI1Nw==", "url": "https://github.com/bakdata/conquery/pull/1139#discussion_r424458257", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\treturn wholeDone;\n          \n          \n            \n            \t\treturn true;", "author": "awildturtok", "createdAt": "2020-05-13T13:56:43Z", "path": "backend/src/main/java/com/bakdata/conquery/models/forms/managed/ManagedForm.java", "diffHunk": "@@ -165,6 +170,19 @@ public void addResult(@NonNull MasterMetaStorage storage, FormSharedResult resul\n \t\t\n \t}\n \n+\n+\tprivate boolean allSubQueriesDone() {\n+\t\tboolean wholeDone = true;\n+\t\tsynchronized (getExecution()) {\t\t\t\n+\t\t\tfor (ManagedQuery q : flatSubQueries.values()) {\n+\t\t\t\tif (!q.getState().equals(ExecutionState.DONE)) {\n+\t\t\t\t\twholeDone = false;\n+\t\t\t\t}\n+\t\t\t}\n+\t\t}\n+\t\treturn wholeDone;", "originalCommit": "b1fcfa907173c332e8d19897da610d53f9d6c269", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQ1ODQwMg==", "url": "https://github.com/bakdata/conquery/pull/1139#discussion_r424458402", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\tboolean wholeDone = true;", "author": "awildturtok", "createdAt": "2020-05-13T13:56:54Z", "path": "backend/src/main/java/com/bakdata/conquery/models/forms/managed/ManagedForm.java", "diffHunk": "@@ -165,6 +170,19 @@ public void addResult(@NonNull MasterMetaStorage storage, FormSharedResult resul\n \t\t\n \t}\n \n+\n+\tprivate boolean allSubQueriesDone() {\n+\t\tboolean wholeDone = true;", "originalCommit": "b1fcfa907173c332e8d19897da610d53f9d6c269", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQ1OTAzOA==", "url": "https://github.com/bakdata/conquery/pull/1139#discussion_r424459038", "bodyText": "ncie!", "author": "awildturtok", "createdAt": "2020-05-13T13:57:44Z", "path": "backend/src/test/java/com/bakdata/conquery/io/cps/CPSBaseTest.java", "diffHunk": "@@ -42,6 +42,9 @@ public void test(Class<?> base, Class<?> type) {\n \t\t\tassertThat(anno.base()).isEqualTo(base);\n \t\t\tassertThat(base).hasAnnotation(CPSBase.class);\n \t\t\tassertThat(base).isAssignableFrom(base);\n+\t\t\tif(anno.subTyped()) {\t\t\t\t", "originalCommit": "b1fcfa907173c332e8d19897da610d53f9d6c269", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1d8e67157894d1c9126c0849626365b6e6045b72", "url": "https://github.com/bakdata/conquery/commit/1d8e67157894d1c9126c0849626365b6e6045b72", "message": "review changes", "committedDate": "2020-05-15T09:17:54Z", "type": "commit"}, {"oid": "0e744af3d59512e6e04c6d335093ae9571a59b12", "url": "https://github.com/bakdata/conquery/commit/0e744af3d59512e6e04c6d335093ae9571a59b12", "message": "Merge branch 'feature/unified-result-output-generation' into feature/auth-system-improvements", "committedDate": "2020-05-15T10:40:40Z", "type": "commit"}, {"oid": "26b6fd5d2ac5cee1d3865d6429e281b706d3dfd3", "url": "https://github.com/bakdata/conquery/commit/26b6fd5d2ac5cee1d3865d6429e281b706d3dfd3", "message": "remove atomic integer from result info", "committedDate": "2020-05-15T12:09:50Z", "type": "commit"}, {"oid": "b51ea45e007855ee92dad4e873f41dda7c47b5f8", "url": "https://github.com/bakdata/conquery/commit/b51ea45e007855ee92dad4e873f41dda7c47b5f8", "message": "clean up auth controller", "committedDate": "2020-05-15T12:10:08Z", "type": "commit"}, {"oid": "f347fa6f2ed6422f6333064fc820c7493f6e6108", "url": "https://github.com/bakdata/conquery/commit/f347fa6f2ed6422f6333064fc820c7493f6e6108", "message": "Merge pull request #1182 from bakdata/feature/auth-system-improvements\n\nFeature/auth system improvements", "committedDate": "2020-05-18T07:49:05Z", "type": "commit"}]}