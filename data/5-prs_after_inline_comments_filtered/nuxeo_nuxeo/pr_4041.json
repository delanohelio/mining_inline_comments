{"pr_number": 4041, "pr_title": "NXP-28146 - Load nuxeo.NUXEO_ENVIRONMENT file in addition to nuxeo.defaults", "pr_createdAt": "2020-05-15T14:03:12Z", "pr_url": "https://github.com/nuxeo/nuxeo/pull/4041", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjI4MjMwNw==", "url": "https://github.com/nuxeo/nuxeo/pull/4041#discussion_r426282307", "bodyText": "This is really obsolete (I can't even remember when it was used). I don't think it's worth keeping.", "author": "efge", "createdAt": "2020-05-17T16:57:41Z", "path": "modules/runtime/nuxeo-launcher-commons/src/main/java/org/nuxeo/launcher/config/ServerConfigurator.java", "diffHunk": "@@ -321,7 +365,10 @@ public void checkPaths() throws ConfigurationException {\n             log.warn(\"NXP-8014 Packages cache location changed. You can safely delete {} or move its content to {}\",\n                     () -> oldPackagesPath, this::getPackagesDir);\n         }\n-\n+        File oldPath = new File(getRuntimeHome(), \"data\" + File.separator + \"vcsh2repo\");\n+        String message = String.format(\"NXP-5370, NXP-5460. \" + \"Please rename 'vcsh2repo' directory from %s to %s\",\n+                oldPath, new File(generator.getDataDir(), \"h2\" + File.separator + \"nuxeo\"));", "originalCommit": "99ac83f07c7d79018b7466f160e45badd28a101a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQzNzI5NA==", "url": "https://github.com/nuxeo/nuxeo/pull/4041#discussion_r426437294", "bodyText": "I removed it.", "author": "kevinleturc", "createdAt": "2020-05-18T08:01:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjI4MjMwNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjI4Mjc1NA==", "url": "https://github.com/nuxeo/nuxeo/pull/4041#discussion_r426282754", "bodyText": "I think you can just call mkdirs() on all the dirs wihtout the isDirectory check, it shouldn't fail if the directory already exists.", "author": "efge", "createdAt": "2020-05-17T17:02:32Z", "path": "modules/runtime/nuxeo-launcher-commons/src/main/java/org/nuxeo/launcher/config/ConfigurationGenerator.java", "diffHunk": "@@ -1274,15 +1224,20 @@ public File getDataDir() {\n      */\n     public void verifyInstallation() throws ConfigurationException {\n         checkJavaVersion();\n-        ifNotExistsAndIsDirectoryThenCreate(getLogDir());\n-        ifNotExistsAndIsDirectoryThenCreate(getPidDir());\n-        ifNotExistsAndIsDirectoryThenCreate(getDataDir());\n-        ifNotExistsAndIsDirectoryThenCreate(getTmpDir());\n-        ifNotExistsAndIsDirectoryThenCreate(getPackagesDir());\n+        createDirectoryIfDoesntExist(getLogDir());\n+        createDirectoryIfDoesntExist(getPidDir());\n+        createDirectoryIfDoesntExist(getDataDir());\n+        createDirectoryIfDoesntExist(getTmpDir());\n+        createDirectoryIfDoesntExist(getPackagesDir());\n         checkAddressesAndPorts();\n         serverConfigurator.verifyInstallation();\n         backingServicesConfigurator.verifyInstallation();\n+    }\n \n+    private void createDirectoryIfDoesntExist(File directory) {\n+        if (!directory.isDirectory()) {\n+            directory.mkdirs();", "originalCommit": "ec56196f09ce9378816f6c498543d3cdb4ac53e1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjI4MzMxOA==", "url": "https://github.com/nuxeo/nuxeo/pull/4041#discussion_r426283318", "bodyText": "Maybe Files.exists(generator.getNuxeoHome().toPath().resolve(Path.of(\"conf\", \"Catalina\", \"localhost\", getContextName() + \".xml\")))", "author": "efge", "createdAt": "2020-05-17T17:08:23Z", "path": "modules/runtime/nuxeo-launcher-commons/src/main/java/org/nuxeo/launcher/config/ServerConfigurator.java", "diffHunk": "@@ -111,16 +111,14 @@ public ServerConfigurator(ConfigurationGenerator configurationGenerator) {\n      * @return true if server configuration files already exist\n      */\n     protected boolean isConfigured() {\n-        return new File(generator.getNuxeoHome(), getTomcatConfig()).exists();\n-    }\n-\n-    /**\n-     * @since 5.4.2\n-     * @return Path to Tomcat configuration of Nuxeo context\n-     */\n-    public String getTomcatConfig() {\n-        return \"conf\" + File.separator + \"Catalina\" + File.separator + \"localhost\" + File.separator + getContextName()\n-                + \".xml\";\n+        return generator.getNuxeoHome()\n+                        .toPath()\n+                        .resolve(\"conf\")\n+                        .resolve(\"Catalina\")\n+                        .resolve(\"localhost\")\n+                        .resolve(getContextName() + \".xml\")\n+                        .toFile()\n+                        .exists();", "originalCommit": "ec56196f09ce9378816f6c498543d3cdb4ac53e1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "dcda1ed1b203b49d72187f28c86f56d5b6f00040", "url": "https://github.com/nuxeo/nuxeo/commit/dcda1ed1b203b49d72187f28c86f56d5b6f00040", "message": "NXP-28146: Remove unused code", "committedDate": "2020-05-18T07:56:04Z", "type": "commit"}, {"oid": "4eed83ec1e64e1f4093d91b799ea72577417e1b1", "url": "https://github.com/nuxeo/nuxeo/commit/4eed83ec1e64e1f4093d91b799ea72577417e1b1", "message": "NXP-28146: Cleanup / Format", "committedDate": "2020-05-18T08:00:10Z", "type": "commit"}, {"oid": "78e84cd4418486b4dae1a90e5a782bc40191edb5", "url": "https://github.com/nuxeo/nuxeo/commit/78e84cd4418486b4dae1a90e5a782bc40191edb5", "message": "NXP-28146: Load nuxeo.NUXEO_ENVIRONMENT in addition  to nuxeo.defaults", "committedDate": "2020-05-18T08:00:16Z", "type": "forcePushed"}, {"oid": "c7ad277054251f1c8565c7dea34d5eea70d06afc", "url": "https://github.com/nuxeo/nuxeo/commit/c7ad277054251f1c8565c7dea34d5eea70d06afc", "message": "NXP-28146: Load nuxeo.NUXEO_ENVIRONMENT in addition  to nuxeo.defaults", "committedDate": "2020-05-20T12:30:10Z", "type": "commit"}, {"oid": "c7ad277054251f1c8565c7dea34d5eea70d06afc", "url": "https://github.com/nuxeo/nuxeo/commit/c7ad277054251f1c8565c7dea34d5eea70d06afc", "message": "NXP-28146: Load nuxeo.NUXEO_ENVIRONMENT in addition  to nuxeo.defaults", "committedDate": "2020-05-20T12:30:10Z", "type": "forcePushed"}]}