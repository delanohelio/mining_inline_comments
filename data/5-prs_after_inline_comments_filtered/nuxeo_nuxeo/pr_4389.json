{"pr_number": 4389, "pr_title": "NXP-29488: Fix NPE in MimeTypeTranslationHelper", "pr_createdAt": "2020-10-15T16:57:52Z", "pr_url": "https://github.com/nuxeo/nuxeo/pull/4389", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTcxNDAxOQ==", "url": "https://github.com/nuxeo/nuxeo/pull/4389#discussion_r505714019", "bodyText": "Shouldn't it be:\n.filter(co -> destinationMimeType == null || destinationMimeType.equals(co.mimeType))", "author": "ataillefer", "createdAt": "2020-10-15T17:24:26Z", "path": "modules/core/nuxeo-core-convert/src/main/java/org/nuxeo/ecm/core/convert/service/MimeTypeTranslationHelper.java", "diffHunk": "@@ -159,7 +159,8 @@ public boolean hasCompatibleMimeType(List<String> mimeTypes, String mimeType) {\n         }\n \n         return cos.stream()\n-                  .filter(co -> destinationMimeType == null || co.mimeType.equals(destinationMimeType))\n+                  .filter(co -> (co.mimeType != null)\n+                          && (destinationMimeType == null || co.mimeType.equals(destinationMimeType)))", "originalCommit": "a3bc23e529fd32fb145f8e9bcd641d24edc4ad71", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTcxNTc3MQ==", "url": "https://github.com/nuxeo/nuxeo/pull/4389#discussion_r505715771", "bodyText": "I'm wondering if this is necessary since testGetConverterNames() is already testing this exact code.\nSimply adding the contribution below without the fix should make this test fail.", "author": "ataillefer", "createdAt": "2020-10-15T17:27:34Z", "path": "modules/core/nuxeo-core-convert/src/test/java/org/nuxeo/ecm/core/convert/service/TestMimeTypeTranslationHelper.java", "diffHunk": "@@ -97,4 +97,13 @@ public void testHasCompatibleMimeType() {\n         assertTrue(mimeTypeTranslationHelper.hasCompatibleMimeType(mimeTypes, \"text/html\"));\n         assertTrue(mimeTypeTranslationHelper.hasCompatibleMimeType(mimeTypes, \"application/pdf\"));\n     }\n+\n+    @Test\n+    public void testGetConverterNamesWhenCOMimeTypeIsNull() {\n+        //No NPE thrown\n+        List<String> converterNames = mimeTypeTranslationHelper.getConverterNames(\"application/pdf\", \"text/plain\");\n+        assertEquals(2, converterNames.size());\n+        assertTrue(converterNames.contains(\"toText1\"));\n+        assertTrue(converterNames.contains(\"toText2\"));\n+    }", "originalCommit": "a3bc23e529fd32fb145f8e9bcd641d24edc4ad71", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "cdba800b6d76336e1a8116b307267245f97b82e8", "url": "https://github.com/nuxeo/nuxeo/commit/cdba800b6d76336e1a8116b307267245f97b82e8", "message": "NXP-29488: Fix NPE in MimeTypeTranslationHelper", "committedDate": "2020-10-15T20:32:55Z", "type": "forcePushed"}, {"oid": "23437d8be1e6b3f73f83323f10b99d9b71501bf3", "url": "https://github.com/nuxeo/nuxeo/commit/23437d8be1e6b3f73f83323f10b99d9b71501bf3", "message": "NXP-29488: Fix NPE in MimeTypeTranslationHelper", "committedDate": "2020-10-26T13:51:35Z", "type": "forcePushed"}, {"oid": "d5804fd88d04c4b3113a2ada751db2f885975191", "url": "https://github.com/nuxeo/nuxeo/commit/d5804fd88d04c4b3113a2ada751db2f885975191", "message": "NXP-29488: Fix NPE in MimeTypeTranslationHelper", "committedDate": "2020-10-28T09:27:07Z", "type": "commit"}, {"oid": "d5804fd88d04c4b3113a2ada751db2f885975191", "url": "https://github.com/nuxeo/nuxeo/commit/d5804fd88d04c4b3113a2ada751db2f885975191", "message": "NXP-29488: Fix NPE in MimeTypeTranslationHelper", "committedDate": "2020-10-28T09:27:07Z", "type": "forcePushed"}]}