{"pr_number": 3726, "pr_title": "fix-NXP-28620-Fix-Comment-Migration-failure", "pr_createdAt": "2020-02-05T20:12:44Z", "pr_url": "https://github.com/nuxeo/nuxeo/pull/3726", "timeline": [{"oid": "397598726d1655b6d5baa695045eacba03c6840e", "url": "https://github.com/nuxeo/nuxeo/commit/397598726d1655b6d5baa695045eacba03c6840e", "message": "NXP-28620: Fix Comment Migration failure", "committedDate": "2020-02-06T06:50:43Z", "type": "forcePushed"}, {"oid": "9975a0b5906baca8e98a48a23787dae22b7a438f", "url": "https://github.com/nuxeo/nuxeo/commit/9975a0b5906baca8e98a48a23787dae22b7a438f", "message": "NXP-28620: Fix Comment Migration failure", "committedDate": "2020-02-06T07:02:18Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTY5Mjg4Ng==", "url": "https://github.com/nuxeo/nuxeo/pull/3726#discussion_r375692886", "bodyText": "We don't need to hide warning from console because the log capture feature already catch warn logs and this they are not logged.", "author": "kevinleturc", "createdAt": "2020-02-06T08:22:11Z", "path": "nuxeo-features/nuxeo-platform-comment/nuxeo-platform-comment/src/test/java/org/nuxeo/ecm/platform/comment/TestCommentsMigrator.java", "diffHunk": "@@ -250,6 +253,52 @@ public void testMigrationFromPropertyToSecuredWithCommentsNotCorrectlyFilled() {\n         }\n     }\n \n+    /**\n+     * Test the migration in the case where the {@code comment:parentId} is not empty, but it doesn't exist.\n+     */\n+    @Test\n+    @LogCaptureFeature.FilterOn(logLevel = \"WARN\")\n+    @Deploy(\"org.nuxeo.ecm.platform.comment.tests:OSGI-INF/disable-removing-comment-children-listener.xml\")\n+    public void testMigrationFromPropertyToSecuredWithRemovedParentComment() {\n+        logFeature.hideWarningFromConsoleLog();", "originalCommit": "9975a0b5906baca8e98a48a23787dae22b7a438f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTcwMDA5MQ==", "url": "https://github.com/nuxeo/nuxeo/pull/3726#discussion_r375700091", "bodyText": "i think the hide warning is required. otherwise (i test with removing the hide) and i get a lot warning logs on my console:\n2020-02-06 09:36:48,404 [main] WARN  [CommentsMigrator] The comment document model with IdRef: 73ffc123-2417-4917-a52a-2c5a0a6fe613 cannot be migrated, because his parent: 0dce638b-c3b4-4bad-8f3a-8d6a496f2c56 cannot be found \ni think we can keep it  for 10.10 and on master version i will remove it and replace by the annotation configuration", "author": "RSalem07", "createdAt": "2020-02-06T08:39:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTY5Mjg4Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTcwMzk2Mg==", "url": "https://github.com/nuxeo/nuxeo/pull/3726#discussion_r375703962", "bodyText": "Ok for 10.10, didn't pay attention to it as it's in the PR title.\nMy point is for master, the presence of LogFeature on the test without the method nor the annotation is enough to hide log from console. We may have a regression.", "author": "kevinleturc", "createdAt": "2020-02-06T08:48:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTY5Mjg4Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTcxODY5MA==", "url": "https://github.com/nuxeo/nuxeo/pull/3726#discussion_r375718690", "bodyText": "once the PR validate i will cherry pick and remove the hide console and i will check it", "author": "RSalem07", "createdAt": "2020-02-06T09:19:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTY5Mjg4Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTcyNjkxMw==", "url": "https://github.com/nuxeo/nuxeo/pull/3726#discussion_r375726913", "bodyText": "but if i remember unfortunately we need the two log to hide and to capture. its why when we rework the log annotation we told ourself we need another JIRA ticket to simply the whole process.\nConsoleLogLevelThreshold was added to hide\nLogCapture was here before the ConsoleLogLevelThreshold and the idea is to create a new jira ticket which will responsible to configure ConsoleLogLevelThreshold based on the LogCapture without the need to add manually the ConsoleLogLevelThreshold", "author": "RSalem07", "createdAt": "2020-02-06T09:35:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTY5Mjg4Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTc0MzY5NA==", "url": "https://github.com/nuxeo/nuxeo/pull/3726#discussion_r375743694", "bodyText": "Agree about the improvement around these two features. What I'm talking about is that without explicitly hiding, we still hide logs from console on master whereas we shouldn't as the improvement wasn't done.", "author": "kevinleturc", "createdAt": "2020-02-06T10:08:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTY5Mjg4Ng=="}], "type": "inlineReview"}, {"oid": "5e21bb930d8823f2ba068a6a9a1ff784b0a9e29d", "url": "https://github.com/nuxeo/nuxeo/commit/5e21bb930d8823f2ba068a6a9a1ff784b0a9e29d", "message": "NXP-28620: Fix Comment Migration failure", "committedDate": "2020-02-06T09:16:32Z", "type": "forcePushed"}, {"oid": "bae0ba12f689267f5ef5ec80bd98b81e1a748987", "url": "https://github.com/nuxeo/nuxeo/commit/bae0ba12f689267f5ef5ec80bd98b81e1a748987", "message": "NXP-28620: Fix Comment Migration failure", "committedDate": "2020-02-06T09:30:18Z", "type": "forcePushed"}, {"oid": "1e00147130d24757389c505d0644bc4a462fe7f2", "url": "https://github.com/nuxeo/nuxeo/commit/1e00147130d24757389c505d0644bc4a462fe7f2", "message": "NXP-28620: Fix Comment Migration failure", "committedDate": "2020-02-06T10:17:23Z", "type": "commit"}, {"oid": "1e00147130d24757389c505d0644bc4a462fe7f2", "url": "https://github.com/nuxeo/nuxeo/commit/1e00147130d24757389c505d0644bc4a462fe7f2", "message": "NXP-28620: Fix Comment Migration failure", "committedDate": "2020-02-06T10:17:23Z", "type": "forcePushed"}]}