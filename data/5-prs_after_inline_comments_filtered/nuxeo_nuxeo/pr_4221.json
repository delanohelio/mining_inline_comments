{"pr_number": 4221, "pr_title": "fix-NXP-29286-filemanager-import-overwrite-parameter", "pr_createdAt": "2020-07-16T20:21:14Z", "pr_url": "https://github.com/nuxeo/nuxeo/pull/4221", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjI3MzQ1Mw==", "url": "https://github.com/nuxeo/nuxeo/pull/4221#discussion_r456273453", "bodyText": "I think we want overwite || overwrite here?", "author": "bdelbosc", "createdAt": "2020-07-17T07:40:31Z", "path": "modules/platform/nuxeo-automation/nuxeo-automation-features/src/main/java/org/nuxeo/ecm/automation/core/operations/services/FileManagerImport.java", "diffHunk": "@@ -82,7 +88,7 @@ public DocumentModel run(Blob blob) throws OperationException, IOException {\n         DocumentModel currentDocument = getCurrentDocument();\n         String path = currentDocument.getPathAsString();\n         FileImporterContext fileCreationContext = FileImporterContext.builder(session, blob, path)\n-                                                                     .overwrite(overwite)\n+                                                                     .overwrite(overwrite)", "originalCommit": "21aa96fc4a818b3aba4ef8d1b8a030266a35f723", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjI4MDM2OQ==", "url": "https://github.com/nuxeo/nuxeo/pull/4221#discussion_r456280369", "bodyText": "And it misses some unit tests to validate that both parameters work as expected :)", "author": "troger", "createdAt": "2020-07-17T07:54:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjI3MzQ1Mw=="}], "type": "inlineReview"}, {"oid": "c1702cf6c38b2060e2c91385079ca54c553497c4", "url": "https://github.com/nuxeo/nuxeo/commit/c1702cf6c38b2060e2c91385079ca54c553497c4", "message": "NXP-29286: rename the parameter \"overwite\" of FileManager.Import to \"overwrite\"", "committedDate": "2020-07-17T12:08:48Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzM4OTEyNQ==", "url": "https://github.com/nuxeo/nuxeo/pull/4221#discussion_r457389125", "bodyText": "Better to use Folder as type for a parent document :)", "author": "troger", "createdAt": "2020-07-20T13:35:36Z", "path": "modules/platform/nuxeo-automation/nuxeo-automation-features/src/test/java/org/nuxeo/ecm/automation/core/operations/services/TestFileManagerImport.java", "diffHunk": "@@ -0,0 +1,173 @@\n+/*\n+ * (C) Copyright 2020 Nuxeo (http://nuxeo.com/) and others.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ * Contributors:\n+ *     Micka\u00ebl Schoentgen <mschoentgen@nuxeo.com>\n+ */\n+\n+package org.nuxeo.ecm.automation.core.operations.services;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNotEquals;\n+import static org.junit.Assert.assertNotNull;\n+\n+import java.io.Serializable;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import javax.inject.Inject;\n+\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.nuxeo.ecm.automation.AutomationService;\n+import org.nuxeo.ecm.automation.OperationContext;\n+import org.nuxeo.ecm.automation.OperationException;\n+import org.nuxeo.ecm.core.api.CoreSession;\n+import org.nuxeo.ecm.core.api.DocumentModel;\n+import org.nuxeo.ecm.core.test.CoreFeature;\n+import org.nuxeo.runtime.test.runner.Deploy;\n+import org.nuxeo.runtime.test.runner.Features;\n+import org.nuxeo.runtime.test.runner.FeaturesRunner;\n+import org.nuxeo.runtime.test.runner.TransactionalFeature;\n+\n+/**\n+ * @since 11.2\n+ */\n+@RunWith(FeaturesRunner.class)\n+@Features(CoreFeature.class)\n+@Deploy(\"org.nuxeo.ecm.platform.types.api\")\n+@Deploy(\"org.nuxeo.ecm.platform.types.core\")\n+@Deploy(\"org.nuxeo.ecm.platform.filemanager.api\")\n+@Deploy(\"org.nuxeo.ecm.platform.filemanager.core\")\n+@Deploy(\"org.nuxeo.ecm.automation.core\")\n+@Deploy(\"org.nuxeo.ecm.automation.features\")\n+@Deploy(\"org.nuxeo.ecm.platform.webapp.types\")\n+public class TestFileManagerImport {\n+\n+    @Inject\n+    protected CoreSession session;\n+\n+    @Inject\n+    protected AutomationService service;\n+\n+    @Inject\n+    public TransactionalFeature txFeature;\n+\n+    protected DocumentModel parent;\n+\n+    @Before\n+    public void before() {\n+        parent = session.createDocumentModel(\"/\", \"foo\", \"File\");", "originalCommit": "c1702cf6c38b2060e2c91385079ca54c553497c4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzM5MTQwNw==", "url": "https://github.com/nuxeo/nuxeo/pull/4221#discussion_r457391407", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        Map<String, Serializable> params = new HashMap<>();\n          \n          \n            \n                        params.put(\"title\", \"bar\");\n          \n          \n            \n                        Map<String, Serializable> params = Map.of(\"title\", \"bar\");\n          \n      \n    \n    \n  \n\nSame for other Maps.", "author": "troger", "createdAt": "2020-07-20T13:37:59Z", "path": "modules/platform/nuxeo-automation/nuxeo-automation-features/src/test/java/org/nuxeo/ecm/automation/core/operations/services/TestFileManagerImport.java", "diffHunk": "@@ -0,0 +1,173 @@\n+/*\n+ * (C) Copyright 2020 Nuxeo (http://nuxeo.com/) and others.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ * Contributors:\n+ *     Micka\u00ebl Schoentgen <mschoentgen@nuxeo.com>\n+ */\n+\n+package org.nuxeo.ecm.automation.core.operations.services;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNotEquals;\n+import static org.junit.Assert.assertNotNull;\n+\n+import java.io.Serializable;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import javax.inject.Inject;\n+\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.nuxeo.ecm.automation.AutomationService;\n+import org.nuxeo.ecm.automation.OperationContext;\n+import org.nuxeo.ecm.automation.OperationException;\n+import org.nuxeo.ecm.core.api.CoreSession;\n+import org.nuxeo.ecm.core.api.DocumentModel;\n+import org.nuxeo.ecm.core.test.CoreFeature;\n+import org.nuxeo.runtime.test.runner.Deploy;\n+import org.nuxeo.runtime.test.runner.Features;\n+import org.nuxeo.runtime.test.runner.FeaturesRunner;\n+import org.nuxeo.runtime.test.runner.TransactionalFeature;\n+\n+/**\n+ * @since 11.2\n+ */\n+@RunWith(FeaturesRunner.class)\n+@Features(CoreFeature.class)\n+@Deploy(\"org.nuxeo.ecm.platform.types.api\")\n+@Deploy(\"org.nuxeo.ecm.platform.types.core\")\n+@Deploy(\"org.nuxeo.ecm.platform.filemanager.api\")\n+@Deploy(\"org.nuxeo.ecm.platform.filemanager.core\")\n+@Deploy(\"org.nuxeo.ecm.automation.core\")\n+@Deploy(\"org.nuxeo.ecm.automation.features\")\n+@Deploy(\"org.nuxeo.ecm.platform.webapp.types\")\n+public class TestFileManagerImport {\n+\n+    @Inject\n+    protected CoreSession session;\n+\n+    @Inject\n+    protected AutomationService service;\n+\n+    @Inject\n+    public TransactionalFeature txFeature;\n+\n+    protected DocumentModel parent;\n+\n+    @Before\n+    public void before() {\n+        parent = session.createDocumentModel(\"/\", \"foo\", \"File\");\n+        parent = session.createDocument(parent);\n+    }\n+\n+    @Test\n+    public void testFileImport() throws OperationException {\n+        try (OperationContext ctx = new OperationContext(session)) {\n+            ctx.setInput(parent);\n+            Map<String, Serializable> params = new HashMap<>();\n+            params.put(\"title\", \"bar\");", "originalCommit": "c1702cf6c38b2060e2c91385079ca54c553497c4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzM5NTUwMA==", "url": "https://github.com/nuxeo/nuxeo/pull/4221#discussion_r457395500", "bodyText": "Tests are on error on your PR (https://jenkins.platform.dev.nuxeo.com/blue/organizations/jenkins/nuxeo%2Fnuxeo/detail/PR-4221/2/pipeline):\n[2020-07-17T16:23:51.496Z] [ERROR] testFileImport(org.nuxeo.ecm.automation.core.operations.services.TestFileManagerImport)  Time elapsed: 0.049 s  <<< ERROR!\n[2020-07-17T16:23:51.496Z] org.nuxeo.ecm.automation.InvalidChainException: Cannot find any valid path in operation chain - no method found for operation 'FileManager.Import' and for first input type 'org.nuxeo.ecm.core.api.impl.DocumentModelImpl'\n\nThe operation input is a Blob, not the parent document. The parent document should be passed as a currentDocument context variable.\nSee TestFileManagerImportWithProperties#testNoteCreationWithProperties for instance.", "author": "troger", "createdAt": "2020-07-20T13:42:25Z", "path": "modules/platform/nuxeo-automation/nuxeo-automation-features/src/test/java/org/nuxeo/ecm/automation/core/operations/services/TestFileManagerImport.java", "diffHunk": "@@ -0,0 +1,173 @@\n+/*\n+ * (C) Copyright 2020 Nuxeo (http://nuxeo.com/) and others.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ * Contributors:\n+ *     Micka\u00ebl Schoentgen <mschoentgen@nuxeo.com>\n+ */\n+\n+package org.nuxeo.ecm.automation.core.operations.services;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNotEquals;\n+import static org.junit.Assert.assertNotNull;\n+\n+import java.io.Serializable;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import javax.inject.Inject;\n+\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.nuxeo.ecm.automation.AutomationService;\n+import org.nuxeo.ecm.automation.OperationContext;\n+import org.nuxeo.ecm.automation.OperationException;\n+import org.nuxeo.ecm.core.api.CoreSession;\n+import org.nuxeo.ecm.core.api.DocumentModel;\n+import org.nuxeo.ecm.core.test.CoreFeature;\n+import org.nuxeo.runtime.test.runner.Deploy;\n+import org.nuxeo.runtime.test.runner.Features;\n+import org.nuxeo.runtime.test.runner.FeaturesRunner;\n+import org.nuxeo.runtime.test.runner.TransactionalFeature;\n+\n+/**\n+ * @since 11.2\n+ */\n+@RunWith(FeaturesRunner.class)\n+@Features(CoreFeature.class)\n+@Deploy(\"org.nuxeo.ecm.platform.types.api\")\n+@Deploy(\"org.nuxeo.ecm.platform.types.core\")\n+@Deploy(\"org.nuxeo.ecm.platform.filemanager.api\")\n+@Deploy(\"org.nuxeo.ecm.platform.filemanager.core\")\n+@Deploy(\"org.nuxeo.ecm.automation.core\")\n+@Deploy(\"org.nuxeo.ecm.automation.features\")\n+@Deploy(\"org.nuxeo.ecm.platform.webapp.types\")\n+public class TestFileManagerImport {\n+\n+    @Inject\n+    protected CoreSession session;\n+\n+    @Inject\n+    protected AutomationService service;\n+\n+    @Inject\n+    public TransactionalFeature txFeature;\n+\n+    protected DocumentModel parent;\n+\n+    @Before\n+    public void before() {\n+        parent = session.createDocumentModel(\"/\", \"foo\", \"File\");\n+        parent = session.createDocument(parent);\n+    }\n+\n+    @Test\n+    public void testFileImport() throws OperationException {\n+        try (OperationContext ctx = new OperationContext(session)) {\n+            ctx.setInput(parent);", "originalCommit": "c1702cf6c38b2060e2c91385079ca54c553497c4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzUwMDY3MA==", "url": "https://github.com/nuxeo/nuxeo/pull/4221#discussion_r457500670", "bodyText": "Couldn't this be dealt with the following code?\n@Param(name = \"overwrite\", required = false, alias = \"overwite\")\nprotected Boolean overwrite = false;\n\nThen we could have simply:\n.overwrite(overwrite)", "author": "ataillefer", "createdAt": "2020-07-20T15:35:04Z", "path": "modules/platform/nuxeo-automation/nuxeo-automation-features/src/main/java/org/nuxeo/ecm/automation/core/operations/services/FileManagerImport.java", "diffHunk": "@@ -82,7 +88,7 @@ public DocumentModel run(Blob blob) throws OperationException, IOException {\n         DocumentModel currentDocument = getCurrentDocument();\n         String path = currentDocument.getPathAsString();\n         FileImporterContext fileCreationContext = FileImporterContext.builder(session, blob, path)\n-                                                                     .overwrite(overwite)\n+                                                                     .overwrite(overwite || overwrite)", "originalCommit": "c1702cf6c38b2060e2c91385079ca54c553497c4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzUxMDM1MQ==", "url": "https://github.com/nuxeo/nuxeo/pull/4221#discussion_r457510351", "bodyText": "It was the first idea, but what about the deprecation part then?", "author": "BoboTiG", "createdAt": "2020-07-20T15:46:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzUwMDY3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzUzMzI3Mg==", "url": "https://github.com/nuxeo/nuxeo/pull/4221#discussion_r457533272", "bodyText": "Indeed, but it seems simpler to use aliases that were made for this purpose, and not have the deprecated member in the logic part.\nI think it's OK that the compatibility is kept forever, or when we remove the deprecated member we could also simply remove the alias.", "author": "ataillefer", "createdAt": "2020-07-20T16:18:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzUwMDY3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzUzNTg1OA==", "url": "https://github.com/nuxeo/nuxeo/pull/4221#discussion_r457535858", "bodyText": "I am +1 for that too :)", "author": "BoboTiG", "createdAt": "2020-07-20T16:22:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzUwMDY3MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzUwNDM1MQ==", "url": "https://github.com/nuxeo/nuxeo/pull/4221#discussion_r457504351", "bodyText": "There is no title parameter for the FileManagerImport operation.", "author": "ataillefer", "createdAt": "2020-07-20T15:39:20Z", "path": "modules/platform/nuxeo-automation/nuxeo-automation-features/src/test/java/org/nuxeo/ecm/automation/core/operations/services/TestFileManagerImport.java", "diffHunk": "@@ -0,0 +1,173 @@\n+/*\n+ * (C) Copyright 2020 Nuxeo (http://nuxeo.com/) and others.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ * Contributors:\n+ *     Micka\u00ebl Schoentgen <mschoentgen@nuxeo.com>\n+ */\n+\n+package org.nuxeo.ecm.automation.core.operations.services;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNotEquals;\n+import static org.junit.Assert.assertNotNull;\n+\n+import java.io.Serializable;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import javax.inject.Inject;\n+\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.nuxeo.ecm.automation.AutomationService;\n+import org.nuxeo.ecm.automation.OperationContext;\n+import org.nuxeo.ecm.automation.OperationException;\n+import org.nuxeo.ecm.core.api.CoreSession;\n+import org.nuxeo.ecm.core.api.DocumentModel;\n+import org.nuxeo.ecm.core.test.CoreFeature;\n+import org.nuxeo.runtime.test.runner.Deploy;\n+import org.nuxeo.runtime.test.runner.Features;\n+import org.nuxeo.runtime.test.runner.FeaturesRunner;\n+import org.nuxeo.runtime.test.runner.TransactionalFeature;\n+\n+/**\n+ * @since 11.2\n+ */\n+@RunWith(FeaturesRunner.class)\n+@Features(CoreFeature.class)\n+@Deploy(\"org.nuxeo.ecm.platform.types.api\")\n+@Deploy(\"org.nuxeo.ecm.platform.types.core\")\n+@Deploy(\"org.nuxeo.ecm.platform.filemanager.api\")\n+@Deploy(\"org.nuxeo.ecm.platform.filemanager.core\")\n+@Deploy(\"org.nuxeo.ecm.automation.core\")\n+@Deploy(\"org.nuxeo.ecm.automation.features\")\n+@Deploy(\"org.nuxeo.ecm.platform.webapp.types\")\n+public class TestFileManagerImport {\n+\n+    @Inject\n+    protected CoreSession session;\n+\n+    @Inject\n+    protected AutomationService service;\n+\n+    @Inject\n+    public TransactionalFeature txFeature;\n+\n+    protected DocumentModel parent;\n+\n+    @Before\n+    public void before() {\n+        parent = session.createDocumentModel(\"/\", \"foo\", \"File\");\n+        parent = session.createDocument(parent);\n+    }\n+\n+    @Test\n+    public void testFileImport() throws OperationException {\n+        try (OperationContext ctx = new OperationContext(session)) {\n+            ctx.setInput(parent);\n+            Map<String, Serializable> params = new HashMap<>();\n+            params.put(\"title\", \"bar\");", "originalCommit": "c1702cf6c38b2060e2c91385079ca54c553497c4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzUwNDcwOA==", "url": "https://github.com/nuxeo/nuxeo/pull/4221#discussion_r457504708", "bodyText": "I guess setting a description is not strictly needed here.", "author": "ataillefer", "createdAt": "2020-07-20T15:39:49Z", "path": "modules/platform/nuxeo-automation/nuxeo-automation-features/src/test/java/org/nuxeo/ecm/automation/core/operations/services/TestFileManagerImport.java", "diffHunk": "@@ -0,0 +1,173 @@\n+/*\n+ * (C) Copyright 2020 Nuxeo (http://nuxeo.com/) and others.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ * Contributors:\n+ *     Micka\u00ebl Schoentgen <mschoentgen@nuxeo.com>\n+ */\n+\n+package org.nuxeo.ecm.automation.core.operations.services;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNotEquals;\n+import static org.junit.Assert.assertNotNull;\n+\n+import java.io.Serializable;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import javax.inject.Inject;\n+\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.nuxeo.ecm.automation.AutomationService;\n+import org.nuxeo.ecm.automation.OperationContext;\n+import org.nuxeo.ecm.automation.OperationException;\n+import org.nuxeo.ecm.core.api.CoreSession;\n+import org.nuxeo.ecm.core.api.DocumentModel;\n+import org.nuxeo.ecm.core.test.CoreFeature;\n+import org.nuxeo.runtime.test.runner.Deploy;\n+import org.nuxeo.runtime.test.runner.Features;\n+import org.nuxeo.runtime.test.runner.FeaturesRunner;\n+import org.nuxeo.runtime.test.runner.TransactionalFeature;\n+\n+/**\n+ * @since 11.2\n+ */\n+@RunWith(FeaturesRunner.class)\n+@Features(CoreFeature.class)\n+@Deploy(\"org.nuxeo.ecm.platform.types.api\")\n+@Deploy(\"org.nuxeo.ecm.platform.types.core\")\n+@Deploy(\"org.nuxeo.ecm.platform.filemanager.api\")\n+@Deploy(\"org.nuxeo.ecm.platform.filemanager.core\")\n+@Deploy(\"org.nuxeo.ecm.automation.core\")\n+@Deploy(\"org.nuxeo.ecm.automation.features\")\n+@Deploy(\"org.nuxeo.ecm.platform.webapp.types\")\n+public class TestFileManagerImport {\n+\n+    @Inject\n+    protected CoreSession session;\n+\n+    @Inject\n+    protected AutomationService service;\n+\n+    @Inject\n+    public TransactionalFeature txFeature;\n+\n+    protected DocumentModel parent;\n+\n+    @Before\n+    public void before() {\n+        parent = session.createDocumentModel(\"/\", \"foo\", \"File\");\n+        parent = session.createDocument(parent);\n+    }\n+\n+    @Test\n+    public void testFileImport() throws OperationException {\n+        try (OperationContext ctx = new OperationContext(session)) {\n+            ctx.setInput(parent);\n+            Map<String, Serializable> params = new HashMap<>();\n+            params.put(\"title\", \"bar\");\n+\n+            DocumentModel doc = (DocumentModel) service.run(ctx, FileManagerImport.ID, params);\n+            assertNotNull(doc);\n+            assertNotNull(doc.getId());\n+            assertEquals(\"File\", doc.getType());\n+            assertEquals(\"bar\", doc.getName());\n+            assertEquals(\"/foo/bar\", doc.getPathAsString());\n+            assertEquals(\"bar\", doc.getTitle());\n+        }\n+    }\n+\n+    @Test\n+    public void testFileImportOverwrite() throws OperationException {\n+        // first create a file\n+        DocumentModel file = session.createDocumentModel(parent.getPathAsString(), \"bar\", \"File\");\n+        file.setPropertyValue(\"dc:title\", \"bar\");\n+        file.setPropertyValue(\"dc:description\", \"foobar\");", "originalCommit": "c1702cf6c38b2060e2c91385079ca54c553497c4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzUwNTAwNw==", "url": "https://github.com/nuxeo/nuxeo/pull/4221#discussion_r457505007", "bodyText": "title parameter doesn't exist", "author": "ataillefer", "createdAt": "2020-07-20T15:40:09Z", "path": "modules/platform/nuxeo-automation/nuxeo-automation-features/src/test/java/org/nuxeo/ecm/automation/core/operations/services/TestFileManagerImport.java", "diffHunk": "@@ -0,0 +1,173 @@\n+/*\n+ * (C) Copyright 2020 Nuxeo (http://nuxeo.com/) and others.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ * Contributors:\n+ *     Micka\u00ebl Schoentgen <mschoentgen@nuxeo.com>\n+ */\n+\n+package org.nuxeo.ecm.automation.core.operations.services;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNotEquals;\n+import static org.junit.Assert.assertNotNull;\n+\n+import java.io.Serializable;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import javax.inject.Inject;\n+\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.nuxeo.ecm.automation.AutomationService;\n+import org.nuxeo.ecm.automation.OperationContext;\n+import org.nuxeo.ecm.automation.OperationException;\n+import org.nuxeo.ecm.core.api.CoreSession;\n+import org.nuxeo.ecm.core.api.DocumentModel;\n+import org.nuxeo.ecm.core.test.CoreFeature;\n+import org.nuxeo.runtime.test.runner.Deploy;\n+import org.nuxeo.runtime.test.runner.Features;\n+import org.nuxeo.runtime.test.runner.FeaturesRunner;\n+import org.nuxeo.runtime.test.runner.TransactionalFeature;\n+\n+/**\n+ * @since 11.2\n+ */\n+@RunWith(FeaturesRunner.class)\n+@Features(CoreFeature.class)\n+@Deploy(\"org.nuxeo.ecm.platform.types.api\")\n+@Deploy(\"org.nuxeo.ecm.platform.types.core\")\n+@Deploy(\"org.nuxeo.ecm.platform.filemanager.api\")\n+@Deploy(\"org.nuxeo.ecm.platform.filemanager.core\")\n+@Deploy(\"org.nuxeo.ecm.automation.core\")\n+@Deploy(\"org.nuxeo.ecm.automation.features\")\n+@Deploy(\"org.nuxeo.ecm.platform.webapp.types\")\n+public class TestFileManagerImport {\n+\n+    @Inject\n+    protected CoreSession session;\n+\n+    @Inject\n+    protected AutomationService service;\n+\n+    @Inject\n+    public TransactionalFeature txFeature;\n+\n+    protected DocumentModel parent;\n+\n+    @Before\n+    public void before() {\n+        parent = session.createDocumentModel(\"/\", \"foo\", \"File\");\n+        parent = session.createDocument(parent);\n+    }\n+\n+    @Test\n+    public void testFileImport() throws OperationException {\n+        try (OperationContext ctx = new OperationContext(session)) {\n+            ctx.setInput(parent);\n+            Map<String, Serializable> params = new HashMap<>();\n+            params.put(\"title\", \"bar\");\n+\n+            DocumentModel doc = (DocumentModel) service.run(ctx, FileManagerImport.ID, params);\n+            assertNotNull(doc);\n+            assertNotNull(doc.getId());\n+            assertEquals(\"File\", doc.getType());\n+            assertEquals(\"bar\", doc.getName());\n+            assertEquals(\"/foo/bar\", doc.getPathAsString());\n+            assertEquals(\"bar\", doc.getTitle());\n+        }\n+    }\n+\n+    @Test\n+    public void testFileImportOverwrite() throws OperationException {\n+        // first create a file\n+        DocumentModel file = session.createDocumentModel(parent.getPathAsString(), \"bar\", \"File\");\n+        file.setPropertyValue(\"dc:title\", \"bar\");\n+        file.setPropertyValue(\"dc:description\", \"foobar\");\n+        file = session.createDocument(file);\n+        txFeature.nextTransaction();\n+\n+        try (OperationContext ctx = new OperationContext(session)) {\n+            ctx.setInput(parent);\n+            Map<String, Serializable> params = new HashMap<>();\n+            params.put(\"title\", \"bar\");", "originalCommit": "c1702cf6c38b2060e2c91385079ca54c553497c4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzUwNjA1Mw==", "url": "https://github.com/nuxeo/nuxeo/pull/4221#discussion_r457506053", "bodyText": "Could be removed since it's included by the next assertion.", "author": "ataillefer", "createdAt": "2020-07-20T15:41:27Z", "path": "modules/platform/nuxeo-automation/nuxeo-automation-features/src/test/java/org/nuxeo/ecm/automation/core/operations/services/TestFileManagerImport.java", "diffHunk": "@@ -0,0 +1,173 @@\n+/*\n+ * (C) Copyright 2020 Nuxeo (http://nuxeo.com/) and others.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ * Contributors:\n+ *     Micka\u00ebl Schoentgen <mschoentgen@nuxeo.com>\n+ */\n+\n+package org.nuxeo.ecm.automation.core.operations.services;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNotEquals;\n+import static org.junit.Assert.assertNotNull;\n+\n+import java.io.Serializable;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import javax.inject.Inject;\n+\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.nuxeo.ecm.automation.AutomationService;\n+import org.nuxeo.ecm.automation.OperationContext;\n+import org.nuxeo.ecm.automation.OperationException;\n+import org.nuxeo.ecm.core.api.CoreSession;\n+import org.nuxeo.ecm.core.api.DocumentModel;\n+import org.nuxeo.ecm.core.test.CoreFeature;\n+import org.nuxeo.runtime.test.runner.Deploy;\n+import org.nuxeo.runtime.test.runner.Features;\n+import org.nuxeo.runtime.test.runner.FeaturesRunner;\n+import org.nuxeo.runtime.test.runner.TransactionalFeature;\n+\n+/**\n+ * @since 11.2\n+ */\n+@RunWith(FeaturesRunner.class)\n+@Features(CoreFeature.class)\n+@Deploy(\"org.nuxeo.ecm.platform.types.api\")\n+@Deploy(\"org.nuxeo.ecm.platform.types.core\")\n+@Deploy(\"org.nuxeo.ecm.platform.filemanager.api\")\n+@Deploy(\"org.nuxeo.ecm.platform.filemanager.core\")\n+@Deploy(\"org.nuxeo.ecm.automation.core\")\n+@Deploy(\"org.nuxeo.ecm.automation.features\")\n+@Deploy(\"org.nuxeo.ecm.platform.webapp.types\")\n+public class TestFileManagerImport {\n+\n+    @Inject\n+    protected CoreSession session;\n+\n+    @Inject\n+    protected AutomationService service;\n+\n+    @Inject\n+    public TransactionalFeature txFeature;\n+\n+    protected DocumentModel parent;\n+\n+    @Before\n+    public void before() {\n+        parent = session.createDocumentModel(\"/\", \"foo\", \"File\");\n+        parent = session.createDocument(parent);\n+    }\n+\n+    @Test\n+    public void testFileImport() throws OperationException {\n+        try (OperationContext ctx = new OperationContext(session)) {\n+            ctx.setInput(parent);\n+            Map<String, Serializable> params = new HashMap<>();\n+            params.put(\"title\", \"bar\");\n+\n+            DocumentModel doc = (DocumentModel) service.run(ctx, FileManagerImport.ID, params);\n+            assertNotNull(doc);\n+            assertNotNull(doc.getId());\n+            assertEquals(\"File\", doc.getType());\n+            assertEquals(\"bar\", doc.getName());\n+            assertEquals(\"/foo/bar\", doc.getPathAsString());\n+            assertEquals(\"bar\", doc.getTitle());\n+        }\n+    }\n+\n+    @Test\n+    public void testFileImportOverwrite() throws OperationException {\n+        // first create a file\n+        DocumentModel file = session.createDocumentModel(parent.getPathAsString(), \"bar\", \"File\");\n+        file.setPropertyValue(\"dc:title\", \"bar\");\n+        file.setPropertyValue(\"dc:description\", \"foobar\");\n+        file = session.createDocument(file);\n+        txFeature.nextTransaction();\n+\n+        try (OperationContext ctx = new OperationContext(session)) {\n+            ctx.setInput(parent);\n+            Map<String, Serializable> params = new HashMap<>();\n+            params.put(\"title\", \"bar\");\n+            params.put(\"overwrite\", true);\n+\n+            DocumentModel doc = (DocumentModel) service.run(ctx, FileManagerImport.ID, params);\n+            assertNotNull(doc);\n+            assertNotNull(doc.getId());", "originalCommit": "c1702cf6c38b2060e2c91385079ca54c553497c4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzUwNjYxNA==", "url": "https://github.com/nuxeo/nuxeo/pull/4221#discussion_r457506614", "bodyText": "title param doesn't exist", "author": "ataillefer", "createdAt": "2020-07-20T15:42:08Z", "path": "modules/platform/nuxeo-automation/nuxeo-automation-features/src/test/java/org/nuxeo/ecm/automation/core/operations/services/TestFileManagerImport.java", "diffHunk": "@@ -0,0 +1,173 @@\n+/*\n+ * (C) Copyright 2020 Nuxeo (http://nuxeo.com/) and others.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ * Contributors:\n+ *     Micka\u00ebl Schoentgen <mschoentgen@nuxeo.com>\n+ */\n+\n+package org.nuxeo.ecm.automation.core.operations.services;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNotEquals;\n+import static org.junit.Assert.assertNotNull;\n+\n+import java.io.Serializable;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import javax.inject.Inject;\n+\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.nuxeo.ecm.automation.AutomationService;\n+import org.nuxeo.ecm.automation.OperationContext;\n+import org.nuxeo.ecm.automation.OperationException;\n+import org.nuxeo.ecm.core.api.CoreSession;\n+import org.nuxeo.ecm.core.api.DocumentModel;\n+import org.nuxeo.ecm.core.test.CoreFeature;\n+import org.nuxeo.runtime.test.runner.Deploy;\n+import org.nuxeo.runtime.test.runner.Features;\n+import org.nuxeo.runtime.test.runner.FeaturesRunner;\n+import org.nuxeo.runtime.test.runner.TransactionalFeature;\n+\n+/**\n+ * @since 11.2\n+ */\n+@RunWith(FeaturesRunner.class)\n+@Features(CoreFeature.class)\n+@Deploy(\"org.nuxeo.ecm.platform.types.api\")\n+@Deploy(\"org.nuxeo.ecm.platform.types.core\")\n+@Deploy(\"org.nuxeo.ecm.platform.filemanager.api\")\n+@Deploy(\"org.nuxeo.ecm.platform.filemanager.core\")\n+@Deploy(\"org.nuxeo.ecm.automation.core\")\n+@Deploy(\"org.nuxeo.ecm.automation.features\")\n+@Deploy(\"org.nuxeo.ecm.platform.webapp.types\")\n+public class TestFileManagerImport {\n+\n+    @Inject\n+    protected CoreSession session;\n+\n+    @Inject\n+    protected AutomationService service;\n+\n+    @Inject\n+    public TransactionalFeature txFeature;\n+\n+    protected DocumentModel parent;\n+\n+    @Before\n+    public void before() {\n+        parent = session.createDocumentModel(\"/\", \"foo\", \"File\");\n+        parent = session.createDocument(parent);\n+    }\n+\n+    @Test\n+    public void testFileImport() throws OperationException {\n+        try (OperationContext ctx = new OperationContext(session)) {\n+            ctx.setInput(parent);\n+            Map<String, Serializable> params = new HashMap<>();\n+            params.put(\"title\", \"bar\");\n+\n+            DocumentModel doc = (DocumentModel) service.run(ctx, FileManagerImport.ID, params);\n+            assertNotNull(doc);\n+            assertNotNull(doc.getId());\n+            assertEquals(\"File\", doc.getType());\n+            assertEquals(\"bar\", doc.getName());\n+            assertEquals(\"/foo/bar\", doc.getPathAsString());\n+            assertEquals(\"bar\", doc.getTitle());\n+        }\n+    }\n+\n+    @Test\n+    public void testFileImportOverwrite() throws OperationException {\n+        // first create a file\n+        DocumentModel file = session.createDocumentModel(parent.getPathAsString(), \"bar\", \"File\");\n+        file.setPropertyValue(\"dc:title\", \"bar\");\n+        file.setPropertyValue(\"dc:description\", \"foobar\");\n+        file = session.createDocument(file);\n+        txFeature.nextTransaction();\n+\n+        try (OperationContext ctx = new OperationContext(session)) {\n+            ctx.setInput(parent);\n+            Map<String, Serializable> params = new HashMap<>();\n+            params.put(\"title\", \"bar\");\n+            params.put(\"overwrite\", true);\n+\n+            DocumentModel doc = (DocumentModel) service.run(ctx, FileManagerImport.ID, params);\n+            assertNotNull(doc);\n+            assertNotNull(doc.getId());\n+            assertEquals(file.getId(), doc.getId());\n+            assertEquals(\"File\", doc.getType());\n+            assertEquals(\"bar\", doc.getName());\n+            assertEquals(\"/foo/bar\", doc.getPathAsString());\n+            assertEquals(\"bar\", doc.getTitle());\n+            assertEquals(\"foobar\", doc.getPropertyValue(\"dc:description\"));\n+        }\n+    }\n+\n+    @Test\n+    public void testFileImportNoOverwrite() throws OperationException {\n+        // first create a file\n+        DocumentModel file = session.createDocumentModel(parent.getPathAsString(), \"bar\", \"File\");\n+        file.setPropertyValue(\"dc:title\", \"bar\");\n+        file.setPropertyValue(\"dc:description\", \"foobar\");\n+        file = session.createDocument(file);\n+\n+        // no overwrite\n+        try (OperationContext ctx = new OperationContext(session)) {\n+            ctx.setInput(parent);\n+            Map<String, Serializable> params = new HashMap<>();\n+            params.put(\"title\", \"bar\");", "originalCommit": "c1702cf6c38b2060e2c91385079ca54c553497c4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzUwNzQxMw==", "url": "https://github.com/nuxeo/nuxeo/pull/4221#discussion_r457507413", "bodyText": "title param doesn't exist", "author": "ataillefer", "createdAt": "2020-07-20T15:43:13Z", "path": "modules/platform/nuxeo-automation/nuxeo-automation-features/src/test/java/org/nuxeo/ecm/automation/core/operations/services/TestFileManagerImport.java", "diffHunk": "@@ -0,0 +1,173 @@\n+/*\n+ * (C) Copyright 2020 Nuxeo (http://nuxeo.com/) and others.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ * Contributors:\n+ *     Micka\u00ebl Schoentgen <mschoentgen@nuxeo.com>\n+ */\n+\n+package org.nuxeo.ecm.automation.core.operations.services;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNotEquals;\n+import static org.junit.Assert.assertNotNull;\n+\n+import java.io.Serializable;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import javax.inject.Inject;\n+\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.nuxeo.ecm.automation.AutomationService;\n+import org.nuxeo.ecm.automation.OperationContext;\n+import org.nuxeo.ecm.automation.OperationException;\n+import org.nuxeo.ecm.core.api.CoreSession;\n+import org.nuxeo.ecm.core.api.DocumentModel;\n+import org.nuxeo.ecm.core.test.CoreFeature;\n+import org.nuxeo.runtime.test.runner.Deploy;\n+import org.nuxeo.runtime.test.runner.Features;\n+import org.nuxeo.runtime.test.runner.FeaturesRunner;\n+import org.nuxeo.runtime.test.runner.TransactionalFeature;\n+\n+/**\n+ * @since 11.2\n+ */\n+@RunWith(FeaturesRunner.class)\n+@Features(CoreFeature.class)\n+@Deploy(\"org.nuxeo.ecm.platform.types.api\")\n+@Deploy(\"org.nuxeo.ecm.platform.types.core\")\n+@Deploy(\"org.nuxeo.ecm.platform.filemanager.api\")\n+@Deploy(\"org.nuxeo.ecm.platform.filemanager.core\")\n+@Deploy(\"org.nuxeo.ecm.automation.core\")\n+@Deploy(\"org.nuxeo.ecm.automation.features\")\n+@Deploy(\"org.nuxeo.ecm.platform.webapp.types\")\n+public class TestFileManagerImport {\n+\n+    @Inject\n+    protected CoreSession session;\n+\n+    @Inject\n+    protected AutomationService service;\n+\n+    @Inject\n+    public TransactionalFeature txFeature;\n+\n+    protected DocumentModel parent;\n+\n+    @Before\n+    public void before() {\n+        parent = session.createDocumentModel(\"/\", \"foo\", \"File\");\n+        parent = session.createDocument(parent);\n+    }\n+\n+    @Test\n+    public void testFileImport() throws OperationException {\n+        try (OperationContext ctx = new OperationContext(session)) {\n+            ctx.setInput(parent);\n+            Map<String, Serializable> params = new HashMap<>();\n+            params.put(\"title\", \"bar\");\n+\n+            DocumentModel doc = (DocumentModel) service.run(ctx, FileManagerImport.ID, params);\n+            assertNotNull(doc);\n+            assertNotNull(doc.getId());\n+            assertEquals(\"File\", doc.getType());\n+            assertEquals(\"bar\", doc.getName());\n+            assertEquals(\"/foo/bar\", doc.getPathAsString());\n+            assertEquals(\"bar\", doc.getTitle());\n+        }\n+    }\n+\n+    @Test\n+    public void testFileImportOverwrite() throws OperationException {\n+        // first create a file\n+        DocumentModel file = session.createDocumentModel(parent.getPathAsString(), \"bar\", \"File\");\n+        file.setPropertyValue(\"dc:title\", \"bar\");\n+        file.setPropertyValue(\"dc:description\", \"foobar\");\n+        file = session.createDocument(file);\n+        txFeature.nextTransaction();\n+\n+        try (OperationContext ctx = new OperationContext(session)) {\n+            ctx.setInput(parent);\n+            Map<String, Serializable> params = new HashMap<>();\n+            params.put(\"title\", \"bar\");\n+            params.put(\"overwrite\", true);\n+\n+            DocumentModel doc = (DocumentModel) service.run(ctx, FileManagerImport.ID, params);\n+            assertNotNull(doc);\n+            assertNotNull(doc.getId());\n+            assertEquals(file.getId(), doc.getId());\n+            assertEquals(\"File\", doc.getType());\n+            assertEquals(\"bar\", doc.getName());\n+            assertEquals(\"/foo/bar\", doc.getPathAsString());\n+            assertEquals(\"bar\", doc.getTitle());\n+            assertEquals(\"foobar\", doc.getPropertyValue(\"dc:description\"));\n+        }\n+    }\n+\n+    @Test\n+    public void testFileImportNoOverwrite() throws OperationException {\n+        // first create a file\n+        DocumentModel file = session.createDocumentModel(parent.getPathAsString(), \"bar\", \"File\");\n+        file.setPropertyValue(\"dc:title\", \"bar\");\n+        file.setPropertyValue(\"dc:description\", \"foobar\");\n+        file = session.createDocument(file);\n+\n+        // no overwrite\n+        try (OperationContext ctx = new OperationContext(session)) {\n+            ctx.setInput(parent);\n+            Map<String, Serializable> params = new HashMap<>();\n+            params.put(\"title\", \"bar\");\n+\n+            DocumentModel doc = (DocumentModel) service.run(ctx, FileManagerImport.ID, params);\n+            assertNotNull(doc);\n+            assertNotNull(doc.getId());\n+            assertNotEquals(file.getId(), doc.getId());\n+            assertEquals(\"File\", doc.getType());\n+            assertNotEquals(\"bar\", doc.getName());\n+            assertNotEquals(\"/foo/bar\", doc.getPathAsString());\n+            assertEquals(\"bar\", doc.getTitle());\n+        }\n+    }\n+\n+    @Test\n+    public void testFileImportDeprecatedOverwite() throws OperationException {\n+        // first create a file\n+        DocumentModel file = session.createDocumentModel(parent.getPathAsString(), \"bar\", \"File\");\n+        file.setPropertyValue(\"dc:title\", \"bar\");\n+        file.setPropertyValue(\"dc:description\", \"foobar\");\n+        file = session.createDocument(file);\n+        txFeature.nextTransaction();\n+\n+        // the deprecated \"overwite\" parameter should still be taken into account\n+        try (OperationContext ctx = new OperationContext(session)) {\n+            ctx.setInput(parent);\n+            Map<String, Serializable> params = new HashMap<>();\n+            params.put(\"title\", \"bar\");", "originalCommit": "c1702cf6c38b2060e2c91385079ca54c553497c4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzUwNzU4Ng==", "url": "https://github.com/nuxeo/nuxeo/pull/4221#discussion_r457507586", "bodyText": "Could be removed since it's included by the next assertion.", "author": "ataillefer", "createdAt": "2020-07-20T15:43:28Z", "path": "modules/platform/nuxeo-automation/nuxeo-automation-features/src/test/java/org/nuxeo/ecm/automation/core/operations/services/TestFileManagerImport.java", "diffHunk": "@@ -0,0 +1,173 @@\n+/*\n+ * (C) Copyright 2020 Nuxeo (http://nuxeo.com/) and others.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ * Contributors:\n+ *     Micka\u00ebl Schoentgen <mschoentgen@nuxeo.com>\n+ */\n+\n+package org.nuxeo.ecm.automation.core.operations.services;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNotEquals;\n+import static org.junit.Assert.assertNotNull;\n+\n+import java.io.Serializable;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import javax.inject.Inject;\n+\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.nuxeo.ecm.automation.AutomationService;\n+import org.nuxeo.ecm.automation.OperationContext;\n+import org.nuxeo.ecm.automation.OperationException;\n+import org.nuxeo.ecm.core.api.CoreSession;\n+import org.nuxeo.ecm.core.api.DocumentModel;\n+import org.nuxeo.ecm.core.test.CoreFeature;\n+import org.nuxeo.runtime.test.runner.Deploy;\n+import org.nuxeo.runtime.test.runner.Features;\n+import org.nuxeo.runtime.test.runner.FeaturesRunner;\n+import org.nuxeo.runtime.test.runner.TransactionalFeature;\n+\n+/**\n+ * @since 11.2\n+ */\n+@RunWith(FeaturesRunner.class)\n+@Features(CoreFeature.class)\n+@Deploy(\"org.nuxeo.ecm.platform.types.api\")\n+@Deploy(\"org.nuxeo.ecm.platform.types.core\")\n+@Deploy(\"org.nuxeo.ecm.platform.filemanager.api\")\n+@Deploy(\"org.nuxeo.ecm.platform.filemanager.core\")\n+@Deploy(\"org.nuxeo.ecm.automation.core\")\n+@Deploy(\"org.nuxeo.ecm.automation.features\")\n+@Deploy(\"org.nuxeo.ecm.platform.webapp.types\")\n+public class TestFileManagerImport {\n+\n+    @Inject\n+    protected CoreSession session;\n+\n+    @Inject\n+    protected AutomationService service;\n+\n+    @Inject\n+    public TransactionalFeature txFeature;\n+\n+    protected DocumentModel parent;\n+\n+    @Before\n+    public void before() {\n+        parent = session.createDocumentModel(\"/\", \"foo\", \"File\");\n+        parent = session.createDocument(parent);\n+    }\n+\n+    @Test\n+    public void testFileImport() throws OperationException {\n+        try (OperationContext ctx = new OperationContext(session)) {\n+            ctx.setInput(parent);\n+            Map<String, Serializable> params = new HashMap<>();\n+            params.put(\"title\", \"bar\");\n+\n+            DocumentModel doc = (DocumentModel) service.run(ctx, FileManagerImport.ID, params);\n+            assertNotNull(doc);\n+            assertNotNull(doc.getId());\n+            assertEquals(\"File\", doc.getType());\n+            assertEquals(\"bar\", doc.getName());\n+            assertEquals(\"/foo/bar\", doc.getPathAsString());\n+            assertEquals(\"bar\", doc.getTitle());\n+        }\n+    }\n+\n+    @Test\n+    public void testFileImportOverwrite() throws OperationException {\n+        // first create a file\n+        DocumentModel file = session.createDocumentModel(parent.getPathAsString(), \"bar\", \"File\");\n+        file.setPropertyValue(\"dc:title\", \"bar\");\n+        file.setPropertyValue(\"dc:description\", \"foobar\");\n+        file = session.createDocument(file);\n+        txFeature.nextTransaction();\n+\n+        try (OperationContext ctx = new OperationContext(session)) {\n+            ctx.setInput(parent);\n+            Map<String, Serializable> params = new HashMap<>();\n+            params.put(\"title\", \"bar\");\n+            params.put(\"overwrite\", true);\n+\n+            DocumentModel doc = (DocumentModel) service.run(ctx, FileManagerImport.ID, params);\n+            assertNotNull(doc);\n+            assertNotNull(doc.getId());\n+            assertEquals(file.getId(), doc.getId());\n+            assertEquals(\"File\", doc.getType());\n+            assertEquals(\"bar\", doc.getName());\n+            assertEquals(\"/foo/bar\", doc.getPathAsString());\n+            assertEquals(\"bar\", doc.getTitle());\n+            assertEquals(\"foobar\", doc.getPropertyValue(\"dc:description\"));\n+        }\n+    }\n+\n+    @Test\n+    public void testFileImportNoOverwrite() throws OperationException {\n+        // first create a file\n+        DocumentModel file = session.createDocumentModel(parent.getPathAsString(), \"bar\", \"File\");\n+        file.setPropertyValue(\"dc:title\", \"bar\");\n+        file.setPropertyValue(\"dc:description\", \"foobar\");\n+        file = session.createDocument(file);\n+\n+        // no overwrite\n+        try (OperationContext ctx = new OperationContext(session)) {\n+            ctx.setInput(parent);\n+            Map<String, Serializable> params = new HashMap<>();\n+            params.put(\"title\", \"bar\");\n+\n+            DocumentModel doc = (DocumentModel) service.run(ctx, FileManagerImport.ID, params);\n+            assertNotNull(doc);\n+            assertNotNull(doc.getId());\n+            assertNotEquals(file.getId(), doc.getId());\n+            assertEquals(\"File\", doc.getType());\n+            assertNotEquals(\"bar\", doc.getName());\n+            assertNotEquals(\"/foo/bar\", doc.getPathAsString());\n+            assertEquals(\"bar\", doc.getTitle());\n+        }\n+    }\n+\n+    @Test\n+    public void testFileImportDeprecatedOverwite() throws OperationException {\n+        // first create a file\n+        DocumentModel file = session.createDocumentModel(parent.getPathAsString(), \"bar\", \"File\");\n+        file.setPropertyValue(\"dc:title\", \"bar\");\n+        file.setPropertyValue(\"dc:description\", \"foobar\");\n+        file = session.createDocument(file);\n+        txFeature.nextTransaction();\n+\n+        // the deprecated \"overwite\" parameter should still be taken into account\n+        try (OperationContext ctx = new OperationContext(session)) {\n+            ctx.setInput(parent);\n+            Map<String, Serializable> params = new HashMap<>();\n+            params.put(\"title\", \"bar\");\n+            params.put(\"overwite\", true);\n+\n+            DocumentModel doc = (DocumentModel) service.run(ctx, FileManagerImport.ID, params);\n+            assertNotNull(doc);\n+            assertNotNull(doc.getId());", "originalCommit": "c1702cf6c38b2060e2c91385079ca54c553497c4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "fb1be29e3c1f3baf2e15ad26981db9e4b7c2e27a", "url": "https://github.com/nuxeo/nuxeo/commit/fb1be29e3c1f3baf2e15ad26981db9e4b7c2e27a", "message": "NXP-29286: rename the parameter \"overwite\" of FileManager.Import to \"overwrite\"", "committedDate": "2020-07-22T16:08:23Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTMxMzAwOA==", "url": "https://github.com/nuxeo/nuxeo/pull/4221#discussion_r459313008", "bodyText": "= null is not needed", "author": "ataillefer", "createdAt": "2020-07-23T09:07:48Z", "path": "modules/platform/nuxeo-automation/nuxeo-automation-features/src/test/java/org/nuxeo/ecm/automation/core/operations/services/TestFileManagerImport.java", "diffHunk": "@@ -0,0 +1,183 @@\n+/*\n+ * (C) Copyright 2020 Nuxeo (http://nuxeo.com/) and others.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ * Contributors:\n+ *     Micka\u00ebl Schoentgen <mschoentgen@nuxeo.com>\n+ */\n+\n+package org.nuxeo.ecm.automation.core.operations.services;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNotEquals;\n+import static org.junit.Assert.assertNotNull;\n+\n+import java.io.Serializable;\n+import java.util.Map;\n+\n+import javax.inject.Inject;\n+\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.nuxeo.ecm.automation.AutomationService;\n+import org.nuxeo.ecm.automation.OperationContext;\n+import org.nuxeo.ecm.automation.OperationException;\n+import org.nuxeo.ecm.core.api.Blob;\n+import org.nuxeo.ecm.core.api.Blobs;\n+import org.nuxeo.ecm.core.api.CoreSession;\n+import org.nuxeo.ecm.core.api.DocumentModel;\n+import org.nuxeo.ecm.core.test.CoreFeature;\n+import org.nuxeo.runtime.test.runner.Deploy;\n+import org.nuxeo.runtime.test.runner.Features;\n+import org.nuxeo.runtime.test.runner.FeaturesRunner;\n+import org.nuxeo.runtime.test.runner.TransactionalFeature;\n+\n+/**\n+ * @since 11.2\n+ */\n+@RunWith(FeaturesRunner.class)\n+@Features(CoreFeature.class)\n+@Deploy(\"org.nuxeo.ecm.platform.types.api\")\n+@Deploy(\"org.nuxeo.ecm.platform.types.core\")\n+@Deploy(\"org.nuxeo.ecm.platform.filemanager.api\")\n+@Deploy(\"org.nuxeo.ecm.platform.filemanager.core\")\n+@Deploy(\"org.nuxeo.ecm.automation.core\")\n+@Deploy(\"org.nuxeo.ecm.automation.features\")\n+public class TestFileManagerImport {\n+\n+    @Inject\n+    protected CoreSession session;\n+\n+    @Inject\n+    protected AutomationService service;\n+\n+    @Inject\n+    public TransactionalFeature txFeature;\n+\n+    protected Blob textBlob;\n+    protected String fileName = \"foo.txt\";\n+    protected String filePath = \"/foo.txt\";\n+\n+    @Before\n+    public void before() {\n+        textBlob = Blobs.createBlob(\"foo\", \"application/octet-stream\", null, fileName);\n+    }\n+    \n+    @Test\n+    public void testFileImport() throws OperationException {\n+        try (OperationContext ctx = new OperationContext(session)) {\n+            ctx.setInput(textBlob);\n+            ctx.put(\"currentDocument\", \"/\");\n+\n+            DocumentModel doc = (DocumentModel) service.run(ctx, FileManagerImport.ID);\n+            assertNotNull(doc);\n+            assertNotNull(doc.getId());\n+            assertEquals(\"Note\", doc.getType());\n+            assertEquals(fileName, doc.getName());\n+            assertEquals(filePath, doc.getPathAsString());\n+            assertEquals(fileName, doc.getTitle());\n+        }\n+    }\n+\n+    @Test\n+    public void testFileImportNoMimeTypeCheck() throws OperationException {\n+        // mime type check is true by default, a Note should be created\n+        try (OperationContext ctx = new OperationContext(session)) {\n+            ctx.setInput(textBlob);\n+            ctx.put(\"currentDocument\", \"/\");\n+\n+            DocumentModel doc = (DocumentModel) service.run(ctx, FileManagerImport.ID);\n+            assertEquals(\"Note\", doc.getType());\n+        }\n+    }\n+\n+    @Test\n+    public void testFileImportNoNoMimeTypeCheck() throws OperationException {\n+        // no mime type check, a File should be created\n+        try (OperationContext ctx = new OperationContext(session)) {\n+            ctx.setInput(textBlob);\n+            ctx.put(\"currentDocument\", \"/\");\n+\n+            Map<String, Serializable> params = Map.of(\"noMimeTypeCheck\", true);\n+            DocumentModel doc = (DocumentModel) service.run(ctx, FileManagerImport.ID, params);\n+            assertEquals(\"File\", doc.getType());\n+        }\n+    }\n+\n+    @Test\n+    public void testFileImportOverwrite() throws OperationException {\n+        DocumentModel file = null;", "originalCommit": "fb1be29e3c1f3baf2e15ad26981db9e4b7c2e27a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTMxODMzNw==", "url": "https://github.com/nuxeo/nuxeo/pull/4221#discussion_r459318337", "bodyText": "I'm wondering if this test could not be removed since this case is tested by the above test.\nYou could simply include the inline comment in the above test.", "author": "ataillefer", "createdAt": "2020-07-23T09:17:52Z", "path": "modules/platform/nuxeo-automation/nuxeo-automation-features/src/test/java/org/nuxeo/ecm/automation/core/operations/services/TestFileManagerImport.java", "diffHunk": "@@ -0,0 +1,183 @@\n+/*\n+ * (C) Copyright 2020 Nuxeo (http://nuxeo.com/) and others.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ * Contributors:\n+ *     Micka\u00ebl Schoentgen <mschoentgen@nuxeo.com>\n+ */\n+\n+package org.nuxeo.ecm.automation.core.operations.services;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNotEquals;\n+import static org.junit.Assert.assertNotNull;\n+\n+import java.io.Serializable;\n+import java.util.Map;\n+\n+import javax.inject.Inject;\n+\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.nuxeo.ecm.automation.AutomationService;\n+import org.nuxeo.ecm.automation.OperationContext;\n+import org.nuxeo.ecm.automation.OperationException;\n+import org.nuxeo.ecm.core.api.Blob;\n+import org.nuxeo.ecm.core.api.Blobs;\n+import org.nuxeo.ecm.core.api.CoreSession;\n+import org.nuxeo.ecm.core.api.DocumentModel;\n+import org.nuxeo.ecm.core.test.CoreFeature;\n+import org.nuxeo.runtime.test.runner.Deploy;\n+import org.nuxeo.runtime.test.runner.Features;\n+import org.nuxeo.runtime.test.runner.FeaturesRunner;\n+import org.nuxeo.runtime.test.runner.TransactionalFeature;\n+\n+/**\n+ * @since 11.2\n+ */\n+@RunWith(FeaturesRunner.class)\n+@Features(CoreFeature.class)\n+@Deploy(\"org.nuxeo.ecm.platform.types.api\")\n+@Deploy(\"org.nuxeo.ecm.platform.types.core\")\n+@Deploy(\"org.nuxeo.ecm.platform.filemanager.api\")\n+@Deploy(\"org.nuxeo.ecm.platform.filemanager.core\")\n+@Deploy(\"org.nuxeo.ecm.automation.core\")\n+@Deploy(\"org.nuxeo.ecm.automation.features\")\n+public class TestFileManagerImport {\n+\n+    @Inject\n+    protected CoreSession session;\n+\n+    @Inject\n+    protected AutomationService service;\n+\n+    @Inject\n+    public TransactionalFeature txFeature;\n+\n+    protected Blob textBlob;\n+    protected String fileName = \"foo.txt\";\n+    protected String filePath = \"/foo.txt\";\n+\n+    @Before\n+    public void before() {\n+        textBlob = Blobs.createBlob(\"foo\", \"application/octet-stream\", null, fileName);\n+    }\n+    \n+    @Test\n+    public void testFileImport() throws OperationException {\n+        try (OperationContext ctx = new OperationContext(session)) {\n+            ctx.setInput(textBlob);\n+            ctx.put(\"currentDocument\", \"/\");\n+\n+            DocumentModel doc = (DocumentModel) service.run(ctx, FileManagerImport.ID);\n+            assertNotNull(doc);\n+            assertNotNull(doc.getId());\n+            assertEquals(\"Note\", doc.getType());\n+            assertEquals(fileName, doc.getName());\n+            assertEquals(filePath, doc.getPathAsString());\n+            assertEquals(fileName, doc.getTitle());\n+        }\n+    }\n+\n+    @Test\n+    public void testFileImportNoMimeTypeCheck() throws OperationException {", "originalCommit": "fb1be29e3c1f3baf2e15ad26981db9e4b7c2e27a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTMxODY4Ng==", "url": "https://github.com/nuxeo/nuxeo/pull/4221#discussion_r459318686", "bodyText": "We usually add blank lines between fields.", "author": "ataillefer", "createdAt": "2020-07-23T09:18:32Z", "path": "modules/platform/nuxeo-automation/nuxeo-automation-features/src/test/java/org/nuxeo/ecm/automation/core/operations/services/TestFileManagerImport.java", "diffHunk": "@@ -0,0 +1,183 @@\n+/*\n+ * (C) Copyright 2020 Nuxeo (http://nuxeo.com/) and others.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ * Contributors:\n+ *     Micka\u00ebl Schoentgen <mschoentgen@nuxeo.com>\n+ */\n+\n+package org.nuxeo.ecm.automation.core.operations.services;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNotEquals;\n+import static org.junit.Assert.assertNotNull;\n+\n+import java.io.Serializable;\n+import java.util.Map;\n+\n+import javax.inject.Inject;\n+\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.nuxeo.ecm.automation.AutomationService;\n+import org.nuxeo.ecm.automation.OperationContext;\n+import org.nuxeo.ecm.automation.OperationException;\n+import org.nuxeo.ecm.core.api.Blob;\n+import org.nuxeo.ecm.core.api.Blobs;\n+import org.nuxeo.ecm.core.api.CoreSession;\n+import org.nuxeo.ecm.core.api.DocumentModel;\n+import org.nuxeo.ecm.core.test.CoreFeature;\n+import org.nuxeo.runtime.test.runner.Deploy;\n+import org.nuxeo.runtime.test.runner.Features;\n+import org.nuxeo.runtime.test.runner.FeaturesRunner;\n+import org.nuxeo.runtime.test.runner.TransactionalFeature;\n+\n+/**\n+ * @since 11.2\n+ */\n+@RunWith(FeaturesRunner.class)\n+@Features(CoreFeature.class)\n+@Deploy(\"org.nuxeo.ecm.platform.types.api\")\n+@Deploy(\"org.nuxeo.ecm.platform.types.core\")\n+@Deploy(\"org.nuxeo.ecm.platform.filemanager.api\")\n+@Deploy(\"org.nuxeo.ecm.platform.filemanager.core\")\n+@Deploy(\"org.nuxeo.ecm.automation.core\")\n+@Deploy(\"org.nuxeo.ecm.automation.features\")\n+public class TestFileManagerImport {\n+\n+    @Inject\n+    protected CoreSession session;\n+\n+    @Inject\n+    protected AutomationService service;\n+\n+    @Inject\n+    public TransactionalFeature txFeature;\n+\n+    protected Blob textBlob;\n+    protected String fileName = \"foo.txt\";", "originalCommit": "fb1be29e3c1f3baf2e15ad26981db9e4b7c2e27a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTMxOTc3OQ==", "url": "https://github.com/nuxeo/nuxeo/pull/4221#discussion_r459319779", "bodyText": "In fact, I'm wondering if we should not keep the deprecated field, along with using an alias, just to make sure someone possibly extending this class won't have its compilation broken.\n@troger WDYT?", "author": "ataillefer", "createdAt": "2020-07-23T09:20:42Z", "path": "modules/platform/nuxeo-automation/nuxeo-automation-features/src/main/java/org/nuxeo/ecm/automation/core/operations/services/FileManagerImport.java", "diffHunk": "@@ -63,8 +63,8 @@\n     @Context\n     protected OperationContext context;\n \n-    @Param(name = \"overwite\", required = false)\n-    protected Boolean overwite = false;\n+    @Param(name = \"overwrite\", alias = \"overwite\", required = false)\n+    protected Boolean overwrite = false;", "originalCommit": "fb1be29e3c1f3baf2e15ad26981db9e4b7c2e27a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "863b938ba0acea9aa77ca5a82204bf7cb326e5f6", "url": "https://github.com/nuxeo/nuxeo/commit/863b938ba0acea9aa77ca5a82204bf7cb326e5f6", "message": "NXP-29286: rename the parameter \"overwite\" of FileManager.Import to \"overwrite\"", "committedDate": "2020-07-23T12:40:42Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTQyNDIwOQ==", "url": "https://github.com/nuxeo/nuxeo/pull/4221#discussion_r459424209", "bodyText": "Can you please replace this by a Java constant, aka:\nprotected static final String FILE_NAME = \"foo.txt\";\n\nSame thing for filePath -> FILE_PATH.\nThese 2 fields should be placed before the other members, at the very top of the class.", "author": "ataillefer", "createdAt": "2020-07-23T12:51:27Z", "path": "modules/platform/nuxeo-automation/nuxeo-automation-features/src/test/java/org/nuxeo/ecm/automation/core/operations/services/TestFileManagerImport.java", "diffHunk": "@@ -0,0 +1,174 @@\n+/*\n+ * (C) Copyright 2020 Nuxeo (http://nuxeo.com/) and others.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ * Contributors:\n+ *     Micka\u00ebl Schoentgen <mschoentgen@nuxeo.com>\n+ */\n+\n+package org.nuxeo.ecm.automation.core.operations.services;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNotEquals;\n+import static org.junit.Assert.assertNotNull;\n+\n+import java.io.Serializable;\n+import java.util.Map;\n+\n+import javax.inject.Inject;\n+\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.nuxeo.ecm.automation.AutomationService;\n+import org.nuxeo.ecm.automation.OperationContext;\n+import org.nuxeo.ecm.automation.OperationException;\n+import org.nuxeo.ecm.core.api.Blob;\n+import org.nuxeo.ecm.core.api.Blobs;\n+import org.nuxeo.ecm.core.api.CoreSession;\n+import org.nuxeo.ecm.core.api.DocumentModel;\n+import org.nuxeo.ecm.core.test.CoreFeature;\n+import org.nuxeo.runtime.test.runner.Deploy;\n+import org.nuxeo.runtime.test.runner.Features;\n+import org.nuxeo.runtime.test.runner.FeaturesRunner;\n+import org.nuxeo.runtime.test.runner.TransactionalFeature;\n+\n+/**\n+ * @since 11.2\n+ */\n+@RunWith(FeaturesRunner.class)\n+@Features(CoreFeature.class)\n+@Deploy(\"org.nuxeo.ecm.platform.types.api\")\n+@Deploy(\"org.nuxeo.ecm.platform.types.core\")\n+@Deploy(\"org.nuxeo.ecm.platform.filemanager.api\")\n+@Deploy(\"org.nuxeo.ecm.platform.filemanager.core\")\n+@Deploy(\"org.nuxeo.ecm.automation.core\")\n+@Deploy(\"org.nuxeo.ecm.automation.features\")\n+public class TestFileManagerImport {\n+\n+    @Inject\n+    protected CoreSession session;\n+\n+    @Inject\n+    protected AutomationService service;\n+\n+    @Inject\n+    public TransactionalFeature txFeature;\n+\n+    protected Blob textBlob;\n+\n+    protected String fileName = \"foo.txt\";", "originalCommit": "863b938ba0acea9aa77ca5a82204bf7cb326e5f6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTQzMjQ1Mg==", "url": "https://github.com/nuxeo/nuxeo/pull/4221#discussion_r459432452", "bodyText": "I removed them completely as they are used only one time.", "author": "BoboTiG", "createdAt": "2020-07-23T13:04:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTQyNDIwOQ=="}], "type": "inlineReview"}, {"oid": "ef8f4bf49cc8124d4e695a8ec0df2640aa600665", "url": "https://github.com/nuxeo/nuxeo/commit/ef8f4bf49cc8124d4e695a8ec0df2640aa600665", "message": "NXP-29286: rename the parameter \"overwite\" of FileManager.Import to \"overwrite\"", "committedDate": "2020-07-23T13:00:11Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTQ1NzU3MA==", "url": "https://github.com/nuxeo/nuxeo/pull/4221#discussion_r459457570", "bodyText": "I would have put the comment near the assertion, as in #testFileImport to be consistent :)", "author": "troger", "createdAt": "2020-07-23T13:41:45Z", "path": "modules/platform/nuxeo-automation/nuxeo-automation-features/src/test/java/org/nuxeo/ecm/automation/core/operations/services/TestFileManagerImport.java", "diffHunk": "@@ -0,0 +1,170 @@\n+/*\n+ * (C) Copyright 2020 Nuxeo (http://nuxeo.com/) and others.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ * Contributors:\n+ *     Micka\u00ebl Schoentgen <mschoentgen@nuxeo.com>\n+ */\n+\n+package org.nuxeo.ecm.automation.core.operations.services;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNotEquals;\n+import static org.junit.Assert.assertNotNull;\n+\n+import java.io.Serializable;\n+import java.util.Map;\n+\n+import javax.inject.Inject;\n+\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.nuxeo.ecm.automation.AutomationService;\n+import org.nuxeo.ecm.automation.OperationContext;\n+import org.nuxeo.ecm.automation.OperationException;\n+import org.nuxeo.ecm.core.api.Blob;\n+import org.nuxeo.ecm.core.api.Blobs;\n+import org.nuxeo.ecm.core.api.CoreSession;\n+import org.nuxeo.ecm.core.api.DocumentModel;\n+import org.nuxeo.ecm.core.test.CoreFeature;\n+import org.nuxeo.runtime.test.runner.Deploy;\n+import org.nuxeo.runtime.test.runner.Features;\n+import org.nuxeo.runtime.test.runner.FeaturesRunner;\n+import org.nuxeo.runtime.test.runner.TransactionalFeature;\n+\n+/**\n+ * @since 11.2\n+ */\n+@RunWith(FeaturesRunner.class)\n+@Features(CoreFeature.class)\n+@Deploy(\"org.nuxeo.ecm.platform.types.api\")\n+@Deploy(\"org.nuxeo.ecm.platform.types.core\")\n+@Deploy(\"org.nuxeo.ecm.platform.filemanager.api\")\n+@Deploy(\"org.nuxeo.ecm.platform.filemanager.core\")\n+@Deploy(\"org.nuxeo.ecm.automation.core\")\n+@Deploy(\"org.nuxeo.ecm.automation.features\")\n+public class TestFileManagerImport {\n+\n+    @Inject\n+    protected CoreSession session;\n+\n+    @Inject\n+    protected AutomationService service;\n+\n+    @Inject\n+    public TransactionalFeature txFeature;\n+\n+    protected Blob textBlob;\n+\n+    @Before\n+    public void before() {\n+        textBlob = Blobs.createBlob(\"foo\", \"application/octet-stream\", null, \"foo.txt\");\n+    }\n+\n+    @Test\n+    public void testFileImport() throws OperationException {\n+        try (OperationContext ctx = new OperationContext(session)) {\n+            ctx.setInput(textBlob);\n+            ctx.put(\"currentDocument\", \"/\");\n+\n+            DocumentModel doc = (DocumentModel) service.run(ctx, FileManagerImport.ID);\n+            assertNotNull(doc);\n+            assertNotNull(doc.getId());\n+            // noMimeTypeCheck is false by default, thus a Note should have been created\n+            assertEquals(\"Note\", doc.getType());\n+            assertEquals(\"foo.txt\", doc.getName());\n+            assertEquals(\"/foo.txt\", doc.getPathAsString());\n+            assertEquals(\"foo.txt\", doc.getTitle());\n+        }\n+    }\n+\n+    @Test\n+    public void testFileImportNoNoMimeTypeCheck() throws OperationException {\n+        // no mime type check, a File should be created", "originalCommit": "ef8f4bf49cc8124d4e695a8ec0df2640aa600665", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3c2b4d8293288001f0fa005d081515d1c05f4826", "url": "https://github.com/nuxeo/nuxeo/commit/3c2b4d8293288001f0fa005d081515d1c05f4826", "message": "NXP-29286: rename the parameter \"overwite\" of FileManager.Import to \"overwrite\"", "committedDate": "2020-07-23T15:47:36Z", "type": "commit"}, {"oid": "3c2b4d8293288001f0fa005d081515d1c05f4826", "url": "https://github.com/nuxeo/nuxeo/commit/3c2b4d8293288001f0fa005d081515d1c05f4826", "message": "NXP-29286: rename the parameter \"overwite\" of FileManager.Import to \"overwrite\"", "committedDate": "2020-07-23T15:47:36Z", "type": "forcePushed"}]}