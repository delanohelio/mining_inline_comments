{"pr_number": 4088, "pr_title": "NXP-28950: compute bundle and component deployment order in explorer", "pr_createdAt": "2020-05-28T10:35:58Z", "pr_url": "https://github.com/nuxeo/nuxeo/pull/4088", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc0MTQ0Mw==", "url": "https://github.com/nuxeo/nuxeo/pull/4088#discussion_r431741443", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    checkDeploymentOrder(legacy ? false : true);\n          \n          \n            \n                    checkDeploymentOrder(!legacy);\n          \n      \n    \n    \n  \n\n(same elsewhere)", "author": "efge", "createdAt": "2020-05-28T10:38:26Z", "path": "ftests/nuxeo-platform-explorer-ftests/src/test/java/org/nuxeo/functionaltests/explorer/pages/artifacts/BundleArtifactPage.java", "diffHunk": "@@ -60,16 +67,18 @@ public void checkReference(boolean partial, boolean legacy) {\n         checkGroupId(\"org.nuxeo.ecm.platform\");\n         checkArtifactId(\"nuxeo-apidoc-core\");\n         checkRequirements(null);\n+        checkDeploymentOrder(legacy ? false : true);", "originalCommit": "8c1d61134fa2748c1a5f3c46ac604dfdf48cf7c9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc0MjQ3NQ==", "url": "https://github.com/nuxeo/nuxeo/pull/4088#discussion_r431742475", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (set) {\n          \n          \n            \n                        assertFalse(orderIsBlank);\n          \n          \n            \n                    } else {\n          \n          \n            \n                        assertTrue(orderIsBlank);\n          \n          \n            \n                    }\n          \n          \n            \n                    assertEquals(!set, orderIsBlank);\n          \n      \n    \n    \n  \n\n(same elsewhere)", "author": "efge", "createdAt": "2020-05-28T10:40:32Z", "path": "ftests/nuxeo-platform-explorer-ftests/src/test/java/org/nuxeo/functionaltests/explorer/pages/artifacts/BundleArtifactPage.java", "diffHunk": "@@ -90,4 +99,13 @@ public void checkArtifactId(String id) {\n         assertEquals(id, artifactId.getText());\n     }\n \n+    public void checkDeploymentOrder(boolean set) {\n+        boolean orderIsBlank = StringUtils.isBlank(deploymentOrder.getText());\n+        if (set) {\n+            assertFalse(orderIsBlank);\n+        } else {\n+            assertTrue(orderIsBlank);\n+        }", "originalCommit": "8c1d61134fa2748c1a5f3c46ac604dfdf48cf7c9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc0MzMwNg==", "url": "https://github.com/nuxeo/nuxeo/pull/4088#discussion_r431743306", "bodyText": "Keep newline at end of file", "author": "efge", "createdAt": "2020-05-28T10:42:15Z", "path": "modules/platform/nuxeo-apidoc-server/nuxeo-apidoc-core/src/main/java/org/nuxeo/apidoc/api/ComponentInfo.java", "diffHunk": "@@ -89,4 +96,16 @@\n      */\n     List<String> getRequirements();\n \n-}\n+    /**\n+     * Returns the registration order as indicated by {@link ComponentManager}.\n+     *\n+     * @since 11.1\n+     */\n+    Long getRegistrationOrder();\n+\n+    /**\n+     * @since 11.1\n+     */\n+    void setRegistrationOrder(Long order);\n+\n+}", "originalCommit": "8c1d61134fa2748c1a5f3c46ac604dfdf48cf7c9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc0MzY2OQ==", "url": "https://github.com/nuxeo/nuxeo/pull/4088#discussion_r431743669", "bodyText": "Setter could use a @since 11.1 too for consistency.", "author": "efge", "createdAt": "2020-05-28T10:42:57Z", "path": "modules/platform/nuxeo-apidoc-server/nuxeo-apidoc-core/src/main/java/org/nuxeo/apidoc/api/BundleInfo.java", "diffHunk": "@@ -91,4 +96,13 @@\n      */\n     Blob getParentReadme();\n \n+    /**\n+     * Returns the deployment order as indicated by the runtime context.\n+     *\n+     * @since 11.1\n+     */\n+    Long getDeploymentOrder();\n+\n+    void setDeploymentOrder(Long order);", "originalCommit": "8c1d61134fa2748c1a5f3c46ac604dfdf48cf7c9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc5Njc2Mw==", "url": "https://github.com/nuxeo/nuxeo/pull/4088#discussion_r431796763", "bodyText": "indeed!", "author": "atchertchian", "createdAt": "2020-05-28T12:27:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc0MzY2OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc0NDE2Mw==", "url": "https://github.com/nuxeo/nuxeo/pull/4088#discussion_r431744163", "bodyText": "Could be written this way to minimize space taken, especially on a protected member\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                /**\n          \n          \n            \n                 * @since 11.1\n          \n          \n            \n                 */\n          \n          \n            \n                /** @since 11.1 */", "author": "efge", "createdAt": "2020-05-28T10:43:59Z", "path": "modules/platform/nuxeo-apidoc-server/nuxeo-apidoc-core/src/main/java/org/nuxeo/apidoc/introspection/BundleInfoImpl.java", "diffHunk": "@@ -42,6 +42,9 @@\n \n     protected String manifest;\n \n+    /**\n+     * @since 11.1\n+     */", "originalCommit": "8c1d61134fa2748c1a5f3c46ac604dfdf48cf7c9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc5NzY0OQ==", "url": "https://github.com/nuxeo/nuxeo/pull/4088#discussion_r431797649", "bodyText": "\ud83d\udc4d i'll probably do that kind of cleanup on others independently, then", "author": "atchertchian", "createdAt": "2020-05-28T12:29:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc0NDE2Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc0NDgxNw==", "url": "https://github.com/nuxeo/nuxeo/pull/4088#discussion_r431744817", "bodyText": "If you make registrationOrder a long then autoboxing will allow you to get rid of the Long.valueOf (another instance below for bindex/setDeploymentOrder)", "author": "efge", "createdAt": "2020-05-28T10:45:11Z", "path": "modules/platform/nuxeo-apidoc-server/nuxeo-apidoc-core/src/main/java/org/nuxeo/apidoc/introspection/ServerInfo.java", "diffHunk": "@@ -352,6 +355,8 @@ public static ServerInfo build(String name, String version) {\n             }\n \n             ComponentInfoImpl component = new ComponentInfoImpl(binfo, cname);\n+            component.setRegistrationOrder(Long.valueOf(registrationOrder++));", "originalCommit": "8c1d61134fa2748c1a5f3c46ac604dfdf48cf7c9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTgwMDA0NA==", "url": "https://github.com/nuxeo/nuxeo/pull/4088#discussion_r431800044", "bodyText": "But what if i needed to be able to keep it null (unset), for legacy persisted distribs, typically?", "author": "atchertchian", "createdAt": "2020-05-28T12:33:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc0NDgxNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTgxMzAwOA==", "url": "https://github.com/nuxeo/nuxeo/pull/4088#discussion_r431813008", "bodyText": "Well Long.valueOf(registrationOrder++) is never null, so you might as well take advantage of autoboxing here.", "author": "efge", "createdAt": "2020-05-28T12:55:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc0NDgxNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTgxNjk3Ng==", "url": "https://github.com/nuxeo/nuxeo/pull/4088#discussion_r431816976", "bodyText": "This is on the live distrib (and the same interface is shared with persisted ones)", "author": "atchertchian", "createdAt": "2020-05-28T13:02:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc0NDgxNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTgxNzEyMw==", "url": "https://github.com/nuxeo/nuxeo/pull/4088#discussion_r431817123", "bodyText": "(for now...)", "author": "atchertchian", "createdAt": "2020-05-28T13:02:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc0NDgxNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTgxOTE1NA==", "url": "https://github.com/nuxeo/nuxeo/pull/4088#discussion_r431819154", "bodyText": "I don't get your point.\nMy point is that this:\nint foo = 1;\ncomponent.setRegistrationOrder(Long.valueOf(foo++));\n\nis identical too:\nlong foo = 1;\ncomponent.setRegistrationOrder(foo++);", "author": "efge", "createdAt": "2020-05-28T13:05:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc0NDgxNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTgyNzc5Mw==", "url": "https://github.com/nuxeo/nuxeo/pull/4088#discussion_r431827793", "bodyText": "Ah! sorry got confused, will do (i thought you were talking about changing from \"Long\" to \"long\" in the API, nevermind)", "author": "atchertchian", "createdAt": "2020-05-28T13:19:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc0NDgxNw=="}], "type": "inlineReview"}, {"oid": "30aa992e933eb514b20799e1412354d7997ae859", "url": "https://github.com/nuxeo/nuxeo/commit/30aa992e933eb514b20799e1412354d7997ae859", "message": "NXP-28950: compute bundle and component deployment order in explorer", "committedDate": "2020-05-28T12:43:48Z", "type": "forcePushed"}, {"oid": "56d811fd811ec51ba7df53f5d090d1217fcadcab", "url": "https://github.com/nuxeo/nuxeo/commit/56d811fd811ec51ba7df53f5d090d1217fcadcab", "message": "NXP-28950: compute bundle and component deployment order in explorer", "committedDate": "2020-05-28T13:37:21Z", "type": "commit"}, {"oid": "56d811fd811ec51ba7df53f5d090d1217fcadcab", "url": "https://github.com/nuxeo/nuxeo/commit/56d811fd811ec51ba7df53f5d090d1217fcadcab", "message": "NXP-28950: compute bundle and component deployment order in explorer", "committedDate": "2020-05-28T13:37:21Z", "type": "forcePushed"}]}