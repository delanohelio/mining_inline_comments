{"pr_number": 1008, "pr_title": "Promote Single.TerminalSignalConsumer to top level interface", "pr_createdAt": "2020-04-07T17:02:15Z", "pr_url": "https://github.com/apple/servicetalk/pull/1008", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDk3MDAzMg==", "url": "https://github.com/apple/servicetalk/pull/1008#discussion_r404970032", "bodyText": "I realize I requested to make the conversion classes internal when these types were recently introduced, but if we are going to have to duplicate the code lets just expose it so we can share.", "author": "Scottmitch", "createdAt": "2020-04-07T17:03:26Z", "path": "servicetalk-http-utils/src/main/java/io/servicetalk/http/utils/BeforeFinallyOnHttpResponseOperator.java", "diffHunk": "@@ -254,28 +255,4 @@ public void onComplete() {\n             // Ignore.\n         }\n     }\n-\n-    private static final class RunnableTerminalSignalConsumer implements TerminalSignalConsumer {", "originalCommit": "b796514c85bf1d0d3b36f33f0d25981212c49ed1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDk5MDY1MA==", "url": "https://github.com/apple/servicetalk/pull/1008#discussion_r404990650", "bodyText": "Sad that we can not place it in some -internal module due to the dependencies between modules to share it with http-utils.", "author": "idelpivnitskiy", "createdAt": "2020-04-07T17:35:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDk3MDAzMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTA0MDc1Nw==", "url": "https://github.com/apple/servicetalk/pull/1008#discussion_r405040757", "bodyText": "agreed the API needs to be public in concurrent-api so we would need to push the APIs down to the concurrent module in order to put the utility classes in an -internal module.", "author": "Scottmitch", "createdAt": "2020-04-07T18:57:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDk3MDAzMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDk3MDk0Ng==", "url": "https://github.com/apple/servicetalk/pull/1008#discussion_r404970946", "bodyText": "not strong on internal type vs top level type, but leaning toward external type so it is more consistent with TerminalSignalConsumer and we can expose RunnableSingleTerminalSignalConsumer in the future if necessary without cluttering Single's public exposure.", "author": "Scottmitch", "createdAt": "2020-04-07T17:04:44Z", "path": "servicetalk-concurrent-api/src/main/java/io/servicetalk/concurrent/api/SingleTerminalSignalConsumer.java", "diffHunk": "@@ -0,0 +1,48 @@\n+/*\n+ * Copyright \u00a9 2020 Apple Inc. and the ServiceTalk project authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.servicetalk.concurrent.api;\n+\n+import io.servicetalk.concurrent.Cancellable;\n+import io.servicetalk.concurrent.SingleSource;\n+\n+import javax.annotation.Nullable;\n+\n+/**\n+ * A contract that provides discrete callbacks for various ways in which a {@link SingleSource.Subscriber} can\n+ * terminate.\n+ *\n+ * @param <T> Type of the result of the {@link Single}.\n+ */\n+public interface SingleTerminalSignalConsumer<T> {", "originalCommit": "b796514c85bf1d0d3b36f33f0d25981212c49ed1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDk5MzA5Mg==", "url": "https://github.com/apple/servicetalk/pull/1008#discussion_r404993092", "bodyText": "If we are ok to expose it as public API, alternative could be to add a static method TerminalSignalConsumer.from(Runnable). That will simplify discoverability and be consistent with other interfaces, like HostAndPort, factories, initializers, etc.", "author": "idelpivnitskiy", "createdAt": "2020-04-07T17:39:16Z", "path": "servicetalk-concurrent-api/src/main/java/io/servicetalk/concurrent/api/RunnableTerminalSignalConsumer.java", "diffHunk": "@@ -17,11 +17,17 @@\n \n import static java.util.Objects.requireNonNull;\n \n-final class RunnableTerminalSignalConsumer implements TerminalSignalConsumer {\n-\n+/**\n+ * A {@link TerminalSignalConsumer} where each method executes a {@link Runnable#run()}.\n+ */\n+public final class RunnableTerminalSignalConsumer implements TerminalSignalConsumer {", "originalCommit": "b796514c85bf1d0d3b36f33f0d25981212c49ed1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTA0NjIzNw==", "url": "https://github.com/apple/servicetalk/pull/1008#discussion_r405046237", "bodyText": "done", "author": "Scottmitch", "createdAt": "2020-04-07T19:06:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDk5MzA5Mg=="}], "type": "inlineReview"}, {"oid": "7a39e4cfba92339d4ccffeb0ffc094ca8dcdd888", "url": "https://github.com/apple/servicetalk/commit/7a39e4cfba92339d4ccffeb0ffc094ca8dcdd888", "message": "Promote Single.TerminalSignalConsumer to top level interface\n\nMotivation:\nTerminalSignalConsumer for Completable and Publisher is a top level\ntype, but Single has an internal type for the same purpose. This makes\nit more challenging to expose utilities classes in a consistent manner\nand also may lead to naming collisions.\n\nModifications:\n- Move Single.TerminalSignalConsumer to a top level interface and rename\nto SingleTerminalSignalConsumer to avoid naming collisions.\n- Expose RunnableTerminalSignalConsumer and re-use it in\nBeforeFinallyOnHttpResponseOperator.\n\nResult:\nMore consistent type definition scheme for TerminalSignalConsumer and\nSingleTerminalSignalConsumer and ability to expose conversion/utility\nmethods outside the scope of the Source.", "committedDate": "2020-04-07T18:57:26Z", "type": "commit"}, {"oid": "7a39e4cfba92339d4ccffeb0ffc094ca8dcdd888", "url": "https://github.com/apple/servicetalk/commit/7a39e4cfba92339d4ccffeb0ffc094ca8dcdd888", "message": "Promote Single.TerminalSignalConsumer to top level interface\n\nMotivation:\nTerminalSignalConsumer for Completable and Publisher is a top level\ntype, but Single has an internal type for the same purpose. This makes\nit more challenging to expose utilities classes in a consistent manner\nand also may lead to naming collisions.\n\nModifications:\n- Move Single.TerminalSignalConsumer to a top level interface and rename\nto SingleTerminalSignalConsumer to avoid naming collisions.\n- Expose RunnableTerminalSignalConsumer and re-use it in\nBeforeFinallyOnHttpResponseOperator.\n\nResult:\nMore consistent type definition scheme for TerminalSignalConsumer and\nSingleTerminalSignalConsumer and ability to expose conversion/utility\nmethods outside the scope of the Source.", "committedDate": "2020-04-07T18:57:26Z", "type": "forcePushed"}, {"oid": "d5a891086e5d20893917e8f64bed72232bba6911", "url": "https://github.com/apple/servicetalk/commit/d5a891086e5d20893917e8f64bed72232bba6911", "message": "switch to public static factory on interface", "committedDate": "2020-04-07T19:05:48Z", "type": "commit"}, {"oid": "f29d13491add126845e3abbc62488ee90f305ae6", "url": "https://github.com/apple/servicetalk/commit/f29d13491add126845e3abbc62488ee90f305ae6", "message": "fix check style", "committedDate": "2020-04-07T19:18:45Z", "type": "commit"}]}