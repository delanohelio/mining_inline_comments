{"pr_number": 1073, "pr_title": "Clarify exception when payload body can not be aggregated", "pr_createdAt": "2020-05-29T20:53:46Z", "pr_url": "https://github.com/apple/servicetalk/pull/1073", "timeline": [{"oid": "07f0664dbd832c3b5088ce29cf1cf07ff83a1ed4", "url": "https://github.com/apple/servicetalk/commit/07f0664dbd832c3b5088ce29cf1cf07ff83a1ed4", "message": "Clarify exception when payload body can not be aggregated\n\nMotivation:\n\nAggregation of the payload body may fail due to some reasons.\nFor example, when data size does not fit into `Integer.MAX_VALUE`\nnetty throws `IllegalArgumentException` from the `CompositeByteBuf`.\nTo simplify understanding of the issue we need to wrap the cause\ninto a more meaningful exception type for this context.\n\nMotivation:\n- Introduce `AggregationException` that will be thrown if we can\nnot aggregate payload body;\n\nResult:\n\nBetter debuggabillity experience for users of aggregated API.", "committedDate": "2020-05-29T20:52:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjczNTA2Nw==", "url": "https://github.com/apple/servicetalk/pull/1073#discussion_r432735067", "bodyText": "I question the value of this change after netty/netty#10330 is available. The only benefit I see is that the name of the exception is different in the logs. As the class is private, users can not use the exception to decide further actions. Is that what your intent is?\nIf we create a publicly accessible exception class like TooLongHttpPayloadException then the change makes more sense to me.", "author": "NiteshKant", "createdAt": "2020-05-29T21:05:48Z", "path": "servicetalk-http-api/src/main/java/io/servicetalk/http/api/HttpDataSourceTransformations.java", "diffHunk": "@@ -433,4 +437,12 @@ static RuntimeException newTrailersExpectedButNotSeenException() {\n             }\n         });\n     }\n+\n+    private static final class AggregationException extends IllegalStateException {", "originalCommit": "07f0664dbd832c3b5088ce29cf1cf07ff83a1ed4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjczNzE4OA==", "url": "https://github.com/apple/servicetalk/pull/1073#discussion_r432737188", "bodyText": "The confusion was that IllegalArgumentException is thrown when users don't pass any argument. A more clear instance of IllegalStateException makes more sense in this case.\nI'm ok with making the exception type public.", "author": "idelpivnitskiy", "createdAt": "2020-05-29T21:10:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjczNTA2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjczODIxNw==", "url": "https://github.com/apple/servicetalk/pull/1073#discussion_r432738217", "bodyText": "The confusion was that IllegalArgumentException is thrown when users don't pass any argument. A more clear instance of IllegalStateException makes more sense in this case.\n\nThe benefit is trivial IMO.\n\nI'm ok with making the exception type public.\n\nMy suggestion is to narrow the scope of the exception (only when there is a buffer overflow) and then make it public", "author": "NiteshKant", "createdAt": "2020-05-29T21:13:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjczNTA2Nw=="}], "type": "inlineReview"}, {"oid": "85887875dd2f387e2d9675940b78f3655f4f9366", "url": "https://github.com/apple/servicetalk/commit/85887875dd2f387e2d9675940b78f3655f4f9366", "message": "Throw BufferOverflowException with the original cause", "committedDate": "2020-05-29T21:33:31Z", "type": "commit"}]}