{"pr_number": 910, "pr_title": "Move RPC paths to generated RPC interfaces", "pr_createdAt": "2020-01-07T18:24:04Z", "pr_url": "https://github.com/apple/servicetalk/pull/910", "timeline": [{"oid": "311a04b75e08f4a2c732995696ed1508954bd4c4", "url": "https://github.com/apple/servicetalk/commit/311a04b75e08f4a2c732995696ed1508954bd4c4", "message": "Move RPC paths to generated RPC interfaces\n\n__Motivation__\n\ngRPC generated code uses an `Enum` to define all RPC paths. It is convenient to have all paths together but they are detached from the actual RPC methods for which the paths are defined.\n\n__Modification__\n\n- Remove `RpcPaths` `Enum` from generated code.\n- Generate a `PATH` constant for all individual RPC interfaces.\n- Async interfaces defines the `PATH` constant with the actual path `String`.\n- Blocking interfaces define the `PATH` constant which referr to the async `PATH` constant.\n\n__Result__\n\nRPC paths are attached to the associate RPC interfaces.", "committedDate": "2020-01-07T18:22:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzkxODAyNw==", "url": "https://github.com/apple/servicetalk/pull/910#discussion_r363918027", "bodyText": "What was the reason to decouple async and blocking interfaces generation? The code for them is almost similar. With your changes you will need to do different pathSpecBuilder.initializer depending on the blocking flag. For everything else all conditions were preexisting. Consider reverting the previous logic.", "author": "idelpivnitskiy", "createdAt": "2020-01-07T19:43:17Z", "path": "servicetalk-grpc-protoc/src/main/java/io/servicetalk/grpc/protoc/Generator.java", "diffHunk": "@@ -250,26 +222,50 @@ private void addSerializationProviderInit(final State state, final TypeSpec.Buil\n \n     private void addServiceRpcInterfaces(final State state, final TypeSpec.Builder serviceClassBuilder) {\n         state.serviceRpcInterfaces = new ArrayList<>(2 * state.serviceProto.getMethodCount());\n-\n-        state.serviceProto.getMethodList().forEach(methodProto -> Stream.of(false, true).forEach(blocking -> {\n-            final String name = context.deconflictJavaTypeName((blocking ? Blocking : \"\") +\n+        state.serviceProto.getMethodList().forEach(methodProto -> {\n+            final String name = context.deconflictJavaTypeName(", "originalCommit": "311a04b75e08f4a2c732995696ed1508954bd4c4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzk2NTk1Mw==", "url": "https://github.com/apple/servicetalk/pull/910#discussion_r363965953", "bodyText": "The primary motivation is to have the ability to refer to the corresponding async RPC interface PATH constant. Since we deconflict the name, there is no way to get the same name as was used by the async RPC interface apart from what I am doing here.\nI can extract common code between these two lambdas into a separate method if you prefer but we will have to do the following:\n\nIterate over the methods in proto file to generate async interfaces.\nIterate over the async interfaces to generate the corresponding blocking interfaces.\n\nThis also has a nice side-effect that async and blocking interfaces for the same RPC method has similar names. eg: if the RPC method name is foo but the service name is also foo then with existing code, async RPC name will be Foo0 but blocking interface will be BlockingFoo. After this change the names will be Foo0 and BlockingFoo0 which is nicer.", "author": "NiteshKant", "createdAt": "2020-01-07T21:44:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzkxODAyNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzk2NjkxNQ==", "url": "https://github.com/apple/servicetalk/pull/910#discussion_r363966915", "bodyText": "Agreed, thanks for clarification.", "author": "idelpivnitskiy", "createdAt": "2020-01-07T21:47:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzkxODAyNw=="}], "type": "inlineReview"}]}