{"pr_number": 962, "pr_title": "MultiAddressUrl client fails to send http request after https request", "pr_createdAt": "2020-03-10T17:43:57Z", "pr_url": "https://github.com/apple/servicetalk/pull/962", "timeline": [{"oid": "16c1a4f66390ca40bdfd7661d2baf878b686ccb0", "url": "https://github.com/apple/servicetalk/commit/16c1a4f66390ca40bdfd7661d2baf878b686ccb0", "message": "MultiAddressUrl client fails to send http request after https request\n\nMotivation:\n\nIf `MultiAddressUrl` was used to send an HTTPS request over secure\nconnection, all other requests to a new non-secure servers will fail\nwith `DecoderException`. It happens because we incorrectly copy the\n`HttpClientBuilder` template. We did not create a new instance of\n`TcpClientConfig` and `HttpConfig`.\n\nModifications:\n\n- Add copy ctor for `HttpConfig`;\n- Use copy ctors for `TcpClientConfig` and `HttpConfig` in\n`HttpClientConfig`;\n- Add test to verify that `MultiAddressUrl` client can connect to\ninsecure server after connecting to a secure server and vice versa;\n\nResult:\n\n`HttpClientConfig` makes a full copy of `TcpClientConfig` and\n`HttpConfig` that prevents the `HttpClientBuilder` template from\nmodifications. `MultiAddressUrl` client correctly copies the\nbuilder template without internal state modifications.", "committedDate": "2020-03-10T17:42:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDUzODQ0Ng==", "url": "https://github.com/apple/servicetalk/pull/962#discussion_r390538446", "bodyText": "nit: consider reverting changes which are just about formatting", "author": "normanmaurer", "createdAt": "2020-03-10T18:51:45Z", "path": "servicetalk-http-netty/src/main/java/io/servicetalk/http/netty/DefaultMultiAddressUrlHttpClientBuilder.java", "diffHunk": "@@ -289,8 +289,7 @@ public StreamingHttpClient apply(final UrlKey urlKey) {\n             this.executionContext = requireNonNull(executionContext);\n         }\n \n-        private FilterableStreamingHttpClient selectClient(\n-                HttpRequestMetaData metaData) {\n+        private FilterableStreamingHttpClient selectClient(final HttpRequestMetaData metaData) {", "originalCommit": "16c1a4f66390ca40bdfd7661d2baf878b686ccb0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "c2b09d501029d16a6faa2b6861091212c862bdd1", "url": "https://github.com/apple/servicetalk/commit/c2b09d501029d16a6faa2b6861091212c862bdd1", "message": "revert formatting changes", "committedDate": "2020-03-10T20:30:33Z", "type": "commit"}, {"oid": "e422cffa3b6f41364348f5cbc2cef1a10bdb2f31", "url": "https://github.com/apple/servicetalk/commit/e422cffa3b6f41364348f5cbc2cef1a10bdb2f31", "message": "Update copyright years", "committedDate": "2020-03-10T20:44:47Z", "type": "commit"}]}