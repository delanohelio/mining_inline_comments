{"pr_number": 1045, "pr_title": "Consolidate concurrent.api NULL_TOKEN usage", "pr_createdAt": "2020-05-09T21:31:32Z", "pr_url": "https://github.com/apple/servicetalk/pull/1045", "timeline": [{"oid": "1f4cd5e8ce8ad7f95895b4f51086c00e76a6cb85", "url": "https://github.com/apple/servicetalk/commit/1f4cd5e8ce8ad7f95895b4f51086c00e76a6cb85", "message": "Consolidate concurrent.api NULL_TOKEN usage\n\nMotivation:\nSubscriberApiUtils exposes a NULL_TOKEN to the concurrent.api package\nand usages share common code to wrap/unwrap the null token. This could\ncould be shared into methods instead of duplicated.\n\nModifications:\n- Make SubscriberApiUtils#NULL_TOKEN private\n- Add SubscriberApiUtils wrapNull and unwrapNull methods\n\nResult:\nMore shared code in concurrent.api for wrapping/unwrapping NULL_TOKEN.", "committedDate": "2020-05-09T21:29:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzM5NTMwMA==", "url": "https://github.com/apple/servicetalk/pull/1045#discussion_r423395300", "bodyText": "nit: rename to unwrapNullUnchecked to indicate that no attempt to verify the type is done.", "author": "NiteshKant", "createdAt": "2020-05-12T00:30:12Z", "path": "servicetalk-concurrent-api/src/main/java/io/servicetalk/concurrent/api/SubscriberApiUtils.java", "diffHunk": "@@ -15,13 +15,25 @@\n  */\n package io.servicetalk.concurrent.api;\n \n+import javax.annotation.Nullable;\n+\n final class SubscriberApiUtils {\n-    static final Object NULL_TOKEN = new Object();\n+    private static final Object NULL_TOKEN = new Object();\n     static final int SUBSCRIBER_STATE_IDLE = 0;\n     static final int SUBSCRIBER_STATE_ON_NEXT = 1;\n     static final int SUBSCRIBER_STATE_TERMINATED = 2;\n \n     private SubscriberApiUtils() {\n         // no instances\n     }\n+\n+    static Object wrapNull(@Nullable Object o) {\n+        return o == null ? NULL_TOKEN : o;\n+    }\n+\n+    @SuppressWarnings(\"unchecked\")\n+    @Nullable\n+    static <T> T unwrapNull(Object o) {", "originalCommit": "1f4cd5e8ce8ad7f95895b4f51086c00e76a6cb85", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzM5MzIxOQ==", "url": "https://github.com/apple/servicetalk/pull/1045#discussion_r423393219", "bodyText": "Unused import.", "author": "idelpivnitskiy", "createdAt": "2020-05-12T00:23:23Z", "path": "servicetalk-concurrent-api/src/main/java/io/servicetalk/concurrent/api/PubFirstOrError.java", "diffHunk": "@@ -20,6 +20,8 @@\n import java.util.NoSuchElementException;\n import javax.annotation.Nullable;\n \n+import static io.servicetalk.concurrent.api.SubscriberApiUtils.wrapNull;", "originalCommit": "1f4cd5e8ce8ad7f95895b4f51086c00e76a6cb85", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzM5ODQxMg==", "url": "https://github.com/apple/servicetalk/pull/1045#discussion_r423398412", "bodyText": "You may have been confused because the new method name is the same as before in the parent class. This import is used.", "author": "NiteshKant", "createdAt": "2020-05-12T00:41:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzM5MzIxOQ=="}], "type": "inlineReview"}, {"oid": "a67f68a21d38de830ea4ad153f643cc34683ea68", "url": "https://github.com/apple/servicetalk/commit/a67f68a21d38de830ea4ad153f643cc34683ea68", "message": "unwrapNullUnchecked", "committedDate": "2020-05-12T01:01:37Z", "type": "commit"}]}