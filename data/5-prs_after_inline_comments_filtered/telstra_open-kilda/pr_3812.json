{"pr_number": 3812, "pr_title": "[Server42] fix resources leak closes #3797", "pr_createdAt": "2020-10-28T13:08:49Z", "pr_url": "https://github.com/telstra/open-kilda/pull/3812", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQyOTgxNw==", "url": "https://github.com/telstra/open-kilda/pull/3812#discussion_r513429817", "bodyText": "It will be nice to have a number of sent records here.", "author": "surabujin", "createdAt": "2020-10-28T13:12:25Z", "path": "src-java/server42/server42-control-server-stub/src/main/java/org/openkilda/server42/control/serverstub/StatsServer.java", "diffHunk": "@@ -87,8 +87,10 @@ public void run() {\n                     }\n                 }\n \n-                if (!flows.isEmpty()) {\n-                    server.send(flowBucketBuilder.build().toByteArray());\n+                server.send(flowBucketBuilder.build().toByteArray());\n+                if (flows.isEmpty()) {\n+                    log.info(\"send ping\");\n+                } else {\n                     log.info(\"send stats\");", "originalCommit": "54301119c20b2e253a6c7152a8e547b2bd4551ba", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQzMzcwNw==", "url": "https://github.com/telstra/open-kilda/pull/3812#discussion_r513433707", "bodyText": "Can/should it be done on line Socket server = context.createSocket(ZMQ.PULL);? I suspect that \"some\" resource allocation happens inside .createSocket(...) call, not only inside .connect(...) call.", "author": "surabujin", "createdAt": "2020-10-28T13:17:52Z", "path": "src-java/server42/server42-stats/src/main/java/org/openkilda/server42/stats/zeromq/StatsCollector.java", "diffHunk": "@@ -73,9 +73,13 @@ public void run() {\n         sessionId = RandomStringUtils.randomAlphanumeric(8);\n         log.info(\"started with session id {}\", sessionId);\n         while (!isInterrupted()) {\n-            try (Socket server = context.createSocket(ZMQ.PULL)) {\n+\n+            Socket serverRef = null;\n+            try {\n+                Socket server = context.createSocket(ZMQ.PULL);\n                 server.setReceiveTimeOut(1000);\n                 server.connect(connectEndpoint);\n+                serverRef = server;", "originalCommit": "54301119c20b2e253a6c7152a8e547b2bd4551ba", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ0NDY2NA==", "url": "https://github.com/telstra/open-kilda/pull/3812#discussion_r513444664", "bodyText": "done", "author": "nikitamarchenko", "createdAt": "2020-10-28T13:32:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQzMzcwNw=="}], "type": "inlineReview"}, {"oid": "f772902e4eb13632bd3ca8fdfa50539e22281725", "url": "https://github.com/telstra/open-kilda/commit/f772902e4eb13632bd3ca8fdfa50539e22281725", "message": "[Server42] fix resources leak closes #3797", "committedDate": "2020-10-28T13:31:25Z", "type": "commit"}, {"oid": "f772902e4eb13632bd3ca8fdfa50539e22281725", "url": "https://github.com/telstra/open-kilda/commit/f772902e4eb13632bd3ca8fdfa50539e22281725", "message": "[Server42] fix resources leak closes #3797", "committedDate": "2020-10-28T13:31:25Z", "type": "forcePushed"}]}