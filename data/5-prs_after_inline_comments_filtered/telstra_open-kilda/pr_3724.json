{"pr_number": 3724, "pr_title": "[Server42] Stats app reconnecting", "pr_createdAt": "2020-09-14T17:04:41Z", "pr_url": "https://github.com/telstra/open-kilda/pull/3724", "timeline": [{"oid": "483567e88d0908c641f5ffdf6c7e92c3466ef4bb", "url": "https://github.com/telstra/open-kilda/commit/483567e88d0908c641f5ffdf6c7e92c3466ef4bb", "message": "[Server42] Stats app reconnecting", "committedDate": "2020-09-14T17:02:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQ0NTA1Mg==", "url": "https://github.com/telstra/open-kilda/pull/3724#discussion_r496445052", "bodyText": "why is it break for EAGAIN?", "author": "timofei-durakov", "createdAt": "2020-09-29T06:25:31Z", "path": "src-java/server42/server42-stats/src/main/java/org/openkilda/server42/stats/zeromq/StatsCollector.java", "diffHunk": "@@ -60,25 +73,33 @@ public void run() {\n         sessionId = RandomStringUtils.randomAlphanumeric(8);\n         log.info(\"started with session id {}\", sessionId);\n         while (!isInterrupted()) {\n-            try (ZContext context = new ZContext()) {\n-                Socket server = context.createSocket(ZMQ.PULL);\n-                try {\n-                    server.connect(connectEndpoint);\n-                    while (!isInterrupted()) {\n-                        byte[] recv = server.recv();\n-                        log.debug(\"stats recived\");\n-                        handleInput(recv);\n+            try (Socket server = context.createSocket(ZMQ.PULL)) {\n+                server.setReceiveTimeOut(1000);\n+                server.connect(connectEndpoint);\n+                log.info(\"connect to {}\", connectEndpoint);\n+                while (!isInterrupted()) {\n+                    byte[] recv = server.recv();\n+                    log.debug(\"recv {}\", recv);\n+                    if (recv == null && server.errno() == ZError.EAGAIN) {", "originalCommit": "483567e88d0908c641f5ffdf6c7e92c3466ef4bb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjUxMzgxMw==", "url": "https://github.com/telstra/open-kilda/pull/3724#discussion_r496513813", "bodyText": "That is timeout. I didn't find documentation but I found src https://github.com/zeromq/jeromq/blob/master/src/main/java/zmq/SocketBase.java#L850", "author": "nikitamarchenko", "createdAt": "2020-09-29T08:16:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQ0NTA1Mg=="}], "type": "inlineReview"}]}