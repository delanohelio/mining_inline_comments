{"pr_number": 3093, "pr_title": "Fix the mess with flow endpoints during the flow update", "pr_createdAt": "2020-01-03T20:54:30Z", "pr_url": "https://github.com/telstra/open-kilda/pull/3093", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTczOTkwOA==", "url": "https://github.com/telstra/open-kilda/pull/3093#discussion_r375739908", "bodyText": "Why do we allow to build flow segment requests for \"null\" path?", "author": "sergii-iakovenko", "createdAt": "2020-02-06T10:00:41Z", "path": "services/wfm/src/main/java/org/openkilda/wfm/share/service/SpeakerFlowSegmentRequestBuilder.java", "diffHunk": "@@ -103,22 +103,21 @@ public SpeakerFlowSegmentRequestBuilder(FlowResourcesManager resourcesManager) {\n \n         List<FlowSegmentRequestFactory> requests = new ArrayList<>();\n         requests.addAll(makePathRequests(\n-                path, context, encapsulation, doIngress, doTransit, doEgress));\n+                flow, path, context, encapsulation, doIngress, doTransit, doEgress));\n         if (oppositePath != null) {\n-            if (!flow.isOneSwitchFlow() && oppositePath != null) {\n+            if (!flow.isOneSwitchFlow()) {\n                 encapsulation = getEncapsulation(\n                         flow.getEncapsulationType(), oppositePath.getPathId(), path.getPathId());\n             }\n             requests.addAll(makePathRequests(\n-                    oppositePath, context, encapsulation, doIngress, doTransit, doEgress));\n+                    flow, oppositePath, context, encapsulation, doIngress, doTransit, doEgress));\n         }\n         return requests;\n     }\n \n     private List<FlowSegmentRequestFactory> makePathRequests(\n-            @NonNull FlowPath path, CommandContext context, FlowTransitEncapsulation encapsulation,\n+            Flow flow, FlowPath path, CommandContext context, FlowTransitEncapsulation encapsulation,", "originalCommit": "d0095184f6861762cf996ab7005a3420a8aa5fda", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzc5NTk4OA==", "url": "https://github.com/telstra/open-kilda/pull/3093#discussion_r387795988", "bodyText": "We don't. This is a private method, I have doubts regarding the usefulness of @NonNull annotations for private methods.", "author": "surabujin", "createdAt": "2020-03-04T16:48:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTczOTkwOA=="}], "type": "inlineReview"}, {"oid": "05ae25a2f8c6e1f42851d191191547a288cdd9a8", "url": "https://github.com/telstra/open-kilda/commit/05ae25a2f8c6e1f42851d191191547a288cdd9a8", "message": "Fix mess with flow endpoints duriong update\n\nThe mess happened because of usage inter-object reference stored inside\nobjects. Because there is no \"consistency\" into provided objects on the\ncaller side (at least now it is part of design) it leads to ... mess.\n\nSo always use provided \"parts\" of domain objects and avoid usage of\ninter-objects links/relations.", "committedDate": "2020-03-04T16:44:41Z", "type": "forcePushed"}, {"oid": "3059705aa8bf4d526dd1eab6ff6bba3d025bbdcc", "url": "https://github.com/telstra/open-kilda/commit/3059705aa8bf4d526dd1eab6ff6bba3d025bbdcc", "message": "Fix the mess with flow endpoints during the flow update\n\nThe mess happened because of the usage of inter-object reference stored\ninside objects. The caller code directly defines which objects must be\nused, so service code must not rely on relation stored inside objects.\nOr else... incorrect data will be used for flow segment speaker\nrequests.\n\nSo always use provided \"parts\" of domain objects and avoid usage of\ninter-objects links/relations.", "committedDate": "2020-03-04T16:51:23Z", "type": "forcePushed"}, {"oid": "e2a78386ead7d479bcf4cab04647e0a113b62bec", "url": "https://github.com/telstra/open-kilda/commit/e2a78386ead7d479bcf4cab04647e0a113b62bec", "message": "Fix the mess with flow endpoints during the flow update\n\nThe mess happened because of the usage of inter-object reference stored\ninside objects. The caller code directly defines which objects must be\nused, so service code must not rely on relation stored inside objects.\nOr else... incorrect data will be used for flow segment speaker\nrequests.\n\nSo always use provided \"parts\" of domain objects and avoid usage of\ninter-objects links/relations.", "committedDate": "2020-03-11T14:13:03Z", "type": "forcePushed"}, {"oid": "9012632f032834e3af272399041d6c79419637ed", "url": "https://github.com/telstra/open-kilda/commit/9012632f032834e3af272399041d6c79419637ed", "message": "Fix the mess with flow endpoints during the flow update\n\nThe mess happened because of the usage of inter-object reference stored\ninside objects. The caller code directly defines which objects must be\nused, so service code must not rely on relation stored inside objects.\nOr else... incorrect data will be used for flow segment speaker\nrequests.\n\nSo always use provided \"parts\" of domain objects and avoid usage of\ninter-objects links/relations.", "committedDate": "2020-03-27T08:29:15Z", "type": "commit"}, {"oid": "9012632f032834e3af272399041d6c79419637ed", "url": "https://github.com/telstra/open-kilda/commit/9012632f032834e3af272399041d6c79419637ed", "message": "Fix the mess with flow endpoints during the flow update\n\nThe mess happened because of the usage of inter-object reference stored\ninside objects. The caller code directly defines which objects must be\nused, so service code must not rely on relation stored inside objects.\nOr else... incorrect data will be used for flow segment speaker\nrequests.\n\nSo always use provided \"parts\" of domain objects and avoid usage of\ninter-objects links/relations.", "committedDate": "2020-03-27T08:29:15Z", "type": "forcePushed"}]}