{"pr_number": 3886, "pr_title": "Zero downtime reroute", "pr_createdAt": "2020-11-29T11:15:29Z", "pr_url": "https://github.com/telstra/open-kilda/pull/3886", "timeline": [{"oid": "eb04d412f1ea78bf824f1a3ea264eeeb6bbba0f4", "url": "https://github.com/telstra/open-kilda/commit/eb04d412f1ea78bf824f1a3ea264eeeb6bbba0f4", "message": "Zero-Downtime Reroute", "committedDate": "2020-11-29T11:20:17Z", "type": "forcePushed"}, {"oid": "f5db2bb92610cd77b2134d1f003c89a8ecf237dd", "url": "https://github.com/telstra/open-kilda/commit/f5db2bb92610cd77b2134d1f003c89a8ecf237dd", "message": "Zero-Downtime Reroute", "committedDate": "2020-11-29T12:48:44Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjU5MjY4Nw==", "url": "https://github.com/telstra/open-kilda/pull/3886#discussion_r532592687", "bodyText": "I think we need here\n\t   if (message instanceof CommandMessage) {\n                if(active) {\n                    handleCommandMessage((CommandMessage) message);\n                 }\n            } else if (message instanceof InfoMessage) {\n                handleInfoMessage(message);\n            } else {\n                unhandledInput(tuple);\n            }\n\nTo do not log unhandled tuples if topology is not active", "author": "niksv", "createdAt": "2020-11-30T13:23:33Z", "path": "src-java/reroute-topology/reroute-storm-topology/src/main/java/org/openkilda/wfm/topology/reroute/bolts/RerouteBolt.java", "diffHunk": "@@ -82,14 +87,18 @@ public void prepare(Map stormConf, TopologyContext context, OutputCollector coll\n      */\n     @Override\n     protected void handleInput(Tuple tuple) throws PipelineException {\n-        Message message = pullValue(tuple, FIELD_ID_PAYLOAD, Message.class);\n-\n-        if (message instanceof CommandMessage) {\n-            handleCommandMessage((CommandMessage) message);\n-        } else if (message instanceof InfoMessage) {\n-            handleInfoMessage(message);\n+        if (ZooKeeperSpout.BOLT_ID.equals(tuple.getSourceComponent())) {\n+            LifecycleEvent event = (LifecycleEvent) tuple.getValueByField(FIELD_ID_LIFECYCLE_EVENT);\n+            handleLifeCycleEvent(event);\n         } else {\n-            unhandledInput(tuple);\n+            Message message = pullValue(tuple, FIELD_ID_PAYLOAD, Message.class);\n+            if (active && message instanceof CommandMessage) {\n+                handleCommandMessage((CommandMessage) message);", "originalCommit": "f5db2bb92610cd77b2134d1f003c89a8ecf237dd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "d56387e619ff5685082a1c5d2bb83277bc717583", "url": "https://github.com/telstra/open-kilda/commit/d56387e619ff5685082a1c5d2bb83277bc717583", "message": "Zero-Downtime Reroute", "committedDate": "2020-12-03T06:26:29Z", "type": "forcePushed"}, {"oid": "4c76836ba9283333aa0848132297dc74b293190d", "url": "https://github.com/telstra/open-kilda/commit/4c76836ba9283333aa0848132297dc74b293190d", "message": "Zero-Downtime Reroute", "committedDate": "2020-12-07T09:40:28Z", "type": "forcePushed"}, {"oid": "f32c4cfcfe7e195b4f32db2adc004eaea1e078ee", "url": "https://github.com/telstra/open-kilda/commit/f32c4cfcfe7e195b4f32db2adc004eaea1e078ee", "message": "Zero-Downtime Reroute", "committedDate": "2020-12-09T11:51:51Z", "type": "forcePushed"}, {"oid": "323bae84c112d4323caab995537f2b71f29ef2b2", "url": "https://github.com/telstra/open-kilda/commit/323bae84c112d4323caab995537f2b71f29ef2b2", "message": "Zero-Downtime Reroute", "committedDate": "2020-12-11T15:07:34Z", "type": "forcePushed"}, {"oid": "b3c46383c73930695107d8a1849a274353cf9cac", "url": "https://github.com/telstra/open-kilda/commit/b3c46383c73930695107d8a1849a274353cf9cac", "message": "Zero-Downtime Reroute", "committedDate": "2020-12-14T06:35:41Z", "type": "forcePushed"}, {"oid": "cd1725e69a03ea9118a89621021b20e040a24d0b", "url": "https://github.com/telstra/open-kilda/commit/cd1725e69a03ea9118a89621021b20e040a24d0b", "message": "Zero-Downtime Reroute", "committedDate": "2020-12-17T12:40:24Z", "type": "forcePushed"}, {"oid": "a73316175510c740c9872254d5e89e5eff946501", "url": "https://github.com/telstra/open-kilda/commit/a73316175510c740c9872254d5e89e5eff946501", "message": "Zero-Downtime Reroute", "committedDate": "2020-12-21T19:44:16Z", "type": "forcePushed"}, {"oid": "d64d7bb31705bd75712e848b28cc9aa1895652fd", "url": "https://github.com/telstra/open-kilda/commit/d64d7bb31705bd75712e848b28cc9aa1895652fd", "message": "Zero-Downtime Reroute", "committedDate": "2020-12-23T07:40:39Z", "type": "forcePushed"}, {"oid": "1768fb6833705d4626cfbbb696e433e4e1391cef", "url": "https://github.com/telstra/open-kilda/commit/1768fb6833705d4626cfbbb696e433e4e1391cef", "message": "Zero-Downtime Reroute", "committedDate": "2020-12-28T11:03:41Z", "type": "forcePushed"}, {"oid": "4bc1a96535b7acf08a83d1cd7aeffcb76ba03c81", "url": "https://github.com/telstra/open-kilda/commit/4bc1a96535b7acf08a83d1cd7aeffcb76ba03c81", "message": "Zero-Downtime Reroute", "committedDate": "2021-01-14T14:23:03Z", "type": "forcePushed"}, {"oid": "46d95303fdb37bd76264e1cf0bc289b582895a38", "url": "https://github.com/telstra/open-kilda/commit/46d95303fdb37bd76264e1cf0bc289b582895a38", "message": "Zero-Downtime Reroute", "committedDate": "2021-01-27T08:17:32Z", "type": "forcePushed"}, {"oid": "b08e0f0cff60632bfddccc2a3ab7b1d7d5f0819f", "url": "https://github.com/telstra/open-kilda/commit/b08e0f0cff60632bfddccc2a3ab7b1d7d5f0819f", "message": "Zero-Downtime Reroute", "committedDate": "2021-01-29T06:07:23Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NzUwODI2Mg==", "url": "https://github.com/telstra/open-kilda/pull/3886#discussion_r567508262", "bodyText": "Does it make sense to introduce a dedicated \"build\" method instead of repeating \"getZkTopoName(), getConfig().getBlueGreenMode()\" each time?", "author": "sergii-iakovenko", "createdAt": "2021-02-01T00:16:14Z", "path": "src-java/reroute-topology/reroute-storm-topology/src/main/java/org/openkilda/wfm/topology/reroute/RerouteTopology.java", "diffHunk": "@@ -77,22 +81,41 @@ public StormTopology createTopology() {\n \n         operationQueue(topologyBuilder);\n \n-        KafkaBolt<String, Message> kafkaFlowHsBolt = buildKafkaBolt(topologyConfig.getKafkaFlowHsTopic());\n+        KafkaBolt<String, Message> kafkaFlowHsBolt = buildKafkaBolt(topologyConfig.getKafkaFlowHsTopic(),\n+                getZkTopoName(), getConfig().getBlueGreenMode());", "originalCommit": "b08e0f0cff60632bfddccc2a3ab7b1d7d5f0819f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "576d0126b701fa3632ce3755d8edf3ecf7b53cc7", "url": "https://github.com/telstra/open-kilda/commit/576d0126b701fa3632ce3755d8edf3ecf7b53cc7", "message": "Zero-Downtime Reroute", "committedDate": "2021-02-03T13:02:49Z", "type": "commit"}, {"oid": "576d0126b701fa3632ce3755d8edf3ecf7b53cc7", "url": "https://github.com/telstra/open-kilda/commit/576d0126b701fa3632ce3755d8edf3ecf7b53cc7", "message": "Zero-Downtime Reroute", "committedDate": "2021-02-03T13:02:49Z", "type": "forcePushed"}]}