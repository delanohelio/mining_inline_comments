{"pr_number": 3315, "pr_title": "Extrach ethernet packet body extractor into separate tool", "pr_createdAt": "2020-03-18T17:43:58Z", "pr_url": "https://github.com/telstra/open-kilda/pull/3315", "timeline": [{"oid": "edca2804999fe7d75ff98fc22f07354b96881bf1", "url": "https://github.com/telstra/open-kilda/commit/edca2804999fe7d75ff98fc22f07354b96881bf1", "message": "Extrach ethernet packet body extractor into separate tool", "committedDate": "2020-03-19T11:01:51Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjM3MjI2MA==", "url": "https://github.com/telstra/open-kilda/pull/3315#discussion_r396372260", "bodyText": "why protected? not private?", "author": "niksv", "createdAt": "2020-03-23T11:09:45Z", "path": "src-java/floodlight-service/floodlight-modules/src/main/java/org/openkilda/floodlight/utils/EthernetPacketToolbox.java", "diffHunk": "@@ -0,0 +1,50 @@\n+/* Copyright 2020 Telstra Open Source\n+ *\n+ *   Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *   you may not use this file except in compliance with the License.\n+ *   You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *   Unless required by applicable law or agreed to in writing, software\n+ *   distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *   See the License for the specific language governing permissions and\n+ *   limitations under the License.\n+ */\n+\n+package org.openkilda.floodlight.utils;\n+\n+import org.openkilda.floodlight.shared.packet.VlanTag;\n+\n+import net.floodlightcontroller.packet.Ethernet;\n+import net.floodlightcontroller.packet.IPacket;\n+\n+import java.util.List;\n+\n+public class EthernetPacketToolbox {\n+    public static final EthernetPacketToolbox INSTANCE = new EthernetPacketToolbox();\n+\n+    /**\n+     * Read through intermediate vlan headers up to actual packet payload. Return both payload and vlan stack.\n+     */\n+    public IPacket extractPayload(Ethernet packet, List<Integer> vlanStack) {\n+        short rootVlan = packet.getVlanID();\n+        if (0 < rootVlan) {\n+            vlanStack.add((int) rootVlan);\n+        }\n+\n+        IPacket payload = packet.getPayload();\n+        while (payload instanceof VlanTag) {\n+            short vlanId = ((VlanTag) payload).getVlanId();\n+            vlanStack.add((int) vlanId);\n+            payload = payload.getPayload();\n+        }\n+\n+        return payload;\n+    }\n+\n+    protected EthernetPacketToolbox() {", "originalCommit": "edca2804999fe7d75ff98fc22f07354b96881bf1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzA5OTEwMg==", "url": "https://github.com/telstra/open-kilda/pull/3315#discussion_r397099102", "bodyText": "em. Can't say, replacing it with \"private\".", "author": "surabujin", "createdAt": "2020-03-24T12:00:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjM3MjI2MA=="}], "type": "inlineReview"}, {"oid": "e58c1dfcb0a980fffb8a93d0a83c57aa2a38b5cb", "url": "https://github.com/telstra/open-kilda/commit/e58c1dfcb0a980fffb8a93d0a83c57aa2a38b5cb", "message": "Extrach ethernet packet body extractor into separate tool", "committedDate": "2020-03-24T12:13:05Z", "type": "forcePushed"}, {"oid": "9211d000f36dac24e7e2aee09f53a34a159c13f3", "url": "https://github.com/telstra/open-kilda/commit/9211d000f36dac24e7e2aee09f53a34a159c13f3", "message": "Extrach ethernet packet body extractor into separate tool", "committedDate": "2020-04-06T08:45:41Z", "type": "forcePushed"}, {"oid": "3b7c16af63a1b0956742da1ff4f2a4a665cb8e66", "url": "https://github.com/telstra/open-kilda/commit/3b7c16af63a1b0956742da1ff4f2a4a665cb8e66", "message": "Extrach ethernet packet body extractor into separate tool", "committedDate": "2020-04-06T09:37:21Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTUxNjA1OQ==", "url": "https://github.com/telstra/open-kilda/pull/3315#discussion_r405516059", "bodyText": "nit: this could be a helper class with just static methods, no need to introduce a singleton. This will be less verbose.", "author": "sergii-iakovenko", "createdAt": "2020-04-08T13:16:38Z", "path": "src-java/floodlight-service/floodlight-modules/src/main/java/org/openkilda/floodlight/utils/EthernetPacketToolbox.java", "diffHunk": "@@ -0,0 +1,50 @@\n+/* Copyright 2020 Telstra Open Source\n+ *\n+ *   Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *   you may not use this file except in compliance with the License.\n+ *   You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *   Unless required by applicable law or agreed to in writing, software\n+ *   distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *   See the License for the specific language governing permissions and\n+ *   limitations under the License.\n+ */\n+\n+package org.openkilda.floodlight.utils;\n+\n+import org.openkilda.floodlight.shared.packet.VlanTag;\n+\n+import net.floodlightcontroller.packet.Ethernet;\n+import net.floodlightcontroller.packet.IPacket;\n+\n+import java.util.List;\n+\n+public final class EthernetPacketToolbox {\n+    public static final EthernetPacketToolbox INSTANCE = new EthernetPacketToolbox();", "originalCommit": "3b7c16af63a1b0956742da1ff4f2a4a665cb8e66", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "4e531a036bc875e8df2c364d0ac2f2b1b0159ecc", "url": "https://github.com/telstra/open-kilda/commit/4e531a036bc875e8df2c364d0ac2f2b1b0159ecc", "message": "Extrach ethernet packet body extractor into separate tool", "committedDate": "2020-04-08T15:27:48Z", "type": "forcePushed"}, {"oid": "1758fe587a0066c3fe29dafe397c8ea0d6a38b01", "url": "https://github.com/telstra/open-kilda/commit/1758fe587a0066c3fe29dafe397c8ea0d6a38b01", "message": "Extrach ethernet packet body extractor into separate tool", "committedDate": "2020-04-08T20:04:30Z", "type": "commit"}, {"oid": "1758fe587a0066c3fe29dafe397c8ea0d6a38b01", "url": "https://github.com/telstra/open-kilda/commit/1758fe587a0066c3fe29dafe397c8ea0d6a38b01", "message": "Extrach ethernet packet body extractor into separate tool", "committedDate": "2020-04-08T20:04:30Z", "type": "forcePushed"}]}