{"pr_number": 3376, "pr_title": "Remove potential reordering of OF events", "pr_createdAt": "2020-04-08T13:09:11Z", "pr_url": "https://github.com/telstra/open-kilda/pull/3376", "timeline": [{"oid": "bbd6e82d1bad685effd010edc8cd7c68650789da", "url": "https://github.com/telstra/open-kilda/commit/bbd6e82d1bad685effd010edc8cd7c68650789da", "message": "Remove potential reordering of OF events\n\nUse \"correct\" kafka-key for each switch-dump event produced by\nOF-speaker on network-dump request. It guarantees correct selection of\nkafka-partition for such messages and as a result, it guarantees correct\nordering of produced events.", "committedDate": "2020-04-08T12:50:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTY3ODk5NQ==", "url": "https://github.com/telstra/open-kilda/pull/3376#discussion_r405678995", "bodyText": "nit: Why is \"emit discovery event\" used? This is not related to it.", "author": "sergii-iakovenko", "createdAt": "2020-04-08T17:05:47Z", "path": "src-java/floodlight-service/floodlight-modules/src/main/java/org/openkilda/floodlight/switchmanager/SwitchTrackingService.java", "diffHunk": "@@ -167,20 +166,11 @@ public void setup(FloodlightModuleContext context) {\n         }\n     }\n \n-    private void dumpAllSwitchesAction(String correlationId) {\n+    private void dumpAllSwitchesAction() {\n         Collection<IOFSwitch> iofSwitches = switchManager.getAllSwitchMap(true).values();\n-        int switchCounter = 0;\n         for (IOFSwitch sw : iofSwitches) {\n-            try {\n-                NetworkDumpSwitchData swData = new NetworkDumpSwitchData(buildSwitch(sw));\n-                producerService.sendMessageAndTrack(discoveryTopic,\n-                                                correlationId,\n-                                                new ChunkedInfoMessage(swData, System.currentTimeMillis(),\n-                                                        correlationId, switchCounter, iofSwitches.size(), region));\n-            } catch (Exception e) {\n-                logger.error(\"Failed to send network dump for {}\", sw.getId());\n-            }\n-            switchCounter++;\n+            NetworkDumpSwitchData payload = new NetworkDumpSwitchData(buildSwitch(sw));\n+            emitDiscoveryEvent(sw.getId(), payload);", "originalCommit": "bbd6e82d1bad685effd010edc8cd7c68650789da", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTY4MjE3OQ==", "url": "https://github.com/telstra/open-kilda/pull/3376#discussion_r405682179", "bodyText": "I can't produce a better name at this moment. Can you propose some? emitDiscoveryEvent is used to send any event into network-topology. Most of them are \"discovery\" events, and only this one \"dump\" is not exactly discovery event. But from the consumer perspective the switch-dump is a discovery message too. So I have named it as emitDiscoveryEvent.\nPS I open to propositions.", "author": "surabujin", "createdAt": "2020-04-08T17:11:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTY3ODk5NQ=="}], "type": "inlineReview"}]}