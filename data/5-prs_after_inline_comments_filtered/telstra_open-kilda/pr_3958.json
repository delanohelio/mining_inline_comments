{"pr_number": 3958, "pr_title": "Delicate network topology activate deactivate", "pr_createdAt": "2020-12-29T08:26:51Z", "pr_url": "https://github.com/telstra/open-kilda/pull/3958", "timeline": [{"oid": "67ab5c38331847a6163996cccb22faea73f9e740", "url": "https://github.com/telstra/open-kilda/commit/67ab5c38331847a6163996cccb22faea73f9e740", "message": "Delicate network topology activate deactivate", "committedDate": "2021-03-12T17:56:51Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NjYyOTA2Nw==", "url": "https://github.com/telstra/open-kilda/pull/3958#discussion_r596629067", "bodyText": "this is not required actually", "author": "timofei-durakov", "createdAt": "2021-03-18T08:06:08Z", "path": "src-java/base-topology/base-storm-topology/src/main/java/org/openkilda/wfm/AbstractBolt.java", "diffHunk": "@@ -66,6 +66,7 @@\n     private String lifeCycleEventSourceComponent;\n \n     public AbstractBolt() {\n+        this(null);", "originalCommit": "67ab5c38331847a6163996cccb22faea73f9e740", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NjcwMDQ3OQ==", "url": "https://github.com/telstra/open-kilda/pull/3958#discussion_r596700479", "bodyText": "I would like to keep it - just to not be surprised when somebody will extend AbstractBolt(String lifeCycleEventSourceComponent) constructor.", "author": "surabujin", "createdAt": "2021-03-18T09:48:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NjYyOTA2Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NjYyOTM0Mg==", "url": "https://github.com/telstra/open-kilda/pull/3958#discussion_r596629342", "bodyText": "why do you remove transient here? p.s. default false is not required as well", "author": "timofei-durakov", "createdAt": "2021-03-18T08:06:36Z", "path": "src-java/base-topology/base-storm-topology/src/main/java/org/openkilda/wfm/AbstractBolt.java", "diffHunk": "@@ -45,7 +45,7 @@\n \n     protected transient Logger log = makeLog();\n \n-    protected transient boolean active;\n+    protected boolean active = false;", "originalCommit": "67ab5c38331847a6163996cccb22faea73f9e740", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NjY5NzgwMg==", "url": "https://github.com/telstra/open-kilda/pull/3958#discussion_r596697802", "bodyText": "Because we should not loose it during topology upload. Its current value \"false\" allow to lose it, but in general we should not loose it. Same reason to obviously declare false value, just for readability.", "author": "surabujin", "createdAt": "2021-03-18T09:44:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NjYyOTM0Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NjY2ODE2OA==", "url": "https://github.com/telstra/open-kilda/pull/3958#discussion_r596668168", "bodyText": "extra spaces?", "author": "timofei-durakov", "createdAt": "2021-03-18T09:05:21Z", "path": "src-java/network-topology/network-storm-topology/src/main/java/org/openkilda/wfm/topology/network/storm/bolt/speaker/SpeakerRouter.java", "diffHunk": "@@ -125,34 +127,23 @@ private void speakerMessage(Tuple input, Message message) throws PipelineExcepti\n     private void proxySpeaker(Tuple input, Message message) throws PipelineException {\n         if (active) {\n             if (message instanceof InfoMessage) {\n-                proxySpeaker(input, ((InfoMessage) message).getData());\n+                proxy(input, ((InfoMessage) message).getData());\n             } else {\n                 log.error(\"Do not proxy speaker message - unexpected message type \\\"{}\\\"\", message.getClass());\n             }\n         }\n     }\n \n-    private void proxySpeaker(Tuple input, InfoData payload) throws PipelineException {\n-        if (payload instanceof IslInfoData) {\n-            emit(STREAM_WATCHER_ID, input, makeWatcherTuple(\n-                    input, new WatcherSpeakerDiscoveryCommand((IslInfoData) payload)));\n-        } else if (payload instanceof DiscoPacketSendingConfirmation) {\n-            emit(STREAM_WATCHER_ID, input, makeWatcherTuple(\n-                    input, new WatcherSpeakerSendConfirmationCommand((DiscoPacketSendingConfirmation) payload)));\n-        } else if (payload instanceof IslRoundTripLatency) {\n-            emit(STREAM_WATCHER_ID, input, makeWatcherTuple(\n-                    input, new WatcherSpeakerRoundTripDiscovery((IslRoundTripLatency) payload)));\n-        } else if (payload instanceof SwitchInfoData) {\n-            emit(input, makeDefaultTuple(input, new SwitchEventCommand((SwitchInfoData) payload)));\n-        } else if (payload instanceof PortInfoData) {\n-            emit(input, makeDefaultTuple(input, new SwitchPortEventCommand((PortInfoData) payload)));\n-        } else if (payload instanceof NetworkDumpSwitchData) {\n-            emit(input, makeDefaultTuple(\n-                    input, new SwitchManagedEventCommand(((NetworkDumpSwitchData) payload).getSwitchView())));\n-        } else if (payload instanceof UnmanagedSwitchNotification) {\n-            emit(input, makeDefaultTuple(\n-                    input, new SwitchUnmanagedEventCommand(((UnmanagedSwitchNotification) payload).getSwitchId())));\n-        } else if (payload instanceof DeactivateSwitchInfoData) {\n+    private void proxy(Tuple input, InfoData payload) throws PipelineException {\n+        if (! proxyUnconditionally(input, payload)) {\n+            if (! proxyOnlyWhenActive(input, payload)) {", "originalCommit": "67ab5c38331847a6163996cccb22faea73f9e740", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NjcwMzg2NA==", "url": "https://github.com/telstra/open-kilda/pull/3958#discussion_r596703864", "bodyText": "em... have I mixed up java's coding style with python's?.. I was sure we must have a space after ! operator.", "author": "surabujin", "createdAt": "2021-03-18T09:52:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NjY2ODE2OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NjY2ODM3Mw==", "url": "https://github.com/telstra/open-kilda/pull/3958#discussion_r596668373", "bodyText": "and here", "author": "timofei-durakov", "createdAt": "2021-03-18T09:05:37Z", "path": "src-java/network-topology/network-storm-topology/src/main/java/org/openkilda/wfm/topology/network/storm/bolt/speaker/SpeakerRouter.java", "diffHunk": "@@ -172,8 +163,54 @@ private void proxySpeaker(Tuple input, InfoData payload) throws PipelineExceptio\n         } else if (payload instanceof DeactivateIslInfoData) {\n             emit(STREAM_ISL_ID, input, makeIslTuple(input, new IslDeleteCommand((DeactivateIslInfoData) payload)));\n         } else {\n-            log.error(\"Do not proxy speaker message - unexpected message payload \\\"{}\\\"\", payload.getClass());\n+            return false;\n+        }\n+        return true;\n+    }\n+\n+    private boolean proxyOnlyWhenActive(Tuple input, InfoData payload) throws PipelineException {\n+        if (! active) {", "originalCommit": "67ab5c38331847a6163996cccb22faea73f9e740", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "48f6afdfd66d376e858452d01a88db981e68bb79", "url": "https://github.com/telstra/open-kilda/commit/48f6afdfd66d376e858452d01a88db981e68bb79", "message": "Delicate network topology activate deactivate", "committedDate": "2021-03-18T09:53:19Z", "type": "commit"}, {"oid": "48f6afdfd66d376e858452d01a88db981e68bb79", "url": "https://github.com/telstra/open-kilda/commit/48f6afdfd66d376e858452d01a88db981e68bb79", "message": "Delicate network topology activate deactivate", "committedDate": "2021-03-18T09:53:19Z", "type": "forcePushed"}]}