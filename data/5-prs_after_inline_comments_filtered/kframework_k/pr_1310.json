{"pr_number": 1310, "pr_title": "Warn if non-anonymous variable appears only once.", "pr_createdAt": "2020-05-28T16:46:25Z", "pr_url": "https://github.com/kframework/k/pull/1310", "timeline": [{"oid": "a6e4b83e2218fa6c7ac15e95f5a61ab8ba9e36a6", "url": "https://github.com/kframework/k/commit/a6e4b83e2218fa6c7ac15e95f5a61ab8ba9e36a6", "message": "add test", "committedDate": "2020-05-28T19:01:22Z", "type": "forcePushed"}, {"oid": "7833aecd8e9cc5649152ff8a617e85643422cffa", "url": "https://github.com/kframework/k/commit/7833aecd8e9cc5649152ff8a617e85643422cffa", "message": "cleanup checks a bit", "committedDate": "2020-05-28T19:02:23Z", "type": "commit"}, {"oid": "abc5a5cfef74a62644499d29e3759b5a9d78c7ce", "url": "https://github.com/kframework/k/commit/abc5a5cfef74a62644499d29e3759b5a9d78c7ce", "message": "add check for unused variables", "committedDate": "2020-05-28T19:02:23Z", "type": "commit"}, {"oid": "7ae36234519c78b44405f27a90185f932c0e9254", "url": "https://github.com/kframework/k/commit/7ae36234519c78b44405f27a90185f932c0e9254", "message": "beef up test some more", "committedDate": "2020-05-28T19:02:23Z", "type": "commit"}, {"oid": "9f0e210a7f2d08c047c40c1b81fa2958404b0f44", "url": "https://github.com/kframework/k/commit/9f0e210a7f2d08c047c40c1b81fa2958404b0f44", "message": "fix crash in test", "committedDate": "2020-05-28T19:02:23Z", "type": "commit"}, {"oid": "780901dd84c19f56a1cdf02707c239f214423c76", "url": "https://github.com/kframework/k/commit/780901dd84c19f56a1cdf02707c239f214423c76", "message": "fix warnings", "committedDate": "2020-05-28T19:02:23Z", "type": "commit"}, {"oid": "ebf3fae34bb8a7ebfda572a6f731a34bc30c038e", "url": "https://github.com/kframework/k/commit/ebf3fae34bb8a7ebfda572a6f731a34bc30c038e", "message": "fix bug with contexts", "committedDate": "2020-05-28T19:02:23Z", "type": "commit"}, {"oid": "d77e977dd2128827e9d238744320a467de7e1d63", "url": "https://github.com/kframework/k/commit/d77e977dd2128827e9d238744320a467de7e1d63", "message": "handle fresh anonymous constants", "committedDate": "2020-05-28T19:02:23Z", "type": "commit"}, {"oid": "4572df4c20c8e6d5c1bc300f06063fba0714904c", "url": "https://github.com/kframework/k/commit/4572df4c20c8e6d5c1bc300f06063fba0714904c", "message": "add test", "committedDate": "2020-05-28T19:02:23Z", "type": "commit"}, {"oid": "4572df4c20c8e6d5c1bc300f06063fba0714904c", "url": "https://github.com/kframework/k/commit/4572df4c20c8e6d5c1bc300f06063fba0714904c", "message": "add test", "committedDate": "2020-05-28T19:02:23Z", "type": "forcePushed"}, {"oid": "ba95c45a8d0ce3e646d35272ecae4170e05a455e", "url": "https://github.com/kframework/k/commit/ba95c45a8d0ce3e646d35272ecae4170e05a455e", "message": "update test", "committedDate": "2020-05-28T19:19:57Z", "type": "commit"}, {"oid": "10e5800f04ca93572a5c1af9a921e3bdc527c966", "url": "https://github.com/kframework/k/commit/10e5800f04ca93572a5c1af9a921e3bdc527c966", "message": "update output file", "committedDate": "2020-05-28T19:19:57Z", "type": "commit"}, {"oid": "f2526e2af521480bde0f05d9eb50659164f94074", "url": "https://github.com/kframework/k/commit/f2526e2af521480bde0f05d9eb50659164f94074", "message": "fix another false positive", "committedDate": "2020-05-28T19:19:57Z", "type": "commit"}, {"oid": "36d4daea0b6db09d99326a56992f7e625dd92062", "url": "https://github.com/kframework/k/commit/36d4daea0b6db09d99326a56992f7e625dd92062", "message": "more warnings in prelude", "committedDate": "2020-06-01T20:18:14Z", "type": "commit"}, {"oid": "640b82d6e3342f9a0d58dc7d3135bb4ea5479778", "url": "https://github.com/kframework/k/commit/640b82d6e3342f9a0d58dc7d3135bb4ea5479778", "message": "update tests more", "committedDate": "2020-06-01T20:30:21Z", "type": "commit"}, {"oid": "85f9b67ad87ad5ebcb23315fc4e56bd674408e7a", "url": "https://github.com/kframework/k/commit/85f9b67ad87ad5ebcb23315fc4e56bd674408e7a", "message": "fix test", "committedDate": "2020-06-01T22:16:51Z", "type": "commit"}, {"oid": "9591728d26277e5ece270bc471fca9480ad85677", "url": "https://github.com/kframework/k/commit/9591728d26277e5ece270bc471fca9480ad85677", "message": "update test", "committedDate": "2020-06-02T18:28:11Z", "type": "commit"}, {"oid": "236b454b585855e26f21c1e6c42d8cebaac8d060", "url": "https://github.com/kframework/k/commit/236b454b585855e26f21c1e6c42d8cebaac8d060", "message": "Merge branch 'master' into warn", "committedDate": "2020-06-02T19:37:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDc0MTExMg==", "url": "https://github.com/kframework/k/pull/1310#discussion_r434741112", "bodyText": "What is this change going on here? Is it related to the variable declaration issues?\nOr is it related to the new issue @hjorthjort posted #1318.", "author": "ehildenb", "createdAt": "2020-06-03T17:37:36Z", "path": "kernel/src/main/java/org/kframework/compile/GenerateSentencesFromConfigDecl.java", "diffHunk": "@@ -202,11 +209,31 @@ public void apply(KToken k) {\n         }\n \n         @Override\n-        public void apply(KApply k) {\n-            if (k.klabel().name().equals(\"#externalCell\")) {\n-                hasConfigVar = true;\n+        public void apply(KApply kapp) {\n+            if (kapp.klabel().name().equals(\"#externalCell\")) {\n+                if (kapp.klist().size() == 1) {\n+                    K startLabel = kapp.klist().items().get(0);\n+                    if (startLabel instanceof KToken) {\n+                        KToken label = (KToken) startLabel;\n+                        if (label.sort().equals(Sort(\"#CellName\"))) {\n+                            String cellName = label.s();\n+                            Sort sort = Sort(getSortOfCell(cellName));\n+                            Option<Set<Production>> initializerProduction = m.productionsFor().get(KLabel(getInitLabel(sort)));\n+                            if (initializerProduction.isDefined()) {\n+                                Set<Production> realProds = stream(initializerProduction.get())\n+                                        .filter(p -> !p.att().contains(Att.RECORD_PRD(), Production.class))\n+                                        .collect(Collections.toSet());\n+                                if (realProds.size() == 1) { // should be only a single initializer\n+                                    if (realProds.head().items().size() == 4) {\n+                                      hasConfigVar = true;\n+                                    }\n+                                }\n+                            }", "originalCommit": "236b454b585855e26f21c1e6c42d8cebaac8d060", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDc3Nzk2MA==", "url": "https://github.com/kframework/k/pull/1310#discussion_r434777960", "bodyText": "This is fixing a false positive that arose because we were generating a rule during parsing that had an unused variable.", "author": "dwightguth", "createdAt": "2020-06-03T18:42:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDc0MTExMg=="}], "type": "inlineReview"}, {"oid": "23c25441872285f5b0dff39e341a7584e2661aa3", "url": "https://github.com/kframework/k/commit/23c25441872285f5b0dff39e341a7584e2661aa3", "message": "add more tests", "committedDate": "2020-06-09T17:34:58Z", "type": "commit"}, {"oid": "31dd67a027d744d8cad4dffe4c9a43a9377c007c", "url": "https://github.com/kframework/k/commit/31dd67a027d744d8cad4dffe4c9a43a9377c007c", "message": "don't make warnings fatal", "committedDate": "2020-06-09T17:34:58Z", "type": "commit"}, {"oid": "2d087209a4b338c3412f9e341626ed73e143adac", "url": "https://github.com/kframework/k/commit/2d087209a4b338c3412f9e341626ed73e143adac", "message": "Merge branch 'master' into warn", "committedDate": "2020-06-10T17:50:48Z", "type": "commit"}, {"oid": "49b73f881f9364f67e637204072834fc1dfd61e9", "url": "https://github.com/kframework/k/commit/49b73f881f9364f67e637204072834fc1dfd61e9", "message": "Merge branch 'master' into warn", "committedDate": "2020-06-10T19:50:55Z", "type": "commit"}]}