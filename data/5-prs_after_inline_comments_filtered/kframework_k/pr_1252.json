{"pr_number": 1252, "pr_title": "Function encoding", "pr_createdAt": "2020-05-04T18:57:38Z", "pr_url": "https://github.com/kframework/k/pull/1252", "timeline": [{"oid": "656b5797d0f12d43c4018b74e513305fd73e9333", "url": "https://github.com/kframework/k/commit/656b5797d0f12d43c4018b74e513305fd73e9333", "message": "rename some references to old syntax", "committedDate": "2020-05-04T18:56:22Z", "type": "commit"}, {"oid": "cf172bf76a03923452e35a5a79a3c543fe2d33e8", "url": "https://github.com/kframework/k/commit/cf172bf76a03923452e35a5a79a3c543fe2d33e8", "message": "new encoding of functions", "committedDate": "2020-05-04T18:56:36Z", "type": "commit"}, {"oid": "12236f1100e85ae8c72685d93f51b07705708206", "url": "https://github.com/kframework/k/commit/12236f1100e85ae8c72685d93f51b07705708206", "message": "don't add simplification automatically", "committedDate": "2020-05-04T18:57:05Z", "type": "commit"}, {"oid": "6779e493f69617cfab5dd2694bb53c0892445f39", "url": "https://github.com/kframework/k/commit/6779e493f69617cfab5dd2694bb53c0892445f39", "message": "fix non owise rules", "committedDate": "2020-05-04T19:36:54Z", "type": "commit"}, {"oid": "dfe932e4e973ca7a84f8a202a21c5502836babb7", "url": "https://github.com/kframework/k/commit/dfe932e4e973ca7a84f8a202a21c5502836babb7", "message": "disallow priority or owise + simplification", "committedDate": "2020-05-05T18:50:24Z", "type": "commit"}, {"oid": "5ba774be946035c89516a671c59ebdb12f03f8b4", "url": "https://github.com/kframework/k/commit/5ba774be946035c89516a671c59ebdb12f03f8b4", "message": "restore old behavior for simplification rules", "committedDate": "2020-05-05T18:55:02Z", "type": "commit"}, {"oid": "e46f70b2fe4812ebad726f06d7798b80eff8dab0", "url": "https://github.com/kframework/k/commit/e46f70b2fe4812ebad726f06d7798b80eff8dab0", "message": "tmp: update submodule", "committedDate": "2020-05-07T17:31:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTQ0NzUwOQ==", "url": "https://github.com/kframework/k/pull/1252#discussion_r439447509", "bodyText": "We should allow priority on simplification rules. For example, this is needed for the arithmetic simplification lemmas.", "author": "ana-pantilie", "createdAt": "2020-06-12T14:18:52Z", "path": "kernel/src/main/java/org/kframework/compile/checks/CheckAtt.java", "diffHunk": "@@ -0,0 +1,39 @@\n+// Copyright (c) 2016-2019 K Team. All Rights Reserved.\n+package org.kframework.compile.checks;\n+\n+import org.kframework.attributes.Att;\n+import org.kframework.attributes.HasLocation;\n+import org.kframework.definition.Module;\n+import org.kframework.definition.Rule;\n+import org.kframework.definition.Sentence;\n+import org.kframework.utils.errorsystem.KEMException;\n+\n+import java.util.Set;\n+\n+/**\n+ * Created by dwightguth on 1/25/16.\n+ */\n+public class CheckAtt {\n+    private final Set<KEMException> errors;\n+    private final Module m;\n+\n+    public CheckAtt(Set<KEMException> errors, Module m) {\n+        this.errors = errors;\n+        this.m = m;\n+    }\n+\n+    public void check(Sentence sentence) {\n+        if (sentence instanceof Rule) {\n+            check(((Rule) sentence).att(), sentence);\n+        }\n+    }\n+\n+    private void check(Att att, HasLocation loc) {\n+        if (att.contains(Att.OWISE()) && att.contains(Att.SIMPLIFICATION())) {\n+          errors.add(KEMException.compilerError(\"owise attribute is not supported on simplification rules.\", loc));\n+        }\n+        if (att.contains(Att.PRIORITY()) && att.contains(Att.SIMPLIFICATION())) {\n+          errors.add(KEMException.compilerError(\"priority attribute is not supported on simplification rules.\", loc));\n+        }", "originalCommit": "e46f70b2fe4812ebad726f06d7798b80eff8dab0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTcxNDM3MA==", "url": "https://github.com/kframework/k/pull/1252#discussion_r439714370", "bodyText": "@ana-pantilie could you provide an example?", "author": "traiansf", "createdAt": "2020-06-13T06:30:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTQ0NzUwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTk3MTc1Ng==", "url": "https://github.com/kframework/k/pull/1252#discussion_r439971756", "bodyText": "@traiansf These rules need to apply after any of the less general rules below.", "author": "ana-pantilie", "createdAt": "2020-06-15T07:12:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTQ0NzUwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTk5OTAzNg==", "url": "https://github.com/kframework/k/pull/1252#discussion_r439999036", "bodyText": "@ana-pantilie I agree it makes sense to try some simplification rules only after other simplification rules have been attempted, but I'm wondering whether using priority would not create confusion.\nThe reason I'm saying this is that for other cases (rules, function definitions), priority has semantic meaning (forces a check that rules with less priority cannot be applies), while priority for simplification axioms probably shouldn't, as it is more of a preference to attempt it before other simplification axioms. Maybe we could allow the simplification attribute to take an extra argument?", "author": "traiansf", "createdAt": "2020-06-15T08:06:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTQ0NzUwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDAwODM0NQ==", "url": "https://github.com/kframework/k/pull/1252#discussion_r440008345", "bodyText": "@traiansf Yes, you're right, it could be confusing. @ttuegel what do you think?", "author": "ana-pantilie", "createdAt": "2020-06-15T08:23:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTQ0NzUwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDIwNzAyMg==", "url": "https://github.com/kframework/k/pull/1252#discussion_r440207022", "bodyText": "Maybe we could allow the simplification attribute to take an extra argument?\n\nThat sounds fine.", "author": "ttuegel", "createdAt": "2020-06-15T14:14:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTQ0NzUwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjU2MDQxMw==", "url": "https://github.com/kframework/k/pull/1252#discussion_r462560413", "bodyText": "@dwightguth I'm trying to add an optional argument to the simplification attribute so we can write (for example) simplification(51). When I add arguments like that, the frontend starts to encode simplification (without arguments) as simplification(\"\") in the generated Kore. I want similar behavior to the concrete attribute: concrete becomes concrete(), concrete(X) becomes concrete(\"X\"), etc. Can you advise how I might do that?", "author": "ttuegel", "createdAt": "2020-07-29T20:13:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTQ0NzUwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjYxMjQ4OQ==", "url": "https://github.com/kframework/k/pull/1252#discussion_r462612489", "bodyText": "I have no idea how that happens the way it does now with the concrete attribute. If anything that sounds suspicious to me and indicates that the code is probably doing something unintended. The way it is supposed to work in the current code is to decide whether the attribute has an argument based on whether a nonempty string appears anywhere as the argument of the attribute. So in that sense what you describe is the intended behavior. The k frontend doesn't actually know how to distinguish between an attribute foo and an attribute foo(). This could in theory be changed, but it's not remotely trivial and would likely be a very intrusive change to the frontend.", "author": "dwightguth", "createdAt": "2020-07-29T21:55:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTQ0NzUwOQ=="}], "type": "inlineReview"}, {"oid": "37bb9f94500e9b0a92fc303be02005eda3f35f99", "url": "https://github.com/kframework/k/commit/37bb9f94500e9b0a92fc303be02005eda3f35f99", "message": "Merge branch 'master' into function", "committedDate": "2020-06-17T17:24:07Z", "type": "commit"}, {"oid": "607a89c105cea5e6843ca538f7094c0fde5ec2ad", "url": "https://github.com/kframework/k/commit/607a89c105cea5e6843ca538f7094c0fde5ec2ad", "message": "update llvm backend submodule", "committedDate": "2020-06-17T17:28:27Z", "type": "commit"}, {"oid": "aca3987a60f707314b7deb4b13327affe8ccc249", "url": "https://github.com/kframework/k/commit/aca3987a60f707314b7deb4b13327affe8ccc249", "message": "domains.k: Do not combine priority and simplification attributes\n\nThe Haskell backend now supports a simplification attribute with optional\npriority argument.", "committedDate": "2020-07-29T19:08:25Z", "type": "commit"}, {"oid": "d19c58d9958dd099fec889c782367375ec8351ec", "url": "https://github.com/kframework/k/commit/d19c58d9958dd099fec889c782367375ec8351ec", "message": "Update haskell-backend", "committedDate": "2020-07-29T19:33:46Z", "type": "commit"}, {"oid": "bd35a8c7ba0608ce3355304a3f84f912d1630410", "url": "https://github.com/kframework/k/commit/bd35a8c7ba0608ce3355304a3f84f912d1630410", "message": "Merge branch 'master' into function", "committedDate": "2020-08-11T20:32:49Z", "type": "commit"}, {"oid": "cfd1317167e3818dd3e13e4748232d55afed05a6", "url": "https://github.com/kframework/k/commit/cfd1317167e3818dd3e13e4748232d55afed05a6", "message": "Update llvm-backend", "committedDate": "2020-08-11T20:32:55Z", "type": "commit"}, {"oid": "08e436bb5de338695b424ea126b630ebb2d100fe", "url": "https://github.com/kframework/k/commit/08e436bb5de338695b424ea126b630ebb2d100fe", "message": "Merge remote-tracking branch 'upstream/master' into function", "committedDate": "2020-08-27T07:11:55Z", "type": "commit"}, {"oid": "faa2a64a8ef1d7b3d22867272ab1d05557ee78e1", "url": "https://github.com/kframework/k/commit/faa2a64a8ef1d7b3d22867272ab1d05557ee78e1", "message": "rat.md: add simplification attribute for ceil rule", "committedDate": "2020-08-27T08:28:19Z", "type": "commit"}, {"oid": "6a833f75cebcb0c3df50ef91a8dfac4631f0d487", "url": "https://github.com/kframework/k/commit/6a833f75cebcb0c3df50ef91a8dfac4631f0d487", "message": "llvm-backend: update", "committedDate": "2020-08-27T16:40:10Z", "type": "commit"}, {"oid": "6df314be9ee03fdae0851cd38e101881c00f4f5f", "url": "https://github.com/kframework/k/commit/6df314be9ee03fdae0851cd38e101881c00f4f5f", "message": "Merge branch 'master' into function", "committedDate": "2020-09-04T16:27:31Z", "type": "commit"}, {"oid": "0ae523683b401a424324a5e70747cdce985763aa", "url": "https://github.com/kframework/k/commit/0ae523683b401a424324a5e70747cdce985763aa", "message": "Update LLVM backend", "committedDate": "2020-09-04T21:06:54Z", "type": "commit"}]}