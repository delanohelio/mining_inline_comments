{"pr_number": 13332, "pr_title": "Hmusum/use remote session repo for finding active session", "pr_createdAt": "2020-05-20T13:26:55Z", "pr_url": "https://github.com/vespa-engine/vespa/pull/13332", "timeline": [{"oid": "a350ddbe7384815674965f22461a049cd0a29c86", "url": "https://github.com/vespa-engine/vespa/commit/a350ddbe7384815674965f22461a049cd0a29c86", "message": "Move one test to another class and remove 2 tests that are tested elsewhere", "committedDate": "2020-05-20T12:17:40Z", "type": "commit"}, {"oid": "e354869c4ad9063c97e8c37417fc7c92673b3331", "url": "https://github.com/vespa-engine/vespa/commit/e354869c4ad9063c97e8c37417fc7c92673b3331", "message": "Use remote session repo to find active session\n\nActive session is not necessarily a local session, it might have been\ncreated on another config server.", "committedDate": "2020-05-20T13:25:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODA4NzYyNw==", "url": "https://github.com/vespa-engine/vespa/pull/13332#discussion_r428087627", "bodyText": "Could probably remove most of these from LocalSession, if they're not to be used on that?", "author": "jonmv", "createdAt": "2020-05-20T15:05:29Z", "path": "configserver/src/main/java/com/yahoo/vespa/config/server/session/RemoteSession.java", "diffHunk": "@@ -135,4 +139,34 @@ public void delete() {\n         transaction.close();\n     }\n \n+    public ApplicationId getApplicationId() { return zooKeeperClient.readApplicationId(); }\n+\n+    public Optional<DockerImage> getDockerImageRepository() { return zooKeeperClient.readDockerImageRepository(); }\n+\n+    public Version getVespaVersion() { return zooKeeperClient.readVespaVersion(); }\n+\n+    public Optional<AthenzDomain> getAthenzDomain() { return zooKeeperClient.readAthenzDomain(); }\n+\n+    public AllocatedHosts getAllocatedHosts() {\n+        return zooKeeperClient.getAllocatedHosts();\n+    }\n+\n+    // Note: Assumes monotonically increasing session ids\n+    public boolean isNewerThan(long sessionId) {\n+        return getSessionId() > sessionId;\n+    }\n+\n+    public Transaction createDeactivateTransaction() {\n+        return createSetStatusTransaction(Status.DEACTIVATE);\n+    }\n+\n+    private Transaction createSetStatusTransaction(Status status) {\n+        return zooKeeperClient.createWriteStatusTransaction(status);\n+    }\n+\n+    public ApplicationMetaData getMetaData() {\n+        return zooKeeperClient.loadApplicationPackage().getMetaData();\n+    }", "originalCommit": "e354869c4ad9063c97e8c37417fc7c92673b3331", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODE5NDgwMQ==", "url": "https://github.com/vespa-engine/vespa/pull/13332#discussion_r428194801", "bodyText": "I think I removed those that could be removed. I want to do more refactoring in this area, but let's try this first.", "author": "hmusum", "createdAt": "2020-05-20T17:44:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODA4NzYyNw=="}], "type": "inlineReview"}]}