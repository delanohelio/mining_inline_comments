{"pr_number": 14452, "pr_title": "Add switch field to nodes API", "pr_createdAt": "2020-09-18T14:32:44Z", "pr_url": "https://github.com/vespa-engine/vespa/pull/14452", "timeline": [{"oid": "9db6c09a62822ae1a3e7b6bad70ed214e442c1c6", "url": "https://github.com/vespa-engine/vespa/commit/9db6c09a62822ae1a3e7b6bad70ed214e442c1c6", "message": "Make PrioritizableNode immutable", "committedDate": "2020-09-18T14:19:16Z", "type": "commit"}, {"oid": "65d3b3c3d953e5b97785e7e0452525eb7888f74c", "url": "https://github.com/vespa-engine/vespa/commit/65d3b3c3d953e5b97785e7e0452525eb7888f74c", "message": "Rename PrioritizableNode -> NodeCandidate", "committedDate": "2020-09-18T14:19:16Z", "type": "commit"}, {"oid": "cca8ef0d7b033475d2e32b211f136dbdeb8fee11", "url": "https://github.com/vespa-engine/vespa/commit/cca8ef0d7b033475d2e32b211f136dbdeb8fee11", "message": "Rename method", "committedDate": "2020-09-18T14:19:16Z", "type": "commit"}, {"oid": "60e0078206bc4719bed8810de01719d65496fa09", "url": "https://github.com/vespa-engine/vespa/commit/60e0078206bc4719bed8810de01719d65496fa09", "message": "Decide whether node candidate is on a exclusive switch", "committedDate": "2020-09-19T13:04:33Z", "type": "forcePushed"}, {"oid": "fc658645ea33707c9bb5a631e41dc338260fe72f", "url": "https://github.com/vespa-engine/vespa/commit/fc658645ea33707c9bb5a631e41dc338260fe72f", "message": "Decide whether node candidate is on a exclusive switch", "committedDate": "2020-09-19T16:11:04Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTY3MDIyOQ==", "url": "https://github.com/vespa-engine/vespa/pull/14452#discussion_r491670229", "bodyText": "I think this should be after the active node preference?", "author": "bratseth", "createdAt": "2020-09-20T08:58:21Z", "path": "node-repository/src/main/java/com/yahoo/vespa/hosted/provision/provisioning/NodeCandidate.java", "diffHunk": "@@ -57,14 +62,18 @@\n     /**\n      * Compare this candidate to another\n      *\n-     * @return negative if first priority is higher than second node\n+     * @return negative if this should be preferred over other\n      */\n     @Override\n     public int compareTo(NodeCandidate other) {\n         // First always pick nodes without violation above nodes with violations\n         if (!this.violatesSpares && other.violatesSpares) return -1;\n         if (!other.violatesSpares && this.violatesSpares) return 1;\n \n+        // Prefer node on exclusive switch", "originalCommit": "dc5ad821dcb6a96d5a5229d76d5975edefddd841", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTgzNzE1Mw==", "url": "https://github.com/vespa-engine/vespa/pull/14452#discussion_r491837153", "bodyText": "It should? That means we'll never prefer a new node on a exclusive switch over an existing active node.", "author": "mpolden", "createdAt": "2020-09-21T07:25:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTY3MDIyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTg2MTc3MA==", "url": "https://github.com/vespa-engine/vespa/pull/14452#discussion_r491861770", "bodyText": "The way it is now we'll always (if this code gets its way) prefer new nodes to existing ones if the switch distribution is not optimal. I don't think we want that but instead want to do a controlled retire attempt node by node initiated by a maintainer?", "author": "bratseth", "createdAt": "2020-09-21T08:14:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTY3MDIyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTkxNDIxMw==", "url": "https://github.com/vespa-engine/vespa/pull/14452#discussion_r491914213", "bodyText": "To spread out retiring in time? OK, I buy that.", "author": "mpolden", "createdAt": "2020-09-21T09:45:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTY3MDIyOQ=="}], "type": "inlineReview"}, {"oid": "655690784b67f9d7e547d068d3386900df9283ac", "url": "https://github.com/vespa-engine/vespa/commit/655690784b67f9d7e547d068d3386900df9283ac", "message": "Add switch hostname to node", "committedDate": "2020-09-22T11:30:33Z", "type": "commit"}, {"oid": "48b32b454f9c72029dee804ce76aa4ff66ef09a4", "url": "https://github.com/vespa-engine/vespa/commit/48b32b454f9c72029dee804ce76aa4ff66ef09a4", "message": "Add switch hostname to REST API", "committedDate": "2020-09-22T11:30:33Z", "type": "commit"}, {"oid": "14c1f947b2906e8cfa38d98ec48ea44bf5fe9e22", "url": "https://github.com/vespa-engine/vespa/commit/14c1f947b2906e8cfa38d98ec48ea44bf5fe9e22", "message": "Unify node patch methods in tests", "committedDate": "2020-09-22T11:30:33Z", "type": "commit"}, {"oid": "14c1f947b2906e8cfa38d98ec48ea44bf5fe9e22", "url": "https://github.com/vespa-engine/vespa/commit/14c1f947b2906e8cfa38d98ec48ea44bf5fe9e22", "message": "Unify node patch methods in tests", "committedDate": "2020-09-22T11:30:33Z", "type": "forcePushed"}]}