{"pr_number": 15586, "pr_title": "Bjorncs/cluster controller reindexing status", "pr_createdAt": "2020-12-02T09:10:57Z", "pr_url": "https://github.com/vespa-engine/vespa/pull/15586", "timeline": [{"oid": "653a83398e536c0413a4f2ee50981cbe3a6f12f7", "url": "https://github.com/vespa-engine/vespa/commit/653a83398e536c0413a4f2ee50981cbe3a6f12f7", "message": "Add helper for combining multiple completable futures", "committedDate": "2020-12-02T09:10:26Z", "type": "commit"}, {"oid": "c04726727464a042c3ce0c0bad9b8935eb9b5d8f", "url": "https://github.com/vespa-engine/vespa/commit/c04726727464a042c3ce0c0bad9b8935eb9b5d8f", "message": "Add helper method to rethrow checked as unchecked", "committedDate": "2020-12-02T09:10:27Z", "type": "commit"}, {"oid": "03c00de5438637108875365dbe949e390f10d4bc", "url": "https://github.com/vespa-engine/vespa/commit/03c00de5438637108875365dbe949e390f10d4bc", "message": "Move serialized value definition to State enum", "committedDate": "2020-12-02T09:10:27Z", "type": "commit"}, {"oid": "a040d7d09ad97c2b06e47e0c44d47882eee16617", "url": "https://github.com/vespa-engine/vespa/commit/a040d7d09ad97c2b06e47e0c44d47882eee16617", "message": "Fetch cluster reindexing status from cluster controllers", "committedDate": "2020-12-02T09:26:09Z", "type": "commit"}, {"oid": "124608092189eba3a27de7463a647191f236a1f6", "url": "https://github.com/vespa-engine/vespa/commit/124608092189eba3a27de7463a647191f236a1f6", "message": "Correctly handle optional fields in JSON response body", "committedDate": "2020-12-02T12:13:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDEyMzI0NQ==", "url": "https://github.com/vespa-engine/vespa/pull/15586#discussion_r534123245", "bodyText": "This is always there, but can fix later.", "author": "jonmv", "createdAt": "2020-12-02T12:18:02Z", "path": "configserver/src/main/java/com/yahoo/vespa/config/server/application/DefaultClusterReindexingStatusClient.java", "diffHunk": "@@ -105,10 +106,18 @@ private static ClusterReindexing toClusterReindexing(byte[] requestBody) throws\n         for (JsonNode statusJson : jsonNode.get(\"status\")) {\n             String type = statusJson.get(\"type\").textValue();\n             Instant startedMillis = Instant.ofEpochMilli(statusJson.get(\"startedMillis\").longValue());\n-            Instant endedMillis = Instant.ofEpochMilli(statusJson.get(\"endedMillis\").longValue());\n-            String progressToken = statusJson.get(\"progress\").textValue();\n-            ClusterReindexing.State state = ClusterReindexing.State.fromString(statusJson.get(\"state\").textValue());\n-            String message = statusJson.get(\"message\").textValue();\n+            Instant endedMillis = Optional.ofNullable(statusJson.get(\"endedMillis\"))\n+                    .map(json -> Instant.ofEpochMilli(json.longValue()))\n+                    .orElse(null);\n+            String progressToken = Optional.ofNullable(statusJson.get(\"progress\"))\n+                    .map(JsonNode::textValue)\n+                    .orElse(null);\n+            ClusterReindexing.State state = Optional.ofNullable(statusJson.get(\"state\"))", "originalCommit": "124608092189eba3a27de7463a647191f236a1f6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}