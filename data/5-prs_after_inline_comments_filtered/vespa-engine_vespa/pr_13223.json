{"pr_number": 13223, "pr_title": "Distribute application package to other config servers", "pr_createdAt": "2020-05-12T10:31:38Z", "pr_url": "https://github.com/vespa-engine/vespa/pull/13223", "timeline": [{"oid": "26fa530aedff254dc8871f7395b54c8d3487f336", "url": "https://github.com/vespa-engine/vespa/commit/26fa530aedff254dc8871f7395b54c8d3487f336", "message": "Distribute application package to other config servers", "committedDate": "2020-05-12T05:18:29Z", "type": "commit"}, {"oid": "ca4bdfb245899ff05b92dea67e78e8388c781f53", "url": "https://github.com/vespa-engine/vespa/commit/ca4bdfb245899ff05b92dea67e78e8388c781f53", "message": "Add flag to decide whether to distribute application package", "committedDate": "2020-05-12T10:30:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDA4MDA5NQ==", "url": "https://github.com/vespa-engine/vespa/pull/13223#discussion_r424080095", "bodyText": "Is it correct to distribute before preprocessing? It probably is if the preprocessing will be done on the other configservers if/when they deploy the package. I don't know this code well enough yet, so I may be asking stupid questions here.", "author": "gjoranv", "createdAt": "2020-05-12T22:56:43Z", "path": "configserver/src/main/java/com/yahoo/vespa/config/server/session/SessionPreparer.java", "diffHunk": "@@ -112,6 +116,7 @@ public ConfigChangeActions prepare(SessionContext context, DeployLogger logger,\n                                        Optional<ApplicationSet> currentActiveApplicationSet, Path tenantPath, \n                                        Instant now) {\n         Preparation preparation = new Preparation(context, logger, params, currentActiveApplicationSet, tenantPath);\n+        preparation.distributeApplicationPackage();", "originalCommit": "26fa530aedff254dc8871f7395b54c8d3487f336", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE3MTgzOQ==", "url": "https://github.com/vespa-engine/vespa/pull/13223#discussion_r424171839", "bodyText": "I think so, but it depends on how it will be used and deployed, as you say. My plan was to end up building it the same way on all config servers, but there's much to do before we are in that state. Something to keep in mind", "author": "hmusum", "createdAt": "2020-05-13T04:55:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDA4MDA5NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDA4OTQ3Mw==", "url": "https://github.com/vespa-engine/vespa/pull/13223#discussion_r424089473", "bodyText": "What does the empty string mean?", "author": "gjoranv", "createdAt": "2020-05-12T23:25:06Z", "path": "configserver/src/main/java/com/yahoo/vespa/config/server/session/SessionPreparer.java", "diffHunk": "@@ -221,6 +223,16 @@ void checkTimeout(String step) {\n             }\n         }\n \n+        void distributeApplicationPackage() {\n+            FileRegistry fileRegistry = fileDistributionProvider.getFileRegistry();\n+            FileReference fileReference = fileRegistry.addFile(\"\");", "originalCommit": "26fa530aedff254dc8871f7395b54c8d3487f336", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE3MjI4Nw==", "url": "https://github.com/vespa-engine/vespa/pull/13223#discussion_r424172287", "bodyText": "It's the relative path in the application package, so it basically means add \"add everything in the application package\" directory. Should probably add a new method to make this clearer, I'll look into it in the next PR.", "author": "hmusum", "createdAt": "2020-05-13T04:57:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDA4OTQ3Mw=="}], "type": "inlineReview"}]}