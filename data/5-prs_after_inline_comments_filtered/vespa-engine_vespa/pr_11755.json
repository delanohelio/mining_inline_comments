{"pr_number": 11755, "pr_title": "Support modify of mixed tensors", "pr_createdAt": "2020-01-13T10:21:52Z", "pr_url": "https://github.com/vespa-engine/vespa/pull/11755", "timeline": [{"oid": "a3ec97de26572acdbfe4b1801744061decb84d38", "url": "https://github.com/vespa-engine/vespa/commit/a3ec97de26572acdbfe4b1801744061decb84d38", "message": "Support modify of mixed tensors", "committedDate": "2020-01-13T10:19:24Z", "type": "commit"}, {"oid": "8477acfc593e68fba389bbdda69d65267a2da641", "url": "https://github.com/vespa-engine/vespa/commit/8477acfc593e68fba389bbdda69d65267a2da641", "message": "Update javadoc", "committedDate": "2020-01-13T12:25:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTc4MDIyMg==", "url": "https://github.com/vespa-engine/vespa/pull/11755#discussion_r365780222", "bodyText": "This will break how we handle such updates in backend. We treat the cells to update as a sparse tensor and assumes this has been verified before serialized. To support the blocked syntax, the resulting tensor must still be a sparse one. Also see tensor_modify_update_treats_the_input_tensor_as_sparse().", "author": "geirst", "createdAt": "2020-01-13T12:33:57Z", "path": "document/src/main/java/com/yahoo/document/update/TensorModifyUpdate.java", "diffHunk": "@@ -29,8 +30,8 @@ public TensorModifyUpdate(Operation operation, TensorFieldValue tensor) {\n     }\n \n     private void verifyCompatibleType(TensorType type) {\n-        if (type.dimensions().stream().anyMatch(dim -> dim.isIndexed()) ) {\n-            throw new IllegalArgumentException(\"Tensor type '\" + type + \"' is not compatible as it contains some indexed dimensions\");\n+        if (type.rank() > 0 && type.dimensions().stream().noneMatch(dim -> dim.isMapped()) ) {", "originalCommit": "a3ec97de26572acdbfe4b1801744061decb84d38", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTgwOTUxMg==", "url": "https://github.com/vespa-engine/vespa/pull/11755#discussion_r365809512", "bodyText": "Okay, let's convert in this layer for now #11766", "author": "bratseth", "createdAt": "2020-01-13T13:42:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTc4MDIyMg=="}], "type": "inlineReview"}]}