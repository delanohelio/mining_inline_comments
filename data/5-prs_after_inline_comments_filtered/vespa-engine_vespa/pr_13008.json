{"pr_number": 13008, "pr_title": "Bratseth/store autoscaling state", "pr_createdAt": "2020-04-22T09:03:46Z", "pr_url": "https://github.com/vespa-engine/vespa/pull/13008", "timeline": [{"oid": "f23cf8b3afd927f5c99e475d3eb9d043360483d4", "url": "https://github.com/vespa-engine/vespa/commit/f23cf8b3afd927f5c99e475d3eb9d043360483d4", "message": "Store application info in zk", "committedDate": "2020-04-21T11:39:36Z", "type": "commit"}, {"oid": "eec77fa0e5b00cb88f248346d19f9dedb4d295ae", "url": "https://github.com/vespa-engine/vespa/commit/eec77fa0e5b00cb88f248346d19f9dedb4d295ae", "message": "Cleanup", "committedDate": "2020-04-21T11:50:20Z", "type": "commit"}, {"oid": "5f6aceb9fd023a637d45b853ea5c998c1259dcd3", "url": "https://github.com/vespa-engine/vespa/commit/5f6aceb9fd023a637d45b853ea5c998c1259dcd3", "message": "Remove applications on remove", "committedDate": "2020-04-22T09:03:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjgxNzE0Mw==", "url": "https://github.com/vespa-engine/vespa/pull/13008#discussion_r412817143", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    System.out.println(\"original id: \" + original.id());\n          \n          \n            \n                    System.out.println(\"serialized id: \" + serialized.id());", "author": "freva", "createdAt": "2020-04-22T09:20:04Z", "path": "node-repository/src/test/java/com/yahoo/vespa/hosted/provision/persistence/ApplicationSerializerTest.java", "diffHunk": "@@ -0,0 +1,58 @@\n+// Copyright Verizon Media. Licensed under the terms of the Apache 2.0 license. See LICENSE in the project root.\n+package com.yahoo.vespa.hosted.provision.persistence;\n+\n+import com.yahoo.config.provision.ApplicationId;\n+import com.yahoo.config.provision.ClusterResources;\n+import com.yahoo.config.provision.ClusterSpec;\n+import com.yahoo.config.provision.NodeResources;\n+import com.yahoo.vespa.hosted.provision.applications.Application;\n+import com.yahoo.vespa.hosted.provision.applications.Cluster;\n+import org.junit.Test;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Optional;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertNotSame;\n+\n+/**\n+ * @author bratseth\n+ */\n+public class ApplicationSerializerTest {\n+\n+    @Test\n+    public void testApplicationSerialization() {\n+        List<Cluster> clusters = new ArrayList<>();\n+        clusters.add(new Cluster(ClusterSpec.Id.from(\"c1\"),\n+                                 new ClusterResources( 8, 4, new NodeResources(1, 2,  3,  4)),\n+                                 new ClusterResources(12, 6, new NodeResources(3, 6, 21, 24)),\n+                                 Optional.empty()));\n+        clusters.add(new Cluster(ClusterSpec.Id.from(\"c2\"),\n+                                 new ClusterResources( 8, 4, new NodeResources(1, 2, 3, 4)),\n+                                 new ClusterResources(14, 7, new NodeResources(3, 6, 21, 24)),\n+                                 Optional.of(new ClusterResources(10, 5, new NodeResources(2, 4, 14, 16)))));\n+        Application original = new Application(ApplicationId.from(\"myTenant\", \"myApplication\", \"myInstance\"),\n+                                               clusters);\n+\n+        Application serialized = ApplicationSerializer.fromJson(ApplicationSerializer.toJson(original));\n+        assertNotSame(original, serialized);\n+        System.out.println(\"original id: \" + original.id());\n+        System.out.println(\"serialized id: \" + serialized.id());", "originalCommit": "f23cf8b3afd927f5c99e475d3eb9d043360483d4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "55aa71d6d78c43890555cb4c8069751ad4a93f2d", "url": "https://github.com/vespa-engine/vespa/commit/55aa71d6d78c43890555cb4c8069751ad4a93f2d", "message": "Update node-repository/src/test/java/com/yahoo/vespa/hosted/provision/persistence/ApplicationSerializerTest.java\n\nCo-Authored-By: Valerij Fredriksen <freva@users.noreply.github.com>", "committedDate": "2020-04-22T09:40:13Z", "type": "commit"}]}