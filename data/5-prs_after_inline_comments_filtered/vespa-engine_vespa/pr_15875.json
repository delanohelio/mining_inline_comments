{"pr_number": 15875, "pr_title": "Use an injected VespaDocumentAccess for streaming search", "pr_createdAt": "2020-12-30T14:11:59Z", "pr_url": "https://github.com/vespa-engine/vespa/pull/15875", "timeline": [{"oid": "86b7e6d6d6514ad4de4c2108d1552ddcd047d89e", "url": "https://github.com/vespa-engine/vespa/commit/86b7e6d6d6514ad4de4c2108d1552ddcd047d89e", "message": "Use an injected VespaDocumentAccess for streaming search", "committedDate": "2021-04-26T10:52:03Z", "type": "forcePushed"}, {"oid": "a4dad58e80bb358027d2bb193f9198250f8d72b0", "url": "https://github.com/vespa-engine/vespa/commit/a4dad58e80bb358027d2bb193f9198250f8d72b0", "message": "Use an injected VespaDocumentAccess for streaming search", "committedDate": "2021-05-28T12:17:37Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MjMzMDYwMw==", "url": "https://github.com/vespa-engine/vespa/pull/15875#discussion_r642330603", "bodyText": "Now we end up promising to run all document access over MessageBus forever just because VdsStreamingSearcher needs it. I suggest it is better to cast there.", "author": "bratseth", "createdAt": "2021-05-31T08:57:00Z", "path": "container-core/src/main/java/com/yahoo/container/core/documentapi/VespaDocumentAccess.java", "diffHunk": "@@ -33,9 +35,8 @@\n public class VespaDocumentAccess extends DocumentAccess {\n \n     private final MessageBusParams parameters;\n-    private final Object monitor = new Object();\n \n-    private DocumentAccess delegate = null;\n+    private final AtomicReference<MessageBusDocumentAccess> delegate = new AtomicReference<>();", "originalCommit": "a4dad58e80bb358027d2bb193f9198250f8d72b0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MjQxNTQwNw==", "url": "https://github.com/vespa-engine/vespa/pull/15875#discussion_r642415407", "bodyText": "Good idea.", "author": "jonmv", "createdAt": "2021-05-31T11:21:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MjMzMDYwMw=="}], "type": "inlineReview"}, {"oid": "eaed7fa806a307ca712d6f099d089288b8caaf7a", "url": "https://github.com/vespa-engine/vespa/commit/eaed7fa806a307ca712d6f099d089288b8caaf7a", "message": "Use an injected VespaDocumentAccess for streaming search", "committedDate": "2021-06-30T18:50:15Z", "type": "commit"}, {"oid": "9ceacdab281de851c841d395b1e1fd42c25d4f18", "url": "https://github.com/vespa-engine/vespa/commit/9ceacdab281de851c841d395b1e1fd42c25d4f18", "message": "Cast to MessageBusDocumentAccess only where needed", "committedDate": "2021-06-30T19:06:52Z", "type": "commit"}, {"oid": "9ceacdab281de851c841d395b1e1fd42c25d4f18", "url": "https://github.com/vespa-engine/vespa/commit/9ceacdab281de851c841d395b1e1fd42c25d4f18", "message": "Cast to MessageBusDocumentAccess only where needed", "committedDate": "2021-06-30T19:06:52Z", "type": "forcePushed"}]}