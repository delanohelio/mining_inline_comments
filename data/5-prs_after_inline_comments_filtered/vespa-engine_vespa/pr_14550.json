{"pr_number": 14550, "pr_title": "Jonmv/async doc v1", "pr_createdAt": "2020-09-25T08:38:07Z", "pr_url": "https://github.com/vespa-engine/vespa/pull/14550", "timeline": [{"oid": "0d12e6650c20799240eb9324ef426745d70ee58f", "url": "https://github.com/vespa-engine/vespa/commit/0d12e6650c20799240eb9324ef426745d70ee58f", "message": "Non-functional changes", "committedDate": "2020-09-25T07:34:43Z", "type": "commit"}, {"oid": "f6d6f0db9f6dab4a48aea33dd8c41b28ff624ad5", "url": "https://github.com/vespa-engine/vespa/commit/f6d6f0db9f6dab4a48aea33dd8c41b28ff624ad5", "message": "Let the injectable lazy document access be specifically injected", "committedDate": "2020-09-25T07:53:42Z", "type": "commit"}, {"oid": "17c6dc3a23badb17f468fe8b38bda57eab717a4c", "url": "https://github.com/vespa-engine/vespa/commit/17c6dc3a23badb17f468fe8b38bda57eab717a4c", "message": "Eliminate config self-subscription from MessageBusDocumentAccess", "committedDate": "2020-09-25T08:37:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDg0NDY2NA==", "url": "https://github.com/vespa-engine/vespa/pull/14550#discussion_r494844664", "bodyText": "This lets us use this in internal classes as well, without fear that the user may have configured their own DocumentAccess component.", "author": "jonmv", "createdAt": "2020-09-25T08:52:37Z", "path": "container-core/src/main/java/com/yahoo/container/core/documentapi/DocumentAccessProvider.java", "diffHunk": "@@ -27,18 +27,18 @@\n  *\n  * @author jonmv\n  */\n-public class MessageBusDocumentAccessProvider extends AbstractComponent implements Provider<DocumentAccess> {\n+public class DocumentAccessProvider extends AbstractComponent implements Provider<DocumentAccessProvider.LazyWrapper> {", "originalCommit": "f6d6f0db9f6dab4a48aea33dd8c41b28ff624ad5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "2cd240de82eedbad02868290c89036e91d3f8e7d", "url": "https://github.com/vespa-engine/vespa/commit/2cd240de82eedbad02868290c89036e91d3f8e7d", "message": "Move injectable lazy document access to top level and rename to VespaDocumentAccess", "committedDate": "2020-09-25T09:23:06Z", "type": "commit"}, {"oid": "1ce342752d01f2118688d9a7016944b98c4946b1", "url": "https://github.com/vespa-engine/vespa/commit/1ce342752d01f2118688d9a7016944b98c4946b1", "message": "Update abi spec", "committedDate": "2020-09-25T09:23:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDg4MDMwOA==", "url": "https://github.com/vespa-engine/vespa/pull/14550#discussion_r494880308", "bodyText": "Add copyright header to your intellij template :)", "author": "bjorncs", "createdAt": "2020-09-25T09:55:20Z", "path": "container-core/src/main/java/com/yahoo/container/core/documentapi/DocumentAccessProvider.java", "diffHunk": "@@ -0,0 +1,38 @@\n+package com.yahoo.container.core.documentapi;", "originalCommit": "1ce342752d01f2118688d9a7016944b98c4946b1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDg5MjMzMg==", "url": "https://github.com/vespa-engine/vespa/pull/14550#discussion_r494892332", "bodyText": "Done!", "author": "jonmv", "createdAt": "2020-09-25T10:19:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDg4MDMwOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDg4MDg4NA==", "url": "https://github.com/vespa-engine/vespa/pull/14550#discussion_r494880884", "bodyText": "Consider adding warning in log if self-subscription", "author": "bjorncs", "createdAt": "2020-09-25T09:56:28Z", "path": "documentapi/src/main/java/com/yahoo/documentapi/messagebus/MessageBusDocumentAccess.java", "diffHunk": "@@ -60,7 +60,9 @@ public MessageBusDocumentAccess(MessageBusParams params) {\n                 bus = new NetworkMessageBus(network, new MessageBus(network, mbusParams));\n             }\n             else {\n-                bus = new RPCMessageBus(mbusParams, params.getRPCNetworkParams(), params.getRoutingConfigId());\n+                bus = params.getRPCNetworkParams().getSlobroksConfig() != null && mbusParams.getMessageBusConfig() != null\n+                      ? new RPCMessageBus(mbusParams, params.getRPCNetworkParams()) // prefer without self-subscription if config is set\n+                      : new RPCMessageBus(mbusParams, params.getRPCNetworkParams(), params.getRoutingConfigId());", "originalCommit": "1ce342752d01f2118688d9a7016944b98c4946b1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e51cf8cde83e94a1ce33bdc1ff00301851f5f165", "url": "https://github.com/vespa-engine/vespa/commit/e51cf8cde83e94a1ce33bdc1ff00301851f5f165", "message": "Log on self-subscroption and fix copyright hreaders", "committedDate": "2020-09-25T10:15:04Z", "type": "commit"}, {"oid": "77978067f2c6eddedfbb08ae7abc732f18adfd8e", "url": "https://github.com/vespa-engine/vespa/commit/77978067f2c6eddedfbb08ae7abc732f18adfd8e", "message": "Refer to correct class i config model", "committedDate": "2020-09-25T10:18:14Z", "type": "commit"}]}