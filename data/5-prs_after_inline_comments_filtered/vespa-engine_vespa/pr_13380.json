{"pr_number": 13380, "pr_title": "Add hack for using same version as applications are pinned to", "pr_createdAt": "2020-05-26T17:30:16Z", "pr_url": "https://github.com/vespa-engine/vespa/pull/13380", "timeline": [{"oid": "3d0b97d04bffe6431294d73ccaf9bbaeaf7a8c70", "url": "https://github.com/vespa-engine/vespa/commit/3d0b97d04bffe6431294d73ccaf9bbaeaf7a8c70", "message": "Add hack for using same version as applications are pinned to", "committedDate": "2020-05-26T17:29:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDYxOTE4MQ==", "url": "https://github.com/vespa-engine/vespa/pull/13380#discussion_r430619181", "bodyText": "There are issues both with using the target platform version, and with using the system version. Sometimes you want one, sometimes the other. We could use system version if the application wasn't pinned to a particular version, and that particular version if it was, to address this in a better way. Probably not the answer to everything either, but should solve this.", "author": "jonmv", "createdAt": "2020-05-26T18:26:23Z", "path": "controller-server/src/main/java/com/yahoo/vespa/hosted/controller/deployment/InternalStepRunner.java", "diffHunk": "@@ -194,7 +194,12 @@ public InternalStepRunner(Controller controller) {\n     }\n \n     private Optional<RunStatus> deployTester(RunId id, DualLogger logger) {\n-        Version platform = controller.systemVersion();\n+        Version targetPlatform = controller.jobController().run(id).get().versions().targetPlatform();\n+        // TODO: Hack to make sure some pinned applications get this version for tester deployments\n+        //       Remove when no applications are pinned to this version anymore\n+        final Version platform = targetPlatform.equals(Version.fromString(\"7.220.14\"))", "originalCommit": "3d0b97d04bffe6431294d73ccaf9bbaeaf7a8c70", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDYyMDIwNg==", "url": "https://github.com/vespa-engine/vespa/pull/13380#discussion_r430620206", "bodyText": "Sounds like a pragmatic solution to me", "author": "hmusum", "createdAt": "2020-05-26T18:28:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDYxOTE4MQ=="}], "type": "inlineReview"}]}