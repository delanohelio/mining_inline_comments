{"pr_number": 14727, "pr_title": "Log at lower level when moving file and file already exists", "pr_createdAt": "2020-10-05T13:21:31Z", "pr_url": "https://github.com/vespa-engine/vespa/pull/14727", "timeline": [{"oid": "46c67bb78209add1586b488da041a8f762926c5a", "url": "https://github.com/vespa-engine/vespa/commit/46c67bb78209add1586b488da041a8f762926c5a", "message": "Log at lower level when moving file and file already exists\n\nNo need to log at info level, this is not a filure and will happen\noccasionally. Also minor change so that we log if deleting a file\nfails.", "committedDate": "2020-10-05T13:19:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTU5NzUzMw==", "url": "https://github.com/vespa-engine/vespa/pull/14727#discussion_r499597533", "bodyText": "Consider catching the particular subclass of IOException thrown when the file already exists (FileAlreadyExistsException?), and only try deletion etc then.", "author": "hakonhall", "createdAt": "2020-10-05T13:27:31Z", "path": "filedistribution/src/main/java/com/yahoo/vespa/filedistribution/FileReceiver.java", "diffHunk": "@@ -96,9 +96,12 @@ void addPart(int partId, byte [] part) {\n             try {\n                 Files.write(inprogressFile.toPath(), part, StandardOpenOption.WRITE, StandardOpenOption.APPEND);\n             } catch (IOException e) {\n-                log.log(Level.SEVERE, \"Failed writing to file (\" + inprogressFile.toPath() + \"): \" + e.getMessage(), e);\n-                inprogressFile.delete();\n-                throw new RuntimeException(\"Failed writing to file (\" + inprogressFile.toPath() + \"): \", e);\n+                String message = \"Failed writing to file (\" + inprogressFile.toPath() + \"): \";\n+                log.log(Level.SEVERE, message + e.getMessage(), e);", "originalCommit": "46c67bb78209add1586b488da041a8f762926c5a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTYwNTQ3NA==", "url": "https://github.com/vespa-engine/vespa/pull/14727#discussion_r499605474", "bodyText": "If we fail to write to the file we need to cleanup (we append to the file, so if it fails we have no idea of what has been written). So the change is just logging if we were unable to delete the file, we always need to delete no matter what the IOException was.", "author": "hmusum", "createdAt": "2020-10-05T13:38:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTU5NzUzMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTYwNzYxNQ==", "url": "https://github.com/vespa-engine/vespa/pull/14727#discussion_r499607615", "bodyText": "\ud83d\udc4d", "author": "hakonhall", "createdAt": "2020-10-05T13:42:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTU5NzUzMw=="}], "type": "inlineReview"}]}