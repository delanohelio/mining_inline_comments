{"pr_number": 12534, "pr_title": "Bjorncs/jdisc metric unhandled exception", "pr_createdAt": "2020-03-11T13:39:21Z", "pr_url": "https://github.com/vespa-engine/vespa/pull/12534", "timeline": [{"oid": "65cf2af452d0fcdae24e3a212cf9cb8019793ba2", "url": "https://github.com/vespa-engine/vespa/commit/65cf2af452d0fcdae24e3a212cf9cb8019793ba2", "message": "Share common metric dimensions with package-local subclasses", "committedDate": "2020-03-12T10:21:48Z", "type": "commit"}, {"oid": "010535d2d5695c4b5bf08976982640a9cee7ec47", "url": "https://github.com/vespa-engine/vespa/commit/010535d2d5695c4b5bf08976982640a9cee7ec47", "message": "Introduce metric for unhandled exceptions from request handlers", "committedDate": "2020-03-12T10:25:00Z", "type": "commit"}, {"oid": "9cb56ed899c987600263764cb00f9baf3e190ea1", "url": "https://github.com/vespa-engine/vespa/commit/9cb56ed899c987600263764cb00f9baf3e190ea1", "message": "Introduce metric for unhandled exceptions from jdisc thread pool", "committedDate": "2020-03-12T10:35:24Z", "type": "commit"}, {"oid": "9cb56ed899c987600263764cb00f9baf3e190ea1", "url": "https://github.com/vespa-engine/vespa/commit/9cb56ed899c987600263764cb00f9baf3e190ea1", "message": "Introduce metric for unhandled exceptions from jdisc thread pool", "committedDate": "2020-03-12T10:35:24Z", "type": "forcePushed"}, {"oid": "0907c88c0b4dec4ad0037c9c2d3dc1f1c61ab4c4", "url": "https://github.com/vespa-engine/vespa/commit/0907c88c0b4dec4ad0037c9c2d3dc1f1c61ab4c4", "message": "Add unit tests that verifies metric is propagated", "committedDate": "2020-03-12T11:46:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTY5NTc4NA==", "url": "https://github.com/vespa-engine/vespa/pull/12534#discussion_r391695784", "bodyText": "What is the difference between Map.of() and Collections.emptyMap()?", "author": "gjoranv", "createdAt": "2020-03-12T15:20:26Z", "path": "container-core/src/main/java/com/yahoo/container/jdisc/ThreadedRequestHandler.java", "diffHunk": "@@ -97,9 +97,12 @@ protected ThreadedRequestHandler(Executor executor, Metric metric, boolean allow\n         dimensions.put(\"port\", Integer.toString(uri.getPort()));\n         String handlerClassName = getClass().getName();\n         dimensions.put(\"handler-name\", handlerClassName);\n+        dimensions.putAll(extraDimensions);\n         return this.metric.createContext(dimensions);\n     }\n \n+    private Metric.Context contextFor(Request request) { return contextFor(request, Map.of()); }", "originalCommit": "65cf2af452d0fcdae24e3a212cf9cb8019793ba2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjE0Njc4Ng==", "url": "https://github.com/vespa-engine/vespa/pull/12534#discussion_r392146786", "bodyText": "Map.of() was introduced in Java 9. The returned Map instance from both have the same semantics (immutable etc). I prefer the new syntax as it is shorter.", "author": "bjorncs", "createdAt": "2020-03-13T10:31:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTY5NTc4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjE0OTE1MQ==", "url": "https://github.com/vespa-engine/vespa/pull/12534#discussion_r392149151", "bodyText": "When you static import the emptyMap() function, I think that is more describing and almost as short. But this is just nit of course. :)", "author": "gjoranv", "createdAt": "2020-03-13T10:36:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTY5NTc4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjE1NjUzNg==", "url": "https://github.com/vespa-engine/vespa/pull/12534#discussion_r392156536", "bodyText": "Agree - if static import is used emptyMap() is more readable \ud83d\udc4d", "author": "bjorncs", "createdAt": "2020-03-13T10:52:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTY5NTc4NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTY5NjU5MA==", "url": "https://github.com/vespa-engine/vespa/pull/12534#discussion_r391696590", "bodyText": "Shouldn't it be ..unhandled_exceptions with the plural 's'? If so, also rename the constant.", "author": "gjoranv", "createdAt": "2020-03-12T15:21:37Z", "path": "container-core/src/main/java/com/yahoo/container/jdisc/ThreadedHttpRequestHandler.java", "diffHunk": "@@ -31,6 +32,7 @@\n \n     public static final String CONTENT_TYPE = \"Content-Type\";\n     private static final String RENDERING_ERRORS = \"rendering_errors\";\n+    private static final String UNHANDLED_EXCEPTION_METRIC = \"jdisc.http.handler.unhandled_exception\";", "originalCommit": "010535d2d5695c4b5bf08976982640a9cee7ec47", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjE0Njk5OA==", "url": "https://github.com/vespa-engine/vespa/pull/12534#discussion_r392146998", "bodyText": "Agree - plural sounds better. I will update the PR with a rename.", "author": "bjorncs", "createdAt": "2020-03-13T10:31:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTY5NjU5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjE0OTI4MQ==", "url": "https://github.com/vespa-engine/vespa/pull/12534#discussion_r392149281", "bodyText": "\ud83d\udc4d", "author": "gjoranv", "createdAt": "2020-03-13T10:36:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTY5NjU5MA=="}], "type": "inlineReview"}, {"oid": "0c8ebb4735a6d97b13c221efb65adc18c75e66dd", "url": "https://github.com/vespa-engine/vespa/commit/0c8ebb4735a6d97b13c221efb65adc18c75e66dd", "message": "Use plural ending in new metric names", "committedDate": "2020-03-13T10:42:34Z", "type": "commit"}, {"oid": "bd08c1ef0ffa6e3b89ee4c3f621dc75e2be1e13e", "url": "https://github.com/vespa-engine/vespa/commit/bd08c1ef0ffa6e3b89ee4c3f621dc75e2be1e13e", "message": "Export new metrics for unhandled exceptions", "committedDate": "2020-03-13T10:46:28Z", "type": "commit"}, {"oid": "0060db436df1b9e6084bcf97939ead48109af078", "url": "https://github.com/vespa-engine/vespa/commit/0060db436df1b9e6084bcf97939ead48109af078", "message": "Update method and constant names to match new metric name", "committedDate": "2020-03-13T11:20:32Z", "type": "commit"}]}