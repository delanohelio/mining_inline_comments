{"pr_number": 1502, "pr_title": "[IIDM] Allow to reuse ShuntCompensatorAdder twice", "pr_createdAt": "2020-10-05T13:43:09Z", "pr_url": "https://github.com/powsybl/powsybl-core/pull/1502", "timeline": [{"oid": "5af532da29f51295281c644b8e00816bd27b062a", "url": "https://github.com/powsybl/powsybl-core/commit/5af532da29f51295281c644b8e00816bd27b062a", "message": "Allow to reuse ShuntCompensatorAdder twice\n\nSigned-off-by: Thomas ADAM <tadam@silicom.fr>", "committedDate": "2020-10-05T13:32:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA4MDM2OQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1502#discussion_r503080369", "bodyText": "@MioRtia why the public API of ShuntCompensatorModel is empty? I would move everything except this method in the public API (i.e. outside the wrapper)", "author": "mathbagu", "createdAt": "2020-10-12T07:07:41Z", "path": "iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/AbstractShuntCompensatorModel.java", "diffHunk": "@@ -19,9 +17,6 @@\n \n     @Override\n     public void setShuntCompensator(ShuntCompensatorImpl shuntCompensator) {", "originalCommit": "5af532da29f51295281c644b8e00816bd27b062a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzEwNTQxOA==", "url": "https://github.com/powsybl/powsybl-core/pull/1502#discussion_r503105418", "bodyText": "It shouldn't be in the public API, should it? A shunt compensator model should not be created independently from the shunt for me, this method was just because it was created in the adder (so before the shunt itself is created). The method can be deleted if it is not used that way anymore.\nEDIT Read the entire PR, it seems this method is still used, don't take my last remark into account", "author": "miovd", "createdAt": "2020-10-12T07:56:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA4MDM2OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA4MTE3Ng==", "url": "https://github.com/powsybl/powsybl-core/pull/1502#discussion_r503081176", "bodyText": "I think this class is redundant with AbstractShuntCompensatorModel\n@MioRtia Is it ok if we remove it?", "author": "mathbagu", "createdAt": "2020-10-12T07:09:33Z", "path": "iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/ShuntCompensatorAdderImpl.java", "diffHunk": "@@ -177,6 +180,17 @@ public ShuntCompensatorAdder setTargetDeadband(double targetDeadband) {\n     public ShuntCompensatorImpl add() {\n         String id = checkAndGetUniqueId();\n         TerminalExt terminal = checkAndGetTerminal();\n+        ShuntCompensatorModelWrapper model = null;", "originalCommit": "5af532da29f51295281c644b8e00816bd27b062a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzExMDU5Mw==", "url": "https://github.com/powsybl/powsybl-core/pull/1502#discussion_r503110593", "bodyText": "Indeed, you can only use AbstractShuntCompensatorModel and make the following methods abstract:\nShuntCompensatorModelType getType();\n\n    int getMaximumSectionCount();\n\n    double getB(int sectionCount);\n\n    double getG(int sectionCount);", "author": "miovd", "createdAt": "2020-10-12T08:05:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA4MTE3Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA4MTQwOQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1502#discussion_r503081409", "bodyText": "I would perform the deep copy in the constructor of ShuntCompensatorNonLinearModelImpl (and document it)", "author": "mathbagu", "createdAt": "2020-10-12T07:10:04Z", "path": "iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/ShuntCompensatorAdderImpl.java", "diffHunk": "@@ -177,6 +180,17 @@ public ShuntCompensatorAdder setTargetDeadband(double targetDeadband) {\n     public ShuntCompensatorImpl add() {\n         String id = checkAndGetUniqueId();\n         TerminalExt terminal = checkAndGetTerminal();\n+        ShuntCompensatorModelWrapper model = null;\n+        if (shuntCompensatorLinearModelAdder != null) {\n+            model = new ShuntCompensatorLinearModelImpl(shuntCompensatorLinearModelAdder.bPerSection,\n+                                                        shuntCompensatorLinearModelAdder.gPerSection,\n+                                                        shuntCompensatorLinearModelAdder.maximumSectionCount);\n+        } else if (shuntCompensatorNonLinearModelAdder != null) {\n+            model = new ShuntCompensatorNonLinearModelImpl(shuntCompensatorNonLinearModelAdder.sections.stream()\n+                                                                                                       .map(ShuntCompensatorNonLinearModelImpl.SectionImpl::copy)\n+                                                                                                       .collect(Collectors.toList()));", "originalCommit": "5af532da29f51295281c644b8e00816bd27b062a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "fb5f85b0264802c1b3b91d9bca1e2ba3aa5ec2f1", "url": "https://github.com/powsybl/powsybl-core/commit/fb5f85b0264802c1b3b91d9bca1e2ba3aa5ec2f1", "message": "Remove ShuntCompensatorModelWrapper class\n\nSigned-off-by: Thomas ADAM <tadam@silicom.fr>", "committedDate": "2020-10-12T08:16:52Z", "type": "commit"}, {"oid": "0e1a8478f0f75fdaed96d5760ab0aab678a9f611", "url": "https://github.com/powsybl/powsybl-core/commit/0e1a8478f0f75fdaed96d5760ab0aab678a9f611", "message": "Move sections deep copy into ShuntCompensatorNonLinearModel constructor\n\nSigned-off-by: Thomas ADAM <tadam@silicom.fr>", "committedDate": "2020-10-12T08:39:48Z", "type": "commit"}, {"oid": "383cc724d98ae8a3f6969c4174368069b14575cb", "url": "https://github.com/powsybl/powsybl-core/commit/383cc724d98ae8a3f6969c4174368069b14575cb", "message": "Move internal adder set into add method\n\nSigned-off-by: Thomas ADAM <tadam@silicom.fr>", "committedDate": "2020-10-13T08:16:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTQxOTI0NA==", "url": "https://github.com/powsybl/powsybl-core/pull/1502#discussion_r505419244", "bodyText": "This is not sufficient to ensure someone don't set two different models. You should introduce a common interface or reset the corresponding attribute in the add methods.", "author": "mathbagu", "createdAt": "2020-10-15T10:02:03Z", "path": "iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/ShuntCompensatorAdderImpl.java", "diffHunk": "@@ -18,7 +18,9 @@\n \n     private final VoltageLevelExt voltageLevel;\n \n-    private ShuntCompensatorModelWrapper model;\n+    private ShuntCompensatorNonLinearModelAdderImpl shuntCompensatorNonLinearModelAdder;\n+\n+    private ShuntCompensatorLinearModelAdderImpl shuntCompensatorLinearModelAdder;", "originalCommit": "383cc724d98ae8a3f6969c4174368069b14575cb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTQxOTUyNg==", "url": "https://github.com/powsybl/powsybl-core/pull/1502#discussion_r505419526", "bodyText": "See my previous comment.", "author": "mathbagu", "createdAt": "2020-10-15T10:02:27Z", "path": "iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/ShuntCompensatorAdderImpl.java", "diffHunk": "@@ -177,6 +179,15 @@ public ShuntCompensatorAdder setTargetDeadband(double targetDeadband) {\n     public ShuntCompensatorImpl add() {\n         String id = checkAndGetUniqueId();\n         TerminalExt terminal = checkAndGetTerminal();\n+        AbstractShuntCompensatorModel model = null;\n+        if (shuntCompensatorLinearModelAdder != null) {\n+            model = new ShuntCompensatorLinearModelImpl(shuntCompensatorLinearModelAdder.bPerSection,\n+                                                        shuntCompensatorLinearModelAdder.gPerSection,\n+                                                        shuntCompensatorLinearModelAdder.maximumSectionCount);\n+        } else if (shuntCompensatorNonLinearModelAdder != null) {\n+            model = new ShuntCompensatorNonLinearModelImpl(shuntCompensatorNonLinearModelAdder.sections);\n+        }", "originalCommit": "383cc724d98ae8a3f6969c4174368069b14575cb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTQyMDQ5NQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1502#discussion_r505420495", "bodyText": "I think clone is more commonly used", "author": "mathbagu", "createdAt": "2020-10-15T10:04:10Z", "path": "iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/ShuntCompensatorNonLinearModelImpl.java", "diffHunk": "@@ -60,6 +61,10 @@ public Section setG(double g) {\n             return this;\n         }\n \n+        public SectionImpl copy() {\n+            return new SectionImpl(index, b, g);\n+        }", "originalCommit": "383cc724d98ae8a3f6969c4174368069b14575cb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f3ffd287c407c0e4580dd142a6173819894d5138", "url": "https://github.com/powsybl/powsybl-core/commit/f3ffd287c407c0e4580dd142a6173819894d5138", "message": "Taking into account PR reviews\n\nSigned-off-by: Thomas ADAM <tadam@silicom.fr>", "committedDate": "2020-10-15T13:03:08Z", "type": "commit"}, {"oid": "58e312ebed63d104b7888d2fb97fb1445fa16999", "url": "https://github.com/powsybl/powsybl-core/commit/58e312ebed63d104b7888d2fb97fb1445fa16999", "message": "Merge branch 'master' into issue_1489_shunt", "committedDate": "2020-10-16T08:25:44Z", "type": "commit"}]}