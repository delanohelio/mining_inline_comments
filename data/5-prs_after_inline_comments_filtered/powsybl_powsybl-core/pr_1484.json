{"pr_number": 1484, "pr_title": "Regulating control adjustments to export SSH", "pr_createdAt": "2020-09-24T10:00:31Z", "pr_url": "https://github.com/powsybl/powsybl-core/pull/1484", "timeline": [{"oid": "6f5a4d892b33f6dcb29f5bc583b2f70f2065efa4", "url": "https://github.com/powsybl/powsybl-core/commit/6f5a4d892b33f6dcb29f5bc583b2f70f2065efa4", "message": "Regulating control adjustments\n\nSigned-off-by: Jos\u00e9 Antonio Marqu\u00e9s <marquesja@aia.es>", "committedDate": "2020-09-24T09:35:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDQ0NjQwMw==", "url": "https://github.com/powsybl/powsybl-core/pull/1484#discussion_r494446403", "bodyText": "Was this method never used?", "author": "MioRtia", "createdAt": "2020-09-24T16:18:11Z", "path": "cgmes/cgmes-conversion/src/main/java/com/powsybl/cgmes/conversion/RegulatingControlMappingForTransformers.java", "diffHunk": "@@ -36,49 +34,13 @@\n         t3xMapping = new HashMap<>();\n     }\n \n-    public void add(String transformerId, String rtcId, PropertyBag rtc, PropertyBag ptc) {", "originalCommit": "6f5a4d892b33f6dcb29f5bc583b2f70f2065efa4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDUxOTkwNQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1484#discussion_r494519905", "bodyText": "Is not used. It was used in the old conversion, deleted months ago. Methods used now are  add(String transformerId, CgmesRegulatingControlRatio rcRtc, CgmesRegulatingControlPhase rcPtc) and  add(String transformerId, CgmesRegulatingControlRatio rcRtc1, CgmesRegulatingControlPhase rcPtc1, CgmesRegulatingControlRatio rcRtc2, CgmesRegulatingControlPhase rcPtc2, CgmesRegulatingControlRatio rcRtc3, CgmesRegulatingControlPhase rcPtc3)", "author": "marqueslanauja", "createdAt": "2020-09-24T18:21:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDQ0NjQwMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDQ0NjkyNA==", "url": "https://github.com/powsybl/powsybl-core/pull/1484#discussion_r494446924", "bodyText": "Same question", "author": "MioRtia", "createdAt": "2020-09-24T16:18:56Z", "path": "cgmes/cgmes-conversion/src/main/java/com/powsybl/cgmes/conversion/RegulatingControlMappingForTransformers.java", "diffHunk": "@@ -36,49 +34,13 @@\n         t3xMapping = new HashMap<>();\n     }\n \n-    public void add(String transformerId, String rtcId, PropertyBag rtc, PropertyBag ptc) {\n-        if (t2xMapping.containsKey(transformerId)) {\n-            throw new CgmesModelException(\"Transformer already added, Transformer id: \" + transformerId);\n-        }\n-\n-        CgmesRegulatingControlRatio rcRtc = null;\n-        if (rtc != null) {\n-            rcRtc = buildRegulatingControlRatio(rtcId, rtc);\n-        }\n-\n-        CgmesRegulatingControlPhase rcPtc = null;\n-        if (ptc != null) {\n-            rcPtc = buildRegulatingControlPhase(ptc);\n-        }\n-\n-        add(transformerId, rcRtc, rcPtc);\n-    }\n-\n     public void add(String transformerId, CgmesRegulatingControlRatio rcRtc, CgmesRegulatingControlPhase rcPtc) {\n         CgmesRegulatingControlForTwoWindingsTransformer rc = new CgmesRegulatingControlForTwoWindingsTransformer();\n         rc.ratioTapChanger = rcRtc;\n         rc.phaseTapChanger = rcPtc;\n         t2xMapping.put(transformerId, rc);\n     }\n \n-    public void add(String transformerId, String rtcId2, PropertyBag rtc2, String rtcId3, PropertyBag rtc3) {", "originalCommit": "6f5a4d892b33f6dcb29f5bc583b2f70f2065efa4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDUyMDAyMw==", "url": "https://github.com/powsybl/powsybl-core/pull/1484#discussion_r494520023", "bodyText": "Is not used. It was used in the old conversion, deleted months ago.", "author": "marqueslanauja", "createdAt": "2020-09-24T18:21:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDQ0NjkyNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDQ0ODEyNQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1484#discussion_r494448125", "bodyText": "In this case, maybe set targetValue to 0? I'm not sure if ValidationUtil will not throw an exception otherwise (and specify in the log)", "author": "MioRtia", "createdAt": "2020-09-24T16:20:45Z", "path": "cgmes/cgmes-conversion/src/main/java/com/powsybl/cgmes/conversion/RegulatingControlMappingForTransformers.java", "diffHunk": "@@ -249,18 +195,19 @@ private boolean setRtcRegulatingControlVoltage(String rtcId, boolean regulating,\n             return false;\n         }\n \n-        // Even if regulating is false, we reset the target voltage if it is not valid\n-        if (control.targetValue <= 0) {\n-            context.ignored(rtcId,\n+        // We always keep the targetValue\n+        // It targetValue is not valid, emit a warning and deactivate regulating control\n+        boolean validTargetValue = control.targetValue > 0;\n+        if (!validTargetValue) {", "originalCommit": "6f5a4d892b33f6dcb29f5bc583b2f70f2065efa4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDUyMDA4OQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1484#discussion_r494520089", "bodyText": "The validation only checks targetV if it is enabled. In this case the control is deactivated.", "author": "marqueslanauja", "createdAt": "2020-09-24T18:21:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDQ0ODEyNQ=="}], "type": "inlineReview"}, {"oid": "f420f0524d80ea23a8db20895066fe0f8c8d3aae", "url": "https://github.com/powsybl/powsybl-core/commit/f420f0524d80ea23a8db20895066fe0f8c8d3aae", "message": "Merge branch 'master' into regulatingControl_adjustments_to_export_SSH", "committedDate": "2020-09-25T06:11:59Z", "type": "commit"}]}