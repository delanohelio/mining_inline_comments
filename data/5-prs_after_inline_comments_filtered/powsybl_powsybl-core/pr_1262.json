{"pr_number": 1262, "pr_title": "Validations around HVDC lines in IIDM", "pr_createdAt": "2020-04-06T11:40:00Z", "pr_url": "https://github.com/powsybl/powsybl-core/pull/1262", "timeline": [{"oid": "a6e789732466f685dd764101f9c1ad1a2daaa128", "url": "https://github.com/powsybl/powsybl-core/commit/a6e789732466f685dd764101f9c1ad1a2daaa128", "message": "* Add a validation in iidm to avoid negative active power setpoint in a hvdc line.\n* Try to introduce a hupper limit to ratios.\n\nSigned-off-by: Anne Tilloy <atilloy@gmail.com>", "committedDate": "2020-04-06T11:33:09Z", "type": "commit"}, {"oid": "9b92173dcc4adf1c6c3389df9deef6813375a0b5", "url": "https://github.com/powsybl/powsybl-core/commit/9b92173dcc4adf1c6c3389df9deef6813375a0b5", "message": "Fix.\n\nSigned-off-by: Anne Tilloy <atilloy@gmail.com>", "committedDate": "2020-04-06T11:50:18Z", "type": "commit"}, {"oid": "14ebade6a134d5e4defc48c971a156f635bd0542", "url": "https://github.com/powsybl/powsybl-core/commit/14ebade6a134d5e4defc48c971a156f635bd0542", "message": "maxP should be positive for an HVDC line.\n* Fix CGMES conversion\n* Fix tests.\n\nSigned-off-by: Anne Tilloy <atilloy@gmail.com>", "committedDate": "2020-04-06T12:58:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQxNjYxMQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1262#discussion_r404416611", "bodyText": "The power factor is defined as the ratio of the active power to the apparent power\npowerFactor = P/ Math.hypot(P, Q)\nso the powerFactor is a number in the closed interval [-1,1], -1 <= powerFactor <= 1", "author": "marqueslanauja", "createdAt": "2020-04-06T22:04:51Z", "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/ValidationUtil.java", "diffHunk": "@@ -365,6 +381,8 @@ public static void checkConvertersMode(Validable validable, HvdcLine.ConvertersM\n     public static void checkPowerFactor(Validable validable, double powerFactor) {\n         if (Double.isNaN(powerFactor)) {\n             throw new ValidationException(validable, \"power factor is invalid\");\n+        } else if (Math.abs(powerFactor) > 3) {\n+            throw new ValidationException(validable, \"power factor is invalid, it should be a ratio\");", "originalCommit": "14ebade6a134d5e4defc48c971a156f635bd0542", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDU3MjI1NQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1262#discussion_r404572255", "bodyText": "Nice thanks, I was not sure about the hupper limit. If it is 1, it is really easiest ! I am going to change the PR.", "author": "annetill", "createdAt": "2020-04-07T06:46:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQxNjYxMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQxNzkwNw==", "url": "https://github.com/powsybl/powsybl-core/pull/1262#discussion_r404417907", "bodyText": "The lossFactor is defined and calculated as a percentage, so 0 <= lossFactor <= 100", "author": "marqueslanauja", "createdAt": "2020-04-06T22:07:45Z", "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/ValidationUtil.java", "diffHunk": "@@ -385,6 +403,8 @@ public static void checkLossFactor(Validable validable, float lossFactor) {\n             throw new ValidationException(validable, \"loss factor is invalid\");\n         } else if (lossFactor < 0) {\n             throw new ValidationException(validable, \"loss factor must be >= 0\");\n+        } else if (lossFactor > 3) {", "originalCommit": "14ebade6a134d5e4defc48c971a156f635bd0542", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDU3MzU0OQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1262#discussion_r404573549", "bodyText": "In fact, I ask @mathbagu and @geofjamg and I have checked in some private parts and the lossFactoris not a percentage, it is a ratio. So:\n\nWhat is the hupper limit for you ? 1 or more (a ratio could be greater than 1, as a percentage can be greater than 100) ?\nYou have to fix your PR about the CGMES conversion of HVDC (sorry for that) because the web site documentation is wrong.", "author": "annetill", "createdAt": "2020-04-07T06:49:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQxNzkwNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDY2NDMwOQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1262#discussion_r404664309", "bodyText": "According with the master version the lossFactor is calculated and expressed as a percentage and to be coherent with the code implementation should be a number in the closed interval [0,100]. (See code lines 179 - 186 and 41 - 93 of the  DcLineSegmentConversion.java class).\nIt is a valid way to express the loss factor and in the IIDM model there are other attributes expressed in the same way, e.g. the step correction in ratioTapChanger and phaseTapChanger but we are in the IIDM model so RTE can choose a different way to express it.", "author": "marqueslanauja", "createdAt": "2020-04-07T09:22:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQxNzkwNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDY3NjMwMA==", "url": "https://github.com/powsybl/powsybl-core/pull/1262#discussion_r404676300", "bodyText": "In fact, the DCLineSegmentConversion.Java has been modified with percentage last year by Miora and me. Miora and me have been influenced by the documentation. You are right about RTC and PTC.", "author": "annetill", "createdAt": "2020-04-07T09:41:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQxNzkwNw=="}], "type": "inlineReview"}, {"oid": "415f437ed036cd1fc6fb2078cd8d7be25394885b", "url": "https://github.com/powsybl/powsybl-core/commit/415f437ed036cd1fc6fb2078cd8d7be25394885b", "message": "Fix hupper limits of lossFactor and powerFactor.\n\nSigned-off-by: Anne Tilloy <atilloy@gmail.com>", "committedDate": "2020-04-07T07:02:30Z", "type": "commit"}, {"oid": "e835b33b8016892b40c54ed4ce554259a78cba59", "url": "https://github.com/powsybl/powsybl-core/commit/e835b33b8016892b40c54ed4ce554259a78cba59", "message": "Revert.\n\nSigned-off-by: Anne Tilloy <atilloy@gmail.com>", "committedDate": "2020-04-07T07:09:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDY0NjUxMQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1262#discussion_r404646511", "bodyText": "If the power factor is between -1 and 1, we should also check the lower bound", "author": "mathbagu", "createdAt": "2020-04-07T08:54:32Z", "path": "iidm/iidm-api/src/main/java/com/powsybl/iidm/network/ValidationUtil.java", "diffHunk": "@@ -365,6 +381,8 @@ public static void checkConvertersMode(Validable validable, HvdcLine.ConvertersM\n     public static void checkPowerFactor(Validable validable, double powerFactor) {\n         if (Double.isNaN(powerFactor)) {\n             throw new ValidationException(validable, \"power factor is invalid\");\n+        } else if (Math.abs(powerFactor) > 1) {\n+            throw new ValidationException(validable, \"power factor is invalid, it should be between -1 and 1\");", "originalCommit": "e835b33b8016892b40c54ed4ce554259a78cba59", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDY0NzUwNw==", "url": "https://github.com/powsybl/powsybl-core/pull/1262#discussion_r404647507", "bodyText": "I cannot make it with Math.abs ?", "author": "annetill", "createdAt": "2020-04-07T08:56:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDY0NjUxMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDY2NTI2NQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1262#discussion_r404665265", "bodyText": "Exact, I read your proposal too quickly", "author": "mathbagu", "createdAt": "2020-04-07T09:24:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDY0NjUxMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDY3NDEyOQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1262#discussion_r404674129", "bodyText": "I prefer to use  the standard definition of power factor P/sqrt(P*P + Q*Q). You can check the wikipedia definition (https://en.wikipedia.org/wiki/Power_factor).\nIn our particular case the active power P is always positive so the power factor will be in the interval [0,1] but I prefer to check it between -1 and 1 as we already have an additional check for the active power to be positive.  This is my particular opinion.", "author": "marqueslanauja", "createdAt": "2020-04-07T09:38:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDY0NjUxMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDY3NzgzOA==", "url": "https://github.com/powsybl/powsybl-core/pull/1262#discussion_r404677838", "bodyText": "Finally, do you agree with this part of the code ? I \"accidentaly\" merge this PR minutes ago\u2026", "author": "annetill", "createdAt": "2020-04-07T09:44:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDY0NjUxMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDY3ODk3MQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1262#discussion_r404678971", "bodyText": "Yes, I've just finished to review it, it is okay for me, we can leave it merged as it is!", "author": "miovd", "createdAt": "2020-04-07T09:46:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDY0NjUxMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDY4MDQ2MQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1262#discussion_r404680461", "bodyText": "Totally agree.", "author": "marqueslanauja", "createdAt": "2020-04-07T09:48:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDY0NjUxMQ=="}], "type": "inlineReview"}, {"oid": "2d210d4304fa02ecf983943fdbf16a431b05e707", "url": "https://github.com/powsybl/powsybl-core/commit/2d210d4304fa02ecf983943fdbf16a431b05e707", "message": "Merge branch 'master' into hvdc-validation", "committedDate": "2020-04-07T08:58:23Z", "type": "commit"}]}