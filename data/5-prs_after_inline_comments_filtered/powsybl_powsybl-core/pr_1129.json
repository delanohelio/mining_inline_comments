{"pr_number": 1129, "pr_title": "Allow to write IIDM-XML files in previous versions", "pr_createdAt": "2020-01-22T10:12:06Z", "pr_url": "https://github.com/powsybl/powsybl-core/pull/1129", "timeline": [{"oid": "f64b765196418055360206a626077997bd3ebc7c", "url": "https://github.com/powsybl/powsybl-core/commit/f64b765196418055360206a626077997bd3ebc7c", "message": "add test\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2020-01-22T12:25:21Z", "type": "forcePushed"}, {"oid": "20e2f4833a4bdf60255d37ce3dafe41a6b10afa3", "url": "https://github.com/powsybl/powsybl-core/commit/20e2f4833a4bdf60255d37ce3dafe41a6b10afa3", "message": "add new mechanisms\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2020-01-23T14:07:50Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTE1NDI1Ng==", "url": "https://github.com/powsybl/powsybl-core/pull/1129#discussion_r371154256", "bodyText": "Implement this in the opposite way: the constructor with the biggest number of parameter should contain the logic. The other constructor(s) should call it with default values", "author": "mathbagu", "createdAt": "2020-01-27T10:12:37Z", "path": "iidm/iidm-converter-api/src/main/java/com/powsybl/iidm/export/ExportOptions.java", "diffHunk": "@@ -50,6 +52,11 @@ public ExportOptions(boolean withBranchSV, boolean indent, boolean onlyMainCc, T\n         this.throwExceptionIfExtensionNotFound = throwExceptionIfExtensionNotFound;\n     }\n \n+    public ExportOptions(boolean withBranchSV, boolean indent, boolean onlyMainCc, TopologyLevel topologyLevel, boolean throwExceptionIfExtensionNotFound, String version) {\n+        this(withBranchSV, indent, onlyMainCc, topologyLevel, throwExceptionIfExtensionNotFound);\n+        this.version = version;\n+    }", "originalCommit": "20e2f4833a4bdf60255d37ce3dafe41a6b10afa3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTE1NDY1Ng==", "url": "https://github.com/powsybl/powsybl-core/pull/1129#discussion_r371154656", "bodyText": "Not sure this should be deprecated: for most people, export network using the current version is OK?", "author": "mathbagu", "createdAt": "2020-01-27T10:13:28Z", "path": "iidm/iidm-xml-converter/src/main/java/com/powsybl/iidm/xml/AbstractConnectableXml.java", "diffHunk": "@@ -153,31 +151,47 @@ public static void readCurrentLimits(Integer index, Supplier<CurrentLimitsAdder>\n                 double value = XmlUtil.readOptionalDoubleAttribute(reader, \"value\", Double.MAX_VALUE);\n                 boolean fictitious = XmlUtil.readOptionalBoolAttribute(reader, \"fictitious\", false);\n                 adder.beginTemporaryLimit()\n-                    .setName(name)\n-                    .setAcceptableDuration(acceptableDuration)\n-                    .setValue(value)\n-                    .setFictitious(fictitious)\n-                    .endTemporaryLimit();\n+                        .setName(name)\n+                        .setAcceptableDuration(acceptableDuration)\n+                        .setValue(value)\n+                        .setFictitious(fictitious)\n+                        .endTemporaryLimit();\n             }\n         });\n         adder.add();\n     }\n \n+    /**\n+     * @deprecated Use {@link #writeCurrentLimits(Integer, CurrentLimits, XMLStreamWriter, IidmXmlVersion)} instead.\n+     */\n+    @Deprecated", "originalCommit": "20e2f4833a4bdf60255d37ce3dafe41a6b10afa3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTE1NDg0NA==", "url": "https://github.com/powsybl/powsybl-core/pull/1129#discussion_r371154844", "bodyText": "Assert that it's not null", "author": "mathbagu", "createdAt": "2020-01-27T10:13:53Z", "path": "iidm/iidm-xml-converter/src/main/java/com/powsybl/iidm/xml/AbstractNetworkXmlContext.java", "diffHunk": "@@ -0,0 +1,27 @@\n+/**\n+ * Copyright (c) 2020, RTE (http://www.rte-france.com)\n+ * This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+ */\n+package com.powsybl.iidm.xml;\n+\n+import com.powsybl.iidm.AbstractConverterContext;\n+import com.powsybl.iidm.anonymizer.Anonymizer;\n+\n+/**\n+ * @author Miora Ralambotiana <miora.ralambotiana at rte-france.com>\n+ */\n+public abstract class AbstractNetworkXmlContext<T> extends AbstractConverterContext<T> {\n+\n+    private final IidmXmlVersion version;\n+\n+    AbstractNetworkXmlContext(Anonymizer anonymizer, IidmXmlVersion version) {\n+        super(anonymizer);\n+        this.version = version;", "originalCommit": "20e2f4833a4bdf60255d37ce3dafe41a6b10afa3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTE1NTg3NQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1129#discussion_r371155875", "bodyText": "Maybe you should also introduce RATIO_TAP_CHANGER_2 and RATIO_TAP_CHANGER_3 even there is no duplication yet", "author": "mathbagu", "createdAt": "2020-01-27T10:16:03Z", "path": "iidm/iidm-xml-converter/src/main/java/com/powsybl/iidm/xml/ThreeWindingsTransformerXml.java", "diffHunk": "@@ -22,6 +22,11 @@\n \n     static final String ROOT_ELEMENT_NAME = \"threeWindingsTransformer\";\n \n+    private static final String RATIO_TAP_CHANGER_1 = \"ratioTapChanger1\";", "originalCommit": "20e2f4833a4bdf60255d37ce3dafe41a6b10afa3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTE1NjU2Ng==", "url": "https://github.com/powsybl/powsybl-core/pull/1129#discussion_r371156566", "bodyText": "Why don't you use the default Runnable? Maybe for exception handling? In that case, I think we have an UncheckedXmlStreamException", "author": "mathbagu", "createdAt": "2020-01-27T10:17:34Z", "path": "iidm/iidm-xml-converter/src/main/java/com/powsybl/iidm/xml/util/IidmXmlUtil.java", "diffHunk": "@@ -7,17 +7,29 @@\n package com.powsybl.iidm.xml.util;\n \n import com.powsybl.commons.PowsyblException;\n+import com.powsybl.commons.xml.XmlUtil;\n+import com.powsybl.iidm.xml.AbstractNetworkXmlContext;\n import com.powsybl.iidm.xml.IidmXmlVersion;\n import com.powsybl.iidm.xml.NetworkXmlReaderContext;\n+import com.powsybl.iidm.xml.NetworkXmlWriterContext;\n+\n+import javax.xml.stream.XMLStreamException;\n+import java.util.Objects;\n \n /**\n  * @author Miora Ralambotiana <miora.ralambotiana at rte-france.com>\n  */\n public final class IidmXmlUtil {\n \n+    public interface IidmXmlRunnable {\n+        void run() throws XMLStreamException;\n+    }", "originalCommit": "20e2f4833a4bdf60255d37ce3dafe41a6b10afa3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "cbbc53abc52ac078cc15a74ae99eed757ee6e9de", "url": "https://github.com/powsybl/powsybl-core/commit/cbbc53abc52ac078cc15a74ae99eed757ee6e9de", "message": "corrections\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2020-01-27T14:16:42Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTY1MjU5Nw==", "url": "https://github.com/powsybl/powsybl-core/pull/1129#discussion_r371652597", "bodyText": "To be discussed: I'm not sure we should allow null values", "author": "mathbagu", "createdAt": "2020-01-28T08:03:13Z", "path": "iidm/iidm-converter-api/src/main/java/com/powsybl/iidm/export/ExportOptions.java", "diffHunk": "@@ -39,15 +39,22 @@\n \n     private boolean throwExceptionIfExtensionNotFound = false;\n \n+    private String version;\n+\n     public ExportOptions() {\n     }\n \n     public ExportOptions(boolean withBranchSV, boolean indent, boolean onlyMainCc, TopologyLevel topologyLevel, boolean throwExceptionIfExtensionNotFound) {\n+        this(withBranchSV, indent, onlyMainCc, topologyLevel, throwExceptionIfExtensionNotFound, null);", "originalCommit": "ef4e77fb5531cfb003de37424ec3354e389920c8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzA2NTE5OQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1129#discussion_r373065199", "bodyText": "In my opinion, null for version would mean the same as \"default\" version i.e. the most recent version (which is implemented in NetworkXml).\nThe logic here of using null for undefined rather than directly a defined value is that if we use ExportOptions for an another serialization of IIDM in the future (IIDM-JSON for example), the most recent version of this serialization does not have to be the same as IIDM-XML most recent version. In this case, keeping it undefined and letting the converter itself assert the defaut version is the best solution I think.", "author": "miovd", "createdAt": "2020-01-30T16:46:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTY1MjU5Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTY1MzI3MQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1129#discussion_r371653271", "bodyText": "To be discussed: I fact, I have a doubt now... This method is not really public, but private package... maybe you were right yesterday when I asked you to remove the deprecated. I think we should even break the API and make this method private package.\nIs this method still used?", "author": "mathbagu", "createdAt": "2020-01-28T08:05:13Z", "path": "iidm/iidm-xml-converter/src/main/java/com/powsybl/iidm/xml/AbstractConnectableXml.java", "diffHunk": "@@ -153,31 +151,39 @@ public static void readCurrentLimits(Integer index, Supplier<CurrentLimitsAdder>\n                 double value = XmlUtil.readOptionalDoubleAttribute(reader, \"value\", Double.MAX_VALUE);\n                 boolean fictitious = XmlUtil.readOptionalBoolAttribute(reader, \"fictitious\", false);\n                 adder.beginTemporaryLimit()\n-                    .setName(name)\n-                    .setAcceptableDuration(acceptableDuration)\n-                    .setValue(value)\n-                    .setFictitious(fictitious)\n-                    .endTemporaryLimit();\n+                        .setName(name)\n+                        .setAcceptableDuration(acceptableDuration)\n+                        .setValue(value)\n+                        .setFictitious(fictitious)\n+                        .endTemporaryLimit();\n             }\n         });\n         adder.add();\n     }\n \n     public static void writeCurrentLimits(Integer index, CurrentLimits limits, XMLStreamWriter writer) throws XMLStreamException {", "originalCommit": "ef4e77fb5531cfb003de37424ec3354e389920c8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzA2Njc3Ng==", "url": "https://github.com/powsybl/powsybl-core/pull/1129#discussion_r373066776", "bodyText": "Currently, it is only used in some extensions relying on CurrentLimits. Not sure either if this should remain public or not but I think both positions are valid.", "author": "miovd", "createdAt": "2020-01-30T16:49:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTY1MzI3MQ=="}], "type": "inlineReview"}, {"oid": "d405b3528f109e5a6bbadc8c85d215af95839b71", "url": "https://github.com/powsybl/powsybl-core/commit/d405b3528f109e5a6bbadc8c85d215af95839b71", "message": "Allow writing IIDM-XML files in previous versions (not only current one)\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2020-01-31T14:49:05Z", "type": "commit"}, {"oid": "317258cac8718b802eb52786ee2fb389d1fb7b1d", "url": "https://github.com/powsybl/powsybl-core/commit/317258cac8718b802eb52786ee2fb389d1fb7b1d", "message": "Update tests to test the new feature\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2020-01-31T14:49:06Z", "type": "commit"}, {"oid": "72f8ed27d5a824a861a9272c6232b32f55627d79", "url": "https://github.com/powsybl/powsybl-core/commit/72f8ed27d5a824a861a9272c6232b32f55627d79", "message": "add test\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2020-01-31T14:49:06Z", "type": "commit"}, {"oid": "887e2ab660bee8f1a9c71340f441df473f5b8fd0", "url": "https://github.com/powsybl/powsybl-core/commit/887e2ab660bee8f1a9c71340f441df473f5b8fd0", "message": "correct checkstyle\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2020-01-31T14:49:06Z", "type": "commit"}, {"oid": "be06de27684686c0bcbe2ff753be596cc9a5c158", "url": "https://github.com/powsybl/powsybl-core/commit/be06de27684686c0bcbe2ff753be596cc9a5c158", "message": "add new mechanisms\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2020-01-31T14:49:06Z", "type": "commit"}, {"oid": "7350520a760fb411aa4547bb0cba8791c304205c", "url": "https://github.com/powsybl/powsybl-core/commit/7350520a760fb411aa4547bb0cba8791c304205c", "message": "corrections\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2020-01-31T14:49:06Z", "type": "commit"}, {"oid": "bed74fdfb731cd9802730e5566f3a00a0426498d", "url": "https://github.com/powsybl/powsybl-core/commit/bed74fdfb731cd9802730e5566f3a00a0426498d", "message": "corrections\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2020-01-31T14:49:06Z", "type": "commit"}, {"oid": "16022487668317214fb94690db9f9e7633ca37d7", "url": "https://github.com/powsybl/powsybl-core/commit/16022487668317214fb94690db9f9e7633ca37d7", "message": "deprecate writeCurrentLimits without IidmXmlVersion parameter\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2020-01-31T14:49:06Z", "type": "commit"}, {"oid": "16022487668317214fb94690db9f9e7633ca37d7", "url": "https://github.com/powsybl/powsybl-core/commit/16022487668317214fb94690db9f9e7633ca37d7", "message": "deprecate writeCurrentLimits without IidmXmlVersion parameter\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2020-01-31T14:49:06Z", "type": "forcePushed"}, {"oid": "ada74a0dd5a9f696eb44edd4b5977fb82eaed3ea", "url": "https://github.com/powsybl/powsybl-core/commit/ada74a0dd5a9f696eb44edd4b5977fb82eaed3ea", "message": "Merge branch 'master' into xiidm_write_versionable", "committedDate": "2020-01-31T14:53:37Z", "type": "commit"}]}