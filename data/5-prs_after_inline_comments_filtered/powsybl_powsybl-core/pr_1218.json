{"pr_number": 1218, "pr_title": "Ensure that voltageLevel.getConnectables() and associated return collections of distinct elements", "pr_createdAt": "2020-03-10T16:38:38Z", "pr_url": "https://github.com/powsybl/powsybl-core/pull/1218", "timeline": [{"oid": "484c4cd8fd1517cae44a388e2d185d8b25c61742", "url": "https://github.com/powsybl/powsybl-core/commit/484c4cd8fd1517cae44a388e2d185d8b25c61742", "message": "Ensure that voltageLevel.getConnectables() and associated return collections of distinct elements\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2020-03-10T16:36:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDgzNzU0MA==", "url": "https://github.com/powsybl/powsybl-core/pull/1218#discussion_r390837540", "bodyText": "Why do you change FluentIterable into Iterable here?", "author": "agnesLeroy", "createdAt": "2020-03-11T09:22:56Z", "path": "iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/AbstractVoltageLevel.java", "diffHunk": "@@ -123,41 +124,45 @@ public VoltageLevel setHighVoltageLimit(double highVoltageLimit) {\n     }\n \n     @Override\n-    public <T extends Connectable> FluentIterable<T> getConnectables(Class<T> clazz) {\n+    public <T extends Connectable> Iterable<T> getConnectables(Class<T> clazz) {", "originalCommit": "484c4cd8fd1517cae44a388e2d185d8b25c61742", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDg4NTYwMA==", "url": "https://github.com/powsybl/powsybl-core/pull/1218#discussion_r390885600", "bodyText": "FluentIterable extends Iterable and is more powerful (can chain more easily like streams for example). However, when ensuring its elements are distinct by using toSet(), I am returning a ImmutableSet which extends Iterable too but not FluentIterable", "author": "miovd", "createdAt": "2020-03-11T10:47:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDgzNzU0MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDgzODA3OQ==", "url": "https://github.com/powsybl/powsybl-core/pull/1218#discussion_r390838079", "bodyText": "Do I get it right that using count() is a better practice than using size(), and that count() returns a long so you need to cast it to an int?", "author": "agnesLeroy", "createdAt": "2020-03-11T09:23:51Z", "path": "iidm/iidm-impl/src/main/java/com/powsybl/iidm/network/impl/AbstractVoltageLevel.java", "diffHunk": "@@ -123,41 +124,45 @@ public VoltageLevel setHighVoltageLimit(double highVoltageLimit) {\n     }\n \n     @Override\n-    public <T extends Connectable> FluentIterable<T> getConnectables(Class<T> clazz) {\n+    public <T extends Connectable> Iterable<T> getConnectables(Class<T> clazz) {\n         Iterable<Terminal> terminals = getTerminals();\n         return FluentIterable.from(terminals)\n                 .transform(Terminal::getConnectable)\n-                .filter(clazz);\n+                .filter(clazz)\n+                .toSet();\n     }\n \n     @Override\n     public <T extends Connectable> Stream<T> getConnectableStream(Class<T> clazz) {\n         return getTerminalStream()\n                 .map(Terminal::getConnectable)\n                 .filter(clazz::isInstance)\n-                .map(clazz::cast);\n+                .map(clazz::cast)\n+                .distinct();\n     }\n \n     @Override\n     public <T extends Connectable> int getConnectableCount(Class<T> clazz) {\n-        return getConnectables(clazz).size();\n+        return Ints.checkedCast(getConnectableStream(clazz).count());", "originalCommit": "484c4cd8fd1517cae44a388e2d185d8b25c61742", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDg4NDg0Mw==", "url": "https://github.com/powsybl/powsybl-core/pull/1218#discussion_r390884843", "bodyText": "No, I only used count() because size() does not exist for streams or for iterables (only for fluentiterables). However, you're right, count() returns a long that I casted.", "author": "miovd", "createdAt": "2020-03-11T10:46:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDgzODA3OQ=="}], "type": "inlineReview"}, {"oid": "f0bf9825e7dd1c56e92cd63c360c601969527713", "url": "https://github.com/powsybl/powsybl-core/commit/f0bf9825e7dd1c56e92cd63c360c601969527713", "message": "Add tests\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2020-03-11T12:29:40Z", "type": "forcePushed"}, {"oid": "f0bf9825e7dd1c56e92cd63c360c601969527713", "url": "https://github.com/powsybl/powsybl-core/commit/f0bf9825e7dd1c56e92cd63c360c601969527713", "message": "Add tests\n\nSigned-off-by: RALAMBOTIANA MIORA <miora.ralambotiana@rte-france.com>", "committedDate": "2020-03-11T12:29:40Z", "type": "commit"}, {"oid": "768d40c980706b1a9590fc64cc4a1605806641c1", "url": "https://github.com/powsybl/powsybl-core/commit/768d40c980706b1a9590fc64cc4a1605806641c1", "message": "Merge branch 'master' into check_distinct_connectable_vl", "committedDate": "2020-03-12T08:42:03Z", "type": "commit"}]}