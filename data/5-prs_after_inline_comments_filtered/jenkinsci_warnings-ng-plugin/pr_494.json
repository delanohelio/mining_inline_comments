{"pr_number": 494, "pr_title": "add TrendChartsUITests", "pr_createdAt": "2020-05-26T18:46:58Z", "pr_url": "https://github.com/jenkinsci/warnings-ng-plugin/pull/494", "timeline": [{"oid": "954a4b17f02e5b02886482a7c4eae4f983d84b44", "url": "https://github.com/jenkinsci/warnings-ng-plugin/commit/954a4b17f02e5b02886482a7c4eae4f983d84b44", "message": "add TrendChartsTable and TrendChartsUITest, WIP", "committedDate": "2020-05-26T18:44:18Z", "type": "commit"}, {"oid": "7514876de3a29181c7ba5edde936254e735b56fa", "url": "https://github.com/jenkinsci/warnings-ng-plugin/commit/7514876de3a29181c7ba5edde936254e735b56fa", "message": "zwischenstand", "committedDate": "2020-05-27T11:36:11Z", "type": "commit"}, {"oid": "265f71bbf526d33ae359eb00856618720b0981f4", "url": "https://github.com/jenkinsci/warnings-ng-plugin/commit/265f71bbf526d33ae359eb00856618720b0981f4", "message": "Merge remote-tracking branch 'upstream/master' into Jenkins-62188/add-ui-test-for-trend-charts", "committedDate": "2020-05-27T12:25:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTEyODI4Nw==", "url": "https://github.com/jenkinsci/warnings-ng-plugin/pull/494#discussion_r431128287", "bodyText": "JUnit 4 brauchen wir hier. Sonst wird der Jenkins nicht hochgefahren, was zu einer NPE f\u00fchrt...", "author": "uhafner", "createdAt": "2020-05-27T13:25:23Z", "path": "ui-tests/src/test/java/io/jenkins/plugins/analysis/warnings/TrendChartsUiTest.java", "diffHunk": "@@ -0,0 +1,40 @@\n+package io.jenkins.plugins.analysis.warnings;\n+\n+import org.junit.jupiter.api.Test;", "originalCommit": "954a4b17f02e5b02886482a7c4eae4f983d84b44", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTEyODY5Mw==", "url": "https://github.com/jenkinsci/warnings-ng-plugin/pull/494#discussion_r431128693", "bodyText": "Evtl. fehlt auch noch @WithPlugins", "author": "uhafner", "createdAt": "2020-05-27T13:26:02Z", "path": "ui-tests/src/test/java/io/jenkins/plugins/analysis/warnings/TrendChartsUiTest.java", "diffHunk": "@@ -0,0 +1,40 @@\n+package io.jenkins.plugins.analysis.warnings;\n+\n+import org.junit.jupiter.api.Test;\n+\n+import org.jenkinsci.test.acceptance.junit.AbstractJUnitTest;\n+import org.jenkinsci.test.acceptance.po.Build;\n+import org.jenkinsci.test.acceptance.po.FreeStyleJob;\n+import org.jenkinsci.test.acceptance.po.Job;\n+\n+import static io.jenkins.plugins.analysis.warnings.Assertions.*;\n+\n+public class TrendChartsUiTest extends AbstractJUnitTest {", "originalCommit": "954a4b17f02e5b02886482a7c4eae4f983d84b44", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "fbc5ac11ffd5773ab2334e917414f9b64c721c50", "url": "https://github.com/jenkinsci/warnings-ng-plugin/commit/fbc5ac11ffd5773ab2334e917414f9b64c721c50", "message": "remove unused imports in ChartsITest, create TrendChart PageObject, wip on TrendChartsUiTest", "committedDate": "2020-05-27T13:55:00Z", "type": "commit"}, {"oid": "3af3d1061d80bd699b0254d70ae16f3ce813b362", "url": "https://github.com/jenkinsci/warnings-ng-plugin/commit/3af3d1061d80bd699b0254d70ae16f3ce813b362", "message": "current status", "committedDate": "2020-05-28T07:52:11Z", "type": "commit"}, {"oid": "e5f433d5ab173da446501f9c419066e9f0a99c1d", "url": "https://github.com/jenkinsci/warnings-ng-plugin/commit/e5f433d5ab173da446501f9c419066e9f0a99c1d", "message": "finish Test that clicks through different trend charts", "committedDate": "2020-05-28T15:41:07Z", "type": "commit"}, {"oid": "81d8a550877e2e662609b476554e1b3e61fac0d5", "url": "https://github.com/jenkinsci/warnings-ng-plugin/commit/81d8a550877e2e662609b476554e1b3e61fac0d5", "message": "refactor comments, names and resolve checkstyle warning", "committedDate": "2020-05-28T15:54:01Z", "type": "commit"}, {"oid": "1b15204c8c198706f7f891098f59f1d631e256f8", "url": "https://github.com/jenkinsci/warnings-ng-plugin/commit/1b15204c8c198706f7f891098f59f1d631e256f8", "message": "trying to run javascript", "committedDate": "2020-06-01T14:20:20Z", "type": "commit"}, {"oid": "f7bedc61673c88a10be05f6284c1c8ecd216ae8c", "url": "https://github.com/jenkinsci/warnings-ng-plugin/commit/f7bedc61673c88a10be05f6284c1c8ecd216ae8c", "message": "add working version of javascript execution", "committedDate": "2020-06-03T16:08:10Z", "type": "commit"}, {"oid": "db2d13a5c8c7f367c78ffadc7677d6d0261200a4", "url": "https://github.com/jenkinsci/warnings-ng-plugin/commit/db2d13a5c8c7f367c78ffadc7677d6d0261200a4", "message": "add json-smart from net.minidev to Pom.xml, Fix getChartModel in AnalysisResult, Add test that verifies the different TrendChartResults", "committedDate": "2020-06-04T15:58:35Z", "type": "commit"}, {"oid": "a746b1a34c8bce06364e4aba354ae0cd831c2df7", "url": "https://github.com/jenkinsci/warnings-ng-plugin/commit/a746b1a34c8bce06364e4aba354ae0cd831c2df7", "message": "Change json parser mode to permissive (smart mode, fastest parsing mode. accept lots of non standard json syntax)", "committedDate": "2020-06-06T09:32:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTIwMDg4NQ==", "url": "https://github.com/jenkinsci/warnings-ng-plugin/pull/494#discussion_r435200885", "bodyText": "K\u00f6nnen Sie da einfach einen String zur\u00fcckliefern und dann im Test:\nassertThatJson(getChartModel(xyz)).isArray().hasSize(2)\n                .contains(first)\n                .contains(second);\n\nSiehe https://github.com/lukas-krecan/JsonUnit#assertj-integration.\nDazu braucht es im POM:\n<dependency>\n    <groupId>net.javacrumbs.json-unit</groupId>\n    <artifactId>json-unit-assertj</artifactId>\n    <version>2.17.0</version>\n    <scope>test</scope>\n</dependency>", "author": "uhafner", "createdAt": "2020-06-04T12:03:46Z", "path": "ui-tests/src/main/java/io/jenkins/plugins/analysis/warnings/AnalysisResult.java", "diffHunk": "@@ -175,6 +180,57 @@ public AnalysisResult openFilterLinkOnSite(final WebElement element) {\n         return retVal;\n     }\n \n+    /**\n+     * returns the TrendChart Carousel DOM Node.\n+     *\n+     * @return trendChart Carousel.\n+     */\n+    public WebElement getTrendChart() {\n+        return find(By.id(\"trend-carousel\"));\n+    }\n+\n+    /**\n+     * returns the Severities Trend Chart.\n+     *\n+     * @return severities TrendChart as JSONObject.\n+     */\n+    public JSONObject getSeveritiesTrendChart() throws JSONException {\n+        return getChartModel(\"severities-trend-chart\");\n+    }\n+\n+    /**\n+     * returns the new versus fixed Trend Chart.\n+     *\n+     * @return new versus fixed TrendChart as JSONObject.\n+     */\n+    public JSONObject getNewVersusFixedTrendChart() throws JSONException {\n+        return getChartModel(\"new-versus-fixed-trend-chart\");\n+    }\n+\n+    /**\n+     * returns the tools Trend Chart.\n+     *\n+     * @return tools TrendChart as JSONObject.\n+     */\n+    public JSONObject getToolsTrendChart() throws JSONException {\n+        return getChartModel(\"tools-trend-chart\");\n+    }\n+\n+    protected JSONObject getChartModel(final String id) throws JSONException {", "originalCommit": "f7bedc61673c88a10be05f6284c1c8ecd216ae8c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI4OTcyNw==", "url": "https://github.com/jenkinsci/warnings-ng-plugin/pull/494#discussion_r436289727", "bodyText": "Vielleicht ist mein Rechner zu schnell oder langsam, ich musste folgendes erg\u00e4nzen:\n        nextButton.click();\n        waitFor().until(() -> !trendChart.findElement(By.id(\"severities-trend-chart\")).isDisplayed());", "author": "uhafner", "createdAt": "2020-06-06T18:24:25Z", "path": "ui-tests/src/test/java/io/jenkins/plugins/analysis/warnings/TrendChartsUiTest.java", "diffHunk": "@@ -0,0 +1,186 @@\n+package io.jenkins.plugins.analysis.warnings;\n+\n+import net.minidev.json.JSONObject;\n+import net.minidev.json.JSONArray;\n+\n+import org.junit.Test;\n+import org.openqa.selenium.By;\n+import org.openqa.selenium.WebElement;\n+\n+import net.minidev.json.parser.JSONParser;\n+import net.minidev.json.parser.ParseException;\n+\n+import org.jenkinsci.test.acceptance.junit.AbstractJUnitTest;\n+import org.jenkinsci.test.acceptance.junit.WithPlugins;\n+import org.jenkinsci.test.acceptance.po.Build;\n+import org.jenkinsci.test.acceptance.po.FreeStyleJob;\n+import org.jenkinsci.test.acceptance.po.Job;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+/**\n+ * Ui test for the Trend Charts Table.\n+ *\n+ * @author Mitja Oldenbourg\n+ */\n+@WithPlugins(\"warnings-ng\")\n+public class TrendChartsUiTest extends AbstractJUnitTest {\n+    private static final String WARNINGS_PLUGIN_PREFIX = \"/\";\n+    private static final String SOURCE_VIEW_FOLDER = WARNINGS_PLUGIN_PREFIX + \"trend_charts_tests/\";\n+    private static final JSONParser JSON_PARSER = new JSONParser(JSONParser.MODE_PERMISSIVE);\n+\n+    /**\n+     * Click on next-button switches between different Chart-types.\n+     */\n+    @Test\n+    public void shouldDisplayDifferentTrendChartsOnClick() {\n+        FreeStyleJob job = createFreeStyleJob(\"build_01\");\n+        job.addPublisher(IssuesRecorder.class, recorder -> recorder.setToolWithPattern(\"Java\", \"**/*.txt\"));\n+        job.save();\n+\n+        shouldBuildJobSuccessfully(job);\n+        reconfigureJobWithResource(job);\n+\n+        Build build = shouldBuildJobSuccessfully(job);\n+\n+        AnalysisResult analysisResultPage = new AnalysisResult(build, \"java\");\n+        analysisResultPage.open();\n+        WebElement trendChart = analysisResultPage.getTrendChart();\n+        WebElement nextButton = trendChart.findElement(By.className(\"carousel-control-next-icon\"));\n+\n+        assertThat(trendChart.findElement(By.id(\"severities-trend-chart\")).isDisplayed()).isTrue();\n+\n+        nextButton.click();", "originalCommit": "a746b1a34c8bce06364e4aba354ae0cd831c2df7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI4OTc2OA==", "url": "https://github.com/jenkinsci/warnings-ng-plugin/pull/494#discussion_r436289768", "bodyText": "Der Test soll keine WebElements kennen, daf\u00fcr ist das Page Objekt da.", "author": "uhafner", "createdAt": "2020-06-06T18:25:03Z", "path": "ui-tests/src/test/java/io/jenkins/plugins/analysis/warnings/TrendChartsUiTest.java", "diffHunk": "@@ -0,0 +1,186 @@\n+package io.jenkins.plugins.analysis.warnings;\n+\n+import net.minidev.json.JSONObject;\n+import net.minidev.json.JSONArray;\n+\n+import org.junit.Test;\n+import org.openqa.selenium.By;\n+import org.openqa.selenium.WebElement;\n+\n+import net.minidev.json.parser.JSONParser;\n+import net.minidev.json.parser.ParseException;\n+\n+import org.jenkinsci.test.acceptance.junit.AbstractJUnitTest;\n+import org.jenkinsci.test.acceptance.junit.WithPlugins;\n+import org.jenkinsci.test.acceptance.po.Build;\n+import org.jenkinsci.test.acceptance.po.FreeStyleJob;\n+import org.jenkinsci.test.acceptance.po.Job;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+/**\n+ * Ui test for the Trend Charts Table.\n+ *\n+ * @author Mitja Oldenbourg\n+ */\n+@WithPlugins(\"warnings-ng\")\n+public class TrendChartsUiTest extends AbstractJUnitTest {\n+    private static final String WARNINGS_PLUGIN_PREFIX = \"/\";\n+    private static final String SOURCE_VIEW_FOLDER = WARNINGS_PLUGIN_PREFIX + \"trend_charts_tests/\";\n+    private static final JSONParser JSON_PARSER = new JSONParser(JSONParser.MODE_PERMISSIVE);\n+\n+    /**\n+     * Click on next-button switches between different Chart-types.\n+     */\n+    @Test\n+    public void shouldDisplayDifferentTrendChartsOnClick() {\n+        FreeStyleJob job = createFreeStyleJob(\"build_01\");\n+        job.addPublisher(IssuesRecorder.class, recorder -> recorder.setToolWithPattern(\"Java\", \"**/*.txt\"));\n+        job.save();\n+\n+        shouldBuildJobSuccessfully(job);\n+        reconfigureJobWithResource(job);\n+\n+        Build build = shouldBuildJobSuccessfully(job);\n+\n+        AnalysisResult analysisResultPage = new AnalysisResult(build, \"java\");\n+        analysisResultPage.open();\n+        WebElement trendChart = analysisResultPage.getTrendChart();", "originalCommit": "a746b1a34c8bce06364e4aba354ae0cd831c2df7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI5MDE2Mg==", "url": "https://github.com/jenkinsci/warnings-ng-plugin/pull/494#discussion_r436290162", "bodyText": "Der Test schl\u00e4gt fehl?\njava.lang.ClassCastException: java.lang.Integer cannot be cast to java.lang.Long\n\n\tat io.jenkins.plugins.analysis.warnings.TrendChartsUiTest.convertToIntArray(TrendChartsUiTest.java:183)\n\tat io.jenkins.plugins.analysis.warnings.TrendChartsUiTest.verifyToolsChart(TrendChartsUiTest.java:121)\n\tat io.jenkins.plugins.analysis.warnings.TrendChartsUiTest.shouldShowTrendChartsWithCorrectResults(TrendChartsUiTest.java:73)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:498)\n\tat org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50)\n\tat org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)\n\tat org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:47)\n\tat org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)\n\tat org.jenkinsci.test.acceptance.junit.WithPlugins$RuleImpl$1.evaluate(WithPlugins.java:164)\n\tat org.junit.rules.TestWatcher$1.evaluate(TestWatcher.java:55)\n\tat org.junit.rules.TestWatcher$1.evaluate(TestWatcher.java:55)\n\tat org.junit.rules.TestWatcher$1.evaluate(TestWatcher.java:55)\n\tat org.jenkinsci.test.acceptance.junit.JenkinsAcceptanceTestRule$1$2$1.evaluate(JenkinsAcceptanceTestRule.java:168)\n\tat org.jenkinsci.test.acceptance.junit.FilterRule$1.evaluate(FilterRule.java:63)\n\tat org.junit.rules.TestWatcher$1.evaluate(TestWatcher.java:55)\n\tat org.jenkinsci.test.acceptance.junit.JenkinsAcceptanceTestRule$1.evaluate(JenkinsAcceptanceTestRule.java:58)\n\tat org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:325)\n\tat org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:78)\n\tat org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:57)\n\tat org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)\n\tat org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71)\n\tat org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288)\n\tat org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)\n\tat org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)\n\tat org.junit.runners.ParentRunner.run(ParentRunner.java:363)\n\tat org.junit.runner.JUnitCore.run(JUnitCore.java:137)\n\tat com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:68)\n\tat com.intellij.rt.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:33)\n\tat com.intellij.rt.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:230)\n\tat com.intellij.rt.junit.JUnitStarter.main(JUnitStarter.java:58)", "author": "uhafner", "createdAt": "2020-06-06T18:30:51Z", "path": "ui-tests/src/test/java/io/jenkins/plugins/analysis/warnings/TrendChartsUiTest.java", "diffHunk": "@@ -0,0 +1,186 @@\n+package io.jenkins.plugins.analysis.warnings;\n+\n+import net.minidev.json.JSONObject;\n+import net.minidev.json.JSONArray;\n+\n+import org.junit.Test;\n+import org.openqa.selenium.By;\n+import org.openqa.selenium.WebElement;\n+\n+import net.minidev.json.parser.JSONParser;\n+import net.minidev.json.parser.ParseException;\n+\n+import org.jenkinsci.test.acceptance.junit.AbstractJUnitTest;\n+import org.jenkinsci.test.acceptance.junit.WithPlugins;\n+import org.jenkinsci.test.acceptance.po.Build;\n+import org.jenkinsci.test.acceptance.po.FreeStyleJob;\n+import org.jenkinsci.test.acceptance.po.Job;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+/**\n+ * Ui test for the Trend Charts Table.\n+ *\n+ * @author Mitja Oldenbourg\n+ */\n+@WithPlugins(\"warnings-ng\")\n+public class TrendChartsUiTest extends AbstractJUnitTest {\n+    private static final String WARNINGS_PLUGIN_PREFIX = \"/\";\n+    private static final String SOURCE_VIEW_FOLDER = WARNINGS_PLUGIN_PREFIX + \"trend_charts_tests/\";\n+    private static final JSONParser JSON_PARSER = new JSONParser(JSONParser.MODE_PERMISSIVE);\n+\n+    /**\n+     * Click on next-button switches between different Chart-types.\n+     */\n+    @Test\n+    public void shouldDisplayDifferentTrendChartsOnClick() {\n+        FreeStyleJob job = createFreeStyleJob(\"build_01\");\n+        job.addPublisher(IssuesRecorder.class, recorder -> recorder.setToolWithPattern(\"Java\", \"**/*.txt\"));\n+        job.save();\n+\n+        shouldBuildJobSuccessfully(job);\n+        reconfigureJobWithResource(job);\n+\n+        Build build = shouldBuildJobSuccessfully(job);\n+\n+        AnalysisResult analysisResultPage = new AnalysisResult(build, \"java\");\n+        analysisResultPage.open();\n+        WebElement trendChart = analysisResultPage.getTrendChart();\n+        WebElement nextButton = trendChart.findElement(By.className(\"carousel-control-next-icon\"));\n+\n+        assertThat(trendChart.findElement(By.id(\"severities-trend-chart\")).isDisplayed()).isTrue();\n+\n+        nextButton.click();\n+\n+        assertThat(trendChart.findElement(By.id(\"tools-trend-chart\")).isDisplayed()).isTrue();\n+\n+        nextButton.click();\n+\n+        assertThat(trendChart.findElement(By.id(\"new-versus-fixed-trend-chart\")).isDisplayed()).isTrue();\n+    }\n+\n+    /** Verifies all Charts after a series of 2 builds. */\n+    @Test\n+    public void shouldShowTrendChartsWithCorrectResults() throws ParseException {", "originalCommit": "a746b1a34c8bce06364e4aba354ae0cd831c2df7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODA3NDQ0Nw==", "url": "https://github.com/jenkinsci/warnings-ng-plugin/pull/494#discussion_r438074447", "bodyText": "Seltsam. Bei mir laufen alle durch. Ich schaue es mir jetzt an.", "author": "MOldenbourg", "createdAt": "2020-06-10T12:14:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI5MDE2Mg=="}], "type": "inlineReview"}, {"oid": "bf33e411f9e48b44e21e9690dff00c6ed18d4f28", "url": "https://github.com/jenkinsci/warnings-ng-plugin/commit/bf33e411f9e48b44e21e9690dff00c6ed18d4f28", "message": "broken git. Hope to fix it. Changes: executeScript now returns correct JSON - Big error in JSON.stringify. AssertThatJson.inPath somehow does not work. Still figuring this out.", "committedDate": "2020-06-16T16:51:35Z", "type": "commit"}, {"oid": "9d0c5cbb20257b31ece53156d38199fb5f66d932", "url": "https://github.com/jenkinsci/warnings-ng-plugin/commit/9d0c5cbb20257b31ece53156d38199fb5f66d932", "message": "add stuff that got lost during git issue", "committedDate": "2020-06-16T16:58:44Z", "type": "commit"}, {"oid": "d523fa8b368befe4c9726072031c63dea1aeba3c", "url": "https://github.com/jenkinsci/warnings-ng-plugin/commit/d523fa8b368befe4c9726072031c63dea1aeba3c", "message": "Working Tests for Trendcharts", "committedDate": "2020-06-17T11:36:26Z", "type": "commit"}, {"oid": "b91fd1187f9ea545c43cc5dcc2cb2d69f9a11f1b", "url": "https://github.com/jenkinsci/warnings-ng-plugin/commit/b91fd1187f9ea545c43cc5dcc2cb2d69f9a11f1b", "message": "fix comments", "committedDate": "2020-06-17T11:40:32Z", "type": "commit"}]}