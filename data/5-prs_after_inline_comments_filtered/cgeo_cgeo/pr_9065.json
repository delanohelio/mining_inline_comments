{"pr_number": 9065, "pr_title": "fix #8897 and #4023: provide direct log link ability for gc.com/oc.x/gc.su, use in GPX export", "pr_createdAt": "2020-09-25T13:08:46Z", "pr_url": "https://github.com/cgeo/cgeo/pull/9065", "timeline": [{"oid": "6e8e79aa12df3b9c12d9c3e5a1c2dbb5fff70985", "url": "https://github.com/cgeo/cgeo/commit/6e8e79aa12df3b9c12d9c3e5a1c2dbb5fff70985", "message": "fix #8897: provide direct log link ability for gc.com/oc.x/gc.su", "committedDate": "2020-09-25T13:18:59Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTAxMTg2OA==", "url": "https://github.com/cgeo/cgeo/pull/9065#discussion_r495011868", "bodyText": "Typo aravilable", "author": "okainov", "createdAt": "2020-09-25T14:06:37Z", "path": "main/src/cgeo/geocaching/connector/IConnector.java", "diffHunk": "@@ -52,6 +53,21 @@\n     @Nullable\n     String getLongCacheUrl(@NonNull Geocache cache);\n \n+    /**\n+     * Get the browser URL for the given LogEntry. May return null if no url aravilable or identifiable.", "originalCommit": "6e8e79aa12df3b9c12d9c3e5a1c2dbb5fff70985", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTA1NTc3NA==", "url": "https://github.com/cgeo/cgeo/pull/9065#discussion_r495055774", "bodyText": "will be fixed", "author": "eddiemuc", "createdAt": "2020-09-25T15:13:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTAxMTg2OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTAxMjY2Nw==", "url": "https://github.com/cgeo/cgeo/pull/9065#discussion_r495012667", "bodyText": "Why would you need to display log ID to the user at all?", "author": "okainov", "createdAt": "2020-09-25T14:07:51Z", "path": "main/src/cgeo/geocaching/connector/IConnector.java", "diffHunk": "@@ -52,6 +53,21 @@\n     @Nullable\n     String getLongCacheUrl(@NonNull Geocache cache);\n \n+    /**\n+     * Get the browser URL for the given LogEntry. May return null if no url aravilable or identifiable.\n+     */\n+    @Nullable\n+    String getCacheLogUrl(@NonNull Geocache cache, @NonNull LogEntry logEntry);\n+\n+    /**\n+     * For a given service-log-id (as assigned by this IConnector and stored as service log id in log entries),\n+     * returns a logid ready for display to the user (e.g. in the GUI)\n+     * May return null if there is no displayable log id.\n+     */\n+    @Nullable\n+    String getDisplayableLogId(@Nullable String serviceLogId);", "originalCommit": "6e8e79aa12df3b9c12d9c3e5a1c2dbb5fff70985", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTA1MDk0Ng==", "url": "https://github.com/cgeo/cgeo/pull/9065#discussion_r495050946", "bodyText": "I currently display it in the popup when you click on log as well as next to the log entry in the log list (as announced in the screenshot in the issue #8897 ). Don't like it? Let's discuss it there.", "author": "eddiemuc", "createdAt": "2020-09-25T15:05:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTAxMjY2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTA3MDU2NA==", "url": "https://github.com/cgeo/cgeo/pull/9065#discussion_r495070564", "bodyText": "I don't think log ID gives any value to the user :)", "author": "okainov", "createdAt": "2020-09-25T15:36:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTAxMjY2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTIyNjQxNg==", "url": "https://github.com/cgeo/cgeo/pull/9065#discussion_r495226416", "bodyText": "@okainov I think it is better to have these discussions in the issue itself , because imho they are documented better that way. Following this issue, I wanted to delete the log ids on the log entries and change the title to \"Log (logid) of (username)\". But maybe you want to suggest something different?", "author": "eddiemuc", "createdAt": "2020-09-25T20:55:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTAxMjY2Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTAxNjU0MQ==", "url": "https://github.com/cgeo/cgeo/pull/9065#discussion_r495016541", "bodyText": "Just wonder, why do you discard usage of method and use member instead?", "author": "okainov", "createdAt": "2020-09-25T14:12:51Z", "path": "main/src/cgeo/geocaching/log/LogsViewCreator.java", "diffHunk": "@@ -96,13 +107,13 @@ protected void fillViewHolder(@SuppressWarnings(\"unused\") final View convertView\n         if (log.hasLogImages()) {\n             holder.images.setText(log.getImageTitles());\n             holder.images.setVisibility(View.VISIBLE);\n-            holder.images.setOnClickListener(v -> ImagesActivity.startActivity(activity, getGeocode(), new ArrayList<>(log.getLogImages())));\n+            holder.images.setOnClickListener(v -> ImagesActivity.startActivity(activity, getGeocode(), new ArrayList<>(log.logImages)));", "originalCommit": "6e8e79aa12df3b9c12d9c3e5a1c2dbb5fff70985", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTA0OTM1Mg==", "url": "https://github.com/cgeo/cgeo/pull/9065#discussion_r495049352", "bodyText": "method was deprecated", "author": "eddiemuc", "createdAt": "2020-09-25T15:02:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTAxNjU0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTA3MDA1OA==", "url": "https://github.com/cgeo/cgeo/pull/9065#discussion_r495070058", "bodyText": "Okay, I'm not really following all the code changes, but typically it's a good practice to use methods over member variables... Anyway, no problem here", "author": "okainov", "createdAt": "2020-09-25T15:36:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTAxNjU0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTIyNTMwMA==", "url": "https://github.com/cgeo/cgeo/pull/9065#discussion_r495225300", "bodyText": "@okainov there is (or maybe was? I remember this from a couple of years ago...) a big debate regarding how to model immutable value objects in Java. While one side argues that also for immutable objects (which of course have no setter methods) explicit getter objects shall be used, the other argues that in this case one can also access directly final members. If you google \"java immutable objects\" you will find lots of sides about this.\nI personally don't mind which pattern is used :-) BUt whoever modelled LogEntry in the first place was clearly advocating the second solution. So I decided to follow it. Because although I don't care too much which pattern to follow (as long as it is sensible enough), I like it when all code follows the SAME pattern :-)", "author": "eddiemuc", "createdAt": "2020-09-25T20:52:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTAxNjU0MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTAxNjY4Mg==", "url": "https://github.com/cgeo/cgeo/pull/9065#discussion_r495016682", "bodyText": "same here", "author": "okainov", "createdAt": "2020-09-25T14:13:02Z", "path": "main/src/cgeo/geocaching/log/LogsViewCreator.java", "diffHunk": "@@ -96,13 +107,13 @@ protected void fillViewHolder(@SuppressWarnings(\"unused\") final View convertView\n         if (log.hasLogImages()) {\n             holder.images.setText(log.getImageTitles());\n             holder.images.setVisibility(View.VISIBLE);\n-            holder.images.setOnClickListener(v -> ImagesActivity.startActivity(activity, getGeocode(), new ArrayList<>(log.getLogImages())));\n+            holder.images.setOnClickListener(v -> ImagesActivity.startActivity(activity, getGeocode(), new ArrayList<>(log.logImages)));\n         } else {\n             holder.images.setVisibility(View.GONE);\n         }\n \n         // colored marker\n-        final int marker = log.getType().markerId;\n+        final int marker = log.logType.markerId;", "originalCommit": "6e8e79aa12df3b9c12d9c3e5a1c2dbb5fff70985", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTA1MTIyMg==", "url": "https://github.com/cgeo/cgeo/pull/9065#discussion_r495051222", "bodyText": "same reason: method was deprecated", "author": "eddiemuc", "createdAt": "2020-09-25T15:05:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTAxNjY4Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTAxODM0NA==", "url": "https://github.com/cgeo/cgeo/pull/9065#discussion_r495018344", "bodyText": "Typo", "author": "okainov", "createdAt": "2020-09-25T14:15:26Z", "path": "main/src/cgeo/geocaching/ui/dialog/ContextMenuDialog.java", "diffHunk": "@@ -0,0 +1,148 @@\n+package cgeo.geocaching.ui.dialog;\n+\n+import cgeo.geocaching.utils.CollectionStream;\n+import cgeo.geocaching.utils.functions.Action1;\n+\n+import android.app.AlertDialog;\n+import android.content.Context;\n+import android.content.DialogInterface;\n+import android.graphics.Rect;\n+import android.graphics.drawable.Drawable;\n+import android.view.View;\n+import android.view.ViewGroup;\n+import android.widget.ArrayAdapter;\n+import android.widget.ListAdapter;\n+import android.widget.TextView;\n+\n+import androidx.annotation.DrawableRes;\n+import androidx.annotation.StringRes;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+/**\n+ * Represents a dlaig usable as a context menu for various elements.", "originalCommit": "6e8e79aa12df3b9c12d9c3e5a1c2dbb5fff70985", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTA1NTI2NQ==", "url": "https://github.com/cgeo/cgeo/pull/9065#discussion_r495055265", "bodyText": "will be fixed", "author": "eddiemuc", "createdAt": "2020-09-25T15:12:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTAxODM0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTAyMTc4Mg==", "url": "https://github.com/cgeo/cgeo/pull/9065#discussion_r495021782", "bodyText": "Seems like it was done, is todo still valid?", "author": "okainov", "createdAt": "2020-09-25T14:20:40Z", "path": "tests/src-android/cgeo/geocaching/storage/DataStoreTest.java", "diffHunk": "@@ -178,6 +181,22 @@ public static void testLoadLogsFromEmptyGeocode() {\n         assertThat(logs).as(\"Logs for empty geocode\").isEmpty();\n     }\n \n+    public static void testLog() {\n+        //ensure that we don't overwrite anything in database before starting this test\n+        DataStore.removeCache(ARTIFICIAL_GEOCODE, REMOVE_ALL);\n+        assertThat(DataStore.loadLogs(ARTIFICIAL_GEOCODE)).isEmpty();\n+\n+        //TODO: create some logs, try to reload them", "originalCommit": "6e8e79aa12df3b9c12d9c3e5a1c2dbb5fff70985", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTA1NDg3OQ==", "url": "https://github.com/cgeo/cgeo/pull/9065#discussion_r495054879", "bodyText": "correct, will be removed", "author": "eddiemuc", "createdAt": "2020-09-25T15:11:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTAyMTc4Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTAyMjU1Mg==", "url": "https://github.com/cgeo/cgeo/pull/9065#discussion_r495022552", "bodyText": "typo, same in other places", "author": "okainov", "createdAt": "2020-09-25T14:21:45Z", "path": "tests/src/cgeo/geocaching/connector/gc/GCUtilsTest.java", "diffHunk": "@@ -0,0 +1,85 @@\n+package cgeo.geocaching.connector.gc;\n+\n+import org.junit.Test;\n+import static org.assertj.core.api.Java6Assertions.assertThat;\n+\n+public class GCUtilsTest {\n+\n+    @Test\n+    public void gcCodesNormal() {\n+        testGcCodeRoundtrip(\"GC2MEGA\", 2045702);\n+        testGcCodeRoundtrip(\"GC1PKK9\", 1186660);\n+        testGcCodeRoundtrip(\"GC1234\", 4660);\n+        testGcCodeRoundtrip(\"GCF123\", 61731);\n+\n+        //following line is of no use, simply to pass Codacy (which requires an assert per unit test DIRECLTY in test method...)", "originalCommit": "6e8e79aa12df3b9c12d9c3e5a1c2dbb5fff70985", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTA1NDQ4Ng==", "url": "https://github.com/cgeo/cgeo/pull/9065#discussion_r495054486", "bodyText": "will be fixed", "author": "eddiemuc", "createdAt": "2020-09-25T15:11:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTAyMjU1Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTAyNDcwNQ==", "url": "https://github.com/cgeo/cgeo/pull/9065#discussion_r495024705", "bodyText": "What about simple test for it?", "author": "okainov", "createdAt": "2020-09-25T14:24:59Z", "path": "main/src/cgeo/geocaching/connector/su/SuParser.java", "diffHunk": "@@ -260,6 +261,7 @@ private static void parseDescription(final StringBuilder descriptionBuilder, fin\n             final boolean isOwnLog = logResponse.has(LOG_OWN) && logResponse.get(LOG_OWN).asInt() == 1;\n \n             final LogEntry log = new LogEntry.Builder()\n+                    .setServiceLogId(logResponse.get(LOG_ID).asText().trim())", "originalCommit": "6e8e79aa12df3b9c12d9c3e5a1c2dbb5fff70985", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTA1Mzk4MA==", "url": "https://github.com/cgeo/cgeo/pull/9065#discussion_r495053980", "bodyText": "Good idea, will add it to SuParserTest", "author": "eddiemuc", "createdAt": "2020-09-25T15:10:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTAyNDcwNQ=="}], "type": "inlineReview"}, {"oid": "b90b1dbed234d49c17285cc394638dcbd2a3d915", "url": "https://github.com/cgeo/cgeo/commit/b90b1dbed234d49c17285cc394638dcbd2a3d915", "message": "fix #8897: provide direct log link ability for gc.com/oc.x/gc.su", "committedDate": "2020-09-25T14:59:00Z", "type": "forcePushed"}, {"oid": "8667a116754c857f4218db72fd86de446bef1d0b", "url": "https://github.com/cgeo/cgeo/commit/8667a116754c857f4218db72fd86de446bef1d0b", "message": "fix #8897: provide direct log link ability for gc.com/oc.x/gc.su", "committedDate": "2020-09-25T15:15:42Z", "type": "forcePushed"}, {"oid": "3f9423f7272dcdc5404e68a2dfc5e121c0a66396", "url": "https://github.com/cgeo/cgeo/commit/3f9423f7272dcdc5404e68a2dfc5e121c0a66396", "message": "fix #8897: provide direct log link ability for gc.com/oc.x/gc.su", "committedDate": "2020-09-25T22:10:01Z", "type": "forcePushed"}, {"oid": "47871982275095715e5527dcaf3a660afc574695", "url": "https://github.com/cgeo/cgeo/commit/47871982275095715e5527dcaf3a660afc574695", "message": "fix #8897: provide direct log link ability for gc.com/oc.x/gc.su", "committedDate": "2020-09-26T09:24:50Z", "type": "forcePushed"}, {"oid": "91b7428c50b81be9e298d3f33976763a1ed3e685", "url": "https://github.com/cgeo/cgeo/commit/91b7428c50b81be9e298d3f33976763a1ed3e685", "message": "fix #8897 and #4032: provide direct log link ability for gc.com/oc.x/gc.su, use in GPX export", "committedDate": "2020-09-26T22:23:22Z", "type": "forcePushed"}, {"oid": "091fa3d694cb5e95780a5b0c6fab4dc11d71f99e", "url": "https://github.com/cgeo/cgeo/commit/091fa3d694cb5e95780a5b0c6fab4dc11d71f99e", "message": "fix #8897 and #4032: provide direct log link ability for gc.com/oc.x/gc.su, use in GPX export", "committedDate": "2020-09-27T10:24:03Z", "type": "forcePushed"}, {"oid": "fbf0f91c6ff2ae05f1a51365643fa20211d998d9", "url": "https://github.com/cgeo/cgeo/commit/fbf0f91c6ff2ae05f1a51365643fa20211d998d9", "message": "fix #8897 and #4032: provide direct log link ability for gc.com/oc.x/gc.su, use in GPX export", "committedDate": "2020-09-28T20:18:35Z", "type": "commit"}, {"oid": "fbf0f91c6ff2ae05f1a51365643fa20211d998d9", "url": "https://github.com/cgeo/cgeo/commit/fbf0f91c6ff2ae05f1a51365643fa20211d998d9", "message": "fix #8897 and #4032: provide direct log link ability for gc.com/oc.x/gc.su, use in GPX export", "committedDate": "2020-09-28T20:18:35Z", "type": "forcePushed"}]}