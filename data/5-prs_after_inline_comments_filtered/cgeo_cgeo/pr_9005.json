{"pr_number": 9005, "pr_title": "add logWriter utility class for separate and extended logfiles", "pr_createdAt": "2020-09-12T19:49:27Z", "pr_url": "https://github.com/cgeo/cgeo/pull/9005", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ0ODk5Ng==", "url": "https://github.com/cgeo/cgeo/pull/9005#discussion_r487448996", "bodyText": "You probably meant to write \"Log.i\" here? Because \"log\" logs to the newly created file, and when you are there the file path is known anyway", "author": "eddiemuc", "createdAt": "2020-09-12T21:08:48Z", "path": "main/src/cgeo/geocaching/utils/LogWriter.java", "diffHunk": "@@ -0,0 +1,71 @@\n+package cgeo.geocaching.utils;\n+\n+import java.io.File;\n+import java.io.FileNotFoundException;\n+import java.io.PrintWriter;\n+\n+public class LogWriter {\n+    private PrintWriter logWriter = null;\n+    private String prefix;\n+\n+    public LogWriter(final String prefix) {\n+        this.prefix = prefix;\n+        checkLogfile();\n+    }\n+\n+    public void log(final String info) {\n+        checkLogfile();\n+        if (null != logWriter) {\n+            logWriter.println(\"--------------------------------------------------------------------\");\n+            logWriter.println(CalendarUtils.formatDateTime(\"yyyy-MM-dd HH:mm:ss.SSS\"));\n+            logWriter.println(info);\n+        }\n+    }\n+\n+    public void d(final String info) {\n+        Log.d(info);\n+        log(info);\n+    }\n+\n+    public void e(final String info) {\n+        Log.e(info);\n+        log(info);\n+    }\n+\n+    public void i(final String info) {\n+        Log.i(info);\n+        log(info);\n+    }\n+\n+    public void v(final String info) {\n+        Log.v(info);\n+        log(info);\n+    }\n+\n+    public void w(final String info) {\n+        Log.w(info);\n+        log(info);\n+    }\n+\n+    public void close() {\n+        if (null != logWriter) {\n+            log(\"end of logging\");\n+            logWriter.println(\"--------------------------------------------------------------------\");\n+            logWriter.close();\n+            logWriter = null;\n+        }\n+    }\n+\n+    private void checkLogfile() {\n+        if (null == logWriter && Log.isDebug()) {\n+            final File logfile = FileUtils.getUniqueNamedLogfile(prefix, \"txt\");\n+            try {\n+                logWriter = new PrintWriter(logfile);\n+                log(\"begin logging to file \" + logfile.getPath());", "originalCommit": "de411d76b72d05c11ebb9806e0de38bbd7a84eb7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ1MDM5Ng==", "url": "https://github.com/cgeo/cgeo/pull/9005#discussion_r487450396", "bodyText": "This is mainly used for having a timestamp being logged, therefore calling the internal log instead of the \"old\" log.xxx method here. I agree, though, that the filename is not necessarily of use here.", "author": "moving-bits", "createdAt": "2020-09-12T21:26:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ0ODk5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ4NjY3NQ==", "url": "https://github.com/cgeo/cgeo/pull/9005#discussion_r487486675", "bodyText": "Ok understood", "author": "eddiemuc", "createdAt": "2020-09-13T06:05:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ0ODk5Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ0OTIyNw==", "url": "https://github.com/cgeo/cgeo/pull/9005#discussion_r487449227", "bodyText": "Since \"checkLogfile\" is called on every call to \"LogWriter\" again: if an exception is catched later (and logWriter stays null) then this check will be repeated again and again, and on every call to LogWriter it will again try to instantiate the logWriter. Maybe a flag should be used so trying to set up file once it failed is not repeated", "author": "eddiemuc", "createdAt": "2020-09-12T21:11:08Z", "path": "main/src/cgeo/geocaching/utils/LogWriter.java", "diffHunk": "@@ -0,0 +1,71 @@\n+package cgeo.geocaching.utils;\n+\n+import java.io.File;\n+import java.io.FileNotFoundException;\n+import java.io.PrintWriter;\n+\n+public class LogWriter {\n+    private PrintWriter logWriter = null;\n+    private String prefix;\n+\n+    public LogWriter(final String prefix) {\n+        this.prefix = prefix;\n+        checkLogfile();\n+    }\n+\n+    public void log(final String info) {\n+        checkLogfile();\n+        if (null != logWriter) {\n+            logWriter.println(\"--------------------------------------------------------------------\");\n+            logWriter.println(CalendarUtils.formatDateTime(\"yyyy-MM-dd HH:mm:ss.SSS\"));\n+            logWriter.println(info);\n+        }\n+    }\n+\n+    public void d(final String info) {\n+        Log.d(info);\n+        log(info);\n+    }\n+\n+    public void e(final String info) {\n+        Log.e(info);\n+        log(info);\n+    }\n+\n+    public void i(final String info) {\n+        Log.i(info);\n+        log(info);\n+    }\n+\n+    public void v(final String info) {\n+        Log.v(info);\n+        log(info);\n+    }\n+\n+    public void w(final String info) {\n+        Log.w(info);\n+        log(info);\n+    }\n+\n+    public void close() {\n+        if (null != logWriter) {\n+            log(\"end of logging\");\n+            logWriter.println(\"--------------------------------------------------------------------\");\n+            logWriter.close();\n+            logWriter = null;\n+        }\n+    }\n+\n+    private void checkLogfile() {\n+        if (null == logWriter && Log.isDebug()) {", "originalCommit": "de411d76b72d05c11ebb9806e0de38bbd7a84eb7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ1MDUwOQ==", "url": "https://github.com/cgeo/cgeo/pull/9005#discussion_r487450509", "bodyText": "Doing the repeated call to 'checkLogfile()' is to catch if a user has switched on debug mode throughout the operation. I agree that this may be a rare case, as you can activate debug mode only using settings, which are reachable only if you close any other activity within c:geo, so this extra check can probably left out.", "author": "moving-bits", "createdAt": "2020-09-12T21:28:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ0OTIyNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ4Njc0NQ==", "url": "https://github.com/cgeo/cgeo/pull/9005#discussion_r487486745", "bodyText": "Ok understood", "author": "eddiemuc", "createdAt": "2020-09-13T06:06:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ0OTIyNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ0OTM3Nw==", "url": "https://github.com/cgeo/cgeo/pull/9005#discussion_r487449377", "bodyText": "My understand is that LogWriter is for logs too long to be handled by logcat? In this case, why log the info additionally to logcat (it won't be able to handle it anyway). Instead, maybe a link to the LogWriter file should be logged.", "author": "eddiemuc", "createdAt": "2020-09-12T21:13:19Z", "path": "main/src/cgeo/geocaching/utils/LogWriter.java", "diffHunk": "@@ -0,0 +1,71 @@\n+package cgeo.geocaching.utils;\n+\n+import java.io.File;\n+import java.io.FileNotFoundException;\n+import java.io.PrintWriter;\n+\n+public class LogWriter {\n+    private PrintWriter logWriter = null;\n+    private String prefix;\n+\n+    public LogWriter(final String prefix) {\n+        this.prefix = prefix;\n+        checkLogfile();\n+    }\n+\n+    public void log(final String info) {\n+        checkLogfile();\n+        if (null != logWriter) {\n+            logWriter.println(\"--------------------------------------------------------------------\");\n+            logWriter.println(CalendarUtils.formatDateTime(\"yyyy-MM-dd HH:mm:ss.SSS\"));\n+            logWriter.println(info);\n+        }\n+    }\n+\n+    public void d(final String info) {\n+        Log.d(info);", "originalCommit": "de411d76b72d05c11ebb9806e0de38bbd7a84eb7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ1MDczNw==", "url": "https://github.com/cgeo/cgeo/pull/9005#discussion_r487450737", "bodyText": "Strings which may be too long for logcat should probably use logWriter.log() instead of the .i etc. variants. But even if not, the full string would be logged to the individual log file, whereas the string in logcat would be truncated.\nOnly those strings logged using one of the logWriter.i(), logWriter.e() etc. variants also log to the regular logcat. This is to have logcat unchanged compared to not using logWriter, and you can additionally turn on the separate logfile, if needed.", "author": "moving-bits", "createdAt": "2020-09-12T21:31:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ0OTM3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ4NjgxMQ==", "url": "https://github.com/cgeo/cgeo/pull/9005#discussion_r487486811", "bodyText": "Ok understood", "author": "eddiemuc", "createdAt": "2020-09-13T06:07:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ0OTM3Nw=="}], "type": "inlineReview"}, {"oid": "8665bb04a33f9fdbd887df3fcc8f0b96b48cdc70", "url": "https://github.com/cgeo/cgeo/commit/8665bb04a33f9fdbd887df3fcc8f0b96b48cdc70", "message": "add logwriter utility class", "committedDate": "2020-09-19T10:40:47Z", "type": "forcePushed"}, {"oid": "8659cf45d5ec349b6fe1dcce3d4b991b2aa4d516", "url": "https://github.com/cgeo/cgeo/commit/8659cf45d5ec349b6fe1dcce3d4b991b2aa4d516", "message": "add LogWriter utility class", "committedDate": "2020-09-19T10:57:25Z", "type": "commit"}, {"oid": "8659cf45d5ec349b6fe1dcce3d4b991b2aa4d516", "url": "https://github.com/cgeo/cgeo/commit/8659cf45d5ec349b6fe1dcce3d4b991b2aa4d516", "message": "add LogWriter utility class", "committedDate": "2020-09-19T10:57:25Z", "type": "forcePushed"}]}