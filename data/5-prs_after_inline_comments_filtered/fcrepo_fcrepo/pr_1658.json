{"pr_number": 1658, "pr_title": "FCREPO-3264 - Start and commit transactions", "pr_createdAt": "2020-04-08T12:49:19Z", "pr_url": "https://github.com/fcrepo/fcrepo/pull/1658", "timeline": [{"oid": "6def76540156b5310c06809a6b6785d5a9f27564", "url": "https://github.com/fcrepo/fcrepo/commit/6def76540156b5310c06809a6b6785d5a9f27564", "message": "Move injection of transaction up to ContentExposingResource so that it does not automatically happen in Transactions controller. Moved methods which depend on transaction with it.", "committedDate": "2020-04-07T21:05:59Z", "type": "commit"}, {"oid": "416cbc03565ca8f0f005ba70918808c09678bbd6", "url": "https://github.com/fcrepo/fcrepo/commit/416cbc03565ca8f0f005ba70918808c09678bbd6", "message": "Adjustments to persistent session rollback locking code to not fail if rolling back a transaction with no changes", "committedDate": "2020-04-07T21:05:59Z", "type": "commit"}, {"oid": "e955647cd6e0ce3ec8cdc46ef29b9eb20248454c", "url": "https://github.com/fcrepo/fcrepo/commit/e955647cd6e0ce3ec8cdc46ef29b9eb20248454c", "message": "Implement multi-request transaction creation, refreshing, status, and committing.\n\nTransaction provided will attempt to retrieve transaction id from request URI if header is not present\n\nTransactionImpl uses system property for session timeout if present.\n\nConsolidate transaction constants and add more detail to exceptions.", "committedDate": "2020-04-07T21:05:59Z", "type": "commit"}, {"oid": "697b29c59828e3f936b0ad2058490d942aa4e8bd", "url": "https://github.com/fcrepo/fcrepo/commit/697b29c59828e3f936b0ad2058490d942aa4e8bd", "message": "Split up refresh and status methods for transactions so that they can respond to errors differently. Added unit tests for creation, refresh and status. Changed refresh to return 400 status if tx not found, to be consistent with the other modification operations", "committedDate": "2020-04-08T16:14:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTY0NjI0Ng==", "url": "https://github.com/fcrepo/fcrepo/pull/1658#discussion_r405646246", "bodyText": "Do we want to return  a text message as well such as \"Transaction does not exist: {txId}\"", "author": "dbernstein", "createdAt": "2020-04-08T16:15:51Z", "path": "fcrepo-http-api/src/main/java/org/fcrepo/http/api/Transactions.java", "diffHunk": "@@ -84,19 +151,20 @@ public Response createTransaction() throws URISyntaxException {\n      * @return 204\n      */\n     @PUT\n-    @Path(\"/fcr:tx/{transactionId}/commit\")\n+    @Path(\"{transactionId}/commit\")\n     public Response commit(@PathParam(\"transactionId\") final String txId) {\n         try {\n             final Transaction transaction = txManager.get(txId);\n-            LOGGER.info(\"Commit transaction '{}'\", transaction.getId());\n+            LOGGER.info(\"Committing transaction '{}'\", transaction.getId());\n             transaction.commit();\n             return noContent().build();\n-        } catch(Exception e) {\n-            if (e.getMessage().matches(\"No Transaction found with transactionId\")) {\n-                return status(BAD_REQUEST).entity(e.getMessage()).type(TEXT_PLAIN_WITH_CHARSET).build();\n-            } else {\n-                throw new RuntimeException(e);\n-            }\n+        } catch (final TransactionNotFoundException e) {\n+            return Response.status(Status.BAD_REQUEST).build();", "originalCommit": "e955647cd6e0ce3ec8cdc46ef29b9eb20248454c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTY0NjYyOA==", "url": "https://github.com/fcrepo/fcrepo/pull/1658#discussion_r405646628", "bodyText": "Or at least pass e.getMessage()", "author": "dbernstein", "createdAt": "2020-04-08T16:16:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTY0NjI0Ng=="}], "type": "inlineReview"}, {"oid": "fb18e088bbd60c258eb4e6ce15a4fc52e535e6e6", "url": "https://github.com/fcrepo/fcrepo/commit/fb18e088bbd60c258eb4e6ce15a4fc52e535e6e6", "message": "Fix line length", "committedDate": "2020-04-08T16:39:54Z", "type": "commit"}, {"oid": "08b440cb81e55adecaaf2231bd8c8cdd6beb7fc6", "url": "https://github.com/fcrepo/fcrepo/commit/08b440cb81e55adecaaf2231bd8c8cdd6beb7fc6", "message": "Handle transaction exceptions thrown when retrieving transactions during normal api calls. TransactionProvider no longer injecting transactions via binding.\n\nUpdate response statuses for transaction operations.", "committedDate": "2020-04-08T23:13:53Z", "type": "commit"}, {"oid": "69a59e130ab3f7fd29f598b4ba19527b70a546dc", "url": "https://github.com/fcrepo/fcrepo/commit/69a59e130ab3f7fd29f598b4ba19527b70a546dc", "message": "Merge branch 'master' into fcrepo-3264-create-commit-tx", "committedDate": "2020-04-08T23:53:42Z", "type": "commit"}]}