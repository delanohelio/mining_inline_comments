{"pr_number": 1730, "pr_title": "Refactor to more broadly use FedoraId instead of a string", "pr_createdAt": "2020-07-23T13:20:05Z", "pr_url": "https://github.com/fcrepo/fcrepo/pull/1730", "timeline": [{"oid": "54781db6aafda27d128f518396676ea536de9f94", "url": "https://github.com/fcrepo/fcrepo/commit/54781db6aafda27d128f518396676ea536de9f94", "message": "refactor operations to use FedoraId", "committedDate": "2020-07-23T13:12:23Z", "type": "commit"}, {"oid": "cd1dd2b4a521a2c6ba1dd7d5e435e65ab6ef01d4", "url": "https://github.com/fcrepo/fcrepo/commit/cd1dd2b4a521a2c6ba1dd7d5e435e65ab6ef01d4", "message": "refactor ResourceHeaders to use FedoraId", "committedDate": "2020-07-23T13:12:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTYyODI5Nw==", "url": "https://github.com/fcrepo/fcrepo/pull/1730#discussion_r459628297", "bodyText": "Could this instead be: fedoraId.asBaseId()?", "author": "awoods", "createdAt": "2020-07-23T17:56:49Z", "path": "fcrepo-kernel-impl/src/main/java/org/fcrepo/kernel/impl/services/WebacAclServiceImpl.java", "diffHunk": "@@ -76,8 +76,8 @@ public void create(final Transaction transaction, final FedoraId fedoraId, final\n         final RdfStream stream = fromModel(model.getResource(fedoraId.getFullId()).asNode(), model);\n \n         final RdfSourceOperation createOp = rdfSourceOperationFactory\n-                .createBuilder(fedoraId.getResourceId(), FEDORA_WEBAC_ACL_URI)\n-                .parentId(fedoraId.getBaseId())\n+                .createBuilder(fedoraId, FEDORA_WEBAC_ACL_URI)\n+                .parentId(FedoraId.create(fedoraId.getBaseId()))", "originalCommit": "cd1dd2b4a521a2c6ba1dd7d5e435e65ab6ef01d4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTY0NDM5OA==", "url": "https://github.com/fcrepo/fcrepo/pull/1730#discussion_r459644398", "bodyText": "Yes, I added the asBaseId method towards the end of the refactor and missed some of earlier changes. Will fix.", "author": "pwinckles", "createdAt": "2020-07-23T18:25:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTYyODI5Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTYzMzYzNA==", "url": "https://github.com/fcrepo/fcrepo/pull/1730#discussion_r459633634", "bodyText": "asBaseId()?", "author": "awoods", "createdAt": "2020-07-23T18:06:23Z", "path": "fcrepo-persistence-ocfl/src/main/java/org/fcrepo/persistence/ocfl/impl/OcflPersistentStorageUtils.java", "diffHunk": "@@ -180,9 +181,9 @@ public static String resolveExtensions(final String subPath, final boolean isRdf\n      * @param fedoraIdentifier The fedora identifier\n      * @return The resolved topic\n      */\n-    public static  String resolveTopic(final String fedoraIdentifier) {\n-        if (fedoraIdentifier.endsWith(FEDORA_METADATA_SUFFIX)) {\n-            return fedoraIdentifier.substring(0, fedoraIdentifier.indexOf(FEDORA_METADATA_SUFFIX));\n+    public static FedoraId resolveTopic(final FedoraId fedoraIdentifier) {\n+        if (fedoraIdentifier.isDescription()) {\n+            return FedoraId.create(fedoraIdentifier.getBaseId());", "originalCommit": "cd1dd2b4a521a2c6ba1dd7d5e435e65ab6ef01d4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTY1NTU1OA==", "url": "https://github.com/fcrepo/fcrepo/pull/1730#discussion_r459655558", "bodyText": "I left this one because I actually fixed it in my next PR. Let me know if you want it fixed in this PR, and I'll do some git gymnastics to get it fixed here. Otherwise, the next PR will take care of it.", "author": "pwinckles", "createdAt": "2020-07-23T18:45:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTYzMzYzNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTYzNzc4NQ==", "url": "https://github.com/fcrepo/fcrepo/pull/1730#discussion_r459637785", "bodyText": "It would seem that this method (which can be private) could be replaced by FedoraId.asBaseId()?", "author": "awoods", "createdAt": "2020-07-23T18:13:39Z", "path": "fcrepo-persistence-ocfl/src/main/java/org/fcrepo/persistence/ocfl/impl/OcflPersistentStorageUtils.java", "diffHunk": "@@ -180,9 +181,9 @@ public static String resolveExtensions(final String subPath, final boolean isRdf\n      * @param fedoraIdentifier The fedora identifier\n      * @return The resolved topic\n      */\n-    public static  String resolveTopic(final String fedoraIdentifier) {\n-        if (fedoraIdentifier.endsWith(FEDORA_METADATA_SUFFIX)) {\n-            return fedoraIdentifier.substring(0, fedoraIdentifier.indexOf(FEDORA_METADATA_SUFFIX));\n+    public static FedoraId resolveTopic(final FedoraId fedoraIdentifier) {", "originalCommit": "cd1dd2b4a521a2c6ba1dd7d5e435e65ab6ef01d4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTY0OTc2Mw==", "url": "https://github.com/fcrepo/fcrepo/pull/1730#discussion_r459649763", "bodyText": "Looks good. Some minor comments.\nAs a note, it is becoming slightly confusing when to use which method of FedoraId. Can we work towards removing some of the \"getters\" that return Strings?\n\nI don't disagree! Because the id is used differently in different contexts it is confusing to know which method you want or even what the current \"state\" of the id is. I attempted to increase the clarity in this recent PR: #1719, but it's still not perfect.", "author": "pwinckles", "createdAt": "2020-07-23T18:35:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTYzNzc4NQ=="}], "type": "inlineReview"}, {"oid": "46577da59dca2b9da7a04d9890a264afe16a0975", "url": "https://github.com/fcrepo/fcrepo/commit/46577da59dca2b9da7a04d9890a264afe16a0975", "message": "pr fixes", "committedDate": "2020-07-23T18:42:11Z", "type": "commit"}]}