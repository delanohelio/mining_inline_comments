{"pr_number": 1667, "pr_title": "Ensures that containment index persists between reboots.", "pr_createdAt": "2020-04-24T17:03:48Z", "pr_url": "https://github.com/fcrepo/fcrepo/pull/1667", "timeline": [{"oid": "e74fe4a54c0c862d21cf5a9e21e1cf4210dfd7cb", "url": "https://github.com/fcrepo/fcrepo/commit/e74fe4a54c0c862d21cf5a9e21e1cf4210dfd7cb", "message": "Ensures that containment index persists between reboots.\n\nResolves: https://jira.lyrasis.org/browse/FCREPO-3283", "committedDate": "2020-04-24T16:40:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTcwNTM2Nw==", "url": "https://github.com/fcrepo/fcrepo/pull/1667#discussion_r419705367", "bodyText": "How do we configure Fedora to use MySQL, for example?", "author": "awoods", "createdAt": "2020-05-04T20:24:02Z", "path": "fcrepo-persistence-ocfl/src/main/java/org/fcrepo/persistence/ocfl/impl/OCFLPersistenceConfig.java", "diffHunk": "@@ -42,4 +48,25 @@ public MutableOcflRepository repository() {\n         final OCFLConstants constants = new OCFLConstants();\n         return createRepository(constants.getStorageRootDir(), constants.getWorkDir());\n     }\n+\n+    @Bean\n+    public OCFLConstants ocflConstants(){\n+        return new OCFLConstants();\n+    }\n+\n+    @Bean\n+    public DataSource dataSource(final OCFLConstants ocflConstants) {\n+        final var dataSource = new DriverManagerDataSource();\n+        final var workDir = ocflConstants.getWorkDir().getAbsolutePath();\n+        dataSource.setUrl(\"jdbc:h2:\" + workDir + File.separator + \"containment.idx;FILE_LOCK=SOCKET\");", "originalCommit": "e74fe4a54c0c862d21cf5a9e21e1cf4210dfd7cb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTcxNjE5Mw==", "url": "https://github.com/fcrepo/fcrepo/pull/1667#discussion_r419716193", "bodyText": "The H2 in memory index was meant to exist to run tests and so you could run a Fedora with a very low bar. This is elevating it and I'm not sure we want to do that.", "author": "whikloj", "createdAt": "2020-05-04T20:43:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTcwNTM2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjI4NTU0Ng==", "url": "https://github.com/fcrepo/fcrepo/pull/1667#discussion_r422285546", "bodyText": "The primary purpose of this PR is to solve the immediate problem not being able to restart fedora without having to blow away the work directory. The secondary purposes is to consolidate the references to the database configuration into one location.\nI think there are two other tasks which should be addressed separately (which I will create jiras for):\n\nmove the FedoraToOCFLIndex state into the database (currently map is written to disk)\nmake the datasource configurable (add mysql, postgresql, etc)", "author": "dbernstein", "createdAt": "2020-05-08T17:58:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTcwNTM2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjMwMjc5MQ==", "url": "https://github.com/fcrepo/fcrepo/pull/1667#discussion_r422302791", "bodyText": "https://jira.lyrasis.org/browse/FCREPO-3308\nhttps://jira.lyrasis.org/browse/FCREPO-3309", "author": "dbernstein", "createdAt": "2020-05-08T18:32:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTcwNTM2Nw=="}], "type": "inlineReview"}]}