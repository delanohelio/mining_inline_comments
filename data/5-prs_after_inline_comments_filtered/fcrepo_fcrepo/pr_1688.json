{"pr_number": 1688, "pr_title": "FCREPO-3200 - Default Digests", "pr_createdAt": "2020-06-03T18:33:58Z", "pr_url": "https://github.com/fcrepo/fcrepo/pull/1688", "timeline": [{"oid": "5c6e9db5e7b6a661c82431abdf3911b951b0d4ac", "url": "https://github.com/fcrepo/fcrepo/commit/5c6e9db5e7b6a661c82431abdf3911b951b0d4ac", "message": "Added getDigests method to MultiDigestInputStreamWrapper, constructor can now take a list of digests to calculate in addition to the current list of digests to verify. checkFixity and getDigests will both now consume the inputstream if it has not already been read", "committedDate": "2020-06-02T21:10:29Z", "type": "commit"}, {"oid": "427dc26a8c1d2a0f21714646decd87be9fde7ace", "url": "https://github.com/fcrepo/fcrepo/commit/427dc26a8c1d2a0f21714646decd87be9fde7ace", "message": "Internal binaries always have a digest of the default algorithm generated and stored to their header file\nOCFLObjectSessions now have a helper method for getting the digest algorithm used by an ocfl object\nAdded a constant for getting the default digest algorithm used by fedora and OCFL (only SHA512 and SHA256 are supported)\nAdds integration tests for persistence of binaries", "committedDate": "2020-06-03T17:55:53Z", "type": "commit"}, {"oid": "ead477d2c42738b6a87a62d89cd877c3350dbe69", "url": "https://github.com/fcrepo/fcrepo/commit/ead477d2c42738b6a87a62d89cd877c3350dbe69", "message": "Persist digests from operation for external binaries", "committedDate": "2020-06-03T19:01:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDgyMDc0OA==", "url": "https://github.com/fcrepo/fcrepo/pull/1688#discussion_r434820748", "bodyText": "Comments seems incorrect. We are defaulting to SHA512, no?", "author": "awoods", "createdAt": "2020-06-03T20:01:13Z", "path": "fcrepo-kernel-api/src/main/java/org/fcrepo/kernel/api/utils/ContentDigest.java", "diffHunk": "@@ -38,20 +41,39 @@\n \n     private static final Logger LOGGER = getLogger(ContentDigest.class);\n \n+    private final static String DEFAULT_DIGEST_ALGORITHM_PROPERTY = \"fcrepo.persistence.defaultDigestAlgorithm\";\n+    public final static DIGEST_ALGORITHM DEFAULT_DIGEST_ALGORITHM;\n+\n+    static {\n+        // Establish the default digest algorithm for fedora, defaulting to SHA1", "originalCommit": "ead477d2c42738b6a87a62d89cd877c3350dbe69", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDkxMTkxMg==", "url": "https://github.com/fcrepo/fcrepo/pull/1688#discussion_r434911912", "bodyText": "Thoughts on refactoring: \"fedoraconfig:defaultDigestAlgorithm\"?\nhttps://github.com/fcrepo4/fcrepo4/blob/master/fcrepo-kernel-api/src/main/java/org/fcrepo/kernel/api/FedoraTypes.java#L90\nOr... is there any reason to change the existing property, and the associated documentation?\nhttps://wiki.lyrasis.org/display/FEDORA4x/RESTful+HTTP+API+-+Fixity#RESTfulHTTPAPIFixity-DefaultFixityAlgorithm", "author": "awoods", "createdAt": "2020-06-03T23:30:17Z", "path": "fcrepo-kernel-api/src/main/java/org/fcrepo/kernel/api/utils/ContentDigest.java", "diffHunk": "@@ -38,20 +41,39 @@\n \n     private static final Logger LOGGER = getLogger(ContentDigest.class);\n \n+    private final static String DEFAULT_DIGEST_ALGORITHM_PROPERTY = \"fcrepo.persistence.defaultDigestAlgorithm\";", "originalCommit": "ead477d2c42738b6a87a62d89cd877c3350dbe69", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTIyMDMxOA==", "url": "https://github.com/fcrepo/fcrepo/pull/1688#discussion_r435220318", "bodyText": "Based on your slack response from the other day, I was thinking we would end up pulling the fedoraconfig:defaultDigestAlgorithm since it seems unnecessary with the removal of fcr:fixity and emphasis on the Want-Digest header. I can do so now, and update the documentation if you'd like.\nOn the other hand, it might make sense to reimagine it as a way for clients to tell fedora what digest algorithm to use for content addressing in a particular ocfl object, allowing them to override the system wide DEFAULT_DIGEST_ALGORITHM. But that likely doesn't fit into this PR, since it would probably come with some twists in terms of allowing clients to change existing objects. From what peter was saying I had the impression that was an allowed ocfl operation, but I would expect it would require significant changes to the object.", "author": "bbpennel", "createdAt": "2020-06-04T12:38:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDkxMTkxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTI5Mjg2Mg==", "url": "https://github.com/fcrepo/fcrepo/pull/1688#discussion_r435292862", "bodyText": "Thanks. Let's take a wait-and-see on fedoraconfig:defaultDigestAlgorithm.", "author": "awoods", "createdAt": "2020-06-04T14:16:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDkxMTkxMg=="}], "type": "inlineReview"}, {"oid": "bf9c13baf87ee2708b5fba117a24916776d5c003", "url": "https://github.com/fcrepo/fcrepo/commit/bf9c13baf87ee2708b5fba117a24916776d5c003", "message": "Improve error message when invalid digest algorithms provided", "committedDate": "2020-06-04T12:49:19Z", "type": "commit"}]}