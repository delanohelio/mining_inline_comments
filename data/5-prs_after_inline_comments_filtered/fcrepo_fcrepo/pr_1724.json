{"pr_number": 1724, "pr_title": "Remove ocfl id mappings on purge", "pr_createdAt": "2020-07-16T14:27:51Z", "pr_url": "https://github.com/fcrepo/fcrepo/pull/1724", "timeline": [{"oid": "3fdfb7cfed96290198a6d90e12b0b74ae1b9b962", "url": "https://github.com/fcrepo/fcrepo/commit/3fdfb7cfed96290198a6d90e12b0b74ae1b9b962", "message": "Remove fedoraToOcflMapping on purge and use a new transaction table to avoid dangling identifier mappings.", "committedDate": "2020-07-16T12:48:04Z", "type": "commit"}, {"oid": "08a06a4b13508fc0ab52454add43b159ba717b19", "url": "https://github.com/fcrepo/fcrepo/commit/08a06a4b13508fc0ab52454add43b159ba717b19", "message": "Fix some containment and change fedoraToOcflMap to use upsert queries", "committedDate": "2020-07-16T12:48:19Z", "type": "commit"}, {"oid": "12895962dfaae0353f8488bfca416441ad633be9", "url": "https://github.com/fcrepo/fcrepo/commit/12895962dfaae0353f8488bfca416441ad633be9", "message": "MySQL DDL file", "committedDate": "2020-07-16T12:48:19Z", "type": "commit"}, {"oid": "c8117d5d13ea565d9c33c946f6e15d720b253a0e", "url": "https://github.com/fcrepo/fcrepo/commit/c8117d5d13ea565d9c33c946f6e15d720b253a0e", "message": "Final clean up", "committedDate": "2020-07-16T12:48:19Z", "type": "commit"}, {"oid": "93d5f804b630a3d872eb1260fea9b9b9e57daf4d", "url": "https://github.com/fcrepo/fcrepo/commit/93d5f804b630a3d872eb1260fea9b9b9e57daf4d", "message": "SQL tweaks", "committedDate": "2020-07-16T12:48:20Z", "type": "commit"}, {"oid": "31588b13738c2e9a5da5ccf885c17ea897d6cf04", "url": "https://github.com/fcrepo/fcrepo/commit/31588b13738c2e9a5da5ccf885c17ea897d6cf04", "message": "Rebase changes", "committedDate": "2020-07-16T12:49:05Z", "type": "commit"}, {"oid": "00c356daf8588afebb2978fc023e408690c79d28", "url": "https://github.com/fcrepo/fcrepo/commit/00c356daf8588afebb2978fc023e408690c79d28", "message": "move nonRdfSourceDescription delete to persister and other code review", "committedDate": "2020-07-16T12:49:08Z", "type": "commit"}, {"oid": "5a6eb6675d2b1ad705ea04ffbce288d07e010cf9", "url": "https://github.com/fcrepo/fcrepo/commit/5a6eb6675d2b1ad705ea04ffbce288d07e010cf9", "message": "Changing back again again", "committedDate": "2020-07-16T12:51:53Z", "type": "commit"}, {"oid": "533fbbb203622c4c74febe56b6558139f3bd85f4", "url": "https://github.com/fcrepo/fcrepo/commit/533fbbb203622c4c74febe56b6558139f3bd85f4", "message": "refactor db platfrom code", "committedDate": "2020-07-16T12:51:56Z", "type": "commit"}, {"oid": "720df3d7fde485e9f88742881d420b236390e216", "url": "https://github.com/fcrepo/fcrepo/commit/720df3d7fde485e9f88742881d420b236390e216", "message": "fixed bug in recursive purge", "committedDate": "2020-07-16T14:14:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTAxMjc2NQ==", "url": "https://github.com/fcrepo/fcrepo/pull/1724#discussion_r459012765", "bodyText": "For consistency, maybe we should name this parameter: transactionId.\n...or in some other way provide consistency. We seem to switch between sessionIds and transactionIds.", "author": "awoods", "createdAt": "2020-07-22T18:54:27Z", "path": "fcrepo-persistence-ocfl/src/main/java/org/fcrepo/persistence/ocfl/api/FedoraToOcflObjectIndex.java", "diffHunk": "@@ -36,34 +38,52 @@\n      * Contrast this  with an Archival Group example:  if you pass in \"my/archival-group/binary/fcr:metadata\" the\n      * resource returned in the mapping would be \"my/archival-group\".\n      *\n+     * @param sessionId id of the current session, or null for read-only.\n      * @param fedoraResourceIdentifier the fedora resource identifier\n      * @return the mapping\n      * @throws FedoraOCFLMappingNotFoundException when no mapping exists for the specified identifier.\n      */\n-    FedoraOCFLMapping getMapping(final String fedoraResourceIdentifier) throws FedoraOCFLMappingNotFoundException;\n+    FedoraOCFLMapping getMapping(final String sessionId, final String fedoraResourceIdentifier) throws", "originalCommit": "720df3d7fde485e9f88742881d420b236390e216", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTAzMzYzNg==", "url": "https://github.com/fcrepo/fcrepo/pull/1724#discussion_r459033636", "bodyText": "While I don't disagree, the persistence codebase consistent refers to it as a \"session\". Perhaps we should have a follow up jira to unify the language?", "author": "pwinckles", "createdAt": "2020-07-22T19:32:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTAxMjc2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTA0MjAzMA==", "url": "https://github.com/fcrepo/fcrepo/pull/1724#discussion_r459042030", "bodyText": "I am fine with a follow-up JIRA for name unification. Currently, it seems like we are open to potentially challenging to track-down bugs since we inter-mix sessions IDs and transaction IDs... is there a difference?", "author": "awoods", "createdAt": "2020-07-22T19:48:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTAxMjc2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTA0MzUzMw==", "url": "https://github.com/fcrepo/fcrepo/pull/1724#discussion_r459043533", "bodyText": "No, there is no difference", "author": "pwinckles", "createdAt": "2020-07-22T19:50:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTAxMjc2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTA0OTM5Nw==", "url": "https://github.com/fcrepo/fcrepo/pull/1724#discussion_r459049397", "bodyText": "https://jira.lyrasis.org/browse/FCREPO-3388", "author": "pwinckles", "createdAt": "2020-07-22T20:01:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTAxMjc2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTAyMjEwNQ==", "url": "https://github.com/fcrepo/fcrepo/pull/1724#discussion_r459022105", "bodyText": "It would appear that the use of Silent is not recommended. Do we have a good reason here?\n     * Engineers should care for removing unused stubbings because they are dead code,\n     * they add unnecessary details, potentially making the test code harder to comprehend.\n     * If you have good reasons to use the silent runner, let us know at the mailing list\n     * or raise an issue in our issue tracker.\n     * The purpose of silent implementation is to satisfy edge/unanticipated use cases,\n     * and to offer users an opt-out.\n     * Mockito framework is opinionated to drive clean tests but it is not dogmatic.", "author": "awoods", "createdAt": "2020-07-22T19:10:49Z", "path": "fcrepo-persistence-ocfl/src/test/java/org/fcrepo/persistence/ocfl/impl/OCFLPersistentStorageSessionTest.java", "diffHunk": "@@ -88,7 +88,7 @@\n  *\n  * @author dbernstein\n  */\n-@RunWith(MockitoJUnitRunner.class)\n+@RunWith(MockitoJUnitRunner.Silent.class)", "originalCommit": "720df3d7fde485e9f88742881d420b236390e216", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTAzNDA5NA==", "url": "https://github.com/fcrepo/fcrepo/pull/1724#discussion_r459034094", "bodyText": "I'm not sure why that was done. I can try running the tests without it and see what happens.", "author": "pwinckles", "createdAt": "2020-07-22T19:33:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTAyMjEwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTA1Mzk1Ng==", "url": "https://github.com/fcrepo/fcrepo/pull/1724#discussion_r459053956", "bodyText": "Didn't seem to be doing anything -- removed.", "author": "pwinckles", "createdAt": "2020-07-22T20:10:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTAyMjEwNQ=="}], "type": "inlineReview"}, {"oid": "adda7805a6efc30917f23200b3365d744dcb9630", "url": "https://github.com/fcrepo/fcrepo/commit/adda7805a6efc30917f23200b3365d744dcb9630", "message": "pr fixes", "committedDate": "2020-07-22T20:09:18Z", "type": "commit"}]}