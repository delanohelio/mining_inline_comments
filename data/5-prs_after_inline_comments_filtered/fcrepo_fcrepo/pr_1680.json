{"pr_number": 1680, "pr_title": "Adds search endpoint with a minimal integration test.", "pr_createdAt": "2020-05-08T20:53:35Z", "pr_url": "https://github.com/fcrepo/fcrepo/pull/1680", "timeline": [{"oid": "407b021978a2ef071d1a3aeca7ecd5974d63bc22", "url": "https://github.com/fcrepo/fcrepo/commit/407b021978a2ef071d1a3aeca7ecd5974d63bc22", "message": "Adds search endpoint with a minimal integration test.\n\nResolves: https://jira.lyrasis.org/browse/FCREPO-3282", "committedDate": "2020-05-08T20:42:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTQ2ODg0Mw==", "url": "https://github.com/fcrepo/fcrepo/pull/1680#discussion_r425468843", "bodyText": "I believe the recommendation is to use the constant: StandardCharsets.UTF_8.", "author": "awoods", "createdAt": "2020-05-14T22:36:48Z", "path": "fcrepo-http-api/src/test/java/org/fcrepo/integration/http/api/FedoraSearchIT.java", "diffHunk": "@@ -0,0 +1,61 @@\n+/*\n+ * Licensed to DuraSpace under one or more contributor license agreements.\n+ * See the NOTICE file distributed with this work for additional information\n+ * regarding copyright ownership.\n+ *\n+ * DuraSpace licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except in\n+ * compliance with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.fcrepo.integration.http.api;\n+\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import org.apache.http.client.methods.CloseableHttpResponse;\n+import org.apache.http.client.methods.HttpGet;\n+import org.fcrepo.search.api.SearchResult;\n+import org.junit.Test;\n+\n+import java.net.URLEncoder;\n+\n+import static javax.ws.rs.core.Response.Status.OK;\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNotNull;\n+\n+/**\n+ * @author dbernstein\n+ * @since 05/06/20\n+ */\n+public class FedoraSearchIT extends AbstractResourceIT {\n+\n+\n+    @Test\n+    public void testSearchAllResources() throws Exception {\n+\n+        final var condition = \"fedoraId=*\";\n+        final String searchUrl = serverAddress + \"fcr:search\" + \"?query=\" + doubleEncode(condition);\n+        try (final CloseableHttpResponse response = execute(new HttpGet(searchUrl))) {\n+            assertEquals(OK.getStatusCode(), getStatus(response));\n+            final ObjectMapper objectMapper = new ObjectMapper();\n+            final SearchResult result = objectMapper.readValue(response.getEntity().getContent(), SearchResult.class);\n+            assertNotNull(result);\n+            assertNotNull(result.getPagination());\n+            assertEquals(0, result.getResults().size());\n+        }\n+    }\n+\n+    private String encode(final String value) throws Exception {\n+        return URLEncoder.encode(value, \"UTF-8\");", "originalCommit": "407b021978a2ef071d1a3aeca7ecd5974d63bc22", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTQ2OTY4OQ==", "url": "https://github.com/fcrepo/fcrepo/pull/1680#discussion_r425469689", "bodyText": "I am surprised that the build did not fail, given the lack of JavaDoc on these public methods... something must have regressed in our checkstyle configuration.", "author": "awoods", "createdAt": "2020-05-14T22:39:11Z", "path": "fcrepo-search-api/src/main/java/org/fcrepo/search/api/SearchResult.java", "diffHunk": "@@ -0,0 +1,46 @@\n+/*\n+ * Licensed to DuraSpace under one or more contributor license agreements.\n+ * See the NOTICE file distributed with this work for additional information\n+ * regarding copyright ownership.\n+ *\n+ * DuraSpace licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except in\n+ * compliance with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.fcrepo.search.api;\n+\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+\n+/**\n+ * @author dbernstein\n+ */\n+public class SearchResult {\n+    @JsonProperty\n+    private PaginationInfo pagination = new PaginationInfo();\n+    @JsonProperty\n+    private List<Map<String, Object>> results = new ArrayList();\n+\n+    public SearchResult() {\n+\n+    }\n+\n+    public PaginationInfo getPagination() {", "originalCommit": "407b021978a2ef071d1a3aeca7ecd5974d63bc22", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTk4NzY3NQ==", "url": "https://github.com/fcrepo/fcrepo/pull/1680#discussion_r425987675", "bodyText": "Me too.  I'm not sure what would have caused the change.", "author": "dbernstein", "createdAt": "2020-05-15T18:51:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTQ2OTY4OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTQ3MDMwOQ==", "url": "https://github.com/fcrepo/fcrepo/pull/1680#discussion_r425470309", "bodyText": "JavaDocs explaining something about the nature of the expected query parameter will be helpful for whoever comes along to implement this.", "author": "awoods", "createdAt": "2020-05-14T22:41:00Z", "path": "fcrepo-search-api/src/main/java/org/fcrepo/search/api/SearchParameters.java", "diffHunk": "@@ -0,0 +1,26 @@\n+/*\n+ * Licensed to DuraSpace under one or more contributor license agreements.\n+ * See the NOTICE file distributed with this work for additional information\n+ * regarding copyright ownership.\n+ *\n+ * DuraSpace licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except in\n+ * compliance with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.fcrepo.search.api;\n+\n+/**\n+ * A pojo encapsulating the parameters of a search\n+ */\n+public class SearchParameters {\n+    public SearchParameters(final String query) {", "originalCommit": "407b021978a2ef071d1a3aeca7ecd5974d63bc22", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1bcae043c4985e61a0f6b88f34cb6e5d9a39ee65", "url": "https://github.com/fcrepo/fcrepo/commit/1bcae043c4985e61a0f6b88f34cb6e5d9a39ee65", "message": "Addresses PR feedback:\nAdds javadocs.\nAdds Query class to encapulate the Query datastructure and string parsing.", "committedDate": "2020-05-15T19:01:39Z", "type": "commit"}, {"oid": "8067dcb2237c5746d914f601999b13ec51496040", "url": "https://github.com/fcrepo/fcrepo/commit/8067dcb2237c5746d914f601999b13ec51496040", "message": "Moves spring context dependency out of test gear section.", "committedDate": "2020-05-21T04:05:24Z", "type": "commit"}]}