{"pr_number": 4229, "pr_title": "NIFI-7379: Support multiple instances of Prometheus registries/metrics", "pr_createdAt": "2020-04-23T19:19:08Z", "pr_url": "https://github.com/apache/nifi/pull/4229", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjIxODQ1MA==", "url": "https://github.com/apache/nifi/pull/4229#discussion_r416218450", "bodyText": "Can these and other holder classes be referred as MetricsRegistry (e.g. BulletinMetricsRegistry)?  It seems like that is the real underlying function it's managing.  Also would recommend these classes extend from a common abstract class which sets up what's needed for the CollectorRegistry.", "author": "YolandaMDavis", "createdAt": "2020-04-27T23:29:45Z", "path": "nifi-nar-bundles/nifi-extension-utils/nifi-prometheus-utils/src/main/java/org/apache/nifi/prometheus/util/BulletinMetricsHolder.java", "diffHunk": "@@ -0,0 +1,44 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.nifi.prometheus.util;\n+\n+import io.prometheus.client.CollectorRegistry;\n+import io.prometheus.client.Gauge;\n+\n+public class BulletinMetricsHolder {", "originalCommit": "4f3c016e3bf16868d48a92c0fd7e1f5186b66843", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjIyMDU2OA==", "url": "https://github.com/apache/nifi/pull/4229#discussion_r416220568", "bodyText": "Would also recommend instead of accessing gauges or counters directly that callers use methods which then can set labels and inc/dec/set values as needed.  This may also allow for isolated testing of the holder/registry.", "author": "YolandaMDavis", "createdAt": "2020-04-27T23:34:54Z", "path": "nifi-nar-bundles/nifi-extension-utils/nifi-prometheus-utils/src/main/java/org/apache/nifi/prometheus/util/BulletinMetricsHolder.java", "diffHunk": "@@ -0,0 +1,44 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.nifi.prometheus.util;\n+\n+import io.prometheus.client.CollectorRegistry;\n+import io.prometheus.client.Gauge;\n+\n+public class BulletinMetricsHolder {\n+\n+    private CollectorRegistry registry = new CollectorRegistry();\n+\n+    public BulletinMetricsHolder() {\n+    }\n+\n+    public BulletinMetricsHolder(final CollectorRegistry registry) {\n+        this();\n+        this.registry = registry;\n+    }\n+\n+    public CollectorRegistry getRegistry() {\n+        return registry;\n+    }\n+\n+    public final Gauge BULLETIN = Gauge.build()", "originalCommit": "4f3c016e3bf16868d48a92c0fd7e1f5186b66843", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjIyMDc2MA==", "url": "https://github.com/apache/nifi/pull/4229#discussion_r416220760", "bodyText": "Same as above", "author": "YolandaMDavis", "createdAt": "2020-04-27T23:35:28Z", "path": "nifi-nar-bundles/nifi-extension-utils/nifi-prometheus-utils/src/main/java/org/apache/nifi/prometheus/util/JvmMetricsHolder.java", "diffHunk": "@@ -0,0 +1,95 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.nifi.prometheus.util;\n+\n+import io.prometheus.client.CollectorRegistry;\n+import io.prometheus.client.Gauge;\n+\n+public class JvmMetricsHolder {", "originalCommit": "4f3c016e3bf16868d48a92c0fd7e1f5186b66843", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjIyMDgzMg==", "url": "https://github.com/apache/nifi/pull/4229#discussion_r416220832", "bodyText": "Same as above", "author": "YolandaMDavis", "createdAt": "2020-04-27T23:35:37Z", "path": "nifi-nar-bundles/nifi-extension-utils/nifi-prometheus-utils/src/main/java/org/apache/nifi/prometheus/util/NiFiMetricsHolder.java", "diffHunk": "@@ -0,0 +1,215 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.nifi.prometheus.util;\n+\n+import io.prometheus.client.CollectorRegistry;\n+import io.prometheus.client.Counter;\n+import io.prometheus.client.Gauge;\n+\n+public class NiFiMetricsHolder {", "originalCommit": "4f3c016e3bf16868d48a92c0fd7e1f5186b66843", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjIyMDk3NA==", "url": "https://github.com/apache/nifi/pull/4229#discussion_r416220974", "bodyText": "Same as above", "author": "YolandaMDavis", "createdAt": "2020-04-27T23:35:59Z", "path": "nifi-nar-bundles/nifi-extension-utils/nifi-prometheus-utils/src/main/java/org/apache/nifi/prometheus/util/ConnectionAnalyticsMetricsHolder.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.nifi.prometheus.util;\n+\n+import io.prometheus.client.CollectorRegistry;\n+import io.prometheus.client.Gauge;\n+\n+public class ConnectionAnalyticsMetricsHolder {", "originalCommit": "4f3c016e3bf16868d48a92c0fd7e1f5186b66843", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "d6e5e9e51653f1f3b56ddb9c08d19c384f776bbe", "url": "https://github.com/apache/nifi/commit/d6e5e9e51653f1f3b56ddb9c08d19c384f776bbe", "message": "NIFI-7379: Support multiple instances of Prometheus registries/metrics", "committedDate": "2020-04-28T12:14:23Z", "type": "commit"}, {"oid": "8847caa24ddc971b2f8007ea708c3ebd5497bac5", "url": "https://github.com/apache/nifi/commit/8847caa24ddc971b2f8007ea708c3ebd5497bac5", "message": "NIFI-7379: Refactored Prometheus objects to support multiple instances", "committedDate": "2020-04-28T15:06:41Z", "type": "commit"}, {"oid": "8847caa24ddc971b2f8007ea708c3ebd5497bac5", "url": "https://github.com/apache/nifi/commit/8847caa24ddc971b2f8007ea708c3ebd5497bac5", "message": "NIFI-7379: Refactored Prometheus objects to support multiple instances", "committedDate": "2020-04-28T15:06:41Z", "type": "forcePushed"}]}