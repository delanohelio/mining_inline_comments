{"pr_number": 5144, "pr_title": "Refactor value based segment pruner to work on DataSource instead of ColumnMetadata", "pr_createdAt": "2020-03-12T02:08:08Z", "pr_url": "https://github.com/apache/pinot/pull/5144", "timeline": [{"oid": "9162a4847c62b9cf7e2c7917019f1b952fb9ef46", "url": "https://github.com/apache/pinot/commit/9162a4847c62b9cf7e2c7917019f1b952fb9ef46", "message": "Refactor value based segment pruner to work on DataSource instead of ColumnMetadata\n\nMotivation:\nColumnMetadata is avaliable to immutable segments only. This change will make segment pruner work on mutable segments.\n\nChanges:\n1. Merge PartitionSegmentPruner into ColumnValueSegmentPruner to reduce the overhead of segment pruning\n2. Re-order segment pruners (ValidSegment -> DataSchema -> ColumnValue)", "committedDate": "2020-03-14T08:15:57Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE4NzUzNw==", "url": "https://github.com/apache/pinot/pull/5144#discussion_r393187537", "bodyText": "It would be nice if this javadoc can be enhanced to highlight what all pruning is done. Something like..\n(1) use equality filter value for partition pruning (if table is partitioned)\n(2) use equality filter for bloom filter based pruning\n(2) min-max value based pruner for RANGE", "author": "siddharthteotia", "createdAt": "2020-03-16T17:18:21Z", "path": "pinot-core/src/main/java/org/apache/pinot/core/query/pruner/ColumnValueSegmentPruner.java", "diffHunk": "@@ -19,184 +19,224 @@\n package org.apache.pinot.core.query.pruner;\n \n import java.util.HashMap;\n-import java.util.List;\n import java.util.Map;\n-import javax.annotation.Nonnull;\n+import java.util.Set;\n import org.apache.commons.configuration.Configuration;\n-import org.apache.pinot.spi.data.FieldSpec;\n-import org.apache.pinot.common.request.FilterOperator;\n+import org.apache.pinot.common.request.transform.TransformExpressionTree;\n import org.apache.pinot.common.utils.request.FilterQueryTree;\n+import org.apache.pinot.core.common.DataSource;\n+import org.apache.pinot.core.common.DataSourceMetadata;\n import org.apache.pinot.core.common.predicate.RangePredicate;\n+import org.apache.pinot.core.data.partition.PartitionFunction;\n import org.apache.pinot.core.indexsegment.IndexSegment;\n+import org.apache.pinot.core.query.exception.BadQueryRequestException;\n import org.apache.pinot.core.query.request.ServerQueryRequest;\n-import org.apache.pinot.core.segment.index.ColumnMetadata;\n-import org.apache.pinot.core.segment.index.SegmentMetadataImpl;\n import org.apache.pinot.core.segment.index.readers.BloomFilterReader;\n+import org.apache.pinot.spi.data.FieldSpec.DataType;\n+import org.apache.pinot.spi.utils.BytesUtils;\n \n \n /**\n- * An implementation of SegmentPruner.\n- * <p>Pruner will prune segment based on the column value inside the filter.\n+ * The {@code ColumnValueSegmentPruner} is the segment pruner that prunes segments based on the value inside the filter.", "originalCommit": "9162a4847c62b9cf7e2c7917019f1b952fb9ef46", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzI1OTE3OA==", "url": "https://github.com/apache/pinot/pull/5144#discussion_r393259178", "bodyText": "Updated the doc", "author": "Jackie-Jiang", "createdAt": "2020-03-16T19:20:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE4NzUzNw=="}], "type": "inlineReview"}, {"oid": "b987f153ed7346b8aa244cf04b252d6e9310c419", "url": "https://github.com/apache/pinot/commit/b987f153ed7346b8aa244cf04b252d6e9310c419", "message": "Refactor value based segment pruner to work on DataSource instead of ColumnMetadata\n\nMotivation:\nColumnMetadata is avaliable to immutable segments only. This change will make segment pruner work on mutable segments.\n\nChanges:\n1. Merge PartitionSegmentPruner into ColumnValueSegmentPruner to reduce the overhead of segment pruning\n2. Re-order segment pruners (ValidSegment -> DataSchema -> ColumnValue)", "committedDate": "2020-03-16T19:20:40Z", "type": "commit"}, {"oid": "b987f153ed7346b8aa244cf04b252d6e9310c419", "url": "https://github.com/apache/pinot/commit/b987f153ed7346b8aa244cf04b252d6e9310c419", "message": "Refactor value based segment pruner to work on DataSource instead of ColumnMetadata\n\nMotivation:\nColumnMetadata is avaliable to immutable segments only. This change will make segment pruner work on mutable segments.\n\nChanges:\n1. Merge PartitionSegmentPruner into ColumnValueSegmentPruner to reduce the overhead of segment pruning\n2. Re-order segment pruners (ValidSegment -> DataSchema -> ColumnValue)", "committedDate": "2020-03-16T19:20:40Z", "type": "forcePushed"}]}