{"pr_number": 5114, "pr_title": "Bugfixing the issue for ThreadLocal DocIdSet in ExpressionFilterOperator", "pr_createdAt": "2020-03-05T00:52:06Z", "pr_url": "https://github.com/apache/pinot/pull/5114", "timeline": [{"oid": "82833f21a0c7b88c0083df1d5f90683e430cc47b", "url": "https://github.com/apache/pinot/commit/82833f21a0c7b88c0083df1d5f90683e430cc47b", "message": "Bugfixing the issue for ThreadLocal DocIdSet in ExpressionFilterOperator", "committedDate": "2020-03-05T00:43:08Z", "type": "commit"}, {"oid": "7ca6f5eaf250a89ff07792a97ff7aeebae4e1da4", "url": "https://github.com/apache/pinot/commit/7ca6f5eaf250a89ff07792a97ff7aeebae4e1da4", "message": "Update bitmap range start/end id", "committedDate": "2020-03-05T02:39:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODA1ODM4Ng==", "url": "https://github.com/apache/pinot/pull/5114#discussion_r388058386", "bodyText": "I would recommend making both endDocId and this exclusive. Currently the numDocsScanned value is incorrect.", "author": "Jackie-Jiang", "createdAt": "2020-03-05T03:17:06Z", "path": "pinot-core/src/main/java/org/apache/pinot/core/operator/filter/ExpressionFilterOperator.java", "diffHunk": "@@ -196,7 +196,7 @@ public BlockDocIdIterator iterator() {\n       int _endDocId;\n       //used only in next() and advance methods\n       int _currentBlockStartDocId = -1;\n-      int _currentBlockEndDocId = 0;\n+      int _currentBlockEndDocId = -1;", "originalCommit": "7ca6f5eaf250a89ff07792a97ff7aeebae4e1da4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODA1ODYxOQ==", "url": "https://github.com/apache/pinot/pull/5114#discussion_r388058619", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                int[] docIds = _threadLocal? THREAD_LOCAL_DOC_IDS.get(): new int[DocIdSetPlanNode.MAX_DOC_PER_CALL];\n          \n          \n            \n                int[] docIds = _threadLocal? THREAD_LOCAL_DOC_IDS.get(): new int[_maxSizeOfDocIdSet];", "author": "Jackie-Jiang", "createdAt": "2020-03-05T03:18:09Z", "path": "pinot-core/src/main/java/org/apache/pinot/core/operator/DocIdSetOperator.java", "diffHunk": "@@ -69,7 +75,7 @@ protected DocIdSetBlock getNextBlock() {\n     }\n \n     int pos = 0;\n-    int[] docIds = THREAD_LOCAL_DOC_IDS.get();\n+    int[] docIds = _threadLocal? THREAD_LOCAL_DOC_IDS.get(): new int[DocIdSetPlanNode.MAX_DOC_PER_CALL];", "originalCommit": "7ca6f5eaf250a89ff07792a97ff7aeebae4e1da4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "682b8c24e20cf69daab53f5e2fd14b5f96da3c5e", "url": "https://github.com/apache/pinot/commit/682b8c24e20cf69daab53f5e2fd14b5f96da3c5e", "message": "Address comments", "committedDate": "2020-03-05T06:43:32Z", "type": "commit"}]}