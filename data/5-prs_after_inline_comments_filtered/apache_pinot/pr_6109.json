{"pr_number": 6109, "pr_title": "Enhance star-tree to skip matching-all predicate on non-star-tree dimension", "pr_createdAt": "2020-10-06T02:03:51Z", "pr_url": "https://github.com/apache/pinot/pull/6109", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTI2OTI2OA==", "url": "https://github.com/apache/pinot/pull/6109#discussion_r501269268", "bodyText": "do we need to make a copy of groupByColumns?", "author": "xiangfu0", "createdAt": "2020-10-07T19:50:01Z", "path": "pinot-core/src/main/java/org/apache/pinot/core/startree/operator/StarTreeFilterOperator.java", "diffHunk": "@@ -121,81 +117,23 @@\n \n   // Star-tree\n   private final StarTreeV2 _starTreeV2;\n-  // Set of group-by columns\n-  private final Set<String> _groupByColumns;\n   // Map from column to predicate evaluators\n   private final Map<String, List<PredicateEvaluator>> _predicateEvaluatorsMap;\n-  // Map from column to matching dictionary ids\n-  private final Map<String, IntSet> _matchingDictIdsMap;\n+  // Set of group-by columns\n+  private final Set<String> _groupByColumns;\n \n   private final Map<String, String> _debugOptions;\n   boolean _resultEmpty = false;\n \n-  public StarTreeFilterOperator(StarTreeV2 starTreeV2, @Nullable FilterContext filter,\n-      @Nullable Set<String> groupByColumns, @Nullable Map<String, String> debugOptions) {\n+  public StarTreeFilterOperator(StarTreeV2 starTreeV2, Map<String, List<PredicateEvaluator>> predicateEvaluatorsMap,\n+      Set<String> groupByColumns, @Nullable Map<String, String> debugOptions) {\n     _starTreeV2 = starTreeV2;\n-    _groupByColumns = groupByColumns != null ? new HashSet<>(groupByColumns) : Collections.emptySet();\n+    _predicateEvaluatorsMap = predicateEvaluatorsMap;\n+    _groupByColumns = groupByColumns;", "originalCommit": "6519f22df04d8174715530f16c101ae86841024b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTQxMDkzOA==", "url": "https://github.com/apache/pinot/pull/6109#discussion_r501410938", "bodyText": "We don't because it is not used by the caller. Added some comments on the caller side", "author": "Jackie-Jiang", "createdAt": "2020-10-08T02:21:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTI2OTI2OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTQxMTYyMA==", "url": "https://github.com/apache/pinot/pull/6109#discussion_r501411620", "bodyText": "After consideration, decide to make a copy in case the caller needs to use it in the future", "author": "Jackie-Jiang", "createdAt": "2020-10-08T02:24:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTI2OTI2OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTI2OTc5Mw==", "url": "https://github.com/apache/pinot/pull/6109#discussion_r501269793", "bodyText": "while (searchEntry = queue.poll() != null) {", "author": "xiangfu0", "createdAt": "2020-10-07T19:51:00Z", "path": "pinot-core/src/main/java/org/apache/pinot/core/startree/operator/StarTreeFilterOperator.java", "diffHunk": "@@ -267,19 +206,19 @@ private StarTreeResult traverseStarTree() {\n     // Use BFS to traverse the star tree\n     Queue<SearchEntry> queue = new LinkedList<>();\n     queue.add(new SearchEntry(starTreeRootNode, _predicateEvaluatorsMap.keySet(), _groupByColumns));\n-    while (!queue.isEmpty()) {\n-      SearchEntry searchEntry = queue.remove();\n+    SearchEntry searchEntry;\n+    while ((searchEntry = queue.poll()) != null) {", "originalCommit": "6519f22df04d8174715530f16c101ae86841024b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTQxMDU5MA==", "url": "https://github.com/apache/pinot/pull/6109#discussion_r501410590", "bodyText": "The parentheses can not be removed, or it will try to assign the boolean value to searchEntry", "author": "Jackie-Jiang", "createdAt": "2020-10-08T02:19:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTI2OTc5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTQyNjE2NA==", "url": "https://github.com/apache/pinot/pull/6109#discussion_r501426164", "bodyText": "got it", "author": "xiangfu0", "createdAt": "2020-10-08T03:23:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTI2OTc5Mw=="}], "type": "inlineReview"}, {"oid": "6f07d407b63ee827facefaf27f444cee79644bd6", "url": "https://github.com/apache/pinot/commit/6f07d407b63ee827facefaf27f444cee79644bd6", "message": "Enhance star-tree to skip matching-all predicate on non-star-tree dimension", "committedDate": "2020-10-08T02:31:07Z", "type": "commit"}, {"oid": "6f07d407b63ee827facefaf27f444cee79644bd6", "url": "https://github.com/apache/pinot/commit/6f07d407b63ee827facefaf27f444cee79644bd6", "message": "Enhance star-tree to skip matching-all predicate on non-star-tree dimension", "committedDate": "2020-10-08T02:31:07Z", "type": "forcePushed"}]}