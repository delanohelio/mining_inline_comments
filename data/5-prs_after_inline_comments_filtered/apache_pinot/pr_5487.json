{"pr_number": 5487, "pr_title": "Add multi-value support to SegmentDumpTool", "pr_createdAt": "2020-06-03T02:34:29Z", "pr_url": "https://github.com/apache/pinot/pull/5487", "timeline": [{"oid": "ae91c7b04cd61bbd2a6241251c8ef9dfd2320128", "url": "https://github.com/apache/pinot/commit/ae91c7b04cd61bbd2a6241251c8ef9dfd2320128", "message": "Add multi-value support to SegmentDumpTool\n\nAlso, add segment dump tool as part of the pinot-tool.sh script", "committedDate": "2020-06-02T17:04:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDI4ODgxNg==", "url": "https://github.com/apache/pinot/pull/5487#discussion_r434288816", "bodyText": "add a System.out.print(\"\\t\");?", "author": "xiangfu0", "createdAt": "2020-06-03T03:33:03Z", "path": "pinot-tools/src/main/java/org/apache/pinot/tools/SegmentDumpTool.java", "diffHunk": "@@ -91,11 +102,27 @@ public void doMain(String[] args)\n       System.out.print(i);\n       System.out.print(\"\\t\");\n       for (String columnName : columnNames) {\n-        BlockSingleValIterator itr = iterators.get(columnName);\n-        int encodedValue = itr.nextIntVal();\n-        Object value = dictionaries.get(columnName).get(encodedValue);\n-        System.out.print(value);\n-        System.out.print(\"\\t\");\n+        BlockValIterator itr = iterators.get(columnName);\n+        if (itr instanceof BlockSingleValIterator) {\n+          int encodedValue = ((BlockSingleValIterator) itr).nextIntVal();\n+          Object value = dictionaries.get(columnName).get(encodedValue);\n+          System.out.print(value);\n+          System.out.print(\"\\t\");\n+        } else {\n+          BlockMultiValIterator mItr = (BlockMultiValIterator) itr;\n+          int maxNumValuesPerMVEntry =\n+              indexSegment.getDataSource(columnName).getDataSourceMetadata().getMaxNumValuesPerMVEntry();\n+          int[] intArray = new int[maxNumValuesPerMVEntry];\n+          int length = mItr.nextIntVal(intArray);\n+          System.out.print(\"[\");\n+          for (int j = 0; j < length; j++) {\n+            System.out.print(dictionaries.get(columnName).get(intArray[j]));\n+            if (j != length - 1) {\n+              System.out.print(\",\");\n+            }\n+          }\n+          System.out.print(\"]\");", "originalCommit": "ae91c7b04cd61bbd2a6241251c8ef9dfd2320128", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDMxMDcwMQ==", "url": "https://github.com/apache/pinot/pull/5487#discussion_r434310701", "bodyText": "good catch", "author": "yupeng9", "createdAt": "2020-06-03T05:09:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDI4ODgxNg=="}], "type": "inlineReview"}, {"oid": "b20fc5e979c7248c3626a9bcf24bbbe46020ea42", "url": "https://github.com/apache/pinot/commit/b20fc5e979c7248c3626a9bcf24bbbe46020ea42", "message": "comments", "committedDate": "2020-06-03T04:56:59Z", "type": "commit"}]}