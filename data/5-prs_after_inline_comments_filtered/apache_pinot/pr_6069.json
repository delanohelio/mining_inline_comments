{"pr_number": 6069, "pr_title": "[Issue 6068] Fixing the calls to Helix to throw exception if zk conne\u2026", "pr_createdAt": "2020-09-29T00:00:39Z", "pr_url": "https://github.com/apache/pinot/pull/6069", "timeline": [{"oid": "9ccc1cd350e757bb4b648e58c318aa7214412c52", "url": "https://github.com/apache/pinot/commit/9ccc1cd350e757bb4b648e58c318aa7214412c52", "message": "[Issue 6068] Fixing the calls to Helix to throw exception if zk connection is broken\n\nSee Issue #6068", "committedDate": "2020-09-28T23:58:20Z", "type": "commit"}, {"oid": "a94f969a488f444c2614b39c0f36f493a27da66d", "url": "https://github.com/apache/pinot/commit/a94f969a488f444c2614b39c0f36f493a27da66d", "message": "Update zk metadata APIs to use timeout zk timeout\n\nThese APIs will ensure that if there is a zk disconnect\nwe will get an exception after a minimal number of retries.\nWe can change this to retry once and implement a backoff retry\nif needed later on.\n\nNote that the underlying helix library ends up calling the previous\nAPI (as yet), but we will upgrade to a helix version soon that actually\nimplements these", "committedDate": "2020-10-04T18:31:01Z", "type": "commit"}, {"oid": "7323688bd837f4c03e9a70ebfa6c1c4738ef0ea4", "url": "https://github.com/apache/pinot/commit/7323688bd837f4c03e9a70ebfa6c1c4738ef0ea4", "message": "Fixing a unit test mock call", "committedDate": "2020-10-05T18:27:42Z", "type": "commit"}, {"oid": "59d331600cf47ae3ded2a262b7c4abda0b890088", "url": "https://github.com/apache/pinot/commit/59d331600cf47ae3ded2a262b7c4abda0b890088", "message": "Updating more calls to getChildren", "committedDate": "2020-10-05T18:39:43Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTgwOTcwNQ==", "url": "https://github.com/apache/pinot/pull/6069#discussion_r499809705", "bodyText": "This won't take effect... Here is the Helix code for it (I would count it as a bug):\n  @Override\n  public List<T> getChildren(String parentPath, List<Stat> stats, int options, int retryCount,\n      int retryInterval) throws HelixException {\n    return getChildren(parentPath, stats, options);\n  }\n\nI don't see an easy way to throw exception for this API unless we create the children paths manually.", "author": "Jackie-Jiang", "createdAt": "2020-10-05T19:03:53Z", "path": "pinot-common/src/main/java/org/apache/pinot/common/metadata/ZKMetadataProvider.java", "diffHunk": "@@ -305,7 +308,7 @@ public static Schema getTableSchema(@Nonnull ZkHelixPropertyStore<ZNRecord> prop\n       ZkHelixPropertyStore<ZNRecord> propertyStore, String tableName) {\n     String offlineTableName = TableNameBuilder.OFFLINE.tableNameWithType(tableName);\n     String parentPath = constructPropertyStorePathForResource(offlineTableName);\n-    List<ZNRecord> znRecords = propertyStore.getChildren(parentPath, null, AccessOption.PERSISTENT);\n+    List<ZNRecord> znRecords = propertyStore.getChildren(parentPath, null, AccessOption.PERSISTENT, ZK_OP_RETRY_COUNT, ZK_OP_RETRY_INTERVAL_MS);", "originalCommit": "7323688bd837f4c03e9a70ebfa6c1c4738ef0ea4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTkwMDQ4Mg==", "url": "https://github.com/apache/pinot/pull/6069#discussion_r499900482", "bodyText": "We are working with the helix team to give us a new version with the API implemented. Since I took the trouble to trace all the APIs, I took the liberty to modify them so that when we upgrade to newer helix version, we have the right calls", "author": "mcvsubbu", "createdAt": "2020-10-05T22:11:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTgwOTcwNQ=="}], "type": "inlineReview"}]}