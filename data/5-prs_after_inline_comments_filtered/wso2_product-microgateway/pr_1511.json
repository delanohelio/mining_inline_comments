{"pr_number": 1511, "pr_title": "[Envoy-Mgw] Add Integration tests", "pr_createdAt": "2020-12-01T21:48:49Z", "pr_url": "https://github.com/wso2/product-microgateway/pull/1511", "timeline": [{"oid": "79776d4dec171f22442b735bc9e8dda4c905d525", "url": "https://github.com/wso2/product-microgateway/commit/79776d4dec171f22442b735bc9e8dda4c905d525", "message": "add basic intergation setup", "committedDate": "2020-12-01T21:22:38Z", "type": "commit"}, {"oid": "31160e52c63cda746ff93aade3e78d8bf2edf94f", "url": "https://github.com/wso2/product-microgateway/commit/31160e52c63cda746ff93aade3e78d8bf2edf94f", "message": "remove unwanted plugins and format", "committedDate": "2020-12-01T21:22:38Z", "type": "commit"}, {"oid": "013233f80ef59c735d6a211f55bc6c81e1797154", "url": "https://github.com/wso2/product-microgateway/commit/013233f80ef59c735d6a211f55bc6c81e1797154", "message": "setup testcontainers", "committedDate": "2020-12-01T21:22:38Z", "type": "commit"}, {"oid": "8ca729c26d942d079a4788bb88409f06d113a707", "url": "https://github.com/wso2/product-microgateway/commit/8ca729c26d942d079a4788bb88409f06d113a707", "message": "add api applications subsription DTOs", "committedDate": "2020-12-01T21:22:38Z", "type": "commit"}, {"oid": "cdf665803d4e09307971534fc1056ea1865f9778", "url": "https://github.com/wso2/product-microgateway/commit/cdf665803d4e09307971534fc1056ea1865f9778", "message": "add licence header to  DTOs", "committedDate": "2020-12-01T21:22:38Z", "type": "commit"}, {"oid": "e807da0baf8674bc6e8e7c29a9c97f3b12a83f1d", "url": "https://github.com/wso2/product-microgateway/commit/e807da0baf8674bc6e8e7c29a9c97f3b12a83f1d", "message": "implement mock backend", "committedDate": "2020-12-01T21:22:38Z", "type": "commit"}, {"oid": "e10b10131e5531ce98bb4a1cac22435be44c3650", "url": "https://github.com/wso2/product-microgateway/commit/e10b10131e5531ce98bb4a1cac22435be44c3650", "message": "add util funtions for https and https and token generation", "committedDate": "2020-12-01T21:22:38Z", "type": "commit"}, {"oid": "1c16a68ed7f7f588ed8e5706d6ffa6b7d0a6f437", "url": "https://github.com/wso2/product-microgateway/commit/1c16a68ed7f7f588ed8e5706d6ffa6b7d0a6f437", "message": "implement mgw server initialisation", "committedDate": "2020-12-01T21:22:38Z", "type": "commit"}, {"oid": "9b8ab4bb2a777afab0b5ddbbd763151c779c0255", "url": "https://github.com/wso2/product-microgateway/commit/9b8ab4bb2a777afab0b5ddbbd763151c779c0255", "message": "implement jwt test cases", "committedDate": "2020-12-01T21:22:38Z", "type": "commit"}, {"oid": "59d224e7e83e96e51ecce0595dafd842ffd6c0c0", "url": "https://github.com/wso2/product-microgateway/commit/59d224e7e83e96e51ecce0595dafd842ffd6c0c0", "message": "add resources and structured pom", "committedDate": "2020-12-01T21:22:38Z", "type": "commit"}, {"oid": "716c9abb23f586db81f6c7f1c233073ac432660c", "url": "https://github.com/wso2/product-microgateway/commit/716c9abb23f586db81f6c7f1c233073ac432660c", "message": "change test cases to testng", "committedDate": "2020-12-01T21:22:38Z", "type": "commit"}, {"oid": "b3d04bf4ee6bbb11a3f37dd24fa0a88e295ed36a", "url": "https://github.com/wso2/product-microgateway/commit/b3d04bf4ee6bbb11a3f37dd24fa0a88e295ed36a", "message": "create mock backend as docker image", "committedDate": "2020-12-01T21:22:38Z", "type": "commit"}, {"oid": "4f6b407c11b28a8975535c4f93cabd935aeb4556", "url": "https://github.com/wso2/product-microgateway/commit/4f6b407c11b28a8975535c4f93cabd935aeb4556", "message": "add intialissation setup with seperate configs", "committedDate": "2020-12-01T21:22:38Z", "type": "commit"}, {"oid": "f714231f112a3ec28d96f89cf02275768e26f763", "url": "https://github.com/wso2/product-microgateway/commit/f714231f112a3ec28d96f89cf02275768e26f763", "message": "add apictlproject creation", "committedDate": "2020-12-01T21:22:38Z", "type": "commit"}, {"oid": "e518ea3abeb76c9575fd99b72ffbf411338c607e", "url": "https://github.com/wso2/product-microgateway/commit/e518ea3abeb76c9575fd99b72ffbf411338c607e", "message": "add backend service", "committedDate": "2020-12-01T21:22:38Z", "type": "commit"}, {"oid": "8d42eabfacc9866f27164f3988821610bb0442b0", "url": "https://github.com/wso2/product-microgateway/commit/8d42eabfacc9866f27164f3988821610bb0442b0", "message": "set apictlproject structure creation setup", "committedDate": "2020-12-01T21:22:38Z", "type": "commit"}, {"oid": "c9e4975d10084cca5456f90478e90d8106653240", "url": "https://github.com/wso2/product-microgateway/commit/c9e4975d10084cca5456f90478e90d8106653240", "message": "document the classes and funtions", "committedDate": "2020-12-02T14:04:31Z", "type": "commit"}, {"oid": "ddde43f9fa266a20c0502964aec058a79624278b", "url": "https://github.com/wso2/product-microgateway/commit/ddde43f9fa266a20c0502964aec058a79624278b", "message": "optimize the mockbackend docker image build and runtime", "committedDate": "2020-12-03T06:57:17Z", "type": "commit"}, {"oid": "ddde43f9fa266a20c0502964aec058a79624278b", "url": "https://github.com/wso2/product-microgateway/commit/ddde43f9fa266a20c0502964aec058a79624278b", "message": "optimize the mockbackend docker image build and runtime", "committedDate": "2020-12-03T06:57:17Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTg2Njc2NQ==", "url": "https://github.com/wso2/product-microgateway/pull/1511#discussion_r535866765", "bodyText": "Lets remove the static imports", "author": "Rajith90", "createdAt": "2020-12-04T06:29:42Z", "path": "test-integration/mock-backend-server/src/main/java/org.wso2am.micro.gw.mockbackend/MockBackEndServer.java", "diffHunk": "@@ -0,0 +1,451 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2am.micro.gw.mockbackend;\n+\n+\n+import com.sun.net.httpserver.HttpServer;\n+import io.netty.handler.codec.http.HttpHeaderNames;\n+import org.apache.commons.io.IOUtils;\n+import org.apache.commons.io.output.ByteArrayOutputStream;\n+import org.json.JSONObject;\n+\n+import java.io.InputStream;\n+import java.net.HttpURLConnection;\n+import java.net.InetSocketAddress;\n+\n+import static org.wso2am.micro.gw.mockbackend.Constants.CONTENT_TYPE;\n+import static org.wso2am.micro.gw.mockbackend.Constants.CONTENT_TYPE_APPLICATION_JSON;\n+import static org.wso2am.micro.gw.mockbackend.Constants.MOCK_BACKEND_SERVER_PORT;", "originalCommit": "ddde43f9fa266a20c0502964aec058a79624278b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM2MzQxMA==", "url": "https://github.com/wso2/product-microgateway/pull/1511#discussion_r536363410", "bodyText": "Fixed in ee03466", "author": "chashikajw", "createdAt": "2020-12-04T20:32:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTg2Njc2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTg2NzE5MA==", "url": "https://github.com/wso2/product-microgateway/pull/1511#discussion_r535867190", "bodyText": "package name convention seems different", "author": "Rajith90", "createdAt": "2020-12-04T06:30:56Z", "path": "test-integration/mock-backend-server/src/main/java/org.wso2am.micro.gw.mockbackend/MockBackEndServer.java", "diffHunk": "@@ -0,0 +1,451 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2am.micro.gw.mockbackend;", "originalCommit": "ddde43f9fa266a20c0502964aec058a79624278b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM2Mzc0Mw==", "url": "https://github.com/wso2/product-microgateway/pull/1511#discussion_r536363743", "bodyText": "Didn't change yet. what is the name we should put?", "author": "chashikajw", "createdAt": "2020-12-04T20:33:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTg2NzE5MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTg2NzU3MA==", "url": "https://github.com/wso2/product-microgateway/pull/1511#discussion_r535867570", "bodyText": "Lets use the logger", "author": "Rajith90", "createdAt": "2020-12-04T06:31:56Z", "path": "test-integration/mock-backend-server/src/main/java/org.wso2am.micro.gw.mockbackend/MockBackEndServer.java", "diffHunk": "@@ -0,0 +1,451 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2am.micro.gw.mockbackend;\n+\n+\n+import com.sun.net.httpserver.HttpServer;\n+import io.netty.handler.codec.http.HttpHeaderNames;\n+import org.apache.commons.io.IOUtils;\n+import org.apache.commons.io.output.ByteArrayOutputStream;\n+import org.json.JSONObject;\n+\n+import java.io.InputStream;\n+import java.net.HttpURLConnection;\n+import java.net.InetSocketAddress;\n+\n+import static org.wso2am.micro.gw.mockbackend.Constants.CONTENT_TYPE;\n+import static org.wso2am.micro.gw.mockbackend.Constants.CONTENT_TYPE_APPLICATION_JSON;\n+import static org.wso2am.micro.gw.mockbackend.Constants.MOCK_BACKEND_SERVER_PORT;\n+\n+/**\n+ * Mock HTTP server for testing Open API tests.\n+ */\n+public class MockBackEndServer extends Thread {\n+\n+    //private static final Logger log = LoggerFactory.getLogger(MockBackEndServer.class);", "originalCommit": "ddde43f9fa266a20c0502964aec058a79624278b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM2MzgxMg==", "url": "https://github.com/wso2/product-microgateway/pull/1511#discussion_r536363812", "bodyText": "Fixed in ee03466", "author": "chashikajw", "createdAt": "2020-12-04T20:33:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTg2NzU3MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTg2NzgwMA==", "url": "https://github.com/wso2/product-microgateway/pull/1511#discussion_r535867800", "bodyText": "Formatting issues", "author": "Rajith90", "createdAt": "2020-12-04T06:32:34Z", "path": "test-integration/mock-backend-server/src/main/java/org.wso2am.micro.gw.mockbackend/MockBackEndServer.java", "diffHunk": "@@ -0,0 +1,451 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2am.micro.gw.mockbackend;\n+\n+\n+import com.sun.net.httpserver.HttpServer;\n+import io.netty.handler.codec.http.HttpHeaderNames;\n+import org.apache.commons.io.IOUtils;\n+import org.apache.commons.io.output.ByteArrayOutputStream;\n+import org.json.JSONObject;\n+\n+import java.io.InputStream;\n+import java.net.HttpURLConnection;\n+import java.net.InetSocketAddress;\n+\n+import static org.wso2am.micro.gw.mockbackend.Constants.CONTENT_TYPE;\n+import static org.wso2am.micro.gw.mockbackend.Constants.CONTENT_TYPE_APPLICATION_JSON;\n+import static org.wso2am.micro.gw.mockbackend.Constants.MOCK_BACKEND_SERVER_PORT;\n+\n+/**\n+ * Mock HTTP server for testing Open API tests.\n+ */\n+public class MockBackEndServer extends Thread {\n+\n+    //private static final Logger log = LoggerFactory.getLogger(MockBackEndServer.class);\n+    private HttpServer httpServer;\n+    private String backEndServerUrl;\n+    private static int backEndServerPort;\n+    private static boolean retryDone = false;\n+\n+\n+\n+    public static void main(String[] args) {\n+        //backend port\n+        backEndServerPort = MOCK_BACKEND_SERVER_PORT;\n+        MockBackEndServer mockBackEndServer = new MockBackEndServer(backEndServerPort);\n+        mockBackEndServer.start();\n+\n+    }\n+\n+    public MockBackEndServer(int port) {\n+\n+        backEndServerPort = port;\n+    }\n+\n+    public void run() {\n+\n+        if (backEndServerPort < 0) {\n+            throw new RuntimeException(\"Server port is not defined\");\n+        }\n+        try {\n+            httpServer = HttpServer.create(new InetSocketAddress(backEndServerPort), 0);\n+            String context = \"/v2\";\n+            httpServer.createContext(context + \"/pet/findByStatus\", exchange -> {\n+\n+                byte[] response = ResponseConstants.responseBody.getBytes();\n+                exchange.getResponseHeaders().set(CONTENT_TYPE,\n+                        CONTENT_TYPE_APPLICATION_JSON);\n+                exchange.sendResponseHeaders(HttpURLConnection.HTTP_OK, response.length);\n+                exchange.getResponseBody().write(response);\n+                exchange.close();\n+            });\n+            httpServer.createContext(context + \"/pet/\", exchange -> {\n+\n+                byte[] response = ResponseConstants.getPetResponse.getBytes();\n+                exchange.getResponseHeaders().set(CONTENT_TYPE,\n+                        CONTENT_TYPE_APPLICATION_JSON);\n+                exchange.sendResponseHeaders(HttpURLConnection.HTTP_OK, response.length);\n+                exchange.getResponseBody().write(response);\n+                exchange.close();\n+            });\n+            httpServer.createContext(context + \"/pet/findByTags\", exchange -> {\n+\n+                byte[] response = ResponseConstants.petByIdResponse.getBytes();\n+                exchange.getResponseHeaders().set(CONTENT_TYPE,\n+                        CONTENT_TYPE_APPLICATION_JSON);\n+                exchange.sendResponseHeaders(HttpURLConnection.HTTP_OK, response.length);\n+                exchange.getResponseBody().write(response);\n+                exchange.close();\n+            });\n+            httpServer.createContext(context + \"/store/inventory\", exchange -> {\n+\n+                byte[] response = ResponseConstants.storeInventoryResponse.getBytes();\n+                exchange.getResponseHeaders().set(CONTENT_TYPE,\n+                        CONTENT_TYPE_APPLICATION_JSON);\n+                exchange.sendResponseHeaders(HttpURLConnection.HTTP_OK, response.length);\n+                exchange.getResponseBody().write(response);\n+                exchange.close();\n+            });\n+            httpServer.createContext(context + \"/pet/3\", exchange -> {\n+\n+                byte[] response = ResponseConstants.RESPONSE_VALID_JWT_TRANSFORMER.getBytes();\n+                exchange.getResponseHeaders().set(CONTENT_TYPE,\n+                        CONTENT_TYPE_APPLICATION_JSON);\n+                exchange.sendResponseHeaders(HttpURLConnection.HTTP_OK, response.length);\n+                exchange.getResponseBody().write(response);\n+                exchange.close();\n+            });\n+            httpServer.createContext(context + \"/store/order/1\", exchange -> {\n+                byte[] response;\n+                if(exchange.getRequestHeaders().containsKey(\"Authorization\") &&\n+                        exchange.getRequestHeaders().get(\"Authorization\").toString().contains(\"Basic YWRtaW46aGVsbG8=\"))\n+                {\n+                    response = ResponseConstants.storeInventoryResponse.getBytes();\n+                    exchange.getResponseHeaders().set(CONTENT_TYPE,\n+                            CONTENT_TYPE_APPLICATION_JSON);\n+                    exchange.sendResponseHeaders(HttpURLConnection.HTTP_OK, response.length);\n+                } else {\n+                    response = ResponseConstants.AUTHENTICATION_FAILURE_RESPONSE.getBytes();\n+                    exchange.getResponseHeaders().set(CONTENT_TYPE,\n+                            CONTENT_TYPE_APPLICATION_JSON);\n+                    exchange.sendResponseHeaders(HttpURLConnection.HTTP_UNAUTHORIZED, response.length);\n+                }\n+                exchange.getResponseBody().write(response);\n+                exchange.close();\n+            });\n+            httpServer.createContext(context + \"/user/john\", exchange -> {\n+                byte[] response;\n+                if(exchange.getRequestHeaders().containsKey(\"Authorization\") &&\n+                        exchange.getRequestHeaders().get(\"Authorization\").toString().contains(\"Basic YWRtaW46aGVsbG8=\"))\n+                {\n+                    response = ResponseConstants.userResponse.getBytes();\n+                    exchange.getResponseHeaders().set(CONTENT_TYPE,\n+                            CONTENT_TYPE_APPLICATION_JSON);\n+                    exchange.sendResponseHeaders(HttpURLConnection.HTTP_OK, response.length);\n+                } else {\n+                    response = ResponseConstants.AUTHZ_FAILURE_RESPONSE.getBytes();\n+                    exchange.getResponseHeaders().set(CONTENT_TYPE,\n+                            CONTENT_TYPE_APPLICATION_JSON);\n+                    exchange.sendResponseHeaders(HttpURLConnection.HTTP_FORBIDDEN, response.length);\n+                }\n+                exchange.getResponseBody().write(response);\n+                exchange.close();\n+            });\n+            String base = \"/v1\";\n+            httpServer.createContext(base + \"/pet/findByStatus\", exchange -> {\n+\n+                byte[] response = ResponseConstants.responseBodyV1.getBytes();\n+                exchange.getResponseHeaders().set(CONTENT_TYPE,\n+                        CONTENT_TYPE_APPLICATION_JSON);\n+                exchange.sendResponseHeaders(HttpURLConnection.HTTP_OK, response.length);\n+                exchange.getResponseBody().write(response);\n+                exchange.close();\n+            });\n+            httpServer.createContext(base + \"/pet/findByStatusNew\", exchange -> {\n+                byte[] response = \"{\\\"error\\\":true}\".getBytes();\n+                if(exchange.getRequestURI().getQuery().contains(\"value1=foo&value2=bar\")) {\n+                    response = ResponseConstants.responseBodyV1.getBytes();\n+                }\n+                exchange.getResponseHeaders().set(CONTENT_TYPE,\n+                        CONTENT_TYPE_APPLICATION_JSON);\n+                exchange.sendResponseHeaders(HttpURLConnection.HTTP_OK, response.length);\n+                exchange.getResponseBody().write(response);\n+                exchange.close();\n+            });\n+            httpServer.createContext(base + \"/pet/findByTags\", exchange -> {\n+\n+                byte[] response = ResponseConstants.petByIdResponseV1.getBytes();\n+                exchange.getResponseHeaders().set(CONTENT_TYPE,\n+                        CONTENT_TYPE_APPLICATION_JSON);\n+                exchange.sendResponseHeaders(HttpURLConnection.HTTP_OK, response.length);\n+                exchange.getResponseBody().write(response);\n+                exchange.close();\n+            });\n+            httpServer.createContext(base + \"/pet/2\", exchange -> {\n+\n+                byte[] response = ResponseConstants.getPetResponse.getBytes();\n+                exchange.getResponseHeaders().set(CONTENT_TYPE,\n+                        CONTENT_TYPE_APPLICATION_JSON);\n+                exchange.sendResponseHeaders(HttpURLConnection.HTTP_OK, response.length);\n+                exchange.getResponseBody().write(response);\n+                exchange.close();\n+            });\n+            httpServer.createContext(base + \"/pet/\", exchange -> {\n+\n+                byte[] response = ResponseConstants.getPetResponse.getBytes();\n+                exchange.getResponseHeaders().set(CONTENT_TYPE,\n+                        CONTENT_TYPE_APPLICATION_JSON);\n+                exchange.sendResponseHeaders(HttpURLConnection.HTTP_OK, response.length);\n+                exchange.getResponseBody().write(response);\n+                exchange.close();\n+            });\n+            //to test endpoints with security\n+            String contextWithSecurity2 = \"/v2Basic\";\n+            httpServer.createContext(contextWithSecurity2 + \"/pet/findByStatus\", exchange -> {\n+                byte[] response;\n+                if(exchange.getRequestHeaders().containsKey(\"Authorization\") &&\n+                        exchange.getRequestHeaders().get(\"Authorization\").toString().contains(\"Basic YWRtaW46YWRtaW4=\"))\n+                {\n+                    response = ResponseConstants.responseBody.getBytes();\n+                    exchange.getResponseHeaders().set(CONTENT_TYPE,\n+                            CONTENT_TYPE_APPLICATION_JSON);\n+                    exchange.sendResponseHeaders(HttpURLConnection.HTTP_OK, response.length);\n+                } else {\n+                    response = ResponseConstants.AUTHENTICATION_FAILURE_RESPONSE.getBytes();\n+                    exchange.getResponseHeaders().set(CONTENT_TYPE,\n+                            CONTENT_TYPE_APPLICATION_JSON);\n+                    exchange.sendResponseHeaders(HttpURLConnection.HTTP_UNAUTHORIZED, response.length);\n+                }\n+                exchange.getResponseBody().write(response);\n+                exchange.close();\n+            });\n+            httpServer.createContext(contextWithSecurity2 + \"/pet/\", exchange -> {\n+                byte[] response;\n+                if(exchange.getRequestHeaders().containsKey(\"Authorization\") &&\n+                        exchange.getRequestHeaders().get(\"Authorization\").toString().contains(\"Basic YWRtaW46YWRtaW4=\"))\n+                {\n+                    response = ResponseConstants.petByIdResponse.getBytes();\n+                    exchange.getResponseHeaders().set(CONTENT_TYPE,\n+                            CONTENT_TYPE_APPLICATION_JSON);\n+                    exchange.sendResponseHeaders(HttpURLConnection.HTTP_OK, response.length);\n+                } else {\n+                    response = ResponseConstants.AUTHENTICATION_FAILURE_RESPONSE.getBytes();\n+                    exchange.getResponseHeaders().set(CONTENT_TYPE,\n+                            CONTENT_TYPE_APPLICATION_JSON);\n+                    exchange.sendResponseHeaders(HttpURLConnection.HTTP_UNAUTHORIZED, response.length);\n+                }\n+                exchange.getResponseBody().write(response);\n+                exchange.close();\n+            });\n+            httpServer.createContext(contextWithSecurity2 + \"/pet/findByTags\", exchange -> {\n+                byte[] response;\n+                if(exchange.getRequestHeaders().containsKey(\"Authorization\") &&\n+                        exchange.getRequestHeaders().get(\"Authorization\").toString().contains(\"Basic YWRtaW46YWRtaW4=\"))\n+                {\n+                    response = ResponseConstants.petByIdResponse.getBytes();\n+                    exchange.getResponseHeaders().set(CONTENT_TYPE,\n+                            CONTENT_TYPE_APPLICATION_JSON);\n+                    exchange.sendResponseHeaders(HttpURLConnection.HTTP_OK, response.length);\n+                } else {\n+                    response = ResponseConstants.AUTHENTICATION_FAILURE_RESPONSE.getBytes();\n+                    exchange.getResponseHeaders().set(CONTENT_TYPE,\n+                            CONTENT_TYPE_APPLICATION_JSON);\n+                    exchange.sendResponseHeaders(HttpURLConnection.HTTP_UNAUTHORIZED, response.length);\n+                }\n+                exchange.getResponseBody().write(response);\n+                exchange.close();\n+            });\n+            httpServer.createContext(contextWithSecurity2 + \"/store/inventory\", exchange -> {\n+                byte[] response;\n+                if(exchange.getRequestHeaders().containsKey(\"Authorization\") &&\n+                        exchange.getRequestHeaders().get(\"Authorization\").toString().contains(\"Basic YWRtaW46YWRtaW4=\"))\n+                {\n+                    response = ResponseConstants.storeInventoryResponse.getBytes();\n+                    exchange.getResponseHeaders().set(CONTENT_TYPE,\n+                            CONTENT_TYPE_APPLICATION_JSON);\n+                    exchange.sendResponseHeaders(HttpURLConnection.HTTP_OK, response.length);\n+                } else {\n+                    response = ResponseConstants.AUTHENTICATION_FAILURE_RESPONSE.getBytes();\n+                    exchange.getResponseHeaders().set(CONTENT_TYPE,\n+                            CONTENT_TYPE_APPLICATION_JSON);\n+                    exchange.sendResponseHeaders(HttpURLConnection.HTTP_UNAUTHORIZED, response.length);\n+                }\n+                exchange.getResponseBody().write(response);\n+                exchange.close();\n+            });\n+            String contextWithSecurity1 = \"/v1Basic\";\n+            httpServer.createContext(contextWithSecurity1 + \"/pet/findByStatus\", exchange -> {\n+                byte[] response;\n+                if(exchange.getRequestHeaders().containsKey(\"Authorization\") &&\n+                        exchange.getRequestHeaders().get(\"Authorization\").toString().contains(\"Basic YWRtaW46YWRtaW4=\"))\n+                {\n+                    response = ResponseConstants.responseBodyV1.getBytes();\n+                    exchange.getResponseHeaders().set(CONTENT_TYPE,\n+                            CONTENT_TYPE_APPLICATION_JSON);\n+                    exchange.sendResponseHeaders(HttpURLConnection.HTTP_OK, response.length);\n+                } else {\n+                    response = ResponseConstants.AUTHENTICATION_FAILURE_RESPONSE.getBytes();\n+                    exchange.getResponseHeaders().set(CONTENT_TYPE,\n+                            CONTENT_TYPE_APPLICATION_JSON);\n+                    exchange.sendResponseHeaders(HttpURLConnection.HTTP_UNAUTHORIZED, response.length);\n+                }\n+                exchange.getResponseBody().write(response);\n+                exchange.close();\n+            });\n+            httpServer.createContext(contextWithSecurity1 + \"/pet/findByTags\", exchange -> {\n+                byte[] response;\n+                if(exchange.getRequestHeaders().containsKey(\"Authorization\") &&\n+                        exchange.getRequestHeaders().get(\"Authorization\").toString().contains(\"Basic YWRtaW46YWRtaW4=\"))\n+                {\n+                    response = ResponseConstants.petByIdResponseV1.getBytes();\n+                    exchange.getResponseHeaders().set(CONTENT_TYPE,\n+                            CONTENT_TYPE_APPLICATION_JSON);\n+                    exchange.sendResponseHeaders(HttpURLConnection.HTTP_OK, response.length);\n+                } else {\n+                    response = ResponseConstants.AUTHENTICATION_FAILURE_RESPONSE.getBytes();\n+                    exchange.getResponseHeaders().set(CONTENT_TYPE,\n+                            CONTENT_TYPE_APPLICATION_JSON);\n+                    exchange.sendResponseHeaders(HttpURLConnection.HTTP_UNAUTHORIZED, response.length);\n+                }\n+                exchange.getResponseBody().write(response);\n+                exchange.close();\n+            });\n+            httpServer.createContext(base + \"/store/inventory\", exchange -> {\n+\n+                byte[] response = ResponseConstants.storeInventoryResponse.getBytes();\n+                exchange.getResponseHeaders().set(CONTENT_TYPE,\n+                        CONTENT_TYPE_APPLICATION_JSON);\n+                exchange.sendResponseHeaders(HttpURLConnection.HTTP_OK, response.length);\n+                exchange.getResponseBody().write(response);\n+                exchange.close();\n+            });\n+            String contextV3 = \"/v3\";\n+            httpServer.createContext(contextV3 + \"/pet/findByStatus\", exchange -> {\n+\n+                byte[] response = ResponseConstants.responseBodyV1.getBytes();\n+                exchange.getResponseHeaders().set(CONTENT_TYPE,\n+                        CONTENT_TYPE_APPLICATION_JSON);\n+                exchange.sendResponseHeaders(HttpURLConnection.HTTP_OK, response.length);\n+                exchange.getResponseBody().write(response);\n+                exchange.close();\n+            });\n+            httpServer.createContext(contextV3 + \"/store/order\", exchange -> {\n+\n+                int length;\n+                ByteArrayOutputStream os = new ByteArrayOutputStream();\n+\n+                InputStream is =  exchange.getRequestBody();\n+                byte[] buffer = new byte[1024];\n+                while ((length = is.read(buffer)) != -1 ) {\n+                    os.write(buffer, 0, length);\n+                }\n+                byte [] response  = os.toByteArray();\n+                exchange.getResponseHeaders().set(CONTENT_TYPE,\n+                        CONTENT_TYPE_APPLICATION_JSON);\n+                exchange.sendResponseHeaders(HttpURLConnection.HTTP_OK,response.length);\n+                exchange.getResponseBody().write(response);\n+                exchange.close();\n+            });\n+            httpServer.createContext(contextV3 + \"/pet/\", exchange -> {\n+\n+                InputStream is =  exchange.getRequestBody();\n+                byte [] response = IOUtils.toByteArray(is);\n+                exchange.getResponseHeaders().set(CONTENT_TYPE,\n+                        CONTENT_TYPE_APPLICATION_JSON);\n+                exchange.sendResponseHeaders(HttpURLConnection.HTTP_OK, response.length);\n+                exchange.getResponseBody().write(response);\n+                exchange.close();\n+            });\n+            httpServer.createContext(contextV3 + \"/timeout\", exchange -> {\n+                try {\n+                    Thread.sleep(5000);\n+                } catch (InterruptedException e) {\n+                    //log.error(\"Error while invoking timeout back end\", e);\n+                }\n+                byte[] response = ResponseConstants.responseBodyV1.getBytes();\n+                exchange.getResponseHeaders().set(CONTENT_TYPE,\n+                        CONTENT_TYPE_APPLICATION_JSON);\n+                exchange.sendResponseHeaders(HttpURLConnection.HTTP_OK, response.length);\n+                exchange.getResponseBody().write(response);\n+                exchange.close();\n+            });\n+            httpServer.createContext(contextV3 + \"/retry\", exchange -> {\n+                if (!retryDone) {\n+                    byte[] response = ResponseConstants.responseBodyV1.getBytes();\n+                    exchange.getResponseHeaders().set(CONTENT_TYPE,\n+                            CONTENT_TYPE_APPLICATION_JSON);\n+                    exchange.sendResponseHeaders(HttpURLConnection.HTTP_GATEWAY_TIMEOUT, 0);\n+                    exchange.getResponseBody().write(response);\n+                    exchange.close();\n+                    retryDone = true;\n+                }\n+                byte[] response = ResponseConstants.responseBodyV1.getBytes();\n+                exchange.getResponseHeaders().set(CONTENT_TYPE,\n+                        CONTENT_TYPE_APPLICATION_JSON);\n+                exchange.sendResponseHeaders(HttpURLConnection.HTTP_OK, response.length);\n+                exchange.getResponseBody().write(response);\n+                retryDone = false;\n+                exchange.close();\n+            });\n+            httpServer.createContext(contextV3 + \"/circuitBreaker\", exchange -> {\n+                if (exchange.getRequestURI().getQuery() != null && exchange.getRequestURI().getQuery()\n+                        .contains(\"cb=true\")) {\n+                    byte[] response = ResponseConstants.ERROR_RESPONSE.getBytes();\n+                    exchange.getResponseHeaders().set(CONTENT_TYPE,\n+                            CONTENT_TYPE_APPLICATION_JSON);\n+                    exchange.sendResponseHeaders(HttpURLConnection.HTTP_INTERNAL_ERROR, 0);\n+                    exchange.getResponseBody().write(response);\n+                    exchange.close();\n+                } else {\n+                    byte[] response = ResponseConstants.responseBodyV1.getBytes();\n+                    exchange.getResponseHeaders().set(CONTENT_TYPE,\n+                            CONTENT_TYPE_APPLICATION_JSON);\n+                    exchange.sendResponseHeaders(HttpURLConnection.HTTP_OK, response.length);\n+                    exchange.getResponseBody().write(response);\n+                    exchange.close();\n+                }\n+            });\n+            // to test jwt generator\n+            String contextV4 = \"/v4\";\n+            httpServer.createContext(contextV4 + \"/jwtheader\", exchange -> {\n+                byte[] response;\n+                if (exchange.getRequestHeaders().containsKey(\"X-JWT-Assertion\")) {\n+                    response = ResponseConstants.VALID_JWT_RESPONSE.getBytes();\n+                } else {\n+                    response = ResponseConstants.INVALID_JWT_RESPONSE.getBytes();\n+                }\n+                exchange.getResponseHeaders().set(CONTENT_TYPE,\n+                        CONTENT_TYPE_APPLICATION_JSON);\n+                exchange.sendResponseHeaders(HttpURLConnection.HTTP_OK, response.length);\n+                exchange.getResponseBody().write(response);\n+                exchange.close();\n+            });\n+            httpServer.createContext(contextV4 + \"/jwttoken\", exchange -> {\n+                byte[] response;\n+                if (exchange.getRequestHeaders().containsKey(\"X-JWT-Assertion\")) {\n+                    JSONObject responseJSON = new JSONObject();\n+                    responseJSON.put(\"token\", exchange.getRequestHeaders().get(\"X-JWT-Assertion\").toString());\n+                    response = responseJSON.toString().getBytes();\n+                } else {\n+                    response = ResponseConstants.INVALID_JWT_RESPONSE.getBytes();\n+                }\n+                exchange.getResponseHeaders().set(CONTENT_TYPE,\n+                        CONTENT_TYPE_APPLICATION_JSON);\n+                exchange.sendResponseHeaders(HttpURLConnection.HTTP_OK, response.length);\n+                exchange.getResponseBody().write(response);\n+                exchange.close();\n+            });\n+            httpServer.start();\n+            backEndServerUrl = \"http://localhost:\" + backEndServerPort;\n+        } catch (Exception e) {\n+            //log.error(\"Error occurred while setting up mock server\", e);\n+        }\n+    }\n+\n+    public void stopIt() {\n+\n+        httpServer.stop(0);\n+    }\n+", "originalCommit": "ddde43f9fa266a20c0502964aec058a79624278b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM2NTU1Mg==", "url": "https://github.com/wso2/product-microgateway/pull/1511#discussion_r536365552", "bodyText": "Fixed in ee03466", "author": "chashikajw", "createdAt": "2020-12-04T20:37:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTg2NzgwMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTg3MDAwMA==", "url": "https://github.com/wso2/product-microgateway/pull/1511#discussion_r535870000", "bodyText": "Lets use proper comments", "author": "Rajith90", "createdAt": "2020-12-04T06:38:33Z", "path": "test-integration/src/test/java/org/wso2am/micro/gw/tests/context/MgwServerInstance.java", "diffHunk": "@@ -0,0 +1,148 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2am.micro.gw.tests.context;\n+\n+import com.github.dockerjava.zerodep.shaded.org.apache.hc.core5.http.HttpStatus;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.testcontainers.containers.DockerComposeContainer;\n+import org.wso2am.micro.gw.tests.mockbackend.MockBackendServer;\n+import org.wso2am.micro.gw.tests.util.HttpClientRequest;\n+import org.wso2am.micro.gw.tests.util.HttpResponse;\n+import org.wso2am.micro.gw.tests.util.Utils;\n+\n+import java.io.File;\n+import java.io.IOException;\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.Properties;\n+import java.util.concurrent.TimeUnit;\n+\n+import static org.wso2am.micro.gw.tests.common.BaseTestCase.getMockServiceURLHttp;\n+\n+/**\n+ * Mgw server instance class.\n+ */\n+public class MgwServerInstance implements MgwServer {\n+\n+    private static final Logger log = LoggerFactory.getLogger(MgwServerInstance.class);\n+    private DockerComposeContainer environment;\n+\n+\n+    /**\n+     * initialize a docker environment using docker compose.\n+     *\n+     * @throws IOException\n+     * @throws MicroGWTestException\n+     */\n+    public MgwServerInstance() throws IOException, MicroGWTestException {\n+        createTmpMgwSetup();\n+        File targetClassesDir = new File(MgwServerInstance.class.getProtectionDomain().getCodeSource().\n+                getLocation().getPath());\n+        String mgwServerPath = targetClassesDir.getParentFile().toString() + File.separator + \"server-tmp\";\n+\n+        String dockerCompsePath = mgwServerPath+  File.separator + \"docker-compose.yaml\";\n+        MockBackendServer.addMockBackendServiceToDockerCompose(dockerCompsePath);\n+        environment = new DockerComposeContainer(new File(dockerCompsePath))\n+                .withLocalCompose(true);\n+\n+    }\n+\n+    /**\n+     * initialize a docker environment using docker compose.\n+     *\n+     * @param confPath external conf.toml path\n+     *\n+     * @throws IOException\n+     * @throws MicroGWTestException\n+     */\n+    public MgwServerInstance(String confPath) throws IOException, MicroGWTestException {\n+        createTmpMgwSetup();\n+        File targetClassesDir = new File(MgwServerInstance.class.getProtectionDomain().getCodeSource().\n+                getLocation().getPath());\n+        String mgwServerPath = targetClassesDir.getParentFile().toString() + File.separator + \"server-tmp\";\n+        Utils.copyFile(confPath, mgwServerPath  +  File.separator + \"resources\"  +  File.separator +\n+                \"conf\" +  File.separator + \"config.toml\");\n+\n+        String dockerCompsePath = mgwServerPath+  File.separator + \"docker-compose.yaml\";\n+        MockBackendServer.addMockBackendServiceToDockerCompose(dockerCompsePath);\n+        environment = new DockerComposeContainer(new File(dockerCompsePath))\n+                .withLocalCompose(true);\n+\n+    }\n+\n+    @Override\n+    public void startMGW() throws IOException, InterruptedException {\n+        try {\n+            environment.start();\n+        } catch (Exception e) {\n+            log.error(\"Error occurs when docker-compose up\");\n+        }\n+\n+        waitTillBackendIsAvailable();\n+\n+    }\n+\n+    @Override\n+    public void stopMGW() {\n+        environment.stop();\n+    }\n+\n+    /**\n+     * create a temporal mgw setup.", "originalCommit": "ddde43f9fa266a20c0502964aec058a79624278b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM2NDA5MQ==", "url": "https://github.com/wso2/product-microgateway/pull/1511#discussion_r536364091", "bodyText": "Fixed in ee03466", "author": "chashikajw", "createdAt": "2020-12-04T20:34:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTg3MDAwMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTg3MzE5OQ==", "url": "https://github.com/wso2/product-microgateway/pull/1511#discussion_r535873199", "bodyText": "remove static imports", "author": "chashikajw", "createdAt": "2020-12-04T06:47:04Z", "path": "test-integration/src/test/java/org/wso2am/micro/gw/tests/jwtValidator/JwtTestCase.java", "diffHunk": "@@ -0,0 +1,114 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2am.micro.gw.tests.jwtValidator;\n+\n+import com.github.dockerjava.zerodep.shaded.org.apache.hc.core5.http.HttpStatus;\n+import io.netty.handler.codec.http.HttpHeaderNames;\n+import org.testng.Assert;\n+import org.testng.annotations.BeforeSuite;\n+import org.testng.annotations.Test;\n+import org.wso2am.micro.gw.tests.common.BaseTestCase;\n+import org.wso2am.micro.gw.tests.common.model.API;\n+import org.wso2am.micro.gw.tests.common.model.ApplicationDTO;\n+import org.wso2am.micro.gw.tests.util.*;\n+\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import static org.wso2am.micro.gw.tests.util.ApiProjectGenerator.*;", "originalCommit": "ddde43f9fa266a20c0502964aec058a79624278b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM2NDE4MQ==", "url": "https://github.com/wso2/product-microgateway/pull/1511#discussion_r536364181", "bodyText": "Fixed in ee03466", "author": "chashikajw", "createdAt": "2020-12-04T20:34:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTg3MzE5OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTg3NDk2OA==", "url": "https://github.com/wso2/product-microgateway/pull/1511#discussion_r535874968", "bodyText": "throw the exception", "author": "chashikajw", "createdAt": "2020-12-04T06:51:51Z", "path": "test-integration/src/test/java/org/wso2am/micro/gw/tests/mockbackend/MockBackendServer.java", "diffHunk": "@@ -0,0 +1,139 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2am.micro.gw.tests.mockbackend;\n+\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.testcontainers.containers.GenericContainer;\n+import org.testcontainers.images.builder.ImageFromDockerfile;\n+import org.wso2am.micro.gw.tests.context.MicroGWTestException;\n+import org.wso2am.micro.gw.tests.util.Utils;\n+import org.wso2am.micro.gw.tests.util.TestConstant;\n+\n+import java.io.*;\n+import java.nio.charset.Charset;\n+import java.nio.charset.StandardCharsets;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.nio.file.StandardOpenOption;\n+import java.util.Arrays;\n+import java.util.List;\n+\n+import static org.rnorth.visibleassertions.VisibleAssertions.pass;\n+\n+/**\n+ * Mock backend server class.\n+ *\n+ */\n+public class MockBackendServer {\n+\n+    private static final Logger log = LoggerFactory.getLogger(MockBackendServer.class);\n+\n+    /**\n+     * Generate the Mock backend server docker image.\n+     *\n+     */\n+    public static void generateMockBackendServerDockerImage() {\n+\n+        try {\n+            ImageFromDockerfile image = new ImageFromDockerfile(TestConstant.MOCK_BACKEND_DOCKER_IMAGE, false)\n+                    .withFileFromPath(\".\", Paths.get(getMockBackendModuleRootPath()));\n+            verifyImage(image);\n+        } catch (Exception e) {\n+            log.error(\"Error occurs when creating \" + TestConstant.MOCK_BACKEND_DOCKER_IMAGE+ \"docker image\");", "originalCommit": "ddde43f9fa266a20c0502964aec058a79624278b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM2NDI5Mg==", "url": "https://github.com/wso2/product-microgateway/pull/1511#discussion_r536364292", "bodyText": "Fixed in ee03466", "author": "chashikajw", "createdAt": "2020-12-04T20:34:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTg3NDk2OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTg3Njg5OA==", "url": "https://github.com/wso2/product-microgateway/pull/1511#discussion_r535876898", "bodyText": "check without a token (get the difference of response code)", "author": "chashikajw", "createdAt": "2020-12-04T06:56:40Z", "path": "test-integration/src/test/java/org/wso2am/micro/gw/tests/util/ApiDeployment.java", "diffHunk": "@@ -0,0 +1,65 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2am.micro.gw.tests.util;\n+\n+import com.github.dockerjava.zerodep.shaded.org.apache.hc.core5.http.HttpStatus;\n+import io.netty.handler.codec.http.HttpHeaderNames;\n+import org.junit.Assert;\n+\n+import java.io.File;\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.concurrent.TimeUnit;\n+\n+import static org.wso2am.micro.gw.tests.common.BaseTestCase.getImportAPIServiceURLHttps;\n+\n+/**\n+ * Api deployment class for the mgw.\n+ *\n+ */\n+public class ApiDeployment {\n+\n+    /**\n+     * Get Mock backend server module root path.\n+     *\n+     * @param apiZipFilePath  path for the apictl project zip file\n+     *\n+     * @throws Exception\n+     */\n+    public static void deployAPI(String apiZipFilePath) throws Exception {\n+\n+        // Set header\n+        Map<String, String> headers = new HashMap<String,String>();\n+        headers.put(HttpHeaderNames.AUTHORIZATION.toString(), \"Basic YWRtaW46YWRtaW4=\");\n+        HttpsPostMultipart multipart = new HttpsPostMultipart(getImportAPIServiceURLHttps(\n+                TestConstant.ADAPTER_IMPORT_API_RESOURCE) , headers);\n+        multipart.addFilePart(\"file\", new File(apiZipFilePath));\n+        HttpResponse response = multipart.getResponse();\n+\n+        // todo (currently no way to test the availability of the api routes, so wait 5 seconds)\n+        TimeUnit.SECONDS.sleep(5);", "originalCommit": "ddde43f9fa266a20c0502964aec058a79624278b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM2NDc1OA==", "url": "https://github.com/wso2/product-microgateway/pull/1511#discussion_r536364758", "bodyText": "Created the method in ee03466. but didn;t call it yet. need to call it after implementing default listenener", "author": "chashikajw", "createdAt": "2020-12-04T20:35:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTg3Njg5OA=="}], "type": "inlineReview"}, {"oid": "ee03466e7304d4b68a1c39906fb6a12affb17948", "url": "https://github.com/wso2/product-microgateway/commit/ee03466e7304d4b68a1c39906fb6a12affb17948", "message": "format the code and change the way of docker image creation", "committedDate": "2020-12-04T16:27:16Z", "type": "commit"}, {"oid": "49905cdaf2edc09fee5be67f1182faafaf3d2bdd", "url": "https://github.com/wso2/product-microgateway/commit/49905cdaf2edc09fee5be67f1182faafaf3d2bdd", "message": "restructure test module", "committedDate": "2020-12-04T20:30:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjQxNTM4OA==", "url": "https://github.com/wso2/product-microgateway/pull/1511#discussion_r562415388", "bodyText": "Shall we remove the extra lines in this file, if the file is not auto-generate?", "author": "Meruja", "createdAt": "2021-01-22T06:32:26Z", "path": "test/mock-backend-server/src/main/java/org.wso2am.micro.gw.mockbackend/MockBackEndServer.java", "diffHunk": "@@ -0,0 +1,155 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2am.micro.gw.mockbackend;\n+\n+import com.sun.net.httpserver.HttpServer;\n+import java.util.logging.Level;\n+import java.net.HttpURLConnection;\n+import java.net.InetSocketAddress;\n+import java.util.logging.Logger;\n+\n+/**\n+ * Mock HTTP server for testing Open API tests.\n+ */\n+public class MockBackEndServer extends Thread {\n+\n+    private static final Logger logger = Logger.getLogger(MockBackEndServer.class.getName());\n+    private HttpServer httpServer;\n+    private String backEndServerUrl;\n+    private static int backEndServerPort;\n+    private static boolean retryDone = false;\n+\n+", "originalCommit": "49905cdaf2edc09fee5be67f1182faafaf3d2bdd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2OTYzOTE4MQ==", "url": "https://github.com/wso2/product-microgateway/pull/1511#discussion_r569639181", "bodyText": "This is already removed", "author": "chashikajw", "createdAt": "2021-02-03T18:15:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjQxNTM4OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjQxNjk1Mw==", "url": "https://github.com/wso2/product-microgateway/pull/1511#discussion_r562416953", "bodyText": "Shall we move open brace/{ to line 109?\nAd check line 128 as well.", "author": "Meruja", "createdAt": "2021-01-22T06:37:10Z", "path": "test/mock-backend-server/src/main/java/org.wso2am.micro.gw.mockbackend/MockBackEndServer.java", "diffHunk": "@@ -0,0 +1,155 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2am.micro.gw.mockbackend;\n+\n+import com.sun.net.httpserver.HttpServer;\n+import java.util.logging.Level;\n+import java.net.HttpURLConnection;\n+import java.net.InetSocketAddress;\n+import java.util.logging.Logger;\n+\n+/**\n+ * Mock HTTP server for testing Open API tests.\n+ */\n+public class MockBackEndServer extends Thread {\n+\n+    private static final Logger logger = Logger.getLogger(MockBackEndServer.class.getName());\n+    private HttpServer httpServer;\n+    private String backEndServerUrl;\n+    private static int backEndServerPort;\n+    private static boolean retryDone = false;\n+\n+\n+\n+    public static void main(String[] args) {\n+        //backend port\n+        backEndServerPort = Constants.MOCK_BACKEND_SERVER_PORT;\n+        MockBackEndServer mockBackEndServer = new MockBackEndServer(backEndServerPort);\n+        mockBackEndServer.start();\n+\n+    }\n+\n+    public MockBackEndServer(int port) {\n+\n+        backEndServerPort = port;\n+    }\n+\n+    public void run() {\n+\n+        if (backEndServerPort < 0) {\n+            throw new RuntimeException(\"Server port is not defined\");\n+        }\n+        try {\n+            httpServer = HttpServer.create(new InetSocketAddress(backEndServerPort), 0);\n+            String context = \"/v2\";\n+            httpServer.createContext(context + \"/pet/findByStatus\", exchange -> {\n+\n+                byte[] response = ResponseConstants.responseBody.getBytes();\n+                exchange.getResponseHeaders().set(Constants.CONTENT_TYPE,\n+                        Constants.CONTENT_TYPE_APPLICATION_JSON);\n+                exchange.sendResponseHeaders(HttpURLConnection.HTTP_OK, response.length);\n+                exchange.getResponseBody().write(response);\n+                exchange.close();\n+            });\n+            httpServer.createContext(context + \"/pet/\", exchange -> {\n+\n+                byte[] response = ResponseConstants.getPetResponse.getBytes();\n+                exchange.getResponseHeaders().set(Constants.CONTENT_TYPE,\n+                        Constants.CONTENT_TYPE_APPLICATION_JSON);\n+                exchange.sendResponseHeaders(HttpURLConnection.HTTP_OK, response.length);\n+                exchange.getResponseBody().write(response);\n+                exchange.close();\n+            });\n+            httpServer.createContext(context + \"/pet/findByTags\", exchange -> {\n+\n+                byte[] response = ResponseConstants.petByIdResponse.getBytes();\n+                exchange.getResponseHeaders().set(Constants.CONTENT_TYPE,\n+                        Constants.CONTENT_TYPE_APPLICATION_JSON);\n+                exchange.sendResponseHeaders(HttpURLConnection.HTTP_OK, response.length);\n+                exchange.getResponseBody().write(response);\n+                exchange.close();\n+            });\n+            httpServer.createContext(context + \"/store/inventory\", exchange -> {\n+\n+                byte[] response = ResponseConstants.storeInventoryResponse.getBytes();\n+                exchange.getResponseHeaders().set(Constants.CONTENT_TYPE,\n+                        Constants.CONTENT_TYPE_APPLICATION_JSON);\n+                exchange.sendResponseHeaders(HttpURLConnection.HTTP_OK, response.length);\n+                exchange.getResponseBody().write(response);\n+                exchange.close();\n+            });\n+            httpServer.createContext(context + \"/pet/3\", exchange -> {\n+\n+                byte[] response = ResponseConstants.RESPONSE_VALID_JWT_TRANSFORMER.getBytes();\n+                exchange.getResponseHeaders().set(Constants.CONTENT_TYPE,\n+                        Constants.CONTENT_TYPE_APPLICATION_JSON);\n+                exchange.sendResponseHeaders(HttpURLConnection.HTTP_OK, response.length);\n+                exchange.getResponseBody().write(response);\n+                exchange.close();\n+            });\n+            httpServer.createContext(context + \"/store/order/1\", exchange -> {\n+                byte[] response;\n+                if(exchange.getRequestHeaders().containsKey(\"Authorization\") &&\n+                        exchange.getRequestHeaders().get(\"Authorization\").toString().contains(\"Basic YWRtaW46aGVsbG8=\"))\n+                {", "originalCommit": "49905cdaf2edc09fee5be67f1182faafaf3d2bdd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2OTY1NzQ1NA==", "url": "https://github.com/wso2/product-microgateway/pull/1511#discussion_r569657454", "bodyText": "Fixed in 3b6cc67", "author": "chashikajw", "createdAt": "2021-02-03T18:44:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjQxNjk1Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjQxNzQ1MQ==", "url": "https://github.com/wso2/product-microgateway/pull/1511#discussion_r562417451", "bodyText": "Remove the extra line.", "author": "Meruja", "createdAt": "2021-01-22T06:38:28Z", "path": "test/mock-backend-server/src/main/java/org.wso2am.micro.gw.mockbackend/MockBackEndServer.java", "diffHunk": "@@ -0,0 +1,155 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2am.micro.gw.mockbackend;\n+\n+import com.sun.net.httpserver.HttpServer;\n+import java.util.logging.Level;\n+import java.net.HttpURLConnection;\n+import java.net.InetSocketAddress;\n+import java.util.logging.Logger;\n+\n+/**\n+ * Mock HTTP server for testing Open API tests.\n+ */\n+public class MockBackEndServer extends Thread {\n+\n+    private static final Logger logger = Logger.getLogger(MockBackEndServer.class.getName());\n+    private HttpServer httpServer;\n+    private String backEndServerUrl;\n+    private static int backEndServerPort;\n+    private static boolean retryDone = false;\n+\n+\n+\n+    public static void main(String[] args) {\n+        //backend port\n+        backEndServerPort = Constants.MOCK_BACKEND_SERVER_PORT;\n+        MockBackEndServer mockBackEndServer = new MockBackEndServer(backEndServerPort);\n+        mockBackEndServer.start();\n+\n+    }\n+\n+    public MockBackEndServer(int port) {\n+\n+        backEndServerPort = port;\n+    }\n+\n+    public void run() {\n+\n+        if (backEndServerPort < 0) {\n+            throw new RuntimeException(\"Server port is not defined\");\n+        }\n+        try {\n+            httpServer = HttpServer.create(new InetSocketAddress(backEndServerPort), 0);\n+            String context = \"/v2\";\n+            httpServer.createContext(context + \"/pet/findByStatus\", exchange -> {\n+\n+                byte[] response = ResponseConstants.responseBody.getBytes();\n+                exchange.getResponseHeaders().set(Constants.CONTENT_TYPE,\n+                        Constants.CONTENT_TYPE_APPLICATION_JSON);\n+                exchange.sendResponseHeaders(HttpURLConnection.HTTP_OK, response.length);\n+                exchange.getResponseBody().write(response);\n+                exchange.close();\n+            });\n+            httpServer.createContext(context + \"/pet/\", exchange -> {\n+\n+                byte[] response = ResponseConstants.getPetResponse.getBytes();\n+                exchange.getResponseHeaders().set(Constants.CONTENT_TYPE,\n+                        Constants.CONTENT_TYPE_APPLICATION_JSON);\n+                exchange.sendResponseHeaders(HttpURLConnection.HTTP_OK, response.length);\n+                exchange.getResponseBody().write(response);\n+                exchange.close();\n+            });\n+            httpServer.createContext(context + \"/pet/findByTags\", exchange -> {\n+\n+                byte[] response = ResponseConstants.petByIdResponse.getBytes();\n+                exchange.getResponseHeaders().set(Constants.CONTENT_TYPE,\n+                        Constants.CONTENT_TYPE_APPLICATION_JSON);\n+                exchange.sendResponseHeaders(HttpURLConnection.HTTP_OK, response.length);\n+                exchange.getResponseBody().write(response);\n+                exchange.close();\n+            });\n+            httpServer.createContext(context + \"/store/inventory\", exchange -> {\n+\n+                byte[] response = ResponseConstants.storeInventoryResponse.getBytes();\n+                exchange.getResponseHeaders().set(Constants.CONTENT_TYPE,\n+                        Constants.CONTENT_TYPE_APPLICATION_JSON);\n+                exchange.sendResponseHeaders(HttpURLConnection.HTTP_OK, response.length);\n+                exchange.getResponseBody().write(response);\n+                exchange.close();\n+            });\n+            httpServer.createContext(context + \"/pet/3\", exchange -> {\n+\n+                byte[] response = ResponseConstants.RESPONSE_VALID_JWT_TRANSFORMER.getBytes();\n+                exchange.getResponseHeaders().set(Constants.CONTENT_TYPE,\n+                        Constants.CONTENT_TYPE_APPLICATION_JSON);\n+                exchange.sendResponseHeaders(HttpURLConnection.HTTP_OK, response.length);\n+                exchange.getResponseBody().write(response);\n+                exchange.close();\n+            });\n+            httpServer.createContext(context + \"/store/order/1\", exchange -> {\n+                byte[] response;\n+                if(exchange.getRequestHeaders().containsKey(\"Authorization\") &&\n+                        exchange.getRequestHeaders().get(\"Authorization\").toString().contains(\"Basic YWRtaW46aGVsbG8=\"))\n+                {\n+                    response = ResponseConstants.storeInventoryResponse.getBytes();\n+                    exchange.getResponseHeaders().set(Constants.CONTENT_TYPE,\n+                            Constants.CONTENT_TYPE_APPLICATION_JSON);\n+                    exchange.sendResponseHeaders(HttpURLConnection.HTTP_OK, response.length);\n+                } else {\n+                    response = ResponseConstants.AUTHENTICATION_FAILURE_RESPONSE.getBytes();\n+                    exchange.getResponseHeaders().set(Constants.CONTENT_TYPE,\n+                            Constants.CONTENT_TYPE_APPLICATION_JSON);\n+                    exchange.sendResponseHeaders(HttpURLConnection.HTTP_UNAUTHORIZED, response.length);\n+                }\n+                exchange.getResponseBody().write(response);\n+                exchange.close();\n+            });\n+            httpServer.createContext(context + \"/user/john\", exchange -> {\n+                byte[] response;\n+                if(exchange.getRequestHeaders().containsKey(\"Authorization\") &&\n+                        exchange.getRequestHeaders().get(\"Authorization\").toString().contains(\"Basic YWRtaW46aGVsbG8=\"))\n+                {\n+                    response = ResponseConstants.userResponse.getBytes();\n+                    exchange.getResponseHeaders().set(Constants.CONTENT_TYPE,\n+                            Constants.CONTENT_TYPE_APPLICATION_JSON);\n+                    exchange.sendResponseHeaders(HttpURLConnection.HTTP_OK, response.length);\n+                } else {\n+                    response = ResponseConstants.AUTHZ_FAILURE_RESPONSE.getBytes();\n+                    exchange.getResponseHeaders().set(Constants.CONTENT_TYPE,\n+                            Constants.CONTENT_TYPE_APPLICATION_JSON);\n+                    exchange.sendResponseHeaders(HttpURLConnection.HTTP_FORBIDDEN, response.length);\n+                }\n+                exchange.getResponseBody().write(response);\n+                exchange.close();\n+            });\n+\n+            httpServer.start();\n+            backEndServerUrl = \"http://localhost:\" + backEndServerPort;\n+        } catch (Exception ex) {\n+            logger.log(Level.SEVERE, \"Error occurred while setting up mock server\", ex);\n+", "originalCommit": "49905cdaf2edc09fee5be67f1182faafaf3d2bdd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2OTY0MTIyNA==", "url": "https://github.com/wso2/product-microgateway/pull/1511#discussion_r569641224", "bodyText": "This is already removed", "author": "chashikajw", "createdAt": "2021-02-03T18:18:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjQxNzQ1MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjQxODYyNA==", "url": "https://github.com/wso2/product-microgateway/pull/1511#discussion_r562418624", "bodyText": "Shall we add a line at the eof?", "author": "Meruja", "createdAt": "2021-01-22T06:42:16Z", "path": "test/test-integration/src/test/java/org/wso2am/micro/gw/tests/common/model/SubscriptionPolicy.java", "diffHunk": "@@ -0,0 +1,152 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2am.micro.gw.tests.common.model;\n+\n+import java.util.List;\n+import java.util.UUID;\n+\n+/**\n+ * Subscription policy model\n+ */\n+public class SubscriptionPolicy {\n+    private String policyId = UUID.randomUUID().toString();\n+    private String policyName;\n+    private String displayName;\n+    private String description;\n+    private boolean isDeployed = true;\n+    private int rateLimitCount = 0;\n+    private String rateLimitTimeUnit = null;\n+    private List<String> customAttributes;\n+    boolean stopOnQuotaReach = true;\n+    private String billingPlan = \"FREE\";\n+    private DefaultLimit defaultLimit = new DefaultLimit();\n+\n+    public String getPolicyId() {\n+        return policyId;\n+    }\n+\n+    public void setPolicyId(String policyId) {\n+        this.policyId = policyId;\n+    }\n+\n+    public String getPolicyName() {\n+        return policyName;\n+    }\n+\n+    public void setPolicyName(String policyName) {\n+        this.policyName = policyName;\n+    }\n+\n+    public String getDisplayName() {\n+        return displayName;\n+    }\n+\n+    public void setDisplayName(String displayName) {\n+        this.displayName = displayName;\n+    }\n+\n+    public String getDescription() {\n+        return description;\n+    }\n+\n+    public void setDescription(String description) {\n+        this.description = description;\n+    }\n+\n+    public boolean isDeployed() {\n+        return isDeployed;\n+    }\n+\n+    public void setDeployed(boolean deployed) {\n+        isDeployed = deployed;\n+    }\n+\n+    public int getRateLimitCount() {\n+        return rateLimitCount;\n+    }\n+\n+    public void setRateLimitCount(int rateLimitCount) {\n+        this.rateLimitCount = rateLimitCount;\n+    }\n+\n+    public String getRateLimitTimeUnit() {\n+        return rateLimitTimeUnit;\n+    }\n+\n+    public void setRateLimitTimeUnit(String rateLimitTimeUnit) {\n+        this.rateLimitTimeUnit = rateLimitTimeUnit;\n+    }\n+\n+    public List<String> getCustomAttributes() {\n+        return customAttributes;\n+    }\n+\n+    public void setCustomAttributes(List<String> customAttributes) {\n+        this.customAttributes = customAttributes;\n+    }\n+\n+    public boolean isStopOnQuotaReach() {\n+        return stopOnQuotaReach;\n+    }\n+\n+    public void setStopOnQuotaReach(boolean stopOnQuotaReach) {\n+        this.stopOnQuotaReach = stopOnQuotaReach;\n+    }\n+\n+    public String getBillingPlan() {\n+        return billingPlan;\n+    }\n+\n+    public void setBillingPlan(String billingPlan) {\n+        this.billingPlan = billingPlan;\n+    }\n+\n+    public String getType() {\n+        return this.defaultLimit.getType();\n+    }\n+\n+    public void setType(String type) {\n+        this.defaultLimit.setType(type);\n+    }\n+\n+    public String getTimeUnit() {\n+        return this.defaultLimit.getTimeUnit();\n+    }\n+\n+    public void setTimeUnit(String timeUnit) {\n+        this.defaultLimit.setTimeUnit(timeUnit);\n+    }\n+\n+    public int getUnitTime() {\n+        return this.defaultLimit.getUnitTime();\n+    }\n+\n+    public void setUnitTime(int unitTime) {\n+        this.defaultLimit.setUnitTime(unitTime);\n+    }\n+\n+    public int getRequestCount() {\n+        return this.defaultLimit.getRequestCount();\n+    }\n+\n+    public void setRequestCount(int requestCount) {\n+        this.defaultLimit.setRequestCount(requestCount);\n+        ;\n+    }\n+}", "originalCommit": "49905cdaf2edc09fee5be67f1182faafaf3d2bdd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2OTY0MzQ5Mw==", "url": "https://github.com/wso2/product-microgateway/pull/1511#discussion_r569643493", "bodyText": "Already added in the repo", "author": "chashikajw", "createdAt": "2021-02-03T18:22:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjQxODYyNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjQxODkxMQ==", "url": "https://github.com/wso2/product-microgateway/pull/1511#discussion_r562418911", "bodyText": "Formatting issue: Add a space between mgwServerPath and +", "author": "Meruja", "createdAt": "2021-01-22T06:43:08Z", "path": "test/test-integration/src/test/java/org/wso2am/micro/gw/tests/context/MgwServerInstance.java", "diffHunk": "@@ -0,0 +1,146 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2am.micro.gw.tests.context;\n+\n+import com.github.dockerjava.zerodep.shaded.org.apache.hc.core5.http.HttpStatus;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.testcontainers.containers.DockerComposeContainer;\n+import org.wso2am.micro.gw.tests.common.BaseTestCase;\n+import org.wso2am.micro.gw.tests.mockbackend.MockBackendServer;\n+import org.wso2am.micro.gw.tests.util.HttpClientRequest;\n+import org.wso2am.micro.gw.tests.util.HttpResponse;\n+import org.wso2am.micro.gw.tests.util.Utils;\n+\n+import java.io.File;\n+import java.io.IOException;\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.Properties;\n+import java.util.concurrent.TimeUnit;\n+\n+/**\n+ * Mgw server instance class.\n+ */\n+public class MgwServerInstance implements MgwServer {\n+\n+    private static final Logger log = LoggerFactory.getLogger(MgwServerInstance.class);\n+    private DockerComposeContainer environment;\n+\n+\n+    /**\n+     * initialize a docker environment using docker compose.\n+     *\n+     * @throws IOException\n+     * @throws MicroGWTestException\n+     */\n+    public MgwServerInstance() throws IOException, MicroGWTestException {\n+        createTmpMgwSetup();\n+        File targetClassesDir = new File(MgwServerInstance.class.getProtectionDomain().getCodeSource().\n+                getLocation().getPath());\n+        String mgwServerPath = targetClassesDir.getParentFile().toString() + File.separator + \"server-tmp\";\n+\n+        String dockerCompsePath = mgwServerPath+  File.separator + \"docker-compose.yaml\";", "originalCommit": "49905cdaf2edc09fee5be67f1182faafaf3d2bdd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2OTY1NzMzNQ==", "url": "https://github.com/wso2/product-microgateway/pull/1511#discussion_r569657335", "bodyText": "Fixed in 3b6cc67", "author": "chashikajw", "createdAt": "2021-02-03T18:44:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjQxODkxMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjQyMDA4OA==", "url": "https://github.com/wso2/product-microgateway/pull/1511#discussion_r562420088", "bodyText": "Shall we merge these lines 76 and 77?\nFiles.write(output, lines, charset, StandardOpenOption.CREATE,  StandardOpenOption.APPEND);", "author": "Meruja", "createdAt": "2021-01-22T06:46:42Z", "path": "test/test-integration/src/test/java/org/wso2am/micro/gw/tests/mockbackend/MockBackendServer.java", "diffHunk": "@@ -0,0 +1,83 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2am.micro.gw.tests.mockbackend;\n+\n+\n+import org.wso2am.micro.gw.tests.context.MicroGWTestException;\n+import org.wso2am.micro.gw.tests.util.Utils;\n+import java.io.*;\n+import java.nio.charset.Charset;\n+import java.nio.charset.StandardCharsets;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.nio.file.StandardOpenOption;\n+import java.util.Arrays;\n+import java.util.List;\n+\n+/**\n+ * Mock backend server class.\n+ *\n+ */\n+public class MockBackendServer {\n+\n+    /**\n+     * Get Mock backend server module root path.\n+     *\n+     * @param dockerComposePath  path for the mgw setup docker-compose file\n+     *\n+     * @throws IOException\n+     * @throws MicroGWTestException\n+     */\n+    public static void addMockBackendServiceToDockerCompose(String dockerComposePath) throws IOException,\n+            MicroGWTestException {\n+\n+        File targetClassesDir = new File(MockBackendServer.class.getProtectionDomain().getCodeSource().\n+                getLocation().getPath());\n+        String targetDir = targetClassesDir.getParentFile().toString();\n+        String backendService = MockBackendServer.class.getClassLoader()\n+                .getResource(\"backend-service.yaml\").getPath();\n+\n+        // Input files\n+        List<Path> inputs = Arrays.asList(\n+                Paths.get(dockerComposePath),\n+                Paths.get(backendService)\n+        );\n+\n+        // Output file\n+        String tmpDockerCompose = targetDir +  File.separator  + System.currentTimeMillis() + \".yaml\";\n+        File fileTmp = new File(tmpDockerCompose);\n+        fileTmp.createNewFile();\n+        Path output = Paths.get(tmpDockerCompose);\n+\n+\n+        // Charset for read and write\n+        Charset charset = StandardCharsets.UTF_8;\n+\n+        // Join files (lines)\n+        for (Path path : inputs) {\n+            List<String> lines = Files.readAllLines(path, charset);\n+            Files.write(output, lines, charset, StandardOpenOption.CREATE,", "originalCommit": "49905cdaf2edc09fee5be67f1182faafaf3d2bdd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2OTY0NTIzOA==", "url": "https://github.com/wso2/product-microgateway/pull/1511#discussion_r569645238", "bodyText": "I didn't' get it can you explain further?", "author": "chashikajw", "createdAt": "2021-02-03T18:25:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjQyMDA4OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjQyMTI4Mw==", "url": "https://github.com/wso2/product-microgateway/pull/1511#discussion_r562421283", "bodyText": "Shall we import only the necessary classes?", "author": "Meruja", "createdAt": "2021-01-22T06:50:02Z", "path": "test/test-integration/src/test/java/org/wso2am/micro/gw/tests/util/HttpClientRequest.java", "diffHunk": "@@ -0,0 +1,257 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2am.micro.gw.tests.util;\n+\n+\n+import java.io.*;", "originalCommit": "49905cdaf2edc09fee5be67f1182faafaf3d2bdd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2OTY1NzI2NQ==", "url": "https://github.com/wso2/product-microgateway/pull/1511#discussion_r569657265", "bodyText": "Fixed in 3b6cc67", "author": "chashikajw", "createdAt": "2021-02-03T18:44:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjQyMTI4Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjQyMjU5MQ==", "url": "https://github.com/wso2/product-microgateway/pull/1511#discussion_r562422591", "bodyText": "Shall we rephrase is as 'Cannot close the socket with is used to check the server status'?", "author": "Meruja", "createdAt": "2021-01-22T06:54:05Z", "path": "test/test-integration/src/test/java/org/wso2am/micro/gw/tests/util/Utils.java", "diffHunk": "@@ -0,0 +1,347 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2am.micro.gw.tests.util;\n+\n+import io.netty.handler.codec.http.HttpHeaderNames;\n+import org.apache.commons.io.FileUtils;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.testng.Assert;\n+import org.wso2am.micro.gw.tests.context.MicroGWTestException;\n+import java.io.File;\n+import java.io.FileInputStream;\n+import java.io.FileOutputStream;\n+import java.io.IOException;\n+import java.net.InetAddress;\n+import java.net.Socket;\n+import java.util.Base64;\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.zip.ZipEntry;\n+import java.util.zip.ZipInputStream;\n+\n+/**\n+ * Utility class for test integration common functions.\n+ */\n+public class Utils {\n+\n+    private static final Logger log = LoggerFactory.getLogger(Utils.class);\n+\n+    /**\n+     * Wait for port to open until given timeout period.\n+     *\n+     * @param port    The port that needs to be checked\n+     * @param timeout The timeout waiting for the port to open\n+     * @param verbose if verbose is set to true,\n+     * @throws RuntimeException if the port is not opened within the timeout\n+     */\n+    public static void waitForPort(int port, long timeout, boolean verbose, String hostName)\n+            throws RuntimeException {\n+        long startTime = System.currentTimeMillis();\n+        boolean isPortOpen = false;\n+        while (!isPortOpen && (System.currentTimeMillis() - startTime) < timeout) {\n+            Socket socket = null;\n+            try {\n+                InetAddress address = InetAddress.getByName(hostName);\n+                socket = new Socket(address, port);\n+                isPortOpen = socket.isConnected();\n+                if (isPortOpen) {\n+                    if (verbose) {\n+                        log.info(\"Successfully connected to the server on port \" + port);\n+                    }\n+                    return;\n+                }\n+            } catch (IOException e) {\n+                if (verbose) {\n+                    log.info(\"Waiting until server starts on port \" + port);\n+                }\n+                try {\n+                    Thread.sleep(1000);\n+                } catch (InterruptedException ignored) {\n+                }\n+            } finally {\n+                try {\n+                    if ((socket != null) && (socket.isConnected())) {\n+                        socket.close();\n+                    }\n+                } catch (IOException e) {\n+                    log.error(\"Can not close the socket with is used to check the server status \", e);\n+                }\n+            }\n+        }\n+        throw new RuntimeException(\"Port \" + port + \" is not open\");\n+    }\n+\n+    /**\n+     * wait until port is closed within given timeout value in mills.\n+     *\n+     * @param port    - port number\n+     * @param timeout - mat time to wait\n+     */\n+    public static void waitForPortToClosed(int port, int timeout) {\n+        long time = System.currentTimeMillis() + timeout;\n+        boolean portOpen = Utils.isPortOpen(port);\n+        while (portOpen && System.currentTimeMillis() < time) {\n+            // wait until server shutdown is completed\n+            try {\n+                Thread.sleep(1000);\n+            } catch (InterruptedException ignored) {\n+                //ignore\n+            }\n+            portOpen = Utils.isPortOpen(port);\n+        }\n+        if (portOpen) {\n+            throw new RuntimeException(\"Port not closed properly when stopping server\");\n+        }\n+    }\n+\n+    /**\n+     * Check whether given port is in use or not.\n+     *\n+     * @param port - port number\n+     * @throws MicroGWTestException if port is already in use\n+     */\n+    public static void checkPortAvailability(int port) throws MicroGWTestException {\n+\n+        //check whether http port is already occupied\n+        if (isPortOpen(port)) {\n+            throw new MicroGWTestException(\"Unable to start carbon server on port \" +\n+                    (port) + \" : Port already in use\");\n+        }\n+    }\n+\n+    /**\n+     * Check whether the provided port is open.\n+     *\n+     * @param port The port that needs to be checked\n+     * @return true if the <code>port</code> is open & false otherwise\n+     */\n+    public static boolean isPortOpen(int port) {\n+        Socket socket = null;\n+        boolean isPortOpen = false;\n+        try {\n+            InetAddress address = InetAddress.getLocalHost();\n+            socket = new Socket(address, port);\n+            isPortOpen = socket.isConnected();\n+            if (isPortOpen) {\n+                log.info(\"Successfully connected to the server on port \" + port);\n+            }\n+        } catch (IOException e) {\n+            log.info(\"Port \" + port + \" is closed and available for use\");\n+            isPortOpen = false;\n+        } finally {\n+            try {\n+                if ((socket != null) && (socket.isConnected())) {\n+                    socket.close();\n+                }\n+            } catch (IOException e) {\n+                log.error(\"Can not close the socket with is used to check the server status \", e);", "originalCommit": "49905cdaf2edc09fee5be67f1182faafaf3d2bdd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2OTY1NzIyMA==", "url": "https://github.com/wso2/product-microgateway/pull/1511#discussion_r569657220", "bodyText": "Fixed in 3b6cc67", "author": "chashikajw", "createdAt": "2021-02-03T18:44:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjQyMjU5MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2OTEyNTc0OQ==", "url": "https://github.com/wso2/product-microgateway/pull/1511#discussion_r569125749", "bodyText": "Shall we add the Javadoc for return type as well?", "author": "Chamindu36", "createdAt": "2021-02-03T04:36:54Z", "path": "test/test-integration/src/test/java/org/wso2am/micro/gw/tests/common/BaseTestCase.java", "diffHunk": "@@ -0,0 +1,115 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2am.micro.gw.tests.common;\n+\n+\n+import org.json.JSONArray;\n+import org.json.JSONObject;\n+import org.wso2am.micro.gw.tests.common.model.API;\n+import org.wso2am.micro.gw.tests.common.model.ApplicationDTO;\n+import org.wso2am.micro.gw.tests.common.model.SubscribedApiDTO;\n+import org.wso2am.micro.gw.tests.context.MgwServerInstance;\n+import org.wso2am.micro.gw.tests.context.MicroGWTestException;\n+import org.wso2am.micro.gw.tests.util.*;\n+\n+import java.io.IOException;\n+import java.net.MalformedURLException;\n+import java.net.URL;\n+import java.util.Arrays;\n+\n+/**\n+ * Base test class for mgw test cases.\n+ */\n+public class BaseTestCase {\n+\n+    protected MgwServerInstance microGWServer;\n+\n+    /**\n+     * start the mgw docker environment and mock backend.\n+     *\n+     * @throws MicroGWTestException\n+     * @throws IOException\n+     */\n+    public void startMGW() throws MicroGWTestException, IOException, InterruptedException {\n+        microGWServer = new MgwServerInstance();\n+        microGWServer.startMGW();\n+    }\n+\n+    /**\n+     * start the mgw docker environment and mock backend.\n+     *\n+     * @param confPath       external conf.toml file location\n+     *\n+     * @throws MicroGWTestException\n+     * @throws IOException\n+     */\n+    public void startMGW(String confPath) throws MicroGWTestException, IOException, InterruptedException {\n+        microGWServer = new MgwServerInstance(confPath);\n+        microGWServer.startMGW();\n+    }\n+\n+    /**\n+     * stop the mgw docker environment.\n+     */\n+    public void stopMGW() {\n+        microGWServer.stopMGW();\n+\n+    }\n+\n+    public static String getImportAPIServiceURLHttps(String servicePath) throws MalformedURLException {\n+        return new URL(new URL(\"https://localhost:\" + TestConstant.ADAPTER_IMPORT_API_PORT), servicePath)\n+                .toString();\n+    }\n+\n+    public static String getServiceURLHttps(String servicePath) throws MalformedURLException {\n+        return new URL(new URL(\"https://localhost:\" + TestConstant.GATEWAY_LISTENER_HTTPS_PORT), servicePath)\n+                .toString();\n+    }\n+\n+    public static String getMockServiceURLHttp(String servicePath) throws MalformedURLException {\n+        return new URL(new URL(\"http://localhost:\" + TestConstant.MOCK_SERVER_PORT), servicePath).toString();\n+    }\n+\n+    /**\n+     * get a jwt token.\n+     *\n+     * @param api                 api\n+     * @param applicationDTO      application dto\n+     * @param tier                tier\n+     * @param keyType             keytype\n+     * @param validityPeriod      validityPeriod\n+     *\n+     * @throws Exception", "originalCommit": "49905cdaf2edc09fee5be67f1182faafaf3d2bdd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2OTY1NzE3Ng==", "url": "https://github.com/wso2/product-microgateway/pull/1511#discussion_r569657176", "bodyText": "Fixed in 3b6cc67", "author": "chashikajw", "createdAt": "2021-02-03T18:44:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2OTEyNTc0OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2OTEyNjA5NQ==", "url": "https://github.com/wso2/product-microgateway/pull/1511#discussion_r569126095", "bodyText": "Shall we add a new line at the EOF?", "author": "Chamindu36", "createdAt": "2021-02-03T04:37:54Z", "path": "test/test-integration/src/test/java/org/wso2am/micro/gw/tests/common/model/ApplicationDTO.java", "diffHunk": "@@ -0,0 +1,55 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2am.micro.gw.tests.common.model;\n+\n+import java.io.Serializable;\n+\n+/**\n+ * Application model\n+ */\n+public class ApplicationDTO implements Serializable {\n+\n+    private int id;\n+    private String name;\n+    private String tier;\n+\n+    public int getId() {\n+        return id;\n+    }\n+\n+    public void setId(int id) {\n+        this.id = id;\n+    }\n+\n+    public String getName() {\n+        return name;\n+    }\n+\n+    public void setName(String name) {\n+        this.name = name;\n+    }\n+\n+    public String getTier() {\n+        return tier;\n+    }\n+\n+    public void setTier(String tier) {\n+        this.tier = tier;\n+    }\n+}", "originalCommit": "49905cdaf2edc09fee5be67f1182faafaf3d2bdd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2OTEyNjM0MQ==", "url": "https://github.com/wso2/product-microgateway/pull/1511#discussion_r569126341", "bodyText": "And please check the other files in this PR and do the same.", "author": "Chamindu36", "createdAt": "2021-02-03T04:38:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2OTEyNjA5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2OTY1NzE0NA==", "url": "https://github.com/wso2/product-microgateway/pull/1511#discussion_r569657144", "bodyText": "Fixed in 3b6cc67", "author": "chashikajw", "createdAt": "2021-02-03T18:44:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2OTEyNjA5NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2OTEyNjgyMw==", "url": "https://github.com/wso2/product-microgateway/pull/1511#discussion_r569126823", "bodyText": "Shall we remove the extra line here?", "author": "Chamindu36", "createdAt": "2021-02-03T04:40:22Z", "path": "test/test-integration/src/test/java/org/wso2am/micro/gw/tests/mockbackend/MockBackendServer.java", "diffHunk": "@@ -0,0 +1,83 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2am.micro.gw.tests.mockbackend;\n+\n+", "originalCommit": "49905cdaf2edc09fee5be67f1182faafaf3d2bdd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2OTY1NzA4NQ==", "url": "https://github.com/wso2/product-microgateway/pull/1511#discussion_r569657085", "bodyText": "Fixed in 3b6cc67", "author": "chashikajw", "createdAt": "2021-02-03T18:44:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2OTEyNjgyMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2OTEyNzA2OA==", "url": "https://github.com/wso2/product-microgateway/pull/1511#discussion_r569127068", "bodyText": "Shall we remove this wild card import here?", "author": "Chamindu36", "createdAt": "2021-02-03T04:41:17Z", "path": "test/test-integration/src/test/java/org/wso2am/micro/gw/tests/util/HttpPostMultipart.java", "diffHunk": "@@ -0,0 +1,133 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2am.micro.gw.tests.util;\n+\n+import javax.net.ssl.*;\n+import java.io.*;", "originalCommit": "49905cdaf2edc09fee5be67f1182faafaf3d2bdd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2OTY1NzAxOQ==", "url": "https://github.com/wso2/product-microgateway/pull/1511#discussion_r569657019", "bodyText": "Fixed in 3b6cc67", "author": "chashikajw", "createdAt": "2021-02-03T18:43:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2OTEyNzA2OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2OTEyNzM5NA==", "url": "https://github.com/wso2/product-microgateway/pull/1511#discussion_r569127394", "bodyText": "Shall we add the java docs for return type here?", "author": "Chamindu36", "createdAt": "2021-02-03T04:42:33Z", "path": "test/test-integration/src/test/java/org/wso2am/micro/gw/tests/util/HttpsPostMultipart.java", "diffHunk": "@@ -0,0 +1,134 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2am.micro.gw.tests.util;\n+\n+import javax.net.ssl.*;\n+import java.io.*;\n+import java.net.URL;\n+import java.net.URLConnection;\n+import java.util.Iterator;\n+import java.util.Map;\n+import java.util.UUID;\n+\n+import static org.wso2am.micro.gw.tests.util.TestConstant.LINE;\n+\n+/**\n+ * This class can be used to send https post multipart request.\n+ */\n+public class HttpsPostMultipart {\n+    private final String boundary;\n+    private HttpsURLConnection conn;\n+    private OutputStream outputStream;\n+    private PrintWriter writer;\n+\n+    /**\n+     * This constructor initializes a new HTTP POST request with content type\n+     * is set to multipart/form-data\n+     *\n+     * @param requestURL\n+     * @param headers\n+     * @throws IOException\n+     */\n+    public HttpsPostMultipart(String requestURL, Map<String, String> headers) throws IOException {\n+\n+        HttpsClientRequest.setSSlSystemProperties();\n+\n+        boundary = UUID.randomUUID().toString();\n+        URL url = new URL(requestURL);\n+        conn = (HttpsURLConnection) url.openConnection();\n+\n+        conn.setUseCaches(false);\n+        conn.setDoOutput(true);    // indicates POST method\n+        conn.setDoInput(true);\n+        conn.setReadTimeout(30000);\n+        conn.setConnectTimeout(15000);\n+        conn.setDoInput(true);\n+\n+        conn.setAllowUserInteraction(false);\n+        conn.setRequestProperty(\"Content-Type\", \"multipart/form-data; boundary=\" + boundary);\n+        if (headers != null && headers.size() > 0) {\n+            Iterator<String> it = headers.keySet().iterator();\n+            while (it.hasNext()) {\n+                String key = it.next();\n+                String value = headers.get(key);\n+                conn.setRequestProperty(key, value);\n+            }\n+        }\n+        outputStream = conn.getOutputStream();\n+        writer = new PrintWriter(new OutputStreamWriter(outputStream,TestConstant.CHARSET_NAME), true);\n+    }\n+\n+\n+    /**\n+     * Adds a form field to the request\n+     *\n+     * @param name  field name\n+     * @param value field value\n+     */\n+    public void addFormField(String name, String value) {\n+        writer.append(\"--\" + boundary).append(LINE);\n+        writer.append(\"Content-Disposition: form-data; name=\\\"\" + name + \"\\\"\").append(LINE);\n+        writer.append(\"Content-Type: text/plain; charset=\" + TestConstant.CHARSET_NAME).append(LINE);\n+        writer.append(LINE);\n+        writer.append(value).append(LINE);\n+        writer.flush();\n+    }\n+\n+    /**\n+     * Adds a upload file section to the request\n+     *\n+     * @param fieldName\n+     * @param uploadFile\n+     * @throws IOException\n+     */\n+    public void addFilePart(String fieldName, File uploadFile)\n+            throws IOException {\n+        String fileName = uploadFile.getName();\n+        writer.append(\"--\" + boundary).append(LINE);\n+        writer.append(\"Content-Disposition: form-data; name=\\\"\" + fieldName + \"\\\"; filename=\\\"\" + fileName + \"\\\"\").append(LINE);\n+        writer.append(\"Content-Type: \" + URLConnection.guessContentTypeFromName(fileName)).append(LINE);\n+        writer.append(\"Content-Transfer-Encoding: binary\").append(LINE);\n+        writer.append(LINE);\n+        writer.flush();\n+\n+        FileInputStream inputStream = new FileInputStream(uploadFile);\n+        byte[] buffer = new byte[4096];\n+        int bytesRead = -1;\n+        while ((bytesRead = inputStream.read(buffer)) != -1) {\n+            outputStream.write(buffer, 0, bytesRead);\n+        }\n+        outputStream.flush();\n+        inputStream.close();\n+        writer.append(LINE);\n+        writer.flush();\n+    }\n+\n+    /**\n+     * Completes the request and receives response from the server.\n+     *", "originalCommit": "49905cdaf2edc09fee5be67f1182faafaf3d2bdd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2OTY1Njk2Ng==", "url": "https://github.com/wso2/product-microgateway/pull/1511#discussion_r569656966", "bodyText": "Fixed in 3b6cc67", "author": "chashikajw", "createdAt": "2021-02-03T18:43:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2OTEyNzM5NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2OTEyNzU1Nw==", "url": "https://github.com/wso2/product-microgateway/pull/1511#discussion_r569127557", "bodyText": "Shall we remove the wildcard imports here?", "author": "Chamindu36", "createdAt": "2021-02-03T04:43:21Z", "path": "test/test-integration/src/test/java/org/wso2am/micro/gw/tests/util/ZipDir.java", "diffHunk": "@@ -0,0 +1,74 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2am.micro.gw.tests.util;\n+\n+import java.io.*;", "originalCommit": "49905cdaf2edc09fee5be67f1182faafaf3d2bdd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2OTY1NjkxOQ==", "url": "https://github.com/wso2/product-microgateway/pull/1511#discussion_r569656919", "bodyText": "Fixed in 3b6cc67", "author": "chashikajw", "createdAt": "2021-02-03T18:43:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2OTEyNzU1Nw=="}], "type": "inlineReview"}]}