{"pr_number": 4529, "pr_title": "[JENKINS-61004, JENKINS-60299] - Reintroduce Build History description truncation by default, allow managing/disabling the limit via a system property", "pr_createdAt": "2020-02-28T08:11:40Z", "pr_url": "https://github.com/jenkinsci/jenkins/pull/4529", "timeline": [{"oid": "027cae3ff1952b9c527cb6d0d2515851bc9bc448", "url": "https://github.com/jenkinsci/jenkins/commit/027cae3ff1952b9c527cb6d0d2515851bc9bc448", "message": "[JENKINS-61004] - Reintroduce Build History description truncation by default, allow managing/disabling the limit via a system property", "committedDate": "2020-02-28T08:08:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTU2MjE1Mg==", "url": "https://github.com/jenkinsci/jenkins/pull/4529#discussion_r385562152", "bodyText": "personally I would make 0 disable truncation as 0 often means unlimited, why introduce a feature to disable descriptions? has anyone asked for it?", "author": "timja", "createdAt": "2020-02-28T08:24:00Z", "path": "core/src/main/java/hudson/model/Run.java", "diffHunk": "@@ -660,32 +671,43 @@ public final long getStartTimeInMillis() {\n     }\n \n     @Exported\n+    @CheckForNull\n     public String getDescription() {\n         return description;\n     }\n \n \n     /**\n      * Returns the length-limited description.\n+     * The method tries to take the HTML tags into account, but it is a best-effort attempt.\n+     * Also, the method will not work properly if a non-HTML {@link hudson.markup.MarkupFormatter} is used.\n      * @return The length-limited description.\n-     * @deprecated truncated description uses arbitrary and unconfigurable limit of 100 symbols\n+     * @deprecated truncated description based on the {@link #TRUNCATED_DESCRIPTION_LIMIT} setting.\n      */\n     @Deprecated\n-    public @Nonnull String getTruncatedDescription() {\n-        final int maxDescrLength = 100;\n-        if (description == null || description.length() < maxDescrLength) {\n+    public @CheckForNull String getTruncatedDescription() {\n+        if (TRUNCATED_DESCRIPTION_LIMIT < 0) { // disabled\n             return description;\n         }\n+        if (TRUNCATED_DESCRIPTION_LIMIT == 0) { // Someone wants to suppress descriptions, why not?", "originalCommit": "027cae3ff1952b9c527cb6d0d2515851bc9bc448", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTU3MjM3Nw==", "url": "https://github.com/jenkinsci/jenkins/pull/4529#discussion_r385572377", "bodyText": "\"Possible to hide\" in https://issues.jenkins-ci.org/browse/JENKINS-60299", "author": "oleg-nenashev", "createdAt": "2020-02-28T08:49:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTU2MjE1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTU3NDQwMg==", "url": "https://github.com/jenkinsci/jenkins/pull/4529#discussion_r385574402", "bodyText": "That was 2 possible solutions, didn't suggest implementing both \ud83d\ude09", "author": "timja", "createdAt": "2020-02-28T08:54:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTU2MjE1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTU3NDc0Mw==", "url": "https://github.com/jenkinsci/jenkins/pull/4529#discussion_r385574743", "bodyText": "Hi, just wanted to chime in. I'm the one who created JENKINS-60299. For our use-case a possibility to disable the build description in the build history widget would be really nice. Note though that we very much need the build description for each build, just not in the widget itself.\nOff course, I'm just one user so I understand if our specific need cannot be taken into account and implemented as a feature for all users :-)", "author": "Laffs2k5", "createdAt": "2020-02-28T08:55:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTU2MjE1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTU3NTgyOA==", "url": "https://github.com/jenkinsci/jenkins/pull/4529#discussion_r385575828", "bodyText": "\ud83e\udd37\u200d\u2642 fine with me then.", "author": "timja", "createdAt": "2020-02-28T08:57:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTU2MjE1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTgxNTc3OQ==", "url": "https://github.com/jenkinsci/jenkins/pull/4529#discussion_r385815779", "bodyText": "Seems like a reasonable option for people using non-HTML markup formatting, which is horrifically broken by the server-side, pre-transformation truncation.", "author": "daniel-beck", "createdAt": "2020-02-28T17:11:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTU2MjE1Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc5MjEyMQ==", "url": "https://github.com/jenkinsci/jenkins/pull/4529#discussion_r385792121", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private static int TRUNCATED_DESCRIPTION_LIMIT = SystemProperties.getInteger(\"historyWidget.descriptionLimit\", 100);\n          \n          \n            \n                private static /* non-final for Groovy */ int TRUNCATED_DESCRIPTION_LIMIT = SystemProperties.getInteger(\"historyWidget.descriptionLimit\", 100);", "author": "daniel-beck", "createdAt": "2020-02-28T16:26:18Z", "path": "core/src/main/java/hudson/model/Run.java", "diffHunk": "@@ -157,6 +157,13 @@\n      */\n     public static final long QUEUE_ID_UNKNOWN = -1;\n \n+    /**\n+     * Target size limit for truncated {@link #description}s in the Build History Widget.\n+     * Negative values will disable truncation, {@code 0} will enforce empty strings.\n+     * @since TODO\n+     */\n+    private static int TRUNCATED_DESCRIPTION_LIMIT = SystemProperties.getInteger(\"historyWidget.descriptionLimit\", 100);", "originalCommit": "027cae3ff1952b9c527cb6d0d2515851bc9bc448", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc5MzE0OA==", "url": "https://github.com/jenkinsci/jenkins/pull/4529#discussion_r385793148", "bodyText": "The deprecation doesn't really make sense anymore? At least for a while?", "author": "daniel-beck", "createdAt": "2020-02-28T16:28:02Z", "path": "core/src/main/java/hudson/model/Run.java", "diffHunk": "@@ -660,32 +671,43 @@ public final long getStartTimeInMillis() {\n     }\n \n     @Exported\n+    @CheckForNull\n     public String getDescription() {\n         return description;\n     }\n \n \n     /**\n      * Returns the length-limited description.\n+     * The method tries to take the HTML tags into account, but it is a best-effort attempt.\n+     * Also, the method will not work properly if a non-HTML {@link hudson.markup.MarkupFormatter} is used.\n      * @return The length-limited description.\n-     * @deprecated truncated description uses arbitrary and unconfigurable limit of 100 symbols\n+     * @deprecated truncated description based on the {@link #TRUNCATED_DESCRIPTION_LIMIT} setting.", "originalCommit": "027cae3ff1952b9c527cb6d0d2515851bc9bc448", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc5ODQ0Nw==", "url": "https://github.com/jenkinsci/jenkins/pull/4529#discussion_r385798447", "bodyText": "I do not want to revert it for now, will probably act on that in a follow-up PR", "author": "oleg-nenashev", "createdAt": "2020-02-28T16:37:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc5MzE0OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc5Mzg5Mg==", "url": "https://github.com/jenkinsci/jenkins/pull/4529#discussion_r385793892", "bodyText": "How was this ever @Nonnull? \ud83d\ude15", "author": "daniel-beck", "createdAt": "2020-02-28T16:29:22Z", "path": "core/src/main/java/hudson/model/Run.java", "diffHunk": "@@ -660,32 +671,43 @@ public final long getStartTimeInMillis() {\n     }\n \n     @Exported\n+    @CheckForNull\n     public String getDescription() {\n         return description;\n     }\n \n \n     /**\n      * Returns the length-limited description.\n+     * The method tries to take the HTML tags into account, but it is a best-effort attempt.\n+     * Also, the method will not work properly if a non-HTML {@link hudson.markup.MarkupFormatter} is used.\n      * @return The length-limited description.\n-     * @deprecated truncated description uses arbitrary and unconfigurable limit of 100 symbols\n+     * @deprecated truncated description based on the {@link #TRUNCATED_DESCRIPTION_LIMIT} setting.\n      */\n     @Deprecated\n-    public @Nonnull String getTruncatedDescription() {", "originalCommit": "027cae3ff1952b9c527cb6d0d2515851bc9bc448", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc5ODU2OA==", "url": "https://github.com/jenkinsci/jenkins/pull/4529#discussion_r385798568", "bodyText": "\ud83e\udd37\u200d\u2642", "author": "oleg-nenashev", "createdAt": "2020-02-28T16:37:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc5Mzg5Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc5NDUzNQ==", "url": "https://github.com/jenkinsci/jenkins/pull/4529#discussion_r385794535", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * The method tries to take the HTML tags into account, but it is a best-effort attempt.\n          \n          \n            \n                 * The method tries to take HTML tags within the description into account, but it is a best-effort attempt.", "author": "daniel-beck", "createdAt": "2020-02-28T16:30:38Z", "path": "core/src/main/java/hudson/model/Run.java", "diffHunk": "@@ -660,32 +671,43 @@ public final long getStartTimeInMillis() {\n     }\n \n     @Exported\n+    @CheckForNull\n     public String getDescription() {\n         return description;\n     }\n \n \n     /**\n      * Returns the length-limited description.\n+     * The method tries to take the HTML tags into account, but it is a best-effort attempt.", "originalCommit": "027cae3ff1952b9c527cb6d0d2515851bc9bc448", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc5NDY3OA==", "url": "https://github.com/jenkinsci/jenkins/pull/4529#discussion_r385794678", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * Also, the method will not work properly if a non-HTML {@link hudson.markup.MarkupFormatter} is used.\n          \n          \n            \n                 * Also, the method will likely not work properly if a non-HTML {@link hudson.markup.MarkupFormatter} is used.", "author": "daniel-beck", "createdAt": "2020-02-28T16:30:51Z", "path": "core/src/main/java/hudson/model/Run.java", "diffHunk": "@@ -660,32 +671,43 @@ public final long getStartTimeInMillis() {\n     }\n \n     @Exported\n+    @CheckForNull\n     public String getDescription() {\n         return description;\n     }\n \n \n     /**\n      * Returns the length-limited description.\n+     * The method tries to take the HTML tags into account, but it is a best-effort attempt.\n+     * Also, the method will not work properly if a non-HTML {@link hudson.markup.MarkupFormatter} is used.", "originalCommit": "027cae3ff1952b9c527cb6d0d2515851bc9bc448", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc5NjQ4Ng==", "url": "https://github.com/jenkinsci/jenkins/pull/4529#discussion_r385796486", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * Target size limit for truncated {@link #description}s in the Build History Widget.\n          \n          \n            \n                 * Target size limit for truncated {@link #description}s in the Build History Widget.\n          \n          \n            \n                 * This is applied to the raw, unformatted description. Especially complex formatting\n          \n          \n            \n                 * like hyperlinks can result in much less text being shown than this might imply.", "author": "daniel-beck", "createdAt": "2020-02-28T16:34:23Z", "path": "core/src/main/java/hudson/model/Run.java", "diffHunk": "@@ -157,6 +157,13 @@\n      */\n     public static final long QUEUE_ID_UNKNOWN = -1;\n \n+    /**\n+     * Target size limit for truncated {@link #description}s in the Build History Widget.", "originalCommit": "027cae3ff1952b9c527cb6d0d2515851bc9bc448", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "fa993851f2812be90ef8ca00bfcc75a829a4ab36", "url": "https://github.com/jenkinsci/jenkins/commit/fa993851f2812be90ef8ca00bfcc75a829a4ab36", "message": "Apply suggestions from code review by @daniel-beck\n\nCo-Authored-By: Daniel Beck <1831569+daniel-beck@users.noreply.github.com>", "committedDate": "2020-02-28T16:40:53Z", "type": "commit"}]}