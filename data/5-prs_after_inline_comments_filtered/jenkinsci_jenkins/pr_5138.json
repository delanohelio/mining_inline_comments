{"pr_number": 5138, "pr_title": "[JENKINS-64510] Necessary pieces to get TCP agent reconnect working.", "pr_createdAt": "2020-12-22T21:00:07Z", "pr_url": "https://github.com/jenkinsci/jenkins/pull/5138", "timeline": [{"oid": "70fe02c76372f4d6c63e25a17b26500a29cde67c", "url": "https://github.com/jenkinsci/jenkins/commit/70fe02c76372f4d6c63e25a17b26500a29cde67c", "message": "[JENKINS-64510] Necessary pieces to get TCP agent reconnect working.\n\nUse a consistently named cookie. Use a new remoting version that knows how to attach the cookie to the channel.", "committedDate": "2020-12-22T20:47:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzUwNjA1Nw==", "url": "https://github.com/jenkinsci/jenkins/pull/5138#discussion_r547506057", "bodyText": "One of the confusing bits is that this would previously throw a NullPointerException.", "author": "jeffret-b", "createdAt": "2020-12-22T21:02:16Z", "path": "core/src/main/java/jenkins/slaves/DefaultJnlpSlaveReceiver.java", "diffHunk": "@@ -124,7 +124,8 @@ public void afterProperties(@NonNull JnlpConnectionState event) {\n         Channel ch = computer.getChannel();\n         if (ch != null) {\n             String cookie = event.getProperty(JnlpConnectionState.COOKIE_KEY);\n-            if (cookie != null && MessageDigest.isEqual(cookie.getBytes(StandardCharsets.UTF_8), ch.getProperty(COOKIE_NAME).toString().getBytes(StandardCharsets.UTF_8))) {\n+            String channelCookie = (String)ch.getProperty(JnlpConnectionState.COOKIE_KEY);\n+            if (cookie != null && channelCookie != null && MessageDigest.isEqual(cookie.getBytes(StandardCharsets.UTF_8), channelCookie.getBytes(StandardCharsets.UTF_8))) {", "originalCommit": "70fe02c76372f4d6c63e25a17b26500a29cde67c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTEzNTQ2Mg==", "url": "https://github.com/jenkinsci/jenkins/pull/5138#discussion_r549135462", "bodyText": "If it evet reached this check, yes...", "author": "oleg-nenashev", "createdAt": "2020-12-27T16:49:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzUwNjA1Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTQzNTE1Mw==", "url": "https://github.com/jenkinsci/jenkins/pull/5138#discussion_r551435153", "bodyText": "It did reach this check, throwing a NullPointerException, before these fixes. That was confusing but wasn't really the problem. With these changes, it doesn't trip over this in normal, valid situations, but it may still reduce confusion in some invalid reconnection situations.", "author": "jeffret-b", "createdAt": "2021-01-04T16:47:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzUwNjA1Nw=="}], "type": "inlineReview"}, {"oid": "320c910a8127829ba652a45a1152e310de3f4293", "url": "https://github.com/jenkinsci/jenkins/commit/320c910a8127829ba652a45a1152e310de3f4293", "message": "Merge branch 'master' into reconnect", "committedDate": "2021-03-02T08:06:56Z", "type": "commit"}]}