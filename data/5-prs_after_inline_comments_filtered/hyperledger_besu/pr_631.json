{"pr_number": 631, "pr_title": "eth/sync: augment log with peer count information", "pr_createdAt": "2020-04-01T13:51:42Z", "pr_url": "https://github.com/hyperledger/besu/pull/631", "timeline": [{"oid": "ea5a4bdfde2e8edf16544e8b466e3be01bc7ae21", "url": "https://github.com/hyperledger/besu/commit/ea5a4bdfde2e8edf16544e8b466e3be01bc7ae21", "message": "ethereum/fullsync: augment log with peer count information\n\nSigned-off-by: q9f <58883403+q9f@users.noreply.github.com>", "committedDate": "2020-04-01T13:39:33Z", "type": "commit"}, {"oid": "ee5b28779cffb7acaaa79bcaa6e54ab131145675", "url": "https://github.com/hyperledger/besu/commit/ee5b28779cffb7acaaa79bcaa6e54ab131145675", "message": "ethereum/fastsync: augment log with peer count information\n\nSigned-off-by: q9f <58883403+q9f@users.noreply.github.com>", "committedDate": "2020-04-01T13:50:21Z", "type": "commit"}, {"oid": "0bd50239f0f6e4a479c2d7be3804122f736bf9ce", "url": "https://github.com/hyperledger/besu/commit/0bd50239f0f6e4a479c2d7be3804122f736bf9ce", "message": "ethereum/manager: augment log with peer count information\n\nSigned-off-by: q9f <58883403+q9f@users.noreply.github.com>", "committedDate": "2020-04-01T13:51:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg1NDU1Mg==", "url": "https://github.com/hyperledger/besu/pull/631#discussion_r401854552", "bodyText": "My concern with short hashes is then we cannot go to etherscan from the log.  I do this fairly frequently when analyzing short lived forks.\nPerhaps put the peers not at the end and making the other numbers fixed width?", "author": "shemnon", "createdAt": "2020-04-01T19:24:37Z", "path": "ethereum/eth/src/main/java/org/hyperledger/besu/ethereum/eth/sync/BlockPropagationManager.java", "diffHunk": "@@ -341,16 +341,23 @@ private void broadcastBlock(final Block block, final BlockHeader parent) {\n                     block.getHash());\n               } else {\n                 final double timeInS = importTask.getTaskTimeInSec();\n+                final String blockHash = block.getHash().toHexString();\n+                final String shortHash =\n+                    String.format(", "originalCommit": "0bd50239f0f6e4a479c2d7be3804122f736bf9ce", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjA5ODk5Ng==", "url": "https://github.com/hyperledger/besu/pull/631#discussion_r402098996", "bodyText": "What about printing out an additional debug level log info with the full hash? My impression is that the full details are too much on info log level.", "author": "q9f", "createdAt": "2020-04-02T07:15:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg1NDU1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzIzNjA4Mw==", "url": "https://github.com/hyperledger/besu/pull/631#discussion_r403236083", "bodyText": "Debug is very noisy.  Besu has had it at info since we started logging these lines.", "author": "shemnon", "createdAt": "2020-04-03T18:42:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg1NDU1Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg1NTgzMA==", "url": "https://github.com/hyperledger/besu/pull/631#discussion_r401855830", "bodyText": "short hash here is fine.", "author": "shemnon", "createdAt": "2020-04-01T19:26:54Z", "path": "ethereum/eth/src/main/java/org/hyperledger/besu/ethereum/eth/sync/fullsync/FullImportBlockStep.java", "diffHunk": "@@ -30,23 +31,37 @@\n   private static final Logger LOG = LogManager.getLogger();\n   private final ProtocolSchedule<C> protocolSchedule;\n   private final ProtocolContext<C> protocolContext;\n+  private final EthContext ethContext;\n \n   public FullImportBlockStep(\n-      final ProtocolSchedule<C> protocolSchedule, final ProtocolContext<C> protocolContext) {\n+      final ProtocolSchedule<C> protocolSchedule,\n+      final ProtocolContext<C> protocolContext,\n+      final EthContext ethContext) {\n     this.protocolSchedule = protocolSchedule;\n     this.protocolContext = protocolContext;\n+    this.ethContext = ethContext;\n   }\n \n   @Override\n   public void accept(final Block block) {\n     final long blockNumber = block.getHeader().getNumber();\n+    final String blockHash = block.getHash().toHexString();\n+    final String shortHash =\n+        String.format(\n+            \"%s..%s\",\n+            blockHash.substring(0, 6),\n+            blockHash.substring(blockHash.length() - 4, blockHash.length()));\n     final BlockImporter<C> importer =\n         protocolSchedule.getByBlockNumber(blockNumber).getBlockImporter();\n     if (!importer.importBlock(protocolContext, block, HeaderValidationMode.SKIP_DETACHED)) {\n       throw new InvalidBlockException(\"Failed to import block\", blockNumber, block.getHash());\n     }\n     if (blockNumber % 200 == 0) {\n-      LOG.info(\"Import reached block {}\", blockNumber);\n+      LOG.info(\n+          \"Import reached block {} ({}), Peers: {}\",", "originalCommit": "0bd50239f0f6e4a479c2d7be3804122f736bf9ce", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "dd51c40c538b3bea06f48ccca1395ca259f71635", "url": "https://github.com/hyperledger/besu/commit/dd51c40c538b3bea06f48ccca1395ca259f71635", "message": "ethereum/manager: print full block hash in debug log information\n\nSigned-off-by: q9f <58883403+q9f@users.noreply.github.com>", "committedDate": "2020-04-02T13:45:23Z", "type": "commit"}, {"oid": "3315af76a124bde6044cb875644906b859e88e0b", "url": "https://github.com/hyperledger/besu/commit/3315af76a124bde6044cb875644906b859e88e0b", "message": "ethereum/*sync: fix tests without passing ethContext\n\nSigned-off-by: q9f <58883403+q9f@users.noreply.github.com>", "committedDate": "2020-04-02T13:46:32Z", "type": "commit"}, {"oid": "f4aab45b13391bba5464587518b38db77e1f72af", "url": "https://github.com/hyperledger/besu/commit/f4aab45b13391bba5464587518b38db77e1f72af", "message": "Merge branch 'master' into q9-logger-peers", "committedDate": "2020-04-02T13:47:34Z", "type": "commit"}, {"oid": "ea2da1ed999e3aedc92a07897e8ce372ae4a0f1f", "url": "https://github.com/hyperledger/besu/commit/ea2da1ed999e3aedc92a07897e8ce372ae4a0f1f", "message": "Merge branch 'master' into q9-logger-peers", "committedDate": "2020-04-02T15:35:26Z", "type": "commit"}, {"oid": "2e29cb7b26e8db3f8be1132d0c74c4ca5b6a7ac5", "url": "https://github.com/hyperledger/besu/commit/2e29cb7b26e8db3f8be1132d0c74c4ca5b6a7ac5", "message": "Merge branch 'master' into q9-logger-peers", "committedDate": "2020-04-04T06:35:29Z", "type": "commit"}, {"oid": "adc3700937e2e5029162e5587f44aecc7c538de4", "url": "https://github.com/hyperledger/besu/commit/adc3700937e2e5029162e5587f44aecc7c538de4", "message": "ethereum/sync: restore full block hash in info log\n\nSigned-off-by: /raw PONG _GHMoaCXLT <58883403+q9f@users.noreply.github.com>", "committedDate": "2020-04-04T09:36:19Z", "type": "commit"}, {"oid": "4d9bdae59e0fae673ec229146e5eb2e2a9299940", "url": "https://github.com/hyperledger/besu/commit/4d9bdae59e0fae673ec229146e5eb2e2a9299940", "message": "Merge branch 'master' into q9-logger-peers", "committedDate": "2020-04-06T08:19:00Z", "type": "commit"}, {"oid": "ffd80965078f952f67259be011ff8e3dd9cfd497", "url": "https://github.com/hyperledger/besu/commit/ffd80965078f952f67259be011ff8e3dd9cfd497", "message": "Merge branch 'master' into q9-logger-peers", "committedDate": "2020-04-08T11:15:21Z", "type": "commit"}]}