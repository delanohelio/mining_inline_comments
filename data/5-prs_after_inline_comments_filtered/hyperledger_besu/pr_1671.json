{"pr_number": 1671, "pr_title": "Catch bad IBFT2 round change msgs", "pr_createdAt": "2020-12-07T04:20:26Z", "pr_url": "https://github.com/hyperledger/besu/pull/1671", "timeline": [{"oid": "9c2c8dd7993b78ad75ed9af57ecf9ad78862337c", "url": "https://github.com/hyperledger/besu/commit/9c2c8dd7993b78ad75ed9af57ecf9ad78862337c", "message": "Catch bad IBFT2 round change msgs\n\nWhen validating a RoundChange message, its important that not only\nare there sufficient Prepare msgs in the PreparedCertificate, but\nalso that each are from a different validator (i.e. cannot simply\ncount the number msgs, but must count distinct authors).\n\nSigned-off-by: Trent Mohay <trent.mohay@consensys.net>", "committedDate": "2020-12-07T04:17:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzIyMzAxMA==", "url": "https://github.com/hyperledger/besu/pull/1671#discussion_r537223010", "bodyText": "Do all the prepare authors also need to be unique? Or is it enough the we have minimumPrepareMessages. I guess I'm wondering if need a hasDuplicateAuthors check like in the RoundChangeCertificateValidator.", "author": "jframe", "createdAt": "2020-12-07T04:28:40Z", "path": "consensus/ibft/src/main/java/org/hyperledger/besu/consensus/ibft/validation/RoundChangePayloadValidator.java", "diffHunk": "@@ -96,10 +96,11 @@ private boolean validateConsistencyOfPrepareCertificateMessages(\n       return false;\n     }\n \n-    if (certificate.getPreparePayloads().size() < minimumPrepareMessages) {\n+    if (certificate.getPreparePayloads().stream().map(SignedData::getAuthor).distinct().count()", "originalCommit": "9c2c8dd7993b78ad75ed9af57ecf9ad78862337c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "489d5139763ba7621e843c0c44a904d56aaf0cfc", "url": "https://github.com/hyperledger/besu/commit/489d5139763ba7621e843c0c44a904d56aaf0cfc", "message": "updated post review\n\nSigned-off-by: Trent Mohay <trent.mohay@consensys.net>", "committedDate": "2020-12-07T23:25:19Z", "type": "commit"}, {"oid": "807fc716ef8eecff8faf67d1ffe2ebd0e8022785", "url": "https://github.com/hyperledger/besu/commit/807fc716ef8eecff8faf67d1ffe2ebd0e8022785", "message": "Merge remote-tracking branch 'upstream/master' into ibft2_fix\n\nSigned-off-by: Trent Mohay <trent.mohay@consensys.net>", "committedDate": "2020-12-07T23:26:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTY0ODAwNQ==", "url": "https://github.com/hyperledger/besu/pull/1671#discussion_r551648005", "bodyText": "can return early with true if preparePayloads list is empty?", "author": "usmansaleem", "createdAt": "2021-01-05T00:27:11Z", "path": "consensus/ibft/src/main/java/org/hyperledger/besu/consensus/ibft/validation/RoundChangePayloadValidator.java", "diffHunk": "@@ -113,6 +117,18 @@ private boolean validateConsistencyOfPrepareCertificateMessages(\n     return true;\n   }\n \n+  private boolean hasDuplicateAuthors(\n+      final Collection<SignedData<PreparePayload>> preparePayloads) {\n+    final long distinctAuthorCount =", "originalCommit": "807fc716ef8eecff8faf67d1ffe2ebd0e8022785", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTY1MDQ0OA==", "url": "https://github.com/hyperledger/besu/pull/1671#discussion_r551650448", "bodyText": "Probably could return early, however there's probably not much of a performance gain, and adds lines of code which would then need to be tested, so would rather not ... but can be convinced if there's significant benefits.", "author": "rain-on", "createdAt": "2021-01-05T00:36:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTY0ODAwNQ=="}], "type": "inlineReview"}, {"oid": "b08742dccde65c5b6c7da7a1fb1589111e571299", "url": "https://github.com/hyperledger/besu/commit/b08742dccde65c5b6c7da7a1fb1589111e571299", "message": "Merge remote-tracking branch 'upstream/master' into ibft2_fix\n\nSigned-off-by: Trent Mohay <trent.mohay@consensys.net>", "committedDate": "2021-01-05T00:34:23Z", "type": "commit"}, {"oid": "01f0237252b0bbcf01177329c160c2fe932f30cd", "url": "https://github.com/hyperledger/besu/commit/01f0237252b0bbcf01177329c160c2fe932f30cd", "message": "move duplicate author check after size\n\nSigned-off-by: Trent Mohay <trent.mohay@consensys.net>", "committedDate": "2021-01-05T00:37:43Z", "type": "commit"}, {"oid": "ba1164bc0e1d0a8ece147569c8eb8d4d7a38c336", "url": "https://github.com/hyperledger/besu/commit/ba1164bc0e1d0a8ece147569c8eb8d4d7a38c336", "message": "Merge branch 'master' into ibft2_fix", "committedDate": "2021-01-05T01:29:56Z", "type": "commit"}]}