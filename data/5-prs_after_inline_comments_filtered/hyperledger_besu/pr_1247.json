{"pr_number": 1247, "pr_title": "add dns support", "pr_createdAt": "2020-07-22T15:50:08Z", "pr_url": "https://github.com/hyperledger/besu/pull/1247", "timeline": [{"oid": "c8f8832cbc0343eabe6d6a52285a04335b14265d", "url": "https://github.com/hyperledger/besu/commit/c8f8832cbc0343eabe6d6a52285a04335b14265d", "message": "add dns support\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>", "committedDate": "2020-07-22T15:41:04Z", "type": "commit"}, {"oid": "f39f52828805c619e079c906f5a88e01ba91d91c", "url": "https://github.com/hyperledger/besu/commit/f39f52828805c619e079c906f5a88e01ba91d91c", "message": "update error message\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>", "committedDate": "2020-07-22T16:03:59Z", "type": "commit"}, {"oid": "f943765fa3edd6ef42c55851420913553a90444d", "url": "https://github.com/hyperledger/besu/commit/f943765fa3edd6ef42c55851420913553a90444d", "message": "fix tests\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>", "committedDate": "2020-07-22T16:24:03Z", "type": "commit"}, {"oid": "ffbff03ce0a09a0b73a9f1310050609e53c83299", "url": "https://github.com/hyperledger/besu/commit/ffbff03ce0a09a0b73a9f1310050609e53c83299", "message": "clean code\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>", "committedDate": "2020-08-17T16:31:52Z", "type": "commit"}, {"oid": "1adca545321f483d89333bd80af9800286e0a59e", "url": "https://github.com/hyperledger/besu/commit/1adca545321f483d89333bd80af9800286e0a59e", "message": "update hostname detection\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>", "committedDate": "2020-08-17T16:36:00Z", "type": "commit"}, {"oid": "1adca545321f483d89333bd80af9800286e0a59e", "url": "https://github.com/hyperledger/besu/commit/1adca545321f483d89333bd80af9800286e0a59e", "message": "update hostname detection\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>", "committedDate": "2020-08-17T16:36:00Z", "type": "forcePushed"}, {"oid": "634e7e95962a7d9f9a41622199f94fa4082975fb", "url": "https://github.com/hyperledger/besu/commit/634e7e95962a7d9f9a41622199f94fa4082975fb", "message": "spotlessApply\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>", "committedDate": "2020-08-19T20:27:00Z", "type": "commit"}, {"oid": "ddbaa0a820867db7cac1079a1fc9c8f378063cff", "url": "https://github.com/hyperledger/besu/commit/ddbaa0a820867db7cac1079a1fc9c8f378063cff", "message": "Merge branch 'upstream/master' into add-dns-support\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>", "committedDate": "2020-08-20T15:47:53Z", "type": "commit"}, {"oid": "d60de83220ad807a6bbab3d54c45464854b350e6", "url": "https://github.com/hyperledger/besu/commit/d60de83220ad807a6bbab3d54c45464854b350e6", "message": "add tests\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>", "committedDate": "2020-08-21T08:26:37Z", "type": "commit"}, {"oid": "3910077a081d59b9d84c6f66c0c1480bc1c23ebf", "url": "https://github.com/hyperledger/besu/commit/3910077a081d59b9d84c6f66c0c1480bc1c23ebf", "message": "update CHANGELOG.md\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>", "committedDate": "2020-08-21T08:44:04Z", "type": "commit"}, {"oid": "0434f6061e464e6260d0e08a66119749cb8f0524", "url": "https://github.com/hyperledger/besu/commit/0434f6061e464e6260d0e08a66119749cb8f0524", "message": "Merge branch 'master' into add-dns-support", "committedDate": "2020-08-21T08:44:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTM0NTQ0Nw==", "url": "https://github.com/hyperledger/besu/pull/1247#discussion_r475345447", "bodyText": "Is there a typo in this test name? (Dnd instead of Dns)", "author": "CjHare", "createdAt": "2020-08-24T05:08:35Z", "path": "besu/src/test/java/org/hyperledger/besu/util/LocalPermissioningConfigurationValidatorTest.java", "diffHunk": "@@ -123,4 +136,89 @@ public void nodeAllowlistCheckShouldIgnoreDiscoveryPortParam() throws Exception\n           \"Exception not expected. Validation of nodes in allowlist should ignore the optional discovery port param.\");\n     }\n   }\n+\n+  @Test\n+  public void nodeAllowlistCheckShouldWorkWithHostnameIfDndEnabled() throws Exception {", "originalCommit": "0434f6061e464e6260d0e08a66119749cb8f0524", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQwOTA1NA==", "url": "https://github.com/hyperledger/besu/pull/1247#discussion_r476409054", "bodyText": "Good catch . Changed", "author": "matkt", "createdAt": "2020-08-25T12:28:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTM0NTQ0Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTM0ODA2Mw==", "url": "https://github.com/hyperledger/besu/pull/1247#discussion_r475348063", "bodyText": "nit; these local variables could be have more succinct  names (as we know they are list of strings from typing).\nMaybe something like localPermittedNodes and localPermittedEnodeUrls?", "author": "CjHare", "createdAt": "2020-08-24T05:18:41Z", "path": "acceptance-tests/dsl/src/main/java/org/hyperledger/besu/tests/acceptance/dsl/node/configuration/permissioning/PermissionedNodeBuilder.java", "diffHunk": "@@ -209,12 +210,15 @@ private LocalPermissioningConfiguration localConfigPermissioningConfiguration()\n         localConfigNodesPermissioningFile = createTemporaryPermissionsFile();\n       }\n \n-      List<String> nodesAsListOfStrings =\n+      final List<String> nodesAsListOfStrings =", "originalCommit": "0434f6061e464e6260d0e08a66119749cb8f0524", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQwOTQ5Ng==", "url": "https://github.com/hyperledger/besu/pull/1247#discussion_r476409496", "bodyText": "it's changed \ud83d\udc4d", "author": "matkt", "createdAt": "2020-08-25T12:28:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTM0ODA2Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTM0ODg5OA==", "url": "https://github.com/hyperledger/besu/pull/1247#discussion_r475348898", "bodyText": "nit; isTrue() and isFalse() can be nicer to read then isEqualTo(true) and isEqualTo(false)", "author": "CjHare", "createdAt": "2020-08-24T05:22:14Z", "path": "besu/src/test/java/org/hyperledger/besu/cli/BesuCommandTest.java", "diffHunk": "@@ -1347,6 +1347,33 @@ public void ethStatsContactOptionCannotBeUsedWithoutEthStatsServerProvided() {\n             \"The `--Xethstats-contact` requires ethstats server URL to be provided. Either remove --Xethstats-contact or provide an url (via --Xethstats=nodename:secret@host:port)\");\n   }\n \n+  @Test\n+  public void dnsEnabledOptionIsParsedCorrectly() {\n+    TestBesuCommand besuCommand = parseCommand(\"--Xdns-enabled\", \"true\");\n+\n+    assertThat(besuCommand.getEnodeDnsConfiguration().dnsEnabled()).isEqualTo(true);", "originalCommit": "0434f6061e464e6260d0e08a66119749cb8f0524", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQwOTYxMw==", "url": "https://github.com/hyperledger/besu/pull/1247#discussion_r476409613", "bodyText": "Done", "author": "matkt", "createdAt": "2020-08-25T12:29:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTM0ODg5OA=="}], "type": "inlineReview"}, {"oid": "b250ae8a9c124a64a61ed1be45e468c6383a6bbc", "url": "https://github.com/hyperledger/besu/commit/b250ae8a9c124a64a61ed1be45e468c6383a6bbc", "message": "fix review issues and add acceptance tests\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>", "committedDate": "2020-08-25T12:24:55Z", "type": "commit"}, {"oid": "ae203e682cd5b4c4e3f2ce4d0d5c3151e91be544", "url": "https://github.com/hyperledger/besu/commit/ae203e682cd5b4c4e3f2ce4d0d5c3151e91be544", "message": "Merge branch 'master' into add-dns-support", "committedDate": "2020-08-25T12:33:29Z", "type": "commit"}, {"oid": "73a087fa942ea3f8acb336c967db0e28a2081866", "url": "https://github.com/hyperledger/besu/commit/73a087fa942ea3f8acb336c967db0e28a2081866", "message": "Merge branch 'master' into add-dns-support", "committedDate": "2020-08-25T13:54:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ5NzAyMA==", "url": "https://github.com/hyperledger/besu/pull/1247#discussion_r476497020", "bodyText": "Should this be camelCased?  bootNodes?  It was before and other places in the edited code retain the camel casing.  Whatever it chosen it should be consistent.", "author": "shemnon", "createdAt": "2020-08-25T14:33:28Z", "path": "besu/src/main/java/org/hyperledger/besu/cli/BesuCommand.java", "diffHunk": "@@ -310,20 +312,7 @@\n               + \"Default is a predefined list.\",\n       split = \",\",\n       arity = \"0..*\")\n-  void setBootnodes(final List<String> values) {\n-    try {\n-      bootNodes =\n-          values.stream()\n-              .filter(value -> !value.isEmpty())\n-              .map(EnodeURL::fromString)\n-              .collect(Collectors.toList());\n-      DiscoveryConfiguration.assertValidBootnodes(bootNodes);\n-    } catch (final IllegalArgumentException e) {\n-      throw new ParameterException(commandLine, e.getMessage());\n-    }\n-  }\n-\n-  private List<EnodeURL> bootNodes = null;\n+  private final List<String> bootnodes = null;", "originalCommit": "73a087fa942ea3f8acb336c967db0e28a2081866", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjU1MjY1Nw==", "url": "https://github.com/hyperledger/besu/pull/1247#discussion_r476552657", "bodyText": "Done", "author": "matkt", "createdAt": "2020-08-25T15:48:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ5NzAyMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjUwMDczOQ==", "url": "https://github.com/hyperledger/besu/pull/1247#discussion_r476500739", "bodyText": "Is doing a DNS lookup every time the design intent?  If not perhaps ip should be a supplier and this logic gets put in a Suppliers.memoize call?  If it is the design intent it's work a comment so a later refactoring doesn't undo it.", "author": "shemnon", "createdAt": "2020-08-25T14:38:18Z", "path": "ethereum/p2p/src/main/java/org/hyperledger/besu/ethereum/p2p/peers/EnodeURL.java", "diffHunk": "@@ -181,18 +195,33 @@ private OptionalInt getDiscPortQueryParam() {\n   }\n \n   public static URI asURI(final String url) {\n-    return fromString(url).toURI();\n+    return asURI(url, EnodeDnsConfiguration.dnsDisabled());\n+  }\n+\n+  public static URI asURI(final String url, final EnodeDnsConfiguration enodeDnsConfiguration) {\n+    return fromString(url, enodeDnsConfiguration).toURI();\n   }\n \n   public Bytes getNodeId() {\n     return nodeId;\n   }\n \n   public String getIpAsString() {\n-    return ip.getHostAddress();\n+    return getIp().getHostAddress();\n   }\n \n   public InetAddress getIp() {\n+    this.ip =", "originalCommit": "73a087fa942ea3f8acb336c967db0e28a2081866", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjUxNTMxMw==", "url": "https://github.com/hyperledger/besu/pull/1247#discussion_r476515313", "bodyText": "No it's a voluntary choice to DNS lookup every time. Because a cache could give a bad IP before it is invalidated again. If the \"dns-update-enabled\" flag is false it will do it only once.\nwe could add a cache but I'm afraid that this will prevent nodes from communicating each other while waiting for the next cache update", "author": "matkt", "createdAt": "2020-08-25T14:57:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjUwMDczOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjU1MjUxNA==", "url": "https://github.com/hyperledger/besu/pull/1247#discussion_r476552514", "bodyText": "I just added a comment \ud83d\udc4d", "author": "matkt", "createdAt": "2020-08-25T15:48:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjUwMDczOQ=="}], "type": "inlineReview"}, {"oid": "abf0db52b2b97f236d6570a989c59023d8c2aeaa", "url": "https://github.com/hyperledger/besu/commit/abf0db52b2b97f236d6570a989c59023d8c2aeaa", "message": "fix review issues\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>", "committedDate": "2020-08-25T15:46:05Z", "type": "commit"}, {"oid": "6e4f8c74004750f63e5c021830030f39a352d69d", "url": "https://github.com/hyperledger/besu/commit/6e4f8c74004750f63e5c021830030f39a352d69d", "message": "Merge remote-tracking branch 'origin/add-dns-support' into add-dns-support\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>", "committedDate": "2020-08-25T15:47:50Z", "type": "commit"}, {"oid": "6e4f8c74004750f63e5c021830030f39a352d69d", "url": "https://github.com/hyperledger/besu/commit/6e4f8c74004750f63e5c021830030f39a352d69d", "message": "Merge remote-tracking branch 'origin/add-dns-support' into add-dns-support\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>", "committedDate": "2020-08-25T15:47:50Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjU2OTY2NA==", "url": "https://github.com/hyperledger/besu/pull/1247#discussion_r476569664", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n               * <p>If \"dns\" and \"dns-update\" are enabled -> DNS lookup every time to have the IP up to date and\n          \n          \n            \n               * <p>If \"dns\" and \"dns-update\" are enabled -&gt; DNS lookup every time to have the IP up to date and", "author": "shemnon", "createdAt": "2020-08-25T16:13:31Z", "path": "ethereum/p2p/src/main/java/org/hyperledger/besu/ethereum/p2p/peers/EnodeURL.java", "diffHunk": "@@ -181,18 +195,44 @@ private OptionalInt getDiscPortQueryParam() {\n   }\n \n   public static URI asURI(final String url) {\n-    return fromString(url).toURI();\n+    return asURI(url, EnodeDnsConfiguration.dnsDisabled());\n+  }\n+\n+  public static URI asURI(final String url, final EnodeDnsConfiguration enodeDnsConfiguration) {\n+    return fromString(url, enodeDnsConfiguration).toURI();\n   }\n \n   public Bytes getNodeId() {\n     return nodeId;\n   }\n \n   public String getIpAsString() {\n-    return ip.getHostAddress();\n+    return getIp().getHostAddress();\n   }\n \n+  /**\n+   * Get IP of the EnodeURL\n+   *\n+   * <p>If \"dns\" and \"dns-update\" are enabled -> DNS lookup every time to have the IP up to date and", "originalCommit": "6e4f8c74004750f63e5c021830030f39a352d69d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjU3MDE3NA==", "url": "https://github.com/hyperledger/besu/pull/1247#discussion_r476570174", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n               * <p>If the \"dns\" is enabled but \"dns-update\" is disabled -> IP is retrieved only one time and\n          \n          \n            \n               * <p>If the \"dns\" is enabled but \"dns-update\" is disabled -&gt; IP is retrieved only one time and", "author": "shemnon", "createdAt": "2020-08-25T16:14:15Z", "path": "ethereum/p2p/src/main/java/org/hyperledger/besu/ethereum/p2p/peers/EnodeURL.java", "diffHunk": "@@ -181,18 +195,44 @@ private OptionalInt getDiscPortQueryParam() {\n   }\n \n   public static URI asURI(final String url) {\n-    return fromString(url).toURI();\n+    return asURI(url, EnodeDnsConfiguration.dnsDisabled());\n+  }\n+\n+  public static URI asURI(final String url, final EnodeDnsConfiguration enodeDnsConfiguration) {\n+    return fromString(url, enodeDnsConfiguration).toURI();\n   }\n \n   public Bytes getNodeId() {\n     return nodeId;\n   }\n \n   public String getIpAsString() {\n-    return ip.getHostAddress();\n+    return getIp().getHostAddress();\n   }\n \n+  /**\n+   * Get IP of the EnodeURL\n+   *\n+   * <p>If \"dns\" and \"dns-update\" are enabled -> DNS lookup every time to have the IP up to date and\n+   * not to rely on an invalid cache\n+   *\n+   * <p>If the \"dns\" is enabled but \"dns-update\" is disabled -> IP is retrieved only one time and", "originalCommit": "6e4f8c74004750f63e5c021830030f39a352d69d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "d769a4c20a530c91996e3e807edba97d169da3a9", "url": "https://github.com/hyperledger/besu/commit/d769a4c20a530c91996e3e807edba97d169da3a9", "message": "fix javadoc\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>", "committedDate": "2020-08-25T16:55:54Z", "type": "commit"}, {"oid": "8768934e3b193991f9c224e89640ef8472e6df9f", "url": "https://github.com/hyperledger/besu/commit/8768934e3b193991f9c224e89640ef8472e6df9f", "message": "Merge branch 'master' into add-dns-support", "committedDate": "2020-08-25T16:57:19Z", "type": "commit"}]}