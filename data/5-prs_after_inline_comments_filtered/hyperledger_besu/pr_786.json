{"pr_number": 786, "pr_title": "EvmTool - A CLI for ad hoc performance and fuzz testing", "pr_createdAt": "2020-04-26T04:04:01Z", "pr_url": "https://github.com/hyperledger/besu/pull/786", "timeline": [{"oid": "460f269288fdb4a3bfdb7bf333b9f2e269f645e1", "url": "https://github.com/hyperledger/besu/commit/460f269288fdb4a3bfdb7bf333b9f2e269f645e1", "message": "EvmTool - A CLI for ad hoc performance and fuzz testing\n\nA standalone CLI that performs EVM execution with provided genesis\nfiles and raw EVM bytecodes.\n\nSigned-off-by: Danno Ferrin <danno.ferrin@gmail.com>", "committedDate": "2020-04-26T04:03:23Z", "type": "commit"}, {"oid": "b80401e04fb382313dc23c513f63fb26323b82ce", "url": "https://github.com/hyperledger/besu/commit/b80401e04fb382313dc23c513f63fb26323b82ce", "message": "spotless\n\nSigned-off-by: Danno Ferrin <danno.ferrin@gmail.com>", "committedDate": "2020-04-27T16:10:45Z", "type": "commit"}, {"oid": "b80401e04fb382313dc23c513f63fb26323b82ce", "url": "https://github.com/hyperledger/besu/commit/b80401e04fb382313dc23c513f63fb26323b82ce", "message": "spotless\n\nSigned-off-by: Danno Ferrin <danno.ferrin@gmail.com>", "committedDate": "2020-04-27T16:10:45Z", "type": "forcePushed"}, {"oid": "fd6ce79326ca053e96554c6cb6ef34b442d3d92b", "url": "https://github.com/hyperledger/besu/commit/fd6ce79326ca053e96554c6cb6ef34b442d3d92b", "message": "fix spdx header check to not look at generated sources.\n\nSigned-off-by: Danno Ferrin <danno.ferrin@gmail.com>", "committedDate": "2020-04-27T18:42:52Z", "type": "commit"}, {"oid": "ac69eb0cdf3dcf449ca751fa28d1450ccf96c635", "url": "https://github.com/hyperledger/besu/commit/ac69eb0cdf3dcf449ca751fa28d1450ccf96c635", "message": "update gitignore\n\nSigned-off-by: Danno Ferrin <danno.ferrin@gmail.com>", "committedDate": "2020-04-27T18:45:51Z", "type": "commit"}, {"oid": "fededec64101861ef823cb3530e651685e3eb35f", "url": "https://github.com/hyperledger/besu/commit/fededec64101861ef823cb3530e651685e3eb35f", "message": "spotless\n\nSigned-off-by: Danno Ferrin <danno.ferrin@gmail.com>", "committedDate": "2020-04-27T18:57:57Z", "type": "commit"}, {"oid": "fededec64101861ef823cb3530e651685e3eb35f", "url": "https://github.com/hyperledger/besu/commit/fededec64101861ef823cb3530e651685e3eb35f", "message": "spotless\n\nSigned-off-by: Danno Ferrin <danno.ferrin@gmail.com>", "committedDate": "2020-04-27T18:57:57Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjczNDI4MQ==", "url": "https://github.com/hyperledger/besu/pull/786#discussion_r416734281", "bodyText": "Maybe we need to change pantheon by Besu here", "author": "matkt", "createdAt": "2020-04-28T16:01:15Z", "path": "ethereum/evmtool/src/main/java/org/hyperledger/besu/evmtool/EvmToolCommand.java", "diffHunk": "@@ -0,0 +1,290 @@\n+/*\n+ * Copyright ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ *\n+ * SPDX-License-Identifier: Apache-2.0\n+ *\n+ */\n+package org.hyperledger.besu.evmtool;\n+\n+import org.hyperledger.besu.cli.config.NetworkName;\n+import org.hyperledger.besu.ethereum.core.Account;\n+import org.hyperledger.besu.ethereum.core.Address;\n+import org.hyperledger.besu.ethereum.core.BlockHeader;\n+import org.hyperledger.besu.ethereum.core.BlockHeaderBuilder;\n+import org.hyperledger.besu.ethereum.core.Difficulty;\n+import org.hyperledger.besu.ethereum.core.Gas;\n+import org.hyperledger.besu.ethereum.core.Hash;\n+import org.hyperledger.besu.ethereum.core.LogsBloomFilter;\n+import org.hyperledger.besu.ethereum.core.Wei;\n+import org.hyperledger.besu.ethereum.mainnet.MainnetBlockHeaderFunctions;\n+import org.hyperledger.besu.ethereum.vm.BlockHashLookup;\n+import org.hyperledger.besu.ethereum.vm.Code;\n+import org.hyperledger.besu.ethereum.vm.EVM;\n+import org.hyperledger.besu.ethereum.vm.ExceptionalHaltReason;\n+import org.hyperledger.besu.ethereum.vm.MessageFrame;\n+import org.hyperledger.besu.ethereum.vm.ehalt.ExceptionalHaltException;\n+\n+import java.io.File;\n+import java.io.IOException;\n+import java.nio.charset.StandardCharsets;\n+import java.time.Instant;\n+import java.util.ArrayDeque;\n+import java.util.List;\n+\n+import com.google.common.base.Stopwatch;\n+import io.vertx.core.json.JsonArray;\n+import io.vertx.core.json.JsonObject;\n+import org.apache.logging.log4j.Level;\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+import org.apache.logging.log4j.core.config.Configurator;\n+import org.apache.tuweni.bytes.Bytes;\n+import org.apache.tuweni.units.bigints.UInt256;\n+import picocli.CommandLine;\n+import picocli.CommandLine.Command;\n+import picocli.CommandLine.Option;\n+\n+@Command(\n+    description = \"This command evaluates EVM transactions.\",\n+    abbreviateSynopsis = true,\n+    name = \"evm\",\n+    mixinStandardHelpOptions = true,\n+    sortOptions = false,\n+    header = \"Usage:\",\n+    synopsisHeading = \"%n\",\n+    descriptionHeading = \"%nDescription:%n%n\",\n+    optionListHeading = \"%nOptions:%n\",\n+    footerHeading = \"%n\",\n+    footer = \"Pantheon is licensed under the Apache License 2.0\")", "originalCommit": "fededec64101861ef823cb3530e651685e3eb35f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjc0MjQ0Ng==", "url": "https://github.com/hyperledger/besu/pull/786#discussion_r416742446", "bodyText": "fixed", "author": "shemnon", "createdAt": "2020-04-28T16:12:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjczNDI4MQ=="}], "type": "inlineReview"}, {"oid": "ab845f80b12e07b86e22ac371186f70763b50f5c", "url": "https://github.com/hyperledger/besu/commit/ab845f80b12e07b86e22ac371186f70763b50f5c", "message": "Merge branch 'master' of github.com:hyperledger/besu into evmtool\n\nSigned-off-by: Danno Ferrin <danno.ferrin@gmail.com>", "committedDate": "2020-04-28T16:04:18Z", "type": "commit"}, {"oid": "bcfcc2830dd1d168b5d49601ed281a6f10f4c7b9", "url": "https://github.com/hyperledger/besu/commit/bcfcc2830dd1d168b5d49601ed281a6f10f4c7b9", "message": "rename some old pantheon references.\n\nSigned-off-by: Danno Ferrin <danno.ferrin@gmail.com>", "committedDate": "2020-04-28T16:11:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzQwMDk0Mg==", "url": "https://github.com/hyperledger/besu/pull/786#discussion_r417400942", "bodyText": "Why do we need a separate main class ? I thought it was a classical subcommand.", "author": "abdelhamidbakhta", "createdAt": "2020-04-29T15:21:47Z", "path": "ethereum/evmtool/src/main/java/org/hyperledger/besu/evmtool/EvmTool.java", "diffHunk": "@@ -0,0 +1,35 @@\n+/*\n+ * Copyright ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ *\n+ * SPDX-License-Identifier: Apache-2.0\n+ *\n+ */\n+package org.hyperledger.besu.evmtool;\n+\n+import static picocli.CommandLine.defaultExceptionHandler;\n+\n+import picocli.CommandLine;\n+\n+public final class EvmTool {", "originalCommit": "bcfcc2830dd1d168b5d49601ed281a6f10f4c7b9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzQxMjEzMg==", "url": "https://github.com/hyperledger/besu/pull/786#discussion_r417412132", "bodyText": "For now this is not meant for general consumption, this tool doesn't get added to the distribution.  If that changes it will be moved in or some other policy set in place.", "author": "shemnon", "createdAt": "2020-04-29T15:36:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzQwMDk0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzQxMjcwMQ==", "url": "https://github.com/hyperledger/besu/pull/786#discussion_r417412701", "bodyText": "Sounds good.", "author": "abdelhamidbakhta", "createdAt": "2020-04-29T15:37:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzQwMDk0Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzQwMjAwMg==", "url": "https://github.com/hyperledger/besu/pull/786#discussion_r417402002", "bodyText": "gasUser ? Typo ?", "author": "abdelhamidbakhta", "createdAt": "2020-04-29T15:23:13Z", "path": "ethereum/evmtool/src/main/java/org/hyperledger/besu/evmtool/EvmToolCommand.java", "diffHunk": "@@ -0,0 +1,290 @@\n+/*\n+ * Copyright ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ *\n+ * SPDX-License-Identifier: Apache-2.0\n+ *\n+ */\n+package org.hyperledger.besu.evmtool;\n+\n+import org.hyperledger.besu.cli.config.NetworkName;\n+import org.hyperledger.besu.ethereum.core.Account;\n+import org.hyperledger.besu.ethereum.core.Address;\n+import org.hyperledger.besu.ethereum.core.BlockHeader;\n+import org.hyperledger.besu.ethereum.core.BlockHeaderBuilder;\n+import org.hyperledger.besu.ethereum.core.Difficulty;\n+import org.hyperledger.besu.ethereum.core.Gas;\n+import org.hyperledger.besu.ethereum.core.Hash;\n+import org.hyperledger.besu.ethereum.core.LogsBloomFilter;\n+import org.hyperledger.besu.ethereum.core.Wei;\n+import org.hyperledger.besu.ethereum.mainnet.MainnetBlockHeaderFunctions;\n+import org.hyperledger.besu.ethereum.vm.BlockHashLookup;\n+import org.hyperledger.besu.ethereum.vm.Code;\n+import org.hyperledger.besu.ethereum.vm.EVM;\n+import org.hyperledger.besu.ethereum.vm.ExceptionalHaltReason;\n+import org.hyperledger.besu.ethereum.vm.MessageFrame;\n+import org.hyperledger.besu.ethereum.vm.ehalt.ExceptionalHaltException;\n+\n+import java.io.File;\n+import java.io.IOException;\n+import java.nio.charset.StandardCharsets;\n+import java.time.Instant;\n+import java.util.ArrayDeque;\n+import java.util.List;\n+\n+import com.google.common.base.Stopwatch;\n+import io.vertx.core.json.JsonArray;\n+import io.vertx.core.json.JsonObject;\n+import org.apache.logging.log4j.Level;\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+import org.apache.logging.log4j.core.config.Configurator;\n+import org.apache.tuweni.bytes.Bytes;\n+import org.apache.tuweni.units.bigints.UInt256;\n+import picocli.CommandLine;\n+import picocli.CommandLine.Command;\n+import picocli.CommandLine.Option;\n+\n+@Command(\n+    description = \"This command evaluates EVM transactions.\",\n+    abbreviateSynopsis = true,\n+    name = \"evm\",\n+    mixinStandardHelpOptions = true,\n+    sortOptions = false,\n+    header = \"Usage:\",\n+    synopsisHeading = \"%n\",\n+    descriptionHeading = \"%nDescription:%n%n\",\n+    optionListHeading = \"%nOptions:%n\",\n+    footerHeading = \"%n\",\n+    footer = \"Hyperledger Besu is licensed under the Apache License 2.0\")\n+public class EvmToolCommand implements Runnable {\n+\n+  private static final Logger LOG = LogManager.getLogger();\n+\n+  @Option(\n+      names = {\"--code\"},\n+      paramLabel = \"<code>\",\n+      description = \"code to be executed\")\n+  Bytes codeHexString = Bytes.EMPTY;\n+\n+  @Option(\n+      names = {\"--codefile\"},\n+      paramLabel = \"<file>\",\n+      description = \"file containing code to be executed\")\n+  File codeFile;\n+\n+  @Option(\n+      names = {\"--gas\"},\n+      paramLabel = \"<int>\")\n+  Gas gas = Gas.of(10_000_000_000L);\n+\n+  @Option(\n+      names = {\"--price\"},\n+      paramLabel = \"<int>\")\n+  Wei gasPriceGWei = Wei.ZERO;\n+\n+  @Option(\n+      names = {\"--sender\"},\n+      paramLabel = \"<address>\",\n+      description = \"address of ORIGIN\")\n+  Address sender = Address.fromHexString(\"0x00\");\n+\n+  @Option(\n+      names = {\"--receiver\"},\n+      paramLabel = \"<address>\",\n+      description = \"address of ADDRESS\")\n+  Address receiver = Address.fromHexString(\"0x00\");\n+\n+  @Option(\n+      names = {\"--input\"},\n+      paramLabel = \"<code>\",\n+      description = \"CALLDATA\")\n+  Bytes callData = Bytes.EMPTY;\n+\n+  @Option(\n+      names = {\"--value\"},\n+      paramLabel = \"<int>\")\n+  Wei ethValue = Wei.ZERO;\n+\n+  @Option(\n+      names = {\"--json\"},\n+      description = \"output json output for each opcode\")\n+  boolean showJsonResults = false;\n+\n+  @Option(\n+      names = {\"--nomemory\"},\n+      description = \"disable showing the full memory output for each op\")\n+  boolean showMemory = true;\n+\n+  @Option(\n+      names = {\"--create\"},\n+      description = \"initcode to execute\")\n+  Bytes createCode = Bytes.of();\n+\n+  @Option(\n+      names = {\"--prestate\", \"--genesis\"},\n+      description = \"a chain specification, the same one that the client normally would use\")\n+  File genesisFile;\n+\n+  @Option(\n+      names = {\"--chain\"},\n+      description = \"Name of a well know chain\")\n+  NetworkName network;\n+\n+  @Option(\n+      names = {\"--repeat\"},\n+      description = \"Number of times to repeat before gathering timing\")\n+  int repeat = 0;\n+\n+  private final EvmToolCommandOptionsModule daggerOptions = new EvmToolCommandOptionsModule();\n+\n+  void parse(\n+      final CommandLine.AbstractParseResultHandler<List<Object>> resultHandler,\n+      final CommandLine.DefaultExceptionHandler<List<Object>> exceptionHandler,\n+      final String[] args) {\n+\n+    final CommandLine commandLine = new CommandLine(this);\n+    commandLine.addMixin(\"Dagger Options\", daggerOptions);\n+\n+    // add sub commands here\n+\n+    commandLine.registerConverter(Address.class, Address::fromHexString);\n+    commandLine.registerConverter(Bytes.class, Bytes::fromHexString);\n+    commandLine.registerConverter(Gas.class, (arg) -> Gas.of(Long.parseUnsignedLong(arg)));\n+    commandLine.registerConverter(Wei.class, (arg) -> Wei.of(Long.parseUnsignedLong(arg)));\n+\n+    commandLine.parseWithHandlers(resultHandler, exceptionHandler, args);\n+  }\n+\n+  @Override\n+  public void run() {\n+    try {\n+      final EvmToolComponent component =\n+          DaggerEvmToolComponent.builder()\n+              .dataStoreModule(new InMemoryDataStoreModule())\n+              .genesisFileModule(\n+                  network == null\n+                      ? genesisFile == null\n+                          ? GenesisFileModule.createGenesisModule(NetworkName.DEV)\n+                          : GenesisFileModule.createGenesisModule(genesisFile)\n+                      : GenesisFileModule.createGenesisModule(network))\n+              .evmToolCommandOptionsModule(daggerOptions)\n+              .metricsSystemModule(new PrometheusMetricsSystemModule())\n+              .build();\n+\n+      final BlockHeader blockHeader =\n+          BlockHeaderBuilder.create()\n+              .parentHash(Hash.EMPTY)\n+              .coinbase(Address.ZERO)\n+              .difficulty(Difficulty.ONE)\n+              .number(1)\n+              .gasLimit(5000)\n+              .timestamp(Instant.now().toEpochMilli())\n+              .ommersHash(Hash.EMPTY_LIST_HASH)\n+              .stateRoot(Hash.EMPTY_TRIE_HASH)\n+              .transactionsRoot(Hash.EMPTY)\n+              .receiptsRoot(Hash.EMPTY)\n+              .logsBloom(LogsBloomFilter.empty())\n+              .gasUsed(0)\n+              .extraData(Bytes.EMPTY)\n+              .mixHash(Hash.EMPTY)\n+              .nonce(0)\n+              .blockHeaderFunctions(new MainnetBlockHeaderFunctions())\n+              .buildBlockHeader();\n+\n+      Configurator.setAllLevels(\"\", repeat == 0 ? Level.INFO : Level.OFF);\n+      do {\n+        final MessageFrame messageFrame =\n+            MessageFrame.builder()\n+                .type(MessageFrame.Type.MESSAGE_CALL)\n+                .messageFrameStack(new ArrayDeque<>())\n+                .blockchain(component.getBlockchain())\n+                .worldState(component.getWorldUpdater())\n+                .initialGas(gas)\n+                .contract(Address.ZERO)\n+                .address(receiver)\n+                .originator(sender)\n+                .gasPrice(gasPriceGWei)\n+                .inputData(callData)\n+                .sender(Address.ZERO)\n+                .value(ethValue)\n+                .apparentValue(ethValue)\n+                .code(new Code(codeHexString))\n+                .blockHeader(blockHeader)\n+                .depth(0)\n+                .completer(c -> {})\n+                .miningBeneficiary(blockHeader.getCoinbase())\n+                .blockHashLookup(new BlockHashLookup(blockHeader, component.getBlockchain()))\n+                .contractAccountVersion(Account.DEFAULT_VERSION)\n+                .build();\n+\n+        messageFrame.setState(MessageFrame.State.CODE_EXECUTING);\n+        final EVM evm = component.getEvmAtBlock().apply(0);\n+\n+        final Stopwatch stopwatch = Stopwatch.createStarted();\n+        evm.runToHalt(\n+            messageFrame,\n+            (frame, currentGasCost, executeOperation) -> {\n+              if (showJsonResults && repeat == 0) {\n+                System.out.println(createEvmTraceOperation(messageFrame));\n+              }\n+              executeOperation.execute();\n+            });\n+        stopwatch.stop();\n+\n+        if (repeat == 0) {\n+          System.out.println(\n+              new JsonObject()\n+                  .put(\n+                      \"gasUser\",", "originalCommit": "bcfcc2830dd1d168b5d49601ed281a6f10f4c7b9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzQwNzMyMA==", "url": "https://github.com/hyperledger/besu/pull/786#discussion_r417407320", "bodyText": "This output is matching existing outputs from other clients.  My understanding is that it was used for cross-client fuzzing at one point and I want to maintain maximum compatibility.", "author": "shemnon", "createdAt": "2020-04-29T15:30:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzQwMjAwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzQwOTAyMg==", "url": "https://github.com/hyperledger/besu/pull/786#discussion_r417409022", "bodyText": "Ok.", "author": "abdelhamidbakhta", "createdAt": "2020-04-29T15:32:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzQwMjAwMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzQwMjU3NQ==", "url": "https://github.com/hyperledger/besu/pull/786#discussion_r417402575", "bodyText": "Why it is needed ?", "author": "abdelhamidbakhta", "createdAt": "2020-04-29T15:23:56Z", "path": "ethereum/evmtool/src/main/java/org/hyperledger/besu/evmtool/EvmToolCommandOptionsModule.java", "diffHunk": "@@ -0,0 +1,40 @@\n+/*\n+ * Copyright ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ *\n+ * SPDX-License-Identifier: Apache-2.0\n+ *\n+ */\n+\n+package org.hyperledger.besu.evmtool;\n+\n+import javax.inject.Named;\n+\n+import dagger.Module;\n+import dagger.Provides;\n+import picocli.CommandLine.Option;\n+\n+@SuppressWarnings(\"WeakerAccess\")", "originalCommit": "bcfcc2830dd1d168b5d49601ed281a6f10f4c7b9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzQwODI5Nw==", "url": "https://github.com/hyperledger/besu/pull/786#discussion_r417408297", "bodyText": "IntelliJ wants it package private, but Dagger complains when it is not public.  This keeps future development from accidentally running into that wall.", "author": "shemnon", "createdAt": "2020-04-29T15:31:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzQwMjU3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzQwOTE4OQ==", "url": "https://github.com/hyperledger/besu/pull/786#discussion_r417409189", "bodyText": "Sounds good.", "author": "abdelhamidbakhta", "createdAt": "2020-04-29T15:32:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzQwMjU3NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzQwMjk0Mw==", "url": "https://github.com/hyperledger/besu/pull/786#discussion_r417402943", "bodyText": "Why fields don't have  private visibility ?", "author": "abdelhamidbakhta", "createdAt": "2020-04-29T15:24:25Z", "path": "ethereum/evmtool/src/main/java/org/hyperledger/besu/evmtool/EvmToolCommand.java", "diffHunk": "@@ -0,0 +1,290 @@\n+/*\n+ * Copyright ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ *\n+ * SPDX-License-Identifier: Apache-2.0\n+ *\n+ */\n+package org.hyperledger.besu.evmtool;\n+\n+import org.hyperledger.besu.cli.config.NetworkName;\n+import org.hyperledger.besu.ethereum.core.Account;\n+import org.hyperledger.besu.ethereum.core.Address;\n+import org.hyperledger.besu.ethereum.core.BlockHeader;\n+import org.hyperledger.besu.ethereum.core.BlockHeaderBuilder;\n+import org.hyperledger.besu.ethereum.core.Difficulty;\n+import org.hyperledger.besu.ethereum.core.Gas;\n+import org.hyperledger.besu.ethereum.core.Hash;\n+import org.hyperledger.besu.ethereum.core.LogsBloomFilter;\n+import org.hyperledger.besu.ethereum.core.Wei;\n+import org.hyperledger.besu.ethereum.mainnet.MainnetBlockHeaderFunctions;\n+import org.hyperledger.besu.ethereum.vm.BlockHashLookup;\n+import org.hyperledger.besu.ethereum.vm.Code;\n+import org.hyperledger.besu.ethereum.vm.EVM;\n+import org.hyperledger.besu.ethereum.vm.ExceptionalHaltReason;\n+import org.hyperledger.besu.ethereum.vm.MessageFrame;\n+import org.hyperledger.besu.ethereum.vm.ehalt.ExceptionalHaltException;\n+\n+import java.io.File;\n+import java.io.IOException;\n+import java.nio.charset.StandardCharsets;\n+import java.time.Instant;\n+import java.util.ArrayDeque;\n+import java.util.List;\n+\n+import com.google.common.base.Stopwatch;\n+import io.vertx.core.json.JsonArray;\n+import io.vertx.core.json.JsonObject;\n+import org.apache.logging.log4j.Level;\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+import org.apache.logging.log4j.core.config.Configurator;\n+import org.apache.tuweni.bytes.Bytes;\n+import org.apache.tuweni.units.bigints.UInt256;\n+import picocli.CommandLine;\n+import picocli.CommandLine.Command;\n+import picocli.CommandLine.Option;\n+\n+@Command(\n+    description = \"This command evaluates EVM transactions.\",\n+    abbreviateSynopsis = true,\n+    name = \"evm\",\n+    mixinStandardHelpOptions = true,\n+    sortOptions = false,\n+    header = \"Usage:\",\n+    synopsisHeading = \"%n\",\n+    descriptionHeading = \"%nDescription:%n%n\",\n+    optionListHeading = \"%nOptions:%n\",\n+    footerHeading = \"%n\",\n+    footer = \"Hyperledger Besu is licensed under the Apache License 2.0\")\n+public class EvmToolCommand implements Runnable {\n+\n+  private static final Logger LOG = LogManager.getLogger();\n+\n+  @Option(\n+      names = {\"--code\"},\n+      paramLabel = \"<code>\",\n+      description = \"code to be executed\")\n+  Bytes codeHexString = Bytes.EMPTY;", "originalCommit": "bcfcc2830dd1d168b5d49601ed281a6f10f4c7b9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzQxNjM5MA==", "url": "https://github.com/hyperledger/besu/pull/786#discussion_r417416390", "bodyText": "It should be.  I'm surprised my intellij didn't complain.", "author": "shemnon", "createdAt": "2020-04-29T15:42:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzQwMjk0Mw=="}], "type": "inlineReview"}, {"oid": "ffaeadc80913563567fbe2470630a7e2a84506d2", "url": "https://github.com/hyperledger/besu/commit/ffaeadc80913563567fbe2470630a7e2a84506d2", "message": "review adjustments\n\nSigned-off-by: Danno Ferrin <danno.ferrin@gmail.com>", "committedDate": "2020-04-29T15:54:31Z", "type": "commit"}, {"oid": "6aca3698ea337afad5924225b1ac0dbe8b6c42b8", "url": "https://github.com/hyperledger/besu/commit/6aca3698ea337afad5924225b1ac0dbe8b6c42b8", "message": "Merge branch 'master' into evmtool", "committedDate": "2020-04-29T15:54:45Z", "type": "commit"}]}