{"pr_number": 1599, "pr_title": "Go quorum enclave", "pr_createdAt": "2020-11-23T05:16:11Z", "pr_url": "https://github.com/hyperledger/besu/pull/1599", "timeline": [{"oid": "0ce28a89389773990e9cff6447ab0ce79ebd6a19", "url": "https://github.com/hyperledger/besu/commit/0ce28a89389773990e9cff6447ab0ce79ebd6a19", "message": "add enclave for goQuorum privacy using Tessera\n\nSigned-off-by: Stefan Pingel <stefan.pingel@consensys.net>", "committedDate": "2020-11-23T05:10:37Z", "type": "commit"}, {"oid": "2c4f68aa3008edb47abf30c4dc9695b189d83852", "url": "https://github.com/hyperledger/besu/commit/2c4f68aa3008edb47abf30c4dc9695b189d83852", "message": "Merge branch 'master' of github.com:hyperledger/besu into goQuorumEnclave", "committedDate": "2020-11-23T05:11:16Z", "type": "commit"}, {"oid": "8fff8392079ff15ebb0679d9135bdb2b8dc14c92", "url": "https://github.com/hyperledger/besu/commit/8fff8392079ff15ebb0679d9135bdb2b8dc14c92", "message": "add enclave for goQuorum privacy using Tessera\n\nSigned-off-by: Stefan Pingel <stefan.pingel@consensys.net>", "committedDate": "2020-11-23T05:36:04Z", "type": "commit"}, {"oid": "a85643072e0cca1dda4a3c12ede417109786bb1e", "url": "https://github.com/hyperledger/besu/commit/a85643072e0cca1dda4a3c12ede417109786bb1e", "message": "add enclave for goQuorum privacy using Tessera\n\nSigned-off-by: Stefan Pingel <stefan.pingel@consensys.net>", "committedDate": "2020-11-23T05:53:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODk4OTk5OA==", "url": "https://github.com/hyperledger/besu/pull/1599#discussion_r528989998", "bodyText": "If this is not needed we can delete it.", "author": "lucassaldanha", "createdAt": "2020-11-23T20:55:12Z", "path": "enclave/src/main/java/org/hyperledger/besu/enclave/GoQuorumEnclave.java", "diffHunk": "@@ -0,0 +1,156 @@\n+/*\n+ * Copyright ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ *\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+package org.hyperledger.besu.enclave;\n+\n+import org.hyperledger.besu.enclave.RequestTransmitter.ResponseBodyHandler;\n+import org.hyperledger.besu.enclave.types.GoQuorumReceiveResponse;\n+import org.hyperledger.besu.enclave.types.GoQuorumSendRequest;\n+import org.hyperledger.besu.enclave.types.ReceiveRequest;\n+import org.hyperledger.besu.enclave.types.SendResponse;\n+\n+import java.io.IOException;\n+import java.nio.charset.StandardCharsets;\n+import java.util.List;\n+\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+\n+public class GoQuorumEnclave {\n+\n+  private static final ObjectMapper objectMapper = new ObjectMapper();\n+  private static final String JSON = \"application/json\";\n+\n+  private final RequestTransmitter requestTransmitter;\n+\n+  public GoQuorumEnclave(final RequestTransmitter requestTransmitter) {\n+    this.requestTransmitter = requestTransmitter;\n+  }\n+\n+  public boolean upCheck() {\n+    try {\n+      final String upcheckResponse =\n+          requestTransmitter.get(null, null, \"/upcheck\", this::handleRawResponse);\n+      return upcheckResponse.equals(\"I'm up!\");\n+    } catch (final Exception e) {\n+      return false;\n+    }\n+  }\n+\n+  public SendResponse send(\n+      final byte[] payload, final String privateFrom, final List<String> privateFor) {\n+    final GoQuorumSendRequest request = new GoQuorumSendRequest(payload, privateFrom, privateFor);\n+    return post(\n+        JSON,\n+        request,\n+        \"/send\",\n+        (statusCode, body) -> handleJsonResponse(statusCode, body, SendResponse.class, 201));\n+  }\n+\n+  public GoQuorumReceiveResponse receive(final String payloadKey) {\n+    final ReceiveRequest request = new ReceiveRequest(payloadKey);\n+    return get(\n+        JSON,\n+        request,\n+        \"/receive\",\n+        (statusCode, body) ->\n+            handleJsonResponse(statusCode, body, GoQuorumReceiveResponse.class, 200));\n+  }\n+\n+  //  This method is not needed for GoQuorum privacy, as we do not support multi-tenancy\n+  //  public GoQuorumReceiveResponse receive(final String payloadKey, final String to) {\n+  //    final ReceiveRequest request = new ReceiveRequest(payloadKey, to);\n+  //    return get(\n+  //        JSON,\n+  //        request,\n+  //        \"/receive\",\n+  //        (statusCode, body) ->\n+  //            handleJsonResponse(statusCode, body, GoQuorumReceiveResponse.class, 200));\n+  //  }", "originalCommit": "a85643072e0cca1dda4a3c12ede417109786bb1e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTA1OTE5Nw==", "url": "https://github.com/hyperledger/besu/pull/1599#discussion_r529059197", "bodyText": "Done", "author": "pinges", "createdAt": "2020-11-23T23:19:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODk4OTk5OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODk5MjE5MA==", "url": "https://github.com/hyperledger/besu/pull/1599#discussion_r528992190", "bodyText": "Why do we need the media-type and content in the interface?", "author": "lucassaldanha", "createdAt": "2020-11-23T20:59:35Z", "path": "enclave/src/main/java/org/hyperledger/besu/enclave/RequestTransmitter.java", "diffHunk": "@@ -27,5 +27,9 @@\n       String endpoint,\n       ResponseBodyHandler<T> responseBodyHandler);\n \n-  <T> T get(String endpoint, ResponseBodyHandler<T> responseBodyHandler);\n+  <T> T get(\n+      String mediaType,\n+      String content,", "originalCommit": "a85643072e0cca1dda4a3c12ede417109786bb1e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTA1OTIzMA==", "url": "https://github.com/hyperledger/besu/pull/1599#discussion_r529059230", "bodyText": "This is needed because we have to set the contentType and the content when we are doing the /receive with Tessera, but we can't set it for the /upcheck with Orion or Tessera.", "author": "pinges", "createdAt": "2020-11-23T23:19:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODk5MjE5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTA4NzkzMQ==", "url": "https://github.com/hyperledger/besu/pull/1599#discussion_r529087931", "bodyText": "Is the content-type dynamic? Isn't this something that can be set when instantiating the implementation of RequestTransmitter?", "author": "lucassaldanha", "createdAt": "2020-11-24T00:40:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODk5MjE5MA=="}], "type": "inlineReview"}, {"oid": "6618d209de4545a20055144b056be53821adc317", "url": "https://github.com/hyperledger/besu/commit/6618d209de4545a20055144b056be53821adc317", "message": "Merge branch 'master' of github.com:hyperledger/besu into goQuorumEnclave", "committedDate": "2020-11-23T23:11:31Z", "type": "commit"}, {"oid": "dabd24bcc816abec390577b7ee31cd14fc6985bd", "url": "https://github.com/hyperledger/besu/commit/dabd24bcc816abec390577b7ee31cd14fc6985bd", "message": "removed code that was commented out\n\nSigned-off-by: Stefan Pingel <stefan.pingel@consensys.net>", "committedDate": "2020-11-23T23:20:35Z", "type": "commit"}, {"oid": "cedbe72f9bedd1c34771a7c5810e776165deb378", "url": "https://github.com/hyperledger/besu/commit/cedbe72f9bedd1c34771a7c5810e776165deb378", "message": "removed code that was commented out\n\nSigned-off-by: Stefan Pingel <stefan.pingel@consensys.net>", "committedDate": "2020-11-23T23:27:53Z", "type": "commit"}, {"oid": "37583010944ec8f5c4e0a6c371eeab7c6bdadef1", "url": "https://github.com/hyperledger/besu/commit/37583010944ec8f5c4e0a6c371eeab7c6bdadef1", "message": "Merge branch 'master' into goQuorumEnclave", "committedDate": "2020-11-24T22:42:39Z", "type": "commit"}]}