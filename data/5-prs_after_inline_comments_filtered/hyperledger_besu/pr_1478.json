{"pr_number": 1478, "pr_title": "Fix Internal error returned on eth_estimateGas", "pr_createdAt": "2020-10-20T09:14:45Z", "pr_url": "https://github.com/hyperledger/besu/pull/1478", "timeline": [{"oid": "8206c1ac5b8ec46bcbd19f10982c4ea2e52c5f28", "url": "https://github.com/hyperledger/besu/commit/8206c1ac5b8ec46bcbd19f10982c4ea2e52c5f28", "message": "fix eth_estimateGas internal error during revert\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>", "committedDate": "2020-10-20T09:02:36Z", "type": "commit"}, {"oid": "e2efb1edd311ad89c52aaec4b7ae4dbbe7e223bc", "url": "https://github.com/hyperledger/besu/commit/e2efb1edd311ad89c52aaec4b7ae4dbbe7e223bc", "message": "clean code\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>", "committedDate": "2020-10-20T09:13:56Z", "type": "commit"}, {"oid": "9b92e46273416534ead1f8fe38b511c4b80897fc", "url": "https://github.com/hyperledger/besu/commit/9b92e46273416534ead1f8fe38b511c4b80897fc", "message": "Merge branch 'master' into feature/internal-error-returned-on-eth-estimate-gas", "committedDate": "2020-10-20T13:24:08Z", "type": "commit"}, {"oid": "a73cade1663b508a340d54c60353e55761d7fcbc", "url": "https://github.com/hyperledger/besu/commit/a73cade1663b508a340d54c60353e55761d7fcbc", "message": "add check world state available\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>", "committedDate": "2020-10-21T14:47:56Z", "type": "commit"}, {"oid": "be82f4c246de6a426f97a8c6917fdd037320fdaf", "url": "https://github.com/hyperledger/besu/commit/be82f4c246de6a426f97a8c6917fdd037320fdaf", "message": "update test\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>", "committedDate": "2020-10-26T10:09:26Z", "type": "commit"}, {"oid": "ecf4423d284ab24350481f49f1b901d3e52faa19", "url": "https://github.com/hyperledger/besu/commit/ecf4423d284ab24350481f49f1b901d3e52faa19", "message": "Merge branch 'master' into feature/internal-error-returned-on-eth-estimate-gas", "committedDate": "2020-10-26T10:10:57Z", "type": "commit"}, {"oid": "4fd2af5cc20cb57cc75f2e514951013a8129c226", "url": "https://github.com/hyperledger/besu/commit/4fd2af5cc20cb57cc75f2e514951013a8129c226", "message": "update CHANGELOG.md\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>", "committedDate": "2020-10-26T10:16:38Z", "type": "commit"}, {"oid": "e9ef78d723ff25b15d1fdabb39bb03ccf8362318", "url": "https://github.com/hyperledger/besu/commit/e9ef78d723ff25b15d1fdabb39bb03ccf8362318", "message": "Merge branch 'master' into feature/internal-error-returned-on-eth-estimate-gas", "committedDate": "2020-10-27T14:51:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjg3MzI0OQ==", "url": "https://github.com/hyperledger/besu/pull/1478#discussion_r512873249", "bodyText": "Instead of storing the revert flag in the tracer is it possible to use org.hyperledger.besu.ethereum.mainnet.TransactionProcessor.Result#getRevertReason?  (via org.hyperledger.besu.ethereum.transaction.TransactionSimulatorResult#getResult)?  If a TX reverts without a reason do we get an empty revert reason or a revert reason with zero bytes?", "author": "shemnon", "createdAt": "2020-10-27T17:09:54Z", "path": "ethereum/core/src/main/java/org/hyperledger/besu/ethereum/vm/EstimateGasOperationTracer.java", "diffHunk": "@@ -23,6 +23,8 @@\n \n   private Gas sStoreStipendNeeded = Gas.ZERO;\n \n+  private boolean isReverted = false;", "originalCommit": "e9ef78d723ff25b15d1fdabb39bb03ccf8362318", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjg3NTMyMA==", "url": "https://github.com/hyperledger/besu/pull/1478#discussion_r512875320", "bodyText": "Im thinking since this is only set by the revert operation and BLS precompiles that the optional will not be empty, at worst an optional of a zero length string", "author": "shemnon", "createdAt": "2020-10-27T17:12:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjg3MzI0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjkyMTM2NA==", "url": "https://github.com/hyperledger/besu/pull/1478#discussion_r512921364", "bodyText": "I just tried again and indeed we don't have an empty. I thought I found a specific case where it didn't work. but after doing it again it seems ok with your technique", "author": "matkt", "createdAt": "2020-10-27T18:11:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjg3MzI0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjk1MDE3MQ==", "url": "https://github.com/hyperledger/besu/pull/1478#discussion_r512950171", "bodyText": "good catch. I just updated the code to use getRevertReason", "author": "matkt", "createdAt": "2020-10-27T18:57:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjg3MzI0OQ=="}], "type": "inlineReview"}, {"oid": "b12743705d8d6b39a8673286dce3a1191dcf590c", "url": "https://github.com/hyperledger/besu/commit/b12743705d8d6b39a8673286dce3a1191dcf590c", "message": "update eth estimate gas implementation\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>", "committedDate": "2020-10-27T18:36:17Z", "type": "commit"}, {"oid": "74c33df3d159de88115cbfaa3defb4f465ee65ba", "url": "https://github.com/hyperledger/besu/commit/74c33df3d159de88115cbfaa3defb4f465ee65ba", "message": "Merge branch 'feature/internal-error-returned-on-eth-estimate-gas'\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>", "committedDate": "2020-10-27T18:37:22Z", "type": "commit"}, {"oid": "74c33df3d159de88115cbfaa3defb4f465ee65ba", "url": "https://github.com/hyperledger/besu/commit/74c33df3d159de88115cbfaa3defb4f465ee65ba", "message": "Merge branch 'feature/internal-error-returned-on-eth-estimate-gas'\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>", "committedDate": "2020-10-27T18:37:22Z", "type": "forcePushed"}, {"oid": "41076bd843e65bc5993cdeb7ee1cbd4fdb43936d", "url": "https://github.com/hyperledger/besu/commit/41076bd843e65bc5993cdeb7ee1cbd4fdb43936d", "message": "Merge branch 'master' into feature/internal-error-returned-on-eth-estimate-gas", "committedDate": "2020-10-28T11:16:09Z", "type": "commit"}, {"oid": "bacbc04c226f44968570e831e0aed092e3776ae9", "url": "https://github.com/hyperledger/besu/commit/bacbc04c226f44968570e831e0aed092e3776ae9", "message": "Merge branch 'master' into feature/internal-error-returned-on-eth-estimate-gas", "committedDate": "2020-10-30T09:04:55Z", "type": "commit"}]}