{"pr_number": 759, "pr_title": "[EIP-1559] Step 10 - Send raw transaction RPC should work with EIP-1559 transactions", "pr_createdAt": "2020-04-21T12:15:13Z", "pr_url": "https://github.com/hyperledger/besu/pull/759", "timeline": [{"oid": "047bf185de728dce29e38f1e18451a09abe2047f", "url": "https://github.com/hyperledger/besu/commit/047bf185de728dce29e38f1e18451a09abe2047f", "message": "Added changelog entries for PR:\n- https://github.com/hyperledger/besu/pull/430\n- https://github.com/hyperledger/besu/pull/440\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>", "committedDate": "2020-04-20T11:26:41Z", "type": "commit"}, {"oid": "63f32fe18facdafa1820b598c91f4a2d2cd47c7f", "url": "https://github.com/hyperledger/besu/commit/63f32fe18facdafa1820b598c91f4a2d2cd47c7f", "message": "Update transaction processing with EIP-1559 rules.\n\n- Created `TransactionPriceCalculator` to compute the transaction gas price.\n- Created `CoinbaseFeePriceCalculator` to compute the coinbase reward.\n- Updated `MainnetTransactionProcessor` to apply new consensus rules:\n    - Updated transaction gas price for EIP-1559 transactions.\n    - Updated coinbase reward for EIP-1559 transactions.\n- Updated `MainnetProtocolSpecs` to build the correct TransactionProcessor for EIP-1559 definition.\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>", "committedDate": "2020-04-20T11:30:48Z", "type": "commit"}, {"oid": "08ad077361a0fb282556ded79a3789ff03c22b33", "url": "https://github.com/hyperledger/besu/commit/08ad077361a0fb282556ded79a3789ff03c22b33", "message": "Manage EIP-1559 transactions forging in local transaction pool.\n- Updated `TransactionPool`\n    - Added `TransactionPriceCalculator` field for frontier transactions.\n    - Added `TransactionPriceCalculator` field for EIP-1559 transactions.\n    - Added `EIP1559` field.\n    - Added `minTransactionGasPrice` to compute transaction gas price according to EIP-1559 rules.\n- Created `BaseFee` domain object.\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>", "committedDate": "2020-04-21T12:12:00Z", "type": "commit"}, {"oid": "25aef63e614896fee02c2d1df42eb1e890f8d554", "url": "https://github.com/hyperledger/besu/commit/25aef63e614896fee02c2d1df42eb1e890f8d554", "message": "Merge remote-tracking branch 'upstream/master' into eip1559-step10\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>", "committedDate": "2020-04-21T12:15:39Z", "type": "commit"}, {"oid": "6117cd4c6ab486876562cf1d50dcb43a9482d497", "url": "https://github.com/hyperledger/besu/commit/6117cd4c6ab486876562cf1d50dcb43a9482d497", "message": "Added parameter to method call\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>", "committedDate": "2020-04-21T12:32:38Z", "type": "commit"}, {"oid": "61bdc578b47d8266731699a65154198b5eab0190", "url": "https://github.com/hyperledger/besu/commit/61bdc578b47d8266731699a65154198b5eab0190", "message": "Merge branch 'master' into eip1559-step10", "committedDate": "2020-04-21T16:24:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjUyNjcwNw==", "url": "https://github.com/hyperledger/besu/pull/759#discussion_r412526707", "bodyText": "return value ignored?  Are we relying on side effects or is this a stray line that should be deleted?", "author": "shemnon", "createdAt": "2020-04-21T22:11:02Z", "path": "besu/src/main/java/org/hyperledger/besu/controller/BesuControllerBuilder.java", "diffHunk": "@@ -256,6 +259,17 @@\n     final EthContext ethContext = new EthContext(ethPeers, ethMessages, scheduler);\n     final SyncState syncState = new SyncState(blockchain, ethPeers);\n     final boolean fastSyncEnabled = syncConfig.getSyncMode().equals(SyncMode.FAST);\n+\n+    final Optional<EIP1559> eip1559;\n+    final GenesisConfigOptions genesisConfigOptions =\n+        genesisConfig.getConfigOptions(genesisConfigOverrides);\n+    if (ExperimentalEIPs.eip1559Enabled\n+        && genesisConfigOptions.getEIP1559BlockNumber().isPresent()) {\n+      eip1559 = Optional.of(new EIP1559(genesisConfigOptions.getEIP1559BlockNumber().getAsLong()));\n+    } else {\n+      eip1559 = Optional.empty();\n+    }\n+    genesisConfig.getConfigOptions(genesisConfigOverrides).getEIP1559BlockNumber();", "originalCommit": "08ad077361a0fb282556ded79a3789ff03c22b33", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjgwODI0OA==", "url": "https://github.com/hyperledger/besu/pull/759#discussion_r412808248", "bodyText": "It is a stray line that should be deleted.\nDone.", "author": "abdelhamidbakhta", "createdAt": "2020-04-22T09:07:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjUyNjcwNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjUyNzE0OA==", "url": "https://github.com/hyperledger/besu/pull/759#discussion_r412527148", "bodyText": "Will this ever change across hard forks or are the designers fairly sure it is static?", "author": "shemnon", "createdAt": "2020-04-21T22:11:53Z", "path": "ethereum/core/src/main/java/org/hyperledger/besu/ethereum/core/fees/BaseFee.java", "diffHunk": "@@ -0,0 +1,46 @@\n+/*\n+ * Copyright ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ *\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+package org.hyperledger.besu.ethereum.core.fees;\n+\n+public class BaseFee {\n+  private static final long BOUNDING_DENOMINATOR = 8;", "originalCommit": "08ad077361a0fb282556ded79a3789ff03c22b33", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjgxMzA3OA==", "url": "https://github.com/hyperledger/besu/pull/759#discussion_r412813078", "bodyText": "Actually the value is defined in FeeMarket interface: getBasefeeMaxChangeDenominator\nRemoved the constant in favor of the interface method", "author": "abdelhamidbakhta", "createdAt": "2020-04-22T09:14:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjUyNzE0OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjUzMDI2OQ==", "url": "https://github.com/hyperledger/besu/pull/759#discussion_r412530269", "bodyText": "Style: I prefer to see returns at the same level, unless it is a guard block (https://wiki.c2.com/?GuardClause).  Unexpected fall throughs I've seen lead to bugs.\nBoth ways to address this will duplicate the frontier gas price calculation, but from a readability perspective I think it's fine as it makes what is going on explicit.\nThis could be re-written as two guard blocks (one checking for 1559 enablement in general, then the two variables calculation, then the check for basefee being present) returning frontier prices and then a final return for 1559 prices.", "author": "shemnon", "createdAt": "2020-04-21T22:18:33Z", "path": "ethereum/eth/src/main/java/org/hyperledger/besu/ethereum/eth/transactions/TransactionPool.java", "diffHunk": "@@ -268,4 +281,18 @@ private BlockHeader getChainHeadBlockHeader() {\n \n     void onTransactionsAdded(Iterable<Transaction> transactions);\n   }\n+\n+  private Wei minTransactionGasPrice(final Transaction transaction) {", "originalCommit": "08ad077361a0fb282556ded79a3789ff03c22b33", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjgyMTQzMQ==", "url": "https://github.com/hyperledger/besu/pull/759#discussion_r412821431", "bodyText": "I added a guard block, if EIP-1559 is not enabled in general, returns with frontier price.\nThen i have a simple if-else block with returns at the same level. Actually i simplified because base fee is mandatory if the block is post EIP-1559, so i added an orElseThrow when retrieving the base fee.", "author": "abdelhamidbakhta", "createdAt": "2020-04-22T09:26:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjUzMDI2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzA3NzkyOQ==", "url": "https://github.com/hyperledger/besu/pull/759#discussion_r413077929", "bodyText": "\ud83d\udc4d", "author": "shemnon", "createdAt": "2020-04-22T15:21:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjUzMDI2OQ=="}], "type": "inlineReview"}, {"oid": "ae8c6e0cc3c7f0b340c7e15c770b2509217d2b09", "url": "https://github.com/hyperledger/besu/commit/ae8c6e0cc3c7f0b340c7e15c770b2509217d2b09", "message": "Merge remote-tracking branch 'upstream/master' into eip1559-step10\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>", "committedDate": "2020-04-22T09:06:04Z", "type": "commit"}, {"oid": "30c84570b3f63b36f0c5a2d57d22c5559e8307df", "url": "https://github.com/hyperledger/besu/commit/30c84570b3f63b36f0c5a2d57d22c5559e8307df", "message": "Address PR comments\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>", "committedDate": "2020-04-22T09:32:44Z", "type": "commit"}, {"oid": "b1e14669ac0112189bbcae88a739178c0a63812b", "url": "https://github.com/hyperledger/besu/commit/b1e14669ac0112189bbcae88a739178c0a63812b", "message": "Address PR comments\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>", "committedDate": "2020-04-22T09:56:57Z", "type": "commit"}]}