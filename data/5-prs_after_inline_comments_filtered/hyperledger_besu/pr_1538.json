{"pr_number": 1538, "pr_title": "Add new JSON_RPC endpoints to get miner data by block number and block hash.", "pr_createdAt": "2020-11-05T20:48:17Z", "pr_url": "https://github.com/hyperledger/besu/pull/1538", "timeline": [{"oid": "dad8dae8bd6601bfe0d3f620036ffdc2f657b702", "url": "https://github.com/hyperledger/besu/commit/dad8dae8bd6601bfe0d3f620036ffdc2f657b702", "message": "#1066 Switched to use unprefixed hex strings for memory and stack values\n\nSigned-off-by: David Mechler <david.mechler@consensys.net>", "committedDate": "2020-06-26T13:37:13Z", "type": "commit"}, {"oid": "01430e770da93ea19171e1a9683daec7c10677f4", "url": "https://github.com/hyperledger/besu/commit/01430e770da93ea19171e1a9683daec7c10677f4", "message": "Merge branch 'master' of github.com:hyperledger/besu", "committedDate": "2020-06-26T16:53:26Z", "type": "commit"}, {"oid": "aac3bd6d4d5c6f16a4ef1e8c1cf7fb3fd8346b7d", "url": "https://github.com/hyperledger/besu/commit/aac3bd6d4d5c6f16a4ef1e8c1cf7fb3fd8346b7d", "message": "Merge branch 'master' of github.com:hyperledger/besu", "committedDate": "2020-06-30T17:04:49Z", "type": "commit"}, {"oid": "17aa301cff4a1192efb3a0d3e53e05995dafa744", "url": "https://github.com/hyperledger/besu/commit/17aa301cff4a1192efb3a0d3e53e05995dafa744", "message": "Disable flaky tests per Ben Burns(Yeti) request\n\nSigned-off-by: David Mechler <david.mechler@consensys.net>", "committedDate": "2020-06-30T20:58:04Z", "type": "commit"}, {"oid": "4a987ae3bd51de708b0f230a26b56785142ec06f", "url": "https://github.com/hyperledger/besu/commit/4a987ae3bd51de708b0f230a26b56785142ec06f", "message": "Merge branch 'master' of github.com:hyperledger/besu", "committedDate": "2020-06-30T23:43:03Z", "type": "commit"}, {"oid": "520d3172fad19bb6ff7055c44b6ddce524ee8bce", "url": "https://github.com/hyperledger/besu/commit/520d3172fad19bb6ff7055c44b6ddce524ee8bce", "message": "Revert last commit and enable ignored tests.\n\nSigned-off-by: David Mechler <david.mechler@consensys.net>", "committedDate": "2020-06-30T23:45:44Z", "type": "commit"}, {"oid": "0e61d8699e37f65780ac5985fb841cbb31920ee8", "url": "https://github.com/hyperledger/besu/commit/0e61d8699e37f65780ac5985fb841cbb31920ee8", "message": "Merge branch 'master' of github.com:hyperledger/besu", "committedDate": "2020-07-01T19:10:35Z", "type": "commit"}, {"oid": "6fc3bf9be8452f237c8a1eb0b96ede151c8a2427", "url": "https://github.com/hyperledger/besu/commit/6fc3bf9be8452f237c8a1eb0b96ede151c8a2427", "message": "Merge branch 'master' of github.com:hyperledger/besu", "committedDate": "2020-07-06T18:44:24Z", "type": "commit"}, {"oid": "47c82ed2dbbf9d1c31e0f60fe0f963d8c16a7362", "url": "https://github.com/hyperledger/besu/commit/47c82ed2dbbf9d1c31e0f60fe0f963d8c16a7362", "message": "#1157 - updated to create 2 agents so that proper bonding can occur\n\nSigned-off-by: David Mechler <david.mechler@consensys.net>", "committedDate": "2020-07-06T21:11:34Z", "type": "commit"}, {"oid": "9742c60a6d08924106055868d933b06ec6b41b1f", "url": "https://github.com/hyperledger/besu/commit/9742c60a6d08924106055868d933b06ec6b41b1f", "message": "Merge branch 'master' into master", "committedDate": "2020-07-06T21:26:30Z", "type": "commit"}, {"oid": "a13be1b0ddac0a3972c0b2af59fe86479c22bc02", "url": "https://github.com/hyperledger/besu/commit/a13be1b0ddac0a3972c0b2af59fe86479c22bc02", "message": "Merge branch 'master' into master", "committedDate": "2020-07-06T23:16:30Z", "type": "commit"}, {"oid": "5d8dfe6f80d2ea9a337126b79042207a9a555041", "url": "https://github.com/hyperledger/besu/commit/5d8dfe6f80d2ea9a337126b79042207a9a555041", "message": "Merge branch 'master' of github.com:hyperledger/besu", "committedDate": "2020-07-07T13:05:21Z", "type": "commit"}, {"oid": "4c6163d1472d16f60b32ec038ce81cb3abfea6e3", "url": "https://github.com/hyperledger/besu/commit/4c6163d1472d16f60b32ec038ce81cb3abfea6e3", "message": "Merge branch 'master' of github.com:hyperledger/besu", "committedDate": "2020-07-08T15:26:54Z", "type": "commit"}, {"oid": "11873402ff1e78d9f0d1edfe3ef0bc4557878133", "url": "https://github.com/hyperledger/besu/commit/11873402ff1e78d9f0d1edfe3ef0bc4557878133", "message": "Merge branch 'master' of github.com:hyperledger/besu", "committedDate": "2020-07-09T13:20:06Z", "type": "commit"}, {"oid": "a92d67821b55776d6c1625f40e713d2214fad6f4", "url": "https://github.com/hyperledger/besu/commit/a92d67821b55776d6c1625f40e713d2214fad6f4", "message": "#1162 - Updated test to mock the local peer PING packet creation so that the hash can be managed.\n\nSigned-off-by: David Mechler <david.mechler@consensys.net>", "committedDate": "2020-07-09T13:27:29Z", "type": "commit"}, {"oid": "b0db56c0bedcd3266e88cb41ef7a2e16fcb63908", "url": "https://github.com/hyperledger/besu/commit/b0db56c0bedcd3266e88cb41ef7a2e16fcb63908", "message": "Merge branch 'master' of github.com:hyperledger/besu", "committedDate": "2020-07-14T15:19:03Z", "type": "commit"}, {"oid": "e301b49061e1b443b2da32ae83b7075632f84518", "url": "https://github.com/hyperledger/besu/commit/e301b49061e1b443b2da32ae83b7075632f84518", "message": "Added admin_logsRepairCache end point\n\nSigned-off-by: David Mechler <david.mechler@consensys.net>", "committedDate": "2020-07-16T15:58:11Z", "type": "commit"}, {"oid": "133485e7d254442ac043fdcb8353cd72420fca11", "url": "https://github.com/hyperledger/besu/commit/133485e7d254442ac043fdcb8353cd72420fca11", "message": "Merge branch 'master' of github.com:hyperledger/besu", "committedDate": "2020-07-16T15:58:24Z", "type": "commit"}, {"oid": "7d6690d84c242eb5f0bbd1d9863f82a07646a16f", "url": "https://github.com/hyperledger/besu/commit/7d6690d84c242eb5f0bbd1d9863f82a07646a16f", "message": "Added admin_logsRepairCache end point\n\nSigned-off-by: David Mechler <david.mechler@consensys.net>", "committedDate": "2020-07-16T15:59:53Z", "type": "commit"}, {"oid": "ae4776c263bcc77548973645f8cc9b62e38b654b", "url": "https://github.com/hyperledger/besu/commit/ae4776c263bcc77548973645f8cc9b62e38b654b", "message": "Merge branch 'master' into master", "committedDate": "2020-07-16T16:54:14Z", "type": "commit"}, {"oid": "8d09e0340beef2421d0f4272ab5d13918c29f196", "url": "https://github.com/hyperledger/besu/commit/8d09e0340beef2421d0f4272ab5d13918c29f196", "message": "Remove p2p network code per PR comments\n\nSigned-off-by: David Mechler <david.mechler@consensys.net>", "committedDate": "2020-07-16T18:04:11Z", "type": "commit"}, {"oid": "99a2d6fb0c5596fc72631fce7d7063dc6c29a57c", "url": "https://github.com/hyperledger/besu/commit/99a2d6fb0c5596fc72631fce7d7063dc6c29a57c", "message": "Merge branch 'master' of github.com:hyperledger/besu", "committedDate": "2020-07-16T18:51:56Z", "type": "commit"}, {"oid": "315149c134ab7f3f70701ed89e28f4c9d1a4954d", "url": "https://github.com/hyperledger/besu/commit/315149c134ab7f3f70701ed89e28f4c9d1a4954d", "message": "Updates from PR comments\n\nSigned-off-by: David Mechler <david.mechler@consensys.net>", "committedDate": "2020-07-16T19:56:25Z", "type": "commit"}, {"oid": "2b70082c6dd14ce51dd6bd63d96a875126795390", "url": "https://github.com/hyperledger/besu/commit/2b70082c6dd14ce51dd6bd63d96a875126795390", "message": "Spotless Apply fixes\n\nSigned-off-by: David Mechler <david.mechler@consensys.net>", "committedDate": "2020-07-16T21:07:30Z", "type": "commit"}, {"oid": "f32a56c946022de71be4087c542044c96ec7bed6", "url": "https://github.com/hyperledger/besu/commit/f32a56c946022de71be4087c542044c96ec7bed6", "message": "PR updates\n\nSigned-off-by: David Mechler <david.mechler@consensys.net>", "committedDate": "2020-07-17T00:59:56Z", "type": "commit"}, {"oid": "0a9c73d8c69750635a0ccbcac69a347e8b4c3949", "url": "https://github.com/hyperledger/besu/commit/0a9c73d8c69750635a0ccbcac69a347e8b4c3949", "message": "Admin force cache refresh when called through end point per PR comments\n\nSigned-off-by: David Mechler <david.mechler@consensys.net>", "committedDate": "2020-07-17T17:09:38Z", "type": "commit"}, {"oid": "2bba686aa081d3b1d63af237f605a36a76b9753a", "url": "https://github.com/hyperledger/besu/commit/2bba686aa081d3b1d63af237f605a36a76b9753a", "message": "Pr updates\n\nSigned-off-by: David Mechler <david.mechler@consensys.net>", "committedDate": "2020-07-20T12:49:02Z", "type": "commit"}, {"oid": "462ef6f3358e3be9df7757a796ed6fe5387bad43", "url": "https://github.com/hyperledger/besu/commit/462ef6f3358e3be9df7757a796ed6fe5387bad43", "message": "Merge branch 'master' into master", "committedDate": "2020-07-20T13:40:08Z", "type": "commit"}, {"oid": "3a9ff925bfc95bd038d0888a3b06e5cb70f6d0b2", "url": "https://github.com/hyperledger/besu/commit/3a9ff925bfc95bd038d0888a3b06e5cb70f6d0b2", "message": "Merge branch 'master' of github.com:hyperledger/besu", "committedDate": "2020-07-23T18:35:25Z", "type": "commit"}, {"oid": "b797d1e28b333d36630df56006d59aaeed6aedc1", "url": "https://github.com/hyperledger/besu/commit/b797d1e28b333d36630df56006d59aaeed6aedc1", "message": "Merge branch 'master' of github.com:hyperledger/besu", "committedDate": "2020-07-24T14:28:26Z", "type": "commit"}, {"oid": "5857190e54837f1d252e863c9d0d60751ffd3832", "url": "https://github.com/hyperledger/besu/commit/5857190e54837f1d252e863c9d0d60751ffd3832", "message": "Merge branch 'master' of github.com:hyperledger/besu", "committedDate": "2020-07-27T13:50:14Z", "type": "commit"}, {"oid": "f65531923ca3ce73e0ccb8069d998cc3e6a57134", "url": "https://github.com/hyperledger/besu/commit/f65531923ca3ce73e0ccb8069d998cc3e6a57134", "message": "Update changelog for 1.5.1\n\nSigned-off-by: David Mechler <david.mechler@consensys.net>", "committedDate": "2020-07-27T13:54:32Z", "type": "commit"}, {"oid": "e8fcb0ff493e2ef5d5a8eaed1f5c1a46fa80b793", "url": "https://github.com/hyperledger/besu/commit/e8fcb0ff493e2ef5d5a8eaed1f5c1a46fa80b793", "message": "Merge branch 'master' of github.com:hyperledger/besu", "committedDate": "2020-07-28T14:06:43Z", "type": "commit"}, {"oid": "99c2e68f497299322508a5679af3d10a04b4170f", "url": "https://github.com/hyperledger/besu/commit/99c2e68f497299322508a5679af3d10a04b4170f", "message": "Merge branch 'master' of github.com:hyperledger/besu", "committedDate": "2020-08-12T20:33:58Z", "type": "commit"}, {"oid": "d000dcc0663d011d24fc4860d35e06611fbd5c06", "url": "https://github.com/hyperledger/besu/commit/d000dcc0663d011d24fc4860d35e06611fbd5c06", "message": "Remove check for 0x prefix on addresses to match expectations\n\nSigned-off-by: David Mechler <david.mechler@consensys.net>", "committedDate": "2020-08-13T15:22:21Z", "type": "commit"}, {"oid": "fda6964d6e0ce4c7cf216fb4fd61d36c08f5363f", "url": "https://github.com/hyperledger/besu/commit/fda6964d6e0ce4c7cf216fb4fd61d36c08f5363f", "message": "Merge branch 'master' of github.com:hyperledger/besu", "committedDate": "2020-08-14T13:23:32Z", "type": "commit"}, {"oid": "7f523cd0cf39251ca417d71be17dd12355465440", "url": "https://github.com/hyperledger/besu/commit/7f523cd0cf39251ca417d71be17dd12355465440", "message": "Merge branch 'master' of github.com:hyperledger/besu", "committedDate": "2020-08-14T20:01:03Z", "type": "commit"}, {"oid": "7de25f2f6a0ac13e2b11835aab021e5f984756c2", "url": "https://github.com/hyperledger/besu/commit/7de25f2f6a0ac13e2b11835aab021e5f984756c2", "message": "Merge branch 'master' of github.com:hyperledger/besu", "committedDate": "2020-08-17T13:22:54Z", "type": "commit"}, {"oid": "7338e6013ded2d68951dc0d0e64a8329f6e9d872", "url": "https://github.com/hyperledger/besu/commit/7338e6013ded2d68951dc0d0e64a8329f6e9d872", "message": "Merge branch 'master' of github.com:hyperledger/besu", "committedDate": "2020-08-19T17:26:11Z", "type": "commit"}, {"oid": "4b136adf2b3cd8776b693ad94246b7e555141965", "url": "https://github.com/hyperledger/besu/commit/4b136adf2b3cd8776b693ad94246b7e555141965", "message": "Merge branch 'master' of github.com:hyperledger/besu", "committedDate": "2020-08-25T17:32:59Z", "type": "commit"}, {"oid": "ae02bc4056e0c1326c2464915b6bc142e31b03d7", "url": "https://github.com/hyperledger/besu/commit/ae02bc4056e0c1326c2464915b6bc142e31b03d7", "message": "Merge branch 'master' of github.com:hyperledger/besu", "committedDate": "2020-08-27T15:25:17Z", "type": "commit"}, {"oid": "e5852b2c94627a33d5d2a5fc0e18ee0a6b6ef84f", "url": "https://github.com/hyperledger/besu/commit/e5852b2c94627a33d5d2a5fc0e18ee0a6b6ef84f", "message": "Merge branch 'master' of github.com:hyperledger/besu", "committedDate": "2020-09-10T13:30:18Z", "type": "commit"}, {"oid": "9439a498e4189c308b68ee8225b8d672a5b1af16", "url": "https://github.com/hyperledger/besu/commit/9439a498e4189c308b68ee8225b8d672a5b1af16", "message": "Merge branch 'master' of github.com:hyperledger/besu", "committedDate": "2020-09-14T14:24:21Z", "type": "commit"}, {"oid": "2660ee5502d978108cce1f5d75c2a968f48a44a5", "url": "https://github.com/hyperledger/besu/commit/2660ee5502d978108cce1f5d75c2a968f48a44a5", "message": "Merge branch 'master' of github.com:hyperledger/besu", "committedDate": "2020-09-21T16:39:53Z", "type": "commit"}, {"oid": "ace9aa306ba25fd9049fc77d43dfdd45dac70283", "url": "https://github.com/hyperledger/besu/commit/ace9aa306ba25fd9049fc77d43dfdd45dac70283", "message": "Merge branch 'master' of github.com:hyperledger/besu", "committedDate": "2020-09-28T14:24:34Z", "type": "commit"}, {"oid": "bc0e535886f7bcde57524ff08ee00dfaf8486945", "url": "https://github.com/hyperledger/besu/commit/bc0e535886f7bcde57524ff08ee00dfaf8486945", "message": "Merge branch 'master' of github.com:hyperledger/besu", "committedDate": "2020-10-07T15:14:51Z", "type": "commit"}, {"oid": "60cf3c3a467d781fe20ba40b00395d0d22e53ddd", "url": "https://github.com/hyperledger/besu/commit/60cf3c3a467d781fe20ba40b00395d0d22e53ddd", "message": "Merge branch 'master' of github.com:hyperledger/besu", "committedDate": "2020-10-08T19:44:20Z", "type": "commit"}, {"oid": "166ce3137d74949384ac8422b5582734d6d69591", "url": "https://github.com/hyperledger/besu/commit/166ce3137d74949384ac8422b5582734d6d69591", "message": "Merge branch 'master' of github.com:hyperledger/besu", "committedDate": "2020-10-12T17:43:19Z", "type": "commit"}, {"oid": "d9c242d73f010cc1b450fc3c0f06d23737dec66f", "url": "https://github.com/hyperledger/besu/commit/d9c242d73f010cc1b450fc3c0f06d23737dec66f", "message": "Merge branch 'master' of github.com:hyperledger/besu", "committedDate": "2020-10-13T20:04:44Z", "type": "commit"}, {"oid": "ec3b2423f761bb41fa2ef26685ff0db08e3b240b", "url": "https://github.com/hyperledger/besu/commit/ec3b2423f761bb41fa2ef26685ff0db08e3b240b", "message": "Update graphql pending to allow for sorting of transactions\n\nSigned-off-by: David Mechler <david.mechler@consensys.net>", "committedDate": "2020-10-13T20:31:50Z", "type": "commit"}, {"oid": "ec0b7f719cd7e73299f5e5b811a260e65d7f0e2c", "url": "https://github.com/hyperledger/besu/commit/ec0b7f719cd7e73299f5e5b811a260e65d7f0e2c", "message": "Merge branch 'master' into master", "committedDate": "2020-10-14T11:58:14Z", "type": "commit"}, {"oid": "7314efcbc832275f818c643cd99d085bc4b41f1e", "url": "https://github.com/hyperledger/besu/commit/7314efcbc832275f818c643cd99d085bc4b41f1e", "message": "Merge branch 'master' of github.com:hyperledger/besu", "committedDate": "2020-10-14T13:44:33Z", "type": "commit"}, {"oid": "d4b5632ee0cdb84d5af974c07d7101d8331d6812", "url": "https://github.com/hyperledger/besu/commit/d4b5632ee0cdb84d5af974c07d7101d8331d6812", "message": "Merge branch 'master' of github.com:hyperledger/besu", "committedDate": "2020-10-14T19:10:29Z", "type": "commit"}, {"oid": "4638e121982fd340f1f30d787e3b8b10fb7aac02", "url": "https://github.com/hyperledger/besu/commit/4638e121982fd340f1f30d787e3b8b10fb7aac02", "message": "Merge branch 'master' of github.com:hyperledger/besu", "committedDate": "2020-10-16T17:05:26Z", "type": "commit"}, {"oid": "e12e21184aa7fb356ca11046d001ae916500f374", "url": "https://github.com/hyperledger/besu/commit/e12e21184aa7fb356ca11046d001ae916500f374", "message": "Merge branch 'master' of github.com:hyperledger/besu", "committedDate": "2020-10-20T15:35:22Z", "type": "commit"}, {"oid": "3f6867665f16d38c2425b7c32caaa7e70393e084", "url": "https://github.com/hyperledger/besu/commit/3f6867665f16d38c2425b7c32caaa7e70393e084", "message": "#1408 Add Miner data endpoints\n\nSigned-off-by: David Mechler <david.mechler@consensys.net>", "committedDate": "2020-11-05T20:40:08Z", "type": "commit"}, {"oid": "8afa5e9022110fc7d48bbe7d3ba14a93c61e7e85", "url": "https://github.com/hyperledger/besu/commit/8afa5e9022110fc7d48bbe7d3ba14a93c61e7e85", "message": "#1408 Add Miner data endpoints\n\nSigned-off-by: David Mechler <david.mechler@consensys.net>", "committedDate": "2020-11-05T20:40:41Z", "type": "commit"}, {"oid": "fc99289ac97d922a5764c0c344bdc08eed6b15da", "url": "https://github.com/hyperledger/besu/commit/fc99289ac97d922a5764c0c344bdc08eed6b15da", "message": "#1408 Add Miner data endpoints\n\nSigned-off-by: David Mechler <david.mechler@consensys.net>", "committedDate": "2020-11-05T20:56:58Z", "type": "commit"}, {"oid": "8b51d253696c6b71294eb562993313b7ba859e15", "url": "https://github.com/hyperledger/besu/commit/8b51d253696c6b71294eb562993313b7ba859e15", "message": "Merge branch 'master' into master", "committedDate": "2020-11-06T12:59:13Z", "type": "commit"}, {"oid": "843ebbad7a6aa23b4f17fc4e2cffe3f70ce3ca7f", "url": "https://github.com/hyperledger/besu/commit/843ebbad7a6aa23b4f17fc4e2cffe3f70ce3ca7f", "message": "#1408 Added tests for new miner endpoints\n\nSigned-off-by: David Mechler <david.mechler@consensys.net>", "committedDate": "2020-11-06T17:15:58Z", "type": "commit"}, {"oid": "de96919b44f7ddb9098771a6ea8fd1d5c69f4bf1", "url": "https://github.com/hyperledger/besu/commit/de96919b44f7ddb9098771a6ea8fd1d5c69f4bf1", "message": "Merge branch 'master' of github.com:davemec/besu", "committedDate": "2020-11-06T17:16:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODk4MjQxOQ==", "url": "https://github.com/hyperledger/besu/pull/1538#discussion_r518982419", "bodyText": "Optional Style: Most of our mocking uses static import of .when() and (when not using the junit annotations) .mock().  Similarly for most of the Assertsions.* series to.  This tends to make a more \"readable\" test at the expense of making it clear this is a Mockito method.", "author": "shemnon", "createdAt": "2020-11-06T20:12:58Z", "path": "ethereum/api/src/test/java/org/hyperledger/besu/ethereum/api/jsonrpc/internal/methods/EthGetMinerDataByBlockNumberTest.java", "diffHunk": "@@ -0,0 +1,152 @@\n+/*\n+ * Copyright ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ *\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+\n+package org.hyperledger.besu.ethereum.api.jsonrpc.internal.methods;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.hyperledger.besu.ethereum.api.jsonrpc.internal.response.JsonRpcError.WORLD_STATE_UNAVAILABLE;\n+import static org.mockito.Mockito.verifyNoMoreInteractions;\n+\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.JsonRpcRequest;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.JsonRpcRequestContext;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.exception.InvalidJsonRpcParameters;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.response.JsonRpcErrorResponse;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.response.JsonRpcResponse;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.response.JsonRpcSuccessResponse;\n+import org.hyperledger.besu.ethereum.api.query.BlockWithMetadata;\n+import org.hyperledger.besu.ethereum.api.query.BlockchainQueries;\n+import org.hyperledger.besu.ethereum.api.query.TransactionWithMetadata;\n+import org.hyperledger.besu.ethereum.chain.Blockchain;\n+import org.hyperledger.besu.ethereum.core.BlockHeader;\n+import org.hyperledger.besu.ethereum.core.BlockHeaderTestFixture;\n+import org.hyperledger.besu.ethereum.core.Difficulty;\n+import org.hyperledger.besu.ethereum.core.Hash;\n+import org.hyperledger.besu.ethereum.core.Wei;\n+import org.hyperledger.besu.ethereum.mainnet.ProtocolSchedule;\n+import org.hyperledger.besu.ethereum.mainnet.ProtocolSpec;\n+import org.hyperledger.besu.ethereum.worldstate.WorldStateArchive;\n+\n+import java.util.Collections;\n+import java.util.Optional;\n+\n+import org.assertj.core.api.Assertions;\n+import org.assertj.core.util.Arrays;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.mockito.Mock;\n+import org.mockito.Mockito;\n+import org.mockito.junit.MockitoJUnitRunner;\n+\n+@RunWith(MockitoJUnitRunner.class)\n+public class EthGetMinerDataByBlockNumberTest {\n+  @Mock private BlockchainQueries blockchainQueries;\n+  @Mock private ProtocolSchedule protocolSchedule;\n+  @Mock private WorldStateArchive worldStateArchive;\n+  @Mock private ProtocolSpec protocolSpec;\n+  @Mock private Blockchain blockChain;\n+  private EthGetMinerDataByBlockNumber method;\n+  private final String ETH_METHOD = \"eth_getMinerDataByBlockNumber\";\n+  private final BlockHeaderTestFixture blockHeaderTestFixture = new BlockHeaderTestFixture();\n+\n+  @Before\n+  public void before() {\n+    this.method = new EthGetMinerDataByBlockNumber(blockchainQueries, protocolSchedule);\n+  }\n+\n+  @Test\n+  public void shouldReturnExpectedMethodNameTest() {\n+    assertThat(method.getName()).isEqualTo(ETH_METHOD);\n+  }\n+\n+  @Test\n+  public void successTest() {\n+    final BlockHeader header = blockHeaderTestFixture.buildHeader();\n+    final BlockWithMetadata<TransactionWithMetadata, Hash> blockWithMetadata =\n+        new BlockWithMetadata<>(\n+            header, Collections.emptyList(), Collections.emptyList(), Difficulty.of(100L), 5);\n+\n+    Mockito.when(blockchainQueries.blockByNumber(Mockito.anyLong()))", "originalCommit": "de96919b44f7ddb9098771a6ea8fd1d5c69f4bf1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODk4NDEwOA==", "url": "https://github.com/hyperledger/besu/pull/1538#discussion_r518984108", "bodyText": "I'm surprised the google formatter didn't ask you to star indent this block.", "author": "shemnon", "createdAt": "2020-11-06T20:16:53Z", "path": "ethereum/api/src/main/java/org/hyperledger/besu/ethereum/api/jsonrpc/internal/methods/EthGetMinerDataByBlockHash.java", "diffHunk": "@@ -0,0 +1,137 @@\n+/*\n+ * Copyright ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ *\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+\n+package org.hyperledger.besu.ethereum.api.jsonrpc.internal.methods;\n+\n+import org.hyperledger.besu.ethereum.api.jsonrpc.RpcMethod;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.JsonRpcRequestContext;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.response.JsonRpcError;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.response.JsonRpcErrorResponse;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.response.JsonRpcResponse;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.response.JsonRpcSuccessResponse;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.results.MinerDataResult;\n+import org.hyperledger.besu.ethereum.api.query.BlockWithMetadata;\n+import org.hyperledger.besu.ethereum.api.query.BlockchainQueries;\n+import org.hyperledger.besu.ethereum.api.query.TransactionReceiptWithMetadata;\n+import org.hyperledger.besu.ethereum.api.query.TransactionWithMetadata;\n+import org.hyperledger.besu.ethereum.core.Address;\n+import org.hyperledger.besu.ethereum.core.BlockHeader;\n+import org.hyperledger.besu.ethereum.core.Hash;\n+import org.hyperledger.besu.ethereum.core.Transaction;\n+import org.hyperledger.besu.ethereum.core.Wei;\n+import org.hyperledger.besu.ethereum.mainnet.ProtocolSchedule;\n+import org.hyperledger.besu.ethereum.mainnet.ProtocolSpec;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.Optional;\n+import java.util.function.Supplier;\n+\n+import com.google.common.base.Suppliers;\n+import org.apache.tuweni.units.bigints.BaseUInt256Value;\n+\n+public class EthGetMinerDataByBlockHash implements JsonRpcMethod {\n+  private final Supplier<BlockchainQueries> blockchain;\n+  private final ProtocolSchedule protocolSchedule;\n+\n+  public EthGetMinerDataByBlockHash(\n+      final BlockchainQueries blockchain, final ProtocolSchedule protocolSchedule) {\n+    this(Suppliers.ofInstance(blockchain), protocolSchedule);\n+  }\n+\n+  public EthGetMinerDataByBlockHash(\n+      final Supplier<BlockchainQueries> blockchain, final ProtocolSchedule protocolSchedule) {\n+    this.blockchain = blockchain;\n+    this.protocolSchedule = protocolSchedule;\n+  }\n+\n+  @Override\n+  public String getName() {\n+    return RpcMethod.ETH_GET_MINER_DATA_BY_BLOCK_HASH.getMethodName();\n+  }\n+\n+  /*\n+  Getting static block reward", "originalCommit": "de96919b44f7ddb9098771a6ea8fd1d5c69f4bf1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTAxODE3Ng==", "url": "https://github.com/hyperledger/besu/pull/1538#discussion_r519018176", "bodyText": "Comment removed as this is no longer relevant.", "author": "davemec", "createdAt": "2020-11-06T21:38:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODk4NDEwOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODk4NTE1Mg==", "url": "https://github.com/hyperledger/besu/pull/1538#discussion_r518985152", "bodyText": "Even though this is a slack quote it should be in a documentary tone.  I'd also move it around 108-111 where the uncle reward calculation is calculated as it is a code relevant comment not a quasi-javadoc comment.", "author": "shemnon", "createdAt": "2020-11-06T20:19:34Z", "path": "ethereum/api/src/main/java/org/hyperledger/besu/ethereum/api/jsonrpc/internal/methods/EthGetMinerDataByBlockHash.java", "diffHunk": "@@ -0,0 +1,137 @@\n+/*\n+ * Copyright ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ *\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+\n+package org.hyperledger.besu.ethereum.api.jsonrpc.internal.methods;\n+\n+import org.hyperledger.besu.ethereum.api.jsonrpc.RpcMethod;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.JsonRpcRequestContext;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.response.JsonRpcError;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.response.JsonRpcErrorResponse;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.response.JsonRpcResponse;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.response.JsonRpcSuccessResponse;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.results.MinerDataResult;\n+import org.hyperledger.besu.ethereum.api.query.BlockWithMetadata;\n+import org.hyperledger.besu.ethereum.api.query.BlockchainQueries;\n+import org.hyperledger.besu.ethereum.api.query.TransactionReceiptWithMetadata;\n+import org.hyperledger.besu.ethereum.api.query.TransactionWithMetadata;\n+import org.hyperledger.besu.ethereum.core.Address;\n+import org.hyperledger.besu.ethereum.core.BlockHeader;\n+import org.hyperledger.besu.ethereum.core.Hash;\n+import org.hyperledger.besu.ethereum.core.Transaction;\n+import org.hyperledger.besu.ethereum.core.Wei;\n+import org.hyperledger.besu.ethereum.mainnet.ProtocolSchedule;\n+import org.hyperledger.besu.ethereum.mainnet.ProtocolSpec;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.Optional;\n+import java.util.function.Supplier;\n+\n+import com.google.common.base.Suppliers;\n+import org.apache.tuweni.units.bigints.BaseUInt256Value;\n+\n+public class EthGetMinerDataByBlockHash implements JsonRpcMethod {\n+  private final Supplier<BlockchainQueries> blockchain;\n+  private final ProtocolSchedule protocolSchedule;\n+\n+  public EthGetMinerDataByBlockHash(\n+      final BlockchainQueries blockchain, final ProtocolSchedule protocolSchedule) {\n+    this(Suppliers.ofInstance(blockchain), protocolSchedule);\n+  }\n+\n+  public EthGetMinerDataByBlockHash(\n+      final Supplier<BlockchainQueries> blockchain, final ProtocolSchedule protocolSchedule) {\n+    this.blockchain = blockchain;\n+    this.protocolSchedule = protocolSchedule;\n+  }\n+\n+  @Override\n+  public String getName() {\n+    return RpcMethod.ETH_GET_MINER_DATA_BY_BLOCK_HASH.getMethodName();\n+  }\n+\n+  /*\n+  Getting static block reward\n+  pass in the block height (as a long) get the block reward (as wei)\n+  each block spec has it.  but it\u2019s only meaningful w/in 6 blocks of the fork.\n+\n+  Didn\u2019t happen at the two places we reduced block reward on mainnet.  I say leave a comment but write no code.", "originalCommit": "de96919b44f7ddb9098771a6ea8fd1d5c69f4bf1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTAxNzg5Nw==", "url": "https://github.com/hyperledger/besu/pull/1538#discussion_r519017897", "bodyText": "Comment removed as this is no longer relevant.", "author": "davemec", "createdAt": "2020-11-06T21:38:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODk4NTE1Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODk4NjY4MA==", "url": "https://github.com/hyperledger/besu/pull/1538#discussion_r518986680", "bodyText": "This looks duplicated from what is in EthGetMinerDataByBlockHash.  This will burn us one day if we don't call a shared method.  I'd recommend an AbstractMinerDataCall  super class where this method is present and the two subclasses marshal the block by either hash or number.\nIf there are differences between the two then we need code comments pointing out the differences as the subtlety will be missed when we come back in the future,", "author": "shemnon", "createdAt": "2020-11-06T20:23:17Z", "path": "ethereum/api/src/main/java/org/hyperledger/besu/ethereum/api/jsonrpc/internal/methods/EthGetMinerDataByBlockNumber.java", "diffHunk": "@@ -0,0 +1,126 @@\n+/*\n+ * Copyright ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ *\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+\n+package org.hyperledger.besu.ethereum.api.jsonrpc.internal.methods;\n+\n+import org.hyperledger.besu.ethereum.api.jsonrpc.RpcMethod;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.JsonRpcRequestContext;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.parameters.BlockParameter;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.response.JsonRpcError;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.response.JsonRpcErrorResponse;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.results.MinerDataResult;\n+import org.hyperledger.besu.ethereum.api.query.BlockWithMetadata;\n+import org.hyperledger.besu.ethereum.api.query.BlockchainQueries;\n+import org.hyperledger.besu.ethereum.api.query.TransactionReceiptWithMetadata;\n+import org.hyperledger.besu.ethereum.api.query.TransactionWithMetadata;\n+import org.hyperledger.besu.ethereum.core.Address;\n+import org.hyperledger.besu.ethereum.core.BlockHeader;\n+import org.hyperledger.besu.ethereum.core.Hash;\n+import org.hyperledger.besu.ethereum.core.Transaction;\n+import org.hyperledger.besu.ethereum.core.Wei;\n+import org.hyperledger.besu.ethereum.mainnet.ProtocolSchedule;\n+import org.hyperledger.besu.ethereum.mainnet.ProtocolSpec;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.Optional;\n+\n+import org.apache.tuweni.units.bigints.BaseUInt256Value;\n+\n+public class EthGetMinerDataByBlockNumber extends AbstractBlockParameterMethod {\n+  private final ProtocolSchedule protocolSchedule;\n+\n+  public EthGetMinerDataByBlockNumber(\n+      final BlockchainQueries blockchain, final ProtocolSchedule protocolSchedule) {\n+    super(blockchain);\n+    this.protocolSchedule = protocolSchedule;\n+  }\n+\n+  @Override\n+  public String getName() {\n+    return RpcMethod.ETH_GET_MINER_DATA_BY_BLOCK_NUMBER.getMethodName();\n+  }\n+\n+  @Override\n+  protected BlockParameter blockParameter(final JsonRpcRequestContext request) {\n+    return request.getRequiredParameter(0, BlockParameter.class);\n+  }\n+\n+  @Override\n+  protected Object resultByBlockNumber(\n+      final JsonRpcRequestContext request, final long blockNumber) {\n+    BlockWithMetadata<TransactionWithMetadata, Hash> block =\n+        getBlockchainQueries().blockByNumber(blockNumber).orElse(null);\n+\n+    MinerDataResult minerDataResult = null;", "originalCommit": "de96919b44f7ddb9098771a6ea8fd1d5c69f4bf1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTAxNjg1NQ==", "url": "https://github.com/hyperledger/besu/pull/1538#discussion_r519016855", "bodyText": "Added static method in EthGetMinerDataByBlockHash for both classes to call since EthGetMinerDataByBlockNumber has a parent.", "author": "davemec", "createdAt": "2020-11-06T21:35:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODk4NjY4MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODk4NzMyNQ==", "url": "https://github.com/hyperledger/besu/pull/1538#discussion_r518987325", "bodyText": "I had a comment written out about using out.writeNull if not present but when I looked at RLPOutput the impl is just to write empty bytes.  Might be worth a comment pointing out that writing Bytes.EMPTY is the same as calling RLPOutput.writeNull", "author": "shemnon", "createdAt": "2020-11-06T20:24:54Z", "path": "ethereum/core/src/main/java/org/hyperledger/besu/ethereum/core/TransactionReceipt.java", "diffHunk": "@@ -154,8 +165,9 @@ private void writeTo(final RLPOutput out, final boolean withRevertReason) {\n     out.writeLongScalar(cumulativeGasUsed);\n     out.writeBytes(bloomFilter);\n     out.writeList(logs, Log::writeTo);\n-    if (withRevertReason && revertReason.isPresent()) {\n-      out.writeBytes(revertReason.get());\n+    if (withMetadata) {\n+      out.writeBytes(revertReason.orElse(Bytes.EMPTY));", "originalCommit": "de96919b44f7ddb9098771a6ea8fd1d5c69f4bf1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODk4OTU2MA==", "url": "https://github.com/hyperledger/besu/pull/1538#discussion_r518989560", "bodyText": "What about when we do a migration?  What if we have an old DB with revert reason but not miner data and start extracting it?  gasRemaining may not always be there.\nI would wrap everything read after the metadataAllowed check in if (!input.isEndOfCurrentList()) { ... } individually as a safety measure.  So two times in this case.", "author": "shemnon", "createdAt": "2020-11-06T20:30:10Z", "path": "ethereum/core/src/main/java/org/hyperledger/besu/ethereum/core/TransactionReceipt.java", "diffHunk": "@@ -191,23 +202,27 @@ public static TransactionReceipt readFrom(\n       final LogsBloomFilter bloomFilter = LogsBloomFilter.readFrom(input);\n       final List<Log> logs = input.readList(Log::readFrom);\n       final Optional<Bytes> revertReason;\n+      long gasRemaining = -1L;\n       if (input.isEndOfCurrentList()) {\n         revertReason = Optional.empty();\n       } else {\n-        if (!revertReasonAllowed) {\n+        if (!metadataAllowed) {\n           throw new RLPException(\"Unexpected value at end of TransactionReceipt\");\n         }\n         revertReason = Optional.of(input.readBytes());\n+        gasRemaining = input.readLong();", "originalCommit": "de96919b44f7ddb9098771a6ea8fd1d5c69f4bf1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTAxNTE0Ng==", "url": "https://github.com/hyperledger/besu/pull/1538#discussion_r519015146", "bodyText": "Will wrap the gasRemaining read but the block starts with the check so the revertReason read is safe.", "author": "davemec", "createdAt": "2020-11-06T21:31:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODk4OTU2MA=="}], "type": "inlineReview"}, {"oid": "60c8343768b664422381713dea86dd3966a7aa55", "url": "https://github.com/hyperledger/besu/commit/60c8343768b664422381713dea86dd3966a7aa55", "message": "#1408 - PR updates\n\nSigned-off-by: David Mechler <david.mechler@consensys.net>", "committedDate": "2020-11-06T21:48:47Z", "type": "commit"}, {"oid": "1479bad9015174c1ecc0f6a29870915731c208b8", "url": "https://github.com/hyperledger/besu/commit/1479bad9015174c1ecc0f6a29870915731c208b8", "message": "SpotlessApply updtes\n\nSigned-off-by: David Mechler <david.mechler@consensys.net>", "committedDate": "2020-11-06T22:09:04Z", "type": "commit"}, {"oid": "67a356410cec8a8b7f080ecf4a1884d4dafff2dd", "url": "https://github.com/hyperledger/besu/commit/67a356410cec8a8b7f080ecf4a1884d4dafff2dd", "message": "SpotlessApply updtes\n\nSigned-off-by: David Mechler <david.mechler@consensys.net>", "committedDate": "2020-11-06T22:18:29Z", "type": "commit"}]}