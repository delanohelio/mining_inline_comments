{"pr_number": 745, "pr_title": "[EIP-1559] Step 9 - Update transaction processing with EIP-1559 rules.", "pr_createdAt": "2020-04-20T11:31:43Z", "pr_url": "https://github.com/hyperledger/besu/pull/745", "timeline": [{"oid": "047bf185de728dce29e38f1e18451a09abe2047f", "url": "https://github.com/hyperledger/besu/commit/047bf185de728dce29e38f1e18451a09abe2047f", "message": "Added changelog entries for PR:\n- https://github.com/hyperledger/besu/pull/430\n- https://github.com/hyperledger/besu/pull/440\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>", "committedDate": "2020-04-20T11:26:41Z", "type": "commit"}, {"oid": "63f32fe18facdafa1820b598c91f4a2d2cd47c7f", "url": "https://github.com/hyperledger/besu/commit/63f32fe18facdafa1820b598c91f4a2d2cd47c7f", "message": "Update transaction processing with EIP-1559 rules.\n\n- Created `TransactionPriceCalculator` to compute the transaction gas price.\n- Created `CoinbaseFeePriceCalculator` to compute the coinbase reward.\n- Updated `MainnetTransactionProcessor` to apply new consensus rules:\n    - Updated transaction gas price for EIP-1559 transactions.\n    - Updated coinbase reward for EIP-1559 transactions.\n- Updated `MainnetProtocolSpecs` to build the correct TransactionProcessor for EIP-1559 definition.\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>", "committedDate": "2020-04-20T11:30:48Z", "type": "commit"}, {"oid": "6a38fa8fb43a367f3b1611f9e2394af2bb4bc10c", "url": "https://github.com/hyperledger/besu/commit/6a38fa8fb43a367f3b1611f9e2394af2bb4bc10c", "message": "Merge branch 'master' into eip1559-step9", "committedDate": "2020-04-20T19:14:17Z", "type": "commit"}, {"oid": "6add803ffc871687581eb66f3d4b90aedf73151b", "url": "https://github.com/hyperledger/besu/commit/6add803ffc871687581eb66f3d4b90aedf73151b", "message": "Merge branch 'master' into eip1559-step9", "committedDate": "2020-04-21T08:01:34Z", "type": "commit"}, {"oid": "52091fc06faed141571f23f3f571e1f3102a5003", "url": "https://github.com/hyperledger/besu/commit/52091fc06faed141571f23f3f571e1f3102a5003", "message": "Merge branch 'master' into eip1559-step9", "committedDate": "2020-04-21T16:24:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjUyMzA0MQ==", "url": "https://github.com/hyperledger/besu/pull/745#discussion_r412523041", "bodyText": "\ud83d\ude04 This should produce compiler errors now if another method is added to the interface.", "author": "shemnon", "createdAt": "2020-04-21T22:03:43Z", "path": "ethereum/core/src/main/java/org/hyperledger/besu/ethereum/core/fees/CoinbaseFeePriceCalculator.java", "diffHunk": "@@ -0,0 +1,37 @@\n+/*\n+ * Copyright ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ *\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+package org.hyperledger.besu.ethereum.core.fees;\n+\n+import org.hyperledger.besu.config.experimental.ExperimentalEIPs;\n+import org.hyperledger.besu.ethereum.core.Gas;\n+import org.hyperledger.besu.ethereum.core.Wei;\n+\n+import java.util.Optional;\n+\n+@FunctionalInterface", "originalCommit": "52091fc06faed141571f23f3f571e1f3102a5003", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjUyMzcxMQ==", "url": "https://github.com/hyperledger/besu/pull/745#discussion_r412523711", "bodyText": "Will gasPremium and Fee Cap always be in legacy TXes in a mixed 1559/legacy state?  i.e. is there a fixed calculation for them based on gas price?  i.e. orElseThrow will only throw if there are config issues?", "author": "shemnon", "createdAt": "2020-04-21T22:05:02Z", "path": "ethereum/core/src/main/java/org/hyperledger/besu/ethereum/core/fees/TransactionPriceCalculator.java", "diffHunk": "@@ -0,0 +1,44 @@\n+/*\n+ * Copyright ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ *\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+package org.hyperledger.besu.ethereum.core.fees;\n+\n+import org.hyperledger.besu.config.experimental.ExperimentalEIPs;\n+import org.hyperledger.besu.ethereum.core.Transaction;\n+import org.hyperledger.besu.ethereum.core.Wei;\n+\n+import java.util.Optional;\n+\n+@FunctionalInterface\n+public interface TransactionPriceCalculator {\n+  Wei price(Transaction transaction, Optional<Long> baseFee);\n+\n+  static TransactionPriceCalculator frontier() {\n+    return (transaction, baseFee) -> transaction.getGasPrice();\n+  }\n+\n+  static TransactionPriceCalculator eip1559() {\n+    return (transaction, maybeBaseFee) -> {\n+      ExperimentalEIPs.eip1559MustBeEnabled();\n+      final long gasPremium = transaction.getGasPremium().orElseThrow().getValue().longValue();", "originalCommit": "52091fc06faed141571f23f3f571e1f3102a5003", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjc5NTAzMA==", "url": "https://github.com/hyperledger/besu/pull/745#discussion_r412795030", "bodyText": "orElseThrow will only throw if there are config issues. You cannot derived gasPremium and fee cap from gas price.", "author": "abdelhamidbakhta", "createdAt": "2020-04-22T08:49:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjUyMzcxMQ=="}], "type": "inlineReview"}, {"oid": "17ef4a0fde665b8295b174099df6a46dfd77a4b7", "url": "https://github.com/hyperledger/besu/commit/17ef4a0fde665b8295b174099df6a46dfd77a4b7", "message": "Merge remote-tracking branch 'upstream/master' into eip1559-step9\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>", "committedDate": "2020-04-22T08:49:58Z", "type": "commit"}, {"oid": "764583eac368e5ca31c01021dde8847168363c0e", "url": "https://github.com/hyperledger/besu/commit/764583eac368e5ca31c01021dde8847168363c0e", "message": "Merge master branch\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>", "committedDate": "2020-04-22T08:51:32Z", "type": "commit"}]}