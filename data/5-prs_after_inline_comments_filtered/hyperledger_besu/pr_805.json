{"pr_number": 805, "pr_title": "[EIP-1559] Handle legacy gas pool and EIP-1559 gas pool when mining blocks.", "pr_createdAt": "2020-04-28T09:37:58Z", "pr_url": "https://github.com/hyperledger/besu/pull/805", "timeline": [{"oid": "5ccfe43de4e91db56dbb88f90c20183335bb9974", "url": "https://github.com/hyperledger/besu/commit/5ccfe43de4e91db56dbb88f90c20183335bb9974", "message": "Added changelog entries for PR:\n- https://github.com/hyperledger/besu/pull/430\n- https://github.com/hyperledger/besu/pull/440\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>", "committedDate": "2020-04-28T08:28:10Z", "type": "commit"}, {"oid": "f62f94574a4a054015de08c0e9e318fc16a6fe05", "url": "https://github.com/hyperledger/besu/commit/f62f94574a4a054015de08c0e9e318fc16a6fe05", "message": "handmerge changelog\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>", "committedDate": "2020-04-28T08:28:10Z", "type": "commit"}, {"oid": "2a4e60ebdb369d20ea12395027866b4c710d352f", "url": "https://github.com/hyperledger/besu/commit/2a4e60ebdb369d20ea12395027866b4c710d352f", "message": "Handle legacy gas pool and EIP-1559 gas pool when mining blocks.\n\n- Added `EIP1559` manager class in `ProtocolSpec` (defaulted to `Optional.empty()`).\n- Updated `MainnetProtocolSpecs` EIP-1559 definition to set the `EIP1559` manager class.\n- Updated `BlockTransactionSelector`\n    - Added `eip1559CumulativeGasUsed` field in `TransactionSelectionResults`.\n    - Updated `updateTransactionResultTracking` method to compute cumulative gas used according to `EIP-1559` rules.\n    - Updated `transactionTooLargeForBlock` method to compute gas remaining according to `EIP-1559` rules.\n    - Updated `blockOccupancyAboveThreshold` method to compute minimum block occupancy ratio according to `EIP-1559` rules.\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>", "committedDate": "2020-04-28T09:35:57Z", "type": "commit"}, {"oid": "4372ae8dce45e754e4bd528b1ee11090aeabdace", "url": "https://github.com/hyperledger/besu/commit/4372ae8dce45e754e4bd528b1ee11090aeabdace", "message": "Merge remote-tracking branch 'upstream/master' into 736\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>", "committedDate": "2020-04-29T10:35:24Z", "type": "commit"}, {"oid": "746fc04fedfbc50013055b46a13239ecee62573f", "url": "https://github.com/hyperledger/besu/commit/746fc04fedfbc50013055b46a13239ecee62573f", "message": "Added min-block-occupancy-ratio command line option\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>", "committedDate": "2020-04-29T11:43:44Z", "type": "commit"}, {"oid": "9f6c63ba3d2c0bb5c3892a0b8dc66f67c56d17a0", "url": "https://github.com/hyperledger/besu/commit/9f6c63ba3d2c0bb5c3892a0b8dc66f67c56d17a0", "message": "Fixed unit tests.\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>", "committedDate": "2020-04-29T13:08:37Z", "type": "commit"}, {"oid": "c9ec78bea9b0faffd8f481f0ce5f5706b90eefe3", "url": "https://github.com/hyperledger/besu/commit/c9ec78bea9b0faffd8f481f0ce5f5706b90eefe3", "message": "Fixed unit tests.\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>", "committedDate": "2020-04-29T13:56:12Z", "type": "commit"}, {"oid": "b426bc18dc59ce2562aeb6b9edd364cba71d0ae4", "url": "https://github.com/hyperledger/besu/commit/b426bc18dc59ce2562aeb6b9edd364cba71d0ae4", "message": "Fixed unit tests.\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>", "committedDate": "2020-04-29T14:35:20Z", "type": "commit"}, {"oid": "d9dd20a9d400bb7098f5fc4b0f5b62f7a111c268", "url": "https://github.com/hyperledger/besu/commit/d9dd20a9d400bb7098f5fc4b0f5b62f7a111c268", "message": "Merge remote-tracking branch 'upstream/master' into 736\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>", "committedDate": "2020-04-29T15:18:43Z", "type": "commit"}, {"oid": "332eeef2879c847537017770f42ceefdb53f4104", "url": "https://github.com/hyperledger/besu/commit/332eeef2879c847537017770f42ceefdb53f4104", "message": "Merge branch 'master' into 736", "committedDate": "2020-04-29T16:18:59Z", "type": "commit"}, {"oid": "37823ba33b6a1a8c31c27aae8270c06f20c36e66", "url": "https://github.com/hyperledger/besu/commit/37823ba33b6a1a8c31c27aae8270c06f20c36e66", "message": "Merge branch 'master' into 736", "committedDate": "2020-04-29T21:30:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzgzMjMwNQ==", "url": "https://github.com/hyperledger/besu/pull/805#discussion_r417832305", "bodyText": "How can we be sure that this block + 1 will always exist?", "author": "matkt", "createdAt": "2020-04-30T08:10:56Z", "path": "ethereum/blockcreation/src/main/java/org/hyperledger/besu/ethereum/blockcreation/AbstractBlockCreator.java", "diffHunk": "@@ -92,8 +96,10 @@ public AbstractBlockCreator(\n     this.protocolSchedule = protocolSchedule;\n     this.gasLimitCalculator = gasLimitCalculator;\n     this.minTransactionGasPrice = minTransactionGasPrice;\n+    this.minBlockOccupancyRatio = minBlockOccupancyRatio;\n     this.miningBeneficiary = miningBeneficiary;\n     this.parentHeader = parentHeader;\n+    this.protocolSpec = protocolSchedule.getByBlockNumber(parentHeader.getNumber() + 1);", "originalCommit": "37823ba33b6a1a8c31c27aae8270c06f20c36e66", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzg1MjM5Nw==", "url": "https://github.com/hyperledger/besu/pull/805#discussion_r417852397", "bodyText": "Block + 1 does not have to exist. You can retrieve any procotol spec for any blocks whether or not they exist", "author": "abdelhamidbakhta", "createdAt": "2020-04-30T08:45:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzgzMjMwNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzgzNjMzMA==", "url": "https://github.com/hyperledger/besu/pull/805#discussion_r417836330", "bodyText": "Is the ratio at 0 normal in this case?", "author": "matkt", "createdAt": "2020-04-30T08:18:04Z", "path": "ethereum/retesteth/src/main/java/org/hyperledger/besu/ethereum/retesteth/methods/TestMineBlocks.java", "diffHunk": "@@ -72,6 +72,7 @@ private boolean mineNewBlock() {\n             Functions.identity(),\n             context.getEthHashSolver(),\n             Wei.ZERO,\n+            0.0,", "originalCommit": "37823ba33b6a1a8c31c27aae8270c06f20c36e66", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzg1MjgzMA==", "url": "https://github.com/hyperledger/besu/pull/805#discussion_r417852830", "bodyText": "Yeah all parameters are neutral for this test. Setting it to 0 avoids some unexpected behaviour here", "author": "abdelhamidbakhta", "createdAt": "2020-04-30T08:46:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzgzNjMzMA=="}], "type": "inlineReview"}]}