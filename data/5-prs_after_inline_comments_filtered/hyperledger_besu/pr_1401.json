{"pr_number": 1401, "pr_title": "[1340] Added check for duplicate configuration ports.", "pr_createdAt": "2020-09-27T12:59:25Z", "pr_url": "https://github.com/hyperledger/besu/pull/1401", "timeline": [{"oid": "68302791a862b56d9999cfc11117004a277e3a5a", "url": "https://github.com/hyperledger/besu/commit/68302791a862b56d9999cfc11117004a277e3a5a", "message": "[1340] Added check for duplicate configuration ports.\n\nSigned-off-by: Mark Terry <mark.terry@consensys.net>", "committedDate": "2020-09-27T12:57:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjA1OTUyMg==", "url": "https://github.com/hyperledger/besu/pull/1401#discussion_r496059522", "bodyText": "Looks like we need to special case port zero, which is designed to conflict.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                          if (!allocatedPorts.add(port)) {\n          \n          \n            \n                          if (port != 0 && !allocatedPorts.add(port)) {\n          \n      \n    \n    \n  \n\nWe will also need a unit test for this.", "author": "shemnon", "createdAt": "2020-09-28T15:55:32Z", "path": "besu/src/main/java/org/hyperledger/besu/cli/BesuCommand.java", "diffHunk": "@@ -2233,6 +2238,31 @@ public EnodeDnsConfiguration getEnodeDnsConfiguration() {\n     return enodeDnsConfiguration;\n   }\n \n+  private void checkPortClash() {\n+    // List of port parameters\n+    final List<Integer> ports =\n+        asList(\n+            p2pPort,\n+            graphQLHttpPort,\n+            rpcHttpPort,\n+            rpcWsPort,\n+            metricsPort,\n+            metricsPushPort,\n+            stratumPort);\n+    ports.stream()\n+        .filter(Objects::nonNull)\n+        .forEach(\n+            port -> {\n+              if (!allocatedPorts.add(port)) {", "originalCommit": "68302791a862b56d9999cfc11117004a277e3a5a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "9d7084cfbe7b28defcfd3af168ca9121a3e89d39", "url": "https://github.com/hyperledger/besu/commit/9d7084cfbe7b28defcfd3af168ca9121a3e89d39", "message": "Update besu/src/main/java/org/hyperledger/besu/cli/BesuCommand.java\n\nCo-authored-by: Danno Ferrin <danno.ferrin@shemnon.com>\nSigned-off-by: Mark Terry <mark.terry@consensys.net>", "committedDate": "2020-09-29T10:41:52Z", "type": "commit"}, {"oid": "9d7084cfbe7b28defcfd3af168ca9121a3e89d39", "url": "https://github.com/hyperledger/besu/commit/9d7084cfbe7b28defcfd3af168ca9121a3e89d39", "message": "Update besu/src/main/java/org/hyperledger/besu/cli/BesuCommand.java\n\nCo-authored-by: Danno Ferrin <danno.ferrin@shemnon.com>\nSigned-off-by: Mark Terry <mark.terry@consensys.net>", "committedDate": "2020-09-29T10:41:52Z", "type": "forcePushed"}, {"oid": "41c4ced11cd2968ff666be23cdc2b34c5ff7cece", "url": "https://github.com/hyperledger/besu/commit/41c4ced11cd2968ff666be23cdc2b34c5ff7cece", "message": "Merge branch 'master' into 1340", "committedDate": "2020-09-29T13:08:28Z", "type": "commit"}, {"oid": "c347679c58cb5e64e1aaadf3dabd0ef5ffae5a4e", "url": "https://github.com/hyperledger/besu/commit/c347679c58cb5e64e1aaadf3dabd0ef5ffae5a4e", "message": "[1340] Added extra test for new condition.\n\nSigned-off-by: Mark Terry <mark.terry@consensys.net>", "committedDate": "2020-09-29T13:19:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzAxODU2MQ==", "url": "https://github.com/hyperledger/besu/pull/1401#discussion_r497018561", "bodyText": "Two more tests - no ports specified and every possible port specified - p2pPort, graphQLHttpPort, rpcHttpPort, rpcWsPort, metricsPort, metricsPushPort, stratumPort", "author": "shemnon", "createdAt": "2020-09-29T20:18:07Z", "path": "besu/src/test/java/org/hyperledger/besu/cli/BesuCommandTest.java", "diffHunk": "@@ -3672,4 +3672,17 @@ public void assertThatInvalidWsTimeoutSecondsFails() {\n     assertThat(commandErrorOutput.toString())\n         .contains(\"Invalid value for option\", \"--Xws-timeout-seconds\", \"abc\", \"is not a long\");\n   }\n+\n+  @Test", "originalCommit": "c347679c58cb5e64e1aaadf3dabd0ef5ffae5a4e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "32ba50269c93d1eb539a7ed5805887e671bbeb82", "url": "https://github.com/hyperledger/besu/commit/32ba50269c93d1eb539a7ed5805887e671bbeb82", "message": "[1340] Extra tests.\n\nSigned-off-by: Mark Terry <mark.terry@consensys.net>", "committedDate": "2020-10-01T02:08:56Z", "type": "commit"}]}