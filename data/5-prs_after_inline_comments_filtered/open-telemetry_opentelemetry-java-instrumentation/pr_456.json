{"pr_number": 456, "pr_title": "Merge changes from dd-trace-java 0.53.0", "pr_createdAt": "2020-05-30T19:57:06Z", "pr_url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/456", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjkwNjk2NQ==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/456#discussion_r432906965", "bodyText": "I am not sure about this attribute:\n\nIs this naming convention consistent? Do we already have attributes with names in snake_case?\nShould we produce \"derived\" attributes? Instead of 2 separate attributes \"startTime\" and \"produceTime\".\nIn any case would like to see at least a comment, explaining its meaning.", "author": "iNikem", "createdAt": "2020-05-31T03:51:39Z", "path": "instrumentation/kafka-clients-0.11/src/main/java/io/opentelemetry/auto/instrumentation/kafkaclients/KafkaDecorator.java", "diffHunk": "@@ -47,16 +48,21 @@ public String spanNameOnProduce(final ProducerRecord record) {\n     return \"destination\";\n   }\n \n-  public void onConsume(final Span span, final ConsumerRecord record) {\n+  public void onConsume(final Span span, final long startTimeMillis, final ConsumerRecord record) {\n     span.setAttribute(\"partition\", record.partition());\n     span.setAttribute(\"offset\", record.offset());\n+    // don't record a duration if the message was sent from an old Kafka client\n+    if (record.timestampType() != TimestampType.NO_TIMESTAMP_TYPE) {\n+      final long produceTime = record.timestamp();\n+      span.setAttribute(\"record.queue_time_ms\", Math.max(0L, startTimeMillis - produceTime));", "originalCommit": "51297ce023d962a5ce51ad998d0d08f2e598aedc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzUyMDM4Nw==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/456#discussion_r433520387", "bodyText": "Is this naming convention consistent? Do we already have attributes with names in snake_case?\n\nI see a couple existing with snake_case:\n\namqp.routing_key\namqp.delivery_mode\ncouchbase.operation_id\n\nI propose that we leave the name for now since we are already planning to review all non- semantic attributes for consistency / documentation.\n\nShould we produce \"derived\" attributes? Instead of 2 separate attributes \"startTime\" and \"produceTime\".\n\nSince it's not a semantic attribute, backends won't understand it, so I think better to leave it in format that is most directly queryable/interesting to users (but this is me making stuff up, I haven't seen any related spec guidance around this).\n\nIn any case would like to see at least a comment, explaining its meaning.\n\ndone", "author": "trask", "createdAt": "2020-06-01T22:20:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjkwNjk2NQ=="}], "type": "inlineReview"}, {"oid": "b95290eb001acf8599b6d368d199c3c195a092d1", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/b95290eb001acf8599b6d368d199c3c195a092d1", "message": "Add time in queue (DataDog/dd-trace-java#1481)", "committedDate": "2020-06-01T22:18:56Z", "type": "commit"}, {"oid": "582610072e223a09c5b195fa67d7cd3c132b5d9b", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/582610072e223a09c5b195fa67d7cd3c132b5d9b", "message": "Replace Set<Integer> with BitSet for HTTP statuses (DataDog/dd-trace-java#1496)", "committedDate": "2020-06-01T22:18:56Z", "type": "commit"}, {"oid": "e4eb52066823dbf2ef5c6c6a1aa505b0bc987e43", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/e4eb52066823dbf2ef5c6c6a1aa505b0bc987e43", "message": "Minor upgrades (DataDog/dd-trace-java#1495)", "committedDate": "2020-06-01T22:18:56Z", "type": "commit"}, {"oid": "9ec8e3513049fb75625c2efd17963fa738b661f2", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/9ec8e3513049fb75625c2efd17963fa738b661f2", "message": "Allow user to disable kafka time in queue tag (DataDog/dd-trace-java#1487)", "committedDate": "2020-06-01T22:18:56Z", "type": "commit"}, {"oid": "b71b0aa8c96b29864a8de02e6bbff7247b0ea252", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/b71b0aa8c96b29864a8de02e6bbff7247b0ea252", "message": "Register WeakMapProvider earlier in AgentInstaller (DataDog/dd-trace-java#1480)", "committedDate": "2020-06-01T22:18:57Z", "type": "commit"}, {"oid": "8f0c4b949275f06b37f15b978bb98b1579abb80f", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/8f0c4b949275f06b37f15b978bb98b1579abb80f", "message": "Update codenarc (DataDog/dd-trace-java#1500)", "committedDate": "2020-06-01T22:18:57Z", "type": "commit"}, {"oid": "8f0c4b949275f06b37f15b978bb98b1579abb80f", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/8f0c4b949275f06b37f15b978bb98b1579abb80f", "message": "Update codenarc (DataDog/dd-trace-java#1500)", "committedDate": "2020-06-01T22:18:57Z", "type": "forcePushed"}]}