{"pr_number": 1351, "pr_title": "Remove unnecessary scopes", "pr_createdAt": "2020-10-09T03:42:06Z", "pr_url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1351", "timeline": [{"oid": "3eac4aa651fa5586a00beae9bded018611fe6257", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/3eac4aa651fa5586a00beae9bded018611fe6257", "message": "Remove unnecessary scopes", "committedDate": "2020-10-09T03:40:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjMxNTAyNA==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1351#discussion_r502315024", "bodyText": "Here the correct parent span is important. I think this change breaks it.", "author": "iNikem", "createdAt": "2020-10-09T09:47:27Z", "path": "instrumentation/servlet/servlet-common/src/main/java/io/opentelemetry/instrumentation/auto/servlet/dispatcher/RequestDispatcherInstrumentation.java", "diffHunk": "@@ -115,18 +114,16 @@ public static void start(\n         parent = servletContext;\n       }\n \n-      try (Scope ignored = ContextUtils.withScopedContext(parent)) {\n-        span = TRACER.startSpan(method);\n+      span = TRACER.startSpan(method);", "originalCommit": "3eac4aa651fa5586a00beae9bded018611fe6257", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjU4MjE5OA==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1351#discussion_r502582198", "bodyText": "Eeek, thanks for catching this!", "author": "trask", "createdAt": "2020-10-09T17:43:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjMxNTAyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjc5NTg0Nw==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1351#discussion_r502795847", "bodyText": "Can we add a test for it?", "author": "anuraaga", "createdAt": "2020-10-10T14:22:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjMxNTAyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjk2Mzc0MA==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1351#discussion_r502963740", "bodyText": "done", "author": "trask", "createdAt": "2020-10-11T20:45:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjMxNTAyNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjMxNTQ0NA==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1351#discussion_r502315444", "bodyText": "What if processResult creates new spans? Will their parent change now?", "author": "iNikem", "createdAt": "2020-10-09T09:48:15Z", "path": "instrumentation/spymemcached-2.12/src/main/java/io/opentelemetry/instrumentation/auto/spymemcached/CompletionListener.java", "diffHunk": "@@ -28,29 +26,27 @@ public CompletionListener(MemcachedConnection connection, String methodName) {\n   }\n \n   protected void closeAsyncSpan(T future) {\n-    try (Scope ignored = currentContextWith(span)) {\n-      try {\n-        processResult(span, future);\n-      } catch (CancellationException e) {\n+    try {\n+      processResult(span, future);", "originalCommit": "3eac4aa651fa5586a00beae9bded018611fe6257", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjU4MjU5MQ==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1351#discussion_r502582591", "bodyText": "processResult is only used to populate span attributes, it doesn't make callbacks into the user code, so I think this is ok", "author": "trask", "createdAt": "2020-10-09T17:44:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjMxNTQ0NA=="}], "type": "inlineReview"}, {"oid": "d4ee45955fc1594f77e2cfe708e69f0e5baf6d4e", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/d4ee45955fc1594f77e2cfe708e69f0e5baf6d4e", "message": "revert", "committedDate": "2020-10-09T17:39:40Z", "type": "commit"}, {"oid": "8e62f8c59bf4bcfa598cc02411e2f4d357b11069", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/8e62f8c59bf4bcfa598cc02411e2f4d357b11069", "message": "Merge remote-tracking branch 'upstream/master' into unnecessary-scopes", "committedDate": "2020-10-09T17:42:08Z", "type": "commit"}, {"oid": "78158abb0268f4f66763decc6f6dcda1a3cde4b2", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/78158abb0268f4f66763decc6f6dcda1a3cde4b2", "message": "spotless", "committedDate": "2020-10-11T18:21:28Z", "type": "commit"}, {"oid": "b89cdd792bf5cbea58234b6840784b9f5728babc", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/b89cdd792bf5cbea58234b6840784b9f5728babc", "message": "Add test", "committedDate": "2020-10-11T20:44:32Z", "type": "commit"}, {"oid": "861239089f86c928bc826e6024afeeeb76dd1f21", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/861239089f86c928bc826e6024afeeeb76dd1f21", "message": "Merge remote-tracking branch 'upstream/master' into unnecessary-scopes", "committedDate": "2020-10-11T20:56:17Z", "type": "commit"}]}