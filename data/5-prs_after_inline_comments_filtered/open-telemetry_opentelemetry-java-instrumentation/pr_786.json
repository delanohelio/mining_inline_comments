{"pr_number": 786, "pr_title": "Update OTel snapshot to 723 for recordException", "pr_createdAt": "2020-07-25T04:04:47Z", "pr_url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/786", "timeline": [{"oid": "281a6cfa77b7e9257c8ef03cb58926cacc4a5729", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/281a6cfa77b7e9257c8ef03cb58926cacc4a5729", "message": "Update OTel snapshot to 723 for recordException", "committedDate": "2020-07-25T04:04:00Z", "type": "commit"}, {"oid": "a57f06406530cb0b1ba4c91a8d3cf1189cbac4cb", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/a57f06406530cb0b1ba4c91a8d3cf1189cbac4cb", "message": "Fix versions", "committedDate": "2020-07-25T04:14:47Z", "type": "commit"}, {"oid": "890ff10b1c030d0e21998275d2715cb168227d50", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/890ff10b1c030d0e21998275d2715cb168227d50", "message": "Annotations", "committedDate": "2020-07-25T04:19:01Z", "type": "commit"}, {"oid": "c88dccffe6de8cf24c7f96499de52e48fcbd8f28", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/c88dccffe6de8cf24c7f96499de52e48fcbd8f28", "message": "content length", "committedDate": "2020-07-25T04:37:50Z", "type": "commit"}, {"oid": "22ea179e663da2fab925ef81d4eb9df3a0abf6b2", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/22ea179e663da2fab925ef81d4eb9df3a0abf6b2", "message": "Update tests", "committedDate": "2020-07-25T06:51:21Z", "type": "commit"}, {"oid": "4a9c725a83c887a54783e873f83d72c80de4aa52", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/4a9c725a83c887a54783e873f83d72c80de4aa52", "message": "Spotless", "committedDate": "2020-07-25T07:33:21Z", "type": "commit"}, {"oid": "e055c89748d89e8370d9d267ec0a32ded8f0c235", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/e055c89748d89e8370d9d267ec0a32ded8f0c235", "message": "Request startAsync", "committedDate": "2020-07-26T03:09:56Z", "type": "commit"}, {"oid": "d74571a9231a253e87c4b15b62fa72357e37ca56", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/d74571a9231a253e87c4b15b62fa72357e37ca56", "message": "fix tests (#2)\n\n* spotless\r\n\r\n* fix tests", "committedDate": "2020-07-26T05:18:39Z", "type": "commit"}, {"oid": "62b5c53628bb0321223124d9059e2f923ce5c9f0", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/62b5c53628bb0321223124d9059e2f923ce5c9f0", "message": "Spotless", "committedDate": "2020-07-26T05:28:55Z", "type": "commit"}, {"oid": "e1bc328b59febf63b924a13b468d197e7fd68e7b", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/e1bc328b59febf63b924a13b468d197e7fd68e7b", "message": "Dropwizard async not work yet and finatra isn't servlet?", "committedDate": "2020-07-26T07:43:57Z", "type": "commit"}, {"oid": "321fca8cb539ee175d3f60fb718a2300988f3d76", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/321fca8cb539ee175d3f60fb718a2300988f3d76", "message": "WIP Jetty", "committedDate": "2020-07-26T09:59:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDUwNjU2NA==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/786#discussion_r460506564", "bodyText": "Notice JettyHandler didn't seem to have implemented counting, so thought it'd be a quick fix to add it, but some conflict between unnamed classloader and app classloader here :( Tomorrow will give another small look and then revert this and remove the assertion for now.", "author": "anuraaga", "createdAt": "2020-07-26T10:00:23Z", "path": "instrumentation/jetty-8.0/src/main/java/io/opentelemetry/auto/instrumentation/jetty/JettyHandlerAdvice.java", "diffHunk": "@@ -86,7 +95,14 @@ public static void stopSpan(\n \n     // Check again in case the request finished before adding the listener.\n     if (!request.isAsyncStarted() && responseHandled.compareAndSet(false, true)) {\n+      contentLengthHelper(span, response);\n       TRACER.end(span, response.getStatus());\n     }\n   }\n+\n+  public static void contentLengthHelper(Span span, ServletResponse response) {\n+    if (response instanceof CountingHttpServletResponse) {", "originalCommit": "321fca8cb539ee175d3f60fb718a2300988f3d76", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDYyMjY2Mg==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/786#discussion_r460622662", "bodyText": "Found it was because I was missing this advice from the helper classes (was referring to servlet-3.0 while writing this). Filed #796 since this was confusing.", "author": "anuraaga", "createdAt": "2020-07-27T03:02:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDUwNjU2NA=="}], "type": "inlineReview"}, {"oid": "71269154fc1551e076953bf344552cd4e0ed0cc5", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/71269154fc1551e076953bf344552cd4e0ed0cc5", "message": "Fix jetty handler instrumentation", "committedDate": "2020-07-27T03:01:13Z", "type": "commit"}, {"oid": "3dcc610b6ea5b447a4f8d2278d8c29b113c83dc8", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/3dcc610b6ea5b447a4f8d2278d8c29b113c83dc8", "message": "Merge branch 'master' of github.com:open-telemetry/opentelemetry-auto-instr-java into update-otel-snapshot-723", "committedDate": "2020-07-27T04:00:40Z", "type": "commit"}, {"oid": "12d184c5d21082302c02eec7a8eb998d53181adc", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/12d184c5d21082302c02eec7a8eb998d53181adc", "message": "Fix spark, spring", "committedDate": "2020-07-27T04:00:48Z", "type": "commit"}, {"oid": "cc548ea9e8fba500e6f9b4ed8876564cecabaf57", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/cc548ea9e8fba500e6f9b4ed8876564cecabaf57", "message": "glassfish", "committedDate": "2020-07-27T05:12:32Z", "type": "commit"}]}