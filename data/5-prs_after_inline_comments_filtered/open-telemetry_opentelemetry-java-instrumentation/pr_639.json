{"pr_number": 639, "pr_title": "[2] Create instrumentation-core:spring:spring-webflux-5.0-core ", "pr_createdAt": "2020-07-06T14:56:20Z", "pr_url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/639", "timeline": [{"oid": "1c90974fc85d1ccfc0f66ed061855c20b324a32b", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/1c90974fc85d1ccfc0f66ed061855c20b324a32b", "message": "instrumentation for spring web mvc, resttemplate and apache http client", "committedDate": "2020-07-06T17:38:10Z", "type": "commit"}, {"oid": "651be354036c47fd1545d7315dfaa4b9545e1641", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/651be354036c47fd1545d7315dfaa4b9545e1641", "message": "rollback settings.gradle regression", "committedDate": "2020-07-06T17:38:10Z", "type": "commit"}, {"oid": "68761e4de709dca8c2b6e0e8ed2d52ee61acf623", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/68761e4de709dca8c2b6e0e8ed2d52ee61acf623", "message": "remove http client", "committedDate": "2020-07-06T17:38:10Z", "type": "commit"}, {"oid": "b4b7a94df1c4d9e81dca853dc1ab442162b136e7", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/b4b7a94df1c4d9e81dca853dc1ab442162b136e7", "message": "removed event", "committedDate": "2020-07-06T17:38:10Z", "type": "commit"}, {"oid": "8a56ac4ce12ea60595dc7a135404fe432264e732", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/8a56ac4ce12ea60595dc7a135404fe432264e732", "message": "extracted spring-webflux core instrumentation", "committedDate": "2020-07-06T17:41:55Z", "type": "commit"}, {"oid": "ce8c7f8f5cb528b6e1f1b90ab1e166c723e512be", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/ce8c7f8f5cb528b6e1f1b90ab1e166c723e512be", "message": "revert spring changes", "committedDate": "2020-07-06T17:42:01Z", "type": "commit"}, {"oid": "5653eb0b28ac1c6ee9499941f580b0c95a7d4e19", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/5653eb0b28ac1c6ee9499941f580b0c95a7d4e19", "message": "hardcode package name", "committedDate": "2020-07-06T17:42:01Z", "type": "commit"}, {"oid": "5653eb0b28ac1c6ee9499941f580b0c95a7d4e19", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/5653eb0b28ac1c6ee9499941f580b0c95a7d4e19", "message": "hardcode package name", "committedDate": "2020-07-06T17:42:01Z", "type": "forcePushed"}, {"oid": "229e8a9adc4de62f263eb73dd40f838f3b8cf01d", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/229e8a9adc4de62f263eb73dd40f838f3b8cf01d", "message": "rerun tests", "committedDate": "2020-07-06T23:33:50Z", "type": "commit"}, {"oid": "229e8a9adc4de62f263eb73dd40f838f3b8cf01d", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/229e8a9adc4de62f263eb73dd40f838f3b8cf01d", "message": "rerun tests", "committedDate": "2020-07-06T23:33:50Z", "type": "forcePushed"}, {"oid": "d310881564c5adfc7541f345a0a00d263903f5d3", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/d310881564c5adfc7541f345a0a00d263903f5d3", "message": "updated dependencies", "committedDate": "2020-07-08T04:32:06Z", "type": "forcePushed"}, {"oid": "71a706cae7d87dcb51b82adf2a8eabce284648ea", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/71a706cae7d87dcb51b82adf2a8eabce284648ea", "message": "updated dependencies", "committedDate": "2020-07-08T05:04:26Z", "type": "forcePushed"}, {"oid": "eab8ad63ef6fe91ba76e238082e7f5bbe21a5553", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/eab8ad63ef6fe91ba76e238082e7f5bbe21a5553", "message": "updated dependencies", "committedDate": "2020-07-08T05:16:38Z", "type": "commit"}, {"oid": "eab8ad63ef6fe91ba76e238082e7f5bbe21a5553", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/eab8ad63ef6fe91ba76e238082e7f5bbe21a5553", "message": "updated dependencies", "committedDate": "2020-07-08T05:16:38Z", "type": "forcePushed"}, {"oid": "bf93ad70081d83ff2034f7aab3aea118de39874d", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/bf93ad70081d83ff2034f7aab3aea118de39874d", "message": "remove version", "committedDate": "2020-07-08T13:08:55Z", "type": "commit"}, {"oid": "5e3c017292147a8888a1c5ae4a32fc9775332043", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/5e3c017292147a8888a1c5ae4a32fc9775332043", "message": "Update instrumentation-core/spring/spring-webflux-5.0-core/spring-webflux-5.0-core.gradle\n\nCo-authored-by: Trask Stalnaker <trask.stalnaker@gmail.com>", "committedDate": "2020-07-09T03:09:00Z", "type": "commit"}, {"oid": "ab19a8ac69f6ddcca4d2c807ecc104d9bc8c5e90", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/ab19a8ac69f6ddcca4d2c807ecc104d9bc8c5e90", "message": "Merge branch 'master' into move_webflux_to_instcore", "committedDate": "2020-07-09T04:17:29Z", "type": "commit"}, {"oid": "b49f73a872b6a6595ad64aa5aa34bf65b825bee7", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/b49f73a872b6a6595ad64aa5aa34bf65b825bee7", "message": "renamed project and added shadow jar", "committedDate": "2020-07-09T13:52:36Z", "type": "commit"}, {"oid": "f62759aab18835b083adb35c3ae8974d23c7ecf6", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/f62759aab18835b083adb35c3ae8974d23c7ecf6", "message": "ws", "committedDate": "2020-07-09T13:55:15Z", "type": "commit"}, {"oid": "e2998c973f03ba7295b4625d72f1a7d874bd5971", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/e2998c973f03ba7295b4625d72f1a7d874bd5971", "message": "Update spring-webflux-5.0.gradle", "committedDate": "2020-07-09T13:55:38Z", "type": "commit"}, {"oid": "541121ff5d85dfa6a1bbb745b7528b3b62b19e85", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/541121ff5d85dfa6a1bbb745b7528b3b62b19e85", "message": "inject tracer into WebClientTracingFilter", "committedDate": "2020-07-09T16:56:08Z", "type": "commit"}, {"oid": "21dd15f6264da3b8a7ecb1f50370ef5ea735fc89", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/21dd15f6264da3b8a7ecb1f50370ef5ea735fc89", "message": "Merge branch 'master' into move_webflux_to_instcore", "committedDate": "2020-07-10T20:04:28Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzIyMTc5Mw==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/639#discussion_r453221793", "bodyText": "I suggest removing the no-arg constructor and passing TRACER in to the constructor below", "author": "trask", "createdAt": "2020-07-11T18:30:27Z", "path": "instrumentation-core/spring/spring-webflux-5.0/src/main/java/io/opentelemetry/instrumentation/springwebflux/client/WebClientTracingFilter.java", "diffHunk": "@@ -34,14 +35,24 @@\n \n public class WebClientTracingFilter implements ExchangeFilterFunction {\n \n+  private final Tracer tracer;\n+\n+  public WebClientTracingFilter() {\n+    this.tracer = TRACER;\n+  }\n+", "originalCommit": "21dd15f6264da3b8a7ecb1f50370ef5ea735fc89", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzIyMzAwNw==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/639#discussion_r453223007", "bodyText": "can be private or at least package-private", "author": "trask", "createdAt": "2020-07-11T18:45:02Z", "path": "instrumentation-core/spring/spring-webflux-5.0/src/main/java/io/opentelemetry/instrumentation/springwebflux/client/WebClientTracingFilter.java", "diffHunk": "@@ -34,14 +35,24 @@\n \n public class WebClientTracingFilter implements ExchangeFilterFunction {\n \n+  private final Tracer tracer;\n+\n+  public WebClientTracingFilter() {\n+    this.tracer = TRACER;\n+  }\n+\n+  public WebClientTracingFilter(Tracer tracer) {", "originalCommit": "21dd15f6264da3b8a7ecb1f50370ef5ea735fc89", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzIyMzEwNQ==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/639#discussion_r453223105", "bodyText": "I think add an overload that takes a Tracer arg for users who want to provide their own Tracer", "author": "trask", "createdAt": "2020-07-11T18:46:09Z", "path": "instrumentation-core/spring/spring-webflux-5.0/src/main/java/io/opentelemetry/instrumentation/springwebflux/client/WebClientTracingFilter.java", "diffHunk": "@@ -34,14 +35,24 @@\n \n public class WebClientTracingFilter implements ExchangeFilterFunction {\n \n+  private final Tracer tracer;\n+\n+  public WebClientTracingFilter() {\n+    this.tracer = TRACER;\n+  }\n+\n+  public WebClientTracingFilter(Tracer tracer) {\n+    this.tracer = tracer;\n+  }\n+\n   public static void addFilter(final List<ExchangeFilterFunction> exchangeFilterFunctions) {", "originalCommit": "21dd15f6264da3b8a7ecb1f50370ef5ea735fc89", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e07d8bfe8a302c8a3f1dd813d8564dd42cae4c3f", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/e07d8bfe8a302c8a3f1dd813d8564dd42cae4c3f", "message": "clean up", "committedDate": "2020-07-13T14:14:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzgwNTQ5OA==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/639#discussion_r453805498", "bodyText": "not familiar w/ the tracer provider and the value passed in get. Is it something we can inject instead? i.e., Tracer should prob be produced as a bean.", "author": "saturnism", "createdAt": "2020-07-13T17:17:45Z", "path": "instrumentation-core/spring/spring-webflux-5.0/src/main/java/io/opentelemetry/instrumentation/springwebflux/client/SpringWebfluxHttpClientDecorator.java", "diffHunk": "@@ -14,21 +14,18 @@\n  * limitations under the License.\n  */\n \n-package io.opentelemetry.auto.instrumentation.springwebflux.client;\n+package io.opentelemetry.instrumentation.springwebflux.client;\n \n import io.opentelemetry.OpenTelemetry;\n import io.opentelemetry.auto.bootstrap.instrumentation.decorator.HttpClientDecorator;\n import io.opentelemetry.trace.Span;\n import io.opentelemetry.trace.Tracer;\n import java.net.URI;\n import java.util.List;\n-import lombok.extern.slf4j.Slf4j;\n import org.springframework.web.reactive.function.client.ClientRequest;\n import org.springframework.web.reactive.function.client.ClientResponse;\n \n-@Slf4j\n-public class SpringWebfluxHttpClientDecorator\n-    extends HttpClientDecorator<ClientRequest, ClientResponse> {\n+class SpringWebfluxHttpClientDecorator extends HttpClientDecorator<ClientRequest, ClientResponse> {\n \n   public static final Tracer TRACER =", "originalCommit": "e07d8bfe8a302c8a3f1dd813d8564dd42cae4c3f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzgwODcxNQ==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/639#discussion_r453808715", "bodyText": "Nice to meet you here, Ray! :)\n@mabdinur you have done this injection for HttpServerTracer, remember? Please do the same for this decorator too. Just add one more constructor here which takes an instance of Tracer.", "author": "iNikem", "createdAt": "2020-07-13T17:22:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzgwNTQ5OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzgxMjcwMQ==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/639#discussion_r453812701", "bodyText": "I was tried to minimize the changes to the instrumentation code because  I wanted to push out small pull requests and to avoid introducing regressions. @nikita I will open another pull request to clean up the injection", "author": "mabdinur", "createdAt": "2020-07-13T17:29:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzgwNTQ5OA=="}], "type": "inlineReview"}]}