{"pr_number": 746, "pr_title": "Target OTel SDK snapshot", "pr_createdAt": "2020-07-21T10:48:16Z", "pr_url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/746", "timeline": [{"oid": "2b3170472ed9001e5d05da2f6c3dc672f70f1bfc", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/2b3170472ed9001e5d05da2f6c3dc672f70f1bfc", "message": "Target OTel SDK snapshot", "committedDate": "2020-07-21T10:47:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI0MzI5Mw==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/746#discussion_r458243293", "bodyText": "unfortunately InstrumentationContext is not documented yet (#588), but this won't work here. InstrumentationContext can only be used inside of advice classes because we change those call sites while injecting the advice, e.g. https://github.com/open-telemetry/opentelemetry-java-instrumentation/blob/master/agent-tooling/src/main/java/io/opentelemetry/auto/tooling/context/FieldBackedProvider.java#L82-L86", "author": "trask", "createdAt": "2020-07-21T16:49:07Z", "path": "instrumentation/opentelemetry-api-beta/src/main/java/io/opentelemetry/auto/instrumentation/opentelemetryapi/trace/Bridging.java", "diffHunk": "@@ -169,6 +172,12 @@ public void consume(String key, AttributeValue attributeValue) {\n         .build();\n   }\n \n+  public static io.grpc.Context toShaded(Context context) {\n+    ContextStore<Context, io.grpc.Context> contextStore =\n+        InstrumentationContext.get(Context.class, io.grpc.Context.class);", "originalCommit": "2b3170472ed9001e5d05da2f6c3dc672f70f1bfc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ4NDY5Mw==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/746#discussion_r458484693", "bodyText": "Oh bummer. Any pointer on how to convert this Context? :) If it's a hard problem, I can ask about reverting the API change, it seems like a very minor convenience.", "author": "anuraaga", "createdAt": "2020-07-22T01:44:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI0MzI5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODUxMTAxMw==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/746#discussion_r458511013", "bodyText": "for this PR i suggest\npassing ContextStore all the way down to the Span.Builder starting here: https://github.com/open-telemetry/opentelemetry-java-instrumentation/blob/master/instrumentation/opentelemetry-api-beta/src/main/java/io/opentelemetry/auto/instrumentation/opentelemetryapi/OpenTelemetryApiInstrumentation.java#L68\nsimilar to https://github.com/open-telemetry/opentelemetry-java-instrumentation/blob/master/instrumentation/opentelemetry-api-beta/src/main/java/io/opentelemetry/auto/instrumentation/opentelemetryapi/OpenTelemetryApiInstrumentation.java#L90\nand let's discuss what to do in the future in #752 \ud83d\udc4d", "author": "trask", "createdAt": "2020-07-22T03:24:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI0MzI5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODU4ODc5MQ==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/746#discussion_r458588791", "bodyText": "Thanks, plumbed", "author": "anuraaga", "createdAt": "2020-07-22T07:26:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI0MzI5Mw=="}], "type": "inlineReview"}, {"oid": "ac0cc53b456b1f693186b6d60af6f238231bf080", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/ac0cc53b456b1f693186b6d60af6f238231bf080", "message": "Merge branch 'master' of github.com:open-telemetry/opentelemetry-java-instrumentation into otel-snapshot", "committedDate": "2020-07-22T06:29:50Z", "type": "commit"}, {"oid": "9e6be7cb4f1ec123deb4f3a027b7df08a7421075", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/9e6be7cb4f1ec123deb4f3a027b7df08a7421075", "message": "Call in Mario to do some plumbing", "committedDate": "2020-07-22T07:25:42Z", "type": "commit"}]}