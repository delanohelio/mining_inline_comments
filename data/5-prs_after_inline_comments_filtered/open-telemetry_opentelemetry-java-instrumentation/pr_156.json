{"pr_number": 156, "pr_title": "Capture servlet dispatch as INTERNAL span", "pr_createdAt": "2020-02-11T18:16:15Z", "pr_url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/156", "timeline": [{"oid": "a9b41f35ef5c4eeca4f800d105b77eb1d7d4dd57", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/a9b41f35ef5c4eeca4f800d105b77eb1d7d4dd57", "message": "Capture servlet dispatch as INTERNAL span", "committedDate": "2020-02-11T05:45:29Z", "type": "commit"}, {"oid": "ff7321622937f1f02ec26243343675443860bc83", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/ff7321622937f1f02ec26243343675443860bc83", "message": "Empty commit to trigger CI", "committedDate": "2020-02-11T18:36:44Z", "type": "commit"}, {"oid": "9a6c028ee2b309c739d6664f945883ae2a41c1f2", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/9a6c028ee2b309c739d6664f945883ae2a41c1f2", "message": "Merge branch 'master' into capture-servlet-dispatch-as-internal-span", "committedDate": "2020-02-14T01:14:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDg1NjQxOA==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/156#discussion_r380856418", "bodyText": "Why remove the null check?", "author": "tylerbenson", "createdAt": "2020-02-18T18:31:14Z", "path": "instrumentation/servlet/src/main/java/io/opentelemetry/auto/instrumentation/servlet/dispatcher/RequestDispatcherInstrumentation.java", "diffHunk": "@@ -95,17 +92,15 @@ public static SpanWithScope start(\n     @Advice.OnMethodExit(onThrowable = Throwable.class, suppress = Throwable.class)\n     public static void stop(\n         @Advice.Enter final SpanWithScope spanWithScope,\n-        @Advice.Local(\"_requestSpan\") final Object requestSpan,\n+        @Advice.Local(\"_originalServletSpan\") final Object originalServletSpan,\n         @Advice.Argument(0) final ServletRequest request,\n         @Advice.Thrown final Throwable throwable) {\n       if (spanWithScope == null) {\n         return;\n       }\n \n-      if (requestSpan != null) {\n-        // now add it back...\n-        request.setAttribute(SPAN_ATTRIBUTE, requestSpan);\n-      }\n+      // restore the original servlet span\n+      request.setAttribute(SPAN_ATTRIBUTE, originalServletSpan);", "originalCommit": "9a6c028ee2b309c739d6664f945883ae2a41c1f2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDkwMjY0OA==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/156#discussion_r380902648", "bodyText": "I pushed a clarifying comment just now, does this makes sense?\n// since spanWithScope is non-null here, originalServletSpan must have been set with the prior\n// servlet span (as opposed to remaining unset)", "author": "trask", "createdAt": "2020-02-18T19:59:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDg1NjQxOA=="}], "type": "inlineReview"}, {"oid": "3e2f4988c981da2caa6450ad604a22b637fe4495", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/3e2f4988c981da2caa6450ad604a22b637fe4495", "message": "Add clarifying comment", "committedDate": "2020-02-18T19:16:54Z", "type": "commit"}, {"oid": "6e5fffb81f443c28b030486f3f00648085b443ff", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/6e5fffb81f443c28b030486f3f00648085b443ff", "message": "Merge branch 'master' into capture-servlet-dispatch-as-internal-span", "committedDate": "2020-02-18T19:56:23Z", "type": "commit"}, {"oid": "39072542a2c744edb06fb58e9c01d8a464baba30", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/39072542a2c744edb06fb58e9c01d8a464baba30", "message": "Merge branch 'master' into capture-servlet-dispatch-as-internal-span", "committedDate": "2020-02-20T03:14:17Z", "type": "commit"}, {"oid": "a027104d48892d621c4d2e87a0fe836866a148e7", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/a027104d48892d621c4d2e87a0fe836866a148e7", "message": "Merge branch 'master' into capture-servlet-dispatch-as-internal-span", "committedDate": "2020-02-21T17:10:29Z", "type": "commit"}]}