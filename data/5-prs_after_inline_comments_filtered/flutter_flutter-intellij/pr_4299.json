{"pr_number": 4299, "pr_title": "Defend against invalid refresh rates for flutter desktop devices.", "pr_createdAt": "2020-01-17T17:58:34Z", "pr_url": "https://github.com/flutter/flutter-intellij/pull/4299", "timeline": [{"oid": "f1dd2d1cb860cf2ce91e33a05e82b2e4d11617cd", "url": "https://github.com/flutter/flutter-intellij/commit/f1dd2d1cb860cf2ce91e33a05e82b2e4d11617cd", "message": "Defend against invalid refresh rates for flutter desktop devices.", "committedDate": "2020-01-17T17:57:43Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODEyNTE3MQ==", "url": "https://github.com/flutter/flutter-intellij/pull/4299#discussion_r368125171", "bodyText": "I believe that comparisons with doubles / floats are a bit fragile. The value could be something small but close to zero (0.000000001), or -0.0.\nPerhaps have a small validation method? Arbitrarily, anything > -1.0 and < 1.0 would be considered invalid?", "author": "devoncarew", "createdAt": "2020-01-17T20:35:03Z", "path": "src/io/flutter/vmService/VMServiceManager.java", "diffHunk": "@@ -630,7 +631,16 @@ public void received(JsonObject object) {\n             ret.complete(null);\n           }\n           else {\n-            ret.complete(object.get(fpsField).getAsDouble());\n+            final double fps = object.get(fpsField).getAsDouble();\n+            // Defend against invalid refresh rate for Flutter Desktop devices (0.0).\n+            if (fps == 0.0) {", "originalCommit": "f1dd2d1cb860cf2ce91e33a05e82b2e4d11617cd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE0NjEzMg==", "url": "https://github.com/flutter/flutter-intellij/pull/4299#discussion_r368146132", "bodyText": "Instead of putting this check in the VMServiceManager.java class - which currently doesn't know about the UI - perhaps move this check to the UI portion of the app which consumes this API? We'd want to make sure that we didn't perform the same check in multiple places.", "author": "devoncarew", "createdAt": "2020-01-17T21:35:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODEyNTE3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE1NjExMA==", "url": "https://github.com/flutter/flutter-intellij/pull/4299#discussion_r368156110", "bodyText": "not to bike shed but anything under 24 fps could be considered invalid as 24fps is the lowest frame rate anyone considers smooth.", "author": "jacob314", "createdAt": "2020-01-17T22:07:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODEyNTE3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE3MTI4OA==", "url": "https://github.com/flutter/flutter-intellij/pull/4299#discussion_r368171288", "bodyText": "Ah. I originally placed it in the VMServiceManager because I was afraid of it being called multiple times by the UI code that updates frequently. I now realize that even where it is in the VMServiceManager, it is called multiple times because it is triggered on each hot restart. Looks like we need to introduce an additional layer that manages this notification and prevents it from being shown multiple times.", "author": "kenzieschmoll", "createdAt": "2020-01-17T23:01:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODEyNTE3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE4MzQzMg==", "url": "https://github.com/flutter/flutter-intellij/pull/4299#discussion_r368183432", "bodyText": "Add two classes to resolve this: DisplayRefreshRateManager and NotificationManager. Ptal.", "author": "kenzieschmoll", "createdAt": "2020-01-18T00:02:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODEyNTE3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTEwMjI5Mg==", "url": "https://github.com/flutter/flutter-intellij/pull/4299#discussion_r369102292", "bodyText": "used 24 fps as the threshold", "author": "kenzieschmoll", "createdAt": "2020-01-21T16:22:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODEyNTE3MQ=="}], "type": "inlineReview"}, {"oid": "a131fc49c90fbb4a20bde05017b771af7608e960", "url": "https://github.com/flutter/flutter-intellij/commit/a131fc49c90fbb4a20bde05017b771af7608e960", "message": "Add DisplayRefreshRateManager and NotificationManager classes.", "committedDate": "2020-01-18T00:01:32Z", "type": "commit"}, {"oid": "998457f7e9ef18c83c2800625af600076e145e0e", "url": "https://github.com/flutter/flutter-intellij/commit/998457f7e9ef18c83c2800625af600076e145e0e", "message": "Use epsilon to determine invalid fps.", "committedDate": "2020-01-18T00:04:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODI0MjQ1Mw==", "url": "https://github.com/flutter/flutter-intellij/pull/4299#discussion_r368242453", "bodyText": "You'll want to switch this import to org.jetbrains.annotations.Nullable.", "author": "devoncarew", "createdAt": "2020-01-18T18:51:55Z", "path": "src/io/flutter/NotificationManager.java", "diffHunk": "@@ -0,0 +1,47 @@\n+/*\n+ * Copyright 2020 The Chromium Authors. All rights reserved.\n+ * Use of this source code is governed by a BSD-style license that can be\n+ * found in the LICENSE file.\n+ */\n+package io.flutter;\n+\n+import javax.annotation.Nullable;", "originalCommit": "998457f7e9ef18c83c2800625af600076e145e0e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTEwMjE4MA==", "url": "https://github.com/flutter/flutter-intellij/pull/4299#discussion_r369102180", "bodyText": "done.", "author": "kenzieschmoll", "createdAt": "2020-01-21T16:21:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODI0MjQ1Mw=="}], "type": "inlineReview"}, {"oid": "a141447adf2fbe64bdea2c36dd6f7fb9a46d401e", "url": "https://github.com/flutter/flutter-intellij/commit/a141447adf2fbe64bdea2c36dd6f7fb9a46d401e", "message": "Review comments.", "committedDate": "2020-01-21T16:21:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTEwODI5MA==", "url": "https://github.com/flutter/flutter-intellij/pull/4299#discussion_r369108290", "bodyText": "Not critical, but in the future we can leave copyright years as is for existing files.", "author": "devoncarew", "createdAt": "2020-01-21T16:31:40Z", "path": "src/io/flutter/performance/FrameRenderingDisplay.java", "diffHunk": "@@ -1,9 +1,9 @@\n /*\n- * Copyright 2018 The Chromium Authors. All rights reserved.\n+ * Copyright 2020 The Chromium Authors. All rights reserved.", "originalCommit": "a141447adf2fbe64bdea2c36dd6f7fb9a46d401e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTExMTg5MA==", "url": "https://github.com/flutter/flutter-intellij/pull/4299#discussion_r369111890", "bodyText": "I think this happened automatically when I moved the file. Will watch for this in the future.", "author": "kenzieschmoll", "createdAt": "2020-01-21T16:37:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTEwODI5MA=="}], "type": "inlineReview"}]}