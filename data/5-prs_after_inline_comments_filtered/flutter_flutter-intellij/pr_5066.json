{"pr_number": 5066, "pr_title": "Use existing devtools for bazel in panel and remove opening devtools for tests", "pr_createdAt": "2020-11-19T22:03:17Z", "pr_url": "https://github.com/flutter/flutter-intellij/pull/5066", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzkxMTc0MA==", "url": "https://github.com/flutter/flutter-intellij/pull/5066#discussion_r527911740", "bodyText": "why is there a 15 second timeout?", "author": "jacob314", "createdAt": "2020-11-20T19:01:21Z", "path": "src/io/flutter/devtools/DevToolsManager.java", "diffHunk": "@@ -237,23 +194,27 @@ public void openBrowserIntoPanel(String uri, ContentManager contentManager, Stri\n       devToolsInstance.openPanel(project, uri, contentManager, tabName, pageName);\n     }\n     else {\n-      @Nullable final OSProcessHandler handler =\n-        isBazel(project) ? getProcessHandlerForBazel() : getProcessHandlerForPub();\n+      if (isBazel(project)) {\n+        try {\n+          devToolsInstance = getDevToolsInstance().get(15, TimeUnit.SECONDS);", "originalCommit": "ba53f0d4a331270eca7d0306600b01962b37ea73", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTA5NTk1OQ==", "url": "https://github.com/flutter/flutter-intellij/pull/5066#discussion_r529095959", "bodyText": "I can't remember what we decided on this - keep it? Otherwise it could wait indefinitely without raising an exception.", "author": "helin24", "createdAt": "2020-11-24T01:05:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzkxMTc0MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzkxNDEyMA==", "url": "https://github.com/flutter/flutter-intellij/pull/5066#discussion_r527914120", "bodyText": "discussing offline if there is a more robust way to achieve the same result. I worry about all the extra edge cases this could introduce.", "author": "jacob314", "createdAt": "2020-11-20T19:06:07Z", "path": "src/io/flutter/devtools/DevToolsManager.java", "diffHunk": "@@ -298,6 +242,36 @@ private void openBrowserImpl(String uri, String screen) {\n     }\n   }\n \n+  private CompletableFuture<DevToolsInstance> getDevToolsInstance() {\n+    final CompletableFuture<DevToolsInstance> instance = new CompletableFuture<>();\n+    final Optional<FlutterApp> appsOptional =\n+      FlutterApp.allFromProjectProcess(project).stream().filter((FlutterApp app) -> app.getProject() == project).findFirst();", "originalCommit": "ba53f0d4a331270eca7d0306600b01962b37ea73", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTA5NzE5Mg==", "url": "https://github.com/flutter/flutter-intellij/pull/5066#discussion_r529097192", "bodyText": "I tried passing an app through to this function, but it's kind of complicated. There are a couple issues:\n\nApp has to be found this way when opening devtools from the run/debug tab, and this function is used from that workflow\nApp doesn't exist when a test is running, but I think we still want to be able to open devtools for bazel projects during tests? I'm not sure about the best way to make requests to the daemon from a test.", "author": "helin24", "createdAt": "2020-11-24T01:08:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzkxNDEyMA=="}], "type": "inlineReview"}, {"oid": "dd334e4481e03d2221fbb2464f599d5381d22220", "url": "https://github.com/flutter/flutter-intellij/commit/dd334e4481e03d2221fbb2464f599d5381d22220", "message": "Use existing devtools for bazel in panel", "committedDate": "2020-11-24T01:03:27Z", "type": "commit"}, {"oid": "53c710d794f1d872fd38e561ffa7a8417eac73ad", "url": "https://github.com/flutter/flutter-intellij/commit/53c710d794f1d872fd38e561ffa7a8417eac73ad", "message": "Use isPresent instead of isEmpty for java 8", "committedDate": "2020-11-24T01:03:27Z", "type": "commit"}, {"oid": "cc21bbb4d52cf130d422289069cf98f3b2820ccc", "url": "https://github.com/flutter/flutter-intellij/commit/cc21bbb4d52cf130d422289069cf98f3b2820ccc", "message": "Get server each time app is restarted", "committedDate": "2020-11-24T01:03:27Z", "type": "commit"}, {"oid": "4eab1df493a049421a6bbdf7ce26f54cdaeda610", "url": "https://github.com/flutter/flutter-intellij/commit/4eab1df493a049421a6bbdf7ce26f54cdaeda610", "message": "Pass app to devtools", "committedDate": "2020-11-24T01:04:09Z", "type": "commit"}, {"oid": "4eab1df493a049421a6bbdf7ce26f54cdaeda610", "url": "https://github.com/flutter/flutter-intellij/commit/4eab1df493a049421a6bbdf7ce26f54cdaeda610", "message": "Pass app to devtools", "committedDate": "2020-11-24T01:04:09Z", "type": "forcePushed"}, {"oid": "fb29b043025f899a69e40aa4abb03402b991362a", "url": "https://github.com/flutter/flutter-intellij/commit/fb29b043025f899a69e40aa4abb03402b991362a", "message": "Notes", "committedDate": "2020-11-30T20:05:23Z", "type": "commit"}, {"oid": "5c0f37bb7fb02a8c4274ed134d22414110ac03a8", "url": "https://github.com/flutter/flutter-intellij/commit/5c0f37bb7fb02a8c4274ed134d22414110ac03a8", "message": "Remove devtools action form tests", "committedDate": "2020-11-30T20:41:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjkxNDIyNg==", "url": "https://github.com/flutter/flutter-intellij/pull/5066#discussion_r532914226", "bodyText": "This code still has the problem that we are finding all FlutterApps for the project and picking one rather than usinig the app for the app being debugged. Can we pick the right app?", "author": "jacob314", "createdAt": "2020-11-30T21:26:38Z", "path": "src/io/flutter/run/OpenDevToolsAction.java", "diffHunk": "@@ -50,21 +51,29 @@ public void update(@NotNull final AnActionEvent e) {\n   public void actionPerformed(@NotNull final AnActionEvent event) {\n     FlutterInitializer.sendAnalyticsAction(this);\n \n-    if (event.getProject() == null) {\n+    Project project = event.getProject();\n+    if (project == null) {\n       return;\n     }\n \n-    final DevToolsManager devToolsManager = DevToolsManager.getInstance(event.getProject());\n+    final DevToolsManager devToolsManager = DevToolsManager.getInstance(project);\n \n-    final Optional<FlutterApp> appOptional = FlutterUtils.findFlutterAppFromProject(event.getProject());\n+    final Optional<FlutterApp> appOptional =\n+      FlutterApp.allFromProjectProcess(project).stream().filter((FlutterApp app) -> app.getProject() == project).findFirst();", "originalCommit": "5c0f37bb7fb02a8c4274ed134d22414110ac03a8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjkyNjc3Nw==", "url": "https://github.com/flutter/flutter-intellij/pull/5066#discussion_r532926777", "bodyText": "Ah yeah, I can pass the app from where OpenDevToolsAction is created.", "author": "helin24", "createdAt": "2020-11-30T21:51:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjkxNDIyNg=="}], "type": "inlineReview"}, {"oid": "811266c035ab048939f460b8f5087195c633549a", "url": "https://github.com/flutter/flutter-intellij/commit/811266c035ab048939f460b8f5087195c633549a", "message": "Set app for OpenDevToolsAction", "committedDate": "2020-11-30T21:50:51Z", "type": "commit"}]}