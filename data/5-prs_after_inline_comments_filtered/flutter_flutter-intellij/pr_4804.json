{"pr_number": 4804, "pr_title": "Skip transparent background if hardware accelerated causes error", "pr_createdAt": "2020-09-03T23:03:21Z", "pr_url": "https://github.com/flutter/flutter-intellij/pull/4804", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTcyMjI3Ng==", "url": "https://github.com/flutter/flutter-intellij/pull/4804#discussion_r485722276", "bodyText": "does HARDWARE_ACCELERATED without the transparent background work on windows? Perhaps add a comment as the placement of the try-catch makes it look like that is the problem not the HARDWARE_ACCELERATED option. I'll put it this way, if I had to pick, HARDWARE_ACCELERATED over enableTransparentBackground as one impacts performance and the other just causes a UI flicker.", "author": "jacob314", "createdAt": "2020-09-09T15:55:29Z", "path": "src/io/flutter/jxbrowser/EmbeddedBrowser.java", "diffHunk": "@@ -20,19 +21,30 @@\n import java.util.concurrent.atomic.AtomicBoolean;\n \n import static com.teamdev.jxbrowser.engine.RenderingMode.HARDWARE_ACCELERATED;\n+import static com.teamdev.jxbrowser.engine.RenderingMode.OFF_SCREEN;\n \n public class EmbeddedBrowser {\n   public void openPanel(ContentManager contentManager, String tabName, String url) {\n-    final EngineOptions options =\n+    EngineOptions options =\n       EngineOptions.newBuilder(HARDWARE_ACCELERATED).build();\n-    final Engine engine = Engine.newInstance(options);\n-    final Browser browser = engine.newBrowser();\n-    browser.settings().enableTransparentBackground();\n+    Engine engine = Engine.newInstance(options);\n+    Browser browser = engine.newBrowser();\n+\n+    try {\n+      browser.settings().enableTransparentBackground();\n+    } catch (UnsupportedRenderingModeException ex) {\n+      options =", "originalCommit": "e59e29c09ce87f595d94d5c2a6eab8a435a24f43", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTkxNTkzNw==", "url": "https://github.com/flutter/flutter-intellij/pull/4804#discussion_r485915937", "bodyText": "I can skip enabling transparent background, but HARDWARE_ACCELERATED mode also causes the window to appear to the left of the panel. Looking into if I can fix this.. maybe a swing issue?", "author": "helin24", "createdAt": "2020-09-09T20:54:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTcyMjI3Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTkxNjgxMg==", "url": "https://github.com/flutter/flutter-intellij/pull/4804#discussion_r485916812", "bodyText": "That seems like it is a jxbrowser bug on windows. Swing shouldn't have many windows specific issues.", "author": "jacob314", "createdAt": "2020-09-09T20:55:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTcyMjI3Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTkyMDY0NQ==", "url": "https://github.com/flutter/flutter-intellij/pull/4804#discussion_r485920645", "bodyText": "Hmm.. I'll post an issue and see if they have any advice.", "author": "helin24", "createdAt": "2020-09-09T21:03:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTcyMjI3Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTcyNDExNQ==", "url": "https://github.com/flutter/flutter-intellij/pull/4804#discussion_r485724115", "bodyText": "nit: having a variable named finalBrowser is a bit ugly.  A slightly cleaner option would be to have a createBrowser()helper method.\nfinal Browser browser= createBrowser(..)", "author": "jacob314", "createdAt": "2020-09-09T15:58:07Z", "path": "src/io/flutter/jxbrowser/EmbeddedBrowser.java", "diffHunk": "@@ -20,19 +21,30 @@\n import java.util.concurrent.atomic.AtomicBoolean;\n \n import static com.teamdev.jxbrowser.engine.RenderingMode.HARDWARE_ACCELERATED;\n+import static com.teamdev.jxbrowser.engine.RenderingMode.OFF_SCREEN;\n \n public class EmbeddedBrowser {\n   public void openPanel(ContentManager contentManager, String tabName, String url) {\n-    final EngineOptions options =\n+    EngineOptions options =\n       EngineOptions.newBuilder(HARDWARE_ACCELERATED).build();\n-    final Engine engine = Engine.newInstance(options);\n-    final Browser browser = engine.newBrowser();\n-    browser.settings().enableTransparentBackground();\n+    Engine engine = Engine.newInstance(options);\n+    Browser browser = engine.newBrowser();\n+\n+    try {\n+      browser.settings().enableTransparentBackground();\n+    } catch (UnsupportedRenderingModeException ex) {\n+      options =\n+        EngineOptions.newBuilder(OFF_SCREEN).build();\n+      engine = Engine.newInstance(options);\n+      browser = engine.newBrowser();\n+      browser.settings().enableTransparentBackground();\n+    }\n \n     // Multiple LoadFinished events can occur, but we only need to add content the first time.\n     final AtomicBoolean contentLoaded = new AtomicBoolean(false);\n \n     browser.navigation().loadUrl(url);\n+    final Browser finalBrowser = browser;", "originalCommit": "e59e29c09ce87f595d94d5c2a6eab8a435a24f43", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTk2MzMzOA==", "url": "https://github.com/flutter/flutter-intellij/pull/4804#discussion_r485963338", "bodyText": "If I just skip the transparent browser step, then we don't really need a separate function here.", "author": "helin24", "createdAt": "2020-09-09T22:48:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTcyNDExNQ=="}], "type": "inlineReview"}, {"oid": "312cb34c036e0c18a7bd6db4567eb7fcb4edb869", "url": "https://github.com/flutter/flutter-intellij/commit/312cb34c036e0c18a7bd6db4567eb7fcb4edb869", "message": "Use off screen render mode if hardware accelerated causes error", "committedDate": "2020-09-09T17:50:11Z", "type": "commit"}, {"oid": "f25f8ca88fb1ed5c2b7f927def20c8867cda65aa", "url": "https://github.com/flutter/flutter-intellij/commit/f25f8ca88fb1ed5c2b7f927def20c8867cda65aa", "message": "Use helper function to get browser", "committedDate": "2020-09-09T22:23:53Z", "type": "commit"}, {"oid": "b5b8accae6be442b4d77f377f74aba637c48bb5b", "url": "https://github.com/flutter/flutter-intellij/commit/b5b8accae6be442b4d77f377f74aba637c48bb5b", "message": "Skip transparent background only", "committedDate": "2020-09-09T22:44:42Z", "type": "commit"}, {"oid": "b5b8accae6be442b4d77f377f74aba637c48bb5b", "url": "https://github.com/flutter/flutter-intellij/commit/b5b8accae6be442b4d77f377f74aba637c48bb5b", "message": "Skip transparent background only", "committedDate": "2020-09-09T22:44:42Z", "type": "forcePushed"}]}