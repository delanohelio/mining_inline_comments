{"pr_number": 4714, "pr_title": "Add tests for JxBrowserManager logic and add test comments", "pr_createdAt": "2020-07-24T00:32:07Z", "pr_url": "https://github.com/flutter/flutter-intellij/pull/4714", "timeline": [{"oid": "0695a86bb2cd64e1bd188a9292db95a041b1651b", "url": "https://github.com/flutter/flutter-intellij/commit/0695a86bb2cd64e1bd188a9292db95a041b1651b", "message": "Keep loading in jxbrowser manager file", "committedDate": "2020-07-24T19:00:46Z", "type": "forcePushed"}, {"oid": "4501ee96828d6a0c7a8913d36e0942274692678e", "url": "https://github.com/flutter/flutter-intellij/commit/4501ee96828d6a0c7a8913d36e0942274692678e", "message": "Make changes for test", "committedDate": "2020-07-31T23:25:27Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDcwODE0Mg==", "url": "https://github.com/flutter/flutter-intellij/pull/4714#discussion_r464708142", "bodyText": "revert this as well.", "author": "jacob314", "createdAt": "2020-08-03T23:09:39Z", "path": "src/io/flutter/jxbrowser/EmbeddedBrowser.java", "diffHunk": "@@ -20,6 +20,7 @@\n \n public class EmbeddedBrowser {\n   public void openPanel(ContentManager contentManager, String tabName, String url) {\n+    System.setProperty(\"jxbrowser.license.key\", \"6P83ACG409A8WGBSFIBUARBTNCLB4U9JHNK8FA3N59XH5Y7ZULRCP50NN2O9TRTT4CDC\");", "originalCommit": "cfabae9d9b255ea7b4b75ddaf35c49a585cbca95", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDcwODM5Ng==", "url": "https://github.com/flutter/flutter-intellij/pull/4714#discussion_r464708396", "bodyText": "feel free to add a @VisibleForTesting annotation to these protected fields to indicate they are only there for testing.", "author": "jacob314", "createdAt": "2020-08-03T23:10:22Z", "path": "src/io/flutter/jxbrowser/JxBrowserManager.java", "diffHunk": "@@ -39,12 +41,12 @@\n // the class path.\n public class JxBrowserManager {\n   private static JxBrowserManager manager;\n-  private static final String DOWNLOAD_PATH = PathManager.getPluginsPath() + File.separatorChar + \"flutter-intellij\" + File.separatorChar + \"jxbrowser\";\n+  protected static final String DOWNLOAD_PATH = PathManager.getPluginsPath() + File.separatorChar + \"flutter-intellij\" + File.separatorChar + \"jxbrowser\";", "originalCommit": "cfabae9d9b255ea7b4b75ddaf35c49a585cbca95", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDcwODQ2MQ==", "url": "https://github.com/flutter/flutter-intellij/pull/4714#discussion_r464708461", "bodyText": "did you mean to leave this on as part of the CL?", "author": "jacob314", "createdAt": "2020-08-03T23:10:37Z", "path": "src/io/flutter/jxbrowser/JxBrowserManager.java", "diffHunk": "@@ -39,12 +41,12 @@\n // the class path.\n public class JxBrowserManager {\n   private static JxBrowserManager manager;\n-  private static final String DOWNLOAD_PATH = PathManager.getPluginsPath() + File.separatorChar + \"flutter-intellij\" + File.separatorChar + \"jxbrowser\";\n+  protected static final String DOWNLOAD_PATH = PathManager.getPluginsPath() + File.separatorChar + \"flutter-intellij\" + File.separatorChar + \"jxbrowser\";\n   private static final AtomicReference<JxBrowserStatus> status = new AtomicReference<>(JxBrowserStatus.NOT_INSTALLED);\n   private static final Logger LOG = Logger.getInstance(JxBrowserManager.class);\n   // We will be gating JxBrowser features until all of the features are landed.\n   // To test JxBrowser, set this to true and also add license key to VM options (-Djxbrowser.license.key=<key>).\n-  public static final boolean ENABLE_JX_BROWSER = false;\n+  public static final boolean ENABLE_JX_BROWSER = true;", "originalCommit": "cfabae9d9b255ea7b4b75ddaf35c49a585cbca95", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDcyNjgyNA==", "url": "https://github.com/flutter/flutter-intellij/pull/4714#discussion_r464726824", "bodyText": "I thought I was adding these testing changes in a separate branch but accidentally committed them.", "author": "helin24", "createdAt": "2020-08-04T00:13:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDcwODQ2MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDcwODU4Mw==", "url": "https://github.com/flutter/flutter-intellij/pull/4714#discussion_r464708583", "bodyText": "mark as @VisibleForTesting", "author": "jacob314", "createdAt": "2020-08-03T23:11:06Z", "path": "src/io/flutter/jxbrowser/JxBrowserManager.java", "diffHunk": "@@ -56,6 +58,10 @@ public static JxBrowserManager getInstance() {\n     return manager;\n   }\n \n+  protected static void resetForTest() {", "originalCommit": "cfabae9d9b255ea7b4b75ddaf35c49a585cbca95", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDcwODk2NA==", "url": "https://github.com/flutter/flutter-intellij/pull/4714#discussion_r464708964", "bodyText": "nit: maybe just call this deleteFile and indicate in the comment that you gracefully handle files that don't exist.", "author": "jacob314", "createdAt": "2020-08-03T23:12:16Z", "path": "src/io/flutter/utils/FileUtils.java", "diffHunk": "@@ -0,0 +1,49 @@\n+/*\n+ * Copyright 2020 The Chromium Authors. All rights reserved.\n+ * Use of this source code is governed by a BSD-style license that can be\n+ * found in the LICENSE file.\n+ */\n+package io.flutter.utils;\n+\n+import com.intellij.util.lang.UrlClassLoader;\n+\n+import java.io.File;\n+import java.net.MalformedURLException;\n+import java.net.URL;\n+\n+public class FileUtils {\n+  public static boolean makeDirectoryIfNotExists(String path) {\n+    final File directory = new File(path);\n+    if (!directory.exists()) {\n+      return directory.mkdirs();\n+    }\n+    return true;\n+  }\n+\n+  public static boolean fileExists(String path) {\n+    final File file = new File(path);\n+    return file.exists();\n+  }\n+\n+  public static boolean deleteFileIfExists(String path) {", "originalCommit": "cfabae9d9b255ea7b4b75ddaf35c49a585cbca95", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDcwOTEwNQ==", "url": "https://github.com/flutter/flutter-intellij/pull/4714#discussion_r464709105", "bodyText": "nit: maybe just call this makeDirectory or mkdirs and indicate in the comment that you gracefully handle directories that already exist.", "author": "jacob314", "createdAt": "2020-08-03T23:12:45Z", "path": "src/io/flutter/utils/FileUtils.java", "diffHunk": "@@ -0,0 +1,49 @@\n+/*\n+ * Copyright 2020 The Chromium Authors. All rights reserved.\n+ * Use of this source code is governed by a BSD-style license that can be\n+ * found in the LICENSE file.\n+ */\n+package io.flutter.utils;\n+\n+import com.intellij.util.lang.UrlClassLoader;\n+\n+import java.io.File;\n+import java.net.MalformedURLException;\n+import java.net.URL;\n+\n+public class FileUtils {\n+  public static boolean makeDirectoryIfNotExists(String path) {", "originalCommit": "cfabae9d9b255ea7b4b75ddaf35c49a585cbca95", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDcwOTM5NQ==", "url": "https://github.com/flutter/flutter-intellij/pull/4714#discussion_r464709395", "bodyText": "nit: just call\nthis loadClass as it is clear from the classLoader argument that the class is loaded with the class loader.", "author": "jacob314", "createdAt": "2020-08-03T23:13:29Z", "path": "src/io/flutter/utils/FileUtils.java", "diffHunk": "@@ -0,0 +1,49 @@\n+/*\n+ * Copyright 2020 The Chromium Authors. All rights reserved.\n+ * Use of this source code is governed by a BSD-style license that can be\n+ * found in the LICENSE file.\n+ */\n+package io.flutter.utils;\n+\n+import com.intellij.util.lang.UrlClassLoader;\n+\n+import java.io.File;\n+import java.net.MalformedURLException;\n+import java.net.URL;\n+\n+public class FileUtils {\n+  public static boolean makeDirectoryIfNotExists(String path) {\n+    final File directory = new File(path);\n+    if (!directory.exists()) {\n+      return directory.mkdirs();\n+    }\n+    return true;\n+  }\n+\n+  public static boolean fileExists(String path) {\n+    final File file = new File(path);\n+    return file.exists();\n+  }\n+\n+  public static boolean deleteFileIfExists(String path) {\n+    final File file = new File(path);\n+    if (file.exists()) {\n+      return file.delete();\n+    }\n+    return true;\n+  }\n+\n+  public static boolean loadClassWithClassLoader(ClassLoader classLoader, String path) {", "originalCommit": "cfabae9d9b255ea7b4b75ddaf35c49a585cbca95", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "0a453b780bb15c946e71140fff85b5caa30a6464", "url": "https://github.com/flutter/flutter-intellij/commit/0a453b780bb15c946e71140fff85b5caa30a6464", "message": "Add test for jxbrowser manager directory failure", "committedDate": "2020-08-24T18:09:30Z", "type": "commit"}, {"oid": "ffa7a4d01770e70798cf6d81c960e012523afa36", "url": "https://github.com/flutter/flutter-intellij/commit/ffa7a4d01770e70798cf6d81c960e012523afa36", "message": "Add test for platform missing", "committedDate": "2020-08-24T18:09:30Z", "type": "commit"}, {"oid": "ab5741826e1366f065a40a8817a1284225577fb8", "url": "https://github.com/flutter/flutter-intellij/commit/ab5741826e1366f065a40a8817a1284225577fb8", "message": "Add test for successful loading", "committedDate": "2020-08-24T18:10:15Z", "type": "commit"}, {"oid": "b2d43330d1fb0452da2572584426d80152af11d0", "url": "https://github.com/flutter/flutter-intellij/commit/b2d43330d1fb0452da2572584426d80152af11d0", "message": "Add test for missing file", "committedDate": "2020-08-24T18:10:17Z", "type": "commit"}, {"oid": "dfd45281ce387ee59290f30100e2b6b220f84cdf", "url": "https://github.com/flutter/flutter-intellij/commit/dfd45281ce387ee59290f30100e2b6b220f84cdf", "message": "Add comments to make tests easier to understand", "committedDate": "2020-08-24T18:10:17Z", "type": "commit"}, {"oid": "b63177058bfc02e6b105adca654b6fe97f20f828", "url": "https://github.com/flutter/flutter-intellij/commit/b63177058bfc02e6b105adca654b6fe97f20f828", "message": "Keep loading in jxbrowser manager file", "committedDate": "2020-08-24T18:10:17Z", "type": "commit"}, {"oid": "270d6c3f9ffad6755169d642bd22b0a6c2d1f44c", "url": "https://github.com/flutter/flutter-intellij/commit/270d6c3f9ffad6755169d642bd22b0a6c2d1f44c", "message": "Make changes for test", "committedDate": "2020-08-24T18:10:17Z", "type": "commit"}, {"oid": "4610576d97c27f16d510c5ef84018ace56a6772a", "url": "https://github.com/flutter/flutter-intellij/commit/4610576d97c27f16d510c5ef84018ace56a6772a", "message": "Revert changes for local testing and add test annotation", "committedDate": "2020-08-24T18:10:18Z", "type": "commit"}, {"oid": "395af896583b1acc249784e17d0f9f052e1be2cc", "url": "https://github.com/flutter/flutter-intellij/commit/395af896583b1acc249784e17d0f9f052e1be2cc", "message": "Rename functions and add comments", "committedDate": "2020-08-24T18:10:18Z", "type": "commit"}, {"oid": "395af896583b1acc249784e17d0f9f052e1be2cc", "url": "https://github.com/flutter/flutter-intellij/commit/395af896583b1acc249784e17d0f9f052e1be2cc", "message": "Rename functions and add comments", "committedDate": "2020-08-24T18:10:18Z", "type": "forcePushed"}]}