{"pr_number": 5046, "pr_title": "Use runScript for bazel run", "pr_createdAt": "2020-11-13T01:00:38Z", "pr_url": "https://github.com/flutter/flutter-intellij/pull/5046", "timeline": [{"oid": "db2423b9f9224fc17b8379cb940fbda416b79265", "url": "https://github.com/flutter/flutter-intellij/commit/db2423b9f9224fc17b8379cb940fbda416b79265", "message": "Use run script for bazel run", "committedDate": "2020-11-13T17:20:53Z", "type": "commit"}, {"oid": "db2423b9f9224fc17b8379cb940fbda416b79265", "url": "https://github.com/flutter/flutter-intellij/commit/db2423b9f9224fc17b8379cb940fbda416b79265", "message": "Use run script for bazel run", "committedDate": "2020-11-13T17:20:53Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzI0Mzg1Mg==", "url": "https://github.com/flutter/flutter-intellij/pull/5046#discussion_r523243852", "bodyText": "Add a TODO to remove these defines and let the run script handle this part.", "author": "jacob314", "createdAt": "2020-11-13T21:33:19Z", "path": "src/io/flutter/run/bazel/BazelFields.java", "diffHunk": "@@ -201,75 +201,38 @@ GeneralCommandLine getLaunchCommand(@NotNull Project project,\n     commandLine.setCharset(CharsetToolkit.UTF8_CHARSET);\n     commandLine.setExePath(FileUtil.toSystemDependentName(launchingScript));\n \n+    // Potentially add build mode to user-specified bazel arguments.\n+    final String inputBazelArgs = StringUtil.notNullize(bazelArgs);\n+    final StringBuilder fullBazelArgs = new StringBuilder(inputBazelArgs);\n+\n     // If the user hasn't overridden the flutter_build_mode, then\n     if (!StringUtil.notNullize(bazelArgs).matches(\".*--define[ =]flutter_build_mode.*\")) {\n+      if (!inputBazelArgs.isEmpty()) {\n+        fullBazelArgs.append(\" \");\n+      }\n \n       // Set the mode. This section needs to match the bazel versions of the flutter_build_mode parameters.\n       if (enableReleaseMode) {", "originalCommit": "db2423b9f9224fc17b8379cb940fbda416b79265", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzI0Mzk1Ng==", "url": "https://github.com/flutter/flutter-intellij/pull/5046#discussion_r523243956", "bodyText": "great to see this go away!", "author": "jacob314", "createdAt": "2020-11-13T21:33:35Z", "path": "src/io/flutter/run/bazel/BazelFields.java", "diffHunk": "@@ -201,75 +201,38 @@ GeneralCommandLine getLaunchCommand(@NotNull Project project,\n     commandLine.setCharset(CharsetToolkit.UTF8_CHARSET);\n     commandLine.setExePath(FileUtil.toSystemDependentName(launchingScript));\n \n+    // Potentially add build mode to user-specified bazel arguments.\n+    final String inputBazelArgs = StringUtil.notNullize(bazelArgs);\n+    final StringBuilder fullBazelArgs = new StringBuilder(inputBazelArgs);\n+\n     // If the user hasn't overridden the flutter_build_mode, then\n     if (!StringUtil.notNullize(bazelArgs).matches(\".*--define[ =]flutter_build_mode.*\")) {\n+      if (!inputBazelArgs.isEmpty()) {\n+        fullBazelArgs.append(\" \");\n+      }\n \n       // Set the mode. This section needs to match the bazel versions of the flutter_build_mode parameters.\n       if (enableReleaseMode) {\n-        commandLine.addParameters(\"--define\", \"flutter_build_mode=release\");\n+        fullBazelArgs.append(\"--define=flutter_build_mode=release\");\n       }\n       else {\n         switch (mode) {\n           case PROFILE:\n-            commandLine.addParameters(\"--define\", \"flutter_build_mode=profile\");\n+            fullBazelArgs.append(\"--define=flutter_build_mode=profile\");\n             break;\n           case RUN:\n           case DEBUG:\n           default:\n             // The default mode of a flutter app is debug mode. This is the mode that supports hot reloading.\n             // So far as flutter is concerned, there is no difference between debug mode and run mode;\n             // the only difference is that a debug mode app will --start-paused.\n-            commandLine.addParameters(\"--define\", \"flutter_build_mode=debug\");\n+            fullBazelArgs.append(\"--define=flutter_build_mode=debug\");\n             break;\n         }\n       }\n     }\n \n-    // User specified additional bazel arguments.", "originalCommit": "db2423b9f9224fc17b8379cb940fbda416b79265", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3ef32b2dea73da1ddd007da49ad8e7180dfdca19", "url": "https://github.com/flutter/flutter-intellij/commit/3ef32b2dea73da1ddd007da49ad8e7180dfdca19", "message": "Add TODO to move build mode to run script", "committedDate": "2020-11-13T23:09:07Z", "type": "commit"}]}