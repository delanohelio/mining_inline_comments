{"pr_number": 9196, "pr_title": "Allow maximum age of csrf cookie to be configured", "pr_createdAt": "2020-11-08T17:22:51Z", "pr_url": "https://github.com/spring-projects/spring-security/pull/9196", "timeline": [{"oid": "c5713ec11b2ac5c55f6f7cce2c30e3682131c6e9", "url": "https://github.com/spring-projects/spring-security/commit/c5713ec11b2ac5c55f6f7cce2c30e3682131c6e9", "message": "Allow maximum age of csrf cookie to be configured\n\nAllows maxAge of the generated cookie by CookieCsrfTokenRepository\nto be configurable.\n\nPrior to this commit, maximum age was set with a value of -1.\n\nAfter this commit, it will be configured by the user with an either\npositive or negative value. If the user does not provide a value,\nit will be set -1.\n\nAn IllegalArgumentException will be thrown when\nthis value is set to zero.\n\nCloses gh-9195", "committedDate": "2020-11-08T18:08:47Z", "type": "commit"}, {"oid": "c5713ec11b2ac5c55f6f7cce2c30e3682131c6e9", "url": "https://github.com/spring-projects/spring-security/commit/c5713ec11b2ac5c55f6f7cce2c30e3682131c6e9", "message": "Allow maximum age of csrf cookie to be configured\n\nAllows maxAge of the generated cookie by CookieCsrfTokenRepository\nto be configurable.\n\nPrior to this commit, maximum age was set with a value of -1.\n\nAfter this commit, it will be configured by the user with an either\npositive or negative value. If the user does not provide a value,\nit will be set -1.\n\nAn IllegalArgumentException will be thrown when\nthis value is set to zero.\n\nCloses gh-9195", "committedDate": "2020-11-08T18:08:47Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzIzNjY2NA==", "url": "https://github.com/spring-projects/spring-security/pull/9196#discussion_r523236664", "bodyText": "Can you please change this to be cookieMaxAge cannot be zero? As it is, the error the user will see if it is 0 would state it is not zero which would be confusing.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\tAssert.isTrue(cookieMaxAge != 0, \"cookieMaxAge is not zero\");\n          \n          \n            \n            \t\tAssert.isTrue(cookieMaxAge != 0, \"cookieMaxAge cannot be zero\");", "author": "rwinch", "createdAt": "2020-11-13T21:16:46Z", "path": "web/src/main/java/org/springframework/security/web/csrf/CookieCsrfTokenRepository.java", "diffHunk": "@@ -192,4 +194,30 @@ public void setSecure(Boolean secure) {\n \t\tthis.secure = secure;\n \t}\n \n+\t/**\n+\t * Sets maximum age in seconds for the cookie that the expected CSRF token is saved to\n+\t * and read from. By default maximum age value is -1.\n+\t *\n+\t * <p>\n+\t * A positive value indicates that the cookie will expire after that many seconds have\n+\t * passed. Note that the value is the <i>maximum</i> age when the cookie will expire,\n+\t * not the cookie's current age.\n+\t *\n+\t * <p>\n+\t * A negative value means that the cookie is not stored persistently and will be\n+\t * deleted when the Web browser exits.\n+\t *\n+\t * <p>\n+\t * A zero value causes the cookie to be deleted immediately therefore it is not a\n+\t * valid value and in that case an {@link IllegalArgumentException} will be thrown.\n+\t * @param cookieMaxAge an integer specifying the maximum age of the cookie in seconds;\n+\t * if negative, means the cookie is not stored; if zero, the method throws an\n+\t * {@link IllegalArgumentException}\n+\t * @since 5.5\n+\t */\n+\tpublic void setCookieMaxAge(int cookieMaxAge) {\n+\t\tAssert.isTrue(cookieMaxAge != 0, \"cookieMaxAge is not zero\");", "originalCommit": "c5713ec11b2ac5c55f6f7cce2c30e3682131c6e9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzM5NzEwNw==", "url": "https://github.com/spring-projects/spring-security/pull/9196#discussion_r523397107", "bodyText": "Thank you for your feedback. In this class there are other assertions written in this way. I've tried to follow the convention in the class. Can I change the other assertions in the same file in order to be consistent?", "author": "sedran", "createdAt": "2020-11-14T09:06:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzIzNjY2NA=="}], "type": "inlineReview"}, {"oid": "75ea7224bd4a08cf9bfa27a7eb065e4eb6323730", "url": "https://github.com/spring-projects/spring-security/commit/75ea7224bd4a08cf9bfa27a7eb065e4eb6323730", "message": "Make assertion messages in CookieCsrfTokenRepository clearer\n\nChanges assertion message format from 'X is not null' to\n'X cannot be null' since this is more meaningful when the error\noccurs and the message is printed in the logs.\n\nCloses gh-9195", "committedDate": "2020-11-17T20:13:35Z", "type": "commit"}, {"oid": "75ea7224bd4a08cf9bfa27a7eb065e4eb6323730", "url": "https://github.com/spring-projects/spring-security/commit/75ea7224bd4a08cf9bfa27a7eb065e4eb6323730", "message": "Make assertion messages in CookieCsrfTokenRepository clearer\n\nChanges assertion message format from 'X is not null' to\n'X cannot be null' since this is more meaningful when the error\noccurs and the message is printed in the logs.\n\nCloses gh-9195", "committedDate": "2020-11-17T20:13:35Z", "type": "forcePushed"}]}