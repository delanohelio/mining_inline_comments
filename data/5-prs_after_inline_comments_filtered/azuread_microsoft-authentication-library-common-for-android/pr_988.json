{"pr_number": 988, "pr_title": "Changes to resurrect telemetry test + add another constant", "pr_createdAt": "2020-08-04T21:59:39Z", "pr_url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/988", "timeline": [{"oid": "c1a2c7dcccfae2b227534db37b15c3fbe18d798d", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/c1a2c7dcccfae2b227534db37b15c3fbe18d798d", "message": "Remove bad_token suberror from fake http response for testing", "committedDate": "2020-08-04T21:54:24Z", "type": "commit"}, {"oid": "1c4b8f5c1bbba57365fced5bdf8399de1a55c2c4", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/1c4b8f5c1bbba57365fced5bdf8399de1a55c2c4", "message": "Add constant for b2c user impersonation scope", "committedDate": "2020-08-04T21:54:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzMyNDEyOQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/988#discussion_r467324129", "bodyText": "Why are we removing this?", "author": "rpdome", "createdAt": "2020-08-07T23:17:40Z", "path": "testutils/src/main/java/com/microsoft/identity/internal/testutils/mocks/MockServerResponse.java", "diffHunk": "@@ -52,7 +52,7 @@ public static HttpResponse getMockTokenFailureInvalidGrantResponse() {\n                 \"\\t\\\"trace_id\\\": \\\"8497799a-e9f9-402f-a951-7060b5014600\\\",\\n\" +\n                 \"\\t\\\"correlation_id\\\": \\\"390d7507-c607-4f05-bb8a-51a2a7a6282b\\\",\\n\" +\n                 \"\\t\\\"error_uri\\\": \\\"https://login.microsoftonline.com/error?code=70000\\\",\\n\" +\n-                \"\\t\\\"suberror\\\": \\\"bad_token\\\"\\n\" +\n+                \"\\t\\\"suberror\\\": \\\"\\\"\\n\" +", "originalCommit": "1c4b8f5c1bbba57365fced5bdf8399de1a55c2c4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzMyNTI0MA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/988#discussion_r467325240", "bodyText": "Back when the test was written, we weren't deleting tokens when a bad_token suberror was thrown by ESTS. However, we changed that behavior here  so now I've refactored this mock response to not throw the bad_token suberror so that MSAL doesn't remove tokens.....because the telemetry test was written around the old behavior. There were two ways to fix:\n\nKeep this mocked response and refactor the test to account for the fact that a bad_token suberror could wipe RT\nOr just refactor the Mock Response to not throw the bad_token suberror\n\nSo I went with the second approach", "author": "shahzaibj", "createdAt": "2020-08-07T23:22:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzMyNDEyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzMzMjM0OA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/988#discussion_r467332348", "bodyText": "given that the server is now returning bad_token, shouldn't we keep the response valid and modify the test instead?\n(IMO, the mock response should be kept as close as the actual response from the server as much as possible).", "author": "rpdome", "createdAt": "2020-08-07T23:59:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzMyNDEyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzM1MTY3MA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/988#discussion_r467351670", "bodyText": "I don't think the server will always return bad_token when invalid_grant occurs, so all we have done here is that we are mocking a different error scenario from the server. Essentially we are saying that the server is throwing an invalid_grant error here without any sub error.\nDo we know if the server would always return bad_token with an invalid_grant? (I don't think so). May be @kreedula can provide some insight?", "author": "shahzaibj", "createdAt": "2020-08-08T02:43:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzMyNDEyOQ=="}], "type": "inlineReview"}, {"oid": "94cfe74060c5fe86817e1463d90d2fa929fd217f", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/94cfe74060c5fe86817e1463d90d2fa929fd217f", "message": "Merge branch 'dev' into shahzaibj/revive-telemetry-test", "committedDate": "2020-08-21T02:53:59Z", "type": "commit"}]}