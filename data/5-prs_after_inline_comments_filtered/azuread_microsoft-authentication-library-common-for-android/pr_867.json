{"pr_number": 867, "pr_title": "Fix msal issue 963", "pr_createdAt": "2020-03-20T18:30:34Z", "pr_url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/867", "timeline": [{"oid": "570be21b6945dbc6d9ed1270d6c22af3aae8389c", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/570be21b6945dbc6d9ed1270d6c22af3aae8389c", "message": "Fix msal issue 963", "committedDate": "2020-03-20T18:30:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTgzMjY2MA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/867#discussion_r395832660", "bodyText": "This is the problem having static global variables here, changing this would be quite a bit of refactor . But for the fix , i think we should make it null in the sendResult  as it's the last exit point. What do you think?", "author": "kreedula", "createdAt": "2020-03-20T18:54:56Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/providers/oauth2/BrowserAuthorizationFragment.java", "diffHunk": "@@ -168,6 +168,7 @@ public void onResume() {\n             } else {\n                 cancelAuthorization(true);\n             }\n+            sCustomTabResponseUri = null;", "originalCommit": "570be21b6945dbc6d9ed1270d6c22af3aae8389c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTgzNDIyMg==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/867#discussion_r395834222", "bodyText": "Was going to add a similar comment; since there is static state at-play here, it would be great to have clear entry/exit points where variable state is set/reset", "author": "iambmelt", "createdAt": "2020-03-20T18:57:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTgzMjY2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTgzNDQ5NQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/867#discussion_r395834495", "bodyText": "sendResult is on the parent class and this field is not exposed to the parent. I think it is better to keep it here anyway as it is at the end of this block and this means that all the logic within it has already executed and we can safely set it to NULL", "author": "shahzaibj", "createdAt": "2020-03-20T18:58:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTgzMjY2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTgzNTU3Nw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/867#discussion_r395835577", "bodyText": "Yeah I ideally we won't have static variables and we've had a number of issues in this fragment, but I believe they are needed in our case. @rpdome Do you have any comments on this as I believe this change was introduced as part of Fragment changes and I see comments from you about using static variables. Can we move away from static?", "author": "shahzaibj", "createdAt": "2020-03-20T19:00:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTgzMjY2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTg3OTg5NA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/867#discussion_r395879894", "bodyText": "It has been there before my refactoring. From my understanding, this is the only way we can get the result back from Browser.", "author": "rpdome", "createdAt": "2020-03-20T20:41:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTgzMjY2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTg4NTI5NA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/867#discussion_r395885294", "bodyText": "Thanks @rpdome for confirming.", "author": "shahzaibj", "createdAt": "2020-03-20T20:54:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTgzMjY2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTg4NTUzMg==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/867#discussion_r395885532", "bodyText": "I agree, this would have to be static as it needs to be called from the BrowserTabActivity", "author": "shahzaibj", "createdAt": "2020-03-20T20:55:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTgzMjY2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTg4Njg5NQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/867#discussion_r395886895", "bodyText": "@iambmelt @kreedula What are you guys suggesting? The way I see it right now, the entry point (set) happens in the createCustomTabResponseIntent whereas the exit / reset will be the onResume method. I can move it to sendResult but that means exposing the field to the parent. It is already a static, I don't want to make it public as that would just cause more problems. Can't put the field on the parent class either as should not belong there as it is specific to the Browser case.", "author": "shahzaibj", "createdAt": "2020-03-20T20:58:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTgzMjY2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTg4Nzk2OQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/867#discussion_r395887969", "bodyText": "Okay, lets take the fix in then", "author": "kreedula", "createdAt": "2020-03-20T21:01:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTgzMjY2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTg5MDc1Ng==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/867#discussion_r395890756", "bodyText": "k sounds like this is as good as we're gonna do in the near term", "author": "iambmelt", "createdAt": "2020-03-20T21:09:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTgzMjY2MA=="}], "type": "inlineReview"}]}