{"pr_number": 772, "pr_title": "JENA-1934: Better error handling for bad HTML forms", "pr_createdAt": "2020-07-02T16:02:05Z", "pr_url": "https://github.com/apache/jena/pull/772", "timeline": [{"oid": "f0f92f630561d4365fd3b25d6f06b8b4c0746ca2", "url": "https://github.com/apache/jena/commit/f0f92f630561d4365fd3b25d6f06b8b4c0746ca2", "message": "JENA-1934: Better error handling for bad HTML forms", "committedDate": "2020-07-02T15:59:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTMwMzUxOQ==", "url": "https://github.com/apache/jena/pull/772#discussion_r449303519", "bodyText": "I think I got hit by this when I was writing the Vue.js client. The default value was sending JSON, or some other value, not HTML form. I couldn't figure out what was wrong, so had to look at the browser requests in the old UI to understand what the server was expecting.", "author": "kinow", "createdAt": "2020-07-02T23:08:09Z", "path": "jena-fuseki2/jena-fuseki-core/src/main/java/org/apache/jena/fuseki/server/Dispatcher.java", "diffHunk": "@@ -373,11 +382,23 @@ public static Operation chooseOperation(HttpAction action) {\n \n         // -- Any other queryString\n         // Query string now unexpected.\n+\n         // Place for an extension point.\n         boolean hasParams = request.getParameterMap().size() > 0;\n         if ( hasParams ) {\n+            // One nasty case:\n+            // Bad HTML form (content-type  application/x-www-form-urlencoded), but body is not an HTML form.\n+            //  map is one entry, and the key is all of the body,\n+            if ( WebContent.contentTypeHTMLForm.equals(request.getContentType()) ) {\n+                ServletOps.errorBadRequest(\"Malformed request: unrecognized HTML form request\");\n+                return null;\n+            }", "originalCommit": "f0f92f630561d4365fd3b25d6f06b8b4c0746ca2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTUzMTM2Nw==", "url": "https://github.com/apache/jena/pull/772#discussion_r449531367", "bodyText": "Ah. I came across it with curl but from what you say, code defaults POST to a HTML form if there is no content-type given. I guess the common case other that forms is \"just send this file, the other end knows what to do\" (i.e. ignore the content-type).\nFuseki dispatch is quite complicated and HTML forms are a possibility for SPARQL Update and SPARQL Query so it's not just simply ignoring application/x-www-form-urlencoded.", "author": "afs", "createdAt": "2020-07-03T11:21:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTMwMzUxOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTMwMzU5OQ==", "url": "https://github.com/apache/jena/pull/772#discussion_r449303599", "bodyText": "Much more descriptive! Thanks!", "author": "kinow", "createdAt": "2020-07-02T23:08:34Z", "path": "jena-fuseki2/jena-fuseki-core/src/main/java/org/apache/jena/fuseki/server/EndpointSet.java", "diffHunk": "@@ -104,7 +104,7 @@ private void resetSingle() {\n     public Collection<Operation> operations() { return endpoints.keySet(); }\n     \n     /** Get the Endpoint for a singleton EndpointSet */\n-    public Endpoint getOnly() {\n+    public Endpoint getExactlyOne() {", "originalCommit": "f0f92f630561d4365fd3b25d6f06b8b4c0746ca2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}