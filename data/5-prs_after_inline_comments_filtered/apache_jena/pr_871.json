{"pr_number": 871, "pr_title": "JENA-2003: Handle file URIs with URI scheme name", "pr_createdAt": "2020-11-25T10:43:55Z", "pr_url": "https://github.com/apache/jena/pull/871", "timeline": [{"oid": "c8c91f8b2e1c4b54e004b55f2cf50f8feb8b4b90", "url": "https://github.com/apache/jena/commit/c8c91f8b2e1c4b54e004b55f2cf50f8feb8b4b90", "message": "JENA-2003: Handle file URIs with URI scheme name", "committedDate": "2020-11-24T23:41:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDI4Mjg2OQ==", "url": "https://github.com/apache/jena/pull/871#discussion_r530282869", "bodyText": "\ud83d\udc4d", "author": "kinow", "createdAt": "2020-11-25T10:55:34Z", "path": "jena-base/src/main/java/org/apache/jena/atlas/io/IO.java", "diffHunk": "@@ -85,24 +88,75 @@ static public InputStream openFileEx(String filename) throws IOException, FileNo\n             filename = IRILib.decodeHex(filename);\n         }\n         InputStream in = new FileInputStream(filename);\n-        String ext = FilenameUtils.getExtension(filename);\n+        String ext = getExtension(filename);\n         switch ( ext ) {\n             case \"\":        return in;\n-            case \"gz\":      return new GZIPInputStream(in);\n-            case \"bz2\":     return new BZip2CompressorInputStream(in);\n-            case \"sz\":      return new SnappyCompressorInputStream(in);\n+            case ext_gz:    return new GZIPInputStream(in);\n+            case ext_bz2:   return new BZip2CompressorInputStream(in);\n+            case ext_sz:    return new SnappyCompressorInputStream(in);\n         }\n         return in;\n     }\n \n-    private static String[] extensions = { \"gz\", \"bz2\", \"sz\" };\n+    // ---- Extracted from Apache CommonsIO : FilenameUtils (2.8.0) because of the drive letter handling.\n+    private static final int NOT_FOUND = -1;\n+    private static final String EMPTY_STRING = \"\";\n+    private static final String EXTENSION_SEPARATOR = \".\";\n+    private static final char UNIX_SEPARATOR = '/';\n+    private static final char WINDOWS_SEPARATOR = '\\\\';\n+\n+    private static int indexOfLastSeparator(final String fileName) {\n+        if (fileName == null) {\n+            return NOT_FOUND;\n+        }\n+        final int lastUnixPos = fileName.lastIndexOf(UNIX_SEPARATOR);\n+        final int lastWindowsPos = fileName.lastIndexOf(WINDOWS_SEPARATOR);\n+        return Math.max(lastUnixPos, lastWindowsPos);\n+    }\n \n-    /** The filename without any compression extension, or the original filename.\n-     *  It tests for compression types handled by {@link #openFileEx}.\n+    private static int indexOfExtension(final String fileName) throws IllegalArgumentException {\n+        if (fileName == null) {\n+            return NOT_FOUND;\n+        }\n+//        if (isSystemWindows()) {\n+//            // Special handling for NTFS ADS: Don't accept colon in the fileName.\n+//            final int offset = fileName.indexOf(':', getAdsCriticalOffset(fileName));\n+//            if (offset != -1) {\n+//                throw new IllegalArgumentException(\"NTFS ADS separator (':') in file name is forbidden.\");\n+//            }\n+//        }", "originalCommit": "c8c91f8b2e1c4b54e004b55f2cf50f8feb8b4b90", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}