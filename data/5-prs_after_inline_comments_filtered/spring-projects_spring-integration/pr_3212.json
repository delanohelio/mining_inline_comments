{"pr_number": 3212, "pr_title": "GH-3211: Add DefSftpSF.setKnownHosts(Resource)", "pr_createdAt": "2020-03-10T19:43:31Z", "pr_url": "https://github.com/spring-projects/spring-integration/pull/3212", "timeline": [{"oid": "02451c1190411525d34ccf77abf3039bbb44e542", "url": "https://github.com/spring-projects/spring-integration/commit/02451c1190411525d34ccf77abf3039bbb44e542", "message": "GH-3211: Add DefSftpSF.setKnownHosts(Resource)\n\nFixes https://github.com/spring-projects/spring-integration/issues/3211\n\n* Add `DefaultSftpSessionFactory.setKnownHosts(Resource)` to\nallow to configure externally any resource for file with known_hosts content\n* Deprecate an existing method in favor of new one\n* The new method makes it aligned with the `setPrivateKey(Resource)`\n* Fix tests do not use a deprecated method any more\n\n**Cherry-pick to 5.2.x**", "committedDate": "2020-03-10T19:43:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDU2OTY4NQ==", "url": "https://github.com/spring-projects/spring-integration/pull/3212#discussion_r390569685", "bodyText": "Won't this cause a problem with <bean/> config? (ambiguous setter) setKnownHostsResource() ?", "author": "garyrussell", "createdAt": "2020-03-10T19:48:36Z", "path": "spring-integration-sftp/src/main/java/org/springframework/integration/sftp/session/DefaultSftpSessionFactory.java", "diffHunk": "@@ -191,8 +193,21 @@ public void setPassword(String password) {\n \t * false (default).</b>\n \t * @param knownHosts The known hosts.\n \t * @see JSch#setKnownHosts(String)\n+\t * @deprecated since 5.2.5 in favor of {@link #setKnownHosts(Resource)}\n \t */\n+\t@Deprecated\n \tpublic void setKnownHosts(String knownHosts) {\n+\t\tsetKnownHosts(new FileSystemResource(knownHosts));\n+\t}\n+\n+\t/**\n+\t * Specifies the filename that will be used for a host key repository.\n+\t * The file has the same format as OpenSSH's known_hosts file.\n+\t * @param knownHosts the resource for known hosts.\n+\t * @see JSch#setKnownHosts(InputStream)\n+\t * @since 5.2.5\n+\t */\n+\tpublic void setKnownHosts(Resource knownHosts) {", "originalCommit": "02451c1190411525d34ccf77abf3039bbb44e542", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDU4MTAyNQ==", "url": "https://github.com/spring-projects/spring-integration/pull/3212#discussion_r390581025", "bodyText": "Looks like Juergen has fixed something in SF. See Travis \ud83d\ude04", "author": "artembilan", "createdAt": "2020-03-10T20:09:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDU2OTY4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDU4MzA1Ng==", "url": "https://github.com/spring-projects/spring-integration/pull/3212#discussion_r390583056", "bodyText": "If I recall correctly, failures were random; also it looks like you changed all the tests to return a Resource using SpEL.\nPerhaps the problem only occurs when a PropertyEditor is needed (although I remember most of the problems were with String Vs. Expression .\nI will defer to you, though, if you think it's safe.", "author": "garyrussell", "createdAt": "2020-03-10T20:13:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDU2OTY4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDU5MzY2Nw==", "url": "https://github.com/spring-projects/spring-integration/pull/3212#discussion_r390593667", "bodyText": "Well, I can rename it to setKnownHostsResource to have it really very safe...", "author": "artembilan", "createdAt": "2020-03-10T20:33:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDU2OTY4NQ=="}], "type": "inlineReview"}, {"oid": "7de122d325c3f38d853a86e1bd1c7d4d73dc682e", "url": "https://github.com/spring-projects/spring-integration/commit/7de122d325c3f38d853a86e1bd1c7d4d73dc682e", "message": "* Rename to `setKnownHostsResource()` to avoid XML parser confusion\n* Change `sftp.adoc` to reflect a new property", "committedDate": "2020-03-10T20:37:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDU5ODUyOA==", "url": "https://github.com/spring-projects/spring-integration/pull/3212#discussion_r390598528", "bodyText": "Should we really deprecate? This is easier if you are using Java Config and want to point to a simple file name.\nNot related to this PR but perhaps we should consider adding a SftpSessionFactorySpec ?", "author": "garyrussell", "createdAt": "2020-03-10T20:43:02Z", "path": "spring-integration-sftp/src/main/java/org/springframework/integration/sftp/session/DefaultSftpSessionFactory.java", "diffHunk": "@@ -191,8 +193,21 @@ public void setPassword(String password) {\n \t * false (default).</b>\n \t * @param knownHosts The known hosts.\n \t * @see JSch#setKnownHosts(String)\n+\t * @deprecated since 5.2.5 in favor of {@link #setKnownHostsResource(Resource)}\n \t */\n+\t@Deprecated", "originalCommit": "7de122d325c3f38d853a86e1bd1c7d4d73dc682e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDU5OTU2Ng==", "url": "https://github.com/spring-projects/spring-integration/pull/3212#discussion_r390599566", "bodyText": "Then we need also to add a string-based for privateKey.\nMore over it is better to resolve any resources via @Value Resource then inject.", "author": "artembilan", "createdAt": "2020-03-10T20:44:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDU5ODUyOA=="}], "type": "inlineReview"}]}