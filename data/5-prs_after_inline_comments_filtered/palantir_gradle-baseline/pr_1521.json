{"pr_number": 1521, "pr_title": "Implement DeprecatedGuavaObjects error-prone migration", "pr_createdAt": "2020-10-22T14:55:15Z", "pr_url": "https://github.com/palantir/gradle-baseline/pull/1521", "timeline": [{"oid": "747156ca2d7cd8af39905c71760af199cfd5ee87", "url": "https://github.com/palantir/gradle-baseline/commit/747156ca2d7cd8af39905c71760af199cfd5ee87", "message": "Implement DeprecatedGuavaObjects migration", "committedDate": "2020-10-22T14:54:47Z", "type": "commit"}, {"oid": "52ac1ded313289142fe30b7795be11097e2a0a76", "url": "https://github.com/palantir/gradle-baseline/commit/52ac1ded313289142fe30b7795be11097e2a0a76", "message": "Add generated changelog entries", "committedDate": "2020-10-22T14:51:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDIzNzc0OQ==", "url": "https://github.com/palantir/gradle-baseline/pull/1521#discussion_r510237749", "bodyText": "should we treat single arg version differently to map to java.util.Objects.hashCode(Object) and varargs maps to java.util.Objects.hash(Objects...)?", "author": "schlosna", "createdAt": "2020-10-22T15:05:36Z", "path": "baseline-error-prone/src/main/java/com/palantir/baseline/errorprone/DeprecatedGuavaObjects.java", "diffHunk": "@@ -0,0 +1,70 @@\n+/*\n+ * (c) Copyright 2020 Palantir Technologies Inc. All rights reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.palantir.baseline.errorprone;\n+\n+import com.google.auto.service.AutoService;\n+import com.google.errorprone.BugPattern;\n+import com.google.errorprone.BugPattern.LinkType;\n+import com.google.errorprone.BugPattern.SeverityLevel;\n+import com.google.errorprone.VisitorState;\n+import com.google.errorprone.bugpatterns.BugChecker;\n+import com.google.errorprone.fixes.SuggestedFix;\n+import com.google.errorprone.matchers.Description;\n+import com.google.errorprone.matchers.Matcher;\n+import com.google.errorprone.matchers.method.MethodMatchers;\n+import com.sun.source.tree.ExpressionTree;\n+import com.sun.source.tree.MethodInvocationTree;\n+\n+@AutoService(BugChecker.class)\n+@BugPattern(\n+        name = \"DeprecatedGuavaObjects\",\n+        link = \"https://github.com/palantir/gradle-baseline#baseline-error-prone-checks\",\n+        linkType = LinkType.CUSTOM,\n+        severity = SeverityLevel.WARNING,\n+        summary = \"The standard library java.util.Objects utilities replace Guava \"\n+                + \"com.google.common.base.Objects in java 1.7 and beyond.\")\n+public final class DeprecatedGuavaObjects extends BugChecker implements BugChecker.MethodInvocationTreeMatcher {\n+\n+    private static final String GUAVA_OBJECTS_NAME = \"com.google.common.base.Objects\";\n+    private static final String GUAVA_OBJECTS_EQUAL = GUAVA_OBJECTS_NAME + \".equal\";\n+    private static final String GUAVA_OBJECTS_HASH_CODE = GUAVA_OBJECTS_NAME + \".hashCode\";\n+    private static final String JAVA_OBJECTS_NAME = \"java.util.Objects\";\n+    private static final Matcher<ExpressionTree> EQUAL_MATCHER = MethodMatchers.staticMethod()\n+            .onClass(\"com.google.common.base.Objects\")\n+            .named(\"equal\");\n+    private static final Matcher<ExpressionTree> HASH_CODE_MATCHER = MethodMatchers.staticMethod()\n+            .onClass(\"com.google.common.base.Objects\")\n+            .named(\"hashCode\");", "originalCommit": "52ac1ded313289142fe30b7795be11097e2a0a76", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDI0MTc2NQ==", "url": "https://github.com/palantir/gradle-baseline/pull/1521#discussion_r510241765", "bodyText": "I was planning to keep this simple as a direct migration and write a separate check for java.util.Objects.hash(value) -> java.util.Objects.hashCode(value) to eventually resolve to the ideal implementation.\nThat would result in the first refactor run failing in this case, so it might be fine to share the complexity with this check as well. What do you think?", "author": "carterkozak", "createdAt": "2020-10-22T15:11:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDIzNzc0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDI1MzE2Mw==", "url": "https://github.com/palantir/gradle-baseline/pull/1521#discussion_r510253163", "bodyText": "\ud83d\udc4d your proposal makes sense to me and is additive beyond just the Guava -> java.util conversion", "author": "schlosna", "createdAt": "2020-10-22T15:25:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDIzNzc0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDI2MTc1Mg==", "url": "https://github.com/palantir/gradle-baseline/pull/1521#discussion_r510261752", "bodyText": "PR is #1522", "author": "carterkozak", "createdAt": "2020-10-22T15:37:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDIzNzc0OQ=="}], "type": "inlineReview"}]}