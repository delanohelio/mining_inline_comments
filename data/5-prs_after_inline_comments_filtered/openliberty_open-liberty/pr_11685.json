{"pr_number": 11685, "pr_title": "Update JPA Spec 1.0 Query FAT to be multi-db supportive.", "pr_createdAt": "2020-04-07T20:05:21Z", "pr_url": "https://github.com/OpenLiberty/open-liberty/pull/11685", "timeline": [{"oid": "f50c38b7730c8f605528e334800d326c1f561793", "url": "https://github.com/OpenLiberty/open-liberty/commit/f50c38b7730c8f605528e334800d326c1f561793", "message": "Update JPA Spec 1.0 Query FAT to be multi-db supportive.\n\nSigned-off-by: Joe Grassel <jgrassel@us.ibm.com>", "committedDate": "2020-04-08T15:53:31Z", "type": "commit"}, {"oid": "f50c38b7730c8f605528e334800d326c1f561793", "url": "https://github.com/OpenLiberty/open-liberty/commit/f50c38b7730c8f605528e334800d326c1f561793", "message": "Update JPA Spec 1.0 Query FAT to be multi-db supportive.\n\nSigned-off-by: Joe Grassel <jgrassel@us.ibm.com>", "committedDate": "2020-04-08T15:53:31Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTcyODkxOA==", "url": "https://github.com/OpenLiberty/open-liberty/pull/11685#discussion_r405728918", "bodyText": "What was the necessity of changing the test? Was the test failing without this change? What DBs fail without this change?", "author": "dazey3", "createdAt": "2020-04-08T18:30:04Z", "path": "dev/com.ibm.ws.jpa_spec10_query_fat/test-applications/olgh8014/src/com/ibm/ws/jpa/olgh8014/testlogic/JPATestOLGH8014Logic.java", "diffHunk": "@@ -387,7 +387,7 @@ public void testAggregateFunctionsWithPrimitives(TestExecutionContext testExecCt\n                 Assert.assertEquals(new Integer(20), res);\n             } else {\n                 //The specification defined assertion\n-                Assert.assertEquals(new Double(20), res);\n+                Assert.assertEquals(new Double(20).doubleValue(), (double) res, 0.5);", "originalCommit": "f50c38b7730c8f605528e334800d326c1f561793", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTc1OTI0Mg==", "url": "https://github.com/OpenLiberty/open-liberty/pull/11685#discussion_r405759242", "bodyText": "You might have noticed the last argument, which allows for wriggle room.  Remember how float and decimal values are not precise, and can vary?  (hint: no reputable bank stores an account balance using decimals and floats)", "author": "jgrassel", "createdAt": "2020-04-08T19:23:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTcyODkxOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjMyNDQ3OQ==", "url": "https://github.com/OpenLiberty/open-liberty/pull/11685#discussion_r406324479", "bodyText": "So you added the delta as a precaution, but there were no test failures that lead to this change?", "author": "dazey3", "createdAt": "2020-04-09T16:24:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTcyODkxOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjQzMDgyMg==", "url": "https://github.com/OpenLiberty/open-liberty/pull/11685#discussion_r406430822", "bodyText": "Without them, Oracle and SQLServer failed because the database did not store the float value exactly the same as as the JVM's value.  So when the query executed, the float value returned was difference.  Because 2.1 != 2.11.  So the third argument is a tolerance for that variance.", "author": "jgrassel", "createdAt": "2020-04-09T19:34:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTcyODkxOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjQ1OTY3MQ==", "url": "https://github.com/OpenLiberty/open-liberty/pull/11685#discussion_r406459671", "bodyText": "Hmm. That seems like an issue. Customers aren't going to be ok with an arbitrary tolerance tho. Do you have the test results you could send me? Id like to take a look.", "author": "dazey3", "createdAt": "2020-04-09T20:31:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTcyODkxOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjQ5MDIzNA==", "url": "https://github.com/OpenLiberty/open-liberty/pull/11685#discussion_r406490234", "bodyText": "Will, this is at the jdbc/database level.  Go ahead and try it with some raw JDBC.", "author": "jgrassel", "createdAt": "2020-04-09T21:33:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTcyODkxOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjkzMjkxMA==", "url": "https://github.com/OpenLiberty/open-liberty/pull/11685#discussion_r406932910", "bodyText": "Maybe these tests are pretty useless then. They were meant to test precise return values, but every database returns a different result.", "author": "dazey3", "createdAt": "2020-04-10T20:38:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTcyODkxOA=="}], "type": "inlineReview"}, {"oid": "3b30076365ed55875eb3312bcf520b0261330bbb", "url": "https://github.com/OpenLiberty/open-liberty/commit/3b30076365ed55875eb3312bcf520b0261330bbb", "message": "Address review comments for PR Update JPA Spec 1.0 Query FAT to be multi-db supportive. #11685\n\nSigned-off-by: Joe Grassel <jgrassel@us.ibm.com>", "committedDate": "2020-04-09T20:10:40Z", "type": "commit"}]}