{"pr_number": 13353, "pr_title": "Kerberos datasource bindings and password support", "pr_createdAt": "2020-08-06T18:24:32Z", "pr_url": "https://github.com/OpenLiberty/open-liberty/pull/13353", "timeline": [{"oid": "60317fb17f1eef027f5ea5572555d8058111153c", "url": "https://github.com/OpenLiberty/open-liberty/commit/60317fb17f1eef027f5ea5572555d8058111153c", "message": "Add test for rebinding auth-data in IBM binding files", "committedDate": "2020-08-06T15:47:20Z", "type": "commit"}, {"oid": "86698057a3062f0e5005bf6f5f72e80832689eba", "url": "https://github.com/OpenLiberty/open-liberty/commit/86698057a3062f0e5005bf6f5f72e80832689eba", "message": "Add support for providing kerberos password via authData password attribute", "committedDate": "2020-08-06T18:19:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY4MTc2MA==", "url": "https://github.com/OpenLiberty/open-liberty/pull/13353#discussion_r466681760", "bodyText": "I just wonder why we do not use WSCallbackHandlerImpl.java instead of Krb5CallbackHandler?", "author": "utle", "createdAt": "2020-08-06T20:56:44Z", "path": "dev/com.ibm.ws.security.kerberos.auth/src/com/ibm/ws/security/kerberos/auth/KerberosService.java", "diffHunk": "@@ -110,28 +123,48 @@ public Path getKeytab() {\n      * @return A valid subject for the supplied principal\n      */\n     public Subject getOrCreateSubject(String principal) throws LoginException {\n+        return getOrCreateSubject(principal, null);\n+    }\n+\n+    /**\n+     * Checks the Subject cache for an existing Subject matching the supplied principal.\n+     * A simple LRU cache is used to store cache Subjects\n+     * If a valid subject is not found in the cache, then a new Kerberos login is performed and\n+     * the resulting Subject is cached.\n+     *\n+     * @param principal The principal to obtain a subject for\n+     * @param pass      The password to be used via CallbackHandler. This will only be used if no password\n+     *                      is found in the credential cache or keytab files first.\n+     * @return A valid subject for the supplied principal\n+     */\n+    public Subject getOrCreateSubject(String principal, SerializableProtectedString pass) throws LoginException {\n         KerberosPrincipal krb5Principal = new KerberosPrincipal(principal);\n         Subject cachedSubject = subjectCache.get(krb5Principal);\n         if (cachedSubject != null) {\n             return cachedSubject;\n         }\n \n-        Subject createdSubject = doKerberosLogin(principal);\n+        Subject createdSubject = doKerberosLogin(principal, pass);\n \n         subjectCache.put(krb5Principal, createdSubject);\n         return createdSubject;\n     }\n \n-    private Subject doKerberosLogin(String principal) throws LoginException {\n+    private Subject doKerberosLogin(String principal, SerializableProtectedString pass) throws LoginException {\n         Subject subject = new Subject();\n         Krb5LoginModuleWrapper krb5 = new Krb5LoginModuleWrapper();\n         Map<String, String> options = new HashMap<String, String>();\n         Map<String, Object> sharedState = new HashMap<String, Object>();\n+        CallbackHandler callback = pass == null ? null : new Krb5CallbackHandler(pass);", "originalCommit": "86698057a3062f0e5005bf6f5f72e80832689eba", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjczODAzNw==", "url": "https://github.com/OpenLiberty/open-liberty/pull/13353#discussion_r466738037", "bodyText": "I didn't know we had WSCallbackHandlerImpl, I could use that but it looks like we'd need to also supply a username for that callback, and here I just want to supply a password specifically for PasswordCallbacks", "author": "aguibert", "createdAt": "2020-08-06T23:25:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY4MTc2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc2MjI2NA==", "url": "https://github.com/OpenLiberty/open-liberty/pull/13353#discussion_r466762264", "bodyText": "I think you can supply null for user name", "author": "utle", "createdAt": "2020-08-07T00:55:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY4MTc2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzIzMTg4OA==", "url": "https://github.com/OpenLiberty/open-liberty/pull/13353#discussion_r467231888", "bodyText": "will change this to WSCallbackHandlerImpl in a follow-on item", "author": "aguibert", "createdAt": "2020-08-07T19:33:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY4MTc2MA=="}], "type": "inlineReview"}]}