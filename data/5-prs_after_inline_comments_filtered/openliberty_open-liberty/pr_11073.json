{"pr_number": 11073, "pr_title": "Adding beta tag", "pr_createdAt": "2020-02-26T18:47:36Z", "pr_url": "https://github.com/OpenLiberty/open-liberty/pull/11073", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjU5NjM1NQ==", "url": "https://github.com/OpenLiberty/open-liberty/pull/11073#discussion_r386596355", "bodyText": "Fix this comment's grammar/spacing", "author": "FlynnIBM", "createdAt": "2020-03-02T19:18:17Z", "path": "dev/com.ibm.ws.kernel.boot.core/src/com/ibm/ws/kernel/productinfo/ProductInfo.java", "diffHunk": "@@ -225,6 +227,46 @@ public String getProperty(String key) {\n         return value;\n     }\n \n+    /**", "originalCommit": "710cc522a0ca0e47b14fb250647e541d51d9a303", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjU5Njg2OQ==", "url": "https://github.com/OpenLiberty/open-liberty/pull/11073#discussion_r386596869", "bodyText": "Remove system.outs from function", "author": "FlynnIBM", "createdAt": "2020-03-02T19:19:21Z", "path": "dev/com.ibm.ws.kernel.boot.core/src/com/ibm/ws/kernel/productinfo/ProductInfo.java", "diffHunk": "@@ -225,6 +227,46 @@ public String getProperty(String key) {\n         return value;\n     }\n \n+    /**\n+     * Helper method to check if EARLY_ACCESS is detection in the edition\n+     *\n+     */\n+    public boolean isBeta() {\n+        boolean isBeta;\n+        String productEdition = this.getEdition();\n+        if (productEdition == null) {\n+            isBeta = false;\n+        } else {\n+            isBeta = productEdition.equals(EARLY_ACCESS);\n+        }\n+        return isBeta;\n+    }\n+\n+    /**\n+     * Checks if the current version is in early access and then sets the BETA_EDITION_JVM_PROPERTY. It will\n+     * be set to true if it found the early access tag else false.\n+     *\n+     */\n+    public static void isAnyProductBeta() {\n+        try {\n+            System.out.println(\"Inside isAnyProductBeta \" + System.getProperty(BETA_EDITION_JVM_PROPERTY));", "originalCommit": "710cc522a0ca0e47b14fb250647e541d51d9a303", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "c6db636a14c57f9e0905ff2c921235fbb85e7c6e", "url": "https://github.com/OpenLiberty/open-liberty/commit/c6db636a14c57f9e0905ff2c921235fbb85e7c6e", "message": "Minor edits to comments. Made sure beta system property set to false if exception thrown", "committedDate": "2020-03-02T20:24:05Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODU3MjkwOA==", "url": "https://github.com/OpenLiberty/open-liberty/pull/11073#discussion_r388572908", "bodyText": "The method name isAnyProductBeta seems odd.  I was expecting it to return something. Its purpose seems to be to ensure the java property is set.", "author": "tspewak", "createdAt": "2020-03-05T21:21:52Z", "path": "dev/com.ibm.ws.kernel.boot.core/src/com/ibm/ws/kernel/productinfo/ProductInfo.java", "diffHunk": "@@ -225,6 +227,41 @@ public String getProperty(String key) {\n         return value;\n     }\n \n+    /**\n+     * Helper method for determining if product is EARLY_ACCESS edition\n+     */\n+    public boolean isBeta() {\n+        boolean isBeta;\n+        String productEdition = this.getEdition();\n+        if (productEdition == null) {\n+            isBeta = false;\n+        } else {\n+            isBeta = productEdition.equals(EARLY_ACCESS);\n+        }\n+        return isBeta;\n+    }\n+\n+    /**\n+     * Sets the com.ibm.ws.beta.edition JVM property to true if the Liberty version is EARLY_ACCESS,\n+     * otherwise sets it to false.\n+     */\n+    public static void isAnyProductBeta() {", "originalCommit": "c6db636a14c57f9e0905ff2c921235fbb85e7c6e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODU3Mzg2MQ==", "url": "https://github.com/OpenLiberty/open-liberty/pull/11073#discussion_r388573861", "bodyText": "would be better if it was   \"JVM option com.ibm.ws.beta.edition was not found\"", "author": "tspewak", "createdAt": "2020-03-05T21:23:47Z", "path": "dev/com.ibm.ws.kernel.boot_fat/fat/src/com/ibm/ws/kernel/boot/ServerStartJVMOptionsTest.java", "diffHunk": "@@ -564,6 +564,79 @@ public void testStartServerCmdlineJVMOptionsAndSystemProps() throws Exception {\n         server.stopServer();\n     }\n \n+    /**\n+     * This test ensures the beta system property is set. It can either be true or false depending on the\n+     * early access tag in the productInfo\n+     */\n+    @Test\n+    @Mode(TestMode.LITE)\n+    public void testServerStartBETAJVMOption() throws Exception {\n+        Log.entering(c, testName.getMethodName());\n+\n+        String[] parms = new String[2];\n+        parms[0] = \"start\";\n+        parms[1] = SERVER_NAME;\n+\n+        Properties envVars = new Properties();\n+        envVars.put(\"CDPATH\", \".\");\n+\n+        initialize();\n+\n+        ProgramOutput po = server.getMachine().execute(serverCommand, parms, executionDir, envVars);\n+        Log.info(c, testName.getMethodName(), \"server start stdout = \" + po.getStdout());\n+        Log.info(c, testName.getMethodName(), \"server start stderr = \" + po.getStderr());\n+        server.waitForStringInLog(\"CWWKF0011I\");\n+        server.resetStarted();\n+\n+        server.serverDump();\n+        File[] filesAfterDump = new File(executionDir + \"/usr/servers/\" + SERVER_NAME).listFiles();\n+\n+        File dumpFile = new File(\"\");\n+        for (File f : filesAfterDump) {\n+            String fileName = f.getName();\n+            Log.info(c, testName.getMethodName(), \"Found file: \" + fileName);\n+            if (fileName.startsWith(SERVER_NAME + \".dump\") && fileName.endsWith(\".zip\")) {\n+                dumpFile = f;\n+                break;\n+            }\n+        }\n+\n+        if (dumpFile.getPath().compareTo(\"\") == 0) {\n+            fail(\"The Dump File was not found\");\n+        }\n+\n+        ZipFile zipFile = new ZipFile(dumpFile);\n+\n+        boolean foundTest1 = false;\n+        for (Enumeration<? extends ZipEntry> en = zipFile.entries(); en.hasMoreElements();) {\n+            ZipEntry entry = en.nextElement();\n+            String entryName = entry.getName();\n+            if (entryName.endsWith(\"JavaRuntimeInformation.txt\")) {\n+                InputStream inputstream = zipFile.getInputStream(entry);\n+                BufferedReader reader = new BufferedReader(new InputStreamReader(inputstream));\n+                String line;\n+                int i = 0;\n+                while ((line = reader.readLine()) != null) {\n+                    Log.info(c, testName.getMethodName(), \"Run\" + i + \": \" + line);\n+                    if (line.contains(\"com.ibm.ws.beta.edition=false\") || line.contains(\"com.ibm.ws.beta.edition=true\")) {\n+                        foundTest1 = true;\n+                        break;\n+                    }\n+                    i++;\n+                }\n+\n+                reader.close();\n+                inputstream.close();\n+            }\n+        }\n+\n+        zipFile.close();\n+        dumpFile.delete();\n+        assertTrue(\"The jvm option was not found\", foundTest1);", "originalCommit": "c6db636a14c57f9e0905ff2c921235fbb85e7c6e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODU4NjA3MQ==", "url": "https://github.com/OpenLiberty/open-liberty/pull/11073#discussion_r388586071", "bodyText": "copyright...apparently any change other than comment updates require a copyright update....Add the second year to the copyright above.", "author": "ginnick", "createdAt": "2020-03-05T21:48:42Z", "path": "dev/com.ibm.ws.kernel.boot.core/src/com/ibm/ws/kernel/productinfo/ProductInfo.java", "diffHunk": "@@ -41,6 +41,8 @@\n     public static final String COM_IBM_WEBSPHERE_PRODUCTEDITION_KEY = \"com.ibm.websphere.productEdition\";", "originalCommit": "c6db636a14c57f9e0905ff2c921235fbb85e7c6e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODU4NzczOA==", "url": "https://github.com/OpenLiberty/open-liberty/pull/11073#discussion_r388587738", "bodyText": "copyright.", "author": "ginnick", "createdAt": "2020-03-05T21:51:52Z", "path": "dev/com.ibm.ws.kernel.service/src/com/ibm/ws/kernel/service/location/internal/Activator.java", "diffHunk": "@@ -23,6 +23,7 @@\n import com.ibm.websphere.ras.Tr;", "originalCommit": "c6db636a14c57f9e0905ff2c921235fbb85e7c6e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDIzMDMyNg==", "url": "https://github.com/OpenLiberty/open-liberty/pull/11073#discussion_r390230326", "bodyText": "So what happens if the user has set this system property to \"YES\"? Please can you add a public static boolean getBetaEdition() method for internal components to use to get this value really easily? They shouldn't need to worry about what the exact value of the system property is or wether they need to call the method inside a doPriv or even use ThreadIdentityManager.runAsServer().", "author": "tevans78", "createdAt": "2020-03-10T10:48:10Z", "path": "dev/com.ibm.ws.kernel.boot.core/src/com/ibm/ws/kernel/productinfo/ProductInfo.java", "diffHunk": "@@ -225,6 +227,41 @@ public String getProperty(String key) {\n         return value;\n     }\n \n+    /**\n+     * Helper method for determining if product is EARLY_ACCESS edition\n+     */\n+    public boolean isBeta() {\n+        boolean isBeta;\n+        String productEdition = this.getEdition();\n+        if (productEdition == null) {\n+            isBeta = false;\n+        } else {\n+            isBeta = productEdition.equals(EARLY_ACCESS);\n+        }\n+        return isBeta;\n+    }\n+\n+    /**\n+     * Sets the com.ibm.ws.beta.edition JVM property to true if the Liberty version is EARLY_ACCESS,\n+     * otherwise sets it to false.\n+     */\n+    public static void setBetaEditionJVMProperty() {\n+        try {\n+            if (System.getProperty(BETA_EDITION_JVM_PROPERTY) == null) {", "originalCommit": "4d62e1aa2cf17450dcf734e15c4c93eba87abc87", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDIzMTYwOQ==", "url": "https://github.com/OpenLiberty/open-liberty/pull/11073#discussion_r390231609", "bodyText": "We should also socialize this at the next EOI, partly to make sure everyone knows that it exists but also to check that it forefills their requirements and that they don't end up writing their own code again.", "author": "tevans78", "createdAt": "2020-03-10T10:50:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDIzMDMyNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc2ODc1Ng==", "url": "https://github.com/OpenLiberty/open-liberty/pull/11073#discussion_r393768756", "bodyText": "Added the static method getBetaEdition() to ProductInfo in latest commit.", "author": "mmerali96", "createdAt": "2020-03-17T15:34:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDIzMDMyNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDQwNjI1OQ==", "url": "https://github.com/OpenLiberty/open-liberty/pull/11073#discussion_r394406259", "bodyText": "Ditch the d", "author": "FlynnIBM", "createdAt": "2020-03-18T14:52:11Z", "path": "dev/com.ibm.ws.kernel.boot.core/src/com/ibm/ws/kernel/productinfo/ProductInfo.java", "diffHunk": "@@ -1,5 +1,5 @@\n /*******************************************************************************\n- * Copyright (c) 2012 IBM Corporation and others.\n+d * Copyright (c) 2012, 2020 IBM Corporation and others.", "originalCommit": "8c2486137fef8c7a8b3b94602455a56e734aeb43", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "fd68168f60ab3ea01ab05e311305a6572cad3d3f", "url": "https://github.com/OpenLiberty/open-liberty/commit/fd68168f60ab3ea01ab05e311305a6572cad3d3f", "message": "Beta fence kernel code to create beta edition system property.", "committedDate": "2020-03-20T03:36:20Z", "type": "commit"}, {"oid": "fd68168f60ab3ea01ab05e311305a6572cad3d3f", "url": "https://github.com/OpenLiberty/open-liberty/commit/fd68168f60ab3ea01ab05e311305a6572cad3d3f", "message": "Beta fence kernel code to create beta edition system property.", "committedDate": "2020-03-20T03:36:20Z", "type": "forcePushed"}, {"oid": "448fb09872cf546a0cf255e31b6c3205a8243ec1", "url": "https://github.com/OpenLiberty/open-liberty/commit/448fb09872cf546a0cf255e31b6c3205a8243ec1", "message": "Merge branch 'integration' into mfa", "committedDate": "2020-03-20T16:38:30Z", "type": "commit"}]}