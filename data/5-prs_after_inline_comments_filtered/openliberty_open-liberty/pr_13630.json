{"pr_number": 13630, "pr_title": "Issue #11864: Jakarta'ize appSecurityClient-1.0 feature and add FATs. Update \u2026", "pr_createdAt": "2020-08-24T19:37:02Z", "pr_url": "https://github.com/OpenLiberty/open-liberty/pull/13630", "timeline": [{"oid": "b3eb1e01e4842b785f7e780ab55d6eebeba73b3d", "url": "https://github.com/OpenLiberty/open-liberty/commit/b3eb1e01e4842b785f7e780ab55d6eebeba73b3d", "message": "Issue #11865: Deliver appSecurityClient-2.0 feature and FATs. Update Jakarta security FATs to run EE9. Resolved issue #13131.", "committedDate": "2020-08-24T19:40:55Z", "type": "forcePushed"}, {"oid": "84ada48f678ab8f485c94382c938d810d766c9da", "url": "https://github.com/OpenLiberty/open-liberty/commit/84ada48f678ab8f485c94382c938d810d766c9da", "message": "Issue #11865: Deliver appSecurityClient-2.0 feature and FATs. Update Jakarta security FATs to run EE9. Resolved issue #13131.", "committedDate": "2020-09-03T14:39:29Z", "type": "forcePushed"}, {"oid": "7ce48606fbccf77b44143fb436fcd6c2099ba249", "url": "https://github.com/OpenLiberty/open-liberty/commit/7ce48606fbccf77b44143fb436fcd6c2099ba249", "message": "Issue #11865: Deliver appSecurityClient-2.0 feature and FATs. Update Jakarta security FATs to run EE9. Resolved issue #13131.", "committedDate": "2020-10-07T03:30:14Z", "type": "forcePushed"}, {"oid": "be7fcc6ae5392edef089c90fd639c0f940b2a675", "url": "https://github.com/OpenLiberty/open-liberty/commit/be7fcc6ae5392edef089c90fd639c0f940b2a675", "message": "Issue #11865: Jakarta'ize appSecurityClient-1.0 feature and add FATs. Update Jakarta security FATs to run EE9. Resolved issue #13131.", "committedDate": "2020-10-07T14:41:42Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTEwMDI5OQ==", "url": "https://github.com/OpenLiberty/open-liberty/pull/13630#discussion_r501100299", "bodyText": "getName() is a much simpler method to call and there is no reason to require getCanonicalName", "author": "jhanders34", "createdAt": "2020-10-07T15:21:21Z", "path": "dev/com.ibm.ws.cdi.web/src/com/ibm/ws/cdi/web/impl/AbstractInitialListenerRegistration.java", "diffHunk": "@@ -89,7 +89,7 @@ public void registerListener(IServletContext isc) {\n                     Tr.debug(tc, \"added WeldInitialListener to the servlet context\");\n \n                 //Put bean manager on the servlet context\n-                isc.setAttribute(\"javax.enterprise.inject.spi.BeanManager\", beanManager);\n+                isc.setAttribute(BeanManager.class.getCanonicalName(), beanManager);", "originalCommit": "be7fcc6ae5392edef089c90fd639c0f940b2a675", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTE1NTMwNQ==", "url": "https://github.com/OpenLiberty/open-liberty/pull/13630#discussion_r501155305", "bodyText": "Changed.", "author": "jvanhill", "createdAt": "2020-10-07T16:38:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTEwMDI5OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTEwMTQ5Nw==", "url": "https://github.com/OpenLiberty/open-liberty/pull/13630#discussion_r501101497", "bodyText": "There is no appSecurityClient-2.0 feature", "author": "jhanders34", "createdAt": "2020-10-07T15:22:48Z", "path": "dev/com.ibm.ws.kernel.feature.core/src/com/ibm/ws/kernel/feature/internal/subsystem/FeatureDefinitionUtils.java", "diffHunk": "@@ -85,7 +85,8 @@\n     public final static Collection<String> ALLOWED_ON_CLIENT_ONLY_FEATURES = Arrays.asList(\"com.ibm.websphere.appserver.javaeeClient-7.0\",\n                                                                                            \"com.ibm.websphere.appserver.javaeeClient-8.0\",\n                                                                                            \"io.openliberty.jakartaeeClient-9.0\",\n-                                                                                           \"com.ibm.websphere.appserver.appSecurityClient-1.0\");\n+                                                                                           \"com.ibm.websphere.appserver.appSecurityClient-1.0\",\n+                                                                                           \"io.openliberty.appSecurityClient-2.0\");", "originalCommit": "be7fcc6ae5392edef089c90fd639c0f940b2a675", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTE1NTgyMA==", "url": "https://github.com/OpenLiberty/open-liberty/pull/13630#discussion_r501155820", "bodyText": "Changed.\nI had originally created one before the private servlet feature rename. Had missed this change from prior to merging in those changes.", "author": "jvanhill", "createdAt": "2020-10-07T16:38:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTEwMTQ5Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTEwODcxNw==", "url": "https://github.com/OpenLiberty/open-liberty/pull/13630#discussion_r501108717", "bodyText": "The OR of the conditional will never be triggered, so is there a point in having it?", "author": "jhanders34", "createdAt": "2020-10-07T15:32:07Z", "path": "dev/com.ibm.ws.webcontainer.security/src/com/ibm/ws/webcontainer/security/WebAppSecurityCollaboratorImpl.java", "diffHunk": "@@ -461,9 +461,32 @@ public void handleException(HttpServletRequest req, HttpServletResponse rsp, Thr\n     }\n \n     @Override\n+    @FFDCIgnore(NumberFormatException.class)\n     public boolean isCDINeeded() {\n-        return WebContainer.getServletContainerSpecLevel() >= WebContainer.SPEC_LEVEL_40 &&\n-               provisionerService.getInstalledFeatures().contains(\"appSecurity-3.0\");\n+        int specLevel = WebContainer.getServletContainerSpecLevel();\n+\n+        /*\n+         * Determine which version of appSecurity we are running.\n+         */\n+        Set<String> installedFeatures = provisionerService.getInstalledFeatures();\n+        float appSecurityVers = 0.0f;\n+        for (String feature : installedFeatures) {\n+            if (feature.startsWith(\"appSecurity-\")) {\n+                try {\n+                    appSecurityVers = Float.valueOf(feature.substring(12));\n+                    break;\n+                } catch (NumberFormatException e) {\n+                    // Ignore. Not the feature we are looking for.\n+                }\n+            }\n+        }\n+\n+        /*\n+         * Future-proof check. Some of these combinations aren't valid, but\n+         * they will not make it this far.\n+         */\n+        return (appSecurityVers >= 3.0 && specLevel >= WebContainer.SPEC_LEVEL_40) ||\n+               (appSecurityVers >= 4.0 && specLevel >= WebContainer.SPEC_LEVEL_50);", "originalCommit": "be7fcc6ae5392edef089c90fd639c0f940b2a675", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTE1NzE3MA==", "url": "https://github.com/OpenLiberty/open-liberty/pull/13630#discussion_r501157170", "bodyText": "Good catch. Removed the OR.", "author": "jvanhill", "createdAt": "2020-10-07T16:40:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTEwODcxNw=="}], "type": "inlineReview"}, {"oid": "32486a4d3a4daeefd6081dd40df6c9d879bc326b", "url": "https://github.com/OpenLiberty/open-liberty/commit/32486a4d3a4daeefd6081dd40df6c9d879bc326b", "message": "Issue #11865: Jakarta'ize appSecurityClient-1.0 feature and add FATs. Update Jakarta security FATs to run EE9. Resolved issue #13131.", "committedDate": "2020-10-08T22:07:22Z", "type": "forcePushed"}, {"oid": "83520c0295f35d3ad6b9c5ca24f8f1c2a8c814a1", "url": "https://github.com/OpenLiberty/open-liberty/commit/83520c0295f35d3ad6b9c5ca24f8f1c2a8c814a1", "message": "Issue #11865: Jakarta'ize appSecurityClient-1.0 feature and add FATs. Update Jakarta security FATs to run EE9. Resolved issue #13131.", "committedDate": "2020-10-09T14:24:12Z", "type": "forcePushed"}, {"oid": "f7387ce203079ed355662dcc64d432d4919a6154", "url": "https://github.com/OpenLiberty/open-liberty/commit/f7387ce203079ed355662dcc64d432d4919a6154", "message": "Issue #11865: Jakarta'ize appSecurityClient-1.0 feature and add FATs. Update Jakarta security FATs to run EE9. Resolved issue #13131.", "committedDate": "2020-10-12T21:46:22Z", "type": "forcePushed"}, {"oid": "66ea03057cab1eaaebc5f213612967d92de98d3e", "url": "https://github.com/OpenLiberty/open-liberty/commit/66ea03057cab1eaaebc5f213612967d92de98d3e", "message": "Issue #11865: Jakarta'ize appSecurityClient-1.0 feature and add FATs. Update Jakarta security FATs to run EE9. Resolved issue #13131.", "committedDate": "2020-10-12T21:47:31Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDc5NDM0NA==", "url": "https://github.com/OpenLiberty/open-liberty/pull/13630#discussion_r504794344", "bodyText": "I think you want to change this to mail-2.0, not jakartaMail-1.6", "author": "jhanders34", "createdAt": "2020-10-14T15:59:29Z", "path": "dev/fattest.simplicity/src/componenttest/rules/repeater/JakartaEE9Action.java", "diffHunk": "@@ -74,7 +74,7 @@\n                                                  \"enterpriseBeansTest-2.0\",\n                                                  \"jacc-2.0\",\n                                                  \"jaspic-2.0\",\n-                                                 \"javaMail-2.0\",\n+                                                 \"jakartaMail-1.6\",", "originalCommit": "66ea03057cab1eaaebc5f213612967d92de98d3e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDg3OTUyNw==", "url": "https://github.com/OpenLiberty/open-liberty/pull/13630#discussion_r504879527", "bodyText": "Made the change.", "author": "jvanhill", "createdAt": "2020-10-14T18:18:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDc5NDM0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDc5NDkzOA==", "url": "https://github.com/OpenLiberty/open-liberty/pull/13630#discussion_r504794938", "bodyText": "I think you want this to be mail not jakartaMail", "author": "jhanders34", "createdAt": "2020-10-14T16:00:18Z", "path": "dev/fattest.simplicity/src/componenttest/rules/repeater/FeatureReplacementAction.java", "diffHunk": "@@ -60,6 +60,7 @@\n         featureNameMapping.put(\"ejbTest\", \"enterpriseBeansTest\");\n         featureNameMapping.put(\"javaee\", \"jakartaee\");\n         featureNameMapping.put(\"javaeeClient\", \"jakartaeeClient\");\n+        featureNameMapping.put(\"javaMail\", \"jakartaMail\");", "originalCommit": "66ea03057cab1eaaebc5f213612967d92de98d3e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDg3OTY1MA==", "url": "https://github.com/OpenLiberty/open-liberty/pull/13630#discussion_r504879650", "bodyText": "Made the change.", "author": "jvanhill", "createdAt": "2020-10-14T18:18:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDc5NDkzOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDc5NjQwMQ==", "url": "https://github.com/OpenLiberty/open-liberty/pull/13630#discussion_r504796401", "bodyText": "This comment should say mail-2.0.  It might be available now.", "author": "jhanders34", "createdAt": "2020-10-14T16:02:23Z", "path": "dev/com.ibm.ws.security.client_fat/fat/src/com/ibm/ws/security/client/fat/JavaColonInjectionsTest.java", "diffHunk": "@@ -0,0 +1,92 @@\n+/*******************************************************************************\n+ * Copyright (c) 2015, 2020 IBM Corporation and others.\n+ * All rights reserved. This program and the accompanying materials\n+ * are made available under the terms of the Eclipse Public License v1.0\n+ * which accompanies this distribution, and is available at\n+ * http://www.eclipse.org/legal/epl-v10.html\n+ *\n+ * Contributors:\n+ *     IBM Corporation - initial API and implementation\n+ *******************************************************************************/\n+\n+package com.ibm.ws.security.client.fat;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertTrue;\n+\n+import java.util.List;\n+\n+import org.junit.AfterClass;\n+import org.junit.BeforeClass;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.junit.rules.TestName;\n+import org.junit.runner.RunWith;\n+\n+import com.ibm.websphere.simplicity.ProgramOutput;\n+import com.ibm.websphere.simplicity.log.Log;\n+\n+import componenttest.annotation.SkipForRepeat;\n+import componenttest.custom.junit.runner.FATRunner;\n+import componenttest.custom.junit.runner.Mode;\n+import componenttest.custom.junit.runner.Mode.TestMode;\n+import componenttest.topology.impl.LibertyClient;\n+import componenttest.topology.impl.LibertyClientFactory;\n+import componenttest.topology.impl.LibertyServer;\n+import componenttest.topology.impl.LibertyServerFactory;\n+\n+@SkipForRepeat(SkipForRepeat.EE9_FEATURES) // TODO jakartaMail-1.6 is not yet available.", "originalCommit": "66ea03057cab1eaaebc5f213612967d92de98d3e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDgwNjU1Nw==", "url": "https://github.com/OpenLiberty/open-liberty/pull/13630#discussion_r504806557", "bodyText": "I just looked and it is edition = beta so it would appears available.", "author": "jhanders34", "createdAt": "2020-10-14T16:17:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDc5NjQwMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDkzNTEwNg==", "url": "https://github.com/OpenLiberty/open-liberty/pull/13630#discussion_r504935106", "bodyText": "Removed the skip for repeat as mail-2.0 is available. I also had to update wlp-jakartaee-transform/rules/jakarta-renames.properties (rename javax.mail to jakarta.mail) and com.ibm.ws.security.client_fat/bnd.bnd  (add EE9 tested features) for this change.", "author": "jvanhill", "createdAt": "2020-10-14T19:55:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDc5NjQwMQ=="}], "type": "inlineReview"}, {"oid": "df1679146f2f8f35ad8341367c8e635a726c5deb", "url": "https://github.com/OpenLiberty/open-liberty/commit/df1679146f2f8f35ad8341367c8e635a726c5deb", "message": "Issue #11865: Jakarta'ize appSecurityClient-1.0 feature and add FATs. Update Jakarta security FATs to run EE9. Resolved issue #13131.", "committedDate": "2020-10-14T19:52:26Z", "type": "forcePushed"}, {"oid": "e4830bd16bb364cb3cd8d0bfb5a3e139d5cfe26e", "url": "https://github.com/OpenLiberty/open-liberty/commit/e4830bd16bb364cb3cd8d0bfb5a3e139d5cfe26e", "message": "Issue #11865: Jakarta'ize appSecurityClient-1.0 feature and add FATs. Update Jakarta security FATs to run EE9. Resolved issue #13131.", "committedDate": "2020-10-14T20:12:57Z", "type": "commit"}, {"oid": "e4830bd16bb364cb3cd8d0bfb5a3e139d5cfe26e", "url": "https://github.com/OpenLiberty/open-liberty/commit/e4830bd16bb364cb3cd8d0bfb5a3e139d5cfe26e", "message": "Issue #11865: Jakarta'ize appSecurityClient-1.0 feature and add FATs. Update Jakarta security FATs to run EE9. Resolved issue #13131.", "committedDate": "2020-10-14T20:12:57Z", "type": "forcePushed"}]}