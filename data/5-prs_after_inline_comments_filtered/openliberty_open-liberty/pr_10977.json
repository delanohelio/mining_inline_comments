{"pr_number": 10977, "pr_title": "gRPC client, server, and servlet initial support", "pr_createdAt": "2020-02-20T16:59:47Z", "pr_url": "https://github.com/OpenLiberty/open-liberty/pull/10977", "timeline": [{"oid": "78d93a14e0377a62e22b6c4f03ec601815bdc824", "url": "https://github.com/OpenLiberty/open-liberty/commit/78d93a14e0377a62e22b6c4f03ec601815bdc824", "message": "grpc server improvements", "committedDate": "2020-02-20T21:35:57Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDIyMDI4OA==", "url": "https://github.com/OpenLiberty/open-liberty/pull/10977#discussion_r384220288", "bodyText": "Do we want to do more than log the message?", "author": "pnicolucci", "createdAt": "2020-02-26T01:02:00Z", "path": "dev/com.ibm.ws.grpc.server/src/com/ibm/ws/grpc/GrpcApplicationManager.java", "diffHunk": "@@ -0,0 +1,184 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 IBM Corporation and others.\n+ * All rights reserved. This program and the accompanying materials\n+ * are made available under the terms of the Eclipse Public License v1.0\n+ * which accompanies this distribution, and is available at\n+ * http://www.eclipse.org/legal/epl-v10.html\n+ *\n+ * Contributors:\n+ *     IBM Corporation - initial API and implementation\n+ *******************************************************************************/\n+\n+package com.ibm.ws.grpc;\n+\n+import java.io.IOException;\n+import java.util.Collection;\n+import java.util.HashSet;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.logging.Level;\n+import java.util.logging.Logger;\n+\n+import org.osgi.service.component.ComponentContext;\n+import org.osgi.service.component.annotations.Activate;\n+import org.osgi.service.component.annotations.Component;\n+import org.osgi.service.component.annotations.ConfigurationPolicy;\n+import org.osgi.service.component.annotations.Deactivate;\n+import org.osgi.service.component.annotations.Modified;\n+\n+import com.ibm.websphere.ras.TraceComponent;\n+import com.ibm.ws.container.service.annocache.AnnotationsBetaHelper;\n+import com.ibm.ws.container.service.annotations.WebAnnotations;\n+import com.ibm.ws.container.service.app.deploy.ApplicationInfo;\n+import com.ibm.ws.container.service.app.deploy.WebModuleInfo;\n+import com.ibm.ws.container.service.state.ApplicationStateListener;\n+import com.ibm.ws.container.service.state.StateChangeException;\n+import com.ibm.wsspi.adaptable.module.NonPersistentCache;\n+import com.ibm.wsspi.adaptable.module.UnableToAdaptException;\n+import com.ibm.wsspi.anno.targets.AnnotationTargets_Targets;\n+\n+import io.grpc.BindableService;\n+import io.grpc.Server;\n+\n+@Component(service = {\n+\t\tApplicationStateListener.class }, configurationPolicy = ConfigurationPolicy.IGNORE, immediate = true)\n+public class GrpcApplicationManager implements ApplicationStateListener {\n+\n+\tprivate static final String CLASS_NAME = GrpcApplicationManager.class.getName();\n+\tprivate static final Logger logger = Logger.getLogger(GrpcApplicationManager.class.getName());\n+\n+\t@Activate\n+\tprotected void activate(ComponentContext cc) {\n+\t}\n+\n+\t@Deactivate\n+\tprotected void deactivate(ComponentContext cc) {\n+\t}\n+\n+\t@Modified\n+\tprotected void modified(Map<?, ?> newProperties) {\n+\t}\n+\n+\t/**\n+\t * Discover and start gRPC services provided by this application\n+\t */\n+\t@Override\n+\tpublic void applicationStarting(ApplicationInfo appInfo) throws StateChangeException {\n+\t\tSet<String> grpcServiceClassNames = findGrpcServiceImplementors(appInfo);\n+\t\tSet<BindableService> services = initGrpcServices(appInfo, grpcServiceClassNames);\n+\t\tif (services != null && !services.isEmpty()) {\n+\t\t\tLibertyServerBuilder serverBuilder = new LibertyServerBuilder();\n+\t\t\tfor (BindableService service : services) {\n+\t\t\t\tserverBuilder.addService(service.bindService());\n+\t\t\t}\n+\t\t\tServer server = serverBuilder.build();\n+\t\t\ttry {\n+\t\t\t\tserver.start();\n+\t\t\t\tActiveGrpcServers.addServer(appInfo.getName(), server);\n+\t\t\t} catch (IOException e) {\n+\t\t\t\tlogMessage(Level.FINE, \"initGrpcServices\",", "originalCommit": "4d538ed11aefbad0848ff937886ef68b3d1b7232", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzMxMTk3MA==", "url": "https://github.com/OpenLiberty/open-liberty/pull/10977#discussion_r387311970", "bodyText": "I've added a FFDC for now.  We'll go back over messages more carefully in another PR.", "author": "wtlucy", "createdAt": "2020-03-03T21:44:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDIyMDI4OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDIyMDMzOA==", "url": "https://github.com/OpenLiberty/open-liberty/pull/10977#discussion_r384220338", "bodyText": "Just pointing out the System.out", "author": "pnicolucci", "createdAt": "2020-02-26T01:02:13Z", "path": "dev/com.ibm.ws.grpc.server/src/com/ibm/ws/grpc/GrpcApplicationManager.java", "diffHunk": "@@ -0,0 +1,184 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 IBM Corporation and others.\n+ * All rights reserved. This program and the accompanying materials\n+ * are made available under the terms of the Eclipse Public License v1.0\n+ * which accompanies this distribution, and is available at\n+ * http://www.eclipse.org/legal/epl-v10.html\n+ *\n+ * Contributors:\n+ *     IBM Corporation - initial API and implementation\n+ *******************************************************************************/\n+\n+package com.ibm.ws.grpc;\n+\n+import java.io.IOException;\n+import java.util.Collection;\n+import java.util.HashSet;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.logging.Level;\n+import java.util.logging.Logger;\n+\n+import org.osgi.service.component.ComponentContext;\n+import org.osgi.service.component.annotations.Activate;\n+import org.osgi.service.component.annotations.Component;\n+import org.osgi.service.component.annotations.ConfigurationPolicy;\n+import org.osgi.service.component.annotations.Deactivate;\n+import org.osgi.service.component.annotations.Modified;\n+\n+import com.ibm.websphere.ras.TraceComponent;\n+import com.ibm.ws.container.service.annocache.AnnotationsBetaHelper;\n+import com.ibm.ws.container.service.annotations.WebAnnotations;\n+import com.ibm.ws.container.service.app.deploy.ApplicationInfo;\n+import com.ibm.ws.container.service.app.deploy.WebModuleInfo;\n+import com.ibm.ws.container.service.state.ApplicationStateListener;\n+import com.ibm.ws.container.service.state.StateChangeException;\n+import com.ibm.wsspi.adaptable.module.NonPersistentCache;\n+import com.ibm.wsspi.adaptable.module.UnableToAdaptException;\n+import com.ibm.wsspi.anno.targets.AnnotationTargets_Targets;\n+\n+import io.grpc.BindableService;\n+import io.grpc.Server;\n+\n+@Component(service = {\n+\t\tApplicationStateListener.class }, configurationPolicy = ConfigurationPolicy.IGNORE, immediate = true)\n+public class GrpcApplicationManager implements ApplicationStateListener {\n+\n+\tprivate static final String CLASS_NAME = GrpcApplicationManager.class.getName();\n+\tprivate static final Logger logger = Logger.getLogger(GrpcApplicationManager.class.getName());\n+\n+\t@Activate\n+\tprotected void activate(ComponentContext cc) {\n+\t}\n+\n+\t@Deactivate\n+\tprotected void deactivate(ComponentContext cc) {\n+\t}\n+\n+\t@Modified\n+\tprotected void modified(Map<?, ?> newProperties) {\n+\t}\n+\n+\t/**\n+\t * Discover and start gRPC services provided by this application\n+\t */\n+\t@Override\n+\tpublic void applicationStarting(ApplicationInfo appInfo) throws StateChangeException {\n+\t\tSet<String> grpcServiceClassNames = findGrpcServiceImplementors(appInfo);\n+\t\tSet<BindableService> services = initGrpcServices(appInfo, grpcServiceClassNames);\n+\t\tif (services != null && !services.isEmpty()) {\n+\t\t\tLibertyServerBuilder serverBuilder = new LibertyServerBuilder();\n+\t\t\tfor (BindableService service : services) {\n+\t\t\t\tserverBuilder.addService(service.bindService());\n+\t\t\t}\n+\t\t\tServer server = serverBuilder.build();\n+\t\t\ttry {\n+\t\t\t\tserver.start();\n+\t\t\t\tActiveGrpcServers.addServer(appInfo.getName(), server);\n+\t\t\t} catch (IOException e) {\n+\t\t\t\tlogMessage(Level.FINE, \"initGrpcServices\",\n+\t\t\t\t\t\t\"gRPC Server \" + server + \" could not be started \", e);\n+\t\t\t}\n+\t\t}\n+\t}\n+\n+\t@Override\n+\tpublic void applicationStarted(ApplicationInfo appInfo) throws StateChangeException {\n+\t}\n+\n+\t@Override\n+\tpublic void applicationStopping(ApplicationInfo appInfo) {\n+\t\tCollection<Server> servers = ActiveGrpcServers.getServerList();\n+\t\tfor (Server s : servers) {\n+\t\t\tSystem.out.println(\"applicationStopping removing grpc server: \" + s);\n+\t\t\ts.shutdown();\n+\t\t}\n+\t\tActiveGrpcServers.removeServer(appInfo.getName());\n+\t\tSystem.out.println(\"applicationStopping app: \" + appInfo.getName());", "originalCommit": "4d538ed11aefbad0848ff937886ef68b3d1b7232", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "54950089cbfb28088d6de20ea34f16c7534816d9", "url": "https://github.com/OpenLiberty/open-liberty/commit/54950089cbfb28088d6de20ea34f16c7534816d9", "message": "clean up grpc server stream impl", "committedDate": "2020-02-28T21:00:06Z", "type": "forcePushed"}, {"oid": "feaf6e32b824ed1f03a8d52956668de61baa0721", "url": "https://github.com/OpenLiberty/open-liberty/commit/feaf6e32b824ed1f03a8d52956668de61baa0721", "message": "standardize logging, further cleanup", "committedDate": "2020-03-02T20:52:44Z", "type": "forcePushed"}, {"oid": "fc86f5ec207b448b3f36c0e2c3bdea92bf3c4d01", "url": "https://github.com/OpenLiberty/open-liberty/commit/fc86f5ec207b448b3f36c0e2c3bdea92bf3c4d01", "message": "add basic unit tests", "committedDate": "2020-03-03T19:53:31Z", "type": "forcePushed"}, {"oid": "b0427a940184d53cf747a4da29da092e5ee3f263", "url": "https://github.com/OpenLiberty/open-liberty/commit/b0427a940184d53cf747a4da29da092e5ee3f263", "message": "standardize grpc logging; add common feature; add server unittests", "committedDate": "2020-03-03T21:19:26Z", "type": "forcePushed"}, {"oid": "d92f1b41f8747ca2ed68f4b6d56b82306a11dd5d", "url": "https://github.com/OpenLiberty/open-liberty/commit/d92f1b41f8747ca2ed68f4b6d56b82306a11dd5d", "message": "standardize grpc logging; add common feature; add server unittests", "committedDate": "2020-03-03T21:23:23Z", "type": "forcePushed"}, {"oid": "27bc33d3a61e914c21ad516d6142afab597f1e27", "url": "https://github.com/OpenLiberty/open-liberty/commit/27bc33d3a61e914c21ad516d6142afab597f1e27", "message": "Initial implementations for grpcServer, grpcServlet, and grpcClient", "committedDate": "2020-03-03T21:24:29Z", "type": "commit"}, {"oid": "2c9ed25253bad7d1c735947f0d4053224f1b98d2", "url": "https://github.com/OpenLiberty/open-liberty/commit/2c9ed25253bad7d1c735947f0d4053224f1b98d2", "message": "standardize grpc logging; add common feature; add server unittests", "committedDate": "2020-03-03T21:24:29Z", "type": "forcePushed"}, {"oid": "07b62bfcfecc5648537ec9a116b869a927835108", "url": "https://github.com/OpenLiberty/open-liberty/commit/07b62bfcfecc5648537ec9a116b869a927835108", "message": "standardize grpc logging; add common feature; add server unittests", "committedDate": "2020-03-03T21:33:02Z", "type": "forcePushed"}, {"oid": "9cdae65f7edce1ed42cdc0aa8e0b7e9dc6534526", "url": "https://github.com/OpenLiberty/open-liberty/commit/9cdae65f7edce1ed42cdc0aa8e0b7e9dc6534526", "message": "standardize grpc logging; add common feature; add server unittests", "committedDate": "2020-03-03T21:35:01Z", "type": "forcePushed"}, {"oid": "e151c823b718d40057207198075a5817af2d06c8", "url": "https://github.com/OpenLiberty/open-liberty/commit/e151c823b718d40057207198075a5817af2d06c8", "message": "standardize grpc logging; add common feature; add server unittests", "committedDate": "2020-03-03T21:43:35Z", "type": "commit"}, {"oid": "e151c823b718d40057207198075a5817af2d06c8", "url": "https://github.com/OpenLiberty/open-liberty/commit/e151c823b718d40057207198075a5817af2d06c8", "message": "standardize grpc logging; add common feature; add server unittests", "committedDate": "2020-03-03T21:43:35Z", "type": "forcePushed"}, {"oid": "9c962e64af53f52890dcfacd7bf0199cbf30179e", "url": "https://github.com/OpenLiberty/open-liberty/commit/9c962e64af53f52890dcfacd7bf0199cbf30179e", "message": "remove new http2 interface from SPI; update features", "committedDate": "2020-03-04T20:50:25Z", "type": "commit"}, {"oid": "8b1370115827a5683c34b1bc84c8b076399483a5", "url": "https://github.com/OpenLiberty/open-liberty/commit/8b1370115827a5683c34b1bc84c8b076399483a5", "message": "support binary headers", "committedDate": "2020-03-05T18:47:43Z", "type": "forcePushed"}, {"oid": "98c1e6ed0b3375eb0df8547b9df51f3bbe7b7493", "url": "https://github.com/OpenLiberty/open-liberty/commit/98c1e6ed0b3375eb0df8547b9df51f3bbe7b7493", "message": "support binary headers", "committedDate": "2020-03-05T19:49:50Z", "type": "commit"}, {"oid": "98c1e6ed0b3375eb0df8547b9df51f3bbe7b7493", "url": "https://github.com/OpenLiberty/open-liberty/commit/98c1e6ed0b3375eb0df8547b9df51f3bbe7b7493", "message": "support binary headers", "committedDate": "2020-03-05T19:49:50Z", "type": "forcePushed"}, {"oid": "7a10421d9b5020799beaf76db17db38f67006940", "url": "https://github.com/OpenLiberty/open-liberty/commit/7a10421d9b5020799beaf76db17db38f67006940", "message": "depend on servlet feature for now", "committedDate": "2020-03-05T19:58:56Z", "type": "commit"}, {"oid": "1cfffd0e1179594ddff937f3dc943a54db807f3c", "url": "https://github.com/OpenLiberty/open-liberty/commit/1cfffd0e1179594ddff937f3dc943a54db807f3c", "message": "respect max frame size during data write", "committedDate": "2020-03-09T18:11:32Z", "type": "commit"}, {"oid": "bd487e65657773971d5d5ad5e4cfd3e7ee08dcc8", "url": "https://github.com/OpenLiberty/open-liberty/commit/bd487e65657773971d5d5ad5e4cfd3e7ee08dcc8", "message": "improve grpc eclipse projects", "committedDate": "2020-03-09T19:25:26Z", "type": "commit"}, {"oid": "999d6a4d5b80d499943c3a8c814973bc9159daca", "url": "https://github.com/OpenLiberty/open-liberty/commit/999d6a4d5b80d499943c3a8c814973bc9159daca", "message": "improve gprc messages; clarify classnames", "committedDate": "2020-03-09T19:56:32Z", "type": "commit"}, {"oid": "999d6a4d5b80d499943c3a8c814973bc9159daca", "url": "https://github.com/OpenLiberty/open-liberty/commit/999d6a4d5b80d499943c3a8c814973bc9159daca", "message": "improve gprc messages; clarify classnames", "committedDate": "2020-03-09T19:56:32Z", "type": "forcePushed"}, {"oid": "158de241f126c1d1135a2bd106e565de35f1b6a3", "url": "https://github.com/OpenLiberty/open-liberty/commit/158de241f126c1d1135a2bd106e565de35f1b6a3", "message": "grpcServlet fixes; improve messages", "committedDate": "2020-03-10T20:37:03Z", "type": "commit"}, {"oid": "83de8c0edbe2c6343824a2916626f31c40cfab15", "url": "https://github.com/OpenLiberty/open-liberty/commit/83de8c0edbe2c6343824a2916626f31c40cfab15", "message": "fix eclipse projects; add package versions", "committedDate": "2020-03-11T13:15:07Z", "type": "commit"}]}