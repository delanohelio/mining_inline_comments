{"pr_number": 13483, "pr_title": "Handle ejb-jar.xml version 4.0 and application.xml version 9 in ddparser", "pr_createdAt": "2020-08-13T14:22:07Z", "pr_url": "https://github.com/OpenLiberty/open-liberty/pull/13483", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDA5NzIyNw==", "url": "https://github.com/OpenLiberty/open-liberty/pull/13483#discussion_r470097227", "bodyText": "Should this test be updated to cover VERSION_9_0?  It looks like that was missed when that version was added to JavaEEVersion back in July.", "author": "brideck", "createdAt": "2020-08-13T17:04:07Z", "path": "dev/com.ibm.ws.javaee.ddmodel/test/com/ibm/ws/javaee/ddmodel/app/AppTest.java", "diffHunk": "@@ -17,58 +17,55 @@\n import com.ibm.ws.javaee.ddmodel.DDParser;\n import com.ibm.ws.javaee.version.JavaEEVersion;\n \n-\n /**\n  * Application deployment descriptor parse tests.\n  */\n public class AppTest extends AppTestBase {\n-    public static final Version[] TEST_VERSIONS =\n-        new Version[] { \n-            JavaEEVersion.VERSION_6_0,\n-            JavaEEVersion.VERSION_7_0,\n-            JavaEEVersion.VERSION_8_0\n-        };\n+    public static final Version[] TEST_VERSIONS = new Version[] {\n+                                                                  JavaEEVersion.VERSION_6_0,\n+                                                                  JavaEEVersion.VERSION_7_0,\n+                                                                  JavaEEVersion.VERSION_8_0\n+    };", "originalCommit": "3f48ac0be96e913315f22c647cfcebbd0ded81b8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDIxMzg2Ng==", "url": "https://github.com/OpenLiberty/open-liberty/pull/13483#discussion_r470213866", "bodyText": "done", "author": "olendvcook", "createdAt": "2020-08-13T20:01:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDA5NzIyNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDA5NzYxNg==", "url": "https://github.com/OpenLiberty/open-liberty/pull/13483#discussion_r470097616", "bodyText": "The matrix of expected results would likewise need updating.", "author": "brideck", "createdAt": "2020-08-13T17:04:47Z", "path": "dev/com.ibm.ws.javaee.ddmodel/test/com/ibm/ws/javaee/ddmodel/app/AppTest.java", "diffHunk": "@@ -17,58 +17,55 @@\n import com.ibm.ws.javaee.ddmodel.DDParser;\n import com.ibm.ws.javaee.version.JavaEEVersion;\n \n-\n /**\n  * Application deployment descriptor parse tests.\n  */\n public class AppTest extends AppTestBase {\n-    public static final Version[] TEST_VERSIONS =\n-        new Version[] { \n-            JavaEEVersion.VERSION_6_0,\n-            JavaEEVersion.VERSION_7_0,\n-            JavaEEVersion.VERSION_8_0\n-        };\n+    public static final Version[] TEST_VERSIONS = new Version[] {\n+                                                                  JavaEEVersion.VERSION_6_0,\n+                                                                  JavaEEVersion.VERSION_7_0,\n+                                                                  JavaEEVersion.VERSION_8_0\n+    };\n \n     public static final int CMP_LT = -1;\n     public static final int CMP_GT = +1;\n-    public static final int CMP_EQ =  0;\n+    public static final int CMP_EQ = 0;\n \n     public static int asCmp(int cmpResult) {\n-        return ( (cmpResult < 0) ? CMP_LT : ((cmpResult > 0) ? CMP_GT : CMP_EQ) );\n+        return ((cmpResult < 0) ? CMP_LT : ((cmpResult > 0) ? CMP_GT : CMP_EQ));\n     }\n \n-    public static int[][] COMPARE_VERSION_RESULTS =\n-        new int[][] {\n-            { CMP_EQ, CMP_LT, CMP_LT },\n-            { CMP_GT, CMP_EQ, CMP_LT },\n-            { CMP_GT, CMP_GT, CMP_EQ }\n-        };\n+    public static int[][] COMPARE_VERSION_RESULTS = new int[][] {\n+                                                                  { CMP_EQ, CMP_LT, CMP_LT },\n+                                                                  { CMP_GT, CMP_EQ, CMP_LT },\n+                                                                  { CMP_GT, CMP_GT, CMP_EQ }", "originalCommit": "3f48ac0be96e913315f22c647cfcebbd0ded81b8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDIxMzY5MA==", "url": "https://github.com/OpenLiberty/open-liberty/pull/13483#discussion_r470213690", "bodyText": "done", "author": "olendvcook", "createdAt": "2020-08-13T20:01:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDA5NzYxNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDEwNzgzNA==", "url": "https://github.com/OpenLiberty/open-liberty/pull/13483#discussion_r470107834", "bodyText": "Is this right?  I can't tell what exactly this test is doing, but you've set DEFAULT_MAX_VERSION to 4_0 in EJBJarEntryAdapter, bumping it from 3_1.", "author": "brideck", "createdAt": "2020-08-13T17:15:39Z", "path": "dev/com.ibm.ws.javaee.ddmodel/test/com/ibm/ws/javaee/ddmodel/ejb/EJBJarTest.java", "diffHunk": "@@ -34,11 +34,12 @@ public void testGetVersionID() throws Exception {\n         Assert.assertEquals(EJBJar.VERSION_3_0, parse(ejbJar30() + \"</ejb-jar>\").getVersionID());\n         Assert.assertEquals(EJBJar.VERSION_3_1, parse(ejbJar31() + \"</ejb-jar>\").getVersionID());\n         Assert.assertEquals(EJBJar.VERSION_3_2, parse(ejbJar32() + \"</ejb-jar>\").getVersionID());\n+        Assert.assertEquals(EJBJar.VERSION_4_0, parse(ejbJar40() + \"</ejb-jar>\").getVersionID());\n     }\n \n     @Test(expected = DDParser.ParseException.class)\n-    public void testMaxVersion31() throws Exception {\n-        parse(ejbJar32() + \"</ejb-jar>\", EJBJar.VERSION_3_1);\n+    public void testMaxVersion() throws Exception {\n+        parse(ejbJar40() + \"</ejb-jar>\", EJBJar.VERSION_3_2);", "originalCommit": "3f48ac0be96e913315f22c647cfcebbd0ded81b8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDEwOTk1OQ==", "url": "https://github.com/OpenLiberty/open-liberty/pull/13483#discussion_r470109959", "bodyText": "Apparently it is, since this test has passed in your personal build.", "author": "brideck", "createdAt": "2020-08-13T17:17:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDEwNzgzNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDIxMzI2NQ==", "url": "https://github.com/OpenLiberty/open-liberty/pull/13483#discussion_r470213265", "bodyText": "this is to test } else if (maxVersion >= EJBJar.VERSION_4_0 && \"4.0\".equals(vers)) { gets a parse exception if the maxVersion variable is lower than 4, the test is passing in a new max version EJBJar.VERSION_3_2 so we aren't using the default from the Mock", "author": "olendvcook", "createdAt": "2020-08-13T20:00:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDEwNzgzNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDIxNTMyMA==", "url": "https://github.com/OpenLiberty/open-liberty/pull/13483#discussion_r470215320", "bodyText": "In FATs and a live server. maxVersion is determined by what feature level is set by which ejb feature is specified in server.xml.  So, if the have an EJB 4.0 ejb-jar.xml but have enabled ejb-lite-3.2 they will get the parse exception.", "author": "olendvcook", "createdAt": "2020-08-13T20:03:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDEwNzgzNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDIyNzg5MA==", "url": "https://github.com/OpenLiberty/open-liberty/pull/13483#discussion_r470227890", "bodyText": "Though I was wrong to get rid of the check for 3.2", "author": "olendvcook", "createdAt": "2020-08-13T20:26:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDEwNzgzNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDIzNDM0NA==", "url": "https://github.com/OpenLiberty/open-liberty/pull/13483#discussion_r470234344", "bodyText": "Aha.  Thanks for the clarification on what this test is doing.", "author": "brideck", "createdAt": "2020-08-13T20:39:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDEwNzgzNA=="}], "type": "inlineReview"}, {"oid": "aeed6ad5ccf2b5947582e6b12a3ab6fe701247f2", "url": "https://github.com/OpenLiberty/open-liberty/commit/aeed6ad5ccf2b5947582e6b12a3ab6fe701247f2", "message": "Handle ejb-jar.xml version 4.0 and application.xml version 9 in ddparser", "committedDate": "2020-08-13T19:56:28Z", "type": "forcePushed"}, {"oid": "ed608566567c016db0bcd1ff6f26e34323f3a93a", "url": "https://github.com/OpenLiberty/open-liberty/commit/ed608566567c016db0bcd1ff6f26e34323f3a93a", "message": "Handle ejb-jar.xml version 4.0 and application.xml version 9 in ddparser", "committedDate": "2020-08-13T20:31:20Z", "type": "commit"}, {"oid": "ed608566567c016db0bcd1ff6f26e34323f3a93a", "url": "https://github.com/OpenLiberty/open-liberty/commit/ed608566567c016db0bcd1ff6f26e34323f3a93a", "message": "Handle ejb-jar.xml version 4.0 and application.xml version 9 in ddparser", "committedDate": "2020-08-13T20:31:20Z", "type": "forcePushed"}]}