{"pr_number": 2926, "pr_title": "Update GeoIP", "pr_createdAt": "2020-01-04T10:26:38Z", "pr_url": "https://github.com/EssentialsX/Essentials/pull/2926", "timeline": [{"oid": "1968c5a2880184b85eeb454457ef3b46693cde6d", "url": "https://github.com/EssentialsX/Essentials/commit/1968c5a2880184b85eeb454457ef3b46693cde6d", "message": "Update GeoIP", "committedDate": "2020-01-04T10:18:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzAzODI2Ng==", "url": "https://github.com/EssentialsX/Essentials/pull/2926#discussion_r363038266", "bodyText": "No need else branch, because you put \"return\" in line 181.", "author": "montlikadani", "createdAt": "2020-01-04T14:32:57Z", "path": "EssentialsGeoIP/src/com/earth2me/essentials/geoip/EssentialsGeoIPPlayerListener.java", "diffHunk": "@@ -175,6 +175,13 @@ private void downloadDatabase() {\n                 logger.log(Level.SEVERE, tl(\"geoIpUrlEmpty\"));\n                 return;\n             }\n+            String licenseKey = config.getString(\"database.license-key\", \"\");\n+            if (licenseKey == null || licenseKey.isEmpty()) {\n+                logger.log(Level.SEVERE, tl(\"geoIpLicenseMissing\"));\n+                return;\n+            } else {\n+                url = url.replace(\"{LICENSEKEY}\", licenseKey);\n+            }", "originalCommit": "1968c5a2880184b85eeb454457ef3b46693cde6d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA1OTAzNQ==", "url": "https://github.com/EssentialsX/Essentials/pull/2926#discussion_r363059035", "bodyText": "Fair enough.", "author": "pop4959", "createdAt": "2020-01-04T22:48:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzAzODI2Ng=="}], "type": "inlineReview"}, {"oid": "6adfee773528dbf02f657228b9f84ffa40e99053", "url": "https://github.com/EssentialsX/Essentials/commit/6adfee773528dbf02f657228b9f84ffa40e99053", "message": "Simplify branch", "committedDate": "2020-01-04T22:45:44Z", "type": "commit"}, {"oid": "50492f2aebfc19da9af9420a580274f55e28c590", "url": "https://github.com/EssentialsX/Essentials/commit/50492f2aebfc19da9af9420a580274f55e28c590", "message": "Merge branch '2.x' of https://github.com/EssentialsX/Essentials into geoip-update", "committedDate": "2020-01-04T22:50:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA1OTI0Mg==", "url": "https://github.com/EssentialsX/Essentials/pull/2926#discussion_r363059242", "bodyText": "This feels clowny. endsWith makes it better but obviously is a generally shitty solution. Could we possibly pick up the GZIP magic numbers and make decisions off of that?", "author": "Ichbinjoe", "createdAt": "2020-01-04T22:55:19Z", "path": "EssentialsGeoIP/src/com/earth2me/essentials/geoip/EssentialsGeoIPPlayerListener.java", "diffHunk": "@@ -183,9 +189,9 @@ private void downloadDatabase() {\n             InputStream input = conn.getInputStream();\n             OutputStream output = new FileOutputStream(databaseFile);\n             byte[] buffer = new byte[2048];\n-            if (url.endsWith(\".gz\")) {\n+            if (url.contains(\"gz\")) {", "originalCommit": "6adfee773528dbf02f657228b9f84ffa40e99053", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA2MDQ4NQ==", "url": "https://github.com/EssentialsX/Essentials/pull/2926#discussion_r363060485", "bodyText": "We could but I don't know there's much of a point in doing so. I just changed it for now because the format of the URL changed. It used to be a direct link to a file with the .tar.gz suffix, but now it is a query parameter without the preceding . which may appear anywhere in the link. Feel free to suggest any code you think might work more cleanly.", "author": "pop4959", "createdAt": "2020-01-04T23:32:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA1OTI0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzEwNTMwOQ==", "url": "https://github.com/EssentialsX/Essentials/pull/2926#discussion_r363105309", "bodyText": "fuck it i guess? its a lot more code.", "author": "Ichbinjoe", "createdAt": "2020-01-05T17:04:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA1OTI0Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA1OTI4NQ==", "url": "https://github.com/EssentialsX/Essentials/pull/2926#discussion_r363059285", "bodyText": "Given the default when will licenceKey ever be null?\nMaybe instead we should remove the default and check for null.", "author": "Ichbinjoe", "createdAt": "2020-01-04T22:56:27Z", "path": "EssentialsGeoIP/src/com/earth2me/essentials/geoip/EssentialsGeoIPPlayerListener.java", "diffHunk": "@@ -175,6 +175,12 @@ private void downloadDatabase() {\n                 logger.log(Level.SEVERE, tl(\"geoIpUrlEmpty\"));\n                 return;\n             }\n+            String licenseKey = config.getString(\"database.license-key\", \"\");\n+            if (licenseKey == null || licenseKey.isEmpty()) {", "originalCommit": "50492f2aebfc19da9af9420a580274f55e28c590", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA2MDU5NA==", "url": "https://github.com/EssentialsX/Essentials/pull/2926#discussion_r363060594", "bodyText": "Not sure. A few lines up the same code is used to check the URL though, so I just went based off of that. I figure you can never be too careful.", "author": "pop4959", "createdAt": "2020-01-04T23:36:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA1OTI4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzEwNTM1Ng==", "url": "https://github.com/EssentialsX/Essentials/pull/2926#discussion_r363105356", "bodyText": "Alright let me be more straight forward.\nGiven that you defined a default, licenseKey will never be null.", "author": "Ichbinjoe", "createdAt": "2020-01-05T17:05:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA1OTI4NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA1OTMxMQ==", "url": "https://github.com/EssentialsX/Essentials/pull/2926#discussion_r363059311", "bodyText": "Consider replace all maybe? idk.", "author": "Ichbinjoe", "createdAt": "2020-01-04T22:56:58Z", "path": "EssentialsGeoIP/src/com/earth2me/essentials/geoip/EssentialsGeoIPPlayerListener.java", "diffHunk": "@@ -175,6 +175,12 @@ private void downloadDatabase() {\n                 logger.log(Level.SEVERE, tl(\"geoIpUrlEmpty\"));\n                 return;\n             }\n+            String licenseKey = config.getString(\"database.license-key\", \"\");\n+            if (licenseKey == null || licenseKey.isEmpty()) {\n+                logger.log(Level.SEVERE, tl(\"geoIpLicenseMissing\"));\n+                return;\n+            }\n+            url = url.replace(\"{LICENSEKEY}\", licenseKey);", "originalCommit": "50492f2aebfc19da9af9420a580274f55e28c590", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA2MDY0NQ==", "url": "https://github.com/EssentialsX/Essentials/pull/2926#discussion_r363060645", "bodyText": "The license key only appears in the URL once. I think it would be very strange if it appeared more than that.", "author": "pop4959", "createdAt": "2020-01-04T23:37:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA1OTMxMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA2MDk3MA==", "url": "https://github.com/EssentialsX/Essentials/pull/2926#discussion_r363060970", "bodyText": "You could probably put the license key at the end of the URL if that was easier.  Then just append the value from the config.", "author": "Bobcat00", "createdAt": "2020-01-04T23:47:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA1OTMxMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA2MTM3Mw==", "url": "https://github.com/EssentialsX/Essentials/pull/2926#discussion_r363061373", "bodyText": "That is ironically the exact reason why I was having troubles before. I had the suffix query parameter in the middle rather than at the end, which caused url.endsWith(\".gz\") to break down. I think it's better to keep it a placeholder (in the same fashion as the base EssentialsX module does in its config). There technically isn't any requirement for the license key to be at the end (or even in the URL at all), so I don't think it would be wise to impose that on users (especially if they use a custom download link).", "author": "pop4959", "createdAt": "2020-01-05T00:00:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA1OTMxMQ=="}], "type": "inlineReview"}, {"oid": "10c4a21be0e82f889c5e012415ea7ee4d14b5799", "url": "https://github.com/EssentialsX/Essentials/commit/10c4a21be0e82f889c5e012415ea7ee4d14b5799", "message": "Update old config detection", "committedDate": "2020-01-04T23:17:45Z", "type": "commit"}, {"oid": "f0b1cc28b581503bd24d635fcc3e764d0021553e", "url": "https://github.com/EssentialsX/Essentials/commit/f0b1cc28b581503bd24d635fcc3e764d0021553e", "message": "Update geoIpLicenseMissing to point to the EssX wiki", "committedDate": "2020-01-10T21:58:40Z", "type": "commit"}]}