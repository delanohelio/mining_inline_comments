{"pr_number": 3415, "pr_title": "EditSign Command", "pr_createdAt": "2020-06-26T16:15:14Z", "pr_url": "https://github.com/EssentialsX/Essentials/pull/3415", "timeline": [{"oid": "3cd99e75b6a970cd32a45bb674fbce05c971412b", "url": "https://github.com/EssentialsX/Essentials/commit/3cd99e75b6a970cd32a45bb674fbce05c971412b", "message": "editsign Command", "committedDate": "2020-06-26T16:14:17Z", "type": "commit"}, {"oid": "146f128fb583578b0a0c30b9fcdd673d2bf6b01d", "url": "https://github.com/EssentialsX/Essentials/commit/146f128fb583578b0a0c30b9fcdd673d2bf6b01d", "message": "Permissions", "committedDate": "2020-06-26T16:19:30Z", "type": "commit"}, {"oid": "5b49cc195cc5268ddbd30f77ea5d1e938cc3cef7", "url": "https://github.com/EssentialsX/Essentials/commit/5b49cc195cc5268ddbd30f77ea5d1e938cc3cef7", "message": "Permissions", "committedDate": "2020-06-26T16:19:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI4MzQ4MQ==", "url": "https://github.com/EssentialsX/Essentials/pull/3415#discussion_r446283481", "bodyText": "You can do here a new argument to clear all lines for lazy peoples.\nEDIT: reset -> clear", "author": "montlikadani", "createdAt": "2020-06-26T16:23:01Z", "path": "Essentials/src/com/earth2me/essentials/commands/Commandeditsign.java", "diffHunk": "@@ -0,0 +1,65 @@\n+package com.earth2me.essentials.commands;\n+\n+import com.earth2me.essentials.User;\n+import com.earth2me.essentials.utils.FormatUtil;\n+import com.earth2me.essentials.utils.NumberUtil;\n+import com.google.common.collect.Lists;\n+import org.bukkit.ChatColor;\n+import org.bukkit.Server;\n+import org.bukkit.block.Block;\n+import org.bukkit.block.Sign;\n+\n+import java.util.Collections;\n+import java.util.List;\n+\n+import static com.earth2me.essentials.I18n.tl;\n+\n+public class Commandeditsign extends EssentialsCommand {\n+    public Commandeditsign() {\n+        super(\"editsign\");\n+    }\n+\n+    @Override\n+    protected void run(Server server, User user, String commandLabel, String[] args) throws Exception {\n+        if (args.length < 2 || !NumberUtil.isInt(args[1])) {\n+            throw new NotEnoughArgumentsException();\n+        }\n+\n+        Block target = user.getBase().getTargetBlock(null, 5); //5 is a good number\n+        if (!(target.getState() instanceof Sign)) {\n+            throw new Exception(tl(\"editsignCommandTarget\"));\n+        }\n+        Sign sign = (Sign) target.getState();\n+        int line = Integer.parseInt(args[1]) - 1;\n+        try {\n+            if (args[0].equalsIgnoreCase(\"set\") && args.length > 2) {\n+                String text = FormatUtil.formatString(user, \"essentials.editsign\", getFinalArg(args, 2)).trim();\n+                if (ChatColor.stripColor(text).length() > 15 && !user.isAuthorized(\"essentials.editsign.unlimited\")) {\n+                    throw new Exception(tl(\"editsignCommandLimit\"));\n+                }\n+                sign.setLine(line, text);\n+                sign.update();\n+                user.sendMessage(tl(\"editsignCommandSetSuccess\", line + 1, text));\n+            } else if (args[0].equalsIgnoreCase(\"reset\")) {\n+                sign.setLine(line, \"\");\n+                sign.update();\n+                user.sendMessage(tl(\"editsignCommandResetLine\", line + 1));\n+            } else {", "originalCommit": "5b49cc195cc5268ddbd30f77ea5d1e938cc3cef7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI4MzM0OQ==", "url": "https://github.com/EssentialsX/Essentials/pull/3415#discussion_r446283349", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        } else if (args[0].equalsIgnoreCase(\"reset\")) {\n          \n          \n            \n                        } else if (args[0].equalsIgnoreCase(\"clear\")) {", "author": "mdcfe", "createdAt": "2020-06-26T16:22:45Z", "path": "Essentials/src/com/earth2me/essentials/commands/Commandeditsign.java", "diffHunk": "@@ -0,0 +1,65 @@\n+package com.earth2me.essentials.commands;\n+\n+import com.earth2me.essentials.User;\n+import com.earth2me.essentials.utils.FormatUtil;\n+import com.earth2me.essentials.utils.NumberUtil;\n+import com.google.common.collect.Lists;\n+import org.bukkit.ChatColor;\n+import org.bukkit.Server;\n+import org.bukkit.block.Block;\n+import org.bukkit.block.Sign;\n+\n+import java.util.Collections;\n+import java.util.List;\n+\n+import static com.earth2me.essentials.I18n.tl;\n+\n+public class Commandeditsign extends EssentialsCommand {\n+    public Commandeditsign() {\n+        super(\"editsign\");\n+    }\n+\n+    @Override\n+    protected void run(Server server, User user, String commandLabel, String[] args) throws Exception {\n+        if (args.length < 2 || !NumberUtil.isInt(args[1])) {\n+            throw new NotEnoughArgumentsException();\n+        }\n+\n+        Block target = user.getBase().getTargetBlock(null, 5); //5 is a good number\n+        if (!(target.getState() instanceof Sign)) {\n+            throw new Exception(tl(\"editsignCommandTarget\"));\n+        }\n+        Sign sign = (Sign) target.getState();\n+        int line = Integer.parseInt(args[1]) - 1;\n+        try {\n+            if (args[0].equalsIgnoreCase(\"set\") && args.length > 2) {\n+                String text = FormatUtil.formatString(user, \"essentials.editsign\", getFinalArg(args, 2)).trim();\n+                if (ChatColor.stripColor(text).length() > 15 && !user.isAuthorized(\"essentials.editsign.unlimited\")) {\n+                    throw new Exception(tl(\"editsignCommandLimit\"));\n+                }\n+                sign.setLine(line, text);\n+                sign.update();\n+                user.sendMessage(tl(\"editsignCommandSetSuccess\", line + 1, text));\n+            } else if (args[0].equalsIgnoreCase(\"reset\")) {", "originalCommit": "5b49cc195cc5268ddbd30f77ea5d1e938cc3cef7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "4cce9bc5177f532d7b26e1b04d054ed24c04bbcb", "url": "https://github.com/EssentialsX/Essentials/commit/4cce9bc5177f532d7b26e1b04d054ed24c04bbcb", "message": "Make everyone happy smile", "committedDate": "2020-06-27T03:29:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ4MDExMA==", "url": "https://github.com/EssentialsX/Essentials/pull/3415#discussion_r446480110", "bodyText": "Maybe something more like this to show flow better. Also, resetting the whole sign is missing a feedback message.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                return;\n          \n          \n            \n                            }\n          \n          \n            \n                            int line = Integer.parseInt(args[1]) - 1;\n          \n          \n            \n                            sign.setLine(line, \"\");\n          \n          \n            \n                            sign.update();\n          \n          \n            \n                            user.sendMessage(tl(\"editsignCommandResetLine\", line + 1));\n          \n          \n            \n                            } else {\n          \n          \n            \n                                int line = Integer.parseInt(args[1]) - 1;\n          \n          \n            \n                                sign.setLine(line, \"\");\n          \n          \n            \n                                sign.update();\n          \n          \n            \n                                user.sendMessage(tl(\"editsignCommandResetLine\", line + 1));\n          \n          \n            \n                            }", "author": "pop4959", "createdAt": "2020-06-27T03:48:47Z", "path": "Essentials/src/com/earth2me/essentials/commands/Commandeditsign.java", "diffHunk": "@@ -0,0 +1,73 @@\n+package com.earth2me.essentials.commands;\n+\n+import com.earth2me.essentials.User;\n+import com.earth2me.essentials.utils.FormatUtil;\n+import com.earth2me.essentials.utils.NumberUtil;\n+import com.google.common.collect.Lists;\n+import org.bukkit.ChatColor;\n+import org.bukkit.Server;\n+import org.bukkit.block.Block;\n+import org.bukkit.block.Sign;\n+\n+import java.util.Collections;\n+import java.util.List;\n+\n+import static com.earth2me.essentials.I18n.tl;\n+\n+public class Commandeditsign extends EssentialsCommand {\n+    public Commandeditsign() {\n+        super(\"editsign\");\n+    }\n+\n+    @Override\n+    protected void run(Server server, User user, String commandLabel, String[] args) throws Exception {\n+        if (args.length == 0 || (args.length > 1 && !NumberUtil.isInt(args[1]))) {\n+            throw new NotEnoughArgumentsException();\n+        }\n+\n+        Block target = user.getBase().getTargetBlock(null, 5); //5 is a good number\n+        if (!(target.getState() instanceof Sign)) {\n+            throw new Exception(tl(\"editsignCommandTarget\"));\n+        }\n+        Sign sign = (Sign) target.getState();\n+        try {\n+            if (args[0].equalsIgnoreCase(\"set\") && args.length > 2) {\n+                int line = Integer.parseInt(args[1]) - 1;\n+                String text = FormatUtil.formatString(user, \"essentials.editsign\", getFinalArg(args, 2)).trim();\n+                if (ChatColor.stripColor(text).length() > 15 && !user.isAuthorized(\"essentials.editsign.unlimited\")) {\n+                    throw new Exception(tl(\"editsignCommandLimit\"));\n+                }\n+                sign.setLine(line, text);\n+                sign.update();\n+                user.sendMessage(tl(\"editsignCommandSetSuccess\", line + 1, text));\n+            } else if (args[0].equalsIgnoreCase(\"clear\")) {\n+                if (args.length == 1) {\n+                    for (int i = 0; i < 4; i++) { // A whole one line of line savings!\n+                        sign.setLine(i, \"\");\n+                    }\n+                    sign.update();\n+                    return;\n+                }\n+                int line = Integer.parseInt(args[1]) - 1;\n+                sign.setLine(line, \"\");\n+                sign.update();\n+                user.sendMessage(tl(\"editsignCommandResetLine\", line + 1));", "originalCommit": "4cce9bc5177f532d7b26e1b04d054ed24c04bbcb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ4MDI5Mw==", "url": "https://github.com/EssentialsX/Essentials/pull/3415#discussion_r446480293", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        return Lists.newArrayList(\"set\", \"reset\");\n          \n          \n            \n                        return Lists.newArrayList(\"set\", \"clear\");", "author": "pop4959", "createdAt": "2020-06-27T03:50:50Z", "path": "Essentials/src/com/earth2me/essentials/commands/Commandeditsign.java", "diffHunk": "@@ -0,0 +1,73 @@\n+package com.earth2me.essentials.commands;\n+\n+import com.earth2me.essentials.User;\n+import com.earth2me.essentials.utils.FormatUtil;\n+import com.earth2me.essentials.utils.NumberUtil;\n+import com.google.common.collect.Lists;\n+import org.bukkit.ChatColor;\n+import org.bukkit.Server;\n+import org.bukkit.block.Block;\n+import org.bukkit.block.Sign;\n+\n+import java.util.Collections;\n+import java.util.List;\n+\n+import static com.earth2me.essentials.I18n.tl;\n+\n+public class Commandeditsign extends EssentialsCommand {\n+    public Commandeditsign() {\n+        super(\"editsign\");\n+    }\n+\n+    @Override\n+    protected void run(Server server, User user, String commandLabel, String[] args) throws Exception {\n+        if (args.length == 0 || (args.length > 1 && !NumberUtil.isInt(args[1]))) {\n+            throw new NotEnoughArgumentsException();\n+        }\n+\n+        Block target = user.getBase().getTargetBlock(null, 5); //5 is a good number\n+        if (!(target.getState() instanceof Sign)) {\n+            throw new Exception(tl(\"editsignCommandTarget\"));\n+        }\n+        Sign sign = (Sign) target.getState();\n+        try {\n+            if (args[0].equalsIgnoreCase(\"set\") && args.length > 2) {\n+                int line = Integer.parseInt(args[1]) - 1;\n+                String text = FormatUtil.formatString(user, \"essentials.editsign\", getFinalArg(args, 2)).trim();\n+                if (ChatColor.stripColor(text).length() > 15 && !user.isAuthorized(\"essentials.editsign.unlimited\")) {\n+                    throw new Exception(tl(\"editsignCommandLimit\"));\n+                }\n+                sign.setLine(line, text);\n+                sign.update();\n+                user.sendMessage(tl(\"editsignCommandSetSuccess\", line + 1, text));\n+            } else if (args[0].equalsIgnoreCase(\"clear\")) {\n+                if (args.length == 1) {\n+                    for (int i = 0; i < 4; i++) { // A whole one line of line savings!\n+                        sign.setLine(i, \"\");\n+                    }\n+                    sign.update();\n+                    return;\n+                }\n+                int line = Integer.parseInt(args[1]) - 1;\n+                sign.setLine(line, \"\");\n+                sign.update();\n+                user.sendMessage(tl(\"editsignCommandResetLine\", line + 1));\n+            } else {\n+                throw new NotEnoughArgumentsException();\n+            }\n+        } catch (IndexOutOfBoundsException e) {\n+            throw new Exception(tl(\"editsignCommandNoLine\"));\n+        }\n+    }\n+\n+    @Override\n+    protected List<String> getTabCompleteOptions(Server server, User user, String commandLabel, String[] args) {\n+        if (args.length == 1) {\n+            return Lists.newArrayList(\"set\", \"reset\");", "originalCommit": "4cce9bc5177f532d7b26e1b04d054ed24c04bbcb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "34336657c51d4f95df73869af93ddea19a3ee523", "url": "https://github.com/EssentialsX/Essentials/commit/34336657c51d4f95df73869af93ddea19a3ee523", "message": "Review changes", "committedDate": "2020-06-27T03:59:28Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODYwMjQxOA==", "url": "https://github.com/EssentialsX/Essentials/pull/3415#discussion_r448602418", "bodyText": "I don't know whether we should just use essentials.sign.<format>? People accustomed to EssentialsX's existing sign formatting permissions might be confused about the separate permission. Alternatively we could keep this as-is, and recommend the LP shorthand format if people want to use a single entry (essentials.{sign,editsign}.{color,format}).", "author": "mdcfe", "createdAt": "2020-07-01T20:35:46Z", "path": "Essentials/src/com/earth2me/essentials/commands/Commandeditsign.java", "diffHunk": "@@ -0,0 +1,74 @@\n+package com.earth2me.essentials.commands;\n+\n+import com.earth2me.essentials.User;\n+import com.earth2me.essentials.utils.FormatUtil;\n+import com.earth2me.essentials.utils.NumberUtil;\n+import com.google.common.collect.Lists;\n+import org.bukkit.ChatColor;\n+import org.bukkit.Server;\n+import org.bukkit.block.Block;\n+import org.bukkit.block.Sign;\n+\n+import java.util.Collections;\n+import java.util.List;\n+\n+import static com.earth2me.essentials.I18n.tl;\n+\n+public class Commandeditsign extends EssentialsCommand {\n+    public Commandeditsign() {\n+        super(\"editsign\");\n+    }\n+\n+    @Override\n+    protected void run(Server server, User user, String commandLabel, String[] args) throws Exception {\n+        if (args.length == 0 || (args.length > 1 && !NumberUtil.isInt(args[1]))) {\n+            throw new NotEnoughArgumentsException();\n+        }\n+\n+        Block target = user.getBase().getTargetBlock(null, 5); //5 is a good number\n+        if (!(target.getState() instanceof Sign)) {\n+            throw new Exception(tl(\"editsignCommandTarget\"));\n+        }\n+        Sign sign = (Sign) target.getState();\n+        try {\n+            if (args[0].equalsIgnoreCase(\"set\") && args.length > 2) {\n+                int line = Integer.parseInt(args[1]) - 1;\n+                String text = FormatUtil.formatString(user, \"essentials.editsign\", getFinalArg(args, 2)).trim();", "originalCommit": "34336657c51d4f95df73869af93ddea19a3ee523", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODYwMjY3Ng==", "url": "https://github.com/EssentialsX/Essentials/pull/3415#discussion_r448602676", "bodyText": "o p t i m i s a t i o n", "author": "mdcfe", "createdAt": "2020-07-01T20:36:16Z", "path": "Essentials/src/com/earth2me/essentials/commands/Commandeditsign.java", "diffHunk": "@@ -0,0 +1,74 @@\n+package com.earth2me.essentials.commands;\n+\n+import com.earth2me.essentials.User;\n+import com.earth2me.essentials.utils.FormatUtil;\n+import com.earth2me.essentials.utils.NumberUtil;\n+import com.google.common.collect.Lists;\n+import org.bukkit.ChatColor;\n+import org.bukkit.Server;\n+import org.bukkit.block.Block;\n+import org.bukkit.block.Sign;\n+\n+import java.util.Collections;\n+import java.util.List;\n+\n+import static com.earth2me.essentials.I18n.tl;\n+\n+public class Commandeditsign extends EssentialsCommand {\n+    public Commandeditsign() {\n+        super(\"editsign\");\n+    }\n+\n+    @Override\n+    protected void run(Server server, User user, String commandLabel, String[] args) throws Exception {\n+        if (args.length == 0 || (args.length > 1 && !NumberUtil.isInt(args[1]))) {\n+            throw new NotEnoughArgumentsException();\n+        }\n+\n+        Block target = user.getBase().getTargetBlock(null, 5); //5 is a good number\n+        if (!(target.getState() instanceof Sign)) {\n+            throw new Exception(tl(\"editsignCommandTarget\"));\n+        }\n+        Sign sign = (Sign) target.getState();\n+        try {\n+            if (args[0].equalsIgnoreCase(\"set\") && args.length > 2) {\n+                int line = Integer.parseInt(args[1]) - 1;\n+                String text = FormatUtil.formatString(user, \"essentials.editsign\", getFinalArg(args, 2)).trim();\n+                if (ChatColor.stripColor(text).length() > 15 && !user.isAuthorized(\"essentials.editsign.unlimited\")) {\n+                    throw new Exception(tl(\"editsignCommandLimit\"));\n+                }\n+                sign.setLine(line, text);\n+                sign.update();\n+                user.sendMessage(tl(\"editsignCommandSetSuccess\", line + 1, text));\n+            } else if (args[0].equalsIgnoreCase(\"clear\")) {\n+                if (args.length == 1) {\n+                    for (int i = 0; i < 4; i++) { // A whole one line of line savings!", "originalCommit": "34336657c51d4f95df73869af93ddea19a3ee523", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e7a1a0739fa2ce72c463c4706320d965c8fa50ca", "url": "https://github.com/EssentialsX/Essentials/commit/e7a1a0739fa2ce72c463c4706320d965c8fa50ca", "message": "Apply suggestions from code review\n\nCo-authored-by: MD <1917406+md678685@users.noreply.github.com>", "committedDate": "2020-07-01T20:48:25Z", "type": "commit"}]}