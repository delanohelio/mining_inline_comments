{"pr_number": 3480, "pr_title": "Fixed how the random teleporter picks a location.", "pr_createdAt": "2020-07-10T03:23:32Z", "pr_url": "https://github.com/EssentialsX/Essentials/pull/3480", "timeline": [{"oid": "684445179a61627b10cbcce12ac4e2b99ba0f1a1", "url": "https://github.com/EssentialsX/Essentials/commit/684445179a61627b10cbcce12ac4e2b99ba0f1a1", "message": "Fixed how the random teleporter picks a location.", "committedDate": "2020-07-10T03:05:56Z", "type": "commit"}, {"oid": "02e342716ccc33a530511b17ab6e7d3464ac96d5", "url": "https://github.com/EssentialsX/Essentials/commit/02e342716ccc33a530511b17ab6e7d3464ac96d5", "message": "Amended my previous commit.\nBefore, I introduced a method to multiply a matrix by a vector, even though there were only ever 3 matrices that would ever be inputted. Instead, I took those three cases and simplified the math (it actually really simplifies) and hard coded it in. If there is ever a need for a method to multiply a matrix by a vector it wouldn't even belong in this class anyway.\n\nSide note, the only thing that changed functionally in this commit is that the random point is no longer rounded to an integer, so the offset may be something like 5.83. I have no idea if that matters, but it can be changed very easily, and I'll allow whoever pulls this to make that decision.", "committedDate": "2020-07-11T00:40:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE0MTkxMg==", "url": "https://github.com/EssentialsX/Essentials/pull/3480#discussion_r453141912", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    double[] offset = getRandXySquare(minRange, maxRange);\n          \n          \n            \n                    double[] offsets = getOffsets(minRange, maxRange);\n          \n      \n    \n    \n  \n\nMight be a better name?", "author": "pop4959", "createdAt": "2020-07-11T02:04:16Z", "path": "Essentials/src/com/earth2me/essentials/RandomTeleport.java", "diffHunk": "@@ -155,12 +155,12 @@ public void cacheRandomLocations(Location center, double minRange, double maxRan\n     // Calculates a random location asynchronously.\n     private CompletableFuture<Location> calculateRandomLocation(Location center, double minRange, double maxRange) {\n         CompletableFuture<Location> future = new CompletableFuture<>();\n-        final int dx = RANDOM.nextBoolean() ? 1 : -1, dz = RANDOM.nextBoolean() ? 1 : -1;\n+        double[] offset = getRandXySquare(minRange, maxRange);", "originalCommit": "02e342716ccc33a530511b17ab6e7d3464ac96d5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE0MTk1OQ==", "url": "https://github.com/EssentialsX/Essentials/pull/3480#discussion_r453141959", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            center.getX() + offset[0],\n          \n          \n            \n                            center.getX() + offsets[0],", "author": "pop4959", "createdAt": "2020-07-11T02:04:34Z", "path": "Essentials/src/com/earth2me/essentials/RandomTeleport.java", "diffHunk": "@@ -155,12 +155,12 @@ public void cacheRandomLocations(Location center, double minRange, double maxRan\n     // Calculates a random location asynchronously.\n     private CompletableFuture<Location> calculateRandomLocation(Location center, double minRange, double maxRange) {\n         CompletableFuture<Location> future = new CompletableFuture<>();\n-        final int dx = RANDOM.nextBoolean() ? 1 : -1, dz = RANDOM.nextBoolean() ? 1 : -1;\n+        double[] offset = getRandXySquare(minRange, maxRange);\n         Location location = new Location(\n                 center.getWorld(),\n-                center.getX() + dx * (minRange + RANDOM.nextDouble() * (maxRange - minRange)),\n+                center.getX() + offset[0],", "originalCommit": "02e342716ccc33a530511b17ab6e7d3464ac96d5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE0MTk2Mg==", "url": "https://github.com/EssentialsX/Essentials/pull/3480#discussion_r453141962", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            center.getZ() + offset[1],\n          \n          \n            \n                            center.getZ() + offsets[1],", "author": "pop4959", "createdAt": "2020-07-11T02:04:36Z", "path": "Essentials/src/com/earth2me/essentials/RandomTeleport.java", "diffHunk": "@@ -155,12 +155,12 @@ public void cacheRandomLocations(Location center, double minRange, double maxRan\n     // Calculates a random location asynchronously.\n     private CompletableFuture<Location> calculateRandomLocation(Location center, double minRange, double maxRange) {\n         CompletableFuture<Location> future = new CompletableFuture<>();\n-        final int dx = RANDOM.nextBoolean() ? 1 : -1, dz = RANDOM.nextBoolean() ? 1 : -1;\n+        double[] offset = getRandXySquare(minRange, maxRange);\n         Location location = new Location(\n                 center.getWorld(),\n-                center.getX() + dx * (minRange + RANDOM.nextDouble() * (maxRange - minRange)),\n+                center.getX() + offset[0],\n                 center.getWorld().getMaxHeight(),\n-                center.getZ() + dz * (minRange + RANDOM.nextDouble() * (maxRange - minRange)),\n+                center.getZ() + offset[1],", "originalCommit": "02e342716ccc33a530511b17ab6e7d3464ac96d5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE0MTk4MQ==", "url": "https://github.com/EssentialsX/Essentials/pull/3480#discussion_r453141981", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private double[] getRandXySquare(double minRange, double maxRange) {\n          \n          \n            \n                private double[] getOffsets(double minRange, double maxRange) {", "author": "pop4959", "createdAt": "2020-07-11T02:04:55Z", "path": "Essentials/src/com/earth2me/essentials/RandomTeleport.java", "diffHunk": "@@ -175,6 +175,36 @@ public void cacheRandomLocations(Location center, double minRange, double maxRan\n         return future;\n     }\n \n+    /**\n+     * Returns an int array of length 2, representing a random coordinate pair that is both inside the square\n+     * <pre>{@code x = maxRange * 2 and y = maxRange * 2 centered on (0,0)}</pre>\n+     * and also NOT inside the square\n+     * <pre>{@code x = minRange * 2 and y = minRange * 2 centered on (0,0)}</pre>\n+     * The points generated by this method are evenly distributed throughout the area.\n+     *\n+     * @param minRange The minimum that {@code |x|} or {@code |y|} will be.\n+     * @param maxRange The maximum that {@code |x|} or {@code |y|} will be.\n+     * @return A pair of numbers, each randomly generated, that satisfy the above conditions.\n+     */\n+    private double[] getRandXySquare(double minRange, double maxRange) {", "originalCommit": "02e342716ccc33a530511b17ab6e7d3464ac96d5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE0MjMxOQ==", "url": "https://github.com/EssentialsX/Essentials/pull/3480#discussion_r453142319", "bodyText": "The rest of this file doesn't really have javadocs, and none of it is really API. If you can match the code style and turn this into a simple line (or multi-line) comment explaining what it does that would be cool. Otherwise we might want to think about adding javadocs to everything else here. \ud83d\ude1b", "author": "pop4959", "createdAt": "2020-07-11T02:08:11Z", "path": "Essentials/src/com/earth2me/essentials/RandomTeleport.java", "diffHunk": "@@ -175,6 +175,36 @@ public void cacheRandomLocations(Location center, double minRange, double maxRan\n         return future;\n     }\n \n+    /**\n+     * Returns an int array of length 2, representing a random coordinate pair that is both inside the square\n+     * <pre>{@code x = maxRange * 2 and y = maxRange * 2 centered on (0,0)}</pre>\n+     * and also NOT inside the square\n+     * <pre>{@code x = minRange * 2 and y = minRange * 2 centered on (0,0)}</pre>\n+     * The points generated by this method are evenly distributed throughout the area.\n+     *\n+     * @param minRange The minimum that {@code |x|} or {@code |y|} will be.\n+     * @param maxRange The maximum that {@code |x|} or {@code |y|} will be.\n+     * @return A pair of numbers, each randomly generated, that satisfy the above conditions.\n+     */", "originalCommit": "02e342716ccc33a530511b17ab6e7d3464ac96d5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE0MjYwMw==", "url": "https://github.com/EssentialsX/Essentials/pull/3480#discussion_r453142603", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    switch ((int) (RANDOM.nextDouble() * 4)) {\n          \n          \n            \n                    switch (RANDOM.nextInt(4)) {", "author": "pop4959", "createdAt": "2020-07-11T02:11:23Z", "path": "Essentials/src/com/earth2me/essentials/RandomTeleport.java", "diffHunk": "@@ -175,6 +175,36 @@ public void cacheRandomLocations(Location center, double minRange, double maxRan\n         return future;\n     }\n \n+    /**\n+     * Returns an int array of length 2, representing a random coordinate pair that is both inside the square\n+     * <pre>{@code x = maxRange * 2 and y = maxRange * 2 centered on (0,0)}</pre>\n+     * and also NOT inside the square\n+     * <pre>{@code x = minRange * 2 and y = minRange * 2 centered on (0,0)}</pre>\n+     * The points generated by this method are evenly distributed throughout the area.\n+     *\n+     * @param minRange The minimum that {@code |x|} or {@code |y|} will be.\n+     * @param maxRange The maximum that {@code |x|} or {@code |y|} will be.\n+     * @return A pair of numbers, each randomly generated, that satisfy the above conditions.\n+     */\n+    private double[] getRandXySquare(double minRange, double maxRange) {\n+        double[] randPairAtSize = new double[]{\n+                RANDOM.nextDouble() * (maxRange - minRange) + minRange,\n+                RANDOM.nextDouble() * (maxRange + minRange) - minRange};\n+        switch ((int) (RANDOM.nextDouble() * 4)) {", "originalCommit": "02e342716ccc33a530511b17ab6e7d3464ac96d5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE0MjY2MA==", "url": "https://github.com/EssentialsX/Essentials/pull/3480#discussion_r453142660", "bodyText": "Why not just case 1,2,3 and default? Default can catch 0 and any impossible case.", "author": "pop4959", "createdAt": "2020-07-11T02:12:05Z", "path": "Essentials/src/com/earth2me/essentials/RandomTeleport.java", "diffHunk": "@@ -175,6 +175,36 @@ public void cacheRandomLocations(Location center, double minRange, double maxRan\n         return future;\n     }\n \n+    /**\n+     * Returns an int array of length 2, representing a random coordinate pair that is both inside the square\n+     * <pre>{@code x = maxRange * 2 and y = maxRange * 2 centered on (0,0)}</pre>\n+     * and also NOT inside the square\n+     * <pre>{@code x = minRange * 2 and y = minRange * 2 centered on (0,0)}</pre>\n+     * The points generated by this method are evenly distributed throughout the area.\n+     *\n+     * @param minRange The minimum that {@code |x|} or {@code |y|} will be.\n+     * @param maxRange The maximum that {@code |x|} or {@code |y|} will be.\n+     * @return A pair of numbers, each randomly generated, that satisfy the above conditions.\n+     */\n+    private double[] getRandXySquare(double minRange, double maxRange) {\n+        double[] randPairAtSize = new double[]{\n+                RANDOM.nextDouble() * (maxRange - minRange) + minRange,\n+                RANDOM.nextDouble() * (maxRange + minRange) - minRange};\n+        switch ((int) (RANDOM.nextDouble() * 4)) {\n+            case 0:\n+                return randPairAtSize;\n+            case 1:\n+                return new double[]{-randPairAtSize[1], randPairAtSize[0]};\n+            case 2:\n+                return new double[]{-randPairAtSize[0], -randPairAtSize[1]};\n+            case 3:\n+                return new double[]{randPairAtSize[1], -randPairAtSize[0]};\n+        }\n+        //This line will never be reached as the random number in the switch will ALWAYS be in the range 0-3 inclusive.\n+        return new double[]{0, 0};", "originalCommit": "02e342716ccc33a530511b17ab6e7d3464ac96d5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE0MjgzMg==", "url": "https://github.com/EssentialsX/Essentials/pull/3480#discussion_r453142832", "bodyText": "Oh true, I like that", "author": "donvi-bz", "createdAt": "2020-07-11T02:14:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE0MjY2MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE0MjY4Nw==", "url": "https://github.com/EssentialsX/Essentials/pull/3480#discussion_r453142687", "bodyText": "There's an extra newline here that shouldn't be here \ud83d\ude09", "author": "pop4959", "createdAt": "2020-07-11T02:12:30Z", "path": "Essentials/src/com/earth2me/essentials/RandomTeleport.java", "diffHunk": "@@ -175,6 +175,36 @@ public void cacheRandomLocations(Location center, double minRange, double maxRan\n         return future;\n     }\n \n+    /**\n+     * Returns an int array of length 2, representing a random coordinate pair that is both inside the square\n+     * <pre>{@code x = maxRange * 2 and y = maxRange * 2 centered on (0,0)}</pre>\n+     * and also NOT inside the square\n+     * <pre>{@code x = minRange * 2 and y = minRange * 2 centered on (0,0)}</pre>\n+     * The points generated by this method are evenly distributed throughout the area.\n+     *\n+     * @param minRange The minimum that {@code |x|} or {@code |y|} will be.\n+     * @param maxRange The maximum that {@code |x|} or {@code |y|} will be.\n+     * @return A pair of numbers, each randomly generated, that satisfy the above conditions.\n+     */\n+    private double[] getRandXySquare(double minRange, double maxRange) {\n+        double[] randPairAtSize = new double[]{\n+                RANDOM.nextDouble() * (maxRange - minRange) + minRange,\n+                RANDOM.nextDouble() * (maxRange + minRange) - minRange};\n+        switch ((int) (RANDOM.nextDouble() * 4)) {\n+            case 0:\n+                return randPairAtSize;\n+            case 1:\n+                return new double[]{-randPairAtSize[1], randPairAtSize[0]};\n+            case 2:\n+                return new double[]{-randPairAtSize[0], -randPairAtSize[1]};\n+            case 3:\n+                return new double[]{randPairAtSize[1], -randPairAtSize[0]};\n+        }\n+        //This line will never be reached as the random number in the switch will ALWAYS be in the range 0-3 inclusive.\n+        return new double[]{0, 0};\n+    }\n+\n+", "originalCommit": "02e342716ccc33a530511b17ab6e7d3464ac96d5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "fa02621e08bce7c2120cdbd2add0ad65a825cb50", "url": "https://github.com/EssentialsX/Essentials/commit/fa02621e08bce7c2120cdbd2add0ad65a825cb50", "message": "Small cleanup", "committedDate": "2020-07-11T02:26:34Z", "type": "commit"}, {"oid": "e35fb82bc2e1c128a47316f7a54458c150ab00f1", "url": "https://github.com/EssentialsX/Essentials/commit/e35fb82bc2e1c128a47316f7a54458c150ab00f1", "message": "Add UserTeleportHomeEvent (#3403)\n\nAdds an event which allows developers to see & cancel when users attempt to teleport home. This event is needed over `PreTeleportEvent` due to the fact that it would be extremely difficult to accurately filter it by the /home command.\r\n\r\nCloses #3401", "committedDate": "2020-07-08T18:53:32Z", "type": "forcePushed"}, {"oid": "ae371b8a98964437378a92b2426c7403fc8ead69", "url": "https://github.com/EssentialsX/Essentials/commit/ae371b8a98964437378a92b2426c7403fc8ead69", "message": "Removed redundant cast.", "committedDate": "2020-07-11T13:26:33Z", "type": "commit"}, {"oid": "805eff011e45abc0b453d5e0d655dfae6e3da880", "url": "https://github.com/EssentialsX/Essentials/commit/805eff011e45abc0b453d5e0d655dfae6e3da880", "message": "Made variable name plural\n\nCo-authored-by: pop4959 <pop4959@gmail.com>", "committedDate": "2020-07-12T15:54:54Z", "type": "commit"}, {"oid": "08bde771d70db5505fad75608c90d0dddbe3ec56", "url": "https://github.com/EssentialsX/Essentials/commit/08bde771d70db5505fad75608c90d0dddbe3ec56", "message": "Made variable name plural\n\nCo-authored-by: pop4959 <pop4959@gmail.com>", "committedDate": "2020-07-12T15:55:00Z", "type": "commit"}, {"oid": "6bde3a87f9d7740bf2588ad1ee21a0ef69bcd6b6", "url": "https://github.com/EssentialsX/Essentials/commit/6bde3a87f9d7740bf2588ad1ee21a0ef69bcd6b6", "message": "Plural", "committedDate": "2020-07-13T19:16:45Z", "type": "commit"}, {"oid": "07f405634d73c131e68d2d0c742a834f4855c744", "url": "https://github.com/EssentialsX/Essentials/commit/07f405634d73c131e68d2d0c742a834f4855c744", "message": "Merge remote-tracking branch 'origin/2.x' into 2.x", "committedDate": "2020-07-13T19:17:27Z", "type": "commit"}, {"oid": "7db77e126d1eab0735b07d5cff8109783cb9b6cc", "url": "https://github.com/EssentialsX/Essentials/commit/7db77e126d1eab0735b07d5cff8109783cb9b6cc", "message": "Functionally the same, style completely different.", "committedDate": "2020-07-17T20:37:05Z", "type": "commit"}, {"oid": "9dc3e7c5422f4e14fcaa044f5d2b872eace3a278", "url": "https://github.com/EssentialsX/Essentials/commit/9dc3e7c5422f4e14fcaa044f5d2b872eace3a278", "message": "Remove extra newline", "committedDate": "2020-07-17T20:49:41Z", "type": "commit"}]}