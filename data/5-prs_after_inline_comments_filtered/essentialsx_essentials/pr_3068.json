{"pr_number": 3068, "pr_title": "Improve MuteStatusChangeEvent", "pr_createdAt": "2020-03-13T14:30:48Z", "pr_url": "https://github.com/EssentialsX/Essentials/pull/3068", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjQ2NDIwMA==", "url": "https://github.com/EssentialsX/Essentials/pull/3068#discussion_r392464200", "bodyText": "The event is Cancellable, so I don't think you should be doing this before knowing the outcome. I had a similar issue while implementing #2807 (which perhaps we should merge before handling this issue, since it seems a lot of the code refactoring is already done there).", "author": "pop4959", "createdAt": "2020-03-13T20:44:47Z", "path": "Essentials/src/com/earth2me/essentials/commands/Commandmute.java", "diffHunk": "@@ -40,25 +40,32 @@ public void run(final Server server, final CommandSource sender, final String co\n                 throw new Exception(tl(\"muteExempt\"));\n             }\n         }\n+\n+        long muteTimestamp = 0;\n+        String muteReason = null;\n+\n+        if (args.length > 1) {\n+            final String time = args[1];\n+            try {\n+                muteTimestamp = DateUtil.parseDateDiff(time, true);\n+                muteReason = getFinalArg(args, 2);\n+            } catch (Exception e) {\n+                muteReason = getFinalArg(args, 1);\n+            }\n+        } else {\n+            user.setMuted(!user.getMuted());", "originalCommit": "b6a1f23eeb2821bbb9882f84cea6067f010d1b0f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjQ3MjY4MA==", "url": "https://github.com/EssentialsX/Essentials/pull/3068#discussion_r392472680", "bodyText": "Whoops, that code shouldn't be up there. As for #2807, yeah that should be merged first", "author": "JRoy", "createdAt": "2020-03-13T20:57:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjQ2NDIwMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjQ2NjM0Mw==", "url": "https://github.com/EssentialsX/Essentials/pull/3068#discussion_r392466343", "bodyText": "The second portion of this description reads poorly in my opinion. Otherwise, the timestamp with 0 should probably be Otherwise, the timestamp, or 0 to make sure it's clear.", "author": "pop4959", "createdAt": "2020-03-13T20:48:04Z", "path": "Essentials/src/net/ess3/api/events/MuteStatusChangeEvent.java", "diffHunk": "@@ -4,7 +4,35 @@\n \n \n public class MuteStatusChangeEvent extends StatusChangeEvent {\n+    private Long timestamp;\n+    private String reason;\n+\n+    @Deprecated\n     public MuteStatusChangeEvent(IUser affected, IUser controller, boolean value) {\n+        this(affected, controller, value, null, null);\n+    }\n+\n+    public MuteStatusChangeEvent(IUser affected, IUser controller, boolean value, Long timestamp, String reason) {\n         super(affected, controller, value);\n+        this.timestamp = timestamp;\n+        if (reason == null) {\n+            this.reason = null;\n+        } else {\n+            this.reason = reason.isEmpty() ? null : reason;\n+        }\n+    }\n+\n+    /**\n+     * @return Returns null if the timestamp is unknown due to usage of deprecated api; Otherwise, the timestamp with 0 indicating permanent.", "originalCommit": "b6a1f23eeb2821bbb9882f84cea6067f010d1b0f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjQ3MjgyMA==", "url": "https://github.com/EssentialsX/Essentials/pull/3068#discussion_r392472820", "bodyText": "\ud83d\udc4d", "author": "JRoy", "createdAt": "2020-03-13T20:58:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjQ2NjM0Mw=="}], "type": "inlineReview"}, {"oid": "3e69b402d02fa1a11d710c24919b4e5a6b46b73a", "url": "https://github.com/EssentialsX/Essentials/commit/3e69b402d02fa1a11d710c24919b4e5a6b46b73a", "message": "Improve MuteStatusChangeEvent", "committedDate": "2020-03-23T02:20:18Z", "type": "commit"}, {"oid": "3e69b402d02fa1a11d710c24919b4e5a6b46b73a", "url": "https://github.com/EssentialsX/Essentials/commit/3e69b402d02fa1a11d710c24919b4e5a6b46b73a", "message": "Improve MuteStatusChangeEvent", "committedDate": "2020-03-23T02:20:18Z", "type": "forcePushed"}, {"oid": "73b2da5653e035a938f85d88665e50e4e7586cd5", "url": "https://github.com/EssentialsX/Essentials/commit/73b2da5653e035a938f85d88665e50e4e7586cd5", "message": "Rebase", "committedDate": "2020-03-23T02:31:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDY3MTYwMQ==", "url": "https://github.com/EssentialsX/Essentials/pull/3068#discussion_r400671601", "bodyText": "When will reason ever be 'empty'? Maybe if a stupid plugin makes it empty but then we should be witchhunting them, not adding this weird oneoff check here.", "author": "Ichbinjoe", "createdAt": "2020-03-31T06:29:53Z", "path": "Essentials/src/net/ess3/api/events/MuteStatusChangeEvent.java", "diffHunk": "@@ -4,7 +4,35 @@\n \n \n public class MuteStatusChangeEvent extends StatusChangeEvent {\n+    private Long timestamp;\n+    private String reason;\n+\n+    @Deprecated\n     public MuteStatusChangeEvent(IUser affected, IUser controller, boolean value) {\n+        this(affected, controller, value, null, null);\n+    }\n+\n+    public MuteStatusChangeEvent(IUser affected, IUser controller, boolean value, Long timestamp, String reason) {\n         super(affected, controller, value);\n+        this.timestamp = timestamp;\n+        if (reason == null) {\n+            this.reason = null;\n+        } else {\n+            this.reason = reason.isEmpty() ? null : reason;", "originalCommit": "73b2da5653e035a938f85d88665e50e4e7586cd5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTAzOTA0MA==", "url": "https://github.com/EssentialsX/Essentials/pull/3068#discussion_r401039040", "bodyText": "It's a prevention measure to assure that the API is consistent; nothing wrong with this. Nonetheless, I changed this to a one-liner.", "author": "JRoy", "createdAt": "2020-03-31T16:12:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDY3MTYwMQ=="}], "type": "inlineReview"}, {"oid": "f7c11fd8f2aa19fa22383769a3367f81a49671fe", "url": "https://github.com/EssentialsX/Essentials/commit/f7c11fd8f2aa19fa22383769a3367f81a49671fe", "message": "Review changes", "committedDate": "2020-03-31T16:12:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjcxMDc0OA==", "url": "https://github.com/EssentialsX/Essentials/pull/3068#discussion_r406710748", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * @return Returns null if no reason is provided or due to the usage of a deprecated api; Otherwise, the reason.\n          \n          \n            \n                 * @return Returns the reason if provided, otherwise null.\n          \n      \n    \n    \n  \n\nOther plugins shouldn't be firing this event on our behalf, so we probably shouldn't assume they are.", "author": "mdcfe", "createdAt": "2020-04-10T11:03:50Z", "path": "Essentials/src/net/ess3/api/events/MuteStatusChangeEvent.java", "diffHunk": "@@ -4,7 +4,31 @@\n \n \n public class MuteStatusChangeEvent extends StatusChangeEvent {\n+    private Long timestamp;\n+    private String reason;\n+\n+    @Deprecated\n     public MuteStatusChangeEvent(IUser affected, IUser controller, boolean value) {\n+        this(affected, controller, value, null, null);\n+    }\n+\n+    public MuteStatusChangeEvent(IUser affected, IUser controller, boolean value, Long timestamp, String reason) {\n         super(affected, controller, value);\n+        this.timestamp = timestamp;\n+        this.reason = reason == null ? null : (reason.isEmpty() ? null : reason);\n+    }\n+\n+    /**\n+     * @return Returns null if the timestamp is unknown due to usage of deprecated api; Otherwise, the timestamp with 0 indicating permanent.\n+     */\n+    public Long getTimestamp() {\n+        return timestamp;\n+    }\n+\n+    /**\n+     * @return Returns null if no reason is provided or due to the usage of a deprecated api; Otherwise, the reason.", "originalCommit": "f7c11fd8f2aa19fa22383769a3367f81a49671fe", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjcxMTQwOA==", "url": "https://github.com/EssentialsX/Essentials/pull/3068#discussion_r406711408", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * @return Returns null if the timestamp is unknown due to usage of deprecated api; Otherwise, the timestamp with 0 indicating permanent.\n          \n          \n            \n                 * @return If the mute is temporary, returns the timestamp; if permanent, returns 0, and if unknown, returns -1.", "author": "mdcfe", "createdAt": "2020-04-10T11:06:21Z", "path": "Essentials/src/net/ess3/api/events/MuteStatusChangeEvent.java", "diffHunk": "@@ -4,7 +4,31 @@\n \n \n public class MuteStatusChangeEvent extends StatusChangeEvent {\n+    private Long timestamp;\n+    private String reason;\n+\n+    @Deprecated\n     public MuteStatusChangeEvent(IUser affected, IUser controller, boolean value) {\n+        this(affected, controller, value, null, null);\n+    }\n+\n+    public MuteStatusChangeEvent(IUser affected, IUser controller, boolean value, Long timestamp, String reason) {\n         super(affected, controller, value);\n+        this.timestamp = timestamp;\n+        this.reason = reason == null ? null : (reason.isEmpty() ? null : reason);\n+    }\n+\n+    /**\n+     * @return Returns null if the timestamp is unknown due to usage of deprecated api; Otherwise, the timestamp with 0 indicating permanent.", "originalCommit": "f7c11fd8f2aa19fa22383769a3367f81a49671fe", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjcxMjAxNw==", "url": "https://github.com/EssentialsX/Essentials/pull/3068#discussion_r406712017", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    this(affected, controller, value, null, null);\n          \n          \n            \n                }\n          \n          \n            \n            \n          \n          \n            \n                public MuteStatusChangeEvent(IUser affected, IUser controller, boolean value, Long timestamp, String reason) {\n          \n          \n            \n                    this(affected, controller, value, -1, null);\n          \n          \n            \n                }\n          \n          \n            \n            \n          \n          \n            \n                public MuteStatusChangeEvent(IUser affected, IUser controller, boolean value, long timestamp, String reason) {", "author": "mdcfe", "createdAt": "2020-04-10T11:08:46Z", "path": "Essentials/src/net/ess3/api/events/MuteStatusChangeEvent.java", "diffHunk": "@@ -4,7 +4,31 @@\n \n \n public class MuteStatusChangeEvent extends StatusChangeEvent {\n+    private Long timestamp;\n+    private String reason;\n+\n+    @Deprecated\n     public MuteStatusChangeEvent(IUser affected, IUser controller, boolean value) {\n+        this(affected, controller, value, null, null);\n+    }\n+\n+    public MuteStatusChangeEvent(IUser affected, IUser controller, boolean value, Long timestamp, String reason) {", "originalCommit": "f7c11fd8f2aa19fa22383769a3367f81a49671fe", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "abcba62a19e5f2ab4a693cd06f8dd6be6bef863b", "url": "https://github.com/EssentialsX/Essentials/commit/abcba62a19e5f2ab4a693cd06f8dd6be6bef863b", "message": "Apply suggestions from code review\n\nCo-Authored-By: md678685 <1917406+md678685@users.noreply.github.com>", "committedDate": "2020-04-10T18:46:04Z", "type": "commit"}, {"oid": "228c33ca11d86ea12dd2ba11eb24d293c4775d6e", "url": "https://github.com/EssentialsX/Essentials/commit/228c33ca11d86ea12dd2ba11eb24d293c4775d6e", "message": "Remove deprecated constructor", "committedDate": "2020-04-10T18:47:15Z", "type": "commit"}, {"oid": "d49b85d097a313fb2dcafa106287e11c74745c61", "url": "https://github.com/EssentialsX/Essentials/commit/d49b85d097a313fb2dcafa106287e11c74745c61", "message": "Merge branch '2.x' into feature/better-mute-event", "committedDate": "2020-04-10T18:48:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzQ2NjM5Ng==", "url": "https://github.com/EssentialsX/Essentials/pull/3068#discussion_r407466396", "bodyText": "I'm not sure whether we should return 0 or null if the mute is permanent. null better describes that there isn't a timestamp for the mute to be lifted on. @Ichbinjoe any thoughts?\n(I'm aware I've changed my mind on this since my last look over this PR - apologies about the changes.)", "author": "mdcfe", "createdAt": "2020-04-13T13:00:31Z", "path": "Essentials/src/net/ess3/api/events/MuteStatusChangeEvent.java", "diffHunk": "@@ -4,7 +4,26 @@\n \n \n public class MuteStatusChangeEvent extends StatusChangeEvent {\n-    public MuteStatusChangeEvent(IUser affected, IUser controller, boolean value) {\n+    private Long timestamp;\n+    private String reason;\n+\n+    public MuteStatusChangeEvent(IUser affected, IUser controller, boolean value, long timestamp, String reason) {\n         super(affected, controller, value);\n+        this.timestamp = timestamp;\n+        this.reason = reason == null ? null : (reason.isEmpty() ? null : reason);\n+    }\n+\n+    /**\n+     * @return If the mute is temporary, returns the timestamp; if permanent, returns 0, and if unknown, returns -1.\n+     */\n+    public Long getTimestamp() {", "originalCommit": "d49b85d097a313fb2dcafa106287e11c74745c61", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTA5Mjg0Mg==", "url": "https://github.com/EssentialsX/Essentials/pull/3068#discussion_r411092842", "bodyText": "Sorry for delay (disappeared for some time).\nI think the optimal solution is to potentially wrap this Long in an Optional. It beats readers over the head with the intent of the field.\nWould opt against 0 - easy to mess up. Null would at least cause things to blow up in the case where there is no timestamp.", "author": "Ichbinjoe", "createdAt": "2020-04-20T04:56:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzQ2NjM5Ng=="}], "type": "inlineReview"}, {"oid": "890d0d953506de3d89432d1866c82df88e31324a", "url": "https://github.com/EssentialsX/Essentials/commit/890d0d953506de3d89432d1866c82df88e31324a", "message": "Review changes", "committedDate": "2020-04-20T21:18:17Z", "type": "commit"}]}