{"pr_number": 3812, "pr_title": "Improve VersionUtil version checks", "pr_createdAt": "2020-12-06T05:45:12Z", "pr_url": "https://github.com/EssentialsX/Essentials/pull/3812", "timeline": [{"oid": "12f16b3c18d1e719adcb2f617ed598178ba453a8", "url": "https://github.com/EssentialsX/Essentials/commit/12f16b3c18d1e719adcb2f617ed598178ba453a8", "message": "Remove unused VersionUtil versions", "committedDate": "2020-12-06T01:44:38Z", "type": "commit"}, {"oid": "593a41fe28c7cffcfb0ae4ef1b95555e3c2f7337", "url": "https://github.com/EssentialsX/Essentials/commit/593a41fe28c7cffcfb0ae4ef1b95555e3c2f7337", "message": "Cache the server's support status", "committedDate": "2020-12-06T02:54:08Z", "type": "commit"}, {"oid": "34bf97f07abac0a53dc66cb06142f57c5d3a54f3", "url": "https://github.com/EssentialsX/Essentials/commit/34bf97f07abac0a53dc66cb06142f57c5d3a54f3", "message": "Add warning about Yatopia", "committedDate": "2020-12-06T03:33:06Z", "type": "commit"}, {"oid": "fea23c90ba0f9b4fe727a971bd80df8aaf129102", "url": "https://github.com/EssentialsX/Essentials/commit/fea23c90ba0f9b4fe727a971bd80df8aaf129102", "message": "Add more dangerous class names", "committedDate": "2020-12-06T05:18:17Z", "type": "commit"}, {"oid": "4afa1f1904195919e144262b08e7f959d7b9f3db", "url": "https://github.com/EssentialsX/Essentials/commit/4afa1f1904195919e144262b08e7f959d7b9f3db", "message": "Increase message incentive", "committedDate": "2020-12-06T05:20:16Z", "type": "commit"}, {"oid": "dec4f5d7ba79849f6ca665506676fc82a7eda678", "url": "https://github.com/EssentialsX/Essentials/commit/dec4f5d7ba79849f6ca665506676fc82a7eda678", "message": "Remove unused NMSVersion field in ReflUtil", "committedDate": "2020-12-06T05:25:27Z", "type": "commit"}, {"oid": "a8b211bcc9af286396274c79b5fdae78300b9b7b", "url": "https://github.com/EssentialsX/Essentials/commit/a8b211bcc9af286396274c79b5fdae78300b9b7b", "message": "Add check for NMS", "committedDate": "2020-12-06T05:28:39Z", "type": "commit"}, {"oid": "b9da8b3825f9b36cc9e0995ac72cacaf227fbd95", "url": "https://github.com/EssentialsX/Essentials/commit/b9da8b3825f9b36cc9e0995ac72cacaf227fbd95", "message": "Fix codestyle violations", "committedDate": "2020-12-06T05:31:45Z", "type": "commit"}, {"oid": "8719aaeb6dbcc60fe1fea48af0ac0f2afe8b64e8", "url": "https://github.com/EssentialsX/Essentials/commit/8719aaeb6dbcc60fe1fea48af0ac0f2afe8b64e8", "message": "Fix using wrong ReflUtil method", "committedDate": "2020-12-06T05:41:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjk2NDIyMg==", "url": "https://github.com/EssentialsX/Essentials/pull/3812#discussion_r536964222", "bodyText": "Are these { and } needed? They aren't there in other cases below", "author": "l1ttleO", "createdAt": "2020-12-06T05:54:43Z", "path": "Essentials/src/main/java/com/earth2me/essentials/Essentials.java", "diffHunk": "@@ -201,6 +201,10 @@ public void onEnable() {\n             Console.setInstance(this);\n \n             switch (VersionUtil.getServerSupportStatus()) {\n+                case DANGEROUS: {\n+                    getLogger().severe(tl(\"serverUnsupportedDangerous\"));\n+                    break;\n+                }", "originalCommit": "8719aaeb6dbcc60fe1fea48af0ac0f2afe8b64e8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjk2NDM5NA==", "url": "https://github.com/EssentialsX/Essentials/pull/3812#discussion_r536964394", "bodyText": "Are these { and } needed? They aren't there in other cases below", "author": "l1ttleO", "createdAt": "2020-12-06T05:56:09Z", "path": "Essentials/src/main/java/com/earth2me/essentials/commands/Commandessentials.java", "diffHunk": "@@ -376,6 +376,10 @@ private void runVersion(final Server server, final CommandSource sender, final S\n         }\n \n         switch (supportStatus) {\n+            case DANGEROUS: {\n+                sender.sendMessage(tl(\"serverUnsupportedDangerous\"));\n+                break;\n+            }", "originalCommit": "8719aaeb6dbcc60fe1fea48af0ac0f2afe8b64e8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjk4NTY2Nw==", "url": "https://github.com/EssentialsX/Essentials/pull/3812#discussion_r536985667", "bodyText": "The UNSTABLE message is for Forge hybrid servers, but this will trigger on other impls like Glowstone.", "author": "mdcfe", "createdAt": "2020-12-06T08:18:08Z", "path": "Essentials/src/main/java/com/earth2me/essentials/utils/VersionUtil.java", "diffHunk": "@@ -46,17 +62,33 @@ public static BukkitVersion getServerBukkitVersion() {\n     }\n \n     public static SupportStatus getServerSupportStatus() {\n-        try {\n-            Class.forName(\"net.minecraftforge.common.MinecraftForge\");\n-            return SupportStatus.UNSTABLE;\n-        } catch (final ClassNotFoundException ignored) {\n-        }\n+        if (supportStatus == null) {\n+            for (String clazz : dangerousServerClasses) {\n+                try {\n+                    Class.forName(clazz);\n+                    return supportStatus = SupportStatus.DANGEROUS;\n+                } catch (final ClassNotFoundException ignored) {\n+                }\n+            }\n \n-        if (!supportedVersions.contains(getServerBukkitVersion())) {\n-            return SupportStatus.OUTDATED;\n-        }\n+            try {\n+                Class.forName(\"net.minecraftforge.common.MinecraftForge\");\n+                return supportStatus = SupportStatus.UNSTABLE;\n+            } catch (final ClassNotFoundException ignored) {\n+            }\n+\n+            // Check for non-nms Bukkit Implis\n+            if (ReflUtil.getNMSClass(\"MinecraftServer\") == null) {\n+                return supportStatus = SupportStatus.UNSTABLE;", "originalCommit": "8719aaeb6dbcc60fe1fea48af0ac0f2afe8b64e8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjk4NjQ3MA==", "url": "https://github.com/EssentialsX/Essentials/pull/3812#discussion_r536986470", "bodyText": "Might be worth renaming this and/or the properties file to specify that this specifically covers Paper forks?", "author": "mdcfe", "createdAt": "2020-12-06T08:23:05Z", "path": "Essentials/src/main/java/com/earth2me/essentials/Essentials.java", "diffHunk": "@@ -201,6 +201,10 @@ public void onEnable() {\n             Console.setInstance(this);\n \n             switch (VersionUtil.getServerSupportStatus()) {\n+                case DANGEROUS: {", "originalCommit": "8719aaeb6dbcc60fe1fea48af0ac0f2afe8b64e8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjk4NjY0Mw==", "url": "https://github.com/EssentialsX/Essentials/pull/3812#discussion_r536986643", "bodyText": "Why not use an immutable Map<String, SupportStatus> to cover other possible cases too?", "author": "mdcfe", "createdAt": "2020-12-06T08:24:13Z", "path": "Essentials/src/main/java/com/earth2me/essentials/utils/VersionUtil.java", "diffHunk": "@@ -28,12 +28,28 @@\n     public static final BukkitVersion v1_15_R01 = BukkitVersion.fromString(\"1.15-R0.1-SNAPSHOT\");\n     public static final BukkitVersion v1_15_2_R01 = BukkitVersion.fromString(\"1.15.2-R0.1-SNAPSHOT\");\n     public static final BukkitVersion v1_16_1_R01 = BukkitVersion.fromString(\"1.16.1-R0.1-SNAPSHOT\");\n-    public static final BukkitVersion v1_16_2_R01 = BukkitVersion.fromString(\"1.16.2-R0.1-SNAPSHOT\");\n     public static final BukkitVersion v1_16_4_R01 = BukkitVersion.fromString(\"1.16.4-R0.1-SNAPSHOT\");\n \n     private static final Set<BukkitVersion> supportedVersions = ImmutableSet.of(v1_8_8_R01, v1_9_4_R01, v1_10_2_R01, v1_11_2_R01, v1_12_2_R01, v1_13_2_R01, v1_14_4_R01, v1_15_2_R01, v1_16_4_R01);\n \n+    private static final Set<String> dangerousServerClasses = ImmutableSet.of(", "originalCommit": "8719aaeb6dbcc60fe1fea48af0ac0f2afe8b64e8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "cb094eb50d8730fb57e3d6f40e7f12ab6f1cb11b", "url": "https://github.com/EssentialsX/Essentials/commit/cb094eb50d8730fb57e3d6f40e7f12ab6f1cb11b", "message": "Changes from code review", "committedDate": "2020-12-06T15:20:41Z", "type": "commit"}, {"oid": "6d2661d11d9fb4d26cfcbc0f4f1b72c24e5c7cb2", "url": "https://github.com/EssentialsX/Essentials/commit/6d2661d11d9fb4d26cfcbc0f4f1b72c24e5c7cb2", "message": "Codestyle :/", "committedDate": "2020-12-06T15:26:32Z", "type": "commit"}, {"oid": "b6227b478687bad560031e07ba956fe4b37fe40b", "url": "https://github.com/EssentialsX/Essentials/commit/b6227b478687bad560031e07ba956fe4b37fe40b", "message": "Update Essentials/src/main/resources/messages.properties\n\nCo-authored-by: l1ttleO <61277953+l1ttleO@users.noreply.github.com>", "committedDate": "2020-12-06T15:40:43Z", "type": "commit"}, {"oid": "09a38358528e9ea0b074261c1ae639dfd3467d70", "url": "https://github.com/EssentialsX/Essentials/commit/09a38358528e9ea0b074261c1ae639dfd3467d70", "message": "Add KibblePatcher as dangerous", "committedDate": "2020-12-10T15:43:51Z", "type": "commit"}, {"oid": "3d592576025297ffaaf1aec632aa0559550a50af", "url": "https://github.com/EssentialsX/Essentials/commit/3d592576025297ffaaf1aec632aa0559550a50af", "message": "Add Fabric as unstable", "committedDate": "2020-12-10T16:15:15Z", "type": "commit"}, {"oid": "dacc4b65751eca71d76ed36f5a338849f653fedd", "url": "https://github.com/EssentialsX/Essentials/commit/dacc4b65751eca71d76ed36f5a338849f653fedd", "message": "Clean up", "committedDate": "2020-12-10T16:22:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjA1OTcwMA==", "url": "https://github.com/EssentialsX/Essentials/pull/3812#discussion_r542059700", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    // KibblePatcher - Dangerous bytecode editor snakeoil that's only use it to break plugins\n          \n          \n            \n                    // KibblePatcher - Dangerous bytecode editor snakeoil that's only use is to break plugins", "author": "Puremin0rez", "createdAt": "2020-12-14T01:47:54Z", "path": "Essentials/src/main/java/com/earth2me/essentials/utils/VersionUtil.java", "diffHunk": "@@ -28,12 +30,46 @@\n     public static final BukkitVersion v1_15_R01 = BukkitVersion.fromString(\"1.15-R0.1-SNAPSHOT\");\n     public static final BukkitVersion v1_15_2_R01 = BukkitVersion.fromString(\"1.15.2-R0.1-SNAPSHOT\");\n     public static final BukkitVersion v1_16_1_R01 = BukkitVersion.fromString(\"1.16.1-R0.1-SNAPSHOT\");\n-    public static final BukkitVersion v1_16_2_R01 = BukkitVersion.fromString(\"1.16.2-R0.1-SNAPSHOT\");\n     public static final BukkitVersion v1_16_4_R01 = BukkitVersion.fromString(\"1.16.4-R0.1-SNAPSHOT\");\n \n     private static final Set<BukkitVersion> supportedVersions = ImmutableSet.of(v1_8_8_R01, v1_9_4_R01, v1_10_2_R01, v1_11_2_R01, v1_12_2_R01, v1_13_2_R01, v1_14_4_R01, v1_15_2_R01, v1_16_4_R01);\n \n+    private static final Map<String, SupportStatus> unsupportedServerClasses;\n+\n+    static {\n+        final ImmutableMap.Builder<String, SupportStatus> builder = new ImmutableMap.Builder<>();\n+\n+        // Yatopia - Extremely volatile patch set;\n+        //   * Messes with bungeecord UUIDs\n+        //   * Frequent data corruptions\n+        builder.put(\"org.yatopiamc.yatopia.server.YatopiaConfig\", SupportStatus.DANGEROUS_FORK);\n+\n+        // KibblePatcher - Dangerous bytecode editor snakeoil that's only use it to break plugins", "originalCommit": "dacc4b65751eca71d76ed36f5a338849f653fedd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "9aa1f1d4a6c89322aa66f98613ea8a216e053a3d", "url": "https://github.com/EssentialsX/Essentials/commit/9aa1f1d4a6c89322aa66f98613ea8a216e053a3d", "message": "Update Essentials/src/main/java/com/earth2me/essentials/utils/VersionUtil.java\n\nCo-authored-by: Dylan Xaldin <Puremin0rez515@gmail.com>", "committedDate": "2020-12-14T01:48:26Z", "type": "commit"}, {"oid": "5185d33583c6971e389393c303bc151bc6989f2c", "url": "https://github.com/EssentialsX/Essentials/commit/5185d33583c6971e389393c303bc151bc6989f2c", "message": "Merge branch '2.x' into feature/segregate-servers", "committedDate": "2020-12-14T02:25:56Z", "type": "commit"}, {"oid": "64fd133a773b089857a38b4ff0fd1fb257d2d4ee", "url": "https://github.com/EssentialsX/Essentials/commit/64fd133a773b089857a38b4ff0fd1fb257d2d4ee", "message": "Merge branch '2.x' into feature/segregate-servers", "committedDate": "2021-01-02T02:55:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDE2MzUwMA==", "url": "https://github.com/EssentialsX/Essentials/pull/3812#discussion_r554163500", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    // KibblePatcher - Dangerous bytecode editor snakeoil that's only use is to break plugins\n          \n          \n            \n                    // KibblePatcher - Dangerous bytecode editor snakeoil whose only use is to break plugins\n          \n      \n    \n    \n  \n\nliterally plugin-breaking smh", "author": "mdcfe", "createdAt": "2021-01-08T20:05:06Z", "path": "Essentials/src/main/java/com/earth2me/essentials/utils/VersionUtil.java", "diffHunk": "@@ -28,12 +30,46 @@\n     public static final BukkitVersion v1_15_R01 = BukkitVersion.fromString(\"1.15-R0.1-SNAPSHOT\");\n     public static final BukkitVersion v1_15_2_R01 = BukkitVersion.fromString(\"1.15.2-R0.1-SNAPSHOT\");\n     public static final BukkitVersion v1_16_1_R01 = BukkitVersion.fromString(\"1.16.1-R0.1-SNAPSHOT\");\n-    public static final BukkitVersion v1_16_2_R01 = BukkitVersion.fromString(\"1.16.2-R0.1-SNAPSHOT\");\n     public static final BukkitVersion v1_16_4_R01 = BukkitVersion.fromString(\"1.16.4-R0.1-SNAPSHOT\");\n \n     private static final Set<BukkitVersion> supportedVersions = ImmutableSet.of(v1_8_8_R01, v1_9_4_R01, v1_10_2_R01, v1_11_2_R01, v1_12_2_R01, v1_13_2_R01, v1_14_4_R01, v1_15_2_R01, v1_16_4_R01);\n \n+    private static final Map<String, SupportStatus> unsupportedServerClasses;\n+\n+    static {\n+        final ImmutableMap.Builder<String, SupportStatus> builder = new ImmutableMap.Builder<>();\n+\n+        // Yatopia - Extremely volatile patch set;\n+        //   * Messes with bungeecord UUIDs\n+        //   * Frequent data corruptions\n+        builder.put(\"org.yatopiamc.yatopia.server.YatopiaConfig\", SupportStatus.DANGEROUS_FORK);\n+\n+        // KibblePatcher - Dangerous bytecode editor snakeoil that's only use is to break plugins", "originalCommit": "64fd133a773b089857a38b4ff0fd1fb257d2d4ee", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDE2Mzc3Nw==", "url": "https://github.com/EssentialsX/Essentials/pull/3812#discussion_r554163777", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    //   * Messes with bungeecord UUIDs\n          \n          \n            \n                    //   * Messes with proxy-forwarded UUIDs", "author": "mdcfe", "createdAt": "2021-01-08T20:05:47Z", "path": "Essentials/src/main/java/com/earth2me/essentials/utils/VersionUtil.java", "diffHunk": "@@ -28,12 +30,46 @@\n     public static final BukkitVersion v1_15_R01 = BukkitVersion.fromString(\"1.15-R0.1-SNAPSHOT\");\n     public static final BukkitVersion v1_15_2_R01 = BukkitVersion.fromString(\"1.15.2-R0.1-SNAPSHOT\");\n     public static final BukkitVersion v1_16_1_R01 = BukkitVersion.fromString(\"1.16.1-R0.1-SNAPSHOT\");\n-    public static final BukkitVersion v1_16_2_R01 = BukkitVersion.fromString(\"1.16.2-R0.1-SNAPSHOT\");\n     public static final BukkitVersion v1_16_4_R01 = BukkitVersion.fromString(\"1.16.4-R0.1-SNAPSHOT\");\n \n     private static final Set<BukkitVersion> supportedVersions = ImmutableSet.of(v1_8_8_R01, v1_9_4_R01, v1_10_2_R01, v1_11_2_R01, v1_12_2_R01, v1_13_2_R01, v1_14_4_R01, v1_15_2_R01, v1_16_4_R01);\n \n+    private static final Map<String, SupportStatus> unsupportedServerClasses;\n+\n+    static {\n+        final ImmutableMap.Builder<String, SupportStatus> builder = new ImmutableMap.Builder<>();\n+\n+        // Yatopia - Extremely volatile patch set;\n+        //   * Messes with bungeecord UUIDs", "originalCommit": "64fd133a773b089857a38b4ff0fd1fb257d2d4ee", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDE2MzkwMw==", "url": "https://github.com/EssentialsX/Essentials/pull/3812#discussion_r554163903", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    // Forge - Doesn't support bukkit\n          \n          \n            \n                    // Forge - Doesn't support Bukkit", "author": "mdcfe", "createdAt": "2021-01-08T20:06:04Z", "path": "Essentials/src/main/java/com/earth2me/essentials/utils/VersionUtil.java", "diffHunk": "@@ -28,12 +30,46 @@\n     public static final BukkitVersion v1_15_R01 = BukkitVersion.fromString(\"1.15-R0.1-SNAPSHOT\");\n     public static final BukkitVersion v1_15_2_R01 = BukkitVersion.fromString(\"1.15.2-R0.1-SNAPSHOT\");\n     public static final BukkitVersion v1_16_1_R01 = BukkitVersion.fromString(\"1.16.1-R0.1-SNAPSHOT\");\n-    public static final BukkitVersion v1_16_2_R01 = BukkitVersion.fromString(\"1.16.2-R0.1-SNAPSHOT\");\n     public static final BukkitVersion v1_16_4_R01 = BukkitVersion.fromString(\"1.16.4-R0.1-SNAPSHOT\");\n \n     private static final Set<BukkitVersion> supportedVersions = ImmutableSet.of(v1_8_8_R01, v1_9_4_R01, v1_10_2_R01, v1_11_2_R01, v1_12_2_R01, v1_13_2_R01, v1_14_4_R01, v1_15_2_R01, v1_16_4_R01);\n \n+    private static final Map<String, SupportStatus> unsupportedServerClasses;\n+\n+    static {\n+        final ImmutableMap.Builder<String, SupportStatus> builder = new ImmutableMap.Builder<>();\n+\n+        // Yatopia - Extremely volatile patch set;\n+        //   * Messes with bungeecord UUIDs\n+        //   * Frequent data corruptions\n+        builder.put(\"org.yatopiamc.yatopia.server.YatopiaConfig\", SupportStatus.DANGEROUS_FORK);\n+\n+        // KibblePatcher - Dangerous bytecode editor snakeoil that's only use is to break plugins\n+        builder.put(\"net.kibblelands.server.FastMath\", SupportStatus.DANGEROUS_FORK);\n+\n+        // AirplaneLite - Yatopia sidestream;\n+        //   * Attempts unsafe chunk concurrency\n+        builder.put(\"gg.airplane.structs.ChunkMapMap\", SupportStatus.DANGEROUS_FORK);\n+        builder.put(\"gg.airplane.structs.ConcLong2ObjectOpenHashMap\", SupportStatus.DANGEROUS_FORK);\n+\n+        // Akarin - Dangerous patch history;\n+        //   * Potentially unsafe saving of nms.JsonList\n+        builder.put(\"io.akarin.server.Config\", SupportStatus.DANGEROUS_FORK);\n+\n+        // Forge - Doesn't support bukkit", "originalCommit": "64fd133a773b089857a38b4ff0fd1fb257d2d4ee", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDE2NDAwMA==", "url": "https://github.com/EssentialsX/Essentials/pull/3812#discussion_r554164000", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    // Fabric - Doesn't support bukkit\n          \n          \n            \n                    // Fabric - Doesn't support Bukkit", "author": "mdcfe", "createdAt": "2021-01-08T20:06:19Z", "path": "Essentials/src/main/java/com/earth2me/essentials/utils/VersionUtil.java", "diffHunk": "@@ -28,12 +30,46 @@\n     public static final BukkitVersion v1_15_R01 = BukkitVersion.fromString(\"1.15-R0.1-SNAPSHOT\");\n     public static final BukkitVersion v1_15_2_R01 = BukkitVersion.fromString(\"1.15.2-R0.1-SNAPSHOT\");\n     public static final BukkitVersion v1_16_1_R01 = BukkitVersion.fromString(\"1.16.1-R0.1-SNAPSHOT\");\n-    public static final BukkitVersion v1_16_2_R01 = BukkitVersion.fromString(\"1.16.2-R0.1-SNAPSHOT\");\n     public static final BukkitVersion v1_16_4_R01 = BukkitVersion.fromString(\"1.16.4-R0.1-SNAPSHOT\");\n \n     private static final Set<BukkitVersion> supportedVersions = ImmutableSet.of(v1_8_8_R01, v1_9_4_R01, v1_10_2_R01, v1_11_2_R01, v1_12_2_R01, v1_13_2_R01, v1_14_4_R01, v1_15_2_R01, v1_16_4_R01);\n \n+    private static final Map<String, SupportStatus> unsupportedServerClasses;\n+\n+    static {\n+        final ImmutableMap.Builder<String, SupportStatus> builder = new ImmutableMap.Builder<>();\n+\n+        // Yatopia - Extremely volatile patch set;\n+        //   * Messes with bungeecord UUIDs\n+        //   * Frequent data corruptions\n+        builder.put(\"org.yatopiamc.yatopia.server.YatopiaConfig\", SupportStatus.DANGEROUS_FORK);\n+\n+        // KibblePatcher - Dangerous bytecode editor snakeoil that's only use is to break plugins\n+        builder.put(\"net.kibblelands.server.FastMath\", SupportStatus.DANGEROUS_FORK);\n+\n+        // AirplaneLite - Yatopia sidestream;\n+        //   * Attempts unsafe chunk concurrency\n+        builder.put(\"gg.airplane.structs.ChunkMapMap\", SupportStatus.DANGEROUS_FORK);\n+        builder.put(\"gg.airplane.structs.ConcLong2ObjectOpenHashMap\", SupportStatus.DANGEROUS_FORK);\n+\n+        // Akarin - Dangerous patch history;\n+        //   * Potentially unsafe saving of nms.JsonList\n+        builder.put(\"io.akarin.server.Config\", SupportStatus.DANGEROUS_FORK);\n+\n+        // Forge - Doesn't support bukkit\n+        builder.put(\"net.minecraftforge.common.MinecraftForge\", SupportStatus.UNSTABLE);\n+\n+        // Fabric - Doesn't support bukkit", "originalCommit": "64fd133a773b089857a38b4ff0fd1fb257d2d4ee", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDE2NDMyOA==", "url": "https://github.com/EssentialsX/Essentials/pull/3812#discussion_r554164328", "bodyText": "iirc calling this will break startup entirely on Glowstone or other non-NMS servers, which isn't ideal", "author": "mdcfe", "createdAt": "2021-01-08T20:06:58Z", "path": "Essentials/src/main/java/com/earth2me/essentials/utils/VersionUtil.java", "diffHunk": "@@ -28,12 +30,46 @@\n     public static final BukkitVersion v1_15_R01 = BukkitVersion.fromString(\"1.15-R0.1-SNAPSHOT\");\n     public static final BukkitVersion v1_15_2_R01 = BukkitVersion.fromString(\"1.15.2-R0.1-SNAPSHOT\");\n     public static final BukkitVersion v1_16_1_R01 = BukkitVersion.fromString(\"1.16.1-R0.1-SNAPSHOT\");\n-    public static final BukkitVersion v1_16_2_R01 = BukkitVersion.fromString(\"1.16.2-R0.1-SNAPSHOT\");\n     public static final BukkitVersion v1_16_4_R01 = BukkitVersion.fromString(\"1.16.4-R0.1-SNAPSHOT\");\n \n     private static final Set<BukkitVersion> supportedVersions = ImmutableSet.of(v1_8_8_R01, v1_9_4_R01, v1_10_2_R01, v1_11_2_R01, v1_12_2_R01, v1_13_2_R01, v1_14_4_R01, v1_15_2_R01, v1_16_4_R01);\n \n+    private static final Map<String, SupportStatus> unsupportedServerClasses;\n+\n+    static {\n+        final ImmutableMap.Builder<String, SupportStatus> builder = new ImmutableMap.Builder<>();\n+\n+        // Yatopia - Extremely volatile patch set;\n+        //   * Messes with bungeecord UUIDs\n+        //   * Frequent data corruptions\n+        builder.put(\"org.yatopiamc.yatopia.server.YatopiaConfig\", SupportStatus.DANGEROUS_FORK);\n+\n+        // KibblePatcher - Dangerous bytecode editor snakeoil that's only use is to break plugins\n+        builder.put(\"net.kibblelands.server.FastMath\", SupportStatus.DANGEROUS_FORK);\n+\n+        // AirplaneLite - Yatopia sidestream;\n+        //   * Attempts unsafe chunk concurrency\n+        builder.put(\"gg.airplane.structs.ChunkMapMap\", SupportStatus.DANGEROUS_FORK);\n+        builder.put(\"gg.airplane.structs.ConcLong2ObjectOpenHashMap\", SupportStatus.DANGEROUS_FORK);\n+\n+        // Akarin - Dangerous patch history;\n+        //   * Potentially unsafe saving of nms.JsonList\n+        builder.put(\"io.akarin.server.Config\", SupportStatus.DANGEROUS_FORK);\n+\n+        // Forge - Doesn't support bukkit\n+        builder.put(\"net.minecraftforge.common.MinecraftForge\", SupportStatus.UNSTABLE);\n+\n+        // Fabric - Doesn't support bukkit\n+        builder.put(\"net.fabricmc.loader.launch.knot.KnotServer\", SupportStatus.UNSTABLE);\n+\n+        // Misc translation layers that do not add NMS will be caught by this\n+        builder.put(\"!net.minecraft.server.\" + ReflUtil.getNMSVersion() + \".MinecraftServer\", SupportStatus.NMS_CLEANROOM);", "originalCommit": "64fd133a773b089857a38b4ff0fd1fb257d2d4ee", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDE3NTIxOQ==", "url": "https://github.com/EssentialsX/Essentials/pull/3812#discussion_r554175219", "bodyText": "fixed this, will not silently fail", "author": "JRoy", "createdAt": "2021-01-08T20:29:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDE2NDMyOA=="}], "type": "inlineReview"}, {"oid": "efcc2052b8e968f36a9cf3d08ad3cf310aa8a9f8", "url": "https://github.com/EssentialsX/Essentials/commit/efcc2052b8e968f36a9cf3d08ad3cf310aa8a9f8", "message": "Apply suggestions from code review\n\nCo-authored-by: MD <1917406+mdcfe@users.noreply.github.com>", "committedDate": "2021-01-08T20:19:01Z", "type": "commit"}, {"oid": "1846433dbc004f52b00a93cfc2d2fdcbcd70f4af", "url": "https://github.com/EssentialsX/Essentials/commit/1846433dbc004f52b00a93cfc2d2fdcbcd70f4af", "message": "Silently fail on cleanroom implementations", "committedDate": "2021-01-08T20:28:35Z", "type": "commit"}, {"oid": "74ea21eb7c47058bf67a3351e5e623bfb4ed7dbe", "url": "https://github.com/EssentialsX/Essentials/commit/74ea21eb7c47058bf67a3351e5e623bfb4ed7dbe", "message": "Add notice for the class that created the unsupported server status", "committedDate": "2021-01-08T20:41:54Z", "type": "commit"}, {"oid": "b6df355381b8cbeb5a46273f1a1fb7c92b6b85dc", "url": "https://github.com/EssentialsX/Essentials/commit/b6df355381b8cbeb5a46273f1a1fb7c92b6b85dc", "message": "Merge branch '2.x' into feature/segregate-servers", "committedDate": "2021-01-19T09:57:41Z", "type": "commit"}, {"oid": "6de50032229557397b3ff7231fe2098e642b20f8", "url": "https://github.com/EssentialsX/Essentials/commit/6de50032229557397b3ff7231fe2098e642b20f8", "message": "Merge branch '2.x' into feature/segregate-servers", "committedDate": "2021-01-19T12:32:57Z", "type": "commit"}]}