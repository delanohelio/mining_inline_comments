{"pr_number": 3066, "pr_title": "Add config option to make currency symbol as a suffix", "pr_createdAt": "2020-03-13T02:35:02Z", "pr_url": "https://github.com/EssentialsX/Essentials/pull/3066", "timeline": [{"oid": "a616c0e3beac90fdb717beb095ce5276bdc4a873", "url": "https://github.com/EssentialsX/Essentials/commit/a616c0e3beac90fdb717beb095ce5276bdc4a873", "message": "Add config option to make currency symbol as a suffix", "committedDate": "2020-03-13T02:33:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDY5MzAxNQ==", "url": "https://github.com/EssentialsX/Essentials/pull/3066#discussion_r400693015", "bodyText": "This feels messy. I'm trying to think about the right way to get out of this (configuration depending on configuration, liable to break when the one is changed) without torching existing configurations.", "author": "Ichbinjoe", "createdAt": "2020-03-31T07:19:55Z", "path": "Essentials/src/com/earth2me/essentials/Kit.java", "diffHunk": "@@ -153,8 +153,8 @@ public void expandItems(final User user, final List<String> items) throws Except\n             boolean spew = false;\n             final boolean allowUnsafe = ess.getSettings().allowUnsafeEnchantments();\n             for (String kitItem : output.getLines()) {\n-                if (kitItem.startsWith(ess.getSettings().getCurrencySymbol())) {\n-                    BigDecimal value = new BigDecimal(kitItem.substring(ess.getSettings().getCurrencySymbol().length()).trim());\n+                if (!ess.getSettings().getCurrencySuffix() ? kitItem.startsWith(ess.getSettings().getCurrencySymbol()) : kitItem.endsWith(ess.getSettings().getCurrencySymbol())) {\n+                    BigDecimal value = ess.getSettings().getCurrencySuffix() ? new BigDecimal(kitItem.substring(0, ess.getSettings().getCurrencySymbol().length()).trim()) : new BigDecimal(kitItem.substring(ess.getSettings().getCurrencySymbol().length()).trim());", "originalCommit": "a616c0e3beac90fdb717beb095ce5276bdc4a873", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDk5OTI3Ng==", "url": "https://github.com/EssentialsX/Essentials/pull/3066#discussion_r400999276", "bodyText": "What are you talking about? This would not break, it's just the ternary operator which is a standard part of java, nothing IMO needs changing here as it works just fine.", "author": "JRoy", "createdAt": "2020-03-31T15:19:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDY5MzAxNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDk5OTk1OQ==", "url": "https://github.com/EssentialsX/Essentials/pull/3066#discussion_r400999959", "bodyText": "If you're talking about decimal parsing, that was already part of the code before this and is out of the scope of this PR", "author": "JRoy", "createdAt": "2020-03-31T15:20:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDY5MzAxNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTMwNTU3OA==", "url": "https://github.com/EssentialsX/Essentials/pull/3066#discussion_r401305578", "bodyText": "I'll agree with Joe in that this could at least be split into several lines for readability. Right now you have what is effectively a nested conditional, with the ternary statement inside of an if statement. A little here can go a long way.\nAs for the configuration dependencies, I don't know how much can be done about it currently. I already approved this PR under the assumption that what you've done is about as good as it will get with how Essentials is currently designed.", "author": "pop4959", "createdAt": "2020-04-01T01:27:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDY5MzAxNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTMwNzQ4NQ==", "url": "https://github.com/EssentialsX/Essentials/pull/3066#discussion_r401307485", "bodyText": "Its just that the logic for this if got a bit more complicated - maybe its just Github's diff colors, but this got hard to read for me.\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            if (!ess.getSettings().getCurrencySuffix() ? kitItem.startsWith(ess.getSettings().getCurrencySymbol()) : kitItem.endsWith(ess.getSettings().getCurrencySymbol())) {\n          \n          \n            \n                                BigDecimal value = ess.getSettings().getCurrencySuffix() ? new BigDecimal(kitItem.substring(0, ess.getSettings().getCurrencySymbol().length()).trim()) : new BigDecimal(kitItem.substring(ess.getSettings().getCurrencySymbol().length()).trim());\n          \n          \n            \n                            boolean currencyIsSuffix = ess.getSettings().getCurrencySuffix();\n          \n          \n            \n                            String currencySymbol = ess.getSettings().getCurrencySymbol();\n          \n          \n            \n                            boolean isCurrency = currencyIsSuffix ? kitItem.endsWith(currencySymbol) : kitItem.startsWith(currencySymbol);\n          \n          \n            \n                            if (isCurrency) {\n          \n          \n            \n                                String valueString = currencyIsSuffix ? kitItem.substring(0, currencySymbol.length()) : kitItem.substring(currencySymbol.length());\n          \n          \n            \n                                BigDecimal value = new BigDecimal(valueString.trim());\n          \n      \n    \n    \n  \n\nI personally think this reads better since we aren't craming so much into one line.", "author": "Ichbinjoe", "createdAt": "2020-04-01T01:34:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDY5MzAxNQ=="}], "type": "inlineReview"}, {"oid": "45d7e1ec209eccf385c2ed2506de01677d9f3438", "url": "https://github.com/EssentialsX/Essentials/commit/45d7e1ec209eccf385c2ed2506de01677d9f3438", "message": "Cleanup", "committedDate": "2020-04-01T02:08:08Z", "type": "commit"}, {"oid": "c8ae976fe7c2a4ed517036655c5c5a1904b776ba", "url": "https://github.com/EssentialsX/Essentials/commit/c8ae976fe7c2a4ed517036655c5c5a1904b776ba", "message": "Merge branch '2.x' into feature/money-suffix", "committedDate": "2020-04-01T02:09:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzg5MDQzMg==", "url": "https://github.com/EssentialsX/Essentials/pull/3066#discussion_r413890432", "bodyText": "I agree this should be isCurrencySymbolSuffixed or similar.", "author": "mdcfe", "createdAt": "2020-04-23T15:21:10Z", "path": "Essentials/src/com/earth2me/essentials/Settings.java", "diffHunk": "@@ -677,6 +677,11 @@ public String getCurrencySymbol() {\n         return config.getString(\"currency-symbol\", \"$\").concat(\"$\").substring(0, 1).replaceAll(\"[0-9]\", \"$\");\n     }\n \n+    @Override\n+    public boolean getCurrencySuffix() {", "originalCommit": "c8ae976fe7c2a4ed517036655c5c5a1904b776ba", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzg5MTYzMA==", "url": "https://github.com/EssentialsX/Essentials/pull/3066#discussion_r413891630", "bodyText": "Is it worth extracting the check here out to a includesCurrencySymbol method?", "author": "mdcfe", "createdAt": "2020-04-23T15:22:39Z", "path": "Essentials/src/com/earth2me/essentials/Kit.java", "diffHunk": "@@ -152,10 +152,13 @@ public boolean expandItems(final User user, final List<String> items) throws Exc\n \n             boolean spew = false;\n             final boolean allowUnsafe = ess.getSettings().allowUnsafeEnchantments();\n+            final boolean currencyIsSuffix = ess.getSettings().getCurrencySuffix();\n+            final String currencySymbol = ess.getSettings().getCurrencySymbol();\n             List<ItemStack> itemList = new ArrayList<>();\n             for (String kitItem : output.getLines()) {\n-                if (kitItem.startsWith(ess.getSettings().getCurrencySymbol())) {\n-                    BigDecimal value = new BigDecimal(kitItem.substring(ess.getSettings().getCurrencySymbol().length()).trim());\n+                if (!currencyIsSuffix ? kitItem.startsWith(ess.getSettings().getCurrencySymbol()) : kitItem.endsWith(ess.getSettings().getCurrencySymbol())) {", "originalCommit": "c8ae976fe7c2a4ed517036655c5c5a1904b776ba", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "9f03f4938a076a3d94d16fe2dbe855a07d72ae26", "url": "https://github.com/EssentialsX/Essentials/commit/9f03f4938a076a3d94d16fe2dbe855a07d72ae26", "message": "Update Essentials/src/config.yml\n\nCo-Authored-By: md678685 <1917406+md678685@users.noreply.github.com>", "committedDate": "2020-04-23T17:39:03Z", "type": "commit"}, {"oid": "e1e593a30f8f25728e89ab0e993c82f52b2c3c7e", "url": "https://github.com/EssentialsX/Essentials/commit/e1e593a30f8f25728e89ab0e993c82f52b2c3c7e", "message": "Rename method to isCurrencySymbolSuffixed", "committedDate": "2020-04-23T18:15:03Z", "type": "commit"}, {"oid": "23cb6b4d357ae686339e986b3df83bf9bce558d2", "url": "https://github.com/EssentialsX/Essentials/commit/23cb6b4d357ae686339e986b3df83bf9bce558d2", "message": "Merge branch '2.x' into feature/money-suffix", "committedDate": "2020-04-23T18:16:17Z", "type": "commit"}, {"oid": "ce7a2142b97afffefa260903e78cd175488e0c6e", "url": "https://github.com/EssentialsX/Essentials/commit/ce7a2142b97afffefa260903e78cd175488e0c6e", "message": "Merge branch '2.x' into feature/money-suffix", "committedDate": "2020-04-23T18:18:45Z", "type": "commit"}]}