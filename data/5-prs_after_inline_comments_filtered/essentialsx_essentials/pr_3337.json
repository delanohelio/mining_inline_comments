{"pr_number": 3337, "pr_title": "Improve command codestyle", "pr_createdAt": "2020-05-27T04:54:35Z", "pr_url": "https://github.com/EssentialsX/Essentials/pull/3337", "timeline": [{"oid": "765a0c3573ef51369fef2d9cfe4f0ce17c94f0c4", "url": "https://github.com/EssentialsX/Essentials/commit/765a0c3573ef51369fef2d9cfe4f0ce17c94f0c4", "message": "Everything up to eco exclusive", "committedDate": "2020-05-27T04:53:30Z", "type": "commit"}, {"oid": "490e88b19c61bfc606c6c4d7f0facf47dea8565d", "url": "https://github.com/EssentialsX/Essentials/commit/490e88b19c61bfc606c6c4d7f0facf47dea8565d", "message": "Merge branch '2.x' into feature/command-rewrite", "committedDate": "2020-05-27T19:28:08Z", "type": "commit"}, {"oid": "24b7d9031556ce64456f58e0bd6f5828b428c47d", "url": "https://github.com/EssentialsX/Essentials/commit/24b7d9031556ce64456f58e0bd6f5828b428c47d", "message": "Allow specifying a consumer in loop commands", "committedDate": "2020-05-28T19:59:32Z", "type": "commit"}, {"oid": "4446fa22d33da37177855b8170755ceebcee736f", "url": "https://github.com/EssentialsX/Essentials/commit/4446fa22d33da37177855b8170755ceebcee736f", "message": "Remove need for updatePlayer method", "committedDate": "2020-05-28T22:04:31Z", "type": "commit"}, {"oid": "be4f50f016144125679ee2463dc37c6de5242fb3", "url": "https://github.com/EssentialsX/Essentials/commit/be4f50f016144125679ee2463dc37c6de5242fb3", "message": "Allow specifying a consumer in loop commands", "committedDate": "2020-05-30T01:05:42Z", "type": "commit"}, {"oid": "6671d115ea90ca5b70aeae5d8af7b6a51c5efd69", "url": "https://github.com/EssentialsX/Essentials/commit/6671d115ea90ca5b70aeae5d8af7b6a51c5efd69", "message": "Remove args from loopOfflinePlayers", "committedDate": "2020-05-30T01:33:02Z", "type": "commit"}, {"oid": "3cbe6e1b9d82d3c724e08931b6c8d9efe1e4790f", "url": "https://github.com/EssentialsX/Essentials/commit/3cbe6e1b9d82d3c724e08931b6c8d9efe1e4790f", "message": "Allow all exceptions to be thrown in the loop consumer", "committedDate": "2020-05-30T03:05:34Z", "type": "commit"}, {"oid": "ac1e5e058ac7ad8803a580c3a8843c2e17192cac", "url": "https://github.com/EssentialsX/Essentials/commit/ac1e5e058ac7ad8803a580c3a8843c2e17192cac", "message": "Cleanup eco command", "committedDate": "2020-05-30T03:38:12Z", "type": "commit"}, {"oid": "9e6d84868e9378c920e92fc7712f4b9e2e797fb9", "url": "https://github.com/EssentialsX/Essentials/commit/9e6d84868e9378c920e92fc7712f4b9e2e797fb9", "message": "Merge branch '2.x' into feature/command-rewrite", "committedDate": "2020-05-30T13:52:06Z", "type": "commit"}, {"oid": "a65315b21e9371fd13a864b2ffd0f050984decec", "url": "https://github.com/EssentialsX/Essentials/commit/a65315b21e9371fd13a864b2ffd0f050984decec", "message": "Merge branch '2.x' into feature/command-rewrite", "committedDate": "2020-05-30T13:52:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjg0NDMzMw==", "url": "https://github.com/EssentialsX/Essentials/pull/3337#discussion_r432844333", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private void parseCommand(Server server, CommandSource sender, String[] args) throws Exception {\n          \n          \n            \n                private void parseOthers(Server server, CommandSource sender, String[] args) throws Exception {", "author": "mdcfe", "createdAt": "2020-05-30T14:07:52Z", "path": "Essentials/src/com/earth2me/essentials/commands/Commandback.java", "diffHunk": "@@ -32,28 +29,17 @@ protected void run(Server server, User user, String commandLabel, String[] args)\n \n     @Override\n     protected void run(Server server, CommandSource sender, String commandLabel, String[] args) throws Exception {\n-        if (args.length < 1) {\n+        if (args.length == 0) {\n             throw new NotEnoughArgumentsException();\n         }\n \n-        this.parseCommand(server, sender, args, true);\n+        this.parseCommand(server, sender, args);\n     }\n \n-    private void parseCommand(Server server, CommandSource sender, String[] args, boolean allowOthers) throws Exception {\n-        Collection<Player> players = new ArrayList<>();\n-\n-        if (allowOthers && args.length > 0 && args[0].trim().length() > 2) {\n-            players = server.matchPlayer(args[0].trim());\n-        }\n-\n-        if (players.size() < 1) {\n-            throw new PlayerNotFoundException();\n-        }\n-\n-        for (Player player : players) {\n-            sender.sendMessage(tl(\"backOther\", player.getName()));\n-            teleportBack(sender, ess.getUser(player));\n-        }\n+    private void parseCommand(Server server, CommandSource sender, String[] args) throws Exception {", "originalCommit": "a65315b21e9371fd13a864b2ffd0f050984decec", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjg0NDYzMA==", "url": "https://github.com/EssentialsX/Essentials/pull/3337#discussion_r432844630", "bodyText": "Not sure about this; sure, this is a lot of exceptions in the method signature, but this encourages throwing whatever you want and not caring about what you catch.", "author": "mdcfe", "createdAt": "2020-05-30T14:11:45Z", "path": "Essentials/src/com/earth2me/essentials/commands/EssentialsLoopCommand.java", "diffHunk": "@@ -19,27 +19,31 @@ public EssentialsLoopCommand(String command) {\n         super(command);\n     }\n \n-    protected void loopOfflinePlayers(final Server server, final CommandSource sender, final boolean multipleStringMatches, boolean matchWildcards, final String searchTerm, final String[] commandArgs) throws PlayerNotFoundException, NotEnoughArgumentsException, PlayerExemptException, ChargeException, MaxMoneyException {", "originalCommit": "a65315b21e9371fd13a864b2ffd0f050984decec", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjg0NDY0NA==", "url": "https://github.com/EssentialsX/Essentials/pull/3337#discussion_r432844644", "bodyText": "This is an overloaded method, why change the name?", "author": "mdcfe", "createdAt": "2020-05-30T14:12:06Z", "path": "Essentials/src/com/earth2me/essentials/commands/EssentialsLoopCommand.java", "diffHunk": "@@ -19,27 +19,31 @@ public EssentialsLoopCommand(String command) {\n         super(command);\n     }\n \n-    protected void loopOfflinePlayers(final Server server, final CommandSource sender, final boolean multipleStringMatches, boolean matchWildcards, final String searchTerm, final String[] commandArgs) throws PlayerNotFoundException, NotEnoughArgumentsException, PlayerExemptException, ChargeException, MaxMoneyException {\n+    protected void loopOfflinePlayers(final Server server, final CommandSource sender, final boolean multipleStringMatches, boolean matchWildcards, final String searchTerm, final String[] commandArgs) throws Exception {\n+        loopOfflinePlayersConsumer(server, sender, multipleStringMatches, matchWildcards, searchTerm, user -> updatePlayer(server, sender, user, commandArgs));\n+    }\n+\n+    protected void loopOfflinePlayersConsumer(final Server server, final CommandSource sender, final boolean multipleStringMatches, boolean matchWildcards, final String searchTerm, UserConsumer userConsumer) throws Exception {", "originalCommit": "a65315b21e9371fd13a864b2ffd0f050984decec", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjg0NjI1NA==", "url": "https://github.com/EssentialsX/Essentials/pull/3337#discussion_r432846254", "bodyText": "Some uses of loop methods provide null to the args array which would create an ambiguous method call due to the fact that the String[] args argument isn't in loopOfflinePlayersConsumer", "author": "JRoy", "createdAt": "2020-05-30T14:35:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjg0NDY0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjg0NDY5Nw==", "url": "https://github.com/EssentialsX/Essentials/pull/3337#discussion_r432844697", "bodyText": "Same concerns as above.", "author": "mdcfe", "createdAt": "2020-05-30T14:12:42Z", "path": "Essentials/src/com/earth2me/essentials/commands/EssentialsLoopCommand.java", "diffHunk": "@@ -48,19 +52,23 @@ protected void loopOfflinePlayers(final Server server, final CommandSource sende\n             final List<Player> matchedPlayers = server.matchPlayer(searchTerm);\n             if (matchedPlayers.isEmpty()) {\n                 final User matchedUser = getPlayer(server, searchTerm, true, true);\n-                updatePlayer(server, sender, matchedUser, commandArgs);\n+                userConsumer.accept(matchedUser);\n             }\n             for (Player matchPlayer : matchedPlayers) {\n                 final User matchedUser = ess.getUser(matchPlayer);\n-                updatePlayer(server, sender, matchedUser, commandArgs);\n+                userConsumer.accept(matchedUser);\n             }\n         } else {\n             final User user = getPlayer(server, searchTerm, true, true);\n-            updatePlayer(server, sender, user, commandArgs);\n+            userConsumer.accept(user);\n         }\n     }\n \n-    protected void loopOnlinePlayers(final Server server, final CommandSource sender, final boolean multipleStringMatches, boolean matchWildcards, final String searchTerm, final String[] commandArgs) throws PlayerNotFoundException, NotEnoughArgumentsException, PlayerExemptException, ChargeException, MaxMoneyException {\n+    protected void loopOnlinePlayers(final Server server, final CommandSource sender, final boolean multipleStringMatches, boolean matchWildcards, final String searchTerm, final String[] commandArgs) throws Exception {\n+        loopOnlinePlayersConsumer(server, sender, multipleStringMatches, matchWildcards, searchTerm, user -> updatePlayer(server, sender, user, commandArgs));\n+    }\n+\n+    protected void loopOnlinePlayersConsumer(final Server server, final CommandSource sender, final boolean multipleStringMatches, boolean matchWildcards, final String searchTerm, UserConsumer userConsumer) throws Exception {", "originalCommit": "a65315b21e9371fd13a864b2ffd0f050984decec", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjg0NDg5Mw==", "url": "https://github.com/EssentialsX/Essentials/pull/3337#discussion_r432844893", "bodyText": "I'd prefer keeping this abstract, it's still used in most places, and the few cases where it's unused we can implement the empty method.", "author": "mdcfe", "createdAt": "2020-05-30T14:15:28Z", "path": "Essentials/src/com/earth2me/essentials/commands/EssentialsLoopCommand.java", "diffHunk": "@@ -100,19 +108,21 @@ protected void loopOnlinePlayers(final Server server, final CommandSource sender\n                         continue;\n                     }\n                     foundUser = true;\n-                    updatePlayer(server, sender, player, commandArgs);\n+                    userConsumer.accept(player);\n                 }\n             }\n             if (!foundUser) {\n                 throw new PlayerNotFoundException();\n             }\n         } else {\n             final User player = getPlayer(server, sender, searchTerm);\n-            updatePlayer(server, sender, player, commandArgs);\n+            userConsumer.accept(player);\n         }\n     }\n \n-    protected abstract void updatePlayer(Server server, CommandSource sender, User user, String[] args) throws NotEnoughArgumentsException, PlayerExemptException, ChargeException, MaxMoneyException;\n+    protected void updatePlayer(Server server, CommandSource sender, User user, String[] args) throws NotEnoughArgumentsException, PlayerExemptException, ChargeException, MaxMoneyException {", "originalCommit": "a65315b21e9371fd13a864b2ffd0f050984decec", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjg0NDk2Mw==", "url": "https://github.com/EssentialsX/Essentials/pull/3337#discussion_r432844963", "bodyText": "Is this interface really necessary? Why not Consumer<User>?", "author": "mdcfe", "createdAt": "2020-05-30T14:16:11Z", "path": "Essentials/src/com/earth2me/essentials/commands/EssentialsLoopCommand.java", "diffHunk": "@@ -129,4 +139,8 @@ protected void loopOnlinePlayers(final Server server, final CommandSource sender\n         players.add(\"*\");\n         return players;\n     }\n+\n+    public interface UserConsumer {", "originalCommit": "a65315b21e9371fd13a864b2ffd0f050984decec", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjg0NTMzNg==", "url": "https://github.com/EssentialsX/Essentials/pull/3337#discussion_r432845336", "bodyText": "Consumers are not allowed to throw exceptions", "author": "JRoy", "createdAt": "2020-05-30T14:22:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjg0NDk2Mw=="}], "type": "inlineReview"}, {"oid": "4119bfd2b8a369fc7e12a2103d724d52dd7b4644", "url": "https://github.com/EssentialsX/Essentials/commit/4119bfd2b8a369fc7e12a2103d724d52dd7b4644", "message": "Reduce exceptions able to be thrown + make updatePlayer abstract", "committedDate": "2020-05-30T14:30:02Z", "type": "commit"}, {"oid": "344e68be7c5b56e28dc72dc7c3686d35fa11c57c", "url": "https://github.com/EssentialsX/Essentials/commit/344e68be7c5b56e28dc72dc7c3686d35fa11c57c", "message": "Update Essentials/src/com/earth2me/essentials/commands/Commandback.java\n\nCo-authored-by: MD <1917406+md678685@users.noreply.github.com>", "committedDate": "2020-05-30T14:36:17Z", "type": "commit"}, {"oid": "4334635ad4f5091ca056b43cfaddc95958faefd7", "url": "https://github.com/EssentialsX/Essentials/commit/4334635ad4f5091ca056b43cfaddc95958faefd7", "message": "Fix build", "committedDate": "2020-05-30T14:38:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjg2MjkxNw==", "url": "https://github.com/EssentialsX/Essentials/pull/3337#discussion_r432862917", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        this.parseCommand(server, sender, args);\n          \n          \n            \n                        this.parseOthers(server, sender, args);\n          \n      \n    \n    \n  \n\nFixes compile", "author": "mdcfe", "createdAt": "2020-05-30T15:16:59Z", "path": "Essentials/src/com/earth2me/essentials/commands/Commandback.java", "diffHunk": "@@ -23,7 +20,7 @@ public Commandback() {\n     protected void run(Server server, User user, String commandLabel, String[] args) throws Exception {\n         CommandSource sender = user.getSource();\n         if (args.length > 0 && user.isAuthorized(\"essentials.back.others\")) {\n-            this.parseCommand(server, sender, args, true);\n+            this.parseCommand(server, sender, args);", "originalCommit": "344e68be7c5b56e28dc72dc7c3686d35fa11c57c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "706557d475c2485ccf8507b547e4b5274e3a5940", "url": "https://github.com/EssentialsX/Essentials/commit/706557d475c2485ccf8507b547e4b5274e3a5940", "message": "Cleanup /enchant and /enderchest", "committedDate": "2020-05-30T15:54:24Z", "type": "commit"}, {"oid": "cab57b6999e77939d10d1de7049c996b37cae4c3", "url": "https://github.com/EssentialsX/Essentials/commit/cab57b6999e77939d10d1de7049c996b37cae4c3", "message": "Add CommandSource#getUser convenience method", "committedDate": "2020-05-30T21:15:48Z", "type": "commit"}, {"oid": "fdd45137742a3f32645ce86ead6f2adb6fdc1487", "url": "https://github.com/EssentialsX/Essentials/commit/fdd45137742a3f32645ce86ead6f2adb6fdc1487", "message": "Move User#getDisplayName to IUser interface", "committedDate": "2020-05-30T21:40:06Z", "type": "commit"}, {"oid": "326bbe2e31c34216727f2235248d6277f22bd6e5", "url": "https://github.com/EssentialsX/Essentials/commit/326bbe2e31c34216727f2235248d6277f22bd6e5", "message": "Cleanup xp command", "committedDate": "2020-05-30T21:47:45Z", "type": "commit"}, {"oid": "156c62c4720c0b0ca35d83af068eadd4f7370e06", "url": "https://github.com/EssentialsX/Essentials/commit/156c62c4720c0b0ca35d83af068eadd4f7370e06", "message": "Use enum in tab completion", "committedDate": "2020-05-30T22:03:25Z", "type": "commit"}, {"oid": "33951239f420c607d503947d651b9b79d803e37a", "url": "https://github.com/EssentialsX/Essentials/commit/33951239f420c607d503947d651b9b79d803e37a", "message": "Commandext", "committedDate": "2020-05-30T22:24:14Z", "type": "commit"}, {"oid": "53658a241541fe7b54d34e5906907de19492bf53", "url": "https://github.com/EssentialsX/Essentials/commit/53658a241541fe7b54d34e5906907de19492bf53", "message": "Exp, fireball, firework, fly", "committedDate": "2020-06-01T05:04:06Z", "type": "commit"}, {"oid": "6fda5d3209c3916c7df93113a42a65dfd3ad5e04", "url": "https://github.com/EssentialsX/Essentials/commit/6fda5d3209c3916c7df93113a42a65dfd3ad5e04", "message": "Make gamemode command a loop command", "committedDate": "2020-06-01T05:04:58Z", "type": "commit"}, {"oid": "dc579941750288dae4a60874949d3ecf3258264e", "url": "https://github.com/EssentialsX/Essentials/commit/dc579941750288dae4a60874949d3ecf3258264e", "message": "Add CommandSource#isAuthorized helper method", "committedDate": "2020-06-01T15:35:04Z", "type": "commit"}, {"oid": "fe6443aa6d5640b2a09078d020672dbc983393f2", "url": "https://github.com/EssentialsX/Essentials/commit/fe6443aa6d5640b2a09078d020672dbc983393f2", "message": "Convert give to loop command", "committedDate": "2020-06-01T15:40:51Z", "type": "commit"}, {"oid": "6c8b463abacd8bcd8d5fc6f6a2c5e4aa0f0b7ba4", "url": "https://github.com/EssentialsX/Essentials/commit/6c8b463abacd8bcd8d5fc6f6a2c5e4aa0f0b7ba4", "message": "Clean up god to kill commands inclusive", "committedDate": "2020-06-01T16:21:09Z", "type": "commit"}, {"oid": "7fdeddb548d948091122fa94df18acb865607cf5", "url": "https://github.com/EssentialsX/Essentials/commit/7fdeddb548d948091122fa94df18acb865607cf5", "message": "Clean up kit to motd commands inclusive", "committedDate": "2020-06-01T19:53:14Z", "type": "commit"}, {"oid": "0d0b98bb69d216635c08a18ab4ad3f1bbe204b78", "url": "https://github.com/EssentialsX/Essentials/commit/0d0b98bb69d216635c08a18ab4ad3f1bbe204b78", "message": "Clean up msg to pweather\n\ntime and weather need to be converted to loop commands because HOLY FUCK LOOK AT THAT CODE i have no brain power right now", "committedDate": "2020-06-04T04:50:38Z", "type": "commit"}, {"oid": "7c8df060730baa14bb9ec82f4478b1e19067379b", "url": "https://github.com/EssentialsX/Essentials/commit/7c8df060730baa14bb9ec82f4478b1e19067379b", "message": "Remove duplicate permission in plugin.yml", "committedDate": "2020-06-04T17:15:25Z", "type": "commit"}, {"oid": "b6000054f1869edc00b69f9f31f4cc09d4803f05", "url": "https://github.com/EssentialsX/Essentials/commit/b6000054f1869edc00b69f9f31f4cc09d4803f05", "message": "Remove player related code from 1.6.4", "committedDate": "2020-06-04T18:31:05Z", "type": "commit"}, {"oid": "498ae6ba42dc7c5e52f8fe2fd8e0e9cb0aec3a72", "url": "https://github.com/EssentialsX/Essentials/commit/498ae6ba42dc7c5e52f8fe2fd8e0e9cb0aec3a72", "message": "Add CommandSource#getSelfSelector helper method", "committedDate": "2020-06-05T17:00:54Z", "type": "commit"}, {"oid": "3a6a2eae7dd99e253216d93b407b990931255787", "url": "https://github.com/EssentialsX/Essentials/commit/3a6a2eae7dd99e253216d93b407b990931255787", "message": "Refactor ptime and pweather\n\nThese were the worst commands i've seen", "committedDate": "2020-06-05T19:21:31Z", "type": "commit"}, {"oid": "370d755e28240a92cd9026f1cc09022c0b56536d", "url": "https://github.com/EssentialsX/Essentials/commit/370d755e28240a92cd9026f1cc09022c0b56536d", "message": "Removed unused sub class", "committedDate": "2020-06-05T19:23:16Z", "type": "commit"}, {"oid": "6ebfff165d8ab12d5b95b967956f2be5e6fa62ad", "url": "https://github.com/EssentialsX/Essentials/commit/6ebfff165d8ab12d5b95b967956f2be5e6fa62ad", "message": "Remove legacy nickname code for versions < 1.8", "committedDate": "2020-06-05T19:53:31Z", "type": "commit"}, {"oid": "eb2fa0849006fb3c9e022046f40d44ae9ce4fe83", "url": "https://github.com/EssentialsX/Essentials/commit/eb2fa0849006fb3c9e022046f40d44ae9ce4fe83", "message": "reply to remove", "committedDate": "2020-06-05T22:33:32Z", "type": "commit"}, {"oid": "fbb2bb8751c3c89432db9083353be402ec4596e4", "url": "https://github.com/EssentialsX/Essentials/commit/fbb2bb8751c3c89432db9083353be402ec4596e4", "message": "Commands repair to thunder", "committedDate": "2020-06-06T04:52:54Z", "type": "commit"}, {"oid": "bae7bd392cf9199c572baa81b371686dad9f5cc0", "url": "https://github.com/EssentialsX/Essentials/commit/bae7bd392cf9199c572baa81b371686dad9f5cc0", "message": "Print cause exceptions for NotEnoughArguments exceptions", "committedDate": "2020-06-06T20:08:45Z", "type": "commit"}, {"oid": "051ec93fd98c781ca2d82b1c55a734cb739e6586", "url": "https://github.com/EssentialsX/Essentials/commit/051ec93fd98c781ca2d82b1c55a734cb739e6586", "message": "Fix spacing in tick formatting", "committedDate": "2020-06-06T20:09:44Z", "type": "commit"}, {"oid": "22bc3787ff72d083a79d5a870ca3f02bcace36c1", "url": "https://github.com/EssentialsX/Essentials/commit/22bc3787ff72d083a79d5a870ca3f02bcace36c1", "message": "Cleanup time command", "committedDate": "2020-06-06T20:16:59Z", "type": "commit"}, {"oid": "2d54f2d21014481937e7864b6e0d57a207af1834", "url": "https://github.com/EssentialsX/Essentials/commit/2d54f2d21014481937e7864b6e0d57a207af1834", "message": "Finish commands", "committedDate": "2020-06-06T21:19:28Z", "type": "commit"}, {"oid": "b953bbd38ffc19e930236a93ffcca51f160c1b6d", "url": "https://github.com/EssentialsX/Essentials/commit/b953bbd38ffc19e930236a93ffcca51f160c1b6d", "message": "Clean up module commands", "committedDate": "2020-06-06T22:02:50Z", "type": "commit"}, {"oid": "0d5466205f00f17a435295610618d2a34f135d9a", "url": "https://github.com/EssentialsX/Essentials/commit/0d5466205f00f17a435295610618d2a34f135d9a", "message": "Pepega Clap", "committedDate": "2020-06-06T22:21:35Z", "type": "commit"}, {"oid": "60fe71ed615b84a866b848e0197f3c0e6f0562e1", "url": "https://github.com/EssentialsX/Essentials/commit/60fe71ed615b84a866b848e0197f3c0e6f0562e1", "message": "Merge branch '2.x' into feature/command-rewrite", "committedDate": "2020-06-16T20:41:28Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTE5NTAzMw==", "url": "https://github.com/EssentialsX/Essentials/pull/3337#discussion_r441195033", "bodyText": "Maybe Collection<User> would be better here?", "author": "pop4959", "createdAt": "2020-06-16T23:21:21Z", "path": "Essentials/src/com/earth2me/essentials/IEssentials.java", "diffHunk": "@@ -103,7 +103,7 @@\n \n     Collection<Player> getOnlinePlayers();\n \n-    Iterable<User> getOnlineUsers();\n+    List<User> getOnlineUsers();", "originalCommit": "60fe71ed615b84a866b848e0197f3c0e6f0562e1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI1NzE1NA==", "url": "https://github.com/EssentialsX/Essentials/pull/3337#discussion_r441257154", "bodyText": "Commands that have * as their first argument seem not to work, for example /clear * ** or /clear * dirt 1.", "author": "pop4959", "createdAt": "2020-06-17T03:17:51Z", "path": "Essentials/src/com/earth2me/essentials/commands/Commandclearinventory.java", "diffHunk": "@@ -16,73 +16,55 @@\n import static com.earth2me.essentials.I18n.tl;\n \n \n-public class Commandclearinventory extends EssentialsCommand {\n+public class Commandclearinventory extends EssentialsLoopCommand {", "originalCommit": "60fe71ed615b84a866b848e0197f3c0e6f0562e1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI1Nzc3Ng==", "url": "https://github.com/EssentialsX/Essentials/pull/3337#discussion_r441257776", "bodyText": "/eco give <player> -1 takes $1, but /eco take pop4959 -1 does not give $1, which is a bit of an inconsistency in the command.", "author": "pop4959", "createdAt": "2020-06-17T03:20:28Z", "path": "Essentials/src/com/earth2me/essentials/commands/Commandeco.java", "diffHunk": "@@ -18,9 +18,6 @@\n \n \n public class Commandeco extends EssentialsLoopCommand {", "originalCommit": "60fe71ed615b84a866b848e0197f3c0e6f0562e1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTU1NjE4MA==", "url": "https://github.com/EssentialsX/Essentials/pull/3337#discussion_r441556180", "bodyText": "Just tested this, the - is ignored just like it way before this refactor", "author": "JRoy", "createdAt": "2020-06-17T13:44:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI1Nzc3Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTkwNDEwOQ==", "url": "https://github.com/EssentialsX/Essentials/pull/3337#discussion_r441904109", "bodyText": "I guess this is technically a \"refactor\", so you shouldn't have to change any preexisting behavior, but it's still strange that it works this way.", "author": "pop4959", "createdAt": "2020-06-18T00:30:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI1Nzc3Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI1ODk4MQ==", "url": "https://github.com/EssentialsX/Essentials/pull/3337#discussion_r441258981", "bodyText": "I think I prefer this over the consumer, and it's a bit weird to have only one implemented or the other", "author": "pop4959", "createdAt": "2020-06-17T03:25:24Z", "path": "Essentials/src/com/earth2me/essentials/commands/Commandeco.java", "diffHunk": "@@ -32,82 +29,61 @@ public void run(final Server server, final CommandSource sender, final String co\n             throw new NotEnoughArgumentsException();\n         }\n \n-        BigDecimal startingBalance = ess.getSettings().getStartingBalance();\n-\n+        EcoCommands cmd;\n+        boolean isPercent;\n+        BigDecimal amount;\n         try {\n-            cmd = Commandeco.EcoCommands.valueOf(args[0].toUpperCase(Locale.ENGLISH));\n+            cmd = EcoCommands.valueOf(args[0].toUpperCase(Locale.ENGLISH));\n             isPercent = cmd != EcoCommands.RESET && args[2].endsWith(\"%\");\n-            amount = (cmd == Commandeco.EcoCommands.RESET) ? startingBalance : new BigDecimal(args[2].replaceAll(\"[^0-9\\\\.]\", \"\"));\n+            amount = (cmd == EcoCommands.RESET) ? ess.getSettings().getStartingBalance() : new BigDecimal(args[2].replaceAll(\"[^0-9\\\\.]\", \"\"));\n         } catch (Exception ex) {\n             throw new NotEnoughArgumentsException(ex);\n         }\n \n-        loopOfflinePlayers(server, sender, false, true, args[1], args);\n-\n-        if (cmd == Commandeco.EcoCommands.RESET || cmd == Commandeco.EcoCommands.SET) {\n-            if (args[1].contentEquals(\"**\")) {\n-                server.broadcastMessage(tl(\"resetBalAll\", NumberUtil.displayCurrency(amount, ess)));\n-            } else if (args[1].contentEquals(\"*\")) {\n-                server.broadcastMessage(tl(\"resetBal\", NumberUtil.displayCurrency(amount, ess)));\n+        loopOfflinePlayersConsumer(server, sender, false, true, args[1], player -> {\n+            BigDecimal userAmount = amount;\n+            if (isPercent) {\n+                userAmount = player.getMoney().multiply(userAmount).scaleByPowerOfTen(-2);\n             }\n-        }\n-    }\n-\n-    @Override\n-    protected void updatePlayer(final Server server, final CommandSource sender, final User player, final String[] args) throws NotEnoughArgumentsException, ChargeException, MaxMoneyException {\n-        if (isPercent && cmd != EcoCommands.RESET) {\n-            amount = player.getMoney().multiply(amount).scaleByPowerOfTen(-2);\n-        }\n-        switch (cmd) {\n-            case GIVE:\n-                player.giveMoney(amount, sender, UserBalanceUpdateEvent.Cause.COMMAND_ECO);\n-                break;\n-\n-            case TAKE:\n-                take(amount, player, sender);\n-                break;\n-\n-            case RESET:\n-            case SET:\n-                set(amount, player, sender);\n-                break;\n-        }\n-    }\n \n-    private void take(BigDecimal amount, final User player, final CommandSource sender) throws ChargeException {\n-        BigDecimal money = player.getMoney();\n-        BigDecimal minBalance = ess.getSettings().getMinMoney();\n-        if (money.subtract(amount).compareTo(minBalance) >= 0) {\n-            player.takeMoney(amount, sender, UserBalanceUpdateEvent.Cause.COMMAND_ECO);\n-        } else if (sender == null) {\n-            try {\n-                player.setMoney(minBalance, UserBalanceUpdateEvent.Cause.COMMAND_ECO);\n-            } catch (MaxMoneyException ex) {\n-                // Take shouldn't be able to throw a max money exception\n+            switch (cmd) {\n+                case GIVE: {\n+                    player.giveMoney(userAmount, sender, UserBalanceUpdateEvent.Cause.COMMAND_ECO);\n+                    break;\n+                }\n+                case TAKE: {\n+                    if (player.getMoney().subtract(userAmount).compareTo(ess.getSettings().getMinMoney()) >= 0) {\n+                        player.takeMoney(userAmount, sender, UserBalanceUpdateEvent.Cause.COMMAND_ECO);\n+                    } else {\n+                        ess.showError(sender, new Exception(tl(\"minimumBalanceError\", NumberUtil.displayCurrency(ess.getSettings().getMinMoney(), ess))), commandLabel);\n+                    }\n+                    break;\n+                }\n+                case RESET:\n+                case SET: {\n+                    BigDecimal minBal = ess.getSettings().getMinMoney();\n+                    BigDecimal maxBal = ess.getSettings().getMaxMoney();\n+                    boolean underMin = (userAmount.compareTo(minBal) < 0);\n+                    boolean aboveMax = (userAmount.compareTo(maxBal) > 0);\n+                    player.setMoney(underMin ? minBal : aboveMax ? maxBal : userAmount, UserBalanceUpdateEvent.Cause.COMMAND_ECO);\n+                    player.sendMessage(tl(\"setBal\", NumberUtil.displayCurrency(player.getMoney(), ess)));\n+                    sender.sendMessage(tl(\"setBalOthers\", player.getDisplayName(), NumberUtil.displayCurrency(player.getMoney(), ess)));\n+                    break;\n+                }\n             }\n-            player.sendMessage(tl(\"takenFromAccount\", NumberUtil.displayCurrency(player.getMoney(), ess)));\n-        } else {\n-            throw new ChargeException(tl(\"insufficientFunds\"));\n-        }\n-    }\n-\n-    private void set(BigDecimal amount, final User player, final CommandSource sender) throws MaxMoneyException {\n-        BigDecimal minBalance = ess.getSettings().getMinMoney();\n-        BigDecimal maxBalance = ess.getSettings().getMaxMoney();\n-        boolean underMinimum = (amount.compareTo(minBalance) < 0);\n-        boolean aboveMax = (amount.compareTo(maxBalance) > 0);\n-        player.setMoney(underMinimum ? minBalance : aboveMax ? maxBalance : amount, UserBalanceUpdateEvent.Cause.COMMAND_ECO);\n-        player.sendMessage(tl(\"setBal\", NumberUtil.displayCurrency(player.getMoney(), ess)));\n-        if (sender != null) {\n-            sender.sendMessage(tl(\"setBalOthers\", player.getDisplayName(), NumberUtil.displayCurrency(player.getMoney(), ess)));\n-        }\n+        });\n     }\n \n \n     private enum EcoCommands {\n         GIVE, TAKE, SET, RESET\n     }\n \n+    @Override\n+    protected void updatePlayer(Server server, CommandSource sender, User user, String[] args) throws NotEnoughArgumentsException, PlayerExemptException, ChargeException, MaxMoneyException {", "originalCommit": "60fe71ed615b84a866b848e0197f3c0e6f0562e1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTU5MjAxNQ==", "url": "https://github.com/EssentialsX/Essentials/pull/3337#discussion_r441592015", "bodyText": "md wanted this to remain abstract #3337 (comment)\nAs for consumers vs this method, consumers allows us not to have to use instance/static variables laying around the command.", "author": "JRoy", "createdAt": "2020-06-17T14:32:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI1ODk4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTkwNDQyNQ==", "url": "https://github.com/EssentialsX/Essentials/pull/3337#discussion_r441904425", "bodyText": "Fair enough. I don't dislike the new method, but it could perhaps be its own distinct class (still abstract), since only one or the other method is ever being used.", "author": "pop4959", "createdAt": "2020-06-18T00:31:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI1ODk4MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI2MTc4Ng==", "url": "https://github.com/EssentialsX/Essentials/pull/3337#discussion_r441261786", "bodyText": "This seems a little weird to me, why not just check the permissions normally but maybe just store the permission node on the enum?", "author": "pop4959", "createdAt": "2020-06-17T03:37:20Z", "path": "Essentials/src/com/earth2me/essentials/commands/Commandexp.java", "diffHunk": "@@ -1,140 +1,136 @@\n package com.earth2me.essentials.commands;\n \n import com.earth2me.essentials.CommandSource;\n+import com.earth2me.essentials.IUser;\n import com.earth2me.essentials.User;\n import com.earth2me.essentials.craftbukkit.SetExpFix;\n import com.earth2me.essentials.utils.NumberUtil;\n import com.google.common.collect.Lists;\n import org.bukkit.Server;\n-import org.bukkit.entity.Player;\n \n+import java.util.ArrayList;\n import java.util.Collections;\n import java.util.List;\n import java.util.Locale;\n \n import static com.earth2me.essentials.I18n.tl;\n \n \n-public class Commandexp extends EssentialsCommand {\n+public class Commandexp extends EssentialsLoopCommand {\n     public Commandexp() {\n         super(\"exp\");\n     }\n \n     @Override\n-    public void run(final Server server, final User user, final String commandLabel, final String[] args) throws Exception {\n-        if (args.length == 0) {\n-            showExp(user.getSource(), user);\n-        } else if (args.length > 1 && args[0].equalsIgnoreCase(\"set\") && user.isAuthorized(\"essentials.exp.set\")) {\n-            if (args.length == 3 && user.isAuthorized(\"essentials.exp.set.others\")) {\n-                expMatch(server, user.getSource(), args[1], args[2], false);\n-            } else {\n-                setExp(user.getSource(), user, args[1], false);\n+    public void run(final Server server, final CommandSource sender, final String commandLabel, final String[] args) throws Exception {\n+        IUser user = sender.getUser(ess);\n+        if (args.length == 0 || (args.length < 2 && user == null)) {\n+            if (user == null) {\n+                throw new NotEnoughArgumentsException();\n             }\n-        } else if (args.length > 1 && args[0].equalsIgnoreCase(\"give\") && user.isAuthorized(\"essentials.exp.give\")) {\n-            if (args.length == 3 && user.isAuthorized(\"essentials.exp.give.others\")) {\n-                expMatch(server, user.getSource(), args[1], args[2], true);\n-            } else {\n-                setExp(user.getSource(), user, args[1], true);\n+            showExp(sender, user);\n+            return;\n+        }\n+\n+        ExpCommands cmd;\n+        try {\n+            cmd = ExpCommands.valueOf(args[0].toUpperCase(Locale.ENGLISH));\n+        } catch (Exception ex) {\n+            throw new NotEnoughArgumentsException(ex);\n+        }\n+\n+        if (!cmd.hasPermission(user)) {\n+            user.sendMessage(tl(\"noAccessSubCommand\", \"/\" + commandLabel + \" \" + cmd.name().toLowerCase(Locale.ENGLISH)));\n+            return;\n+        }\n+\n+        switch (cmd) {\n+            case SET: {\n+                if (args.length == 3 && cmd.hasOtherPermission(user)) {\n+                    loopOnlinePlayersConsumer(server,sender, false, true, args[1], player -> setExp(sender, player, args[2], false));\n+                } else if (args.length == 2 && user != null) {\n+                    setExp(sender, user, args[1], false);\n+                } else {\n+                    throw new NotEnoughArgumentsException();\n+                }\n+                return;\n             }\n-        } else if (args.length > 1 && args[0].equalsIgnoreCase(\"take\") && user.isAuthorized(\"essentials.exp.take\")) {\n-            if (args.length == 3 && user.isAuthorized(\"essentials.exp.take.others\")) {\n-                expMatch(server, user.getSource(), args[1], \"-\" + args[2], true);\n-            } else {\n-                setExp(user.getSource(), user, \"-\" + args[1], true);\n-            }        \n-        } else if (args.length < 3 && args[0].equalsIgnoreCase(\"reset\") && user.isAuthorized(\"essentials.exp.reset\")) {\n-            if (args.length == 2 && user.isAuthorized(\"essentials.exp.reset.others\")) {\n-                expMatch(server, user.getSource(), args[1], \"0\", false);\n-            } else {\n-                setExp(user.getSource(), user, \"0\", false);\n+            case GIVE: {\n+                if (args.length == 3 && cmd.hasOtherPermission(user)) {\n+                    loopOnlinePlayersConsumer(server, sender, false, true, args[1], player -> setExp(sender, player, args[2], true));\n+                } else if (args.length == 2 && user != null) {\n+                    setExp(sender, user, args[1], true);\n+                } else {\n+                    throw new NotEnoughArgumentsException();\n+                }\n+                return;\n             }\n-        } else if (args[0].equalsIgnoreCase(\"show\")) {\n-            if (args.length >= 2 && user.isAuthorized(\"essentials.exp.others\")) {\n-                String match = args[1].trim();\n-                showMatch(server, user.getSource(), match);\n-            } else {\n-                showExp(user.getSource(), user);\n+            case TAKE: {\n+                if (args.length == 3 && cmd.hasOtherPermission(user)) {\n+                    loopOnlinePlayersConsumer(server, sender, false, true, args[1], player -> setExp(sender, player, \"-\" + args[2], true));\n+                } else if (args.length == 2) {\n+                    setExp(sender, user, \"-\" + args[1], true);\n+                } else {\n+                    throw new NotEnoughArgumentsException();\n+                }\n+                return;\n             }\n-        } else {\n-            if (args.length >= 1 && NumberUtil.isInt(args[0].toLowerCase(Locale.ENGLISH).replace(\"l\", \"\")) && user.isAuthorized(\"essentials.exp.give\")) {\n-                if (args.length >= 2 && user.isAuthorized(\"essentials.exp.give.others\")) {\n-                    expMatch(server, user.getSource(), args[1], args[0], true);\n+            case RESET: {\n+                if (args.length == 2 && cmd.hasOtherPermission(user)) {\n+                    loopOnlinePlayersConsumer(server, sender, false, true, args[1], player -> setExp(sender, player, \"0\", false));\n+                } else if (user != null) {\n+                    setExp(sender, user, \"0\", false);\n                 } else {\n-                    setExp(user.getSource(), user, args[0], true);\n+                    throw new NotEnoughArgumentsException();\n                 }\n-            } else if (args.length >= 1 && user.isAuthorized(\"essentials.exp.others\")) {\n-                String match = args[0].trim();\n-                showMatch(server, user.getSource(), match);\n-            } else {\n-                showExp(user.getSource(), user);\n+                return;\n             }\n-        }\n-    }\n-\n-    @Override\n-    public void run(final Server server, final CommandSource sender, final String commandLabel, final String[] args) throws Exception {\n-        if (args.length < 1) {\n-            throw new NotEnoughArgumentsException();\n-        } else if (args.length > 2 && args[0].equalsIgnoreCase(\"set\")) {\n-            expMatch(server, sender, args[1], args[2], false);\n-        } else if (args.length > 2 && args[0].equalsIgnoreCase(\"give\")) {\n-            expMatch(server, sender, args[1], args[2], true);\n-        } else if (args.length > 2 && args[0].equalsIgnoreCase(\"take\")) {\n-            expMatch(server, sender, args[1], \"-\" + args[2], true);\n-        } else if (args.length > 2 && args[0].equalsIgnoreCase(\"reset\")) {\n-            expMatch(server, sender, args[1], \"0\", false);\n-        } else {\n-            String match = args[0].trim();\n-            if (args.length >= 2 && NumberUtil.isInt(args[0].toLowerCase(Locale.ENGLISH).replace(\"l\", \"\"))) {\n-                match = args[1].trim();\n-                expMatch(server, sender, match, args[0], true);\n-            } else if (args.length == 1) {\n-                match = args[0].trim();\n+            case SHOW: {\n+                if (args.length == 2 && (user == null || user.isAuthorized(\"essentials.exp.others\"))) {\n+                    showExp(sender, getPlayer(server, sender, args[1]));\n+                } else if (user != null) {\n+                    showExp(sender, user);\n+                } else {\n+                    throw new NotEnoughArgumentsException();\n+                }\n+                return;\n             }\n-            showMatch(server, sender, match);\n         }\n+        throw new NotEnoughArgumentsException(); //Should never happen but in the impossible chance it does...\n     }\n \n-    private void showMatch(final Server server, final CommandSource sender, final String match) throws PlayerNotFoundException {\n-        boolean skipHidden = sender.isPlayer() && !ess.getUser(sender.getPlayer()).canInteractVanished();\n-        boolean foundUser = false;\n-        final List<Player> matchedPlayers = server.matchPlayer(match);\n-        for (Player matchPlayer : matchedPlayers) {\n-            final User player = ess.getUser(matchPlayer);\n-            if (skipHidden && player.isHidden(sender.getPlayer()) && !sender.getPlayer().canSee(matchPlayer)) {\n-                continue;\n-            }\n-            foundUser = true;\n-            showExp(sender, player);\n+    private enum ExpCommands {\n+        SET,\n+        GIVE,\n+        TAKE,\n+        RESET,\n+        SHOW(false);\n+\n+        private final boolean permCheck;\n+\n+        ExpCommands() {\n+            permCheck = true;\n         }\n-        if (!foundUser) {\n-            throw new PlayerNotFoundException();\n+\n+        ExpCommands(boolean perm) {\n+            permCheck = perm;\n         }\n-    }\n \n-    private void expMatch(final Server server, final CommandSource sender, final String match, String amount, final boolean give) throws NotEnoughArgumentsException, PlayerNotFoundException {\n-        boolean skipHidden = sender.isPlayer() && !ess.getUser(sender.getPlayer()).canInteractVanished();\n-        boolean foundUser = false;\n-        final List<Player> matchedPlayers = server.matchPlayer(match);\n-        for (Player matchPlayer : matchedPlayers) {\n-            final User player = ess.getUser(matchPlayer);\n-            if (skipHidden && player.isHidden(sender.getPlayer()) && !sender.getPlayer().canSee(matchPlayer)) {\n-                continue;\n-            }\n-            foundUser = true;\n-            setExp(sender, player, amount, give);\n+        boolean hasPermission(IUser user) {", "originalCommit": "60fe71ed615b84a866b848e0197f3c0e6f0562e1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTU5MjkzMQ==", "url": "https://github.com/EssentialsX/Essentials/pull/3337#discussion_r441592931", "bodyText": "This way it reduces code duplication", "author": "JRoy", "createdAt": "2020-06-17T14:33:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI2MTc4Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTkwNDYxOQ==", "url": "https://github.com/EssentialsX/Essentials/pull/3337#discussion_r441904619", "bodyText": "Feels a bit forced but OK", "author": "pop4959", "createdAt": "2020-06-18T00:32:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI2MTc4Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI2NTI1OA==", "url": "https://github.com/EssentialsX/Essentials/pull/3337#discussion_r441265258", "bodyText": "This is a bug", "author": "pop4959", "createdAt": "2020-06-17T03:52:25Z", "path": "Essentials/src/com/earth2me/essentials/commands/Commandjails.java", "diffHunk": "@@ -14,7 +14,7 @@ public Commandjails() {\n \n     @Override\n     protected void run(final Server server, final CommandSource sender, final String commandLabel, final String[] args) throws Exception {\n-        if (ess.getJails().getCount() < 1) {\n+        if (ess.getJails().getCount() == 1) {", "originalCommit": "60fe71ed615b84a866b848e0197f3c0e6f0562e1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI2NTg3MQ==", "url": "https://github.com/EssentialsX/Essentials/pull/3337#discussion_r441265871", "bodyText": "This easter egg doesn't appear to be functional. It's probably not worth adding to the translations.", "author": "pop4959", "createdAt": "2020-06-17T03:55:08Z", "path": "Essentials/src/com/earth2me/essentials/commands/Commandjump.java", "diffHunk": "@@ -24,10 +24,10 @@ public void run(final Server server, final User user, final String commandLabel,\n         if (args.length > 0 && args[0].contains(\"lock\") && user.isAuthorized(\"essentials.jump.lock\")) {\n             if (user.isFlyClickJump()) {\n                 user.setRightClickJump(false);\n-                user.sendMessage(\"Flying wizard mode disabled\");\n+                user.sendMessage(tl(\"jumpEasterDisable\"));", "originalCommit": "60fe71ed615b84a866b848e0197f3c0e6f0562e1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTU5NDAyNg==", "url": "https://github.com/EssentialsX/Essentials/pull/3337#discussion_r441594026", "bodyText": "/shrug", "author": "JRoy", "createdAt": "2020-06-17T14:35:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI2NTg3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjU4OTg1NQ==", "url": "https://github.com/EssentialsX/Essentials/pull/3337#discussion_r442589855", "bodyText": "Why wouldn't this be working? :P\nSteps:\n\nEnable Fly\nFly in the sky\nType /jump lock\npunch the air, while looking at the ground some distance away\n\nYou will be teleported to the location x/z, but keep the same y.\nOdd feature... But that's why it was an easteregg.\nBasically", "author": "khobbits", "createdAt": "2020-06-19T01:53:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI2NTg3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjU5NDE2Ng==", "url": "https://github.com/EssentialsX/Essentials/pull/3337#discussion_r442594166", "bodyText": "I stand corrected! I wasn't in fly mode, and I must have glossed over that when looking at the feature in code. Either way, it's an easteregg so it being translated or not too consequential. I'm impartial to it, since the feature is indeed working.", "author": "pop4959", "createdAt": "2020-06-19T02:11:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI2NTg3MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI2NjgyNA==", "url": "https://github.com/EssentialsX/Essentials/pull/3337#discussion_r441266824", "bodyText": "nitpick: could be condensed to else if {", "author": "pop4959", "createdAt": "2020-06-17T03:59:15Z", "path": "Essentials/src/com/earth2me/essentials/commands/Commandmute.java", "diffHunk": "@@ -32,12 +32,12 @@ public void run(final Server server, final CommandSource sender, final String co\n             nomatch = true;\n             user = ess.getUser(new OfflinePlayer(args[0], ess.getServer()));\n         }\n-        if (!user.getBase().isOnline()) {\n-            if (sender.isPlayer() && !ess.getUser(sender.getPlayer()).isAuthorized(\"essentials.mute.offline\")) {\n+        if (!user.getBase().isOnline() && sender.isPlayer()) {\n+            if (!sender.isAuthorized(\"essentials.mute.offline\", ess)) {\n                 throw new Exception(tl(\"muteExemptOffline\"));\n             }\n         } else {\n-            if (user.isAuthorized(\"essentials.mute.exempt\") && sender.isPlayer()) {\n+            if (user.isAuthorized(\"essentials.mute.exempt\")) {", "originalCommit": "60fe71ed615b84a866b848e0197f3c0e6f0562e1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI2Nzk0MQ==", "url": "https://github.com/EssentialsX/Essentials/pull/3337#discussion_r441267941", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        for (int i = 0; args.length > i; i++) {\n          \n          \n            \n                        for (int i = 0; i < args.length; ++i) {", "author": "pop4959", "createdAt": "2020-06-17T04:04:07Z", "path": "Essentials/src/com/earth2me/essentials/commands/Commandnuke.java", "diffHunk": "@@ -25,10 +25,8 @@ protected void run(final Server server, final CommandSource sender, final String\n         Collection<Player> targets;\n         if (args.length > 0) {\n             targets = new ArrayList<>();\n-            int pos = 0;\n-            for (String arg : args) {\n-                targets.add(getPlayer(server, sender, args, pos).getBase());\n-                pos++;\n+            for (int i = 0; args.length > i; i++) {", "originalCommit": "60fe71ed615b84a866b848e0197f3c0e6f0562e1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTkwNTUxOA==", "url": "https://github.com/EssentialsX/Essentials/pull/3337#discussion_r441905518", "bodyText": "In response to the commit message pop wanted this idk why tho: The way I've suggested it is more commonly used (I don't think I've seen it the other way often if at all in Essentials, or most other code). Late night me reviewing this thought this was a bug at first because it was the other way around.", "author": "pop4959", "createdAt": "2020-06-18T00:35:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI2Nzk0MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI3MDE1NA==", "url": "https://github.com/EssentialsX/Essentials/pull/3337#discussion_r441270154", "bodyText": "This should remain private. Also, perhaps <T> Arrays::asList(T...) would be cleaner here instead of the set + static block.", "author": "pop4959", "createdAt": "2020-06-17T04:14:11Z", "path": "Essentials/src/com/earth2me/essentials/commands/Commandptime.java", "diffHunk": "@@ -1,21 +1,20 @@\n package com.earth2me.essentials.commands;\n \n-import com.google.common.collect.Lists;\n-\n import com.earth2me.essentials.CommandSource;\n+import com.earth2me.essentials.IUser;\n import com.earth2me.essentials.User;\n import com.earth2me.essentials.utils.DescParseTickFormat;\n+import com.google.common.collect.Lists;\n import org.bukkit.Server;\n import org.bukkit.World;\n-import org.bukkit.entity.Player;\n \n import java.util.*;\n \n import static com.earth2me.essentials.I18n.tl;\n \n \n-public class Commandptime extends EssentialsCommand {\n-    private static final Set<String> getAliases = new HashSet<>();\n+public class Commandptime extends EssentialsLoopCommand {\n+    protected static final Set<String> getAliases = new HashSet<>();", "originalCommit": "60fe71ed615b84a866b848e0197f3c0e6f0562e1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTU5Nzg4Mw==", "url": "https://github.com/EssentialsX/Essentials/pull/3337#discussion_r441597883", "bodyText": "Is protected for its use in Commandpweather", "author": "JRoy", "createdAt": "2020-06-17T14:40:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI3MDE1NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTkwNjAwNQ==", "url": "https://github.com/EssentialsX/Essentials/pull/3337#discussion_r441906005", "bodyText": "Only because you've forced it to be used in Commandpweather. Is there any particular reason why this is necessary? I think encapsulating each command is more important, and there is no other command as far as I know that borrows code from another directly like this.", "author": "pop4959", "createdAt": "2020-06-18T00:37:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI3MDE1NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI3MDQyNw==", "url": "https://github.com/EssentialsX/Essentials/pull/3337#discussion_r441270427", "bodyText": "Big nope", "author": "pop4959", "createdAt": "2020-06-17T04:15:26Z", "path": "Essentials/src/com/earth2me/essentials/commands/Commandpweather.java", "diffHunk": "@@ -1,27 +1,21 @@\n package com.earth2me.essentials.commands;\n \n-import com.google.common.collect.Lists;\n-\n import com.earth2me.essentials.CommandSource;\n+import com.earth2me.essentials.IUser;\n import com.earth2me.essentials.User;\n+import com.google.common.collect.Lists;\n import org.bukkit.Server;\n import org.bukkit.WeatherType;\n-import org.bukkit.entity.Player;\n \n import java.util.*;\n \n import static com.earth2me.essentials.I18n.tl;\n+import static com.earth2me.essentials.commands.Commandptime.getAliases;", "originalCommit": "60fe71ed615b84a866b848e0197f3c0e6f0562e1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTkwNjIwNg==", "url": "https://github.com/EssentialsX/Essentials/pull/3337#discussion_r441906206", "bodyText": "I noticed this after seeing the protected scope change earlier (hence why I asked why you did it). Now I see, but this isn't a good idea in my opinion.", "author": "pop4959", "createdAt": "2020-06-18T00:38:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI3MDQyNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI3MTc0Nw==", "url": "https://github.com/EssentialsX/Essentials/pull/3337#discussion_r441271747", "bodyText": "Why protected?", "author": "pop4959", "createdAt": "2020-06-17T04:21:06Z", "path": "Essentials/src/com/earth2me/essentials/commands/Commandrtoggle.java", "diffHunk": "@@ -22,7 +22,7 @@ public void run(Server server, CommandSource sender, String commandLabel, String\n     }\n \n     @Override\n-    void togglePlayer(CommandSource sender, User user, Boolean enabled) throws NotEnoughArgumentsException {\n+    protected void togglePlayer(CommandSource sender, User user, Boolean enabled) {", "originalCommit": "60fe71ed615b84a866b848e0197f3c0e6f0562e1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI3MzQzMg==", "url": "https://github.com/EssentialsX/Essentials/pull/3337#discussion_r441273432", "bodyText": "This tab method is a little weird, because it doesn't actually suggest anything until the user has entered 2 args already, making it fairly useless currently.", "author": "pop4959", "createdAt": "2020-06-17T04:28:32Z", "path": "Essentials/src/com/earth2me/essentials/commands/Commandspeed.java", "diffHunk": "@@ -133,18 +131,9 @@ private float getRealMoveSpeed(final float userSpeed, final boolean isFly, final\n         }\n     }\n \n-    @Override\n-    protected List<String> getTabCompleteOptions(Server server, User user, String commandLabel, String[] args) {\n-        if (args.length == 3 && user.isAuthorized(\"essentials.speed.others\")) {\n-            return getPlayers(server, user);\n-        } else {\n-            return Collections.emptyList();\n-        }\n-    }\n-\n     @Override\n     protected List<String> getTabCompleteOptions(Server server, CommandSource sender, String commandLabel, String[] args) {", "originalCommit": "60fe71ed615b84a866b848e0197f3c0e6f0562e1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI3NDc2NQ==", "url": "https://github.com/EssentialsX/Essentials/pull/3337#discussion_r441274765", "bodyText": "This method doesn't need to be called twice", "author": "pop4959", "createdAt": "2020-06-17T04:34:39Z", "path": "Essentials/src/com/earth2me/essentials/commands/Commandthunder.java", "diffHunk": "@@ -18,22 +18,21 @@ public Commandthunder() {\n \n     @Override\n     public void run(final Server server, final User user, final String commandLabel, final String[] args) throws Exception {\n-        if (args.length < 1) {\n+        if (args.length == 0) {\n             throw new NotEnoughArgumentsException();\n         }\n \n         final World world = user.getWorld();\n         final boolean setThunder = args[0].equalsIgnoreCase(\"true\");\n-        if (args.length > 1) {\n-\n-            world.setThundering(setThunder);\n-            world.setThunderDuration(Integer.parseInt(args[1]) * 20);\n-            user.sendMessage(tl(\"thunderDuration\", (setThunder ? tl(\"enabled\") : tl(\"disabled\")), Integer.parseInt(args[1])));\n-\n-        } else {\n+        if (args.length == 1) {\n             world.setThundering(setThunder);", "originalCommit": "60fe71ed615b84a866b848e0197f3c0e6f0562e1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTYwOTYyNg==", "url": "https://github.com/EssentialsX/Essentials/pull/3337#discussion_r441609626", "bodyText": "Which method?", "author": "JRoy", "createdAt": "2020-06-17T14:55:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI3NDc2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTkwNjc0MA==", "url": "https://github.com/EssentialsX/Essentials/pull/3337#discussion_r441906740", "bodyText": "Ignore, was blind and didn't see the return.", "author": "pop4959", "createdAt": "2020-06-18T00:41:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI3NDc2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI3NTQ0MA==", "url": "https://github.com/EssentialsX/Essentials/pull/3337#discussion_r441275440", "bodyText": "Numbers are a bit weird to autocomplete (they are ordered in lexicographical order), so maybe leave out 500 and increment by 1000 or something, or just leave out completions entirely.", "author": "pop4959", "createdAt": "2020-06-17T04:37:20Z", "path": "Essentials/src/com/earth2me/essentials/commands/Commandtime.java", "diffHunk": "@@ -166,25 +130,29 @@ private String normalizeWorldName(World world) {\n \n     @Override\n     protected List<String> getTabCompleteOptions(Server server, CommandSource sender, String commandLabel, String[] args) {\n-        final User user = ess.getUser(sender.getPlayer());\n-\n+        boolean isConsole = sender.isPlayer();\n         if (args.length == 1) {\n-            if (user == null || user.isAuthorized(\"essentials.time.set\")) {\n+            if (isConsole || sender.isAuthorized(\"essentials.time.set\", ess)) {\n                 return Lists.newArrayList(\"set\", \"add\");\n             } else {\n                 return Collections.emptyList();\n             }\n-        } else if (args.length == 2 && args[0].equalsIgnoreCase(\"set\")) {\n-            return Lists.newArrayList(\"sunrise\", \"day\", \"morning\", \"noon\", \"afternoon\", \"sunset\", \"night\", \"midnight\");\n-            // TODO: handle tab completion for add\n+        } else if (args.length == 2) {\n+            if (args[0].equalsIgnoreCase(\"set\")) {\n+                return Lists.newArrayList(\"sunrise\", \"day\", \"morning\", \"noon\", \"afternoon\", \"sunset\", \"night\", \"midnight\");\n+            } else if (args[0].equalsIgnoreCase(\"add\")) {\n+                return Lists.newArrayList(\"500\", \"1000\", \"1500\", \"2000\", \"2500\", \"3000\");", "originalCommit": "60fe71ed615b84a866b848e0197f3c0e6f0562e1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI3NTYyMg==", "url": "https://github.com/EssentialsX/Essentials/pull/3337#discussion_r441275622", "bodyText": "This logic doesn't seem right to me", "author": "pop4959", "createdAt": "2020-06-17T04:38:05Z", "path": "Essentials/src/com/earth2me/essentials/commands/Commandtime.java", "diffHunk": "@@ -166,25 +130,29 @@ private String normalizeWorldName(World world) {\n \n     @Override\n     protected List<String> getTabCompleteOptions(Server server, CommandSource sender, String commandLabel, String[] args) {\n-        final User user = ess.getUser(sender.getPlayer());\n-\n+        boolean isConsole = sender.isPlayer();", "originalCommit": "60fe71ed615b84a866b848e0197f3c0e6f0562e1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTYxMzg5MQ==", "url": "https://github.com/EssentialsX/Essentials/pull/3337#discussion_r441613891", "bodyText": "What logic?", "author": "JRoy", "createdAt": "2020-06-17T15:00:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI3NTYyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTkwNjgyOQ==", "url": "https://github.com/EssentialsX/Essentials/pull/3337#discussion_r441906829", "bodyText": "if the sender is a player, they are not console.", "author": "pop4959", "createdAt": "2020-06-18T00:41:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI3NTYyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTkwNzM2MQ==", "url": "https://github.com/EssentialsX/Essentials/pull/3337#discussion_r441907361", "bodyText": "oh lmao, fixed i fixed that up", "author": "JRoy", "createdAt": "2020-06-18T00:43:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI3NTYyMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI3ODQwMA==", "url": "https://github.com/EssentialsX/Essentials/pull/3337#discussion_r441278400", "bodyText": "Would probably be better to use ChatColor here", "author": "pop4959", "createdAt": "2020-06-17T04:49:14Z", "path": "EssentialsXMPP/src/com/earth2me/essentials/xmpp/Commandxmpp.java", "diffHunk": "@@ -21,13 +21,14 @@ protected void run(final Server server, final CommandSource sender, final String\n         final String address = EssentialsXMPP.getInstance().getAddress(args[0]);\n         if (address == null) {\n             sender.sendMessage(\"\u00a7cThere are no players matching that name.\");\n-        } else {\n-            final String message = getFinalArg(args, 1);\n-            final String senderName = sender.isPlayer() ? ess.getUser(sender.getPlayer()).getDisplayName() : Console.NAME;\n-            sender.sendMessage(\"[\" + senderName + \">\" + address + \"] \" + message);\n-            if (!EssentialsXMPP.getInstance().sendMessage(address, \"[\" + senderName + \"] \" + message)) {\n-                sender.sendMessage(\"\u00a7cError sending message.\");\n-            }\n+            return;\n+        }\n+\n+        final String message = getFinalArg(args, 1);\n+        final String senderName = sender.isPlayer() ? ess.getUser(sender.getPlayer()).getDisplayName() : Console.NAME;\n+        sender.sendMessage(\"[\" + senderName + \">\" + address + \"] \" + message);\n+        if (!EssentialsXMPP.getInstance().sendMessage(address, \"[\" + senderName + \"] \" + message)) {\n+            sender.sendMessage(\"\u00a7cError sending message.\");", "originalCommit": "60fe71ed615b84a866b848e0197f3c0e6f0562e1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "4a6c66b9d26d46ca0fa2048830c6a1c3c7e4d0f5", "url": "https://github.com/EssentialsX/Essentials/commit/4a6c66b9d26d46ca0fa2048830c6a1c3c7e4d0f5", "message": "Merge branch '2.x' into feature/command-rewrite", "committedDate": "2020-06-17T13:41:25Z", "type": "commit"}, {"oid": "9e1a7b2a647e5945828b5161babe23163df433b5", "url": "https://github.com/EssentialsX/Essentials/commit/9e1a7b2a647e5945828b5161babe23163df433b5", "message": "Make IEssentials#getOnlineUsers return Collection", "committedDate": "2020-06-17T14:28:26Z", "type": "commit"}, {"oid": "867bb14559090f4bc889fc208d85d2d68f595678", "url": "https://github.com/EssentialsX/Essentials/commit/867bb14559090f4bc889fc208d85d2d68f595678", "message": "Fix Commandclearinventory offsets", "committedDate": "2020-06-17T14:29:23Z", "type": "commit"}, {"oid": "1cf81818e4212ce596c37fd1aaba019c9e6d6b2d", "url": "https://github.com/EssentialsX/Essentials/commit/1cf81818e4212ce596c37fd1aaba019c9e6d6b2d", "message": "Fix bug with only one jail defined", "committedDate": "2020-06-17T14:34:52Z", "type": "commit"}, {"oid": "5bbf1ab4f5aaad71d825471fc396141558c5d427", "url": "https://github.com/EssentialsX/Essentials/commit/5bbf1ab4f5aaad71d825471fc396141558c5d427", "message": "Remove TODO", "committedDate": "2020-06-17T14:36:04Z", "type": "commit"}, {"oid": "25f1585894298197d46658af988cde555a1a306d", "url": "https://github.com/EssentialsX/Essentials/commit/25f1585894298197d46658af988cde555a1a306d", "message": "Fix nested else if to elseif", "committedDate": "2020-06-17T14:37:12Z", "type": "commit"}, {"oid": "95743f0405b9fe2e1679fa82b2983bf661473075", "url": "https://github.com/EssentialsX/Essentials/commit/95743f0405b9fe2e1679fa82b2983bf661473075", "message": "pop wanted this idk why tho", "committedDate": "2020-06-17T14:38:15Z", "type": "commit"}, {"oid": "43b1ee3a86054b460498455bb010a92bc950bdec", "url": "https://github.com/EssentialsX/Essentials/commit/43b1ee3a86054b460498455bb010a92bc950bdec", "message": "Convert getAliases from a Set to a List", "committedDate": "2020-06-17T14:41:12Z", "type": "commit"}, {"oid": "24cb93c73abf28ffcefd1d8b9c261c8da220a6b1", "url": "https://github.com/EssentialsX/Essentials/commit/24cb93c73abf28ffcefd1d8b9c261c8da220a6b1", "message": "Remove protected status for Commandrtoggle#togglePlayer", "committedDate": "2020-06-17T14:43:58Z", "type": "commit"}, {"oid": "c37dd0672036daa0f95f6205b2ac4207a0cf2feb", "url": "https://github.com/EssentialsX/Essentials/commit/c37dd0672036daa0f95f6205b2ac4207a0cf2feb", "message": "Add tab completion for speed command", "committedDate": "2020-06-17T14:54:10Z", "type": "commit"}, {"oid": "52e4620b6b39b72a0571e5a593c74ba317592c07", "url": "https://github.com/EssentialsX/Essentials/commit/52e4620b6b39b72a0571e5a593c74ba317592c07", "message": "Optimize Commandtime command completions", "committedDate": "2020-06-17T14:59:52Z", "type": "commit"}, {"oid": "e87557f9ad7148cf819238c2acc0f24377a09a1f", "url": "https://github.com/EssentialsX/Essentials/commit/e87557f9ad7148cf819238c2acc0f24377a09a1f", "message": "Remove unnecessary console check", "committedDate": "2020-06-17T15:00:40Z", "type": "commit"}, {"oid": "1a81e03bb665fe5aab96050b9dbadd8aab2afc3b", "url": "https://github.com/EssentialsX/Essentials/commit/1a81e03bb665fe5aab96050b9dbadd8aab2afc3b", "message": "Change timeWorldAdd message", "committedDate": "2020-06-17T15:01:34Z", "type": "commit"}, {"oid": "f997a9fe13aa3203e091c64f1ffa7c60f41a4f0c", "url": "https://github.com/EssentialsX/Essentials/commit/f997a9fe13aa3203e091c64f1ffa7c60f41a4f0c", "message": "Update command usages/descriptions in messages.properties", "committedDate": "2020-06-17T15:04:46Z", "type": "commit"}, {"oid": "58f58457fff083e9c6e6bef694389ef502dfa3fa", "url": "https://github.com/EssentialsX/Essentials/commit/58f58457fff083e9c6e6bef694389ef502dfa3fa", "message": "Stupid legacy module doesn't use stupid chat color enum", "committedDate": "2020-06-17T15:05:48Z", "type": "commit"}, {"oid": "d5ea1f36768a8431f967b1ed32211c9cc66d044e", "url": "https://github.com/EssentialsX/Essentials/commit/d5ea1f36768a8431f967b1ed32211c9cc66d044e", "message": "Remove protected status from Commandptime#getAliases", "committedDate": "2020-06-18T00:46:35Z", "type": "commit"}, {"oid": "fd004eb541e60c457287c1dec76750427ba2a911", "url": "https://github.com/EssentialsX/Essentials/commit/fd004eb541e60c457287c1dec76750427ba2a911", "message": "Merge branch '2.x' into feature/command-rewrite\n\n# Conflicts:\n#\tEssentials/src/com/earth2me/essentials/User.java\n#\tEssentials/src/com/earth2me/essentials/commands/Commandback.java\n#\tEssentials/src/com/earth2me/essentials/commands/Commandtogglejail.java\n#\tEssentialsSpawn/src/com/earth2me/essentials/spawn/Commandspawn.java", "committedDate": "2020-06-24T17:41:01Z", "type": "commit"}, {"oid": "a4c37f38a7b9d6e61b8e3efc06e18f558bffef64", "url": "https://github.com/EssentialsX/Essentials/commit/a4c37f38a7b9d6e61b8e3efc06e18f558bffef64", "message": "Merge branch '2.x' into feature/command-rewrite\n\n# Conflicts:\n#\tEssentials/src/com/earth2me/essentials/Essentials.java", "committedDate": "2020-06-24T23:31:19Z", "type": "commit"}, {"oid": "7ae054f8601e4954a0e96fe2c4ad7cea1e14a238", "url": "https://github.com/EssentialsX/Essentials/commit/7ae054f8601e4954a0e96fe2c4ad7cea1e14a238", "message": "Merge branch '2.x' into feature/command-rewrite", "committedDate": "2020-06-27T22:32:42Z", "type": "commit"}, {"oid": "e07399502fefc8cc63ff2678cbaebec6a559ef4c", "url": "https://github.com/EssentialsX/Essentials/commit/e07399502fefc8cc63ff2678cbaebec6a559ef4c", "message": "Merge branch '2.x' into feature/command-rewrite", "committedDate": "2020-07-06T19:33:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODA5MDMwNw==", "url": "https://github.com/EssentialsX/Essentials/pull/3337#discussion_r438090307", "bodyText": "This feels icky. Why move this to CommandSource?", "author": "mdcfe", "createdAt": "2020-06-10T12:42:08Z", "path": "Essentials/src/com/earth2me/essentials/CommandSource.java", "diffHunk": "@@ -22,8 +22,15 @@ public final Player getPlayer() {\n         return null;\n     }\n \n+    public final net.ess3.api.IUser getUser(IEssentials ess) {", "originalCommit": "0d5466205f00f17a435295610618d2a34f135d9a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDQ3NTYzNw==", "url": "https://github.com/EssentialsX/Essentials/pull/3337#discussion_r450475637", "bodyText": "Because ess.getUser(source.getSender()) vs source.getUser(ess)", "author": "JRoy", "createdAt": "2020-07-06T20:56:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODA5MDMwNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDE2OTc4Mw==", "url": "https://github.com/EssentialsX/Essentials/pull/3337#discussion_r440169783", "bodyText": "Might be worth turning this into an EssentialsLoopCommand (see #3087).", "author": "mdcfe", "createdAt": "2020-06-15T13:20:20Z", "path": "Essentials/src/com/earth2me/essentials/commands/Commandpaytoggle.java", "diffHunk": "@@ -20,11 +20,7 @@ public void run(Server server, User user, String commandLabel, String[] args) th\n             acceptingPay = false;\n         }\n         user.setAcceptingPay(acceptingPay);\n-        if (acceptingPay) {\n-            user.sendMessage(tl(\"payToggleOn\"));\n-        } else {\n-            user.sendMessage(tl(\"payToggleOff\"));\n-        }\n+        user.sendMessage(acceptingPay ? tl(\"payToggleOn\") : tl(\"payToggleOff\"));", "originalCommit": "0d5466205f00f17a435295610618d2a34f135d9a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDQ2NTIxNw==", "url": "https://github.com/EssentialsX/Essentials/pull/3337#discussion_r450465217", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private final List<String> types = Arrays.asList(\"walk\", \"fly\", \"1\", \"1.5\", \"1.75\", \"2\");\n          \n          \n            \n                private final List<String> speeds = Arrays.asList(\"1\", \"1.5\", \"1.75\", \"2\");\n          \n          \n            \n                private static final List<String> types = Arrays.asList(\"walk\", \"fly\", \"1\", \"1.5\", \"1.75\", \"2\");\n          \n          \n            \n                private static final List<String> speeds = Arrays.asList(\"1\", \"1.5\", \"1.75\", \"2\");", "author": "mdcfe", "createdAt": "2020-07-06T20:34:57Z", "path": "Essentials/src/com/earth2me/essentials/commands/Commandspeed.java", "diffHunk": "@@ -6,13 +6,17 @@\n import org.bukkit.Server;\n import org.bukkit.entity.Player;\n \n+import java.util.Arrays;\n import java.util.Collections;\n import java.util.List;\n \n import static com.earth2me.essentials.I18n.tl;\n \n \n public class Commandspeed extends EssentialsCommand {\n+    private final List<String> types = Arrays.asList(\"walk\", \"fly\", \"1\", \"1.5\", \"1.75\", \"2\");\n+    private final List<String> speeds = Arrays.asList(\"1\", \"1.5\", \"1.75\", \"2\");", "originalCommit": "e07399502fefc8cc63ff2678cbaebec6a559ef4c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDQ5MjE3NA==", "url": "https://github.com/EssentialsX/Essentials/pull/3337#discussion_r450492174", "bodyText": "I would also suggest using a better range of speeds, such as 1,2,3,4,5 instead of these random decimals", "author": "pop4959", "createdAt": "2020-07-06T21:35:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDQ2NTIxNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDQ5NzA1MQ==", "url": "https://github.com/EssentialsX/Essentials/pull/3337#discussion_r450497051", "bodyText": "or just maybe don't put the numbers lol its kind of weird to suggest specific numbers in general imo", "author": "pop4959", "createdAt": "2020-07-06T21:47:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDQ2NTIxNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDQ2NzYzNw==", "url": "https://github.com/EssentialsX/Essentials/pull/3337#discussion_r450467637", "bodyText": "Comment should probably be improved not just removed", "author": "mdcfe", "createdAt": "2020-07-06T20:40:02Z", "path": "Essentials/src/com/earth2me/essentials/commands/Commandtime.java", "diffHunk": "@@ -14,120 +14,94 @@\n \n \n public class Commandtime extends EssentialsCommand {\n+    private final List<String> subCommands = Arrays.asList(\"add\", \"set\");\n+    private final List<String> timeNames = Arrays.asList(\"sunrise\", \"day\", \"morning\", \"noon\", \"afternoon\", \"sunset\", \"night\", \"midnight\");\n+    private final List<String> timeNumbers = Arrays.asList(\"1000\", \"2000\", \"3000\", \"4000\", \"5000\");\n+\n+\n     public Commandtime() {\n         super(\"time\");\n     }\n \n     @Override\n     public void run(final Server server, final CommandSource sender, final String commandLabel, final String[] args) throws Exception {\n+        long timeTick;\n+        Set<World> worlds;\n         boolean add = false;\n-        final List<String> argList = new ArrayList<>(Arrays.asList(args));\n-        if (argList.remove(\"set\") && !argList.isEmpty() && NumberUtil.isInt(argList.get(0))) {\n-            argList.set(0, argList.get(0) + \"t\");\n-        }\n-        if (argList.remove(\"add\") && !argList.isEmpty() && NumberUtil.isInt(argList.get(0))) {\n-            add = true;\n-            argList.set(0, argList.get(0) + \"t\");\n-        }\n-        final String[] validArgs = argList.toArray(new String[0]);\n-\n-        // Which World(s) are we interested in?\n-        String worldSelector = null;\n-        if (validArgs.length == 2) {\n-            worldSelector = validArgs[1];\n-        }\n-        final Set<World> worlds = getWorlds(server, sender, worldSelector);\n-        final String setTime;\n-\n-        // If no arguments we are reading the time\n-        if (validArgs.length == 0) {\n-            if (commandLabel.equalsIgnoreCase(\"day\") || commandLabel.equalsIgnoreCase(\"eday\")) {\n-                setTime = \"day\";\n-            } else if (commandLabel.equalsIgnoreCase(\"night\") || commandLabel.equalsIgnoreCase(\"enight\")) {\n-                setTime = \"night\";\n+        if (args.length == 0) {\n+            worlds = getWorlds(server, sender, null);\n+            if (commandLabel.endsWith(\"day\") || commandLabel.endsWith(\"night\")) {\n+                timeTick = DescParseTickFormat.parse(commandLabel.toLowerCase(Locale.ENGLISH).replace(\"e\", \"\")); // These are 100% safe things to parse, no need for catching\n             } else {\n                 getWorldsTime(sender, worlds);\n-                throw new NoChargeException();\n+                return;\n+            }\n+        } else if (args.length == 1) {\n+            worlds = getWorlds(server, sender, null);\n+            try {\n+                timeTick = DescParseTickFormat.parse(NumberUtil.isInt(args[0]) ? (args[0] + \"t\") : args[0]);\n+            } catch (NumberFormatException e) {\n+                throw new NotEnoughArgumentsException(e);\n             }\n         } else {\n-            setTime = validArgs[0];\n-        }\n-\n-        final User user = ess.getUser(sender.getPlayer());\n-        if (user != null && !user.isAuthorized(\"essentials.time.set\")) {\n-            throw new Exception(tl(\"timeSetPermission\"));\n-        }\n-\n-        // Parse the target time int ticks from args[0]\n-        long ticks;\n-        try {\n-            ticks = DescParseTickFormat.parse(setTime);\n-        } catch (NumberFormatException e) {\n-            throw new NotEnoughArgumentsException(e);\n-        }\n-\n-        setWorldsTime(sender, worlds, ticks, add);\n-    }\n-\n-    /**\n-     * Used to get the time and inform\n-     */\n-    private void getWorldsTime(final CommandSource sender, final Collection<World> worlds) {\n-        if (worlds.size() == 1) {\n-            final Iterator<World> iter = worlds.iterator();\n-            sender.sendMessage(DescParseTickFormat.format(iter.next().getTime()));\n-            return;\n-        }\n-\n-        for (World world : worlds) {\n-            sender.sendMessage(tl(\"timeWorldCurrent\", world.getName(), DescParseTickFormat.format(world.getTime())));\n+            if (args[0].equalsIgnoreCase(\"set\") || args[0].equalsIgnoreCase(\"add\")) {\n+                try {\n+                    add = args[0].equalsIgnoreCase(\"add\");\n+                    timeTick = DescParseTickFormat.parse(NumberUtil.isInt(args[1]) ? (args[1] + \"t\") : args[1]);\n+                    worlds = getWorlds(server, sender, args.length > 2 ? args[2] : null);\n+                } catch (NumberFormatException e) {\n+                    throw new NotEnoughArgumentsException(e);\n+                }\n+            } else {\n+                try {\n+                    timeTick = DescParseTickFormat.parse(NumberUtil.isInt(args[0]) ? (args[0] + \"t\") : args[0]);\n+                    worlds = getWorlds(server, sender, args[1]);\n+                } catch (NumberFormatException e) {\n+                    throw new NotEnoughArgumentsException(e);\n+                }\n+            }\n         }\n-    }\n \n-    /**\n-     * Used to set the time and inform of the change\n-     */\n-    private void setWorldsTime(final CommandSource sender, final Collection<World> worlds, final long ticks, final boolean add) throws Exception {\n+        // Start updating world times, we have what we need\n         User user = ess.getUser(sender.getPlayer());\n         for (World world : worlds) {\n             if (!canUpdateWorld(user, world)) {\n                 throw new Exception(tl(\"timeSetWorldPermission\", user.getWorld().getName()));\n             }\n         }\n \n-        // Update the time\n+        final StringJoiner joiner = new StringJoiner(\",\");\n         for (World world : worlds) {\n             long time = world.getTime();\n             if (!add) {\n                 time -= time % 24000;\n             }\n-            world.setTime(time + (add ? 0 : 24000) + ticks);\n+            world.setTime(time + (add ? 0 : 24000) + timeTick);\n+            joiner.add(world.getName());\n         }\n \n-        final StringBuilder output = new StringBuilder();\n-        for (World world : worlds) {\n-            if (output.length() > 0) {\n-                output.append(\", \");\n-            }\n+        sender.sendMessage(tl(add ? \"timeWorldAdd\" : \"timeWorldSet\", DescParseTickFormat.formatTicks(timeTick), joiner.toString()));\n+    }\n \n-            output.append(world.getName());\n+    private void getWorldsTime(final CommandSource sender, final Collection<World> worlds) {\n+        if (worlds.size() == 1) {\n+            final Iterator<World> iter = worlds.iterator();\n+            sender.sendMessage(DescParseTickFormat.format(iter.next().getTime()));\n+            return;\n         }\n \n-        sender.sendMessage(tl(\"timeWorldSet\", DescParseTickFormat.format(ticks), output.toString()));\n+        for (World world : worlds) {\n+            sender.sendMessage(tl(\"timeWorldCurrent\", world.getName(), DescParseTickFormat.format(world.getTime())));\n+        }\n     }\n \n-    /**\n-     * Used to parse an argument of the type \"world(s) selector\"\n-     */", "originalCommit": "e07399502fefc8cc63ff2678cbaebec6a559ef4c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDQ3MDIxMw==", "url": "https://github.com/EssentialsX/Essentials/pull/3337#discussion_r450470213", "bodyText": "Should return a list of groups in the permission manager.", "author": "mdcfe", "createdAt": "2020-07-06T20:45:19Z", "path": "EssentialsSpawn/src/com/earth2me/essentials/spawn/Commandsetspawn.java", "diffHunk": "@@ -18,4 +22,9 @@ public void run(final Server server, final User user, final String commandLabel,\n         ((SpawnStorage) module).setSpawn(user.getLocation(), group);\n         user.sendMessage(tl(\"spawnSet\", group));\n     }\n+\n+    @Override\n+    protected List<String> getTabCompleteOptions(Server server, CommandSource sender, String commandLabel, String[] args) {\n+        return Collections.emptyList();", "originalCommit": "e07399502fefc8cc63ff2678cbaebec6a559ef4c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e21692b6db308f37609648a3994bc6bc40208678", "url": "https://github.com/EssentialsX/Essentials/commit/e21692b6db308f37609648a3994bc6bc40208678", "message": "Update Essentials/src/messages.properties\n\nCo-authored-by: MD <1917406+md678685@users.noreply.github.com>", "committedDate": "2020-07-06T20:50:07Z", "type": "commit"}, {"oid": "27ada98fed6cb272e08da1cdb0e0397bb066edfd", "url": "https://github.com/EssentialsX/Essentials/commit/27ada98fed6cb272e08da1cdb0e0397bb066edfd", "message": "Update Essentials/src/plugin.yml\n\nCo-authored-by: MD <1917406+md678685@users.noreply.github.com>", "committedDate": "2020-07-06T20:50:15Z", "type": "commit"}, {"oid": "b569614cea68858fd6a0cbefeff4ed8943f6f185", "url": "https://github.com/EssentialsX/Essentials/commit/b569614cea68858fd6a0cbefeff4ed8943f6f185", "message": "Update Essentials/src/com/earth2me/essentials/commands/Commandspeed.java\n\nCo-authored-by: MD <1917406+md678685@users.noreply.github.com>", "committedDate": "2020-07-06T20:51:28Z", "type": "commit"}, {"oid": "1721469c62252459971b916ffeb55b4308002218", "url": "https://github.com/EssentialsX/Essentials/commit/1721469c62252459971b916ffeb55b4308002218", "message": "Update Essentials/src/messages.properties\n\nCo-authored-by: MD <1917406+md678685@users.noreply.github.com>", "committedDate": "2020-07-06T20:57:59Z", "type": "commit"}, {"oid": "05dfaa7ecbfd23fa5bbbc9b35dce6ca4f28eb512", "url": "https://github.com/EssentialsX/Essentials/commit/05dfaa7ecbfd23fa5bbbc9b35dce6ca4f28eb512", "message": "Comment", "committedDate": "2020-07-06T21:22:02Z", "type": "commit"}, {"oid": "6c01f09b36946d9901b87cb2a46f470f0577314b", "url": "https://github.com/EssentialsX/Essentials/commit/6c01f09b36946d9901b87cb2a46f470f0577314b", "message": "Move paytoggle to ToggleCommand", "committedDate": "2020-07-06T21:53:31Z", "type": "commit"}, {"oid": "51c65ede0a2d682acaaf00e9e6f369caf1dac60f", "url": "https://github.com/EssentialsX/Essentials/commit/51c65ede0a2d682acaaf00e9e6f369caf1dac60f", "message": "Merge branch '2.x' into feature/command-rewrite\n\n# Conflicts:\n#\tEssentials/src/com/earth2me/essentials/Essentials.java\n#\tEssentials/src/com/earth2me/essentials/commands/Commandseen.java", "committedDate": "2020-08-10T03:05:12Z", "type": "commit"}, {"oid": "e1ec9eb3367beea285e7227a0d4caed9a68a23bd", "url": "https://github.com/EssentialsX/Essentials/commit/e1ec9eb3367beea285e7227a0d4caed9a68a23bd", "message": "Fix #3579", "committedDate": "2020-08-10T03:36:49Z", "type": "commit"}]}