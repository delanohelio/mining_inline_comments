{"pr_number": 5839, "pr_title": "Fix request url traceId sometimes shows \"Ignored_Trace\"", "pr_createdAt": "2020-11-13T07:12:53Z", "pr_url": "https://github.com/apache/skywalking/pull/5839", "timeline": [{"oid": "2482a966abc74eb435224393a1029e8ff28db457", "url": "https://github.com/apache/skywalking/commit/2482a966abc74eb435224393a1029e8ff28db457", "message": "Fix request url traceId sometimes shows \"Ignored_Trace\"", "committedDate": "2020-11-13T06:54:55Z", "type": "commit"}, {"oid": "e605db681bd45efb2fadc2544b6338c97082683d", "url": "https://github.com/apache/skywalking/commit/e605db681bd45efb2fadc2544b6338c97082683d", "message": "Merge branch 'master' into huliang-patch-1", "committedDate": "2020-11-13T08:47:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjgwNjkxMg==", "url": "https://github.com/apache/skywalking/pull/5839#discussion_r522806912", "bodyText": "The split should happen in the boot stage, and only do match in the runtime.", "author": "wu-sheng", "createdAt": "2020-11-13T08:48:35Z", "path": "apm-sniffer/apm-agent-core/src/main/java/org/apache/skywalking/apm/agent/core/context/ContextManagerExtendService.java", "diffHunk": "@@ -61,7 +63,7 @@ public AbstractTracerContext createTraceContext(String operationName, boolean fo\n         }\n \n         int suffixIdx = operationName.lastIndexOf(\".\");\n-        if (suffixIdx > -1 && Config.Agent.IGNORE_SUFFIX.contains(operationName.substring(suffixIdx))) {\n+        if (suffixIdx > -1 && Arrays.stream(Config.Agent.IGNORE_SUFFIX.split(\",\")).anyMatch(a -> a.equals(operationName.substring(suffixIdx)))) {", "originalCommit": "e605db681bd45efb2fadc2544b6338c97082683d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "4a84cecba9532606936d86d874161e88e972c243", "url": "https://github.com/apache/skywalking/commit/4a84cecba9532606936d86d874161e88e972c243", "message": "Update ContextManagerExtendService.java", "committedDate": "2020-11-14T06:28:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzQyNDUyNQ==", "url": "https://github.com/apache/skywalking/pull/5839#discussion_r523424525", "bodyText": "Put the initialization process in the boot method, rather than there. It is safer and keeps the initialization sequence more clear.", "author": "wu-sheng", "createdAt": "2020-11-14T14:20:09Z", "path": "apm-sniffer/apm-agent-core/src/main/java/org/apache/skywalking/apm/agent/core/context/ContextManagerExtendService.java", "diffHunk": "@@ -27,8 +27,13 @@\n import org.apache.skywalking.apm.agent.core.remote.GRPCChannelStatus;\n import org.apache.skywalking.apm.agent.core.sampling.SamplingService;\n \n+import java.util.Arrays;\n+\n @DefaultImplementor\n public class ContextManagerExtendService implements BootService, GRPCChannelListener {\n+    \n+    private static String[] IGNORE_SUFFIX_ARRAY = Config.Agent.IGNORE_SUFFIX.split(\",\");", "originalCommit": "4a84cecba9532606936d86d874161e88e972c243", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e6fa03519dc0f7f046d38b57a0ce8baef15dc057", "url": "https://github.com/apache/skywalking/commit/e6fa03519dc0f7f046d38b57a0ce8baef15dc057", "message": "Update ContextManagerExtendService.java\n\nPut the 'IGNORE_SUFFIX_ARRAY' initialization process in the boot method", "committedDate": "2020-11-16T00:42:37Z", "type": "commit"}, {"oid": "abce9c5126d68b3b473ddef05bd62088c16f0f2d", "url": "https://github.com/apache/skywalking/commit/abce9c5126d68b3b473ddef05bd62088c16f0f2d", "message": "Merge branch 'master' into huliang-patch-1", "committedDate": "2020-11-16T00:58:34Z", "type": "commit"}, {"oid": "11612086c3240097740a9436186363bc401f1031", "url": "https://github.com/apache/skywalking/commit/11612086c3240097740a9436186363bc401f1031", "message": "Update ContextManagerExtendServiceTest.java\n\nContextManagerExtendservice through ServiceManager.INSTANCE.findService initialization", "committedDate": "2020-11-16T01:02:38Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzg0Nzc4NA==", "url": "https://github.com/apache/skywalking/pull/5839#discussion_r523847784", "bodyText": "ContextManagerExtendService's instance is controlled by the agent core. This field should not be a static one, like status.", "author": "wu-sheng", "createdAt": "2020-11-16T01:05:41Z", "path": "apm-sniffer/apm-agent-core/src/main/java/org/apache/skywalking/apm/agent/core/context/ContextManagerExtendService.java", "diffHunk": "@@ -27,8 +27,13 @@\n import org.apache.skywalking.apm.agent.core.remote.GRPCChannelStatus;\n import org.apache.skywalking.apm.agent.core.sampling.SamplingService;\n \n+import java.util.Arrays;\n+\n @DefaultImplementor\n public class ContextManagerExtendService implements BootService, GRPCChannelListener {\n+    \n+    private static String[] IGNORE_SUFFIX_ARRAY = new String[0];", "originalCommit": "11612086c3240097740a9436186363bc401f1031", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "21c1d5ed3b04792ac367ab5b148aaf5b7429e684", "url": "https://github.com/apache/skywalking/commit/21c1d5ed3b04792ac367ab5b148aaf5b7429e684", "message": "Update ContextManagerExtendService.java\n\nIGNORE_SUFFIX_ARRAY field Change to non static", "committedDate": "2020-11-16T01:10:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzg0OTE0MQ==", "url": "https://github.com/apache/skywalking/pull/5839#discussion_r523849141", "bodyText": "Compiling local, this name format would not pass the CI, because of the format.", "author": "wu-sheng", "createdAt": "2020-11-16T01:13:18Z", "path": "apm-sniffer/apm-agent-core/src/main/java/org/apache/skywalking/apm/agent/core/context/ContextManagerExtendService.java", "diffHunk": "@@ -27,8 +27,13 @@\n import org.apache.skywalking.apm.agent.core.remote.GRPCChannelStatus;\n import org.apache.skywalking.apm.agent.core.sampling.SamplingService;\n \n+import java.util.Arrays;\n+\n @DefaultImplementor\n public class ContextManagerExtendService implements BootService, GRPCChannelListener {\n+    \n+    private String[] IGNORE_SUFFIX_ARRAY = new String[0];", "originalCommit": "21c1d5ed3b04792ac367ab5b148aaf5b7429e684", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "86247284264f1b7fb7f5ca60af047f787d27e141", "url": "https://github.com/apache/skywalking/commit/86247284264f1b7fb7f5ca60af047f787d27e141", "message": "Update CHANGES.md", "committedDate": "2020-11-16T01:19:39Z", "type": "commit"}, {"oid": "930074e4ba24018834991b62514e2874cb38f2ce", "url": "https://github.com/apache/skywalking/commit/930074e4ba24018834991b62514e2874cb38f2ce", "message": "Update ContextManagerExtendService.java\n\nIGNORE_SUFFIX_ARRAY field rename to ignoreSuffixArray", "committedDate": "2020-11-16T01:20:26Z", "type": "commit"}]}