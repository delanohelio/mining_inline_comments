{"pr_number": 5147, "pr_title": "support jetty server advanced configuration.", "pr_createdAt": "2020-07-22T07:51:44Z", "pr_url": "https://github.com/apache/skywalking/pull/5147", "timeline": [{"oid": "fa369c3825eb963c0705ba6f6d3952a2b3d56e7d", "url": "https://github.com/apache/skywalking/commit/fa369c3825eb963c0705ba6f6d3952a2b3d56e7d", "message": "support jetty custom advanced configuration.", "committedDate": "2020-07-22T07:50:10Z", "type": "commit"}, {"oid": "d4d9bac3ad23ee91b735e15cb5df347a842cf80f", "url": "https://github.com/apache/skywalking/commit/d4d9bac3ad23ee91b735e15cb5df347a842cf80f", "message": "fix ci.", "committedDate": "2020-07-23T01:47:44Z", "type": "commit"}, {"oid": "38edd901a7b390a79b73b89f0331e448d7169093", "url": "https://github.com/apache/skywalking/commit/38edd901a7b390a79b73b89f0331e448d7169093", "message": "Merge branch 'master' into jetty_config", "committedDate": "2020-07-23T03:26:56Z", "type": "commit"}, {"oid": "a1748b9f389f1b98fd8e9b34fb8fb7427b6e16b0", "url": "https://github.com/apache/skywalking/commit/a1748b9f389f1b98fd8e9b34fb8fb7427b6e16b0", "message": "update docs.", "committedDate": "2020-07-23T05:18:32Z", "type": "commit"}, {"oid": "a13a6956d3f6eb235284b2290013cd5720ec07d8", "url": "https://github.com/apache/skywalking/commit/a13a6956d3f6eb235284b2290013cd5720ec07d8", "message": "Merge branch 'master' into jetty_config", "committedDate": "2020-07-23T12:32:05Z", "type": "commit"}, {"oid": "177ef9bcdea02c9e1c6672f1b03a92794271c908", "url": "https://github.com/apache/skywalking/commit/177ef9bcdea02c9e1c6672f1b03a92794271c908", "message": "Merge branch 'master' into jetty_config", "committedDate": "2020-07-24T12:10:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDE0MjA5Ng==", "url": "https://github.com/apache/skywalking/pull/5147#discussion_r460142096", "bodyText": "Can you explain more about this, the original logic is initializing JettyServer when config.getRestPort() != 0, but after your changes, JettyServer is always initialized, is it expected?", "author": "kezhenxu94", "createdAt": "2020-07-24T15:56:24Z", "path": "oap-server/server-receiver-plugin/skywalking-sharing-server-plugin/src/main/java/org/apache/skywalking/oap/server/receiver/sharing/server/SharingServerModuleProvider.java", "diffHunk": "@@ -67,26 +68,38 @@ public ModuleConfig createConfigBeanIfAbsent() {\n \n     @Override\n     public void prepare() {\n-        if (config.getRestPort() != 0) {\n-            jettyServer = new JettyServer(Strings.isBlank(config.getRestHost()) ? \"0.0.0.0\" : config.getRestHost(), config\n-                .getRestPort(), config.getRestContextPath());\n-            jettyServer.initialize();\n-\n-            this.registerServiceImplementation(JettyHandlerRegister.class, new JettyHandlerRegisterImpl(jettyServer));\n-        } else {\n-            this.receiverJettyHandlerRegister = new ReceiverJettyHandlerRegister();\n-            this.registerServiceImplementation(JettyHandlerRegister.class, receiverJettyHandlerRegister);\n+        JettyServerConfig jettyServerConfig = JettyServerConfig.builder()\n+                                                               .host(config.getHost()).port(config.getPort())\n+                                                               .contextPath(config.getContextPath())\n+                                                               .jettyMinThreads(config.getJettyMinThreads())\n+                                                               .jettyMaxThreads(config.getJettyMaxThreads())\n+                                                               .jettyAcceptQueueSize(config.getJettyAcceptQueueSize())\n+                                                               .jettyAcceptorPriorityDelta(config.getJettyAcceptorPriorityDelta())\n+                                                               .jettyIdleTimeOut(config.getJettyIdleTimeOut()).build();\n+\n+        if (config.getPort() != 0) {\n+            jettyServerConfig.setHost(Strings.isBlank(config.getHost()) ? \"0.0.0.0\" : config.getHost());\n+            jettyServerConfig.setPort(config.getPort());\n+            jettyServerConfig.setContextPath(config.getContextPath());\n         }\n+        jettyServer = new JettyServer(jettyServerConfig);\n+        jettyServer.initialize();", "originalCommit": "177ef9bcdea02c9e1c6672f1b03a92794271c908", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDMyNzc1MA==", "url": "https://github.com/apache/skywalking/pull/5147#discussion_r460327750", "bodyText": "The logic should not be changed. Once port is invalid, the jetty server should not be activated.", "author": "wu-sheng", "createdAt": "2020-07-24T23:23:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDE0MjA5Ng=="}], "type": "inlineReview"}, {"oid": "6b7b2a105d21d0139160c5507e781a6a42a3f4af", "url": "https://github.com/apache/skywalking/commit/6b7b2a105d21d0139160c5507e781a6a42a3f4af", "message": "fix jetty server init logical.", "committedDate": "2020-07-25T01:20:00Z", "type": "commit"}, {"oid": "7a27ec215c58e1e6de9d8e29d1af96fdc59dc396", "url": "https://github.com/apache/skywalking/commit/7a27ec215c58e1e6de9d8e29d1af96fdc59dc396", "message": "Merge branch 'master' into jetty_config", "committedDate": "2020-07-25T01:21:18Z", "type": "commit"}, {"oid": "b1d860ed9a2b1d417f341940c864990d3de2d7d1", "url": "https://github.com/apache/skywalking/commit/b1d860ed9a2b1d417f341940c864990d3de2d7d1", "message": "Merge branch 'master' into jetty_config", "committedDate": "2020-07-25T05:00:56Z", "type": "commit"}]}