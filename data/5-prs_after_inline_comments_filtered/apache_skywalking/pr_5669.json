{"pr_number": 5669, "pr_title": "Support Nacos auth", "pr_createdAt": "2020-10-15T06:16:55Z", "pr_url": "https://github.com/apache/skywalking/pull/5669", "timeline": [{"oid": "fdc68379775946b0fd77de2dd8a17a7fd22192c7", "url": "https://github.com/apache/skywalking/commit/fdc68379775946b0fd77de2dd8a17a7fd22192c7", "message": "Support Nacos auth", "committedDate": "2020-10-15T06:14:40Z", "type": "commit"}, {"oid": "7c4a9b53a6d90d587efbda3ff3ac98d0a756d564", "url": "https://github.com/apache/skywalking/commit/7c4a9b53a6d90d587efbda3ff3ac98d0a756d564", "message": "update nacos configuration", "committedDate": "2020-10-15T07:34:59Z", "type": "commit"}, {"oid": "fd789fa82c15a061655f30fd3b318e5aad7ee953", "url": "https://github.com/apache/skywalking/commit/fd789fa82c15a061655f30fd3b318e5aad7ee953", "message": "Test nacos with default username nacos", "committedDate": "2020-10-15T15:54:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTk0NDIwOQ==", "url": "https://github.com/apache/skywalking/pull/5669#discussion_r505944209", "bodyText": "Should be else if?", "author": "wu-sheng", "createdAt": "2020-10-16T00:47:12Z", "path": "oap-server/server-cluster-plugin/cluster-nacos-plugin/src/main/java/org/apache/skywalking/oap/server/cluster/plugin/nacos/ClusterModuleNacosProvider.java", "diffHunk": "@@ -63,6 +65,17 @@ public void prepare() throws ServiceNotProvidedException, ModuleStartException {\n             Properties properties = new Properties();\n             properties.put(PropertyKeyConst.SERVER_ADDR, config.getHostPort());\n             properties.put(PropertyKeyConst.NAMESPACE, config.getNamespace());\n+            if (StringUtil.isNotEmpty(config.getUsername()) && StringUtil.isNotEmpty(config.getAccessKey())) {\n+                throw new ModuleStartException(\"Nacos Auth method should choose either username or accessKey, not both\");\n+            }\n+            if (StringUtil.isNotEmpty(config.getUsername())) {\n+                properties.put(PropertyKeyConst.USERNAME, config.getUsername());\n+                properties.put(PropertyKeyConst.PASSWORD, config.getPassword());\n+            }\n+            if (StringUtil.isNotEmpty(config.getAccessKey())) {", "originalCommit": "fd789fa82c15a061655f30fd3b318e5aad7ee953", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjAwODAxOQ==", "url": "https://github.com/apache/skywalking/pull/5669#discussion_r506008019", "bodyText": "done", "author": "xbkaishui", "createdAt": "2020-10-16T02:51:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTk0NDIwOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTk0NDI0NQ==", "url": "https://github.com/apache/skywalking/pull/5669#discussion_r505944245", "bodyText": "Should be else if?", "author": "wu-sheng", "createdAt": "2020-10-16T00:47:17Z", "path": "oap-server/server-configuration/configuration-nacos/src/main/java/org/apache/skywalking/oap/server/configuration/nacos/NacosConfigWatcherRegister.java", "diffHunk": "@@ -56,6 +58,14 @@ public NacosConfigWatcherRegister(NacosServerSettings settings) throws NacosExce\n         final Properties properties = new Properties();\n         properties.put(PropertyKeyConst.SERVER_ADDR, serverAddr + \":\" + port);\n         properties.put(PropertyKeyConst.NAMESPACE, settings.getNamespace());\n+        if (StringUtil.isNotEmpty(settings.getUsername())) {\n+            properties.put(PropertyKeyConst.USERNAME, settings.getUsername());\n+            properties.put(PropertyKeyConst.PASSWORD, settings.getPassword());\n+        }\n+        if (StringUtil.isNotEmpty(settings.getAccessKey())) {", "originalCommit": "fd789fa82c15a061655f30fd3b318e5aad7ee953", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjAwODEyNA==", "url": "https://github.com/apache/skywalking/pull/5669#discussion_r506008124", "bodyText": "done", "author": "xbkaishui", "createdAt": "2020-10-16T02:52:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTk0NDI0NQ=="}], "type": "inlineReview"}, {"oid": "855d24423f0c526aeb68fe6e204e7572cea4708a", "url": "https://github.com/apache/skywalking/commit/855d24423f0c526aeb68fe6e204e7572cea4708a", "message": "Merge branch 'master' into Nacos-support-auth", "committedDate": "2020-10-16T00:47:42Z", "type": "commit"}, {"oid": "7df85a51aaaae2a2f8930837b31da05ad97c5a6f", "url": "https://github.com/apache/skywalking/commit/7df85a51aaaae2a2f8930837b31da05ad97c5a6f", "message": "Refactor change as cr", "committedDate": "2020-10-16T02:50:33Z", "type": "commit"}, {"oid": "38162789bff1aa369a7f40ab47aebbed9d0366ad", "url": "https://github.com/apache/skywalking/commit/38162789bff1aa369a7f40ab47aebbed9d0366ad", "message": "Merge remote-tracking branch 'upstream/Nacos-support-auth' into Nacos-support-auth", "committedDate": "2020-10-16T02:51:05Z", "type": "commit"}, {"oid": "8538c715ea0f8fe5ee94e22854741464861c0312", "url": "https://github.com/apache/skywalking/commit/8538c715ea0f8fe5ee94e22854741464861c0312", "message": "Merge branch 'master' into Nacos-support-auth", "committedDate": "2020-10-16T05:51:08Z", "type": "commit"}]}