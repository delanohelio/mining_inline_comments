{"pr_number": 5915, "pr_title": "Make meter receiver support MAL", "pr_createdAt": "2020-11-27T09:37:40Z", "pr_url": "https://github.com/apache/skywalking/pull/5915", "timeline": [{"oid": "444a798b95d6d2039366973cc927d422c692bb1e", "url": "https://github.com/apache/skywalking/commit/444a798b95d6d2039366973cc927d422c692bb1e", "message": "Make meter receiver support MAL", "committedDate": "2020-11-26T03:59:24Z", "type": "commit"}, {"oid": "f24695314fccad330f542967ff6d2006c8407fa6", "url": "https://github.com/apache/skywalking/commit/f24695314fccad330f542967ff6d2006c8407fa6", "message": "Add default time unit", "committedDate": "2020-11-27T03:54:04Z", "type": "commit"}, {"oid": "a52d6a56384d9d077661b5587386b2a0f4335515", "url": "https://github.com/apache/skywalking/commit/a52d6a56384d9d077661b5587386b2a0f4335515", "message": "Merge master", "committedDate": "2020-11-27T04:19:19Z", "type": "commit"}, {"oid": "edd9df4ffca53f982594920298741e46e50278b0", "url": "https://github.com/apache/skywalking/commit/edd9df4ffca53f982594920298741e46e50278b0", "message": "Adapt the new metrics rules", "committedDate": "2020-11-27T07:41:22Z", "type": "commit"}, {"oid": "8badff06c1e5a2ae01af93d868ac9a641e7fa6d0", "url": "https://github.com/apache/skywalking/commit/8badff06c1e5a2ae01af93d868ac9a641e7fa6d0", "message": "Merge remote-tracking branch 'upstream/master' into agent-side-meter-support-mal", "committedDate": "2020-11-27T08:29:54Z", "type": "commit"}, {"oid": "01a33ac8cb97b7cf073196b7d8da3427a7e6ffdf", "url": "https://github.com/apache/skywalking/commit/01a33ac8cb97b7cf073196b7d8da3427a7e6ffdf", "message": "Fix submodule HEAD", "committedDate": "2020-11-27T08:35:04Z", "type": "commit"}, {"oid": "25087a1c5109b1286fdf8c639a11c608fa39fd8a", "url": "https://github.com/apache/skywalking/commit/25087a1c5109b1286fdf8c639a11c608fa39fd8a", "message": "Change protocol HEAD", "committedDate": "2020-11-27T09:26:49Z", "type": "commit"}, {"oid": "452f7a75f3b85f6c82c997b7b8d822902b9b9fc4", "url": "https://github.com/apache/skywalking/commit/452f7a75f3b85f6c82c997b7b8d822902b9b9fc4", "message": "Rollback project required maven version", "committedDate": "2020-11-27T09:29:52Z", "type": "commit"}, {"oid": "2e5d257d4d5512f1caa56da69a0d0a2bb9e4c7fd", "url": "https://github.com/apache/skywalking/commit/2e5d257d4d5512f1caa56da69a0d0a2bb9e4c7fd", "message": "Merge branch 'master' into agent-side-meter-support-mal", "committedDate": "2020-11-27T09:37:54Z", "type": "commit"}, {"oid": "268e4c333b4b0a8df559a427e1f3b47b49ce7d2d", "url": "https://github.com/apache/skywalking/commit/268e4c333b4b0a8df559a427e1f3b47b49ce7d2d", "message": "Fix getting rules error", "committedDate": "2020-11-27T12:23:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTgxMjM2Nw==", "url": "https://github.com/apache/skywalking/pull/5915#discussion_r531812367", "bodyText": "From https://en.wikipedia.org/wiki/Histogram#Mathematical_definition, there are two types of histogram bin:\n\nCumulative: prometheus, otel.\nOrdinary: agent meter.\n\nLet's provide two functions to set it, and defaults to cumulative.", "author": "hanahmily", "createdAt": "2020-11-28T00:23:46Z", "path": "oap-server/analyzer/meter-analyzer/src/main/java/org/apache/skywalking/oap/meter/analyzer/dsl/SampleFamily.java", "diffHunk": "@@ -233,12 +234,29 @@ public SampleFamily tag(Closure<?> cl) {\n         }).toArray(Sample[]::new));\n     }\n \n+    /**\n+     * Ignore histogram decrease bucket value, at agent side meter, need to ignore decrease histogram bucket value\n+     */\n+    public SampleFamily ignoreHistogramDecrease() {", "originalCommit": "268e4c333b4b0a8df559a427e1f3b47b49ce7d2d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTgxMzU2OA==", "url": "https://github.com/apache/skywalking/pull/5915#discussion_r531813568", "bodyText": "What I mean is histogramDecrease is not clear and very confusing to ppl. Let's opt for the notions that is well-known for ppl.", "author": "hanahmily", "createdAt": "2020-11-28T00:35:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTgxMjM2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjAyNTY0OQ==", "url": "https://github.com/apache/skywalking/pull/5915#discussion_r532025649", "bodyText": "Created HistogramType enum to adapt this.", "author": "mrproliu", "createdAt": "2020-11-28T10:48:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTgxMjM2Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTgxMjg3Nw==", "url": "https://github.com/apache/skywalking/pull/5915#discussion_r531812877", "bodyText": "My preference is to add a new factory to build SampleFamily with those two settings. If we define functions in SampleFamily, that means end-users could access them, that will cause some potential issues.\nand they represent the different behaviors of the eco-system, I don't find any reason to access them in a MAL expression.", "author": "hanahmily", "createdAt": "2020-11-28T00:27:57Z", "path": "oap-server/analyzer/meter-analyzer/src/main/java/org/apache/skywalking/oap/meter/analyzer/dsl/SampleFamily.java", "diffHunk": "@@ -233,12 +234,29 @@ public SampleFamily tag(Closure<?> cl) {\n         }).toArray(Sample[]::new));\n     }\n \n+    /**\n+     * Ignore histogram decrease bucket value, at agent side meter, need to ignore decrease histogram bucket value\n+     */\n+    public SampleFamily ignoreHistogramDecrease() {\n+        this.context.ignoreHistogramDecrease = true;\n+        return this;\n+    }\n+\n+    /**\n+     * Change default histogram bucket value unit,\n+     * use second on the Prometheus, use millisecond on the meter side meter\n+     */\n+    public SampleFamily defaultHistogramBucketUnit(TimeUnit unit) {", "originalCommit": "268e4c333b4b0a8df559a427e1f3b47b49ce7d2d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjAyNTczOQ==", "url": "https://github.com/apache/skywalking/pull/5915#discussion_r532025739", "bodyText": "Have created SampleFactoryBuilder to help create SampleFactory with these two settings.", "author": "mrproliu", "createdAt": "2020-11-28T10:49:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTgxMjg3Nw=="}], "type": "inlineReview"}, {"oid": "9bcd5efb234cabba5aa923d938b6e25ee224f1af", "url": "https://github.com/apache/skywalking/commit/9bcd5efb234cabba5aa923d938b6e25ee224f1af", "message": "Fix sleuth missing config", "committedDate": "2020-11-28T05:00:24Z", "type": "commit"}, {"oid": "7e3364069e4085c20e1f8cb64badc85f5d3362b5", "url": "https://github.com/apache/skywalking/commit/7e3364069e4085c20e1f8cb64badc85f5d3362b5", "message": "Using Builder mode to create SampleFamily", "committedDate": "2020-11-28T10:47:14Z", "type": "commit"}, {"oid": "53f3b49d0501dc00345a471916df324bc1838c73", "url": "https://github.com/apache/skywalking/commit/53f3b49d0501dc00345a471916df324bc1838c73", "message": "Merge branch 'master' into agent-side-meter-support-mal", "committedDate": "2020-11-28T10:49:57Z", "type": "commit"}, {"oid": "6c04457b5ad43045f0e3af932eab8e63f9234146", "url": "https://github.com/apache/skywalking/commit/6c04457b5ad43045f0e3af932eab8e63f9234146", "message": "Merge branch 'master' into agent-side-meter-support-mal", "committedDate": "2020-11-29T15:18:43Z", "type": "commit"}, {"oid": "23ca2915f03aeea2176cdc86320e11a500fdfe60", "url": "https://github.com/apache/skywalking/commit/23ca2915f03aeea2176cdc86320e11a500fdfe60", "message": "Update CHANGES.md", "committedDate": "2020-11-30T05:27:24Z", "type": "commit"}]}