{"pr_number": 5509, "pr_title": "Fix slack nullpointer issue ", "pr_createdAt": "2020-09-17T08:33:36Z", "pr_url": "https://github.com/apache/skywalking/pull/5509", "timeline": [{"oid": "c2cfe3c497383b8eac09395b5c4d50e7b2ec7a63", "url": "https://github.com/apache/skywalking/commit/c2cfe3c497383b8eac09395b5c4d50e7b2ec7a63", "message": "Fix null pointer bug, format log message", "committedDate": "2020-09-17T08:30:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDA3MDk1Mg==", "url": "https://github.com/apache/skywalking/pull/5509#discussion_r490070952", "bodyText": "Actually, I think this should not change, but wechat callback should be changed.\nTake a look on the source codes\npublic void error(Marker marker, String format, Object arg);\n\npublic void error(String msg, Throwable t);\n\nIf you want to print exception stack, then can't use the arguments for log text.", "author": "wu-sheng", "createdAt": "2020-09-17T08:38:15Z", "path": "oap-server/server-alarm-plugin/src/main/java/org/apache/skywalking/oap/server/core/alarm/provider/slack/SlackhookCallback.java", "diffHunk": "@@ -77,31 +77,26 @@ public void doAlarm(List<AlarmMessage> alarmMessages) {\n \n                 StringEntity entity;\n                 try {\n-\n                     JsonObject jsonObject = new JsonObject();\n                     JsonArray jsonElements = new JsonArray();\n-\n                     alarmMessages.forEach(item -> {\n                         jsonElements.add(GSON.fromJson(\n                             String.format(\n                                 this.alarmRulesWatcher.getSlackSettings().getTextTemplate(), item.getAlarmMessage()\n                             ), JsonObject.class));\n                     });\n-\n                     jsonObject.add(\"blocks\", jsonElements);\n-\n                     entity = new StringEntity(GSON.toJson(jsonObject), ContentType.APPLICATION_JSON);\n-\n                     post.setEntity(entity);\n                     CloseableHttpResponse httpResponse = httpClient.execute(post);\n                     StatusLine statusLine = httpResponse.getStatusLine();\n                     if (statusLine != null && statusLine.getStatusCode() != HttpStatus.SC_OK) {\n-                        log.error(\"send alarm to \" + url + \" failure. Response code: \" + statusLine.getStatusCode());\n+                        log.error(\"Send slack alarm to {} failure. Response code: {}\", url , statusLine.getStatusCode());\n                     }\n                 } catch (UnsupportedEncodingException e) {\n-                    log.error(\"Alarm to JSON error, \" + e.getMessage(), e);\n+                    log.error(\"Alarm to JSON error, {} \", e.getMessage(), e);\n                 } catch (IOException e) {\n-                    log.error(\"send alarm to \" + url + \" failure.\", e);\n+                    log.error(\"Send slack alarm to {} failure.\", url , e);", "originalCommit": "c2cfe3c497383b8eac09395b5c4d50e7b2ec7a63", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDA3NjQxMw==", "url": "https://github.com/apache/skywalking/pull/5509#discussion_r490076413", "bodyText": "I don't think so , actually It will match   this method   public void error(String format, Object arg1, Object arg2),\nplease check below simple test\n  @Test\n    public void testLog() {\n        try {\n            int a = 1 / 0;\n        } catch (Throwable e) {\n            log.error(\"aha err {}\", \"formated error\", e);\n        }\n    }\n\nlogs as belows ........\n\n\n      2020-09-17 16:45:52.749  LogTest.java:22\n      - aha err formated error\n\njava.lang.ArithmeticException: / by zero\n\tat com.credigo.czs.service.LogTest.testLog(LogTest.java:20) ~[test-classes/:?]\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:1.8.0_231]\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[?:1.8.0_231]\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:1.8.0_231]\n\tat java.lang.reflect.Method.invoke(Method.java:498) ~[?:1.8.0_231]\n\tat org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50) ~[junit-4.12.jar:4.12]\n\tat org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12) ~[junit-4.12.jar:4.12]\n\tat org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:47) ~[junit-4.12.jar:4.12]", "author": "xbkaishui", "createdAt": "2020-09-17T08:46:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDA3MDk1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDA4MzI3OA==", "url": "https://github.com/apache/skywalking/pull/5509#discussion_r490083278", "bodyText": "Thanks for the demo codes. Interesting, the comments of methods are not consistent.", "author": "wu-sheng", "createdAt": "2020-09-17T08:57:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDA3MDk1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDA4ODUxNw==", "url": "https://github.com/apache/skywalking/pull/5509#discussion_r490088517", "bodyText": "please check this", "author": "xbkaishui", "createdAt": "2020-09-17T09:05:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDA3MDk1Mg=="}], "type": "inlineReview"}, {"oid": "e1f02f1b9db2e627338f1c4f137423b59f207338", "url": "https://github.com/apache/skywalking/commit/e1f02f1b9db2e627338f1c4f137423b59f207338", "message": "Merge branch 'master' into fix-slack-issue", "committedDate": "2020-09-17T08:57:21Z", "type": "commit"}]}