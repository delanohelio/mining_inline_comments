{"pr_number": 4470, "pr_title": "Enable OAP gRPC SSL transportation", "pr_createdAt": "2020-03-09T09:14:50Z", "pr_url": "https://github.com/apache/skywalking/pull/4470", "timeline": [{"oid": "156196dd8ef3ef432f8e849a9f828e235a6a9b82", "url": "https://github.com/apache/skywalking/commit/156196dd8ef3ef432f8e849a9f828e235a6a9b82", "message": "Enable OAP gRPC SSL transportation\n\nPorting to OpenSSL to enable SSL transportation. The server private\nkey is in the format of PCKS#8, certificates is x509 though.\n\nSigned-off-by: Gao Hongtao <hanahmily@gmail.com>", "committedDate": "2020-03-09T09:07:19Z", "type": "commit"}, {"oid": "52764bf5577f35691894a397155f569a297f2d68", "url": "https://github.com/apache/skywalking/commit/52764bf5577f35691894a397155f569a297f2d68", "message": "Merge branch 'master' into oap-ssl", "committedDate": "2020-03-09T09:15:17Z", "type": "commit"}, {"oid": "dd44c374665a7fde124a62f312cac126ce1b84d6", "url": "https://github.com/apache/skywalking/commit/dd44c374665a7fde124a62f312cac126ce1b84d6", "message": "Add netty-tcnative-boringssl-static 2.0.26 licnese\n\nSigned-off-by: Gao Hongtao <hanahmily@gmail.com>", "committedDate": "2020-03-09T10:15:22Z", "type": "commit"}, {"oid": "8fe58ddaad0a92e060776c65a2f69e0556800904", "url": "https://github.com/apache/skywalking/commit/8fe58ddaad0a92e060776c65a2f69e0556800904", "message": "Merge branch 'oap-ssl' of https://github.com/apache/skywalking into oap-ssl", "committedDate": "2020-03-09T10:16:25Z", "type": "commit"}, {"oid": "3c7e837bb53a6754c8824d46fff2fa0a9ff48808", "url": "https://github.com/apache/skywalking/commit/3c7e837bb53a6754c8824d46fff2fa0a9ff48808", "message": "Merge branch 'master' into oap-ssl", "committedDate": "2020-03-09T12:50:16Z", "type": "commit"}, {"oid": "afcd4443ed44bb989703e9eb6e89ecb46e3a22c6", "url": "https://github.com/apache/skywalking/commit/afcd4443ed44bb989703e9eb6e89ecb46e3a22c6", "message": "Update docs/en/setup/backend/grpc-ssl.md\n\nCo-Authored-By: kezhenxu94 <kezhenxu94@apache.org>", "committedDate": "2020-03-09T14:29:24Z", "type": "commit"}, {"oid": "f4994b152ef3767bbed7d8974925a83937f329b4", "url": "https://github.com/apache/skywalking/commit/f4994b152ef3767bbed7d8974925a83937f329b4", "message": "Update docs/en/setup/backend/grpc-ssl.md\n\nCo-Authored-By: kezhenxu94 <kezhenxu94@apache.org>", "committedDate": "2020-03-09T14:29:35Z", "type": "commit"}, {"oid": "590cfdbd342a40f7f9752837b2fe058d4124997a", "url": "https://github.com/apache/skywalking/commit/590cfdbd342a40f7f9752837b2fe058d4124997a", "message": "Merge branch 'master' into oap-ssl", "committedDate": "2020-03-10T00:00:23Z", "type": "commit"}, {"oid": "d61abf2c3a7a70a7f0ac812ff568d731a6f3823b", "url": "https://github.com/apache/skywalking/commit/d61abf2c3a7a70a7f0ac812ff568d731a6f3823b", "message": "Add SSL to grpc remote client and sharing server\n\nSigned-off-by: Gao Hongtao <hanahmily@gmail.com>", "committedDate": "2020-03-10T06:34:07Z", "type": "commit"}, {"oid": "9ab4a2ebf7abfd58fba74504f20d6492e621ba13", "url": "https://github.com/apache/skywalking/commit/9ab4a2ebf7abfd58fba74504f20d6492e621ba13", "message": "Merge branch 'oap-ssl' of https://github.com/apache/skywalking into oap-ssl", "committedDate": "2020-03-10T06:34:24Z", "type": "commit"}, {"oid": "c6d1192c9655a952dfea487b8ac49d8aecb7439e", "url": "https://github.com/apache/skywalking/commit/c6d1192c9655a952dfea487b8ac49d8aecb7439e", "message": "Update documents\n\nSigned-off-by: Gao Hongtao <hanahmily@gmail.com>", "committedDate": "2020-03-10T06:57:40Z", "type": "commit"}, {"oid": "4b16f36b19987df81de07463bc1e62eb10e9d7f6", "url": "https://github.com/apache/skywalking/commit/4b16f36b19987df81de07463bc1e62eb10e9d7f6", "message": "Fix nits\n\nSigned-off-by: Gao Hongtao <hanahmily@gmail.com>", "committedDate": "2020-03-10T07:02:44Z", "type": "commit"}, {"oid": "ae97361e371108b7bdfbf32d470a1277812ba9f0", "url": "https://github.com/apache/skywalking/commit/ae97361e371108b7bdfbf32d470a1277812ba9f0", "message": "Fix test case\n\nSigned-off-by: Gao Hongtao <hanahmily@gmail.com>", "committedDate": "2020-03-10T14:07:47Z", "type": "commit"}, {"oid": "ae97361e371108b7bdfbf32d470a1277812ba9f0", "url": "https://github.com/apache/skywalking/commit/ae97361e371108b7bdfbf32d470a1277812ba9f0", "message": "Fix test case\n\nSigned-off-by: Gao Hongtao <hanahmily@gmail.com>", "committedDate": "2020-03-10T14:07:47Z", "type": "forcePushed"}, {"oid": "83f5ad24198f38692983fa6b701f73a2c7378eae", "url": "https://github.com/apache/skywalking/commit/83f5ad24198f38692983fa6b701f73a2c7378eae", "message": "Merge branch 'master' into oap-ssl", "committedDate": "2020-03-10T14:32:55Z", "type": "commit"}, {"oid": "13b389af09396c0a6694576c63c4864d6fa2e44a", "url": "https://github.com/apache/skywalking/commit/13b389af09396c0a6694576c63c4864d6fa2e44a", "message": "Add e2e-ssl and remove other test cases temporarily\n\nSigned-off-by: Gao Hongtao <hanahmily@gmail.com>", "committedDate": "2020-03-10T15:12:36Z", "type": "commit"}, {"oid": "8019a9933a4ba612057c4be0669ca58f361b69c8", "url": "https://github.com/apache/skywalking/commit/8019a9933a4ba612057c4be0669ca58f361b69c8", "message": "Merge branch 'oap-ssl' of https://github.com/apache/skywalking into oap-ssl", "committedDate": "2020-03-10T15:13:52Z", "type": "commit"}, {"oid": "bd6b9510074675478bf0a6d136206371c0339ce0", "url": "https://github.com/apache/skywalking/commit/bd6b9510074675478bf0a6d136206371c0339ce0", "message": "Add TLS relevant files\n\nSigned-off-by: Gao Hongtao <hanahmily@gmail.com>", "committedDate": "2020-03-11T04:40:40Z", "type": "commit"}, {"oid": "e3c0dc172232addee17501fc4a048c363b96ad97", "url": "https://github.com/apache/skywalking/commit/e3c0dc172232addee17501fc4a048c363b96ad97", "message": "Decrease timeout\n\nSigned-off-by: Gao Hongtao <hanahmily@gmail.com>", "committedDate": "2020-03-11T05:00:58Z", "type": "commit"}, {"oid": "da893402b5f451abd973077079740d77b859fd15", "url": "https://github.com/apache/skywalking/commit/da893402b5f451abd973077079740d77b859fd15", "message": "Test config works\n\nSigned-off-by: Gao Hongtao <hanahmily@gmail.com>", "committedDate": "2020-03-11T06:18:25Z", "type": "commit"}, {"oid": "da893402b5f451abd973077079740d77b859fd15", "url": "https://github.com/apache/skywalking/commit/da893402b5f451abd973077079740d77b859fd15", "message": "Test config works\n\nSigned-off-by: Gao Hongtao <hanahmily@gmail.com>", "committedDate": "2020-03-11T06:18:25Z", "type": "forcePushed"}, {"oid": "26501fe87dab026a3353a779081c2b2574bfcf1e", "url": "https://github.com/apache/skywalking/commit/26501fe87dab026a3353a779081c2b2574bfcf1e", "message": "triger CI on oap-ssl branch", "committedDate": "2020-03-11T06:23:44Z", "type": "commit"}, {"oid": "ad735b280530aa4872eb51394a10d808e01ff447", "url": "https://github.com/apache/skywalking/commit/ad735b280530aa4872eb51394a10d808e01ff447", "message": "Disable agent ca\n\nSigned-off-by: Gao Hongtao <hanahmily@gmail.com>", "committedDate": "2020-03-11T06:39:53Z", "type": "commit"}, {"oid": "7e461b57cb6bf7aade5aede33684b51bfec34442", "url": "https://github.com/apache/skywalking/commit/7e461b57cb6bf7aade5aede33684b51bfec34442", "message": "Switch to sharing server\n\nSigned-off-by: Gao Hongtao <hanahmily@gmail.com>", "committedDate": "2020-03-11T09:26:06Z", "type": "commit"}, {"oid": "7e461b57cb6bf7aade5aede33684b51bfec34442", "url": "https://github.com/apache/skywalking/commit/7e461b57cb6bf7aade5aede33684b51bfec34442", "message": "Switch to sharing server\n\nSigned-off-by: Gao Hongtao <hanahmily@gmail.com>", "committedDate": "2020-03-11T09:26:06Z", "type": "forcePushed"}, {"oid": "d5c06d6b391e1b3c02061bb08f449c3e89cd7695", "url": "https://github.com/apache/skywalking/commit/d5c06d6b391e1b3c02061bb08f449c3e89cd7695", "message": "Add agent log to console\n\nSigned-off-by: Gao Hongtao <hanahmily@gmail.com>", "committedDate": "2020-03-12T01:19:22Z", "type": "commit"}, {"oid": "9a25e400fcc0c3740d9c5e3620e07f917fa63b93", "url": "https://github.com/apache/skywalking/commit/9a25e400fcc0c3740d9c5e3620e07f917fa63b93", "message": "Upload log files", "committedDate": "2020-03-12T04:34:13Z", "type": "forcePushed"}, {"oid": "6f2abc18966fa7fdeb288f702e58513a1b4bdcfa", "url": "https://github.com/apache/skywalking/commit/6f2abc18966fa7fdeb288f702e58513a1b4bdcfa", "message": "Upload log files", "committedDate": "2020-03-13T02:42:18Z", "type": "commit"}, {"oid": "6f2abc18966fa7fdeb288f702e58513a1b4bdcfa", "url": "https://github.com/apache/skywalking/commit/6f2abc18966fa7fdeb288f702e58513a1b4bdcfa", "message": "Upload log files", "committedDate": "2020-03-13T02:42:18Z", "type": "forcePushed"}, {"oid": "7a085711e3653d3bf642aa84f73650e22595e383", "url": "https://github.com/apache/skywalking/commit/7a085711e3653d3bf642aa84f73650e22595e383", "message": "Change backend\n\nSigned-off-by: Gao Hongtao <hanahmily@gmail.com>", "committedDate": "2020-03-13T03:12:18Z", "type": "commit"}, {"oid": "d98d2424f0c5b3fef3cc04fc48b3cc2ff493f609", "url": "https://github.com/apache/skywalking/commit/d98d2424f0c5b3fef3cc04fc48b3cc2ff493f609", "message": "Revert \"Change backend\"\n\nThis reverts commit 7a085711e3653d3bf642aa84f73650e22595e383.", "committedDate": "2020-03-13T03:13:00Z", "type": "commit"}, {"oid": "1f6974ab946f58f07eb821c2fe085b7895a30ffb", "url": "https://github.com/apache/skywalking/commit/1f6974ab946f58f07eb821c2fe085b7895a30ffb", "message": "Update backend\n\nSigned-off-by: Gao Hongtao <hanahmily@gmail.com>", "committedDate": "2020-03-13T03:16:26Z", "type": "commit"}, {"oid": "44f7667561b205afea0aea1e26dc4add993fe625", "url": "https://github.com/apache/skywalking/commit/44f7667561b205afea0aea1e26dc4add993fe625", "message": "Revert e2e\n\nSigned-off-by: Gao Hongtao <hanahmily@gmail.com>", "committedDate": "2020-03-13T03:40:11Z", "type": "commit"}, {"oid": "fd7301f1e040618e4dc7f0f3d066f97458e97961", "url": "https://github.com/apache/skywalking/commit/fd7301f1e040618e4dc7f0f3d066f97458e97961", "message": "Merge branch 'master' into oap-ssl", "committedDate": "2020-03-13T03:41:28Z", "type": "commit"}, {"oid": "262548404374557cbef14c3397db75b778bc27f9", "url": "https://github.com/apache/skywalking/commit/262548404374557cbef14c3397db75b778bc27f9", "message": "Ignore TSL relevant files\n\nSigned-off-by: Gao Hongtao <hanahmily@gmail.com>", "committedDate": "2020-03-13T04:25:30Z", "type": "commit"}, {"oid": "262548404374557cbef14c3397db75b778bc27f9", "url": "https://github.com/apache/skywalking/commit/262548404374557cbef14c3397db75b778bc27f9", "message": "Ignore TSL relevant files\n\nSigned-off-by: Gao Hongtao <hanahmily@gmail.com>", "committedDate": "2020-03-13T04:25:30Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjA1MjIzNA==", "url": "https://github.com/apache/skywalking/pull/4470#discussion_r392052234", "bodyText": "Could you make the core style consistently. GRPCRemoteClient client use two constructors for ssl ON/OFF, here using a boolean and empty/null string.", "author": "wu-sheng", "createdAt": "2020-03-13T06:36:04Z", "path": "oap-server/server-core/src/main/java/org/apache/skywalking/oap/server/core/remote/client/RemoteClientManager.java", "diffHunk": "@@ -55,21 +59,29 @@\n     private static final Logger logger = LoggerFactory.getLogger(RemoteClientManager.class);\n \n     private final ModuleDefineHolder moduleDefineHolder;\n+    private final boolean grpcSslEnabled;\n+    private final String grpcSslTrustCAPath;\n     private ClusterNodesQuery clusterNodesQuery;\n     private volatile List<RemoteClient> usingClients;\n     private GaugeMetrics gauge;\n     private int remoteTimeout;\n \n     /**\n      * Initial the manager for all remote communication clients.\n-     *\n-     * @param moduleDefineHolder for looking up other modules\n+     *  @param moduleDefineHolder for looking up other modules\n      * @param remoteTimeout      for cluster internal communication, in second unit.\n+     * @param grpcSslEnabled true: enable SSL between clusters, false: plain gRPC between the cluster.\n+     * @param grpcSslTrustCAPath trust certificate authorities file path.\n      */\n-    public RemoteClientManager(ModuleDefineHolder moduleDefineHolder, int remoteTimeout) {\n+    public RemoteClientManager(ModuleDefineHolder moduleDefineHolder,", "originalCommit": "262548404374557cbef14c3397db75b778bc27f9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjE2MjY2NA==", "url": "https://github.com/apache/skywalking/pull/4470#discussion_r392162664", "bodyText": "done. keep all parameter list the same way.", "author": "hanahmily", "createdAt": "2020-03-13T11:04:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjA1MjIzNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjA1MjM4NQ==", "url": "https://github.com/apache/skywalking/pull/4470#discussion_r392052385", "bodyText": "A similar code style inconsistent here, using sslContext==null represents no SSL.", "author": "wu-sheng", "createdAt": "2020-03-13T06:36:39Z", "path": "oap-server/server-core/src/main/java/org/apache/skywalking/oap/server/core/remote/client/GRPCRemoteClient.java", "diffHunk": "@@ -99,7 +110,7 @@ GRPCClient getClient() {\n         if (Objects.isNull(client)) {\n             synchronized (GRPCRemoteClient.class) {\n                 if (Objects.isNull(client)) {\n-                    this.client = new GRPCClient(address.getHost(), address.getPort());\n+                    this.client = new GRPCClient(address.getHost(), address.getPort(), sslContext);", "originalCommit": "262548404374557cbef14c3397db75b778bc27f9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjA1MjgzNw==", "url": "https://github.com/apache/skywalking/pull/4470#discussion_r392052837", "bodyText": "I think you miss the deletion of this?", "author": "wu-sheng", "createdAt": "2020-03-13T06:38:34Z", "path": "oap-server/server-receiver-plugin/skywalking-sharing-server-plugin/src/main/java/org/apache/skywalking/oap/server/receiver/sharing/server/SharingServerModuleProvider.java", "diffHunk": "@@ -80,6 +81,15 @@ public void prepare() {\n         if (config.getGRPCPort() != 0) {\n             grpcServer = new GRPCServer(Strings.isBlank(config.getGRPCHost()) ? \"0.0.0.0\" : config.getGRPCHost(), config", "originalCommit": "262548404374557cbef14c3397db75b778bc27f9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjE2Mjc2NA==", "url": "https://github.com/apache/skywalking/pull/4470#discussion_r392162764", "bodyText": "removed it.", "author": "hanahmily", "createdAt": "2020-03-13T11:04:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjA1MjgzNw=="}], "type": "inlineReview"}, {"oid": "65cb79d840a5b3b280f080a71942b501816dd7df", "url": "https://github.com/apache/skywalking/commit/65cb79d840a5b3b280f080a71942b501816dd7df", "message": "Polish codes\n\nSigned-off-by: Gao Hongtao <hanahmily@gmail.com>", "committedDate": "2020-03-13T11:05:34Z", "type": "forcePushed"}, {"oid": "4dad85283585acbe9a5eb51056791917d099c307", "url": "https://github.com/apache/skywalking/commit/4dad85283585acbe9a5eb51056791917d099c307", "message": "Polish codes\n\nSigned-off-by: Gao Hongtao <hanahmily@gmail.com>", "committedDate": "2020-03-13T11:43:44Z", "type": "commit"}, {"oid": "4dad85283585acbe9a5eb51056791917d099c307", "url": "https://github.com/apache/skywalking/commit/4dad85283585acbe9a5eb51056791917d099c307", "message": "Polish codes\n\nSigned-off-by: Gao Hongtao <hanahmily@gmail.com>", "committedDate": "2020-03-13T11:43:44Z", "type": "forcePushed"}, {"oid": "1e04dfc69fadeeb314baf1986155d9f744bd4120", "url": "https://github.com/apache/skywalking/commit/1e04dfc69fadeeb314baf1986155d9f744bd4120", "message": "Merge branch 'master' into oap-ssl", "committedDate": "2020-03-13T14:09:19Z", "type": "commit"}, {"oid": "e44a7e9c1b3a92af1281ec75643930fdb181efca", "url": "https://github.com/apache/skywalking/commit/e44a7e9c1b3a92af1281ec75643930fdb181efca", "message": "Merge branch 'master' into oap-ssl", "committedDate": "2020-03-13T15:17:13Z", "type": "commit"}, {"oid": "2891e7c11a60c21ddb7a7ad07361842424e67fea", "url": "https://github.com/apache/skywalking/commit/2891e7c11a60c21ddb7a7ad07361842424e67fea", "message": "Update certificates expires year to 2120\n\nSigned-off-by: Gao Hongtao <hanahmily@gmail.com>", "committedDate": "2020-03-14T11:14:23Z", "type": "commit"}, {"oid": "d370b303ebedbe7a1b937185c34e86d5a762ba27", "url": "https://github.com/apache/skywalking/commit/d370b303ebedbe7a1b937185c34e86d5a762ba27", "message": "Merge branch 'oap-ssl' of https://github.com/apache/skywalking into oap-ssl", "committedDate": "2020-03-14T13:14:52Z", "type": "commit"}, {"oid": "d370b303ebedbe7a1b937185c34e86d5a762ba27", "url": "https://github.com/apache/skywalking/commit/d370b303ebedbe7a1b937185c34e86d5a762ba27", "message": "Merge branch 'oap-ssl' of https://github.com/apache/skywalking into oap-ssl", "committedDate": "2020-03-14T13:14:52Z", "type": "forcePushed"}]}