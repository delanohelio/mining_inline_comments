{"pr_number": 5844, "pr_title": "add Tidb provider module.", "pr_createdAt": "2020-11-14T12:42:44Z", "pr_url": "https://github.com/apache/skywalking/pull/5844", "timeline": [{"oid": "fe4132a928583fd8e2c13fb51b89d2a02fa8a9fa", "url": "https://github.com/apache/skywalking/commit/fe4132a928583fd8e2c13fb51b89d2a02fa8a9fa", "message": "fix transaction too large error when use TiDB as storage", "committedDate": "2020-10-29T12:24:30Z", "type": "commit"}, {"oid": "2953a069a2d1409eff001eb8aef3d2f8ff092600", "url": "https://github.com/apache/skywalking/commit/2953a069a2d1409eff001eb8aef3d2f8ff092600", "message": "add CHANGES.md", "committedDate": "2020-10-29T12:46:22Z", "type": "commit"}, {"oid": "4f3e3db27673b2add4c3c612892474f66a6e6e72", "url": "https://github.com/apache/skywalking/commit/4f3e3db27673b2add4c3c612892474f66a6e6e72", "message": "fix typo", "committedDate": "2020-10-29T13:08:50Z", "type": "commit"}, {"oid": "5f24f84fd9cc9deb5157045c07e80e72fce9245b", "url": "https://github.com/apache/skywalking/commit/5f24f84fd9cc9deb5157045c07e80e72fce9245b", "message": "Merge branch 'master' into dev-fix-tdb", "committedDate": "2020-11-01T16:22:26Z", "type": "commit"}, {"oid": "8b13719925753f0fcc7bfc6157f35034b739560a", "url": "https://github.com/apache/skywalking/commit/8b13719925753f0fcc7bfc6157f35034b739560a", "message": "Merge branch 'master' into dev-fix-tdb", "committedDate": "2020-11-05T07:25:20Z", "type": "commit"}, {"oid": "546416efe61312e89445808012e6cf45567c00db", "url": "https://github.com/apache/skywalking/commit/546416efe61312e89445808012e6cf45567c00db", "message": "Merge remote-tracking branch 'origin/master' into dev-fix-tdb\n\n# Conflicts:\n#\tCHANGES.md", "committedDate": "2020-11-10T07:57:21Z", "type": "commit"}, {"oid": "6f832a0197bace1f968187b996d1e963e302f905", "url": "https://github.com/apache/skywalking/commit/6f832a0197bace1f968187b996d1e963e302f905", "message": "Merge branch 'master' into dev-fix-tdb\n\n# Conflicts:\n#\tCHANGES.md", "committedDate": "2020-11-14T03:26:56Z", "type": "commit"}, {"oid": "7187c7e54451547f24f82c4a555fb7b9db48765c", "url": "https://github.com/apache/skywalking/commit/7187c7e54451547f24f82c4a555fb7b9db48765c", "message": "add tidb storage provider module.", "committedDate": "2020-11-14T12:37:25Z", "type": "commit"}, {"oid": "c887749781e71370ab85af952500b301b8719622", "url": "https://github.com/apache/skywalking/commit/c887749781e71370ab85af952500b301b8719622", "message": "add e2e.", "committedDate": "2020-11-15T02:32:47Z", "type": "commit"}, {"oid": "8171ee17612d0d67aa0a9660b2df77fac37884c7", "url": "https://github.com/apache/skywalking/commit/8171ee17612d0d67aa0a9660b2df77fac37884c7", "message": "revert ui submodule.", "committedDate": "2020-11-15T02:53:02Z", "type": "commit"}, {"oid": "0926e4c32180e784a277cb4123b5ffa1abcffbc9", "url": "https://github.com/apache/skywalking/commit/0926e4c32180e784a277cb4123b5ffa1abcffbc9", "message": "fix license.", "committedDate": "2020-11-15T02:56:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzY3OTY5OA==", "url": "https://github.com/apache/skywalking/pull/5844#discussion_r523679698", "bodyText": "Why need >= minDate? What is the scenario?", "author": "wu-sheng", "createdAt": "2020-11-15T03:06:27Z", "path": "oap-server/server-storage-plugin/storage-tidb-plugin/src/main/java/org/apache/skywalking/oap/server/storage/plugin/jdbc/tidb/TiDBHistoryDeleteDAO.java", "diffHunk": "@@ -0,0 +1,76 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.oap.server.storage.plugin.jdbc.tidb;\n+\n+import java.io.IOException;\n+import java.sql.Connection;\n+import java.sql.SQLException;\n+import org.apache.skywalking.oap.server.core.storage.IHistoryDeleteDAO;\n+import org.apache.skywalking.oap.server.core.storage.model.Model;\n+import org.apache.skywalking.oap.server.library.client.jdbc.JDBCClientException;\n+import org.apache.skywalking.oap.server.library.client.jdbc.hikaricp.JDBCHikariCPClient;\n+import org.apache.skywalking.oap.server.storage.plugin.jdbc.SQLBuilder;\n+import org.joda.time.DateTime;\n+\n+public class TiDBHistoryDeleteDAO implements IHistoryDeleteDAO {\n+\n+    private final JDBCHikariCPClient client;\n+\n+    public TiDBHistoryDeleteDAO(JDBCHikariCPClient client) {\n+        this.client = client;\n+    }\n+\n+    @Override\n+    public void deleteHistory(Model model, String timeBucketColumnName, int ttl) throws IOException {\n+        SQLBuilder dataDeleteSQL = new SQLBuilder(\"delete from \" + model.getName() + \" where \")\n+            .append(timeBucketColumnName).append(\"<= ? and \")\n+            .append(timeBucketColumnName).append(\">= ?\")", "originalCommit": "0926e4c32180e784a277cb4123b5ffa1abcffbc9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzcwMzcyMw==", "url": "https://github.com/apache/skywalking/pull/5844#discussion_r523703723", "bodyText": "this could be deleted.#5845", "author": "JaredTan95", "createdAt": "2020-11-15T03:57:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzY3OTY5OA=="}], "type": "inlineReview"}, {"oid": "692e5529d0b03ef0a7ffcb14f7c6dc90941b5259", "url": "https://github.com/apache/skywalking/commit/692e5529d0b03ef0a7ffcb14f7c6dc90941b5259", "message": "update e2e.", "committedDate": "2020-11-15T04:18:26Z", "type": "commit"}, {"oid": "6dd6562235a968fc48b2124917bdb2354d094dbc", "url": "https://github.com/apache/skywalking/commit/6dd6562235a968fc48b2124917bdb2354d094dbc", "message": "update e2e.", "committedDate": "2020-11-15T05:52:08Z", "type": "commit"}, {"oid": "dd36b362eb4e0913b4732d1b247dcf3664a154c0", "url": "https://github.com/apache/skywalking/commit/dd36b362eb4e0913b4732d1b247dcf3664a154c0", "message": "update e2e.", "committedDate": "2020-11-15T06:10:57Z", "type": "commit"}, {"oid": "774d9f6405ba1d813b6e6737a65e56ed7f8fd92c", "url": "https://github.com/apache/skywalking/commit/774d9f6405ba1d813b6e6737a65e56ed7f8fd92c", "message": "Merge remote-tracking branch 'origin/master' into tidb_provider\n\n# Conflicts:\n#\tCHANGES.md\n#\toap-server/server-storage-plugin/storage-jdbc-hikaricp-plugin/src/main/java/org/apache/skywalking/oap/server/storage/plugin/jdbc/h2/dao/H2HistoryDeleteDAO.java", "committedDate": "2020-11-15T13:54:33Z", "type": "commit"}, {"oid": "c211afdd0d85dafb162fa3eadb602681d06b8235", "url": "https://github.com/apache/skywalking/commit/c211afdd0d85dafb162fa3eadb602681d06b8235", "message": "Merge branch 'master' into tidb_provider", "committedDate": "2020-11-16T08:20:13Z", "type": "commit"}, {"oid": "116fba19fbc2d35996783daee167039dc565a6ee", "url": "https://github.com/apache/skywalking/commit/116fba19fbc2d35996783daee167039dc565a6ee", "message": "Merge branch 'master' into tidb_provider", "committedDate": "2020-11-18T07:50:12Z", "type": "commit"}, {"oid": "eb3a582c795df9397302ec677f883ca65666f4a3", "url": "https://github.com/apache/skywalking/commit/eb3a582c795df9397302ec677f883ca65666f4a3", "message": "Fix wrong health check test", "committedDate": "2020-11-22T02:45:09Z", "type": "commit"}, {"oid": "4f64e9dccb4fe2bfbfea724991bdbf6af168b4b2", "url": "https://github.com/apache/skywalking/commit/4f64e9dccb4fe2bfbfea724991bdbf6af168b4b2", "message": "Merge branch 'master' into tidb_provider", "committedDate": "2020-11-22T02:45:45Z", "type": "commit"}, {"oid": "fb1352f8dec058191bb155909b0c8464c6b8508e", "url": "https://github.com/apache/skywalking/commit/fb1352f8dec058191bb155909b0c8464c6b8508e", "message": "Merge branch 'master' into tidb_provider", "committedDate": "2020-11-22T14:25:28Z", "type": "commit"}, {"oid": "590bea76202fa8a1bb42ad4eaea8bf9ad0c9d3ee", "url": "https://github.com/apache/skywalking/commit/590bea76202fa8a1bb42ad4eaea8bf9ad0c9d3ee", "message": "add tidb ttl e2e.", "committedDate": "2020-11-22T14:37:12Z", "type": "commit"}]}