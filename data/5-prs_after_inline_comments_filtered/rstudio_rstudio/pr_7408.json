{"pr_number": 7408, "pr_title": "Use F6 to Navigate Between Panels", "pr_createdAt": "2020-07-21T19:48:42Z", "pr_url": "https://github.com/rstudio/rstudio/pull/7408", "timeline": [{"oid": "edd8229ea67b7d0e5a3ac30b61dd7ebfb1ebb4e5", "url": "https://github.com/rstudio/rstudio/commit/edd8229ea67b7d0e5a3ac30b61dd7ebfb1ebb4e5", "message": "determine next tab and select on F6", "committedDate": "2020-07-15T23:32:59Z", "type": "commit"}, {"oid": "2c3aadf2175d5cbe3781b90a365c74c9f488c3c5", "url": "https://github.com/rstudio/rstudio/commit/2c3aadf2175d5cbe3781b90a365c74c9f488c3c5", "message": "add setFocus() call to WorkbenchTab so every tab can be focused", "committedDate": "2020-07-17T00:41:08Z", "type": "commit"}, {"oid": "2e361d9770a6bd2c0b4b2c507dfd3debb5669dfd", "url": "https://github.com/rstudio/rstudio/commit/2e361d9770a6bd2c0b4b2c507dfd3debb5669dfd", "message": "Merge branch 'master' of https://github.com/rstudio/rstudio into feature/cycle-panes", "committedDate": "2020-07-17T00:41:42Z", "type": "commit"}, {"oid": "d9a6a4719e4df445df585e7e4c9814823859077c", "url": "https://github.com/rstudio/rstudio/commit/d9a6a4719e4df445df585e7e4c9814823859077c", "message": "focus column on F6", "committedDate": "2020-07-17T01:56:59Z", "type": "commit"}, {"oid": "7f8acd3d76bc48bf3a3651005a7c3f16e7e5cd7e", "url": "https://github.com/rstudio/rstudio/commit/7f8acd3d76bc48bf3a3651005a7c3f16e7e5cd7e", "message": "always put main source column at beginning of list", "committedDate": "2020-07-17T19:04:27Z", "type": "commit"}, {"oid": "5c0e31e9e5773e7496138d75313499c7585386a7", "url": "https://github.com/rstudio/rstudio/commit/5c0e31e9e5773e7496138d75313499c7585386a7", "message": "allow active editor to be set to the first editor when not explicitly specified", "committedDate": "2020-07-17T19:16:04Z", "type": "commit"}, {"oid": "1a6ea58349195452567647612cff49bbe7e84d0f", "url": "https://github.com/rstudio/rstudio/commit/1a6ea58349195452567647612cff49bbe7e84d0f", "message": "display source columns within their logical windows rather than directly in the source pane", "committedDate": "2020-07-17T22:05:22Z", "type": "commit"}, {"oid": "ab94800f78ae071b7447f96a91333b02b7958eef", "url": "https://github.com/rstudio/rstudio/commit/ab94800f78ae071b7447f96a91333b02b7958eef", "message": "set focus for files pane", "committedDate": "2020-07-17T22:47:23Z", "type": "commit"}, {"oid": "46f368815d083079947e8199f2eb167a1f1c082e", "url": "https://github.com/rstudio/rstudio/commit/46f368815d083079947e8199f2eb167a1f1c082e", "message": "implement setFocus for help pane", "committedDate": "2020-07-17T23:01:28Z", "type": "commit"}, {"oid": "9866cc367c98ecfcb919cabea4884cb5ac40496f", "url": "https://github.com/rstudio/rstudio/commit/9866cc367c98ecfcb919cabea4884cb5ac40496f", "message": "implement setFocus() for the jobs pane and ensure a tab is visible before showing it", "committedDate": "2020-07-18T00:35:30Z", "type": "commit"}, {"oid": "591ea607a3eba9bd29c32a5265bad308984fb1d2", "url": "https://github.com/rstudio/rstudio/commit/591ea607a3eba9bd29c32a5265bad308984fb1d2", "message": "remove repetitive functions", "committedDate": "2020-07-18T00:42:03Z", "type": "commit"}, {"oid": "426a2138d0674a4c32b0412dd031fdcacc6db126", "url": "https://github.com/rstudio/rstudio/commit/426a2138d0674a4c32b0412dd031fdcacc6db126", "message": "implement setFocus for find output", "committedDate": "2020-07-18T00:45:13Z", "type": "commit"}, {"oid": "21913942640ff56120130e27c0def54d90c58780", "url": "https://github.com/rstudio/rstudio/commit/21913942640ff56120130e27c0def54d90c58780", "message": "implement setFocus for viewer and plots panes", "committedDate": "2020-07-20T20:53:33Z", "type": "commit"}, {"oid": "ed96201bfc974134b0ff0a3bff8e5937ee3349d7", "url": "https://github.com/rstudio/rstudio/commit/ed96201bfc974134b0ff0a3bff8e5937ee3349d7", "message": "implement setFocus for SVN and tutorial panes", "committedDate": "2020-07-20T22:00:28Z", "type": "commit"}, {"oid": "0bc803b2b66f89403137bec86e480463d2efd8c0", "url": "https://github.com/rstudio/rstudio/commit/0bc803b2b66f89403137bec86e480463d2efd8c0", "message": "implement setFocus for packages and presentation panes", "committedDate": "2020-07-20T22:16:39Z", "type": "commit"}, {"oid": "722dc9a4f80954f0b21cb1a3af0589b0b7ecd84f", "url": "https://github.com/rstudio/rstudio/commit/722dc9a4f80954f0b21cb1a3af0589b0b7ecd84f", "message": "implement setFocus for build and markers output panes", "committedDate": "2020-07-21T17:04:23Z", "type": "commit"}, {"oid": "2f231a6fe981859309b95a10e670c011fcd09d28", "url": "https://github.com/rstudio/rstudio/commit/2f231a6fe981859309b95a10e670c011fcd09d28", "message": "implement setFocus for compile output and source cpp panes.\nUpdate setFocus for build pane to focus on compile panel.", "committedDate": "2020-07-21T17:44:20Z", "type": "commit"}, {"oid": "73fdb55b65576730f7de1a0d5850d0b6f689f3ce", "url": "https://github.com/rstudio/rstudio/commit/73fdb55b65576730f7de1a0d5850d0b6f689f3ce", "message": "set focus for SQL Results", "committedDate": "2020-07-21T19:25:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQyMzcxOA==", "url": "https://github.com/rstudio/rstudio/pull/7408#discussion_r458423718", "bodyText": "Maybe simplify to return normal_.equals(window.normal_)?", "author": "jmcphers", "createdAt": "2020-07-21T22:24:07Z", "path": "src/gwt/src/org/rstudio/core/client/layout/LogicalWindow.java", "diffHunk": "@@ -125,6 +125,13 @@ public WindowState getState()\n       return state_;\n    }\n \n+   public boolean equals(LogicalWindow window)\n+   {\n+      if(normal_.equals(window.normal_))", "originalCommit": "73fdb55b65576730f7de1a0d5850d0b6f689f3ce", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ0Mjg3Ng==", "url": "https://github.com/rstudio/rstudio/pull/7408#discussion_r458442876", "bodyText": "Good call, fixed", "author": "melissa-barca", "createdAt": "2020-07-21T23:17:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQyMzcxOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQyNDI3Nw==", "url": "https://github.com/rstudio/rstudio/pull/7408#discussion_r458424277", "bodyText": "This should be getValue() (getGlobalValue() ignores project values, which is technically irrelevant for this option now but could change in the near future)", "author": "jmcphers", "createdAt": "2020-07-21T22:25:25Z", "path": "src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java", "diffHunk": "@@ -289,10 +287,20 @@ public PaneManager(Provider<MainSplitPanel> pSplitPanel,\n \n       //\u00a0get the widgets for the extra source columns to be displayed\n       ArrayList<Widget> sourceColumns = new ArrayList<>();\n-      if (sourceColumnManager_.getSize() > 1 && additionalSourceCount_ > 0)\n+      additionalSourceCount_ = userPrefs_.panes().getGlobalValue().getAdditionalSourceColumns();", "originalCommit": "73fdb55b65576730f7de1a0d5850d0b6f689f3ce", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ0Mjk5Mw==", "url": "https://github.com/rstudio/rstudio/pull/7408#discussion_r458442993", "bodyText": "Fixed! Thanks for the explanation \ud83d\udc4d", "author": "melissa-barca", "createdAt": "2020-07-21T23:18:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQyNDI3Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQyNDU1NA==", "url": "https://github.com/rstudio/rstudio/pull/7408#discussion_r458424554", "bodyText": "Nit: Use StringUtil.equal to compare strings", "author": "jmcphers", "createdAt": "2020-07-21T22:26:09Z", "path": "src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java", "diffHunk": "@@ -579,6 +593,71 @@ public void onFocusCenterSeparator()\n       panel_.focusSplitter();\n    }\n \n+   @Handler\n+   public void onFocusNextPane()\n+   {\n+      // get the name of the currently focused pane\n+      LogicalWindow currentFocus = getActiveLogicalWindow();\n+      String nextFocusName = null;\n+      if (currentFocus != null)\n+      {\n+         String currentName = currentFocus.getNormal().getName();\n+         if (currentFocus.getNormal().getName() == \"TabSet2\")", "originalCommit": "73fdb55b65576730f7de1a0d5850d0b6f689f3ce", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQyNTY1OA==", "url": "https://github.com/rstudio/rstudio/pull/7408#discussion_r458425658", "bodyText": "Should this do something? (Set focus to the widget hosting the jobs list?)", "author": "jmcphers", "createdAt": "2020-07-21T22:28:44Z", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/jobs/view/JobsDisplayImpl.java", "diffHunk": "@@ -217,6 +217,11 @@ public void onSelected()\n    {\n    }\n    \n+   @Override\n+   public void setFocus()\n+   {", "originalCommit": "73fdb55b65576730f7de1a0d5850d0b6f689f3ce", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ0MzE5Mw==", "url": "https://github.com/rstudio/rstudio/pull/7408#discussion_r458443193", "bodyText": "I think I made the correct update, can you take another look?", "author": "melissa-barca", "createdAt": "2020-07-21T23:18:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQyNTY1OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQyNjgwMw==", "url": "https://github.com/rstudio/rstudio/pull/7408#discussion_r458426803", "bodyText": "There's a repeated pattern here where we set focus to what (presumably) is the first focusable command/button. I worry a little that this is going to be tricky to maintain, because if you permute the order of the commands you're going to wind up making F6 sending command to some random place in the middle, and you won't notice unless you happen to test F6. I wonder if we should have a method which performs a heuristic instead to find the first focusable element? (Gary might also have some thoughts on the best rules by which to select an element for focus)", "author": "jmcphers", "createdAt": "2020-07-21T22:31:36Z", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/presentation/PresentationPane.java", "diffHunk": "@@ -295,7 +295,12 @@ public void hideBusy()\n       refreshButton_.setVisible(true);\n       progressButton_.setVisible(false);\n    }\n-   \n+\n+   @Override\n+   public void setFocus()\n+   {\n+      slideNavigationMenu_.focus();", "originalCommit": "73fdb55b65576730f7de1a0d5850d0b6f689f3ce", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQzODU4MQ==", "url": "https://github.com/rstudio/rstudio/pull/7408#discussion_r458438581", "bodyText": "I talked to @gtritchie briefly about this before starting and he suggested determining the best place per pane to select focus and setting it accordingly. I did run into some issues with determining which element this is in every case, and more often than not defaulted to the first focusable element.\nIt might be tricky to write a generic approach since we don't typically save the button as a part of the pane's class and there is no rule that a pane needs to have a focusable button.", "author": "melissa-barca", "createdAt": "2020-07-21T23:04:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQyNjgwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ1MjUyNA==", "url": "https://github.com/rstudio/rstudio/pull/7408#discussion_r458452524", "bodyText": "I haven't looked at this PR yet (want to build it and play with it).\nThat said, there is a technique I added in the modal dialog code that dynamically determines the first (and last) focusable element contained with a parent element, so we might be able to leverage something similar here and set a reasonable default.\n\n  \n    \n      rstudio/src/gwt/src/org/rstudio/core/client/widget/ModalDialogBase.java\n    \n    \n        Lines 751 to 773\n      in\n      7fbec0b\n    \n    \n    \n    \n\n        \n          \n           public ArrayList<Element> getFocusableElements() \n        \n\n        \n          \n           { \n        \n\n        \n          \n              // css selector from https://github.com/scottaohara/accessible_modal_window \n        \n\n        \n          \n              String focusableElements = \n        \n\n        \n          \n                    \"button:not([hidden]):not([disabled]), [href]:not([hidden]), \" + \n        \n\n        \n          \n                    \"input:not([hidden]):not([type=\\\"hidden\\\"]):not([disabled]), \" + \n        \n\n        \n          \n                    \"select:not([hidden]):not([disabled]), textarea:not([hidden]):not([disabled]), \" + \n        \n\n        \n          \n                    \"[tabindex=\\\"0\\\"]:not([hidden]):not([disabled]), summary:not([hidden]), \" + \n        \n\n        \n          \n                    \"[contenteditable]:not([hidden]), audio[controls]:not([hidden]), \" + \n        \n\n        \n          \n                    \"video[controls]:not([hidden])\"; \n        \n\n        \n          \n              NodeList<Element> potentiallyFocusable = DomUtils.querySelectorAll(getElement(), focusableElements); \n        \n\n        \n          \n            \n        \n\n        \n          \n              ArrayList<Element> focusable = new ArrayList<>(); \n        \n\n        \n          \n              for (int i = 0; i < potentiallyFocusable.getLength(); i++) \n        \n\n        \n          \n              { \n        \n\n        \n          \n                 // only include items taking up space \n        \n\n        \n          \n                 if (potentiallyFocusable.getItem(i).getOffsetWidth() > 0 && \n        \n\n        \n          \n                       potentiallyFocusable.getItem(i).getOffsetHeight() > 0) \n        \n\n        \n          \n                 { \n        \n\n        \n          \n                    focusable.add(potentiallyFocusable.getItem(i)); \n        \n\n        \n          \n                 } \n        \n\n        \n          \n              } \n        \n\n        \n          \n              return focusable; \n        \n    \n  \n\n\nProbably do still want a way for each pane to override that; for the dialogs, that is done via the focusInitialControl() method. By default it just sets focus to the programmatically-determined first control, but some dialogs change this.", "author": "gtritchie", "createdAt": "2020-07-21T23:48:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQyNjgwMw=="}], "type": "inlineReview"}, {"oid": "2e3efccbe171de1e87301f7f45f3b0b92b6feeb4", "url": "https://github.com/rstudio/rstudio/commit/2e3efccbe171de1e87301f7f45f3b0b92b6feeb4", "message": "code clean up", "committedDate": "2020-07-21T23:10:39Z", "type": "commit"}, {"oid": "abaaf0f7cec656445090e8f3add5fb77e7a70b38", "url": "https://github.com/rstudio/rstudio/commit/abaaf0f7cec656445090e8f3add5fb77e7a70b38", "message": "implement setFocus on JobsDisplayImpl", "committedDate": "2020-07-21T23:17:04Z", "type": "commit"}, {"oid": "c9d61668555d7cbbbf2ce09248e45866fa5f601d", "url": "https://github.com/rstudio/rstudio/commit/c9d61668555d7cbbbf2ce09248e45866fa5f601d", "message": "make ModalDialogBase method 'getFocusableElements()' generic and move to DomUtils, add generic\nsetFocus method to WorkbenchPane to focus on the first focusable element in the pane.", "committedDate": "2020-07-22T18:28:01Z", "type": "commit"}, {"oid": "dfbcade317c31b47f50338bb543310b0d738545d", "url": "https://github.com/rstudio/rstudio/commit/dfbcade317c31b47f50338bb543310b0d738545d", "message": "remove specific setFocus methods from classes that didn't already have focus specified", "committedDate": "2020-07-22T19:05:21Z", "type": "commit"}, {"oid": "3c7b47b6c85c2b4b449d907b74cd06470b12ac70", "url": "https://github.com/rstudio/rstudio/commit/3c7b47b6c85c2b4b449d907b74cd06470b12ac70", "message": "manually add focus-visible attribute to element", "committedDate": "2020-07-22T20:49:19Z", "type": "commit"}, {"oid": "3c7b47b6c85c2b4b449d907b74cd06470b12ac70", "url": "https://github.com/rstudio/rstudio/commit/3c7b47b6c85c2b4b449d907b74cd06470b12ac70", "message": "manually add focus-visible attribute to element", "committedDate": "2020-07-22T20:49:19Z", "type": "forcePushed"}, {"oid": "426c3eb886d00a0176e456521d1e49e3c96ebe2f", "url": "https://github.com/rstudio/rstudio/commit/426c3eb886d00a0176e456521d1e49e3c96ebe2f", "message": "add setFocus to HistoryPane", "committedDate": "2020-07-22T21:21:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTY5MzQ4MQ==", "url": "https://github.com/rstudio/rstudio/pull/7408#discussion_r459693481", "bodyText": "Should this send focus to the xterm.js instance? (cc @gtritchie)", "author": "jmcphers", "createdAt": "2020-07-23T19:58:03Z", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/terminal/TerminalPane.java", "diffHunk": "@@ -232,6 +232,11 @@ public void onSelected()\n       }\n    }\n \n+   @Override\n+   public void setFocus()\n+   {", "originalCommit": "426c3eb886d00a0176e456521d1e49e3c96ebe2f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTgzOTM1NQ==", "url": "https://github.com/rstudio/rstudio/pull/7408#discussion_r459839355", "bodyText": "Should this send focus to the xterm.js instance? (cc @gtritchie)\n\nActually the Terminal pane is \"special\" and handles focus in its own way (see setFocusOnVisible() which is invoked in many locations) so having this empty override is actually the safest thing to do here.\nI would add a comment in this empty method saying something like \"Terminal pane automatically directs focus to xterm.js so this method intentionally left blank\".", "author": "gtritchie", "createdAt": "2020-07-24T03:47:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTY5MzQ4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDE1NjQ5OA==", "url": "https://github.com/rstudio/rstudio/pull/7408#discussion_r460156498", "bodyText": "Done!", "author": "melissa-barca", "createdAt": "2020-07-24T16:22:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTY5MzQ4MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTgxMjQ3MQ==", "url": "https://github.com/rstudio/rstudio/pull/7408#discussion_r459812471", "bodyText": "Why use a FocusPanel here? Doing so creates an extra focusable element so when Tabbing through there is an extra stop, and it doesn't have a meaningful accessible description nor obvious purpose.", "author": "gtritchie", "createdAt": "2020-07-24T01:28:37Z", "path": "src/gwt/src/org/rstudio/core/client/files/filedialog/PathBreadcrumbWidget.java", "diffHunk": "@@ -57,8 +57,7 @@ public PathBreadcrumbWidget(FileSystemContext context)\n       panel_.setSize(\"100%\", \"100%\");\n       panel_.add(pathPanel_);\n \n-      outer_ = new SimplePanel();\n-      outer_.setWidget(panel_);\n+      outer_ = new FocusPanel(panel_);", "originalCommit": "426c3eb886d00a0176e456521d1e49e3c96ebe2f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDEzMDYyMg==", "url": "https://github.com/rstudio/rstudio/pull/7408#discussion_r460130622", "bodyText": "Leftover change from prior commit, removed.", "author": "melissa-barca", "createdAt": "2020-07-24T15:36:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTgxMjQ3MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTgxMjg3Ng==", "url": "https://github.com/rstudio/rstudio/pull/7408#discussion_r459812876", "bodyText": "This is unused and can be remove; it is currently invoked by FilePathToolbar.focus, but that is not invoked by anything and should also be removed.", "author": "gtritchie", "createdAt": "2020-07-24T01:30:27Z", "path": "src/gwt/src/org/rstudio/core/client/files/filedialog/PathBreadcrumbWidget.java", "diffHunk": "@@ -150,6 +149,11 @@ public void setDirectory(FileSystemItem[] pathElements,\n       onWidthsChanged();\n    }\n \n+   public void focus()", "originalCommit": "426c3eb886d00a0176e456521d1e49e3c96ebe2f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDEzMDc1MQ==", "url": "https://github.com/rstudio/rstudio/pull/7408#discussion_r460130751", "bodyText": "Removed", "author": "melissa-barca", "createdAt": "2020-07-24T15:37:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTgxMjg3Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTgxMzEwNA==", "url": "https://github.com/rstudio/rstudio/pull/7408#discussion_r459813104", "bodyText": "This seems to be unused and unnecessary.", "author": "gtritchie", "createdAt": "2020-07-24T01:31:30Z", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/files/ui/FilePathToolbar.java", "diffHunk": "@@ -179,6 +179,11 @@ public void onResize()\n          ((RequiresResize)getWidget()).onResize();\n    }\n \n+   public void focus()", "originalCommit": "426c3eb886d00a0176e456521d1e49e3c96ebe2f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDE1MjYwMg==", "url": "https://github.com/rstudio/rstudio/pull/7408#discussion_r460152602", "bodyText": "Removed", "author": "melissa-barca", "createdAt": "2020-07-24T16:14:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTgxMzEwNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTgxNDQyNg==", "url": "https://github.com/rstudio/rstudio/pull/7408#discussion_r459814426", "bodyText": "This is unused and can be removed.", "author": "gtritchie", "createdAt": "2020-07-24T01:37:57Z", "path": "src/gwt/src/org/rstudio/studio/client/common/compile/CompilePanel.java", "diffHunk": "@@ -189,7 +188,12 @@ public HasClickHandlers stopButton()\n    {\n       return stopButton_;\n    }\n-   \n+\n+   public void focus()", "originalCommit": "426c3eb886d00a0176e456521d1e49e3c96ebe2f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDEzMjQyMQ==", "url": "https://github.com/rstudio/rstudio/pull/7408#discussion_r460132421", "bodyText": "Reverted", "author": "melissa-barca", "createdAt": "2020-07-24T15:40:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTgxNDQyNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTgxNTI3Nw==", "url": "https://github.com/rstudio/rstudio/pull/7408#discussion_r459815277", "bodyText": "Don't see purpose of using a FocusPanel here.", "author": "gtritchie", "createdAt": "2020-07-24T01:42:13Z", "path": "src/gwt/src/org/rstudio/studio/client/common/compile/CompilePanel.java", "diffHunk": "@@ -44,7 +44,7 @@ public CompilePanel()\n    public CompilePanel(CompileOutputDisplay outputDisplay)\n    {\n       \n-      panel_ = new SimplePanel();\n+      panel_ = new FocusPanel();", "originalCommit": "426c3eb886d00a0176e456521d1e49e3c96ebe2f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDEzMjMzNg==", "url": "https://github.com/rstudio/rstudio/pull/7408#discussion_r460132336", "bodyText": "Reverted", "author": "melissa-barca", "createdAt": "2020-07-24T15:40:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTgxNTI3Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTgxNTM4NA==", "url": "https://github.com/rstudio/rstudio/pull/7408#discussion_r459815384", "bodyText": "This is unused and can be deleted.", "author": "gtritchie", "createdAt": "2020-07-24T01:42:50Z", "path": "src/gwt/src/org/rstudio/studio/client/common/presentation/SlideNavigationToolbarMenu.java", "diffHunk": "@@ -135,7 +135,12 @@ public HasClickHandlers getEditButton()\n    {\n       return editButton_;\n    }\n-   \n+\n+   public void focus()", "originalCommit": "426c3eb886d00a0176e456521d1e49e3c96ebe2f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDEzOTE2OA==", "url": "https://github.com/rstudio/rstudio/pull/7408#discussion_r460139168", "bodyText": "Reverted", "author": "melissa-barca", "createdAt": "2020-07-24T15:51:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTgxNTM4NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTgzMzA3Mg==", "url": "https://github.com/rstudio/rstudio/pull/7408#discussion_r459833072", "bodyText": "Why was this necessary? I'm familiar with the polyfill we use that keys off this classname, but in general it should handle this by itself. Is there an example I can look at where adding this manually was needed?", "author": "gtritchie", "createdAt": "2020-07-24T03:13:08Z", "path": "src/gwt/src/org/rstudio/studio/client/workbench/ui/WorkbenchPane.java", "diffHunk": "@@ -57,6 +62,21 @@ public void onSelected()\n    {\n    }\n \n+   @Override\n+   public void setFocus()\n+   {\n+      ArrayList<Element> focusableElements = DomUtils.getFocusableElements(getElement());\n+      if (!focusableElements.isEmpty())\n+      {\n+         Element el = focusableElements.get(0);\n+         el.focus();\n+         el.addClassName(\"focus-visible\");", "originalCommit": "426c3eb886d00a0176e456521d1e49e3c96ebe2f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDE0NzA5MA==", "url": "https://github.com/rstudio/rstudio/pull/7408#discussion_r460147090", "bodyText": "If you checkout the commit prior to this one and test with chrome you'll see (or not see...) that when pressing F6 focus is moved to the pane, but there is no visible indication (if you press the Tab Key afterwards you'll see visible indication on the next element). My understanding is that the polyfill only sets :focus-visible when a focus event is immediately followed by a Tab, Shift+Tab, or an arrow key.", "author": "melissa-barca", "createdAt": "2020-07-24T16:05:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTgzMzA3Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTgzMzQ2OA==", "url": "https://github.com/rstudio/rstudio/pull/7408#discussion_r459833468", "bodyText": "Addition of this member variable looks unnecessary, and can be un-done I think?", "author": "gtritchie", "createdAt": "2020-07-24T03:15:16Z", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/connections/ui/ConnectionsPane.java", "diffHunk": "@@ -474,7 +474,8 @@ private void installConnectionsToolbar()\n    {\n       toolbar_.removeAllWidgets();\n       \n-      toolbar_.addLeftWidget(commands_.newConnection().createToolbarButton());\n+      newConnectionButton_ =", "originalCommit": "426c3eb886d00a0176e456521d1e49e3c96ebe2f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDE1MDI2MA==", "url": "https://github.com/rstudio/rstudio/pull/7408#discussion_r460150260", "bodyText": "Removed", "author": "melissa-barca", "createdAt": "2020-07-24T16:10:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTgzMzQ2OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTgzMzc5Ng==", "url": "https://github.com/rstudio/rstudio/pull/7408#discussion_r459833796", "bodyText": "No reason for this to be a member variable, looks like all the changes in this source file are not necessary.", "author": "gtritchie", "createdAt": "2020-07-24T03:17:12Z", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/environment/EnvironmentPane.java", "diffHunk": "@@ -217,7 +217,7 @@ private void initSecondaryToolbar()\n       ThemeStyles styles = ThemeStyles.INSTANCE;\n       toolbar.getWrapper().addStyleName(styles.tallerToolbarWrapper());\n       \n-      SearchWidget searchWidget = new SearchWidget(\"Search environment\", new SuggestOracle() {\n+      searchWidget_ = new SearchWidget(\"Search environment\", new SuggestOracle() {", "originalCommit": "426c3eb886d00a0176e456521d1e49e3c96ebe2f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDE1MTg0OA==", "url": "https://github.com/rstudio/rstudio/pull/7408#discussion_r460151848", "bodyText": "Removed", "author": "melissa-barca", "createdAt": "2020-07-24T16:13:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTgzMzc5Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTgzNTQ0OQ==", "url": "https://github.com/rstudio/rstudio/pull/7408#discussion_r459835449", "bodyText": "Note you will need to implement this in the Pro repo in LauncherJobsPaneWidgetsPro.java.", "author": "gtritchie", "createdAt": "2020-07-24T03:26:06Z", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/jobs/view/LauncherJobsPaneWidgets.java", "diffHunk": "@@ -50,7 +50,12 @@ public void installMainToolbar()\n    public void removeProgressWidget()\n    {\n    }\n-   \n+\n+   @Override", "originalCommit": "426c3eb886d00a0176e456521d1e49e3c96ebe2f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDE1MzI5Ng==", "url": "https://github.com/rstudio/rstudio/pull/7408#discussion_r460153296", "bodyText": "Thank you, noted \ud83d\udc4d", "author": "melissa-barca", "createdAt": "2020-07-24T16:16:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTgzNTQ0OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTgzNTk5Ng==", "url": "https://github.com/rstudio/rstudio/pull/7408#discussion_r459835996", "bodyText": "Don't need this installButton_ member variable at all.", "author": "gtritchie", "createdAt": "2020-07-24T03:29:22Z", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/packages/PackagesPane.java", "diffHunk": "@@ -195,7 +195,7 @@ protected Toolbar createMainToolbar()\n       Toolbar toolbar = new Toolbar(\"Packages Tab\");\n      \n       // install packages\n-      toolbar.addLeftWidget(commands_.installPackage().createToolbarButton());\n+      toolbar.addLeftWidget(installButton_ = commands_.installPackage().createToolbarButton());", "originalCommit": "426c3eb886d00a0176e456521d1e49e3c96ebe2f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDE1NDU3NQ==", "url": "https://github.com/rstudio/rstudio/pull/7408#discussion_r460154575", "bodyText": "Removed", "author": "melissa-barca", "createdAt": "2020-07-24T16:18:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTgzNTk5Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTgzNjU1Ng==", "url": "https://github.com/rstudio/rstudio/pull/7408#discussion_r459836556", "bodyText": "This is never called. Can revert all the changes in this source file.", "author": "gtritchie", "createdAt": "2020-07-24T03:32:26Z", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/plots/ui/PlotsToolbar.java", "diffHunk": "@@ -47,7 +47,12 @@ public void removeCustomToolbar()\n       removeAllWidgets();\n       installStandardUI();\n    }\n-   \n+\n+   public void focus()", "originalCommit": "426c3eb886d00a0176e456521d1e49e3c96ebe2f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDE1NTU3Ng==", "url": "https://github.com/rstudio/rstudio/pull/7408#discussion_r460155576", "bodyText": "Removed", "author": "melissa-barca", "createdAt": "2020-07-24T16:20:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTgzNjU1Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTgzOTQzMg==", "url": "https://github.com/rstudio/rstudio/pull/7408#discussion_r459839432", "bodyText": "Don't need the added homeButton_ member variable.", "author": "gtritchie", "createdAt": "2020-07-24T03:48:27Z", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/tutorial/TutorialPane.java", "diffHunk": "@@ -116,7 +117,8 @@ protected Toolbar createMainToolbar()\n       // toolbar_.addLeftWidget(commands_.tutorialBack().createToolbarButton());\n       // toolbar_.addLeftWidget(commands_.tutorialForward().createToolbarButton());\n       \n-      toolbar_.addLeftWidget(commands_.tutorialHome().createToolbarButton());\n+      toolbar_.addLeftWidget(homeButton_ =", "originalCommit": "426c3eb886d00a0176e456521d1e49e3c96ebe2f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDE1Nzc5Ng==", "url": "https://github.com/rstudio/rstudio/pull/7408#discussion_r460157796", "bodyText": "Removed", "author": "melissa-barca", "createdAt": "2020-07-24T16:24:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTgzOTQzMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTgzOTU4MA==", "url": "https://github.com/rstudio/rstudio/pull/7408#discussion_r459839580", "bodyText": "Don't need the added diffButton_ member variable.", "author": "gtritchie", "createdAt": "2020-07-24T03:49:13Z", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/vcs/git/GitPane.java", "diffHunk": "@@ -127,7 +127,7 @@ protected Toolbar createMainToolbar()\n       pullMoreMenu.addItem(commands_.vcsPullRebase().createMenuItem(false));\n \n       Toolbar toolbar = new Toolbar(\"Git Tab\");\n-      toolbar.addLeftWidget(commands_.vcsDiff().createToolbarButton());\n+      toolbar.addLeftWidget(diffButton_ = commands_.vcsDiff().createToolbarButton());", "originalCommit": "426c3eb886d00a0176e456521d1e49e3c96ebe2f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDE1ODg4Nw==", "url": "https://github.com/rstudio/rstudio/pull/7408#discussion_r460158887", "bodyText": "Removed", "author": "melissa-barca", "createdAt": "2020-07-24T16:26:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTgzOTU4MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTgzOTYzNg==", "url": "https://github.com/rstudio/rstudio/pull/7408#discussion_r459839636", "bodyText": "Don't need the added diffButton_ member variable.", "author": "gtritchie", "createdAt": "2020-07-24T03:49:37Z", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/vcs/svn/SVNPane.java", "diffHunk": "@@ -61,7 +61,7 @@ protected Toolbar createMainToolbar()\n    {\n       Toolbar toolbar = new Toolbar(\"SVN Tab\");\n \n-      toolbar.addLeftWidget(commands_.vcsDiff().createToolbarButton());\n+      toolbar.addLeftWidget(diffButton_ = commands_.vcsDiff().createToolbarButton());", "originalCommit": "426c3eb886d00a0176e456521d1e49e3c96ebe2f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDE1ODk0Nw==", "url": "https://github.com/rstudio/rstudio/pull/7408#discussion_r460158947", "bodyText": "Removed", "author": "melissa-barca", "createdAt": "2020-07-24T16:27:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTgzOTYzNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTg0MTQ1OA==", "url": "https://github.com/rstudio/rstudio/pull/7408#discussion_r459841458", "bodyText": "This pane (when nothing has been loaded in it) has no focusable controls (all the buttons are disabled). So it actually acts as a \"trap\" and F6 refuses to go to it, staying stuck on the previous pane.\nSimplest fix might be to make the \"clear\" button always enabled, and just be a no-op if there's nothing to clear. Then you don't need any of this logic involving zoomButton_ or clearAllButton_ and the default behavior will handle it for you. That is, don't need a setFocus() override at all or the new member variables.", "author": "gtritchie", "createdAt": "2020-07-24T04:00:01Z", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/viewer/ViewerPane.java", "diffHunk": "@@ -280,7 +280,16 @@ public void onResize()\n       \n       publishButton_.setShowCaption(width > 500);\n    }\n-   \n+\n+   @Override\n+   public void setFocus()", "originalCommit": "426c3eb886d00a0176e456521d1e49e3c96ebe2f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDE4NDAwOA==", "url": "https://github.com/rstudio/rstudio/pull/7408#discussion_r460184008", "bodyText": "Fixed!", "author": "melissa-barca", "createdAt": "2020-07-24T17:15:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTg0MTQ1OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTg0NTEzMQ==", "url": "https://github.com/rstudio/rstudio/pull/7408#discussion_r459845131", "bodyText": "Several tab types in the Source panel don't yet handle focus and prevent F6 from moving to that panel when they are selected.\n\nprofile results (ProfilerEditingTarget)\nUrlContentEditingTarget (execute data() in the console)\nDataEditingTarget (execute View(mtcars) in console)\nObjectExplorerEditingTarget (execute View(list(\"a\" = 1.2, \"b\" = TRUE, \"c\" = 3:10)) in console)\n\nFine with you opening a separate issue on this and looking into it later.", "author": "gtritchie", "createdAt": "2020-07-24T04:20:28Z", "path": "src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java", "diffHunk": "@@ -579,6 +593,71 @@ public void onFocusCenterSeparator()\n       panel_.focusSplitter();\n    }\n \n+   @Handler\n+   public void onFocusNextPane()", "originalCommit": "426c3eb886d00a0176e456521d1e49e3c96ebe2f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDE0MzI5Mg==", "url": "https://github.com/rstudio/rstudio/pull/7408#discussion_r460143292", "bodyText": "Another good catch. I've create #7441 to track this.", "author": "melissa-barca", "createdAt": "2020-07-24T15:58:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTg0NTEzMQ=="}], "type": "inlineReview"}, {"oid": "a3a9379fed8a64672197ff7d780e683c7384fe4e", "url": "https://github.com/rstudio/rstudio/commit/a3a9379fed8a64672197ff7d780e683c7384fe4e", "message": "revert unused changes", "committedDate": "2020-07-24T17:11:32Z", "type": "commit"}, {"oid": "be74d396ad9eae26f4b74c022a182c4a4e391772", "url": "https://github.com/rstudio/rstudio/commit/be74d396ad9eae26f4b74c022a182c4a4e391772", "message": "add comment", "committedDate": "2020-07-24T17:11:38Z", "type": "commit"}, {"oid": "844978c030514fd4f3a14bf45fcc20e574d13a93", "url": "https://github.com/rstudio/rstudio/commit/844978c030514fd4f3a14bf45fcc20e574d13a93", "message": "prevent focusNextPane from getting trapped when there is nothing displayed in the Viewer Pane", "committedDate": "2020-07-24T17:12:07Z", "type": "commit"}, {"oid": "98a98ddbba350625890d7f104006c25315704c51", "url": "https://github.com/rstudio/rstudio/commit/98a98ddbba350625890d7f104006c25315704c51", "message": "Update NEWS.md", "committedDate": "2020-07-24T18:43:05Z", "type": "commit"}, {"oid": "0aec153768297c0c4cbff61cbdb615bedff94d55", "url": "https://github.com/rstudio/rstudio/commit/0aec153768297c0c4cbff61cbdb615bedff94d55", "message": "Merge branches 'feature/cycle-panes' and 'master' of https://github.com/rstudio/rstudio into feature/cycle-panes\n\n\u0001 Conflicts:\n\u0001\tsrc/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java", "committedDate": "2020-07-24T19:28:38Z", "type": "commit"}]}