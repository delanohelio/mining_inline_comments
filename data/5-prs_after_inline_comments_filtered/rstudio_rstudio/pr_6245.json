{"pr_number": 6245, "pr_title": "Replace more instances of String.CharAt with StringUtil.CharAt", "pr_createdAt": "2020-02-17T04:05:37Z", "pr_url": "https://github.com/rstudio/rstudio/pull/6245", "timeline": [{"oid": "7556bfd7b16a81c1ad9957a7412d620211894b1b", "url": "https://github.com/rstudio/rstudio/commit/7556bfd7b16a81c1ad9957a7412d620211894b1b", "message": "Replace more instances of String.CharAt with StringUtil.CharAt\n\nJavaScript exception related to charAt; don't know exact repro, taking opportunity to fix that call stack and defensively change a few other instances of charAt to use safer StringUtil.charAt.\n\nFor more context:\n\n* fix exceptions caused by gwt 2.8.2 checking charAt bounds #4451\n* more fixes for new behavior of String.charAt in GWT 2.8.2 #4489\n* fix exception when typing Shift+Tab on whitespace-only editor line #5036\n* javascript exceptions being thrown by charAt in cpp completion code #5052\n\nCallstack:\n```\n15 Feb 2020 00:03:26 [rserver] ERROR CLIENT EXCEPTION (rsession-gary): Index: -1, Size: 226;\nrstudio-0.js@10#639::Throwable.createError\nrstudio-0.js@48#703::Throwable.initializeBackingError\nrstudio-0.js@8#535::Throwable.Throwable\nrstudio-0.js@18#808::Exception.Exception\nrstudio-0.js@18#862::RuntimeException.RuntimeException\nrstudio-0.js@25#3620::IndexOutOfBoundsException.IndexOutOfBoundsException\nrstudio-0.js@34#5360::StringIndexOutOfBoundsException\nrstudio-0.js@21#5794::checkCriticalStringElementIndex\nrstudio-0.js@5#6025::checkStringElementIndex\nrstudio-0.js@3#4059::charAt\nrstudio-0.js@10#4633::charAt_I_C__devirtual$\nrstudio-0.js@39#356896::CompletionManagerBase.canAutoPopup\nrstudio-0.js@14#357339::CompletionManagerBase.previewKeyPress\nrstudio-0.js@61#360873::MarkdownCompletionManager.previewKeyPress\nrstudio-0.js@23#359555::DelegatingCompletionManager.previewKeyPress\nrstudio-0.js@43#464919::AceKeyboardPreviewer$1.previewKeyPress\nrstudio-0.js@24#464884::AceKeyboardPreviewer.onTextInput\nrstudio-0.js@21#464852::<anonymous>\nrstudio-0.js@28#16334::apply\nrstudio-0.js@16#16393::entry0\nrstudio-0.js@14#16372::handleKeyboard\nhttp://localhost:9876/rstudio/7D3FB0FCC17B7BB289C4D681EC4DE752.cache.js@43#42254::callKeyboardHandlers\nhttp://localhost:9876/rstudio/7D3FB0FCC17B7BB289C4D681EC4DE752.cache.js@14#42290::onTextInput\nhttp://localhost:9876/rstudio/7D3FB0FCC17B7BB289C4D681EC4DE752.cache.js@36#49554::onTextInput\nhttp://localhost:9876/rstudio/7D3FB0FCC17B7BB289C4D681EC4DE752.cache.js@22#40398::sendText\nhttp://localhost:9876/rstudio/7D3FB0FCC17B7BB289C4D681EC4DE752.cache.js@24#40419::onInput\nClient-ID: 3049a086-a908-4534-a87e-4dcaca02d7f7\nUser-Agent: Mozilla/5.0 (Macintosh  Intel Mac OS X 10_15_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.106 Safari/537.36\n```", "committedDate": "2020-02-17T04:01:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTk5MjIwNw==", "url": "https://github.com/rstudio/rstudio/pull/6245#discussion_r379992207", "bodyText": "nit: previously this function always returned a string; now it's returning null? Might be safer to just change the usages of .charAt() here.", "author": "kevinushey", "createdAt": "2020-02-17T05:34:05Z", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/vcs/git/GitStatusRenderer.java", "diffHunk": "@@ -78,6 +78,9 @@ public SafeHtml render(String str)\n \n    private String descForStatus(String str)\n    {\n+      if (str.length() < 2)\n+         return null;", "originalCommit": "7556bfd7b16a81c1ad9957a7412d620211894b1b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDAwNTE2MA==", "url": "https://github.com/rstudio/rstudio/pull/6245#discussion_r380005160", "bodyText": "Good catch, meant to return empty string there like one of the cases later in the function. Fixed.", "author": "gtritchie", "createdAt": "2020-02-17T06:37:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTk5MjIwNw=="}], "type": "inlineReview"}, {"oid": "9d2b0d868fdcff567c9ae8d9769312d753886592", "url": "https://github.com/rstudio/rstudio/commit/9d2b0d868fdcff567c9ae8d9769312d753886592", "message": "return empty string instead of null", "committedDate": "2020-02-17T06:37:15Z", "type": "commit"}]}