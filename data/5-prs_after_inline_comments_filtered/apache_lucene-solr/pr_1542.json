{"pr_number": 1542, "pr_title": "SOLR-14347: fix cached session update to not depend on Zookeeper state", "pr_createdAt": "2020-05-28T22:08:15Z", "pr_url": "https://github.com/apache/lucene-solr/pull/1542", "timeline": [{"oid": "caff934b7e991a5d7b3e52d1755f8918dc4b97d1", "url": "https://github.com/apache/lucene-solr/commit/caff934b7e991a5d7b3e52d1755f8918dc4b97d1", "message": "SOLR-14347: fix cached session update to not depend on Zookeeper state", "committedDate": "2020-05-28T22:01:23Z", "type": "commit"}, {"oid": "c83017479aa367d5317745116a2acb5a9a6b941e", "url": "https://github.com/apache/lucene-solr/commit/c83017479aa367d5317745116a2acb5a9a6b941e", "message": "Merge branch 'master' into SOLR-14347", "committedDate": "2020-06-10T05:48:15Z", "type": "commit"}, {"oid": "5d7b3e714f08479a10d868ce7da428450d03ae39", "url": "https://github.com/apache/lucene-solr/commit/5d7b3e714f08479a10d868ce7da428450d03ae39", "message": "avoid O(n) while copying, fixing the precommit errors introduced during merge", "committedDate": "2020-06-10T07:19:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODAzODU1OQ==", "url": "https://github.com/apache/lucene-solr/pull/1542#discussion_r438038559", "bodyText": "Tradeoff with this one time matrix walk and copy is that we copy all nodes, even those that might not be needed (because not present in parameter nodes). I do like the approach though it's cleaner than the code I wrote.\nMaybe keep this initial loop but just store Row references, then do the copy below when newRow is needed? (there's already an if bloc when it's null, so copy action can easily be placed in else bloc).", "author": "murblanc", "createdAt": "2020-06-10T11:01:03Z", "path": "solr/solrj/src/java/org/apache/solr/client/solrj/cloud/autoscaling/Policy.java", "diffHunk": "@@ -644,15 +643,13 @@ public Session cloneToNewSession(SolrCloudManager cloudManager) {\n       List<Clause> expandedClauses = new ArrayList<>(this.expandedClauses);\n \n       List<Row> matrix = new ArrayList<>(nodes.size());\n+      Map<String, Row> copyNodes = new HashMap<>();\n+      for (Row oldRow: this.matrix) {", "originalCommit": "5d7b3e714f08479a10d868ce7da428450d03ae39", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODA0MzA1OQ==", "url": "https://github.com/apache/lucene-solr/pull/1542#discussion_r438043059", "bodyText": "even those that might not be needed\n\nI believe it's a reasonable tradeoff because most of the times nodes do not go away. Yes, we make an extra copy in those rare occasions, but it should be OK.", "author": "noblepaul", "createdAt": "2020-06-10T11:10:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODAzODU1OQ=="}], "type": "inlineReview"}]}