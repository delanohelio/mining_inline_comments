{"pr_number": 1707, "pr_title": "SOLR-14692: Allow 'method' specification on JSON Facet join domain transforms", "pr_createdAt": "2020-07-30T21:02:13Z", "pr_url": "https://github.com/apache/lucene-solr/pull/1707", "timeline": [{"oid": "0840f6fafbf9f21388f8c93ccfb839e623dfd444", "url": "https://github.com/apache/lucene-solr/commit/0840f6fafbf9f21388f8c93ccfb839e623dfd444", "message": "Plumb 'method' parameter over to JoinQParserPlugin.createJoinQuery", "committedDate": "2020-07-30T15:50:52Z", "type": "commit"}, {"oid": "83d0f6d59ee01c92ad30fd03cfaa7a50ac95e87a", "url": "https://github.com/apache/lucene-solr/commit/83d0f6d59ee01c92ad30fd03cfaa7a50ac95e87a", "message": "Obey 'method' parameter passed into JoinQParserPlugin.createJoinQuery\n\nRemaining todo items before this effort is fit for merging:\n  - tests\n  - figure out whether method=scoreWithDV is fit for use\n  - figure out whether method=crossCollection is fit for use\n  - figure out whether method=topLevelDV uses TPI by default or whether\n    we should be tweaking the query params there in some way to force\n    TPI behavior", "committedDate": "2020-07-30T20:56:45Z", "type": "commit"}, {"oid": "64b723227410f1e401fb945314989361e54b6c3d", "url": "https://github.com/apache/lucene-solr/commit/64b723227410f1e401fb945314989361e54b6c3d", "message": "Improve invalid-method error message", "committedDate": "2020-07-31T14:45:20Z", "type": "commit"}, {"oid": "71dadd916540381987a21124e9b2262c84a5963a", "url": "https://github.com/apache/lucene-solr/commit/71dadd916540381987a21124e9b2262c84a5963a", "message": "Correct out-of-date input validation", "committedDate": "2020-07-31T14:46:09Z", "type": "commit"}, {"oid": "efbdfc9e50280ca44647698c13bffaf82342a594", "url": "https://github.com/apache/lucene-solr/commit/efbdfc9e50280ca44647698c13bffaf82342a594", "message": "Add join-domain support for 'dvWithScore' method", "committedDate": "2020-07-31T15:58:59Z", "type": "commit"}, {"oid": "af3607f59bd406030a0f126477b002297812edf7", "url": "https://github.com/apache/lucene-solr/commit/af3607f59bd406030a0f126477b002297812edf7", "message": "Use JoinField constants more widely", "committedDate": "2020-07-31T16:01:46Z", "type": "commit"}, {"oid": "8424a1cba4c06150ff9f63f384190d6179ca70f6", "url": "https://github.com/apache/lucene-solr/commit/8424a1cba4c06150ff9f63f384190d6179ca70f6", "message": "Add unit tests for new 'method' join domain property", "committedDate": "2020-07-31T17:24:12Z", "type": "commit"}, {"oid": "0cfb49ae5ed59a8d32be291ef39e139ae752323e", "url": "https://github.com/apache/lucene-solr/commit/0cfb49ae5ed59a8d32be291ef39e139ae752323e", "message": "Document 'method' Join domain-change property", "committedDate": "2020-07-31T17:42:55Z", "type": "commit"}, {"oid": "703ba5a1f1b669edf88a9b623fe1d95b212a3835", "url": "https://github.com/apache/lucene-solr/commit/703ba5a1f1b669edf88a9b623fe1d95b212a3835", "message": "Fix unused import", "committedDate": "2020-07-31T18:25:50Z", "type": "commit"}, {"oid": "d0ef72236e71113066b92dfbfa9da0fc876537f9", "url": "https://github.com/apache/lucene-solr/commit/d0ef72236e71113066b92dfbfa9da0fc876537f9", "message": "Fix precommit: String.format", "committedDate": "2020-07-31T18:31:19Z", "type": "commit"}, {"oid": "5a4442942e878285d1b28f2636d51507648175dc", "url": "https://github.com/apache/lucene-solr/commit/5a4442942e878285d1b28f2636d51507648175dc", "message": "Fix precommit: bad ref-guide target", "committedDate": "2020-07-31T18:51:43Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzk0NDc2MQ==", "url": "https://github.com/apache/lucene-solr/pull/1707#discussion_r463944761", "bodyText": "I think this could be reused by creating static enumSet", "author": "munendrasn", "createdAt": "2020-08-01T09:39:10Z", "path": "solr/core/src/java/org/apache/solr/search/JoinQParserPlugin.java", "diffHunk": "@@ -182,9 +203,34 @@ public Query parse() throws SyntaxError {\n    * @param subQuery the query to define the starting set of documents on the \"left side\" of the join\n    * @param fromField \"left side\" field name to use in the join\n    * @param toField \"right side\" field name to use in the join\n+   * @param method indicates which implementation should be used to process the join.  Currently only 'index',\n+   *               'dvWithScore', and 'topLevelDV' are supported.\n    */\n-  public static Query createJoinQuery(Query subQuery, String fromField, String toField) {\n-    return new JoinQuery(fromField, toField, null, subQuery);\n+  public static Query createJoinQuery(Query subQuery, String fromField, String toField, String method) {\n+    final EnumSet<Method> methodWhitelist = EnumSet.of(Method.index, Method.topLevelDV, Method.dvWithScore);", "originalCommit": "5a4442942e878285d1b28f2636d51507648175dc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzk0NDg5NA==", "url": "https://github.com/apache/lucene-solr/pull/1707#discussion_r463944894", "bodyText": "these variables could be package-private or preferably private", "author": "munendrasn", "createdAt": "2020-08-01T09:40:35Z", "path": "solr/core/src/java/org/apache/solr/search/facet/FacetRequest.java", "diffHunk": "@@ -163,15 +166,23 @@ public boolean canBecomeNonEmpty() {\n \n     /** Are we doing a query time join across other documents */\n     public static class JoinField {\n+      public static final String FROM_PARAM = \"from\";\n+      public static final String TO_PARAM = \"to\";\n+      public static final String METHOD_PARAM = \"method\";\n+      public static final Set<String> SUPPORTED_JOIN_PROPERTIES = Sets.newHashSet(FROM_PARAM, TO_PARAM, METHOD_PARAM);", "originalCommit": "5a4442942e878285d1b28f2636d51507648175dc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "0f156c5904f7475accec321c6455d773b5194177", "url": "https://github.com/apache/lucene-solr/commit/0f156c5904f7475accec321c6455d773b5194177", "message": "Address review comments, rd 1", "committedDate": "2020-08-11T11:14:53Z", "type": "commit"}, {"oid": "9c015e6903f7e48c6fd593ed807b56ab9d8288e7", "url": "https://github.com/apache/lucene-solr/commit/9c015e6903f7e48c6fd593ed807b56ab9d8288e7", "message": "Merge branch 'master' into SOLR_14692_support_method_param_on_facetings_join_domain_transform", "committedDate": "2020-08-11T11:16:36Z", "type": "commit"}]}