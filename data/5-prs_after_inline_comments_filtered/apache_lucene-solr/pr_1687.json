{"pr_number": 1687, "pr_title": "SOLR-14658: Fix colstatus solrj interfaces to return one or all collections", "pr_createdAt": "2020-07-22T18:50:50Z", "pr_url": "https://github.com/apache/lucene-solr/pull/1687", "timeline": [{"oid": "3b01acae16ac5ba2fe9d8282566498ef8311e2f3", "url": "https://github.com/apache/lucene-solr/commit/3b01acae16ac5ba2fe9d8282566498ef8311e2f3", "message": "Fix colstatus solrj interfaces to return one or all collections", "committedDate": "2020-07-22T18:35:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTAxMTMxMA==", "url": "https://github.com/apache/lucene-solr/pull/1687#discussion_r459011310", "bodyText": "Removed this because it's not documented in the API anyway and the CoreAdminParams.NAME isn't copied anyway.", "author": "andyvuong", "createdAt": "2020-07-22T18:51:59Z", "path": "solr/core/src/java/org/apache/solr/handler/admin/CollectionsHandler.java", "diffHunk": "@@ -517,10 +517,7 @@ private static void addStatusToResponse(NamedList<Object> results, RequestStatus\n           ColStatus.RAW_SIZE_DETAILS_PROP,\n           ColStatus.RAW_SIZE_SAMPLING_PERCENT_PROP,\n           ColStatus.SIZE_INFO_PROP);\n-      // make sure we can get the name if there's \"name\" but not \"collection\"\n-      if (props.containsKey(CoreAdminParams.NAME) && !props.containsKey(COLLECTION_PROP)) {", "originalCommit": "3b01acae16ac5ba2fe9d8282566498ef8311e2f3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDMxMjQ1Ng==", "url": "https://github.com/apache/lucene-solr/pull/1687#discussion_r474312456", "bodyText": "CC @sigram I believe you added the lines of code here that Andy thinks should be removed.", "author": "dsmiley", "createdAt": "2020-08-20T22:45:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTAxMTMxMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTAxMjk4Nw==", "url": "https://github.com/apache/lucene-solr/pull/1687#discussion_r459012987", "bodyText": "AsyncCollectionSpecificAdminRequest enforces a non-null collection name passed in which doesn't work if the solrj colstatus interface's intention is to allow either one collection return or all collections returned as documented in the collection api doc. If no collection = null, i.e. empty, then collectionshandler will treat it as returning all collections staying consistent with the documented api.", "author": "andyvuong", "createdAt": "2020-07-22T18:54:50Z", "path": "solr/solrj/src/java/org/apache/solr/client/solrj/request/CollectionAdminRequest.java", "diffHunk": "@@ -863,13 +863,23 @@ public SolrParams getParams() {\n   }\n \n   /**\n-   * Return a SolrRequest for low-level detailed status of the collection.\n+   * Return a SolrRequest for low-level detailed status of the specified collection. \n+   * @param collection the collection to get the status of.\n    */\n   public static ColStatus collectionStatus(String collection) {\n+    checkNotNull(CoreAdminParams.COLLECTION, collection);\n     return new ColStatus(collection);\n   }\n+  \n+  /**\n+   * Return a SolrRequest for low-level detailed status of all collections on the cluster.\n+   */\n+  public static ColStatus collectionStatuses() {\n+    return new ColStatus();\n+  }\n \n-  public static class ColStatus extends AsyncCollectionSpecificAdminRequest {", "originalCommit": "3b01acae16ac5ba2fe9d8282566498ef8311e2f3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDMxMDczNw==", "url": "https://github.com/apache/lucene-solr/pull/1687#discussion_r474310737", "bodyText": "please convert to expectThrows", "author": "dsmiley", "createdAt": "2020-08-20T22:40:36Z", "path": "solr/core/src/test/org/apache/solr/cloud/CollectionsAPISolrJTest.java", "diffHunk": "@@ -662,6 +662,44 @@ public void testColStatus() throws Exception {\n     Number down = (Number) rsp.getResponse().findRecursive(collectionName, \"shards\", \"shard1\", \"replicas\", \"down\");\n     assertTrue(\"should be some down replicas, but there were none in shard1:\" + rsp, down.intValue() > 0);\n   }\n+  \n+  @Test\n+  public void testColStatusCollectionName() throws Exception {\n+    final String[] collectionNames = {\"collectionStatusTest_1\", \"collectionStatusTest_2\"};\n+    for (String collectionName : collectionNames) {\n+      CollectionAdminRequest.createCollection(collectionName, \"conf2\", 1, 1)\n+      .process(cluster.getSolrClient());\n+      cluster.waitForActiveCollection(collectionName, 1, 1);\n+    }\n+    // assert only one collection is returned using the solrj colstatus interface\n+    CollectionAdminRequest.ColStatus req = CollectionAdminRequest.collectionStatus(collectionNames[0]);\n+    CollectionAdminResponse rsp = req.process(cluster.getSolrClient());\n+    assertNotNull(rsp.getResponse().get(collectionNames[0]));\n+    assertNull(rsp.getResponse().get(collectionNames[1]));\n+   \n+    req = CollectionAdminRequest.collectionStatus(collectionNames[1]);\n+    rsp = req.process(cluster.getSolrClient());\n+    assertNotNull(rsp.getResponse().get(collectionNames[1]));\n+    assertNull(rsp.getResponse().get(collectionNames[0]));\n+    \n+    // assert passing null collection fails\n+    try {", "originalCommit": "3b01acae16ac5ba2fe9d8282566498ef8311e2f3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "72122a694b14112170949b18d707242ba0342bed", "url": "https://github.com/apache/lucene-solr/commit/72122a694b14112170949b18d707242ba0342bed", "message": "Merge branch 'master' into jira/SOLR-14658", "committedDate": "2020-09-03T07:25:23Z", "type": "commit"}, {"oid": "ea4c037348e4606921dca2f0f1da79f0fe7c69a5", "url": "https://github.com/apache/lucene-solr/commit/ea4c037348e4606921dca2f0f1da79f0fe7c69a5", "message": "Fix exception check and add change item", "committedDate": "2020-09-03T18:09:20Z", "type": "commit"}, {"oid": "a948e944571c492b632e3c02a47511cd32bf038f", "url": "https://github.com/apache/lucene-solr/commit/a948e944571c492b632e3c02a47511cd32bf038f", "message": "fix", "committedDate": "2020-09-03T18:16:28Z", "type": "commit"}, {"oid": "1e4c10a6f18b338bd096bab96a655516afd9f942", "url": "https://github.com/apache/lucene-solr/commit/1e4c10a6f18b338bd096bab96a655516afd9f942", "message": "Merge branch 'master' into jira/SOLR-14658", "committedDate": "2020-09-03T18:21:48Z", "type": "commit"}]}