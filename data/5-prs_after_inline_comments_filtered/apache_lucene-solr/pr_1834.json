{"pr_number": 1834, "pr_title": "Make sure to test normal scorers with asserting wrappers.", "pr_createdAt": "2020-09-04T23:00:00Z", "pr_url": "https://github.com/apache/lucene-solr/pull/1834", "timeline": [{"oid": "1a007aaa6c72faa35426a69418ab57233eb4ac3c", "url": "https://github.com/apache/lucene-solr/commit/1a007aaa6c72faa35426a69418ab57233eb4ac3c", "message": "Make sure to test normal scorers with asserting wrappers.", "committedDate": "2020-09-05T00:51:33Z", "type": "commit"}, {"oid": "1a007aaa6c72faa35426a69418ab57233eb4ac3c", "url": "https://github.com/apache/lucene-solr/commit/1a007aaa6c72faa35426a69418ab57233eb4ac3c", "message": "Make sure to test normal scorers with asserting wrappers.", "committedDate": "2020-09-05T00:51:33Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzk2NzgyMg==", "url": "https://github.com/apache/lucene-solr/pull/1834#discussion_r483967822", "bodyText": "I know of several tests that test first with a top-level query and then with a filter to make sure that both the bulk scorer and the scorer are tested. With this change, 50% of the time, we wouldn't be testing the bulk scorer, so I wonder if we should replace random.nextBoolean() with frequently() or something like that.", "author": "jpountz", "createdAt": "2020-09-05T16:53:30Z", "path": "lucene/test-framework/src/java/org/apache/lucene/search/AssertingWeight.java", "diffHunk": "@@ -85,11 +85,18 @@ public long cost() {\n \n   @Override\n   public BulkScorer bulkScorer(LeafReaderContext context) throws IOException {\n-    BulkScorer inScorer = in.bulkScorer(context);\n+    BulkScorer inScorer;\n+    // We explicitly test both the delegate's bulk scorer, and also the normal scorer.\n+    // This ensures that normal scorers are sometimes tested with an asserting wrapper.\n+    if (random.nextBoolean()) {\n+      inScorer = in.bulkScorer(context);\n+    } else {\n+      inScorer = super.bulkScorer(context);\n+    }", "originalCommit": "1a007aaa6c72faa35426a69418ab57233eb4ac3c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTA1NTkyOQ==", "url": "https://github.com/apache/lucene-solr/pull/1834#discussion_r485055929", "bodyText": "That makes sense to me, I can reduce the frequency with which we take the Scorer path.\nI didn't know about the practice of testing both with a top-level query and a filter. To me this change is still valuable, it ensures we check the scorer/ iterator contract sometimes in a clear + solid way.", "author": "jtibshirani", "createdAt": "2020-09-08T16:39:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzk2NzgyMg=="}], "type": "inlineReview"}, {"oid": "1829abe99195ed5205876ffc7d0cf7a6056ba010", "url": "https://github.com/apache/lucene-solr/commit/1829abe99195ed5205876ffc7d0cf7a6056ba010", "message": "Decrease the frequency for testing Scorer directly.", "committedDate": "2020-09-08T16:53:23Z", "type": "commit"}, {"oid": "a444e75015869015bf4602895449036f05bd87a8", "url": "https://github.com/apache/lucene-solr/commit/a444e75015869015bf4602895449036f05bd87a8", "message": "Merge remote-tracking branch 'upstream/master' into asserting-scorer", "committedDate": "2020-09-08T17:01:50Z", "type": "commit"}, {"oid": "c630178dd3e9a66c13ed43ee3798b081d99ecf43", "url": "https://github.com/apache/lucene-solr/commit/c630178dd3e9a66c13ed43ee3798b081d99ecf43", "message": "Update changelog entry.", "committedDate": "2020-09-08T17:01:57Z", "type": "commit"}, {"oid": "eb7de9c24e00b59723b258625bc2988c6268adb9", "url": "https://github.com/apache/lucene-solr/commit/eb7de9c24e00b59723b258625bc2988c6268adb9", "message": "Clarify changelog entry.", "committedDate": "2020-09-14T15:43:00Z", "type": "commit"}]}