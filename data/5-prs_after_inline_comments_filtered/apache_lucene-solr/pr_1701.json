{"pr_number": 1701, "pr_title": "SOLR-14671: Parsing dynamic ZK config sometimes cause NuberFormatException", "pr_createdAt": "2020-07-27T23:50:54Z", "pr_url": "https://github.com/apache/lucene-solr/pull/1701", "timeline": [{"oid": "ada61d60403ab3e0e3c235547ce08405aece5a2a", "url": "https://github.com/apache/lucene-solr/commit/ada61d60403ab3e0e3c235547ce08405aece5a2a", "message": "SOLR-14671: Parsing dynamic ZK config sometimes cause NuberFormatException", "committedDate": "2020-07-27T23:38:00Z", "type": "commit"}, {"oid": "466d883fbfb9fbc626e964a44d3394fcfec766ac", "url": "https://github.com/apache/lucene-solr/commit/466d883fbfb9fbc626e964a44d3394fcfec766ac", "message": "Better test", "committedDate": "2020-07-27T23:50:22Z", "type": "commit"}, {"oid": "6328d2053b8b87309d2c2a55cfcf8ba3ff267818", "url": "https://github.com/apache/lucene-solr/commit/6328d2053b8b87309d2c2a55cfcf8ba3ff267818", "message": "Handle case where dynamic config does not include client port (which is only present in server-side static config)\nIn that case we'll iterate hosts from connection string instead of from dynamic config", "committedDate": "2020-07-28T09:41:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTQ2MTAxNQ==", "url": "https://github.com/apache/lucene-solr/pull/1701#discussion_r461461015", "bodyText": "This is not bullet proof if e.g. user has clientPort=1234 in zoo.cfg and in zkHost connection string. Then we'll add a warning that dynamic config differs from zkHost, which is not entirely true since we just lack the port part. We have no way from client to read the clientPort from server except from connecting to the server with 4LW ont the clientPort which is a chicken and egg. This hack will make the comparison work for default port, which is a compromise.", "author": "janhoy", "createdAt": "2020-07-28T09:52:38Z", "path": "solr/core/src/java/org/apache/solr/handler/admin/ZookeeperStatusHandler.java", "diffHunk": "@@ -112,15 +112,21 @@ public void handleRequestBody(SolrQueryRequest req, SolrQueryResponse rsp) throw\n           .map(h -> h.resolveClientPortAddress() + \":\" + h.clientPort)\n           .sorted().collect(Collectors.toList());\n       List<String> dynamicHosts = zkDynamicConfig.getServers().stream()\n-          .map(h -> h.resolveClientPortAddress() + \":\" + h.clientPort)\n+          .map(h -> h.resolveClientPortAddress() + \":\" + (h.clientPort != null ? h.clientPort : \"2181\"))", "originalCommit": "6328d2053b8b87309d2c2a55cfcf8ba3ff267818", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTc3NzE3Mg==", "url": "https://github.com/apache/lucene-solr/pull/1701#discussion_r461777172", "bodyText": "Maybe instead of defaulting to 2181, we default to hostsFromConnectionString.getServers().get(0).clientPort? I imagine that would match a vast majority of scenarios.", "author": "HoustonPutman", "createdAt": "2020-07-28T18:12:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTQ2MTAxNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjEyODkzMA==", "url": "https://github.com/apache/lucene-solr/pull/1701#discussion_r462128930", "bodyText": "Agree, I'll do that change and merge", "author": "janhoy", "createdAt": "2020-07-29T08:28:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTQ2MTAxNQ=="}], "type": "inlineReview"}, {"oid": "5593b7e437ecd55f99170364112c0fd96d71ede9", "url": "https://github.com/apache/lucene-solr/commit/5593b7e437ecd55f99170364112c0fd96d71ede9", "message": "Use first port from zkHost as fallback instead of 2181", "committedDate": "2020-07-29T08:28:16Z", "type": "commit"}]}