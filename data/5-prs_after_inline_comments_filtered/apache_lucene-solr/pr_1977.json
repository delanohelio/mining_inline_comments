{"pr_number": 1977, "pr_title": "SOLR-14907: Support single file upload/overwrite in configSet API", "pr_createdAt": "2020-10-12T17:32:10Z", "pr_url": "https://github.com/apache/lucene-solr/pull/1977", "timeline": [{"oid": "9e73f4042a64d50a4204768bec474d70ceadaf54", "url": "https://github.com/apache/lucene-solr/commit/9e73f4042a64d50a4204768bec474d70ceadaf54", "message": "SOLR-14907: Support single file upload/overwrite in configSet API", "committedDate": "2020-10-12T17:27:51Z", "type": "commit"}, {"oid": "5d45fac6cb4cf116d0cb2d067812514d4133c7e7", "url": "https://github.com/apache/lucene-solr/commit/5d45fac6cb4cf116d0cb2d067812514d4133c7e7", "message": "Fix filePath parameter in tests.", "committedDate": "2020-10-12T18:14:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzU2NzE3OQ==", "url": "https://github.com/apache/lucene-solr/pull/1977#discussion_r503567179", "bodyText": "should we error instead of silently ignoring the cleanup param? it defaults to false, so someone must have explicitly set it to true", "author": "tflobbe", "createdAt": "2020-10-12T22:34:50Z", "path": "solr/core/src/java/org/apache/solr/handler/admin/ConfigSetsHandler.java", "diffHunk": "@@ -170,10 +170,14 @@ private void handleConfigUploadRequest(SolrQueryRequest req, SolrQueryResponse r\n \n     boolean overwritesExisting = zkClient.exists(configPathInZk, true);\n \n-    if (overwritesExisting && !req.getParams().getBool(ConfigSetParams.OVERWRITE, false)) {\n-      throw new SolrException(ErrorCode.BAD_REQUEST,\n-          \"The configuration \" + configSetName + \" already exists in zookeeper\");\n-    }\n+    // Get upload parameters\n+    String singleFilePath = req.getParams().get(ConfigSetParams.FILE_PATH, \"\");\n+    boolean allowOverwrite = req.getParams().getBool(ConfigSetParams.OVERWRITE, false);\n+    // Cleanup is not allowed while using singleFilePath upload\n+    boolean cleanup = singleFilePath.isEmpty() && req.getParams().getBool(ConfigSetParams.CLEANUP, false);", "originalCommit": "5d45fac6cb4cf116d0cb2d067812514d4133c7e7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzU4MDE4OQ==", "url": "https://github.com/apache/lucene-solr/pull/1977#discussion_r503580189", "bodyText": "Added error handling for that and cases where a bad filePath is given.", "author": "HoustonPutman", "createdAt": "2020-10-12T23:16:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzU2NzE3OQ=="}], "type": "inlineReview"}, {"oid": "dbfc89e2183ca54a6b01fa3b918e94ded4cca929", "url": "https://github.com/apache/lucene-solr/commit/dbfc89e2183ca54a6b01fa3b918e94ded4cca929", "message": "Adding extra error handling.", "committedDate": "2020-10-12T23:15:34Z", "type": "commit"}, {"oid": "bc37f0fa49e395a942b2b9fbacf342faa1d03bda", "url": "https://github.com/apache/lucene-solr/commit/bc37f0fa49e395a942b2b9fbacf342faa1d03bda", "message": "Update configsets-api.adoc", "committedDate": "2020-10-12T23:18:34Z", "type": "commit"}, {"oid": "1ae14110391fbd2d2ceb6d2a295296f1402bcffa", "url": "https://github.com/apache/lucene-solr/commit/1ae14110391fbd2d2ceb6d2a295296f1402bcffa", "message": "Moved creation of baseZnode after error checking for security purposes.", "committedDate": "2020-10-12T23:26:30Z", "type": "commit"}, {"oid": "a58a9dd874cfd900ed1dd9bc216ae0629c9abc5f", "url": "https://github.com/apache/lucene-solr/commit/a58a9dd874cfd900ed1dd9bc216ae0629c9abc5f", "message": "Securing configSets on badZip upload.", "committedDate": "2020-10-12T23:53:58Z", "type": "commit"}, {"oid": "34c22a074511b4e34d01469db9354684f6d53155", "url": "https://github.com/apache/lucene-solr/commit/34c22a074511b4e34d01469db9354684f6d53155", "message": "Adding docs for overwrite with filePath.", "committedDate": "2020-10-13T18:36:41Z", "type": "commit"}]}