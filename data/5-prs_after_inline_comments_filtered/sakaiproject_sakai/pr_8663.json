{"pr_number": 8663, "pr_title": "SAK-44353 Group Manager and Date Manager do not change idiom", "pr_createdAt": "2020-10-08T10:30:20Z", "pr_url": "https://github.com/sakaiproject/sakai/pull/8663", "timeline": [{"oid": "7dfaa176a86dd94ce5ed78347acf172d67a09aa7", "url": "https://github.com/sakaiproject/sakai/commit/7dfaa176a86dd94ce5ed78347acf172d67a09aa7", "message": "SAK-44353 Group Manager and Date Manager do not change idiom\n\n\nSAK-44353 Group Manager and Date Manager do not change idiom", "committedDate": "2020-10-08T10:39:57Z", "type": "forcePushed"}, {"oid": "720d60314fea29ced972b2739e0317c338526e8d", "url": "https://github.com/sakaiproject/sakai/commit/720d60314fea29ced972b2739e0317c338526e8d", "message": "SAK-44353 Group Manager and Date Manager do not change idiom\n\n\nSAK-44353 Group Manager and Date Manager do not change idiom\n\n\nSAK-44353 Group Manager and Date Manager do not change idiom", "committedDate": "2020-10-08T13:31:23Z", "type": "forcePushed"}, {"oid": "ff9f37d72a3f019e8636ec9026589af1e0a83f0b", "url": "https://github.com/sakaiproject/sakai/commit/ff9f37d72a3f019e8636ec9026589af1e0a83f0b", "message": "SAK-44353 Group Manager and Date Manager do not change idiom\n\n\nSAK-44353 Group Manager and Date Manager do not change idiom\n\n\nSAK-44353 Group Manager and Date Manager do not change idiom\n\n\nSAK-44353 Group Manager and Date Manager do not change idiom", "committedDate": "2020-10-08T13:34:11Z", "type": "forcePushed"}, {"oid": "06b6ea84f5c6d5ca25f7a5e0d994b01c6b3b8c0b", "url": "https://github.com/sakaiproject/sakai/commit/06b6ea84f5c6d5ca25f7a5e0d994b01c6b3b8c0b", "message": "SAK-44353 Group Manager and Date Manager do not change idiom\n\n\nSAK-44353 Group Manager and Date Manager do not change idiom\n\n\nSAK-44353 Group Manager and Date Manager do not change idiom\n\n\nSAK-44353 Group Manager and Date Manager do not change idiom\n\n\nSAK-44353 Group Manager and Date Manager do not change idiom", "committedDate": "2020-10-08T13:38:03Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODMxMDM3NA==", "url": "https://github.com/sakaiproject/sakai/pull/8663#discussion_r508310374", "bodyText": "need spaces around the !=", "author": "adrianfish", "createdAt": "2020-10-20T08:31:22Z", "path": "site-manage/datemanager/tool/src/main/java/org/sakaiproject/datemanager/tool/MainController.java", "diffHunk": "@@ -47,10 +52,29 @@\n @Controller\n public class MainController {\n \n-\t@Inject private DateManagerService dateManagerService;\n-\n-\t@RequestMapping(value = {\"/\", \"/index\"}, method = RequestMethod.GET)\n-\tpublic String showIndex(@RequestParam(required=false) String code, Model model) {\n+    @Inject private DateManagerService dateManagerService;\n+\t\n+    @Autowired\n+    private SessionManager sessionManager;\n+    \n+    @Autowired\n+    private PreferencesService preferencesService;\n+\n+    @RequestMapping(value = {\"/\", \"/index\"}, method = RequestMethod.GET)\n+    public String showIndex(@RequestParam(required=false) String code, Model model, HttpServletRequest request, HttpServletResponse response) {\n+\t\t\n+        Locale.setDefault(Locale.US);\n+        String userId = sessionManager.getCurrentSessionUserId();\n+        Locale loc = null;\n+        if (userId!=null) {", "originalCommit": "06b6ea84f5c6d5ca25f7a5e0d994b01c6b3b8c0b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODMxNDgwMA==", "url": "https://github.com/sakaiproject/sakai/pull/8663#discussion_r508314800", "bodyText": "This is an anti pattern. You should never need to do this as Locale.getDefault picks up the settings from the JVM.", "author": "adrianfish", "createdAt": "2020-10-20T08:37:53Z", "path": "site-manage/datemanager/tool/src/main/java/org/sakaiproject/datemanager/tool/MainController.java", "diffHunk": "@@ -47,10 +52,29 @@\n @Controller\n public class MainController {\n \n-\t@Inject private DateManagerService dateManagerService;\n-\n-\t@RequestMapping(value = {\"/\", \"/index\"}, method = RequestMethod.GET)\n-\tpublic String showIndex(@RequestParam(required=false) String code, Model model) {\n+    @Inject private DateManagerService dateManagerService;\n+\t\n+    @Autowired\n+    private SessionManager sessionManager;\n+    \n+    @Autowired\n+    private PreferencesService preferencesService;\n+\n+    @RequestMapping(value = {\"/\", \"/index\"}, method = RequestMethod.GET)\n+    public String showIndex(@RequestParam(required=false) String code, Model model, HttpServletRequest request, HttpServletResponse response) {\n+\t\t\n+        Locale.setDefault(Locale.US);", "originalCommit": "06b6ea84f5c6d5ca25f7a5e0d994b01c6b3b8c0b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDE4NDg2MA==", "url": "https://github.com/sakaiproject/sakai/pull/8663#discussion_r510184860", "bodyText": "or even more so get it from the PreferencesService", "author": "ern", "createdAt": "2020-10-22T13:59:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODMxNDgwMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODMxNTM1Nw==", "url": "https://github.com/sakaiproject/sakai/pull/8663#discussion_r508315357", "bodyText": "Should use loc = Locale.getDefault() here.", "author": "adrianfish", "createdAt": "2020-10-20T08:38:43Z", "path": "site-manage/datemanager/tool/src/main/java/org/sakaiproject/datemanager/tool/MainController.java", "diffHunk": "@@ -47,10 +52,29 @@\n @Controller\n public class MainController {\n \n-\t@Inject private DateManagerService dateManagerService;\n-\n-\t@RequestMapping(value = {\"/\", \"/index\"}, method = RequestMethod.GET)\n-\tpublic String showIndex(@RequestParam(required=false) String code, Model model) {\n+    @Inject private DateManagerService dateManagerService;\n+\t\n+    @Autowired\n+    private SessionManager sessionManager;\n+    \n+    @Autowired\n+    private PreferencesService preferencesService;\n+\n+    @RequestMapping(value = {\"/\", \"/index\"}, method = RequestMethod.GET)\n+    public String showIndex(@RequestParam(required=false) String code, Model model, HttpServletRequest request, HttpServletResponse response) {\n+\t\t\n+        Locale.setDefault(Locale.US);\n+        String userId = sessionManager.getCurrentSessionUserId();\n+        Locale loc = null;\n+        if (userId!=null) {\n+            loc = preferencesService.getLocale(userId);\n+        } else {\n+            loc = Locale.US;", "originalCommit": "06b6ea84f5c6d5ca25f7a5e0d994b01c6b3b8c0b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODMyMDkyOQ==", "url": "https://github.com/sakaiproject/sakai/pull/8663#discussion_r508320929", "bodyText": "I'm pretty sure you can just replace all this with ResourceLoaderMessageSource.\n@bean\npublic MessageSource messageSource() {\nResourceLoaderMessageSource messages = new ResourceLoaderMessageSource();\nmessages.setBasename(\"Messages\");\nreturn messages;\n}\nTake a look at:\nsite/sakai-message-bundle-manager-tool/src/main/java/org/sakaiproject/mbm/ThymeleafConfig.java", "author": "adrianfish", "createdAt": "2020-10-20T08:46:47Z", "path": "site-manage/datemanager/tool/src/main/java/org/sakaiproject/datemanager/ThymeleafConfig.java", "diffHunk": "@@ -76,4 +81,23 @@ private ITemplateResolver templateResolver() {\n \t\ttemplateResolver.setTemplateMode(TemplateMode.HTML);\n \t\treturn templateResolver;\n \t}\n+\t\n+    @Bean\n+\tpublic LocaleResolver localeResolver() {\n+\t    SessionLocaleResolver slr = new SessionLocaleResolver();\n+\t    slr.setDefaultLocale(Locale.US);\n+\t    return slr;\n+\t}\n+    \n+    @Bean\n+\tpublic LocaleChangeInterceptor localeChangeInterceptor() {\n+\t    LocaleChangeInterceptor lci = new LocaleChangeInterceptor();\n+\t    lci.setParamName(\"lang\");\n+\t    return lci;\n+\t}\n+    \n+    @Override\n+\tpublic void addInterceptors(InterceptorRegistry registry) {\n+\t    registry.addInterceptor(localeChangeInterceptor());\n+\t}", "originalCommit": "06b6ea84f5c6d5ca25f7a5e0d994b01c6b3b8c0b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "b96739ad00943efc74623a686ca1ac2820b32d32", "url": "https://github.com/sakaiproject/sakai/commit/b96739ad00943efc74623a686ca1ac2820b32d32", "message": "SAK-44353 Group Manager and Date Manager do not change idiom\n\n\nSAK-44353 Group Manager and Date Manager do not change idiom\n\n\nSAK-44353 Group Manager and Date Manager do not change idiom\n\n\nSAK-44353 Group Manager and Date Manager do not change idiom\n\n\nSAK-44353 Group Manager and Date Manager do not change idiom\n\n\nSAK-44353 Group Manager and Date Manager do not change idiom", "committedDate": "2020-10-23T09:40:02Z", "type": "forcePushed"}, {"oid": "dd7b46a8da55648d3accd50c73f875b583e46e98", "url": "https://github.com/sakaiproject/sakai/commit/dd7b46a8da55648d3accd50c73f875b583e46e98", "message": "SAK-44353 Group Manager and Date Manager do not change idiom\n\n\nSAK-44353 Group Manager and Date Manager do not change idiom\n\n\nSAK-44353 Group Manager and Date Manager do not change idiom\n\n\nSAK-44353 Group Manager and Date Manager do not change idiom\n\n\nSAK-44353 Group Manager and Date Manager do not change idiom\n\n\nSAK-44353 Group Manager and Date Manager do not change idiom\n\n\nSAK-44353 Group Manager and Date Manager do not change idiom", "committedDate": "2020-10-23T09:41:41Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjgxMDkwNw==", "url": "https://github.com/sakaiproject/sakai/pull/8663#discussion_r516810907", "bodyText": "final Locale loc = StringUtils.isNotBlank(userId) ? preferencesService.getLocale(userId) : Locale.getDefault();", "author": "adrianfish", "createdAt": "2020-11-03T16:47:59Z", "path": "site-manage/datemanager/tool/src/main/java/org/sakaiproject/datemanager/tool/MainController.java", "diffHunk": "@@ -47,10 +52,28 @@\n @Controller\n public class MainController {\n \n-\t@Inject private DateManagerService dateManagerService;\n-\n-\t@RequestMapping(value = {\"/\", \"/index\"}, method = RequestMethod.GET)\n-\tpublic String showIndex(@RequestParam(required=false) String code, Model model) {\n+    @Inject private DateManagerService dateManagerService;\n+\t\n+    @Autowired\n+    private SessionManager sessionManager;\n+    \n+    @Autowired\n+    private PreferencesService preferencesService;\n+\n+    @RequestMapping(value = {\"/\", \"/index\"}, method = RequestMethod.GET)\n+    public String showIndex(@RequestParam(required=false) String code, Model model, HttpServletRequest request, HttpServletResponse response) {\n+\n+        String userId = sessionManager.getCurrentSessionUserId();\n+        Locale loc = null;\n+        if (userId != null) {\n+            loc = preferencesService.getLocale(userId);\n+        } else {\n+        \tloc = Locale.getDefault();\n+        }\n+", "originalCommit": "dd7b46a8da55648d3accd50c73f875b583e46e98", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjgxMjIyMQ==", "url": "https://github.com/sakaiproject/sakai/pull/8663#discussion_r516812221", "bodyText": "Indentation seems off here.", "author": "adrianfish", "createdAt": "2020-11-03T16:49:53Z", "path": "site-manage/datemanager/tool/src/main/java/org/sakaiproject/datemanager/tool/MainController.java", "diffHunk": "@@ -47,10 +52,28 @@\n @Controller\n public class MainController {\n \n-\t@Inject private DateManagerService dateManagerService;\n-\n-\t@RequestMapping(value = {\"/\", \"/index\"}, method = RequestMethod.GET)\n-\tpublic String showIndex(@RequestParam(required=false) String code, Model model) {\n+    @Inject private DateManagerService dateManagerService;\n+\t\n+    @Autowired\n+    private SessionManager sessionManager;\n+    \n+    @Autowired\n+    private PreferencesService preferencesService;\n+\n+    @RequestMapping(value = {\"/\", \"/index\"}, method = RequestMethod.GET)\n+    public String showIndex(@RequestParam(required=false) String code, Model model, HttpServletRequest request, HttpServletResponse response) {\n+\n+        String userId = sessionManager.getCurrentSessionUserId();\n+        Locale loc = null;\n+        if (userId != null) {\n+            loc = preferencesService.getLocale(userId);\n+        } else {\n+        \tloc = Locale.getDefault();\n+        }\n+\n+        LocaleResolver localeResolver = RequestContextUtils.getLocaleResolver(request);\n+        localeResolver.setLocale(request, response, loc);\n+        ", "originalCommit": "dd7b46a8da55648d3accd50c73f875b583e46e98", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "c5b38d6e44e458a58ca5d0f337b1380f823885f1", "url": "https://github.com/sakaiproject/sakai/commit/c5b38d6e44e458a58ca5d0f337b1380f823885f1", "message": "SAK-44353 Group Manager and Date Manager do not change idiom\n\n\nSAK-44353 Group Manager and Date Manager do not change idiom\n\n\nSAK-44353 Group Manager and Date Manager do not change idiom\n\n\nSAK-44353 Group Manager and Date Manager do not change idiom\n\n\nSAK-44353 Group Manager and Date Manager do not change idiom\n\n\nSAK-44353 Group Manager and Date Manager do not change idiom\n\n\nSAK-44353 Group Manager and Date Manager do not change idiom\n\n\nSAK-44353 Group Manager and Date Manager do not change idiom", "committedDate": "2020-11-04T08:05:05Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjY1NTI0Mg==", "url": "https://github.com/sakaiproject/sakai/pull/8663#discussion_r532655242", "bodyText": "Sorry I've been neglecting this PR review \ud83d\udc4d\nWhy are you bothering to create a new locale object here? You have it already at line 67.", "author": "adrianfish", "createdAt": "2020-11-30T14:53:33Z", "path": "site-manage/datemanager/tool/src/main/java/org/sakaiproject/datemanager/tool/MainController.java", "diffHunk": "@@ -47,12 +52,24 @@\n @Controller\n public class MainController {\n \n-\t@Inject private DateManagerService dateManagerService;\n+    @Inject private DateManagerService dateManagerService;\n+\t\n+    @Autowired\n+    private SessionManager sessionManager;\n+    \n+    @Autowired\n+    private PreferencesService preferencesService;\n+\n+    @RequestMapping(value = {\"/\", \"/index\"}, method = RequestMethod.GET)\n+    public String showIndex(@RequestParam(required=false) String code, Model model, HttpServletRequest request, HttpServletResponse response) {\n+\n+        String userId = sessionManager.getCurrentSessionUserId();\n+        final Locale loc = StringUtils.isNotBlank(userId) ? preferencesService.getLocale(userId) : Locale.getDefault();\n+        LocaleResolver localeResolver = RequestContextUtils.getLocaleResolver(request);\n+        localeResolver.setLocale(request, response, loc);\n \n-\t@RequestMapping(value = {\"/\", \"/index\"}, method = RequestMethod.GET)\n-\tpublic String showIndex(@RequestParam(required=false) String code, Model model) {\n-\t\tLocale locale = dateManagerService.getUserLocale();\n-\t\tString siteId = dateManagerService.getCurrentSiteId();\n+        Locale locale = dateManagerService.getUserLocale();", "originalCommit": "c5b38d6e44e458a58ca5d0f337b1380f823885f1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzIxMjQ5OA==", "url": "https://github.com/sakaiproject/sakai/pull/8663#discussion_r533212498", "bodyText": "Good point, Adrian.\nI've made and tested the correction.\nThank you.", "author": "MRutea", "createdAt": "2020-12-01T09:26:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjY1NTI0Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjY1NjAwNg==", "url": "https://github.com/sakaiproject/sakai/pull/8663#discussion_r532656006", "bodyText": "You can use GetMapping here. Bit simpler.", "author": "adrianfish", "createdAt": "2020-11-30T14:54:32Z", "path": "site-manage/datemanager/tool/src/main/java/org/sakaiproject/datemanager/tool/MainController.java", "diffHunk": "@@ -47,12 +52,24 @@\n @Controller\n public class MainController {\n \n-\t@Inject private DateManagerService dateManagerService;\n+    @Inject private DateManagerService dateManagerService;\n+\t\n+    @Autowired\n+    private SessionManager sessionManager;\n+    \n+    @Autowired\n+    private PreferencesService preferencesService;\n+\n+    @RequestMapping(value = {\"/\", \"/index\"}, method = RequestMethod.GET)", "originalCommit": "c5b38d6e44e458a58ca5d0f337b1380f823885f1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzIxODE4Mw==", "url": "https://github.com/sakaiproject/sakai/pull/8663#discussion_r533218183", "bodyText": "Hi,\nThank you. I've made the change to GetMapping.", "author": "MRutea", "createdAt": "2020-12-01T09:29:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjY1NjAwNg=="}], "type": "inlineReview"}, {"oid": "fbc5b0143363890730eefd70c41c44f145cfb66c", "url": "https://github.com/sakaiproject/sakai/commit/fbc5b0143363890730eefd70c41c44f145cfb66c", "message": "SAK-44353 Group Manager and Date Manager do not change idiom\n\n\nSAK-44353 Group Manager and Date Manager do not change idiom\n\n\nSAK-44353 Group Manager and Date Manager do not change idiom\n\n\nSAK-44353 Group Manager and Date Manager do not change idiom\n\n\nSAK-44353 Group Manager and Date Manager do not change idiom\n\n\nSAK-44353 Group Manager and Date Manager do not change idiom\n\n\nSAK-44353 Group Manager and Date Manager do not change idiom\n\n\nSAK-44353 Group Manager and Date Manager do not change idiom\n\n\nSAK-44353 Group Manager and Date Manager do not change idiom", "committedDate": "2020-12-01T09:25:13Z", "type": "commit"}, {"oid": "fbc5b0143363890730eefd70c41c44f145cfb66c", "url": "https://github.com/sakaiproject/sakai/commit/fbc5b0143363890730eefd70c41c44f145cfb66c", "message": "SAK-44353 Group Manager and Date Manager do not change idiom\n\n\nSAK-44353 Group Manager and Date Manager do not change idiom\n\n\nSAK-44353 Group Manager and Date Manager do not change idiom\n\n\nSAK-44353 Group Manager and Date Manager do not change idiom\n\n\nSAK-44353 Group Manager and Date Manager do not change idiom\n\n\nSAK-44353 Group Manager and Date Manager do not change idiom\n\n\nSAK-44353 Group Manager and Date Manager do not change idiom\n\n\nSAK-44353 Group Manager and Date Manager do not change idiom\n\n\nSAK-44353 Group Manager and Date Manager do not change idiom", "committedDate": "2020-12-01T09:25:13Z", "type": "forcePushed"}]}