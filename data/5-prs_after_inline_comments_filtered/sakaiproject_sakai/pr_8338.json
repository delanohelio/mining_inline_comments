{"pr_number": 8338, "pr_title": "SAK-43899 Date Manager doesn't work with Shared Lessons Page", "pr_createdAt": "2020-07-06T11:44:04Z", "pr_url": "https://github.com/sakaiproject/sakai/pull/8338", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDkxNjU1Ng==", "url": "https://github.com/sakaiproject/sakai/pull/8338#discussion_r450916556", "bodyText": "The previous code loaded all the items in the site before calling the recursive method can we go back to that as it was clearer and it avoids the potential of that being called more than once.\nIf not then put it in an if statement at the very top of the method with an explanation.", "author": "ern", "createdAt": "2020-07-07T14:39:51Z", "path": "site-manage/datemanager/impl/src/java/org/sakaiproject/datemanager/impl/DateManagerServiceImpl.java", "diffHunk": "@@ -1248,12 +1248,19 @@ public void updateAnnouncements(DateManagerValidation announcementValidate) thro\n \t@Override\n \tpublic JSONArray getLessonsForContext(String siteId) {\n \t\tJSONArray jsonLessons = new JSONArray();\n-\t\tString url = getUrlForTool(DateManagerConstants.COMMON_ID_LESSONS);\n-\t\tList<SimplePageItem> items = simplePageToolDao.findItemsInSite(siteId);\n+\t\tjsonLessons = addAllSubpages(siteId, null, jsonLessons, \"false\");\n+\t\treturn jsonLessons;\n+\t}\n+\n+\tprivate JSONArray addAllSubpages(String siteId, Long pageId, JSONArray jsonLessons, String extraInfo) {\n+\t\tList<SimplePageItem> items = siteId!=null?simplePageToolDao.findItemsInSite(siteId):simplePageToolDao.findItemsOnPage(pageId);", "originalCommit": "23627208f3bf1c853abdc7235afee59ba165310b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDk4NDgxMg==", "url": "https://github.com/sakaiproject/sakai/pull/8338#discussion_r450984812", "bodyText": "I've made a new version easy to read !!", "author": "juanjmerono", "createdAt": "2020-07-07T16:16:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDkxNjU1Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDkxNjk0MQ==", "url": "https://github.com/sakaiproject/sakai/pull/8338#discussion_r450916941", "bodyText": "+1 removing duplicate code", "author": "ern", "createdAt": "2020-07-07T14:40:20Z", "path": "site-manage/datemanager/impl/src/java/org/sakaiproject/datemanager/impl/DateManagerServiceImpl.java", "diffHunk": "@@ -1265,39 +1272,15 @@ public JSONArray getLessonsForContext(String siteId) {\n \t\t\t\t\t}\n \t\t\t\t\tlobj.put(\"tool_title\", toolTitle);\n \t\t\t\t\tlobj.put(\"url\", url);\n-\t\t\t\t\tlobj.put(\"extraInfo\", \"false\");\n+\t\t\t\t\tlobj.put(\"extraInfo\", extraInfo);\n \t\t\t\t\tjsonLessons.add(lobj);\n-\t\t\t\t\tjsonLessons = addAllSubpages(Long.parseLong(item.getSakaiId()), jsonLessons);\n+\t\t\t\t\tjsonLessons = addAllSubpages(null, Long.parseLong(item.getSakaiId()), jsonLessons, rb.getString(\"tool.lessons.extra.subpage\"));\n \t\t\t\t}\n \t\t\t}\n \t\t}\n \t\treturn jsonLessons;\n \t}\n \n-\tprivate JSONArray addAllSubpages(Long pageId, JSONArray jsonLessons) {", "originalCommit": "23627208f3bf1c853abdc7235afee59ba165310b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "687a4c2874f28901ef08ee307d5f0ef2a7e25aec", "url": "https://github.com/sakaiproject/sakai/commit/687a4c2874f28901ef08ee307d5f0ef2a7e25aec", "message": "SAK-43899 Date Manager doesn't work with Shared Lessons Page", "committedDate": "2020-07-07T16:13:47Z", "type": "commit"}, {"oid": "687a4c2874f28901ef08ee307d5f0ef2a7e25aec", "url": "https://github.com/sakaiproject/sakai/commit/687a4c2874f28901ef08ee307d5f0ef2a7e25aec", "message": "SAK-43899 Date Manager doesn't work with Shared Lessons Page", "committedDate": "2020-07-07T16:13:47Z", "type": "forcePushed"}]}