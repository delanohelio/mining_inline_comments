{"pr_number": 8088, "pr_title": "SAK-41905 - site info: Import from Site always shows complete list of\u2026", "pr_createdAt": "2020-03-26T16:10:21Z", "pr_url": "https://github.com/sakaiproject/sakai/pull/8088", "timeline": [{"oid": "c8e79623f16971b881154e0a46f1c42e8bfca308", "url": "https://github.com/sakaiproject/sakai/commit/c8e79623f16971b881154e0a46f1c42e8bfca308", "message": "SAK-41905 - site info: Import from Site always shows complete list of sites, including hidden ones.", "committedDate": "2020-03-27T07:11:41Z", "type": "forcePushed"}, {"oid": "07e8c6f0f095b70d28453df1e4da60ee66cc6272", "url": "https://github.com/sakaiproject/sakai/commit/07e8c6f0f095b70d28453df1e4da60ee66cc6272", "message": "SAK-41905 - site info: Import from Site always shows complete list of sites, including hidden ones.", "committedDate": "2020-03-27T17:54:17Z", "type": "forcePushed"}, {"oid": "23705ed08c308332ebd8bbee3f046106c6877d1d", "url": "https://github.com/sakaiproject/sakai/commit/23705ed08c308332ebd8bbee3f046106c6877d1d", "message": "SAK-41905 - site info: Import from Site always shows complete list of sites, including hidden ones.", "committedDate": "2020-03-27T18:05:39Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDk4MjM1MA==", "url": "https://github.com/sakaiproject/sakai/pull/8088#discussion_r400982350", "bodyText": "Could be reduced to a one line lambda ;)", "author": "ern", "createdAt": "2020-03-31T14:58:10Z", "path": "site-manage/site-manage-tool/tool/src/java/org/sakaiproject/site/tool/SiteAction.java", "diffHunk": "@@ -4205,11 +4206,31 @@ private void pageOrderToolTitleIntoContext(Context context, SessionState state,\n \t */\n \tprivate void putImportSitesInfoIntoContext(Context context, Site site, SessionState state, boolean ownTypeOnly) {\n \t\tcontext.put(\"currentSite\", site);\n-\t\tcontext.put(\"importSiteList\", state\n-\t\t\t\t.getAttribute(STATE_IMPORT_SITES));\n-\t\tcontext.put(\"sites\", SiteService.getSites(\n-\t\t\t\torg.sakaiproject.site.api.SiteService.SelectionType.UPDATE,\n-\t\t\t\townTypeOnly?site.getType():null, null, null, SortType.TITLE_ASC, null));\n+\t\tcontext.put(\"importSiteList\", state.getAttribute(STATE_IMPORT_SITES));\n+\t\tfinal List<Site> siteList = SiteService.getSites(org.sakaiproject.site.api.SiteService.SelectionType.UPDATE, ownTypeOnly?site.getType():null, null, null, SortType.TITLE_ASC, null);\n+\t\tList<String> hiddenSiteIdList = new ArrayList<>();\n+\t\tList<Site> hiddenSiteList = new ArrayList<>();\n+\t\tList<Site> visibleSiteList = new ArrayList<>();\n+\t\tPreferences preferences = preferencesService.getPreferences(userDirectoryService.getCurrentUser().getId());\n+\t\tif (preferences != null) {\n+\t\t\tResourceProperties properties = preferences.getProperties(PreferencesService.SITENAV_PREFS_KEY);\n+\t\t\thiddenSiteIdList = (List<String>) properties.getPropertyList(PreferencesService.SITENAV_PREFS_EXCLUDE_KEY);\n+\t\t}\n+\n+\t\tif (hiddenSiteIdList != null && !hiddenSiteIdList.isEmpty()) {", "originalCommit": "23705ed08c308332ebd8bbee3f046106c6877d1d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1c4c6b0130c74b025b2b37be4527dcdf36a72b0d", "url": "https://github.com/sakaiproject/sakai/commit/1c4c6b0130c74b025b2b37be4527dcdf36a72b0d", "message": "SAK-41905 - site info: Import from Site always shows complete list of sites, including hidden ones.", "committedDate": "2020-04-01T13:18:46Z", "type": "commit"}, {"oid": "1c4c6b0130c74b025b2b37be4527dcdf36a72b0d", "url": "https://github.com/sakaiproject/sakai/commit/1c4c6b0130c74b025b2b37be4527dcdf36a72b0d", "message": "SAK-41905 - site info: Import from Site always shows complete list of sites, including hidden ones.", "committedDate": "2020-04-01T13:18:46Z", "type": "forcePushed"}]}