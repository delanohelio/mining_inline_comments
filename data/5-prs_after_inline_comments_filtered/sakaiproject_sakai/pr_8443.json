{"pr_number": 8443, "pr_title": "SAK-40369 - Intermittent startup failure", "pr_createdAt": "2020-08-09T21:05:59Z", "pr_url": "https://github.com/sakaiproject/sakai/pull/8443", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODIwOTMzMA==", "url": "https://github.com/sakaiproject/sakai/pull/8443#discussion_r468209330", "bodyText": "There should always be a scheduler instance, but it may not actually be executing and running jobs.", "author": "ern", "createdAt": "2020-08-10T21:58:14Z", "path": "jobscheduler/scheduler-component-shared/src/java/org/sakaiproject/component/app/scheduler/SchedulerManagerImpl.java", "diffHunk": "@@ -99,6 +99,10 @@\n \n   public void init()\n   {\n+    if (!startScheduler) {", "originalCommit": "dab9b81b3221dc614f027c75dfaaf6be3ecc8ef9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODIxMjQwMA==", "url": "https://github.com/sakaiproject/sakai/pull/8443#discussion_r468212400", "bodyText": "Since the SchedulerManager Bean is injected via spring it should never be non null. If schedulerManager.getScheduler() is returning null then there is likely some timing issue going on.", "author": "ern", "createdAt": "2020-08-10T22:05:50Z", "path": "jobscheduler/scheduler-utils/src/java/org/sakaiproject/scheduler/util/AutoProvisionJobs.java", "diffHunk": "@@ -54,13 +54,18 @@\n \n     public void init() throws ParserConfigurationException, XPathException, ParseException, IOException, ValidationException, SchedulerException, SAXException, ClassNotFoundException {\n \n+        Scheduler scheduler = schedulerManager.getScheduler();", "originalCommit": "dab9b81b3221dc614f027c75dfaaf6be3ecc8ef9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODI3MDcwOQ==", "url": "https://github.com/sakaiproject/sakai/pull/8443#discussion_r468270709", "bodyText": "The schedulerManager isn't null, but getScheduler() was returning null because it wasn't set up after this in init.\nI can move this abort down further but it really seems like everything in this init shouldn't be running if startScheduler=false. It's just doing too much. I moved it down right before the jobs are processed and removed the null checks and it's loading up and seems to still be working as expected.", "author": "jonespm", "createdAt": "2020-08-11T01:15:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODIxMjQwMA=="}], "type": "inlineReview"}, {"oid": "469012df18adbbe6b094c2c8038d734b94528866", "url": "https://github.com/sakaiproject/sakai/commit/469012df18adbbe6b094c2c8038d734b94528866", "message": "SAK-40369 - Intermittent startup failure", "committedDate": "2020-08-11T01:17:13Z", "type": "commit"}, {"oid": "469012df18adbbe6b094c2c8038d734b94528866", "url": "https://github.com/sakaiproject/sakai/commit/469012df18adbbe6b094c2c8038d734b94528866", "message": "SAK-40369 - Intermittent startup failure", "committedDate": "2020-08-11T01:17:13Z", "type": "forcePushed"}, {"oid": "fb9feabdeb4e5c8840ec3e998ae73abf5f1a0d93", "url": "https://github.com/sakaiproject/sakai/commit/fb9feabdeb4e5c8840ec3e998ae73abf5f1a0d93", "message": "Updated job detail log message", "committedDate": "2020-08-11T13:42:12Z", "type": "commit"}]}