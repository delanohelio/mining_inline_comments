{"pr_number": 2687, "pr_title": "ENT-1862: Port PoolDTO to spec-first", "pr_createdAt": "2020-04-23T11:53:05Z", "pr_url": "https://github.com/candlepin/candlepin/pull/2687", "timeline": [{"oid": "7aa341d995524861502ccc180c110389d6259797", "url": "https://github.com/candlepin/candlepin/commit/7aa341d995524861502ccc180c110389d6259797", "message": "ENT-1862: Port PoolDTO to spec-first", "committedDate": "2020-04-23T12:43:41Z", "type": "forcePushed"}, {"oid": "2a34daeb5dd6fd9fcc1757f2c944d3e8afe28cbb", "url": "https://github.com/candlepin/candlepin/commit/2a34daeb5dd6fd9fcc1757f2c944d3e8afe28cbb", "message": "ENT-1862: Port PoolDTO to spec-first", "committedDate": "2020-04-24T07:56:38Z", "type": "forcePushed"}, {"oid": "2a7dc63cdf81936eb22f2fdc7ec8d57f1449019d", "url": "https://github.com/candlepin/candlepin/commit/2a7dc63cdf81936eb22f2fdc7ec8d57f1449019d", "message": "ENT-1862: Port PoolDTO to spec-first", "committedDate": "2020-04-24T08:58:33Z", "type": "forcePushed"}, {"oid": "e7bb04d3d071cfb0abb4dc20a7919ddd13211a3a", "url": "https://github.com/candlepin/candlepin/commit/e7bb04d3d071cfb0abb4dc20a7919ddd13211a3a", "message": "ENT-1862: Port PoolDTO to spec-first", "committedDate": "2020-04-24T09:08:05Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQ2MTAyMQ==", "url": "https://github.com/candlepin/candlepin/pull/2687#discussion_r414461021", "bodyText": "We should probably remove this comment.", "author": "wolfdale", "createdAt": "2020-04-24T10:14:22Z", "path": "server/src/test/java/org/candlepin/dto/api/v1/PoolTranslatorTest.java", "diffHunk": "@@ -37,18 +38,14 @@\n import static org.junit.Assert.assertEquals;\n import static org.junit.Assert.assertNotNull;\n import static org.junit.Assert.assertNull;\n-import static org.junit.Assert.assertTrue;\n \n-/**\n- * Test suite for the PoolTranslator class.\n- */\n public class PoolTranslatorTest extends AbstractTranslatorTest<Pool, PoolDTO, PoolTranslator> {\n \n     protected PoolTranslator translator = new PoolTranslator();\n \n     // Using EntitlementTranslator instead of EntitlementTranslatorTest to avoid StackOverflow issues\n     // caused by bidirectional reference between Pool and Entitlement.", "originalCommit": "e7bb04d3d071cfb0abb4dc20a7919ddd13211a3a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQ4MDE3Mg==", "url": "https://github.com/candlepin/candlepin/pull/2687#discussion_r414480172", "bodyText": "Done.", "author": "Januson", "createdAt": "2020-04-24T10:47:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQ2MTAyMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQ2MTUwNw==", "url": "https://github.com/candlepin/candlepin/pull/2687#discussion_r414461507", "bodyText": "Small issue - Incorrect header date.", "author": "wolfdale", "createdAt": "2020-04-24T10:15:11Z", "path": "server/src/test/java/org/candlepin/dto/api/v1/NestedEntitlementTranslatorTest.java", "diffHunk": "@@ -0,0 +1,109 @@\n+/**\n+ * Copyright (c) 2009 - 2017 Red Hat, Inc.", "originalCommit": "e7bb04d3d071cfb0abb4dc20a7919ddd13211a3a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQ4MDIwNw==", "url": "https://github.com/candlepin/candlepin/pull/2687#discussion_r414480207", "bodyText": "Done.", "author": "Januson", "createdAt": "2020-04-24T10:47:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQ2MTUwNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQ2MTc4OQ==", "url": "https://github.com/candlepin/candlepin/pull/2687#discussion_r414461789", "bodyText": "Small issue - Incorrect header date.", "author": "wolfdale", "createdAt": "2020-04-24T10:15:36Z", "path": "server/src/main/java/org/candlepin/jackson/PoolAnnotationMixIn.java", "diffHunk": "@@ -0,0 +1,42 @@\n+/**\n+ * Copyright (c) 2009 - 2012 Red Hat, Inc.", "originalCommit": "e7bb04d3d071cfb0abb4dc20a7919ddd13211a3a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQ4MDI2Mw==", "url": "https://github.com/candlepin/candlepin/pull/2687#discussion_r414480263", "bodyText": "Done.", "author": "Januson", "createdAt": "2020-04-24T10:47:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQ2MTc4OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQ2MjA2OQ==", "url": "https://github.com/candlepin/candlepin/pull/2687#discussion_r414462069", "bodyText": "Small issue - Incorrect header date.", "author": "wolfdale", "createdAt": "2020-04-24T10:16:05Z", "path": "server/src/main/java/org/candlepin/dto/api/v1/NestedEntitlementTranslator.java", "diffHunk": "@@ -0,0 +1,73 @@\n+/**\n+ * Copyright (c) 2009 - 2017 Red Hat, Inc.", "originalCommit": "e7bb04d3d071cfb0abb4dc20a7919ddd13211a3a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQ4MDI5OQ==", "url": "https://github.com/candlepin/candlepin/pull/2687#discussion_r414480299", "bodyText": "Done.", "author": "Januson", "createdAt": "2020-04-24T10:47:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQ2MjA2OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQ2Mzg4Mw==", "url": "https://github.com/candlepin/candlepin/pull/2687#discussion_r414463883", "bodyText": "Description needs to be changed here.", "author": "wolfdale", "createdAt": "2020-04-24T10:19:05Z", "path": "server/src/main/java/org/candlepin/dto/api/v1/NestedEntitlementTranslator.java", "diffHunk": "@@ -0,0 +1,73 @@\n+/**\n+ * Copyright (c) 2009 - 2017 Red Hat, Inc.\n+ *\n+ * This software is licensed to you under the GNU General Public License,\n+ * version 2 (GPLv2). There is NO WARRANTY for this software, express or\n+ * implied, including the implied warranties of MERCHANTABILITY or FITNESS\n+ * FOR A PARTICULAR PURPOSE. You should have received a copy of GPLv2\n+ * along with this software; if not, see\n+ * http://www.gnu.org/licenses/old-licenses/gpl-2.0.txt.\n+ *\n+ * Red Hat trademarks are not licensed under GPLv2. No permission is\n+ * granted to use or replicate Red Hat trademarks that are incorporated\n+ * in this software or its documentation.\n+ */\n+package org.candlepin.dto.api.v1;\n+\n+import org.candlepin.dto.ModelTranslator;\n+import org.candlepin.dto.ObjectTranslator;\n+import org.candlepin.model.Entitlement;\n+import org.candlepin.util.Util;\n+\n+/**\n+ * The EntitlementTranslator provides translation from Entitlement model objects to EntitlementDTOs.", "originalCommit": "e7bb04d3d071cfb0abb4dc20a7919ddd13211a3a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQ4MDM2OA==", "url": "https://github.com/candlepin/candlepin/pull/2687#discussion_r414480368", "bodyText": "Done.", "author": "Januson", "createdAt": "2020-04-24T10:47:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQ2Mzg4Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQ2Njg3NA==", "url": "https://github.com/candlepin/candlepin/pull/2687#discussion_r414466874", "bodyText": "Technically it is correct. Since we follow fluent style in most of our translators, maybe we can do it here as well.", "author": "wolfdale", "createdAt": "2020-04-24T10:24:08Z", "path": "server/src/main/java/org/candlepin/dto/api/v1/NestedEntitlementTranslator.java", "diffHunk": "@@ -0,0 +1,73 @@\n+/**\n+ * Copyright (c) 2009 - 2017 Red Hat, Inc.\n+ *\n+ * This software is licensed to you under the GNU General Public License,\n+ * version 2 (GPLv2). There is NO WARRANTY for this software, express or\n+ * implied, including the implied warranties of MERCHANTABILITY or FITNESS\n+ * FOR A PARTICULAR PURPOSE. You should have received a copy of GPLv2\n+ * along with this software; if not, see\n+ * http://www.gnu.org/licenses/old-licenses/gpl-2.0.txt.\n+ *\n+ * Red Hat trademarks are not licensed under GPLv2. No permission is\n+ * granted to use or replicate Red Hat trademarks that are incorporated\n+ * in this software or its documentation.\n+ */\n+package org.candlepin.dto.api.v1;\n+\n+import org.candlepin.dto.ModelTranslator;\n+import org.candlepin.dto.ObjectTranslator;\n+import org.candlepin.model.Entitlement;\n+import org.candlepin.util.Util;\n+\n+/**\n+ * The EntitlementTranslator provides translation from Entitlement model objects to EntitlementDTOs.\n+ */\n+public class NestedEntitlementTranslator implements ObjectTranslator<Entitlement, NestedEntitlementDTO> {\n+\n+    /**\n+     * {@inheritDoc}\n+     */\n+    @Override\n+    public NestedEntitlementDTO translate(Entitlement source) {\n+        return this.translate(null, source);\n+    }\n+\n+    /**\n+     * {@inheritDoc}\n+     */\n+    @Override\n+    public NestedEntitlementDTO translate(ModelTranslator translator, Entitlement source) {\n+        return source != null ? this.populate(translator, source, new NestedEntitlementDTO()) : null;\n+    }\n+\n+    /**\n+     * {@inheritDoc}\n+     */\n+    @Override\n+    public NestedEntitlementDTO populate(Entitlement source, NestedEntitlementDTO destination) {\n+        return this.populate(null, source, destination);\n+    }\n+\n+    /**\n+     * {@inheritDoc}\n+     */\n+    @Override\n+    public NestedEntitlementDTO populate(\n+        ModelTranslator modelTranslator, Entitlement source, NestedEntitlementDTO dest) {\n+        if (source == null) {\n+            throw new IllegalArgumentException(\"source is null\");\n+        }\n+\n+        if (dest == null) {\n+            throw new IllegalArgumentException(\"destination is null\");\n+        }\n+\n+        dest.setId(source.getId());\n+        dest.setQuantity(source.getQuantity());\n+        dest.setDeletedFromPool(source.deletedFromPool());\n+        dest.setStartDate(Util.toDateTime(source.getStartDate()));\n+        dest.setEndDate(Util.toDateTime(source.getEndDate()));", "originalCommit": "e7bb04d3d071cfb0abb4dc20a7919ddd13211a3a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQ4MDQzMA==", "url": "https://github.com/candlepin/candlepin/pull/2687#discussion_r414480430", "bodyText": "Done.", "author": "Januson", "createdAt": "2020-04-24T10:47:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQ2Njg3NA=="}], "type": "inlineReview"}, {"oid": "4fc673b61749280756a2d2fac898f0b0b6479d2e", "url": "https://github.com/candlepin/candlepin/commit/4fc673b61749280756a2d2fac898f0b0b6479d2e", "message": "ENT-1862: Port PoolDTO to spec-first", "committedDate": "2020-04-24T10:45:57Z", "type": "forcePushed"}, {"oid": "10c7278c847b0c3e35ba62b58eefefc4c42c7570", "url": "https://github.com/candlepin/candlepin/commit/10c7278c847b0c3e35ba62b58eefefc4c42c7570", "message": "ENT-1862: Port PoolDTO to spec-first", "committedDate": "2020-04-28T13:57:32Z", "type": "forcePushed"}, {"oid": "7b5a27eb81294526d268c9fe449744ca2ac9e128", "url": "https://github.com/candlepin/candlepin/commit/7b5a27eb81294526d268c9fe449744ca2ac9e128", "message": "ENT-1862: Port PoolDTO to spec-first", "committedDate": "2020-04-28T14:16:00Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDUzOTc5Mg==", "url": "https://github.com/candlepin/candlepin/pull/2687#discussion_r414539792", "bodyText": "This annotation is custom one, not a jackson annotation, so it has no effect on the MixIn. Also, it turns out that PoolDTO did not need these annotations anyway, because there was no corresponding \"PoolFilter\" when configuring the ObjectMapper in JsonProvider.java, thus the @JsonFilter(\"PoolFilter\") and the @Hateoas* annotations on it did not work anyway. They only work for the model entity (Pool.java) because the Event ObjectMapper is configured to look for a \"PoolFilter\", and they were accidentally copied over to PoolDTO when we implemented that.\nSo we should remove all 4 @Hateoas annotations and their fields from here.", "author": "nikosmoum", "createdAt": "2020-04-24T12:32:28Z", "path": "server/src/main/java/org/candlepin/jackson/PoolAnnotationMixIn.java", "diffHunk": "@@ -0,0 +1,42 @@\n+/**\n+ * Copyright (c) 2009 - 2020 Red Hat, Inc.\n+ *\n+ * This software is licensed to you under the GNU General Public License,\n+ * version 2 (GPLv2). There is NO WARRANTY for this software, express or\n+ * implied, including the implied warranties of MERCHANTABILITY or FITNESS\n+ * FOR A PARTICULAR PURPOSE. You should have received a copy of GPLv2\n+ * along with this software; if not, see\n+ * http://www.gnu.org/licenses/old-licenses/gpl-2.0.txt.\n+ *\n+ * Red Hat trademarks are not licensed under GPLv2. No permission is\n+ * granted to use or replicate Red Hat trademarks that are incorporated\n+ * in this software or its documentation.\n+ */\n+package org.candlepin.jackson;\n+\n+import org.candlepin.common.jackson.DynamicPropertyFilterMixIn;\n+import org.candlepin.common.jackson.HateoasInclude;\n+import org.candlepin.dto.api.v1.AttributeDTO;\n+\n+import com.fasterxml.jackson.databind.annotation.JsonDeserialize;\n+\n+import java.util.List;\n+\n+public abstract class PoolAnnotationMixIn extends DynamicPropertyFilterMixIn {\n+\n+    @JsonDeserialize(using = AttributeDeserializer.class)\n+    private List<AttributeDTO> attributes;\n+    @JsonDeserialize(using = AttributeDeserializer.class)\n+    private List<AttributeDTO> productAttributes;\n+    @JsonDeserialize(using = AttributeDeserializer.class)\n+    private List<AttributeDTO> derivedProductAttributes;\n+\n+    @HateoasInclude", "originalCommit": "4fc673b61749280756a2d2fac898f0b0b6479d2e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzk2NTMxNQ==", "url": "https://github.com/candlepin/candlepin/pull/2687#discussion_r417965315", "bodyText": "Done.", "author": "Januson", "createdAt": "2020-04-30T12:15:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDUzOTc5Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzg5NTU4MQ==", "url": "https://github.com/candlepin/candlepin/pull/2687#discussion_r417895581", "bodyText": "ProvidedProductDTO should probably also be added the DynamicPropertyFilterMixIn here", "author": "nikosmoum", "createdAt": "2020-04-30T09:59:17Z", "path": "server/src/main/java/org/candlepin/resteasy/JsonProvider.java", "diffHunk": "@@ -180,15 +183,17 @@ private void addMixInAnnotationsForDTOs(ObjectMapper mapper) {\n         mapper.addMixIn(DistributorVersionDTO.class, DynamicPropertyFilterMixIn.class);\n         mapper.addMixIn(GuestIdDTO.class, DynamicPropertyFilterMixIn.class);\n         mapper.addMixIn(GuestIdDTOArrayElement.class, DynamicPropertyFilterMixIn.class);\n+        mapper.addMixIn(NestedEntitlementDTO.class, DynamicPropertyFilterMixIn.class);", "originalCommit": "7b5a27eb81294526d268c9fe449744ca2ac9e128", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzk2NTQxOA==", "url": "https://github.com/candlepin/candlepin/pull/2687#discussion_r417965418", "bodyText": "Done.", "author": "Januson", "createdAt": "2020-04-30T12:15:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzg5NTU4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzk4MDgwMg==", "url": "https://github.com/candlepin/candlepin/pull/2687#discussion_r417980802", "bodyText": "The wrong class was added. We want ProvidedProductDTO, not ProvidedProduct", "author": "nikosmoum", "createdAt": "2020-04-30T12:43:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzg5NTU4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODAwMzE2Ng==", "url": "https://github.com/candlepin/candlepin/pull/2687#discussion_r418003166", "bodyText": "Done", "author": "Januson", "createdAt": "2020-04-30T13:19:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzg5NTU4MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzkwNzIwOA==", "url": "https://github.com/candlepin/candlepin/pull/2687#discussion_r417907208", "bodyText": "Since NestedEntitlementDTO has only 2 fields: id and href, and it is only used in PoolDTO currently (no other DTO has an EntitlementDTO member field), the translator might be a bit overkill, and we could get away to just creating an object on the fly and calling the 2 setters, just like you did with ProvidedProductDTO.", "author": "nikosmoum", "createdAt": "2020-04-30T10:20:39Z", "path": "server/src/main/java/org/candlepin/dto/api/v1/NestedEntitlementTranslator.java", "diffHunk": "@@ -0,0 +1,72 @@\n+/**\n+ * Copyright (c) 2009 - 2020 Red Hat, Inc.\n+ *\n+ * This software is licensed to you under the GNU General Public License,\n+ * version 2 (GPLv2). There is NO WARRANTY for this software, express or\n+ * implied, including the implied warranties of MERCHANTABILITY or FITNESS\n+ * FOR A PARTICULAR PURPOSE. You should have received a copy of GPLv2\n+ * along with this software; if not, see\n+ * http://www.gnu.org/licenses/old-licenses/gpl-2.0.txt.\n+ *\n+ * Red Hat trademarks are not licensed under GPLv2. No permission is\n+ * granted to use or replicate Red Hat trademarks that are incorporated\n+ * in this software or its documentation.\n+ */\n+package org.candlepin.dto.api.v1;\n+\n+import org.candlepin.dto.ModelTranslator;\n+import org.candlepin.dto.ObjectTranslator;\n+import org.candlepin.model.Entitlement;\n+import org.candlepin.util.Util;\n+\n+/**\n+ * This class provides translation from {@link Entitlement} model objects\n+ * to {@link NestedEntitlementDTO}.\n+ */\n+public class NestedEntitlementTranslator implements ObjectTranslator<Entitlement, NestedEntitlementDTO> {", "originalCommit": "7b5a27eb81294526d268c9fe449744ca2ac9e128", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzk2NTQ0OA==", "url": "https://github.com/candlepin/candlepin/pull/2687#discussion_r417965448", "bodyText": "Done.", "author": "Januson", "createdAt": "2020-04-30T12:16:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzkwNzIwOA=="}], "type": "inlineReview"}, {"oid": "2a6515926d4cf1a808ab9b2bd1784bf30b5f47d4", "url": "https://github.com/candlepin/candlepin/commit/2a6515926d4cf1a808ab9b2bd1784bf30b5f47d4", "message": "ENT-1862: Port PoolDTO to spec-first", "committedDate": "2020-04-30T12:09:45Z", "type": "forcePushed"}, {"oid": "9363cb852fa30f2e12f4d5688a2c4525fa309e69", "url": "https://github.com/candlepin/candlepin/commit/9363cb852fa30f2e12f4d5688a2c4525fa309e69", "message": "ENT-1862: Port PoolDTO to spec-first", "committedDate": "2020-04-30T13:18:16Z", "type": "forcePushed"}, {"oid": "36e2173796e3de98f49d4d44f2859269ea5405de", "url": "https://github.com/candlepin/candlepin/commit/36e2173796e3de98f49d4d44f2859269ea5405de", "message": "ENT-1862: Port PoolDTO to spec-first", "committedDate": "2020-04-30T14:13:49Z", "type": "commit"}, {"oid": "36e2173796e3de98f49d4d44f2859269ea5405de", "url": "https://github.com/candlepin/candlepin/commit/36e2173796e3de98f49d4d44f2859269ea5405de", "message": "ENT-1862: Port PoolDTO to spec-first", "committedDate": "2020-04-30T14:13:49Z", "type": "forcePushed"}]}