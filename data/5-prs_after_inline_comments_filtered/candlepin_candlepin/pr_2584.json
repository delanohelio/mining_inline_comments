{"pr_number": 2584, "pr_title": "[F] ENT-1855: Port CertificateSerialDTO to openapi spec", "pr_createdAt": "2020-01-24T16:37:38Z", "pr_url": "https://github.com/candlepin/candlepin/pull/2584", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgxODY2Mg==", "url": "https://github.com/candlepin/candlepin/pull/2584#discussion_r370818662", "bodyText": "I wonder if it'd be worth the effort (and if it's even possible) to update the entities to use LocalDate as well. While this translation works, I don't know how keen I am to be doing that everywhere.", "author": "Ceiu", "createdAt": "2020-01-24T20:02:52Z", "path": "server/src/main/java/org/candlepin/dto/api/v1/CertificateSerialTranslator.java", "diffHunk": "@@ -56,14 +61,26 @@ public CertificateSerialDTO populate(CertificateSerial source, CertificateSerial\n     @Override\n     public CertificateSerialDTO populate(ModelTranslator translator, CertificateSerial source,\n         CertificateSerialDTO dest) {\n+        if (source == null) {\n+            throw new IllegalArgumentException(\"source is null\");\n+        }\n \n-        dest = super.populate(translator, source, dest);\n+        if (dest == null) {\n+            throw new IllegalArgumentException(\"dest is null\");\n+        }\n \n-        dest.setId(source.getId() == null ? null : source.getId().toString());\n-        dest.setSerial(source.getSerial() == null ? null : source.getSerial().toString());\n-        dest.setExpiration(source.getExpiration());\n-        dest.setCollected(source.isCollected());\n-        dest.setRevoked(source.isRevoked());\n+        Date created = source.getCreated();\n+        dest.setCreated(created != null ?  Instant.ofEpochMilli(created.getTime()).atZone(ZoneId.systemDefault()).toLocalDate(): null);", "originalCommit": "f68ec46c4857a5b4672339669a67b41655a45ad9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTg5NTY4NQ==", "url": "https://github.com/candlepin/candlepin/pull/2584#discussion_r371895685", "bodyText": "I tried looking into changing CertificateSerial.java's expiration field from Date to OffsetDateTime.\nWe would need to change our CertificateSerialInfo Adapter inferface to support OffsetDateTime too, which would also force us to change the manifest CertificateSerialDTO to use it too, and this whole thing suddenly cascades wildly. Basically, if we change our model Dates to OffsetDateTimes, the Dates on the *Info would all also need to change. Not only that, but Date is basically used all across the codebase, so if we start changing those on the models, we'd have to change them everywhere (including model unit tests).\nCompared to all that, doing these conversions in translators only (and translator tests), is a good price to pay. So I'd vote to not do that. If we were going to do it though, it would probably have to be a massive effort, which I'd prefer be done separately alltogether from this epic (probably another epic).", "author": "nikosmoum", "createdAt": "2020-01-28T16:02:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgxODY2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTg5NzIzMA==", "url": "https://github.com/candlepin/candlepin/pull/2584#discussion_r371897230", "bodyText": "Yikes, alright then.\nWe probably should switch to the java.time package eventually, but if it's going to be such a massive undertaking, then I agree that this PR is not the place for it.", "author": "Ceiu", "createdAt": "2020-01-28T16:04:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgxODY2Mg=="}], "type": "inlineReview"}, {"oid": "27c6912e7d8d6ee216a57d37cf6141549dffdb39", "url": "https://github.com/candlepin/candlepin/commit/27c6912e7d8d6ee216a57d37cf6141549dffdb39", "message": "ENT-1855: Port CertificateSerialDTO to openapi spec\n\n- Add custom deserializer for OffsetDateTime that\n  supports ISO 8601 dates with optional offset, millis, or time.\n- Add custom serializer for OffsetDateTime that cuts off millis and\n  converts to UTC using the offset.", "committedDate": "2020-01-28T12:23:16Z", "type": "forcePushed"}, {"oid": "a5cd052e540b2257493705338e977a8c04cdb0da", "url": "https://github.com/candlepin/candlepin/commit/a5cd052e540b2257493705338e977a8c04cdb0da", "message": "ENT-1855: Port CertificateSerialDTO to openapi spec\n\n- Add custom deserializer for OffsetDateTime that\n  supports ISO 8601 dates with optional offset, millis, or time.\n- Add custom serializer for OffsetDateTime that cuts off millis and\n  converts to UTC using the offset.", "committedDate": "2020-01-28T16:10:58Z", "type": "forcePushed"}, {"oid": "e40c07b333291296b39a5c98da1b6a33e7084722", "url": "https://github.com/candlepin/candlepin/commit/e40c07b333291296b39a5c98da1b6a33e7084722", "message": "ENT-1855: Port CertificateSerialDTO to openapi spec\n\n- Add custom deserializer for OffsetDateTime that\n  supports ISO 8601 dates with optional offset, millis, or time.\n- Add custom serializer for OffsetDateTime that cuts off millis and\n  converts to UTC using the offset.", "committedDate": "2020-01-30T16:01:27Z", "type": "forcePushed"}, {"oid": "683195da525eb120c6c03efa71fbdab1f65ab710", "url": "https://github.com/candlepin/candlepin/commit/683195da525eb120c6c03efa71fbdab1f65ab710", "message": "ENT-1855: Port CertificateSerialDTO to openapi spec\n\n- Add custom deserializer for OffsetDateTime that\n  supports ISO 8601 dates with optional offset, millis, or time.\n- Add custom serializer for OffsetDateTime that cuts off millis and\n  converts to UTC using the offset.", "committedDate": "2020-01-31T08:18:37Z", "type": "forcePushed"}, {"oid": "578f1ee480cee89639ae75cfd5ce5819a027b012", "url": "https://github.com/candlepin/candlepin/commit/578f1ee480cee89639ae75cfd5ce5819a027b012", "message": "ENT-1855: Port CertificateSerialDTO to openapi spec\n\n- Add custom deserializer for OffsetDateTime that\n  supports ISO 8601 dates with optional offset, millis, or time.\n- Add custom serializer for OffsetDateTime that cuts off millis and\n  converts to UTC using the offset.", "committedDate": "2020-01-31T13:25:54Z", "type": "commit"}, {"oid": "578f1ee480cee89639ae75cfd5ce5819a027b012", "url": "https://github.com/candlepin/candlepin/commit/578f1ee480cee89639ae75cfd5ce5819a027b012", "message": "ENT-1855: Port CertificateSerialDTO to openapi spec\n\n- Add custom deserializer for OffsetDateTime that\n  supports ISO 8601 dates with optional offset, millis, or time.\n- Add custom serializer for OffsetDateTime that cuts off millis and\n  converts to UTC using the offset.", "committedDate": "2020-01-31T13:25:54Z", "type": "forcePushed"}]}