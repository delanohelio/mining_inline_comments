{"pr_number": 2730, "pr_title": "[M] 1844243: Added Quartz trigger misfire logging (ENT-2479)", "pr_createdAt": "2020-06-22T15:56:00Z", "pr_url": "https://github.com/candlepin/candlepin/pull/2730", "timeline": [{"oid": "2111f49be69733476adf43502dab75ceb978f9b4", "url": "https://github.com/candlepin/candlepin/commit/2111f49be69733476adf43502dab75ceb978f9b4", "message": "1844243: Added Quartz trigger misfire logging\n\n- The JobManager now logs Quartz trigger misfire events as they occur", "committedDate": "2020-06-12T20:18:25Z", "type": "commit"}, {"oid": "2111f49be69733476adf43502dab75ceb978f9b4", "url": "https://github.com/candlepin/candlepin/commit/2111f49be69733476adf43502dab75ceb978f9b4", "message": "1844243: Added Quartz trigger misfire logging\n\n- The JobManager now logs Quartz trigger misfire events as they occur", "committedDate": "2020-06-12T20:18:25Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDE1NjkyMQ==", "url": "https://github.com/candlepin/candlepin/pull/2730#discussion_r444156921", "bodyText": "Do you think we should add a condition to check if Candlepin is in SUSPEND mode and not allow job to be executed.", "author": "wolfdale", "createdAt": "2020-06-23T11:37:06Z", "path": "server/src/main/java/org/candlepin/async/JobManager.java", "diffHunk": "@@ -168,6 +169,37 @@ public void execute(org.quartz.JobExecutionContext context) throws org.quartz.Jo\n                 throw new org.quartz.JobExecutionException(errmsg, e);\n             }\n         }\n+\n+        @Override\n+        public String getName() {\n+            return this.getClass().getSimpleName();\n+        }\n+\n+        @Override\n+        public void triggerComplete(Trigger trigger, org.quartz.JobExecutionContext context,\n+            Trigger.CompletedExecutionInstruction triggerInstructionCode) {\n+            // Intentionally left empty\n+        }\n+\n+        @Override\n+        public void triggerFired(Trigger trigger, org.quartz.JobExecutionContext context) {\n+            // Intentionally left empty\n+        }\n+\n+        @Override\n+        public void triggerMisfired(Trigger trigger) {\n+            String jobKey = trigger.getKey().getName();\n+\n+            log.warn(\"Trigger misfired for job: {} [start: {}, end: {}, next fire time: {}, \" +\n+                \"final fire time: {}, priority: {}, misfire instruction: {}]\",\n+                jobKey, trigger.getStartTime(), trigger.getEndTime(), trigger.getNextFireTime(),\n+                trigger.getFinalFireTime(), trigger.getPriority(), trigger.getMisfireInstruction());\n+        }\n+\n+        @Override\n+        public boolean vetoJobExecution(Trigger trigger, org.quartz.JobExecutionContext context) {\n+            return false;", "originalCommit": "2111f49be69733476adf43502dab75ceb978f9b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDE5Nzk5OQ==", "url": "https://github.com/candlepin/candlepin/pull/2730#discussion_r444197999", "bodyText": "Nah. Suspend mode is already handled by pausing both the scheduler and the message receiver. We don't need explicit handling here.", "author": "Ceiu", "createdAt": "2020-06-23T12:51:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDE1NjkyMQ=="}], "type": "inlineReview"}]}