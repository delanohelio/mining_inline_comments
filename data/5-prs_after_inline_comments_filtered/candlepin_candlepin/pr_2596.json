{"pr_number": 2596, "pr_title": "ENT-1872: Port DistributorVersionResource to spec-first", "pr_createdAt": "2020-01-30T15:16:59Z", "pr_url": "https://github.com/candlepin/candlepin/pull/2596", "timeline": [{"oid": "711e0f739e65dc3c55cae61bb131204840e0ce6a", "url": "https://github.com/candlepin/candlepin/commit/711e0f739e65dc3c55cae61bb131204840e0ce6a", "message": "ENT-1872: Port DistributorVersionResource to spec-first\n - Add yaml definitions of resource and DTOs\n - Update Translator\n - Fix broken tests", "committedDate": "2020-01-31T14:14:10Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzkxODE0OA==", "url": "https://github.com/candlepin/candlepin/pull/2596#discussion_r373918148", "bodyText": "@Januson\nmodelTranslator never used in this code. Any specific reason for this null check?", "author": "abhiskum", "createdAt": "2020-02-03T04:29:30Z", "path": "server/src/main/java/org/candlepin/dto/api/v1/DistributorVersionTranslator.java", "diffHunk": "@@ -60,28 +66,43 @@ public DistributorVersionDTO populate(DistributorVersion source, DistributorVers\n     public DistributorVersionDTO populate(ModelTranslator modelTranslator, DistributorVersion source,\n         DistributorVersionDTO dest) {\n \n-        dest = super.populate(modelTranslator, source, dest);\n+        if (source == null) {\n+            throw new IllegalArgumentException(\"source is null\");\n+        }\n \n-        dest.setId(source.getId());\n-        dest.setName(source.getName());\n-        dest.setDisplayName(source.getDisplayName());\n+        if (dest == null) {\n+            throw new IllegalArgumentException(\"dest is null\");\n+        }\n \n-        if (modelTranslator != null) {\n+        dest.id(source.getId())\n+            .name(source.getName())\n+            .displayName(source.getDisplayName())\n+            .created(toDateTime(source::getCreated))\n+            .updated(toDateTime(source::getUpdated));\n \n-            Set<DistributorVersionCapability> capabilities = source.getCapabilities();\n-            if (capabilities != null && !capabilities.isEmpty()) {\n-                for (DistributorVersionCapability capability : capabilities) {\n-                    if (capability != null) {\n-                        dest.addCapability(new DistributorVersionDTO.DistributorVersionCapabilityDTO(\n-                            capability.getId(), capability.getName()));\n-                    }\n-                }\n-            }\n-            else {\n-                dest.setCapabilities(Collections.emptySet());\n+        if (modelTranslator != null) {", "originalCommit": "711e0f739e65dc3c55cae61bb131204840e0ce6a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDAwNjA3OA==", "url": "https://github.com/candlepin/candlepin/pull/2596#discussion_r374006078", "bodyText": "No reason. Just forgot to remove it. Done.", "author": "Januson", "createdAt": "2020-02-03T09:48:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzkxODE0OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzkxODMwOQ==", "url": "https://github.com/candlepin/candlepin/pull/2596#discussion_r373918309", "bodyText": "@Januson What was to the purpose of @Context Principal principal in this API?", "author": "abhiskum", "createdAt": "2020-02-03T04:30:37Z", "path": "server/src/main/java/org/candlepin/resource/DistributorVersionResource.java", "diffHunk": "@@ -139,26 +111,16 @@ else if (!StringUtils.isBlank(capability)) {\n             this.translator.getStreamMapper(DistributorVersion.class, DistributorVersionDTO.class));\n     }\n \n-    @ApiOperation(notes = \"Deletes a Distributor Version\", value = \"delete\")\n-    @ApiResponses({ @ApiResponse(code = 400, message = \"\"), @ApiResponse(code = 404, message = \"\") })\n-    @DELETE\n-    @Produces(MediaType.WILDCARD)\n-    @Path(\"/{id}\")\n-    public void delete(@PathParam(\"id\") String id,\n-        @Context Principal principal) {", "originalCommit": "711e0f739e65dc3c55cae61bb131204840e0ce6a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDE2OTQ0Mw==", "url": "https://github.com/candlepin/candlepin/pull/2596#discussion_r374169443", "bodyText": "Principal is unused so it should be save to remove. Just including it shouldn't have any side effects.", "author": "Januson", "createdAt": "2020-02-03T15:31:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzkxODMwOQ=="}], "type": "inlineReview"}, {"oid": "e10ac949af90987730f70400c1855a570d2c5051", "url": "https://github.com/candlepin/candlepin/commit/e10ac949af90987730f70400c1855a570d2c5051", "message": "ENT-1872: Port DistributorVersionResource to spec-first\n - Add yaml definitions of resource and DTOs\n - Update Translator\n - Fix broken tests", "committedDate": "2020-02-03T09:15:59Z", "type": "forcePushed"}, {"oid": "a9f24d60791134afc629baa4caa5960844bc15b0", "url": "https://github.com/candlepin/candlepin/commit/a9f24d60791134afc629baa4caa5960844bc15b0", "message": "ENT-1872: Port DistributorVersionResource to spec-first\n - Add yaml definitions of resource and DTOs\n - Update Translator\n - Fix broken tests", "committedDate": "2020-02-03T09:47:53Z", "type": "forcePushed"}, {"oid": "79c62e72bb9198b85f6b290852ce7f207684f2ec", "url": "https://github.com/candlepin/candlepin/commit/79c62e72bb9198b85f6b290852ce7f207684f2ec", "message": "ENT-1872: Port DistributorVersionResource to spec-first\n - Add yaml definitions of resource and DTOs\n - Update Translator\n - Fix broken tests", "committedDate": "2020-02-03T11:32:11Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDYxMTE3MA==", "url": "https://github.com/candlepin/candlepin/pull/2596#discussion_r374611170", "bodyText": "What exactly does the use of Supplier get us? Will it not create overhead, and we simply add one more line of code (having to do Date date = source.get();) instead of just accepting a Date?\nRegardless, the idea of using a utility method is good, and we should probably even extract it to a util class, so that we can use it throughout the spec-first port tasks, since it will be ubiquitous. The org.candlepin.util.Util.java class already has some utility methods about Dates, so we could add it there.", "author": "nikosmoum", "createdAt": "2020-02-04T11:14:48Z", "path": "server/src/main/java/org/candlepin/dto/api/v1/DistributorVersionTranslator.java", "diffHunk": "@@ -60,28 +67,43 @@ public DistributorVersionDTO populate(DistributorVersion source, DistributorVers\n     public DistributorVersionDTO populate(ModelTranslator modelTranslator, DistributorVersion source,\n         DistributorVersionDTO dest) {\n \n-        dest = super.populate(modelTranslator, source, dest);\n+        if (source == null) {\n+            throw new IllegalArgumentException(\"source is null\");\n+        }\n+\n+        if (dest == null) {\n+            throw new IllegalArgumentException(\"dest is null\");\n+        }\n \n-        dest.setId(source.getId());\n-        dest.setName(source.getName());\n-        dest.setDisplayName(source.getDisplayName());\n+        dest.id(source.getId())\n+            .name(source.getName())\n+            .displayName(source.getDisplayName())\n+            .created(toDateTime(source::getCreated))\n+            .updated(toDateTime(source::getUpdated))\n+            .capabilities(toDto(source.getCapabilities()));\n \n-        if (modelTranslator != null) {\n+        return dest;\n+    }\n \n-            Set<DistributorVersionCapability> capabilities = source.getCapabilities();\n-            if (capabilities != null && !capabilities.isEmpty()) {\n-                for (DistributorVersionCapability capability : capabilities) {\n-                    if (capability != null) {\n-                        dest.addCapability(new DistributorVersionDTO.DistributorVersionCapabilityDTO(\n-                            capability.getId(), capability.getName()));\n-                    }\n-                }\n-            }\n-            else {\n-                dest.setCapabilities(Collections.emptySet());\n-            }\n+    private OffsetDateTime toDateTime(Supplier<Date> source) {", "originalCommit": "79c62e72bb9198b85f6b290852ce7f207684f2ec", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDc5MTgxNw==", "url": "https://github.com/candlepin/candlepin/pull/2596#discussion_r374791817", "bodyText": "If we have a use of the utility such that throwing a supplier at it is easier or cleaner than just using the utility method as a mapper, then it makes sense to do so. However, I would bet that most, if not all, of our uses are going to be just raw one-off conversions for DTO translation.", "author": "Ceiu", "createdAt": "2020-02-04T16:48:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDYxMTE3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTYzMDYxNw==", "url": "https://github.com/candlepin/candlepin/pull/2596#discussion_r395630617", "bodyText": "Done. Supplier was a leftover from experiment I forgot to rollback. Util function expects Date.", "author": "Januson", "createdAt": "2020-03-20T13:20:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDYxMTE3MA=="}], "type": "inlineReview"}, {"oid": "c781011f3f5cc8ddbf77e1dce2ed275305a007a6", "url": "https://github.com/candlepin/candlepin/commit/c781011f3f5cc8ddbf77e1dce2ed275305a007a6", "message": "ENT-1872: Port DistributorVersionResource to spec-first\n - Add yaml definitions of resource and DTOs\n - Update Translator\n - Fix broken tests", "committedDate": "2020-03-04T12:48:01Z", "type": "forcePushed"}, {"oid": "143da33eee7f716efbb4b958646c04837e320799", "url": "https://github.com/candlepin/candlepin/commit/143da33eee7f716efbb4b958646c04837e320799", "message": "ENT-1872: Port DistributorVersionResource to spec-first\n - Add yaml definitions of resource and DTOs\n - Update Translator\n - Fix broken tests", "committedDate": "2020-03-20T12:57:27Z", "type": "forcePushed"}, {"oid": "2505cb7cca4f672242195ece520be0010d1fd57a", "url": "https://github.com/candlepin/candlepin/commit/2505cb7cca4f672242195ece520be0010d1fd57a", "message": "ENT-1872: Port DistributorVersionResource to spec-first\n - Add yaml definitions of resource and DTOs\n - Update Translator\n - Fix broken tests", "committedDate": "2020-03-20T13:14:54Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIyNTI5OA==", "url": "https://github.com/candlepin/candlepin/pull/2596#discussion_r397225298", "bodyText": "This is setting the source's updated date to the dest's created date. it should be setting the created date", "author": "nikosmoum", "createdAt": "2020-03-24T15:06:10Z", "path": "server/src/main/java/org/candlepin/dto/api/v1/DistributorVersionTranslator.java", "diffHunk": "@@ -60,28 +63,38 @@ public DistributorVersionDTO populate(DistributorVersion source, DistributorVers\n     public DistributorVersionDTO populate(ModelTranslator modelTranslator, DistributorVersion source,\n         DistributorVersionDTO dest) {\n \n-        dest = super.populate(modelTranslator, source, dest);\n+        if (source == null) {\n+            throw new IllegalArgumentException(\"source is null\");\n+        }\n \n-        dest.setId(source.getId());\n-        dest.setName(source.getName());\n-        dest.setDisplayName(source.getDisplayName());\n+        if (dest == null) {\n+            throw new IllegalArgumentException(\"dest is null\");\n+        }\n \n-        if (modelTranslator != null) {\n+        dest.id(source.getId())\n+            .name(source.getName())\n+            .displayName(source.getDisplayName())\n+            .created(Util.toDateTime(source.getUpdated()))", "originalCommit": "2505cb7cca4f672242195ece520be0010d1fd57a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzcxODc2MQ==", "url": "https://github.com/candlepin/candlepin/pull/2596#discussion_r397718761", "bodyText": "Done.", "author": "Januson", "createdAt": "2020-03-25T09:38:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIyNTI5OA=="}], "type": "inlineReview"}, {"oid": "b1e2d4d3ac373f4623fd35fb0aaa30931eabbc59", "url": "https://github.com/candlepin/candlepin/commit/b1e2d4d3ac373f4623fd35fb0aaa30931eabbc59", "message": "ENT-1872: Port DistributorVersionResource to spec-first\n - Add yaml definitions of resource and DTOs\n - Update Translator\n - Fix broken tests", "committedDate": "2020-03-25T09:37:17Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzczMzI0Nw==", "url": "https://github.com/candlepin/candlepin/pull/2596#discussion_r397733247", "bodyText": "One more thing I forgot (sorry, I know I'm asking for changes multiple times instead of all at once, but it's hard to keep in mind everything that needs to be in line. I'll try to take some notes of a complete list of things to look for in each openapi port PR review from now on!):\nNow that we've marked the DistributorVersionCapabilityDTO's name field as required: true and minLength: 1, this is going to generate some validation annotations, but we still need to manually run the validation (with DTOValidator) on the created/update endpoints with: validator.validateConstraints(dto);. Also, the old DTO is validating that none of the capability DTOs set by the setCapabilities setter is null, so we also have to check this ourselves using validator.validateCollectionElementsNotNull(dto::getCapabilities);", "author": "nikosmoum", "createdAt": "2020-03-25T10:01:30Z", "path": "server/src/main/java/org/candlepin/resource/DistributorVersionResource.java", "diffHunk": "@@ -170,14 +132,8 @@ public DistributorVersionDTO create(\n         return this.translator.translate(curator.create(toCreate), DistributorVersionDTO.class);\n     }\n \n-    @ApiOperation(notes = \"Updates a Distributor Version\", value = \"update\")\n-    @PUT\n-    @Consumes(MediaType.APPLICATION_JSON)\n-    @Produces(MediaType.APPLICATION_JSON)\n-    @Path(\"/{id}\")\n-    public DistributorVersionDTO update(@PathParam(\"id\") String id,\n-        @ApiParam(name = \"distributorVersion\", required = true) DistributorVersionDTO dto,\n-        @Context Principal principal) {\n+    @Override\n+    public DistributorVersionDTO update(String id, DistributorVersionDTO dto) {", "originalCommit": "b1e2d4d3ac373f4623fd35fb0aaa30931eabbc59", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzkwNjY2Nw==", "url": "https://github.com/candlepin/candlepin/pull/2596#discussion_r397906667", "bodyText": "Done.", "author": "Januson", "createdAt": "2020-03-25T14:39:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzczMzI0Nw=="}], "type": "inlineReview"}, {"oid": "08b3c5f4bb7bf353e155fa8363bd381ab50acccd", "url": "https://github.com/candlepin/candlepin/commit/08b3c5f4bb7bf353e155fa8363bd381ab50acccd", "message": "ENT-1872: Port DistributorVersionResource to spec-first\n - Add yaml definitions of resource and DTOs\n - Update Translator\n - Fix broken tests", "committedDate": "2020-03-25T13:32:04Z", "type": "forcePushed"}, {"oid": "b28179f46388947898db2d03c88a3226783d5802", "url": "https://github.com/candlepin/candlepin/commit/b28179f46388947898db2d03c88a3226783d5802", "message": "ENT-1872: Port DistributorVersionResource to spec-first\n - Add yaml definitions of resource and DTOs\n - Update Translator\n - Fix broken tests", "committedDate": "2020-03-25T13:34:20Z", "type": "commit"}, {"oid": "b28179f46388947898db2d03c88a3226783d5802", "url": "https://github.com/candlepin/candlepin/commit/b28179f46388947898db2d03c88a3226783d5802", "message": "ENT-1872: Port DistributorVersionResource to spec-first\n - Add yaml definitions of resource and DTOs\n - Update Translator\n - Fix broken tests", "committedDate": "2020-03-25T13:34:20Z", "type": "forcePushed"}]}