{"pr_number": 2573, "pr_title": "[M] Converted ConsumerTypeResource to the OpenAPI specification (ENT-1868)", "pr_createdAt": "2020-01-16T21:50:23Z", "pr_url": "https://github.com/candlepin/candlepin/pull/2573", "timeline": [{"oid": "6535eb8c1bf3f8b08fb4853347b01420eac21ba5", "url": "https://github.com/candlepin/candlepin/commit/6535eb8c1bf3f8b08fb4853347b01420eac21ba5", "message": "Converted ConsumerTypeResource to the OpenAPI specification\n\n- Created new specifications for the consumer type resource and\n  API DTO\n- Updated ConsumerTypeResource to adhere to the generated API\n  specification\n- Removed the existing API ConsumerTypeDTO", "committedDate": "2020-01-20T18:28:44Z", "type": "forcePushed"}, {"oid": "7c7ea308b5e63ba88d876afaaf9465a0abfd64f2", "url": "https://github.com/candlepin/candlepin/commit/7c7ea308b5e63ba88d876afaaf9465a0abfd64f2", "message": "Converted ConsumerTypeResource to the OpenAPI specification\n\n- Created new specifications for the consumer type resource and\n  API DTO\n- Updated ConsumerTypeResource to adhere to the generated API\n  specification\n- Removed the existing API ConsumerTypeDTO", "committedDate": "2020-01-20T19:12:43Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDIwNTIxMA==", "url": "https://github.com/candlepin/candlepin/pull/2573#discussion_r370205210", "bodyText": "So, we don't get a clone method??? This looks tedious.", "author": "nikosmoum", "createdAt": "2020-01-23T15:59:01Z", "path": "server/src/main/java/org/candlepin/dto/api/v1/ImportUpstreamConsumerDTO.java", "diffHunk": "@@ -205,7 +205,17 @@ public ImportUpstreamConsumerDTO clone() {\n         ImportUpstreamConsumerDTO copy = super.clone();\n \n         ConsumerTypeDTO type = this.getConsumerType();\n-        copy.setConsumerType(type != null ? (ConsumerTypeDTO) type.clone() : null);\n+        if (type != null) {\n+            copy.setConsumerType(new ConsumerTypeDTO()", "originalCommit": "7c7ea308b5e63ba88d876afaaf9465a0abfd64f2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg2MTQ4MQ==", "url": "https://github.com/candlepin/candlepin/pull/2573#discussion_r370861481", "bodyText": "Yes", "author": "Ceiu", "createdAt": "2020-01-24T21:59:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDIwNTIxMA=="}], "type": "inlineReview"}, {"oid": "6771a5b49715530112014997dc6f8b24bcf66059", "url": "https://github.com/candlepin/candlepin/commit/6771a5b49715530112014997dc6f8b24bcf66059", "message": "Converted ConsumerTypeResource to the OpenAPI specification\n\n- Created new specifications for the consumer type resource and\n  API DTO\n- Updated ConsumerTypeResource to adhere to the generated API\n  specification\n- Removed the existing API ConsumerTypeDTO", "committedDate": "2020-01-24T18:54:54Z", "type": "forcePushed"}, {"oid": "bf9790c43e64e7d2c7d4109dc32c15782c16cfae", "url": "https://github.com/candlepin/candlepin/commit/bf9790c43e64e7d2c7d4109dc32c15782c16cfae", "message": "Converted ConsumerTypeResource to the OpenAPI specification\n\n- Created new specifications for the consumer type resource and\n  API DTO\n- Updated ConsumerTypeResource to adhere to the generated API\n  specification\n- Removed the existing API ConsumerTypeDTO", "committedDate": "2020-01-24T21:35:56Z", "type": "forcePushed"}, {"oid": "0140e66908011dd48b0b82c26234f40a1d4deeea", "url": "https://github.com/candlepin/candlepin/commit/0140e66908011dd48b0b82c26234f40a1d4deeea", "message": "Converted ConsumerTypeResource to the OpenAPI specification\n\n- Created new specifications for the consumer type resource and\n  API DTO\n- Updated ConsumerTypeResource to adhere to the generated API\n  specification\n- Removed the existing API ConsumerTypeDTO\n- Added a custom deserializer for ConsumerType", "committedDate": "2020-01-27T21:31:59Z", "type": "forcePushed"}, {"oid": "740a4021fc51ac5b5cdb5b3eec7e9eca4b6f4cb7", "url": "https://github.com/candlepin/candlepin/commit/740a4021fc51ac5b5cdb5b3eec7e9eca4b6f4cb7", "message": "Converted ConsumerTypeResource to the OpenAPI specification\n\n- Created new specifications for the consumer type resource and\n  API DTO\n- Updated ConsumerTypeResource to adhere to the generated API\n  specification\n- Removed the existing API ConsumerTypeDTO\n- Added a custom deserializer for ConsumerType", "committedDate": "2020-01-27T21:53:55Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc5NDE2Ng==", "url": "https://github.com/candlepin/candlepin/pull/2573#discussion_r371794166", "bodyText": "What happens when ConsumerDTO.java gets deleted and gets defined in the yaml file? Is there a way to specify custom field se/deserializers for openapi-defined entities?", "author": "nikosmoum", "createdAt": "2020-01-28T13:15:51Z", "path": "server/src/main/java/org/candlepin/dto/api/v1/ConsumerDTO.java", "diffHunk": "@@ -788,6 +789,7 @@ public ConsumerTypeDTO getType() {\n      *\n      * @return a reference to this DTO object.\n      */\n+    @JsonDeserialize(using = ConsumerTypeDeserializer.class)", "originalCommit": "740a4021fc51ac5b5cdb5b3eec7e9eca4b6f4cb7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgwMzM3Mw==", "url": "https://github.com/candlepin/candlepin/pull/2573#discussion_r371803373", "bodyText": "That's indeed a problem that needs to be solved; however is not one that is unique to this addition. We have other such annotations and custom format handlers we'll need to figure out how to add into the (de)serializers.\nTo some extend this is kind of kicking the can down the road for someone else to sort out, but since we have other areas that use it and need sorting, we can revisit it then.", "author": "Ceiu", "createdAt": "2020-01-28T13:33:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc5NDE2Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc5NTIyMg==", "url": "https://github.com/candlepin/candlepin/pull/2573#discussion_r371795222", "bodyText": "The comment should get updated to reflect the new class", "author": "nikosmoum", "createdAt": "2020-01-28T13:17:54Z", "path": "server/src/main/java/org/candlepin/jackson/ConsumerTypeDeserializer.java", "diffHunk": "@@ -0,0 +1,96 @@\n+/**\n+ * Copyright (c) 2009 - 2020 Red Hat, Inc.\n+ *\n+ * This software is licensed to you under the GNU General Public License,\n+ * version 2 (GPLv2). There is NO WARRANTY for this software, express or\n+ * implied, including the implied warranties of MERCHANTABILITY or FITNESS\n+ * FOR A PARTICULAR PURPOSE. You should have received a copy of GPLv2\n+ * along with this software; if not, see\n+ * http://www.gnu.org/licenses/old-licenses/gpl-2.0.txt.\n+ *\n+ * Red Hat trademarks are not licensed under GPLv2. No permission is\n+ * granted to use or replicate Red Hat trademarks that are incorporated\n+ * in this software or its documentation.\n+ */\n+package org.candlepin.jackson;\n+\n+import org.candlepin.common.exceptions.CandlepinJsonProcessingException;\n+import org.candlepin.dto.api.v1.ConsumerTypeDTO;\n+import org.candlepin.model.ConsumerType.ConsumerTypeEnum;\n+\n+import com.fasterxml.jackson.core.JsonParser;\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import com.fasterxml.jackson.databind.DeserializationContext;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.databind.deser.std.StdDeserializer;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.io.IOException;\n+\n+\n+\n+/**\n+ * The CandlepinAttributeDeserializer handles the deserialization of attributes, processing both", "originalCommit": "740a4021fc51ac5b5cdb5b3eec7e9eca4b6f4cb7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgwMzQ0MQ==", "url": "https://github.com/candlepin/candlepin/pull/2573#discussion_r371803441", "bodyText": "Fixed", "author": "Ceiu", "createdAt": "2020-01-28T13:33:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc5NTIyMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc5NzY0Nw==", "url": "https://github.com/candlepin/candlepin/pull/2573#discussion_r371797647", "bodyText": "These should be removed probably", "author": "nikosmoum", "createdAt": "2020-01-28T13:22:25Z", "path": "server/src/main/java/org/candlepin/jackson/ConsumerTypeDeserializer.java", "diffHunk": "@@ -0,0 +1,96 @@\n+/**\n+ * Copyright (c) 2009 - 2020 Red Hat, Inc.\n+ *\n+ * This software is licensed to you under the GNU General Public License,\n+ * version 2 (GPLv2). There is NO WARRANTY for this software, express or\n+ * implied, including the implied warranties of MERCHANTABILITY or FITNESS\n+ * FOR A PARTICULAR PURPOSE. You should have received a copy of GPLv2\n+ * along with this software; if not, see\n+ * http://www.gnu.org/licenses/old-licenses/gpl-2.0.txt.\n+ *\n+ * Red Hat trademarks are not licensed under GPLv2. No permission is\n+ * granted to use or replicate Red Hat trademarks that are incorporated\n+ * in this software or its documentation.\n+ */\n+package org.candlepin.jackson;\n+\n+import org.candlepin.common.exceptions.CandlepinJsonProcessingException;\n+import org.candlepin.dto.api.v1.ConsumerTypeDTO;\n+import org.candlepin.model.ConsumerType.ConsumerTypeEnum;\n+\n+import com.fasterxml.jackson.core.JsonParser;\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import com.fasterxml.jackson.databind.DeserializationContext;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.databind.deser.std.StdDeserializer;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.io.IOException;\n+\n+\n+\n+/**\n+ * The CandlepinAttributeDeserializer handles the deserialization of attributes, processing both\n+ * the current attribute mapping style and obsoleted formats.\n+ */\n+public class ConsumerTypeDeserializer extends StdDeserializer<ConsumerTypeDTO> {\n+    private static Logger log = LoggerFactory.getLogger(ConsumerTypeDeserializer.class);\n+\n+    public ConsumerTypeDeserializer() {\n+        this(null);\n+    }\n+\n+    public ConsumerTypeDeserializer(Class<?> valueClass) {\n+        super(valueClass);\n+    }\n+\n+    @Override\n+    public ConsumerTypeDTO deserialize(JsonParser parser, DeserializationContext context)\n+        throws IOException, JsonProcessingException {\n+\n+        // TreeNode node = parser.readValueAsTree();\n+\n+        // log.debug(\"DESERIALIZING CONSUMER TYPE. TREENODE: {}\", node);", "originalCommit": "740a4021fc51ac5b5cdb5b3eec7e9eca4b6f4cb7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgwMzU5OQ==", "url": "https://github.com/candlepin/candlepin/pull/2573#discussion_r371803599", "bodyText": "Thought I removed these already. Must have ctrl+z'd one too many times.", "author": "Ceiu", "createdAt": "2020-01-28T13:34:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc5NzY0Nw=="}], "type": "inlineReview"}, {"oid": "01da3fc08f168f444bf58c5d5456d5ec09280afb", "url": "https://github.com/candlepin/candlepin/commit/01da3fc08f168f444bf58c5d5456d5ec09280afb", "message": "Converted ConsumerTypeResource to the OpenAPI specification\n\n- Created new specifications for the consumer type resource and\n  API DTO\n- Updated ConsumerTypeResource to adhere to the generated API\n  specification\n- Removed the existing API ConsumerTypeDTO\n- Added a custom deserializer for ConsumerType", "committedDate": "2020-01-28T13:30:52Z", "type": "commit"}, {"oid": "01da3fc08f168f444bf58c5d5456d5ec09280afb", "url": "https://github.com/candlepin/candlepin/commit/01da3fc08f168f444bf58c5d5456d5ec09280afb", "message": "Converted ConsumerTypeResource to the OpenAPI specification\n\n- Created new specifications for the consumer type resource and\n  API DTO\n- Updated ConsumerTypeResource to adhere to the generated API\n  specification\n- Removed the existing API ConsumerTypeDTO\n- Added a custom deserializer for ConsumerType", "committedDate": "2020-01-28T13:30:52Z", "type": "forcePushed"}]}