{"pr_number": 2588, "pr_title": "[F] Fetch provided products from pool.product (ENT-2026)", "pr_createdAt": "2020-01-29T06:30:20Z", "pr_url": "https://github.com/candlepin/candlepin/pull/2588", "timeline": [{"oid": "4d14d199daba2ede8bb1483b140d8df865093c3c", "url": "https://github.com/candlepin/candlepin/commit/4d14d199daba2ede8bb1483b140d8df865093c3c", "message": "Fetch provided products from pool.product", "committedDate": "2020-01-29T06:32:42Z", "type": "forcePushed"}, {"oid": "80fb6c10d64bc362bed457f42bf137de8b91d099", "url": "https://github.com/candlepin/candlepin/commit/80fb6c10d64bc362bed457f42bf137de8b91d099", "message": "Fetch provided products from pool.product", "committedDate": "2020-01-29T10:54:32Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjQxODgxOA==", "url": "https://github.com/candlepin/candlepin/pull/2588#discussion_r372418818", "bodyText": "I'm trying to find out if this change is enough or not. From what I can find out, the code in the productCurator.getPoolProvidedProductsCached() method was added in a0986b4 as an attempt for better performance by caching provided products in JCache, and to use these methods on the curator instead of the pool.getProvidedProducts/derivedProvidedProducts getters. This was later changed by @barnabycourt to use Hibernate L2 cache in 404af50.\nMy assumption is that the original mechanism with the productCurator methods is no longer needed, because Product is already immutable and cachable in hibernate L2, and the only thing we'd need to do is mark the providedProducts collection on Product with @Cachable and @Cache(usage = CacheConcurrencyStrategy.READ_ONLY), just like the other collections, and caching will work implicitly (without using the productCurator workarounds).\n@Ceiu @barnabycourt Are my assumptions correct, or am I missing something?", "author": "nikosmoum", "createdAt": "2020-01-29T14:37:53Z", "path": "server/src/main/java/org/candlepin/service/impl/DefaultEntitlementCertServiceAdapter.java", "diffHunk": "@@ -461,7 +461,7 @@ public String cleanUpPrefix(String contentPrefix) throws IOException {\n                 ent.getQuantity(),\n                 ent.getId());\n \n-            Set<Product> products = new HashSet<>(productCurator.getPoolProvidedProductsCached(pool));\n+            Set<Product> products = new HashSet<>(pool.getProduct().getProvidedProducts());", "originalCommit": "80fb6c10d64bc362bed457f42bf137de8b91d099", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjQyNjczNw==", "url": "https://github.com/candlepin/candlepin/pull/2588#discussion_r372426737", "bodyText": "That is my assumption as well", "author": "Ceiu", "createdAt": "2020-01-29T14:50:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjQxODgxOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzI2NDM4OA==", "url": "https://github.com/candlepin/candlepin/pull/2588#discussion_r373264388", "bodyText": "@nikosmoum Added caching annotation on providedProducts and also, remove reference of productCurator.getPoolProvidedProductsCached() from other places. Only 3 more places where this method still being used and these will be updated in refresh PR.", "author": "abhiskum", "createdAt": "2020-01-31T00:27:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjQxODgxOA=="}], "type": "inlineReview"}, {"oid": "f1d5a968af42cfbeb5d5af8271c138ba604fd32d", "url": "https://github.com/candlepin/candlepin/commit/f1d5a968af42cfbeb5d5af8271c138ba604fd32d", "message": "Fetch provided products from pool.product\n  - Updated Product.java to cache provided products\n  - Updated Pool.java to populate providedProductDtos from product.providedProducts\n  - Updated code to fetch provided products from pool.product.providedProducts\n  - Updated Junit and rspec based on these changes", "committedDate": "2020-01-30T10:45:05Z", "type": "commit"}, {"oid": "f1d5a968af42cfbeb5d5af8271c138ba604fd32d", "url": "https://github.com/candlepin/candlepin/commit/f1d5a968af42cfbeb5d5af8271c138ba604fd32d", "message": "Fetch provided products from pool.product\n  - Updated Product.java to cache provided products\n  - Updated Pool.java to populate providedProductDtos from product.providedProducts\n  - Updated code to fetch provided products from pool.product.providedProducts\n  - Updated Junit and rspec based on these changes", "committedDate": "2020-01-30T10:45:05Z", "type": "forcePushed"}]}