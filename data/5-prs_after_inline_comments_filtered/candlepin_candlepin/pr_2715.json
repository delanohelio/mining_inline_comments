{"pr_number": 2715, "pr_title": "1834762: crl file candlepin-crl.crl is not found on the candlepin server", "pr_createdAt": "2020-05-28T12:13:05Z", "pr_url": "https://github.com/candlepin/candlepin/pull/2715", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTgwMzU1Ng==", "url": "https://github.com/candlepin/candlepin/pull/2715#discussion_r431803556", "bodyText": "We should write these to the log and probably rethrow the exception as well.", "author": "Ceiu", "createdAt": "2020-05-28T12:40:00Z", "path": "server/src/main/java/org/candlepin/guice/CandlepinContextListener.java", "diffHunk": "@@ -224,6 +229,20 @@ private void initializeSubsystems(Injector injector) throws Exception {\n             capabilities.add(CandlepinCapabilities.KEYCLOAK_AUTH_CAPBILITY);\n         }\n \n+        // Init CRL file\n+        this.crlFileUtil = injector.getInstance(CrlFileUtil.class);\n+        String filePath = getCrlFilePath();\n+        File crlFile = new File(filePath);\n+        if (!crlFile.exists() || crlFile.length() == 0) {\n+            try {\n+                this.crlFileUtil.initializeCRLFile(crlFile, Collections.emptyList());\n+            }\n+            catch (IOException e) {\n+                e.printStackTrace();", "originalCommit": "4d5f15bf713a0c6ce5665d5092dc8b35b4b2bc8d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTg0MDQ3NQ==", "url": "https://github.com/candlepin/candlepin/pull/2715#discussion_r431840475", "bodyText": "Done.", "author": "Januson", "createdAt": "2020-05-28T13:37:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTgwMzU1Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTgwNDM3MA==", "url": "https://github.com/candlepin/candlepin/pull/2715#discussion_r431804370", "bodyText": "IseException is a REST exception. We should throw something like a ConfigurationException here instead.", "author": "Ceiu", "createdAt": "2020-05-28T12:41:28Z", "path": "server/src/main/java/org/candlepin/guice/CandlepinContextListener.java", "diffHunk": "@@ -382,4 +401,15 @@ private void insertValidationEventListeners(Injector injector) {\n         registry.getEventListenerGroup(EventType.PRE_UPDATE).appendListener(listenerProvider.get());\n         registry.getEventListenerGroup(EventType.PRE_DELETE).appendListener(listenerProvider.get());\n     }\n+\n+\n+    private String getCrlFilePath() {\n+        String filePath = config.getString(ConfigProperties.CRL_FILE_PATH);\n+\n+        if (filePath == null) {\n+            throw new IseException(\"CRL file path not defined in config file\");", "originalCommit": "4d5f15bf713a0c6ce5665d5092dc8b35b4b2bc8d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTg0MDM0OQ==", "url": "https://github.com/candlepin/candlepin/pull/2715#discussion_r431840349", "bodyText": "Done.", "author": "Januson", "createdAt": "2020-05-28T13:37:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTgwNDM3MA=="}], "type": "inlineReview"}, {"oid": "9cfbb59683afbf8786f43026a04b43a59e277b7b", "url": "https://github.com/candlepin/candlepin/commit/9cfbb59683afbf8786f43026a04b43a59e277b7b", "message": "1834762: crl file candlepin-crl.crl is not found on the candlepin server\n- Added a check to initialize the CRL file if it is missing during the Candlepin startup", "committedDate": "2020-05-28T13:29:57Z", "type": "forcePushed"}, {"oid": "43ea71d757b876c11a3a802c9d4d34e2ac2dada4", "url": "https://github.com/candlepin/candlepin/commit/43ea71d757b876c11a3a802c9d4d34e2ac2dada4", "message": "1834762: crl file candlepin-crl.crl is not found on the candlepin server\n- Added a check to initialize the CRL file if it is missing during the Candlepin startup", "committedDate": "2020-05-28T13:41:33Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTg0NjU0NA==", "url": "https://github.com/candlepin/candlepin/pull/2715#discussion_r431846544", "bodyText": "This one should stay as an IOException, just rethrown.", "author": "Ceiu", "createdAt": "2020-05-28T13:45:59Z", "path": "server/src/main/java/org/candlepin/guice/CandlepinContextListener.java", "diffHunk": "@@ -224,6 +228,21 @@ private void initializeSubsystems(Injector injector) throws Exception {\n             capabilities.add(CandlepinCapabilities.KEYCLOAK_AUTH_CAPBILITY);\n         }\n \n+        // Init CRL file\n+        this.crlFileUtil = injector.getInstance(CrlFileUtil.class);\n+        String filePath = getCrlFilePath();\n+        File crlFile = new File(filePath);\n+        if (!crlFile.exists() || crlFile.length() == 0) {\n+            try {\n+                this.crlFileUtil.initializeCRLFile(crlFile, Collections.emptyList());\n+            }\n+            catch (IOException e) {\n+                log.error(\"Error occurred during initialization of CRL file!\", e);\n+                throw new ConfigurationException(\"Error occurred during initialization of CRL file!\", e);", "originalCommit": "43ea71d757b876c11a3a802c9d4d34e2ac2dada4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTg2MDUxMQ==", "url": "https://github.com/candlepin/candlepin/pull/2715#discussion_r431860511", "bodyText": "Done.", "author": "Januson", "createdAt": "2020-05-28T14:04:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTg0NjU0NA=="}], "type": "inlineReview"}, {"oid": "2cb771cf66a28dd1d0ab43156e634233c0038055", "url": "https://github.com/candlepin/candlepin/commit/2cb771cf66a28dd1d0ab43156e634233c0038055", "message": "1834762: crl file candlepin-crl.crl is not found on the candlepin server\n- Added a check to initialize the CRL file if it is missing during the Candlepin startup", "committedDate": "2020-05-28T14:03:37Z", "type": "commit"}, {"oid": "2cb771cf66a28dd1d0ab43156e634233c0038055", "url": "https://github.com/candlepin/candlepin/commit/2cb771cf66a28dd1d0ab43156e634233c0038055", "message": "1834762: crl file candlepin-crl.crl is not found on the candlepin server\n- Added a check to initialize the CRL file if it is missing during the Candlepin startup", "committedDate": "2020-05-28T14:03:37Z", "type": "forcePushed"}]}