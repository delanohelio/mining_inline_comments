{"pr_number": 1204, "pr_title": "Elide 5.x elide-async integration in elide-spring", "pr_createdAt": "2020-02-26T22:41:40Z", "pr_url": "https://github.com/yahoo/elide/pull/1204", "timeline": [{"oid": "3fe537ee18d074f39aa34e62bb8798e3337cb2a8", "url": "https://github.com/yahoo/elide/commit/3fe537ee18d074f39aa34e62bb8798e3337cb2a8", "message": "Integrating elide-async.\n\nCo-authored-by: Abhino <abhino@gmail.com>", "committedDate": "2020-02-26T22:43:50Z", "type": "forcePushed"}, {"oid": "03f9b8186f24af1e92315d18b204196f81a8f169", "url": "https://github.com/yahoo/elide/commit/03f9b8186f24af1e92315d18b204196f81a8f169", "message": "Integrating elide-async.\n\nCo-authored-by: Abhino <abhino@gmail.com>\n\nIntegrating elide-async.\n\nCo-authored-by: Abhino <abhino@gmail.com>", "committedDate": "2020-02-26T22:46:48Z", "type": "commit"}, {"oid": "03f9b8186f24af1e92315d18b204196f81a8f169", "url": "https://github.com/yahoo/elide/commit/03f9b8186f24af1e92315d18b204196f81a8f169", "message": "Integrating elide-async.\n\nCo-authored-by: Abhino <abhino@gmail.com>\n\nIntegrating elide-async.\n\nCo-authored-by: Abhino <abhino@gmail.com>", "committedDate": "2020-02-26T22:46:48Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTI2MDA0Mw==", "url": "https://github.com/yahoo/elide/pull/1204#discussion_r385260043", "bodyText": "Time variables should always include Units in their name so they are unambiguous.", "author": "aklish", "createdAt": "2020-02-27T17:28:41Z", "path": "elide-spring/elide-spring-boot-autoconfigure/src/main/java/com/yahoo/elide/spring/config/AsyncProperties.java", "diffHunk": "@@ -0,0 +1,31 @@\n+/*\n+ * Copyright 2020, Yahoo Inc.\n+ * Licensed under the Apache License, Version 2.0\n+ * See LICENSE file in project root for terms.\n+ */\n+package com.yahoo.elide.spring.config;\n+\n+import lombok.Data;\n+\n+/**\n+ * Extra properties for setting up async query support.\n+ */\n+@Data\n+public class AsyncProperties extends ControllerProperties {\n+\n+    /**\n+     * Default thread pool size.\n+     */\n+    private int threadPoolSize = 6;\n+\n+    /**\n+     * Default max query run time.\n+     */\n+    private int maxRunTime = 60;", "originalCommit": "03f9b8186f24af1e92315d18b204196f81a8f169", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTI2MDM3OA==", "url": "https://github.com/yahoo/elide/pull/1204#discussion_r385260378", "bodyText": "I think we'll want two times here - one for the timeout and one for cleanup (deletion).  Both should be configurable.", "author": "aklish", "createdAt": "2020-02-27T17:29:04Z", "path": "elide-spring/elide-spring-boot-autoconfigure/src/main/java/com/yahoo/elide/spring/config/AsyncProperties.java", "diffHunk": "@@ -0,0 +1,31 @@\n+/*\n+ * Copyright 2020, Yahoo Inc.\n+ * Licensed under the Apache License, Version 2.0\n+ * See LICENSE file in project root for terms.\n+ */\n+package com.yahoo.elide.spring.config;\n+\n+import lombok.Data;\n+\n+/**\n+ * Extra properties for setting up async query support.\n+ */\n+@Data\n+public class AsyncProperties extends ControllerProperties {\n+\n+    /**\n+     * Default thread pool size.\n+     */\n+    private int threadPoolSize = 6;\n+\n+    /**\n+     * Default max query run time.\n+     */\n+    private int maxRunTime = 60;", "originalCommit": "03f9b8186f24af1e92315d18b204196f81a8f169", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTMyOTQ2Nw==", "url": "https://github.com/yahoo/elide/pull/1204#discussion_r385329467", "bodyText": "We are calculating the cleanup time in elide-async based on provided maxRunTime. It's set to the maximum of 6 Hours or Twice of the maxRunTime provided by the user.  If we pass both params then we will have to do checks to make sure cleanup time is not less than the timeout.", "author": "moizarafat", "createdAt": "2020-02-27T19:39:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTI2MDM3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTMzMTgzNA==", "url": "https://github.com/yahoo/elide/pull/1204#discussion_r385331834", "bodyText": "elide/elide-async/src/main/java/com/yahoo/elide/async/service/AsyncExecutorService.java\n    \n    \n         Line 63\n      in\n      c88d08a\n    \n    \n    \n    \n\n        \n          \n           cleaner.scheduleWithFixedDelay(cleanUpTask, initialDelay, Math.max(DEFAULT_CLEANUP_DELAY, maxRunTime * 2), TimeUnit.MINUTES);", "author": "moizarafat", "createdAt": "2020-02-27T19:43:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTI2MDM3OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTI2MDU3Mg==", "url": "https://github.com/yahoo/elide/pull/1204#discussion_r385260572", "bodyText": "Do we need this?", "author": "aklish", "createdAt": "2020-02-27T17:29:29Z", "path": "elide-spring/elide-spring-boot-autoconfigure/src/main/java/com/yahoo/elide/spring/config/AsyncProperties.java", "diffHunk": "@@ -0,0 +1,31 @@\n+/*\n+ * Copyright 2020, Yahoo Inc.\n+ * Licensed under the Apache License, Version 2.0\n+ * See LICENSE file in project root for terms.\n+ */\n+package com.yahoo.elide.spring.config;\n+\n+import lombok.Data;\n+\n+/**\n+ * Extra properties for setting up async query support.\n+ */\n+@Data\n+public class AsyncProperties extends ControllerProperties {\n+\n+    /**\n+     * Default thread pool size.\n+     */\n+    private int threadPoolSize = 6;\n+\n+    /**\n+     * Default max query run time.\n+     */\n+    private int maxRunTime = 60;\n+\n+    /**\n+     * Default number of hosts running Elide.\n+     */\n+    private int numberOfHosts = 1;", "originalCommit": "03f9b8186f24af1e92315d18b204196f81a8f169", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTMzMTM5OQ==", "url": "https://github.com/yahoo/elide/pull/1204#discussion_r385331399", "bodyText": "so we are using this param to randomize the start-up time for cleanup executor. If we have more than 1 hosts running and then if all of them have the cleanup service executing at the same time they could possibly try to update/delete the record at the same time and have lock error etc.  so this is how we are using it here. \n  \n    \n      elide/elide-async/src/main/java/com/yahoo/elide/async/service/AsyncExecutorService.java\n    \n    \n        Lines 59 to 63\n      in\n      c88d08a\n    \n    \n    \n    \n\n        \n          \n           Random random = new Random(); \n        \n\n        \n          \n           int initialDelay = random.ints(0, numberOfNodes * 2).limit(1).findFirst().getAsInt(); \n        \n\n        \n          \n            \n        \n\n        \n          \n           //Having a delay of at least DEFAULT_CLEANUP_DELAY between two cleanup attempts. \n        \n\n        \n          \n           cleaner.scheduleWithFixedDelay(cleanUpTask, initialDelay, Math.max(DEFAULT_CLEANUP_DELAY, maxRunTime * 2), TimeUnit.MINUTES);", "author": "moizarafat", "createdAt": "2020-02-27T19:43:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTI2MDU3Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTI2MDkwMw==", "url": "https://github.com/yahoo/elide/pull/1204#discussion_r385260903", "bodyText": "If we are using the JpaDataStore, these classes are automatically discovered.  There is no need to explicitly bind them.", "author": "aklish", "createdAt": "2020-02-27T17:30:09Z", "path": "elide-spring/elide-spring-boot-autoconfigure/src/main/java/com/yahoo/elide/spring/config/ElideAsyncConfiguration.java", "diffHunk": "@@ -0,0 +1,56 @@\n+/*\n+ * Copyright 2019, Yahoo Inc.\n+ * Licensed under the Apache License, Version 2.0\n+ * See LICENSE file in project root for terms.\n+ */\n+package com.yahoo.elide.spring.config;\n+\n+import com.yahoo.elide.Elide;\n+import com.yahoo.elide.async.models.AsyncQuery;\n+import com.yahoo.elide.async.models.AsyncQueryResult;\n+import com.yahoo.elide.async.service.AsyncExecutorService;\n+import com.yahoo.elide.core.EntityDictionary;\n+\n+import org.springframework.boot.autoconfigure.condition.ConditionalOnExpression;\n+import org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;\n+import org.springframework.boot.autoconfigure.domain.EntityScan;\n+import org.springframework.boot.context.properties.EnableConfigurationProperties;\n+import org.springframework.context.annotation.Bean;\n+import org.springframework.context.annotation.Configuration;\n+\n+/**\n+ * Async Configuration For Elide Services.  Override any of the beans (by defining your own) to change\n+ * the default behavior.\n+ */\n+@Configuration\n+@EntityScan(basePackageClasses = AsyncQuery.class)\n+@EnableConfigurationProperties(ElideConfigProperties.class)\n+@ConditionalOnExpression(\"${elide.async.enabled:false}\")\n+public class ElideAsyncConfiguration {\n+\n+    /**\n+     * Updates the entity dictionary for Elide by binding the Async Models.\n+     * @param dictionary Contains the static metadata about Elide models.\n+     * @return updated instance of dictionary.\n+     */\n+    public EntityDictionary bindAsyncDictionary(EntityDictionary dictionary) {\n+\n+        dictionary.bindEntity(AsyncQuery.class);", "originalCommit": "03f9b8186f24af1e92315d18b204196f81a8f169", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTI2MTQ3NQ==", "url": "https://github.com/yahoo/elide/pull/1204#discussion_r385261475", "bodyText": "We should be able to remove this function", "author": "aklish", "createdAt": "2020-02-27T17:31:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTI2MDkwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTMzMjMwNQ==", "url": "https://github.com/yahoo/elide/pull/1204#discussion_r385332305", "bodyText": "Did this because we did not want the Async Models to be discovered/binded if the enableAsync is set to false.", "author": "moizarafat", "createdAt": "2020-02-27T19:44:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTI2MDkwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjE0NzY4MA==", "url": "https://github.com/yahoo/elide/pull/1204#discussion_r386147680", "bodyText": "@aklish will remove this. but we still need to include @EntityScan(basePackageClasses = AsyncQuery.class) for them to be discovered. Please see my response on the next comment.", "author": "moizarafat", "createdAt": "2020-03-01T22:39:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTI2MDkwMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTI2MjU0OA==", "url": "https://github.com/yahoo/elide/pull/1204#discussion_r385262548", "bodyText": "I don't think we need this.  Why did we add?", "author": "aklish", "createdAt": "2020-02-27T17:33:02Z", "path": "elide-spring/elide-spring-boot-autoconfigure/src/test/java/com/yahoo/elide/spring/App.java", "diffHunk": "@@ -15,6 +16,7 @@\n  */\n @Slf4j\n @SpringBootApplication\n+@EntityScan(basePackages = {\"${elide.modelPackage}\"})", "originalCommit": "03f9b8186f24af1e92315d18b204196f81a8f169", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTMzMzI4MQ==", "url": "https://github.com/yahoo/elide/pull/1204#discussion_r385333281", "bodyText": "If we don't this, the Async Models are bound by default to API and swagger as they have @Entity annotation. We wanted to avoid that and are explicitly telling it to bind/discover the entities in the provided package. We bind the Async Models separately based on if enableAsync is true/false.", "author": "moizarafat", "createdAt": "2020-02-27T19:46:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTI2MjU0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjE0ODIxNw==", "url": "https://github.com/yahoo/elide/pull/1204#discussion_r386148217", "bodyText": "@aklish Since we are putting @EntityScan(basePackageClasses = AsyncQuery.class) in the ElideAsyncConfiguration.java, it overrides the default behavior of spring to scan all the entities in the package where App.java (with annotation @SpringBootApplication) will be placed. In my testing, I found that we can change @EntityScan(basePackages = {\"${elide.modelPackage}\"}) to @EntityScan in this class and it should work fine. This will be a simple change for users that can be included in the documentation.\nThe other option would be as suggested by you that we include the logic from the dynamic config design to use our own implementation of LocalContainerEntityManagerFactoryBean and add the Async models ourselves but it could potentially take time to implement and test out fullt. Let me know your thoughts.", "author": "moizarafat", "createdAt": "2020-03-01T22:46:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTI2MjU0OA=="}], "type": "inlineReview"}, {"oid": "18f4c74a0ae3d5313aece0e909c5a8cd8969607c", "url": "https://github.com/yahoo/elide/commit/18f4c74a0ae3d5313aece0e909c5a8cd8969607c", "message": "Removing unwanted params.\n\nCo-authored-by: Abhino <abhino@gmail.com>", "committedDate": "2020-03-01T23:11:54Z", "type": "commit"}, {"oid": "4d9d96b148fa17b6bf9ed5d5e73c657f298cccf9", "url": "https://github.com/yahoo/elide/commit/4d9d96b148fa17b6bf9ed5d5e73c657f298cccf9", "message": "Binding Cleaner service.\n\nCo-authored-by: Abhino <abhino@gmail.com>", "committedDate": "2020-03-02T18:30:23Z", "type": "commit"}, {"oid": "305c7197ec34edd4d02a009d690347ac1d614525", "url": "https://github.com/yahoo/elide/commit/305c7197ec34edd4d02a009d690347ac1d614525", "message": "Adding query result retention.\n\nCo-authored-by: Abhino <abhino@gmail.com>", "committedDate": "2020-03-03T01:33:58Z", "type": "commit"}, {"oid": "d26a2e895fd2cfdc9d0ce62bfcc4afad97c5fe62", "url": "https://github.com/yahoo/elide/commit/d26a2e895fd2cfdc9d0ce62bfcc4afad97c5fe62", "message": "Adding query result retention.\n\nCo-authored-by: Abhino <abhino@gmail.com>", "committedDate": "2020-03-08T00:41:48Z", "type": "forcePushed"}, {"oid": "fee5acee48de035ebc852e9a578237744a29d8af", "url": "https://github.com/yahoo/elide/commit/fee5acee48de035ebc852e9a578237744a29d8af", "message": "Fixing integration issues\n\nCo-authored-by: Abhino <abhino@gmail.com>", "committedDate": "2020-03-11T15:51:29Z", "type": "forcePushed"}, {"oid": "fee5acee48de035ebc852e9a578237744a29d8af", "url": "https://github.com/yahoo/elide/commit/fee5acee48de035ebc852e9a578237744a29d8af", "message": "Fixing integration issues\n\nCo-authored-by: Abhino <abhino@gmail.com>", "committedDate": "2020-03-11T15:51:29Z", "type": "forcePushed"}, {"oid": "760d353d6d2aab16802335a6e7e3eb22d31145bc", "url": "https://github.com/yahoo/elide/commit/760d353d6d2aab16802335a6e7e3eb22d31145bc", "message": "Adding DAO configuration\n\nCo-authored-by: Abhino <abhino@gmail.com>", "committedDate": "2020-03-11T16:49:26Z", "type": "commit"}, {"oid": "f4fc324b4c503a1ac41d8dec88db4f3268646ec5", "url": "https://github.com/yahoo/elide/commit/f4fc324b4c503a1ac41d8dec88db4f3268646ec5", "message": "Checkstyle error\n\nCo-authored-by: Abhino <abhino@gmail.com>", "committedDate": "2020-03-11T16:54:03Z", "type": "commit"}, {"oid": "f4fc324b4c503a1ac41d8dec88db4f3268646ec5", "url": "https://github.com/yahoo/elide/commit/f4fc324b4c503a1ac41d8dec88db4f3268646ec5", "message": "Checkstyle error\n\nCo-authored-by: Abhino <abhino@gmail.com>", "committedDate": "2020-03-11T16:54:03Z", "type": "forcePushed"}, {"oid": "f4fc324b4c503a1ac41d8dec88db4f3268646ec5", "url": "https://github.com/yahoo/elide/commit/f4fc324b4c503a1ac41d8dec88db4f3268646ec5", "message": "Checkstyle error\n\nCo-authored-by: Abhino <abhino@gmail.com>", "committedDate": "2020-03-11T16:54:03Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTIwNTU0NA==", "url": "https://github.com/yahoo/elide/pull/1204#discussion_r391205544", "bodyText": "This should also be conditional on async being enabled (no point to have the cleaner in that case).", "author": "aklish", "createdAt": "2020-03-11T19:18:50Z", "path": "elide-spring/elide-spring-boot-autoconfigure/src/main/java/com/yahoo/elide/spring/config/ElideAsyncCleanupConfiguration.java", "diffHunk": "@@ -0,0 +1,40 @@\n+/*\n+ * Copyright 2019, Yahoo Inc.\n+ * Licensed under the Apache License, Version 2.0\n+ * See LICENSE file in project root for terms.\n+ */\n+package com.yahoo.elide.spring.config;\n+\n+import com.yahoo.elide.Elide;\n+import com.yahoo.elide.async.service.AsyncCleanerService;\n+import com.yahoo.elide.async.service.AsyncQueryDAO;\n+\n+import org.springframework.boot.autoconfigure.condition.ConditionalOnExpression;\n+import org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;\n+import org.springframework.boot.context.properties.EnableConfigurationProperties;\n+import org.springframework.context.annotation.Bean;\n+import org.springframework.context.annotation.Configuration;\n+\n+/**\n+ * Async Configuration For Elide Services.  Override any of the beans (by defining your own) to change\n+ * the default behavior.\n+ */\n+@Configuration\n+@EnableConfigurationProperties(ElideConfigProperties.class)\n+@ConditionalOnExpression(\"${elide.async.cleanupEnabled:false}\")", "originalCommit": "f4fc324b4c503a1ac41d8dec88db4f3268646ec5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTIwNTg1NA==", "url": "https://github.com/yahoo/elide/pull/1204#discussion_r391205854", "bodyText": "In auto-configuration, I thought this was done with ConditionalOnMissingBean annotations rather than config.", "author": "aklish", "createdAt": "2020-03-11T19:19:20Z", "path": "elide-spring/elide-spring-boot-autoconfigure/src/main/java/com/yahoo/elide/spring/config/AsyncProperties.java", "diffHunk": "@@ -0,0 +1,42 @@\n+/*\n+ * Copyright 2020, Yahoo Inc.\n+ * Licensed under the Apache License, Version 2.0\n+ * See LICENSE file in project root for terms.\n+ */\n+package com.yahoo.elide.spring.config;\n+\n+import lombok.Data;\n+\n+/**\n+ * Extra properties for setting up async query support.\n+ */\n+@Data\n+public class AsyncProperties extends ControllerProperties {\n+\n+    /**\n+     * Default thread pool size.\n+     */\n+    private int threadPoolSize = 6;\n+\n+    /**\n+     * Default max query run time.\n+     */\n+    private int maxRunTimeMinutes = 60;\n+\n+    /**\n+     * Whether or not the cleanup is enabled.\n+     */\n+    private boolean cleanupEnabled = false;\n+\n+    /**\n+     * Default retention of async query and results.\n+     */\n+    private int queryCleanupDays = 7;\n+\n+    /**\n+     * Whether or not to use the default implementation of AsyncQueryDAO.\n+     * If false, the user will provide custom implementation of AsyncQueryDAO.\n+     */\n+    private boolean defaultAsyncQueryDAO = true;", "originalCommit": "f4fc324b4c503a1ac41d8dec88db4f3268646ec5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTcyNTY0OA==", "url": "https://github.com/yahoo/elide/pull/1204#discussion_r391725648", "bodyText": "If the user provides his bean we will not be able to control the injection order so we should disable our injection using this param and also be consistent with standalone where the user overrides the getAsyncQueryDAO method.", "author": "moizarafat", "createdAt": "2020-03-12T16:04:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTIwNTg1NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTIwNzIxMQ==", "url": "https://github.com/yahoo/elide/pull/1204#discussion_r391207211", "bodyText": "ConditionalOnMissingBean should suffice.", "author": "aklish", "createdAt": "2020-03-11T19:22:04Z", "path": "elide-spring/elide-spring-boot-autoconfigure/src/main/java/com/yahoo/elide/spring/config/ElideAsyncQueryDAOConfiguration.java", "diffHunk": "@@ -0,0 +1,37 @@\n+/*\n+ * Copyright 2019, Yahoo Inc.\n+ * Licensed under the Apache License, Version 2.0\n+ * See LICENSE file in project root for terms.\n+ */\n+package com.yahoo.elide.spring.config;\n+\n+import com.yahoo.elide.Elide;\n+import com.yahoo.elide.async.service.AsyncQueryDAO;\n+import com.yahoo.elide.async.service.DefaultAsyncQueryDAO;\n+\n+import org.springframework.boot.autoconfigure.condition.ConditionalOnExpression;\n+import org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;\n+import org.springframework.boot.context.properties.EnableConfigurationProperties;\n+import org.springframework.context.annotation.Bean;\n+import org.springframework.context.annotation.Configuration;\n+\n+/**\n+ * Async Configuration For Elide Services.  Override any of the beans (by defining your own) to change\n+ * the default behavior.\n+ */\n+@Configuration\n+@EnableConfigurationProperties(ElideConfigProperties.class)\n+@ConditionalOnExpression(\"${elide.async.defaultAsyncQueryDAO:true}\")", "originalCommit": "f4fc324b4c503a1ac41d8dec88db4f3268646ec5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTcyNjU3OA==", "url": "https://github.com/yahoo/elide/pull/1204#discussion_r391726578", "bodyText": "see previous comment on AsyncProperties.java about adding defaultAsyncQueryDAO", "author": "moizarafat", "createdAt": "2020-03-12T16:06:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTIwNzIxMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTIwNzQ1Mg==", "url": "https://github.com/yahoo/elide/pull/1204#discussion_r391207452", "bodyText": "Instead of breaking out all of these beans into separate files - why not just put them in a single ElideAsyncConfiguration class?", "author": "aklish", "createdAt": "2020-03-11T19:22:34Z", "path": "elide-spring/elide-spring-boot-autoconfigure/src/main/java/com/yahoo/elide/spring/config/ElideAsyncConfiguration.java", "diffHunk": "@@ -0,0 +1,43 @@\n+/*\n+ * Copyright 2019, Yahoo Inc.\n+ * Licensed under the Apache License, Version 2.0\n+ * See LICENSE file in project root for terms.\n+ */\n+package com.yahoo.elide.spring.config;\n+\n+import com.yahoo.elide.Elide;\n+import com.yahoo.elide.async.models.AsyncQuery;\n+import com.yahoo.elide.async.service.AsyncExecutorService;\n+import com.yahoo.elide.async.service.AsyncQueryDAO;\n+\n+import org.springframework.boot.autoconfigure.condition.ConditionalOnExpression;\n+import org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;\n+import org.springframework.boot.autoconfigure.domain.EntityScan;\n+import org.springframework.boot.context.properties.EnableConfigurationProperties;\n+import org.springframework.context.annotation.Bean;\n+import org.springframework.context.annotation.Configuration;\n+\n+/**\n+ * Async Configuration For Elide Services.  Override any of the beans (by defining your own) to change\n+ * the default behavior.\n+ */\n+@Configuration\n+@EntityScan(basePackageClasses = AsyncQuery.class)\n+@EnableConfigurationProperties(ElideConfigProperties.class)\n+@ConditionalOnExpression(\"${elide.async.enabled:false}\")\n+public class ElideAsyncConfiguration {", "originalCommit": "f4fc324b4c503a1ac41d8dec88db4f3268646ec5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTcyNjc2Mg==", "url": "https://github.com/yahoo/elide/pull/1204#discussion_r391726762", "bodyText": "Merging them into one config now", "author": "moizarafat", "createdAt": "2020-03-12T16:06:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTIwNzQ1Mg=="}], "type": "inlineReview"}, {"oid": "9ee041e3773b9ba15818e9b89184c0c71ce12d29", "url": "https://github.com/yahoo/elide/commit/9ee041e3773b9ba15818e9b89184c0c71ce12d29", "message": "Review comments\n\nCo-authored-by: Abhino <abhino@gmail.com>", "committedDate": "2020-03-12T16:07:27Z", "type": "commit"}, {"oid": "6fdad1b1b5c2053fbec736031c032f574082a541", "url": "https://github.com/yahoo/elide/commit/6fdad1b1b5c2053fbec736031c032f574082a541", "message": "Review comments\n\nCo-authored-by: Abhino <abhino@gmail.com>", "committedDate": "2020-03-12T16:40:32Z", "type": "commit"}, {"oid": "b38086471c4de41fb783562de03f89749e639e7e", "url": "https://github.com/yahoo/elide/commit/b38086471c4de41fb783562de03f89749e639e7e", "message": "Review comments", "committedDate": "2020-03-25T15:56:29Z", "type": "commit"}, {"oid": "b8fbdfcd17abfde07df1609ced32d19906884a4a", "url": "https://github.com/yahoo/elide/commit/b8fbdfcd17abfde07df1609ced32d19906884a4a", "message": "Merge branch 'elide-5.x-async' into elide-5.x-async-spring", "committedDate": "2020-03-26T17:15:19Z", "type": "commit"}]}