{"pr_number": 1668, "pr_title": "Make Dynamic Compile work without shade plugin", "pr_createdAt": "2020-11-17T19:50:44Z", "pr_url": "https://github.com/yahoo/elide/pull/1668", "timeline": [{"oid": "8549e2cf99bf7381122f519a04473acbcadce63b", "url": "https://github.com/yahoo/elide/commit/8549e2cf99bf7381122f519a04473acbcadce63b", "message": "Initial commit", "committedDate": "2020-11-17T20:32:33Z", "type": "forcePushed"}, {"oid": "51365f70f31b81e31fca8d2fe476fe24e33ac115", "url": "https://github.com/yahoo/elide/commit/51365f70f31b81e31fca8d2fe476fe24e33ac115", "message": "Initial commit", "committedDate": "2020-11-17T20:38:12Z", "type": "forcePushed"}, {"oid": "06aa8d5c75e6c426be014b0a74694501ce591027", "url": "https://github.com/yahoo/elide/commit/06aa8d5c75e6c426be014b0a74694501ce591027", "message": "Initial commit", "committedDate": "2020-11-17T20:40:01Z", "type": "forcePushed"}, {"oid": "954988e89bdd6d17b6c640d81148e564f30314ab", "url": "https://github.com/yahoo/elide/commit/954988e89bdd6d17b6c640d81148e564f30314ab", "message": "Initial commit", "committedDate": "2020-11-17T20:41:17Z", "type": "forcePushed"}, {"oid": "9b626fdae2fc82bd6dce562f4ef217183dc7a8f9", "url": "https://github.com/yahoo/elide/commit/9b626fdae2fc82bd6dce562f4ef217183dc7a8f9", "message": "Initial commit", "committedDate": "2020-11-17T20:42:45Z", "type": "forcePushed"}, {"oid": "d6ccdec84d2c34be74f32c7455897912ce7ebeb7", "url": "https://github.com/yahoo/elide/commit/d6ccdec84d2c34be74f32c7455897912ce7ebeb7", "message": "Initial commit", "committedDate": "2020-11-17T21:54:57Z", "type": "forcePushed"}, {"oid": "43b9b892860f52bdb6ce9cb27ca6f31616c67f45", "url": "https://github.com/yahoo/elide/commit/43b9b892860f52bdb6ce9cb27ca6f31616c67f45", "message": "Initial commit", "committedDate": "2020-11-17T22:22:02Z", "type": "commit"}, {"oid": "43b9b892860f52bdb6ce9cb27ca6f31616c67f45", "url": "https://github.com/yahoo/elide/commit/43b9b892860f52bdb6ce9cb27ca6f31616c67f45", "message": "Initial commit", "committedDate": "2020-11-17T22:22:02Z", "type": "forcePushed"}, {"oid": "27c88591001e7202cae0fa485868172ee3daf16d", "url": "https://github.com/yahoo/elide/commit/27c88591001e7202cae0fa485868172ee3daf16d", "message": "Merge branch 'elide-5.x' into without_shade", "committedDate": "2020-11-18T20:12:10Z", "type": "commit"}, {"oid": "bb107f89dd8798d1847045a3824663ccdcabc13c", "url": "https://github.com/yahoo/elide/commit/bb107f89dd8798d1847045a3824663ccdcabc13c", "message": "Update ElideDynamicEntityCompiler.java", "committedDate": "2020-11-18T20:13:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjM5OTY5Mg==", "url": "https://github.com/yahoo/elide/pull/1668#discussion_r526399692", "bodyText": "There are some strong recommendations to not use the context class loader and instead just this.class.getClassLoader instead:\nhttps://stackoverflow.com/questions/1771679/difference-between-threads-context-class-loader-and-normal-classloader#:~:text=The%20thread%20context%20classloader%20is,currentThread().", "author": "aklish", "createdAt": "2020-11-18T20:28:31Z", "path": "elide-model-config/src/main/java/com/yahoo/elide/contrib/dynamicconfighelpers/compile/ElideDynamicEntityCompiler.java", "diffHunk": "@@ -125,9 +125,24 @@ public ElideDynamicEntityCompiler(String path, DBPasswordExtractor dbPasswordExt\n             classNames.add(PACKAGE_NAME + entry.getKey());\n         }\n \n-        compiler.useParentClassLoader(\n-                new ElideDynamicInMemoryClassLoader(ClassLoader.getSystemClassLoader(),\n-                        Sets.newHashSet(classNames)));\n+        // Prepare classpath\n+        StringBuilder sb = new StringBuilder();\n+        Enumeration<URL> resources = Thread.currentThread().getContextClassLoader().getResources(\"/\");\n+        while (resources.hasMoreElements()) {\n+            URL url = resources.nextElement();\n+            String fileName = url.getFile();\n+            sb.append(fileName.substring(0, fileName.lastIndexOf(\"!\"))).append(File.pathSeparator);\n+        }\n+\n+        String classpath = sb.toString();\n+\n+        if (classpath != null && !classpath.equals(\"\")) {\n+            log.debug(\"Classpath = \" + classpath);\n+            compiler.useOptions(\"-classpath\", sb.toString());\n+        }\n+\n+        compiler.useParentClassLoader(Thread.currentThread().getContextClassLoader());", "originalCommit": "bb107f89dd8798d1847045a3824663ccdcabc13c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "67792f9f3d663229572129068966ae03bccb0c8b", "url": "https://github.com/yahoo/elide/commit/67792f9f3d663229572129068966ae03bccb0c8b", "message": "Review Comments", "committedDate": "2020-11-18T21:28:12Z", "type": "commit"}]}