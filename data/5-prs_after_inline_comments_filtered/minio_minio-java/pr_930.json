{"pr_number": 930, "pr_title": "Add arg builder to versioning and removeBucket API", "pr_createdAt": "2020-05-13T09:07:58Z", "pr_url": "https://github.com/minio/minio-java/pull/930", "timeline": [{"oid": "ba16b2d5acab16d53aafc458d12490442e1b9e69", "url": "https://github.com/minio/minio-java/commit/ba16b2d5acab16d53aafc458d12490442e1b9e69", "message": "Version and Remove bucket using builder", "committedDate": "2020-05-13T09:09:26Z", "type": "forcePushed"}, {"oid": "e2dab769b090d6b94035ef49d7295c8f4863da34", "url": "https://github.com/minio/minio-java/commit/e2dab769b090d6b94035ef49d7295c8f4863da34", "message": "Version and Remove bucket using builder", "committedDate": "2020-05-14T05:13:10Z", "type": "forcePushed"}, {"oid": "264c36b3e28f439017567cb326d5d2cfeb9d6a43", "url": "https://github.com/minio/minio-java/commit/264c36b3e28f439017567cb326d5d2cfeb9d6a43", "message": "Version and Remove bucket using builder", "committedDate": "2020-05-14T05:33:39Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTAwNjgxMg==", "url": "https://github.com/minio/minio-java/pull/930#discussion_r425006812", "bodyText": "I would suggest to have each API has separate Args class.", "author": "balamurugana", "createdAt": "2020-05-14T09:42:17Z", "path": "api/src/main/java/io/minio/VersionBucketArgs.java", "diffHunk": "@@ -0,0 +1,37 @@\n+/*\n+ * MinIO Java SDK for Amazon S3 Compatible Cloud Storage, (C) 2020 MinIO, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.minio;\n+\n+/**\n+ * Argument class of @see #enableVersioning(VersionBucketArgs args) @see\n+ * #disableVersioning(VersionBucketArgs args).\n+ */\n+public class VersionBucketArgs extends BucketArgs {", "originalCommit": "264c36b3e28f439017567cb326d5d2cfeb9d6a43", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "193b35075a266b25300920ba206266807e0f06b8", "url": "https://github.com/minio/minio-java/commit/193b35075a266b25300920ba206266807e0f06b8", "message": "Added new class DisableVersionBucketArgs", "committedDate": "2020-05-14T12:09:37Z", "type": "forcePushed"}, {"oid": "c58ca21e580d92e64114dfe1b37c97c1da5fc426", "url": "https://github.com/minio/minio-java/commit/c58ca21e580d92e64114dfe1b37c97c1da5fc426", "message": "Added new class DisableVersionBucketArgs", "committedDate": "2020-05-14T13:14:27Z", "type": "forcePushed"}, {"oid": "7a85024ac986f8fb9b33772c952453e38453bd90", "url": "https://github.com/minio/minio-java/commit/7a85024ac986f8fb9b33772c952453e38453bd90", "message": "Added new class DisableVersionBucketArgs", "committedDate": "2020-05-14T13:24:48Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTE4NTEwMQ==", "url": "https://github.com/minio/minio-java/pull/930#discussion_r425185101", "bodyText": "We would need to have name consistency with API name. Here, DisableVersioningArgs and EnableVersioningArgs are appropriate.\nRemove any obvious comments for getters (if any).\nFollow consistent comments for Args and Builder class. #934 can be taken as reference.", "author": "balamurugana", "createdAt": "2020-05-14T14:33:39Z", "path": "api/src/main/java/io/minio/DisableVersionBucketArgs.java", "diffHunk": "@@ -0,0 +1,31 @@\n+/*\n+ * MinIO Java SDK for Amazon S3 Compatible Cloud Storage, (C) 2020 MinIO, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.minio;\n+\n+/** Argument class of @see #disableVersioning(DisableVersionBucketArgs args). */\n+public class DisableVersionBucketArgs extends BucketArgs {", "originalCommit": "7a85024ac986f8fb9b33772c952453e38453bd90", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "ff6bae47465380e508fcdf0c46b43d3b8e2e21be", "url": "https://github.com/minio/minio-java/commit/ff6bae47465380e508fcdf0c46b43d3b8e2e21be", "message": "add arg builder to versioning and removeBucket API", "committedDate": "2020-05-16T16:48:34Z", "type": "forcePushed"}, {"oid": "5c84b5e7b1e6029019daba2f55c7bb8d0c20bf3f", "url": "https://github.com/minio/minio-java/commit/5c84b5e7b1e6029019daba2f55c7bb8d0c20bf3f", "message": "add arg builder to versioning and removeBucket API", "committedDate": "2020-05-16T16:52:13Z", "type": "forcePushed"}, {"oid": "3e4fad21ddfcdf8f0173e1cc196c4988ab4b9614", "url": "https://github.com/minio/minio-java/commit/3e4fad21ddfcdf8f0173e1cc196c4988ab4b9614", "message": "add arg builder to versioning and removeBucket API", "committedDate": "2020-05-16T17:06:13Z", "type": "forcePushed"}, {"oid": "24c946a55596ad318490e705adfe164eccb95785", "url": "https://github.com/minio/minio-java/commit/24c946a55596ad318490e705adfe164eccb95785", "message": "add arg builder to versioning and removeBucket API", "committedDate": "2020-05-16T17:50:58Z", "type": "forcePushed"}, {"oid": "91cc69081d13c0075e46e22dbd71cfab90fea6e1", "url": "https://github.com/minio/minio-java/commit/91cc69081d13c0075e46e22dbd71cfab90fea6e1", "message": "add arg builder to versioning and removeBucket API", "committedDate": "2020-05-18T07:11:00Z", "type": "forcePushed"}, {"oid": "3d9770dbea17345a97e7dd5be625d16990fa0e07", "url": "https://github.com/minio/minio-java/commit/3d9770dbea17345a97e7dd5be625d16990fa0e07", "message": "add arg builder to versioning and removeBucket API", "committedDate": "2020-05-18T07:24:48Z", "type": "forcePushed"}, {"oid": "c3a91ab1ceb0f3775147fd31e546d8062157bdd8", "url": "https://github.com/minio/minio-java/commit/c3a91ab1ceb0f3775147fd31e546d8062157bdd8", "message": "add arg builder to versioning and removeBucket API", "committedDate": "2020-05-18T14:47:22Z", "type": "forcePushed"}, {"oid": "1581fa2e8fea90ddfd7fa5f8ccdf4e00f636f968", "url": "https://github.com/minio/minio-java/commit/1581fa2e8fea90ddfd7fa5f8ccdf4e00f636f968", "message": "add arg builder to versioning and removeBucket API", "committedDate": "2020-05-19T02:53:12Z", "type": "forcePushed"}, {"oid": "9a0c5e73276d8a28f961a38011df7230c51158d0", "url": "https://github.com/minio/minio-java/commit/9a0c5e73276d8a28f961a38011df7230c51158d0", "message": "add arg builder to versioning and removeBucket API", "committedDate": "2020-05-19T02:57:44Z", "type": "forcePushed"}, {"oid": "c896334b8a60e4617e93c0dee70a4f256d7af861", "url": "https://github.com/minio/minio-java/commit/c896334b8a60e4617e93c0dee70a4f256d7af861", "message": "Version and Remove bucket using builder", "committedDate": "2020-05-19T17:35:03Z", "type": "commit"}, {"oid": "2bf770a557a28d8be95342e8e7e3695e18a993dc", "url": "https://github.com/minio/minio-java/commit/2bf770a557a28d8be95342e8e7e3695e18a993dc", "message": "Added new class DisableVersionBucketArgs", "committedDate": "2020-05-19T17:35:03Z", "type": "commit"}, {"oid": "d8a704c09d10141acb9bba0608563f0b0e457647", "url": "https://github.com/minio/minio-java/commit/d8a704c09d10141acb9bba0608563f0b0e457647", "message": "add arg builder to versioning and removeBucket API", "committedDate": "2020-05-19T17:52:21Z", "type": "forcePushed"}, {"oid": "eb6e6df45e5de6835f2ee10fe6708d7c1b3dca02", "url": "https://github.com/minio/minio-java/commit/eb6e6df45e5de6835f2ee10fe6708d7c1b3dca02", "message": "Add arg builder to versioning and removeBucket API", "committedDate": "2020-05-19T18:10:37Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzc0MDU3Mg==", "url": "https://github.com/minio/minio-java/pull/930#discussion_r427740572", "bodyText": "Please fix to * @param args {@link EnableVersioningArgs} object.", "author": "balamurugana", "createdAt": "2020-05-20T04:54:40Z", "path": "api/src/main/java/io/minio/MinioClient.java", "diffHunk": "@@ -3468,16 +3468,44 @@ public void makeBucket(MakeBucketArgs args)\n    * @throws NoSuchAlgorithmException thrown to indicate missing of MD5 or SHA-256 digest library.\n    * @throws XmlParserException thrown to indicate XML parsing error.\n    */\n+  @Deprecated\n   public void enableVersioning(String bucketName)\n       throws ErrorResponseException, IllegalArgumentException, InsufficientDataException,\n           InternalException, InvalidBucketNameException, InvalidKeyException,\n           InvalidResponseException, IOException, NoSuchAlgorithmException, XmlParserException {\n+    this.enableVersioning(EnableVersioningArgs.builder().bucket(bucketName).build());\n+  }\n+\n+  /**\n+   * Enables object versioning feature in a bucket.\n+   *\n+   * <pre>Example:{@code\n+   * minioClient.enableVersioning(EnableVersioningArgs.builder().bucket(\"my-bucketname\").build());\n+   * }</pre>\n+   *\n+   * @param args {@link EnableVersioningArgs} bucket.", "originalCommit": "eb6e6df45e5de6835f2ee10fe6708d7c1b3dca02", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzc0MDgzMQ==", "url": "https://github.com/minio/minio-java/pull/930#discussion_r427740831", "bodyText": "throw IllegalArgumentException if args is null", "author": "balamurugana", "createdAt": "2020-05-20T04:55:41Z", "path": "api/src/main/java/io/minio/MinioClient.java", "diffHunk": "@@ -3468,16 +3468,44 @@ public void makeBucket(MakeBucketArgs args)\n    * @throws NoSuchAlgorithmException thrown to indicate missing of MD5 or SHA-256 digest library.\n    * @throws XmlParserException thrown to indicate XML parsing error.\n    */\n+  @Deprecated\n   public void enableVersioning(String bucketName)\n       throws ErrorResponseException, IllegalArgumentException, InsufficientDataException,\n           InternalException, InvalidBucketNameException, InvalidKeyException,\n           InvalidResponseException, IOException, NoSuchAlgorithmException, XmlParserException {\n+    this.enableVersioning(EnableVersioningArgs.builder().bucket(bucketName).build());\n+  }\n+\n+  /**\n+   * Enables object versioning feature in a bucket.\n+   *\n+   * <pre>Example:{@code\n+   * minioClient.enableVersioning(EnableVersioningArgs.builder().bucket(\"my-bucketname\").build());\n+   * }</pre>\n+   *\n+   * @param args {@link EnableVersioningArgs} bucket.\n+   * @throws ErrorResponseException thrown to indicate S3 service returned an error response.\n+   * @throws IllegalArgumentException throws to indicate invalid argument passed.\n+   * @throws InsufficientDataException thrown to indicate not enough data available in InputStream.\n+   * @throws InternalException thrown to indicate internal library error.\n+   * @throws InvalidBucketNameException thrown to indicate invalid bucket name passed.\n+   * @throws InvalidKeyException thrown to indicate missing of HMAC SHA-256 library.\n+   * @throws InvalidResponseException thrown to indicate S3 service returned invalid or no error\n+   *     response.\n+   * @throws IOException thrown to indicate I/O error on S3 operation.\n+   * @throws NoSuchAlgorithmException thrown to indicate missing of MD5 or SHA-256 digest library.\n+   * @throws XmlParserException thrown to indicate XML parsing error.\n+   */\n+  public void enableVersioning(EnableVersioningArgs args)\n+      throws ErrorResponseException, IllegalArgumentException, InsufficientDataException,\n+          InternalException, InvalidBucketNameException, InvalidKeyException,\n+          InvalidResponseException, IOException, NoSuchAlgorithmException, XmlParserException {", "originalCommit": "eb6e6df45e5de6835f2ee10fe6708d7c1b3dca02", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "2e3701341afb24b2b16135f7e0e114163265700e", "url": "https://github.com/minio/minio-java/commit/2e3701341afb24b2b16135f7e0e114163265700e", "message": "Add arg builder to versioning and removeBucket API", "committedDate": "2020-05-20T05:19:14Z", "type": "forcePushed"}, {"oid": "e1fb0bcb7313a666ab0cbbeee374f1683f803d16", "url": "https://github.com/minio/minio-java/commit/e1fb0bcb7313a666ab0cbbeee374f1683f803d16", "message": "Add arg builder to versioning and removeBucket API", "committedDate": "2020-05-20T05:32:09Z", "type": "commit"}, {"oid": "e1fb0bcb7313a666ab0cbbeee374f1683f803d16", "url": "https://github.com/minio/minio-java/commit/e1fb0bcb7313a666ab0cbbeee374f1683f803d16", "message": "Add arg builder to versioning and removeBucket API", "committedDate": "2020-05-20T05:32:09Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzg2NjczOA==", "url": "https://github.com/minio/minio-java/pull/930#discussion_r427866738", "bodyText": "Better to fix > 100 char long line.\nminioClient.disableVersioning(\n    DisableVersioningArgs.builder().bucket(\"my-bucketname\").build());", "author": "balamurugana", "createdAt": "2020-05-20T09:23:24Z", "path": "api/src/main/java/io/minio/MinioClient.java", "diffHunk": "@@ -3501,16 +3533,48 @@ public void enableVersioning(String bucketName)\n    * @throws NoSuchAlgorithmException thrown to indicate missing of MD5 or SHA-256 digest library.\n    * @throws XmlParserException thrown to indicate XML parsing error.\n    */\n+  @Deprecated\n   public void disableVersioning(String bucketName)\n       throws ErrorResponseException, IllegalArgumentException, InsufficientDataException,\n           InternalException, InvalidBucketNameException, InvalidKeyException,\n           InvalidResponseException, IOException, NoSuchAlgorithmException, XmlParserException {\n+    this.disableVersioning(DisableVersioningArgs.builder().bucket(bucketName).build());\n+  }\n+\n+  /**\n+   * Disables object versioning feature in a bucket.\n+   *\n+   * <pre>Example:{@code\n+   * minioClient.disableVersioning(DisableVersioningArgs.builder().bucket(\"my-bucketname\").build());", "originalCommit": "e1fb0bcb7313a666ab0cbbeee374f1683f803d16", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODA0NjUzNA==", "url": "https://github.com/minio/minio-java/pull/930#discussion_r428046534", "bodyText": "you could add one more check after this by\nclient.enableVersioning(EnableVersioningArgs.builder().bucket(name).build());\nclient.disableVersioning(DisableVersioningArgs.builder().bucket(name).build());", "author": "balamurugana", "createdAt": "2020-05-20T14:14:00Z", "path": "functional/FunctionalTest.java", "diffHunk": "@@ -384,6 +386,74 @@ public static void makeBucket_test4() throws Exception {\n     }\n   }\n \n+  /** Test: enableVersioning(EnableVersioningArgs args). */\n+  public static void enableVersioning_test() throws Exception {\n+    if (!mintEnv) {\n+      System.out.println(\"Test: enableVersioning(EnableVersioningArgs args)\");\n+    }\n+\n+    long startTime = System.currentTimeMillis();\n+    try {\n+      String name = getRandomName();\n+      client.makeBucket(MakeBucketArgs.builder().bucket(name).build());\n+      client.enableVersioning(EnableVersioningArgs.builder().bucket(name).build());\n+      client.removeBucket(RemoveBucketArgs.builder().bucket(name).build());\n+      mintSuccessLog(\"enableVersioning(EnableVersioningArgs args)\", null, startTime);\n+    } catch (Exception e) {\n+      ErrorResponse errorResponse = null;\n+      if (e instanceof ErrorResponseException) {\n+        ErrorResponseException exp = (ErrorResponseException) e;\n+        errorResponse = exp.errorResponse();\n+      }\n+      // Ignore NotImplemented error\n+      if (errorResponse != null && errorResponse.errorCode() == ErrorCode.NOT_IMPLEMENTED) {\n+        mintIgnoredLog(\"enableVersioning(EnableVersioningArgs args)\", null, startTime);\n+      } else {\n+        mintFailedLog(\n+            \"enableVersioning(EnableVersioningArgs args)\",\n+            null,\n+            startTime,\n+            null,\n+            e.toString() + \" >>> \" + Arrays.toString(e.getStackTrace()));\n+        throw e;\n+      }\n+    }\n+  }\n+\n+  /** Test: disableVersioning(DisableVersioningArgs args). */\n+  public static void disableVersioning_test() throws Exception {\n+    if (!mintEnv) {\n+      System.out.println(\"Test: disableVersioning(DisableVersioningArgs args)\");\n+    }\n+\n+    long startTime = System.currentTimeMillis();\n+    try {\n+      String name = getRandomName();\n+      client.makeBucket(MakeBucketArgs.builder().bucket(name).build());\n+      client.disableVersioning(DisableVersioningArgs.builder().bucket(name).build());", "originalCommit": "4b2ebc65d24a07219ec9e6474fa87f94e55e1a89", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "ff9823bb659c3c3f985fbbc1fd2f187e257fbf9f", "url": "https://github.com/minio/minio-java/commit/ff9823bb659c3c3f985fbbc1fd2f187e257fbf9f", "message": "Add functional test", "committedDate": "2020-05-20T14:20:47Z", "type": "forcePushed"}, {"oid": "95be36ddec2f5d1878c491506fd925728cf16001", "url": "https://github.com/minio/minio-java/commit/95be36ddec2f5d1878c491506fd925728cf16001", "message": "Add functional test", "committedDate": "2020-05-20T14:40:21Z", "type": "forcePushed"}, {"oid": "2e5be2e439d0caa92524477797ce66882f915518", "url": "https://github.com/minio/minio-java/commit/2e5be2e439d0caa92524477797ce66882f915518", "message": "Add functional test", "committedDate": "2020-05-20T14:46:00Z", "type": "commit"}, {"oid": "2e5be2e439d0caa92524477797ce66882f915518", "url": "https://github.com/minio/minio-java/commit/2e5be2e439d0caa92524477797ce66882f915518", "message": "Add functional test", "committedDate": "2020-05-20T14:46:00Z", "type": "forcePushed"}]}