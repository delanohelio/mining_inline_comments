{"pr_number": 955, "pr_title": "Add method isVersioningEnabled()", "pr_createdAt": "2020-05-27T15:23:02Z", "pr_url": "https://github.com/minio/minio-java/pull/955", "timeline": [{"oid": "17c4d63f8bdc9eef30c2d01bd2016048fcb795a5", "url": "https://github.com/minio/minio-java/commit/17c4d63f8bdc9eef30c2d01bd2016048fcb795a5", "message": "add builder to get bucket version config", "committedDate": "2020-05-27T17:50:28Z", "type": "forcePushed"}, {"oid": "a57bd9c6bfbf7a2c7841719c5c1b50d83daa02fc", "url": "https://github.com/minio/minio-java/commit/a57bd9c6bfbf7a2c7841719c5c1b50d83daa02fc", "message": "add builder to get bucket version config", "committedDate": "2020-05-28T14:06:53Z", "type": "forcePushed"}, {"oid": "479614ee603b7fe895a2638844d581fceccdbe8a", "url": "https://github.com/minio/minio-java/commit/479614ee603b7fe895a2638844d581fceccdbe8a", "message": "add builder to get bucket version config", "committedDate": "2020-05-28T15:02:00Z", "type": "forcePushed"}, {"oid": "e484e1a73d2f88877f2768f99fcdc15c58b9621e", "url": "https://github.com/minio/minio-java/commit/e484e1a73d2f88877f2768f99fcdc15c58b9621e", "message": "add builder to get bucket version config", "committedDate": "2020-05-28T15:44:49Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk2OTg1Mw==", "url": "https://github.com/minio/minio-java/pull/955#discussion_r431969853", "bodyText": "Its better to pass a boolean rather a string.", "author": "balamurugana", "createdAt": "2020-05-28T16:31:28Z", "path": "api/src/main/java/io/minio/MinioClient.java", "diffHunk": "@@ -3648,9 +3649,8 @@ public void enableVersioning(EnableVersioningArgs args)\n \n     Map<String, String> queryParamMap = new HashMap<>();\n     queryParamMap.put(\"versioning\", \"\");\n-    String config =\n-        \"<VersioningConfiguration xmlns=\\\"http://s3.amazonaws.com/doc/2006-03-01/\\\">\"\n-            + \"<Status>Enabled</Status></VersioningConfiguration>\";\n+    VersioningConfiguration config = new VersioningConfiguration(\"Enabled\");", "originalCommit": "e484e1a73d2f88877f2768f99fcdc15c58b9621e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI2NTQwNg==", "url": "https://github.com/minio/minio-java/pull/955#discussion_r432265406", "bodyText": "done", "author": "sinhaashish", "createdAt": "2020-05-29T05:38:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk2OTg1Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk3MTk5OQ==", "url": "https://github.com/minio/minio-java/pull/955#discussion_r431971999", "bodyText": "When do we get this error?", "author": "balamurugana", "createdAt": "2020-05-28T16:34:59Z", "path": "api/src/main/java/io/minio/MinioClient.java", "diffHunk": "@@ -3712,13 +3712,58 @@ public void disableVersioning(DisableVersioningArgs args)\n \n     Map<String, String> queryParamMap = new HashMap<>();\n     queryParamMap.put(\"versioning\", \"\");\n-    String config =\n-        \"<VersioningConfiguration xmlns=\\\"http://s3.amazonaws.com/doc/2006-03-01/\\\">\"\n-            + \"<Status>Suspended</Status></VersioningConfiguration>\";\n+    VersioningConfiguration config = new VersioningConfiguration(\"Suspended\");\n     Response response = executePut(args.bucket(), null, null, queryParamMap, config, 0);\n     response.body().close();\n   }\n \n+  /**\n+   * Returns true if versioning is enabled on the bucket.\n+   *\n+   * <pre>Example:{@code\n+   * boolean isVersioningEnabled =\n+   *  minioClient.isVersioningEnabled(\n+   *       IsVersioningEnabledArgs.builder().bucket(\"my-bucketname\").build());\n+   * if (isVersioningEnabled) {\n+   *   System.out.println(\"Bucket versioning is enabled\");\n+   * } else {\n+   *   System.out.println(\"Bucket versioning is disabled\");\n+   * }\n+   * }</pre>\n+   *\n+   * @param args {@link IsVersioningEnabledArgs} object.\n+   * @throws ErrorResponseException thrown to indicate S3 service returned an error response.\n+   * @throws IllegalArgumentException throws to indicate invalid argument passed.\n+   * @throws InsufficientDataException thrown to indicate not enough data available in InputStream.\n+   * @throws InternalException thrown to indicate internal library error.\n+   * @throws InvalidBucketNameException thrown to indicate invalid bucket name passed.\n+   * @throws InvalidKeyException thrown to indicate missing of HMAC SHA-256 library.\n+   * @throws InvalidResponseException thrown to indicate S3 service returned invalid or no error\n+   *     response.\n+   * @throws IOException thrown to indicate I/O error on S3 operation.\n+   * @throws NoSuchAlgorithmException thrown to indicate missing of MD5 or SHA-256 digest library.\n+   * @throws XmlParserException thrown to indicate XML parsing error.\n+   */\n+  public boolean isVersioningEnabled(IsVersioningEnabledArgs args)\n+      throws ErrorResponseException, IllegalArgumentException, InsufficientDataException,\n+          InternalException, InvalidBucketNameException, InvalidKeyException,\n+          InvalidResponseException, IOException, NoSuchAlgorithmException, XmlParserException {\n+    checkArgs(args);\n+\n+    Map<String, String> queryParamMap = new HashMap<>();\n+    queryParamMap.put(\"versioning\", \"\");\n+    try (Response response = executeGet(args.bucket(), null, null, queryParamMap)) {\n+      VersioningConfiguration result =\n+          Xml.unmarshal(VersioningConfiguration.class, response.body().charStream());\n+      return result.status();\n+    } catch (ErrorResponseException e) {\n+      if (e.errorResponse().errorCode() != ErrorCode.ILLEGAL_VERSIONING_CONFIGURATION_EXCEPTION) {", "originalCommit": "e484e1a73d2f88877f2768f99fcdc15c58b9621e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI2NTM2Nw==", "url": "https://github.com/minio/minio-java/pull/955#discussion_r432265367", "bodyText": "Removed", "author": "sinhaashish", "createdAt": "2020-05-29T05:38:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk3MTk5OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk3Mjc5Mw==", "url": "https://github.com/minio/minio-java/pull/955#discussion_r431972793", "bodyText": "I don't think the link going to work. Have you checked it?", "author": "balamurugana", "createdAt": "2020-05-28T16:36:19Z", "path": "api/src/main/java/io/minio/messages/VersioningConfiguration.java", "diffHunk": "@@ -0,0 +1,47 @@\n+/*\n+ * MinIO Java SDK for Amazon S3 Compatible Cloud Storage, (C) 2020 MinIO, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.minio.messages;\n+\n+import org.simpleframework.xml.Element;\n+import org.simpleframework.xml.Namespace;\n+import org.simpleframework.xml.Root;\n+\n+/**\n+ * Object representation of request XML of <a\n+ * href=\"https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketVersioning.html\">PutBucketVersioning", "originalCommit": "e484e1a73d2f88877f2768f99fcdc15c58b9621e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI2NTE5Ng==", "url": "https://github.com/minio/minio-java/pull/955#discussion_r432265196", "bodyText": "It works.", "author": "sinhaashish", "createdAt": "2020-05-29T05:37:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk3Mjc5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI3ODIyNg==", "url": "https://github.com/minio/minio-java/pull/955#discussion_r432278226", "bodyText": "The illusion I saw was, href string was broken into next line.", "author": "balamurugana", "createdAt": "2020-05-29T06:22:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk3Mjc5Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk3MzM0OQ==", "url": "https://github.com/minio/minio-java/pull/955#discussion_r431973349", "bodyText": "Accept boolean and construct status string accordingly", "author": "balamurugana", "createdAt": "2020-05-28T16:37:17Z", "path": "api/src/main/java/io/minio/messages/VersioningConfiguration.java", "diffHunk": "@@ -0,0 +1,47 @@\n+/*\n+ * MinIO Java SDK for Amazon S3 Compatible Cloud Storage, (C) 2020 MinIO, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.minio.messages;\n+\n+import org.simpleframework.xml.Element;\n+import org.simpleframework.xml.Namespace;\n+import org.simpleframework.xml.Root;\n+\n+/**\n+ * Object representation of request XML of <a\n+ * href=\"https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketVersioning.html\">PutBucketVersioning\n+ * API</a> and response XML of <a\n+ * href=\"https://docs.aws.amazon.com/AmazonS3/latest/API/API_GetBucketVersioning.html\">GetBucketVersioning\n+ * API</a>.\n+ */\n+@Root(name = \"VersioningConfiguration\", strict = false)\n+@Namespace(reference = \"http://s3.amazonaws.com/doc/2006-03-01/\")\n+public class VersioningConfiguration {\n+  @Element(name = \"Status\", required = false)\n+  private String status;\n+\n+  public VersioningConfiguration() {}\n+\n+  /** Constructs a new VersioningConfiguration object with given status. */\n+  public VersioningConfiguration(String status) {\n+    this.status = status;", "originalCommit": "e484e1a73d2f88877f2768f99fcdc15c58b9621e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk3Mzg0Mw==", "url": "https://github.com/minio/minio-java/pull/955#discussion_r431973843", "bodyText": "return \"Enabled\".equals(status) would work", "author": "balamurugana", "createdAt": "2020-05-28T16:38:08Z", "path": "api/src/main/java/io/minio/messages/VersioningConfiguration.java", "diffHunk": "@@ -0,0 +1,47 @@\n+/*\n+ * MinIO Java SDK for Amazon S3 Compatible Cloud Storage, (C) 2020 MinIO, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.minio.messages;\n+\n+import org.simpleframework.xml.Element;\n+import org.simpleframework.xml.Namespace;\n+import org.simpleframework.xml.Root;\n+\n+/**\n+ * Object representation of request XML of <a\n+ * href=\"https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketVersioning.html\">PutBucketVersioning\n+ * API</a> and response XML of <a\n+ * href=\"https://docs.aws.amazon.com/AmazonS3/latest/API/API_GetBucketVersioning.html\">GetBucketVersioning\n+ * API</a>.\n+ */\n+@Root(name = \"VersioningConfiguration\", strict = false)\n+@Namespace(reference = \"http://s3.amazonaws.com/doc/2006-03-01/\")\n+public class VersioningConfiguration {\n+  @Element(name = \"Status\", required = false)\n+  private String status;\n+\n+  public VersioningConfiguration() {}\n+\n+  /** Constructs a new VersioningConfiguration object with given status. */\n+  public VersioningConfiguration(String status) {\n+    this.status = status;\n+  }\n+\n+  /** Indicates whether the bucket is version enabled or not. */\n+  public boolean status() {\n+    return status != null && status.equals(\"Enabled\");", "originalCommit": "e484e1a73d2f88877f2768f99fcdc15c58b9621e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "29dc3557146a32ead172325a8f5b8886e4ba8e77", "url": "https://github.com/minio/minio-java/commit/29dc3557146a32ead172325a8f5b8886e4ba8e77", "message": "add builder to get bucket version config", "committedDate": "2020-05-29T05:15:25Z", "type": "forcePushed"}, {"oid": "4c0a86027d1f8be5fa0cada8c87f95cb79805088", "url": "https://github.com/minio/minio-java/commit/4c0a86027d1f8be5fa0cada8c87f95cb79805088", "message": "Add example for isVersionEnabled", "committedDate": "2020-05-29T09:51:18Z", "type": "forcePushed"}, {"oid": "daa185107ed69c93e08abf6700456f0f105c62f0", "url": "https://github.com/minio/minio-java/commit/daa185107ed69c93e08abf6700456f0f105c62f0", "message": "add builder to get bucket version config", "committedDate": "2020-05-29T12:18:12Z", "type": "commit"}, {"oid": "f1abdf6d8c5da477970e2b3786f671a154fd9637", "url": "https://github.com/minio/minio-java/commit/f1abdf6d8c5da477970e2b3786f671a154fd9637", "message": "Add example for versioning", "committedDate": "2020-05-29T12:18:12Z", "type": "commit"}, {"oid": "a8df66a9af4bce085e070e5908a787c7563d0fc2", "url": "https://github.com/minio/minio-java/commit/a8df66a9af4bce085e070e5908a787c7563d0fc2", "message": "Add example for isVersionEnabled", "committedDate": "2020-05-29T12:18:12Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjQ2NDg1Nw==", "url": "https://github.com/minio/minio-java/pull/955#discussion_r432464857", "bodyText": "This empty line can be removed", "author": "anjalshireesh", "createdAt": "2020-05-29T12:58:30Z", "path": "functional/FunctionalTest.java", "diffHunk": "@@ -4880,6 +4860,7 @@ public static void runQuickTests() throws Exception {\n   public static boolean downloadMinio() throws IOException {\n     String url = \"https://dl.min.io/server/minio/release/\";\n     if (OS.contains(\"linux\")) {\n+", "originalCommit": "a8df66a9af4bce085e070e5908a787c7563d0fc2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6639ef2c94d4b9867689c37bb9d5eff0ab0b14a3", "url": "https://github.com/minio/minio-java/commit/6639ef2c94d4b9867689c37bb9d5eff0ab0b14a3", "message": "Add example for isVersionEnabled", "committedDate": "2020-05-29T13:04:23Z", "type": "commit"}, {"oid": "6639ef2c94d4b9867689c37bb9d5eff0ab0b14a3", "url": "https://github.com/minio/minio-java/commit/6639ef2c94d4b9867689c37bb9d5eff0ab0b14a3", "message": "Add example for isVersionEnabled", "committedDate": "2020-05-29T13:04:23Z", "type": "forcePushed"}, {"oid": "69e4ac8e22caf5e2dcf25bcc477f306a8d7e17f0", "url": "https://github.com/minio/minio-java/commit/69e4ac8e22caf5e2dcf25bcc477f306a8d7e17f0", "message": "Remove extra line", "committedDate": "2020-05-29T13:54:40Z", "type": "commit"}, {"oid": "69e4ac8e22caf5e2dcf25bcc477f306a8d7e17f0", "url": "https://github.com/minio/minio-java/commit/69e4ac8e22caf5e2dcf25bcc477f306a8d7e17f0", "message": "Remove extra line", "committedDate": "2020-05-29T13:54:40Z", "type": "forcePushed"}, {"oid": "57b13109aceb98aba7b2661e47afa9818e55a97c", "url": "https://github.com/minio/minio-java/commit/57b13109aceb98aba7b2661e47afa9818e55a97c", "message": "Add deprecation comment", "committedDate": "2020-05-29T15:00:22Z", "type": "commit"}, {"oid": "57b13109aceb98aba7b2661e47afa9818e55a97c", "url": "https://github.com/minio/minio-java/commit/57b13109aceb98aba7b2661e47afa9818e55a97c", "message": "Add deprecation comment", "committedDate": "2020-05-29T15:00:22Z", "type": "forcePushed"}]}