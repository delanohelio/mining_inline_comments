{"pr_number": 936, "pr_title": "add arg builder to statObject API", "pr_createdAt": "2020-05-15T04:52:33Z", "pr_url": "https://github.com/minio/minio-java/pull/936", "timeline": [{"oid": "bdc48d81fca1a674e7cf2413d114bf2f7603ce30", "url": "https://github.com/minio/minio-java/commit/bdc48d81fca1a674e7cf2413d114bf2f7603ce30", "message": "add arg builder to statObject API", "committedDate": "2020-05-15T18:02:06Z", "type": "forcePushed"}, {"oid": "3a0c9ec258bd741ef5771db6af1cdfc266026dad", "url": "https://github.com/minio/minio-java/commit/3a0c9ec258bd741ef5771db6af1cdfc266026dad", "message": "add arg builder to statObject API", "committedDate": "2020-05-15T18:31:35Z", "type": "forcePushed"}, {"oid": "c7b107ee8752294b0c226155cf2b4870502a9544", "url": "https://github.com/minio/minio-java/commit/c7b107ee8752294b0c226155cf2b4870502a9544", "message": "Fix build() not available in some args classes", "committedDate": "2020-05-16T12:35:54Z", "type": "forcePushed"}, {"oid": "dc4a4068b3b415ba41f22166d27d35125a3347c0", "url": "https://github.com/minio/minio-java/commit/dc4a4068b3b415ba41f22166d27d35125a3347c0", "message": "fix makebucket functional test", "committedDate": "2020-05-16T12:50:40Z", "type": "forcePushed"}, {"oid": "0c42a6a536e38bfee6f92bf1d088dd02865ac29e", "url": "https://github.com/minio/minio-java/commit/0c42a6a536e38bfee6f92bf1d088dd02865ac29e", "message": "Fix build() not available in some args classes", "committedDate": "2020-05-16T12:54:14Z", "type": "forcePushed"}, {"oid": "87ce9f8897e312ae626b7acebb9745e8e76d9ec4", "url": "https://github.com/minio/minio-java/commit/87ce9f8897e312ae626b7acebb9745e8e76d9ec4", "message": "add arg builder to statObject API", "committedDate": "2020-05-18T12:48:55Z", "type": "forcePushed"}, {"oid": "5faa549c7be0c186877521dd0a530f12121d11d7", "url": "https://github.com/minio/minio-java/commit/5faa549c7be0c186877521dd0a530f12121d11d7", "message": "add arg builder to statObject API", "committedDate": "2020-05-18T14:29:04Z", "type": "forcePushed"}, {"oid": "fcb98c2a9344902aa0f51465d462a4a37d4f7bb6", "url": "https://github.com/minio/minio-java/commit/fcb98c2a9344902aa0f51465d462a4a37d4f7bb6", "message": "add arg builder to statObject API", "committedDate": "2020-05-18T20:02:31Z", "type": "forcePushed"}, {"oid": "84dd8fdd70f98e0b3b8423c7197ec5425994e983", "url": "https://github.com/minio/minio-java/commit/84dd8fdd70f98e0b3b8423c7197ec5425994e983", "message": "add arg builder to statObject API", "committedDate": "2020-05-19T08:28:34Z", "type": "forcePushed"}, {"oid": "e2c1a3504d04e39ef2969b5376649d7bad5dbb5e", "url": "https://github.com/minio/minio-java/commit/e2c1a3504d04e39ef2969b5376649d7bad5dbb5e", "message": "add arg builder to statObject API", "committedDate": "2020-05-19T09:57:33Z", "type": "forcePushed"}, {"oid": "557a037da91cd5d2dda1b0cef5422b6f632c0789", "url": "https://github.com/minio/minio-java/commit/557a037da91cd5d2dda1b0cef5422b6f632c0789", "message": "add arg builder to statObject API", "committedDate": "2020-05-19T13:01:45Z", "type": "commit"}, {"oid": "557a037da91cd5d2dda1b0cef5422b6f632c0789", "url": "https://github.com/minio/minio-java/commit/557a037da91cd5d2dda1b0cef5422b6f632c0789", "message": "add arg builder to statObject API", "committedDate": "2020-05-19T13:01:45Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzQ1NTYyNQ==", "url": "https://github.com/minio/minio-java/pull/936#discussion_r427455625", "bodyText": "Instead of preparing and passing the extra headers and query-params from this specific method, can we look at making this a generic feature that works for all the APIs? So if these arguments are present, the corresponding headers and query parameters should automatically get added in the requests without having to write extra code in the corresponding method.", "author": "anjalshireesh", "createdAt": "2020-05-19T16:57:28Z", "path": "api/src/main/java/io/minio/MinioClient.java", "diffHunk": "@@ -1552,24 +1546,92 @@ public ObjectStat statObject(String bucketName, String objectName)\n    * @throws XmlParserException thrown to indicate XML parsing error.\n    * @see ObjectStat\n    */\n+  @Deprecated\n   public ObjectStat statObject(String bucketName, String objectName, ServerSideEncryption sse)\n       throws ErrorResponseException, IllegalArgumentException, InsufficientDataException,\n           InternalException, InvalidBucketNameException, InvalidKeyException,\n           InvalidResponseException, IOException, NoSuchAlgorithmException, XmlParserException {\n-    checkReadRequestSse(sse);\n-    checkBucketName(bucketName);\n-    checkObjectName(objectName);\n+    return statObject(\n+        StatObjectArgs.builder().bucket(bucketName).object(objectName).ssec(sse).build());\n+  }\n \n-    Map<String, String> headers = null;\n-    if (sse != null) {\n-      headers = sse.headers();\n+  /**\n+   * Gets information of an object.\n+   *\n+   * <pre>Example:{@code\n+   * // Get information of an object.\n+   * ObjectStat objectStat =\n+   *     minioClient.statObject(\n+   *         StatObjectArgs.builder().bucket(\"my-bucketname\").object(\"my-objectname\").build());\n+   *\n+   * // Get information of SSE-C encrypted object.\n+   * ObjectStat objectStat =\n+   *     minioClient.statObject(\n+   *         StatObjectArgs.builder()\n+   *             .bucket(\"my-bucketname\")\n+   *             .object(\"my-objectname\")\n+   *             .ssec(ssec)\n+   *             .build());\n+   *\n+   * // Get information of a versioned object.\n+   * ObjectStat objectStat =\n+   *     minioClient.statObject(\n+   *         StatObjectArgs.builder()\n+   *             .bucket(\"my-bucketname\")\n+   *             .object(\"my-objectname\")\n+   *             .versionId(\"version-id\")\n+   *             .build());\n+   *\n+   * // Get information of a SSE-C encrypted versioned object.\n+   * ObjectStat objectStat =\n+   *     minioClient.statObject(\n+   *         StatObjectArgs.builder()\n+   *             .bucket(\"my-bucketname\")\n+   *             .object(\"my-objectname\")\n+   *             .versionId(\"version-id\")\n+   *             .ssec(ssec)\n+   *             .build());\n+   * }</pre>\n+   *\n+   * @param args {@link StatObjectArgs} object.\n+   * @return {@link ObjectStat} - Populated object information and metadata.\n+   * @throws ErrorResponseException thrown to indicate S3 service returned an error response.\n+   * @throws IllegalArgumentException throws to indicate invalid argument passed.\n+   * @throws InsufficientDataException thrown to indicate not enough data available in InputStream.\n+   * @throws InternalException thrown to indicate internal library error.\n+   * @throws InvalidBucketNameException thrown to indicate invalid bucket name passed.\n+   * @throws InvalidKeyException thrown to indicate missing of HMAC SHA-256 library.\n+   * @throws InvalidResponseException thrown to indicate S3 service returned invalid or no error\n+   *     response.\n+   * @throws IOException thrown to indicate I/O error on S3 operation.\n+   * @throws NoSuchAlgorithmException thrown to indicate missing of MD5 or SHA-256 digest library.\n+   * @throws XmlParserException thrown to indicate XML parsing error.\n+   * @see ObjectStat\n+   */\n+  public ObjectStat statObject(StatObjectArgs args)\n+      throws ErrorResponseException, IllegalArgumentException, InsufficientDataException,\n+          InternalException, InvalidBucketNameException, InvalidKeyException,\n+          InvalidResponseException, IOException, NoSuchAlgorithmException, XmlParserException {\n+    if (args == null) {\n+      throw new IllegalArgumentException(\"null arguments\");\n     }\n \n-    Response response = executeHead(bucketName, objectName, headers);\n-    try {\n-      return new ObjectStat(bucketName, objectName, response.headers());\n-    } finally {\n-      response.close();\n+    checkReadRequestSse(args.ssec());\n+\n+    Multimap<String, String> headers = HashMultimap.create();\n+    headers.putAll(args.extraHeaders());\n+    if (args.ssec() != null) {\n+      headers.putAll(Multimaps.forMap(args.ssec().headers()));\n+    }\n+\n+    Multimap<String, String> queryParams = HashMultimap.create();\n+    queryParams.putAll(args.extraQueryParams());\n+    if (args.versionId() != null) {\n+      queryParams.put(\"versionId\", args.versionId());\n+    }", "originalCommit": "557a037da91cd5d2dda1b0cef5422b6f632c0789", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzQ2NTM2NQ==", "url": "https://github.com/minio/minio-java/pull/936#discussion_r427465365", "bodyText": "The first part inside try block can be extracted out into a method, say putTestObject()", "author": "anjalshireesh", "createdAt": "2020-05-19T17:13:30Z", "path": "functional/FunctionalTest.java", "diffHunk": "@@ -1103,14 +1097,79 @@ public static void statObject_test3() throws Exception {\n       }\n     } catch (Exception e) {\n       mintFailedLog(\n-          \"statObject(String bucketName, \\\"randomName/\\\")\",\n+          \"statObject(StatObjectArgs args) with non-existing object\",\n           null,\n           startTime,\n           null,\n           e.toString() + \" >>> \" + Arrays.toString(e.getStackTrace()));\n       throw e;\n     } finally {\n-      mintSuccessLog(\"statObject(String bucketName, \\\"randomName/\\\"`)\", null, startTime);\n+      mintSuccessLog(\"statObject(StatObjectArgs args) with non-existing object\", null, startTime);\n+    }\n+  }\n+\n+  /** Test: with extra headers/query params: statObject(StatObjectArgs args). */\n+  public static void statObject_test4() throws Exception {\n+    if (!mintEnv) {\n+      System.out.println(\"Test: with extra headers/query params: statObject(StatObjectArgs args)\");\n+    }\n+\n+    long startTime = System.currentTimeMillis();\n+    try {\n+      String objectName = getRandomName();\n+      Map<String, String> headerMap = new HashMap<>();\n+      headerMap.put(\"Content-Type\", customContentType);\n+      headerMap.put(\"my-custom-data\", \"foo\");\n+      try (final InputStream is = new ContentInputStream(1)) {\n+        PutObjectOptions options = new PutObjectOptions(1, -1);\n+        options.setHeaders(headerMap);\n+        options.setContentType(customContentType);\n+        client.putObject(bucketName, objectName, is, options);\n+      }", "originalCommit": "557a037da91cd5d2dda1b0cef5422b6f632c0789", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzQ2ODU2MA==", "url": "https://github.com/minio/minio-java/pull/936#discussion_r427468560", "bodyText": "I see the same condition for statObject_test2() as well. Maybe there can be a single if block for all the tests that depend on this condition?", "author": "anjalshireesh", "createdAt": "2020-05-19T17:18:41Z", "path": "functional/FunctionalTest.java", "diffHunk": "@@ -4112,10 +4187,7 @@ public static void runTests() throws Exception {\n     selectObjectContent_test1();\n \n     // SSE_C tests will only work over TLS connection\n-    Locale locale = Locale.ENGLISH;\n-    boolean tlsEnabled = endpoint.toLowerCase(locale).contains(\"https://\");\n-    if (tlsEnabled) {\n-      statObject_test2();\n+    if (endpoint.toLowerCase(Locale.US).contains(\"https://\")) {", "originalCommit": "557a037da91cd5d2dda1b0cef5422b6f632c0789", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}