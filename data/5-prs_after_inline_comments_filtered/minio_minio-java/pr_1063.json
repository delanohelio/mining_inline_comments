{"pr_number": 1063, "pr_title": "fix x-amz-object-lock-retain-until-date header time format in ObjectWriteArgs", "pr_createdAt": "2020-09-24T10:38:52Z", "pr_url": "https://github.com/minio/minio-java/pull/1063", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDIyOTkwMA==", "url": "https://github.com/minio/minio-java/pull/1063#discussion_r494229900", "bodyText": "You would need to add this to putObject() test", "author": "balamurugana", "createdAt": "2020-09-24T11:13:32Z", "path": "functional/FunctionalTest.java", "diffHunk": "@@ -2514,6 +2514,24 @@ public static void setObjectRetention() throws Exception {\n                 .config(new Retention())\n                 .bypassGovernanceMode(true)\n                 .build());\n+\n+        objectInfo =\n+            client.putObject(", "originalCommit": "889c2bbc8ad4268b6526b4f718ece07d09dd7538", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "db7e5a23516d8722f4f730d96e199e2f1f7baed6", "url": "https://github.com/minio/minio-java/commit/db7e5a23516d8722f4f730d96e199e2f1f7baed6", "message": "Date Format in Reetention", "committedDate": "2020-09-24T11:35:33Z", "type": "forcePushed"}, {"oid": "3b314d018dbbedffc5b74b1981b385ee200f291c", "url": "https://github.com/minio/minio-java/commit/3b314d018dbbedffc5b74b1981b385ee200f291c", "message": "Date Format in Retention", "committedDate": "2020-09-24T12:18:18Z", "type": "forcePushed"}, {"oid": "d08428d925540790964ccd617a745a73fd4a9e16", "url": "https://github.com/minio/minio-java/commit/d08428d925540790964ccd617a745a73fd4a9e16", "message": "Date Format in Retention", "committedDate": "2020-09-24T12:57:34Z", "type": "forcePushed"}, {"oid": "e27d98c95368d2f1ec9e53954390ae217e19ffbe", "url": "https://github.com/minio/minio-java/commit/e27d98c95368d2f1ec9e53954390ae217e19ffbe", "message": "Date Format in Retention", "committedDate": "2020-09-24T13:13:30Z", "type": "forcePushed"}, {"oid": "70072fed417181865db93765595e3f5c1e6b8602", "url": "https://github.com/minio/minio-java/commit/70072fed417181865db93765595e3f5c1e6b8602", "message": "Date Format in Retention", "committedDate": "2020-09-24T13:19:12Z", "type": "forcePushed"}, {"oid": "5c0284132cb19aa2c91e1a97cc4496d9cbae18e9", "url": "https://github.com/minio/minio-java/commit/5c0284132cb19aa2c91e1a97cc4496d9cbae18e9", "message": "Date Format in Retention", "committedDate": "2020-09-24T13:25:15Z", "type": "forcePushed"}, {"oid": "0efe4191248073310a3c2d72bfdb07d1ef4cbead", "url": "https://github.com/minio/minio-java/commit/0efe4191248073310a3c2d72bfdb07d1ef4cbead", "message": "Date Format in Retention", "committedDate": "2020-09-24T13:34:39Z", "type": "forcePushed"}, {"oid": "c4c2fd0a7f474a5c9b9bc13b8c729c88accc778a", "url": "https://github.com/minio/minio-java/commit/c4c2fd0a7f474a5c9b9bc13b8c729c88accc778a", "message": "Date Format in Retention", "committedDate": "2020-09-24T13:38:30Z", "type": "commit"}, {"oid": "c4c2fd0a7f474a5c9b9bc13b8c729c88accc778a", "url": "https://github.com/minio/minio-java/commit/c4c2fd0a7f474a5c9b9bc13b8c729c88accc778a", "message": "Date Format in Retention", "committedDate": "2020-09-24T13:38:30Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDM5NTU5MQ==", "url": "https://github.com/minio/minio-java/pull/1063#discussion_r494395591", "bodyText": "Move ObjectWriteResponse objectInfo = null; here.", "author": "balamurugana", "createdAt": "2020-09-24T15:07:06Z", "path": "functional/FunctionalTest.java", "diffHunk": "@@ -749,16 +749,31 @@ public static void testPutObject(String testTags, PutObjectArgs args, String err\n       throws Exception {\n     String methodName = \"putObject()\";\n     long startTime = System.currentTimeMillis();\n+    ObjectWriteResponse objectInfo = null;\n     try {\n       try {", "originalCommit": "c4c2fd0a7f474a5c9b9bc13b8c729c88accc778a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDM5NjAxMw==", "url": "https://github.com/minio/minio-java/pull/1063#discussion_r494396013", "bodyText": "Use if (args.retention() != null)", "author": "balamurugana", "createdAt": "2020-09-24T15:07:41Z", "path": "functional/FunctionalTest.java", "diffHunk": "@@ -749,16 +749,31 @@ public static void testPutObject(String testTags, PutObjectArgs args, String err\n       throws Exception {\n     String methodName = \"putObject()\";\n     long startTime = System.currentTimeMillis();\n+    ObjectWriteResponse objectInfo = null;\n     try {\n       try {\n-        client.putObject(args);\n+        objectInfo = client.putObject(args);\n       } catch (ErrorResponseException e) {\n         if (errorCode == null || !e.errorResponse().code().equals(errorCode)) {\n           throw e;\n         }\n       }\n+      if (testTags.equals(\"[With Retention]\")) {", "originalCommit": "c4c2fd0a7f474a5c9b9bc13b8c729c88accc778a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDM5NjU1Nw==", "url": "https://github.com/minio/minio-java/pull/1063#discussion_r494396557", "bodyText": "Just use .versionId(objectInfo.versionId())", "author": "balamurugana", "createdAt": "2020-09-24T15:08:24Z", "path": "functional/FunctionalTest.java", "diffHunk": "@@ -749,16 +749,31 @@ public static void testPutObject(String testTags, PutObjectArgs args, String err\n       throws Exception {\n     String methodName = \"putObject()\";\n     long startTime = System.currentTimeMillis();\n+    ObjectWriteResponse objectInfo = null;\n     try {\n       try {\n-        client.putObject(args);\n+        objectInfo = client.putObject(args);\n       } catch (ErrorResponseException e) {\n         if (errorCode == null || !e.errorResponse().code().equals(errorCode)) {\n           throw e;\n         }\n       }\n+      if (testTags.equals(\"[With Retention]\")) {\n+        client.setObjectRetention(\n+            SetObjectRetentionArgs.builder()\n+                .bucket(args.bucket())\n+                .object(args.object())\n+                .config(new Retention())\n+                .bypassGovernanceMode(true)\n+                .build());\n+      }\n       client.removeObject(\n-          RemoveObjectArgs.builder().bucket(args.bucket()).object(args.object()).build());\n+          RemoveObjectArgs.builder()\n+              .bucket(args.bucket())\n+              .object(args.object())\n+              .versionId(objectInfo != null ? objectInfo.versionId() : null)", "originalCommit": "c4c2fd0a7f474a5c9b9bc13b8c729c88accc778a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDQwNzU1OQ==", "url": "https://github.com/minio/minio-java/pull/1063#discussion_r494407559", "bodyText": "It wont work as below test doesn't populate objectInfo\n testPutObject(\n        \"[storage-class=INVALID negative case]\",\n        PutObjectArgs.builder().bucket(bucketName).object(getRandomName()).stream(\n                new ContentInputStream(1 * KB), 1 * KB, -1)\n            .headers(headers)\n            .build(),\n        \"InvalidStorageClass\");", "author": "sinhaashish", "createdAt": "2020-09-24T15:23:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDM5NjU1Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDM5NzEwNA==", "url": "https://github.com/minio/minio-java/pull/1063#discussion_r494397104", "bodyText": "No need to declare a variable; instead use getRandomName() directly.", "author": "balamurugana", "createdAt": "2020-09-24T15:09:13Z", "path": "functional/FunctionalTest.java", "diffHunk": "@@ -909,6 +924,16 @@ public static void putObject() throws Exception {\n             .build(),\n         null);\n \n+    String retainedObjectName = getRandomName();", "originalCommit": "c4c2fd0a7f474a5c9b9bc13b8c729c88accc778a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDM5NzY0Mw==", "url": "https://github.com/minio/minio-java/pull/1063#discussion_r494397643", "bodyText": "Keep tag lower cased.", "author": "balamurugana", "createdAt": "2020-09-24T15:09:55Z", "path": "functional/FunctionalTest.java", "diffHunk": "@@ -909,6 +924,16 @@ public static void putObject() throws Exception {\n             .build(),\n         null);\n \n+    String retainedObjectName = getRandomName();\n+    testPutObject(\n+        \"[With Retention]\",", "originalCommit": "c4c2fd0a7f474a5c9b9bc13b8c729c88accc778a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "b9c902cc53b212cd6ff7d3794d47fcf8c27dbbb3", "url": "https://github.com/minio/minio-java/commit/b9c902cc53b212cd6ff7d3794d47fcf8c27dbbb3", "message": "Address review comment", "committedDate": "2020-09-24T15:35:50Z", "type": "commit"}, {"oid": "b9c902cc53b212cd6ff7d3794d47fcf8c27dbbb3", "url": "https://github.com/minio/minio-java/commit/b9c902cc53b212cd6ff7d3794d47fcf8c27dbbb3", "message": "Address review comment", "committedDate": "2020-09-24T15:35:50Z", "type": "forcePushed"}]}