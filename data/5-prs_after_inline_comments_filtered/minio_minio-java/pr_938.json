{"pr_number": 938, "pr_title": " add arg builder to set/get objectRetention API ", "pr_createdAt": "2020-05-15T15:44:53Z", "pr_url": "https://github.com/minio/minio-java/pull/938", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjEyNDM4NA==", "url": "https://github.com/minio/minio-java/pull/938#discussion_r426124384", "bodyText": "As per the conversion, it seems this method is not required. If required, my recommendation is to have method name as overrideGovernance()", "author": "balamurugana", "createdAt": "2020-05-16T06:26:35Z", "path": "api/src/main/java/io/minio/MinioClient.java", "diffHunk": "@@ -3589,23 +3590,62 @@ public void setObjectRetention(\n       throws ErrorResponseException, IllegalArgumentException, InsufficientDataException,\n           InternalException, InvalidBucketNameException, InvalidKeyException,\n           InvalidResponseException, IOException, NoSuchAlgorithmException, XmlParserException {\n-    if (config == null) {\n+\n+    this.setObjectRetention(\n+        SetObjectRetentionArgs.builder()\n+            .bucket(bucketName)\n+            .object(objectName)\n+            .versionId(versionId)\n+            .config(config)\n+            .bypassGovernanceRetention(bypassGovernanceRetention)", "originalCommit": "d121a7a32076bcf709b425c391c126bb43e1664a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzM3NDYwMQ==", "url": "https://github.com/minio/minio-java/pull/938#discussion_r427374601", "bodyText": "@balamurugana I looked at the older API spec https://docs.aws.amazon.com/AmazonS3/latest/API/archive-RESTObjectPUTRetention.html\nThis header is needed.", "author": "kannappanr", "createdAt": "2020-05-19T15:02:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjEyNDM4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzQzMTE0Mw==", "url": "https://github.com/minio/minio-java/pull/938#discussion_r427431143", "bodyText": "No problem. I thought it was policy decision when you were talking about removing the flag.", "author": "balamurugana", "createdAt": "2020-05-19T16:20:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjEyNDM4NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjEyNDQ1NA==", "url": "https://github.com/minio/minio-java/pull/938#discussion_r426124454", "bodyText": "Its required to expand examples than prototyping.", "author": "balamurugana", "createdAt": "2020-05-16T06:27:44Z", "path": "api/src/main/java/io/minio/MinioClient.java", "diffHunk": "@@ -3589,23 +3590,62 @@ public void setObjectRetention(\n       throws ErrorResponseException, IllegalArgumentException, InsufficientDataException,\n           InternalException, InvalidBucketNameException, InvalidKeyException,\n           InvalidResponseException, IOException, NoSuchAlgorithmException, XmlParserException {\n-    if (config == null) {\n+\n+    this.setObjectRetention(\n+        SetObjectRetentionArgs.builder()\n+            .bucket(bucketName)\n+            .object(objectName)\n+            .versionId(versionId)\n+            .config(config)\n+            .bypassGovernanceRetention(bypassGovernanceRetention)\n+            .build());\n+  }\n+\n+  /**\n+   * Sets retention configuration to an object.\n+   *\n+   * <pre>Example:{@code\n+   * Retention retention =\n+   *     new Retention(RetentionMode.COMPLIANCE, ZonedDateTime.now().plusYears(1));\n+   * minioClient.setObjectRetention(SetObjectRetentionArgs args);", "originalCommit": "d121a7a32076bcf709b425c391c126bb43e1664a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjEyNDU2OA==", "url": "https://github.com/minio/minio-java/pull/938#discussion_r426124568", "bodyText": "Its not required to check individual args (it defeats the purpose of arg builder). You would need to throw IllegalArgumentException if (args == null)", "author": "balamurugana", "createdAt": "2020-05-16T06:29:39Z", "path": "api/src/main/java/io/minio/MinioClient.java", "diffHunk": "@@ -3589,23 +3590,62 @@ public void setObjectRetention(\n       throws ErrorResponseException, IllegalArgumentException, InsufficientDataException,\n           InternalException, InvalidBucketNameException, InvalidKeyException,\n           InvalidResponseException, IOException, NoSuchAlgorithmException, XmlParserException {\n-    if (config == null) {\n+\n+    this.setObjectRetention(\n+        SetObjectRetentionArgs.builder()\n+            .bucket(bucketName)\n+            .object(objectName)\n+            .versionId(versionId)\n+            .config(config)\n+            .bypassGovernanceRetention(bypassGovernanceRetention)\n+            .build());\n+  }\n+\n+  /**\n+   * Sets retention configuration to an object.\n+   *\n+   * <pre>Example:{@code\n+   * Retention retention =\n+   *     new Retention(RetentionMode.COMPLIANCE, ZonedDateTime.now().plusYears(1));\n+   * minioClient.setObjectRetention(SetObjectRetentionArgs args);\n+   * }</pre>\n+   *\n+   * @param args {@link SetObjectRetentionArgs} object.\n+   * @throws ErrorResponseException thrown to indicate S3 service returned an error response.\n+   * @throws IllegalArgumentException throws to indicate invalid argument passed.\n+   * @throws InsufficientDataException thrown to indicate not enough data available in InputStream.\n+   * @throws InternalException thrown to indicate internal library error.\n+   * @throws InvalidBucketNameException thrown to indicate invalid bucket name passed.\n+   * @throws InvalidKeyException thrown to indicate missing of HMAC SHA-256 library.\n+   * @throws InvalidResponseException thrown to indicate S3 service returned invalid or no error\n+   *     response.\n+   * @throws IOException thrown to indicate I/O error on S3 operation.\n+   * @throws NoSuchAlgorithmException thrown to indicate missing of MD5 or SHA-256 digest library.\n+   * @throws XmlParserException thrown to indicate XML parsing error.\n+   */\n+  public void setObjectRetention(SetObjectRetentionArgs args)\n+      throws ErrorResponseException, IllegalArgumentException, InsufficientDataException,\n+          InternalException, InvalidBucketNameException, InvalidKeyException,\n+          InvalidResponseException, IOException, NoSuchAlgorithmException, XmlParserException {\n+    if (args.config() == null) {", "originalCommit": "d121a7a32076bcf709b425c391c126bb43e1664a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjEyNDY4MA==", "url": "https://github.com/minio/minio-java/pull/938#discussion_r426124680", "bodyText": "deprecate this method.", "author": "balamurugana", "createdAt": "2020-05-16T06:31:00Z", "path": "api/src/main/java/io/minio/MinioClient.java", "diffHunk": "@@ -3639,14 +3679,51 @@ public Retention getObjectRetention(String bucketName, String objectName, String\n       throws ErrorResponseException, IllegalArgumentException, InsufficientDataException,", "originalCommit": "d121a7a32076bcf709b425c391c126bb43e1664a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjEyNDcwMA==", "url": "https://github.com/minio/minio-java/pull/938#discussion_r426124700", "bodyText": "Expand the example and no prototyping.", "author": "balamurugana", "createdAt": "2020-05-16T06:31:33Z", "path": "api/src/main/java/io/minio/MinioClient.java", "diffHunk": "@@ -3639,14 +3679,51 @@ public Retention getObjectRetention(String bucketName, String objectName, String\n       throws ErrorResponseException, IllegalArgumentException, InsufficientDataException,\n           InternalException, InvalidBucketNameException, InvalidKeyException,\n           InvalidResponseException, IOException, NoSuchAlgorithmException, XmlParserException {\n+    return this.getObjectRetention(\n+        GetObjectRetentionArgs.builder()\n+            .bucket(bucketName)\n+            .object(objectName)\n+            .versionId(versionId)\n+            .build());\n+  }\n+\n+  /**\n+   * Gets retention configuration of an object.\n+   *\n+   * <pre>Example:{@code\n+   * Retention retention =\n+   *     minioClient.getObjectRetention(GetObjectRetentionArgs args);", "originalCommit": "d121a7a32076bcf709b425c391c126bb43e1664a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjEyNDg0Mg==", "url": "https://github.com/minio/minio-java/pull/938#discussion_r426124842", "bodyText": "I would recommend versionId = \"\" can be allowed i.e. if (args.versionId() != null)", "author": "balamurugana", "createdAt": "2020-05-16T06:33:52Z", "path": "api/src/main/java/io/minio/MinioClient.java", "diffHunk": "@@ -3639,14 +3679,51 @@ public Retention getObjectRetention(String bucketName, String objectName, String\n       throws ErrorResponseException, IllegalArgumentException, InsufficientDataException,\n           InternalException, InvalidBucketNameException, InvalidKeyException,\n           InvalidResponseException, IOException, NoSuchAlgorithmException, XmlParserException {\n+    return this.getObjectRetention(\n+        GetObjectRetentionArgs.builder()\n+            .bucket(bucketName)\n+            .object(objectName)\n+            .versionId(versionId)\n+            .build());\n+  }\n+\n+  /**\n+   * Gets retention configuration of an object.\n+   *\n+   * <pre>Example:{@code\n+   * Retention retention =\n+   *     minioClient.getObjectRetention(GetObjectRetentionArgs args);\n+   * System.out.println(\n+   *     \"mode: \" + retention.mode() + \"until: \" + retention.retainUntilDate());\n+   * }</pre>\n+   *\n+   * @param args {@link GetObjectRetentionArgs} object.\n+   * @return {@link Retention} - Object retention configuration.\n+   * @throws ErrorResponseException thrown to indicate S3 service returned an error response.\n+   * @throws IllegalArgumentException throws to indicate invalid argument passed.\n+   * @throws InsufficientDataException thrown to indicate not enough data available in InputStream.\n+   * @throws InternalException thrown to indicate internal library error.\n+   * @throws InvalidBucketNameException thrown to indicate invalid bucket name passed.\n+   * @throws InvalidKeyException thrown to indicate missing of HMAC SHA-256 library.\n+   * @throws InvalidResponseException thrown to indicate S3 service returned invalid or no error\n+   *     response.\n+   * @throws IOException thrown to indicate I/O error on S3 operation.\n+   * @throws NoSuchAlgorithmException thrown to indicate missing of MD5 or SHA-256 digest library.\n+   * @throws XmlParserException thrown to indicate XML parsing error.\n+   */\n+  public Retention getObjectRetention(GetObjectRetentionArgs args)\n+      throws ErrorResponseException, IllegalArgumentException, InsufficientDataException,\n+          InternalException, InvalidBucketNameException, InvalidKeyException,\n+          InvalidResponseException, IOException, NoSuchAlgorithmException, XmlParserException {\n     Map<String, String> queryParamMap = new HashMap<>();\n     queryParamMap.put(\"retention\", \"\");\n \n-    if (versionId != null && !versionId.isEmpty()) {\n-      queryParamMap.put(\"versionId\", versionId);\n+    if (args.versionId() != null && !args.versionId().isEmpty()) {", "originalCommit": "d121a7a32076bcf709b425c391c126bb43e1664a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjEyNDg5MA==", "url": "https://github.com/minio/minio-java/pull/938#discussion_r426124890", "bodyText": "typo here.", "author": "balamurugana", "createdAt": "2020-05-16T06:34:53Z", "path": "api/src/main/java/io/minio/SetObjectRetentionArgs.java", "diffHunk": "@@ -0,0 +1,61 @@\n+/*\n+ * MinIO Java SDK for Amazon S3 Compatible Cloud Storage, (C) 2020 MinIO, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.minio;\n+\n+import io.minio.messages.Retention;\n+\n+public class SetObjectRetentionArgs extends ObjectArgs {\n+  private Retention config;\n+  private boolean bypassGovernanceRetention;\n+\n+  public Retention config() {\n+    return config;\n+  }\n+\n+  public boolean bypassGovernanceRetention() {\n+    return bypassGovernanceRetention;\n+  }\n+\n+  public static Builder builder() {\n+    return new Builder();\n+  }\n+\n+  /** Argument builder of {@link SetObjectRetentionArgs}. */\n+  public static final class Builder extends ObjectArgs.Builder<Builder, SetObjectRetentionArgs> {\n+    public Builder config(Retention config) {\n+      if (config == null) {\n+        throw new IllegalArgumentException(\"null object retention configuration\");\n+      }\n+\n+      operations.add(args -> args.config = config);\n+      return this;\n+    }\n+\n+    public Builder bypassGovernanceRetention(boolean bypassGovernanceRetention) {\n+      operations.add(args -> args.bypassGovernanceRetention = bypassGovernanceRetention);\n+      return this;\n+    }\n+\n+    public SetObjectRetentionArgs build() throws IllegalArgumentException {\n+      SetObjectRetentionArgs args = build(SetObjectRetentionArgs.class);\n+      if (args.config == null) {\n+        throw new IllegalArgumentException(\"null bject retention configuration to build\");", "originalCommit": "d121a7a32076bcf709b425c391c126bb43e1664a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjEyNTUwMw==", "url": "https://github.com/minio/minio-java/pull/938#discussion_r426125503", "bodyText": "Shorten exception list by catching MinioException.", "author": "balamurugana", "createdAt": "2020-05-16T06:43:52Z", "path": "examples/GetObjectRetentionConfig.java", "diffHunk": "@@ -0,0 +1,114 @@\n+/*\n+ * MinIO Java SDK for Amazon S3 Compatible Cloud Storage, (C) 2020 MinIO, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+import io.minio.GetObjectRetentionArgs;\n+import io.minio.MakeBucketArgs;\n+import io.minio.MinioClient;\n+import io.minio.PutObjectOptions;\n+import io.minio.SetObjectRetentionArgs;\n+import io.minio.errors.ErrorResponseException;\n+import io.minio.errors.InsufficientDataException;\n+import io.minio.errors.InternalException;\n+import io.minio.errors.InvalidBucketNameException;\n+import io.minio.errors.InvalidEndpointException;\n+import io.minio.errors.InvalidPortException;\n+import io.minio.errors.InvalidResponseException;\n+import io.minio.errors.MinioException;\n+import io.minio.errors.RegionConflictException;\n+import io.minio.messages.Retention;\n+import io.minio.messages.RetentionMode;\n+import java.io.ByteArrayInputStream;\n+import java.io.IOException;\n+import java.security.InvalidKeyException;\n+import java.security.NoSuchAlgorithmException;\n+import java.time.ZonedDateTime;\n+\n+public class GetObjectRetentionConfig {\n+  /** MinioClient.getObjectRetention() example. */\n+  public static void main(String[] args)\n+      throws IOException, NoSuchAlgorithmException, InvalidKeyException, InvalidResponseException,\n+          InsufficientDataException, InternalException, ErrorResponseException,\n+          InvalidBucketNameException, InvalidPortException, InvalidEndpointException,\n+          RegionConflictException, IllegalArgumentException {", "originalCommit": "d121a7a32076bcf709b425c391c126bb43e1664a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjEyNTg2OQ==", "url": "https://github.com/minio/minio-java/pull/938#discussion_r426125869", "bodyText": "I defer by providing example from bucket creation to the end. My suggestion is to specific to the API.", "author": "balamurugana", "createdAt": "2020-05-16T06:49:57Z", "path": "examples/GetObjectRetentionConfig.java", "diffHunk": "@@ -0,0 +1,114 @@\n+/*\n+ * MinIO Java SDK for Amazon S3 Compatible Cloud Storage, (C) 2020 MinIO, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+import io.minio.GetObjectRetentionArgs;\n+import io.minio.MakeBucketArgs;\n+import io.minio.MinioClient;\n+import io.minio.PutObjectOptions;\n+import io.minio.SetObjectRetentionArgs;\n+import io.minio.errors.ErrorResponseException;\n+import io.minio.errors.InsufficientDataException;\n+import io.minio.errors.InternalException;\n+import io.minio.errors.InvalidBucketNameException;\n+import io.minio.errors.InvalidEndpointException;\n+import io.minio.errors.InvalidPortException;\n+import io.minio.errors.InvalidResponseException;\n+import io.minio.errors.MinioException;\n+import io.minio.errors.RegionConflictException;\n+import io.minio.messages.Retention;\n+import io.minio.messages.RetentionMode;\n+import java.io.ByteArrayInputStream;\n+import java.io.IOException;\n+import java.security.InvalidKeyException;\n+import java.security.NoSuchAlgorithmException;\n+import java.time.ZonedDateTime;\n+\n+public class GetObjectRetentionConfig {\n+  /** MinioClient.getObjectRetention() example. */\n+  public static void main(String[] args)\n+      throws IOException, NoSuchAlgorithmException, InvalidKeyException, InvalidResponseException,\n+          InsufficientDataException, InternalException, ErrorResponseException,\n+          InvalidBucketNameException, InvalidPortException, InvalidEndpointException,\n+          RegionConflictException, IllegalArgumentException {\n+    try {\n+\n+      /* play.min.io for test and development. */\n+      MinioClient minioClient =\n+          new MinioClient(\n+              \"https://play.min.io\",\n+              \"Q3AM3UQ867SPQQA43P2F\",\n+              \"zuf+tfteSlswRu7BJ86wekitnifILbZam1KYY3TG\");\n+\n+      // Create bucket if it doesn't exist.\n+      boolean found = minioClient.bucketExists(\"my-bucketname\");\n+      if (found) {\n+        System.out.println(\"my-bucketname already exists\");\n+      } else {\n+        // Create bucket 'my-bucketname' with object lock functionality enabled\n+        minioClient.makeBucket(\n+            MakeBucketArgs.builder().bucket(\"my-bucketname\").objectLock(true).build());\n+        System.out.println(\n+            \"my-bucketname is created successfully with object lock functionality enabled.\");\n+      }\n+\n+      StringBuilder builder = new StringBuilder();\n+      for (int i = 0; i < 100; i++) {\n+        builder.append(\n+            \"Sphinx of black quartz, judge my vow: Used by Adobe InDesign to display font samples. \");\n+        builder.append(\"(29 letters)\\n\");\n+        builder.append(\n+            \"Jackdaws love my big sphinx of quartz: Similarly, used by Windows XP for some fonts. \");\n+        builder.append(\"---\\n\");\n+      }\n+\n+      // Create a InputStream for object upload.\n+      ByteArrayInputStream bais = new ByteArrayInputStream(builder.toString().getBytes(\"UTF-8\"));\n+\n+      // Create object 'my-objectname' in 'my-bucketname' with content from the input stream.\n+      minioClient.putObject(\n+          \"my-bucketname\", \"my-objectname\", bais, new PutObjectOptions(bais.available(), -1));\n+      bais.close();\n+      System.out.println(\"my-objectname is uploaded successfully\");\n+\n+      // Declaring config with Retention mode as Compliance and\n+      // retain until one year to current date.\n+      ZonedDateTime retentionUntil = ZonedDateTime.now().plusYears(1);\n+      Retention config = new Retention(RetentionMode.COMPLIANCE, retentionUntil);\n+\n+      // Set object lock configuration\n+      minioClient.setObjectRetention(\n+          SetObjectRetentionArgs.builder()\n+              .bucket(\"my-bucketname\")\n+              .object(\"my-objectname\")\n+              .config(config)\n+              .bypassGovernanceRetention(true)\n+              .build());\n+\n+      // Get object lock retention\n+      Retention retention =\n+          minioClient.getObjectRetention(\n+              GetObjectRetentionArgs.builder()\n+                  .bucket(\"my-bucketname\")\n+                  .object(\"my-objectname\")\n+                  .build());\n+\n+      System.out.println(\"Mode: \" + retention.mode());\n+      System.out.println(\"Retainuntil Date: \" + retention.retainUntilDate());", "originalCommit": "d121a7a32076bcf709b425c391c126bb43e1664a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "19d2729371ef6e106d05ee88b37f633b8c9e4af5", "url": "https://github.com/minio/minio-java/commit/19d2729371ef6e106d05ee88b37f633b8c9e4af5", "message": "add arg builder to objectRetention API", "committedDate": "2020-05-22T08:46:06Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUxODQ4Mg==", "url": "https://github.com/minio/minio-java/pull/938#discussion_r429518482", "bodyText": "As bypassGovernanceMode() is used in removeObject(), we would need to be consistent with names. Sorry for the confusion.", "author": "balamurugana", "createdAt": "2020-05-23T06:09:06Z", "path": "api/src/main/java/io/minio/MinioClient.java", "diffHunk": "@@ -3624,23 +3625,67 @@ public void setObjectRetention(\n       throws ErrorResponseException, IllegalArgumentException, InsufficientDataException,\n           InternalException, InvalidBucketNameException, InvalidKeyException,\n           InvalidResponseException, IOException, NoSuchAlgorithmException, XmlParserException {\n-    if (config == null) {\n-      throw new IllegalArgumentException(\"null value is not allowed in config.\");\n+\n+    this.setObjectRetention(\n+        SetObjectRetentionArgs.builder()\n+            .bucket(bucketName)\n+            .object(objectName)\n+            .versionId(versionId)\n+            .config(config)\n+            .overrideGovernance(bypassGovernanceRetention)", "originalCommit": "19d2729371ef6e106d05ee88b37f633b8c9e4af5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUxODU1NA==", "url": "https://github.com/minio/minio-java/pull/938#discussion_r429518554", "bodyText": "You can use versionId() if not null. The validation is already done in ObjectArgs.", "author": "balamurugana", "createdAt": "2020-05-23T06:10:25Z", "path": "api/src/main/java/io/minio/MinioClient.java", "diffHunk": "@@ -3624,23 +3625,67 @@ public void setObjectRetention(\n       throws ErrorResponseException, IllegalArgumentException, InsufficientDataException,\n           InternalException, InvalidBucketNameException, InvalidKeyException,\n           InvalidResponseException, IOException, NoSuchAlgorithmException, XmlParserException {\n-    if (config == null) {\n-      throw new IllegalArgumentException(\"null value is not allowed in config.\");\n+\n+    this.setObjectRetention(\n+        SetObjectRetentionArgs.builder()\n+            .bucket(bucketName)\n+            .object(objectName)\n+            .versionId(versionId)\n+            .config(config)\n+            .overrideGovernance(bypassGovernanceRetention)\n+            .build());\n+  }\n+\n+  /**\n+   * Sets retention configuration to an object.\n+   *\n+   * <pre>Example:{@code\n+   *  Retention retention = new Retention(\n+   *       RetentionMode.COMPLIANCE, ZonedDateTime.now().plusYears(1));\n+   *  minioClient.setObjectRetention(\n+   *      SetObjectRetentionArgs.builder()\n+   *          .bucket(\"my-bucketname\")\n+   *          .object(\"my-objectname\")\n+   *          .config(config)\n+   *          .overrideGovernance(true)\n+   *          .build());\n+   * }</pre>\n+   *\n+   * @param args {@link SetObjectRetentionArgs} object.\n+   * @throws ErrorResponseException thrown to indicate S3 service returned an error response.\n+   * @throws IllegalArgumentException throws to indicate invalid argument passed.\n+   * @throws InsufficientDataException thrown to indicate not enough data available in InputStream.\n+   * @throws InternalException thrown to indicate internal library error.\n+   * @throws InvalidBucketNameException thrown to indicate invalid bucket name passed.\n+   * @throws InvalidKeyException thrown to indicate missing of HMAC SHA-256 library.\n+   * @throws InvalidResponseException thrown to indicate S3 service returned invalid or no error\n+   *     response.\n+   * @throws IOException thrown to indicate I/O error on S3 operation.\n+   * @throws NoSuchAlgorithmException thrown to indicate missing of MD5 or SHA-256 digest library.\n+   * @throws XmlParserException thrown to indicate XML parsing error.\n+   */\n+  public void setObjectRetention(SetObjectRetentionArgs args)\n+      throws ErrorResponseException, IllegalArgumentException, InsufficientDataException,\n+          InternalException, InvalidBucketNameException, InvalidKeyException,\n+          InvalidResponseException, IOException, NoSuchAlgorithmException, XmlParserException {\n+    if (args == null) {\n+      throw new IllegalArgumentException(\"null arguments\");\n     }\n \n     Map<String, String> queryParamMap = new HashMap<>();\n     queryParamMap.put(\"retention\", \"\");\n \n-    if (versionId != null && !versionId.isEmpty()) {\n-      queryParamMap.put(\"versionId\", versionId);\n+    if (args.versionId() != null && !args.versionId().isEmpty()) {", "originalCommit": "19d2729371ef6e106d05ee88b37f633b8c9e4af5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUxODY1OQ==", "url": "https://github.com/minio/minio-java/pull/938#discussion_r429518659", "bodyText": "use method name and field name similar.", "author": "balamurugana", "createdAt": "2020-05-23T06:12:17Z", "path": "api/src/main/java/io/minio/SetObjectRetentionArgs.java", "diffHunk": "@@ -0,0 +1,50 @@\n+/*\n+ * MinIO Java SDK for Amazon S3 Compatible Cloud Storage, (C) 2020 MinIO, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.minio;\n+\n+import io.minio.messages.Retention;\n+\n+/** Argument class of MinioClient.setObjectRetention(). */\n+public class SetObjectRetentionArgs extends ObjectArgs {\n+  private Retention config;\n+  private boolean bypassGovernanceRetention;", "originalCommit": "19d2729371ef6e106d05ee88b37f633b8c9e4af5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUxODc3Mg==", "url": "https://github.com/minio/minio-java/pull/938#discussion_r429518772", "bodyText": "You could have API name and example name similar.", "author": "balamurugana", "createdAt": "2020-05-23T06:14:21Z", "path": "examples/GetObjectRetentionConfig.java", "diffHunk": "@@ -0,0 +1,52 @@\n+/*", "originalCommit": "19d2729371ef6e106d05ee88b37f633b8c9e4af5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUxODgwNw==", "url": "https://github.com/minio/minio-java/pull/938#discussion_r429518807", "bodyText": "Same as above,", "author": "balamurugana", "createdAt": "2020-05-23T06:15:01Z", "path": "examples/SetObjectRetentionConfig.java", "diffHunk": "@@ -0,0 +1,69 @@\n+/*", "originalCommit": "19d2729371ef6e106d05ee88b37f633b8c9e4af5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUxODg4Mg==", "url": "https://github.com/minio/minio-java/pull/938#discussion_r429518882", "bodyText": "You can remove all stale comments.", "author": "balamurugana", "createdAt": "2020-05-23T06:16:01Z", "path": "functional/FunctionalTest.java", "diffHunk": "@@ -4253,6 +4561,10 @@ public static void runTests() throws Exception {\n     setDefaultRetention_test();\n     getDefaultRetention_test();\n \n+    setObjectRetention_test();\n+    // getObjectRetention_test1();\n+    // getObjectRetention_test2();", "originalCommit": "19d2729371ef6e106d05ee88b37f633b8c9e4af5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "a9e13be8b16025db1057f299022e2d90f69aaf67", "url": "https://github.com/minio/minio-java/commit/a9e13be8b16025db1057f299022e2d90f69aaf67", "message": "add arg builder to objectRetention API", "committedDate": "2020-05-24T07:29:25Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQxNjAyNw==", "url": "https://github.com/minio/minio-java/pull/938#discussion_r430416027", "bodyText": "you would need to add validate() method to check for args.config is not null.", "author": "balamurugana", "createdAt": "2020-05-26T13:34:43Z", "path": "api/src/main/java/io/minio/SetObjectRetentionArgs.java", "diffHunk": "@@ -0,0 +1,50 @@\n+/*\n+ * MinIO Java SDK for Amazon S3 Compatible Cloud Storage, (C) 2020 MinIO, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.minio;\n+\n+import io.minio.messages.Retention;\n+\n+/** Argument class of MinioClient.setObjectRetention(). */\n+public class SetObjectRetentionArgs extends ObjectArgs {\n+  private Retention config;\n+  private boolean bypassGovernanceMode;\n+\n+  public Retention config() {\n+    return config;\n+  }\n+\n+  public boolean bypassGovernanceMode() {\n+    return bypassGovernanceMode;\n+  }\n+\n+  public static Builder builder() {\n+    return new Builder();\n+  }\n+\n+  /** Argument builder of {@link SetObjectRetentionArgs}. */\n+  public static final class Builder extends ObjectArgs.Builder<Builder, SetObjectRetentionArgs> {", "originalCommit": "a9e13be8b16025db1057f299022e2d90f69aaf67", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQxODc0Ng==", "url": "https://github.com/minio/minio-java/pull/938#discussion_r430418746", "bodyText": "Please fix the comment appropriately", "author": "balamurugana", "createdAt": "2020-05-26T13:38:43Z", "path": "examples/SetObjectRetention.java", "diffHunk": "@@ -0,0 +1,69 @@\n+/*\n+ * MinIO Java SDK for Amazon S3 Compatible Cloud Storage, (C) 2020 MinIO, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+import io.minio.GetObjectRetentionArgs;\n+import io.minio.MinioClient;\n+import io.minio.SetObjectRetentionArgs;\n+import io.minio.errors.MinioException;\n+import io.minio.messages.Retention;\n+import io.minio.messages.RetentionMode;\n+import java.io.IOException;\n+import java.security.InvalidKeyException;\n+import java.security.NoSuchAlgorithmException;\n+import java.time.ZonedDateTime;\n+\n+public class SetObjectRetention {\n+  /** MinioClient.setObjectRetention() example. */\n+  public static void main(String[] args)\n+      throws IOException, NoSuchAlgorithmException, InvalidKeyException, IllegalArgumentException {\n+    try {\n+\n+      /* play.min.io for test and development. */\n+      MinioClient minioClient =\n+          new MinioClient(\n+              \"https://play.min.io\",\n+              \"Q3AM3UQ867SPQQA43P2F\",\n+              \"zuf+tfteSlswRu7BJ86wekitnifILbZam1KYY3TG\");\n+\n+      // Declaring config with Retention mode as Compliance and\n+      // retain until one year to current date.\n+      ZonedDateTime retentionUntil = ZonedDateTime.now().plusYears(1);\n+      Retention config = new Retention(RetentionMode.COMPLIANCE, retentionUntil);\n+\n+      // Set object lock configuration", "originalCommit": "a9e13be8b16025db1057f299022e2d90f69aaf67", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQxOTI5OA==", "url": "https://github.com/minio/minio-java/pull/938#discussion_r430419298", "bodyText": "Use handleException() method.", "author": "balamurugana", "createdAt": "2020-05-26T13:39:35Z", "path": "functional/FunctionalTest.java", "diffHunk": "@@ -3761,6 +3764,309 @@ public static void getDefaultRetention_test() throws Exception {\n     }\n   }\n \n+  /** Test: setObjectRetention(SetObjectRetentionArgs args). */\n+  public static void setObjectRetention_test() throws Exception {\n+    if (!mintEnv) {\n+      System.out.println(\"Test: setObjectRetention(SetObjectRetentionArgs args)\");\n+    }\n+\n+    long startTime = System.currentTimeMillis();\n+    String bucketName = getRandomName();\n+    String objectName = getRandomName();\n+    try {\n+      client.makeBucket(MakeBucketArgs.builder().bucket(bucketName).objectLock(true).build());\n+      try {\n+        ZonedDateTime retentionUntil = ZonedDateTime.now().plusDays(1);\n+        Retention expectedConfig = new Retention(RetentionMode.GOVERNANCE, retentionUntil);\n+\n+        try (final InputStream is = new ContentInputStream(1 * KB)) {\n+          PutObjectOptions options = new PutObjectOptions(1 * KB, -1);\n+          options.setContentType(customContentType);\n+          client.putObject(bucketName, objectName, is, options);\n+        }\n+\n+        client.setObjectRetention(\n+            SetObjectRetentionArgs.builder()\n+                .bucket(bucketName)\n+                .object(objectName)\n+                .config(expectedConfig)\n+                .build());\n+        // Set empty object lock configuration by setting bypassGovernanceMode as true\n+        Retention emptyConfig = new Retention();\n+        client.setObjectRetention(\n+            SetObjectRetentionArgs.builder()\n+                .bucket(bucketName)\n+                .object(objectName)\n+                .config(emptyConfig)\n+                .bypassGovernanceMode(true)\n+                .build());\n+\n+      } finally {\n+        client.removeObject(\n+            RemoveObjectArgs.builder().bucket(bucketName).object(objectName).build());\n+        client.removeBucket(RemoveBucketArgs.builder().bucket(bucketName).build());\n+      }\n+\n+      mintSuccessLog(\"setObjectRetention(SetObjectRetentionArgs args)\", null, startTime);\n+\n+    } catch (Exception e) {", "originalCommit": "a9e13be8b16025db1057f299022e2d90f69aaf67", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQyMTc4MQ==", "url": "https://github.com/minio/minio-java/pull/938#discussion_r430421781", "bodyText": "Too many nesting.\nIsn't ZonedDateTime.equals() working?", "author": "balamurugana", "createdAt": "2020-05-26T13:43:03Z", "path": "functional/FunctionalTest.java", "diffHunk": "@@ -3761,6 +3764,309 @@ public static void getDefaultRetention_test() throws Exception {\n     }\n   }\n \n+  /** Test: setObjectRetention(SetObjectRetentionArgs args). */\n+  public static void setObjectRetention_test() throws Exception {\n+    if (!mintEnv) {\n+      System.out.println(\"Test: setObjectRetention(SetObjectRetentionArgs args)\");\n+    }\n+\n+    long startTime = System.currentTimeMillis();\n+    String bucketName = getRandomName();\n+    String objectName = getRandomName();\n+    try {\n+      client.makeBucket(MakeBucketArgs.builder().bucket(bucketName).objectLock(true).build());\n+      try {\n+        ZonedDateTime retentionUntil = ZonedDateTime.now().plusDays(1);\n+        Retention expectedConfig = new Retention(RetentionMode.GOVERNANCE, retentionUntil);\n+\n+        try (final InputStream is = new ContentInputStream(1 * KB)) {\n+          PutObjectOptions options = new PutObjectOptions(1 * KB, -1);\n+          options.setContentType(customContentType);\n+          client.putObject(bucketName, objectName, is, options);\n+        }\n+\n+        client.setObjectRetention(\n+            SetObjectRetentionArgs.builder()\n+                .bucket(bucketName)\n+                .object(objectName)\n+                .config(expectedConfig)\n+                .build());\n+        // Set empty object lock configuration by setting bypassGovernanceMode as true\n+        Retention emptyConfig = new Retention();\n+        client.setObjectRetention(\n+            SetObjectRetentionArgs.builder()\n+                .bucket(bucketName)\n+                .object(objectName)\n+                .config(emptyConfig)\n+                .bypassGovernanceMode(true)\n+                .build());\n+\n+      } finally {\n+        client.removeObject(\n+            RemoveObjectArgs.builder().bucket(bucketName).object(objectName).build());\n+        client.removeBucket(RemoveBucketArgs.builder().bucket(bucketName).build());\n+      }\n+\n+      mintSuccessLog(\"setObjectRetention(SetObjectRetentionArgs args)\", null, startTime);\n+\n+    } catch (Exception e) {\n+      ErrorResponse errorResponse = null;\n+      if (e instanceof ErrorResponseException) {\n+        ErrorResponseException exp = (ErrorResponseException) e;\n+        errorResponse = exp.errorResponse();\n+      }\n+\n+      // Ignore NotImplemented error\n+      if (errorResponse != null && errorResponse.errorCode() == ErrorCode.NOT_IMPLEMENTED) {\n+        mintIgnoredLog(\"setObjectRetention(SetObjectRetentionArgs args)\", null, startTime);\n+      } else {\n+        mintFailedLog(\n+            \"setObjectRetention(SetObjectRetentionArgs args)\",\n+            null,\n+            startTime,\n+            null,\n+            e.toString() + \" >>> \" + Arrays.toString(e.getStackTrace()));\n+        throw e;\n+      }\n+    }\n+  }\n+\n+  /** Test: getObjectRetention(GetObjectRetentionArgs args). */\n+  public static void getObjectRetention_test1() throws Exception {\n+    if (!mintEnv) {\n+      System.out.println(\"Test: getObjectRetention(GetObjectRetentionArgs args)\");\n+    }\n+\n+    long startTime = System.currentTimeMillis();\n+    String bucketName = getRandomName();\n+    String objectName = getRandomName();\n+    try {\n+      client.makeBucket(MakeBucketArgs.builder().bucket(bucketName).objectLock(true).build());\n+      try {\n+        try (final InputStream is = new ContentInputStream(1 * KB)) {\n+          PutObjectOptions options = new PutObjectOptions(1 * KB, -1);\n+          options.setContentType(customContentType);\n+          client.putObject(bucketName, objectName, is, options);\n+        }\n+\n+        ZonedDateTime retentionUntil = ZonedDateTime.now().plusDays(3);\n+        Retention expectedConfig = new Retention(RetentionMode.GOVERNANCE, retentionUntil);\n+        client.setObjectRetention(\n+            SetObjectRetentionArgs.builder()\n+                .bucket(bucketName)\n+                .object(objectName)\n+                .config(expectedConfig)\n+                .build());\n+\n+        Retention config =\n+            client.getObjectRetention(\n+                GetObjectRetentionArgs.builder().bucket(bucketName).object(objectName).build());\n+\n+        if ((!(config\n+                .retainUntilDate()\n+                .toString()\n+                .substring(0, config.retainUntilDate().toString().indexOf(\"T\"))\n+                .equals(\n+                    expectedConfig\n+                        .retainUntilDate()\n+                        .toString()\n+                        .substring(0, expectedConfig.retainUntilDate().toString().indexOf(\"T\")))))", "originalCommit": "a9e13be8b16025db1057f299022e2d90f69aaf67", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDk3MjI0Ng==", "url": "https://github.com/minio/minio-java/pull/938#discussion_r430972246", "bodyText": "ZonedDateTime.equa didn't work as the value returned by server is 2020-05-30T08:51:38Z while the value set is 2020-05-30T14:21:38.951+05:30[Asia/Kolkata].", "author": "sinhaashish", "createdAt": "2020-05-27T09:12:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQyMTc4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTAwMzg2OQ==", "url": "https://github.com/minio/minio-java/pull/938#discussion_r431003869", "bodyText": "Thanks for you suggestion.\nZonedDateTime retentionUntil = ZonedDateTime.now(Time.UTC).plusDays(3).withNano(0); works.", "author": "sinhaashish", "createdAt": "2020-05-27T10:05:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQyMTc4MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQyMjE1Mw==", "url": "https://github.com/minio/minio-java/pull/938#discussion_r430422153", "bodyText": "Use handleException()", "author": "balamurugana", "createdAt": "2020-05-26T13:43:36Z", "path": "functional/FunctionalTest.java", "diffHunk": "@@ -3761,6 +3764,309 @@ public static void getDefaultRetention_test() throws Exception {\n     }\n   }\n \n+  /** Test: setObjectRetention(SetObjectRetentionArgs args). */\n+  public static void setObjectRetention_test() throws Exception {\n+    if (!mintEnv) {\n+      System.out.println(\"Test: setObjectRetention(SetObjectRetentionArgs args)\");\n+    }\n+\n+    long startTime = System.currentTimeMillis();\n+    String bucketName = getRandomName();\n+    String objectName = getRandomName();\n+    try {\n+      client.makeBucket(MakeBucketArgs.builder().bucket(bucketName).objectLock(true).build());\n+      try {\n+        ZonedDateTime retentionUntil = ZonedDateTime.now().plusDays(1);\n+        Retention expectedConfig = new Retention(RetentionMode.GOVERNANCE, retentionUntil);\n+\n+        try (final InputStream is = new ContentInputStream(1 * KB)) {\n+          PutObjectOptions options = new PutObjectOptions(1 * KB, -1);\n+          options.setContentType(customContentType);\n+          client.putObject(bucketName, objectName, is, options);\n+        }\n+\n+        client.setObjectRetention(\n+            SetObjectRetentionArgs.builder()\n+                .bucket(bucketName)\n+                .object(objectName)\n+                .config(expectedConfig)\n+                .build());\n+        // Set empty object lock configuration by setting bypassGovernanceMode as true\n+        Retention emptyConfig = new Retention();\n+        client.setObjectRetention(\n+            SetObjectRetentionArgs.builder()\n+                .bucket(bucketName)\n+                .object(objectName)\n+                .config(emptyConfig)\n+                .bypassGovernanceMode(true)\n+                .build());\n+\n+      } finally {\n+        client.removeObject(\n+            RemoveObjectArgs.builder().bucket(bucketName).object(objectName).build());\n+        client.removeBucket(RemoveBucketArgs.builder().bucket(bucketName).build());\n+      }\n+\n+      mintSuccessLog(\"setObjectRetention(SetObjectRetentionArgs args)\", null, startTime);\n+\n+    } catch (Exception e) {\n+      ErrorResponse errorResponse = null;\n+      if (e instanceof ErrorResponseException) {\n+        ErrorResponseException exp = (ErrorResponseException) e;\n+        errorResponse = exp.errorResponse();\n+      }\n+\n+      // Ignore NotImplemented error\n+      if (errorResponse != null && errorResponse.errorCode() == ErrorCode.NOT_IMPLEMENTED) {\n+        mintIgnoredLog(\"setObjectRetention(SetObjectRetentionArgs args)\", null, startTime);\n+      } else {\n+        mintFailedLog(\n+            \"setObjectRetention(SetObjectRetentionArgs args)\",\n+            null,\n+            startTime,\n+            null,\n+            e.toString() + \" >>> \" + Arrays.toString(e.getStackTrace()));\n+        throw e;\n+      }\n+    }\n+  }\n+\n+  /** Test: getObjectRetention(GetObjectRetentionArgs args). */\n+  public static void getObjectRetention_test1() throws Exception {\n+    if (!mintEnv) {\n+      System.out.println(\"Test: getObjectRetention(GetObjectRetentionArgs args)\");\n+    }\n+\n+    long startTime = System.currentTimeMillis();\n+    String bucketName = getRandomName();\n+    String objectName = getRandomName();\n+    try {\n+      client.makeBucket(MakeBucketArgs.builder().bucket(bucketName).objectLock(true).build());\n+      try {\n+        try (final InputStream is = new ContentInputStream(1 * KB)) {\n+          PutObjectOptions options = new PutObjectOptions(1 * KB, -1);\n+          options.setContentType(customContentType);\n+          client.putObject(bucketName, objectName, is, options);\n+        }\n+\n+        ZonedDateTime retentionUntil = ZonedDateTime.now().plusDays(3);\n+        Retention expectedConfig = new Retention(RetentionMode.GOVERNANCE, retentionUntil);\n+        client.setObjectRetention(\n+            SetObjectRetentionArgs.builder()\n+                .bucket(bucketName)\n+                .object(objectName)\n+                .config(expectedConfig)\n+                .build());\n+\n+        Retention config =\n+            client.getObjectRetention(\n+                GetObjectRetentionArgs.builder().bucket(bucketName).object(objectName).build());\n+\n+        if ((!(config\n+                .retainUntilDate()\n+                .toString()\n+                .substring(0, config.retainUntilDate().toString().indexOf(\"T\"))\n+                .equals(\n+                    expectedConfig\n+                        .retainUntilDate()\n+                        .toString()\n+                        .substring(0, expectedConfig.retainUntilDate().toString().indexOf(\"T\")))))\n+            || (config.mode() != expectedConfig.mode())) {\n+          throw new Exception(\n+              \"[FAILED] Expected: expected duration : \"\n+                  + expectedConfig.retainUntilDate()\n+                  + \", got: \"\n+                  + config.retainUntilDate()\n+                  + \" expected mode :\"\n+                  + expectedConfig.mode()\n+                  + \", got: \"\n+                  + config.mode());\n+        }\n+\n+        // Set empty object lock configuration by setting bypassGovernanceMode as true\n+        Retention emptyConfig = new Retention();\n+        client.setObjectRetention(\n+            SetObjectRetentionArgs.builder()\n+                .bucket(bucketName)\n+                .object(objectName)\n+                .config(emptyConfig)\n+                .bypassGovernanceMode(true)\n+                .build());\n+\n+      } finally {\n+        client.removeObject(\n+            RemoveObjectArgs.builder().bucket(bucketName).object(objectName).build());\n+        client.removeBucket(RemoveBucketArgs.builder().bucket(bucketName).build());\n+      }\n+\n+      mintSuccessLog(\"getObjectRetention(GetObjectRetentionArgs args)\", null, startTime);\n+\n+    } catch (Exception e) {\n+      ErrorResponse errorResponse = null;", "originalCommit": "a9e13be8b16025db1057f299022e2d90f69aaf67", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQyNjg4MQ==", "url": "https://github.com/minio/minio-java/pull/938#discussion_r430426881", "bodyText": "I think you are testing bypassGovernanceMode() here. If so it needs to be merged in above.\nI guess bypassGovernanceMode allow to change Retention where RetentionUntil time could be higher or lower.  If this is the test you want to do, you could have the test doing both.", "author": "balamurugana", "createdAt": "2020-05-26T13:50:02Z", "path": "functional/FunctionalTest.java", "diffHunk": "@@ -3761,6 +3764,309 @@ public static void getDefaultRetention_test() throws Exception {\n     }\n   }\n \n+  /** Test: setObjectRetention(SetObjectRetentionArgs args). */\n+  public static void setObjectRetention_test() throws Exception {\n+    if (!mintEnv) {\n+      System.out.println(\"Test: setObjectRetention(SetObjectRetentionArgs args)\");\n+    }\n+\n+    long startTime = System.currentTimeMillis();\n+    String bucketName = getRandomName();\n+    String objectName = getRandomName();\n+    try {\n+      client.makeBucket(MakeBucketArgs.builder().bucket(bucketName).objectLock(true).build());\n+      try {\n+        ZonedDateTime retentionUntil = ZonedDateTime.now().plusDays(1);\n+        Retention expectedConfig = new Retention(RetentionMode.GOVERNANCE, retentionUntil);\n+\n+        try (final InputStream is = new ContentInputStream(1 * KB)) {\n+          PutObjectOptions options = new PutObjectOptions(1 * KB, -1);\n+          options.setContentType(customContentType);\n+          client.putObject(bucketName, objectName, is, options);\n+        }\n+\n+        client.setObjectRetention(\n+            SetObjectRetentionArgs.builder()\n+                .bucket(bucketName)\n+                .object(objectName)\n+                .config(expectedConfig)\n+                .build());\n+        // Set empty object lock configuration by setting bypassGovernanceMode as true\n+        Retention emptyConfig = new Retention();\n+        client.setObjectRetention(\n+            SetObjectRetentionArgs.builder()\n+                .bucket(bucketName)\n+                .object(objectName)\n+                .config(emptyConfig)\n+                .bypassGovernanceMode(true)\n+                .build());\n+\n+      } finally {\n+        client.removeObject(\n+            RemoveObjectArgs.builder().bucket(bucketName).object(objectName).build());\n+        client.removeBucket(RemoveBucketArgs.builder().bucket(bucketName).build());\n+      }\n+\n+      mintSuccessLog(\"setObjectRetention(SetObjectRetentionArgs args)\", null, startTime);\n+\n+    } catch (Exception e) {\n+      ErrorResponse errorResponse = null;\n+      if (e instanceof ErrorResponseException) {\n+        ErrorResponseException exp = (ErrorResponseException) e;\n+        errorResponse = exp.errorResponse();\n+      }\n+\n+      // Ignore NotImplemented error\n+      if (errorResponse != null && errorResponse.errorCode() == ErrorCode.NOT_IMPLEMENTED) {\n+        mintIgnoredLog(\"setObjectRetention(SetObjectRetentionArgs args)\", null, startTime);\n+      } else {\n+        mintFailedLog(\n+            \"setObjectRetention(SetObjectRetentionArgs args)\",\n+            null,\n+            startTime,\n+            null,\n+            e.toString() + \" >>> \" + Arrays.toString(e.getStackTrace()));\n+        throw e;\n+      }\n+    }\n+  }\n+\n+  /** Test: getObjectRetention(GetObjectRetentionArgs args). */\n+  public static void getObjectRetention_test1() throws Exception {\n+    if (!mintEnv) {\n+      System.out.println(\"Test: getObjectRetention(GetObjectRetentionArgs args)\");\n+    }\n+\n+    long startTime = System.currentTimeMillis();\n+    String bucketName = getRandomName();\n+    String objectName = getRandomName();\n+    try {\n+      client.makeBucket(MakeBucketArgs.builder().bucket(bucketName).objectLock(true).build());\n+      try {\n+        try (final InputStream is = new ContentInputStream(1 * KB)) {\n+          PutObjectOptions options = new PutObjectOptions(1 * KB, -1);\n+          options.setContentType(customContentType);\n+          client.putObject(bucketName, objectName, is, options);\n+        }\n+\n+        ZonedDateTime retentionUntil = ZonedDateTime.now().plusDays(3);\n+        Retention expectedConfig = new Retention(RetentionMode.GOVERNANCE, retentionUntil);\n+        client.setObjectRetention(\n+            SetObjectRetentionArgs.builder()\n+                .bucket(bucketName)\n+                .object(objectName)\n+                .config(expectedConfig)\n+                .build());\n+\n+        Retention config =\n+            client.getObjectRetention(\n+                GetObjectRetentionArgs.builder().bucket(bucketName).object(objectName).build());\n+\n+        if ((!(config\n+                .retainUntilDate()\n+                .toString()\n+                .substring(0, config.retainUntilDate().toString().indexOf(\"T\"))\n+                .equals(\n+                    expectedConfig\n+                        .retainUntilDate()\n+                        .toString()\n+                        .substring(0, expectedConfig.retainUntilDate().toString().indexOf(\"T\")))))\n+            || (config.mode() != expectedConfig.mode())) {\n+          throw new Exception(\n+              \"[FAILED] Expected: expected duration : \"\n+                  + expectedConfig.retainUntilDate()\n+                  + \", got: \"\n+                  + config.retainUntilDate()\n+                  + \" expected mode :\"\n+                  + expectedConfig.mode()\n+                  + \", got: \"\n+                  + config.mode());\n+        }\n+\n+        // Set empty object lock configuration by setting bypassGovernanceMode as true\n+        Retention emptyConfig = new Retention();\n+        client.setObjectRetention(\n+            SetObjectRetentionArgs.builder()\n+                .bucket(bucketName)\n+                .object(objectName)\n+                .config(emptyConfig)\n+                .bypassGovernanceMode(true)\n+                .build());\n+\n+      } finally {\n+        client.removeObject(\n+            RemoveObjectArgs.builder().bucket(bucketName).object(objectName).build());\n+        client.removeBucket(RemoveBucketArgs.builder().bucket(bucketName).build());\n+      }\n+\n+      mintSuccessLog(\"getObjectRetention(GetObjectRetentionArgs args)\", null, startTime);\n+\n+    } catch (Exception e) {\n+      ErrorResponse errorResponse = null;\n+      if (e instanceof ErrorResponseException) {\n+        ErrorResponseException exp = (ErrorResponseException) e;\n+        errorResponse = exp.errorResponse();\n+      }\n+\n+      // Ignore NotImplemented error\n+      if (errorResponse != null && errorResponse.errorCode() == ErrorCode.NOT_IMPLEMENTED) {\n+        mintIgnoredLog(\"getObjectRetention(GetObjectRetentionArgs args)\", null, startTime);\n+      } else {\n+        mintFailedLog(\n+            \"getObjectRetention(GetObjectRetentionArgs args)\",\n+            null,\n+            startTime,\n+            null,\n+            e.toString() + \" >>> \" + Arrays.toString(e.getStackTrace()));\n+        throw e;\n+      }\n+    }\n+  }\n+\n+  /** Test: getObjectRetention(GetObjectRetentionArgs args). */\n+  public static void getObjectRetention_test2() throws Exception {\n+    if (!mintEnv) {\n+      System.out.println(\n+          \"Test: with shortened retention period: getObjectRetention(GetObjectRetentionArgs args)\");\n+    }\n+\n+    long startTime = System.currentTimeMillis();\n+    String bucketName = getRandomName();\n+    String objectName = getRandomName();\n+    try {\n+      client.makeBucket(MakeBucketArgs.builder().bucket(bucketName).objectLock(true).build());\n+      try {\n+        try (final InputStream is = new ContentInputStream(1 * KB)) {\n+          PutObjectOptions options = new PutObjectOptions(1 * KB, -1);\n+          options.setContentType(customContentType);\n+          client.putObject(bucketName, objectName, is, options);\n+        }\n+\n+        ZonedDateTime retentionUntil = ZonedDateTime.now().plusDays(3);\n+        Retention expectedConfig = new Retention(RetentionMode.GOVERNANCE, retentionUntil);\n+        client.setObjectRetention(\n+            SetObjectRetentionArgs.builder()\n+                .bucket(bucketName)\n+                .object(objectName)\n+                .config(expectedConfig)\n+                .build());\n+\n+        Retention config =\n+            client.getObjectRetention(\n+                GetObjectRetentionArgs.builder().bucket(bucketName).object(objectName).build());\n+\n+        if ((!(config\n+                .retainUntilDate()\n+                .toString()\n+                .substring(0, config.retainUntilDate().toString().indexOf(\"T\"))\n+                .equals(\n+                    expectedConfig\n+                        .retainUntilDate()\n+                        .toString()\n+                        .substring(0, expectedConfig.retainUntilDate().toString().indexOf(\"T\")))))\n+            || (config.mode() != expectedConfig.mode())) {\n+          throw new Exception(\n+              \"[FAILED] Expected: expected duration : \"\n+                  + expectedConfig.retainUntilDate()\n+                  + \", got: \"\n+                  + config.retainUntilDate()\n+                  + \" expected mode :\"\n+                  + expectedConfig.mode()\n+                  + \", got: \"\n+                  + config.mode());\n+        }\n+\n+        // You can perform operations on object versions that are locked in governance mode as if\n+        // they were unprotected if you have the s3:bypassGovernanceMode permission. These\n+        // operations include deleting an object version, shortening the retention period, or\n+        // removing the Object Lock by placing a new lock with empty parameters.\n+        ZonedDateTime shortenedRetentionUntil = ZonedDateTime.now().plusDays(1);", "originalCommit": "a9e13be8b16025db1057f299022e2d90f69aaf67", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQzOTk1MA==", "url": "https://github.com/minio/minio-java/pull/938#discussion_r430439950", "bodyText": "This test is to set retention with a shortened retention period. As per s3 , retention period can shortened only by setting bypassGovernance to true.\nYou can perform operations on object versions that are locked in governance mode as if they were unprotected if you have the s3:BypassGovernanceRetention permission. These operations include deleting an object version, shortening the retention period, or removing the Object Lock by placing a new lock with empty parameters. \nbypassGovernanceMode is tested in all the related functional test test as  i set the empty lock by setting bypassGovernance to true and then i am able to delete the object.", "author": "sinhaashish", "createdAt": "2020-05-26T14:07:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQyNjg4MQ=="}], "type": "inlineReview"}, {"oid": "c9fbc2a12a13eb1ba565a4be6a7d199b7a24a709", "url": "https://github.com/minio/minio-java/commit/c9fbc2a12a13eb1ba565a4be6a7d199b7a24a709", "message": "add arg builder to objectRetention API", "committedDate": "2020-05-26T13:53:55Z", "type": "forcePushed"}, {"oid": "d3ed3923aadb3935b95f90c87d6e8eac66db3ae8", "url": "https://github.com/minio/minio-java/commit/d3ed3923aadb3935b95f90c87d6e8eac66db3ae8", "message": "Set/Get Object Retention", "committedDate": "2020-05-27T08:21:29Z", "type": "commit"}, {"oid": "3298f45d075ce4113f7cf207385611255b95ea35", "url": "https://github.com/minio/minio-java/commit/3298f45d075ce4113f7cf207385611255b95ea35", "message": "add arg builder to objectRetention API", "committedDate": "2020-05-27T08:24:27Z", "type": "commit"}, {"oid": "03c418fd29bf0528bc4fb3c0a8d209213a6fb1b7", "url": "https://github.com/minio/minio-java/commit/03c418fd29bf0528bc4fb3c0a8d209213a6fb1b7", "message": "address review comment", "committedDate": "2020-05-27T09:20:01Z", "type": "forcePushed"}, {"oid": "04a93745efb2da6db1158c734fdd163a0e987be4", "url": "https://github.com/minio/minio-java/commit/04a93745efb2da6db1158c734fdd163a0e987be4", "message": "address review comment", "committedDate": "2020-05-27T10:02:50Z", "type": "commit"}, {"oid": "04a93745efb2da6db1158c734fdd163a0e987be4", "url": "https://github.com/minio/minio-java/commit/04a93745efb2da6db1158c734fdd163a0e987be4", "message": "address review comment", "committedDate": "2020-05-27T10:02:50Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTEzOTA1MA==", "url": "https://github.com/minio/minio-java/pull/938#discussion_r431139050", "bodyText": "Its not required to close ContentInputStream", "author": "balamurugana", "createdAt": "2020-05-27T13:40:37Z", "path": "functional/FunctionalTest.java", "diffHunk": "@@ -3795,6 +3798,155 @@ public static void getDefaultRetention_test() throws Exception {\n     }\n   }\n \n+  /** Test: setObjectRetention(SetObjectRetentionArgs args). */\n+  public static void setObjectRetention_test1() throws Exception {\n+    String methodName = \"setObjectRetention(SetObjectRetentionArgs args)\";\n+    if (!mintEnv) {\n+      System.out.println(\"Test: \" + methodName);\n+    }\n+\n+    long startTime = System.currentTimeMillis();\n+    String bucketName = getRandomName();\n+    String objectName = getRandomName();\n+    try {\n+      client.makeBucket(MakeBucketArgs.builder().bucket(bucketName).objectLock(true).build());\n+      try {\n+        ZonedDateTime retentionUntil = ZonedDateTime.now(Time.UTC).plusDays(1).withNano(0);\n+        Retention expectedConfig = new Retention(RetentionMode.GOVERNANCE, retentionUntil);\n+\n+        try (final InputStream is = new ContentInputStream(1 * KB)) {", "originalCommit": "04a93745efb2da6db1158c734fdd163a0e987be4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTEzOTkzNQ==", "url": "https://github.com/minio/minio-java/pull/938#discussion_r431139935", "bodyText": "Just have these two lines before setObjectRetention()", "author": "balamurugana", "createdAt": "2020-05-27T13:41:47Z", "path": "functional/FunctionalTest.java", "diffHunk": "@@ -3795,6 +3798,155 @@ public static void getDefaultRetention_test() throws Exception {\n     }\n   }\n \n+  /** Test: setObjectRetention(SetObjectRetentionArgs args). */\n+  public static void setObjectRetention_test1() throws Exception {\n+    String methodName = \"setObjectRetention(SetObjectRetentionArgs args)\";\n+    if (!mintEnv) {\n+      System.out.println(\"Test: \" + methodName);\n+    }\n+\n+    long startTime = System.currentTimeMillis();\n+    String bucketName = getRandomName();\n+    String objectName = getRandomName();\n+    try {\n+      client.makeBucket(MakeBucketArgs.builder().bucket(bucketName).objectLock(true).build());\n+      try {\n+        ZonedDateTime retentionUntil = ZonedDateTime.now(Time.UTC).plusDays(1).withNano(0);\n+        Retention expectedConfig = new Retention(RetentionMode.GOVERNANCE, retentionUntil);", "originalCommit": "04a93745efb2da6db1158c734fdd163a0e987be4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTE0MTU3NQ==", "url": "https://github.com/minio/minio-java/pull/938#discussion_r431141575", "bodyText": "This is not object lock configuration. Either fix the comment or remove it.", "author": "balamurugana", "createdAt": "2020-05-27T13:43:59Z", "path": "functional/FunctionalTest.java", "diffHunk": "@@ -3795,6 +3798,155 @@ public static void getDefaultRetention_test() throws Exception {\n     }\n   }\n \n+  /** Test: setObjectRetention(SetObjectRetentionArgs args). */\n+  public static void setObjectRetention_test1() throws Exception {\n+    String methodName = \"setObjectRetention(SetObjectRetentionArgs args)\";\n+    if (!mintEnv) {\n+      System.out.println(\"Test: \" + methodName);\n+    }\n+\n+    long startTime = System.currentTimeMillis();\n+    String bucketName = getRandomName();\n+    String objectName = getRandomName();\n+    try {\n+      client.makeBucket(MakeBucketArgs.builder().bucket(bucketName).objectLock(true).build());\n+      try {\n+        ZonedDateTime retentionUntil = ZonedDateTime.now(Time.UTC).plusDays(1).withNano(0);\n+        Retention expectedConfig = new Retention(RetentionMode.GOVERNANCE, retentionUntil);\n+\n+        try (final InputStream is = new ContentInputStream(1 * KB)) {\n+          PutObjectOptions options = new PutObjectOptions(1 * KB, -1);\n+          options.setContentType(customContentType);\n+          client.putObject(bucketName, objectName, is, options);\n+        }\n+\n+        client.setObjectRetention(\n+            SetObjectRetentionArgs.builder()\n+                .bucket(bucketName)\n+                .object(objectName)\n+                .config(expectedConfig)\n+                .build());\n+        // Set empty object lock configuration by setting bypassGovernanceMode as true", "originalCommit": "04a93745efb2da6db1158c734fdd163a0e987be4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTE2MTAzMw==", "url": "https://github.com/minio/minio-java/pull/938#discussion_r431161033", "bodyText": "same as above.", "author": "balamurugana", "createdAt": "2020-05-27T14:09:20Z", "path": "functional/FunctionalTest.java", "diffHunk": "@@ -3795,6 +3798,155 @@ public static void getDefaultRetention_test() throws Exception {\n     }\n   }\n \n+  /** Test: setObjectRetention(SetObjectRetentionArgs args). */\n+  public static void setObjectRetention_test1() throws Exception {\n+    String methodName = \"setObjectRetention(SetObjectRetentionArgs args)\";\n+    if (!mintEnv) {\n+      System.out.println(\"Test: \" + methodName);\n+    }\n+\n+    long startTime = System.currentTimeMillis();\n+    String bucketName = getRandomName();\n+    String objectName = getRandomName();\n+    try {\n+      client.makeBucket(MakeBucketArgs.builder().bucket(bucketName).objectLock(true).build());\n+      try {\n+        ZonedDateTime retentionUntil = ZonedDateTime.now(Time.UTC).plusDays(1).withNano(0);\n+        Retention expectedConfig = new Retention(RetentionMode.GOVERNANCE, retentionUntil);\n+\n+        try (final InputStream is = new ContentInputStream(1 * KB)) {\n+          PutObjectOptions options = new PutObjectOptions(1 * KB, -1);\n+          options.setContentType(customContentType);\n+          client.putObject(bucketName, objectName, is, options);\n+        }\n+\n+        client.setObjectRetention(\n+            SetObjectRetentionArgs.builder()\n+                .bucket(bucketName)\n+                .object(objectName)\n+                .config(expectedConfig)\n+                .build());\n+        // Set empty object lock configuration by setting bypassGovernanceMode as true\n+        Retention emptyConfig = new Retention();\n+        client.setObjectRetention(\n+            SetObjectRetentionArgs.builder()\n+                .bucket(bucketName)\n+                .object(objectName)\n+                .config(emptyConfig)\n+                .bypassGovernanceMode(true)\n+                .build());\n+\n+      } finally {\n+        client.removeObject(\n+            RemoveObjectArgs.builder().bucket(bucketName).object(objectName).build());\n+        client.removeBucket(RemoveBucketArgs.builder().bucket(bucketName).build());\n+      }\n+      mintSuccessLog(methodName, null, startTime);\n+    } catch (Exception e) {\n+      handleException(methodName, null, startTime, e);\n+    }\n+  }\n+\n+  /** Test: getObjectRetention(GetObjectRetentionArgs args). */\n+  public static void getObjectRetention_test1() throws Exception {\n+    String methodName = \"getObjectRetention(GetObjectRetentionArgs args)\";\n+    if (!mintEnv) {\n+      System.out.println(\"Test: with shortened retention period: \" + methodName);\n+    }\n+\n+    long startTime = System.currentTimeMillis();\n+    String bucketName = getRandomName();\n+    String objectName = getRandomName();\n+    try {\n+      client.makeBucket(MakeBucketArgs.builder().bucket(bucketName).objectLock(true).build());\n+      try {\n+        try (final InputStream is = new ContentInputStream(1 * KB)) {", "originalCommit": "04a93745efb2da6db1158c734fdd163a0e987be4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTE4NTM3OA==", "url": "https://github.com/minio/minio-java/pull/938#discussion_r431185378", "bodyText": "I think you could have separate two if checks.", "author": "balamurugana", "createdAt": "2020-05-27T14:35:27Z", "path": "functional/FunctionalTest.java", "diffHunk": "@@ -3795,6 +3798,155 @@ public static void getDefaultRetention_test() throws Exception {\n     }\n   }\n \n+  /** Test: setObjectRetention(SetObjectRetentionArgs args). */\n+  public static void setObjectRetention_test1() throws Exception {\n+    String methodName = \"setObjectRetention(SetObjectRetentionArgs args)\";\n+    if (!mintEnv) {\n+      System.out.println(\"Test: \" + methodName);\n+    }\n+\n+    long startTime = System.currentTimeMillis();\n+    String bucketName = getRandomName();\n+    String objectName = getRandomName();\n+    try {\n+      client.makeBucket(MakeBucketArgs.builder().bucket(bucketName).objectLock(true).build());\n+      try {\n+        ZonedDateTime retentionUntil = ZonedDateTime.now(Time.UTC).plusDays(1).withNano(0);\n+        Retention expectedConfig = new Retention(RetentionMode.GOVERNANCE, retentionUntil);\n+\n+        try (final InputStream is = new ContentInputStream(1 * KB)) {\n+          PutObjectOptions options = new PutObjectOptions(1 * KB, -1);\n+          options.setContentType(customContentType);\n+          client.putObject(bucketName, objectName, is, options);\n+        }\n+\n+        client.setObjectRetention(\n+            SetObjectRetentionArgs.builder()\n+                .bucket(bucketName)\n+                .object(objectName)\n+                .config(expectedConfig)\n+                .build());\n+        // Set empty object lock configuration by setting bypassGovernanceMode as true\n+        Retention emptyConfig = new Retention();\n+        client.setObjectRetention(\n+            SetObjectRetentionArgs.builder()\n+                .bucket(bucketName)\n+                .object(objectName)\n+                .config(emptyConfig)\n+                .bypassGovernanceMode(true)\n+                .build());\n+\n+      } finally {\n+        client.removeObject(\n+            RemoveObjectArgs.builder().bucket(bucketName).object(objectName).build());\n+        client.removeBucket(RemoveBucketArgs.builder().bucket(bucketName).build());\n+      }\n+      mintSuccessLog(methodName, null, startTime);\n+    } catch (Exception e) {\n+      handleException(methodName, null, startTime, e);\n+    }\n+  }\n+\n+  /** Test: getObjectRetention(GetObjectRetentionArgs args). */\n+  public static void getObjectRetention_test1() throws Exception {\n+    String methodName = \"getObjectRetention(GetObjectRetentionArgs args)\";\n+    if (!mintEnv) {\n+      System.out.println(\"Test: with shortened retention period: \" + methodName);\n+    }\n+\n+    long startTime = System.currentTimeMillis();\n+    String bucketName = getRandomName();\n+    String objectName = getRandomName();\n+    try {\n+      client.makeBucket(MakeBucketArgs.builder().bucket(bucketName).objectLock(true).build());\n+      try {\n+        try (final InputStream is = new ContentInputStream(1 * KB)) {\n+          PutObjectOptions options = new PutObjectOptions(1 * KB, -1);\n+          options.setContentType(customContentType);\n+          client.putObject(bucketName, objectName, is, options);\n+        }\n+\n+        ZonedDateTime retentionUntil = ZonedDateTime.now(Time.UTC).plusDays(3).withNano(0);\n+        Retention expectedConfig = new Retention(RetentionMode.GOVERNANCE, retentionUntil);\n+        client.setObjectRetention(\n+            SetObjectRetentionArgs.builder()\n+                .bucket(bucketName)\n+                .object(objectName)\n+                .config(expectedConfig)\n+                .build());\n+\n+        Retention config =\n+            client.getObjectRetention(\n+                GetObjectRetentionArgs.builder().bucket(bucketName).object(objectName).build());\n+\n+        if (!(config.retainUntilDate().equals(expectedConfig.retainUntilDate()))\n+            || (config.mode() != expectedConfig.mode())) {", "originalCommit": "04a93745efb2da6db1158c734fdd163a0e987be4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTE4ODA1NQ==", "url": "https://github.com/minio/minio-java/pull/938#discussion_r431188055", "bodyText": "This test is also checking to shortening retention until. You could just have \"Test: \"", "author": "balamurugana", "createdAt": "2020-05-27T14:38:03Z", "path": "functional/FunctionalTest.java", "diffHunk": "@@ -3795,6 +3798,155 @@ public static void getDefaultRetention_test() throws Exception {\n     }\n   }\n \n+  /** Test: setObjectRetention(SetObjectRetentionArgs args). */\n+  public static void setObjectRetention_test1() throws Exception {\n+    String methodName = \"setObjectRetention(SetObjectRetentionArgs args)\";\n+    if (!mintEnv) {\n+      System.out.println(\"Test: \" + methodName);\n+    }\n+\n+    long startTime = System.currentTimeMillis();\n+    String bucketName = getRandomName();\n+    String objectName = getRandomName();\n+    try {\n+      client.makeBucket(MakeBucketArgs.builder().bucket(bucketName).objectLock(true).build());\n+      try {\n+        ZonedDateTime retentionUntil = ZonedDateTime.now(Time.UTC).plusDays(1).withNano(0);\n+        Retention expectedConfig = new Retention(RetentionMode.GOVERNANCE, retentionUntil);\n+\n+        try (final InputStream is = new ContentInputStream(1 * KB)) {\n+          PutObjectOptions options = new PutObjectOptions(1 * KB, -1);\n+          options.setContentType(customContentType);\n+          client.putObject(bucketName, objectName, is, options);\n+        }\n+\n+        client.setObjectRetention(\n+            SetObjectRetentionArgs.builder()\n+                .bucket(bucketName)\n+                .object(objectName)\n+                .config(expectedConfig)\n+                .build());\n+        // Set empty object lock configuration by setting bypassGovernanceMode as true\n+        Retention emptyConfig = new Retention();\n+        client.setObjectRetention(\n+            SetObjectRetentionArgs.builder()\n+                .bucket(bucketName)\n+                .object(objectName)\n+                .config(emptyConfig)\n+                .bypassGovernanceMode(true)\n+                .build());\n+\n+      } finally {\n+        client.removeObject(\n+            RemoveObjectArgs.builder().bucket(bucketName).object(objectName).build());\n+        client.removeBucket(RemoveBucketArgs.builder().bucket(bucketName).build());\n+      }\n+      mintSuccessLog(methodName, null, startTime);\n+    } catch (Exception e) {\n+      handleException(methodName, null, startTime, e);\n+    }\n+  }\n+\n+  /** Test: getObjectRetention(GetObjectRetentionArgs args). */\n+  public static void getObjectRetention_test1() throws Exception {\n+    String methodName = \"getObjectRetention(GetObjectRetentionArgs args)\";\n+    if (!mintEnv) {\n+      System.out.println(\"Test: with shortened retention period: \" + methodName);", "originalCommit": "04a93745efb2da6db1158c734fdd163a0e987be4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTE4ODkxNA==", "url": "https://github.com/minio/minio-java/pull/938#discussion_r431188914", "bodyText": "We can reuse expectedConfig itself.", "author": "balamurugana", "createdAt": "2020-05-27T14:39:10Z", "path": "functional/FunctionalTest.java", "diffHunk": "@@ -3795,6 +3798,155 @@ public static void getDefaultRetention_test() throws Exception {\n     }\n   }\n \n+  /** Test: setObjectRetention(SetObjectRetentionArgs args). */\n+  public static void setObjectRetention_test1() throws Exception {\n+    String methodName = \"setObjectRetention(SetObjectRetentionArgs args)\";\n+    if (!mintEnv) {\n+      System.out.println(\"Test: \" + methodName);\n+    }\n+\n+    long startTime = System.currentTimeMillis();\n+    String bucketName = getRandomName();\n+    String objectName = getRandomName();\n+    try {\n+      client.makeBucket(MakeBucketArgs.builder().bucket(bucketName).objectLock(true).build());\n+      try {\n+        ZonedDateTime retentionUntil = ZonedDateTime.now(Time.UTC).plusDays(1).withNano(0);\n+        Retention expectedConfig = new Retention(RetentionMode.GOVERNANCE, retentionUntil);\n+\n+        try (final InputStream is = new ContentInputStream(1 * KB)) {\n+          PutObjectOptions options = new PutObjectOptions(1 * KB, -1);\n+          options.setContentType(customContentType);\n+          client.putObject(bucketName, objectName, is, options);\n+        }\n+\n+        client.setObjectRetention(\n+            SetObjectRetentionArgs.builder()\n+                .bucket(bucketName)\n+                .object(objectName)\n+                .config(expectedConfig)\n+                .build());\n+        // Set empty object lock configuration by setting bypassGovernanceMode as true\n+        Retention emptyConfig = new Retention();\n+        client.setObjectRetention(\n+            SetObjectRetentionArgs.builder()\n+                .bucket(bucketName)\n+                .object(objectName)\n+                .config(emptyConfig)\n+                .bypassGovernanceMode(true)\n+                .build());\n+\n+      } finally {\n+        client.removeObject(\n+            RemoveObjectArgs.builder().bucket(bucketName).object(objectName).build());\n+        client.removeBucket(RemoveBucketArgs.builder().bucket(bucketName).build());\n+      }\n+      mintSuccessLog(methodName, null, startTime);\n+    } catch (Exception e) {\n+      handleException(methodName, null, startTime, e);\n+    }\n+  }\n+\n+  /** Test: getObjectRetention(GetObjectRetentionArgs args). */\n+  public static void getObjectRetention_test1() throws Exception {\n+    String methodName = \"getObjectRetention(GetObjectRetentionArgs args)\";\n+    if (!mintEnv) {\n+      System.out.println(\"Test: with shortened retention period: \" + methodName);\n+    }\n+\n+    long startTime = System.currentTimeMillis();\n+    String bucketName = getRandomName();\n+    String objectName = getRandomName();\n+    try {\n+      client.makeBucket(MakeBucketArgs.builder().bucket(bucketName).objectLock(true).build());\n+      try {\n+        try (final InputStream is = new ContentInputStream(1 * KB)) {\n+          PutObjectOptions options = new PutObjectOptions(1 * KB, -1);\n+          options.setContentType(customContentType);\n+          client.putObject(bucketName, objectName, is, options);\n+        }\n+\n+        ZonedDateTime retentionUntil = ZonedDateTime.now(Time.UTC).plusDays(3).withNano(0);\n+        Retention expectedConfig = new Retention(RetentionMode.GOVERNANCE, retentionUntil);\n+        client.setObjectRetention(\n+            SetObjectRetentionArgs.builder()\n+                .bucket(bucketName)\n+                .object(objectName)\n+                .config(expectedConfig)\n+                .build());\n+\n+        Retention config =\n+            client.getObjectRetention(\n+                GetObjectRetentionArgs.builder().bucket(bucketName).object(objectName).build());\n+\n+        if (!(config.retainUntilDate().equals(expectedConfig.retainUntilDate()))\n+            || (config.mode() != expectedConfig.mode())) {\n+          throw new Exception(\n+              \"[FAILED] Expected: expected duration : \"\n+                  + expectedConfig.retainUntilDate()\n+                  + \", got: \"\n+                  + config.retainUntilDate()\n+                  + \" expected mode :\"\n+                  + expectedConfig.mode()\n+                  + \", got: \"\n+                  + config.mode());\n+        }\n+\n+        // You can perform operations on object versions that are locked in governance mode as if\n+        // they were unprotected if you have the s3:bypassGovernanceMode permission. These\n+        // operations include deleting an object version, shortening the retention period, or\n+        // removing the Object Lock by placing a new lock with empty parameters.\n+        ZonedDateTime shortenedRetentionUntil = ZonedDateTime.now(Time.UTC).plusDays(1).withNano(0);\n+        Retention expectedConfigWithShortenedPeriod =", "originalCommit": "04a93745efb2da6db1158c734fdd163a0e987be4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTE5MDE2NQ==", "url": "https://github.com/minio/minio-java/pull/938#discussion_r431190165", "bodyText": "similarly config can be reused.", "author": "balamurugana", "createdAt": "2020-05-27T14:40:48Z", "path": "functional/FunctionalTest.java", "diffHunk": "@@ -3795,6 +3798,155 @@ public static void getDefaultRetention_test() throws Exception {\n     }\n   }\n \n+  /** Test: setObjectRetention(SetObjectRetentionArgs args). */\n+  public static void setObjectRetention_test1() throws Exception {\n+    String methodName = \"setObjectRetention(SetObjectRetentionArgs args)\";\n+    if (!mintEnv) {\n+      System.out.println(\"Test: \" + methodName);\n+    }\n+\n+    long startTime = System.currentTimeMillis();\n+    String bucketName = getRandomName();\n+    String objectName = getRandomName();\n+    try {\n+      client.makeBucket(MakeBucketArgs.builder().bucket(bucketName).objectLock(true).build());\n+      try {\n+        ZonedDateTime retentionUntil = ZonedDateTime.now(Time.UTC).plusDays(1).withNano(0);\n+        Retention expectedConfig = new Retention(RetentionMode.GOVERNANCE, retentionUntil);\n+\n+        try (final InputStream is = new ContentInputStream(1 * KB)) {\n+          PutObjectOptions options = new PutObjectOptions(1 * KB, -1);\n+          options.setContentType(customContentType);\n+          client.putObject(bucketName, objectName, is, options);\n+        }\n+\n+        client.setObjectRetention(\n+            SetObjectRetentionArgs.builder()\n+                .bucket(bucketName)\n+                .object(objectName)\n+                .config(expectedConfig)\n+                .build());\n+        // Set empty object lock configuration by setting bypassGovernanceMode as true\n+        Retention emptyConfig = new Retention();\n+        client.setObjectRetention(\n+            SetObjectRetentionArgs.builder()\n+                .bucket(bucketName)\n+                .object(objectName)\n+                .config(emptyConfig)\n+                .bypassGovernanceMode(true)\n+                .build());\n+\n+      } finally {\n+        client.removeObject(\n+            RemoveObjectArgs.builder().bucket(bucketName).object(objectName).build());\n+        client.removeBucket(RemoveBucketArgs.builder().bucket(bucketName).build());\n+      }\n+      mintSuccessLog(methodName, null, startTime);\n+    } catch (Exception e) {\n+      handleException(methodName, null, startTime, e);\n+    }\n+  }\n+\n+  /** Test: getObjectRetention(GetObjectRetentionArgs args). */\n+  public static void getObjectRetention_test1() throws Exception {\n+    String methodName = \"getObjectRetention(GetObjectRetentionArgs args)\";\n+    if (!mintEnv) {\n+      System.out.println(\"Test: with shortened retention period: \" + methodName);\n+    }\n+\n+    long startTime = System.currentTimeMillis();\n+    String bucketName = getRandomName();\n+    String objectName = getRandomName();\n+    try {\n+      client.makeBucket(MakeBucketArgs.builder().bucket(bucketName).objectLock(true).build());\n+      try {\n+        try (final InputStream is = new ContentInputStream(1 * KB)) {\n+          PutObjectOptions options = new PutObjectOptions(1 * KB, -1);\n+          options.setContentType(customContentType);\n+          client.putObject(bucketName, objectName, is, options);\n+        }\n+\n+        ZonedDateTime retentionUntil = ZonedDateTime.now(Time.UTC).plusDays(3).withNano(0);\n+        Retention expectedConfig = new Retention(RetentionMode.GOVERNANCE, retentionUntil);\n+        client.setObjectRetention(\n+            SetObjectRetentionArgs.builder()\n+                .bucket(bucketName)\n+                .object(objectName)\n+                .config(expectedConfig)\n+                .build());\n+\n+        Retention config =\n+            client.getObjectRetention(\n+                GetObjectRetentionArgs.builder().bucket(bucketName).object(objectName).build());\n+\n+        if (!(config.retainUntilDate().equals(expectedConfig.retainUntilDate()))\n+            || (config.mode() != expectedConfig.mode())) {\n+          throw new Exception(\n+              \"[FAILED] Expected: expected duration : \"\n+                  + expectedConfig.retainUntilDate()\n+                  + \", got: \"\n+                  + config.retainUntilDate()\n+                  + \" expected mode :\"\n+                  + expectedConfig.mode()\n+                  + \", got: \"\n+                  + config.mode());\n+        }\n+\n+        // You can perform operations on object versions that are locked in governance mode as if\n+        // they were unprotected if you have the s3:bypassGovernanceMode permission. These\n+        // operations include deleting an object version, shortening the retention period, or\n+        // removing the Object Lock by placing a new lock with empty parameters.\n+        ZonedDateTime shortenedRetentionUntil = ZonedDateTime.now(Time.UTC).plusDays(1).withNano(0);\n+        Retention expectedConfigWithShortenedPeriod =\n+            new Retention(RetentionMode.GOVERNANCE, shortenedRetentionUntil);\n+        client.setObjectRetention(\n+            SetObjectRetentionArgs.builder()\n+                .bucket(bucketName)\n+                .object(objectName)\n+                .config(expectedConfigWithShortenedPeriod)\n+                .bypassGovernanceMode(true)\n+                .build());\n+\n+        Retention updatedConfig =", "originalCommit": "04a93745efb2da6db1158c734fdd163a0e987be4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTE5MTg2Mg==", "url": "https://github.com/minio/minio-java/pull/938#discussion_r431191862", "bodyText": "You could fix object lock configuration comment overall. This comment will make confusion with {Get,Put}ObjectLockConfiguration", "author": "balamurugana", "createdAt": "2020-05-27T14:43:10Z", "path": "functional/FunctionalTest.java", "diffHunk": "@@ -3795,6 +3798,155 @@ public static void getDefaultRetention_test() throws Exception {\n     }\n   }\n \n+  /** Test: setObjectRetention(SetObjectRetentionArgs args). */\n+  public static void setObjectRetention_test1() throws Exception {\n+    String methodName = \"setObjectRetention(SetObjectRetentionArgs args)\";\n+    if (!mintEnv) {\n+      System.out.println(\"Test: \" + methodName);\n+    }\n+\n+    long startTime = System.currentTimeMillis();\n+    String bucketName = getRandomName();\n+    String objectName = getRandomName();\n+    try {\n+      client.makeBucket(MakeBucketArgs.builder().bucket(bucketName).objectLock(true).build());\n+      try {\n+        ZonedDateTime retentionUntil = ZonedDateTime.now(Time.UTC).plusDays(1).withNano(0);\n+        Retention expectedConfig = new Retention(RetentionMode.GOVERNANCE, retentionUntil);\n+\n+        try (final InputStream is = new ContentInputStream(1 * KB)) {\n+          PutObjectOptions options = new PutObjectOptions(1 * KB, -1);\n+          options.setContentType(customContentType);\n+          client.putObject(bucketName, objectName, is, options);\n+        }\n+\n+        client.setObjectRetention(\n+            SetObjectRetentionArgs.builder()\n+                .bucket(bucketName)\n+                .object(objectName)\n+                .config(expectedConfig)\n+                .build());\n+        // Set empty object lock configuration by setting bypassGovernanceMode as true\n+        Retention emptyConfig = new Retention();\n+        client.setObjectRetention(\n+            SetObjectRetentionArgs.builder()\n+                .bucket(bucketName)\n+                .object(objectName)\n+                .config(emptyConfig)\n+                .bypassGovernanceMode(true)\n+                .build());\n+\n+      } finally {\n+        client.removeObject(\n+            RemoveObjectArgs.builder().bucket(bucketName).object(objectName).build());\n+        client.removeBucket(RemoveBucketArgs.builder().bucket(bucketName).build());\n+      }\n+      mintSuccessLog(methodName, null, startTime);\n+    } catch (Exception e) {\n+      handleException(methodName, null, startTime, e);\n+    }\n+  }\n+\n+  /** Test: getObjectRetention(GetObjectRetentionArgs args). */\n+  public static void getObjectRetention_test1() throws Exception {\n+    String methodName = \"getObjectRetention(GetObjectRetentionArgs args)\";\n+    if (!mintEnv) {\n+      System.out.println(\"Test: with shortened retention period: \" + methodName);\n+    }\n+\n+    long startTime = System.currentTimeMillis();\n+    String bucketName = getRandomName();\n+    String objectName = getRandomName();\n+    try {\n+      client.makeBucket(MakeBucketArgs.builder().bucket(bucketName).objectLock(true).build());\n+      try {\n+        try (final InputStream is = new ContentInputStream(1 * KB)) {\n+          PutObjectOptions options = new PutObjectOptions(1 * KB, -1);\n+          options.setContentType(customContentType);\n+          client.putObject(bucketName, objectName, is, options);\n+        }\n+\n+        ZonedDateTime retentionUntil = ZonedDateTime.now(Time.UTC).plusDays(3).withNano(0);\n+        Retention expectedConfig = new Retention(RetentionMode.GOVERNANCE, retentionUntil);\n+        client.setObjectRetention(\n+            SetObjectRetentionArgs.builder()\n+                .bucket(bucketName)\n+                .object(objectName)\n+                .config(expectedConfig)\n+                .build());\n+\n+        Retention config =\n+            client.getObjectRetention(\n+                GetObjectRetentionArgs.builder().bucket(bucketName).object(objectName).build());\n+\n+        if (!(config.retainUntilDate().equals(expectedConfig.retainUntilDate()))\n+            || (config.mode() != expectedConfig.mode())) {\n+          throw new Exception(\n+              \"[FAILED] Expected: expected duration : \"\n+                  + expectedConfig.retainUntilDate()\n+                  + \", got: \"\n+                  + config.retainUntilDate()\n+                  + \" expected mode :\"\n+                  + expectedConfig.mode()\n+                  + \", got: \"\n+                  + config.mode());\n+        }\n+\n+        // You can perform operations on object versions that are locked in governance mode as if\n+        // they were unprotected if you have the s3:bypassGovernanceMode permission. These\n+        // operations include deleting an object version, shortening the retention period, or\n+        // removing the Object Lock by placing a new lock with empty parameters.\n+        ZonedDateTime shortenedRetentionUntil = ZonedDateTime.now(Time.UTC).plusDays(1).withNano(0);\n+        Retention expectedConfigWithShortenedPeriod =\n+            new Retention(RetentionMode.GOVERNANCE, shortenedRetentionUntil);\n+        client.setObjectRetention(\n+            SetObjectRetentionArgs.builder()\n+                .bucket(bucketName)\n+                .object(objectName)\n+                .config(expectedConfigWithShortenedPeriod)\n+                .bypassGovernanceMode(true)\n+                .build());\n+\n+        Retention updatedConfig =\n+            client.getObjectRetention(\n+                GetObjectRetentionArgs.builder().bucket(bucketName).object(objectName).build());\n+\n+        if (!(updatedConfig\n+                .retainUntilDate()\n+                .equals(expectedConfigWithShortenedPeriod.retainUntilDate()))\n+            || (updatedConfig.mode() != expectedConfigWithShortenedPeriod.mode())) {\n+          throw new Exception(\n+              \"[FAILED] Expected: expected duration : \"\n+                  + expectedConfigWithShortenedPeriod.retainUntilDate()\n+                  + \", got: \"\n+                  + updatedConfig.retainUntilDate()\n+                  + \" expected mode :\"\n+                  + expectedConfigWithShortenedPeriod.mode()\n+                  + \", got: \"\n+                  + updatedConfig.mode());\n+        }\n+\n+        // Set empty object lock configuration by setting bypassGovernanceMode as true", "originalCommit": "04a93745efb2da6db1158c734fdd163a0e987be4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTE5OTgyOQ==", "url": "https://github.com/minio/minio-java/pull/938#discussion_r431199829", "bodyText": "I don't think this long comment is useful. You could have // Check shortening retention until period", "author": "balamurugana", "createdAt": "2020-05-27T14:53:31Z", "path": "functional/FunctionalTest.java", "diffHunk": "@@ -3795,6 +3798,155 @@ public static void getDefaultRetention_test() throws Exception {\n     }\n   }\n \n+  /** Test: setObjectRetention(SetObjectRetentionArgs args). */\n+  public static void setObjectRetention_test1() throws Exception {\n+    String methodName = \"setObjectRetention(SetObjectRetentionArgs args)\";\n+    if (!mintEnv) {\n+      System.out.println(\"Test: \" + methodName);\n+    }\n+\n+    long startTime = System.currentTimeMillis();\n+    String bucketName = getRandomName();\n+    String objectName = getRandomName();\n+    try {\n+      client.makeBucket(MakeBucketArgs.builder().bucket(bucketName).objectLock(true).build());\n+      try {\n+        ZonedDateTime retentionUntil = ZonedDateTime.now(Time.UTC).plusDays(1).withNano(0);\n+        Retention expectedConfig = new Retention(RetentionMode.GOVERNANCE, retentionUntil);\n+\n+        try (final InputStream is = new ContentInputStream(1 * KB)) {\n+          PutObjectOptions options = new PutObjectOptions(1 * KB, -1);\n+          options.setContentType(customContentType);\n+          client.putObject(bucketName, objectName, is, options);\n+        }\n+\n+        client.setObjectRetention(\n+            SetObjectRetentionArgs.builder()\n+                .bucket(bucketName)\n+                .object(objectName)\n+                .config(expectedConfig)\n+                .build());\n+        // Set empty object lock configuration by setting bypassGovernanceMode as true\n+        Retention emptyConfig = new Retention();\n+        client.setObjectRetention(\n+            SetObjectRetentionArgs.builder()\n+                .bucket(bucketName)\n+                .object(objectName)\n+                .config(emptyConfig)\n+                .bypassGovernanceMode(true)\n+                .build());\n+\n+      } finally {\n+        client.removeObject(\n+            RemoveObjectArgs.builder().bucket(bucketName).object(objectName).build());\n+        client.removeBucket(RemoveBucketArgs.builder().bucket(bucketName).build());\n+      }\n+      mintSuccessLog(methodName, null, startTime);\n+    } catch (Exception e) {\n+      handleException(methodName, null, startTime, e);\n+    }\n+  }\n+\n+  /** Test: getObjectRetention(GetObjectRetentionArgs args). */\n+  public static void getObjectRetention_test1() throws Exception {\n+    String methodName = \"getObjectRetention(GetObjectRetentionArgs args)\";\n+    if (!mintEnv) {\n+      System.out.println(\"Test: with shortened retention period: \" + methodName);\n+    }\n+\n+    long startTime = System.currentTimeMillis();\n+    String bucketName = getRandomName();\n+    String objectName = getRandomName();\n+    try {\n+      client.makeBucket(MakeBucketArgs.builder().bucket(bucketName).objectLock(true).build());\n+      try {\n+        try (final InputStream is = new ContentInputStream(1 * KB)) {\n+          PutObjectOptions options = new PutObjectOptions(1 * KB, -1);\n+          options.setContentType(customContentType);\n+          client.putObject(bucketName, objectName, is, options);\n+        }\n+\n+        ZonedDateTime retentionUntil = ZonedDateTime.now(Time.UTC).plusDays(3).withNano(0);\n+        Retention expectedConfig = new Retention(RetentionMode.GOVERNANCE, retentionUntil);\n+        client.setObjectRetention(\n+            SetObjectRetentionArgs.builder()\n+                .bucket(bucketName)\n+                .object(objectName)\n+                .config(expectedConfig)\n+                .build());\n+\n+        Retention config =\n+            client.getObjectRetention(\n+                GetObjectRetentionArgs.builder().bucket(bucketName).object(objectName).build());\n+\n+        if (!(config.retainUntilDate().equals(expectedConfig.retainUntilDate()))\n+            || (config.mode() != expectedConfig.mode())) {\n+          throw new Exception(\n+              \"[FAILED] Expected: expected duration : \"\n+                  + expectedConfig.retainUntilDate()\n+                  + \", got: \"\n+                  + config.retainUntilDate()\n+                  + \" expected mode :\"\n+                  + expectedConfig.mode()\n+                  + \", got: \"\n+                  + config.mode());\n+        }\n+\n+        // You can perform operations on object versions that are locked in governance mode as if\n+        // they were unprotected if you have the s3:bypassGovernanceMode permission. These\n+        // operations include deleting an object version, shortening the retention period, or\n+        // removing the Object Lock by placing a new lock with empty parameters.", "originalCommit": "04a93745efb2da6db1158c734fdd163a0e987be4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "92d08641908f41c6a675a4d9c3016da62c6fa40c", "url": "https://github.com/minio/minio-java/commit/92d08641908f41c6a675a4d9c3016da62c6fa40c", "message": "Add withNano(0) to be S3 compatiable", "committedDate": "2020-05-27T15:06:30Z", "type": "commit"}, {"oid": "92d08641908f41c6a675a4d9c3016da62c6fa40c", "url": "https://github.com/minio/minio-java/commit/92d08641908f41c6a675a4d9c3016da62c6fa40c", "message": "Add withNano(0) to be S3 compatiable", "committedDate": "2020-05-27T15:06:30Z", "type": "forcePushed"}, {"oid": "b0a6af5420b63d5cb64ef6bb24988a1a5d9f2205", "url": "https://github.com/minio/minio-java/commit/b0a6af5420b63d5cb64ef6bb24988a1a5d9f2205", "message": "Address bala's comment", "committedDate": "2020-05-27T16:24:30Z", "type": "commit"}, {"oid": "b0a6af5420b63d5cb64ef6bb24988a1a5d9f2205", "url": "https://github.com/minio/minio-java/commit/b0a6af5420b63d5cb64ef6bb24988a1a5d9f2205", "message": "Address bala's comment", "committedDate": "2020-05-27T16:24:30Z", "type": "forcePushed"}]}