{"pr_number": 116, "pr_title": "#115 added removefirstpart with a test", "pr_createdAt": "2020-04-11T02:04:58Z", "pr_url": "https://github.com/artipie/http/pull/116", "timeline": [{"oid": "96bdfae701967ded4e64ae8a7a8fffa45ec7d6d2", "url": "https://github.com/artipie/http/commit/96bdfae701967ded4e64ae8a7a8fffa45ec7d6d2", "message": "#115 added removefirstpart with a test", "committedDate": "2020-04-11T02:04:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzIxODY0Mw==", "url": "https://github.com/artipie/http/pull/116#discussion_r407218643", "bodyText": "@ammaratef45 expand the description. We are removing initial part of the URI, not just some artificial first part. Add an example too.", "author": "Vatavuk", "createdAt": "2020-04-12T16:08:18Z", "path": "src/main/java/com/artipie/http/slice/RemoveFirstPart.java", "diffHunk": "@@ -0,0 +1,64 @@\n+/*\n+ * MIT License\n+ *\n+ * Copyright (c) 2020 Artipie\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included in all\n+ * copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n+ * SOFTWARE.\n+ */\n+package com.artipie.http.slice;\n+\n+import com.artipie.http.Response;\n+import com.artipie.http.Slice;\n+import java.nio.ByteBuffer;\n+import java.util.Map;\n+import org.apache.commons.lang3.ArrayUtils;\n+import org.reactivestreams.Publisher;\n+\n+/**\n+ * Slice that removes the first part from the request.", "originalCommit": "96bdfae701967ded4e64ae8a7a8fffa45ec7d6d2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzIxODg2OA==", "url": "https://github.com/artipie/http/pull/116#discussion_r407218868", "bodyText": "@ammaratef45 expand the test name. What is the test scenario?", "author": "Vatavuk", "createdAt": "2020-04-12T16:09:54Z", "path": "src/test/java/com/artipie/http/slice/RemoveFirstPartTest.java", "diffHunk": "@@ -0,0 +1,95 @@\n+/*\n+ * MIT License\n+ *\n+ * Copyright (c) 2020 Artipie\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included in all\n+ * copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n+ * SOFTWARE.\n+ */\n+package com.artipie.http.slice;\n+\n+import com.artipie.http.Response;\n+import com.artipie.http.Slice;\n+import com.artipie.http.rq.RequestLine;\n+import com.artipie.http.rs.RsStatus;\n+import com.artipie.http.rs.RsWithHeaders;\n+import com.artipie.http.rs.RsWithStatus;\n+import io.reactivex.Flowable;\n+import java.nio.ByteBuffer;\n+import java.util.Arrays;\n+import java.util.Map;\n+import java.util.concurrent.CompletableFuture;\n+import org.cactoos.map.MapEntry;\n+import org.hamcrest.MatcherAssert;\n+import org.hamcrest.core.IsEqual;\n+import org.junit.jupiter.api.Test;\n+import org.reactivestreams.Publisher;\n+\n+/**\n+ * Test case for {@link RemoveFirstPart}.\n+ * @since 0.8\n+ */\n+class RemoveFirstPartTest {\n+\n+    @Test\n+    void response() {", "originalCommit": "96bdfae701967ded4e64ae8a7a8fffa45ec7d6d2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzIxOTA1MA==", "url": "https://github.com/artipie/http/pull/116#discussion_r407219050", "bodyText": "@ammaratef45 let's rename it to just url to make it more readable.", "author": "Vatavuk", "createdAt": "2020-04-12T16:11:03Z", "path": "src/test/java/com/artipie/http/slice/RemoveFirstPartTest.java", "diffHunk": "@@ -0,0 +1,95 @@\n+/*\n+ * MIT License\n+ *\n+ * Copyright (c) 2020 Artipie\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included in all\n+ * copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n+ * SOFTWARE.\n+ */\n+package com.artipie.http.slice;\n+\n+import com.artipie.http.Response;\n+import com.artipie.http.Slice;\n+import com.artipie.http.rq.RequestLine;\n+import com.artipie.http.rs.RsStatus;\n+import com.artipie.http.rs.RsWithHeaders;\n+import com.artipie.http.rs.RsWithStatus;\n+import io.reactivex.Flowable;\n+import java.nio.ByteBuffer;\n+import java.util.Arrays;\n+import java.util.Map;\n+import java.util.concurrent.CompletableFuture;\n+import org.cactoos.map.MapEntry;\n+import org.hamcrest.MatcherAssert;\n+import org.hamcrest.core.IsEqual;\n+import org.junit.jupiter.api.Test;\n+import org.reactivestreams.Publisher;\n+\n+/**\n+ * Test case for {@link RemoveFirstPart}.\n+ * @since 0.8\n+ */\n+class RemoveFirstPartTest {\n+\n+    @Test\n+    void response() {\n+        final String allurl = get(\"http://www.w3.org/pub/WWW/TheProject.html\");", "originalCommit": "96bdfae701967ded4e64ae8a7a8fffa45ec7d6d2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzIxOTIzNQ==", "url": "https://github.com/artipie/http/pull/116#discussion_r407219235", "bodyText": "@ammaratef45 this method sounds like we are retrieving something from the server. Maybe we can rename it to something like requestLine. That would be much easier to understand.", "author": "Vatavuk", "createdAt": "2020-04-12T16:12:44Z", "path": "src/test/java/com/artipie/http/slice/RemoveFirstPartTest.java", "diffHunk": "@@ -0,0 +1,95 @@\n+/*\n+ * MIT License\n+ *\n+ * Copyright (c) 2020 Artipie\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included in all\n+ * copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n+ * SOFTWARE.\n+ */\n+package com.artipie.http.slice;\n+\n+import com.artipie.http.Response;\n+import com.artipie.http.Slice;\n+import com.artipie.http.rq.RequestLine;\n+import com.artipie.http.rs.RsStatus;\n+import com.artipie.http.rs.RsWithHeaders;\n+import com.artipie.http.rs.RsWithStatus;\n+import io.reactivex.Flowable;\n+import java.nio.ByteBuffer;\n+import java.util.Arrays;\n+import java.util.Map;\n+import java.util.concurrent.CompletableFuture;\n+import org.cactoos.map.MapEntry;\n+import org.hamcrest.MatcherAssert;\n+import org.hamcrest.core.IsEqual;\n+import org.junit.jupiter.api.Test;\n+import org.reactivestreams.Publisher;\n+\n+/**\n+ * Test case for {@link RemoveFirstPart}.\n+ * @since 0.8\n+ */\n+class RemoveFirstPartTest {\n+\n+    @Test\n+    void response() {\n+        final String allurl = get(\"http://www.w3.org/pub/WWW/TheProject.html\");\n+        final String partedurl = get(\"http://www.w3.org/WWW/TheProject.html\");\n+        new RemoveFirstPart(new LineSlice()).response(\n+            allurl,\n+            Arrays.asList(\n+                new MapEntry<>(\"Content-Length\", \"0\"),\n+                new MapEntry<>(\"Content-Type\", \"whatever\")\n+            ),\n+            Flowable.empty()\n+        ).send(\n+            (status, headers, body) -> {\n+                final String line = headers.iterator().next().getValue();\n+                MatcherAssert.assertThat(\n+                    \"url retrieved\",\n+                    line,\n+                    IsEqual.equalTo(partedurl)\n+                );\n+                return CompletableFuture.allOf();\n+            }\n+        );\n+    }\n+\n+    private static String get(final String path) {", "originalCommit": "96bdfae701967ded4e64ae8a7a8fffa45ec7d6d2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzIxOTMwMw==", "url": "https://github.com/artipie/http/pull/116#discussion_r407219303", "bodyText": "@ammaratef45 you can inline this variable.", "author": "Vatavuk", "createdAt": "2020-04-12T16:13:11Z", "path": "src/test/java/com/artipie/http/slice/RemoveFirstPartTest.java", "diffHunk": "@@ -0,0 +1,95 @@\n+/*\n+ * MIT License\n+ *\n+ * Copyright (c) 2020 Artipie\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included in all\n+ * copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n+ * SOFTWARE.\n+ */\n+package com.artipie.http.slice;\n+\n+import com.artipie.http.Response;\n+import com.artipie.http.Slice;\n+import com.artipie.http.rq.RequestLine;\n+import com.artipie.http.rs.RsStatus;\n+import com.artipie.http.rs.RsWithHeaders;\n+import com.artipie.http.rs.RsWithStatus;\n+import io.reactivex.Flowable;\n+import java.nio.ByteBuffer;\n+import java.util.Arrays;\n+import java.util.Map;\n+import java.util.concurrent.CompletableFuture;\n+import org.cactoos.map.MapEntry;\n+import org.hamcrest.MatcherAssert;\n+import org.hamcrest.core.IsEqual;\n+import org.junit.jupiter.api.Test;\n+import org.reactivestreams.Publisher;\n+\n+/**\n+ * Test case for {@link RemoveFirstPart}.\n+ * @since 0.8\n+ */\n+class RemoveFirstPartTest {\n+\n+    @Test\n+    void response() {\n+        final String allurl = get(\"http://www.w3.org/pub/WWW/TheProject.html\");\n+        final String partedurl = get(\"http://www.w3.org/WWW/TheProject.html\");", "originalCommit": "96bdfae701967ded4e64ae8a7a8fffa45ec7d6d2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzI0MjMxNA==", "url": "https://github.com/artipie/http/pull/116#discussion_r407242314", "bodyText": "@Vatavuk you mean not using the method get?", "author": "ammaratef45", "createdAt": "2020-04-12T19:29:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzIxOTMwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzM2MzQ3NQ==", "url": "https://github.com/artipie/http/pull/116#discussion_r407363475", "bodyText": "@ammaratef45  get method  can be used directly in assert part without extracting it to partedurl variable", "author": "Vatavuk", "createdAt": "2020-04-13T07:50:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzIxOTMwMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzIyMDM4OQ==", "url": "https://github.com/artipie/http/pull/116#discussion_r407220389", "bodyText": "@ammaratef45 the class name sound very strange and will not be obvious to other developers what to expect from such a class name. How about renaming it to HiddenRoutingSlice or NormalizedUriSlice or something like that. The intention of this class is to hide repository routing from repository implementations.  Its not easy to find appropriate naming here but let's try something different if you agree.", "author": "Vatavuk", "createdAt": "2020-04-12T16:21:44Z", "path": "src/main/java/com/artipie/http/slice/RemoveFirstPart.java", "diffHunk": "@@ -0,0 +1,64 @@\n+/*\n+ * MIT License\n+ *\n+ * Copyright (c) 2020 Artipie\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included in all\n+ * copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n+ * SOFTWARE.\n+ */\n+package com.artipie.http.slice;\n+\n+import com.artipie.http.Response;\n+import com.artipie.http.Slice;\n+import java.nio.ByteBuffer;\n+import java.util.Map;\n+import org.apache.commons.lang3.ArrayUtils;\n+import org.reactivestreams.Publisher;\n+\n+/**\n+ * Slice that removes the first part from the request.\n+ * @since 0.8\n+ */\n+public class RemoveFirstPart implements Slice {", "originalCommit": "96bdfae701967ded4e64ae8a7a8fffa45ec7d6d2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzI0MjEyOQ==", "url": "https://github.com/artipie/http/pull/116#discussion_r407242129", "bodyText": "@Vatavuk I was wondering about the name of the class too, HiddenRoutingSlice sounds good for me", "author": "ammaratef45", "createdAt": "2020-04-12T19:28:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzIyMDM4OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzIyMDc4Nw==", "url": "https://github.com/artipie/http/pull/116#discussion_r407220787", "bodyText": "@ammaratef45 I believe we can get IndexOutOfBoundsException here, we should add additional check.", "author": "Vatavuk", "createdAt": "2020-04-12T16:24:45Z", "path": "src/main/java/com/artipie/http/slice/RemoveFirstPart.java", "diffHunk": "@@ -0,0 +1,64 @@\n+/*\n+ * MIT License\n+ *\n+ * Copyright (c) 2020 Artipie\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included in all\n+ * copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n+ * SOFTWARE.\n+ */\n+package com.artipie.http.slice;\n+\n+import com.artipie.http.Response;\n+import com.artipie.http.Slice;\n+import java.nio.ByteBuffer;\n+import java.util.Map;\n+import org.apache.commons.lang3.ArrayUtils;\n+import org.reactivestreams.Publisher;\n+\n+/**\n+ * Slice that removes the first part from the request.\n+ * @since 0.8\n+ */\n+public class RemoveFirstPart implements Slice {\n+\n+    /**\n+     * Delegate slice.\n+     */\n+    private final Slice slice;\n+\n+    /**\n+     * Ctor.\n+     *\n+     * @param slice Slice.\n+     */\n+    public RemoveFirstPart(final Slice slice) {\n+        this.slice = slice;\n+    }\n+\n+    // @checkstyle DesignForExtensionCheck (1 line)\n+    @Override\n+    public Response response(\n+        final String line,\n+        final Iterable<Map.Entry<String, String>> headers,\n+        final Publisher<ByteBuffer> body\n+    ) {\n+        // @checkstyle MagicNumberCheck (1 line)\n+        final String newline = String.join(\"/\", ArrayUtils.remove(line.split(\"/\"), 3));", "originalCommit": "96bdfae701967ded4e64ae8a7a8fffa45ec7d6d2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzI0MjU2Mw==", "url": "https://github.com/artipie/http/pull/116#discussion_r407242563", "bodyText": "@Vatavuk do you thing making the function throws IndexOutOfBoundsException is enough?", "author": "ammaratef45", "createdAt": "2020-04-12T19:32:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzIyMDc4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzM2NDk3MQ==", "url": "https://github.com/artipie/http/pull/116#discussion_r407364971", "bodyText": "@ammaratef45 we should prevent this exception from happening. I believe we should ignore those lines which does not include the initial part of the uri path.", "author": "Vatavuk", "createdAt": "2020-04-13T07:55:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzIyMDc4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzM2NTIzMA==", "url": "https://github.com/artipie/http/pull/116#discussion_r407365230", "bodyText": "@ammaratef45 also add a test for that scenario", "author": "Vatavuk", "createdAt": "2020-04-13T07:55:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzIyMDc4Nw=="}], "type": "inlineReview"}, {"oid": "ac1cf9f5ad54ddce1b23e623433ea6cfa1124371", "url": "https://github.com/artipie/http/commit/ac1cf9f5ad54ddce1b23e623433ea6cfa1124371", "message": "#115 resolved review comments", "committedDate": "2020-04-12T19:34:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzM2NTY5Ng==", "url": "https://github.com/artipie/http/pull/116#discussion_r407365696", "bodyText": "@ammaratef45 let's rename it to removesInitialPartOfUri to be more explicit of what to expect of the test.", "author": "Vatavuk", "createdAt": "2020-04-13T07:57:22Z", "path": "src/test/java/com/artipie/http/slice/HiddenRoutingSliceTest.java", "diffHunk": "@@ -0,0 +1,95 @@\n+/*\n+ * MIT License\n+ *\n+ * Copyright (c) 2020 Artipie\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included in all\n+ * copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n+ * SOFTWARE.\n+ */\n+package com.artipie.http.slice;\n+\n+import com.artipie.http.Response;\n+import com.artipie.http.Slice;\n+import com.artipie.http.rq.RequestLine;\n+import com.artipie.http.rs.RsStatus;\n+import com.artipie.http.rs.RsWithHeaders;\n+import com.artipie.http.rs.RsWithStatus;\n+import io.reactivex.Flowable;\n+import java.nio.ByteBuffer;\n+import java.util.Arrays;\n+import java.util.Map;\n+import java.util.concurrent.CompletableFuture;\n+import org.cactoos.map.MapEntry;\n+import org.hamcrest.MatcherAssert;\n+import org.hamcrest.core.IsEqual;\n+import org.junit.jupiter.api.Test;\n+import org.reactivestreams.Publisher;\n+\n+/**\n+ * Test case for {@link HiddenRoutingSlice}.\n+ * @since 0.8\n+ */\n+class HiddenRoutingSliceTest {\n+\n+    @Test\n+    void isFirstPartRemoved() {", "originalCommit": "ac1cf9f5ad54ddce1b23e623433ea6cfa1124371", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "76b5d13d90b874d34539a6c3d7550e8c65971c47", "url": "https://github.com/artipie/http/commit/76b5d13d90b874d34539a6c3d7550e8c65971c47", "message": "#115 prevented indexoutofbounds exception", "committedDate": "2020-04-13T15:44:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODA2ODk1NQ==", "url": "https://github.com/artipie/http/pull/116#discussion_r408068955", "bodyText": "@ammaratef45 HTTP request line may contain both kinds: abosule URI and absolute path, see https://www.w3.org/Protocols/rfc2616/rfc2616-sec5.html#sec5.1.2\n\nRequest-URI    = \"*\" | absoluteURI | abs_path | authority\n\nSo it would be not correct to split it at 5 slash symbols, we need to parse it using URI class or something similar", "author": "g4s8", "createdAt": "2020-04-14T11:38:21Z", "path": "src/test/java/com/artipie/http/slice/HiddenRoutingSliceTest.java", "diffHunk": "@@ -0,0 +1,113 @@\n+/*\n+ * MIT License\n+ *\n+ * Copyright (c) 2020 Artipie\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included in all\n+ * copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n+ * SOFTWARE.\n+ */\n+package com.artipie.http.slice;\n+\n+import com.artipie.http.Response;\n+import com.artipie.http.Slice;\n+import com.artipie.http.rq.RequestLine;\n+import com.artipie.http.rs.RsStatus;\n+import com.artipie.http.rs.RsWithHeaders;\n+import com.artipie.http.rs.RsWithStatus;\n+import io.reactivex.Flowable;\n+import java.nio.ByteBuffer;\n+import java.util.Arrays;\n+import java.util.Map;\n+import java.util.concurrent.CompletableFuture;\n+import org.cactoos.map.MapEntry;\n+import org.hamcrest.MatcherAssert;\n+import org.hamcrest.core.IsEqual;\n+import org.junit.jupiter.api.Test;\n+import org.reactivestreams.Publisher;\n+\n+/**\n+ * Test case for {@link HiddenRoutingSlice}.\n+ * @since 0.8\n+ */\n+class HiddenRoutingSliceTest {\n+\n+    @Test\n+    void removesInitialPartOfUri() {\n+        new HiddenRoutingSlice(new LineSlice()).response(\n+            requestLine(\"http://www.w3.org/pub/WWW/TheProject.html\"),\n+            Arrays.asList(\n+                new MapEntry<>(\"Content-Length\", \"0\"),\n+                new MapEntry<>(\"Content-Type\", \"whatever\")\n+            ),\n+            Flowable.empty()\n+        ).send(\n+            (status, headers, body) -> {\n+                final String line = headers.iterator().next().getValue();\n+                MatcherAssert.assertThat(\n+                    \"url retrieved\",\n+                    line,\n+                    IsEqual.equalTo(requestLine(\"http://www.w3.org/WWW/TheProject.html\"))", "originalCommit": "76b5d13d90b874d34539a6c3d7550e8c65971c47", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODA2OTcwMw==", "url": "https://github.com/artipie/http/pull/116#discussion_r408069703", "bodyText": "@ammaratef45 it seems these headers are not needed for unit test", "author": "g4s8", "createdAt": "2020-04-14T11:39:47Z", "path": "src/test/java/com/artipie/http/slice/HiddenRoutingSliceTest.java", "diffHunk": "@@ -0,0 +1,113 @@\n+/*\n+ * MIT License\n+ *\n+ * Copyright (c) 2020 Artipie\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included in all\n+ * copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n+ * SOFTWARE.\n+ */\n+package com.artipie.http.slice;\n+\n+import com.artipie.http.Response;\n+import com.artipie.http.Slice;\n+import com.artipie.http.rq.RequestLine;\n+import com.artipie.http.rs.RsStatus;\n+import com.artipie.http.rs.RsWithHeaders;\n+import com.artipie.http.rs.RsWithStatus;\n+import io.reactivex.Flowable;\n+import java.nio.ByteBuffer;\n+import java.util.Arrays;\n+import java.util.Map;\n+import java.util.concurrent.CompletableFuture;\n+import org.cactoos.map.MapEntry;\n+import org.hamcrest.MatcherAssert;\n+import org.hamcrest.core.IsEqual;\n+import org.junit.jupiter.api.Test;\n+import org.reactivestreams.Publisher;\n+\n+/**\n+ * Test case for {@link HiddenRoutingSlice}.\n+ * @since 0.8\n+ */\n+class HiddenRoutingSliceTest {\n+\n+    @Test\n+    void removesInitialPartOfUri() {\n+        new HiddenRoutingSlice(new LineSlice()).response(\n+            requestLine(\"http://www.w3.org/pub/WWW/TheProject.html\"),\n+            Arrays.asList(\n+                new MapEntry<>(\"Content-Length\", \"0\"),", "originalCommit": "76b5d13d90b874d34539a6c3d7550e8c65971c47", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "8896eb39c2e5176e2268ca1cfa0c5fbac3e71347", "url": "https://github.com/artipie/http/commit/8896eb39c2e5176e2268ca1cfa0c5fbac3e71347", "message": "#115 added uri builder to handle path", "committedDate": "2020-04-17T22:13:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTEyMzE5MQ==", "url": "https://github.com/artipie/http/pull/116#discussion_r411123191", "bodyText": "@ammaratef45 you can mark the class as final to get rid of this warning", "author": "g4s8", "createdAt": "2020-04-20T06:25:28Z", "path": "src/main/java/com/artipie/http/slice/HiddenRoutingSlice.java", "diffHunk": "@@ -0,0 +1,82 @@\n+/*\n+ * MIT License\n+ *\n+ * Copyright (c) 2020 Artipie\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included in all\n+ * copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n+ * SOFTWARE.\n+ */\n+package com.artipie.http.slice;\n+\n+import com.artipie.http.Response;\n+import com.artipie.http.Slice;\n+import java.net.URI;\n+import java.net.URISyntaxException;\n+import java.nio.ByteBuffer;\n+import java.util.Map;\n+import org.apache.commons.lang3.ArrayUtils;\n+import org.apache.http.client.utils.URIBuilder;\n+import org.reactivestreams.Publisher;\n+\n+/**\n+ * Slice that removes the first part from the request URI.\n+ * for example `GET http://www.w3.org/pub/WWW/TheProject.html HTTP/1.1`\n+ * would be `GET http://www.w3.org/WWW/TheProject.html HTTP/1.1`\n+ *\n+ * @since 0.8\n+ */\n+public class HiddenRoutingSlice implements Slice {\n+\n+    /**\n+     * Delegate slice.\n+     */\n+    private final Slice slice;\n+\n+    /**\n+     * Ctor.\n+     *\n+     * @param slice Slice.\n+     */\n+    public HiddenRoutingSlice(final Slice slice) {\n+        this.slice = slice;\n+    }\n+\n+    // @checkstyle DesignForExtensionCheck (1 line)", "originalCommit": "8896eb39c2e5176e2268ca1cfa0c5fbac3e71347", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTEyNDU3OQ==", "url": "https://github.com/artipie/http/pull/116#discussion_r411124579", "bodyText": "@ammaratef45 can you add a test to verify that the absolute path works as well as absolute URI? E.g. request line GET /one/two/three HTTP/1.1 returns /two/three path?", "author": "g4s8", "createdAt": "2020-04-20T06:28:40Z", "path": "src/test/java/com/artipie/http/slice/HiddenRoutingSliceTest.java", "diffHunk": "@@ -0,0 +1,109 @@\n+/*\n+ * MIT License\n+ *\n+ * Copyright (c) 2020 Artipie\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included in all\n+ * copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n+ * SOFTWARE.\n+ */\n+package com.artipie.http.slice;\n+\n+import com.artipie.http.Response;\n+import com.artipie.http.Slice;\n+import com.artipie.http.rq.RequestLine;\n+import com.artipie.http.rs.RsStatus;\n+import com.artipie.http.rs.RsWithHeaders;\n+import com.artipie.http.rs.RsWithStatus;\n+import io.reactivex.Flowable;\n+import java.nio.ByteBuffer;\n+import java.util.Arrays;\n+import java.util.Map;\n+import java.util.concurrent.CompletableFuture;\n+import org.hamcrest.MatcherAssert;\n+import org.hamcrest.core.IsEqual;\n+import org.junit.jupiter.api.Test;\n+import org.reactivestreams.Publisher;\n+\n+/**\n+ * Test case for {@link HiddenRoutingSlice}.\n+ * @since 0.8\n+ */\n+class HiddenRoutingSliceTest {", "originalCommit": "8896eb39c2e5176e2268ca1cfa0c5fbac3e71347", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "c66f092737860b066d6453a6f97bc6b052890f8e", "url": "https://github.com/artipie/http/commit/c66f092737860b066d6453a6f97bc6b052890f8e", "message": "#115 added a test for absolute paths", "committedDate": "2020-04-20T15:16:19Z", "type": "commit"}, {"oid": "0d4d7e15541139445918ee89f6d1a7614859220a", "url": "https://github.com/artipie/http/commit/0d4d7e15541139445918ee89f6d1a7614859220a", "message": "#115 added a test for absolute paths", "committedDate": "2020-04-20T15:21:07Z", "type": "commit"}]}