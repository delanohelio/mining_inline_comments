{"pr_number": 290, "pr_title": "HH-122108 improve configuration validation", "pr_createdAt": "2020-12-29T08:00:12Z", "pr_url": "https://github.com/hhru/nuts-and-bolts/pull/290", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTYwOTY5NA==", "url": "https://github.com/hhru/nuts-and-bolts/pull/290#discussion_r549609694", "bodyText": "getNotEmptyFromConfig \u0438\u043b\u0438 \u0434\u0430\u0436\u0435 getNotEmpty?", "author": "pvorlov", "createdAt": "2020-12-29T08:09:49Z", "path": "nab-starter/src/main/java/ru/hh/nab/starter/ConsulService.java", "diffHunk": "@@ -118,6 +123,25 @@ public ConsulService(AgentClient agentClient, KeyValueClient kvClient,\n     }\n   }\n \n+  private int validateAndGetCacheWaitSeconds(FileSettings fileSettings, OkHttpClient httpClient) {\n+    int cacheWaitSeconds = fileSettings.getInteger(CONSUL_WEIGHT_CACHE_WATCH_INTERVAL_PROPERTY, 10);\n+    if (httpClient.readTimeoutMillis() <= TimeUnit.SECONDS.toMillis(cacheWaitSeconds)) {\n+      throw new IllegalStateException(CONSUL_WEIGHT_CACHE_WATCH_INTERVAL_PROPERTY\n+        + \" must be less than consul http read timeout=\" + httpClient.readTimeoutMillis() + \"ms. To adjust timeout use configuration key: \"\n+        + CONSUL_CLIENT_READ_TIMEOUT_PROPERTY + \")\"\n+      );\n+    }\n+    return cacheWaitSeconds;\n+  }\n+\n+  private String validateAndGetFromConfig(FileSettings fileSettings, String propertyKey) {", "originalCommit": "f04f420f1bd040ab7e56170f1d1ea4df522012a2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTYyNzQyMg==", "url": "https://github.com/hhru/nuts-and-bolts/pull/290#discussion_r549627422", "bodyText": "\u0416\u0435\u0441\u0442\u044c \u043a\u043e\u043d\u0435\u0447\u043d\u043e, \u043d\u043e \u043f\u043e \u0434\u0440\u0443\u0433\u043e\u043c\u0443 \u043d\u0435 \u0437\u043d\u0430\u044e \u043a\u0430\u043a \u0441\u0434\u0435\u043b\u0430\u0442\u044c, \u0442\u043e\u043b\u044c\u043a\u043e \u0435\u0441\u043b\u0438 \u043d\u0430\u0448 \u0444\u043e\u0440\u043a \u0440\u0430\u0441\u0448\u0438\u0440\u044f\u0442\u044c.", "author": "pvorlov", "createdAt": "2020-12-29T09:09:34Z", "path": "nab-starter/src/main/java/ru/hh/nab/starter/NabProdConfig.java", "diffHunk": "@@ -80,14 +83,25 @@ KeyValueClient keyValueClient(Consul consul) {\n     return consul.keyValueClient();\n   }\n \n+  @Bean\n+  OkHttpClient okHttpClient(Consul consul) {\n+    return Optional.ofNullable(ReflectionUtils.findField(Consul.class, \"okHttpClient\", OkHttpClient.class))", "originalCommit": "f04f420f1bd040ab7e56170f1d1ea4df522012a2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTYzMDQyMw==", "url": "https://github.com/hhru/nuts-and-bolts/pull/290#discussion_r549630423", "bodyText": "\u043f\u043e-\u0445\u043e\u0440\u043e\u0448\u0435\u043c\u0443 \u0438\u0437 \u0441\u0430\u043c\u043e\u0433\u043e \u043a\u043e\u043d\u0441\u0443\u043b\u0430 \u0431\u044b \u0432\u044b\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u044d\u0442\u0438 \u0442\u0430\u0439\u043c\u0430\u0443\u0442\u044b \u0438 \u043d\u0435 \u0441\u0432\u0435\u0442\u0438\u0442\u044c \u043d\u0430\u0440\u0443\u0436\u0443 \u044d\u0442\u043e\u0442 \u043e\u043a\u0445\u0442\u0442\u043f\n\u0430 \u0435\u0449\u0435 \u043b\u0443\u0447\u0448\u0435 \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432\u0430\u043b\u0438\u0434\u0430\u0446\u0438\u044e \u0432 \u043a\u044d\u0448, \u0447\u0442\u043e\u0431\u044b \u0435\u0433\u043e \u043d\u0435\u043b\u044c\u0437\u044f \u0431\u044b\u043b\u043e \u0437\u0430\u0432\u0435\u0441\u0442\u0438 \u043a\u0440\u0438\u0432\u043e\u0439\n\u043d\u043e \u0431\u043b\u0438\u043d - \u044d\u0442\u043e \u043d\u0430\u0434\u043e \u043f\u0440\u044f\u043c \u043b\u0435\u0437\u0442\u044c \u0432 \u043b\u0438\u0431\u0443. \u0447\u0435 \u0442 \u044f \u0445\u0437 \u043f\u043e\u043a\u0430", "author": "dzharikhin", "createdAt": "2020-12-29T09:18:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTYyNzQyMg=="}], "type": "inlineReview"}, {"oid": "2f5059972c510c823b6489954a632b6a14305944", "url": "https://github.com/hhru/nuts-and-bolts/commit/2f5059972c510c823b6489954a632b6a14305944", "message": "HH-122108 use newer and SHADED version of consul client", "committedDate": "2020-12-30T09:03:18Z", "type": "forcePushed"}, {"oid": "75ac6aefc12c5e0e2e40c6f7dda4f5e200a89bcc", "url": "https://github.com/hhru/nuts-and-bolts/commit/75ac6aefc12c5e0e2e40c6f7dda4f5e200a89bcc", "message": "HH-122108 prod version", "committedDate": "2021-01-12T08:52:28Z", "type": "forcePushed"}, {"oid": "c404db93a154771cc6dd6dbb8121962b7a98d5f9", "url": "https://github.com/hhru/nuts-and-bolts/commit/c404db93a154771cc6dd6dbb8121962b7a98d5f9", "message": "HH-122108 improved dependency management", "committedDate": "2021-01-13T13:13:57Z", "type": "forcePushed"}, {"oid": "d82b327f67d96d1dc14ff5e1f768e9edbde9e348", "url": "https://github.com/hhru/nuts-and-bolts/commit/d82b327f67d96d1dc14ff5e1f768e9edbde9e348", "message": "HH-122108 improve configuration validation", "committedDate": "2021-01-13T18:37:07Z", "type": "commit"}, {"oid": "5ca5c7aa4ecc23f29721de90d576cf6d03a29ade", "url": "https://github.com/hhru/nuts-and-bolts/commit/5ca5c7aa4ecc23f29721de90d576cf6d03a29ade", "message": "HH-122108 shorter method", "committedDate": "2021-01-13T18:37:07Z", "type": "commit"}, {"oid": "4799580e57f888b39aeb53e548e42a6fd1d33e72", "url": "https://github.com/hhru/nuts-and-bolts/commit/4799580e57f888b39aeb53e548e42a6fd1d33e72", "message": "HH-122108 use newer and SHADED version of consul client", "committedDate": "2021-01-13T18:37:07Z", "type": "commit"}, {"oid": "59b4175f14a7c77116c5dbd726e903e13e2eacdc", "url": "https://github.com/hhru/nuts-and-bolts/commit/59b4175f14a7c77116c5dbd726e903e13e2eacdc", "message": "HH-122108 prod version", "committedDate": "2021-01-13T18:37:07Z", "type": "commit"}, {"oid": "8af267f67c0fd4cad17014b507cf923c28e485e1", "url": "https://github.com/hhru/nuts-and-bolts/commit/8af267f67c0fd4cad17014b507cf923c28e485e1", "message": "HH-122108 improved dependency management", "committedDate": "2021-01-13T18:37:07Z", "type": "forcePushed"}, {"oid": "e426110bbf5b3588eaa17c16429790b4d31dd66b", "url": "https://github.com/hhru/nuts-and-bolts/commit/e426110bbf5b3588eaa17c16429790b4d31dd66b", "message": "HH-122108 improved dependency management", "committedDate": "2021-01-13T18:53:09Z", "type": "forcePushed"}, {"oid": "46f71b0efdee0f4df9bfd558aa27f13c461e71e7", "url": "https://github.com/hhru/nuts-and-bolts/commit/46f71b0efdee0f4df9bfd558aa27f13c461e71e7", "message": "HH-122108 improved dependency management", "committedDate": "2021-01-13T19:00:28Z", "type": "forcePushed"}, {"oid": "f35d375d6de653bba8e596cf3174a0e1d8d5b3eb", "url": "https://github.com/hhru/nuts-and-bolts/commit/f35d375d6de653bba8e596cf3174a0e1d8d5b3eb", "message": "HH-122108 up consul client version", "committedDate": "2021-01-14T12:43:21Z", "type": "forcePushed"}, {"oid": "2366262caa74715e3ea3f25fd3f3a6efea592ebd", "url": "https://github.com/hhru/nuts-and-bolts/commit/2366262caa74715e3ea3f25fd3f3a6efea592ebd", "message": "HH-122108 improved dependency management", "committedDate": "2021-01-14T21:13:32Z", "type": "commit"}, {"oid": "8d46bd96bd2ad6efc57c788e27be9514370b571f", "url": "https://github.com/hhru/nuts-and-bolts/commit/8d46bd96bd2ad6efc57c788e27be9514370b571f", "message": "HH-122108 up consul client version", "committedDate": "2021-01-14T21:13:32Z", "type": "commit"}, {"oid": "c0b85522ea62a7a047d1e46c16dc2fcb3bbce4a3", "url": "https://github.com/hhru/nuts-and-bolts/commit/c0b85522ea62a7a047d1e46c16dc2fcb3bbce4a3", "message": "HH-122108 readme up", "committedDate": "2021-01-14T21:14:00Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODE4NTU1MA==", "url": "https://github.com/hhru/nuts-and-bolts/pull/290#discussion_r558185550", "bodyText": "\u041c\u043e\u0436\u0435\u0442 \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 fileSettings?", "author": "heruv1m", "createdAt": "2021-01-15T10:10:27Z", "path": "nab-starter/src/main/java/ru/hh/nab/starter/ConsulService.java", "diffHunk": "@@ -118,6 +120,14 @@ public ConsulService(AgentClient agentClient, KeyValueClient kvClient,\n     }\n   }\n \n+  private String getNotEmpty(FileSettings fileSettings, String propertyKey) {", "originalCommit": "c0b85522ea62a7a047d1e46c16dc2fcb3bbce4a3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "c2ee2807b34bb609943a333979a465e6be6ab1ed", "url": "https://github.com/hhru/nuts-and-bolts/commit/c2ee2807b34bb609943a333979a465e6be6ab1ed", "message": "HH-122108 readme up", "committedDate": "2021-01-15T10:39:57Z", "type": "commit"}, {"oid": "0122605633d3198849714a23c204808482e80a41", "url": "https://github.com/hhru/nuts-and-bolts/commit/0122605633d3198849714a23c204808482e80a41", "message": "HH-122108 use bom for main framework dependencies to guagantee consistency", "committedDate": "2021-01-15T10:39:57Z", "type": "forcePushed"}, {"oid": "876c0691469f240bf59512d78d8043c5bf5579b2", "url": "https://github.com/hhru/nuts-and-bolts/commit/876c0691469f240bf59512d78d8043c5bf5579b2", "message": "HH-122108 use bom for main framework dependencies to guagantee consistency", "committedDate": "2021-01-15T11:38:52Z", "type": "commit"}, {"oid": "876c0691469f240bf59512d78d8043c5bf5579b2", "url": "https://github.com/hhru/nuts-and-bolts/commit/876c0691469f240bf59512d78d8043c5bf5579b2", "message": "HH-122108 use bom for main framework dependencies to guagantee consistency", "committedDate": "2021-01-15T11:38:52Z", "type": "forcePushed"}, {"oid": "41b4dbeca8fcb9e5e5c6bccfc873f03e4a59a429", "url": "https://github.com/hhru/nuts-and-bolts/commit/41b4dbeca8fcb9e5e5c6bccfc873f03e4a59a429", "message": "HH-122108 move not empty validation to util class", "committedDate": "2021-01-15T16:19:13Z", "type": "commit"}]}