{"pr_number": 230, "pr_title": "HH-105938 support X-HH-AcceptErrors header for custom exceptions", "pr_createdAt": "2020-03-23T09:00:35Z", "pr_url": "https://github.com/hhru/nuts-and-bolts/pull/230", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjMyMjQyNw==", "url": "https://github.com/hhru/nuts-and-bolts/pull/230#discussion_r396322427", "bodyText": "\u044d\u0442\u043e \u0433\u0434\u0435-\u0442\u043e \u0434\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442\u044c \u0441\u0442\u043e\u043f\u0443\u0434\u043e\u0432\u043e \u043a\u043e\u043d\u0441\u0442\u0430\u043d\u0442\u043e\u0439", "author": "dzharikhin", "createdAt": "2020-03-23T09:44:32Z", "path": "nab-starter/src/main/java/ru/hh/nab/starter/filters/ErrorAcceptFilter.java", "diffHunk": "@@ -0,0 +1,22 @@\n+package ru.hh.nab.starter.filters;\n+\n+import javax.ws.rs.container.ContainerRequestContext;\n+import javax.ws.rs.container.ContainerResponseContext;\n+import javax.ws.rs.container.ContainerResponseFilter;\n+import javax.ws.rs.ext.Provider;\n+import java.io.IOException;\n+import java.util.List;\n+\n+@Provider\n+public class ErrorAcceptFilter implements ContainerResponseFilter {\n+    @Override\n+    public void filter(ContainerRequestContext requestContext,\n+                       ContainerResponseContext responseContext) throws IOException {\n+        if (responseContext.getStatus() >= 400) {\n+            String AcceptErrors = requestContext.getHeaders().getFirst(\"X-HH-AcceptErrors\");\n+            if (AcceptErrors != null) {\n+                responseContext.getHeaders().replace(\"Content-Type\", List.of(AcceptErrors));", "originalCommit": "f2b27b946e0abf20c90c68068bcac60a6e8716dd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjMyMzQ4Nw==", "url": "https://github.com/hhru/nuts-and-bolts/pull/230#discussion_r396323487", "bodyText": "\u044d\u0442\u043e \u043d\u0443 \u043b\u0438\u0431\u043e RequestHeaders, \u043b\u0438\u0431\u043e \u0440\u0430\u0437 \u0443\u0436 \u0432\u0441\u0435-\u0442\u0430\u043a\u0438 \u043c\u044b \u0441\u0432\u044f\u0437\u044b\u0432\u0430\u0435\u043c jclient \u0438 nab, \u0442\u043e \u043c\u043e\u0436\u043d\u043e \u0432 jclient-common-api \u043e\u0431\u044a\u044f\u0432\u0438\u0442\u044c, \u0430 \u0432 \u0441\u0442\u0430\u0440\u0442\u0435\u0440 \u0431\u0430\u0445\u043d\u0443\u0442\u044c \u043e\u0442 jclient-common-api \u0437\u0430\u0432\u0438\u0441\u0438\u043c\u043e\u0441\u0442\u044c. \u0438 \u043e\u0442\u0442\u0443\u0434\u0430 \u0431\u0440\u0430\u0442\u044c. \u0432 \u043d\u0430\u0431\u0435 \u0435\u0449\u0435 \u043e\u0434\u0438\u043d \u0445\u0435\u0434\u0435\u0440 \u0442\u0430\u043a\u043e\u0439 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u043f\u0440\u043e outerTimeout - \u0435\u0433\u043e \u0442\u043e\u0436\u0435 \u043c\u043e\u0436\u043d\u043e \u0431\u0443\u0434\u0435\u0442 \u0442\u043e\u0433\u0434\u0430 \u0438\u0437 jclient'\u0430 \u0437\u0430\u0431\u0440\u0430\u0442\u044c", "author": "dzharikhin", "createdAt": "2020-03-23T09:46:23Z", "path": "nab-starter/src/main/java/ru/hh/nab/starter/filters/ErrorAcceptFilter.java", "diffHunk": "@@ -0,0 +1,22 @@\n+package ru.hh.nab.starter.filters;\n+\n+import javax.ws.rs.container.ContainerRequestContext;\n+import javax.ws.rs.container.ContainerResponseContext;\n+import javax.ws.rs.container.ContainerResponseFilter;\n+import javax.ws.rs.ext.Provider;\n+import java.io.IOException;\n+import java.util.List;\n+\n+@Provider\n+public class ErrorAcceptFilter implements ContainerResponseFilter {\n+    @Override\n+    public void filter(ContainerRequestContext requestContext,\n+                       ContainerResponseContext responseContext) throws IOException {\n+        if (responseContext.getStatus() >= 400) {\n+            String AcceptErrors = requestContext.getHeaders().getFirst(\"X-HH-AcceptErrors\");", "originalCommit": "f2b27b946e0abf20c90c68068bcac60a6e8716dd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjM2Mzc1NQ==", "url": "https://github.com/hhru/nuts-and-bolts/pull/230#discussion_r396363755", "bodyText": "\u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u043e\u0439 \u043d\u0430\u0447\u0438\u043d\u0430\u0435\u0442\u0441\u044f \u0441 \u043c\u0430\u043b\u0435\u043d\u044c\u043a\u043e\u0439 \u0431\u0443\u043a\u0432\u044b", "author": "kincajou", "createdAt": "2020-03-23T10:54:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjMyMzQ4Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjM2MzUwMw==", "url": "https://github.com/hhru/nuts-and-bolts/pull/230#discussion_r396363503", "bodyText": "\u043d\u0430 \u0433\u043b\u0430\u0437 \u0442\u0443\u0442 \u043d\u0435 \u043d\u0443\u0436\u0435\u043d \u043f\u0435\u0440\u0435\u043d\u043e\u0441 \u0441\u0442\u0440\u043e\u043a\u0438 \u0438 \u0432\u0441\u0435 \u0432\u043b\u0435\u0437\u0435\u0442 \u0432 150", "author": "kincajou", "createdAt": "2020-03-23T10:53:36Z", "path": "nab-starter/src/main/java/ru/hh/nab/starter/filters/ErrorAcceptFilter.java", "diffHunk": "@@ -0,0 +1,22 @@\n+package ru.hh.nab.starter.filters;\n+\n+import javax.ws.rs.container.ContainerRequestContext;\n+import javax.ws.rs.container.ContainerResponseContext;\n+import javax.ws.rs.container.ContainerResponseFilter;\n+import javax.ws.rs.ext.Provider;\n+import java.io.IOException;\n+import java.util.List;\n+\n+@Provider\n+public class ErrorAcceptFilter implements ContainerResponseFilter {\n+    @Override\n+    public void filter(ContainerRequestContext requestContext,\n+                       ContainerResponseContext responseContext) throws IOException {", "originalCommit": "f2b27b946e0abf20c90c68068bcac60a6e8716dd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTIzNDI1Mg==", "url": "https://github.com/hhru/nuts-and-bolts/pull/230#discussion_r399234252", "bodyText": "\u0447\u0442\u043e \u0437\u0430 \u0437\u0430\u043f\u044f\u0442\u0430\u044f? \u043e\u0442\u043a\u0443\u0434\u0430, \u0434\u043b\u044f \u0447\u0435\u0433\u043e? \u044d\u0442\u043e \u043d\u0430\u0448 \u0445\u0435\u0434\u0435\u0440 \u0438 \u043c\u044b \u0432\u0441\u0435 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u0438\u0440\u0443\u0435\u043c", "author": "dzharikhin", "createdAt": "2020-03-27T12:38:45Z", "path": "nab-starter/src/main/java/ru/hh/nab/starter/filters/ErrorAcceptFilter.java", "diffHunk": "@@ -0,0 +1,25 @@\n+package ru.hh.nab.starter.filters;\n+\n+import javax.ws.rs.container.ContainerRequestContext;\n+import javax.ws.rs.container.ContainerResponseContext;\n+import javax.ws.rs.container.ContainerResponseFilter;\n+import javax.ws.rs.ext.Provider;\n+import java.io.IOException;\n+import java.util.List;\n+\n+import static javax.ws.rs.core.HttpHeaders.CONTENT_TYPE;\n+import static ru.hh.jclient.common.HttpHeaderNames.X_HH_ACCEPT_ERRORS;\n+\n+@Provider\n+public class ErrorAcceptFilter implements ContainerResponseFilter {\n+    @Override\n+    public void filter(ContainerRequestContext requestContext, ContainerResponseContext responseContext) throws IOException {\n+        if (responseContext.getStatus() >= 400) {\n+            String acceptErrors = requestContext.getHeaders().getFirst(X_HH_ACCEPT_ERRORS);\n+            if (acceptErrors != null) {\n+                String[] mediatypes = acceptErrors.split(\",\");", "originalCommit": "6eed99b4478afc1ca542e90362e1cc9c41ede817", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTI1Mzc4Mg==", "url": "https://github.com/hhru/nuts-and-bolts/pull/230#discussion_r399253782", "bodyText": "\u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u044e \u0434\u043b\u044f \u044d\u0442\u043e\u0433\u043e \u0445\u044d\u0434\u0435\u0440\u0430 \u0442\u0443 \u0436\u0435 \u043b\u043e\u0433\u0438\u043a\u0443, \u0447\u0442\u043e \u0438 \u0434\u043b\u044f accept.\n\u0430 \u0442\u0430\u043c \u043c\u043e\u0436\u0435\u0442 \u043f\u0440\u0438\u043b\u0435\u0442\u0430\u0442\u044c \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u043c\u0435\u0434\u0438\u043f\u0442\u043f\u0439\u043f\u043e\u0432, \u0440\u0430\u0437\u0434\u0435\u043b\u0451\u043d\u043d\u044b\u0445 \u0437\u0430\u043f\u044f\u0442\u043e\u0439.\n\u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0435\u043d\u043d\u043e, \u043d\u0430 \u043f\u0440\u0438\u043d\u0438\u043c\u0430\u044e\u0449\u0435\u0439 \u0441\u0442\u043e\u0440\u043e\u043d\u0435 \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u044b\u043c \u0432\u044b\u0445\u043e\u0434\u043e\u043c \u0432\u0438\u0436\u0443 \u0442\u0443\u043f\u043e \u0432\u0437\u044f\u0442\u044c \u043f\u0435\u0440\u0432\u044b\u0439 \u0438\u0437 \u043c\u0435\u0434\u0438\u0430\u0442\u0430\u0439\u043f\u043e\u0432", "author": "Afftobus", "createdAt": "2020-03-27T13:13:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTIzNDI1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTI2MTY3OA==", "url": "https://github.com/hhru/nuts-and-bolts/pull/230#discussion_r399261678", "bodyText": "\u0442\u0430\u043a \u043c\u043e\u0436\u0435\u0442 \u0442\u043e\u0433\u0434\u0430 \u0432\u0441\u0435 \u0438 \u0441\u043a\u043b\u0430\u0434\u044b\u0432\u0430\u0442\u044c?)", "author": "dzharikhin", "createdAt": "2020-03-27T13:26:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTIzNDI1Mg=="}], "type": "inlineReview"}, {"oid": "8a55f33f25d96205f9e7bd4a6c137c1756a13616", "url": "https://github.com/hhru/nuts-and-bolts/commit/8a55f33f25d96205f9e7bd4a6c137c1756a13616", "message": "HH-105938 support X-HH-AcceptErrors header for custom exceptions", "committedDate": "2020-03-30T10:29:03Z", "type": "forcePushed"}, {"oid": "cc44af2e7e9d974b4f0356253bc20d043bd2884a", "url": "https://github.com/hhru/nuts-and-bolts/commit/cc44af2e7e9d974b4f0356253bc20d043bd2884a", "message": "HH-105938 support X-HH-AcceptErrors header for custom exceptions", "committedDate": "2020-03-31T09:33:03Z", "type": "commit"}, {"oid": "cc44af2e7e9d974b4f0356253bc20d043bd2884a", "url": "https://github.com/hhru/nuts-and-bolts/commit/cc44af2e7e9d974b4f0356253bc20d043bd2884a", "message": "HH-105938 support X-HH-AcceptErrors header for custom exceptions", "committedDate": "2020-03-31T09:33:03Z", "type": "forcePushed"}]}