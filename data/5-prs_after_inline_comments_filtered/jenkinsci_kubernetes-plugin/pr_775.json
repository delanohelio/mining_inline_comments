{"pr_number": 775, "pr_title": "[JENKINS-58223] Add directive generator for KubernetesDeclarativeAgent", "pr_createdAt": "2020-05-07T07:34:26Z", "pr_url": "https://github.com/jenkinsci/kubernetes-plugin/pull/775", "timeline": [{"oid": "c67865320a435b5903c49f287339344c62cdaa3a", "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/c67865320a435b5903c49f287339344c62cdaa3a", "message": "[JENKINS-58223] Add configuration UI for KubernetesDeclarativeAgent\n\nFix inline helps", "committedDate": "2020-05-07T07:33:38Z", "type": "commit"}, {"oid": "8d8a9109ae2998b8bc61299f2175c3fad26f91a9", "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/8d8a9109ae2998b8bc61299f2175c3fad26f91a9", "message": "Merge branch 'master' into JENKINS-58223", "committedDate": "2020-05-18T13:00:07Z", "type": "commit"}, {"oid": "737e8a723f1ab9c94e4953b873c9e782b9bc4fee", "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/737e8a723f1ab9c94e4953b873c9e782b9bc4fee", "message": "Fix spotbugs", "committedDate": "2020-05-18T13:48:05Z", "type": "commit"}, {"oid": "c78aa5973e679c286d56348b63c433523ea1b159", "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/c78aa5973e679c286d56348b63c433523ea1b159", "message": "Merge branch 'master' into JENKINS-58223", "committedDate": "2020-05-27T06:40:29Z", "type": "commit"}, {"oid": "f4114cb781f980996642b71abd5f400944ee8c36", "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/f4114cb781f980996642b71abd5f400944ee8c36", "message": "Merge branch 'master' into JENKINS-58223", "committedDate": "2020-06-15T08:50:10Z", "type": "commit"}, {"oid": "4512a29476e33ba14f410f6dc9f2f546c912e9de", "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/4512a29476e33ba14f410f6dc9f2f546c912e9de", "message": "Pick up fixed pipeline-model-definition", "committedDate": "2020-06-15T09:33:23Z", "type": "commit"}, {"oid": "7aa8947109b3cdd76dde46478f0091060a81b1c5", "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/7aa8947109b3cdd76dde46478f0091060a81b1c5", "message": "Merge branch 'master' into JENKINS-58223", "committedDate": "2020-06-15T12:46:59Z", "type": "commit"}, {"oid": "82d9965c2196489cd5540f8f9ba16bf9f5fdd8c9", "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/82d9965c2196489cd5540f8f9ba16bf9f5fdd8c9", "message": "Restore custom workspace", "committedDate": "2020-06-15T12:52:36Z", "type": "commit"}, {"oid": "0ce2a148b4c5909c73f1bccb510c940cc2d09949", "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/0ce2a148b4c5909c73f1bccb510c940cc2d09949", "message": "Add back docker-workflow since it we need it for tests", "committedDate": "2020-06-15T13:36:15Z", "type": "commit"}, {"oid": "c2be0407ef012064ab34a20355322d4ac5050539", "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/c2be0407ef012064ab34a20355322d4ac5050539", "message": "Cloud being deleted shouldn't trigger a warning", "committedDate": "2020-06-15T14:23:38Z", "type": "commit"}, {"oid": "ecec62165444516b15417f36ba8984dc7a945e0d", "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/ecec62165444516b15417f36ba8984dc7a945e0d", "message": "Add tests for directive generator", "committedDate": "2020-06-16T14:11:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDkxMzY4Mg==", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/775#discussion_r440913682", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        result.add(\"-- any --\", \"\");\n          \n          \n            \n                        result.add(\"\u2014any\u2014\", \"\");\n          \n      \n    \n    \n  \n\n?", "author": "jglick", "createdAt": "2020-06-16T14:52:36Z", "path": "src/main/java/org/csanchez/jenkins/plugins/kubernetes/pipeline/PodTemplateStep.java", "diffHunk": "@@ -384,6 +391,47 @@ public void setSupplementalGroups(@CheckForNull String supplementalGroups) {\n     @Extension\n     public static class DescriptorImpl extends StepDescriptor {\n \n+        static final String[] POD_TEMPLATE_FIELDS = {\"name\", \"namespace\", \"inheritFrom\", \"containers\", \"envVars\", \"volumes\", \"annotations\", \"yaml\", \"showRawYaml\", \"instanceCap\", \"podRetention\", \"supplementalGroups\", \"idleMinutes\", \"activeDeadlineSeconds\", \"serviceAccount\", \"nodeSelector\", \"workingDir\", \"workspaceVolume\"};\n+\n+        public DescriptorImpl() {\n+            for (String field : POD_TEMPLATE_FIELDS) {\n+                addHelpFileRedirect(field, PodTemplate.class, field);\n+            }\n+        }\n+\n+        @SuppressWarnings(\"unused\") // by stapler/jelly\n+        public ListBoxModel doFillCloudItems() {\n+            ListBoxModel result = new ListBoxModel();\n+            result.add(\"-- any --\", \"\");", "originalCommit": "ecec62165444516b15417f36ba8984dc7a945e0d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDkxNDEwOA==", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/775#discussion_r440914108", "bodyText": "similarly", "author": "jglick", "createdAt": "2020-06-16T14:53:09Z", "path": "src/main/java/org/csanchez/jenkins/plugins/kubernetes/pipeline/PodTemplateStep.java", "diffHunk": "@@ -384,6 +391,47 @@ public void setSupplementalGroups(@CheckForNull String supplementalGroups) {\n     @Extension\n     public static class DescriptorImpl extends StepDescriptor {\n \n+        static final String[] POD_TEMPLATE_FIELDS = {\"name\", \"namespace\", \"inheritFrom\", \"containers\", \"envVars\", \"volumes\", \"annotations\", \"yaml\", \"showRawYaml\", \"instanceCap\", \"podRetention\", \"supplementalGroups\", \"idleMinutes\", \"activeDeadlineSeconds\", \"serviceAccount\", \"nodeSelector\", \"workingDir\", \"workspaceVolume\"};\n+\n+        public DescriptorImpl() {\n+            for (String field : POD_TEMPLATE_FIELDS) {\n+                addHelpFileRedirect(field, PodTemplate.class, field);\n+            }\n+        }\n+\n+        @SuppressWarnings(\"unused\") // by stapler/jelly\n+        public ListBoxModel doFillCloudItems() {\n+            ListBoxModel result = new ListBoxModel();\n+            result.add(\"-- any --\", \"\");\n+            Jenkins.get().clouds\n+                    .getAll(KubernetesCloud.class)\n+                    .forEach(cloud -> result.add(cloud.name));\n+            return result;\n+        }\n+\n+        @SuppressWarnings(\"unused\") // by stapler/jelly\n+        public ListBoxModel doFillInheritFromItems(@QueryParameter(\"cloud\") String cloudName) {\n+            cloudName = Util.fixEmpty(cloudName);\n+            ListBoxModel result = new ListBoxModel();\n+            result.add(\"-- Default inheritance --\", \"<default>\");\n+            result.add(\"-- Disable inheritance --\", \" \");", "originalCommit": "ecec62165444516b15417f36ba8984dc7a945e0d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDkyMTYzMw==", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/775#discussion_r440921633", "bodyText": "Not really a unit test if using JenkinsRule.\nWould @ClassRule be appropriate?", "author": "jglick", "createdAt": "2020-06-16T15:02:28Z", "path": "src/test/java/org/csanchez/jenkins/plugins/kubernetes/pipeline/KubernetesDeclarativeAgentUnitTest.java", "diffHunk": "@@ -0,0 +1,90 @@\n+package org.csanchez.jenkins.plugins.kubernetes.pipeline;\n+\n+import org.csanchez.jenkins.plugins.kubernetes.pod.retention.Never;\n+import org.csanchez.jenkins.plugins.kubernetes.pod.yaml.Merge;\n+import org.csanchez.jenkins.plugins.kubernetes.volumes.workspace.DynamicPVCWorkspaceVolume;\n+import org.jenkinsci.plugins.pipeline.modeldefinition.generator.AgentDirective;\n+import org.jenkinsci.plugins.pipeline.modeldefinition.generator.DirectiveGeneratorTester;\n+import org.junit.Before;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.jvnet.hudson.test.JenkinsRule;\n+\n+import java.util.Collections;\n+import java.util.Map;\n+\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.equalTo;\n+import static org.hamcrest.Matchers.isA;\n+\n+public class KubernetesDeclarativeAgentUnitTest {\n+    @Rule\n+    public JenkinsRule j = new JenkinsRule();", "originalCommit": "ecec62165444516b15417f36ba8984dc7a945e0d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTUyODQ5Mg==", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/775#discussion_r441528492", "bodyText": "Yes, this is by opposition to KubernetesDeclarativeAgentTest which is performing builds, so need an actual Kubernetes environment. Can probably use @ClassRule here.", "author": "Vlatombe", "createdAt": "2020-06-17T13:05:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDkyMTYzMw=="}], "type": "inlineReview"}, {"oid": "d285c18b46ef7f812d3efa86be15eab131b5a6a3", "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/d285c18b46ef7f812d3efa86be15eab131b5a6a3", "message": "Update incrementals ref", "committedDate": "2020-06-17T10:58:22Z", "type": "commit"}, {"oid": "58333f48d34c332ccba3c2400b23b235ea49933e", "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/58333f48d34c332ccba3c2400b23b235ea49933e", "message": "tests jar should be test scoped.\n\nCo-authored-by: Jesse Glick <jglick@cloudbees.com>", "committedDate": "2020-06-17T11:56:14Z", "type": "commit"}, {"oid": "3de95e022e62634b2664ef05ac1e067a37c20d53", "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/3de95e022e62634b2664ef05ac1e067a37c20d53", "message": "Update labels with Jesse's suggestions", "committedDate": "2020-06-17T11:57:06Z", "type": "commit"}, {"oid": "8557d85b119a934ab4c58b2a7fb7361767d9f199", "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/8557d85b119a934ab4c58b2a7fb7361767d9f199", "message": "Apply suggestions from @jglick\n\nCo-authored-by: Jesse Glick <jglick@cloudbees.com>", "committedDate": "2020-06-17T13:03:53Z", "type": "commit"}, {"oid": "8d60df965074bd529cb4a8d24abb29aaedecb714", "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/8d60df965074bd529cb4a8d24abb29aaedecb714", "message": "Can use ClassRule for JenkinsRule in this class", "committedDate": "2020-06-17T13:09:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTY2MDQ3Nw==", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/775#discussion_r441660477", "bodyText": "FWIW I suggested\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        result.add(\"-any-\", \"\");\n          \n          \n            \n                        result.add(\"\u2014any\u2014\", \"\");\n          \n      \n    \n    \n  \n\nor whatever looks nice in your browser", "author": "jglick", "createdAt": "2020-06-17T16:06:50Z", "path": "src/main/java/org/csanchez/jenkins/plugins/kubernetes/pipeline/PodTemplateStep.java", "diffHunk": "@@ -402,7 +402,7 @@ public DescriptorImpl() {\n         @SuppressWarnings(\"unused\") // by stapler/jelly\n         public ListBoxModel doFillCloudItems() {\n             ListBoxModel result = new ListBoxModel();\n-            result.add(\"-- any --\", \"\");\n+            result.add(\"-any-\", \"\");", "originalCommit": "8d60df965074bd529cb4a8d24abb29aaedecb714", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjE4MjM4Ng==", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/775#discussion_r442182386", "bodyText": "Ah,I didn't see that it was a different character.", "author": "Vlatombe", "createdAt": "2020-06-18T12:18:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTY2MDQ3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjE4OTAyNA==", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/775#discussion_r442189024", "bodyText": "https://getitwriteonline.com/articles/en-dashes-em-dashes/ Didn't even know the en dash.", "author": "Vlatombe", "createdAt": "2020-06-18T12:30:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTY2MDQ3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjE5MzIxMw==", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/775#discussion_r442193213", "bodyText": "And let us not forget U+2015 HORIZONTAL BAR \u2015 which crops up a lot in Irish novels IIRC!", "author": "jglick", "createdAt": "2020-06-18T12:37:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTY2MDQ3Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTY2MDc1NQ==", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/775#discussion_r441660755", "bodyText": "similarly\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        result.add(\"-Default inheritance-\", \"<default>\");\n          \n          \n            \n                        result.add(\"-Disable inheritance-\", \" \");\n          \n          \n            \n                        result.add(\"\u2014Default inheritance\u2014\", \"<default>\");\n          \n          \n            \n                        result.add(\"\u2014Disable inheritance\u2014\", \" \");", "author": "jglick", "createdAt": "2020-06-17T16:07:21Z", "path": "src/main/java/org/csanchez/jenkins/plugins/kubernetes/pipeline/PodTemplateStep.java", "diffHunk": "@@ -413,8 +413,8 @@ public ListBoxModel doFillCloudItems() {\n         public ListBoxModel doFillInheritFromItems(@QueryParameter(\"cloud\") String cloudName) {\n             cloudName = Util.fixEmpty(cloudName);\n             ListBoxModel result = new ListBoxModel();\n-            result.add(\"-- Default inheritance --\", \"<default>\");\n-            result.add(\"-- Disable inheritance --\", \" \");\n+            result.add(\"-Default inheritance-\", \"<default>\");\n+            result.add(\"-Disable inheritance-\", \" \");", "originalCommit": "8d60df965074bd529cb4a8d24abb29aaedecb714", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e414f34ede93ccedebd599bd307f114f1a641c48", "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/e414f34ede93ccedebd599bd307f114f1a641c48", "message": "Use em dash suggested by @jglick\n\nCo-authored-by: Jesse Glick <jglick@cloudbees.com>", "committedDate": "2020-06-18T12:28:04Z", "type": "commit"}, {"oid": "6aa83a646982c73b49bd500e6f425e4f1a34c613", "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/6aa83a646982c73b49bd500e6f425e4f1a34c613", "message": "Merge branch 'master' into JENKINS-58223", "committedDate": "2020-06-19T06:48:56Z", "type": "commit"}, {"oid": "194aa6702d940b61afa6bd29d92f375436530811", "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/194aa6702d940b61afa6bd29d92f375436530811", "message": "Merge branch 'master' into JENKINS-58223", "committedDate": "2020-06-24T13:41:31Z", "type": "commit"}, {"oid": "cd921206324f958dd077a2be9ea1dc3dd20a6afa", "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/cd921206324f958dd077a2be9ea1dc3dd20a6afa", "message": "Update workflow-cps to use release.", "committedDate": "2020-07-02T08:02:20Z", "type": "commit"}, {"oid": "c8246905814a9cc4aed2a534476ea6934b38420f", "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/c8246905814a9cc4aed2a534476ea6934b38420f", "message": "Update pipeline-model-definition to 1.7.2", "committedDate": "2020-08-31T07:18:51Z", "type": "commit"}, {"oid": "674c6f029309d22791daef8bae3b8d8a3713c5e8", "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/674c6f029309d22791daef8bae3b8d8a3713c5e8", "message": "Merge branch 'master' into JENKINS-58223", "committedDate": "2020-08-31T07:19:55Z", "type": "commit"}]}