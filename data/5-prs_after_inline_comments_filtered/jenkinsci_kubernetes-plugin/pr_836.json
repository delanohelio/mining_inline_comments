{"pr_number": 836, "pr_title": "[JENKINS-63584] Add an option to use Jenkins proxy to access Kubernetes", "pr_createdAt": "2020-09-03T14:11:38Z", "pr_url": "https://github.com/jenkinsci/kubernetes-plugin/pull/836", "timeline": [{"oid": "7c4c2f70dc51f70e0829d500b1ac0993812fab41", "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/7c4c2f70dc51f70e0829d500b1ac0993812fab41", "message": "Merge pull request #1 from jenkinsci/master\n\nUpdate from master", "committedDate": "2020-09-03T07:45:05Z", "type": "commit"}, {"oid": "b4516c867b6c27b3cbef6d0395f7a9b0bf39d8e5", "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/b4516c867b6c27b3cbef6d0395f7a9b0bf39d8e5", "message": "[JENKINS-63584] Respect Jenkins Proxy settings", "committedDate": "2020-09-03T14:10:26Z", "type": "commit"}, {"oid": "7aeae728db12da91c93e1d2e5ed888121487fcdc", "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/7aeae728db12da91c93e1d2e5ed888121487fcdc", "message": "[JENKINS-63584] Use Jenkins Proxy settings only if cloud has it activated", "committedDate": "2020-09-03T15:20:12Z", "type": "commit"}, {"oid": "9a79c487973803835555f3a191e21e1c01ad51ed", "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/9a79c487973803835555f3a191e21e1c01ad51ed", "message": "[JENKINS-63584] useJenkinsProxy in Cloud config realy saved", "committedDate": "2020-09-04T06:41:36Z", "type": "commit"}, {"oid": "2df98b42e8773c4e0417a85a7aeba4c6fd284856", "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/2df98b42e8773c4e0417a85a7aeba4c6fd284856", "message": "[JENKINS-63584] better comment", "committedDate": "2020-09-04T06:46:50Z", "type": "commit"}, {"oid": "cefedbe74bf56ff3d2a578d3c649c7301ee89506", "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/cefedbe74bf56ff3d2a578d3c649c7301ee89506", "message": "[JENKINS-63584] HashCode modified for reloading clound config after config change", "committedDate": "2020-09-07T10:33:12Z", "type": "commit"}, {"oid": "806e2f4b31fcaf7ebfa4775dca7151f5a1084581", "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/806e2f4b31fcaf7ebfa4775dca7151f5a1084581", "message": "[JENKINS-63584] label enhanced", "committedDate": "2020-09-07T11:24:43Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTQxMDU1Nw==", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/836#discussion_r485410557", "bodyText": "Remove unused imports", "author": "Vlatombe", "createdAt": "2020-09-09T07:53:13Z", "path": "src/test/java/org/csanchez/jenkins/plugins/kubernetes/KubernetesFactoryAdapterTest.java", "diffHunk": "@@ -29,16 +29,19 @@\n import java.util.HashMap;\n import java.util.Map;\n \n+import jenkins.model.Jenkins;", "originalCommit": "806e2f4b31fcaf7ebfa4775dca7151f5a1084581", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTQxMDYzMg==", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/836#discussion_r485410632", "bodyText": "Ditto", "author": "Vlatombe", "createdAt": "2020-09-09T07:53:19Z", "path": "src/test/java/org/csanchez/jenkins/plugins/kubernetes/KubernetesFactoryAdapterTest.java", "diffHunk": "@@ -29,16 +29,19 @@\n import java.util.HashMap;\n import java.util.Map;\n \n+import jenkins.model.Jenkins;\n import org.junit.After;\n import org.junit.Before;\n import org.junit.Test;\n \n import static io.fabric8.kubernetes.client.Config.*;\n import io.fabric8.kubernetes.client.KubernetesClient;\n+import org.junit.runner.RunWith;", "originalCommit": "806e2f4b31fcaf7ebfa4775dca7151f5a1084581", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTQxMDc0Mg==", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/836#discussion_r485410742", "bodyText": "Revert", "author": "Vlatombe", "createdAt": "2020-09-09T07:53:30Z", "path": "src/test/java/org/csanchez/jenkins/plugins/kubernetes/KubernetesFactoryAdapterTest.java", "diffHunk": "@@ -29,16 +29,19 @@\n import java.util.HashMap;\n import java.util.Map;\n \n+import jenkins.model.Jenkins;\n import org.junit.After;\n import org.junit.Before;\n import org.junit.Test;\n \n import static io.fabric8.kubernetes.client.Config.*;\n import io.fabric8.kubernetes.client.KubernetesClient;\n+import org.junit.runner.RunWith;\n \n /**\n  * Test the creation of clients\n  */\n+", "originalCommit": "806e2f4b31fcaf7ebfa4775dca7151f5a1084581", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQ1MDAyMA==", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/836#discussion_r486450020", "bodyText": "class reverted", "author": "inidona", "createdAt": "2020-09-10T15:49:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTQxMDc0Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTQxMTA3Ng==", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/836#discussion_r485411076", "bodyText": "Not really.", "author": "Vlatombe", "createdAt": "2020-09-09T07:54:03Z", "path": "src/main/java/org/csanchez/jenkins/plugins/kubernetes/KubernetesFactoryAdapter.java", "diffHunk": "@@ -120,9 +124,38 @@ public KubernetesClient createClient() throws KubernetesAuthException {\n         }\n \n         LOGGER.log(FINE, \"Creating Kubernetes client: {0}\", this.toString());\n+        // JENKINS-63584 If Jenkins has an configured Proxy and cloud has enabled proxy usage pass the arguments to K8S\n+        LOGGER.log(FINE, \"Proxy Settings for Cloud: \" + useJenkinsProxy);\n+        if(useJenkinsProxy) {\n+            Jenkins jenkins = Jenkins.getInstanceOrNull(); // this code might run on slaves", "originalCommit": "806e2f4b31fcaf7ebfa4775dca7151f5a1084581", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQ1MDg0NA==", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/836#discussion_r486450844", "bodyText": "comment removed", "author": "inidona", "createdAt": "2020-09-10T15:50:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTQxMTA3Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTQxMTUwNQ==", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/836#discussion_r485411505", "bodyText": "Why this?", "author": "Vlatombe", "createdAt": "2020-09-09T07:54:43Z", "path": "src/main/java/org/csanchez/jenkins/plugins/kubernetes/KubernetesFactoryAdapter.java", "diffHunk": "@@ -120,9 +124,38 @@ public KubernetesClient createClient() throws KubernetesAuthException {\n         }\n \n         LOGGER.log(FINE, \"Creating Kubernetes client: {0}\", this.toString());\n+        // JENKINS-63584 If Jenkins has an configured Proxy and cloud has enabled proxy usage pass the arguments to K8S\n+        LOGGER.log(FINE, \"Proxy Settings for Cloud: \" + useJenkinsProxy);\n+        if(useJenkinsProxy) {\n+            Jenkins jenkins = Jenkins.getInstanceOrNull(); // this code might run on slaves\n+            LOGGER.log(FINE, \"Jenkins Instance: \" + jenkins);\n+            if (jenkins != null) {\n+                ProxyConfiguration p = jenkins.proxy;\n+                LOGGER.log(FINE,\"Proxy Instance: \" + p);\n+                if (p != null) {\n+                    builder.withWebsocketTimeout(10000);", "originalCommit": "806e2f4b31fcaf7ebfa4775dca7151f5a1084581", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1eb6f6d67da1e3757a28645685a17e68de485e60", "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/1eb6f6d67da1e3757a28645685a17e68de485e60", "message": "[JENKINS-63584] Review comments", "committedDate": "2020-09-09T08:27:45Z", "type": "commit"}]}