{"pr_number": 8508, "pr_title": "Fixes #8330, add class based sharding algorithm SPI.", "pr_createdAt": "2020-12-04T08:51:40Z", "pr_url": "https://github.com/apache/shardingsphere/pull/8508", "timeline": [{"oid": "9c943a385baa3cd434b3464ff2f85709e3bc2f9f", "url": "https://github.com/apache/shardingsphere/commit/9c943a385baa3cd434b3464ff2f85709e3bc2f9f", "message": "add class based sharding algorithm", "committedDate": "2020-12-02T10:55:54Z", "type": "commit"}, {"oid": "774617a8ab2f54734a2429013f172278acc04bc2", "url": "https://github.com/apache/shardingsphere/commit/774617a8ab2f54734a2429013f172278acc04bc2", "message": "Merge branch 'amaster' into dev-8330", "committedDate": "2020-12-02T11:20:34Z", "type": "commit"}, {"oid": "aeaf31caf398382626e516cf8e84407c4eff2e59", "url": "https://github.com/apache/shardingsphere/commit/aeaf31caf398382626e516cf8e84407c4eff2e59", "message": "For #8330, add test cases.", "committedDate": "2020-12-04T07:59:27Z", "type": "commit"}, {"oid": "333d82ae4911d0a2e23c2011037cdaeda1dffc26", "url": "https://github.com/apache/shardingsphere/commit/333d82ae4911d0a2e23c2011037cdaeda1dffc26", "message": "Merge branch 'master' into dev-8330", "committedDate": "2020-12-04T08:09:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTk0OTM2OA==", "url": "https://github.com/apache/shardingsphere/pull/8508#discussion_r535949368", "bodyText": "Please remove useless blank line", "author": "terrymanu", "createdAt": "2020-12-04T09:15:54Z", "path": "shardingsphere-features/shardingsphere-sharding/shardingsphere-sharding-common/src/main/java/org/apache/shardingsphere/sharding/algorithm/sharding/classbased/ClassBasedShardingAlgorithm.java", "diffHunk": "@@ -0,0 +1,113 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.shardingsphere.sharding.algorithm.sharding.classbased;\n+\n+import com.google.common.base.Preconditions;\n+import lombok.Getter;\n+import lombok.Setter;\n+import org.apache.shardingsphere.sharding.api.sharding.complex.ComplexKeysShardingAlgorithm;\n+import org.apache.shardingsphere.sharding.api.sharding.complex.ComplexKeysShardingValue;\n+import org.apache.shardingsphere.sharding.api.sharding.hint.HintShardingAlgorithm;\n+import org.apache.shardingsphere.sharding.api.sharding.hint.HintShardingValue;\n+import org.apache.shardingsphere.sharding.api.sharding.standard.PreciseShardingValue;\n+import org.apache.shardingsphere.sharding.api.sharding.standard.RangeShardingValue;\n+import org.apache.shardingsphere.sharding.api.sharding.standard.StandardShardingAlgorithm;\n+\n+import java.util.Collection;\n+import java.util.Objects;\n+import java.util.Properties;\n+\n+/**\n+ * Class based sharding algorithm.\n+ */\n+public class ClassBasedShardingAlgorithm implements StandardShardingAlgorithm<Comparable<?>>, ComplexKeysShardingAlgorithm<Comparable<?>>, HintShardingAlgorithm<Comparable<?>> {\n+\n+    private static final String STRATEGY_KEY = \"strategy\";\n+\n+    private static final String ALGORITHM_CLASS_NAME_KEY = \"algorithmClassName\";\n+\n+    private StandardShardingAlgorithm standardShardingAlgorithm;\n+\n+    private ComplexKeysShardingAlgorithm complexKeysShardingAlgorithm;\n+\n+    private HintShardingAlgorithm hintShardingAlgorithm;\n+\n+    @Getter\n+    private ClassBasedShardingAlgorithmStrategy strategy;\n+\n+    @Getter\n+    private String algorithmClassName;\n+\n+    @Getter\n+    @Setter\n+    private Properties props = new Properties();\n+\n+    @Override\n+    public void init() {\n+        String strategyStr = props.getProperty(STRATEGY_KEY);\n+        Preconditions.checkNotNull(strategyStr, \"The props`%s` cannot be null when uses class based sharding strategy.\", STRATEGY_KEY);\n+", "originalCommit": "333d82ae4911d0a2e23c2011037cdaeda1dffc26", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTk1MDI4OA==", "url": "https://github.com/apache/shardingsphere/pull/8508#discussion_r535950288", "bodyText": "strategyKey may better than strategyStr for variable name", "author": "terrymanu", "createdAt": "2020-12-04T09:17:15Z", "path": "shardingsphere-features/shardingsphere-sharding/shardingsphere-sharding-common/src/main/java/org/apache/shardingsphere/sharding/algorithm/sharding/classbased/ClassBasedShardingAlgorithm.java", "diffHunk": "@@ -0,0 +1,113 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.shardingsphere.sharding.algorithm.sharding.classbased;\n+\n+import com.google.common.base.Preconditions;\n+import lombok.Getter;\n+import lombok.Setter;\n+import org.apache.shardingsphere.sharding.api.sharding.complex.ComplexKeysShardingAlgorithm;\n+import org.apache.shardingsphere.sharding.api.sharding.complex.ComplexKeysShardingValue;\n+import org.apache.shardingsphere.sharding.api.sharding.hint.HintShardingAlgorithm;\n+import org.apache.shardingsphere.sharding.api.sharding.hint.HintShardingValue;\n+import org.apache.shardingsphere.sharding.api.sharding.standard.PreciseShardingValue;\n+import org.apache.shardingsphere.sharding.api.sharding.standard.RangeShardingValue;\n+import org.apache.shardingsphere.sharding.api.sharding.standard.StandardShardingAlgorithm;\n+\n+import java.util.Collection;\n+import java.util.Objects;\n+import java.util.Properties;\n+\n+/**\n+ * Class based sharding algorithm.\n+ */\n+public class ClassBasedShardingAlgorithm implements StandardShardingAlgorithm<Comparable<?>>, ComplexKeysShardingAlgorithm<Comparable<?>>, HintShardingAlgorithm<Comparable<?>> {\n+\n+    private static final String STRATEGY_KEY = \"strategy\";\n+\n+    private static final String ALGORITHM_CLASS_NAME_KEY = \"algorithmClassName\";\n+\n+    private StandardShardingAlgorithm standardShardingAlgorithm;\n+\n+    private ComplexKeysShardingAlgorithm complexKeysShardingAlgorithm;\n+\n+    private HintShardingAlgorithm hintShardingAlgorithm;\n+\n+    @Getter\n+    private ClassBasedShardingAlgorithmStrategy strategy;\n+\n+    @Getter\n+    private String algorithmClassName;\n+\n+    @Getter\n+    @Setter\n+    private Properties props = new Properties();\n+\n+    @Override\n+    public void init() {\n+        String strategyStr = props.getProperty(STRATEGY_KEY);", "originalCommit": "333d82ae4911d0a2e23c2011037cdaeda1dffc26", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTk3MTgxOQ==", "url": "https://github.com/apache/shardingsphere/pull/8508#discussion_r535971819", "bodyText": "Yes it is, thanks", "author": "RaigorJiang", "createdAt": "2020-12-04T09:49:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTk1MDI4OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTk1MjU4NQ==", "url": "https://github.com/apache/shardingsphere/pull/8508#discussion_r535952585", "bodyText": "There are ShardingStrategy and ShardingAlgorithm in current ShardingSphere,\nSo name of class ClassBasedShardingAlgorithmStrategy maybe not good enough.\nMaybe ClassBasedShardingAlgorithmType is better, what do you think?", "author": "terrymanu", "createdAt": "2020-12-04T09:20:58Z", "path": "shardingsphere-features/shardingsphere-sharding/shardingsphere-sharding-common/src/main/java/org/apache/shardingsphere/sharding/algorithm/sharding/classbased/ClassBasedShardingAlgorithmStrategy.java", "diffHunk": "@@ -0,0 +1,61 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.shardingsphere.sharding.algorithm.sharding.classbased;\n+\n+import lombok.Getter;\n+import lombok.RequiredArgsConstructor;\n+\n+/**\n+ * Class based sharding strategy.\n+ */\n+@RequiredArgsConstructor\n+@Getter\n+public enum ClassBasedShardingAlgorithmStrategy {", "originalCommit": "333d82ae4911d0a2e23c2011037cdaeda1dffc26", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTk3Njg5OQ==", "url": "https://github.com/apache/shardingsphere/pull/8508#discussion_r535976899", "bodyText": "I think it is not good enough too, but our props key is 'strategy', if the class named 'type', is it strange?", "author": "RaigorJiang", "createdAt": "2020-12-04T09:57:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTk1MjU4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTk5ODYwMw==", "url": "https://github.com/apache/shardingsphere/pull/8508#discussion_r535998603", "bodyText": "How about strategy_type?", "author": "terrymanu", "createdAt": "2020-12-04T10:31:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTk1MjU4NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTk1MzYwNw==", "url": "https://github.com/apache/shardingsphere/pull/8508#discussion_r535953607", "bodyText": "Please remove useless blank line", "author": "terrymanu", "createdAt": "2020-12-04T09:22:31Z", "path": "shardingsphere-features/shardingsphere-sharding/shardingsphere-sharding-common/src/main/java/org/apache/shardingsphere/sharding/algorithm/sharding/classbased/ClassBasedShardingAlgorithm.java", "diffHunk": "@@ -0,0 +1,113 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.shardingsphere.sharding.algorithm.sharding.classbased;\n+\n+import com.google.common.base.Preconditions;\n+import lombok.Getter;\n+import lombok.Setter;\n+import org.apache.shardingsphere.sharding.api.sharding.complex.ComplexKeysShardingAlgorithm;\n+import org.apache.shardingsphere.sharding.api.sharding.complex.ComplexKeysShardingValue;\n+import org.apache.shardingsphere.sharding.api.sharding.hint.HintShardingAlgorithm;\n+import org.apache.shardingsphere.sharding.api.sharding.hint.HintShardingValue;\n+import org.apache.shardingsphere.sharding.api.sharding.standard.PreciseShardingValue;\n+import org.apache.shardingsphere.sharding.api.sharding.standard.RangeShardingValue;\n+import org.apache.shardingsphere.sharding.api.sharding.standard.StandardShardingAlgorithm;\n+\n+import java.util.Collection;\n+import java.util.Objects;\n+import java.util.Properties;\n+\n+/**\n+ * Class based sharding algorithm.\n+ */\n+public class ClassBasedShardingAlgorithm implements StandardShardingAlgorithm<Comparable<?>>, ComplexKeysShardingAlgorithm<Comparable<?>>, HintShardingAlgorithm<Comparable<?>> {\n+\n+    private static final String STRATEGY_KEY = \"strategy\";\n+\n+    private static final String ALGORITHM_CLASS_NAME_KEY = \"algorithmClassName\";\n+\n+    private StandardShardingAlgorithm standardShardingAlgorithm;\n+\n+    private ComplexKeysShardingAlgorithm complexKeysShardingAlgorithm;\n+\n+    private HintShardingAlgorithm hintShardingAlgorithm;\n+\n+    @Getter\n+    private ClassBasedShardingAlgorithmStrategy strategy;\n+\n+    @Getter\n+    private String algorithmClassName;\n+\n+    @Getter\n+    @Setter\n+    private Properties props = new Properties();\n+\n+    @Override\n+    public void init() {\n+        String strategyStr = props.getProperty(STRATEGY_KEY);\n+        Preconditions.checkNotNull(strategyStr, \"The props`%s` cannot be null when uses class based sharding strategy.\", STRATEGY_KEY);\n+\n+        strategy = ClassBasedShardingAlgorithmStrategy.valueFrom(strategyStr.trim());\n+        Preconditions.checkArgument(Objects.nonNull(strategy), \"Unknown class based sharding strategy %s.\", strategy);\n+", "originalCommit": "333d82ae4911d0a2e23c2011037cdaeda1dffc26", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTk1NDYzMQ==", "url": "https://github.com/apache/shardingsphere/pull/8508#discussion_r535954631", "bodyText": "Please remove useless blank line", "author": "terrymanu", "createdAt": "2020-12-04T09:24:06Z", "path": "shardingsphere-features/shardingsphere-sharding/shardingsphere-sharding-common/src/main/java/org/apache/shardingsphere/sharding/algorithm/sharding/classbased/ClassBasedShardingAlgorithm.java", "diffHunk": "@@ -0,0 +1,113 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.shardingsphere.sharding.algorithm.sharding.classbased;\n+\n+import com.google.common.base.Preconditions;\n+import lombok.Getter;\n+import lombok.Setter;\n+import org.apache.shardingsphere.sharding.api.sharding.complex.ComplexKeysShardingAlgorithm;\n+import org.apache.shardingsphere.sharding.api.sharding.complex.ComplexKeysShardingValue;\n+import org.apache.shardingsphere.sharding.api.sharding.hint.HintShardingAlgorithm;\n+import org.apache.shardingsphere.sharding.api.sharding.hint.HintShardingValue;\n+import org.apache.shardingsphere.sharding.api.sharding.standard.PreciseShardingValue;\n+import org.apache.shardingsphere.sharding.api.sharding.standard.RangeShardingValue;\n+import org.apache.shardingsphere.sharding.api.sharding.standard.StandardShardingAlgorithm;\n+\n+import java.util.Collection;\n+import java.util.Objects;\n+import java.util.Properties;\n+\n+/**\n+ * Class based sharding algorithm.\n+ */\n+public class ClassBasedShardingAlgorithm implements StandardShardingAlgorithm<Comparable<?>>, ComplexKeysShardingAlgorithm<Comparable<?>>, HintShardingAlgorithm<Comparable<?>> {\n+\n+    private static final String STRATEGY_KEY = \"strategy\";\n+\n+    private static final String ALGORITHM_CLASS_NAME_KEY = \"algorithmClassName\";\n+\n+    private StandardShardingAlgorithm standardShardingAlgorithm;\n+\n+    private ComplexKeysShardingAlgorithm complexKeysShardingAlgorithm;\n+\n+    private HintShardingAlgorithm hintShardingAlgorithm;\n+\n+    @Getter\n+    private ClassBasedShardingAlgorithmStrategy strategy;\n+\n+    @Getter\n+    private String algorithmClassName;\n+\n+    @Getter\n+    @Setter\n+    private Properties props = new Properties();\n+\n+    @Override\n+    public void init() {\n+        String strategyStr = props.getProperty(STRATEGY_KEY);\n+        Preconditions.checkNotNull(strategyStr, \"The props`%s` cannot be null when uses class based sharding strategy.\", STRATEGY_KEY);\n+\n+        strategy = ClassBasedShardingAlgorithmStrategy.valueFrom(strategyStr.trim());\n+        Preconditions.checkArgument(Objects.nonNull(strategy), \"Unknown class based sharding strategy %s.\", strategy);\n+\n+        algorithmClassName = props.getProperty(ALGORITHM_CLASS_NAME_KEY);\n+        Preconditions.checkNotNull(algorithmClassName, \"The props `%s` cannot be null when uses class based sharding strategy.\", ALGORITHM_CLASS_NAME_KEY);\n+", "originalCommit": "333d82ae4911d0a2e23c2011037cdaeda1dffc26", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTk1NTE2NQ==", "url": "https://github.com/apache/shardingsphere/pull/8508#discussion_r535955165", "bodyText": "Switch case may better than multiple if statements", "author": "terrymanu", "createdAt": "2020-12-04T09:24:54Z", "path": "shardingsphere-features/shardingsphere-sharding/shardingsphere-sharding-common/src/main/java/org/apache/shardingsphere/sharding/algorithm/sharding/classbased/ClassBasedShardingAlgorithm.java", "diffHunk": "@@ -0,0 +1,113 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.shardingsphere.sharding.algorithm.sharding.classbased;\n+\n+import com.google.common.base.Preconditions;\n+import lombok.Getter;\n+import lombok.Setter;\n+import org.apache.shardingsphere.sharding.api.sharding.complex.ComplexKeysShardingAlgorithm;\n+import org.apache.shardingsphere.sharding.api.sharding.complex.ComplexKeysShardingValue;\n+import org.apache.shardingsphere.sharding.api.sharding.hint.HintShardingAlgorithm;\n+import org.apache.shardingsphere.sharding.api.sharding.hint.HintShardingValue;\n+import org.apache.shardingsphere.sharding.api.sharding.standard.PreciseShardingValue;\n+import org.apache.shardingsphere.sharding.api.sharding.standard.RangeShardingValue;\n+import org.apache.shardingsphere.sharding.api.sharding.standard.StandardShardingAlgorithm;\n+\n+import java.util.Collection;\n+import java.util.Objects;\n+import java.util.Properties;\n+\n+/**\n+ * Class based sharding algorithm.\n+ */\n+public class ClassBasedShardingAlgorithm implements StandardShardingAlgorithm<Comparable<?>>, ComplexKeysShardingAlgorithm<Comparable<?>>, HintShardingAlgorithm<Comparable<?>> {\n+\n+    private static final String STRATEGY_KEY = \"strategy\";\n+\n+    private static final String ALGORITHM_CLASS_NAME_KEY = \"algorithmClassName\";\n+\n+    private StandardShardingAlgorithm standardShardingAlgorithm;\n+\n+    private ComplexKeysShardingAlgorithm complexKeysShardingAlgorithm;\n+\n+    private HintShardingAlgorithm hintShardingAlgorithm;\n+\n+    @Getter\n+    private ClassBasedShardingAlgorithmStrategy strategy;\n+\n+    @Getter\n+    private String algorithmClassName;\n+\n+    @Getter\n+    @Setter\n+    private Properties props = new Properties();\n+\n+    @Override\n+    public void init() {\n+        String strategyStr = props.getProperty(STRATEGY_KEY);\n+        Preconditions.checkNotNull(strategyStr, \"The props`%s` cannot be null when uses class based sharding strategy.\", STRATEGY_KEY);\n+\n+        strategy = ClassBasedShardingAlgorithmStrategy.valueFrom(strategyStr.trim());\n+        Preconditions.checkArgument(Objects.nonNull(strategy), \"Unknown class based sharding strategy %s.\", strategy);\n+\n+        algorithmClassName = props.getProperty(ALGORITHM_CLASS_NAME_KEY);\n+        Preconditions.checkNotNull(algorithmClassName, \"The props `%s` cannot be null when uses class based sharding strategy.\", ALGORITHM_CLASS_NAME_KEY);\n+\n+        createAlgorithmInstance(strategy, algorithmClassName);\n+    }\n+\n+    private void createAlgorithmInstance(final ClassBasedShardingAlgorithmStrategy classBasedShardingAlgorithmStrategy, final String algorithmClassName) {\n+        if (ClassBasedShardingAlgorithmStrategy.STANDARD == classBasedShardingAlgorithmStrategy) {", "originalCommit": "333d82ae4911d0a2e23c2011037cdaeda1dffc26", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTk1OTk0MA==", "url": "https://github.com/apache/shardingsphere/pull/8508#discussion_r535959940", "bodyText": "Class can be final if not for extend", "author": "terrymanu", "createdAt": "2020-12-04T09:32:09Z", "path": "shardingsphere-features/shardingsphere-sharding/shardingsphere-sharding-common/src/main/java/org/apache/shardingsphere/sharding/algorithm/sharding/classbased/ClassBasedShardingAlgorithmFactory.java", "diffHunk": "@@ -0,0 +1,50 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.shardingsphere.sharding.algorithm.sharding.classbased;\n+\n+import lombok.AccessLevel;\n+import lombok.NoArgsConstructor;\n+import lombok.SneakyThrows;\n+import org.apache.shardingsphere.infra.exception.ShardingSphereException;\n+import org.apache.shardingsphere.sharding.spi.ShardingAlgorithm;\n+\n+/**\n+ * ShardingSphere class based algorithm factory.\n+ */\n+@NoArgsConstructor(access = AccessLevel.PRIVATE)\n+public class ClassBasedShardingAlgorithmFactory {", "originalCommit": "333d82ae4911d0a2e23c2011037cdaeda1dffc26", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTk2MDY1MA==", "url": "https://github.com/apache/shardingsphere/pull/8508#discussion_r535960650", "bodyText": "Value may instead of enum.name()", "author": "terrymanu", "createdAt": "2020-12-04T09:33:03Z", "path": "shardingsphere-features/shardingsphere-sharding/shardingsphere-sharding-common/src/main/java/org/apache/shardingsphere/sharding/algorithm/sharding/classbased/ClassBasedShardingAlgorithmStrategy.java", "diffHunk": "@@ -0,0 +1,61 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.shardingsphere.sharding.algorithm.sharding.classbased;\n+\n+import lombok.Getter;\n+import lombok.RequiredArgsConstructor;\n+\n+/**\n+ * Class based sharding strategy.\n+ */\n+@RequiredArgsConstructor\n+@Getter\n+public enum ClassBasedShardingAlgorithmStrategy {\n+\n+    /**\n+     * The sharding strategy is standard.\n+     */\n+    STANDARD(\"standard\"),\n+\n+    /**\n+     * The sharding strategy is complex.\n+     */\n+    COMPLEX(\"complex\"),\n+\n+    /**\n+     * The sharding strategy is hint.\n+     */\n+    HINT(\"hint\");\n+\n+    private final String value;", "originalCommit": "333d82ae4911d0a2e23c2011037cdaeda1dffc26", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTk2MDk5NQ==", "url": "https://github.com/apache/shardingsphere/pull/8508#discussion_r535960995", "bodyText": "@return javadoc should not upper case for first letter", "author": "terrymanu", "createdAt": "2020-12-04T09:33:36Z", "path": "shardingsphere-features/shardingsphere-sharding/shardingsphere-sharding-common/src/main/java/org/apache/shardingsphere/sharding/algorithm/sharding/classbased/ClassBasedShardingAlgorithmStrategy.java", "diffHunk": "@@ -0,0 +1,61 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.shardingsphere.sharding.algorithm.sharding.classbased;\n+\n+import lombok.Getter;\n+import lombok.RequiredArgsConstructor;\n+\n+/**\n+ * Class based sharding strategy.\n+ */\n+@RequiredArgsConstructor\n+@Getter\n+public enum ClassBasedShardingAlgorithmStrategy {\n+\n+    /**\n+     * The sharding strategy is standard.\n+     */\n+    STANDARD(\"standard\"),\n+\n+    /**\n+     * The sharding strategy is complex.\n+     */\n+    COMPLEX(\"complex\"),\n+\n+    /**\n+     * The sharding strategy is hint.\n+     */\n+    HINT(\"hint\");\n+\n+    private final String value;\n+\n+    /**\n+     * Value of Class based sharding strategy.\n+     *\n+     * @param value value\n+     * @return Class based sharding strategy", "originalCommit": "333d82ae4911d0a2e23c2011037cdaeda1dffc26", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTk2MTMzNw==", "url": "https://github.com/apache/shardingsphere/pull/8508#discussion_r535961337", "bodyText": "Class can be final if not for extend", "author": "terrymanu", "createdAt": "2020-12-04T09:34:09Z", "path": "shardingsphere-features/shardingsphere-sharding/shardingsphere-sharding-common/src/test/java/org/apache/shardingsphere/sharding/algorithm/sharding/classbased/ClassBasedShardingAlgorithmTest.java", "diffHunk": "@@ -0,0 +1,135 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.shardingsphere.sharding.algorithm.sharding.classbased;\n+\n+import com.google.common.collect.Lists;\n+import com.google.common.collect.Range;\n+import org.apache.shardingsphere.infra.exception.ShardingSphereException;\n+import org.apache.shardingsphere.sharding.api.sharding.complex.ComplexKeysShardingValue;\n+import org.apache.shardingsphere.sharding.api.sharding.hint.HintShardingValue;\n+import org.apache.shardingsphere.sharding.api.sharding.standard.PreciseShardingValue;\n+import org.apache.shardingsphere.sharding.api.sharding.standard.RangeShardingValue;\n+import org.apache.shardingsphere.sharding.fixture.ClassBasedComplexKeysShardingAlgorithmFixture;\n+import org.apache.shardingsphere.sharding.fixture.ClassBasedHintShardingAlgorithmFixture;\n+import org.apache.shardingsphere.sharding.fixture.ClassBasedStandardShardingAlgorithmFixture;\n+import org.junit.Test;\n+\n+import java.util.Collection;\n+import java.util.List;\n+\n+import static org.hamcrest.CoreMatchers.is;\n+import static org.junit.Assert.assertThat;\n+\n+public class ClassBasedShardingAlgorithmTest {", "originalCommit": "333d82ae4911d0a2e23c2011037cdaeda1dffc26", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTk2MTUwOA==", "url": "https://github.com/apache/shardingsphere/pull/8508#discussion_r535961508", "bodyText": "Class can be final if not for extend", "author": "terrymanu", "createdAt": "2020-12-04T09:34:21Z", "path": "shardingsphere-features/shardingsphere-sharding/shardingsphere-sharding-common/src/test/java/org/apache/shardingsphere/sharding/fixture/ClassBasedComplexKeysShardingAlgorithmFixture.java", "diffHunk": "@@ -0,0 +1,40 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.shardingsphere.sharding.fixture;\n+\n+import org.apache.shardingsphere.sharding.api.sharding.complex.ComplexKeysShardingAlgorithm;\n+import org.apache.shardingsphere.sharding.api.sharding.complex.ComplexKeysShardingValue;\n+\n+import java.util.Collection;\n+\n+public class ClassBasedComplexKeysShardingAlgorithmFixture implements ComplexKeysShardingAlgorithm<Integer> {", "originalCommit": "333d82ae4911d0a2e23c2011037cdaeda1dffc26", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTk2MTY4NQ==", "url": "https://github.com/apache/shardingsphere/pull/8508#discussion_r535961685", "bodyText": "Class can be final if not for extend", "author": "terrymanu", "createdAt": "2020-12-04T09:34:34Z", "path": "shardingsphere-features/shardingsphere-sharding/shardingsphere-sharding-common/src/test/java/org/apache/shardingsphere/sharding/fixture/ClassBasedHintShardingAlgorithmFixture.java", "diffHunk": "@@ -0,0 +1,40 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.shardingsphere.sharding.fixture;\n+\n+import org.apache.shardingsphere.sharding.api.sharding.hint.HintShardingAlgorithm;\n+import org.apache.shardingsphere.sharding.api.sharding.hint.HintShardingValue;\n+\n+import java.util.Collection;\n+\n+public class ClassBasedHintShardingAlgorithmFixture implements HintShardingAlgorithm<Integer> {", "originalCommit": "333d82ae4911d0a2e23c2011037cdaeda1dffc26", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTk2MTc1NA==", "url": "https://github.com/apache/shardingsphere/pull/8508#discussion_r535961754", "bodyText": "Class can be final if not for extend", "author": "terrymanu", "createdAt": "2020-12-04T09:34:42Z", "path": "shardingsphere-features/shardingsphere-sharding/shardingsphere-sharding-common/src/test/java/org/apache/shardingsphere/sharding/fixture/ClassBasedStandardShardingAlgorithmFixture.java", "diffHunk": "@@ -0,0 +1,51 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.shardingsphere.sharding.fixture;\n+\n+import org.apache.shardingsphere.sharding.api.sharding.standard.PreciseShardingValue;\n+import org.apache.shardingsphere.sharding.api.sharding.standard.RangeShardingValue;\n+import org.apache.shardingsphere.sharding.api.sharding.standard.StandardShardingAlgorithm;\n+\n+import java.util.Collection;\n+\n+public class ClassBasedStandardShardingAlgorithmFixture implements StandardShardingAlgorithm<Integer> {", "originalCommit": "333d82ae4911d0a2e23c2011037cdaeda1dffc26", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "df1fc87183da7f89ab178ce71dff35632b1e064c", "url": "https://github.com/apache/shardingsphere/commit/df1fc87183da7f89ab178ce71dff35632b1e064c", "message": "Solve problems & add document.", "committedDate": "2020-12-04T16:22:15Z", "type": "commit"}]}