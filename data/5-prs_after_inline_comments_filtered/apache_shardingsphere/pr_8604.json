{"pr_number": 8604, "pr_title": "Add ExpressionAssert for WhereClause, IdentifierValueAssert for ExpectedOwner and TableAssert for UpdateStatementAssert.", "pr_createdAt": "2020-12-13T14:56:52Z", "pr_url": "https://github.com/apache/shardingsphere/pull/8604", "timeline": [{"oid": "a6a036067871b912c710d7988c971a3dbd26aaa0", "url": "https://github.com/apache/shardingsphere/commit/a6a036067871b912c710d7988c971a3dbd26aaa0", "message": "Add TableAssert for UpdateStatementAssert.\nAdd IdentifierValueAssert for ExpectedIndex, ExpectedColumnOrderByItem, ExpectedOwner, ExpectedSchema and ExpectedColumnProjection.\nAdd ExpressionAssert and test cases for select where with expr.\nAdjust the whereClause of the old test case.", "committedDate": "2020-12-13T15:34:40Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzE0NDc3MQ==", "url": "https://github.com/apache/shardingsphere/pull/8604#discussion_r543144771", "bodyText": "@lwtdev\nWhat is the purpose of such a change?", "author": "jingshanglu", "createdAt": "2020-12-15T08:34:06Z", "path": "shardingsphere-sql-parser/shardingsphere-sql-parser-test/src/main/java/org/apache/shardingsphere/test/sql/parser/parameterized/jaxb/sql/loader/SQLCasesLoader.java", "diffHunk": "@@ -117,7 +117,7 @@ private String getLiteralSQL(final String sql, final List<?> parameters) {\n         if (null == parameters || parameters.isEmpty()) {\n             return sql;\n         }\n-        return String.format(sql.replace(\"%\", \"$\").replace(\"?\", \"%s\"), parameters.toArray()).replace(\"$\", \"%\").replace(\"%%\", \"%\").replace(\"'%'\", \"'%%'\");\n+        return String.format(sql.replace(\"%\", \"$$\").replace(\"?\", \"%s\"), parameters.toArray()).replace(\"$$\", \"%\").replace(\"%%\", \"%\").replace(\"'%'\", \"'%%'\");", "originalCommit": "a6a036067871b912c710d7988c971a3dbd26aaa0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzI5NTYwNw==", "url": "https://github.com/apache/shardingsphere/pull/8604#discussion_r543295607", "bodyText": "@jingshanglu $ is used to temporarily replace %, but in MySQL, it used to be the Path syntax of JSON, representing a JSON document.\nThe test case is not working properly.\nMaybe using a non-printable character here is better than \"$$ \"?", "author": "lwtdev", "createdAt": "2020-12-15T12:19:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzE0NDc3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjMyNTQ0NA==", "url": "https://github.com/apache/shardingsphere/pull/8604#discussion_r546325444", "bodyText": "Add a replace method to replace sql parameters.", "author": "lwtdev", "createdAt": "2020-12-20T05:38:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzE0NDc3MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzE2NzIyMw==", "url": "https://github.com/apache/shardingsphere/pull/8604#discussion_r543167223", "bodyText": "@lwtdev Like this, maybe it's better to go to assert actual based on expect.", "author": "jingshanglu", "createdAt": "2020-12-15T09:07:56Z", "path": "shardingsphere-sql-parser/shardingsphere-sql-parser-test/src/main/java/org/apache/shardingsphere/test/sql/parser/parameterized/asserts/segment/expression/ExpressionAssert.java", "diffHunk": "@@ -65,7 +87,7 @@ public static void assertParameterMarkerExpression(final SQLCaseAssertContext as\n      */\n     public static void assertLiteralExpression(final SQLCaseAssertContext assertContext,\n                                                 final LiteralExpressionSegment actual, final ExpectedLiteralExpression expected) {\n-        assertNotNull(assertContext.getText(\"Expected literal expression should exist.\"));\n+        assertNotNull(assertContext.getText(\"Expected literal expression should exist.\"), expected);", "originalCommit": "a6a036067871b912c710d7988c971a3dbd26aaa0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzI5NTc0Mw==", "url": "https://github.com/apache/shardingsphere/pull/8604#discussion_r543295743", "bodyText": "@jingshanglu OK, I will modify it.", "author": "lwtdev", "createdAt": "2020-12-15T12:20:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzE2NzIyMw=="}], "type": "inlineReview"}, {"oid": "44f2f8565e9bc9f7a287d7ea3beb30824abd4118", "url": "https://github.com/apache/shardingsphere/commit/44f2f8565e9bc9f7a287d7ea3beb30824abd4118", "message": "Add TableAssert for UpdateStatementAssert.\nAdd IdentifierValueAssert for ExpectedIndex, ExpectedColumnOrderByItem, ExpectedOwner, ExpectedSchema and ExpectedColumnProjection.\nAdd ExpressionAssert and test cases for select where with expr.\nAdjust the whereClause of the old test case.", "committedDate": "2020-12-21T04:42:43Z", "type": "commit"}, {"oid": "c55fa65490e1bf64048c776a56ffcdff6bcf2e5a", "url": "https://github.com/apache/shardingsphere/commit/c55fa65490e1bf64048c776a56ffcdff6bcf2e5a", "message": "Use the `replace` method instead of `String.format` to replace the parameters in sql.\nFormat sql parse cases.\nAssert actual base on expected in ExpressionAssert.\nAdd `literal-text` attribute in ExpressionProjection for the case which result is different between placeholder and literal mode.", "committedDate": "2020-12-21T04:42:43Z", "type": "commit"}, {"oid": "b1850401fa9de8047ac37ca971c10617cacdaab5", "url": "https://github.com/apache/shardingsphere/commit/b1850401fa9de8047ac37ca971c10617cacdaab5", "message": "Format code.", "committedDate": "2020-12-21T04:42:43Z", "type": "commit"}, {"oid": "ee290892fa78043bdb3222e634f5281a7462d9cc", "url": "https://github.com/apache/shardingsphere/commit/ee290892fa78043bdb3222e634f5281a7462d9cc", "message": "Fix test cases that use the old `expr` syntax.", "committedDate": "2020-12-21T06:42:25Z", "type": "commit"}, {"oid": "ee290892fa78043bdb3222e634f5281a7462d9cc", "url": "https://github.com/apache/shardingsphere/commit/ee290892fa78043bdb3222e634f5281a7462d9cc", "message": "Fix test cases that use the old `expr` syntax.", "committedDate": "2020-12-21T06:42:25Z", "type": "forcePushed"}]}