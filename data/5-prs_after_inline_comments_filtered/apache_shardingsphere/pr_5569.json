{"pr_number": 5569, "pr_title": "add shadow_hit_total metrics", "pr_createdAt": "2020-05-13T06:50:37Z", "pr_url": "https://github.com/apache/shardingsphere/pull/5569", "timeline": [{"oid": "d03dda88799ca97619f57d9451b5b02d0e208de1", "url": "https://github.com/apache/shardingsphere/commit/d03dda88799ca97619f57d9451b5b02d0e208de1", "message": "add shadow_hit_total metrics", "committedDate": "2020-05-13T06:49:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDIxMjY2Nw==", "url": "https://github.com/apache/shardingsphere/pull/5569#discussion_r424212667", "bodyText": "blank line in the end\u3002", "author": "yu199195", "createdAt": "2020-05-13T06:58:42Z", "path": "sharding-metrics/sharding-metrics-prometheus/src/test/java/org/apache/shardingsphere/metrics/prometheus/impl/counter/ShadowHitTotalCounterMetricsTrackerTest.java", "diffHunk": "@@ -0,0 +1,39 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.shardingsphere.metrics.prometheus.impl.counter;\n+\n+import org.apache.shardingsphere.metrics.enums.MetricsLabelEnum;\n+import org.apache.shardingsphere.metrics.enums.MetricsTypeEnum;\n+import org.apache.shardingsphere.metrics.prometheus.impl.AbstractPrometheusCollectorRegistry;\n+import org.junit.Test;\n+\n+import static org.hamcrest.CoreMatchers.is;\n+import static org.junit.Assert.assertThat;\n+\n+public class ShadowHitTotalCounterMetricsTrackerTest extends AbstractPrometheusCollectorRegistry {\n+    \n+    @Test\n+    public void counterShadowHitTotal() {\n+        ShadowHitTotalCounterMetricsTracker tracker = new ShadowHitTotalCounterMetricsTracker();\n+        assertThat(tracker.metricsLabel(), is(MetricsLabelEnum.SHADOW_HIT_TOTAL.getName()));\n+        assertThat(tracker.metricsType(), is(MetricsTypeEnum.COUNTER.name()));\n+        tracker.inc(1.0);\n+        Double total = getCollectorRegistry().getSampleValue(\"shadow_hit_total\");\n+        assertThat(total, is(1.0));\n+    }\n+}", "originalCommit": "d03dda88799ca97619f57d9451b5b02d0e208de1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDIxMzM0MA==", "url": "https://github.com/apache/shardingsphere/pull/5569#discussion_r424213340", "bodyText": "Maybe we can't bury it here", "author": "yu199195", "createdAt": "2020-05-13T07:00:06Z", "path": "shadow-core/shadow-core-route/src/main/java/org/apache/shardingsphere/shadow/route/engine/ShadowRouteDecorator.java", "diffHunk": "@@ -95,6 +99,10 @@ private boolean isShadowSQL(final RouteContext routeContext, final ShadowRule sh\n         return shadowDataSourceRouter.isShadowSQL();\n     }\n     \n+    private void metricsCollect() {\n+        MetricsTrackerFacade.getInstance().counterInc(MetricsLabelEnum.SHADOW_HIT_TOTAL.getName());\n+    }\n+    ", "originalCommit": "d03dda88799ca97619f57d9451b5b02d0e208de1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "fc84ee4c60ed8e17e86a5b209b1c25ca9f5d9935", "url": "https://github.com/apache/shardingsphere/commit/fc84ee4c60ed8e17e86a5b209b1c25ca9f5d9935", "message": "fix check style", "committedDate": "2020-05-13T07:13:37Z", "type": "commit"}, {"oid": "a827bff6614fddf321e726acea39e82d28d28465", "url": "https://github.com/apache/shardingsphere/commit/a827bff6614fddf321e726acea39e82d28d28465", "message": "remove from shadow-core", "committedDate": "2020-05-13T07:14:50Z", "type": "commit"}, {"oid": "3568e2151825f2dcf9793811c867f15cf07e85d6", "url": "https://github.com/apache/shardingsphere/commit/3568e2151825f2dcf9793811c867f15cf07e85d6", "message": "Merge branch 'master' into add-metrics", "committedDate": "2020-05-13T07:36:06Z", "type": "commit"}, {"oid": "1ad227b3c303550a82b1c0cdb5c8c54eb68feb98", "url": "https://github.com/apache/shardingsphere/commit/1ad227b3c303550a82b1c0cdb5c8c54eb68feb98", "message": "add shadow route metrics collect", "committedDate": "2020-05-13T07:41:08Z", "type": "commit"}, {"oid": "c4007fb6797e16a4e24a7073d45db6eff57846dc", "url": "https://github.com/apache/shardingsphere/commit/c4007fb6797e16a4e24a7073d45db6eff57846dc", "message": "resolve merge conflicts", "committedDate": "2020-05-13T08:02:36Z", "type": "commit"}, {"oid": "e988efb2821284b0304e841d8aa02cc2f14eb682", "url": "https://github.com/apache/shardingsphere/commit/e988efb2821284b0304e841d8aa02cc2f14eb682", "message": "Merge branch 'master' into add-metrics\n\n# Conflicts:\n#\tsharding-proxy/sharding-proxy-backend/src/main/java/org/apache/shardingsphere/shardingproxy/backend/communication/jdbc/wrapper/PreparedStatementExecutorWrapper.java\n#\tsharding-proxy/sharding-proxy-backend/src/main/java/org/apache/shardingsphere/shardingproxy/backend/communication/jdbc/wrapper/StatementExecutorWrapper.java", "committedDate": "2020-05-13T08:41:16Z", "type": "commit"}]}