{"pr_number": 6854, "pr_title": "fix issue 6850", "pr_createdAt": "2020-08-15T01:30:12Z", "pr_url": "https://github.com/apache/shardingsphere/pull/6854", "timeline": [{"oid": "5a8c79273ff931c4164f4a7c0b4c5d6216ddc130", "url": "https://github.com/apache/shardingsphere/commit/5a8c79273ff931c4164f4a7c0b4c5d6216ddc130", "message": "fix issue 6850\n\n* add test case for EncryptTableRuleConfigurationYamlSwapper", "committedDate": "2020-08-15T01:29:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDkyNjkxMA==", "url": "https://github.com/apache/shardingsphere/pull/6854#discussion_r470926910", "bodyText": "The variable should be actualColumns", "author": "terrymanu", "createdAt": "2020-08-15T02:30:55Z", "path": "shardingsphere-features/shardingsphere-encrypt/shardingsphere-encrypt-common/src/test/java/org/apache/shardingsphere/encrypt/yaml/swapper/rule/EncryptTableRuleConfigurationYamlSwapperTest.java", "diffHunk": "@@ -0,0 +1,74 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.shardingsphere.encrypt.yaml.swapper.rule;\n+\n+import com.google.common.collect.Lists;\n+import java.util.Collection;\n+import java.util.LinkedHashMap;\n+import java.util.Map;\n+import org.apache.shardingsphere.encrypt.api.config.rule.EncryptColumnRuleConfiguration;\n+import org.apache.shardingsphere.encrypt.api.config.rule.EncryptTableRuleConfiguration;\n+import org.apache.shardingsphere.encrypt.yaml.config.rule.YamlEncryptColumnRuleConfiguration;\n+import org.apache.shardingsphere.encrypt.yaml.config.rule.YamlEncryptTableRuleConfiguration;\n+import org.junit.Test;\n+\n+import static org.hamcrest.CoreMatchers.is;\n+import static org.junit.Assert.assertFalse;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertThat;\n+\n+public final class EncryptTableRuleConfigurationYamlSwapperTest {\n+    \n+    private final EncryptTableRuleConfigurationYamlSwapper tableRuleConfigYamlSwapper = new EncryptTableRuleConfigurationYamlSwapper();\n+    \n+    @Test\n+    public void assertSwapToYamlConfiguration() {\n+        Collection<EncryptColumnRuleConfiguration> encryptColumnRuleConfigCollection =\n+            Lists.newArrayList(\n+                new EncryptColumnRuleConfiguration(\"encrypt_column_1\", \"encrypt_cipher_1\", \"\", \"\", \"test_encrypto_1r\"),\n+                new EncryptColumnRuleConfiguration(\"encrypt_column_2\", \"encrypt_cipher_2\", \"\", \"\", \"test_encryptor_2\"),\n+                new EncryptColumnRuleConfiguration(\"encrypt_column_3\", \"encrypt_cipher_3\", \"\", \"\", \"test_encryptor_3\")\n+              );\n+        EncryptTableRuleConfiguration encryptTableRuleConfig = new EncryptTableRuleConfiguration(\"test_table\", encryptColumnRuleConfigCollection);\n+        YamlEncryptTableRuleConfiguration actualYamlEncryptTableRuleConfig = tableRuleConfigYamlSwapper.swapToYamlConfiguration(encryptTableRuleConfig);\n+        assertNotNull(actualYamlEncryptTableRuleConfig);\n+        assertFalse(actualYamlEncryptTableRuleConfig.getColumns().isEmpty());\n+        assertThat(actualYamlEncryptTableRuleConfig.getColumns().size(), is(3));\n+    }\n+    \n+    @Test\n+    public void assertSwapToObject() {\n+        YamlEncryptColumnRuleConfiguration encryptColumnRuleConfig = new YamlEncryptColumnRuleConfiguration();\n+        encryptColumnRuleConfig.setLogicColumn(\"encrypt_column\");\n+        encryptColumnRuleConfig.setCipherColumn(\"encrypt_cipher\");\n+        encryptColumnRuleConfig.setAssistedQueryColumn(\"encrypt_assisted\");\n+        encryptColumnRuleConfig.setPlainColumn(\"encrypt_plain\");\n+        encryptColumnRuleConfig.setEncryptorName(\"test_encryptor\");\n+        Map<String, YamlEncryptColumnRuleConfiguration> columns = new LinkedHashMap<>(1);\n+        columns.put(\"test_column\", encryptColumnRuleConfig);\n+        YamlEncryptTableRuleConfiguration yamlEncryptTableRuleConfig = new YamlEncryptTableRuleConfiguration();\n+        yamlEncryptTableRuleConfig.setName(\"test_table\");\n+        yamlEncryptTableRuleConfig.setColumns(columns);\n+        EncryptTableRuleConfiguration actualEncryptTableRuleConfig = tableRuleConfigYamlSwapper.swapToObject(yamlEncryptTableRuleConfig);\n+        assertNotNull(actualEncryptTableRuleConfig);\n+        assertThat(actualEncryptTableRuleConfig.getName(), is(\"test_table\"));\n+        Collection<EncryptColumnRuleConfiguration> actualColumn = actualEncryptTableRuleConfig.getColumns();", "originalCommit": "5a8c79273ff931c4164f4a7c0b4c5d6216ddc130", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDkyNjk3Mg==", "url": "https://github.com/apache/shardingsphere/pull/6854#discussion_r470926972", "bodyText": "Please add more assertions of columns content", "author": "terrymanu", "createdAt": "2020-08-15T02:31:32Z", "path": "shardingsphere-features/shardingsphere-encrypt/shardingsphere-encrypt-common/src/test/java/org/apache/shardingsphere/encrypt/yaml/swapper/rule/EncryptTableRuleConfigurationYamlSwapperTest.java", "diffHunk": "@@ -0,0 +1,74 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.shardingsphere.encrypt.yaml.swapper.rule;\n+\n+import com.google.common.collect.Lists;\n+import java.util.Collection;\n+import java.util.LinkedHashMap;\n+import java.util.Map;\n+import org.apache.shardingsphere.encrypt.api.config.rule.EncryptColumnRuleConfiguration;\n+import org.apache.shardingsphere.encrypt.api.config.rule.EncryptTableRuleConfiguration;\n+import org.apache.shardingsphere.encrypt.yaml.config.rule.YamlEncryptColumnRuleConfiguration;\n+import org.apache.shardingsphere.encrypt.yaml.config.rule.YamlEncryptTableRuleConfiguration;\n+import org.junit.Test;\n+\n+import static org.hamcrest.CoreMatchers.is;\n+import static org.junit.Assert.assertFalse;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertThat;\n+\n+public final class EncryptTableRuleConfigurationYamlSwapperTest {\n+    \n+    private final EncryptTableRuleConfigurationYamlSwapper tableRuleConfigYamlSwapper = new EncryptTableRuleConfigurationYamlSwapper();\n+    \n+    @Test\n+    public void assertSwapToYamlConfiguration() {\n+        Collection<EncryptColumnRuleConfiguration> encryptColumnRuleConfigCollection =\n+            Lists.newArrayList(\n+                new EncryptColumnRuleConfiguration(\"encrypt_column_1\", \"encrypt_cipher_1\", \"\", \"\", \"test_encrypto_1r\"),\n+                new EncryptColumnRuleConfiguration(\"encrypt_column_2\", \"encrypt_cipher_2\", \"\", \"\", \"test_encryptor_2\"),\n+                new EncryptColumnRuleConfiguration(\"encrypt_column_3\", \"encrypt_cipher_3\", \"\", \"\", \"test_encryptor_3\")\n+              );\n+        EncryptTableRuleConfiguration encryptTableRuleConfig = new EncryptTableRuleConfiguration(\"test_table\", encryptColumnRuleConfigCollection);\n+        YamlEncryptTableRuleConfiguration actualYamlEncryptTableRuleConfig = tableRuleConfigYamlSwapper.swapToYamlConfiguration(encryptTableRuleConfig);\n+        assertNotNull(actualYamlEncryptTableRuleConfig);\n+        assertFalse(actualYamlEncryptTableRuleConfig.getColumns().isEmpty());\n+        assertThat(actualYamlEncryptTableRuleConfig.getColumns().size(), is(3));", "originalCommit": "5a8c79273ff931c4164f4a7c0b4c5d6216ddc130", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDkzMDAyOQ==", "url": "https://github.com/apache/shardingsphere/pull/6854#discussion_r470930029", "bodyText": "Please add more assertions of columns content\n\nok, I will add more assertions of columns content", "author": "jacksparrow414", "createdAt": "2020-08-15T03:09:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDkyNjk3Mg=="}], "type": "inlineReview"}, {"oid": "c0f6b69db4ba9b44756d9885a6bc3618d34a3d5e", "url": "https://github.com/apache/shardingsphere/commit/c0f6b69db4ba9b44756d9885a6bc3618d34a3d5e", "message": "modify variable name", "committedDate": "2020-08-15T02:45:33Z", "type": "commit"}, {"oid": "3533a00a65de388887b0e55e485d21a7eacb92e8", "url": "https://github.com/apache/shardingsphere/commit/3533a00a65de388887b0e55e485d21a7eacb92e8", "message": " add more assertions of columns content", "committedDate": "2020-08-15T02:54:11Z", "type": "commit"}]}