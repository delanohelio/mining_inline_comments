{"pr_number": 6270, "pr_title": "Fix 6239", "pr_createdAt": "2020-07-06T03:26:54Z", "pr_url": "https://github.com/apache/shardingsphere/pull/6270", "timeline": [{"oid": "125d13f932656b8ddf198ca832e5087854a09b9d", "url": "https://github.com/apache/shardingsphere/commit/125d13f932656b8ddf198ca832e5087854a09b9d", "message": "add usage for proxy startup command", "committedDate": "2020-07-04T10:18:31Z", "type": "commit"}, {"oid": "d7593a06f1373e70d9e64f675a324a50f880c6a2", "url": "https://github.com/apache/shardingsphere/commit/d7593a06f1373e70d9e64f675a324a50f880c6a2", "message": "dynamic set server version when proxy startup", "committedDate": "2020-07-06T03:25:02Z", "type": "commit"}, {"oid": "36ea446dfb55e2f3bbf0ba476f7aae1ecf39001d", "url": "https://github.com/apache/shardingsphere/commit/36ea446dfb55e2f3bbf0ba476f7aae1ecf39001d", "message": "merge master", "committedDate": "2020-07-06T03:30:26Z", "type": "commit"}, {"oid": "a824485738666d9a93676f30448f3a14e9f5cad6", "url": "https://github.com/apache/shardingsphere/commit/a824485738666d9a93676f30448f3a14e9f5cad6", "message": "fix check style", "committedDate": "2020-07-06T04:26:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTk4MzE2OA==", "url": "https://github.com/apache/shardingsphere/pull/6270#discussion_r449983168", "bodyText": "Should delete if only use for serverVersion once.", "author": "tuohai666", "createdAt": "2020-07-06T04:55:30Z", "path": "shardingsphere-db-protocol/shardingsphere-db-protocol-mysql/src/main/java/org/apache/shardingsphere/db/protocol/mysql/constant/MySQLServerInfo.java", "diffHunk": "@@ -31,13 +31,33 @@\n      */\n     public static final int PROTOCOL_VERSION = 0x0A;\n     \n+    /**\n+     * Charset code 0x21 is utf8_general_ci.\n+     */\n+    public static final int CHARSET = 0x21;\n+    \n+    private static final String DEFAULT_SERVER_VERSION = \"8.0.20-ShardingSphere-Proxy 5.0.0-RC1\";", "originalCommit": "a824485738666d9a93676f30448f3a14e9f5cad6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTk5NTAzNg==", "url": "https://github.com/apache/shardingsphere/pull/6270#discussion_r449995036", "bodyText": "ok", "author": "xbkaishui", "createdAt": "2020-07-06T05:45:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTk4MzE2OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTk4Mzg0NA==", "url": "https://github.com/apache/shardingsphere/pull/6270#discussion_r449983844", "bodyText": "follow an empty line.", "author": "tuohai666", "createdAt": "2020-07-06T04:58:39Z", "path": "shardingsphere-db-protocol/shardingsphere-db-protocol-mysql/src/main/java/org/apache/shardingsphere/db/protocol/mysql/constant/MySQLServerInfo.java", "diffHunk": "@@ -31,13 +31,33 @@\n      */\n     public static final int PROTOCOL_VERSION = 0x0A;\n     \n+    /**\n+     * Charset code 0x21 is utf8_general_ci.\n+     */\n+    public static final int CHARSET = 0x21;\n+    \n+    private static final String DEFAULT_SERVER_VERSION = \"8.0.20-ShardingSphere-Proxy 5.0.0-RC1\";\n+    \n     /**\n      * Server version.\n      */\n-    public static final String SERVER_VERSION = \"8.0.20-ShardingSphere-Proxy 5.0.0-RC1\";\n+    private static String serverVersion = DEFAULT_SERVER_VERSION;\n     \n     /**\n-     * Charset code 0x21 is utf8_general_ci.\n+     *  set server version.", "originalCommit": "a824485738666d9a93676f30448f3a14e9f5cad6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTk4Mzk5NQ==", "url": "https://github.com/apache/shardingsphere/pull/6270#discussion_r449983995", "bodyText": "null != version", "author": "tuohai666", "createdAt": "2020-07-06T04:59:30Z", "path": "shardingsphere-db-protocol/shardingsphere-db-protocol-mysql/src/main/java/org/apache/shardingsphere/db/protocol/mysql/constant/MySQLServerInfo.java", "diffHunk": "@@ -31,13 +31,33 @@\n      */\n     public static final int PROTOCOL_VERSION = 0x0A;\n     \n+    /**\n+     * Charset code 0x21 is utf8_general_ci.\n+     */\n+    public static final int CHARSET = 0x21;\n+    \n+    private static final String DEFAULT_SERVER_VERSION = \"8.0.20-ShardingSphere-Proxy 5.0.0-RC1\";\n+    \n     /**\n      * Server version.\n      */\n-    public static final String SERVER_VERSION = \"8.0.20-ShardingSphere-Proxy 5.0.0-RC1\";\n+    private static String serverVersion = DEFAULT_SERVER_VERSION;\n     \n     /**\n-     * Charset code 0x21 is utf8_general_ci.\n+     *  set server version.\n+     * @param version version\n      */\n-    public static final int CHARSET = 0x21;\n+    public static void setServerVersion(final String version) {\n+        if (version != null) {", "originalCommit": "a824485738666d9a93676f30448f3a14e9f5cad6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTk4NTczNA==", "url": "https://github.com/apache/shardingsphere/pull/6270#discussion_r449985734", "bodyText": "set should be capitalized.", "author": "tuohai666", "createdAt": "2020-07-06T05:07:22Z", "path": "shardingsphere-db-protocol/shardingsphere-db-protocol-mysql/src/main/java/org/apache/shardingsphere/db/protocol/mysql/constant/MySQLServerInfo.java", "diffHunk": "@@ -31,13 +31,33 @@\n      */\n     public static final int PROTOCOL_VERSION = 0x0A;\n     \n+    /**\n+     * Charset code 0x21 is utf8_general_ci.\n+     */\n+    public static final int CHARSET = 0x21;\n+    \n+    private static final String DEFAULT_SERVER_VERSION = \"8.0.20-ShardingSphere-Proxy 5.0.0-RC1\";\n+    \n     /**\n      * Server version.\n      */\n-    public static final String SERVER_VERSION = \"8.0.20-ShardingSphere-Proxy 5.0.0-RC1\";\n+    private static String serverVersion = DEFAULT_SERVER_VERSION;\n     \n     /**\n-     * Charset code 0x21 is utf8_general_ci.\n+     *  set server version.", "originalCommit": "a824485738666d9a93676f30448f3a14e9f5cad6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTk4NTgyOQ==", "url": "https://github.com/apache/shardingsphere/pull/6270#discussion_r449985829", "bodyText": "server version", "author": "tuohai666", "createdAt": "2020-07-06T05:07:47Z", "path": "shardingsphere-db-protocol/shardingsphere-db-protocol-mysql/src/main/java/org/apache/shardingsphere/db/protocol/mysql/constant/MySQLServerInfo.java", "diffHunk": "@@ -31,13 +31,33 @@\n      */\n     public static final int PROTOCOL_VERSION = 0x0A;\n     \n+    /**\n+     * Charset code 0x21 is utf8_general_ci.\n+     */\n+    public static final int CHARSET = 0x21;\n+    \n+    private static final String DEFAULT_SERVER_VERSION = \"8.0.20-ShardingSphere-Proxy 5.0.0-RC1\";\n+    \n     /**\n      * Server version.\n      */\n-    public static final String SERVER_VERSION = \"8.0.20-ShardingSphere-Proxy 5.0.0-RC1\";\n+    private static String serverVersion = DEFAULT_SERVER_VERSION;\n     \n     /**\n-     * Charset code 0x21 is utf8_general_ci.\n+     *  set server version.\n+     * @param version version", "originalCommit": "a824485738666d9a93676f30448f3a14e9f5cad6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTk4NjAyMg==", "url": "https://github.com/apache/shardingsphere/pull/6270#discussion_r449986022", "bodyText": "get should be capitalized.", "author": "tuohai666", "createdAt": "2020-07-06T05:08:46Z", "path": "shardingsphere-db-protocol/shardingsphere-db-protocol-mysql/src/main/java/org/apache/shardingsphere/db/protocol/mysql/constant/MySQLServerInfo.java", "diffHunk": "@@ -31,13 +31,33 @@\n      */\n     public static final int PROTOCOL_VERSION = 0x0A;\n     \n+    /**\n+     * Charset code 0x21 is utf8_general_ci.\n+     */\n+    public static final int CHARSET = 0x21;\n+    \n+    private static final String DEFAULT_SERVER_VERSION = \"8.0.20-ShardingSphere-Proxy 5.0.0-RC1\";\n+    \n     /**\n      * Server version.\n      */\n-    public static final String SERVER_VERSION = \"8.0.20-ShardingSphere-Proxy 5.0.0-RC1\";\n+    private static String serverVersion = DEFAULT_SERVER_VERSION;\n     \n     /**\n-     * Charset code 0x21 is utf8_general_ci.\n+     *  set server version.\n+     * @param version version\n      */\n-    public static final int CHARSET = 0x21;\n+    public static void setServerVersion(final String version) {\n+        if (version != null) {\n+            serverVersion = String.format(\"%s-ShardingSphere-Proxy 5.0.0-RC1\", version);\n+        }\n+    }\n+    \n+    /**\n+     * get current server version.", "originalCommit": "a824485738666d9a93676f30448f3a14e9f5cad6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTk4NjA1MQ==", "url": "https://github.com/apache/shardingsphere/pull/6270#discussion_r449986051", "bodyText": "follow an empty line.", "author": "tuohai666", "createdAt": "2020-07-06T05:08:59Z", "path": "shardingsphere-db-protocol/shardingsphere-db-protocol-mysql/src/main/java/org/apache/shardingsphere/db/protocol/mysql/constant/MySQLServerInfo.java", "diffHunk": "@@ -31,13 +31,33 @@\n      */\n     public static final int PROTOCOL_VERSION = 0x0A;\n     \n+    /**\n+     * Charset code 0x21 is utf8_general_ci.\n+     */\n+    public static final int CHARSET = 0x21;\n+    \n+    private static final String DEFAULT_SERVER_VERSION = \"8.0.20-ShardingSphere-Proxy 5.0.0-RC1\";\n+    \n     /**\n      * Server version.\n      */\n-    public static final String SERVER_VERSION = \"8.0.20-ShardingSphere-Proxy 5.0.0-RC1\";\n+    private static String serverVersion = DEFAULT_SERVER_VERSION;\n     \n     /**\n-     * Charset code 0x21 is utf8_general_ci.\n+     *  set server version.\n+     * @param version version\n      */\n-    public static final int CHARSET = 0x21;\n+    public static void setServerVersion(final String version) {\n+        if (version != null) {\n+            serverVersion = String.format(\"%s-ShardingSphere-Proxy 5.0.0-RC1\", version);\n+        }\n+    }\n+    \n+    /**\n+     * get current server version.", "originalCommit": "a824485738666d9a93676f30448f3a14e9f5cad6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTk4OTI0Ng==", "url": "https://github.com/apache/shardingsphere/pull/6270#discussion_r449989246", "bodyText": "remove meaningless empty line.", "author": "tuohai666", "createdAt": "2020-07-06T05:22:09Z", "path": "shardingsphere-proxy/shardingsphere-proxy-bootstrap/src/main/java/org/apache/shardingsphere/proxy/Bootstrap.java", "diffHunk": "@@ -157,6 +162,26 @@ private static void initialize(final Authentication authentication, final Proper\n         log(authentication, properties);\n         initControlPanelFacade(metricsConfiguration);\n         initCluster(cluster);\n+        updateServerInfo();\n+    }\n+    \n+    private static void updateServerInfo() {\n+        List<String> schemaNames = ProxySchemaContexts.getInstance().getSchemaNames();\n+        if (CollectionUtils.isEmpty(schemaNames)) {\n+            return;\n+        }\n+        Map<String, DataSource> dataSources = ProxySchemaContexts.getInstance().getSchema(schemaNames.get(0)).getSchema().getDataSources();\n+        DataSource singleDataSource = dataSources.values().iterator().next();\n+        try (Connection connection = singleDataSource.getConnection()) {\n+            DatabaseMetaData meta = connection.getMetaData();\n+            String name = meta.getDatabaseProductName();\n+            String version = meta.getDatabaseProductVersion();\n+            log.info(\"server name {} , server version {}\", name, version);\n+            MySQLServerInfo.setServerVersion(version);\n+        } catch (SQLException e) {\n+            log.error(e.getMessage(), e);\n+        }\n+    ", "originalCommit": "a824485738666d9a93676f30448f3a14e9f5cad6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTk5MDA4MQ==", "url": "https://github.com/apache/shardingsphere/pull/6270#discussion_r449990081", "bodyText": "meta -> databaseMetaData, note that we rarely use abbreviation.", "author": "tuohai666", "createdAt": "2020-07-06T05:25:42Z", "path": "shardingsphere-proxy/shardingsphere-proxy-bootstrap/src/main/java/org/apache/shardingsphere/proxy/Bootstrap.java", "diffHunk": "@@ -157,6 +162,26 @@ private static void initialize(final Authentication authentication, final Proper\n         log(authentication, properties);\n         initControlPanelFacade(metricsConfiguration);\n         initCluster(cluster);\n+        updateServerInfo();\n+    }\n+    \n+    private static void updateServerInfo() {\n+        List<String> schemaNames = ProxySchemaContexts.getInstance().getSchemaNames();\n+        if (CollectionUtils.isEmpty(schemaNames)) {\n+            return;\n+        }\n+        Map<String, DataSource> dataSources = ProxySchemaContexts.getInstance().getSchema(schemaNames.get(0)).getSchema().getDataSources();\n+        DataSource singleDataSource = dataSources.values().iterator().next();\n+        try (Connection connection = singleDataSource.getConnection()) {\n+            DatabaseMetaData meta = connection.getMetaData();", "originalCommit": "a824485738666d9a93676f30448f3a14e9f5cad6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTk5MDcwMg==", "url": "https://github.com/apache/shardingsphere/pull/6270#discussion_r449990702", "bodyText": "throw a ShardingSphereException instead of print log.", "author": "tuohai666", "createdAt": "2020-07-06T05:28:11Z", "path": "shardingsphere-proxy/shardingsphere-proxy-bootstrap/src/main/java/org/apache/shardingsphere/proxy/Bootstrap.java", "diffHunk": "@@ -157,6 +162,26 @@ private static void initialize(final Authentication authentication, final Proper\n         log(authentication, properties);\n         initControlPanelFacade(metricsConfiguration);\n         initCluster(cluster);\n+        updateServerInfo();\n+    }\n+    \n+    private static void updateServerInfo() {\n+        List<String> schemaNames = ProxySchemaContexts.getInstance().getSchemaNames();\n+        if (CollectionUtils.isEmpty(schemaNames)) {\n+            return;\n+        }\n+        Map<String, DataSource> dataSources = ProxySchemaContexts.getInstance().getSchema(schemaNames.get(0)).getSchema().getDataSources();\n+        DataSource singleDataSource = dataSources.values().iterator().next();\n+        try (Connection connection = singleDataSource.getConnection()) {\n+            DatabaseMetaData meta = connection.getMetaData();\n+            String name = meta.getDatabaseProductName();\n+            String version = meta.getDatabaseProductVersion();\n+            log.info(\"server name {} , server version {}\", name, version);\n+            MySQLServerInfo.setServerVersion(version);\n+        } catch (SQLException e) {\n+            log.error(e.getMessage(), e);", "originalCommit": "a824485738666d9a93676f30448f3a14e9f5cad6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTk5MDgxMA==", "url": "https://github.com/apache/shardingsphere/pull/6270#discussion_r449990810", "bodyText": "SQLException e -> final SQLException ex", "author": "tuohai666", "createdAt": "2020-07-06T05:28:42Z", "path": "shardingsphere-proxy/shardingsphere-proxy-bootstrap/src/main/java/org/apache/shardingsphere/proxy/Bootstrap.java", "diffHunk": "@@ -157,6 +162,26 @@ private static void initialize(final Authentication authentication, final Proper\n         log(authentication, properties);\n         initControlPanelFacade(metricsConfiguration);\n         initCluster(cluster);\n+        updateServerInfo();\n+    }\n+    \n+    private static void updateServerInfo() {\n+        List<String> schemaNames = ProxySchemaContexts.getInstance().getSchemaNames();\n+        if (CollectionUtils.isEmpty(schemaNames)) {\n+            return;\n+        }\n+        Map<String, DataSource> dataSources = ProxySchemaContexts.getInstance().getSchema(schemaNames.get(0)).getSchema().getDataSources();\n+        DataSource singleDataSource = dataSources.values().iterator().next();\n+        try (Connection connection = singleDataSource.getConnection()) {\n+            DatabaseMetaData meta = connection.getMetaData();\n+            String name = meta.getDatabaseProductName();\n+            String version = meta.getDatabaseProductVersion();\n+            log.info(\"server name {} , server version {}\", name, version);\n+            MySQLServerInfo.setServerVersion(version);\n+        } catch (SQLException e) {", "originalCommit": "a824485738666d9a93676f30448f3a14e9f5cad6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTk5MjQ5MA==", "url": "https://github.com/apache/shardingsphere/pull/6270#discussion_r449992490", "bodyText": "remove this change if it's not about the server version.", "author": "tuohai666", "createdAt": "2020-07-06T05:35:29Z", "path": "shardingsphere-proxy/shardingsphere-proxy-common/src/main/java/org/apache/shardingsphere/proxy/config/ShardingConfigurationLoader.java", "diffHunk": "@@ -52,9 +53,10 @@\n      * @throws IOException IO exception\n      */\n     public ShardingConfiguration load(final String path) throws IOException {\n+        //this is just check for schemaName duplication", "originalCommit": "a824485738666d9a93676f30448f3a14e9f5cad6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "a2c8f52658a82312948736ff68ae3ed83978a57f", "url": "https://github.com/apache/shardingsphere/commit/a2c8f52658a82312948736ff68ae3ed83978a57f", "message": "fix code review suggestions", "committedDate": "2020-07-06T06:02:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDAxMjkzMg==", "url": "https://github.com/apache/shardingsphere/pull/6270#discussion_r450012932", "bodyText": "version server version -> server version", "author": "tuohai666", "createdAt": "2020-07-06T06:42:24Z", "path": "shardingsphere-db-protocol/shardingsphere-db-protocol-mysql/src/main/java/org/apache/shardingsphere/db/protocol/mysql/constant/MySQLServerInfo.java", "diffHunk": "@@ -31,13 +31,33 @@\n      */\n     public static final int PROTOCOL_VERSION = 0x0A;\n     \n+    /**\n+     * Charset code 0x21 is utf8_general_ci.\n+     */\n+    public static final int CHARSET = 0x21;\n+    \n     /**\n      * Server version.\n      */\n-    public static final String SERVER_VERSION = \"8.0.20-ShardingSphere-Proxy 5.0.0-RC1\";\n+    private static String serverVersion = \"8.0.20-ShardingSphere-Proxy 5.0.0-RC1\";\n     \n     /**\n-     * Charset code 0x21 is utf8_general_ci.\n+     * Set server version.\n+     *\n+     * @param version server version", "originalCommit": "a2c8f52658a82312948736ff68ae3ed83978a57f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDAxNzc3NA==", "url": "https://github.com/apache/shardingsphere/pull/6270#discussion_r450017774", "bodyText": "the checkstyle will fail if changes to server version\n 'server' \u7684\u65e0\u7528\u6807\u7b7e @param \u3002 (47:8) [JavadocMethodCheck]", "author": "xbkaishui", "createdAt": "2020-07-06T06:54:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDAxMjkzMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDAyMTk1MQ==", "url": "https://github.com/apache/shardingsphere/pull/6270#discussion_r450021951", "bodyText": "done", "author": "xbkaishui", "createdAt": "2020-07-06T07:04:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDAxMjkzMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDAxMzk4Mg==", "url": "https://github.com/apache/shardingsphere/pull/6270#discussion_r450013982", "bodyText": "move @slf4j after constructor", "author": "tuohai666", "createdAt": "2020-07-06T06:45:08Z", "path": "shardingsphere-proxy/shardingsphere-proxy-bootstrap/src/main/java/org/apache/shardingsphere/proxy/Bootstrap.java", "diffHunk": "@@ -77,6 +81,7 @@\n /**\n  * ShardingSphere-Proxy Bootstrap.\n  */\n+@Slf4j", "originalCommit": "a2c8f52658a82312948736ff68ae3ed83978a57f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDAxNTIxNA==", "url": "https://github.com/apache/shardingsphere/pull/6270#discussion_r450015214", "bodyText": "Database name/Database version is better.", "author": "tuohai666", "createdAt": "2020-07-06T06:48:28Z", "path": "shardingsphere-proxy/shardingsphere-proxy-bootstrap/src/main/java/org/apache/shardingsphere/proxy/Bootstrap.java", "diffHunk": "@@ -157,6 +162,25 @@ private static void initialize(final Authentication authentication, final Proper\n         log(authentication, properties);\n         initControlPanelFacade(metricsConfiguration);\n         initCluster(cluster);\n+        updateServerInfo();\n+    }\n+    \n+    private static void updateServerInfo() {\n+        List<String> schemaNames = ProxySchemaContexts.getInstance().getSchemaNames();\n+        if (CollectionUtils.isEmpty(schemaNames)) {\n+            return;\n+        }\n+        Map<String, DataSource> dataSources = ProxySchemaContexts.getInstance().getSchema(schemaNames.get(0)).getSchema().getDataSources();\n+        DataSource singleDataSource = dataSources.values().iterator().next();\n+        try (Connection connection = singleDataSource.getConnection()) {\n+            DatabaseMetaData databaseMetaData = connection.getMetaData();\n+            String name = databaseMetaData.getDatabaseProductName();\n+            String version = databaseMetaData.getDatabaseProductVersion();\n+            log.info(\"server name {} , server version {}\", name, version);", "originalCommit": "a2c8f52658a82312948736ff68ae3ed83978a57f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDAxODE0Mw==", "url": "https://github.com/apache/shardingsphere/pull/6270#discussion_r450018143", "bodyText": "yes that's better", "author": "xbkaishui", "createdAt": "2020-07-06T06:55:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDAxNTIxNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDAxOTQ3Mw==", "url": "https://github.com/apache/shardingsphere/pull/6270#discussion_r450019473", "bodyText": "done", "author": "xbkaishui", "createdAt": "2020-07-06T06:58:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDAxNTIxNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDAxNTg3MA==", "url": "https://github.com/apache/shardingsphere/pull/6270#discussion_r450015870", "bodyText": "e -> ex", "author": "tuohai666", "createdAt": "2020-07-06T06:50:01Z", "path": "shardingsphere-proxy/shardingsphere-proxy-bootstrap/src/main/java/org/apache/shardingsphere/proxy/Bootstrap.java", "diffHunk": "@@ -157,6 +162,25 @@ private static void initialize(final Authentication authentication, final Proper\n         log(authentication, properties);\n         initControlPanelFacade(metricsConfiguration);\n         initCluster(cluster);\n+        updateServerInfo();\n+    }\n+    \n+    private static void updateServerInfo() {\n+        List<String> schemaNames = ProxySchemaContexts.getInstance().getSchemaNames();\n+        if (CollectionUtils.isEmpty(schemaNames)) {\n+            return;\n+        }\n+        Map<String, DataSource> dataSources = ProxySchemaContexts.getInstance().getSchema(schemaNames.get(0)).getSchema().getDataSources();\n+        DataSource singleDataSource = dataSources.values().iterator().next();\n+        try (Connection connection = singleDataSource.getConnection()) {\n+            DatabaseMetaData databaseMetaData = connection.getMetaData();\n+            String name = databaseMetaData.getDatabaseProductName();\n+            String version = databaseMetaData.getDatabaseProductVersion();\n+            log.info(\"server name {} , server version {}\", name, version);\n+            MySQLServerInfo.setServerVersion(version);\n+        } catch (final SQLException e) {", "originalCommit": "a2c8f52658a82312948736ff68ae3ed83978a57f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDAxOTM4OA==", "url": "https://github.com/apache/shardingsphere/pull/6270#discussion_r450019388", "bodyText": "done", "author": "xbkaishui", "createdAt": "2020-07-06T06:58:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDAxNTg3MA=="}], "type": "inlineReview"}, {"oid": "20242332e365c065c561d1fe03aeebc60f260bff", "url": "https://github.com/apache/shardingsphere/commit/20242332e365c065c561d1fe03aeebc60f260bff", "message": "fix code review suggestions", "committedDate": "2020-07-06T06:57:31Z", "type": "commit"}, {"oid": "c463fe0cb74625acc4230aff9c2b607d95888806", "url": "https://github.com/apache/shardingsphere/commit/c463fe0cb74625acc4230aff9c2b607d95888806", "message": "fix code review suggestions", "committedDate": "2020-07-06T07:02:59Z", "type": "commit"}]}