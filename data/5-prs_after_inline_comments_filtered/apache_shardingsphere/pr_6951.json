{"pr_number": 6951, "pr_title": "Scaling refactor", "pr_createdAt": "2020-08-20T08:07:26Z", "pr_url": "https://github.com/apache/shardingsphere/pull/6951", "timeline": [{"oid": "cc6cb3f3e172fcbd1f3ba58fb6c8f1ca0933c7fe", "url": "https://github.com/apache/shardingsphere/commit/cc6cb3f3e172fcbd1f3ba58fb6c8f1ca0933c7fe", "message": "Refactor: refactor the typecast", "committedDate": "2020-08-20T02:27:09Z", "type": "commit"}, {"oid": "0ba2de95b65c53ddf5ea4cfa2b253b63f805deae", "url": "https://github.com/apache/shardingsphere/commit/0ba2de95b65c53ddf5ea4cfa2b253b63f805deae", "message": "Remove: remove the rawtypes annotation", "committedDate": "2020-08-20T02:37:48Z", "type": "commit"}, {"oid": "ff7041fd1ce68c34f6a6b3b1b7cb29676d735124", "url": "https://github.com/apache/shardingsphere/commit/ff7041fd1ce68c34f6a6b3b1b7cb29676d735124", "message": "Refactor: result will never be empty", "committedDate": "2020-08-20T02:45:29Z", "type": "commit"}, {"oid": "dfa19f8d5188bccc10886221a899609d707f64fc", "url": "https://github.com/apache/shardingsphere/commit/dfa19f8d5188bccc10886221a899609d707f64fc", "message": "Add: add test case for further refactor", "committedDate": "2020-08-20T08:05:07Z", "type": "commit"}, {"oid": "21c82a9427fed0db76015c3da6bd94425f5fe5f7", "url": "https://github.com/apache/shardingsphere/commit/21c82a9427fed0db76015c3da6bd94425f5fe5f7", "message": "Refactor: refactor the variables name", "committedDate": "2020-08-20T08:12:59Z", "type": "commit"}, {"oid": "d5b6b8615de83063a256d1bd720514cf45c128e2", "url": "https://github.com/apache/shardingsphere/commit/d5b6b8615de83063a256d1bd720514cf45c128e2", "message": "Add: add equals method for different DatabaseType", "committedDate": "2020-08-20T10:17:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mzg3NTkyOQ==", "url": "https://github.com/apache/shardingsphere/pull/6951#discussion_r473875929", "bodyText": "Please replace with @EqualsAndHashCode.", "author": "Lucas-307", "createdAt": "2020-08-20T10:48:11Z", "path": "shardingsphere-infra/shardingsphere-infra-common/src/main/java/org/apache/shardingsphere/infra/database/type/dialect/H2DatabaseType.java", "diffHunk": "@@ -49,4 +49,12 @@ public H2DataSourceMetaData getDataSourceMetaData(final String url, final String\n     public DatabaseType getTrunkDatabaseType() {\n         return DatabaseTypes.getActualDatabaseType(\"MySQL\");\n     }\n+\n+    @Override\n+    public boolean equals(final Object obj) {\n+        if (!(obj instanceof DatabaseType)) {\n+            return false;\n+        }\n+        return getName().equals(((DatabaseType) obj).getName());\n+    }", "originalCommit": "d5b6b8615de83063a256d1bd720514cf45c128e2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzkwMTY5OA==", "url": "https://github.com/apache/shardingsphere/pull/6951#discussion_r473901698", "bodyText": "thx for your guide", "author": "taojintianxia", "createdAt": "2020-08-20T11:32:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mzg3NTkyOQ=="}], "type": "inlineReview"}, {"oid": "b02ba735ff98ed75aab977ce08a3c61e2bb1c6b9", "url": "https://github.com/apache/shardingsphere/commit/b02ba735ff98ed75aab977ce08a3c61e2bb1c6b9", "message": "Refactor: refactor the equals method to a better way", "committedDate": "2020-08-20T10:57:36Z", "type": "commit"}, {"oid": "b02ba735ff98ed75aab977ce08a3c61e2bb1c6b9", "url": "https://github.com/apache/shardingsphere/commit/b02ba735ff98ed75aab977ce08a3c61e2bb1c6b9", "message": "Refactor: refactor the equals method to a better way", "committedDate": "2020-08-20T10:57:36Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDM3NjMyMw==", "url": "https://github.com/apache/shardingsphere/pull/6951#discussion_r474376323", "bodyText": "Please do not change original code if unnecessary.", "author": "terrymanu", "createdAt": "2020-08-21T02:41:08Z", "path": "shardingsphere-infra/shardingsphere-infra-common/src/main/java/org/apache/shardingsphere/infra/database/type/dialect/H2DatabaseType.java", "diffHunk": "@@ -28,12 +30,11 @@\n /**\n  * Database type of H2.\n  */\n+@EqualsAndHashCode\n public final class H2DatabaseType implements BranchDatabaseType {\n     \n-    @Override\n-    public String getName() {\n-        return \"H2\";\n-    }\n+    @Getter\n+    private final String name = \"H2\";", "originalCommit": "b02ba735ff98ed75aab977ce08a3c61e2bb1c6b9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDM3NjU4Nw==", "url": "https://github.com/apache/shardingsphere/pull/6951#discussion_r474376587", "bodyText": "Please remove useless blank line", "author": "terrymanu", "createdAt": "2020-08-21T02:42:18Z", "path": "shardingsphere-scaling/shardingsphere-scaling-core/src/test/java/org/apache/shardingsphere/scaling/core/config/JDBCDataSourceConfigurationTest.java", "diffHunk": "@@ -0,0 +1,52 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.shardingsphere.scaling.core.config;\n+\n+import org.apache.shardingsphere.infra.database.type.dialect.H2DatabaseType;\n+import org.apache.shardingsphere.infra.database.type.dialect.MariaDBDatabaseType;\n+import org.junit.Test;\n+\n+import static org.hamcrest.CoreMatchers.is;\n+import static org.hamcrest.CoreMatchers.not;\n+import static org.junit.Assert.assertThat;\n+\n+public final class JDBCDataSourceConfigurationTest {\n+    \n+    @Test\n+    public void assertJDBCDataSourceConfigurationEquals() {\n+        JDBCDataSourceConfiguration sourceConfiguration = new JDBCDataSourceConfiguration(\"jdbc:mysql://127.0.0.1:3306/test2?serverTimezone=UTC&useSSL=false\", \"root\", \"root\");\n+        JDBCDataSourceConfiguration targetConfiguration = new JDBCDataSourceConfiguration(\"jdbc:mysql://127.0.0.1:3306/test2?serverTimezone=UTC&useSSL=false\", \"root\", \"root\");\n+        assertThat(sourceConfiguration, is(targetConfiguration));\n+        \n+        sourceConfiguration.setDatabaseType(new MariaDBDatabaseType());\n+        targetConfiguration.setDatabaseType(new MariaDBDatabaseType());\n+        assertThat(sourceConfiguration, is(targetConfiguration));\n+    }\n+    \n+    @Test\n+    public void assertJDBCDataSourceConfigurationNotEquals() {\n+        JDBCDataSourceConfiguration sourceConfiguration = new JDBCDataSourceConfiguration(\"jdbc:mysql://127.0.0.1:3306/test2?serverTimezone=UTC&useSSL=false\", \"sa\", \"root\");\n+        JDBCDataSourceConfiguration targetConfiguration = new JDBCDataSourceConfiguration(\"jdbc:mysql://127.0.0.1:3306/test2?serverTimezone=UTC&useSSL=false\", \"root\", \"root\");\n+        assertThat(sourceConfiguration, not(targetConfiguration));\n+", "originalCommit": "b02ba735ff98ed75aab977ce08a3c61e2bb1c6b9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDU1MzMzMQ==", "url": "https://github.com/apache/shardingsphere/pull/6951#discussion_r474553331", "bodyText": "done", "author": "taojintianxia", "createdAt": "2020-08-21T09:05:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDM3NjU4Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDM3ODUyOQ==", "url": "https://github.com/apache/shardingsphere/pull/6951#discussion_r474378529", "bodyText": "maybe put @getter above class is better.", "author": "Lucas-307", "createdAt": "2020-08-21T02:49:58Z", "path": "shardingsphere-infra/shardingsphere-infra-common/src/main/java/org/apache/shardingsphere/infra/database/type/dialect/H2DatabaseType.java", "diffHunk": "@@ -28,12 +30,11 @@\n /**\n  * Database type of H2.\n  */\n+@EqualsAndHashCode\n public final class H2DatabaseType implements BranchDatabaseType {\n     \n-    @Override\n-    public String getName() {\n-        return \"H2\";\n-    }\n+    @Getter", "originalCommit": "b02ba735ff98ed75aab977ce08a3c61e2bb1c6b9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDU1MzQzMg==", "url": "https://github.com/apache/shardingsphere/pull/6951#discussion_r474553432", "bodyText": "done", "author": "taojintianxia", "createdAt": "2020-08-21T09:05:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDM3ODUyOQ=="}], "type": "inlineReview"}, {"oid": "224b32af6c789fb31def51af973c99455927cf65", "url": "https://github.com/apache/shardingsphere/commit/224b32af6c789fb31def51af973c99455927cf65", "message": "Remove: remove useless blank line", "committedDate": "2020-08-21T04:54:41Z", "type": "commit"}, {"oid": "403de6c3c6ac14e99aaf06b9b5ee7a21ef5083a4", "url": "https://github.com/apache/shardingsphere/commit/403de6c3c6ac14e99aaf06b9b5ee7a21ef5083a4", "message": "Refactor: rever the code to last change", "committedDate": "2020-08-21T09:36:44Z", "type": "commit"}, {"oid": "6fc5079abff06395ffdf9cf3183d4c34a4bdc970", "url": "https://github.com/apache/shardingsphere/commit/6fc5079abff06395ffdf9cf3183d4c34a4bdc970", "message": "Refactor: remove useless annotation", "committedDate": "2020-08-21T09:38:20Z", "type": "commit"}, {"oid": "afb1ef703e18d701b1b34f37f400384faac88ffe", "url": "https://github.com/apache/shardingsphere/commit/afb1ef703e18d701b1b34f37f400384faac88ffe", "message": "Refactor: roll back the annotation", "committedDate": "2020-08-21T09:39:50Z", "type": "commit"}, {"oid": "bad85fcf3743f71bed7875f6ce3950952e30a1ab", "url": "https://github.com/apache/shardingsphere/commit/bad85fcf3743f71bed7875f6ce3950952e30a1ab", "message": "Refactor: update the corresponding test", "committedDate": "2020-08-21T09:41:36Z", "type": "commit"}, {"oid": "e08994f8fe3e38aad64da3c05e98e627fc5813f1", "url": "https://github.com/apache/shardingsphere/commit/e08994f8fe3e38aad64da3c05e98e627fc5813f1", "message": "Remove: remove the uesless annotation", "committedDate": "2020-08-21T09:44:16Z", "type": "commit"}, {"oid": "31e4beb6dadfddf7aea3a44729da7381fe463c44", "url": "https://github.com/apache/shardingsphere/commit/31e4beb6dadfddf7aea3a44729da7381fe463c44", "message": "Add: add back the intention", "committedDate": "2020-08-21T09:45:16Z", "type": "commit"}]}