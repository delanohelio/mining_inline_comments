{"pr_number": 8814, "pr_title": "BAEL-2552 - spatialguru.net@gmail.com", "pr_createdAt": "2020-03-05T08:06:58Z", "pr_url": "https://github.com/eugenp/tutorials/pull/8814", "timeline": [{"oid": "9d624366257001040d62ddb03b1e8d158a3f57c6", "url": "https://github.com/eugenp/tutorials/commit/9d624366257001040d62ddb03b1e8d158a3f57c6", "message": "BAEL-2552 - Add controller and unit test showing how to set timeouts", "committedDate": "2020-03-05T08:04:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQzNTgzOA==", "url": "https://github.com/eugenp/tutorials/pull/8814#discussion_r388435838", "bodyText": "this sounds a bit hacky, the best would be to create a junit rule and before the call just record rule.expect(ReadTimeoutException.class)", "author": "rpvilao", "createdAt": "2020-03-05T17:08:09Z", "path": "spring-5-webflux/src/test/java/com/baeldung/spring/serverconfig/TimeoutLiveTest.java", "diffHunk": "@@ -0,0 +1,88 @@\n+package com.baeldung.spring.serverconfig;\n+\n+import java.util.concurrent.TimeUnit;\n+\n+import javax.net.ssl.SSLException;\n+\n+import org.junit.Assert;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.springframework.boot.test.context.SpringBootTest;\n+import org.springframework.boot.test.context.SpringBootTest.WebEnvironment;\n+import org.springframework.http.client.reactive.ReactorClientHttpConnector;\n+import org.springframework.test.annotation.DirtiesContext;\n+import org.springframework.test.context.junit4.SpringRunner;\n+import org.springframework.test.web.reactive.server.WebTestClient;\n+\n+import io.netty.channel.ChannelOption;\n+import io.netty.handler.ssl.SslContext;\n+import io.netty.handler.ssl.SslContextBuilder;\n+import io.netty.handler.ssl.util.InsecureTrustManagerFactory;\n+import io.netty.handler.timeout.ReadTimeoutException;\n+import io.netty.handler.timeout.ReadTimeoutHandler;\n+import io.netty.handler.timeout.WriteTimeoutHandler;\n+import reactor.netty.http.client.HttpClient;\n+import reactor.netty.tcp.TcpClient;\n+\n+@RunWith(SpringRunner.class)\n+@SpringBootTest(webEnvironment = WebEnvironment.DEFINED_PORT)\n+@DirtiesContext\n+public class TimeoutLiveTest {\n+\n+    private static final String BASE_URL = \"https://localhost:8443\";\n+    private static final int TIMEOUT_MILLIS = 2000;\n+\n+    private WebTestClient webTestClient;\n+\n+    @Before\n+    public void setup() throws SSLException {\n+        webTestClient = WebTestClient.bindToServer(getConnector())\n+                                     .baseUrl(BASE_URL)\n+                                     .build();\n+    }\n+\n+    @Test\n+    public void shouldTimeout() {", "originalCommit": "9d624366257001040d62ddb03b1e8d158a3f57c6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ1ODg0Ng==", "url": "https://github.com/eugenp/tutorials/pull/8814#discussion_r388458846", "bodyText": "Changes have been made.", "author": "markathomas", "createdAt": "2020-03-05T17:49:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQzNTgzOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQzNjEzNw==", "url": "https://github.com/eugenp/tutorials/pull/8814#discussion_r388436137", "bodyText": "I would remove this since the exception fails the test, and it's better to have that reported then to hide it", "author": "rpvilao", "createdAt": "2020-03-05T17:08:42Z", "path": "spring-5-webflux/src/test/java/com/baeldung/spring/serverconfig/TimeoutLiveTest.java", "diffHunk": "@@ -0,0 +1,88 @@\n+package com.baeldung.spring.serverconfig;\n+\n+import java.util.concurrent.TimeUnit;\n+\n+import javax.net.ssl.SSLException;\n+\n+import org.junit.Assert;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.springframework.boot.test.context.SpringBootTest;\n+import org.springframework.boot.test.context.SpringBootTest.WebEnvironment;\n+import org.springframework.http.client.reactive.ReactorClientHttpConnector;\n+import org.springframework.test.annotation.DirtiesContext;\n+import org.springframework.test.context.junit4.SpringRunner;\n+import org.springframework.test.web.reactive.server.WebTestClient;\n+\n+import io.netty.channel.ChannelOption;\n+import io.netty.handler.ssl.SslContext;\n+import io.netty.handler.ssl.SslContextBuilder;\n+import io.netty.handler.ssl.util.InsecureTrustManagerFactory;\n+import io.netty.handler.timeout.ReadTimeoutException;\n+import io.netty.handler.timeout.ReadTimeoutHandler;\n+import io.netty.handler.timeout.WriteTimeoutHandler;\n+import reactor.netty.http.client.HttpClient;\n+import reactor.netty.tcp.TcpClient;\n+\n+@RunWith(SpringRunner.class)\n+@SpringBootTest(webEnvironment = WebEnvironment.DEFINED_PORT)\n+@DirtiesContext\n+public class TimeoutLiveTest {\n+\n+    private static final String BASE_URL = \"https://localhost:8443\";\n+    private static final int TIMEOUT_MILLIS = 2000;\n+\n+    private WebTestClient webTestClient;\n+\n+    @Before\n+    public void setup() throws SSLException {\n+        webTestClient = WebTestClient.bindToServer(getConnector())\n+                                     .baseUrl(BASE_URL)\n+                                     .build();\n+    }\n+\n+    @Test\n+    public void shouldTimeout() {\n+        try {\n+            webTestClient.get()\n+              .uri(\"/timeout/{timeout}\", 3)\n+              .exchange();\n+            Assert.fail();\n+        } catch (ReadTimeoutException ignore) {\n+        }\n+    }\n+\n+    @Test\n+    public void shouldNotTimeout() {\n+        try {\n+            WebTestClient.ResponseSpec response = webTestClient.get()\n+              .uri(\"/timeout/{timeout}\", 1)\n+              .exchange();\n+            response.expectStatus()\n+              .isOk()\n+              .expectBody(String.class)\n+              .isEqualTo(\"OK\");\n+        } catch (ReadTimeoutException e) {", "originalCommit": "9d624366257001040d62ddb03b1e8d158a3f57c6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ1ODYwOA==", "url": "https://github.com/eugenp/tutorials/pull/8814#discussion_r388458608", "bodyText": "Changes have been made.", "author": "markathomas", "createdAt": "2020-03-05T17:48:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQzNjEzNw=="}], "type": "inlineReview"}, {"oid": "75f7aa3b88d8c6d9a6dc406af882e5946a743eca", "url": "https://github.com/eugenp/tutorials/commit/75f7aa3b88d8c6d9a6dc406af882e5946a743eca", "message": "BAEL-2552 - use JUnit @Rule", "committedDate": "2020-03-05T17:47:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ2OTgwNw==", "url": "https://github.com/eugenp/tutorials/pull/8814#discussion_r388469807", "bodyText": "this can now be removed because if the exception is not thrown, JUnit it will fail it since it was expecting it", "author": "rpvilao", "createdAt": "2020-03-05T18:08:53Z", "path": "spring-5-webflux/src/test/java/com/baeldung/spring/serverconfig/TimeoutLiveTest.java", "diffHunk": "@@ -44,28 +49,22 @@ public void setup() throws SSLException {\n \n     @Test\n     public void shouldTimeout() {\n-        try {\n-            webTestClient.get()\n-              .uri(\"/timeout/{timeout}\", 3)\n-              .exchange();\n-            Assert.fail();\n-        } catch (ReadTimeoutException ignore) {\n-        }\n+        exception.expect(ReadTimeoutException.class);\n+        webTestClient.get()\n+          .uri(\"/timeout/{timeout}\", 3)\n+          .exchange();\n+        Assert.fail();", "originalCommit": "75f7aa3b88d8c6d9a6dc406af882e5946a743eca", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ3MjA1NA==", "url": "https://github.com/eugenp/tutorials/pull/8814#discussion_r388472054", "bodyText": "Good point.  I forgot to remove that.  It is done.", "author": "markathomas", "createdAt": "2020-03-05T18:13:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ2OTgwNw=="}], "type": "inlineReview"}, {"oid": "2a409ab3494d3df192a6e36c61c8ebfc087057b0", "url": "https://github.com/eugenp/tutorials/commit/2a409ab3494d3df192a6e36c61c8ebfc087057b0", "message": "BAEL-2552 - Remove unnecessary line", "committedDate": "2020-03-05T18:13:08Z", "type": "commit"}]}