{"pr_number": 10351, "pr_title": "Selectively enforce lookup class package check", "pr_createdAt": "2020-08-06T18:48:49Z", "pr_url": "https://github.com/eclipse-openj9/openj9/pull/10351", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzAyNDEzMQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/10351#discussion_r467024131", "bodyText": "@JasonFengJ9 I would rather the callers of the Lookup ctors made an explicit choice to either pass the default or set the as required for their call.\nA method that passes thru and drops the argument is confusing and makes the code harder to reason about.\nThis method should be to get the default for the release - that's why it has Default in it's name :)\nprivate static boolean lookupJLIPackageCheckDefault()", "author": "DanHeidinga", "createdAt": "2020-08-07T12:59:09Z", "path": "jcl/src/java.base/share/classes/java/lang/invoke/MethodHandles.java", "diffHunk": "@@ -215,12 +215,23 @@\n \t\t\taccessMode = lookupMode;\n \t\t}\n \t\t\n+\t\t/* For Java 15, the default is not to check for the \"java.lang.invoke\" package.\n+\t\t * For earlier releases, these lookups are illegal\n+\t\t  */\n+\t\tprivate static boolean lookupJLIPackageCheckDefault(boolean doCheck) {\n+\t\t\t/*[IF Java15]\n+\t\t\treturn false;", "originalCommit": "569fcd3b508b99def7c95a2592303379fe228ddf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzA2Mzc4Mw==", "url": "https://github.com/eclipse-openj9/openj9/pull/10351#discussion_r467063783", "bodyText": "Thanks @DanHeidinga , made following changes, please have another look.\n\nRemoved the helper constructor Lookup(Class<?> lookupClass, int lookupMode, boolean doCheck);\nAdded comments to Lookup(Class<?> lookupClass, boolean performSecurityCheck) and stated that the incoming performSecurityCheck is expected to be false, otherwise Lookup(Class<?> lookupClass) can be used instead.\nlookupJLIPackageCheckDefault() is used by three ctors to perform the package check for pre-JDK15 levels, and skip it for JDK15 and beyond.", "author": "JasonFengJ9", "createdAt": "2020-08-07T14:08:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzAyNDEzMQ=="}], "type": "inlineReview"}, {"oid": "35641b4a37a92a9de01f912a5d779d759ea38ec9", "url": "https://github.com/eclipse-openj9/openj9/commit/35641b4a37a92a9de01f912a5d779d759ea38ec9", "message": "Selectively enforce lookup class package check\n\nOnly following APIs are subject to lookup class package check (matching\nRI behaviours):\n\nMethodHandles.Lookup.in\u200b(Class<?> lookupClass)\nMethodHandles.Lookup.dropLookupMode\u200b(int modeToDrop)\nMethodHandles.Lookup.privateLookupIn\u200b(Class<?> targetClass,\nMethodHandles.Lookup caller)\nThe change only applies to JDK15. The package check stays same for\npre-JDK15 levels.\n\nSigned-off-by: Jason Feng <fengj@ca.ibm.com>", "committedDate": "2020-08-07T14:03:37Z", "type": "forcePushed"}, {"oid": "514b23b3dae59d5dae3916dddbaa1b2abc86722b", "url": "https://github.com/eclipse-openj9/openj9/commit/514b23b3dae59d5dae3916dddbaa1b2abc86722b", "message": "Selectively enforce lookup class package check\n\nOnly following APIs are subject to lookup class package check (matching\nRI behaviours):\n\nMethodHandles.Lookup.in\u200b(Class<?> lookupClass)\nMethodHandles.Lookup.dropLookupMode\u200b(int modeToDrop)\nMethodHandles.Lookup.privateLookupIn\u200b(Class<?> targetClass,\nMethodHandles.Lookup caller)\nThe change only applies to JDK15. The package check stays same for\npre-JDK15 levels.\n\nSigned-off-by: Jason Feng <fengj@ca.ibm.com>", "committedDate": "2020-08-07T18:35:35Z", "type": "commit"}, {"oid": "514b23b3dae59d5dae3916dddbaa1b2abc86722b", "url": "https://github.com/eclipse-openj9/openj9/commit/514b23b3dae59d5dae3916dddbaa1b2abc86722b", "message": "Selectively enforce lookup class package check\n\nOnly following APIs are subject to lookup class package check (matching\nRI behaviours):\n\nMethodHandles.Lookup.in\u200b(Class<?> lookupClass)\nMethodHandles.Lookup.dropLookupMode\u200b(int modeToDrop)\nMethodHandles.Lookup.privateLookupIn\u200b(Class<?> targetClass,\nMethodHandles.Lookup caller)\nThe change only applies to JDK15. The package check stays same for\npre-JDK15 levels.\n\nSigned-off-by: Jason Feng <fengj@ca.ibm.com>", "committedDate": "2020-08-07T18:35:35Z", "type": "forcePushed"}]}