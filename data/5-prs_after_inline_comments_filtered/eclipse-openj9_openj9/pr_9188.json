{"pr_number": 9188, "pr_title": "Refactoring the code of setting assertion status in ClassLoader", "pr_createdAt": "2020-04-08T20:00:16Z", "pr_url": "https://github.com/eclipse-openj9/openj9/pull/9188", "timeline": [{"oid": "77214a2e4f18277e4e01018dffbe23da4e89c2b6", "url": "https://github.com/eclipse-openj9/openj9/commit/77214a2e4f18277e4e01018dffbe23da4e89c2b6", "message": "Refactoring the code with the assertion status\n\nthe change is to match the behavior of RI by replacing\nall public methods (used for setting assertion status)\nwith private methods when calling in\ninitializeClassLoaderAssertStatus() given that these\npublic methods overridden by sub-classloaders will be\ninvoked during the  initialization of sub-classloaders.\n\nFixes: #9058\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>", "committedDate": "2020-04-09T00:31:26Z", "type": "forcePushed"}, {"oid": "7b79cfbe1e204b4380613265ec624f455907ddaf", "url": "https://github.com/eclipse-openj9/openj9/commit/7b79cfbe1e204b4380613265ec624f455907ddaf", "message": "Refactoring the code with the assertion status\n\nthe change is to match the behavior of RI by replacing\nall public methods (used for setting assertion status)\nwith private methods when calling in\ninitializeClassLoaderAssertStatus() given that these\npublic methods overridden by sub-classloaders will be\ninvoked during the  initialization of sub-classloaders.\n\nFixes: #9058\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>", "committedDate": "2020-04-09T00:41:27Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTkzMDI3Mg==", "url": "https://github.com/eclipse-openj9/openj9/pull/9188#discussion_r405930272", "bodyText": "These methods can set a boolean field, like failed = true, and the main method can use it to print PASSED or FAILED, which can then be checked in the success and failure conditions of the cmdLineTest.", "author": "pshipton", "createdAt": "2020-04-09T03:05:24Z", "path": "test/functional/cmdLineTests/classLoaderTest/src/org/openj9/test/assertionstatus/EnableAssertionStatusTest.java", "diffHunk": "@@ -0,0 +1,54 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020, 2020 IBM Corp. and others\n+ *\n+ * This program and the accompanying materials are made available under\n+ * the terms of the Eclipse Public License 2.0 which accompanies this\n+ * distribution and is available at https://www.eclipse.org/legal/epl-2.0/\n+ * or the Apache License, Version 2.0 which accompanies this distribution and\n+ * is available at https://www.apache.org/licenses/LICENSE-2.0.\n+ *\n+ * This Source Code may also be made available under the following\n+ * Secondary Licenses when the conditions for such availability set\n+ * forth in the Eclipse Public License, v. 2.0 are satisfied: GNU\n+ * General Public License, version 2 with the GNU Classpath\n+ * Exception [1] and GNU General Public License, version 2 with the\n+ * OpenJDK Assembly Exception [2].\n+ *\n+ * [1] https://www.gnu.org/software/classpath/license.html\n+ * [2] http://openjdk.java.net/legal/assembly-exception.html\n+ *\n+ * SPDX-License-Identifier: EPL-2.0 OR Apache-2.0 OR GPL-2.0 WITH Classpath-exception-2.0 OR LicenseRef-GPL-2.0 WITH Assembly-exception\n+ *******************************************************************************/\n+\n+package org.openj9.test.assertionstatus;\n+\n+/* The intention of this test is to verify whether these public methods (overridden by\n+ * the inner class loader) are not directly invoked during the initialization so as to\n+ * match the behavior of RI. \n+ */\n+\n+class SubClassLoader extends ClassLoader {\n+\t\n+\tclass InnerClassLoader extends SubClassLoader {\n+\t\t\n+\t\tpublic void setDefaultAssertionStatus(boolean enable) {\n+\t\t\tnew Throwable().printStackTrace();", "originalCommit": "7b79cfbe1e204b4380613265ec624f455907ddaf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTk0NDkwOQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/9188#discussion_r405944909", "bodyText": "Agreed and updated the test code against the suggestion above.", "author": "ChengJin01", "createdAt": "2020-04-09T04:08:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTkzMDI3Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTkzMDMxNw==", "url": "https://github.com/eclipse-openj9/openj9/pull/9188#discussion_r405930317", "bodyText": "Pls add a new line", "author": "pshipton", "createdAt": "2020-04-09T03:05:35Z", "path": "test/functional/cmdLineTests/classLoaderTest/src/org/openj9/test/assertionstatus/EnableAssertionStatusTest.java", "diffHunk": "@@ -0,0 +1,54 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020, 2020 IBM Corp. and others\n+ *\n+ * This program and the accompanying materials are made available under\n+ * the terms of the Eclipse Public License 2.0 which accompanies this\n+ * distribution and is available at https://www.eclipse.org/legal/epl-2.0/\n+ * or the Apache License, Version 2.0 which accompanies this distribution and\n+ * is available at https://www.apache.org/licenses/LICENSE-2.0.\n+ *\n+ * This Source Code may also be made available under the following\n+ * Secondary Licenses when the conditions for such availability set\n+ * forth in the Eclipse Public License, v. 2.0 are satisfied: GNU\n+ * General Public License, version 2 with the GNU Classpath\n+ * Exception [1] and GNU General Public License, version 2 with the\n+ * OpenJDK Assembly Exception [2].\n+ *\n+ * [1] https://www.gnu.org/software/classpath/license.html\n+ * [2] http://openjdk.java.net/legal/assembly-exception.html\n+ *\n+ * SPDX-License-Identifier: EPL-2.0 OR Apache-2.0 OR GPL-2.0 WITH Classpath-exception-2.0 OR LicenseRef-GPL-2.0 WITH Assembly-exception\n+ *******************************************************************************/\n+\n+package org.openj9.test.assertionstatus;\n+\n+/* The intention of this test is to verify whether these public methods (overridden by\n+ * the inner class loader) are not directly invoked during the initialization so as to\n+ * match the behavior of RI. \n+ */\n+\n+class SubClassLoader extends ClassLoader {\n+\t\n+\tclass InnerClassLoader extends SubClassLoader {\n+\t\t\n+\t\tpublic void setDefaultAssertionStatus(boolean enable) {\n+\t\t\tnew Throwable().printStackTrace();\n+\t\t}\n+\t\t\n+\t\tpublic void setPackageAssertionStatus(String pname, boolean enable) {\n+\t\t\tnew Throwable().printStackTrace();\n+\t\t}\n+\t\t\n+\t\tpublic void setClassAssertionStatus(String cname, boolean enable) {\n+\t\t\tnew Throwable().printStackTrace();\n+\t\t}\n+\t}\n+}\n+\n+public class EnableAssertionStatusTest {\n+\t\n+\tpublic static void main(String[] args) throws Throwable {\n+\t\tSubClassLoader subCldr = new SubClassLoader();\n+\t\tsubCldr.new InnerClassLoader();\n+\t}\n+}", "originalCommit": "7b79cfbe1e204b4380613265ec624f455907ddaf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTk0NDk0NA==", "url": "https://github.com/eclipse-openj9/openj9/pull/9188#discussion_r405944944", "bodyText": "Added.", "author": "ChengJin01", "createdAt": "2020-04-09T04:08:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTkzMDMxNw=="}], "type": "inlineReview"}, {"oid": "14b63547146e8f01eeba2cec62f7a0ae9aa5c10e", "url": "https://github.com/eclipse-openj9/openj9/commit/14b63547146e8f01eeba2cec62f7a0ae9aa5c10e", "message": "Refactoring the code with the assertion status\n\nthe change is to match the behavior of RI by replacing\nall public methods (used for setting assertion status)\nwith private methods when calling in\ninitializeClassLoaderAssertStatus() given that these\npublic methods overridden by sub-classloaders will be\ninvoked during the  initialization of sub-classloaders.\n\nFixes: #9058\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>", "committedDate": "2020-04-09T04:05:29Z", "type": "forcePushed"}, {"oid": "19cf28b4209a47a9ebb0bd5e378c668b4d9f428c", "url": "https://github.com/eclipse-openj9/openj9/commit/19cf28b4209a47a9ebb0bd5e378c668b4d9f428c", "message": "Refactoring the code with the assertion status\n\nthe change is to match the behavior of RI by replacing\nall public methods (used for setting assertion status)\nwith private methods when calling in\ninitializeClassLoaderAssertStatus() given that these\npublic methods overridden by sub-classloaders will be\ninvoked during the  initialization of sub-classloaders.\n\nFixes: #9058\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>", "committedDate": "2020-04-09T06:46:30Z", "type": "forcePushed"}, {"oid": "974c6b030477db3315bc6672179bb3f7e101f4dd", "url": "https://github.com/eclipse-openj9/openj9/commit/974c6b030477db3315bc6672179bb3f7e101f4dd", "message": "Refactoring the code with the assertion status\n\nthe change is to match the behavior of RI by replacing\nall public methods (used for setting assertion status)\nwith private methods when calling in\ninitializeClassLoaderAssertStatus() given that these\npublic methods overridden by sub-classloaders will be\ninvoked during the  initialization of sub-classloaders.\n\nFixes: #9058\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>", "committedDate": "2020-04-09T14:36:28Z", "type": "forcePushed"}, {"oid": "8d65611a09835e6ff1ef028875d8be19f6994c91", "url": "https://github.com/eclipse-openj9/openj9/commit/8d65611a09835e6ff1ef028875d8be19f6994c91", "message": "Refactoring the code with the assertion status\n\nthe change is to match the behavior of RI by replacing\nall public methods (used for setting assertion status)\nwith private methods when calling in\ninitializeClassLoaderAssertStatus() given that these\npublic methods overridden by sub-classloaders will be\ninvoked during the  initialization of sub-classloaders.\n\nFixes: #9058\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>", "committedDate": "2020-04-09T14:37:07Z", "type": "commit"}, {"oid": "8d65611a09835e6ff1ef028875d8be19f6994c91", "url": "https://github.com/eclipse-openj9/openj9/commit/8d65611a09835e6ff1ef028875d8be19f6994c91", "message": "Refactoring the code with the assertion status\n\nthe change is to match the behavior of RI by replacing\nall public methods (used for setting assertion status)\nwith private methods when calling in\ninitializeClassLoaderAssertStatus() given that these\npublic methods overridden by sub-classloaders will be\ninvoked during the  initialization of sub-classloaders.\n\nFixes: #9058\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>", "committedDate": "2020-04-09T14:37:07Z", "type": "forcePushed"}]}