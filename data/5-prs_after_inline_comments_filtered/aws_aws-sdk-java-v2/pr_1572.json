{"pr_number": 1572, "pr_title": "Add scheme to destination region endpoint", "pr_createdAt": "2020-01-03T19:07:39Z", "pr_url": "https://github.com/aws/aws-sdk-java-v2/pull/1572", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzQ2NDI1Mw==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1572#discussion_r363464253", "bodyText": "Can we pull the client configured protocol in an interceptor?", "author": "spfink", "createdAt": "2020-01-06T20:16:06Z", "path": "services/ec2/src/main/java/software/amazon/awssdk/services/ec2/transform/internal/GeneratePreSignUrlInterceptor.java", "diffHunk": "@@ -152,6 +152,10 @@ private URI createEndpoint(String regionName, String serviceName) {\n                                     .build();\n         }\n \n-        return Ec2Client.serviceMetadata().endpointFor(region);\n+        URI endpoint = Ec2Client.serviceMetadata().endpointFor(region);\n+        if (endpoint.getScheme() == null) {\n+            return URI.create(\"https://\" + endpoint);", "originalCommit": "8e0e31aec49257d07dae9779fc2b03dbfc153b7e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzUyNjI1MA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1572#discussion_r363526250", "bodyText": "I considered this, but given that this URL is used by EC2 and not consumed by the customer/client, it doesn't really make sense to be anything other than HTTPS. It's also the same behavior as V1 https://github.com/aws/aws-sdk-java/blob/7b1e5b87b0bf03456df9e77716b14731adf9a7a7/aws-java-sdk-ec2/src/main/java/com/amazonaws/services/ec2/model/transform/GeneratePreSignUrlRequestHandler.java#L145-L147", "author": "dagnir", "createdAt": "2020-01-06T23:10:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzQ2NDI1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzUyNzQwOQ==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1572#discussion_r363527409", "bodyText": "+1 on pulling client configured protocol. Customers might use this against a mock server (maybe for testing purpose) which only supports HTTP. I think we should honor the customer configuration.", "author": "zoewangg", "createdAt": "2020-01-06T23:14:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzQ2NDI1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzUyODM1OQ==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1572#discussion_r363528359", "bodyText": "I'm not sure I understand the use case. The presigned URL is explicitly used by the EC2 service to presumably pull the snapshot for cross region copying, it doesn't affect where or how the actual HTTP request being modified is sent.", "author": "dagnir", "createdAt": "2020-01-06T23:18:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzQ2NDI1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzUzMDQyNQ==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1572#discussion_r363530425", "bodyText": "I meant there might be some mockEc2 server library available for customers to test their applications. The mockEc2 server might have a similar copySnapshot function to mimic the real service's behavior. This use case might be rare or doesn't exist at all, but I still think it'd be better to honor the customer configuration.", "author": "zoewangg", "createdAt": "2020-01-06T23:25:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzQ2NDI1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzUzMTg2Mw==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1572#discussion_r363531863", "bodyText": "I disagree that it's important in this case; we've had the same behavior in v1 for a long time without issue, the same with RDS. Technically the protocol configured on the client specifies the protocol it speaks to service we're calling the API on anyway, I don't think it necessarily governs things like the presigned URL(s) it generates.\nIMO it's also a potential dangerous if the customer happens to being using HTTP and now their EBS snapshots are also being transferred in plaintext.", "author": "dagnir", "createdAt": "2020-01-06T23:31:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzQ2NDI1Mw=="}], "type": "inlineReview"}, {"oid": "c0e89f6357b0a03159a72218f4d428428bf16c98", "url": "https://github.com/aws/aws-sdk-java-v2/commit/c0e89f6357b0a03159a72218f4d428428bf16c98", "message": "Add scheme to destination region endpoint\n\nFixes #1564", "committedDate": "2020-01-07T21:12:34Z", "type": "forcePushed"}, {"oid": "6ac80f1343004c6a8419b7a14eecb7ff459ec39e", "url": "https://github.com/aws/aws-sdk-java-v2/commit/6ac80f1343004c6a8419b7a14eecb7ff459ec39e", "message": "Add scheme to destination region endpoint\n\nFixes #1564", "committedDate": "2020-01-08T01:02:00Z", "type": "commit"}, {"oid": "6ac80f1343004c6a8419b7a14eecb7ff459ec39e", "url": "https://github.com/aws/aws-sdk-java-v2/commit/6ac80f1343004c6a8419b7a14eecb7ff459ec39e", "message": "Add scheme to destination region endpoint\n\nFixes #1564", "committedDate": "2020-01-08T01:02:00Z", "type": "forcePushed"}]}