{"pr_number": 2176, "pr_title": "Expose event-type in stream interface", "pr_createdAt": "2020-12-02T01:26:14Z", "pr_url": "https://github.com/aws/aws-sdk-java-v2/pull/2176", "timeline": [{"oid": "c39678a67a5b856ec0c0712432a1d0148eea5976", "url": "https://github.com/aws/aws-sdk-java-v2/commit/c39678a67a5b856ec0c0712432a1d0148eea5976", "message": "Expose event-type in stream interface", "committedDate": "2020-12-02T20:40:56Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDQ3OTk5NQ==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2176#discussion_r534479995", "bodyText": "nit: can we extract it to a separate method?", "author": "zoewangg", "createdAt": "2020-12-02T21:04:05Z", "path": "codegen/src/main/java/software/amazon/awssdk/codegen/poet/model/AwsServiceModel.java", "diffHunk": "@@ -203,6 +210,30 @@ private void addEventSupport(TypeSpec.Builder specBuilder, ShapeModel eventStrea\n \n         specBuilder.addSuperinterface(eventStreamClassName);\n \n+        // This is hacky, but there's no better solution without\n+        // extensive refactoring. We basically need to know if any of\n+        // the *event types* within this even stream have this\n+        // customization enabled, which requires knowing the\n+        // MemberModel that has this given shape.\n+        boolean usesLegacyScheme = false;\n+        String eventName = null;\n+        for (MemberModel member : eventStream.getMembers()) {\n+            if (member.getShape().equals(shapeModel) && helper.useLegacyGenerationScheme(member)) {\n+                usesLegacyScheme = true;\n+                eventName = member.getName();\n+                break;\n+            }\n+        }\n+\n+        if (usesLegacyScheme) {\n+            specBuilder.addMethod(MethodSpec.methodBuilder(\"sdkEventType\")\n+                       .addAnnotation(Override.class)\n+                       .addModifiers(PUBLIC)\n+                       .returns(String.class)\n+                       .addStatement(\"return $S\", eventName)\n+                       .build());\n+        }\n+", "originalCommit": "c39678a67a5b856ec0c0712432a1d0148eea5976", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDQ4MDM2Mg==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2176#discussion_r534480362", "bodyText": "Should we use enum for the type?", "author": "zoewangg", "createdAt": "2020-12-02T21:04:43Z", "path": "codegen/src/test/resources/software/amazon/awssdk/codegen/poet/model/sharedstream/eventstream.java", "diffHunk": "@@ -41,6 +41,13 @@ public void accept(StreamDeathsResponseHandler.Visitor visitor) {\n         return DefaultPerson.builder();\n     }\n \n+    /**\n+     * The type of this event. Corresponds to the {@code :event-type} header on the Message.\n+     */\n+    default String sdkEventType() {", "originalCommit": "c39678a67a5b856ec0c0712432a1d0148eea5976", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDQ4NDk4OA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2176#discussion_r534484988", "bodyText": "What's the benefit?", "author": "dagnir", "createdAt": "2020-12-02T21:13:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDQ4MDM2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDQ4Njc3NQ==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2176#discussion_r534486775", "bodyText": "It'll be easier to enumerate all types when they do switch, whereas with string, they will need to manually check the code to see all available types.", "author": "zoewangg", "createdAt": "2020-12-02T21:16:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDQ4MDM2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDQ4ODEyNg==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2176#discussion_r534488126", "bodyText": "Sounds good.", "author": "dagnir", "createdAt": "2020-12-02T21:19:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDQ4MDM2Mg=="}], "type": "inlineReview"}, {"oid": "03b7c2e644ea0b05fed3dd6f5a32f0a98577f5bd", "url": "https://github.com/aws/aws-sdk-java-v2/commit/03b7c2e644ea0b05fed3dd6f5a32f0a98577f5bd", "message": "Expose event-type in stream interface", "committedDate": "2020-12-03T01:03:02Z", "type": "forcePushed"}, {"oid": "de5700aa46ce3d2800c192d6b78f1b5861f615e6", "url": "https://github.com/aws/aws-sdk-java-v2/commit/de5700aa46ce3d2800c192d6b78f1b5861f615e6", "message": "Expose event-type in stream interface", "committedDate": "2020-12-03T01:18:58Z", "type": "forcePushed"}, {"oid": "425ac63e9482217f51bf9b00fb450c45a6768b8b", "url": "https://github.com/aws/aws-sdk-java-v2/commit/425ac63e9482217f51bf9b00fb450c45a6768b8b", "message": "Expose event-type in stream interface", "committedDate": "2020-12-03T01:33:30Z", "type": "forcePushed"}, {"oid": "a839ef820a67def6f82d390420d860c8950d9b82", "url": "https://github.com/aws/aws-sdk-java-v2/commit/a839ef820a67def6f82d390420d860c8950d9b82", "message": "Expose event-type in stream interface", "committedDate": "2020-12-03T02:37:20Z", "type": "forcePushed"}, {"oid": "79caff91b8635b38412fde819f4e2d7e3732236d", "url": "https://github.com/aws/aws-sdk-java-v2/commit/79caff91b8635b38412fde819f4e2d7e3732236d", "message": "Multiple fixes\n\n - Use C2j name as string value of EventType enum\n - Use NamingStrategy to generate event class name and builder method\n - Fix Javadoc notation", "committedDate": "2020-12-04T01:41:22Z", "type": "forcePushed"}, {"oid": "32cd8d61bc470ef325477fa29af90d5b8c12b2b4", "url": "https://github.com/aws/aws-sdk-java-v2/commit/32cd8d61bc470ef325477fa29af90d5b8c12b2b4", "message": "Expose event-type in stream interface", "committedDate": "2020-12-04T01:48:13Z", "type": "commit"}, {"oid": "32cd8d61bc470ef325477fa29af90d5b8c12b2b4", "url": "https://github.com/aws/aws-sdk-java-v2/commit/32cd8d61bc470ef325477fa29af90d5b8c12b2b4", "message": "Expose event-type in stream interface", "committedDate": "2020-12-04T01:48:13Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM1Njk5OQ==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2176#discussion_r536356999", "bodyText": "Typo? EventStream$EventTwo -> EventStream#EventTwo", "author": "zoewangg", "createdAt": "2020-12-04T20:19:42Z", "path": "codegen/src/test/resources/software/amazon/awssdk/codegen/poet/eventstream/defaulteventtwo.java", "diffHunk": "@@ -1,14 +1,16 @@\n-package software.amazon.awssdk.services.jsonprotocoltests.model.eventstream;\n+package software.amazon.awssdk.services.json.model.eventstream;\n \n import software.amazon.awssdk.annotations.Generated;\n import software.amazon.awssdk.annotations.SdkInternalApi;\n-import software.amazon.awssdk.services.jsonprotocoltests.model.EventStreamOperationResponseHandler;\n-import software.amazon.awssdk.services.jsonprotocoltests.model.EventTwo;\n+import software.amazon.awssdk.services.json.model.EventStream;\n+import software.amazon.awssdk.services.json.model.EventStreamOperationResponseHandler;\n+import software.amazon.awssdk.services.json.model.EventStreamOperationWithOnlyOutputResponseHandler;\n+import software.amazon.awssdk.services.json.model.EventTwo;\n \n /**\n- * A specialization of {@code software.amazon.awssdk.services.jsonprotocoltests.model.EventTwo} that represents the\n- * {@code EventStream#EventTwo} event. Do not use this class directly. Instead, use the static builder methods on\n- * {@link software.amazon.awssdk.services.jsonprotocoltests.model.EventStream}.\n+ * A specialization of {@code software.amazon.awssdk.services.json.model.EventTwo} that represents the\n+ * {@code EventStream$EventTwo} event. Do not use this class directly. Instead, use the static builder methods on", "originalCommit": "32cd8d61bc470ef325477fa29af90d5b8c12b2b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM4Njc0MA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2176#discussion_r536386740", "bodyText": "No, decided to use the C2j notation", "author": "dagnir", "createdAt": "2020-12-04T21:21:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM1Njk5OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM3MDY4Mw==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2176#discussion_r536370683", "bodyText": "Is this change intentional? Shouldn't it be DefaultSecondEventTwo?", "author": "zoewangg", "createdAt": "2020-12-04T20:47:54Z", "path": "codegen/src/test/resources/software/amazon/awssdk/codegen/poet/eventstream/defaultsecondeventtwo.java", "diffHunk": "@@ -1,21 +1,23 @@\n-package software.amazon.awssdk.services.jsonprotocoltests.model.eventstream;\n+package software.amazon.awssdk.services.json.model.eventstream;\n \n import software.amazon.awssdk.annotations.Generated;\n import software.amazon.awssdk.annotations.SdkInternalApi;\n-import software.amazon.awssdk.services.jsonprotocoltests.model.EventStreamOperationResponseHandler;\n-import software.amazon.awssdk.services.jsonprotocoltests.model.EventTwo;\n+import software.amazon.awssdk.services.json.model.EventStream;\n+import software.amazon.awssdk.services.json.model.EventStreamOperationResponseHandler;\n+import software.amazon.awssdk.services.json.model.EventStreamOperationWithOnlyOutputResponseHandler;\n+import software.amazon.awssdk.services.json.model.EventTwo;\n \n /**\n- * A specialization of {@code software.amazon.awssdk.services.jsonprotocoltests.model.EventTwo} that represents the\n- * {@code EventStream#SecondEventTwo} event. Do not use this class directly. Instead, use the static builder methods on\n- * {@link software.amazon.awssdk.services.jsonprotocoltests.model.EventStream}.\n+ * A specialization of {@code software.amazon.awssdk.services.json.model.EventTwo} that represents the\n+ * {@code EventStream$secondeventtwo} event. Do not use this class directly. Instead, use the static builder methods on\n+ * {@link software.amazon.awssdk.services.json.model.EventStream}.\n  */\n @SdkInternalApi\n @Generated(\"software.amazon.awssdk:codegen\")\n-public final class DefaultSecondEventTwo extends EventTwo {\n+public final class DefaultSecondeventtwo extends EventTwo {", "originalCommit": "32cd8d61bc470ef325477fa29af90d5b8c12b2b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM4NzI0MA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2176#discussion_r536387240", "bodyText": "It's a little confusing, but this one corresponds to this event \n  \n    \n      aws-sdk-java-v2/codegen/src/test/resources/software/amazon/awssdk/codegen/poet/eventstream/service-2.json\n    \n    \n         Line 106\n      in\n      32cd8d6\n    \n    \n    \n    \n\n        \n          \n           \"secondeventtwo\": {", "author": "dagnir", "createdAt": "2020-12-04T21:22:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM3MDY4Mw=="}], "type": "inlineReview"}]}