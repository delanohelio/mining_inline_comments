{"pr_number": 2066, "pr_title": "add per request waiterOverrideConfiguration overloaded waiter operation", "pr_createdAt": "2020-09-25T22:41:30Z", "pr_url": "https://github.com/aws/aws-sdk-java-v2/pull/2066", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTI5NjMzMw==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2066#discussion_r495296333", "bodyText": "Just return the value of the expression", "author": "dagnir", "createdAt": "2020-09-25T22:51:56Z", "path": "codegen/src/main/resources/software/amazon/awssdk/codegen/waiters/WaitersRuntime.java", "diffHunk": "@@ -502,7 +492,11 @@ public WaiterState waiterState() {\n \n         @Override\n         public boolean matches(SdkResponse response) {\n-            return response.sdkHttpResponse().statusCode() == statusCode;\n+            if (response.sdkHttpResponse() != null &&\n+                response.sdkHttpResponse().statusCode() == statusCode) {", "originalCommit": "fb5c896df67f33b59ccff992e9787bce2afd35fd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTI5NjgxNQ==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2066#discussion_r495296815", "bodyText": "probably more appropriate to use Collections.singletonList", "author": "dagnir", "createdAt": "2020-09-25T22:52:46Z", "path": "codegen/src/main/resources/software/amazon/awssdk/codegen/waiters/WaitersRuntime.java", "diffHunk": "@@ -33,17 +33,7 @@ private WaitersRuntime() {\n     }\n \n     private static List<WaiterAcceptor<Object>> defaultAcceptors() {\n-        return Arrays.asList(throwOnUnmatchedExceptionWaiter(), retryOnUnmatchedResponseWaiter());\n-    }\n-\n-    private static WaiterAcceptor<Object> throwOnUnmatchedExceptionWaiter() {\n-        return WaiterAcceptor.errorOnExceptionAcceptor(t -> {\n-            if (t instanceof RuntimeException) {\n-                throw (RuntimeException) t;\n-            }\n-\n-            throw SdkClientException.create(\"Encountered unexpected exception.\", t);\n-        });\n+        return Arrays.asList(retryOnUnmatchedResponseWaiter());", "originalCommit": "fb5c896df67f33b59ccff992e9787bce2afd35fd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTMwMjA1OA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2066#discussion_r495302058", "bodyText": "Is it possible to just overload the Waiter run() method to take an the override instead? That way the existing waiter can be reused without instantiating a new one when a override is given. Would also simplify codegen", "author": "dagnir", "createdAt": "2020-09-25T23:01:20Z", "path": "codegen/src/test/resources/software/amazon/awssdk/codegen/poet/waiters/query-sync-waiter-class.java", "diffHunk": "@@ -66,6 +66,15 @@ private static String errorCode(Throwable error) {\n         return postOperationSuccessWaiter.run(() -> client.aPostOperation(applyWaitersUserAgent(aPostOperationRequest)));\n     }\n \n+    @Override\n+    public WaiterResponse<APostOperationResponse> waitUntilPostOperationSuccess(APostOperationRequest aPostOperationRequest,\n+                                                                                WaiterOverrideConfiguration overrideConfig) {\n+        Waiter<APostOperationResponse> waiter = Waiter.builder(APostOperationResponse.class)\n+                                                      .acceptors(postOperationSuccessWaiterAcceptors())\n+                                                      .overrideConfiguration(postOperationSuccessWaiterConfig(overrideConfig)).build();\n+        return waiter.run(() -> client.aPostOperation(applyWaitersUserAgent(aPostOperationRequest)));", "originalCommit": "fb5c896df67f33b59ccff992e9787bce2afd35fd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTMxMDg3Ng==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2066#discussion_r495310876", "bodyText": "Instantiating a new waiter is actually very cheap, but I do like your idea. Well, too bad I already made the codegen change :( Anyway, I'll update it", "author": "zoewangg", "createdAt": "2020-09-25T23:16:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTMwMjA1OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTMxODE2MQ==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2066#discussion_r495318161", "bodyText": "But hopefully less code to maintain :). Also customers using the generic Waiter directly would benefit as well", "author": "dagnir", "createdAt": "2020-09-25T23:33:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTMwMjA1OA=="}], "type": "inlineReview"}, {"oid": "0f97f94d54ff3e74f3310f2e69838542401222a1", "url": "https://github.com/aws/aws-sdk-java-v2/commit/0f97f94d54ff3e74f3310f2e69838542401222a1", "message": "Add request override config overload in Waiter", "committedDate": "2020-09-28T17:05:25Z", "type": "forcePushed"}, {"oid": "c3de0f765f40055b7f876a0d24faa8f2bcea93d3", "url": "https://github.com/aws/aws-sdk-java-v2/commit/c3de0f765f40055b7f876a0d24faa8f2bcea93d3", "message": "Add request level override config overload\n\nFixed a bug where an exception thrown in waiterAcceptor could cause the async waiter operations to hang\n\nAdd request override config overload in Waiter", "committedDate": "2020-09-28T17:54:19Z", "type": "commit"}, {"oid": "c3de0f765f40055b7f876a0d24faa8f2bcea93d3", "url": "https://github.com/aws/aws-sdk-java-v2/commit/c3de0f765f40055b7f876a0d24faa8f2bcea93d3", "message": "Add request level override config overload\n\nFixed a bug where an exception thrown in waiterAcceptor could cause the async waiter operations to hang\n\nAdd request override config overload in Waiter", "committedDate": "2020-09-28T17:54:19Z", "type": "forcePushed"}]}