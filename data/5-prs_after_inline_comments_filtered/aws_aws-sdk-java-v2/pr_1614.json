{"pr_number": 1614, "pr_title": "Throws IOException for an h2 connection acquiring race condition", "pr_createdAt": "2020-01-24T05:34:46Z", "pr_url": "https://github.com/aws/aws-sdk-java-v2/pull/1614", "timeline": [{"oid": "e9d93a4bbc7ad73e329cf0bc234078be61c187f1", "url": "https://github.com/aws/aws-sdk-java-v2/commit/e9d93a4bbc7ad73e329cf0bc234078be61c187f1", "message": "Reduce the chance of the race condition where an http2 connection gets picked up at the same time it gets closed", "committedDate": "2020-01-24T20:15:00Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgyODQ2OA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1614#discussion_r370828468", "bodyText": "Do we know that this actually helps, or are we just guessing?", "author": "millems", "createdAt": "2020-01-24T20:28:57Z", "path": "http-clients/netty-nio-client/src/main/java/software/amazon/awssdk/http/nio/netty/internal/http2/MultiplexedChannelRecord.java", "diffHunk": "@@ -248,9 +249,13 @@ public Channel getConnection() {\n         return connection;\n     }\n \n-    public boolean claimStream() {\n+    private boolean claimStream() {\n         lastReserveAttemptTimeMillis = System.currentTimeMillis();\n         for (int attempt = 0; attempt < 5; ++attempt) {\n+            if (!connection.isActive()) {\n+                return false;\n+            }\n+", "originalCommit": "e9d93a4bbc7ad73e329cf0bc234078be61c187f1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgzOTgxOA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1614#discussion_r370839818", "bodyText": "As discussed offline, the check does not cover for all cases and we need to figure out a better way to reduce the race condition. Removed it for now.", "author": "zoewangg", "createdAt": "2020-01-24T21:00:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgyODQ2OA=="}], "type": "inlineReview"}, {"oid": "ca6fb14791b317022e48e773e7d0629a26459b43", "url": "https://github.com/aws/aws-sdk-java-v2/commit/ca6fb14791b317022e48e773e7d0629a26459b43", "message": "Throws `IOException` for the race condition where an http2 connection gets picked up at the same time it gets closed", "committedDate": "2020-01-24T20:57:03Z", "type": "commit"}, {"oid": "ca6fb14791b317022e48e773e7d0629a26459b43", "url": "https://github.com/aws/aws-sdk-java-v2/commit/ca6fb14791b317022e48e773e7d0629a26459b43", "message": "Throws `IOException` for the race condition where an http2 connection gets picked up at the same time it gets closed", "committedDate": "2020-01-24T20:57:03Z", "type": "forcePushed"}]}