{"pr_number": 2199, "pr_title": "Merge evenstream generation fixes", "pr_createdAt": "2020-12-10T21:20:13Z", "pr_url": "https://github.com/aws/aws-sdk-java-v2/pull/2199", "timeline": [{"oid": "ad6544c050f76f3db914ae99810c2ef0f576794a", "url": "https://github.com/aws/aws-sdk-java-v2/commit/ad6544c050f76f3db914ae99810c2ef0f576794a", "message": "Include event type in visitor name\n\nThis commit fixes event visitor method generation by including the *event type*\nin the visitor name. Note that event type here is actually the member name in\nthe encompassing eventstream structure, *not* the Java class of the event.\n\nFor example, in the example below, \"Foo\" is the event type.\n\n\"MyEventStream\": {\n   \"type\": \"structure\",\n   \"eventstream\": true,\n   \"members\": {\n       \"Foo\": {\n           \"shape\": \"Bar\"\n       }\n   }\n}\n\nTo ensure that this change is backwards compatible with existing services that\nhave event streams (Transcribe Streaming and Kinesis), we also include a\ncustomization to supress this behavior keep the method name as \"visit\".\n\nNote that by sheer luck, the existing consumer method setters, e.g.\n\nBuilder onSubscribeToShardEvent(Consumer<SubscribeToShardEvent>);\n\nare unaffected by this change. The previous generation scheme for these methods\nis \"on{Generation Java class name for event shape}\"; now it's \"on{event type}\".\nHowever, both Transcribe and Kinesis use the shape name as the member name (or\nvise versa?) in their current iteration of their event streams.\n\nFor example, in Kinesis, SubscribeToShard's output stream is defined as\n\n\"SubscribeToShardEventStream\":{\n  \"type\":\"structure\",\n  \"required\":[\"SubscribeToShardEvent\"],\n  \"members\":{\n    \"SubscribeToShardEvent\":{\"shape\":\"SubscribeToShardEvent\"},\n\n    ...\n    },\n  \"eventstream\":true\n}", "committedDate": "2020-10-15T22:47:55Z", "type": "commit"}, {"oid": "d50b76b8fc2a1ff0ba1239611a7e4deb7085dca0", "url": "https://github.com/aws/aws-sdk-java-v2/commit/d50b76b8fc2a1ff0ba1239611a7e4deb7085dca0", "message": "Subclass events to do visitor dispatch\n\nGenerate events as discrete subclasses of the base shape class that take care\ndispatching to the correct visitor method. The base shape is what we would\ngenerate as a normal model class for a non request/response shape today.\nHowever, because they need to be extended, they are no longer final; insteach\nany method that can be made final (such as property getters) is made final.\n\nThis commit also generates static builder methods on the event stream interface\nto make discovery and creation of events easier.", "committedDate": "2020-10-24T00:44:15Z", "type": "commit"}, {"oid": "294927b791b09a654a1cd95972722b1aba1c6d50", "url": "https://github.com/aws/aws-sdk-java-v2/commit/294927b791b09a654a1cd95972722b1aba1c6d50", "message": "Merge remote-tracking branch 'origin/master' into dongie/eventstream-visitors-fix", "committedDate": "2020-12-03T22:55:50Z", "type": "commit"}, {"oid": "e7d882db40170d1684ad84b5ebdcb14cc582721d", "url": "https://github.com/aws/aws-sdk-java-v2/commit/e7d882db40170d1684ad84b5ebdcb14cc582721d", "message": "Merge pull request #2181 from dagnir/eventstream-visitors-fix-merge\n\nEventstream visitors fix merge", "committedDate": "2020-12-03T23:31:44Z", "type": "commit"}, {"oid": "32cd8d61bc470ef325477fa29af90d5b8c12b2b4", "url": "https://github.com/aws/aws-sdk-java-v2/commit/32cd8d61bc470ef325477fa29af90d5b8c12b2b4", "message": "Expose event-type in stream interface", "committedDate": "2020-12-04T01:48:13Z", "type": "commit"}, {"oid": "308e493546ded28c5784a91b29704a4f2a7943e3", "url": "https://github.com/aws/aws-sdk-java-v2/commit/308e493546ded28c5784a91b29704a4f2a7943e3", "message": "Merge pull request #2176 from aws/sdk-event-type-getter\n\nExpose event-type in stream interface", "committedDate": "2020-12-04T21:39:34Z", "type": "commit"}, {"oid": "65534411b9103a835d1f585a89275e9d210c4a98", "url": "https://github.com/aws/aws-sdk-java-v2/commit/65534411b9103a835d1f585a89275e9d210c4a98", "message": "Event transformation based on type\n\nFixes event marshalling and unmarshalling:\n\n - Fix unmarshalling by mapping event type to the correct builder static\n   constructor on the eventstream interface.\n\n - Fix marshalling by retrieving the value for the :event-type header from the\n   event using getSdkEventType()", "committedDate": "2020-12-07T19:24:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjk5ODMxNw==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2199#discussion_r542998317", "bodyText": "Do we need the copy right statement here?", "author": "Quanzzzz", "createdAt": "2020-12-15T02:31:04Z", "path": "codegen/src/test/java/software/amazon/awssdk/codegen/poet/eventstream/EventModelSpecTest.java", "diffHunk": "@@ -0,0 +1,79 @@\n+package software.amazon.awssdk.codegen.poet.eventstream;", "originalCommit": "a92d99717f294253bb7819c4fe4bc9b2aed9226f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzU4OTY1OA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2199#discussion_r543589658", "bodyText": "Yep, good catch. I'll add it", "author": "dagnir", "createdAt": "2020-12-15T18:36:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjk5ODMxNw=="}], "type": "inlineReview"}, {"oid": "2349c2eb63044cb617a6e28dff4e9a08c41d71f3", "url": "https://github.com/aws/aws-sdk-java-v2/commit/2349c2eb63044cb617a6e28dff4e9a08c41d71f3", "message": "Add legacy gen for MedicalTranscriptResultStream\n\nMedicalTranscriptResultStream$TrancriptEvent was released with the existing code\ngeneration scheme so it needs to be customized.", "committedDate": "2020-12-15T23:42:41Z", "type": "forcePushed"}, {"oid": "2e55e8f40de2ad8ef4172675223215af08e2bbd9", "url": "https://github.com/aws/aws-sdk-java-v2/commit/2e55e8f40de2ad8ef4172675223215af08e2bbd9", "message": "Merge remote-tracking branch 'origin/master' into dongie/eventstream-visitors-fix", "committedDate": "2020-12-15T22:02:47Z", "type": "forcePushed"}, {"oid": "a1ad3aa118437458d36b906f41ed9e97ef0f6cea", "url": "https://github.com/aws/aws-sdk-java-v2/commit/a1ad3aa118437458d36b906f41ed9e97ef0f6cea", "message": "Add legacy gen for MedicalTranscriptResultStream\n\nMedicalTranscriptResultStream$TrancriptEvent was released with the existing code\ngeneration scheme so it needs to be customized.", "committedDate": "2020-12-16T00:15:53Z", "type": "commit"}, {"oid": "b8dd326d373bd2fd8277707b8290f2424397bcd6", "url": "https://github.com/aws/aws-sdk-java-v2/commit/b8dd326d373bd2fd8277707b8290f2424397bcd6", "message": "Add validation for new streams\n\nValidation is only for Kinesis, Transcribe Streaming, since they have existing\nstreams generated with the old style.", "committedDate": "2020-12-16T19:51:51Z", "type": "commit"}, {"oid": "c77cecda8e1aac79f748c7f30b802e7242e591b4", "url": "https://github.com/aws/aws-sdk-java-v2/commit/c77cecda8e1aac79f748c7f30b802e7242e591b4", "message": "Merge remote-tracking branch 'origin/master' into dongie/eventstream-visitors-fix", "committedDate": "2020-12-16T19:56:42Z", "type": "commit"}, {"oid": "c77cecda8e1aac79f748c7f30b802e7242e591b4", "url": "https://github.com/aws/aws-sdk-java-v2/commit/c77cecda8e1aac79f748c7f30b802e7242e591b4", "message": "Merge remote-tracking branch 'origin/master' into dongie/eventstream-visitors-fix", "committedDate": "2020-12-16T19:56:42Z", "type": "forcePushed"}, {"oid": "b67c0cc9f71725a649086ba78dfff86e94de4c76", "url": "https://github.com/aws/aws-sdk-java-v2/commit/b67c0cc9f71725a649086ba78dfff86e94de4c76", "message": "Don't strip SafeVarargs", "committedDate": "2020-12-16T22:52:02Z", "type": "commit"}, {"oid": "bd35d3a6e701924716771aecf7076ff61ef2a236", "url": "https://github.com/aws/aws-sdk-java-v2/commit/bd35d3a6e701924716771aecf7076ff61ef2a236", "message": "Add changelog entry", "committedDate": "2020-12-16T22:53:02Z", "type": "commit"}]}