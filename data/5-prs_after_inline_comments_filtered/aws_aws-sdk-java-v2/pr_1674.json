{"pr_number": 1674, "pr_title": "DynamoDb Enhanced Client : changed the way extensions are loaded, loa\u2026", "pr_createdAt": "2020-02-27T23:01:36Z", "pr_url": "https://github.com/aws/aws-sdk-java-v2/pull/1674", "timeline": [{"oid": "dc597034630628c1d1fc55d52bdc3e1a98d3a32f", "url": "https://github.com/aws/aws-sdk-java-v2/commit/dc597034630628c1d1fc55d52bdc3e1a98d3a32f", "message": "DynamoDb Enhanced Client : changed the way extensions are loaded, loads VersionedRecordExtension by default", "committedDate": "2020-02-27T23:24:54Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTQzODcyOA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1674#discussion_r385438728", "bodyText": "Should we move the common apis to an interface that both async client builder and sync client builder extend? It's easier to maintain that way, to me, eg: If we ever need to update javadocs, we can just update one place in stead of two.", "author": "zoewangg", "createdAt": "2020-02-27T23:57:38Z", "path": "services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/DynamoDbEnhancedAsyncClient.java", "diffHunk": "@@ -91,10 +91,38 @@\n      * The builder definition for a {@link DynamoDbEnhancedAsyncClient}.\n      */\n     interface Builder {\n-        Builder dynamoDbClient(DynamoDbAsyncClient dynamoDbAsyncClient);\n-\n-        Builder extendWith(DynamoDbEnhancedClientExtension dynamoDbEnhancedClientExtension);\n-\n+        /**\n+         * The regular low-level SDK client to use with the enhanced client.\n+         * @param dynamoDbClient an initialized {@link DynamoDbAsyncClient}\n+         */\n+        Builder dynamoDbClient(DynamoDbAsyncClient dynamoDbClient);", "originalCommit": "dc597034630628c1d1fc55d52bdc3e1a98d3a32f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTQ0NDI0Mg==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1674#discussion_r385444242", "bodyText": "Yeah ok. I was thinking about it as I was copy and pasting all of it, it's right on the threshold for me. Excessive hierarchy can interfere with readability, but I'll try it out and see how it looks.", "author": "bmaizels", "createdAt": "2020-02-28T00:16:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTQzODcyOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTQzOTc4OQ==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1674#discussion_r385439789", "bodyText": "unmodifiable list?", "author": "zoewangg", "createdAt": "2020-02-28T00:01:04Z", "path": "services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/internal/client/ExtensionResolver.java", "diffHunk": "@@ -0,0 +1,69 @@\n+/*\n+ * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.awssdk.enhanced.dynamodb.internal.client;\n+\n+import java.util.Collections;\n+import java.util.List;\n+\n+import software.amazon.awssdk.annotations.SdkInternalApi;\n+import software.amazon.awssdk.enhanced.dynamodb.DynamoDbEnhancedClientExtension;\n+import software.amazon.awssdk.enhanced.dynamodb.extensions.VersionedRecordExtension;\n+import software.amazon.awssdk.enhanced.dynamodb.internal.extensions.ChainExtension;\n+\n+/**\n+ * Static module to assist with the initialization of an extension for a DynamoDB Enhanced Client based on supplied\n+ * configuration.\n+ */\n+@SdkInternalApi\n+public final class ExtensionResolver {\n+    private static final DynamoDbEnhancedClientExtension DEFAULT_VERSIONED_RECORD_EXTENSION =\n+        VersionedRecordExtension.builder().build();\n+    private static final List<DynamoDbEnhancedClientExtension> DEFAULT_EXTENSIONS =\n+        Collections.singletonList(DEFAULT_VERSIONED_RECORD_EXTENSION);\n+\n+    private ExtensionResolver() {\n+    }\n+\n+    /**\n+     * Static provider for the default extensions that are bundled with the DynamoDB Enhanced Client. Currently this is\n+     * just the {@link software.amazon.awssdk.enhanced.dynamodb.extensions.VersionedRecordExtension}.\n+     *\n+     * These extensions will be used by default unless overridden in the enhanced client builder.\n+     */\n+    public static List<DynamoDbEnhancedClientExtension> defaultExtensions() {\n+        return DEFAULT_EXTENSIONS;", "originalCommit": "dc597034630628c1d1fc55d52bdc3e1a98d3a32f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTQ0NDQ0MQ==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1674#discussion_r385444441", "bodyText": "It's already immutable.", "author": "bmaizels", "createdAt": "2020-02-28T00:16:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTQzOTc4OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTQ0ODEwNg==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1674#discussion_r385448106", "bodyText": "As discussed I'll add a test to assert this and leave it at that.", "author": "bmaizels", "createdAt": "2020-02-28T00:29:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTQzOTc4OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTQ0MTU2Nw==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1674#discussion_r385441567", "bodyText": "Where do we do null check for DynamoDbEnhancedClientExtension?\nShould we use Optional?", "author": "zoewangg", "createdAt": "2020-02-28T00:07:05Z", "path": "services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/internal/client/ExtensionResolver.java", "diffHunk": "@@ -0,0 +1,69 @@\n+/*\n+ * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.awssdk.enhanced.dynamodb.internal.client;\n+\n+import java.util.Collections;\n+import java.util.List;\n+\n+import software.amazon.awssdk.annotations.SdkInternalApi;\n+import software.amazon.awssdk.enhanced.dynamodb.DynamoDbEnhancedClientExtension;\n+import software.amazon.awssdk.enhanced.dynamodb.extensions.VersionedRecordExtension;\n+import software.amazon.awssdk.enhanced.dynamodb.internal.extensions.ChainExtension;\n+\n+/**\n+ * Static module to assist with the initialization of an extension for a DynamoDB Enhanced Client based on supplied\n+ * configuration.\n+ */\n+@SdkInternalApi\n+public final class ExtensionResolver {\n+    private static final DynamoDbEnhancedClientExtension DEFAULT_VERSIONED_RECORD_EXTENSION =\n+        VersionedRecordExtension.builder().build();\n+    private static final List<DynamoDbEnhancedClientExtension> DEFAULT_EXTENSIONS =\n+        Collections.singletonList(DEFAULT_VERSIONED_RECORD_EXTENSION);\n+\n+    private ExtensionResolver() {\n+    }\n+\n+    /**\n+     * Static provider for the default extensions that are bundled with the DynamoDB Enhanced Client. Currently this is\n+     * just the {@link software.amazon.awssdk.enhanced.dynamodb.extensions.VersionedRecordExtension}.\n+     *\n+     * These extensions will be used by default unless overridden in the enhanced client builder.\n+     */\n+    public static List<DynamoDbEnhancedClientExtension> defaultExtensions() {\n+        return DEFAULT_EXTENSIONS;\n+    }\n+\n+    /**\n+     * Resolves a list of extensions into a single extension. If the list is a singleton, will just return that extension\n+     * otherwise it will combine them with the {@link software.amazon.awssdk.enhanced.dynamodb.internal.extensions.ChainExtension}\n+     * meta-extension using the order provided in the list.\n+     *\n+     * @param extensions A list of extensions to be combined in strict order\n+     * @return A single extension that combines all the supplied extensions or null if no extensions were provided\n+     */\n+    public static DynamoDbEnhancedClientExtension resolveExtensions(List<DynamoDbEnhancedClientExtension> extensions) {\n+        if (extensions == null || extensions.isEmpty()) {\n+            return null;", "originalCommit": "dc597034630628c1d1fc55d52bdc3e1a98d3a32f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTQ0NDg1NA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1674#discussion_r385444854", "bodyText": "Null is valid all through the code and is treated as 'no extension'. I could change this interface to optional though but i'd be unwrapping it to null on the client.", "author": "bmaizels", "createdAt": "2020-02-28T00:18:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTQ0MTU2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTQ0NjY0Mw==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1674#discussion_r385446643", "bodyText": "I see. I'm not against return null as long as we make sure null-check is in place somewhere.", "author": "zoewangg", "createdAt": "2020-02-28T00:24:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTQ0MTU2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTQ0ODAzNA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1674#discussion_r385448034", "bodyText": "There are multiple tests that exercise this code path. There's no immediate validation that can take place because null is valid. The requirement is that all operations can handle it correctly, and there are tests that verify this.", "author": "bmaizels", "createdAt": "2020-02-28T00:29:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTQ0MTU2Nw=="}], "type": "inlineReview"}, {"oid": "b180825acf704e5b4580f87c41694584ede2ff25", "url": "https://github.com/aws/aws-sdk-java-v2/commit/b180825acf704e5b4580f87c41694584ede2ff25", "message": "DynamoDb Enhanced Client : changed the way extensions are loaded, loads VersionedRecordExtension by default", "committedDate": "2020-02-28T00:47:38Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTQ1Mzk1MA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1674#discussion_r385453950", "bodyText": "nit: {@inheritDoc} is not necessay. @Override automatically renders the inherited doc.", "author": "zoewangg", "createdAt": "2020-02-28T00:51:06Z", "path": "services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/DynamoDbEnhancedClient.java", "diffHunk": "@@ -88,11 +88,29 @@ static Builder builder() {\n     /**\n      * The builder definition for a {@link DynamoDbEnhancedClient}.\n      */\n-    interface Builder {\n+    interface Builder extends DynamoDbEnhancedResource.Builder {\n+        /**\n+         * The regular low-level SDK client to use with the enhanced client.\n+         * @param dynamoDbClient an initialized {@link DynamoDbClient}\n+         */\n         Builder dynamoDbClient(DynamoDbClient dynamoDbClient);\n \n-        Builder extendWith(DynamoDbEnhancedClientExtension dynamoDbEnhancedClientExtension);\n-\n+        /**\n+         * {@inheritDoc}", "originalCommit": "b180825acf704e5b4580f87c41694584ede2ff25", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTQ1NDM0NQ==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1674#discussion_r385454345", "bodyText": "oh! I'll whip that out then. Thanks.", "author": "bmaizels", "createdAt": "2020-02-28T00:52:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTQ1Mzk1MA=="}], "type": "inlineReview"}, {"oid": "fb12003687b7550107903b69b88a50566f7b8d5e", "url": "https://github.com/aws/aws-sdk-java-v2/commit/fb12003687b7550107903b69b88a50566f7b8d5e", "message": "DynamoDb Enhanced Client : changed the way extensions are loaded, loads VersionedRecordExtension by default", "committedDate": "2020-02-28T00:53:40Z", "type": "commit"}, {"oid": "fb12003687b7550107903b69b88a50566f7b8d5e", "url": "https://github.com/aws/aws-sdk-java-v2/commit/fb12003687b7550107903b69b88a50566f7b8d5e", "message": "DynamoDb Enhanced Client : changed the way extensions are loaded, loads VersionedRecordExtension by default", "committedDate": "2020-02-28T00:53:40Z", "type": "forcePushed"}]}