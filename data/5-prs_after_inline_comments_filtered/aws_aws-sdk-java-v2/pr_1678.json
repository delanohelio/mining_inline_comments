{"pr_number": 1678, "pr_title": "Add support for maven lambda archetype", "pr_createdAt": "2020-02-28T20:16:51Z", "pr_url": "https://github.com/aws/aws-sdk-java-v2/pull/1678", "timeline": [{"oid": "c4a10dd2b5c5fc4f34cd6d209b78b43607891717", "url": "https://github.com/aws/aws-sdk-java-v2/commit/c4a10dd2b5c5fc4f34cd6d209b78b43607891717", "message": "Add tests, improve docs and other changes", "committedDate": "2020-03-24T19:49:03Z", "type": "forcePushed"}, {"oid": "e85ff6b64bae02054cc6a47ad4e2419b5d6efd9f", "url": "https://github.com/aws/aws-sdk-java-v2/commit/e85ff6b64bae02054cc6a47ad4e2419b5d6efd9f", "message": "Add tests, improve docs and other changes", "committedDate": "2020-03-24T20:07:30Z", "type": "forcePushed"}, {"oid": "b272b3f3bd9785fe4bd982df9b80af028d7fa3e7", "url": "https://github.com/aws/aws-sdk-java-v2/commit/b272b3f3bd9785fe4bd982df9b80af028d7fa3e7", "message": "Add tests, improve docs and other changes", "committedDate": "2020-03-24T20:24:11Z", "type": "forcePushed"}, {"oid": "47165ca62890d5b9827c3007072bd29f4e22e723", "url": "https://github.com/aws/aws-sdk-java-v2/commit/47165ca62890d5b9827c3007072bd29f4e22e723", "message": "Add tests, improve docs and other changes", "committedDate": "2020-03-24T20:28:53Z", "type": "forcePushed"}, {"oid": "31a5b3a88a1ddc84e0031f48f326edaadda1fb1f", "url": "https://github.com/aws/aws-sdk-java-v2/commit/31a5b3a88a1ddc84e0031f48f326edaadda1fb1f", "message": "Add tests, improve docs and other changes", "committedDate": "2020-03-24T21:25:56Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA3NTM3OA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1678#discussion_r398075378", "bodyText": "In the future, we should consider showing them how to do true DI with dagger.", "author": "millems", "createdAt": "2020-03-25T18:23:34Z", "path": "archetypes/archetype-lambda/src/main/resources/archetype-resources/src/main/java/DependencyFactory.java", "diffHunk": "@@ -0,0 +1,27 @@\n+#parse ( \"global.vm\")\n+\n+package ${package};\n+\n+import software.amazon.awssdk.auth.credentials.EnvironmentVariableCredentialsProvider;\n+import software.amazon.awssdk.http.${httpClientPackageName};\n+import software.amazon.awssdk.regions.Region;\n+import software.amazon.awssdk.services.${servicePackage}.${serviceClientClassName};\n+\n+/**\n+ * The module containing all dependencies required by the {@link ${handlerClassName}}.\n+ */\n+public class DependencyFactory {\n+\n+    private DependencyFactory() {}\n+\n+    /**\n+     * @return an instance of ${serviceClientClassName}\n+     */\n+    public static ${serviceClientClassName} ${service}Client() {", "originalCommit": "31a5b3a88a1ddc84e0031f48f326edaadda1fb1f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA4NjA3Ng==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1678#discussion_r398086076", "bodyText": "Yup. I thought about adding another parameter, something like di, which allows customers to switch between relatively lightweight DI such as dagger or guice or no DI at all.", "author": "zoewangg", "createdAt": "2020-03-25T18:40:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA3NTM3OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA4MDY0OA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1678#discussion_r398080648", "bodyText": "Do we include open SSL or other tweaks for netty?", "author": "millems", "createdAt": "2020-03-25T18:31:50Z", "path": "archetypes/archetype-lambda/src/test/resources/projects/nettyclient/reference/src/main/java/software/amazonaws/test/DependencyFactory.java", "diffHunk": "@@ -0,0 +1,26 @@\n+\n+package software.amazonaws.test;\n+\n+import software.amazon.awssdk.auth.credentials.EnvironmentVariableCredentialsProvider;\n+import software.amazon.awssdk.http.nio.netty.NettyNioAsyncHttpClient;\n+import software.amazon.awssdk.regions.Region;\n+import software.amazon.awssdk.services.kinesis.KinesisAsyncClient;\n+\n+/**\n+ * The module containing all dependencies required by the {@link MyNettyFunction}.\n+ */\n+public class DependencyFactory {\n+\n+    private DependencyFactory() {}\n+\n+    /**\n+     * @return an instance of KinesisAsyncClient\n+     */\n+    public static KinesisAsyncClient kinesisClient() {\n+        return KinesisAsyncClient.builder()\n+                       .credentialsProvider(EnvironmentVariableCredentialsProvider.create())\n+                       .region(Region.US_EAST_1)\n+                       .httpClientBuilder(NettyNioAsyncHttpClient.builder())", "originalCommit": "31a5b3a88a1ddc84e0031f48f326edaadda1fb1f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA4ODU0Mw==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1678#discussion_r398088543", "bodyText": "That would require another openssl dependency netty-tcnative though, and not all platforms support it. We can probably add a comment here to recommend using openssl if possible.", "author": "zoewangg", "createdAt": "2020-03-25T18:44:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA4MDY0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA5MDg2NA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1678#discussion_r398090864", "bodyText": "But since it's on Lambda, we know the platform, right?", "author": "millems", "createdAt": "2020-03-25T18:48:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA4MDY0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA5NDAzMQ==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1678#discussion_r398094031", "bodyText": "lol, good point. I'll give it a try", "author": "zoewangg", "createdAt": "2020-03-25T18:53:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA4MDY0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODE0MDAxNA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1678#discussion_r398140014", "bodyText": "Wow, the netty-tcnative-boringssl-static binding jar itself is 3MB...Certainly wouldn't help with cold start issue, but I guess it would improve overall latency a bit.\n5 concurrent s3Async#listBuckets calls with 1024MB mem:\n\nOpenssl Duration: 3767.44 ms, Init Duration: 1092.19 ms\nJDK: Duration: 3995.94 ms Init Duration: 1108.46 ms", "author": "zoewangg", "createdAt": "2020-03-25T20:14:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA4MDY0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODg4NTc3MQ==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1678#discussion_r398885771", "bodyText": "Ended up just adding netty-tcnative-boringssl-static dependency so that it'd use openssl if supported and fallback to jdk ssl provider otherwise.", "author": "zoewangg", "createdAt": "2020-03-26T20:55:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA4MDY0OA=="}], "type": "inlineReview"}, {"oid": "3dc5e50c84e1646cd8bf8ec3e56c51faf531a3fe", "url": "https://github.com/aws/aws-sdk-java-v2/commit/3dc5e50c84e1646cd8bf8ec3e56c51faf531a3fe", "message": "generate service mapping vm file during build time", "committedDate": "2020-03-26T20:55:20Z", "type": "forcePushed"}, {"oid": "52ff67bf2862bbbc26250db108e912ea7046b600", "url": "https://github.com/aws/aws-sdk-java-v2/commit/52ff67bf2862bbbc26250db108e912ea7046b600", "message": "generate service mapping vm file during build time", "committedDate": "2020-03-26T20:56:42Z", "type": "forcePushed"}, {"oid": "1067b6ecf28826f5ba944d2aa72e260663b6eb4d", "url": "https://github.com/aws/aws-sdk-java-v2/commit/1067b6ecf28826f5ba944d2aa72e260663b6eb4d", "message": "generate service mapping vm file during build time", "committedDate": "2020-03-26T21:18:29Z", "type": "forcePushed"}, {"oid": "4f1ab3032e4a07c35cd59ca4eebd5a9abb4e54e2", "url": "https://github.com/aws/aws-sdk-java-v2/commit/4f1ab3032e4a07c35cd59ca4eebd5a9abb4e54e2", "message": "Add support for maven lambda archetype", "committedDate": "2020-03-26T22:36:29Z", "type": "forcePushed"}, {"oid": "29cafa7734cd0ad5b0446ddfb83b14de1c6d62e8", "url": "https://github.com/aws/aws-sdk-java-v2/commit/29cafa7734cd0ad5b0446ddfb83b14de1c6d62e8", "message": "Add support for maven lambda archetype", "committedDate": "2020-03-26T23:25:14Z", "type": "commit"}, {"oid": "29cafa7734cd0ad5b0446ddfb83b14de1c6d62e8", "url": "https://github.com/aws/aws-sdk-java-v2/commit/29cafa7734cd0ad5b0446ddfb83b14de1c6d62e8", "message": "Add support for maven lambda archetype", "committedDate": "2020-03-26T23:25:14Z", "type": "forcePushed"}]}