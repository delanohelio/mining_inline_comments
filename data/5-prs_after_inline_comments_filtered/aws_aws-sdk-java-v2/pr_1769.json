{"pr_number": 1769, "pr_title": "Integrating AWS CRT 0.5.1 into aws-crt-dev-preview", "pr_createdAt": "2020-04-06T23:00:54Z", "pr_url": "https://github.com/aws/aws-sdk-java-v2/pull/1769", "timeline": [{"oid": "18c17b94e298b7f48644e7f5a24a568477de2abb", "url": "https://github.com/aws/aws-sdk-java-v2/commit/18c17b94e298b7f48644e7f5a24a568477de2abb", "message": "Updated crt http client to use latest crt api, which uses byte[] for response body.", "committedDate": "2020-04-06T22:46:19Z", "type": "commit"}, {"oid": "f39e59ee84e38a66e232b4b716648c6a00daf076", "url": "https://github.com/aws/aws-sdk-java-v2/commit/f39e59ee84e38a66e232b4b716648c6a00daf076", "message": "Removed old comment.", "committedDate": "2020-04-06T22:46:19Z", "type": "commit"}, {"oid": "037f03d3f40646c85f5430334635188a4b67eb77", "url": "https://github.com/aws/aws-sdk-java-v2/commit/037f03d3f40646c85f5430334635188a4b67eb77", "message": "Fixed build failures.", "committedDate": "2020-04-06T22:46:49Z", "type": "commit"}, {"oid": "37ceb5599041ab53d0d3b2c62eb8ec0f275d97c7", "url": "https://github.com/aws/aws-sdk-java-v2/commit/37ceb5599041ab53d0d3b2c62eb8ec0f275d97c7", "message": "Fixed benchmark builds.", "committedDate": "2020-04-06T22:46:49Z", "type": "commit"}, {"oid": "c53e1210beb8477aeed56ad2fdf1c2f0ae86d652", "url": "https://github.com/aws/aws-sdk-java-v2/commit/c53e1210beb8477aeed56ad2fdf1c2f0ae86d652", "message": "Removed unused import.", "committedDate": "2020-04-06T22:46:49Z", "type": "commit"}, {"oid": "20a907e3c22755a51f33e1a102902754351a74de", "url": "https://github.com/aws/aws-sdk-java-v2/commit/20a907e3c22755a51f33e1a102902754351a74de", "message": "Fixed SPI test.", "committedDate": "2020-04-06T22:46:49Z", "type": "commit"}, {"oid": "d2466d564c61f174f9cdfc1e60b8469bca6322fe", "url": "https://github.com/aws/aws-sdk-java-v2/commit/d2466d564c61f174f9cdfc1e60b8469bca6322fe", "message": "Hopefully fix the build this time.", "committedDate": "2020-04-06T22:46:49Z", "type": "commit"}, {"oid": "a03e35a227d318275bf8160f419b6c31202c038a", "url": "https://github.com/aws/aws-sdk-java-v2/commit/a03e35a227d318275bf8160f419b6c31202c038a", "message": "Updating SDK to work with most recent CRT\n\nFactoring out EventLoopGroup/HostResolver from client constructor, fixing bug reported by Sonar", "committedDate": "2020-04-06T22:47:11Z", "type": "commit"}, {"oid": "37fe7c57d7738547944eadafd6566253ba2d332e", "url": "https://github.com/aws/aws-sdk-java-v2/commit/37fe7c57d7738547944eadafd6566253ba2d332e", "message": "Taking out incorrect try-with-resources block", "committedDate": "2020-04-06T22:47:11Z", "type": "commit"}, {"oid": "9125cb8d22978deff2a4735d4e6ca3222e7d2982", "url": "https://github.com/aws/aws-sdk-java-v2/commit/9125cb8d22978deff2a4735d4e6ca3222e7d2982", "message": "Updating to latest SDK snapshot and CRT", "committedDate": "2020-04-06T22:47:11Z", "type": "commit"}, {"oid": "20728ffacec7d2312832a7c8e2f92b368a71aafa", "url": "https://github.com/aws/aws-sdk-java-v2/commit/20728ffacec7d2312832a7c8e2f92b368a71aafa", "message": "Adjusting usage of builder, removing whitespace change.", "committedDate": "2020-04-06T22:47:11Z", "type": "commit"}, {"oid": "6295b73edfba26ad63ff166380965b5aa0cf9038", "url": "https://github.com/aws/aws-sdk-java-v2/commit/6295b73edfba26ad63ff166380965b5aa0cf9038", "message": "Updating snapshot version", "committedDate": "2020-04-06T22:47:11Z", "type": "commit"}, {"oid": "e9ecbbef98f6b931e17a9692382df076274bb05f", "url": "https://github.com/aws/aws-sdk-java-v2/commit/e9ecbbef98f6b931e17a9692382df076274bb05f", "message": "Updating copyright headers", "committedDate": "2020-04-06T22:47:11Z", "type": "commit"}, {"oid": "9df0bb681bc8a085c189246c811fe3c4a9a12adb", "url": "https://github.com/aws/aws-sdk-java-v2/commit/9df0bb681bc8a085c189246c811fe3c4a9a12adb", "message": "Fixing checkstyle warning for 'TLS' being more than 2 consecutive capital letters", "committedDate": "2020-04-06T22:47:11Z", "type": "commit"}, {"oid": "f830694d44e6e06ea068b276e081294e5af9a925", "url": "https://github.com/aws/aws-sdk-java-v2/commit/f830694d44e6e06ea068b276e081294e5af9a925", "message": "Updating snapshot and CRT version", "committedDate": "2020-04-06T22:47:11Z", "type": "commit"}, {"oid": "907a82ac86e357458e195a13d4b0ee2e1a086d14", "url": "https://github.com/aws/aws-sdk-java-v2/commit/907a82ac86e357458e195a13d4b0ee2e1a086d14", "message": "Grabbing commit 025c43c52d4bf92ae36959e8b8a473589ba3345a: Update AWS CRT Client to work with v0.5.1", "committedDate": "2020-04-06T22:47:11Z", "type": "commit"}, {"oid": "9a59adac604871e029ef1eb9ae99243e8babfb12", "url": "https://github.com/aws/aws-sdk-java-v2/commit/9a59adac604871e029ef1eb9ae99243e8babfb12", "message": "Updating snapshot version and adding aws-crt-client to tests coverage reporting", "committedDate": "2020-04-06T22:47:11Z", "type": "commit"}, {"oid": "5be5b161ef83e7201bc727a6ed336452ec3037c4", "url": "https://github.com/aws/aws-sdk-java-v2/commit/5be5b161ef83e7201bc727a6ed336452ec3037c4", "message": "Fixing copyright headers.  Fixing CRT version in sdk-benchmarks.", "committedDate": "2020-04-06T22:47:11Z", "type": "commit"}, {"oid": "92c24d155add0082801fe4fd4b034ea384335a50", "url": "https://github.com/aws/aws-sdk-java-v2/commit/92c24d155add0082801fe4fd4b034ea384335a50", "message": "Adding manual window management flag", "committedDate": "2020-04-06T22:47:11Z", "type": "commit"}, {"oid": "9b3ddc490d75fb565218c09d3d4a97fefe1542d5", "url": "https://github.com/aws/aws-sdk-java-v2/commit/9b3ddc490d75fb565218c09d3d4a97fefe1542d5", "message": "Fixing version in pom file", "committedDate": "2020-04-06T22:47:11Z", "type": "commit"}, {"oid": "45ceea3cbe11210295353cdefc9984fca378bfac", "url": "https://github.com/aws/aws-sdk-java-v2/commit/45ceea3cbe11210295353cdefc9984fca378bfac", "message": "Updating pom version", "committedDate": "2020-04-06T22:50:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTA2MDk1MQ==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1769#discussion_r405060951", "bodyText": "I\"m not sure what the purposes of these changes is. Care to enlighten me?", "author": "JonathanHenson", "createdAt": "2020-04-07T19:32:39Z", "path": "http-clients/aws-crt-client/src/it/java/software/amazon/awssdk/http/crt/AwsCrtClientKmsIntegrationTest.java", "diffHunk": "@@ -43,9 +47,13 @@ public void setup() {\n                 continue;\n             }\n \n+            int numThreads = 1;\n+            eventLoopGroup = new EventLoopGroup(numThreads);", "originalCommit": "45ceea3cbe11210295353cdefc9984fca378bfac", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTA3MDAzNw==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1769#discussion_r405070037", "bodyText": "The client doesn't create its own event loop group anymore, as people felt it was a bit awkward for them to create such a heavy object.  Because of that, we don't have the .eventLoopSize(1) builder change that we used to have on the client, and this is meant to be the replacement of that.  (The numThreads variable is just meant to be more explicit about what's being passed in, and could arguably be taken out or made final.)", "author": "rccarper", "createdAt": "2020-04-07T19:49:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTA2MDk1MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTA2MTUxNg==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1769#discussion_r405061516", "bodyText": "create is a wierd verb for a builder pattern", "author": "JonathanHenson", "createdAt": "2020-04-07T19:33:42Z", "path": "http-clients/aws-crt-client/src/main/java/software/amazon/awssdk/http/crt/AwsCrtAsyncHttpClient.java", "diffHunk": "@@ -135,9 +146,16 @@ private HttpClientConnectionManager createConnectionPool(URI uri) {\n         Validate.notNull(uri, \"URI must not be null\");\n         log.debug(() -> \"Creating ConnectionPool for: URI:\" + uri + \", MaxConns: \" + maxConnectionsPerEndpoint);\n \n-        return new HttpClientConnectionManager(bootstrap, socketOptions, tlsContext, uri,\n-                                                HttpClientConnectionManager.DEFAULT_MAX_BUFFER_SIZE, windowSize,\n-                                                maxConnectionsPerEndpoint);\n+        HttpClientConnectionManagerOptions options = new HttpClientConnectionManagerOptions()\n+                .withClientBootstrap(bootstrap)\n+                .withSocketOptions(socketOptions)\n+                .withTlsContext(tlsContext)\n+                .withUri(uri)\n+                .withWindowSize(windowSize)\n+                .withMaxConnections(maxConnectionsPerEndpoint)\n+                .withManualWindowManagement(manualWindowManagement);\n+\n+        return HttpClientConnectionManager.create(options);", "originalCommit": "45ceea3cbe11210295353cdefc9984fca378bfac", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTA3Mzg4OA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1769#discussion_r405073888", "bodyText": "Wouldn't that be a change we would have to make on the CRT side?", "author": "rccarper", "createdAt": "2020-04-07T19:56:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTA2MTUxNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTA2MzQ1Ng==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1769#discussion_r405063456", "bodyText": "make sure to call out if this is ever set to true the user is responsible for calling updateWindow on the stream object.", "author": "JonathanHenson", "createdAt": "2020-04-07T19:37:29Z", "path": "http-clients/aws-crt-client/src/main/java/software/amazon/awssdk/http/crt/AwsCrtAsyncHttpClient.java", "diffHunk": "@@ -264,36 +281,50 @@ public void close() {\n      */\n     public interface Builder extends SdkAsyncHttpClient.Builder<AwsCrtAsyncHttpClient.Builder> {\n \n-        /**\n-         * The number of Threads to use in the EventLoop.\n-         * @param eventLoopSize The number of Threads to use in the EventLoop.\n-         * @return the builder of the method chaining.\n-         */\n-        Builder eventLoopSize(int eventLoopSize);\n-\n         /**\n          * The AWS CRT TlsCipherPreference to use for this Client\n          * @param tlsCipherPreference The AWS Common Runtime TlsCipherPreference\n-         * @return the builder of the method chaining.\n+         * @return The builder of the method chaining.\n          */\n         Builder tlsCipherPreference(TlsCipherPreference tlsCipherPreference);\n \n         /**\n          * Whether or not to Verify the Peer's TLS Certificate Chain.\n          * @param verifyPeer true if the Certificate Chain should be validated, false if validation should be skipped.\n-         * @return the builder of the method chaining.\n+         * @return The builder of the method chaining.\n          */\n         Builder verifyPeer(boolean verifyPeer);\n \n+        /**\n+         * If set to true, then the TCP read back pressure mechanism will be enabled.", "originalCommit": "45ceea3cbe11210295353cdefc9984fca378bfac", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTA2NDgzNQ==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1769#discussion_r405064835", "bodyText": "sorry, incrementWindow()", "author": "JonathanHenson", "createdAt": "2020-04-07T19:39:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTA2MzQ1Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTA3NDIzOA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1769#discussion_r405074238", "bodyText": "I'll update the comment!", "author": "rccarper", "createdAt": "2020-04-07T19:56:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTA2MzQ1Ng=="}], "type": "inlineReview"}, {"oid": "ea67a61965b5d1d129f283cde8fa8bac48804cf9", "url": "https://github.com/aws/aws-sdk-java-v2/commit/ea67a61965b5d1d129f283cde8fa8bac48804cf9", "message": "Updating comment", "committedDate": "2020-04-07T20:16:02Z", "type": "commit"}]}