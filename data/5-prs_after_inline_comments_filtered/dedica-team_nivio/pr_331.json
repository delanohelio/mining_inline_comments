{"pr_number": 331, "pr_title": "[#321] kpis initialized early with landscape", "pr_createdAt": "2020-11-24T15:42:39Z", "pr_url": "https://github.com/dedica-team/nivio/pull/331", "timeline": [{"oid": "d6112065339da99f22d9b0432760fbf8b9c71aa6", "url": "https://github.com/dedica-team/nivio/commit/d6112065339da99f22d9b0432760fbf8b9c71aa6", "message": "[#321] kpis initialized early with landscape", "committedDate": "2020-11-24T15:42:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDM4OTEzMw==", "url": "https://github.com/dedica-team/nivio/pull/331#discussion_r530389133", "bodyText": "This looks a bit strange at the first sight. I checked more deeply and realized that applyKPIs() is a default method in the Asseable interface that recursively calls itself.\nI would have suggested to make applyKPIs() in Landscape use the KPIs already known to the Landscape. I did not see any usage of landscape.applyKPIs(Map<String, KPI> kpis) where we would provide the KPIs from the outside.", "author": "mfbieber", "createdAt": "2020-11-25T13:53:03Z", "path": "src/main/java/de/bonndan/nivio/assessment/AssessmentController.java", "diffHunk": "@@ -31,9 +28,7 @@ public AssessmentController(LandscapeRepository landscapeRepository, KPIFactory\n             return ResponseEntity.notFound().build();\n         }\n \n-        Assessment assessment = new Assessment(\n-                landscape.applyKPIs(factory.getConfiguredKPIs(landscape))\n-        );\n+        Assessment assessment = new Assessment(landscape.applyKPIs(landscape.getKpis()));", "originalCommit": "d6112065339da99f22d9b0432760fbf8b9c71aa6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTE0NjUwMQ==", "url": "https://github.com/dedica-team/nivio/pull/331#discussion_r531146501", "bodyText": "I think we could check how the Landscape object works after #212 has been resolved. Maybe thinks like this are already cleaned up after these changes.", "author": "mfbieber", "createdAt": "2020-11-26T16:52:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDM4OTEzMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTE0NzQ1Mw==", "url": "https://github.com/dedica-team/nivio/pull/331#discussion_r531147453", "bodyText": "Objects.requireNonNull() does not check if the map is empty, only if an object == null.", "author": "mfbieber", "createdAt": "2020-11-26T16:55:03Z", "path": "src/main/java/de/bonndan/nivio/assessment/kpi/KPIFactory.java", "diffHunk": "@@ -32,16 +29,18 @@ public KPIFactory(ApplicationEventPublisher eventPublisher) {\n     /**\n      * Returns the default KPIs plus custom ones and configuration.\n      *\n-     * @param landscape the landscape\n+     * @param kpiConfigMap the landscape kpi configurations\n      * @return effective KPIs\n+     * @throws ProcessingException if a KPI is misconfigured\n      */\n-    public Map<String, KPI> getConfiguredKPIs(Landscape landscape) {\n+    public Map<String, KPI> getConfiguredKPIs(@NonNull Map<String, KPIConfig> kpiConfigMap) {\n \n-        Map<String, KPIConfig> config = landscape.getConfig().getKPIs();\n-        Map<String, KPI> kpis = new HashMap<>(defaultKPIs.size() + config.size());\n+        Objects.requireNonNull(kpiConfigMap, \"kpi config is null or empty\");", "originalCommit": "d6112065339da99f22d9b0432760fbf8b9c71aa6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTQxMjM0Nw==", "url": "https://github.com/dedica-team/nivio/pull/331#discussion_r531412347", "bodyText": "Yes. If the are no configured KPIs, the map would be empty.", "author": "bonndan", "createdAt": "2020-11-27T06:55:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTE0NzQ1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjIxMTkzNQ==", "url": "https://github.com/dedica-team/nivio/pull/331#discussion_r532211935", "bodyText": "I meant that the message is missleading, we are not checking if the map is empty, only if it is null ;)", "author": "mfbieber", "createdAt": "2020-11-29T13:45:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTE0NzQ1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjIyNDQ5NQ==", "url": "https://github.com/dedica-team/nivio/pull/331#discussion_r532224495", "bodyText": "Fixed in a different branch.", "author": "bonndan", "createdAt": "2020-11-29T15:22:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTE0NzQ1Mw=="}], "type": "inlineReview"}, {"oid": "a19c49603a6703139b0af770c461115b667eea4f", "url": "https://github.com/dedica-team/nivio/commit/a19c49603a6703139b0af770c461115b667eea4f", "message": "[#321] renamed method, added comments", "committedDate": "2020-11-27T06:52:45Z", "type": "commit"}]}