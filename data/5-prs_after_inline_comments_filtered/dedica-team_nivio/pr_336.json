{"pr_number": 336, "pr_title": "External data from links, interal refactoring", "pr_createdAt": "2020-12-07T17:40:31Z", "pr_url": "https://github.com/dedica-team/nivio/pull/336", "timeline": [{"oid": "3bbc7e93a2b3f3239e832ddd80d1d462f09f992f", "url": "https://github.com/dedica-team/nivio/commit/3bbc7e93a2b3f3239e832ddd80d1d462f09f992f", "message": "[#97] draft how link resolving could work", "committedDate": "2020-07-17T12:56:50Z", "type": "commit"}, {"oid": "6d0153d3ac423a64efb1ffb00fb2de8b9b24d878", "url": "https://github.com/dedica-team/nivio/commit/6d0153d3ac423a64efb1ffb00fb2de8b9b24d878", "message": "[#97] draft how link resolving could work", "committedDate": "2020-12-06T17:32:34Z", "type": "commit"}, {"oid": "4d25340619ae78f2900bb4ef183a963f2a13584f", "url": "https://github.com/dedica-team/nivio/commit/4d25340619ae78f2900bb4ef183a963f2a13584f", "message": "[#97] link handler work in progress", "committedDate": "2020-12-06T21:21:57Z", "type": "commit"}, {"oid": "4796d53f68b055afd071bf73c287a0457ce8e7cc", "url": "https://github.com/dedica-team/nivio/commit/4796d53f68b055afd071bf73c287a0457ce8e7cc", "message": "Merge remote-tracking branch 'origin/97_link_resolver' into 97_link_resolver\n\n# Conflicts:\n#\tsrc/main/java/de/bonndan/nivio/input/Indexer.java\n#\tsrc/main/java/de/bonndan/nivio/input/LinksResolver.java\n#\tsrc/test/java/de/bonndan/nivio/input/IndexerIntegrationTest.java\n#\tsrc/test/java/de/bonndan/nivio/output/jgraphx/JGraphXRendererTest.java", "committedDate": "2020-12-06T21:23:43Z", "type": "commit"}, {"oid": "171b79832a40ab1c9603ae313a66bf2f8cd13cc5", "url": "https://github.com/dedica-team/nivio/commit/171b79832a40ab1c9603ae313a66bf2f8cd13cc5", "message": "[#97] github repo link handler", "committedDate": "2020-12-07T17:28:23Z", "type": "commit"}, {"oid": "3b024961832ed3876b093a4297a9ff63e08cb53e", "url": "https://github.com/dedica-team/nivio/commit/3b024961832ed3876b093a4297a9ff63e08cb53e", "message": "[#97] inout landscape has repo link", "committedDate": "2020-12-07T17:33:58Z", "type": "commit"}, {"oid": "fd2bf50a610015b92157bcb2aed79de7ebe40cbc", "url": "https://github.com/dedica-team/nivio/commit/fd2bf50a610015b92157bcb2aed79de7ebe40cbc", "message": "[#97] sonar wip", "committedDate": "2020-12-07T19:52:33Z", "type": "commit"}, {"oid": "1347bf4406191901c17aac953093c8fb3cf4c8f8", "url": "https://github.com/dedica-team/nivio/commit/1347bf4406191901c17aac953093c8fb3cf4c8f8", "message": "[#97] sonar wip", "committedDate": "2020-12-07T19:55:24Z", "type": "commit"}, {"oid": "8c84be709db4856b645a539a69b47b3cbf131910", "url": "https://github.com/dedica-team/nivio/commit/8c84be709db4856b645a539a69b47b3cbf131910", "message": "[#97] sonar wip", "committedDate": "2020-12-07T20:01:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzc5NDQ3MQ==", "url": "https://github.com/dedica-team/nivio/pull/336#discussion_r537794471", "bodyText": "@sl0815 still no time to work on this? The GitHub connection is already working. Loading Sonarqube stuff is just a matter of knowing their API.", "author": "bonndan", "createdAt": "2020-12-07T20:03:35Z", "path": "src/main/java/de/bonndan/nivio/input/linked/SonarLinkHandler.java", "diffHunk": "@@ -0,0 +1,41 @@\n+package de.bonndan.nivio.input.linked;\n+\n+import de.bonndan.nivio.model.Labeled;\n+import de.bonndan.nivio.model.Link;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.sonar.wsclient.SonarClient;\n+\n+import java.util.Optional;\n+import java.util.concurrent.CompletableFuture;\n+\n+public class SonarLinkHandler implements ExternalLinkHandler {\n+\n+    private final Logger LOGGER = LoggerFactory.getLogger(SonarLinkHandler.class);\n+\n+    private final Optional<SonarClient> sonarClient;\n+    private final String sonarApiEndpoint;\n+\n+    public SonarLinkHandler(Optional<SonarClient> sonarClient,String sonarApiEndpoint) {\n+        this.sonarClient = sonarClient;\n+\n+        this.sonarApiEndpoint = sonarApiEndpoint;\n+    }\n+\n+    /**\n+     * https://medium.com/@shanchathusanda/https-medium-com-shanchathusanda-integrating-sonarqube-apis-with-a-java-application-de8fdc8b951f\n+     * @param link\n+     * @param component\n+     * @return\n+     */\n+    @Override\n+    public CompletableFuture<String> resolveAndApplyData(Link link, Labeled component) {\n+        if (sonarClient.isEmpty()) {\n+            return CompletableFuture.completedFuture(\"SonarClient is not configured\");\n+        }\n+\n+        SonarClient sonarClient = this.sonarClient.get();\n+        // TODO", "originalCommit": "8c84be709db4856b645a539a69b47b3cbf131910", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "187b77bd61650b28e820c5e46b9dd8ffce0bb0df", "url": "https://github.com/dedica-team/nivio/commit/187b77bd61650b28e820c5e46b9dd8ffce0bb0df", "message": "[#97] external links resolved earlier, now contribute to input DTOs", "committedDate": "2020-12-14T11:07:18Z", "type": "commit"}, {"oid": "b38b2e95b3656bc493bc0f49c71288c435649c06", "url": "https://github.com/dedica-team/nivio/commit/b38b2e95b3656bc493bc0f49c71288c435649c06", "message": "[#97] extended test", "committedDate": "2020-12-14T11:30:08Z", "type": "commit"}, {"oid": "dd6a506b0963d8980e32cad7a9a01b950432b785", "url": "https://github.com/dedica-team/nivio/commit/dd6a506b0963d8980e32cad7a9a01b950432b785", "message": "[#97] extended test", "committedDate": "2020-12-14T11:32:22Z", "type": "commit"}, {"oid": "6628f98a4389656daf508cff8c3efbdb5cc4b8e8", "url": "https://github.com/dedica-team/nivio/commit/6628f98a4389656daf508cff8c3efbdb5cc4b8e8", "message": "[#97] extended GitHubRepoHandler", "committedDate": "2020-12-15T07:03:50Z", "type": "commit"}, {"oid": "6f9e2948998fbe3d6424a3d41c5dd65cd61d835c", "url": "https://github.com/dedica-team/nivio/commit/6f9e2948998fbe3d6424a3d41c5dd65cd61d835c", "message": "[#97] group description fix", "committedDate": "2020-12-15T07:08:37Z", "type": "commit"}, {"oid": "9607011cdc7bacc6374ef12ee3c50f6ea760fc54", "url": "https://github.com/dedica-team/nivio/commit/9607011cdc7bacc6374ef12ee3c50f6ea760fc54", "message": "[#97] LinksResolver fix", "committedDate": "2020-12-15T07:09:00Z", "type": "commit"}, {"oid": "675766e93c8ce3048b1a37909f5fd462ae9ca9e5", "url": "https://github.com/dedica-team/nivio/commit/675766e93c8ce3048b1a37909f5fd462ae9ca9e5", "message": "[#97] added prometheus url", "committedDate": "2020-12-15T07:09:31Z", "type": "commit"}, {"oid": "c5212f4ec9e553e91497a3692b25a5f148f50f8b", "url": "https://github.com/dedica-team/nivio/commit/c5212f4ec9e553e91497a3692b25a5f148f50f8b", "message": "[#97] refactored resolving of templates (no more coupling with templates map between resolvers)", "committedDate": "2020-12-15T09:18:38Z", "type": "commit"}, {"oid": "c3a7d0abefbf39c2b87147277a82ed27f995bff5", "url": "https://github.com/dedica-team/nivio/commit/c3a7d0abefbf39c2b87147277a82ed27f995bff5", "message": "[#97] refactored indexer: distinction between Processor and Resolver", "committedDate": "2020-12-15T09:38:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIyODAzMw==", "url": "https://github.com/dedica-team/nivio/pull/336#discussion_r546228033", "bodyText": "Is this just a Map merge? If yes, why not use item.getLinks().putAll(increment.getLinks());", "author": "mfbieber", "createdAt": "2020-12-19T11:34:35Z", "path": "src/main/java/de/bonndan/nivio/input/ComponentDescriptionValues.java", "diffHunk": "@@ -0,0 +1,60 @@\n+package de.bonndan.nivio.input;\n+\n+import de.bonndan.nivio.input.dto.ComponentDescription;\n+import de.bonndan.nivio.input.dto.ItemDescription;\n+import de.bonndan.nivio.model.Labeled;\n+import org.springframework.util.StringUtils;\n+\n+import static de.bonndan.nivio.util.SafeAssign.assignSafe;\n+import static de.bonndan.nivio.util.SafeAssign.assignSafeIfAbsent;\n+\n+public class ComponentDescriptionValues {\n+\n+    /**\n+     * Overwrites labels and links.\n+     *\n+     * @param existing  current description present in the landscape\n+     * @param increment new values\n+     */\n+    public static void assignNotNull(ComponentDescription existing, ComponentDescription increment) {\n+\n+        if (increment.getName() != null)\n+            existing.setName(increment.getName());\n+\n+        if (increment.getDescription() != null)\n+            existing.setDescription(increment.getDescription());\n+\n+        if (increment.getOwner() != null)\n+            existing.setOwner(increment.getOwner());\n+\n+        if (increment.getLabels() != null) {\n+            increment.getLabels().forEach((s, s2) -> {\n+                if (increment.getLabel(s) != null) {\n+                    existing.setLabel(s, s2);\n+                }\n+            });\n+        }\n+\n+        existing.getLinks().putAll(increment.getLinks());\n+\n+    }\n+    /**\n+     * Writes the values of the increment (second object) to the first where first is null/absent.\n+     *\n+     * @param item     target\n+     * @param increment source\n+     */\n+    public static void assignSafeNotNull(ComponentDescription item, ComponentDescription increment) {\n+\n+        assignSafeIfAbsent(increment.getName(), item.getName(), item::setName);\n+        assignSafeIfAbsent(increment.getDescription(), item.getDescription(), item::setDescription);\n+        assignSafeIfAbsent(increment.getOwner(), item.getOwner(), item::setOwner);\n+\n+        Labeled.merge(increment, item);\n+\n+        increment.getLinks().entrySet().stream()\n+                .filter(entry -> !item.getLinks().containsKey(entry.getKey()))\n+                .forEach(entry -> item.getLinks().put(entry.getKey(), entry.getValue()));", "originalCommit": "c3a7d0abefbf39c2b87147277a82ed27f995bff5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIyODQ0Mg==", "url": "https://github.com/dedica-team/nivio/pull/336#discussion_r546228442", "bodyText": "It is putIfAbsent \ud83d\ude04", "author": "bonndan", "createdAt": "2020-12-19T11:38:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIyODAzMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIzNTc5Ng==", "url": "https://github.com/dedica-team/nivio/pull/336#discussion_r546235796", "bodyText": "ok", "author": "mfbieber", "createdAt": "2020-12-19T12:58:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIyODAzMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIzMTk1NA==", "url": "https://github.com/dedica-team/nivio/pull/336#discussion_r546231954", "bodyText": "Shouldn't the method be named resolve()?", "author": "mfbieber", "createdAt": "2020-12-19T12:16:57Z", "path": "src/main/java/de/bonndan/nivio/input/Indexer.java", "diffHunk": "@@ -87,42 +88,45 @@ private void runResolvers(LandscapeDescription input, Landscape landscape) {\n         KPIFactory kpiFactory = new KPIFactory();\n         landscape.setKpis(kpiFactory.getConfiguredKPIs(input.getConfig().getKPIs()));\n \n-        Map<ItemDescription, List<String>> templatesAndTargets = new HashMap<>();\n         // read all input sources\n-        new SourceReferencesResolver(formatFactory, logger).resolve(input, templatesAndTargets);\n+        new SourceReferencesResolver(formatFactory, logger).resolve(input);\n \n-        // apply template values to the items\n-        new TemplateResolver().processTemplates(input, templatesAndTargets);\n+        // apply template values to items\n+        new TemplateResolver(logger).resolve(input);\n \n-        // read special labels on items and assign the values to fields\n-        new LabelToFieldProcessor(logger).process(input, landscape);\n+        // resolve links on components to gather more data.\n+        new LinksResolver(logger, linkHandlerFactory).process(input);", "originalCommit": "c3a7d0abefbf39c2b87147277a82ed27f995bff5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIzMjM1MA==", "url": "https://github.com/dedica-team/nivio/pull/336#discussion_r546232350", "bodyText": "excellent observation, Sherlock!", "author": "bonndan", "createdAt": "2020-12-19T12:21:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIzMTk1NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIzMjU4Ng==", "url": "https://github.com/dedica-team/nivio/pull/336#discussion_r546232586", "bodyText": "done.", "author": "bonndan", "createdAt": "2020-12-19T12:24:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIzMTk1NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIzMjMyNg==", "url": "https://github.com/dedica-team/nivio/pull/336#discussion_r546232326", "bodyText": "Since this is all about resolvers and processors. What is the difference between both of them? They both operate on the provided LandscapeDescription input. Is the result a modified input which is later applied to the Landscape?", "author": "mfbieber", "createdAt": "2020-12-19T12:21:45Z", "path": "src/main/java/de/bonndan/nivio/input/Indexer.java", "diffHunk": "@@ -87,42 +88,45 @@ private void runResolvers(LandscapeDescription input, Landscape landscape) {\n         KPIFactory kpiFactory = new KPIFactory();\n         landscape.setKpis(kpiFactory.getConfiguredKPIs(input.getConfig().getKPIs()));\n \n-        Map<ItemDescription, List<String>> templatesAndTargets = new HashMap<>();\n         // read all input sources\n-        new SourceReferencesResolver(formatFactory, logger).resolve(input, templatesAndTargets);\n+        new SourceReferencesResolver(formatFactory, logger).resolve(input);\n \n-        // apply template values to the items\n-        new TemplateResolver().processTemplates(input, templatesAndTargets);\n+        // apply template values to items\n+        new TemplateResolver(logger).resolve(input);\n \n-        // read special labels on items and assign the values to fields\n-        new LabelToFieldProcessor(logger).process(input, landscape);\n+        // resolve links on components to gather more data.\n+        new LinksResolver(logger, linkHandlerFactory).process(input);\n \n         // mask any label containing secrets\n-        new SecureLabelsProcessor().process(input);\n+        new SecureLabelsResolver(logger).resolve(input);\n \n         // create relation targets on the fly if the landscape is configured \"greedy\"\n-        new InstantItemResolver(logger).processTargets(input);\n+        new InstantItemResolver(logger).resolve(input);\n+\n+        // read special labels on items and assign the values to fields\n+        new LabelToFieldResolver(logger).resolve(input);\n \n         // find items for relation endpoints (which can be queries, identifiers...)\n-        new RelationEndpointResolver(logger).processRelations(input);\n+        // KEEP here (must run late after other resolvers)\n+        new RelationEndpointResolver(logger).resolve(input);\n \n         // add any missing groups\n-        new GroupResolver(logger).process(input, landscape);\n+        new GroupProcessor(logger).process(input, landscape);", "originalCommit": "c3a7d0abefbf39c2b87147277a82ed27f995bff5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIzMjUxNw==", "url": "https://github.com/dedica-team/nivio/pull/336#discussion_r546232517", "bodyText": "Maybe the naming can be discussed. Resolvers just modify and extended the input, but not not affect the final output.", "author": "bonndan", "createdAt": "2020-12-19T12:23:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIzMjMyNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIzNTg3NQ==", "url": "https://github.com/dedica-team/nivio/pull/336#discussion_r546235875", "bodyText": "Why is an input modified if it does not have an effect on the final output?\nI am just trying to understand the underlying mechanism ;)", "author": "mfbieber", "createdAt": "2020-12-19T12:59:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIzMjMyNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIzNjE5OA==", "url": "https://github.com/dedica-team/nivio/pull/336#discussion_r546236198", "bodyText": "First, the data is aggregated in the ComponentDescription objects. This is done sequentially by the different Resolvers. Then the processors do their work and start mapping the input to the final Landscape.", "author": "bonndan", "createdAt": "2020-12-19T13:03:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIzMjMyNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjQwNTExMg==", "url": "https://github.com/dedica-team/nivio/pull/336#discussion_r546405112", "bodyText": "Okay thanks, now I understand!", "author": "mfbieber", "createdAt": "2020-12-20T17:22:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIzMjMyNg=="}], "type": "inlineReview"}, {"oid": "55ebdb6dd175e9e0de82e9d0600081ddf2df2b0a", "url": "https://github.com/dedica-team/nivio/commit/55ebdb6dd175e9e0de82e9d0600081ddf2df2b0a", "message": "[#97] LinksResolver extends Resolver", "committedDate": "2020-12-19T12:24:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIzMjU5Ng==", "url": "https://github.com/dedica-team/nivio/pull/336#discussion_r546232596", "bodyText": "The contains check is not necessary. Can't this also be simpler like this: item.getInterfaces().addAll(template.getInterfaces());?", "author": "mfbieber", "createdAt": "2020-12-19T12:24:56Z", "path": "src/main/java/de/bonndan/nivio/input/ItemDescriptionValues.java", "diffHunk": "@@ -13,32 +16,46 @@\n      */\n     public static void assignNotNull(ItemDescription existing, ItemDescription increment) {\n \n-        if (increment.getName() != null)\n-            existing.setName(increment.getName());\n+        ComponentDescriptionValues.assignNotNull(existing, increment);\n+\n         if (increment.getType() != null)\n             existing.setType(increment.getType());\n-        if (increment.getDescription() != null)\n-            existing.setDescription(increment.getDescription());\n         if (increment.getContact() != null)\n             existing.setContact(increment.getContact());\n \n-        if (increment.getOwner() != null)\n-            existing.setOwner(increment.getOwner());\n         if (increment.getGroup() != null)\n             existing.setGroup(increment.getGroup());\n \n-        if (increment.getLabels() != null) {\n-            increment.getLabels().forEach((s, s2) -> {\n-                if (increment.getLabel(s) != null) {\n-                    existing.setLabel(s, s2);\n-                }\n-            });\n-        }\n-\n-        existing.getLinks().putAll(increment.getLinks());\n-\n         assignSafe(increment.getRelations(), (rel) -> rel.forEach(existing::addRelation));\n \n         assignSafe(increment.getInterfaces(), (set) -> set.forEach(intf -> existing.getInterfaces().add(intf)));\n     }\n+\n+    /**\n+     * Writes the values of the template (second object) to the first where first is null.\n+     *\n+     * @param item     target\n+     * @param template source\n+     */\n+    public static void assignSafeNotNull(ItemDescription item, ItemDescription template) {\n+\n+        ComponentDescriptionValues.assignSafeNotNull(item, template);\n+\n+        assignSafeIfAbsent(template.getType(), item.getType(), item::setType);\n+        assignSafeIfAbsent(template.getContact(), item.getContact(), item::setContact);\n+        assignSafeIfAbsent(template.getGroup(), item.getGroup(), item::setGroup);\n+\n+        if (template.getProvidedBy() != null) {\n+            template.getProvidedBy().stream()\n+                    .filter(s -> !StringUtils.isEmpty(s) && !item.getProvidedBy().contains(s))\n+                    .forEach(s -> item.getProvidedBy().add(s));\n+        }\n+\n+        template.getRelations().forEach(item::addRelation);\n+\n+        template.getInterfaces().forEach(interfaceItem -> {\n+            if (!item.getInterfaces().contains(interfaceItem))\n+                item.getInterfaces().add(interfaceItem);\n+        });", "originalCommit": "c3a7d0abefbf39c2b87147277a82ed27f995bff5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIzMjkyNw==", "url": "https://github.com/dedica-team/nivio/pull/336#discussion_r546232927", "bodyText": "done", "author": "bonndan", "createdAt": "2020-12-19T12:28:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIzMjU5Ng=="}], "type": "inlineReview"}, {"oid": "8eef21e7dc674167e3fec9991401bd0b4c14fd11", "url": "https://github.com/dedica-team/nivio/commit/8eef21e7dc674167e3fec9991401bd0b4c14fd11", "message": "[#97] fix wording", "committedDate": "2020-12-19T12:25:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIzMjg5Mw==", "url": "https://github.com/dedica-team/nivio/pull/336#discussion_r546232893", "bodyText": "Why does this not extend Resolver?", "author": "mfbieber", "createdAt": "2020-12-19T12:27:44Z", "path": "src/main/java/de/bonndan/nivio/input/LinksResolver.java", "diffHunk": "@@ -0,0 +1,81 @@\n+package de.bonndan.nivio.input;\n+\n+import de.bonndan.nivio.ProcessingException;\n+import de.bonndan.nivio.input.dto.ComponentDescription;\n+import de.bonndan.nivio.input.dto.LandscapeDescription;\n+import de.bonndan.nivio.input.external.LinkHandlerFactory;\n+import de.bonndan.nivio.util.SafeAssign;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.concurrent.CompletableFuture;\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.TimeoutException;\n+\n+\n+/**\n+ * Resolves all links of all landscape components.\n+ */\n+public class LinksResolver {", "originalCommit": "c3a7d0abefbf39c2b87147277a82ed27f995bff5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIzMjk4NA==", "url": "https://github.com/dedica-team/nivio/pull/336#discussion_r546232984", "bodyText": "You're right, I have changed it based on your previous comment.", "author": "bonndan", "createdAt": "2020-12-19T12:28:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIzMjg5Mw=="}], "type": "inlineReview"}, {"oid": "d91b670e9fb2cbe672adcf3587e02490852426a7", "url": "https://github.com/dedica-team/nivio/commit/d91b670e9fb2cbe672adcf3587e02490852426a7", "message": "[#97] code cleanup", "committedDate": "2020-12-19T12:27:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIzMzI1NQ==", "url": "https://github.com/dedica-team/nivio/pull/336#discussion_r546233255", "bodyText": "Do you use  an abstract class instead of an interface only because of the ProcessLog field?", "author": "mfbieber", "createdAt": "2020-12-19T12:31:37Z", "path": "src/main/java/de/bonndan/nivio/input/Processor.java", "diffHunk": "@@ -0,0 +1,20 @@\n+package de.bonndan.nivio.input;\n+\n+import de.bonndan.nivio.input.dto.LandscapeDescription;\n+import de.bonndan.nivio.model.Landscape;\n+\n+/**\n+ * Modifies the target landscape using input.\n+ *\n+ *\n+ */\n+abstract class Processor {\n+\n+    protected final ProcessLog processLog;\n+\n+    protected Processor(ProcessLog processLog) {\n+        this.processLog = processLog;\n+    }", "originalCommit": "c3a7d0abefbf39c2b87147277a82ed27f995bff5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIzNTI0Ng==", "url": "https://github.com/dedica-team/nivio/pull/336#discussion_r546235246", "bodyText": "Yes, so far. We can change it to an interface and add the processlog as further argument to process/resolve.", "author": "bonndan", "createdAt": "2020-12-19T12:53:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIzMzI1NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIzNTk3NA==", "url": "https://github.com/dedica-team/nivio/pull/336#discussion_r546235974", "bodyText": "It's ok, I dont mind the abstract class. I think the only thing that \"bothers\" me is that I don't fully understand what the resolvers and the processors do and why - see comment above :)", "author": "mfbieber", "createdAt": "2020-12-19T13:00:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIzMzI1NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIzNjQwNQ==", "url": "https://github.com/dedica-team/nivio/pull/336#discussion_r546236405", "bodyText": "Until a few days ago I was not aware of that, too. I just observed that some of the classes in Indexer only worked on the input objects, while others only/mostly worked on the output.", "author": "bonndan", "createdAt": "2020-12-19T13:05:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIzMzI1NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIzMzM5MQ==", "url": "https://github.com/dedica-team/nivio/pull/336#discussion_r546233391", "bodyText": "Why is the name set to null?", "author": "mfbieber", "createdAt": "2020-12-19T12:33:20Z", "path": "src/main/java/de/bonndan/nivio/input/TemplateResolver.java", "diffHunk": "@@ -1,30 +1,44 @@\n package de.bonndan.nivio.input;\n \n+import de.bonndan.nivio.ProcessingException;\n import de.bonndan.nivio.input.dto.ItemDescription;\n import de.bonndan.nivio.input.dto.LandscapeDescription;\n-import de.bonndan.nivio.model.*;\n-import org.springframework.util.StringUtils;\n+import de.bonndan.nivio.util.URLHelper;\n \n-import java.util.*;\n-\n-import static de.bonndan.nivio.util.SafeAssign.assignSafeIfAbsent;\n+import java.net.URL;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n \n /**\n  * Responsible to apply templates to landscape items.\n  * <p>\n  * Resolves the items the templates are assigned to as well as dynamic endpoints of relation in templates.\n  */\n-public class TemplateResolver {\n+public class TemplateResolver extends Resolver {\n+\n+    protected TemplateResolver(ProcessLog processLog) {\n+        super(processLog);\n+    }\n \n     /**\n      * Applies the template values and relations to all items the template is assigned to.\n      *\n-     * @param landscape           the landscape containing all(!) items. Querying happens on these items.\n-     * @param templatesAndTargets The assignment can be a list of static item identifiers or dynamic queries to match\n-     *                            certain items.\n+     * @param landscape the landscape containing all(!) items. Querying happens on these items.\n      */\n-    public void processTemplates(LandscapeDescription landscape, Map<ItemDescription, List<String>> templatesAndTargets) {\n-        templatesAndTargets.forEach((landscapeItem, identifiers) -> applyTemplateValues(landscapeItem, identifiers, landscape));\n+    @Override\n+    public void resolve(LandscapeDescription landscape) {\n+\n+        Map<ItemDescription, List<String>> templatesAndTargets = new HashMap<>();\n+        landscape.getSourceReferences().forEach(ref -> {\n+            ref.getAssignTemplates().forEach((key, identifiers) -> {\n+                ItemDescription template = landscape.getTemplates().get(key);\n+                template.setName(null);", "originalCommit": "c3a7d0abefbf39c2b87147277a82ed27f995bff5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIzNTA5Nw==", "url": "https://github.com/dedica-team/nivio/pull/336#discussion_r546235097", "bodyText": "Because names are more or less unique and I think it makes no sense to apply the same name to different items.", "author": "bonndan", "createdAt": "2020-12-19T12:51:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIzMzM5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIzNjA4Mw==", "url": "https://github.com/dedica-team/nivio/pull/336#discussion_r546236083", "bodyText": "Isn't the name then null by default for a template? Why set it explicitly?", "author": "mfbieber", "createdAt": "2020-12-19T13:02:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIzMzM5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIzNjI2NA==", "url": "https://github.com/dedica-team/nivio/pull/336#discussion_r546236264", "bodyText": "I mean, annotate it as @Nullable, make the getter either return @Nullable or  @nonnulland anOptional` and the caller of the getter knows what to expect.\nAlso, the name is annotated with @NotEmpty in ItemDescription. I think null is not a valid value - is it?", "author": "mfbieber", "createdAt": "2020-12-19T13:03:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIzMzM5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIzNzE2Ng==", "url": "https://github.com/dedica-team/nivio/pull/336#discussion_r546237166", "bodyText": "ItemDescription is misused as template. And perhaps you are right: there could exist items without a name (not without identifier, however).", "author": "bonndan", "createdAt": "2020-12-19T13:14:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIzMzM5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIzNzcwMA==", "url": "https://github.com/dedica-team/nivio/pull/336#discussion_r546237700", "bodyText": "I have updated the interface and added @nullable annotations", "author": "bonndan", "createdAt": "2020-12-19T13:19:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIzMzM5MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIzNDIwMg==", "url": "https://github.com/dedica-team/nivio/pull/336#discussion_r546234202", "bodyText": "Is there any ComponentDescription that will not have a name, description and owner when the object is constructed? We are working towards more inmutability in objects, I would not invite to use the setters through the interface and rather deprecate as much setters as possible ;)", "author": "mfbieber", "createdAt": "2020-12-19T12:42:14Z", "path": "src/main/java/de/bonndan/nivio/input/dto/ComponentDescription.java", "diffHunk": "@@ -0,0 +1,26 @@\n+package de.bonndan.nivio.input.dto;\n+\n+import de.bonndan.nivio.model.Labeled;\n+import de.bonndan.nivio.model.Linked;\n+\n+/**\n+ * Base interface for input DTOs.\n+ *\n+ *\n+ */\n+public interface ComponentDescription extends Labeled, Linked {\n+\n+    String getIdentifier();\n+\n+    String getName();\n+\n+    void setName(String name);\n+\n+    String getDescription();\n+\n+    void setDescription(String description);\n+\n+    String getOwner();\n+\n+    void setOwner(String owner);", "originalCommit": "c3a7d0abefbf39c2b87147277a82ed27f995bff5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIzNTU5OA==", "url": "https://github.com/dedica-team/nivio/pull/336#discussion_r546235598", "bodyText": "Yes, it is very likely that these values become available later during processing only. I would leave the input DTOs (all what extends from ComponentDescription) as mutable as possible.", "author": "bonndan", "createdAt": "2020-12-19T12:56:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIzNDIwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjQwNTc0MA==", "url": "https://github.com/dedica-team/nivio/pull/336#discussion_r546405740", "bodyText": "Okay", "author": "mfbieber", "createdAt": "2020-12-20T17:27:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIzNDIwMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIzNDY2OA==", "url": "https://github.com/dedica-team/nivio/pull/336#discussion_r546234668", "bodyText": "This is cool \ud83d\ude3b\nShouldn't the description though be something like \"Loads the open issues, open pull requests, the readme and the repositories description\"?", "author": "mfbieber", "createdAt": "2020-12-19T12:46:49Z", "path": "src/main/java/de/bonndan/nivio/input/external/github/GitHubRepoHandler.java", "diffHunk": "@@ -0,0 +1,75 @@\n+package de.bonndan.nivio.input.external.github;\n+\n+import de.bonndan.nivio.input.dto.ComponentDescription;\n+import de.bonndan.nivio.input.dto.ItemDescription;\n+import de.bonndan.nivio.input.external.ExternalLinkHandler;\n+import de.bonndan.nivio.model.Link;\n+import org.kohsuke.github.GHIssueState;\n+import org.kohsuke.github.GHRepository;\n+import org.kohsuke.github.GitHub;\n+import org.kohsuke.github.MarkdownMode;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.lang.NonNull;\n+import org.springframework.util.StringUtils;\n+\n+import java.util.concurrent.CompletableFuture;\n+\n+/**\n+ * https://github-api.kohsuke.org/index.html\n+ */\n+public class GitHubRepoHandler implements ExternalLinkHandler {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(GitHubRepoHandler.class);\n+\n+    public static final String OPEN_ISSUES = \"github.issues.open\";\n+    public static final String OPEN_PRS = \"github.pullrequests.open\";\n+    public static final String README = \"github.readme\";\n+    public static final String DESCRIPTION = \"github.description\";\n+\n+    private final GitHub gitHub;\n+\n+    public GitHubRepoHandler(GitHub gitHub) {\n+        this.gitHub = gitHub;\n+    }\n+\n+    /**\n+     * Loads the open issues from the repo.", "originalCommit": "c3a7d0abefbf39c2b87147277a82ed27f995bff5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIzNTg1Ng==", "url": "https://github.com/dedica-team/nivio/pull/336#discussion_r546235856", "bodyText": "done", "author": "bonndan", "createdAt": "2020-12-19T12:59:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIzNDY2OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIzNTEwNA==", "url": "https://github.com/dedica-team/nivio/pull/336#discussion_r546235104", "bodyText": "There is no test for this, is there? Also I didn't find one for the JsonCompositeHealth. Why not addind directly a test for this new functionality? The test should be rather simple now.\nI started adding jacoco with #329 and from what I saw, we can really improve on test code coverage!", "author": "mfbieber", "createdAt": "2020-12-19T12:51:53Z", "path": "src/main/java/de/bonndan/nivio/input/external/springboot/CompositeHealthDeserializer.java", "diffHunk": "@@ -0,0 +1,27 @@\n+package de.bonndan.nivio.input.external.springboot;\n+\n+import com.fasterxml.jackson.core.JsonParser;\n+import com.fasterxml.jackson.core.TreeNode;\n+import com.fasterxml.jackson.databind.DeserializationContext;\n+import com.fasterxml.jackson.databind.JsonDeserializer;\n+import com.fasterxml.jackson.databind.node.TextNode;\n+import org.springframework.boot.jackson.JsonComponent;\n+\n+import java.io.IOException;\n+import java.util.Map;\n+\n+@JsonComponent\n+public class CompositeHealthDeserializer extends JsonDeserializer<JsonCompositeHealth> {\n+\n+    @Override\n+    public JsonCompositeHealth deserialize(JsonParser jsonParser, DeserializationContext deserializationContext) throws IOException {", "originalCommit": "c3a7d0abefbf39c2b87147277a82ed27f995bff5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIzODY5OQ==", "url": "https://github.com/dedica-team/nivio/pull/336#discussion_r546238699", "bodyText": "It's tested indirectly in SpringBootHealthHandlerTest. Although you're right, I am not very motivated to invest my time in an JsonParser/TreeNode/bla etc. deep dive.", "author": "bonndan", "createdAt": "2020-12-19T13:29:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIzNTEwNA=="}], "type": "inlineReview"}, {"oid": "b71e25cd09eb0e8ce2af9c3631292c334147992e", "url": "https://github.com/dedica-team/nivio/commit/b71e25cd09eb0e8ce2af9c3631292c334147992e", "message": "[#97] wording fix", "committedDate": "2020-12-19T12:57:41Z", "type": "commit"}, {"oid": "f83a93190bca6977f045772f935d9f0c5ad2e78d", "url": "https://github.com/dedica-team/nivio/commit/f83a93190bca6977f045772f935d9f0c5ad2e78d", "message": "[#97] added comment", "committedDate": "2020-12-19T12:59:06Z", "type": "commit"}, {"oid": "402c5504ee649c32bf27f209db5ff526911144da", "url": "https://github.com/dedica-team/nivio/commit/402c5504ee649c32bf27f209db5ff526911144da", "message": "[#97] name,description can be null in ComponentDescription", "committedDate": "2020-12-19T13:17:56Z", "type": "commit"}, {"oid": "1088c1cdb4af1fa6387bf8f67881868a8ecd8563", "url": "https://github.com/dedica-team/nivio/commit/1088c1cdb4af1fa6387bf8f67881868a8ecd8563", "message": "[#97] added docs", "committedDate": "2020-12-19T16:15:11Z", "type": "commit"}, {"oid": "96838f780853ab88f6bd5dd95f1ffaf181266168", "url": "https://github.com/dedica-team/nivio/commit/96838f780853ab88f6bd5dd95f1ffaf181266168", "message": "cleanup", "committedDate": "2020-12-20T18:00:33Z", "type": "commit"}, {"oid": "922ef95f0987277ba5cd3cea2f9789e45eec4580", "url": "https://github.com/dedica-team/nivio/commit/922ef95f0987277ba5cd3cea2f9789e45eec4580", "message": "cleanup", "committedDate": "2020-12-20T18:30:59Z", "type": "commit"}]}