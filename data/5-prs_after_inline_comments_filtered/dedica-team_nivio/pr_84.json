{"pr_number": 84, "pr_title": "83 csv import", "pr_createdAt": "2020-01-16T05:41:15Z", "pr_url": "https://github.com/dedica-team/nivio/pull/84", "timeline": [{"oid": "e21407d4f337c3413caff75182806bbadad0e0a1", "url": "https://github.com/dedica-team/nivio/commit/e21407d4f337c3413caff75182806bbadad0e0a1", "message": "[#83] csv reader in item description factory", "committedDate": "2020-01-15T21:57:51Z", "type": "commit"}, {"oid": "12deadf6825ad7f741ddf614249563d8d1c5aea3", "url": "https://github.com/dedica-team/nivio/commit/12deadf6825ad7f741ddf614249563d8d1c5aea3", "message": "[#83] added csv in input / output graph", "committedDate": "2020-01-15T22:12:27Z", "type": "commit"}, {"oid": "473148991811120943767017200410f8ef739675", "url": "https://github.com/dedica-team/nivio/commit/473148991811120943767017200410f8ef739675", "message": "label to field processor can handle links", "committedDate": "2020-01-16T04:25:50Z", "type": "commit"}, {"oid": "c8799806430f83b669c65d96b951a5db4d2cab6c", "url": "https://github.com/dedica-team/nivio/commit/c8799806430f83b669c65d96b951a5db4d2cab6c", "message": "[#83] added test", "committedDate": "2020-01-16T04:26:24Z", "type": "commit"}, {"oid": "7c4c11968ed4a09a24ee15ff660dfd00c5c87221", "url": "https://github.com/dedica-team/nivio/commit/7c4c11968ed4a09a24ee15ff660dfd00c5c87221", "message": "[#83] integration test and fixes", "committedDate": "2020-01-16T04:54:35Z", "type": "commit"}, {"oid": "fc4aa30f9cf6173ecbb07078acc8c1040c2d545b", "url": "https://github.com/dedica-team/nivio/commit/fc4aa30f9cf6173ecbb07078acc8c1040c2d545b", "message": "[#83] documented csv as input source", "committedDate": "2020-01-16T05:27:13Z", "type": "commit"}, {"oid": "e889de0e97f8ec614b40d782788fc498aaa859f0", "url": "https://github.com/dedica-team/nivio/commit/e889de0e97f8ec614b40d782788fc498aaa859f0", "message": "[#83] updated documentation", "committedDate": "2020-01-16T05:39:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTAwNjc5OQ==", "url": "https://github.com/dedica-team/nivio/pull/84#discussion_r369006799", "bodyText": "btw: ItemDescriptionFactory has loads of if-statements without braces. \ud83d\ude43", "author": "jpgoelz", "createdAt": "2020-01-21T13:43:45Z", "path": "src/main/java/de/bonndan/nivio/input/csv/ItemDescriptionFactoryCSV.java", "diffHunk": "@@ -0,0 +1,80 @@\n+package de.bonndan.nivio.input.csv;\n+\n+import com.opencsv.CSVParser;\n+import com.opencsv.CSVParserBuilder;\n+import com.opencsv.CSVReader;\n+import com.opencsv.CSVReaderBuilder;\n+import de.bonndan.nivio.ProcessingException;\n+import de.bonndan.nivio.input.FileFetcher;\n+import de.bonndan.nivio.input.ItemDescriptionFactory;\n+import de.bonndan.nivio.input.LabelToFieldProcessor;\n+import de.bonndan.nivio.input.dto.ItemDescription;\n+import de.bonndan.nivio.input.dto.SourceReference;\n+import org.springframework.stereotype.Service;\n+\n+import java.io.StringReader;\n+import java.net.URL;\n+import java.util.*;\n+\n+@Service\n+public class ItemDescriptionFactoryCSV implements ItemDescriptionFactory {", "originalCommit": "e889de0e97f8ec614b40d782788fc498aaa859f0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTE1NDYwOA==", "url": "https://github.com/dedica-team/nivio/pull/84#discussion_r369154608", "bodyText": "cannot find any", "author": "bonndan", "createdAt": "2020-01-21T17:58:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTAwNjc5OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTIzNTg2MA==", "url": "https://github.com/dedica-team/nivio/pull/84#discussion_r369235860", "bodyText": "Lines 25 through 64...?\nItemDescriptionFactory.java in 83_csv_import", "author": "jpgoelz", "createdAt": "2020-01-21T20:50:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTAwNjc5OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQzMDUxMA==", "url": "https://github.com/dedica-team/nivio/pull/84#discussion_r369430510", "bodyText": "Right. I've been looking into the wrong file.", "author": "bonndan", "createdAt": "2020-01-22T08:46:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTAwNjc5OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTAxMDc1OA==", "url": "https://github.com/dedica-team/nivio/pull/84#discussion_r369010758", "bodyText": "Personally, I would go with List.of(\"csv\"), which is also immutable.\nSee Singleton List Showdown: Collections::singletonList Vs. List::of (tl;dr: \"Both Collections::singletonList and List:of are great choices for creating single-element lists. [...] I recommend going with List:of for its ease of use, readability, and better-documented immutability.)", "author": "jpgoelz", "createdAt": "2020-01-21T13:51:25Z", "path": "src/main/java/de/bonndan/nivio/input/csv/ItemDescriptionFactoryCSV.java", "diffHunk": "@@ -0,0 +1,80 @@\n+package de.bonndan.nivio.input.csv;\n+\n+import com.opencsv.CSVParser;\n+import com.opencsv.CSVParserBuilder;\n+import com.opencsv.CSVReader;\n+import com.opencsv.CSVReaderBuilder;\n+import de.bonndan.nivio.ProcessingException;\n+import de.bonndan.nivio.input.FileFetcher;\n+import de.bonndan.nivio.input.ItemDescriptionFactory;\n+import de.bonndan.nivio.input.LabelToFieldProcessor;\n+import de.bonndan.nivio.input.dto.ItemDescription;\n+import de.bonndan.nivio.input.dto.SourceReference;\n+import org.springframework.stereotype.Service;\n+\n+import java.io.StringReader;\n+import java.net.URL;\n+import java.util.*;\n+\n+@Service\n+public class ItemDescriptionFactoryCSV implements ItemDescriptionFactory {\n+\n+    public static final String IDENTIFIER_KEY = \"identifier\";\n+    private final FileFetcher fileFetcher;\n+\n+    public ItemDescriptionFactoryCSV(FileFetcher fileFetcher) {\n+        this.fileFetcher = fileFetcher;\n+    }\n+\n+    @Override\n+    public List<String> getFormats() {\n+        return Collections.singletonList(\"csv\");", "originalCommit": "e889de0e97f8ec614b40d782788fc498aaa859f0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTE1NDExNQ==", "url": "https://github.com/dedica-team/nivio/pull/84#discussion_r369154115", "bodyText": "done", "author": "bonndan", "createdAt": "2020-01-21T17:57:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTAxMDc1OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTAxMTgxOA==", "url": "https://github.com/dedica-team/nivio/pull/84#discussion_r369011818", "bodyText": "Because it is a sentence with a period: Mapping...", "author": "jpgoelz", "createdAt": "2020-01-21T13:53:19Z", "path": "src/main/java/de/bonndan/nivio/input/csv/ItemDescriptionFactoryCSV.java", "diffHunk": "@@ -0,0 +1,80 @@\n+package de.bonndan.nivio.input.csv;\n+\n+import com.opencsv.CSVParser;\n+import com.opencsv.CSVParserBuilder;\n+import com.opencsv.CSVReader;\n+import com.opencsv.CSVReaderBuilder;\n+import de.bonndan.nivio.ProcessingException;\n+import de.bonndan.nivio.input.FileFetcher;\n+import de.bonndan.nivio.input.ItemDescriptionFactory;\n+import de.bonndan.nivio.input.LabelToFieldProcessor;\n+import de.bonndan.nivio.input.dto.ItemDescription;\n+import de.bonndan.nivio.input.dto.SourceReference;\n+import org.springframework.stereotype.Service;\n+\n+import java.io.StringReader;\n+import java.net.URL;\n+import java.util.*;\n+\n+@Service\n+public class ItemDescriptionFactoryCSV implements ItemDescriptionFactory {\n+\n+    public static final String IDENTIFIER_KEY = \"identifier\";\n+    private final FileFetcher fileFetcher;\n+\n+    public ItemDescriptionFactoryCSV(FileFetcher fileFetcher) {\n+        this.fileFetcher = fileFetcher;\n+    }\n+\n+    @Override\n+    public List<String> getFormats() {\n+        return Collections.singletonList(\"csv\");\n+    }\n+\n+    @Override\n+    public List<ItemDescription> getDescriptions(SourceReference reference, URL baseUrl) {\n+        List<ItemDescription> itemDescriptions = new ArrayList<>();\n+        String content = fileFetcher.get(reference, baseUrl);\n+        CSVReader reader = getReader(reference, content);\n+\n+        Map<String, Object> mapping = (Map<String, Object>) reference.getProperty(\"mapping\");\n+        if (mapping == null) {\n+            throw new ProcessingException(reference.getLandscapeDescription(), \"mapping must be present in configuration.\");", "originalCommit": "e889de0e97f8ec614b40d782788fc498aaa859f0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTE1NDQzMA==", "url": "https://github.com/dedica-team/nivio/pull/84#discussion_r369154430", "bodyText": "put quotes around it", "author": "bonndan", "createdAt": "2020-01-21T17:58:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTAxMTgxOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTAxNTcyOQ==", "url": "https://github.com/dedica-team/nivio/pull/84#discussion_r369015729", "bodyText": "This class contains if-statements without braces.", "author": "jpgoelz", "createdAt": "2020-01-21T14:00:01Z", "path": "src/main/java/de/bonndan/nivio/input/dto/ItemDescription.java", "diffHunk": "@@ -17,6 +17,8 @@\n  */\n public class ItemDescription implements LandscapeItem {", "originalCommit": "e889de0e97f8ec614b40d782788fc498aaa859f0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTE1NTMyNw==", "url": "https://github.com/dedica-team/nivio/pull/84#discussion_r369155327", "bodyText": "done", "author": "bonndan", "createdAt": "2020-01-21T18:00:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTAxNTcyOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTAyODE5Mg==", "url": "https://github.com/dedica-team/nivio/pull/84#discussion_r369028192", "bodyText": "Why are not all test methods public?\nThe names of the methods don't really give away, what they are testing. Maybe change method names or at least use @DisplayName(\"Expect this and that\").", "author": "jpgoelz", "createdAt": "2020-01-21T14:22:13Z", "path": "src/test/java/de/bonndan/nivio/input/LabelToFieldProcessorTest.java", "diffHunk": "@@ -7,6 +7,9 @@\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n+import java.net.URL;\n+import java.util.Map;\n+\n import static org.junit.jupiter.api.Assertions.*;\n \n class LabelToFieldProcessorTest {", "originalCommit": "e889de0e97f8ec614b40d782788fc498aaa859f0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTE1OTEzMA==", "url": "https://github.com/dedica-team/nivio/pull/84#discussion_r369159130", "bodyText": "Test methods do not need to be public afaik. It's more a habit of good old PHP times.", "author": "bonndan", "createdAt": "2020-01-21T18:08:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTAyODE5Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTE1OTI3MA==", "url": "https://github.com/dedica-team/nivio/pull/84#discussion_r369159270", "bodyText": "added @DisplayName annotations", "author": "bonndan", "createdAt": "2020-01-21T18:09:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTAyODE5Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTAzMDI4Mg==", "url": "https://github.com/dedica-team/nivio/pull/84#discussion_r369030282", "bodyText": "IntelliJ complains: \"Statement lambda can be replaced with expression lambda.\"\nWhat are your thoughts on that, @bonndan, @Matthimatiker?", "author": "jpgoelz", "createdAt": "2020-01-21T14:25:42Z", "path": "src/test/java/de/bonndan/nivio/input/csv/ItemDescriptionFactoryCSVTest.java", "diffHunk": "@@ -0,0 +1,102 @@\n+package de.bonndan.nivio.input.csv;\n+\n+import de.bonndan.nivio.ProcessingException;\n+import de.bonndan.nivio.input.FileFetcher;\n+import de.bonndan.nivio.input.dto.ItemDescription;\n+import de.bonndan.nivio.input.dto.SourceReference;\n+import de.bonndan.nivio.input.http.HttpService;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import static org.junit.jupiter.api.Assertions.*;\n+\n+class ItemDescriptionFactoryCSVTest {\n+\n+    private FileFetcher fileFetcher;\n+\n+    @BeforeEach\n+    public void setup() {\n+        fileFetcher = new FileFetcher(new HttpService());\n+    }\n+\n+    @Test\n+    public void read() {\n+\n+        SourceReference file = new SourceReference(getRootPath() + \"/src/test/resources/example/services/test.csv\");\n+\n+        Map<String, String> mapping = new HashMap<>();\n+        mapping.put(\"identifier\", \"1\");\n+        mapping.put(\"name\", \"0\");\n+        mapping.put(\"description\", \"2\");\n+        file.setProperty(\"mapping\", mapping);\n+        file.setProperty(\"skipLines\", 1);\n+        file.setProperty(\"separator\", \";\");\n+\n+        ItemDescriptionFactoryCSV factoryCSV = new ItemDescriptionFactoryCSV(fileFetcher);\n+        List<ItemDescription> services = factoryCSV.getDescriptions(file, null);\n+        assertEquals(3, services.size());\n+        ItemDescription foo = services.get(0);\n+        assertNotNull(foo);\n+\n+        assertEquals(\"foo\", foo.getIdentifier());\n+        assertTrue(foo.getLabels().containsKey(\"nivio.name\"));\n+        assertEquals(\"foo\", foo.getLabels().get(\"nivio.name\"));\n+        assertTrue(foo.getLabels().containsKey(\"nivio.description\"));\n+        assertEquals(\"This does nothing\", foo.getLabels().get(\"nivio.description\"));\n+\n+        ItemDescription bar = services.get(1);\n+        assertNotNull(bar);\n+\n+        assertEquals(\"bar\", bar.getIdentifier());\n+        assertTrue(bar.getLabels().containsKey(\"nivio.name\"));\n+        assertEquals(\"bar\", bar.getLabels().get(\"nivio.name\"));\n+        assertTrue(bar.getLabels().containsKey(\"nivio.description\"));\n+        assertEquals(\"\", bar.getLabels().get(\"nivio.description\"));\n+\n+        ItemDescription super1 = services.get(2);\n+        assertNotNull(super1);\n+\n+        assertEquals(\"super1\", super1.getIdentifier());\n+        assertTrue(super1.getLabels().containsKey(\"nivio.name\"));\n+        assertEquals(\"Super Service\", super1.getLabels().get(\"nivio.name\"));\n+        assertTrue(super1.getLabels().containsKey(\"nivio.description\"));\n+        assertEquals(\"superior\", super1.getLabels().get(\"nivio.description\"));\n+    }\n+\n+    @Test\n+    public void failsWithoutMapping() {\n+\n+        SourceReference file = new SourceReference(getRootPath() + \"/src/test/resources/example/services/test.csv\");\n+        ItemDescriptionFactoryCSV factoryCSV = new ItemDescriptionFactoryCSV(fileFetcher);\n+\n+        assertThrows(ProcessingException.class, () -> {\n+            factoryCSV.getDescriptions(file, null);\n+        });", "originalCommit": "e889de0e97f8ec614b40d782788fc498aaa859f0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTE2MDIwMQ==", "url": "https://github.com/dedica-team/nivio/pull/84#discussion_r369160201", "bodyText": "I'd say this does not matter in tests, and here it is perhaps better to work with the system under test as usual.", "author": "bonndan", "createdAt": "2020-01-21T18:11:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTAzMDI4Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTAzMDY5NA==", "url": "https://github.com/dedica-team/nivio/pull/84#discussion_r369030694", "bodyText": "see above (+78 to +80).", "author": "jpgoelz", "createdAt": "2020-01-21T14:26:24Z", "path": "src/test/java/de/bonndan/nivio/input/csv/ItemDescriptionFactoryCSVTest.java", "diffHunk": "@@ -0,0 +1,102 @@\n+package de.bonndan.nivio.input.csv;\n+\n+import de.bonndan.nivio.ProcessingException;\n+import de.bonndan.nivio.input.FileFetcher;\n+import de.bonndan.nivio.input.dto.ItemDescription;\n+import de.bonndan.nivio.input.dto.SourceReference;\n+import de.bonndan.nivio.input.http.HttpService;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import static org.junit.jupiter.api.Assertions.*;\n+\n+class ItemDescriptionFactoryCSVTest {\n+\n+    private FileFetcher fileFetcher;\n+\n+    @BeforeEach\n+    public void setup() {\n+        fileFetcher = new FileFetcher(new HttpService());\n+    }\n+\n+    @Test\n+    public void read() {\n+\n+        SourceReference file = new SourceReference(getRootPath() + \"/src/test/resources/example/services/test.csv\");\n+\n+        Map<String, String> mapping = new HashMap<>();\n+        mapping.put(\"identifier\", \"1\");\n+        mapping.put(\"name\", \"0\");\n+        mapping.put(\"description\", \"2\");\n+        file.setProperty(\"mapping\", mapping);\n+        file.setProperty(\"skipLines\", 1);\n+        file.setProperty(\"separator\", \";\");\n+\n+        ItemDescriptionFactoryCSV factoryCSV = new ItemDescriptionFactoryCSV(fileFetcher);\n+        List<ItemDescription> services = factoryCSV.getDescriptions(file, null);\n+        assertEquals(3, services.size());\n+        ItemDescription foo = services.get(0);\n+        assertNotNull(foo);\n+\n+        assertEquals(\"foo\", foo.getIdentifier());\n+        assertTrue(foo.getLabels().containsKey(\"nivio.name\"));\n+        assertEquals(\"foo\", foo.getLabels().get(\"nivio.name\"));\n+        assertTrue(foo.getLabels().containsKey(\"nivio.description\"));\n+        assertEquals(\"This does nothing\", foo.getLabels().get(\"nivio.description\"));\n+\n+        ItemDescription bar = services.get(1);\n+        assertNotNull(bar);\n+\n+        assertEquals(\"bar\", bar.getIdentifier());\n+        assertTrue(bar.getLabels().containsKey(\"nivio.name\"));\n+        assertEquals(\"bar\", bar.getLabels().get(\"nivio.name\"));\n+        assertTrue(bar.getLabels().containsKey(\"nivio.description\"));\n+        assertEquals(\"\", bar.getLabels().get(\"nivio.description\"));\n+\n+        ItemDescription super1 = services.get(2);\n+        assertNotNull(super1);\n+\n+        assertEquals(\"super1\", super1.getIdentifier());\n+        assertTrue(super1.getLabels().containsKey(\"nivio.name\"));\n+        assertEquals(\"Super Service\", super1.getLabels().get(\"nivio.name\"));\n+        assertTrue(super1.getLabels().containsKey(\"nivio.description\"));\n+        assertEquals(\"superior\", super1.getLabels().get(\"nivio.description\"));\n+    }\n+\n+    @Test\n+    public void failsWithoutMapping() {\n+\n+        SourceReference file = new SourceReference(getRootPath() + \"/src/test/resources/example/services/test.csv\");\n+        ItemDescriptionFactoryCSV factoryCSV = new ItemDescriptionFactoryCSV(fileFetcher);\n+\n+        assertThrows(ProcessingException.class, () -> {\n+            factoryCSV.getDescriptions(file, null);\n+        });\n+    }\n+\n+    @Test\n+    public void failsWithoutIdentifierInMapping() {\n+\n+        SourceReference file = new SourceReference(getRootPath() + \"/src/test/resources/example/services/test.csv\");\n+        Map<String, String> mapping = new HashMap<>();\n+        mapping.put(\"name\", \"0\");\n+        file.setProperty(\"mapping\", mapping);\n+\n+        ItemDescriptionFactoryCSV factoryCSV = new ItemDescriptionFactoryCSV(fileFetcher);\n+\n+        assertThrows(ProcessingException.class, () -> {\n+            factoryCSV.getDescriptions(file, null);\n+        });", "originalCommit": "e889de0e97f8ec614b40d782788fc498aaa859f0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTAzNDI5Nw==", "url": "https://github.com/dedica-team/nivio/pull/84#discussion_r369034297", "bodyText": "add a blank line after this", "author": "jpgoelz", "createdAt": "2020-01-21T14:32:31Z", "path": "src/test/java/de/bonndan/nivio/input/csv/ItemDescriptionFactoryCSVTest.java", "diffHunk": "@@ -0,0 +1,102 @@\n+package de.bonndan.nivio.input.csv;\n+\n+import de.bonndan.nivio.ProcessingException;\n+import de.bonndan.nivio.input.FileFetcher;\n+import de.bonndan.nivio.input.dto.ItemDescription;\n+import de.bonndan.nivio.input.dto.SourceReference;\n+import de.bonndan.nivio.input.http.HttpService;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import static org.junit.jupiter.api.Assertions.*;\n+\n+class ItemDescriptionFactoryCSVTest {\n+\n+    private FileFetcher fileFetcher;\n+\n+    @BeforeEach\n+    public void setup() {\n+        fileFetcher = new FileFetcher(new HttpService());\n+    }\n+\n+    @Test\n+    public void read() {\n+\n+        SourceReference file = new SourceReference(getRootPath() + \"/src/test/resources/example/services/test.csv\");\n+\n+        Map<String, String> mapping = new HashMap<>();\n+        mapping.put(\"identifier\", \"1\");\n+        mapping.put(\"name\", \"0\");\n+        mapping.put(\"description\", \"2\");\n+        file.setProperty(\"mapping\", mapping);\n+        file.setProperty(\"skipLines\", 1);\n+        file.setProperty(\"separator\", \";\");\n+\n+        ItemDescriptionFactoryCSV factoryCSV = new ItemDescriptionFactoryCSV(fileFetcher);\n+        List<ItemDescription> services = factoryCSV.getDescriptions(file, null);\n+        assertEquals(3, services.size());", "originalCommit": "e889de0e97f8ec614b40d782788fc498aaa859f0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTE2MDg2Mw==", "url": "https://github.com/dedica-team/nivio/pull/84#discussion_r369160863", "bodyText": "done", "author": "bonndan", "createdAt": "2020-01-21T18:12:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTAzNDI5Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTA0NzA0MA==", "url": "https://github.com/dedica-team/nivio/pull/84#discussion_r369047040", "bodyText": "Why do these return mxGraph, if the return value is never used?", "author": "jpgoelz", "createdAt": "2020-01-21T14:53:06Z", "path": "src/test/java/de/bonndan/nivio/output/jgraphx/JGraphXRendererTest.java", "diffHunk": "@@ -48,12 +53,18 @@ private LandscapeImpl getLandscape(String path) {\n     }\n \n     private mxGraph debugRender(String path) throws IOException {\n+        return debugRender(path, true);\n+    }\n+\n+    private mxGraph debugRender(String path, boolean debugMode) throws IOException {\n         LandscapeImpl landscape = getLandscape(path + \".yml\");\n-        return debugRenderLandscape(path, landscape, true);\n+        return debugRenderLandscape(path, landscape, debugMode);\n     }", "originalCommit": "e889de0e97f8ec614b40d782788fc498aaa859f0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTE2MjA4MQ==", "url": "https://github.com/dedica-team/nivio/pull/84#discussion_r369162081", "bodyText": "This maybe remained from earlier examinations of the graph. As always, I'd say this is not worth refactoring, since it is just test code.", "author": "bonndan", "createdAt": "2020-01-21T18:15:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTA0NzA0MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTA1MTQyNQ==", "url": "https://github.com/dedica-team/nivio/pull/84#discussion_r369051425", "bodyText": "Not one of the changes, but there is a typo on line 166: lanscape.", "author": "jpgoelz", "createdAt": "2020-01-21T15:00:10Z", "path": "src/main/java/de/bonndan/nivio/api/ApiController.java", "diffHunk": "@@ -8,7 +8,6 @@\n import de.bonndan.nivio.input.dto.SourceReference;", "originalCommit": "e889de0e97f8ec614b40d782788fc498aaa859f0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTA1MzYwMA==", "url": "https://github.com/dedica-team/nivio/pull/84#discussion_r369053600", "bodyText": "I like spaces between i, + and 1. :)", "author": "jpgoelz", "createdAt": "2020-01-21T15:03:45Z", "path": "src/main/java/de/bonndan/nivio/input/LabelToFieldProcessor.java", "diffHunk": "@@ -54,20 +58,38 @@ private void setValue(ItemDescription item, String name, String value) {\n                 myAccessor.setPropertyValue(name, Arrays.asList(o));\n                 return;\n             }\n+\n             if (propertyType != null && propertyType.isAssignableFrom(Set.class)) {\n                 String[] o = getParts(value);\n                 myAccessor.setPropertyValue(name, Set.of(o));\n                 return;\n             }\n \n+            if (propertyType != null && propertyType.isAssignableFrom(Map.class)) {\n+                String[] o = getParts(value);\n+                Map propertyValue = (Map) myAccessor.getPropertyValue(name);\n+                for (int i = 0; i < o.length; i++) {\n+                    if (ItemDescription.LINKS_FIELD.equals(name)) {\n+                        try {\n+                            propertyValue.put(String.valueOf(i+1), new URL(o[i]));", "originalCommit": "e889de0e97f8ec614b40d782788fc498aaa859f0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTA1MzcyMg==", "url": "https://github.com/dedica-team/nivio/pull/84#discussion_r369053722", "bodyText": "more spaces please", "author": "jpgoelz", "createdAt": "2020-01-21T15:03:58Z", "path": "src/main/java/de/bonndan/nivio/input/LabelToFieldProcessor.java", "diffHunk": "@@ -54,20 +58,38 @@ private void setValue(ItemDescription item, String name, String value) {\n                 myAccessor.setPropertyValue(name, Arrays.asList(o));\n                 return;\n             }\n+\n             if (propertyType != null && propertyType.isAssignableFrom(Set.class)) {\n                 String[] o = getParts(value);\n                 myAccessor.setPropertyValue(name, Set.of(o));\n                 return;\n             }\n \n+            if (propertyType != null && propertyType.isAssignableFrom(Map.class)) {\n+                String[] o = getParts(value);\n+                Map propertyValue = (Map) myAccessor.getPropertyValue(name);\n+                for (int i = 0; i < o.length; i++) {\n+                    if (ItemDescription.LINKS_FIELD.equals(name)) {\n+                        try {\n+                            propertyValue.put(String.valueOf(i+1), new URL(o[i]));\n+                        } catch (MalformedURLException e) {\n+                            logger.warn(\"Failed to parse link \" + o[i]);\n+                        }\n+                    } else {\n+                        propertyValue.put(String.valueOf(i+1), o[i]);", "originalCommit": "e889de0e97f8ec614b40d782788fc498aaa859f0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTE1NTk2Nw==", "url": "https://github.com/dedica-team/nivio/pull/84#discussion_r369155967", "bodyText": "reformatted file", "author": "bonndan", "createdAt": "2020-01-21T18:01:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTA1MzcyMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTA1NDk4MA==", "url": "https://github.com/dedica-team/nivio/pull/84#discussion_r369054980", "bodyText": "Imho static, albeit private methods should go to the top of a class, even before public methods. What's your opinion @Matthimatiker?", "author": "jpgoelz", "createdAt": "2020-01-21T15:06:10Z", "path": "src/main/java/de/bonndan/nivio/input/LabelToFieldProcessor.java", "diffHunk": "@@ -54,20 +58,38 @@ private void setValue(ItemDescription item, String name, String value) {\n                 myAccessor.setPropertyValue(name, Arrays.asList(o));\n                 return;\n             }\n+\n             if (propertyType != null && propertyType.isAssignableFrom(Set.class)) {\n                 String[] o = getParts(value);\n                 myAccessor.setPropertyValue(name, Set.of(o));\n                 return;\n             }\n \n+            if (propertyType != null && propertyType.isAssignableFrom(Map.class)) {\n+                String[] o = getParts(value);\n+                Map propertyValue = (Map) myAccessor.getPropertyValue(name);\n+                for (int i = 0; i < o.length; i++) {\n+                    if (ItemDescription.LINKS_FIELD.equals(name)) {\n+                        try {\n+                            propertyValue.put(String.valueOf(i+1), new URL(o[i]));\n+                        } catch (MalformedURLException e) {\n+                            logger.warn(\"Failed to parse link \" + o[i]);\n+                        }\n+                    } else {\n+                        propertyValue.put(String.valueOf(i+1), o[i]);\n+                    }\n+                }\n+                return;\n+            }\n+\n             myAccessor.setPropertyValue(name, value.trim());\n         } catch (NotWritablePropertyException e) {\n             logger.warn(\"Failed to write field '\" + name + \"' via label\");\n         }\n     }\n \n     private static String[] getParts(String value) {", "originalCommit": "e889de0e97f8ec614b40d782788fc498aaa859f0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTE2MzIwMA==", "url": "https://github.com/dedica-team/nivio/pull/84#discussion_r369163200", "bodyText": "My opinion(!) is: public stuff comes first. You are however free to change it.", "author": "bonndan", "createdAt": "2020-01-21T18:17:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTA1NDk4MA=="}], "type": "inlineReview"}, {"oid": "0ca8bc1bf974b72c83bbc2d1a4cc9864a49a1f90", "url": "https://github.com/dedica-team/nivio/commit/0ca8bc1bf974b72c83bbc2d1a4cc9864a49a1f90", "message": "Merge branch 'develop' into 83_csv_import", "committedDate": "2020-01-21T17:48:54Z", "type": "commit"}, {"oid": "5d637ce63a05746487a5cd63bb5ab26b4c4a2297", "url": "https://github.com/dedica-team/nivio/commit/5d637ce63a05746487a5cd63bb5ab26b4c4a2297", "message": "[#84] fixes, wording", "committedDate": "2020-01-21T18:12:21Z", "type": "commit"}, {"oid": "3cc759cf5a1486bf95516599fa3dc20a47d41b4f", "url": "https://github.com/dedica-team/nivio/commit/3cc759cf5a1486bf95516599fa3dc20a47d41b4f", "message": "[#84] test fix", "committedDate": "2020-01-21T18:19:30Z", "type": "commit"}]}