{"pr_number": 320, "pr_title": "new icon set", "pr_createdAt": "2020-10-12T07:24:44Z", "pr_url": "https://github.com/dedica-team/nivio/pull/320", "timeline": [{"oid": "a1e640ff732f08fe2eb63c11444bffa1dd8bcfd0", "url": "https://github.com/dedica-team/nivio/commit/a1e640ff732f08fe2eb63c11444bffa1dd8bcfd0", "message": "[#315] removed unnecessary precision in background hexes", "committedDate": "2020-10-10T08:00:11Z", "type": "commit"}, {"oid": "9db99b856212966ceae1de42aafbfb8979790b33", "url": "https://github.com/dedica-team/nivio/commit/9db99b856212966ceae1de42aafbfb8979790b33", "message": "[#314] material ui icons", "committedDate": "2020-10-10T12:55:21Z", "type": "commit"}, {"oid": "70ee6e7660dbcbb047d56728159b318d5c0a0bc4", "url": "https://github.com/dedica-team/nivio/commit/70ee6e7660dbcbb047d56728159b318d5c0a0bc4", "message": "improved item rendering (using bigger single char if shortname is present)", "committedDate": "2020-10-10T12:57:43Z", "type": "commit"}, {"oid": "1443bf9da28137562bebf10224a3757dace2ed59", "url": "https://github.com/dedica-team/nivio/commit/1443bf9da28137562bebf10224a3757dace2ed59", "message": "[#314] removed old png icons, inserted preliminary logo", "committedDate": "2020-10-10T13:07:38Z", "type": "commit"}, {"oid": "7fd74fd8076a26404970ef58dc53b6e2d92c3602", "url": "https://github.com/dedica-team/nivio/commit/7fd74fd8076a26404970ef58dc53b6e2d92c3602", "message": "[#314] added copyright remark", "committedDate": "2020-10-10T13:14:24Z", "type": "commit"}, {"oid": "c60967c10231e9338de110784688fbd509d3e6f8", "url": "https://github.com/dedica-team/nivio/commit/c60967c10231e9338de110784688fbd509d3e6f8", "message": "[#314] added comments", "committedDate": "2020-10-10T13:14:48Z", "type": "commit"}, {"oid": "b6ad3e1c55a151e2bd671d232f4af493e89976ca", "url": "https://github.com/dedica-team/nivio/commit/b6ad3e1c55a151e2bd671d232f4af493e89976ca", "message": "[#314] icon base64 caching in LocalServer", "committedDate": "2020-10-10T19:11:03Z", "type": "commit"}, {"oid": "f74e3a4835c13821059b3a1c31cc7c7e9dd7e246", "url": "https://github.com/dedica-team/nivio/commit/f74e3a4835c13821059b3a1c31cc7c7e9dd7e246", "message": "cleanup", "committedDate": "2020-10-11T03:42:03Z", "type": "commit"}, {"oid": "538a4f2c35a828e13d934bf120b223e7b524f936", "url": "https://github.com/dedica-team/nivio/commit/538a4f2c35a828e13d934bf120b223e7b524f936", "message": "[#314] renamed icons to iconmapping, fixed usage", "committedDate": "2020-10-11T03:53:07Z", "type": "commit"}, {"oid": "8754d54c028159e4e0451858dbd5e618c2ed16c7", "url": "https://github.com/dedica-team/nivio/commit/8754d54c028159e4e0451858dbd5e618c2ed16c7", "message": "larger group label", "committedDate": "2020-10-11T03:57:02Z", "type": "commit"}, {"oid": "f26f8dec1e5c9517ed7ee84fb4452e12b713c54c", "url": "https://github.com/dedica-team/nivio/commit/f26f8dec1e5c9517ed7ee84fb4452e12b713c54c", "message": "[#262] removed local serving of icons and vendor icons", "committedDate": "2020-10-11T18:18:22Z", "type": "commit"}, {"oid": "b8d5c17bb3dd63d794f7fd45e0a816142966bae9", "url": "https://github.com/dedica-team/nivio/commit/b8d5c17bb3dd63d794f7fd45e0a816142966bae9", "message": "[#300] documented item appearance", "committedDate": "2020-10-12T07:20:46Z", "type": "commit"}, {"oid": "ff63992771c15e4d87835cc62fc962f5c0990311", "url": "https://github.com/dedica-team/nivio/commit/ff63992771c15e4d87835cc62fc962f5c0990311", "message": "[#300] added comment", "committedDate": "2020-10-12T07:33:29Z", "type": "commit"}, {"oid": "98a92924037aaf3db400e4dd3b14b1b88180d693", "url": "https://github.com/dedica-team/nivio/commit/98a92924037aaf3db400e4dd3b14b1b88180d693", "message": "[#314] bumped wiremock and jackson-databind to omit class not found error", "committedDate": "2020-10-12T07:55:09Z", "type": "commit"}, {"oid": "779b5caf5f33153cf7421956b5dd5fda8e24ea82", "url": "https://github.com/dedica-team/nivio/commit/779b5caf5f33153cf7421956b5dd5fda8e24ea82", "message": "[#314] fixed icon mapping", "committedDate": "2020-10-12T09:23:17Z", "type": "commit"}, {"oid": "80e247de15551f6acd75ec81119a8c072fb6dc85", "url": "https://github.com/dedica-team/nivio/commit/80e247de15551f6acd75ec81119a8c072fb6dc85", "message": "[#314] preliminary nivio svg icon", "committedDate": "2020-10-12T09:41:23Z", "type": "commit"}, {"oid": "876db0aaa7f07526de69294325a29bfd49ac31e9", "url": "https://github.com/dedica-team/nivio/commit/876db0aaa7f07526de69294325a29bfd49ac31e9", "message": "[#314] vendor icons fix", "committedDate": "2020-10-12T09:56:34Z", "type": "commit"}, {"oid": "7da2a3fbfe9688d4a6778d0aa9c51d7458296c26", "url": "https://github.com/dedica-team/nivio/commit/7da2a3fbfe9688d4a6778d0aa9c51d7458296c26", "message": "[#315] removed unnecessary precision in background hexes", "committedDate": "2020-10-13T18:26:55Z", "type": "commit"}, {"oid": "6e1e213d3b7d0dbff64b0ab9afa81553cc226f71", "url": "https://github.com/dedica-team/nivio/commit/6e1e213d3b7d0dbff64b0ab9afa81553cc226f71", "message": "[#314] material ui icons", "committedDate": "2020-10-13T18:26:55Z", "type": "commit"}, {"oid": "3f86a7a913d1470c54906131be95c484fa15d702", "url": "https://github.com/dedica-team/nivio/commit/3f86a7a913d1470c54906131be95c484fa15d702", "message": "improved item rendering (using bigger single char if shortname is present)", "committedDate": "2020-10-13T18:26:55Z", "type": "commit"}, {"oid": "a9ceb149de140c05f828f4db983015268837e277", "url": "https://github.com/dedica-team/nivio/commit/a9ceb149de140c05f828f4db983015268837e277", "message": "[#314] removed old png icons, inserted preliminary logo", "committedDate": "2020-10-13T18:26:55Z", "type": "commit"}, {"oid": "ff1dfc3f2f707f599409433397629f8bd90aa155", "url": "https://github.com/dedica-team/nivio/commit/ff1dfc3f2f707f599409433397629f8bd90aa155", "message": "[#314] added copyright remark", "committedDate": "2020-10-13T18:26:55Z", "type": "commit"}, {"oid": "7c0649e081672e5f3fd3bca8125273ee70d8edcc", "url": "https://github.com/dedica-team/nivio/commit/7c0649e081672e5f3fd3bca8125273ee70d8edcc", "message": "[#314] added comments", "committedDate": "2020-10-13T18:26:55Z", "type": "commit"}, {"oid": "823d4ab09c6fc3f1a72331307887fc8b522a31ea", "url": "https://github.com/dedica-team/nivio/commit/823d4ab09c6fc3f1a72331307887fc8b522a31ea", "message": "[#314] icon base64 caching in LocalServer", "committedDate": "2020-10-13T18:26:55Z", "type": "commit"}, {"oid": "2ff2239c587f429e84d955732ea4bddba217f726", "url": "https://github.com/dedica-team/nivio/commit/2ff2239c587f429e84d955732ea4bddba217f726", "message": "cleanup", "committedDate": "2020-10-13T18:26:55Z", "type": "commit"}, {"oid": "1ea3afb0e3d5e2e6ccbd631d59b03e7c79e0ec27", "url": "https://github.com/dedica-team/nivio/commit/1ea3afb0e3d5e2e6ccbd631d59b03e7c79e0ec27", "message": "[#314] renamed icons to iconmapping, fixed usage", "committedDate": "2020-10-13T18:26:55Z", "type": "commit"}, {"oid": "6cd69ac0564ee3931ebb80db409a203a3d1344f1", "url": "https://github.com/dedica-team/nivio/commit/6cd69ac0564ee3931ebb80db409a203a3d1344f1", "message": "larger group label", "committedDate": "2020-10-13T18:26:55Z", "type": "commit"}, {"oid": "8a7b6aea3796ab3571f60378a28ca119e6d14156", "url": "https://github.com/dedica-team/nivio/commit/8a7b6aea3796ab3571f60378a28ca119e6d14156", "message": "[#262] removed local serving of icons and vendor icons", "committedDate": "2020-10-13T18:26:55Z", "type": "commit"}, {"oid": "c05423cfa8b9e5ef7826b533eed9c7f3090dfe83", "url": "https://github.com/dedica-team/nivio/commit/c05423cfa8b9e5ef7826b533eed9c7f3090dfe83", "message": "[#300] documented item appearance", "committedDate": "2020-10-13T18:26:55Z", "type": "commit"}, {"oid": "612784d2224034f1510b368772723e0152ee2226", "url": "https://github.com/dedica-team/nivio/commit/612784d2224034f1510b368772723e0152ee2226", "message": "[#300] added comment", "committedDate": "2020-10-13T18:26:55Z", "type": "commit"}, {"oid": "1e8d6b20211a22abe44030361392f8bade53a398", "url": "https://github.com/dedica-team/nivio/commit/1e8d6b20211a22abe44030361392f8bade53a398", "message": "[#314] bumped wiremock and jackson-databind to omit class not found error", "committedDate": "2020-10-13T18:26:55Z", "type": "commit"}, {"oid": "cb1963a13e66e4dbe281be8355e94dad34700446", "url": "https://github.com/dedica-team/nivio/commit/cb1963a13e66e4dbe281be8355e94dad34700446", "message": "[#314] fixed icon mapping", "committedDate": "2020-10-13T18:26:56Z", "type": "commit"}, {"oid": "03aac4f4678d5eef37bbe5700280ebb6b2256ec3", "url": "https://github.com/dedica-team/nivio/commit/03aac4f4678d5eef37bbe5700280ebb6b2256ec3", "message": "[#314] preliminary nivio svg icon", "committedDate": "2020-10-13T18:26:56Z", "type": "commit"}, {"oid": "144b55b04457d46e591dd2a3cca8111d6f61e3a3", "url": "https://github.com/dedica-team/nivio/commit/144b55b04457d46e591dd2a3cca8111d6f61e3a3", "message": "[#314] vendor icons fix", "committedDate": "2020-10-13T18:26:56Z", "type": "commit"}, {"oid": "800d7c1160d522e9d6b9eb60012659a6fab0c9cc", "url": "https://github.com/dedica-team/nivio/commit/800d7c1160d522e9d6b9eb60012659a6fab0c9cc", "message": "Merge remote-tracking branch 'origin/314_icon_set' into 314_icon_set", "committedDate": "2020-10-13T18:27:19Z", "type": "commit"}, {"oid": "c2b8272ca27636b1cb58c37bbc7c14b229b53a14", "url": "https://github.com/dedica-team/nivio/commit/c2b8272ca27636b1cb58c37bbc7c14b229b53a14", "message": "[#314] copying icons using node for os independence", "committedDate": "2020-10-14T04:07:11Z", "type": "commit"}, {"oid": "c7492793dd7706bb1e9e8fefb380f3b0230ca244", "url": "https://github.com/dedica-team/nivio/commit/c7492793dd7706bb1e9e8fefb380f3b0230ca244", "message": "[#315] removed unnecessary precision in background hexes", "committedDate": "2020-10-15T17:44:21Z", "type": "commit"}, {"oid": "3e4ad48ec46e22474b1c65cc4427d564b1e394b7", "url": "https://github.com/dedica-team/nivio/commit/3e4ad48ec46e22474b1c65cc4427d564b1e394b7", "message": "[#314] material ui icons", "committedDate": "2020-10-15T17:44:21Z", "type": "commit"}, {"oid": "508e99f7c4f920c1b1611fe2f4cdcada8bb98eca", "url": "https://github.com/dedica-team/nivio/commit/508e99f7c4f920c1b1611fe2f4cdcada8bb98eca", "message": "improved item rendering (using bigger single char if shortname is present)", "committedDate": "2020-10-15T17:44:21Z", "type": "commit"}, {"oid": "c736eaa882ad61718045abaa70adcdf223901bd4", "url": "https://github.com/dedica-team/nivio/commit/c736eaa882ad61718045abaa70adcdf223901bd4", "message": "[#314] removed old png icons, inserted preliminary logo", "committedDate": "2020-10-15T17:44:21Z", "type": "commit"}, {"oid": "6655a6fd022016b3a0814844a1ba7fdb31c46001", "url": "https://github.com/dedica-team/nivio/commit/6655a6fd022016b3a0814844a1ba7fdb31c46001", "message": "[#314] added copyright remark", "committedDate": "2020-10-15T17:44:21Z", "type": "commit"}, {"oid": "6818b07102ed005a879ea5bfc4ab523bb82f24ae", "url": "https://github.com/dedica-team/nivio/commit/6818b07102ed005a879ea5bfc4ab523bb82f24ae", "message": "[#314] added comments", "committedDate": "2020-10-15T17:44:21Z", "type": "commit"}, {"oid": "2a32cebb9b0b0c04501664f81abc305e132fbebc", "url": "https://github.com/dedica-team/nivio/commit/2a32cebb9b0b0c04501664f81abc305e132fbebc", "message": "[#314] icon base64 caching in LocalServer", "committedDate": "2020-10-15T17:44:21Z", "type": "commit"}, {"oid": "9b25ee5481669ee2b899992c1ab81ae46879d042", "url": "https://github.com/dedica-team/nivio/commit/9b25ee5481669ee2b899992c1ab81ae46879d042", "message": "cleanup", "committedDate": "2020-10-15T17:44:21Z", "type": "commit"}, {"oid": "d8057a3cdb10a1a7c6c6105357dfb54e3f7f9751", "url": "https://github.com/dedica-team/nivio/commit/d8057a3cdb10a1a7c6c6105357dfb54e3f7f9751", "message": "[#314] renamed icons to iconmapping, fixed usage", "committedDate": "2020-10-15T17:44:21Z", "type": "commit"}, {"oid": "886bdb761dc5dcdd2bc3ec3099510ec5f57ada3e", "url": "https://github.com/dedica-team/nivio/commit/886bdb761dc5dcdd2bc3ec3099510ec5f57ada3e", "message": "larger group label", "committedDate": "2020-10-15T17:44:21Z", "type": "commit"}, {"oid": "ac697ad9710543985037ccd2bd69ff63b3d19e7d", "url": "https://github.com/dedica-team/nivio/commit/ac697ad9710543985037ccd2bd69ff63b3d19e7d", "message": "[#262] removed local serving of icons and vendor icons", "committedDate": "2020-10-15T17:48:11Z", "type": "commit"}, {"oid": "80d51f696405d76516cb9b338cad836825c9190c", "url": "https://github.com/dedica-team/nivio/commit/80d51f696405d76516cb9b338cad836825c9190c", "message": "[#300] documented item appearance", "committedDate": "2020-10-15T17:48:14Z", "type": "commit"}, {"oid": "96ce99b15d6cc28677d8b13170aa79008ea06eef", "url": "https://github.com/dedica-team/nivio/commit/96ce99b15d6cc28677d8b13170aa79008ea06eef", "message": "[#300] added comment", "committedDate": "2020-10-15T17:48:14Z", "type": "commit"}, {"oid": "c92d6f07e26537618b2fcfaf646b2740d56dbf93", "url": "https://github.com/dedica-team/nivio/commit/c92d6f07e26537618b2fcfaf646b2740d56dbf93", "message": "[#314] bumped wiremock and jackson-databind to omit class not found error", "committedDate": "2020-10-15T17:48:14Z", "type": "commit"}, {"oid": "0dbe3b47644a6132d2c0963e495508c40e4af200", "url": "https://github.com/dedica-team/nivio/commit/0dbe3b47644a6132d2c0963e495508c40e4af200", "message": "[#314] fixed icon mapping", "committedDate": "2020-10-15T17:48:14Z", "type": "commit"}, {"oid": "c5b1a8bb15f6b0e9b83f4ded4f46d73b644dbeca", "url": "https://github.com/dedica-team/nivio/commit/c5b1a8bb15f6b0e9b83f4ded4f46d73b644dbeca", "message": "[#314] preliminary nivio svg icon", "committedDate": "2020-10-15T17:48:14Z", "type": "commit"}, {"oid": "b939173ea2fa033836804c5e3adad9faf129d440", "url": "https://github.com/dedica-team/nivio/commit/b939173ea2fa033836804c5e3adad9faf129d440", "message": "[#314] vendor icons fix", "committedDate": "2020-10-15T17:48:14Z", "type": "commit"}, {"oid": "7e33d7dd0a1070360c3bb221b11d1a77b3c699b2", "url": "https://github.com/dedica-team/nivio/commit/7e33d7dd0a1070360c3bb221b11d1a77b3c699b2", "message": "improved item rendering (using bigger single char if shortname is present)", "committedDate": "2020-10-15T17:53:19Z", "type": "commit"}, {"oid": "b5b649df556f813f9dd088807a2e0568b1f8e315", "url": "https://github.com/dedica-team/nivio/commit/b5b649df556f813f9dd088807a2e0568b1f8e315", "message": "[#300] added comment", "committedDate": "2020-10-15T17:54:43Z", "type": "commit"}, {"oid": "6a66ada9369b1415b86d5ee7c0dd8a96072a2638", "url": "https://github.com/dedica-team/nivio/commit/6a66ada9369b1415b86d5ee7c0dd8a96072a2638", "message": "[#314] fixed icon mapping", "committedDate": "2020-10-15T17:55:12Z", "type": "commit"}, {"oid": "a2b68c24ba5db27c2f7dce393d1aacbecff3c514", "url": "https://github.com/dedica-team/nivio/commit/a2b68c24ba5db27c2f7dce393d1aacbecff3c514", "message": "[#314] copying icons using node for os independence", "committedDate": "2020-10-15T17:55:14Z", "type": "commit"}, {"oid": "acbdaeb38baa9c51b769aa7adbad5965cb580103", "url": "https://github.com/dedica-team/nivio/commit/acbdaeb38baa9c51b769aa7adbad5965cb580103", "message": "[#314] fix after rebase", "committedDate": "2020-10-15T17:57:17Z", "type": "commit"}, {"oid": "dc5cbe90b36e4d73178fd2fe9e41aa2eb949f13b", "url": "https://github.com/dedica-team/nivio/commit/dc5cbe90b36e4d73178fd2fe9e41aa2eb949f13b", "message": "Merge remote-tracking branch 'origin/314_icon_set' into 314_icon_set\n\n# Conflicts:\n#\tsrc/main/java/de/bonndan/nivio/api/LinkFactory.java\n#\tsrc/test/java/de/bonndan/nivio/input/AppearanceResolverTest.java", "committedDate": "2020-10-15T18:39:17Z", "type": "commit"}, {"oid": "59592cb85661e0ca2af25d725c86fa3170b27122", "url": "https://github.com/dedica-team/nivio/commit/59592cb85661e0ca2af25d725c86fa3170b27122", "message": "Merge remote-tracking branch 'origin/develop' into 314_icon_set", "committedDate": "2020-10-16T18:39:41Z", "type": "commit"}, {"oid": "12cd83f43de735514220878172fb6ec5509cdd66", "url": "https://github.com/dedica-team/nivio/commit/12cd83f43de735514220878172fb6ec5509cdd66", "message": "removed one unneeded cast", "committedDate": "2020-10-16T19:25:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjY3NDY3Nw==", "url": "https://github.com/dedica-team/nivio/pull/320#discussion_r506674677", "bodyText": "Can't this be private?", "author": "mfbieber", "createdAt": "2020-10-16T19:15:42Z", "path": "src/main/java/de/bonndan/nivio/output/icons/LocalIcons.java", "diffHunk": "@@ -0,0 +1,115 @@\n+package de.bonndan.nivio.output.icons;\n+\n+import de.bonndan.nivio.model.Item;\n+import de.bonndan.nivio.model.Label;\n+import de.bonndan.nivio.util.URLHelper;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.stereotype.Service;\n+import org.springframework.util.StringUtils;\n+\n+import java.net.URL;\n+import java.util.Map;\n+import java.util.Optional;\n+import java.util.concurrent.ConcurrentHashMap;\n+\n+import static de.bonndan.nivio.output.icons.IconMapping.DEFAULT_ICON;\n+\n+/**\n+ * Provides icons and vendor icons as data.\n+ *\n+ *\n+ */\n+@Service\n+public class LocalIcons {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(LocalIcons.class);\n+\n+    private final VendorIcons vendorIcons;\n+\n+    /**\n+     * default icon data url\n+     */\n+    private final String defaultIcon;\n+\n+    /**\n+     * data url cache\n+     */\n+    private final Map<String, String> iconDataUrls = new ConcurrentHashMap<>();\n+\n+\n+    public LocalIcons(VendorIcons vendorIcons) {\n+\n+        this.vendorIcons = vendorIcons;\n+        defaultIcon = getIconUrl(DEFAULT_ICON.getIcon(), false);\n+    }\n+\n+    public String getIconUrl(Item item) {\n+\n+        //icon label based\n+        String icon = item.getIcon();\n+        if (!StringUtils.isEmpty(icon)) {\n+\n+            if (icon.startsWith(VendorIcons.VENDOR_PREFIX)) {\n+                String key = icon.replace(VendorIcons.VENDOR_PREFIX, \"\").toLowerCase();\n+                return vendorIcons.getUrl(key).orElse(defaultIcon);\n+            }\n+\n+            String iconUrl = getIconUrl(icon, true);\n+            if(iconUrl != null) {\n+                return iconUrl;\n+            }\n+        }\n+\n+        //type based\n+        String type = item.getLabel(Label.type);\n+        if (StringUtils.isEmpty(type)) {\n+            return getIconUrl(DEFAULT_ICON.getIcon(), false);\n+        }\n+\n+        //fallback to item.type\n+        String iconName = IconMapping.of(type.toLowerCase()).map(IconMapping::getIcon).orElseGet(type::toLowerCase);\n+        return getIconUrl(iconName, true);\n+    }\n+\n+    /**\n+     * Provides an URL for a locally served icon.\n+     *\n+     * @return an url pointing to a file or a data url\n+     */\n+    String getIconUrl(String icon, boolean fallback) {", "originalCommit": "59592cb85661e0ca2af25d725c86fa3170b27122", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjY4NDI2Mg==", "url": "https://github.com/dedica-team/nivio/pull/320#discussion_r506684262", "bodyText": "I've been lazy and made it package-private for testing. \ud83d\ude48", "author": "bonndan", "createdAt": "2020-10-16T19:38:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjY3NDY3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjY4NzU0Nw==", "url": "https://github.com/dedica-team/nivio/pull/320#discussion_r506687547", "bodyText": "But I did not see it being used in the tests - did I overlook this?", "author": "mfbieber", "createdAt": "2020-10-16T19:45:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjY3NDY3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjcwNzcwOQ==", "url": "https://github.com/dedica-team/nivio/pull/320#discussion_r506707709", "bodyText": "LocalIconsTest uses it. Maybe it were better to return an Optional and get rid of the boolean flag.", "author": "bonndan", "createdAt": "2020-10-16T20:32:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjY3NDY3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjcxMjg1MQ==", "url": "https://github.com/dedica-team/nivio/pull/320#discussion_r506712851", "bodyText": "Oh, yes.\nYes, that would be better!", "author": "mfbieber", "createdAt": "2020-10-16T20:45:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjY3NDY3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjg0MzYwNA==", "url": "https://github.com/dedica-team/nivio/pull/320#discussion_r506843604", "bodyText": "done", "author": "bonndan", "createdAt": "2020-10-17T07:06:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjY3NDY3Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjY3Nzk1NQ==", "url": "https://github.com/dedica-team/nivio/pull/320#discussion_r506677955", "bodyText": "This is the only place where vendorIcons.getUrl() is used, so I was at first a little confused about what LocalIcons really is. I thought LocalIcons are icons addes by the user? Is this correct? (In this case, maybe a different naming would be better. Why not just Icons?)\nOr does it mean that there are not retrieved from a remote location such as the vendor icons?", "author": "mfbieber", "createdAt": "2020-10-16T19:23:08Z", "path": "src/main/java/de/bonndan/nivio/output/icons/LocalIcons.java", "diffHunk": "@@ -0,0 +1,115 @@\n+package de.bonndan.nivio.output.icons;\n+\n+import de.bonndan.nivio.model.Item;\n+import de.bonndan.nivio.model.Label;\n+import de.bonndan.nivio.util.URLHelper;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.stereotype.Service;\n+import org.springframework.util.StringUtils;\n+\n+import java.net.URL;\n+import java.util.Map;\n+import java.util.Optional;\n+import java.util.concurrent.ConcurrentHashMap;\n+\n+import static de.bonndan.nivio.output.icons.IconMapping.DEFAULT_ICON;\n+\n+/**\n+ * Provides icons and vendor icons as data.\n+ *\n+ *\n+ */\n+@Service\n+public class LocalIcons {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(LocalIcons.class);\n+\n+    private final VendorIcons vendorIcons;\n+\n+    /**\n+     * default icon data url\n+     */\n+    private final String defaultIcon;\n+\n+    /**\n+     * data url cache\n+     */\n+    private final Map<String, String> iconDataUrls = new ConcurrentHashMap<>();\n+\n+\n+    public LocalIcons(VendorIcons vendorIcons) {\n+\n+        this.vendorIcons = vendorIcons;\n+        defaultIcon = getIconUrl(DEFAULT_ICON.getIcon(), false);\n+    }\n+\n+    public String getIconUrl(Item item) {\n+\n+        //icon label based\n+        String icon = item.getIcon();\n+        if (!StringUtils.isEmpty(icon)) {\n+\n+            if (icon.startsWith(VendorIcons.VENDOR_PREFIX)) {\n+                String key = icon.replace(VendorIcons.VENDOR_PREFIX, \"\").toLowerCase();\n+                return vendorIcons.getUrl(key).orElse(defaultIcon);", "originalCommit": "59592cb85661e0ca2af25d725c86fa3170b27122", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjY4NTI2MA==", "url": "https://github.com/dedica-team/nivio/pull/320#discussion_r506685260", "bodyText": "LocalIcons is a crappy name, but I had no better idea. It stands for the locally (fs) available svg icons that come shipped with nivio. They are loaded and embedded, so nivio does not serve anything anymore.", "author": "bonndan", "createdAt": "2020-10-16T19:40:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjY3Nzk1NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjY4NjIxNQ==", "url": "https://github.com/dedica-team/nivio/pull/320#discussion_r506686215", "bodyText": "Okay, I think for the users it is okay. As I developer, I now understand. Maybe we can add a brief comment to the class, so others developers understand too?\nIn this case I also did not come up with a better name. \"BuiltInIcons\" could be another idea.", "author": "mfbieber", "createdAt": "2020-10-16T19:42:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjY3Nzk1NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjcwOTI4MQ==", "url": "https://github.com/dedica-team/nivio/pull/320#discussion_r506709281", "bodyText": "One more ugly aspect is that it is named to handle local icons, but suddenly comes up with remote vendor icons. I don't like my design here.", "author": "bonndan", "createdAt": "2020-10-16T20:36:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjY3Nzk1NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjcxMjQ3Mg==", "url": "https://github.com/dedica-team/nivio/pull/320#discussion_r506712472", "bodyText": "Yes, that is exactly what I was wondering about.", "author": "mfbieber", "createdAt": "2020-10-16T20:44:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjY3Nzk1NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjg0MzU1MQ==", "url": "https://github.com/dedica-team/nivio/pull/320#discussion_r506843551", "bodyText": "refactored.", "author": "bonndan", "createdAt": "2020-10-17T07:05:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjY3Nzk1NQ=="}], "type": "inlineReview"}, {"oid": "19f20f1a851a3b029e29553fbb006bbca6cdf1c4", "url": "https://github.com/dedica-team/nivio/commit/19f20f1a851a3b029e29553fbb006bbca6cdf1c4", "message": "[#314] improved comment", "committedDate": "2020-10-16T20:35:27Z", "type": "commit"}, {"oid": "4319676999386f8b7121f618d4e9e3b71aafa559", "url": "https://github.com/dedica-team/nivio/commit/4319676999386f8b7121f618d4e9e3b71aafa559", "message": "[#314] refactored, created IconService", "committedDate": "2020-10-17T06:40:11Z", "type": "commit"}, {"oid": "1f17ed33e2a3d5e1beba53f1a94eed216d92425b", "url": "https://github.com/dedica-team/nivio/commit/1f17ed33e2a3d5e1beba53f1a94eed216d92425b", "message": "[#314] test fix", "committedDate": "2020-10-17T07:32:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjk0MDIzOA==", "url": "https://github.com/dedica-team/nivio/pull/320#discussion_r506940238", "bodyText": "This is a lot better \ud83d\udc4d", "author": "mfbieber", "createdAt": "2020-10-17T12:51:02Z", "path": "src/main/java/de/bonndan/nivio/output/icons/IconService.java", "diffHunk": "@@ -0,0 +1,64 @@\n+package de.bonndan.nivio.output.icons;\n+\n+import de.bonndan.nivio.model.Item;\n+import de.bonndan.nivio.model.Label;\n+import org.springframework.lang.Nullable;\n+import org.springframework.stereotype.Service;\n+import org.springframework.util.StringUtils;\n+\n+import java.util.Optional;\n+\n+\n+/**\n+ * Provides the builtin icons (shipped with nivio) and vendor icons (loaded form remote locations) as embeddable data.\n+ *\n+ *\n+ */\n+@Service\n+public class IconService {", "originalCommit": "1f17ed33e2a3d5e1beba53f1a94eed216d92425b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}