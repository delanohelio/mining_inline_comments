{"pr_number": 8552, "pr_title": "Allow create/update endpoint registry entry when no definition file/url provided", "pr_createdAt": "2020-05-22T07:52:55Z", "pr_url": "https://github.com/wso2/carbon-apimgt/pull/8552", "timeline": [{"oid": "54f755af115f53e84f0be6812a138cbbe516a75c", "url": "https://github.com/wso2/carbon-apimgt/commit/54f755af115f53e84f0be6812a138cbbe516a75c", "message": "Allow create/update endpoint registry entry when no definition file/url  provided", "committedDate": "2020-05-22T08:47:03Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTE1MTAxNQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8552#discussion_r429151015", "bodyText": "set defaults if not provided", "author": "fazlan-nazeem", "createdAt": "2020-05-22T09:48:04Z", "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.endpoint.registry/src/main/java/org/wso2/carbon/apimgt/rest/api/endpoint/registry/util/EndpointRegistryMappingUtils.java", "diffHunk": "@@ -43,8 +43,12 @@ public static EndpointRegistryInfo fromDTOtoEndpointRegistry(RegistryDTO registr\n         EndpointRegistryInfo registry = new EndpointRegistryInfo();\n         registry.setName(registryDTO.getName());\n         registry.setOwner(owner);\n-        registry.setType(registryDTO.getType().toString());\n-        registry.setMode(registryDTO.getMode().toString());\n+        if (registryDTO.getType() != null) {", "originalCommit": "54f755af115f53e84f0be6812a138cbbe516a75c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIwMDczNg==", "url": "https://github.com/wso2/carbon-apimgt/pull/8552#discussion_r429200736", "bodyText": "Fixed", "author": "ChamodDamitha", "createdAt": "2020-05-22T11:48:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTE1MTAxNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTE1MjY3Ng==", "url": "https://github.com/wso2/carbon-apimgt/pull/8552#discussion_r429152676", "bodyText": "shall we introduce a method to create a registryEntry when parameters are given? also another method to return a registryEntry with some default values.", "author": "fazlan-nazeem", "createdAt": "2020-05-22T09:51:43Z", "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.endpoint.registry/src/test/java/org.wso2.carbon.apimgt.rest.api.endpoint.registry/impl/RegistriesApiServiceImplTest.java", "diffHunk": "@@ -817,6 +856,57 @@ public void updateRegistryEntryWithDefinitionUrl() throws APIManagementException\n         compareRegistryEntryDTOs(payloadEntryDTO, responseEntryDTO);\n     }\n \n+    @Test\n+    public void updateRegistryEntryWithNoDefinitionFileAndUrl() throws APIManagementException {\n+        final String REGISTRY_UUID = \"reg1\";\n+\n+        EndpointRegistryInfo endpointRegistryInfo = new EndpointRegistryInfo();", "originalCommit": "54f755af115f53e84f0be6812a138cbbe516a75c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTE1MzI1MQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8552#discussion_r429153251", "bodyText": "the reason is, if we are to add a new property to a schema there;s a lot of places to change to include them in the tests. By introducing a method we can minimize that effort.", "author": "fazlan-nazeem", "createdAt": "2020-05-22T09:53:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTE1MjY3Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTE1NzA4Mw==", "url": "https://github.com/wso2/carbon-apimgt/pull/8552#discussion_r429157083", "bodyText": "sure, will add that", "author": "ChamodDamitha", "createdAt": "2020-05-22T10:01:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTE1MjY3Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIwMDU0MQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8552#discussion_r429200541", "bodyText": "Added in e168f5d", "author": "ChamodDamitha", "createdAt": "2020-05-22T11:47:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTE1MjY3Ng=="}], "type": "inlineReview"}, {"oid": "2e5287d5bc7f50e5420792f0258baaa2a5b2905d", "url": "https://github.com/wso2/carbon-apimgt/commit/2e5287d5bc7f50e5420792f0258baaa2a5b2905d", "message": "Update endpoint registry test cases", "committedDate": "2020-05-22T11:34:21Z", "type": "forcePushed"}, {"oid": "6bb8978e4b4fb83f981a667e22774a38daba4209", "url": "https://github.com/wso2/carbon-apimgt/commit/6bb8978e4b4fb83f981a667e22774a38daba4209", "message": "Fix NPE in endpoint registry/entry DTO mapping functions", "committedDate": "2020-05-22T11:38:02Z", "type": "commit"}, {"oid": "ddfe7a37899a76ce7d8e81c48f1f0497fbe78de7", "url": "https://github.com/wso2/carbon-apimgt/commit/ddfe7a37899a76ce7d8e81c48f1f0497fbe78de7", "message": "Allow create/update endpoint registry entry when no definition file/url  provided", "committedDate": "2020-05-22T11:38:02Z", "type": "commit"}, {"oid": "e168f5df88c3d0fd01b64f4ad08d69c5bed0b45e", "url": "https://github.com/wso2/carbon-apimgt/commit/e168f5df88c3d0fd01b64f4ad08d69c5bed0b45e", "message": "Update endpoint registry test cases", "committedDate": "2020-05-22T11:45:28Z", "type": "commit"}, {"oid": "e168f5df88c3d0fd01b64f4ad08d69c5bed0b45e", "url": "https://github.com/wso2/carbon-apimgt/commit/e168f5df88c3d0fd01b64f4ad08d69c5bed0b45e", "message": "Update endpoint registry test cases", "committedDate": "2020-05-22T11:45:28Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjEzMTk0MQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8552#discussion_r466131941", "bodyText": "Shall we move \"user1\" to line 233?", "author": "Meruja", "createdAt": "2020-08-06T04:00:48Z", "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.endpoint.registry/src/test/java/org.wso2.carbon.apimgt.rest.api.endpoint.registry/impl/RegistriesApiServiceImplTest.java", "diffHunk": "@@ -263,23 +228,12 @@ public void addRegistry_ResourceNameExists() throws APIManagementException {\n \n     @Test\n     public void updateRegistry() throws APIManagementException {\n-        EndpointRegistryInfo endpointRegistryInfoOld = new EndpointRegistryInfo();\n-        endpointRegistryInfoOld.setName(\"Endpoint Registry 1\");\n-        endpointRegistryInfoOld.setUuid(\"abc1\");\n-        endpointRegistryInfoOld.setMode(RegistryDTO.ModeEnum.READWRITE.toString());\n-        endpointRegistryInfoOld.setType(RegistryDTO.TypeEnum.ETCD.toString());\n-        endpointRegistryInfoOld.setOwner(ADMIN_USERNAME);\n-\n-        RegistryDTO payloadDTO = new RegistryDTO();\n-        payloadDTO.setName(\"Endpoint Registry 2\");\n-        payloadDTO.setId(\"abc1\");\n-        payloadDTO.setMode(RegistryDTO.ModeEnum.READONLY);\n-        payloadDTO.setType(RegistryDTO.TypeEnum.WSO2);\n-        payloadDTO.setOwner(ADMIN_USERNAME);\n-\n-        EndpointRegistryInfo endpointRegistryInfoNew =\n-                EndpointRegistryMappingUtils.fromDTOtoEndpointRegistry(payloadDTO, ADMIN_USERNAME);\n-        endpointRegistryInfoNew.setUuid(\"abc1\");\n+        EndpointRegistryInfo endpointRegistryInfoOld = createRegistryWithDefaultParams();\n+        EndpointRegistryInfo endpointRegistryInfoNew = createRegistry(endpointRegistryInfoOld.getUuid(), 2,\n+                \"Endpoint Registry 2\", RegistryDTO.ModeEnum.READWRITE, RegistryDTO.TypeEnum.ETCD,\n+                \"user1\");", "originalCommit": "e168f5df88c3d0fd01b64f4ad08d69c5bed0b45e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODg0ODM0NQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8552#discussion_r478848345", "bodyText": "Removed the file in #8615", "author": "ChamodDamitha", "createdAt": "2020-08-28T06:02:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjEzMTk0MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjEzMTk3Ng==", "url": "https://github.com/wso2/carbon-apimgt/pull/8552#discussion_r466131976", "bodyText": "Shall we move \"user1\" to line 256?", "author": "Meruja", "createdAt": "2020-08-06T04:01:01Z", "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.endpoint.registry/src/test/java/org.wso2.carbon.apimgt.rest.api.endpoint.registry/impl/RegistriesApiServiceImplTest.java", "diffHunk": "@@ -297,23 +251,12 @@ public void updateRegistry() throws APIManagementException {\n \n     @Test\n     public void updateRegistry_existingName() throws APIManagementException {\n-        EndpointRegistryInfo endpointRegistryInfoOld = new EndpointRegistryInfo();\n-        endpointRegistryInfoOld.setName(\"Endpoint Registry 1\");\n-        endpointRegistryInfoOld.setUuid(\"abc1\");\n-        endpointRegistryInfoOld.setMode(RegistryDTO.ModeEnum.READWRITE.toString());\n-        endpointRegistryInfoOld.setType(RegistryDTO.TypeEnum.ETCD.toString());\n-        endpointRegistryInfoOld.setOwner(ADMIN_USERNAME);\n-\n-        RegistryDTO payloadDTO = new RegistryDTO();\n-        payloadDTO.setName(\"Endpoint Registry 2\");\n-        payloadDTO.setId(\"abc1\");\n-        payloadDTO.setMode(RegistryDTO.ModeEnum.READONLY);\n-        payloadDTO.setType(RegistryDTO.TypeEnum.WSO2);\n-        payloadDTO.setOwner(ADMIN_USERNAME);\n-\n-        EndpointRegistryInfo endpointRegistryInfoNew =\n-                EndpointRegistryMappingUtils.fromDTOtoEndpointRegistry(payloadDTO, ADMIN_USERNAME);\n-        endpointRegistryInfoNew.setUuid(\"abc1\");\n+        EndpointRegistryInfo endpointRegistryInfoOld = createRegistryWithDefaultParams();\n+        EndpointRegistryInfo endpointRegistryInfoNew = createRegistry(endpointRegistryInfoOld.getUuid(), 2,\n+                \"Endpoint Registry 2\", RegistryDTO.ModeEnum.READWRITE, RegistryDTO.TypeEnum.ETCD,\n+                \"user1\");\n+", "originalCommit": "e168f5df88c3d0fd01b64f4ad08d69c5bed0b45e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODg0ODM3OA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8552#discussion_r478848378", "bodyText": "Removed the file in #8615", "author": "ChamodDamitha", "createdAt": "2020-08-28T06:02:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjEzMTk3Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjE1MjA3OQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8552#discussion_r466152079", "bodyText": "Shall we declare variables for \"Entry Name 2\", \"{mutualTLS: false}\" and \"https://xyz2.com\"?\nIt has been used in many places.", "author": "Meruja", "createdAt": "2020-08-06T05:19:43Z", "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.endpoint.registry/src/test/java/org.wso2.carbon.apimgt.rest.api.endpoint.registry/impl/RegistriesApiServiceImplTest.java", "diffHunk": "@@ -914,26 +685,18 @@ public void getAllEntriesInRegistry() throws APIManagementException {\n \n         List<EndpointRegistryEntry> endpointRegistryEntryList = new ArrayList<>();\n \n-        EndpointRegistryEntry endpointRegistryEntry1 = new EndpointRegistryEntry();\n-        endpointRegistryEntry1.setEntryId(\"entry1\");\n-        endpointRegistryEntry1.setName(\"Entry Name 1\");\n-        endpointRegistryEntry1.setMetaData(\"{mutualTLS: true}\");\n-        endpointRegistryEntry1.setProductionServiceURL(\"https://xyz.com\");\n-        endpointRegistryEntry1.setServiceType(RegistryEntryDTO.ServiceTypeEnum.REST.toString());\n-        endpointRegistryEntry1.setServiceCategory(RegistryEntryDTO.ServiceCategoryEnum.UTILITY.toString());\n-        endpointRegistryEntry1.setDefinitionURL(\"https://petstore.swagger.io/v2/swagger.json\");\n-        endpointRegistryEntry1.setDefinitionType(RegistryEntryDTO.DefinitionTypeEnum.OAS.toString());\n+        EndpointRegistryEntry endpointRegistryEntry1 = createRegistryEntry(\"entry1\", \"Entry Name 1\",\n+                \"{mutualTLS: true}\", \"https://xyz.com\",\n+                RegistryEntryDTO.ServiceTypeEnum.REST, RegistryEntryDTO.ServiceCategoryEnum.UTILITY,\n+                \"https://petstore.swagger.io/v2/swagger.json\", RegistryEntryDTO.DefinitionTypeEnum.OAS,\n+                null);\n         endpointRegistryEntryList.add(endpointRegistryEntry1);\n \n-        EndpointRegistryEntry endpointRegistryEntry2 = new EndpointRegistryEntry();\n-        endpointRegistryEntry2.setEntryId(\"entry2\");\n-        endpointRegistryEntry2.setName(\"Entry Name 2\");\n-        endpointRegistryEntry2.setMetaData(\"{mutualTLS: true}\");\n-        endpointRegistryEntry2.setProductionServiceURL(\"https://xyz2.com\");\n-        endpointRegistryEntry2.setServiceType(RegistryEntryDTO.ServiceTypeEnum.SOAP_1_1.toString());\n-        endpointRegistryEntry2.setServiceCategory(RegistryEntryDTO.ServiceCategoryEnum.DOMAIN.toString());\n-        endpointRegistryEntry2.setDefinitionURL(\"https://petstore.swagger.io/v2/swagger2.json\");\n-        endpointRegistryEntry2.setDefinitionType(RegistryEntryDTO.DefinitionTypeEnum.GQL_SDL.toString());\n+        EndpointRegistryEntry endpointRegistryEntry2 = createRegistryEntry(\"entry2\", \"Entry Name 2\",\n+                \"{mutualTLS: false}\", \"https://xyz2.com\",", "originalCommit": "e168f5df88c3d0fd01b64f4ad08d69c5bed0b45e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODg0ODM5OA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8552#discussion_r478848398", "bodyText": "Removed the file in #8615", "author": "ChamodDamitha", "createdAt": "2020-08-28T06:02:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjE1MjA3OQ=="}], "type": "inlineReview"}]}