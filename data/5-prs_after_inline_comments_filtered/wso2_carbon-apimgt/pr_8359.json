{"pr_number": 8359, "pr_title": "Make API provider name optional when exporting an API", "pr_createdAt": "2020-03-16T08:40:35Z", "pr_url": "https://github.com/wso2/carbon-apimgt/pull/8359", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjg2NTQwMA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8359#discussion_r392865400", "bodyText": "Please fix the small formatting issue here (line 77 and 83). Space required between ) and {", "author": "malinthaprasan", "createdAt": "2020-03-16T08:56:25Z", "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.util/src/main/java/org/wso2/carbon/apimgt/rest/api/util/impl/ExportApiUtil.java", "diffHunk": "@@ -60,19 +60,35 @@ public Response exportApiByParams(String name, String version, String providerNa\n         //If not specified status is preserved by default\n         boolean isStatusPreserved = preserveStatus == null || preserveStatus;\n \n-        if (name == null || version == null || providerName == null) {\n-            RestApiUtil.handleBadRequest(\"'name', 'version' or 'provider' should not be null\", log);\n+        if (name == null || version == null) {\n+            RestApiUtil.handleBadRequest(\"'name' or 'version' should not be null\", log);\n         }\n \n         try {\n             //Default export format is YAML\n             exportFormat = StringUtils.isNotEmpty(format) ? ExportFormat.valueOf(format.toUpperCase()) :\n                     ExportFormat.YAML;\n \n+            // Get currently logged in user's username and the domain\n             userName = RestApiUtil.getLoggedInUsername();\n+            apiRequesterDomain = RestApiUtil.getLoggedInUserTenantDomain();\n+\n+            // If provider name is not given\n+            if (providerName.isEmpty()){\n+                // Retrieve the provider who is in same tenant domain and who owns the same API (by comparing\n+                // API name and the version)\n+                providerName = APIUtil.getAPIProviderFromAPINameVersionTenant(name, version, apiRequesterDomain);\n+\n+                // If there is no provider in current domain, the API cannot be exported\n+                if (providerName == null){", "originalCommit": "4f9ddf280270c9679cac2a2b9b55e2a6c2c1bf08", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjg2NzIyMw==", "url": "https://github.com/wso2/carbon-apimgt/pull/8359#discussion_r392867223", "bodyText": "Shall we use StringUtils.isBlank - [1] here?\n[1] http://commons.apache.org/proper/commons-lang/javadocs/api-2.6/org/apache/commons/lang/StringUtils.html#isBlank(java.lang.String)", "author": "vithu30", "createdAt": "2020-03-16T08:59:57Z", "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.util/src/main/java/org/wso2/carbon/apimgt/rest/api/util/impl/ExportApiUtil.java", "diffHunk": "@@ -60,19 +60,35 @@ public Response exportApiByParams(String name, String version, String providerNa\n         //If not specified status is preserved by default\n         boolean isStatusPreserved = preserveStatus == null || preserveStatus;\n \n-        if (name == null || version == null || providerName == null) {\n-            RestApiUtil.handleBadRequest(\"'name', 'version' or 'provider' should not be null\", log);\n+        if (name == null || version == null) {\n+            RestApiUtil.handleBadRequest(\"'name' or 'version' should not be null\", log);\n         }\n \n         try {\n             //Default export format is YAML\n             exportFormat = StringUtils.isNotEmpty(format) ? ExportFormat.valueOf(format.toUpperCase()) :\n                     ExportFormat.YAML;\n \n+            // Get currently logged in user's username and the domain\n             userName = RestApiUtil.getLoggedInUsername();\n+            apiRequesterDomain = RestApiUtil.getLoggedInUserTenantDomain();\n+\n+            // If provider name is not given\n+            if (providerName.isEmpty()){", "originalCommit": "4f9ddf280270c9679cac2a2b9b55e2a6c2c1bf08", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjg5NTg2Ng==", "url": "https://github.com/wso2/carbon-apimgt/pull/8359#discussion_r392895866", "bodyText": "+1 to use StringUtils.isBlank", "author": "prasa7", "createdAt": "2020-03-16T09:52:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjg2NzIyMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjg3ODk4Ng==", "url": "https://github.com/wso2/carbon-apimgt/pull/8359#discussion_r392878986", "bodyText": "Please fix the small formatting issue", "author": "HiranyaKavishani", "createdAt": "2020-03-16T09:22:35Z", "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.admin/src/gen/java/org/wso2/carbon/apimgt/rest/api/admin/ExportApi.java", "diffHunk": "@@ -40,11 +40,11 @@\n \n     public Response exportApiGet(@ApiParam(value = \"API Name\\n\",required=true) @QueryParam(\"name\")  String name,\n     @ApiParam(value = \"Version of the API\\n\",required=true) @QueryParam(\"version\")  String version,\n-    @ApiParam(value = \"Provider name of the API\\n\",required=true) @QueryParam(\"providerName\")  String providerName,\n     @ApiParam(value = \"Format of output documents. Can be YAML or JSON.\\n\",required=true, allowableValues=\"{values=[JSON, YAML]}\") @QueryParam(\"format\")  String format,\n+    @ApiParam(value = \"Provider name of the API\\n\") @QueryParam(\"providerName\")  String providerName,\n     @ApiParam(value = \"Preserve API Status on export\\n\") @QueryParam(\"preserveStatus\")  Boolean preserveStatus)\n     {\n-    return delegate.exportApiGet(name,version,providerName,format,preserveStatus);\n+    return delegate.exportApiGet(name,version,format,providerName,preserveStatus);", "originalCommit": "4f9ddf280270c9679cac2a2b9b55e2a6c2c1bf08", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjg4NDQyNQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8359#discussion_r392884425", "bodyText": "This file was automatically generated by sagger2cxf. Is it okay to change an automatically generated file like this?", "author": "wasuradananjith", "createdAt": "2020-03-16T09:32:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjg3ODk4Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjg5MDQ0NA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8359#discussion_r392890444", "bodyText": "Then we don't need", "author": "HiranyaKavishani", "createdAt": "2020-03-16T09:42:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjg3ODk4Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjg3OTQ2MA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8359#discussion_r392879460", "bodyText": "Please fix the small formatting issue", "author": "HiranyaKavishani", "createdAt": "2020-03-16T09:23:22Z", "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.admin/src/gen/java/org/wso2/carbon/apimgt/rest/api/admin/ExportApiService.java", "diffHunk": "@@ -14,7 +14,7 @@\n import javax.ws.rs.core.Response;\n \n public abstract class ExportApiService {\n-    public abstract Response exportApiGet(String name,String version,String providerName,String format,Boolean preserveStatus);\n+    public abstract Response exportApiGet(String name,String version,String format,String providerName,Boolean preserveStatus);", "originalCommit": "4f9ddf280270c9679cac2a2b9b55e2a6c2c1bf08", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjg4NDczMw==", "url": "https://github.com/wso2/carbon-apimgt/pull/8359#discussion_r392884733", "bodyText": "This file was automatically generated by sagger2cxf. Is it okay to change an automatically generated file like this?", "author": "wasuradananjith", "createdAt": "2020-03-16T09:32:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjg3OTQ2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjg5MDMxNQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8359#discussion_r392890315", "bodyText": "Then we don't need", "author": "HiranyaKavishani", "createdAt": "2020-03-16T09:42:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjg3OTQ2MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjg5NzE2Mw==", "url": "https://github.com/wso2/carbon-apimgt/pull/8359#discussion_r392897163", "bodyText": "Shall We print the context information (name and version) in the log message", "author": "prasa7", "createdAt": "2020-03-16T09:54:43Z", "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.util/src/main/java/org/wso2/carbon/apimgt/rest/api/util/impl/ExportApiUtil.java", "diffHunk": "@@ -60,19 +60,35 @@ public Response exportApiByParams(String name, String version, String providerNa\n         //If not specified status is preserved by default\n         boolean isStatusPreserved = preserveStatus == null || preserveStatus;\n \n-        if (name == null || version == null || providerName == null) {\n-            RestApiUtil.handleBadRequest(\"'name', 'version' or 'provider' should not be null\", log);\n+        if (name == null || version == null) {\n+            RestApiUtil.handleBadRequest(\"'name' or 'version' should not be null\", log);", "originalCommit": "4f9ddf280270c9679cac2a2b9b55e2a6c2c1bf08", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3641ced1f7342ca5b700683d589658c0e3a19f73", "url": "https://github.com/wso2/carbon-apimgt/commit/3641ced1f7342ca5b700683d589658c0e3a19f73", "message": "make provider name optional when exporting an api", "committedDate": "2020-03-16T11:10:06Z", "type": "commit"}, {"oid": "9a4d1253af2109fc8811b4c525f85330807373e2", "url": "https://github.com/wso2/carbon-apimgt/commit/9a4d1253af2109fc8811b4c525f85330807373e2", "message": "change formatting and print context inf in log", "committedDate": "2020-03-16T11:10:06Z", "type": "commit"}, {"oid": "9a4d1253af2109fc8811b4c525f85330807373e2", "url": "https://github.com/wso2/carbon-apimgt/commit/9a4d1253af2109fc8811b4c525f85330807373e2", "message": "change formatting and print context inf in log", "committedDate": "2020-03-16T11:10:06Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDEwNDc2Nw==", "url": "https://github.com/wso2/carbon-apimgt/pull/8359#discussion_r394104767", "bodyText": "Do we need this info log?", "author": "malinthaprasan", "createdAt": "2020-03-18T04:47:46Z", "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.util/src/main/java/org/wso2/carbon/apimgt/rest/api/util/impl/ExportApiUtil.java", "diffHunk": "@@ -60,19 +60,38 @@ public Response exportApiByParams(String name, String version, String providerNa\n         //If not specified status is preserved by default\n         boolean isStatusPreserved = preserveStatus == null || preserveStatus;\n \n-        if (name == null || version == null || providerName == null) {\n-            RestApiUtil.handleBadRequest(\"'name', 'version' or 'provider' should not be null\", log);\n+        // Print context information (name and version of the API) in the log\n+        log.info(\"API name: \"+ name + \", version: \"+ version);", "originalCommit": "9a4d1253af2109fc8811b4c525f85330807373e2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "c1f0ad7a24502795d7515b40c05cf9e7f5376cf3", "url": "https://github.com/wso2/carbon-apimgt/commit/c1f0ad7a24502795d7515b40c05cf9e7f5376cf3", "message": "change the api name and version null log", "committedDate": "2020-03-18T06:34:43Z", "type": "commit"}]}