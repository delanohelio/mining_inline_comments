{"pr_number": 8641, "pr_title": "Adding shared scope usage REST API", "pr_createdAt": "2020-06-03T07:19:07Z", "pr_url": "https://github.com/wso2/carbon-apimgt/pull/8641", "timeline": [{"oid": "ecfe7debc6c80092e9e02bff7dd29d93c2a40837", "url": "https://github.com/wso2/carbon-apimgt/commit/ecfe7debc6c80092e9e02bff7dd29d93c2a40837", "message": "Adding shared scope usage REST API", "committedDate": "2020-06-03T07:16:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDk1ODE1NA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8641#discussion_r434958154", "bodyText": "is it possible to use try with resources", "author": "malinthaprasan", "createdAt": "2020-06-04T02:32:54Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/ApiMgtDAO.java", "diffHunk": "@@ -14704,6 +14706,80 @@ public String getSharedScopeKeyByUUID(String uuid) throws APIManagementException\n         return scopeKey;\n     }\n \n+    /***\n+     * Get the API and URI usages of the given shared scope\n+     *\n+     * @param uuid Id of the shared scope\n+     * @param tenantId tenant Id\n+     * @return usgaes ofr the shaerd scope\n+     * @throws APIManagementException If an error occurs while getting the usage details\n+     */\n+    public SharedScopeUsage getSharedScopeUsage(String uuid, int tenantId) throws APIManagementException {\n+        Connection conn = null;\n+        ResultSet apiUsageResultSet = null;\n+        ResultSet uriUsageResultSet = null;\n+        PreparedStatement psForApiUsage = null;\n+        PreparedStatement psForUriUsage = null;\n+        SharedScopeUsage sharedScopeUsage = null;\n+        List<API> usedApiList = new ArrayList<>();\n+        String sharedScopeName = getSharedScopeKeyByUUID(uuid);\n+\n+        if (sharedScopeName != null) {\n+            sharedScopeUsage = new SharedScopeUsage();\n+            sharedScopeUsage.setId(uuid);\n+            sharedScopeUsage.setName(sharedScopeName);\n+        } else {\n+            throw new APIMgtResourceNotFoundException(\"Shared Scope not found for scope ID: \" + uuid,\n+                    ExceptionCodes.from(ExceptionCodes.SHARED_SCOPE_NOT_FOUND, uuid));\n+        }\n+\n+        try {\n+            conn = APIMgtDBUtil.getConnection();\n+            String sqlQueryForApiUsage = SQLConstants.GET_SHARED_SCOPE_API_USAGE_BY_TENANT;\n+            psForApiUsage = conn.prepareStatement(sqlQueryForApiUsage);\n+            psForApiUsage.setString(1, uuid);\n+            psForApiUsage.setInt(2, tenantId);\n+            apiUsageResultSet = psForApiUsage.executeQuery();\n+            while (apiUsageResultSet.next()) {", "originalCommit": "ecfe7debc6c80092e9e02bff7dd29d93c2a40837", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTAzMjI5Nw==", "url": "https://github.com/wso2/carbon-apimgt/pull/8641#discussion_r435032297", "bodyText": "Fixed with 3550c6a", "author": "mushthaq33", "createdAt": "2020-06-04T06:58:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDk1ODE1NA=="}], "type": "inlineReview"}, {"oid": "3550c6ac829d5e756dab682eab507f16e5616d0b", "url": "https://github.com/wso2/carbon-apimgt/commit/3550c6ac829d5e756dab682eab507f16e5616d0b", "message": "Adding changes", "committedDate": "2020-06-04T06:57:12Z", "type": "commit"}, {"oid": "ced0371bde8abe362a22f5b7de80d1afca230307", "url": "https://github.com/wso2/carbon-apimgt/commit/ced0371bde8abe362a22f5b7de80d1afca230307", "message": "Adding changes", "committedDate": "2020-06-04T07:02:37Z", "type": "commit"}]}