{"pr_number": 8293, "pr_title": "Added workflowExecutors for ApprovalWorkflowExecutor and two rest APIs.", "pr_createdAt": "2020-03-03T06:05:30Z", "pr_url": "https://github.com/wso2/carbon-apimgt/pull/8293", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjgyMjU5OA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r386822598", "bodyText": "remove extra whitespace", "author": "chamilaadhi", "createdAt": "2020-03-03T06:35:32Z", "path": "components/apimgt/org.wso2.carbon.apimgt.api/src/main/java/org/wso2/carbon/apimgt/api/APIAdmin.java", "diffHunk": "@@ -200,4 +201,9 @@ void updateMonetizationUsagePublishInfo(MonetizationUsagePublishInfo monetizatio\n      * @return Timestamp in long format\n      */\n     long getTimestamp(String date);\n+\n+    Workflow[] getworkflows(String workflowType, String status, String tenantDomain) throws APIManagementException;\n+\n+", "originalCommit": "6e7d63f0cbce7821d881557b6f804ffd9f00caf6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjgyNTc3MA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r386825770", "bodyText": "format this section. { should be after () . need space between =", "author": "chamilaadhi", "createdAt": "2020-03-03T06:47:12Z", "path": "components/apimgt/org.wso2.carbon.apimgt.api/src/main/java/org/wso2/carbon/apimgt/api/model/Workflow.java", "diffHunk": "@@ -0,0 +1,189 @@\n+package org.wso2.carbon.apimgt.api.model;\n+\n+import org.json.simple.JSONObject;\n+import org.wso2.carbon.apimgt.api.WorkflowStatus;\n+\n+public class Workflow {\n+\n+    private String workflowReference;\n+\n+    private String workflowType;\n+\n+    private WorkflowStatus status;\n+\n+    private String createdTime;\n+\n+    private String updatedTime;\n+\n+    private String workflowDescription;\n+\n+    private int tenantId;\n+\n+    private String tenantDomain;\n+\n+    private String externalWorkflowReference;\n+\n+    private String callbackUrl;\n+\n+    private int workflowId;\n+\n+    private String workflowStatusDesc;\n+\n+    private JSONObject metadata;\n+\n+    private JSONObject properties;\n+\n+    public Workflow()\n+    {\n+        metadata=new JSONObject();", "originalCommit": "6e7d63f0cbce7821d881557b6f804ffd9f00caf6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjgyNzAwNg==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r386827006", "bodyText": "format the method. lenght should be 120 characters", "author": "chamilaadhi", "createdAt": "2020-03-03T06:51:31Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/APIAdminImpl.java", "diffHunk": "@@ -349,4 +346,21 @@ private int isCategoryAttached(APICategory category, String username) throws API\n         int length = (Integer) result.get(\"length\");\n         return length;\n     }\n+\n+    public Workflow[] getworkflows(String workflowType, String status, String tenantDomain ) throws APIManagementException {\n+\n+        return apiMgtDAO.getworkflows(workflowType, status , tenantDomain );\n+    }\n+\n+    public Workflow getworkflowReferenceByExternalWorkflowReferenceID(String externelWorkflowRef, String status, String tenantDomain) throws APIManagementException {\n+", "originalCommit": "6e7d63f0cbce7821d881557b6f804ffd9f00caf6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU5ODU1Nw==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r387598557", "bodyText": "fixed with 1be4d86", "author": "SahanHerath", "createdAt": "2020-03-04T11:10:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjgyNzAwNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjgzNDcwNQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r386834705", "bodyText": "better to cast to string instead of using toString() .", "author": "chamilaadhi", "createdAt": "2020-03-03T07:17:43Z", "path": "components/apimgt/org.wso2.carbon.apimgt.api/src/main/java/org/wso2/carbon/apimgt/api/model/Workflow.java", "diffHunk": "@@ -0,0 +1,189 @@\n+package org.wso2.carbon.apimgt.api.model;\n+\n+import org.json.simple.JSONObject;\n+import org.wso2.carbon.apimgt.api.WorkflowStatus;\n+\n+public class Workflow {\n+\n+    private String workflowReference;\n+\n+    private String workflowType;\n+\n+    private WorkflowStatus status;\n+\n+    private String createdTime;\n+\n+    private String updatedTime;\n+\n+    private String workflowDescription;\n+\n+    private int tenantId;\n+\n+    private String tenantDomain;\n+\n+    private String externalWorkflowReference;\n+\n+    private String callbackUrl;\n+\n+    private int workflowId;\n+\n+    private String workflowStatusDesc;\n+\n+    private JSONObject metadata;\n+\n+    private JSONObject properties;\n+\n+    public Workflow()\n+    {\n+        metadata=new JSONObject();\n+        properties=new JSONObject();\n+    }\n+\n+    public String getWorkflowReference() {\n+        return workflowReference;\n+    }\n+\n+    public void setWorkflowReference(String workflowReference) {\n+        this.workflowReference = workflowReference;\n+    }\n+\n+    public String getWorkflowType() {\n+        return workflowType;\n+    }\n+\n+    public void setWorkflowType(String workflowType) {\n+        this.workflowType = workflowType;\n+    }\n+\n+    public WorkflowStatus getStatus() {\n+        return status;\n+    }\n+\n+    public void setStatus(WorkflowStatus status) {\n+        this.status = status;\n+    }\n+\n+    public String getCreatedTime() {\n+        return createdTime;\n+    }\n+\n+    public void setCreatedTime(String createdTime) {\n+        this.createdTime = createdTime;\n+    }\n+\n+    public String getUpdatedTime() {\n+        return updatedTime;\n+    }\n+\n+    public void setUpdatedTime(String updatedTime) {\n+        this.updatedTime = updatedTime;\n+    }\n+\n+    public String getWorkflowDescription() {\n+        return workflowDescription;\n+    }\n+\n+    public void setWorkflowDescription(String workflowDescription) {\n+        this.workflowDescription = workflowDescription;\n+    }\n+\n+    public int getTenantId() {\n+        return tenantId;\n+    }\n+\n+    public void setTenantId(int tenantId) {\n+        this.tenantId = tenantId;\n+    }\n+\n+    public String getTenantDomain() {\n+        return tenantDomain;\n+    }\n+\n+    public void setTenantDomain(String tenantDomain) {\n+        this.tenantDomain = tenantDomain;\n+    }\n+\n+    public String getExternalWorkflowReference() {\n+        return externalWorkflowReference;\n+    }\n+\n+    public void setExternalWorkflowReference(String externalWorkflowReference) {\n+        this.externalWorkflowReference = externalWorkflowReference;\n+    }\n+\n+    public String getCallbackUrl() {\n+        return callbackUrl;\n+    }\n+\n+    public void setCallbackUrl(String callbackUrl) {\n+        this.callbackUrl = callbackUrl;\n+    }\n+\n+    public int getWorkflowId() {\n+        return workflowId;\n+    }\n+\n+    public void setWorkflowId(int workflowId) {\n+        this.workflowId = workflowId;\n+    }\n+\n+    public String getWorkflowStatusDesc() {\n+        return workflowStatusDesc;\n+    }\n+\n+    public void setWorkflowStatusDesc(String workflowStatusDesc) {\n+        this.workflowStatusDesc = workflowStatusDesc;\n+    }\n+\n+    public String getMetadata(String key) {\n+        return metadata.get(key).toString();\n+    }\n+\n+    public void setMetadata(String key, String value) {\n+        metadata.put(key, value);\n+    }\n+\n+    public String getProperties(String key) {\n+        return properties.get(key).toString();", "originalCommit": "6e7d63f0cbce7821d881557b6f804ffd9f00caf6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjgzNDgzNQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r386834835", "bodyText": "better to cast to string instead of using toString()", "author": "chamilaadhi", "createdAt": "2020-03-03T07:18:09Z", "path": "components/apimgt/org.wso2.carbon.apimgt.api/src/main/java/org/wso2/carbon/apimgt/api/model/Workflow.java", "diffHunk": "@@ -0,0 +1,189 @@\n+package org.wso2.carbon.apimgt.api.model;\n+\n+import org.json.simple.JSONObject;\n+import org.wso2.carbon.apimgt.api.WorkflowStatus;\n+\n+public class Workflow {\n+\n+    private String workflowReference;\n+\n+    private String workflowType;\n+\n+    private WorkflowStatus status;\n+\n+    private String createdTime;\n+\n+    private String updatedTime;\n+\n+    private String workflowDescription;\n+\n+    private int tenantId;\n+\n+    private String tenantDomain;\n+\n+    private String externalWorkflowReference;\n+\n+    private String callbackUrl;\n+\n+    private int workflowId;\n+\n+    private String workflowStatusDesc;\n+\n+    private JSONObject metadata;\n+\n+    private JSONObject properties;\n+\n+    public Workflow()\n+    {\n+        metadata=new JSONObject();\n+        properties=new JSONObject();\n+    }\n+\n+    public String getWorkflowReference() {\n+        return workflowReference;\n+    }\n+\n+    public void setWorkflowReference(String workflowReference) {\n+        this.workflowReference = workflowReference;\n+    }\n+\n+    public String getWorkflowType() {\n+        return workflowType;\n+    }\n+\n+    public void setWorkflowType(String workflowType) {\n+        this.workflowType = workflowType;\n+    }\n+\n+    public WorkflowStatus getStatus() {\n+        return status;\n+    }\n+\n+    public void setStatus(WorkflowStatus status) {\n+        this.status = status;\n+    }\n+\n+    public String getCreatedTime() {\n+        return createdTime;\n+    }\n+\n+    public void setCreatedTime(String createdTime) {\n+        this.createdTime = createdTime;\n+    }\n+\n+    public String getUpdatedTime() {\n+        return updatedTime;\n+    }\n+\n+    public void setUpdatedTime(String updatedTime) {\n+        this.updatedTime = updatedTime;\n+    }\n+\n+    public String getWorkflowDescription() {\n+        return workflowDescription;\n+    }\n+\n+    public void setWorkflowDescription(String workflowDescription) {\n+        this.workflowDescription = workflowDescription;\n+    }\n+\n+    public int getTenantId() {\n+        return tenantId;\n+    }\n+\n+    public void setTenantId(int tenantId) {\n+        this.tenantId = tenantId;\n+    }\n+\n+    public String getTenantDomain() {\n+        return tenantDomain;\n+    }\n+\n+    public void setTenantDomain(String tenantDomain) {\n+        this.tenantDomain = tenantDomain;\n+    }\n+\n+    public String getExternalWorkflowReference() {\n+        return externalWorkflowReference;\n+    }\n+\n+    public void setExternalWorkflowReference(String externalWorkflowReference) {\n+        this.externalWorkflowReference = externalWorkflowReference;\n+    }\n+\n+    public String getCallbackUrl() {\n+        return callbackUrl;\n+    }\n+\n+    public void setCallbackUrl(String callbackUrl) {\n+        this.callbackUrl = callbackUrl;\n+    }\n+\n+    public int getWorkflowId() {\n+        return workflowId;\n+    }\n+\n+    public void setWorkflowId(int workflowId) {\n+        this.workflowId = workflowId;\n+    }\n+\n+    public String getWorkflowStatusDesc() {\n+        return workflowStatusDesc;\n+    }\n+\n+    public void setWorkflowStatusDesc(String workflowStatusDesc) {\n+        this.workflowStatusDesc = workflowStatusDesc;\n+    }\n+\n+    public String getMetadata(String key) {\n+        return metadata.get(key).toString();", "originalCommit": "6e7d63f0cbce7821d881557b6f804ffd9f00caf6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njg1NjgwOQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r386856809", "bodyText": "do a null check before converting to toJSONString(). otherwise if these properties are not set, NPE will be thrown", "author": "chamilaadhi", "createdAt": "2020-03-03T08:17:36Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/ApiMgtDAO.java", "diffHunk": "@@ -5936,10 +5933,17 @@ public void addWorkflowEntry(WorkflowDTO workflow) throws APIManagementException\n             prepStmt.setString(7, workflow.getTenantDomain());\n             prepStmt.setString(8, workflow.getExternalWorkflowReference());\n \n+            byte[] byteData1 = workflow.getMetadata().toJSONString().getBytes(\"UTF-8\");\n+            byte[] byteData2 = workflow.getProperties().toJSONString().getBytes(\"UTF-8\");\n+", "originalCommit": "6e7d63f0cbce7821d881557b6f804ffd9f00caf6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njg1Njk4MQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r386856981", "bodyText": "add method description", "author": "chamilaadhi", "createdAt": "2020-03-03T08:18:02Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/ApiMgtDAO.java", "diffHunk": "@@ -14576,4 +14580,284 @@ public String getUserID(String userName) throws APIManagementException {\n         }\n         return userID;\n     }\n+\n+\n+    public void deleteWorkflowRequest(String workflowExtRef) throws APIManagementException {", "originalCommit": "6e7d63f0cbce7821d881557b6f804ffd9f00caf6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU5ODkxNA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r387598914", "bodyText": "fixed with 1be4d86", "author": "SahanHerath", "createdAt": "2020-03-04T11:11:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njg1Njk4MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njg1NzEwMA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r386857100", "bodyText": "remove unnecessary white space", "author": "chamilaadhi", "createdAt": "2020-03-03T08:18:20Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/ApiMgtDAO.java", "diffHunk": "@@ -14576,4 +14580,284 @@ public String getUserID(String userName) throws APIManagementException {\n         }\n         return userID;\n     }\n+\n+\n+    public void deleteWorkflowRequest(String workflowExtRef) throws APIManagementException {\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+\n+        String query = SQLConstants.DELETE_WORKFLOW_REQUEST_SQL;\n+        try {\n+\n+            connection = APIMgtDBUtil.getConnection();\n+            connection.setAutoCommit(false);\n+\n+", "originalCommit": "6e7d63f0cbce7821d881557b6f804ffd9f00caf6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njg1NzY1Mw==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r386857653", "bodyText": "format the method\nadd a self-explanatory method name (no idea what this EWR means)\nadd method description", "author": "chamilaadhi", "createdAt": "2020-03-03T08:19:41Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/ApiMgtDAO.java", "diffHunk": "@@ -14576,4 +14580,284 @@ public String getUserID(String userName) throws APIManagementException {\n         }\n         return userID;\n     }\n+\n+\n+    public void deleteWorkflowRequest(String workflowExtRef) throws APIManagementException {\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+\n+        String query = SQLConstants.DELETE_WORKFLOW_REQUEST_SQL;\n+        try {\n+\n+            connection = APIMgtDBUtil.getConnection();\n+            connection.setAutoCommit(false);\n+\n+\n+            prepStmt = connection.prepareStatement(query);\n+            prepStmt.setString(1, workflowExtRef);\n+            prepStmt.executeUpdate();\n+            connection.commit();\n+        }\n+        catch (SQLException e) {\n+            handleException(\"Failed to delete the workflow request \", e);\n+\n+        }\n+    }\n+\n+    public Workflow getworkflowReferenceByEWR(String externalWorkflowRef)throws APIManagementException {\n+", "originalCommit": "6e7d63f0cbce7821d881557b6f804ffd9f00caf6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU5OTEzMw==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r387599133", "bodyText": "fixed with 1be4d86", "author": "SahanHerath", "createdAt": "2020-03-04T11:11:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njg1NzY1Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njg1Nzc4NA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r386857784", "bodyText": "remove all unnecessary white spaces", "author": "chamilaadhi", "createdAt": "2020-03-03T08:20:03Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/ApiMgtDAO.java", "diffHunk": "@@ -14576,4 +14580,284 @@ public String getUserID(String userName) throws APIManagementException {\n         }\n         return userID;\n     }\n+\n+\n+    public void deleteWorkflowRequest(String workflowExtRef) throws APIManagementException {\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+\n+        String query = SQLConstants.DELETE_WORKFLOW_REQUEST_SQL;\n+        try {\n+\n+            connection = APIMgtDBUtil.getConnection();\n+            connection.setAutoCommit(false);\n+\n+\n+            prepStmt = connection.prepareStatement(query);\n+            prepStmt.setString(1, workflowExtRef);\n+            prepStmt.executeUpdate();\n+            connection.commit();\n+        }\n+        catch (SQLException e) {\n+            handleException(\"Failed to delete the workflow request \", e);\n+\n+        }\n+    }\n+\n+    public Workflow getworkflowReferenceByEWR(String externalWorkflowRef)throws APIManagementException {\n+\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+        ResultSet rs = null;\n+\n+\n+        Workflow workflow=new Workflow();\n+\n+        String sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS_BY_EWR;\n+\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            prepStmt = connection.prepareStatement(sqlQuery);\n+            prepStmt.setString(1, externalWorkflowRef);\n+\n+\n+            rs = prepStmt.executeQuery();\n+\n+\n+", "originalCommit": "6e7d63f0cbce7821d881557b6f804ffd9f00caf6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njg1ODI5Mw==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r386858293", "bodyText": "remove whitespace and format", "author": "chamilaadhi", "createdAt": "2020-03-03T08:21:18Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/ApiMgtDAO.java", "diffHunk": "@@ -14576,4 +14580,284 @@ public String getUserID(String userName) throws APIManagementException {\n         }\n         return userID;\n     }\n+\n+\n+    public void deleteWorkflowRequest(String workflowExtRef) throws APIManagementException {\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+\n+        String query = SQLConstants.DELETE_WORKFLOW_REQUEST_SQL;\n+        try {\n+\n+            connection = APIMgtDBUtil.getConnection();\n+            connection.setAutoCommit(false);\n+\n+\n+            prepStmt = connection.prepareStatement(query);\n+            prepStmt.setString(1, workflowExtRef);\n+            prepStmt.executeUpdate();\n+            connection.commit();\n+        }\n+        catch (SQLException e) {\n+            handleException(\"Failed to delete the workflow request \", e);\n+\n+        }\n+    }\n+\n+    public Workflow getworkflowReferenceByEWR(String externalWorkflowRef)throws APIManagementException {\n+\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+        ResultSet rs = null;\n+\n+\n+        Workflow workflow=new Workflow();\n+\n+        String sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS_BY_EWR;\n+\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            prepStmt = connection.prepareStatement(sqlQuery);\n+            prepStmt.setString(1, externalWorkflowRef);\n+\n+\n+            rs = prepStmt.executeQuery();\n+\n+\n+\n+\n+            while (rs.next()) {\n+\n+                workflow.setWorkflowId(rs.getInt(\"WF_ID\"));\n+                workflow.setWorkflowReference(rs.getString(\"WF_REFERENCE\"));\n+                workflow.setWorkflowType(rs.getString(\"WF_TYPE\"));\n+\n+                String workflowstatus =rs.getString(\"WF_STATUS\");\n+                workflow.setStatus(org.wso2.carbon.apimgt.api.WorkflowStatus.valueOf(workflowstatus));\n+\n+                workflow.setCreatedTime(rs.getTimestamp(\"WF_CREATED_TIME\").toString());\n+                workflow.setUpdatedTime(rs.getTimestamp(\"WF_UPDATED_TIME\").toString());\n+\n+                workflow.setWorkflowStatusDesc(rs.getString(\"WF_STATUS_DESC\"));\n+                workflow.setTenantId(rs.getInt(\"TENANT_ID\"));\n+                workflow.setTenantDomain(rs.getString(\"TENANT_DOMAIN\"));\n+                workflow.setExternalWorkflowReference(rs.getString(\"WF_EXTERNAL_REFERENCE\"));\n+                Blob blob = rs.getBlob(\"WF_METADATA\");\n+\n+                byte[] byteData;\n+\n+                if(blob != null) {\n+                    byteData = blob.getBytes(1L, (int) blob.length());\n+                    InputStream targetStream = new ByteArrayInputStream(byteData);\n+                    String data = APIMgtDBUtil.getStringFromInputStream(targetStream);\n+                    Gson g = new Gson();\n+\n+                    JSONObject json = g.fromJson(data, JSONObject.class);\n+                    workflow.setMetadata(json);\n+                }\n+                else{\n+                    JSONObject json=new JSONObject();\n+                    workflow.setMetadata(json);\n+                }\n+\n+\n+\n+            }\n+\n+        } catch (SQLException e) {\n+            handleException(\"Error when retriving the workflow details\" , e);\n+        } finally {\n+            APIMgtDBUtil.closeAllConnections(prepStmt, connection, rs);\n+        }\n+        return workflow;\n+    }\n+\n+    public Workflow[] getworkflows(String workflowType ,String status ,String tenantDomain) throws APIManagementException {\n+\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+        ResultSet rs = null;\n+\n+        Workflow[] workflows = null;\n+\n+        String sqlQuery;\n+\n+        if (workflowType != null){\n+            sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS;\n+        }\n+        else{\n+            sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS_NO_TYPE;\n+        }\n+\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            prepStmt = connection.prepareStatement(sqlQuery);\n+\n+            if (workflowType != null){\n+                prepStmt.setString(1, workflowType);\n+                prepStmt.setString( 2, status);\n+                prepStmt.setString( 3, tenantDomain);\n+\n+            }\n+            else{\n+                prepStmt.setString( 1, status);\n+                prepStmt.setString( 2, tenantDomain);\n+            }\n+\n+\n+", "originalCommit": "6e7d63f0cbce7821d881557b6f804ffd9f00caf6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njg1OTE4NA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r386859184", "bodyText": "use a self descriptive variable names (ex: metadataBlob)", "author": "chamilaadhi", "createdAt": "2020-03-03T08:23:31Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/ApiMgtDAO.java", "diffHunk": "@@ -14576,4 +14580,284 @@ public String getUserID(String userName) throws APIManagementException {\n         }\n         return userID;\n     }\n+\n+\n+    public void deleteWorkflowRequest(String workflowExtRef) throws APIManagementException {\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+\n+        String query = SQLConstants.DELETE_WORKFLOW_REQUEST_SQL;\n+        try {\n+\n+            connection = APIMgtDBUtil.getConnection();\n+            connection.setAutoCommit(false);\n+\n+\n+            prepStmt = connection.prepareStatement(query);\n+            prepStmt.setString(1, workflowExtRef);\n+            prepStmt.executeUpdate();\n+            connection.commit();\n+        }\n+        catch (SQLException e) {\n+            handleException(\"Failed to delete the workflow request \", e);\n+\n+        }\n+    }\n+\n+    public Workflow getworkflowReferenceByEWR(String externalWorkflowRef)throws APIManagementException {\n+\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+        ResultSet rs = null;\n+\n+\n+        Workflow workflow=new Workflow();\n+\n+        String sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS_BY_EWR;\n+\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            prepStmt = connection.prepareStatement(sqlQuery);\n+            prepStmt.setString(1, externalWorkflowRef);\n+\n+\n+            rs = prepStmt.executeQuery();\n+\n+\n+\n+\n+            while (rs.next()) {\n+\n+                workflow.setWorkflowId(rs.getInt(\"WF_ID\"));\n+                workflow.setWorkflowReference(rs.getString(\"WF_REFERENCE\"));\n+                workflow.setWorkflowType(rs.getString(\"WF_TYPE\"));\n+\n+                String workflowstatus =rs.getString(\"WF_STATUS\");\n+                workflow.setStatus(org.wso2.carbon.apimgt.api.WorkflowStatus.valueOf(workflowstatus));\n+\n+                workflow.setCreatedTime(rs.getTimestamp(\"WF_CREATED_TIME\").toString());\n+                workflow.setUpdatedTime(rs.getTimestamp(\"WF_UPDATED_TIME\").toString());\n+\n+                workflow.setWorkflowStatusDesc(rs.getString(\"WF_STATUS_DESC\"));\n+                workflow.setTenantId(rs.getInt(\"TENANT_ID\"));\n+                workflow.setTenantDomain(rs.getString(\"TENANT_DOMAIN\"));\n+                workflow.setExternalWorkflowReference(rs.getString(\"WF_EXTERNAL_REFERENCE\"));\n+                Blob blob = rs.getBlob(\"WF_METADATA\");\n+\n+                byte[] byteData;\n+\n+                if(blob != null) {\n+                    byteData = blob.getBytes(1L, (int) blob.length());\n+                    InputStream targetStream = new ByteArrayInputStream(byteData);\n+                    String data = APIMgtDBUtil.getStringFromInputStream(targetStream);\n+                    Gson g = new Gson();\n+\n+                    JSONObject json = g.fromJson(data, JSONObject.class);\n+                    workflow.setMetadata(json);\n+                }\n+                else{\n+                    JSONObject json=new JSONObject();\n+                    workflow.setMetadata(json);\n+                }\n+\n+\n+\n+            }\n+\n+        } catch (SQLException e) {\n+            handleException(\"Error when retriving the workflow details\" , e);\n+        } finally {\n+            APIMgtDBUtil.closeAllConnections(prepStmt, connection, rs);\n+        }\n+        return workflow;\n+    }\n+\n+    public Workflow[] getworkflows(String workflowType ,String status ,String tenantDomain) throws APIManagementException {\n+\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+        ResultSet rs = null;\n+\n+        Workflow[] workflows = null;\n+\n+        String sqlQuery;\n+\n+        if (workflowType != null){\n+            sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS;\n+        }\n+        else{\n+            sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS_NO_TYPE;\n+        }\n+\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            prepStmt = connection.prepareStatement(sqlQuery);\n+\n+            if (workflowType != null){\n+                prepStmt.setString(1, workflowType);\n+                prepStmt.setString( 2, status);\n+                prepStmt.setString( 3, tenantDomain);\n+\n+            }\n+            else{\n+                prepStmt.setString( 1, status);\n+                prepStmt.setString( 2, tenantDomain);\n+            }\n+\n+\n+\n+\n+            rs = prepStmt.executeQuery();\n+\n+            ArrayList<Workflow> workflowsList = new ArrayList<Workflow>();\n+            Workflow workflow;\n+            while (rs.next()) {\n+                workflow = new Workflow();\n+                workflow.setWorkflowId(rs.getInt(\"WF_ID\"));\n+                workflow.setWorkflowReference(rs.getString(\"WF_REFERENCE\"));\n+                workflow.setWorkflowType(rs.getString(\"WF_TYPE\"));\n+\n+                String workflowstatus =rs.getString(\"WF_STATUS\");\n+                workflow.setStatus(org.wso2.carbon.apimgt.api.WorkflowStatus.valueOf(workflowstatus));\n+\n+                workflow.setCreatedTime(rs.getTimestamp(\"WF_CREATED_TIME\").toString());\n+                workflow.setUpdatedTime(rs.getTimestamp(\"WF_UPDATED_TIME\").toString());\n+\n+                workflow.setWorkflowStatusDesc(rs.getString(\"WF_STATUS_DESC\"));\n+                workflow.setTenantId(rs.getInt(\"TENANT_ID\"));\n+                workflow.setTenantDomain(rs.getString(\"TENANT_DOMAIN\"));\n+                workflow.setExternalWorkflowReference(rs.getString(\"WF_EXTERNAL_REFERENCE\"));\n+                workflow.setWorkflowDescription(rs.getString(\"WF_STATUS_DESC\"));\n+                Blob blob = rs.getBlob(\"WF_METADATA\");\n+                Blob blob1 = rs.getBlob(\"WF_PROPERTIES\");\n+", "originalCommit": "6e7d63f0cbce7821d881557b6f804ffd9f00caf6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njg1OTM3Nw==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r386859377", "bodyText": "same here", "author": "chamilaadhi", "createdAt": "2020-03-03T08:23:59Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/ApiMgtDAO.java", "diffHunk": "@@ -14576,4 +14580,284 @@ public String getUserID(String userName) throws APIManagementException {\n         }\n         return userID;\n     }\n+\n+\n+    public void deleteWorkflowRequest(String workflowExtRef) throws APIManagementException {\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+\n+        String query = SQLConstants.DELETE_WORKFLOW_REQUEST_SQL;\n+        try {\n+\n+            connection = APIMgtDBUtil.getConnection();\n+            connection.setAutoCommit(false);\n+\n+\n+            prepStmt = connection.prepareStatement(query);\n+            prepStmt.setString(1, workflowExtRef);\n+            prepStmt.executeUpdate();\n+            connection.commit();\n+        }\n+        catch (SQLException e) {\n+            handleException(\"Failed to delete the workflow request \", e);\n+\n+        }\n+    }\n+\n+    public Workflow getworkflowReferenceByEWR(String externalWorkflowRef)throws APIManagementException {\n+\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+        ResultSet rs = null;\n+\n+\n+        Workflow workflow=new Workflow();\n+\n+        String sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS_BY_EWR;\n+\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            prepStmt = connection.prepareStatement(sqlQuery);\n+            prepStmt.setString(1, externalWorkflowRef);\n+\n+\n+            rs = prepStmt.executeQuery();\n+\n+\n+\n+\n+            while (rs.next()) {\n+\n+                workflow.setWorkflowId(rs.getInt(\"WF_ID\"));\n+                workflow.setWorkflowReference(rs.getString(\"WF_REFERENCE\"));\n+                workflow.setWorkflowType(rs.getString(\"WF_TYPE\"));\n+\n+                String workflowstatus =rs.getString(\"WF_STATUS\");\n+                workflow.setStatus(org.wso2.carbon.apimgt.api.WorkflowStatus.valueOf(workflowstatus));\n+\n+                workflow.setCreatedTime(rs.getTimestamp(\"WF_CREATED_TIME\").toString());\n+                workflow.setUpdatedTime(rs.getTimestamp(\"WF_UPDATED_TIME\").toString());\n+\n+                workflow.setWorkflowStatusDesc(rs.getString(\"WF_STATUS_DESC\"));\n+                workflow.setTenantId(rs.getInt(\"TENANT_ID\"));\n+                workflow.setTenantDomain(rs.getString(\"TENANT_DOMAIN\"));\n+                workflow.setExternalWorkflowReference(rs.getString(\"WF_EXTERNAL_REFERENCE\"));\n+                Blob blob = rs.getBlob(\"WF_METADATA\");\n+\n+                byte[] byteData;\n+\n+                if(blob != null) {\n+                    byteData = blob.getBytes(1L, (int) blob.length());\n+                    InputStream targetStream = new ByteArrayInputStream(byteData);\n+                    String data = APIMgtDBUtil.getStringFromInputStream(targetStream);\n+                    Gson g = new Gson();\n+\n+                    JSONObject json = g.fromJson(data, JSONObject.class);\n+                    workflow.setMetadata(json);\n+                }\n+                else{\n+                    JSONObject json=new JSONObject();\n+                    workflow.setMetadata(json);\n+                }\n+\n+\n+\n+            }\n+\n+        } catch (SQLException e) {\n+            handleException(\"Error when retriving the workflow details\" , e);\n+        } finally {\n+            APIMgtDBUtil.closeAllConnections(prepStmt, connection, rs);\n+        }\n+        return workflow;\n+    }\n+\n+    public Workflow[] getworkflows(String workflowType ,String status ,String tenantDomain) throws APIManagementException {\n+\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+        ResultSet rs = null;\n+\n+        Workflow[] workflows = null;\n+\n+        String sqlQuery;\n+\n+        if (workflowType != null){\n+            sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS;\n+        }\n+        else{\n+            sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS_NO_TYPE;\n+        }\n+\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            prepStmt = connection.prepareStatement(sqlQuery);\n+\n+            if (workflowType != null){\n+                prepStmt.setString(1, workflowType);\n+                prepStmt.setString( 2, status);\n+                prepStmt.setString( 3, tenantDomain);\n+\n+            }\n+            else{\n+                prepStmt.setString( 1, status);\n+                prepStmt.setString( 2, tenantDomain);\n+            }\n+\n+\n+\n+\n+            rs = prepStmt.executeQuery();\n+\n+            ArrayList<Workflow> workflowsList = new ArrayList<Workflow>();\n+            Workflow workflow;\n+            while (rs.next()) {\n+                workflow = new Workflow();\n+                workflow.setWorkflowId(rs.getInt(\"WF_ID\"));\n+                workflow.setWorkflowReference(rs.getString(\"WF_REFERENCE\"));\n+                workflow.setWorkflowType(rs.getString(\"WF_TYPE\"));\n+\n+                String workflowstatus =rs.getString(\"WF_STATUS\");\n+                workflow.setStatus(org.wso2.carbon.apimgt.api.WorkflowStatus.valueOf(workflowstatus));\n+\n+                workflow.setCreatedTime(rs.getTimestamp(\"WF_CREATED_TIME\").toString());\n+                workflow.setUpdatedTime(rs.getTimestamp(\"WF_UPDATED_TIME\").toString());\n+\n+                workflow.setWorkflowStatusDesc(rs.getString(\"WF_STATUS_DESC\"));\n+                workflow.setTenantId(rs.getInt(\"TENANT_ID\"));\n+                workflow.setTenantDomain(rs.getString(\"TENANT_DOMAIN\"));\n+                workflow.setExternalWorkflowReference(rs.getString(\"WF_EXTERNAL_REFERENCE\"));\n+                workflow.setWorkflowDescription(rs.getString(\"WF_STATUS_DESC\"));\n+                Blob blob = rs.getBlob(\"WF_METADATA\");\n+                Blob blob1 = rs.getBlob(\"WF_PROPERTIES\");\n+\n+\n+                byte[] byteData;\n+", "originalCommit": "6e7d63f0cbce7821d881557b6f804ffd9f00caf6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njg1OTUzNw==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r386859537", "bodyText": "add meaningful variable name", "author": "chamilaadhi", "createdAt": "2020-03-03T08:24:25Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/ApiMgtDAO.java", "diffHunk": "@@ -14576,4 +14580,284 @@ public String getUserID(String userName) throws APIManagementException {\n         }\n         return userID;\n     }\n+\n+\n+    public void deleteWorkflowRequest(String workflowExtRef) throws APIManagementException {\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+\n+        String query = SQLConstants.DELETE_WORKFLOW_REQUEST_SQL;\n+        try {\n+\n+            connection = APIMgtDBUtil.getConnection();\n+            connection.setAutoCommit(false);\n+\n+\n+            prepStmt = connection.prepareStatement(query);\n+            prepStmt.setString(1, workflowExtRef);\n+            prepStmt.executeUpdate();\n+            connection.commit();\n+        }\n+        catch (SQLException e) {\n+            handleException(\"Failed to delete the workflow request \", e);\n+\n+        }\n+    }\n+\n+    public Workflow getworkflowReferenceByEWR(String externalWorkflowRef)throws APIManagementException {\n+\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+        ResultSet rs = null;\n+\n+\n+        Workflow workflow=new Workflow();\n+\n+        String sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS_BY_EWR;\n+\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            prepStmt = connection.prepareStatement(sqlQuery);\n+            prepStmt.setString(1, externalWorkflowRef);\n+\n+\n+            rs = prepStmt.executeQuery();\n+\n+\n+\n+\n+            while (rs.next()) {\n+\n+                workflow.setWorkflowId(rs.getInt(\"WF_ID\"));\n+                workflow.setWorkflowReference(rs.getString(\"WF_REFERENCE\"));\n+                workflow.setWorkflowType(rs.getString(\"WF_TYPE\"));\n+\n+                String workflowstatus =rs.getString(\"WF_STATUS\");\n+                workflow.setStatus(org.wso2.carbon.apimgt.api.WorkflowStatus.valueOf(workflowstatus));\n+\n+                workflow.setCreatedTime(rs.getTimestamp(\"WF_CREATED_TIME\").toString());\n+                workflow.setUpdatedTime(rs.getTimestamp(\"WF_UPDATED_TIME\").toString());\n+\n+                workflow.setWorkflowStatusDesc(rs.getString(\"WF_STATUS_DESC\"));\n+                workflow.setTenantId(rs.getInt(\"TENANT_ID\"));\n+                workflow.setTenantDomain(rs.getString(\"TENANT_DOMAIN\"));\n+                workflow.setExternalWorkflowReference(rs.getString(\"WF_EXTERNAL_REFERENCE\"));\n+                Blob blob = rs.getBlob(\"WF_METADATA\");\n+\n+                byte[] byteData;\n+\n+                if(blob != null) {\n+                    byteData = blob.getBytes(1L, (int) blob.length());\n+                    InputStream targetStream = new ByteArrayInputStream(byteData);\n+                    String data = APIMgtDBUtil.getStringFromInputStream(targetStream);\n+                    Gson g = new Gson();\n+\n+                    JSONObject json = g.fromJson(data, JSONObject.class);\n+                    workflow.setMetadata(json);\n+                }\n+                else{\n+                    JSONObject json=new JSONObject();\n+                    workflow.setMetadata(json);\n+                }\n+\n+\n+\n+            }\n+\n+        } catch (SQLException e) {\n+            handleException(\"Error when retriving the workflow details\" , e);\n+        } finally {\n+            APIMgtDBUtil.closeAllConnections(prepStmt, connection, rs);\n+        }\n+        return workflow;\n+    }\n+\n+    public Workflow[] getworkflows(String workflowType ,String status ,String tenantDomain) throws APIManagementException {\n+\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+        ResultSet rs = null;\n+\n+        Workflow[] workflows = null;\n+\n+        String sqlQuery;\n+\n+        if (workflowType != null){\n+            sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS;\n+        }\n+        else{\n+            sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS_NO_TYPE;\n+        }\n+\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            prepStmt = connection.prepareStatement(sqlQuery);\n+\n+            if (workflowType != null){\n+                prepStmt.setString(1, workflowType);\n+                prepStmt.setString( 2, status);\n+                prepStmt.setString( 3, tenantDomain);\n+\n+            }\n+            else{\n+                prepStmt.setString( 1, status);\n+                prepStmt.setString( 2, tenantDomain);\n+            }\n+\n+\n+\n+\n+            rs = prepStmt.executeQuery();\n+\n+            ArrayList<Workflow> workflowsList = new ArrayList<Workflow>();\n+            Workflow workflow;\n+            while (rs.next()) {\n+                workflow = new Workflow();\n+                workflow.setWorkflowId(rs.getInt(\"WF_ID\"));\n+                workflow.setWorkflowReference(rs.getString(\"WF_REFERENCE\"));\n+                workflow.setWorkflowType(rs.getString(\"WF_TYPE\"));\n+\n+                String workflowstatus =rs.getString(\"WF_STATUS\");\n+                workflow.setStatus(org.wso2.carbon.apimgt.api.WorkflowStatus.valueOf(workflowstatus));\n+\n+                workflow.setCreatedTime(rs.getTimestamp(\"WF_CREATED_TIME\").toString());\n+                workflow.setUpdatedTime(rs.getTimestamp(\"WF_UPDATED_TIME\").toString());\n+\n+                workflow.setWorkflowStatusDesc(rs.getString(\"WF_STATUS_DESC\"));\n+                workflow.setTenantId(rs.getInt(\"TENANT_ID\"));\n+                workflow.setTenantDomain(rs.getString(\"TENANT_DOMAIN\"));\n+                workflow.setExternalWorkflowReference(rs.getString(\"WF_EXTERNAL_REFERENCE\"));\n+                workflow.setWorkflowDescription(rs.getString(\"WF_STATUS_DESC\"));\n+                Blob blob = rs.getBlob(\"WF_METADATA\");\n+                Blob blob1 = rs.getBlob(\"WF_PROPERTIES\");\n+\n+\n+                byte[] byteData;\n+\n+                if(blob != null) {\n+                    byteData = blob.getBytes(1L, (int) blob.length());\n+                    InputStream targetStream = new ByteArrayInputStream(byteData);\n+                    String data = APIMgtDBUtil.getStringFromInputStream(targetStream);\n+                    Gson g = new Gson();", "originalCommit": "6e7d63f0cbce7821d881557b6f804ffd9f00caf6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njg1OTU5OQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r386859599", "bodyText": "add meaningful variable name", "author": "chamilaadhi", "createdAt": "2020-03-03T08:24:36Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/ApiMgtDAO.java", "diffHunk": "@@ -14576,4 +14580,284 @@ public String getUserID(String userName) throws APIManagementException {\n         }\n         return userID;\n     }\n+\n+\n+    public void deleteWorkflowRequest(String workflowExtRef) throws APIManagementException {\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+\n+        String query = SQLConstants.DELETE_WORKFLOW_REQUEST_SQL;\n+        try {\n+\n+            connection = APIMgtDBUtil.getConnection();\n+            connection.setAutoCommit(false);\n+\n+\n+            prepStmt = connection.prepareStatement(query);\n+            prepStmt.setString(1, workflowExtRef);\n+            prepStmt.executeUpdate();\n+            connection.commit();\n+        }\n+        catch (SQLException e) {\n+            handleException(\"Failed to delete the workflow request \", e);\n+\n+        }\n+    }\n+\n+    public Workflow getworkflowReferenceByEWR(String externalWorkflowRef)throws APIManagementException {\n+\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+        ResultSet rs = null;\n+\n+\n+        Workflow workflow=new Workflow();\n+\n+        String sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS_BY_EWR;\n+\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            prepStmt = connection.prepareStatement(sqlQuery);\n+            prepStmt.setString(1, externalWorkflowRef);\n+\n+\n+            rs = prepStmt.executeQuery();\n+\n+\n+\n+\n+            while (rs.next()) {\n+\n+                workflow.setWorkflowId(rs.getInt(\"WF_ID\"));\n+                workflow.setWorkflowReference(rs.getString(\"WF_REFERENCE\"));\n+                workflow.setWorkflowType(rs.getString(\"WF_TYPE\"));\n+\n+                String workflowstatus =rs.getString(\"WF_STATUS\");\n+                workflow.setStatus(org.wso2.carbon.apimgt.api.WorkflowStatus.valueOf(workflowstatus));\n+\n+                workflow.setCreatedTime(rs.getTimestamp(\"WF_CREATED_TIME\").toString());\n+                workflow.setUpdatedTime(rs.getTimestamp(\"WF_UPDATED_TIME\").toString());\n+\n+                workflow.setWorkflowStatusDesc(rs.getString(\"WF_STATUS_DESC\"));\n+                workflow.setTenantId(rs.getInt(\"TENANT_ID\"));\n+                workflow.setTenantDomain(rs.getString(\"TENANT_DOMAIN\"));\n+                workflow.setExternalWorkflowReference(rs.getString(\"WF_EXTERNAL_REFERENCE\"));\n+                Blob blob = rs.getBlob(\"WF_METADATA\");\n+\n+                byte[] byteData;\n+\n+                if(blob != null) {\n+                    byteData = blob.getBytes(1L, (int) blob.length());\n+                    InputStream targetStream = new ByteArrayInputStream(byteData);\n+                    String data = APIMgtDBUtil.getStringFromInputStream(targetStream);\n+                    Gson g = new Gson();\n+\n+                    JSONObject json = g.fromJson(data, JSONObject.class);\n+                    workflow.setMetadata(json);\n+                }\n+                else{\n+                    JSONObject json=new JSONObject();\n+                    workflow.setMetadata(json);\n+                }\n+\n+\n+\n+            }\n+\n+        } catch (SQLException e) {\n+            handleException(\"Error when retriving the workflow details\" , e);\n+        } finally {\n+            APIMgtDBUtil.closeAllConnections(prepStmt, connection, rs);\n+        }\n+        return workflow;\n+    }\n+\n+    public Workflow[] getworkflows(String workflowType ,String status ,String tenantDomain) throws APIManagementException {\n+\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+        ResultSet rs = null;\n+\n+        Workflow[] workflows = null;\n+\n+        String sqlQuery;\n+\n+        if (workflowType != null){\n+            sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS;\n+        }\n+        else{\n+            sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS_NO_TYPE;\n+        }\n+\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            prepStmt = connection.prepareStatement(sqlQuery);\n+\n+            if (workflowType != null){\n+                prepStmt.setString(1, workflowType);\n+                prepStmt.setString( 2, status);\n+                prepStmt.setString( 3, tenantDomain);\n+\n+            }\n+            else{\n+                prepStmt.setString( 1, status);\n+                prepStmt.setString( 2, tenantDomain);\n+            }\n+\n+\n+\n+\n+            rs = prepStmt.executeQuery();\n+\n+            ArrayList<Workflow> workflowsList = new ArrayList<Workflow>();\n+            Workflow workflow;\n+            while (rs.next()) {\n+                workflow = new Workflow();\n+                workflow.setWorkflowId(rs.getInt(\"WF_ID\"));\n+                workflow.setWorkflowReference(rs.getString(\"WF_REFERENCE\"));\n+                workflow.setWorkflowType(rs.getString(\"WF_TYPE\"));\n+\n+                String workflowstatus =rs.getString(\"WF_STATUS\");\n+                workflow.setStatus(org.wso2.carbon.apimgt.api.WorkflowStatus.valueOf(workflowstatus));\n+\n+                workflow.setCreatedTime(rs.getTimestamp(\"WF_CREATED_TIME\").toString());\n+                workflow.setUpdatedTime(rs.getTimestamp(\"WF_UPDATED_TIME\").toString());\n+\n+                workflow.setWorkflowStatusDesc(rs.getString(\"WF_STATUS_DESC\"));\n+                workflow.setTenantId(rs.getInt(\"TENANT_ID\"));\n+                workflow.setTenantDomain(rs.getString(\"TENANT_DOMAIN\"));\n+                workflow.setExternalWorkflowReference(rs.getString(\"WF_EXTERNAL_REFERENCE\"));\n+                workflow.setWorkflowDescription(rs.getString(\"WF_STATUS_DESC\"));\n+                Blob blob = rs.getBlob(\"WF_METADATA\");\n+                Blob blob1 = rs.getBlob(\"WF_PROPERTIES\");\n+\n+\n+                byte[] byteData;\n+\n+                if(blob != null) {\n+                    byteData = blob.getBytes(1L, (int) blob.length());\n+                    InputStream targetStream = new ByteArrayInputStream(byteData);\n+                    String data = APIMgtDBUtil.getStringFromInputStream(targetStream);\n+                    Gson g = new Gson();\n+\n+                    JSONObject json = g.fromJson(data, JSONObject.class);\n+                    workflow.setMetadata(json);\n+                }\n+                else{\n+                    JSONObject json = new JSONObject();\n+                    workflow.setMetadata(json);\n+                }\n+\n+                byte[] byteData1;", "originalCommit": "6e7d63f0cbce7821d881557b6f804ffd9f00caf6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njg1OTg2NQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r386859865", "bodyText": "add meaningful variable name", "author": "chamilaadhi", "createdAt": "2020-03-03T08:25:09Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/ApiMgtDAO.java", "diffHunk": "@@ -14576,4 +14580,284 @@ public String getUserID(String userName) throws APIManagementException {\n         }\n         return userID;\n     }\n+\n+\n+    public void deleteWorkflowRequest(String workflowExtRef) throws APIManagementException {\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+\n+        String query = SQLConstants.DELETE_WORKFLOW_REQUEST_SQL;\n+        try {\n+\n+            connection = APIMgtDBUtil.getConnection();\n+            connection.setAutoCommit(false);\n+\n+\n+            prepStmt = connection.prepareStatement(query);\n+            prepStmt.setString(1, workflowExtRef);\n+            prepStmt.executeUpdate();\n+            connection.commit();\n+        }\n+        catch (SQLException e) {\n+            handleException(\"Failed to delete the workflow request \", e);\n+\n+        }\n+    }\n+\n+    public Workflow getworkflowReferenceByEWR(String externalWorkflowRef)throws APIManagementException {\n+\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+        ResultSet rs = null;\n+\n+\n+        Workflow workflow=new Workflow();\n+\n+        String sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS_BY_EWR;\n+\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            prepStmt = connection.prepareStatement(sqlQuery);\n+            prepStmt.setString(1, externalWorkflowRef);\n+\n+\n+            rs = prepStmt.executeQuery();\n+\n+\n+\n+\n+            while (rs.next()) {\n+\n+                workflow.setWorkflowId(rs.getInt(\"WF_ID\"));\n+                workflow.setWorkflowReference(rs.getString(\"WF_REFERENCE\"));\n+                workflow.setWorkflowType(rs.getString(\"WF_TYPE\"));\n+\n+                String workflowstatus =rs.getString(\"WF_STATUS\");\n+                workflow.setStatus(org.wso2.carbon.apimgt.api.WorkflowStatus.valueOf(workflowstatus));\n+\n+                workflow.setCreatedTime(rs.getTimestamp(\"WF_CREATED_TIME\").toString());\n+                workflow.setUpdatedTime(rs.getTimestamp(\"WF_UPDATED_TIME\").toString());\n+\n+                workflow.setWorkflowStatusDesc(rs.getString(\"WF_STATUS_DESC\"));\n+                workflow.setTenantId(rs.getInt(\"TENANT_ID\"));\n+                workflow.setTenantDomain(rs.getString(\"TENANT_DOMAIN\"));\n+                workflow.setExternalWorkflowReference(rs.getString(\"WF_EXTERNAL_REFERENCE\"));\n+                Blob blob = rs.getBlob(\"WF_METADATA\");\n+\n+                byte[] byteData;\n+\n+                if(blob != null) {\n+                    byteData = blob.getBytes(1L, (int) blob.length());\n+                    InputStream targetStream = new ByteArrayInputStream(byteData);\n+                    String data = APIMgtDBUtil.getStringFromInputStream(targetStream);\n+                    Gson g = new Gson();\n+\n+                    JSONObject json = g.fromJson(data, JSONObject.class);\n+                    workflow.setMetadata(json);\n+                }\n+                else{\n+                    JSONObject json=new JSONObject();\n+                    workflow.setMetadata(json);\n+                }\n+\n+\n+\n+            }\n+\n+        } catch (SQLException e) {\n+            handleException(\"Error when retriving the workflow details\" , e);\n+        } finally {\n+            APIMgtDBUtil.closeAllConnections(prepStmt, connection, rs);\n+        }\n+        return workflow;\n+    }\n+\n+    public Workflow[] getworkflows(String workflowType ,String status ,String tenantDomain) throws APIManagementException {\n+\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+        ResultSet rs = null;\n+\n+        Workflow[] workflows = null;\n+\n+        String sqlQuery;\n+\n+        if (workflowType != null){\n+            sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS;\n+        }\n+        else{\n+            sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS_NO_TYPE;\n+        }\n+\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            prepStmt = connection.prepareStatement(sqlQuery);\n+\n+            if (workflowType != null){\n+                prepStmt.setString(1, workflowType);\n+                prepStmt.setString( 2, status);\n+                prepStmt.setString( 3, tenantDomain);\n+\n+            }\n+            else{\n+                prepStmt.setString( 1, status);\n+                prepStmt.setString( 2, tenantDomain);\n+            }\n+\n+\n+\n+\n+            rs = prepStmt.executeQuery();\n+\n+            ArrayList<Workflow> workflowsList = new ArrayList<Workflow>();\n+            Workflow workflow;\n+            while (rs.next()) {\n+                workflow = new Workflow();\n+                workflow.setWorkflowId(rs.getInt(\"WF_ID\"));\n+                workflow.setWorkflowReference(rs.getString(\"WF_REFERENCE\"));\n+                workflow.setWorkflowType(rs.getString(\"WF_TYPE\"));\n+\n+                String workflowstatus =rs.getString(\"WF_STATUS\");\n+                workflow.setStatus(org.wso2.carbon.apimgt.api.WorkflowStatus.valueOf(workflowstatus));\n+\n+                workflow.setCreatedTime(rs.getTimestamp(\"WF_CREATED_TIME\").toString());\n+                workflow.setUpdatedTime(rs.getTimestamp(\"WF_UPDATED_TIME\").toString());\n+\n+                workflow.setWorkflowStatusDesc(rs.getString(\"WF_STATUS_DESC\"));\n+                workflow.setTenantId(rs.getInt(\"TENANT_ID\"));\n+                workflow.setTenantDomain(rs.getString(\"TENANT_DOMAIN\"));\n+                workflow.setExternalWorkflowReference(rs.getString(\"WF_EXTERNAL_REFERENCE\"));\n+                workflow.setWorkflowDescription(rs.getString(\"WF_STATUS_DESC\"));\n+                Blob blob = rs.getBlob(\"WF_METADATA\");\n+                Blob blob1 = rs.getBlob(\"WF_PROPERTIES\");\n+\n+\n+                byte[] byteData;\n+\n+                if(blob != null) {\n+                    byteData = blob.getBytes(1L, (int) blob.length());\n+                    InputStream targetStream = new ByteArrayInputStream(byteData);\n+                    String data = APIMgtDBUtil.getStringFromInputStream(targetStream);\n+                    Gson g = new Gson();\n+\n+                    JSONObject json = g.fromJson(data, JSONObject.class);\n+                    workflow.setMetadata(json);\n+                }\n+                else{\n+                    JSONObject json = new JSONObject();\n+                    workflow.setMetadata(json);\n+                }\n+\n+                byte[] byteData1;\n+\n+                if(blob1 != null) {\n+                    byteData1 = blob1.getBytes(1L, (int) blob.length());\n+                    InputStream targetStream1 = new ByteArrayInputStream(byteData1);\n+                    String data1 = APIMgtDBUtil.getStringFromInputStream(targetStream1);\n+                    Gson g = new Gson();", "originalCommit": "6e7d63f0cbce7821d881557b6f804ffd9f00caf6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njg1OTkyMg==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r386859922", "bodyText": "format", "author": "chamilaadhi", "createdAt": "2020-03-03T08:25:16Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/ApiMgtDAO.java", "diffHunk": "@@ -14576,4 +14580,284 @@ public String getUserID(String userName) throws APIManagementException {\n         }\n         return userID;\n     }\n+\n+\n+    public void deleteWorkflowRequest(String workflowExtRef) throws APIManagementException {\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+\n+        String query = SQLConstants.DELETE_WORKFLOW_REQUEST_SQL;\n+        try {\n+\n+            connection = APIMgtDBUtil.getConnection();\n+            connection.setAutoCommit(false);\n+\n+\n+            prepStmt = connection.prepareStatement(query);\n+            prepStmt.setString(1, workflowExtRef);\n+            prepStmt.executeUpdate();\n+            connection.commit();\n+        }\n+        catch (SQLException e) {\n+            handleException(\"Failed to delete the workflow request \", e);\n+\n+        }\n+    }\n+\n+    public Workflow getworkflowReferenceByEWR(String externalWorkflowRef)throws APIManagementException {\n+\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+        ResultSet rs = null;\n+\n+\n+        Workflow workflow=new Workflow();\n+\n+        String sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS_BY_EWR;\n+\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            prepStmt = connection.prepareStatement(sqlQuery);\n+            prepStmt.setString(1, externalWorkflowRef);\n+\n+\n+            rs = prepStmt.executeQuery();\n+\n+\n+\n+\n+            while (rs.next()) {\n+\n+                workflow.setWorkflowId(rs.getInt(\"WF_ID\"));\n+                workflow.setWorkflowReference(rs.getString(\"WF_REFERENCE\"));\n+                workflow.setWorkflowType(rs.getString(\"WF_TYPE\"));\n+\n+                String workflowstatus =rs.getString(\"WF_STATUS\");\n+                workflow.setStatus(org.wso2.carbon.apimgt.api.WorkflowStatus.valueOf(workflowstatus));\n+\n+                workflow.setCreatedTime(rs.getTimestamp(\"WF_CREATED_TIME\").toString());\n+                workflow.setUpdatedTime(rs.getTimestamp(\"WF_UPDATED_TIME\").toString());\n+\n+                workflow.setWorkflowStatusDesc(rs.getString(\"WF_STATUS_DESC\"));\n+                workflow.setTenantId(rs.getInt(\"TENANT_ID\"));\n+                workflow.setTenantDomain(rs.getString(\"TENANT_DOMAIN\"));\n+                workflow.setExternalWorkflowReference(rs.getString(\"WF_EXTERNAL_REFERENCE\"));\n+                Blob blob = rs.getBlob(\"WF_METADATA\");\n+\n+                byte[] byteData;\n+\n+                if(blob != null) {\n+                    byteData = blob.getBytes(1L, (int) blob.length());\n+                    InputStream targetStream = new ByteArrayInputStream(byteData);\n+                    String data = APIMgtDBUtil.getStringFromInputStream(targetStream);\n+                    Gson g = new Gson();\n+\n+                    JSONObject json = g.fromJson(data, JSONObject.class);\n+                    workflow.setMetadata(json);\n+                }\n+                else{\n+                    JSONObject json=new JSONObject();\n+                    workflow.setMetadata(json);\n+                }\n+\n+\n+\n+            }\n+\n+        } catch (SQLException e) {\n+            handleException(\"Error when retriving the workflow details\" , e);\n+        } finally {\n+            APIMgtDBUtil.closeAllConnections(prepStmt, connection, rs);\n+        }\n+        return workflow;\n+    }\n+\n+    public Workflow[] getworkflows(String workflowType ,String status ,String tenantDomain) throws APIManagementException {\n+\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+        ResultSet rs = null;\n+\n+        Workflow[] workflows = null;\n+\n+        String sqlQuery;\n+\n+        if (workflowType != null){\n+            sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS;\n+        }\n+        else{\n+            sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS_NO_TYPE;\n+        }\n+\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            prepStmt = connection.prepareStatement(sqlQuery);\n+\n+            if (workflowType != null){\n+                prepStmt.setString(1, workflowType);\n+                prepStmt.setString( 2, status);\n+                prepStmt.setString( 3, tenantDomain);\n+\n+            }\n+            else{\n+                prepStmt.setString( 1, status);\n+                prepStmt.setString( 2, tenantDomain);\n+            }\n+\n+\n+\n+\n+            rs = prepStmt.executeQuery();\n+\n+            ArrayList<Workflow> workflowsList = new ArrayList<Workflow>();\n+            Workflow workflow;\n+            while (rs.next()) {\n+                workflow = new Workflow();\n+                workflow.setWorkflowId(rs.getInt(\"WF_ID\"));\n+                workflow.setWorkflowReference(rs.getString(\"WF_REFERENCE\"));\n+                workflow.setWorkflowType(rs.getString(\"WF_TYPE\"));\n+\n+                String workflowstatus =rs.getString(\"WF_STATUS\");\n+                workflow.setStatus(org.wso2.carbon.apimgt.api.WorkflowStatus.valueOf(workflowstatus));\n+\n+                workflow.setCreatedTime(rs.getTimestamp(\"WF_CREATED_TIME\").toString());\n+                workflow.setUpdatedTime(rs.getTimestamp(\"WF_UPDATED_TIME\").toString());\n+\n+                workflow.setWorkflowStatusDesc(rs.getString(\"WF_STATUS_DESC\"));\n+                workflow.setTenantId(rs.getInt(\"TENANT_ID\"));\n+                workflow.setTenantDomain(rs.getString(\"TENANT_DOMAIN\"));\n+                workflow.setExternalWorkflowReference(rs.getString(\"WF_EXTERNAL_REFERENCE\"));\n+                workflow.setWorkflowDescription(rs.getString(\"WF_STATUS_DESC\"));\n+                Blob blob = rs.getBlob(\"WF_METADATA\");\n+                Blob blob1 = rs.getBlob(\"WF_PROPERTIES\");\n+\n+\n+                byte[] byteData;\n+\n+                if(blob != null) {\n+                    byteData = blob.getBytes(1L, (int) blob.length());\n+                    InputStream targetStream = new ByteArrayInputStream(byteData);\n+                    String data = APIMgtDBUtil.getStringFromInputStream(targetStream);\n+                    Gson g = new Gson();\n+\n+                    JSONObject json = g.fromJson(data, JSONObject.class);\n+                    workflow.setMetadata(json);\n+                }\n+                else{\n+                    JSONObject json = new JSONObject();\n+                    workflow.setMetadata(json);\n+                }\n+\n+                byte[] byteData1;\n+\n+                if(blob1 != null) {\n+                    byteData1 = blob1.getBytes(1L, (int) blob.length());\n+                    InputStream targetStream1 = new ByteArrayInputStream(byteData1);\n+                    String data1 = APIMgtDBUtil.getStringFromInputStream(targetStream1);\n+                    Gson g = new Gson();\n+\n+                    JSONObject json = g.fromJson(data1, JSONObject.class);\n+                    workflow.setProperties(json);\n+                }\n+                else{\n+                    JSONObject json = new JSONObject();\n+                    workflow.setProperties(json);", "originalCommit": "6e7d63f0cbce7821d881557b6f804ffd9f00caf6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njg2MDE4Mw==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r386860183", "bodyText": "format\n-add method description", "author": "chamilaadhi", "createdAt": "2020-03-03T08:25:51Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/ApiMgtDAO.java", "diffHunk": "@@ -14576,4 +14580,284 @@ public String getUserID(String userName) throws APIManagementException {\n         }\n         return userID;\n     }\n+\n+\n+    public void deleteWorkflowRequest(String workflowExtRef) throws APIManagementException {\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+\n+        String query = SQLConstants.DELETE_WORKFLOW_REQUEST_SQL;\n+        try {\n+\n+            connection = APIMgtDBUtil.getConnection();\n+            connection.setAutoCommit(false);\n+\n+\n+            prepStmt = connection.prepareStatement(query);\n+            prepStmt.setString(1, workflowExtRef);\n+            prepStmt.executeUpdate();\n+            connection.commit();\n+        }\n+        catch (SQLException e) {\n+            handleException(\"Failed to delete the workflow request \", e);\n+\n+        }\n+    }\n+\n+    public Workflow getworkflowReferenceByEWR(String externalWorkflowRef)throws APIManagementException {\n+\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+        ResultSet rs = null;\n+\n+\n+        Workflow workflow=new Workflow();\n+\n+        String sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS_BY_EWR;\n+\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            prepStmt = connection.prepareStatement(sqlQuery);\n+            prepStmt.setString(1, externalWorkflowRef);\n+\n+\n+            rs = prepStmt.executeQuery();\n+\n+\n+\n+\n+            while (rs.next()) {\n+\n+                workflow.setWorkflowId(rs.getInt(\"WF_ID\"));\n+                workflow.setWorkflowReference(rs.getString(\"WF_REFERENCE\"));\n+                workflow.setWorkflowType(rs.getString(\"WF_TYPE\"));\n+\n+                String workflowstatus =rs.getString(\"WF_STATUS\");\n+                workflow.setStatus(org.wso2.carbon.apimgt.api.WorkflowStatus.valueOf(workflowstatus));\n+\n+                workflow.setCreatedTime(rs.getTimestamp(\"WF_CREATED_TIME\").toString());\n+                workflow.setUpdatedTime(rs.getTimestamp(\"WF_UPDATED_TIME\").toString());\n+\n+                workflow.setWorkflowStatusDesc(rs.getString(\"WF_STATUS_DESC\"));\n+                workflow.setTenantId(rs.getInt(\"TENANT_ID\"));\n+                workflow.setTenantDomain(rs.getString(\"TENANT_DOMAIN\"));\n+                workflow.setExternalWorkflowReference(rs.getString(\"WF_EXTERNAL_REFERENCE\"));\n+                Blob blob = rs.getBlob(\"WF_METADATA\");\n+\n+                byte[] byteData;\n+\n+                if(blob != null) {\n+                    byteData = blob.getBytes(1L, (int) blob.length());\n+                    InputStream targetStream = new ByteArrayInputStream(byteData);\n+                    String data = APIMgtDBUtil.getStringFromInputStream(targetStream);\n+                    Gson g = new Gson();\n+\n+                    JSONObject json = g.fromJson(data, JSONObject.class);\n+                    workflow.setMetadata(json);\n+                }\n+                else{\n+                    JSONObject json=new JSONObject();\n+                    workflow.setMetadata(json);\n+                }\n+\n+\n+\n+            }\n+\n+        } catch (SQLException e) {\n+            handleException(\"Error when retriving the workflow details\" , e);\n+        } finally {\n+            APIMgtDBUtil.closeAllConnections(prepStmt, connection, rs);\n+        }\n+        return workflow;\n+    }\n+\n+    public Workflow[] getworkflows(String workflowType ,String status ,String tenantDomain) throws APIManagementException {\n+\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+        ResultSet rs = null;\n+\n+        Workflow[] workflows = null;\n+\n+        String sqlQuery;\n+\n+        if (workflowType != null){\n+            sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS;\n+        }\n+        else{\n+            sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS_NO_TYPE;\n+        }\n+\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            prepStmt = connection.prepareStatement(sqlQuery);\n+\n+            if (workflowType != null){\n+                prepStmt.setString(1, workflowType);\n+                prepStmt.setString( 2, status);\n+                prepStmt.setString( 3, tenantDomain);\n+\n+            }\n+            else{\n+                prepStmt.setString( 1, status);\n+                prepStmt.setString( 2, tenantDomain);\n+            }\n+\n+\n+\n+\n+            rs = prepStmt.executeQuery();\n+\n+            ArrayList<Workflow> workflowsList = new ArrayList<Workflow>();\n+            Workflow workflow;\n+            while (rs.next()) {\n+                workflow = new Workflow();\n+                workflow.setWorkflowId(rs.getInt(\"WF_ID\"));\n+                workflow.setWorkflowReference(rs.getString(\"WF_REFERENCE\"));\n+                workflow.setWorkflowType(rs.getString(\"WF_TYPE\"));\n+\n+                String workflowstatus =rs.getString(\"WF_STATUS\");\n+                workflow.setStatus(org.wso2.carbon.apimgt.api.WorkflowStatus.valueOf(workflowstatus));\n+\n+                workflow.setCreatedTime(rs.getTimestamp(\"WF_CREATED_TIME\").toString());\n+                workflow.setUpdatedTime(rs.getTimestamp(\"WF_UPDATED_TIME\").toString());\n+\n+                workflow.setWorkflowStatusDesc(rs.getString(\"WF_STATUS_DESC\"));\n+                workflow.setTenantId(rs.getInt(\"TENANT_ID\"));\n+                workflow.setTenantDomain(rs.getString(\"TENANT_DOMAIN\"));\n+                workflow.setExternalWorkflowReference(rs.getString(\"WF_EXTERNAL_REFERENCE\"));\n+                workflow.setWorkflowDescription(rs.getString(\"WF_STATUS_DESC\"));\n+                Blob blob = rs.getBlob(\"WF_METADATA\");\n+                Blob blob1 = rs.getBlob(\"WF_PROPERTIES\");\n+\n+\n+                byte[] byteData;\n+\n+                if(blob != null) {\n+                    byteData = blob.getBytes(1L, (int) blob.length());\n+                    InputStream targetStream = new ByteArrayInputStream(byteData);\n+                    String data = APIMgtDBUtil.getStringFromInputStream(targetStream);\n+                    Gson g = new Gson();\n+\n+                    JSONObject json = g.fromJson(data, JSONObject.class);\n+                    workflow.setMetadata(json);\n+                }\n+                else{\n+                    JSONObject json = new JSONObject();\n+                    workflow.setMetadata(json);\n+                }\n+\n+                byte[] byteData1;\n+\n+                if(blob1 != null) {\n+                    byteData1 = blob1.getBytes(1L, (int) blob.length());\n+                    InputStream targetStream1 = new ByteArrayInputStream(byteData1);\n+                    String data1 = APIMgtDBUtil.getStringFromInputStream(targetStream1);\n+                    Gson g = new Gson();\n+\n+                    JSONObject json = g.fromJson(data1, JSONObject.class);\n+                    workflow.setProperties(json);\n+                }\n+                else{\n+                    JSONObject json = new JSONObject();\n+                    workflow.setProperties(json);\n+                }\n+\n+                workflowsList.add(workflow);\n+            }\n+            workflows = workflowsList.toArray(new Workflow[workflowsList.size()]);\n+        } catch (SQLException e) {\n+            handleException(\"Error when retrieve all the workflow details\" , e);\n+        } finally {\n+            APIMgtDBUtil.closeAllConnections(prepStmt, connection, rs);\n+        }\n+        return workflows;\n+\n+    }\n+\n+    public Workflow getworkflowReferenceByExternalWorkflowReferenceID(String externelWorkflowRef, String status , String tenantDomain) throws APIManagementException {\n+", "originalCommit": "6e7d63f0cbce7821d881557b6f804ffd9f00caf6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDc5MTE0Mw==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r410791143", "bodyText": "fixed with 1be4d86", "author": "SahanHerath", "createdAt": "2020-04-19T01:55:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njg2MDE4Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njg2MDMwMQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r386860301", "bodyText": "remove spaces", "author": "chamilaadhi", "createdAt": "2020-03-03T08:26:07Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/ApiMgtDAO.java", "diffHunk": "@@ -14576,4 +14580,284 @@ public String getUserID(String userName) throws APIManagementException {\n         }\n         return userID;\n     }\n+\n+\n+    public void deleteWorkflowRequest(String workflowExtRef) throws APIManagementException {\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+\n+        String query = SQLConstants.DELETE_WORKFLOW_REQUEST_SQL;\n+        try {\n+\n+            connection = APIMgtDBUtil.getConnection();\n+            connection.setAutoCommit(false);\n+\n+\n+            prepStmt = connection.prepareStatement(query);\n+            prepStmt.setString(1, workflowExtRef);\n+            prepStmt.executeUpdate();\n+            connection.commit();\n+        }\n+        catch (SQLException e) {\n+            handleException(\"Failed to delete the workflow request \", e);\n+\n+        }\n+    }\n+\n+    public Workflow getworkflowReferenceByEWR(String externalWorkflowRef)throws APIManagementException {\n+\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+        ResultSet rs = null;\n+\n+\n+        Workflow workflow=new Workflow();\n+\n+        String sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS_BY_EWR;\n+\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            prepStmt = connection.prepareStatement(sqlQuery);\n+            prepStmt.setString(1, externalWorkflowRef);\n+\n+\n+            rs = prepStmt.executeQuery();\n+\n+\n+\n+\n+            while (rs.next()) {\n+\n+                workflow.setWorkflowId(rs.getInt(\"WF_ID\"));\n+                workflow.setWorkflowReference(rs.getString(\"WF_REFERENCE\"));\n+                workflow.setWorkflowType(rs.getString(\"WF_TYPE\"));\n+\n+                String workflowstatus =rs.getString(\"WF_STATUS\");\n+                workflow.setStatus(org.wso2.carbon.apimgt.api.WorkflowStatus.valueOf(workflowstatus));\n+\n+                workflow.setCreatedTime(rs.getTimestamp(\"WF_CREATED_TIME\").toString());\n+                workflow.setUpdatedTime(rs.getTimestamp(\"WF_UPDATED_TIME\").toString());\n+\n+                workflow.setWorkflowStatusDesc(rs.getString(\"WF_STATUS_DESC\"));\n+                workflow.setTenantId(rs.getInt(\"TENANT_ID\"));\n+                workflow.setTenantDomain(rs.getString(\"TENANT_DOMAIN\"));\n+                workflow.setExternalWorkflowReference(rs.getString(\"WF_EXTERNAL_REFERENCE\"));\n+                Blob blob = rs.getBlob(\"WF_METADATA\");\n+\n+                byte[] byteData;\n+\n+                if(blob != null) {\n+                    byteData = blob.getBytes(1L, (int) blob.length());\n+                    InputStream targetStream = new ByteArrayInputStream(byteData);\n+                    String data = APIMgtDBUtil.getStringFromInputStream(targetStream);\n+                    Gson g = new Gson();\n+\n+                    JSONObject json = g.fromJson(data, JSONObject.class);\n+                    workflow.setMetadata(json);\n+                }\n+                else{\n+                    JSONObject json=new JSONObject();\n+                    workflow.setMetadata(json);\n+                }\n+\n+\n+\n+            }\n+\n+        } catch (SQLException e) {\n+            handleException(\"Error when retriving the workflow details\" , e);\n+        } finally {\n+            APIMgtDBUtil.closeAllConnections(prepStmt, connection, rs);\n+        }\n+        return workflow;\n+    }\n+\n+    public Workflow[] getworkflows(String workflowType ,String status ,String tenantDomain) throws APIManagementException {\n+\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+        ResultSet rs = null;\n+\n+        Workflow[] workflows = null;\n+\n+        String sqlQuery;\n+\n+        if (workflowType != null){\n+            sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS;\n+        }\n+        else{\n+            sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS_NO_TYPE;\n+        }\n+\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            prepStmt = connection.prepareStatement(sqlQuery);\n+\n+            if (workflowType != null){\n+                prepStmt.setString(1, workflowType);\n+                prepStmt.setString( 2, status);\n+                prepStmt.setString( 3, tenantDomain);\n+\n+            }\n+            else{\n+                prepStmt.setString( 1, status);\n+                prepStmt.setString( 2, tenantDomain);\n+            }\n+\n+\n+\n+\n+            rs = prepStmt.executeQuery();\n+\n+            ArrayList<Workflow> workflowsList = new ArrayList<Workflow>();\n+            Workflow workflow;\n+            while (rs.next()) {\n+                workflow = new Workflow();\n+                workflow.setWorkflowId(rs.getInt(\"WF_ID\"));\n+                workflow.setWorkflowReference(rs.getString(\"WF_REFERENCE\"));\n+                workflow.setWorkflowType(rs.getString(\"WF_TYPE\"));\n+\n+                String workflowstatus =rs.getString(\"WF_STATUS\");\n+                workflow.setStatus(org.wso2.carbon.apimgt.api.WorkflowStatus.valueOf(workflowstatus));\n+\n+                workflow.setCreatedTime(rs.getTimestamp(\"WF_CREATED_TIME\").toString());\n+                workflow.setUpdatedTime(rs.getTimestamp(\"WF_UPDATED_TIME\").toString());\n+\n+                workflow.setWorkflowStatusDesc(rs.getString(\"WF_STATUS_DESC\"));\n+                workflow.setTenantId(rs.getInt(\"TENANT_ID\"));\n+                workflow.setTenantDomain(rs.getString(\"TENANT_DOMAIN\"));\n+                workflow.setExternalWorkflowReference(rs.getString(\"WF_EXTERNAL_REFERENCE\"));\n+                workflow.setWorkflowDescription(rs.getString(\"WF_STATUS_DESC\"));\n+                Blob blob = rs.getBlob(\"WF_METADATA\");\n+                Blob blob1 = rs.getBlob(\"WF_PROPERTIES\");\n+\n+\n+                byte[] byteData;\n+\n+                if(blob != null) {\n+                    byteData = blob.getBytes(1L, (int) blob.length());\n+                    InputStream targetStream = new ByteArrayInputStream(byteData);\n+                    String data = APIMgtDBUtil.getStringFromInputStream(targetStream);\n+                    Gson g = new Gson();\n+\n+                    JSONObject json = g.fromJson(data, JSONObject.class);\n+                    workflow.setMetadata(json);\n+                }\n+                else{\n+                    JSONObject json = new JSONObject();\n+                    workflow.setMetadata(json);\n+                }\n+\n+                byte[] byteData1;\n+\n+                if(blob1 != null) {\n+                    byteData1 = blob1.getBytes(1L, (int) blob.length());\n+                    InputStream targetStream1 = new ByteArrayInputStream(byteData1);\n+                    String data1 = APIMgtDBUtil.getStringFromInputStream(targetStream1);\n+                    Gson g = new Gson();\n+\n+                    JSONObject json = g.fromJson(data1, JSONObject.class);\n+                    workflow.setProperties(json);\n+                }\n+                else{\n+                    JSONObject json = new JSONObject();\n+                    workflow.setProperties(json);\n+                }\n+\n+                workflowsList.add(workflow);\n+            }\n+            workflows = workflowsList.toArray(new Workflow[workflowsList.size()]);\n+        } catch (SQLException e) {\n+            handleException(\"Error when retrieve all the workflow details\" , e);\n+        } finally {\n+            APIMgtDBUtil.closeAllConnections(prepStmt, connection, rs);\n+        }\n+        return workflows;\n+\n+    }\n+\n+    public Workflow getworkflowReferenceByExternalWorkflowReferenceID(String externelWorkflowRef, String status , String tenantDomain) throws APIManagementException {\n+\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+        ResultSet rs = null;\n+\n+        Workflow workflow=new Workflow();\n+\n+        String sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAIL_REFER_BY_EXTERNALWORKFLOWREFERENCE;\n+\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            prepStmt = connection.prepareStatement(sqlQuery);\n+            prepStmt.setString(1, externelWorkflowRef);\n+            prepStmt.setString(2, status);\n+            prepStmt.setString(3, tenantDomain);\n+\n+\n+            rs = prepStmt.executeQuery();\n+\n+", "originalCommit": "6e7d63f0cbce7821d881557b6f804ffd9f00caf6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njg2MDM3Mw==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r386860373", "bodyText": "add meaningful variable name", "author": "chamilaadhi", "createdAt": "2020-03-03T08:26:19Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/ApiMgtDAO.java", "diffHunk": "@@ -14576,4 +14580,284 @@ public String getUserID(String userName) throws APIManagementException {\n         }\n         return userID;\n     }\n+\n+\n+    public void deleteWorkflowRequest(String workflowExtRef) throws APIManagementException {\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+\n+        String query = SQLConstants.DELETE_WORKFLOW_REQUEST_SQL;\n+        try {\n+\n+            connection = APIMgtDBUtil.getConnection();\n+            connection.setAutoCommit(false);\n+\n+\n+            prepStmt = connection.prepareStatement(query);\n+            prepStmt.setString(1, workflowExtRef);\n+            prepStmt.executeUpdate();\n+            connection.commit();\n+        }\n+        catch (SQLException e) {\n+            handleException(\"Failed to delete the workflow request \", e);\n+\n+        }\n+    }\n+\n+    public Workflow getworkflowReferenceByEWR(String externalWorkflowRef)throws APIManagementException {\n+\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+        ResultSet rs = null;\n+\n+\n+        Workflow workflow=new Workflow();\n+\n+        String sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS_BY_EWR;\n+\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            prepStmt = connection.prepareStatement(sqlQuery);\n+            prepStmt.setString(1, externalWorkflowRef);\n+\n+\n+            rs = prepStmt.executeQuery();\n+\n+\n+\n+\n+            while (rs.next()) {\n+\n+                workflow.setWorkflowId(rs.getInt(\"WF_ID\"));\n+                workflow.setWorkflowReference(rs.getString(\"WF_REFERENCE\"));\n+                workflow.setWorkflowType(rs.getString(\"WF_TYPE\"));\n+\n+                String workflowstatus =rs.getString(\"WF_STATUS\");\n+                workflow.setStatus(org.wso2.carbon.apimgt.api.WorkflowStatus.valueOf(workflowstatus));\n+\n+                workflow.setCreatedTime(rs.getTimestamp(\"WF_CREATED_TIME\").toString());\n+                workflow.setUpdatedTime(rs.getTimestamp(\"WF_UPDATED_TIME\").toString());\n+\n+                workflow.setWorkflowStatusDesc(rs.getString(\"WF_STATUS_DESC\"));\n+                workflow.setTenantId(rs.getInt(\"TENANT_ID\"));\n+                workflow.setTenantDomain(rs.getString(\"TENANT_DOMAIN\"));\n+                workflow.setExternalWorkflowReference(rs.getString(\"WF_EXTERNAL_REFERENCE\"));\n+                Blob blob = rs.getBlob(\"WF_METADATA\");\n+\n+                byte[] byteData;\n+\n+                if(blob != null) {\n+                    byteData = blob.getBytes(1L, (int) blob.length());\n+                    InputStream targetStream = new ByteArrayInputStream(byteData);\n+                    String data = APIMgtDBUtil.getStringFromInputStream(targetStream);\n+                    Gson g = new Gson();\n+\n+                    JSONObject json = g.fromJson(data, JSONObject.class);\n+                    workflow.setMetadata(json);\n+                }\n+                else{\n+                    JSONObject json=new JSONObject();\n+                    workflow.setMetadata(json);\n+                }\n+\n+\n+\n+            }\n+\n+        } catch (SQLException e) {\n+            handleException(\"Error when retriving the workflow details\" , e);\n+        } finally {\n+            APIMgtDBUtil.closeAllConnections(prepStmt, connection, rs);\n+        }\n+        return workflow;\n+    }\n+\n+    public Workflow[] getworkflows(String workflowType ,String status ,String tenantDomain) throws APIManagementException {\n+\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+        ResultSet rs = null;\n+\n+        Workflow[] workflows = null;\n+\n+        String sqlQuery;\n+\n+        if (workflowType != null){\n+            sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS;\n+        }\n+        else{\n+            sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS_NO_TYPE;\n+        }\n+\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            prepStmt = connection.prepareStatement(sqlQuery);\n+\n+            if (workflowType != null){\n+                prepStmt.setString(1, workflowType);\n+                prepStmt.setString( 2, status);\n+                prepStmt.setString( 3, tenantDomain);\n+\n+            }\n+            else{\n+                prepStmt.setString( 1, status);\n+                prepStmt.setString( 2, tenantDomain);\n+            }\n+\n+\n+\n+\n+            rs = prepStmt.executeQuery();\n+\n+            ArrayList<Workflow> workflowsList = new ArrayList<Workflow>();\n+            Workflow workflow;\n+            while (rs.next()) {\n+                workflow = new Workflow();\n+                workflow.setWorkflowId(rs.getInt(\"WF_ID\"));\n+                workflow.setWorkflowReference(rs.getString(\"WF_REFERENCE\"));\n+                workflow.setWorkflowType(rs.getString(\"WF_TYPE\"));\n+\n+                String workflowstatus =rs.getString(\"WF_STATUS\");\n+                workflow.setStatus(org.wso2.carbon.apimgt.api.WorkflowStatus.valueOf(workflowstatus));\n+\n+                workflow.setCreatedTime(rs.getTimestamp(\"WF_CREATED_TIME\").toString());\n+                workflow.setUpdatedTime(rs.getTimestamp(\"WF_UPDATED_TIME\").toString());\n+\n+                workflow.setWorkflowStatusDesc(rs.getString(\"WF_STATUS_DESC\"));\n+                workflow.setTenantId(rs.getInt(\"TENANT_ID\"));\n+                workflow.setTenantDomain(rs.getString(\"TENANT_DOMAIN\"));\n+                workflow.setExternalWorkflowReference(rs.getString(\"WF_EXTERNAL_REFERENCE\"));\n+                workflow.setWorkflowDescription(rs.getString(\"WF_STATUS_DESC\"));\n+                Blob blob = rs.getBlob(\"WF_METADATA\");\n+                Blob blob1 = rs.getBlob(\"WF_PROPERTIES\");\n+\n+\n+                byte[] byteData;\n+\n+                if(blob != null) {\n+                    byteData = blob.getBytes(1L, (int) blob.length());\n+                    InputStream targetStream = new ByteArrayInputStream(byteData);\n+                    String data = APIMgtDBUtil.getStringFromInputStream(targetStream);\n+                    Gson g = new Gson();\n+\n+                    JSONObject json = g.fromJson(data, JSONObject.class);\n+                    workflow.setMetadata(json);\n+                }\n+                else{\n+                    JSONObject json = new JSONObject();\n+                    workflow.setMetadata(json);\n+                }\n+\n+                byte[] byteData1;\n+\n+                if(blob1 != null) {\n+                    byteData1 = blob1.getBytes(1L, (int) blob.length());\n+                    InputStream targetStream1 = new ByteArrayInputStream(byteData1);\n+                    String data1 = APIMgtDBUtil.getStringFromInputStream(targetStream1);\n+                    Gson g = new Gson();\n+\n+                    JSONObject json = g.fromJson(data1, JSONObject.class);\n+                    workflow.setProperties(json);\n+                }\n+                else{\n+                    JSONObject json = new JSONObject();\n+                    workflow.setProperties(json);\n+                }\n+\n+                workflowsList.add(workflow);\n+            }\n+            workflows = workflowsList.toArray(new Workflow[workflowsList.size()]);\n+        } catch (SQLException e) {\n+            handleException(\"Error when retrieve all the workflow details\" , e);\n+        } finally {\n+            APIMgtDBUtil.closeAllConnections(prepStmt, connection, rs);\n+        }\n+        return workflows;\n+\n+    }\n+\n+    public Workflow getworkflowReferenceByExternalWorkflowReferenceID(String externelWorkflowRef, String status , String tenantDomain) throws APIManagementException {\n+\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+        ResultSet rs = null;\n+\n+        Workflow workflow=new Workflow();\n+\n+        String sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAIL_REFER_BY_EXTERNALWORKFLOWREFERENCE;\n+\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            prepStmt = connection.prepareStatement(sqlQuery);\n+            prepStmt.setString(1, externelWorkflowRef);\n+            prepStmt.setString(2, status);\n+            prepStmt.setString(3, tenantDomain);\n+\n+\n+            rs = prepStmt.executeQuery();\n+\n+\n+\n+            while (rs.next()) {\n+\n+                workflow.setWorkflowId(rs.getInt(\"WF_ID\"));\n+                workflow.setWorkflowReference(rs.getString(\"WF_REFERENCE\"));\n+                workflow.setWorkflowType(rs.getString(\"WF_TYPE\"));\n+\n+                String workflowstatus =rs.getString(\"WF_STATUS\");\n+                workflow.setStatus(org.wso2.carbon.apimgt.api.WorkflowStatus.valueOf(workflowstatus));\n+\n+                workflow.setCreatedTime(rs.getTimestamp(\"WF_CREATED_TIME\").toString());\n+                workflow.setUpdatedTime(rs.getTimestamp(\"WF_UPDATED_TIME\").toString());\n+\n+                workflow.setWorkflowDescription(rs.getString(\"WF_STATUS_DESC\"));\n+                workflow.setTenantId(rs.getInt(\"TENANT_ID\"));\n+                workflow.setTenantDomain(rs.getString(\"TENANT_DOMAIN\"));\n+                workflow.setExternalWorkflowReference(rs.getString(\"WF_EXTERNAL_REFERENCE\"));\n+                Blob blob = rs.getBlob(\"WF_METADATA\");\n+                Blob blob1 = rs.getBlob(\"WF_PROPERTIES\");", "originalCommit": "6e7d63f0cbce7821d881557b6f804ffd9f00caf6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njg2MTM5NQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r386861395", "bodyText": "format", "author": "chamilaadhi", "createdAt": "2020-03-03T08:28:33Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/constants/SQLConstants.java", "diffHunk": "@@ -1869,6 +1869,27 @@\n     public static final String GET_ALL_WORKFLOW_ENTRY_FROM_INTERNAL_REF_SQL =\n             \"SELECT * FROM AM_WORKFLOWS WHERE WF_REFERENCE=? AND WF_TYPE=?\";\n \n+    public static final String ADD_PAYLOAD_SQL =\n+            \" UPDATE AM_WORKFLOWS \" +\n+                    \" SET \" +\n+                    \"   WF_METADATA = ?, \" +\n+                    \"   WF_PROPERTIES = ?, \" +\n+                    \"   WF_STATUS_DESC = ? \" +\n+                    \" WHERE \" +\n+                    \"    WF_EXTERNAL_REFERENCE = ?\";\n+\n+    public static final String DELETE_WORKFLOW_REQUEST_SQL=", "originalCommit": "6e7d63f0cbce7821d881557b6f804ffd9f00caf6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDc5MTIwMw==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r410791203", "bodyText": "fixed with 1be4d86", "author": "SahanHerath", "createdAt": "2020-04-19T01:55:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njg2MTM5NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njg3MTkwNA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r386871904", "bodyText": "format and add method description", "author": "chamilaadhi", "createdAt": "2020-03-03T08:50:05Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/ApiMgtDAO.java", "diffHunk": "@@ -14576,4 +14580,284 @@ public String getUserID(String userName) throws APIManagementException {\n         }\n         return userID;\n     }\n+\n+\n+    public void deleteWorkflowRequest(String workflowExtRef) throws APIManagementException {\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+\n+        String query = SQLConstants.DELETE_WORKFLOW_REQUEST_SQL;\n+        try {\n+\n+            connection = APIMgtDBUtil.getConnection();\n+            connection.setAutoCommit(false);\n+\n+\n+            prepStmt = connection.prepareStatement(query);\n+            prepStmt.setString(1, workflowExtRef);\n+            prepStmt.executeUpdate();\n+            connection.commit();\n+        }\n+        catch (SQLException e) {\n+            handleException(\"Failed to delete the workflow request \", e);\n+\n+        }\n+    }\n+\n+    public Workflow getworkflowReferenceByEWR(String externalWorkflowRef)throws APIManagementException {\n+\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+        ResultSet rs = null;\n+\n+\n+        Workflow workflow=new Workflow();\n+\n+        String sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS_BY_EWR;\n+\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            prepStmt = connection.prepareStatement(sqlQuery);\n+            prepStmt.setString(1, externalWorkflowRef);\n+\n+\n+            rs = prepStmt.executeQuery();\n+\n+\n+\n+\n+            while (rs.next()) {\n+\n+                workflow.setWorkflowId(rs.getInt(\"WF_ID\"));\n+                workflow.setWorkflowReference(rs.getString(\"WF_REFERENCE\"));\n+                workflow.setWorkflowType(rs.getString(\"WF_TYPE\"));\n+\n+                String workflowstatus =rs.getString(\"WF_STATUS\");\n+                workflow.setStatus(org.wso2.carbon.apimgt.api.WorkflowStatus.valueOf(workflowstatus));\n+\n+                workflow.setCreatedTime(rs.getTimestamp(\"WF_CREATED_TIME\").toString());\n+                workflow.setUpdatedTime(rs.getTimestamp(\"WF_UPDATED_TIME\").toString());\n+\n+                workflow.setWorkflowStatusDesc(rs.getString(\"WF_STATUS_DESC\"));\n+                workflow.setTenantId(rs.getInt(\"TENANT_ID\"));\n+                workflow.setTenantDomain(rs.getString(\"TENANT_DOMAIN\"));\n+                workflow.setExternalWorkflowReference(rs.getString(\"WF_EXTERNAL_REFERENCE\"));\n+                Blob blob = rs.getBlob(\"WF_METADATA\");\n+\n+                byte[] byteData;\n+\n+                if(blob != null) {\n+                    byteData = blob.getBytes(1L, (int) blob.length());\n+                    InputStream targetStream = new ByteArrayInputStream(byteData);\n+                    String data = APIMgtDBUtil.getStringFromInputStream(targetStream);\n+                    Gson g = new Gson();\n+\n+                    JSONObject json = g.fromJson(data, JSONObject.class);\n+                    workflow.setMetadata(json);\n+                }\n+                else{\n+                    JSONObject json=new JSONObject();\n+                    workflow.setMetadata(json);\n+                }\n+\n+\n+\n+            }\n+\n+        } catch (SQLException e) {\n+            handleException(\"Error when retriving the workflow details\" , e);\n+        } finally {\n+            APIMgtDBUtil.closeAllConnections(prepStmt, connection, rs);\n+        }\n+        return workflow;\n+    }\n+\n+    public Workflow[] getworkflows(String workflowType ,String status ,String tenantDomain) throws APIManagementException {\n+\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+        ResultSet rs = null;\n+\n+        Workflow[] workflows = null;\n+\n+        String sqlQuery;\n+\n+        if (workflowType != null){\n+            sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS;\n+        }\n+        else{\n+            sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS_NO_TYPE;\n+        }\n+\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            prepStmt = connection.prepareStatement(sqlQuery);\n+\n+            if (workflowType != null){\n+                prepStmt.setString(1, workflowType);\n+                prepStmt.setString( 2, status);\n+                prepStmt.setString( 3, tenantDomain);\n+\n+            }\n+            else{\n+                prepStmt.setString( 1, status);\n+                prepStmt.setString( 2, tenantDomain);\n+            }\n+\n+\n+\n+\n+            rs = prepStmt.executeQuery();\n+\n+            ArrayList<Workflow> workflowsList = new ArrayList<Workflow>();\n+            Workflow workflow;\n+            while (rs.next()) {\n+                workflow = new Workflow();\n+                workflow.setWorkflowId(rs.getInt(\"WF_ID\"));\n+                workflow.setWorkflowReference(rs.getString(\"WF_REFERENCE\"));\n+                workflow.setWorkflowType(rs.getString(\"WF_TYPE\"));\n+\n+                String workflowstatus =rs.getString(\"WF_STATUS\");\n+                workflow.setStatus(org.wso2.carbon.apimgt.api.WorkflowStatus.valueOf(workflowstatus));\n+\n+                workflow.setCreatedTime(rs.getTimestamp(\"WF_CREATED_TIME\").toString());\n+                workflow.setUpdatedTime(rs.getTimestamp(\"WF_UPDATED_TIME\").toString());\n+\n+                workflow.setWorkflowStatusDesc(rs.getString(\"WF_STATUS_DESC\"));\n+                workflow.setTenantId(rs.getInt(\"TENANT_ID\"));\n+                workflow.setTenantDomain(rs.getString(\"TENANT_DOMAIN\"));\n+                workflow.setExternalWorkflowReference(rs.getString(\"WF_EXTERNAL_REFERENCE\"));\n+                workflow.setWorkflowDescription(rs.getString(\"WF_STATUS_DESC\"));\n+                Blob blob = rs.getBlob(\"WF_METADATA\");\n+                Blob blob1 = rs.getBlob(\"WF_PROPERTIES\");\n+\n+\n+                byte[] byteData;\n+\n+                if(blob != null) {\n+                    byteData = blob.getBytes(1L, (int) blob.length());\n+                    InputStream targetStream = new ByteArrayInputStream(byteData);\n+                    String data = APIMgtDBUtil.getStringFromInputStream(targetStream);\n+                    Gson g = new Gson();\n+\n+                    JSONObject json = g.fromJson(data, JSONObject.class);\n+                    workflow.setMetadata(json);\n+                }\n+                else{\n+                    JSONObject json = new JSONObject();\n+                    workflow.setMetadata(json);\n+                }\n+\n+                byte[] byteData1;\n+\n+                if(blob1 != null) {\n+                    byteData1 = blob1.getBytes(1L, (int) blob.length());\n+                    InputStream targetStream1 = new ByteArrayInputStream(byteData1);\n+                    String data1 = APIMgtDBUtil.getStringFromInputStream(targetStream1);\n+                    Gson g = new Gson();\n+\n+                    JSONObject json = g.fromJson(data1, JSONObject.class);\n+                    workflow.setProperties(json);\n+                }\n+                else{\n+                    JSONObject json = new JSONObject();\n+                    workflow.setProperties(json);\n+                }\n+\n+                workflowsList.add(workflow);\n+            }\n+            workflows = workflowsList.toArray(new Workflow[workflowsList.size()]);\n+        } catch (SQLException e) {\n+            handleException(\"Error when retrieve all the workflow details\" , e);\n+        } finally {\n+            APIMgtDBUtil.closeAllConnections(prepStmt, connection, rs);\n+        }\n+        return workflows;\n+\n+    }\n+\n+    public Workflow getworkflowReferenceByExternalWorkflowReferenceID(String externelWorkflowRef, String status , String tenantDomain) throws APIManagementException {\n+", "originalCommit": "6e7d63f0cbce7821d881557b6f804ffd9f00caf6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzYwMDgxMw==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r387600813", "bodyText": "fixed with 1be4d86", "author": "SahanHerath", "createdAt": "2020-03-04T11:15:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njg3MTkwNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njg3MzgxMg==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r386873812", "bodyText": "lets rename to GET_ALL_WORKFLOW_DETAILS_BY_EXTERNAL_WORKFLOW_REFERENCE", "author": "chamilaadhi", "createdAt": "2020-03-03T08:53:46Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/constants/SQLConstants.java", "diffHunk": "@@ -1869,6 +1869,27 @@\n     public static final String GET_ALL_WORKFLOW_ENTRY_FROM_INTERNAL_REF_SQL =\n             \"SELECT * FROM AM_WORKFLOWS WHERE WF_REFERENCE=? AND WF_TYPE=?\";\n \n+    public static final String ADD_PAYLOAD_SQL =\n+            \" UPDATE AM_WORKFLOWS \" +\n+                    \" SET \" +\n+                    \"   WF_METADATA = ?, \" +\n+                    \"   WF_PROPERTIES = ?, \" +\n+                    \"   WF_STATUS_DESC = ? \" +\n+                    \" WHERE \" +\n+                    \"    WF_EXTERNAL_REFERENCE = ?\";\n+\n+    public static final String DELETE_WORKFLOW_REQUEST_SQL=\n+            \" DELETE FROM AM_WORKFLOWS WHERE WF_EXTERNAL_REFERENCE = ?\";\n+\n+    public static final String GET_ALL_WORKFLOW_DETAILS_BY_EWR = \"SELECT  * FROM AM_WORKFLOWS WHERE WF_EXTERNAL_REFERENCE = ?\";\n+\n+    public static final String GET_ALL_WORKFLOW_DETAILS = \"SELECT  * FROM AM_WORKFLOWS WHERE WF_TYPE = ? AND  WF_STATUS = ? AND TENANT_DOMAIN = ?\";\n+\n+    public static final String GET_ALL_WORKFLOW_DETAILS_NO_TYPE = \"SELECT  * FROM AM_WORKFLOWS WHERE WF_STATUS = ? AND TENANT_DOMAIN = ?\";\n+\n+\n+    public static final String GET_ALL_WORKFLOW_DETAIL_REFER_BY_EXTERNALWORKFLOWREFERENCE = \"SELECT  * FROM AM_WORKFLOWS WHERE WF_EXTERNAL_REFERENCE = ? AND WF_STATUS = ? AND TENANT_DOMAIN = ?\";", "originalCommit": "6e7d63f0cbce7821d881557b6f804ffd9f00caf6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njg3NDAxMA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r386874010", "bodyText": "not clear enough (meaning)", "author": "chamilaadhi", "createdAt": "2020-03-03T08:54:09Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/constants/SQLConstants.java", "diffHunk": "@@ -1869,6 +1869,27 @@\n     public static final String GET_ALL_WORKFLOW_ENTRY_FROM_INTERNAL_REF_SQL =\n             \"SELECT * FROM AM_WORKFLOWS WHERE WF_REFERENCE=? AND WF_TYPE=?\";\n \n+    public static final String ADD_PAYLOAD_SQL =\n+            \" UPDATE AM_WORKFLOWS \" +\n+                    \" SET \" +\n+                    \"   WF_METADATA = ?, \" +\n+                    \"   WF_PROPERTIES = ?, \" +\n+                    \"   WF_STATUS_DESC = ? \" +\n+                    \" WHERE \" +\n+                    \"    WF_EXTERNAL_REFERENCE = ?\";\n+\n+    public static final String DELETE_WORKFLOW_REQUEST_SQL=\n+            \" DELETE FROM AM_WORKFLOWS WHERE WF_EXTERNAL_REFERENCE = ?\";\n+\n+    public static final String GET_ALL_WORKFLOW_DETAILS_BY_EWR = \"SELECT  * FROM AM_WORKFLOWS WHERE WF_EXTERNAL_REFERENCE = ?\";\n+\n+    public static final String GET_ALL_WORKFLOW_DETAILS = \"SELECT  * FROM AM_WORKFLOWS WHERE WF_TYPE = ? AND  WF_STATUS = ? AND TENANT_DOMAIN = ?\";\n+\n+    public static final String GET_ALL_WORKFLOW_DETAILS_NO_TYPE = \"SELECT  * FROM AM_WORKFLOWS WHERE WF_STATUS = ? AND TENANT_DOMAIN = ?\";", "originalCommit": "6e7d63f0cbce7821d881557b6f804ffd9f00caf6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njg3NDE2Mw==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r386874163", "bodyText": "format and remove space", "author": "chamilaadhi", "createdAt": "2020-03-03T08:54:28Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dto/WorkflowDTO.java", "diffHunk": "@@ -56,7 +57,26 @@\n     private String externalWorkflowReference;\n \n     private String callbackUrl;\n-    \n+\n+    private JSONObject metadata;\n+\n+    private JSONObject properties;\n+\n+    public WorkflowDTO(){\n+        metadata =new JSONObject();\n+        properties =new JSONObject();\n+    }\n+", "originalCommit": "6e7d63f0cbce7821d881557b6f804ffd9f00caf6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjc2NDY3MQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r406764671", "bodyText": "fixed with 1be4d86", "author": "SahanHerath", "createdAt": "2020-04-10T13:47:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njg3NDE2Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njg3NDQyMQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r386874421", "bodyText": "this is not needed", "author": "chamilaadhi", "createdAt": "2020-03-03T08:54:55Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/workflow/APIStateChangeApprovalWorkflowExecutor.java", "diffHunk": "@@ -0,0 +1,233 @@\n+package org.wso2.carbon.apimgt.impl.workflow;\n+\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+import org.wso2.carbon.apimgt.api.APIManagementException;\n+import org.wso2.carbon.apimgt.api.WorkflowResponse;\n+import org.wso2.carbon.apimgt.api.model.APIIdentifier;\n+import org.wso2.carbon.apimgt.api.model.Workflow;\n+import org.wso2.carbon.apimgt.impl.APIConstants;\n+import org.wso2.carbon.apimgt.impl.dao.ApiMgtDAO;\n+import org.wso2.carbon.apimgt.impl.dto.WorkflowDTO;\n+import org.wso2.carbon.apimgt.impl.internal.ServiceReferenceHolder;\n+import org.wso2.carbon.apimgt.impl.utils.APIUtil;\n+import org.wso2.carbon.context.PrivilegedCarbonContext;\n+import org.wso2.carbon.governance.api.generic.dataobjects.GenericArtifact;\n+import org.wso2.carbon.registry.core.Registry;\n+import org.wso2.carbon.registry.core.exceptions.RegistryException;\n+\n+import java.util.*;\n+\n+public class APIStateChangeApprovalWorkflowExecutor extends WorkflowExecutor{\n+\n+    private static final String RUNTIME_INSTANCE_RESOURCE_PATH = \"/runtime/process-instances\";", "originalCommit": "6e7d63f0cbce7821d881557b6f804ffd9f00caf6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzYwMDQ5NA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r387600494", "bodyText": "fixed with 1be4d86", "author": "SahanHerath", "createdAt": "2020-03-04T11:14:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njg3NDQyMQ=="}], "type": "inlineReview"}, {"oid": "63aac0ce60d89723bf51b15c7f9f35b420b3e7cc", "url": "https://github.com/wso2/carbon-apimgt/commit/63aac0ce60d89723bf51b15c7f9f35b420b3e7cc", "message": "Added workflowExecutors for ApprovalWorkflowExecutor and two rest APIs.", "committedDate": "2020-04-01T07:02:11Z", "type": "commit"}, {"oid": "e5f1ca8c0c731ff296553a3776fe7937da125395", "url": "https://github.com/wso2/carbon-apimgt/commit/e5f1ca8c0c731ff296553a3776fe7937da125395", "message": "Reformatted workflowExecutors for ApprovalWorkflowExecutor and two rest APIs", "committedDate": "2020-04-01T07:02:12Z", "type": "commit"}, {"oid": "8b030289aca2777f2d9be37fd3330df4e6ce1002", "url": "https://github.com/wso2/carbon-apimgt/commit/8b030289aca2777f2d9be37fd3330df4e6ce1002", "message": "Added database changes to the sql files", "committedDate": "2020-04-01T07:02:12Z", "type": "commit"}, {"oid": "31f6f67b8a13bf657c46f4e2f9730d7b472c9b72", "url": "https://github.com/wso2/carbon-apimgt/commit/31f6f67b8a13bf657c46f4e2f9730d7b472c9b72", "message": "Added workflowExecutors for ApprovalWorkflowExecutor and two rest APIs.", "committedDate": "2020-04-01T07:28:36Z", "type": "commit"}, {"oid": "63814cb85271ac3852fd12470cc7a81669d844ca", "url": "https://github.com/wso2/carbon-apimgt/commit/63814cb85271ac3852fd12470cc7a81669d844ca", "message": "Changes in the workflow executors", "committedDate": "2020-04-01T07:28:37Z", "type": "commit"}, {"oid": "63814cb85271ac3852fd12470cc7a81669d844ca", "url": "https://github.com/wso2/carbon-apimgt/commit/63814cb85271ac3852fd12470cc7a81669d844ca", "message": "Changes in the workflow executors", "committedDate": "2020-04-01T07:28:37Z", "type": "forcePushed"}, {"oid": "6bf3e5572d4f5d21b3b4f4cb596a1eeea3348002", "url": "https://github.com/wso2/carbon-apimgt/commit/6bf3e5572d4f5d21b3b4f4cb596a1eeea3348002", "message": "Changes in add workflow entry ApiMgtDAO.java", "committedDate": "2020-04-03T05:48:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYxNjkxMQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r406616911", "bodyText": "Missing license header", "author": "chamilaadhi", "createdAt": "2020-04-10T06:06:36Z", "path": "components/apimgt/org.wso2.carbon.apimgt.api/src/main/java/org/wso2/carbon/apimgt/api/model/Workflow.java", "diffHunk": "@@ -0,0 +1,188 @@\n+package org.wso2.carbon.apimgt.api.model;", "originalCommit": "6bf3e5572d4f5d21b3b4f4cb596a1eeea3348002", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDc5MTQzNg==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r410791436", "bodyText": "fixed with e00fe40", "author": "SahanHerath", "createdAt": "2020-04-19T01:57:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYxNjkxMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDc5NjgxOA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r410796818", "bodyText": "changed year with 3719d98", "author": "SahanHerath", "createdAt": "2020-04-19T02:37:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYxNjkxMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYxODE5MA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r406618190", "bodyText": "seems like this method is still not formated. please format every new method you include. Ex: there is no space between '=', I can see some other issues as well", "author": "chamilaadhi", "createdAt": "2020-04-10T06:12:04Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/APIAdminImpl.java", "diffHunk": "@@ -349,4 +346,22 @@ private int isCategoryAttached(APICategory category, String username) throws API\n         int length = (Integer) result.get(\"length\");\n         return length;\n     }\n+\n+    public Workflow[] getworkflows(String workflowType, String status, String tenantDomain ) throws APIManagementException {\n+\n+        return apiMgtDAO.getworkflows(workflowType, status , tenantDomain );\n+    }\n+\n+    public Workflow getworkflowReferenceByExternalWorkflowReferenceID(String externelWorkflowRef, String status,\n+                                                                      String tenantDomain) throws APIManagementException {\n+\n+        Workflow workflow=apiMgtDAO.getworkflowReferenceByExternalWorkflowReferenceID(externelWorkflowRef, status ,tenantDomain );\n+\n+        if (workflow == null) {\n+            String msg=\"External workflow Reference: \" + externelWorkflowRef + \" was not found.\";\n+            throw new APIMgtResourceNotFoundException(msg);\n+        }\n+", "originalCommit": "6bf3e5572d4f5d21b3b4f4cb596a1eeea3348002", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYxODIzMA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r406618230", "bodyText": "format", "author": "chamilaadhi", "createdAt": "2020-04-10T06:12:16Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/APIAdminImpl.java", "diffHunk": "@@ -349,4 +346,22 @@ private int isCategoryAttached(APICategory category, String username) throws API\n         int length = (Integer) result.get(\"length\");\n         return length;\n     }\n+\n+    public Workflow[] getworkflows(String workflowType, String status, String tenantDomain ) throws APIManagementException {\n+\n+        return apiMgtDAO.getworkflows(workflowType, status , tenantDomain );", "originalCommit": "6bf3e5572d4f5d21b3b4f4cb596a1eeea3348002", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYxODMyMw==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r406618323", "bodyText": "format", "author": "chamilaadhi", "createdAt": "2020-04-10T06:12:38Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/ApiMgtDAO.java", "diffHunk": "@@ -5937,10 +5934,24 @@ public void addWorkflowEntry(WorkflowDTO workflow) throws APIManagementException\n             prepStmt.setString(7, workflow.getTenantDomain());\n             prepStmt.setString(8, workflow.getExternalWorkflowReference());\n \n+            if(workflow.getMetadata()!=null){\n+                byte[] metadataByte = workflow.getMetadata().toJSONString().getBytes(\"UTF-8\");", "originalCommit": "6bf3e5572d4f5d21b3b4f4cb596a1eeea3348002", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDc5MTc2Mg==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r410791762", "bodyText": "fixed with e00fe40", "author": "SahanHerath", "createdAt": "2020-04-19T01:59:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYxODMyMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYxODg0OQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r406618849", "bodyText": "close the db connection once finished\nfinally {\nAPIMgtDBUtil.closeAllConnections(ps, conn, resultSet);\n}", "author": "chamilaadhi", "createdAt": "2020-04-10T06:14:52Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/ApiMgtDAO.java", "diffHunk": "@@ -14610,4 +14621,284 @@ public String getUserID(String userName) throws APIManagementException {\n         }\n         return list;\n     }\n+\n+    /**\n+     * Remove the Pending workflow Requests using ExternalWorkflowReference\n+     *\n+     * @param workflowExtRef\n+     * @return\n+     */\n+\n+    public void deleteWorkflowRequest(String workflowExtRef) throws APIManagementException {\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+\n+        String query = SQLConstants.DELETE_WORKFLOW_REQUEST_SQL;\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            connection.setAutoCommit(false);\n+\n+            prepStmt = connection.prepareStatement(query);\n+            prepStmt.setString(1, workflowExtRef);\n+            prepStmt.executeUpdate();\n+            connection.commit();\n+        }\n+        catch (SQLException e) {\n+            handleException(\"Failed to delete the workflow request \", e);\n+        }", "originalCommit": "6bf3e5572d4f5d21b3b4f4cb596a1eeea3348002", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDc5MTc4Mw==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r410791783", "bodyText": "fixed with e00fe40", "author": "SahanHerath", "createdAt": "2020-04-19T01:59:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYxODg0OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYxOTA1OQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r406619059", "bodyText": "add missing docs", "author": "chamilaadhi", "createdAt": "2020-04-10T06:15:48Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/ApiMgtDAO.java", "diffHunk": "@@ -14610,4 +14621,284 @@ public String getUserID(String userName) throws APIManagementException {\n         }\n         return list;\n     }\n+\n+    /**\n+     * Remove the Pending workflow Requests using ExternalWorkflowReference\n+     *\n+     * @param workflowExtRef", "originalCommit": "6bf3e5572d4f5d21b3b4f4cb596a1eeea3348002", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYxOTE3MQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r406619171", "bodyText": "add missing docs", "author": "chamilaadhi", "createdAt": "2020-04-10T06:16:20Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/ApiMgtDAO.java", "diffHunk": "@@ -14610,4 +14621,284 @@ public String getUserID(String userName) throws APIManagementException {\n         }\n         return list;\n     }\n+\n+    /**\n+     * Remove the Pending workflow Requests using ExternalWorkflowReference\n+     *\n+     * @param workflowExtRef\n+     * @return\n+     */\n+\n+    public void deleteWorkflowRequest(String workflowExtRef) throws APIManagementException {\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+\n+        String query = SQLConstants.DELETE_WORKFLOW_REQUEST_SQL;\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            connection.setAutoCommit(false);\n+\n+            prepStmt = connection.prepareStatement(query);\n+            prepStmt.setString(1, workflowExtRef);\n+            prepStmt.executeUpdate();\n+            connection.commit();\n+        }\n+        catch (SQLException e) {\n+            handleException(\"Failed to delete the workflow request \", e);\n+        }\n+    }\n+\n+    /**\n+     * Get the Pending workflow Request using ExternalWorkflowReference\n+     *\n+     * @param externalWorkflowRef\n+     * @return\n+     */", "originalCommit": "6bf3e5572d4f5d21b3b4f4cb596a1eeea3348002", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDc5MTg0Nw==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r410791847", "bodyText": "fixed with e00fe40", "author": "SahanHerath", "createdAt": "2020-04-19T02:00:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYxOTE3MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYxOTI2Mg==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r406619262", "bodyText": "format", "author": "chamilaadhi", "createdAt": "2020-04-10T06:16:49Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/ApiMgtDAO.java", "diffHunk": "@@ -14610,4 +14621,284 @@ public String getUserID(String userName) throws APIManagementException {\n         }\n         return list;\n     }\n+\n+    /**\n+     * Remove the Pending workflow Requests using ExternalWorkflowReference\n+     *\n+     * @param workflowExtRef\n+     * @return\n+     */\n+\n+    public void deleteWorkflowRequest(String workflowExtRef) throws APIManagementException {\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+\n+        String query = SQLConstants.DELETE_WORKFLOW_REQUEST_SQL;\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            connection.setAutoCommit(false);\n+\n+            prepStmt = connection.prepareStatement(query);\n+            prepStmt.setString(1, workflowExtRef);\n+            prepStmt.executeUpdate();\n+            connection.commit();\n+        }\n+        catch (SQLException e) {\n+            handleException(\"Failed to delete the workflow request \", e);\n+        }\n+    }\n+\n+    /**\n+     * Get the Pending workflow Request using ExternalWorkflowReference\n+     *\n+     * @param externalWorkflowRef\n+     * @return\n+     */\n+\n+    public Workflow getworkflowReferenceByExternalWorkflowReference(String externalWorkflowRef)throws APIManagementException {", "originalCommit": "6bf3e5572d4f5d21b3b4f4cb596a1eeea3348002", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDc5MTg4Nw==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r410791887", "bodyText": "fixed with e00fe40", "author": "SahanHerath", "createdAt": "2020-04-19T02:00:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYxOTI2Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYxOTM5Nw==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r406619397", "bodyText": "format", "author": "chamilaadhi", "createdAt": "2020-04-10T06:17:28Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/ApiMgtDAO.java", "diffHunk": "@@ -14610,4 +14621,284 @@ public String getUserID(String userName) throws APIManagementException {\n         }\n         return list;\n     }\n+\n+    /**\n+     * Remove the Pending workflow Requests using ExternalWorkflowReference\n+     *\n+     * @param workflowExtRef\n+     * @return\n+     */\n+\n+    public void deleteWorkflowRequest(String workflowExtRef) throws APIManagementException {\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+\n+        String query = SQLConstants.DELETE_WORKFLOW_REQUEST_SQL;\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            connection.setAutoCommit(false);\n+\n+            prepStmt = connection.prepareStatement(query);\n+            prepStmt.setString(1, workflowExtRef);\n+            prepStmt.executeUpdate();\n+            connection.commit();\n+        }\n+        catch (SQLException e) {\n+            handleException(\"Failed to delete the workflow request \", e);\n+        }\n+    }\n+\n+    /**\n+     * Get the Pending workflow Request using ExternalWorkflowReference\n+     *\n+     * @param externalWorkflowRef\n+     * @return\n+     */\n+\n+    public Workflow getworkflowReferenceByExternalWorkflowReference(String externalWorkflowRef)throws APIManagementException {\n+\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+        ResultSet rs = null;\n+\n+        Workflow workflow=new Workflow();", "originalCommit": "6bf3e5572d4f5d21b3b4f4cb596a1eeea3348002", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYxOTYwMw==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r406619603", "bodyText": "EWR?? please use a readable parameters", "author": "chamilaadhi", "createdAt": "2020-04-10T06:18:18Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/ApiMgtDAO.java", "diffHunk": "@@ -14610,4 +14621,284 @@ public String getUserID(String userName) throws APIManagementException {\n         }\n         return list;\n     }\n+\n+    /**\n+     * Remove the Pending workflow Requests using ExternalWorkflowReference\n+     *\n+     * @param workflowExtRef\n+     * @return\n+     */\n+\n+    public void deleteWorkflowRequest(String workflowExtRef) throws APIManagementException {\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+\n+        String query = SQLConstants.DELETE_WORKFLOW_REQUEST_SQL;\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            connection.setAutoCommit(false);\n+\n+            prepStmt = connection.prepareStatement(query);\n+            prepStmt.setString(1, workflowExtRef);\n+            prepStmt.executeUpdate();\n+            connection.commit();\n+        }\n+        catch (SQLException e) {\n+            handleException(\"Failed to delete the workflow request \", e);\n+        }\n+    }\n+\n+    /**\n+     * Get the Pending workflow Request using ExternalWorkflowReference\n+     *\n+     * @param externalWorkflowRef\n+     * @return\n+     */\n+\n+    public Workflow getworkflowReferenceByExternalWorkflowReference(String externalWorkflowRef)throws APIManagementException {\n+\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+        ResultSet rs = null;\n+\n+        Workflow workflow=new Workflow();\n+\n+        String sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS_BY_EWR;", "originalCommit": "6bf3e5572d4f5d21b3b4f4cb596a1eeea3348002", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYxOTgzOQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r406619839", "bodyText": "remove unnecessary gaps between each statement", "author": "chamilaadhi", "createdAt": "2020-04-10T06:19:02Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/ApiMgtDAO.java", "diffHunk": "@@ -14610,4 +14621,284 @@ public String getUserID(String userName) throws APIManagementException {\n         }\n         return list;\n     }\n+\n+    /**\n+     * Remove the Pending workflow Requests using ExternalWorkflowReference\n+     *\n+     * @param workflowExtRef\n+     * @return\n+     */\n+\n+    public void deleteWorkflowRequest(String workflowExtRef) throws APIManagementException {\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+\n+        String query = SQLConstants.DELETE_WORKFLOW_REQUEST_SQL;\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            connection.setAutoCommit(false);\n+\n+            prepStmt = connection.prepareStatement(query);\n+            prepStmt.setString(1, workflowExtRef);\n+            prepStmt.executeUpdate();\n+            connection.commit();\n+        }\n+        catch (SQLException e) {\n+            handleException(\"Failed to delete the workflow request \", e);\n+        }\n+    }\n+\n+    /**\n+     * Get the Pending workflow Request using ExternalWorkflowReference\n+     *\n+     * @param externalWorkflowRef\n+     * @return\n+     */\n+\n+    public Workflow getworkflowReferenceByExternalWorkflowReference(String externalWorkflowRef)throws APIManagementException {\n+\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+        ResultSet rs = null;\n+\n+        Workflow workflow=new Workflow();\n+\n+        String sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS_BY_EWR;\n+\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            prepStmt = connection.prepareStatement(sqlQuery);\n+            prepStmt.setString(1, externalWorkflowRef);\n+\n+            rs = prepStmt.executeQuery();\n+\n+            while (rs.next()) {\n+\n+                workflow.setWorkflowId(rs.getInt(\"WF_ID\"));\n+                workflow.setWorkflowReference(rs.getString(\"WF_REFERENCE\"));\n+                workflow.setWorkflowType(rs.getString(\"WF_TYPE\"));\n+\n+                String workflowstatus =rs.getString(\"WF_STATUS\");\n+                workflow.setStatus(org.wso2.carbon.apimgt.api.WorkflowStatus.valueOf(workflowstatus));\n+\n+                workflow.setCreatedTime(rs.getTimestamp(\"WF_CREATED_TIME\").toString());\n+                workflow.setUpdatedTime(rs.getTimestamp(\"WF_UPDATED_TIME\").toString());\n+\n+                workflow.setWorkflowStatusDesc(rs.getString(\"WF_STATUS_DESC\"));\n+                workflow.setTenantId(rs.getInt(\"TENANT_ID\"));\n+                workflow.setTenantDomain(rs.getString(\"TENANT_DOMAIN\"));\n+                workflow.setExternalWorkflowReference(rs.getString(\"WF_EXTERNAL_REFERENCE\"));\n+                Blob metadatablob = rs.getBlob(\"WF_METADATA\");\n+", "originalCommit": "6bf3e5572d4f5d21b3b4f4cb596a1eeea3348002", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDc5MjAwMQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r410792001", "bodyText": "fixed with e00fe40", "author": "SahanHerath", "createdAt": "2020-04-19T02:01:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYxOTgzOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYxOTk0OQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r406619949", "bodyText": "format", "author": "chamilaadhi", "createdAt": "2020-04-10T06:19:33Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/ApiMgtDAO.java", "diffHunk": "@@ -14610,4 +14621,284 @@ public String getUserID(String userName) throws APIManagementException {\n         }\n         return list;\n     }\n+\n+    /**\n+     * Remove the Pending workflow Requests using ExternalWorkflowReference\n+     *\n+     * @param workflowExtRef\n+     * @return\n+     */\n+\n+    public void deleteWorkflowRequest(String workflowExtRef) throws APIManagementException {\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+\n+        String query = SQLConstants.DELETE_WORKFLOW_REQUEST_SQL;\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            connection.setAutoCommit(false);\n+\n+            prepStmt = connection.prepareStatement(query);\n+            prepStmt.setString(1, workflowExtRef);\n+            prepStmt.executeUpdate();\n+            connection.commit();\n+        }\n+        catch (SQLException e) {\n+            handleException(\"Failed to delete the workflow request \", e);\n+        }\n+    }\n+\n+    /**\n+     * Get the Pending workflow Request using ExternalWorkflowReference\n+     *\n+     * @param externalWorkflowRef\n+     * @return\n+     */\n+\n+    public Workflow getworkflowReferenceByExternalWorkflowReference(String externalWorkflowRef)throws APIManagementException {\n+\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+        ResultSet rs = null;\n+\n+        Workflow workflow=new Workflow();\n+\n+        String sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS_BY_EWR;\n+\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            prepStmt = connection.prepareStatement(sqlQuery);\n+            prepStmt.setString(1, externalWorkflowRef);\n+\n+            rs = prepStmt.executeQuery();\n+\n+            while (rs.next()) {\n+\n+                workflow.setWorkflowId(rs.getInt(\"WF_ID\"));\n+                workflow.setWorkflowReference(rs.getString(\"WF_REFERENCE\"));\n+                workflow.setWorkflowType(rs.getString(\"WF_TYPE\"));\n+\n+                String workflowstatus =rs.getString(\"WF_STATUS\");", "originalCommit": "6bf3e5572d4f5d21b3b4f4cb596a1eeea3348002", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDc5MjA4Mg==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r410792082", "bodyText": "fixed with e00fe40", "author": "SahanHerath", "createdAt": "2020-04-19T02:01:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYxOTk0OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyMDAzNg==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r406620036", "bodyText": "format", "author": "chamilaadhi", "createdAt": "2020-04-10T06:19:57Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/ApiMgtDAO.java", "diffHunk": "@@ -14610,4 +14621,284 @@ public String getUserID(String userName) throws APIManagementException {\n         }\n         return list;\n     }\n+\n+    /**\n+     * Remove the Pending workflow Requests using ExternalWorkflowReference\n+     *\n+     * @param workflowExtRef\n+     * @return\n+     */\n+\n+    public void deleteWorkflowRequest(String workflowExtRef) throws APIManagementException {\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+\n+        String query = SQLConstants.DELETE_WORKFLOW_REQUEST_SQL;\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            connection.setAutoCommit(false);\n+\n+            prepStmt = connection.prepareStatement(query);\n+            prepStmt.setString(1, workflowExtRef);\n+            prepStmt.executeUpdate();\n+            connection.commit();\n+        }\n+        catch (SQLException e) {\n+            handleException(\"Failed to delete the workflow request \", e);\n+        }\n+    }\n+\n+    /**\n+     * Get the Pending workflow Request using ExternalWorkflowReference\n+     *\n+     * @param externalWorkflowRef\n+     * @return\n+     */\n+\n+    public Workflow getworkflowReferenceByExternalWorkflowReference(String externalWorkflowRef)throws APIManagementException {\n+\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+        ResultSet rs = null;\n+\n+        Workflow workflow=new Workflow();\n+\n+        String sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS_BY_EWR;\n+\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            prepStmt = connection.prepareStatement(sqlQuery);\n+            prepStmt.setString(1, externalWorkflowRef);\n+\n+            rs = prepStmt.executeQuery();\n+\n+            while (rs.next()) {\n+\n+                workflow.setWorkflowId(rs.getInt(\"WF_ID\"));\n+                workflow.setWorkflowReference(rs.getString(\"WF_REFERENCE\"));\n+                workflow.setWorkflowType(rs.getString(\"WF_TYPE\"));\n+\n+                String workflowstatus =rs.getString(\"WF_STATUS\");\n+                workflow.setStatus(org.wso2.carbon.apimgt.api.WorkflowStatus.valueOf(workflowstatus));\n+\n+                workflow.setCreatedTime(rs.getTimestamp(\"WF_CREATED_TIME\").toString());\n+                workflow.setUpdatedTime(rs.getTimestamp(\"WF_UPDATED_TIME\").toString());\n+\n+                workflow.setWorkflowStatusDesc(rs.getString(\"WF_STATUS_DESC\"));\n+                workflow.setTenantId(rs.getInt(\"TENANT_ID\"));\n+                workflow.setTenantDomain(rs.getString(\"TENANT_DOMAIN\"));\n+                workflow.setExternalWorkflowReference(rs.getString(\"WF_EXTERNAL_REFERENCE\"));\n+                Blob metadatablob = rs.getBlob(\"WF_METADATA\");\n+\n+                byte[] metadataByte;\n+\n+                if(metadatablob != null) {\n+                    metadataByte = metadatablob.getBytes(1L, (int) metadatablob.length());\n+                    InputStream targetStream = new ByteArrayInputStream(metadataByte);\n+                    String metadata = APIMgtDBUtil.getStringFromInputStream(targetStream);\n+                    Gson g = new Gson();\n+                    JSONObject json = g.fromJson(metadata, JSONObject.class);\n+                    workflow.setMetadata(json);\n+                } else {\n+                    JSONObject json=new JSONObject();", "originalCommit": "6bf3e5572d4f5d21b3b4f4cb596a1eeea3348002", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyMDA4Nw==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r406620087", "bodyText": "format", "author": "chamilaadhi", "createdAt": "2020-04-10T06:20:12Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/ApiMgtDAO.java", "diffHunk": "@@ -14610,4 +14621,284 @@ public String getUserID(String userName) throws APIManagementException {\n         }\n         return list;\n     }\n+\n+    /**\n+     * Remove the Pending workflow Requests using ExternalWorkflowReference\n+     *\n+     * @param workflowExtRef\n+     * @return\n+     */\n+\n+    public void deleteWorkflowRequest(String workflowExtRef) throws APIManagementException {\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+\n+        String query = SQLConstants.DELETE_WORKFLOW_REQUEST_SQL;\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            connection.setAutoCommit(false);\n+\n+            prepStmt = connection.prepareStatement(query);\n+            prepStmt.setString(1, workflowExtRef);\n+            prepStmt.executeUpdate();\n+            connection.commit();\n+        }\n+        catch (SQLException e) {\n+            handleException(\"Failed to delete the workflow request \", e);\n+        }\n+    }\n+\n+    /**\n+     * Get the Pending workflow Request using ExternalWorkflowReference\n+     *\n+     * @param externalWorkflowRef\n+     * @return\n+     */\n+\n+    public Workflow getworkflowReferenceByExternalWorkflowReference(String externalWorkflowRef)throws APIManagementException {\n+\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+        ResultSet rs = null;\n+\n+        Workflow workflow=new Workflow();\n+\n+        String sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS_BY_EWR;\n+\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            prepStmt = connection.prepareStatement(sqlQuery);\n+            prepStmt.setString(1, externalWorkflowRef);\n+\n+            rs = prepStmt.executeQuery();\n+\n+            while (rs.next()) {\n+\n+                workflow.setWorkflowId(rs.getInt(\"WF_ID\"));\n+                workflow.setWorkflowReference(rs.getString(\"WF_REFERENCE\"));\n+                workflow.setWorkflowType(rs.getString(\"WF_TYPE\"));\n+\n+                String workflowstatus =rs.getString(\"WF_STATUS\");\n+                workflow.setStatus(org.wso2.carbon.apimgt.api.WorkflowStatus.valueOf(workflowstatus));\n+\n+                workflow.setCreatedTime(rs.getTimestamp(\"WF_CREATED_TIME\").toString());\n+                workflow.setUpdatedTime(rs.getTimestamp(\"WF_UPDATED_TIME\").toString());\n+\n+                workflow.setWorkflowStatusDesc(rs.getString(\"WF_STATUS_DESC\"));\n+                workflow.setTenantId(rs.getInt(\"TENANT_ID\"));\n+                workflow.setTenantDomain(rs.getString(\"TENANT_DOMAIN\"));\n+                workflow.setExternalWorkflowReference(rs.getString(\"WF_EXTERNAL_REFERENCE\"));\n+                Blob metadatablob = rs.getBlob(\"WF_METADATA\");\n+\n+                byte[] metadataByte;\n+\n+                if(metadatablob != null) {", "originalCommit": "6bf3e5572d4f5d21b3b4f4cb596a1eeea3348002", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDc5MjEyOQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r410792129", "bodyText": "fixed with e00fe40", "author": "SahanHerath", "createdAt": "2020-04-19T02:02:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyMDA4Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyMDI5MA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r406620290", "bodyText": "don't use g as a variable name", "author": "chamilaadhi", "createdAt": "2020-04-10T06:21:00Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/ApiMgtDAO.java", "diffHunk": "@@ -14610,4 +14621,284 @@ public String getUserID(String userName) throws APIManagementException {\n         }\n         return list;\n     }\n+\n+    /**\n+     * Remove the Pending workflow Requests using ExternalWorkflowReference\n+     *\n+     * @param workflowExtRef\n+     * @return\n+     */\n+\n+    public void deleteWorkflowRequest(String workflowExtRef) throws APIManagementException {\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+\n+        String query = SQLConstants.DELETE_WORKFLOW_REQUEST_SQL;\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            connection.setAutoCommit(false);\n+\n+            prepStmt = connection.prepareStatement(query);\n+            prepStmt.setString(1, workflowExtRef);\n+            prepStmt.executeUpdate();\n+            connection.commit();\n+        }\n+        catch (SQLException e) {\n+            handleException(\"Failed to delete the workflow request \", e);\n+        }\n+    }\n+\n+    /**\n+     * Get the Pending workflow Request using ExternalWorkflowReference\n+     *\n+     * @param externalWorkflowRef\n+     * @return\n+     */\n+\n+    public Workflow getworkflowReferenceByExternalWorkflowReference(String externalWorkflowRef)throws APIManagementException {\n+\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+        ResultSet rs = null;\n+\n+        Workflow workflow=new Workflow();\n+\n+        String sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS_BY_EWR;\n+\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            prepStmt = connection.prepareStatement(sqlQuery);\n+            prepStmt.setString(1, externalWorkflowRef);\n+\n+            rs = prepStmt.executeQuery();\n+\n+            while (rs.next()) {\n+\n+                workflow.setWorkflowId(rs.getInt(\"WF_ID\"));\n+                workflow.setWorkflowReference(rs.getString(\"WF_REFERENCE\"));\n+                workflow.setWorkflowType(rs.getString(\"WF_TYPE\"));\n+\n+                String workflowstatus =rs.getString(\"WF_STATUS\");\n+                workflow.setStatus(org.wso2.carbon.apimgt.api.WorkflowStatus.valueOf(workflowstatus));\n+\n+                workflow.setCreatedTime(rs.getTimestamp(\"WF_CREATED_TIME\").toString());\n+                workflow.setUpdatedTime(rs.getTimestamp(\"WF_UPDATED_TIME\").toString());\n+\n+                workflow.setWorkflowStatusDesc(rs.getString(\"WF_STATUS_DESC\"));\n+                workflow.setTenantId(rs.getInt(\"TENANT_ID\"));\n+                workflow.setTenantDomain(rs.getString(\"TENANT_DOMAIN\"));\n+                workflow.setExternalWorkflowReference(rs.getString(\"WF_EXTERNAL_REFERENCE\"));\n+                Blob metadatablob = rs.getBlob(\"WF_METADATA\");\n+\n+                byte[] metadataByte;\n+\n+                if(metadatablob != null) {\n+                    metadataByte = metadatablob.getBytes(1L, (int) metadatablob.length());\n+                    InputStream targetStream = new ByteArrayInputStream(metadataByte);\n+                    String metadata = APIMgtDBUtil.getStringFromInputStream(targetStream);\n+                    Gson g = new Gson();", "originalCommit": "6bf3e5572d4f5d21b3b4f4cb596a1eeea3348002", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyMDUyMA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r406620520", "bodyText": "add a space at the end of the message", "author": "chamilaadhi", "createdAt": "2020-04-10T06:21:57Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/ApiMgtDAO.java", "diffHunk": "@@ -14610,4 +14621,284 @@ public String getUserID(String userName) throws APIManagementException {\n         }\n         return list;\n     }\n+\n+    /**\n+     * Remove the Pending workflow Requests using ExternalWorkflowReference\n+     *\n+     * @param workflowExtRef\n+     * @return\n+     */\n+\n+    public void deleteWorkflowRequest(String workflowExtRef) throws APIManagementException {\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+\n+        String query = SQLConstants.DELETE_WORKFLOW_REQUEST_SQL;\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            connection.setAutoCommit(false);\n+\n+            prepStmt = connection.prepareStatement(query);\n+            prepStmt.setString(1, workflowExtRef);\n+            prepStmt.executeUpdate();\n+            connection.commit();\n+        }\n+        catch (SQLException e) {\n+            handleException(\"Failed to delete the workflow request \", e);\n+        }\n+    }\n+\n+    /**\n+     * Get the Pending workflow Request using ExternalWorkflowReference\n+     *\n+     * @param externalWorkflowRef\n+     * @return\n+     */\n+\n+    public Workflow getworkflowReferenceByExternalWorkflowReference(String externalWorkflowRef)throws APIManagementException {\n+\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+        ResultSet rs = null;\n+\n+        Workflow workflow=new Workflow();\n+\n+        String sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS_BY_EWR;\n+\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            prepStmt = connection.prepareStatement(sqlQuery);\n+            prepStmt.setString(1, externalWorkflowRef);\n+\n+            rs = prepStmt.executeQuery();\n+\n+            while (rs.next()) {\n+\n+                workflow.setWorkflowId(rs.getInt(\"WF_ID\"));\n+                workflow.setWorkflowReference(rs.getString(\"WF_REFERENCE\"));\n+                workflow.setWorkflowType(rs.getString(\"WF_TYPE\"));\n+\n+                String workflowstatus =rs.getString(\"WF_STATUS\");\n+                workflow.setStatus(org.wso2.carbon.apimgt.api.WorkflowStatus.valueOf(workflowstatus));\n+\n+                workflow.setCreatedTime(rs.getTimestamp(\"WF_CREATED_TIME\").toString());\n+                workflow.setUpdatedTime(rs.getTimestamp(\"WF_UPDATED_TIME\").toString());\n+\n+                workflow.setWorkflowStatusDesc(rs.getString(\"WF_STATUS_DESC\"));\n+                workflow.setTenantId(rs.getInt(\"TENANT_ID\"));\n+                workflow.setTenantDomain(rs.getString(\"TENANT_DOMAIN\"));\n+                workflow.setExternalWorkflowReference(rs.getString(\"WF_EXTERNAL_REFERENCE\"));\n+                Blob metadatablob = rs.getBlob(\"WF_METADATA\");\n+\n+                byte[] metadataByte;\n+\n+                if(metadatablob != null) {\n+                    metadataByte = metadatablob.getBytes(1L, (int) metadatablob.length());\n+                    InputStream targetStream = new ByteArrayInputStream(metadataByte);\n+                    String metadata = APIMgtDBUtil.getStringFromInputStream(targetStream);\n+                    Gson g = new Gson();\n+                    JSONObject json = g.fromJson(metadata, JSONObject.class);\n+                    workflow.setMetadata(json);\n+                } else {\n+                    JSONObject json=new JSONObject();\n+                    workflow.setMetadata(json);\n+                }\n+            }\n+        } catch (SQLException e) {\n+            handleException(\"Error when retriving the workflow details\" , e);", "originalCommit": "6bf3e5572d4f5d21b3b4f4cb596a1eeea3348002", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyMDYyMw==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r406620623", "bodyText": "describe these", "author": "chamilaadhi", "createdAt": "2020-04-10T06:22:20Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/ApiMgtDAO.java", "diffHunk": "@@ -14610,4 +14621,284 @@ public String getUserID(String userName) throws APIManagementException {\n         }\n         return list;\n     }\n+\n+    /**\n+     * Remove the Pending workflow Requests using ExternalWorkflowReference\n+     *\n+     * @param workflowExtRef\n+     * @return\n+     */\n+\n+    public void deleteWorkflowRequest(String workflowExtRef) throws APIManagementException {\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+\n+        String query = SQLConstants.DELETE_WORKFLOW_REQUEST_SQL;\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            connection.setAutoCommit(false);\n+\n+            prepStmt = connection.prepareStatement(query);\n+            prepStmt.setString(1, workflowExtRef);\n+            prepStmt.executeUpdate();\n+            connection.commit();\n+        }\n+        catch (SQLException e) {\n+            handleException(\"Failed to delete the workflow request \", e);\n+        }\n+    }\n+\n+    /**\n+     * Get the Pending workflow Request using ExternalWorkflowReference\n+     *\n+     * @param externalWorkflowRef\n+     * @return\n+     */\n+\n+    public Workflow getworkflowReferenceByExternalWorkflowReference(String externalWorkflowRef)throws APIManagementException {\n+\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+        ResultSet rs = null;\n+\n+        Workflow workflow=new Workflow();\n+\n+        String sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS_BY_EWR;\n+\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            prepStmt = connection.prepareStatement(sqlQuery);\n+            prepStmt.setString(1, externalWorkflowRef);\n+\n+            rs = prepStmt.executeQuery();\n+\n+            while (rs.next()) {\n+\n+                workflow.setWorkflowId(rs.getInt(\"WF_ID\"));\n+                workflow.setWorkflowReference(rs.getString(\"WF_REFERENCE\"));\n+                workflow.setWorkflowType(rs.getString(\"WF_TYPE\"));\n+\n+                String workflowstatus =rs.getString(\"WF_STATUS\");\n+                workflow.setStatus(org.wso2.carbon.apimgt.api.WorkflowStatus.valueOf(workflowstatus));\n+\n+                workflow.setCreatedTime(rs.getTimestamp(\"WF_CREATED_TIME\").toString());\n+                workflow.setUpdatedTime(rs.getTimestamp(\"WF_UPDATED_TIME\").toString());\n+\n+                workflow.setWorkflowStatusDesc(rs.getString(\"WF_STATUS_DESC\"));\n+                workflow.setTenantId(rs.getInt(\"TENANT_ID\"));\n+                workflow.setTenantDomain(rs.getString(\"TENANT_DOMAIN\"));\n+                workflow.setExternalWorkflowReference(rs.getString(\"WF_EXTERNAL_REFERENCE\"));\n+                Blob metadatablob = rs.getBlob(\"WF_METADATA\");\n+\n+                byte[] metadataByte;\n+\n+                if(metadatablob != null) {\n+                    metadataByte = metadatablob.getBytes(1L, (int) metadatablob.length());\n+                    InputStream targetStream = new ByteArrayInputStream(metadataByte);\n+                    String metadata = APIMgtDBUtil.getStringFromInputStream(targetStream);\n+                    Gson g = new Gson();\n+                    JSONObject json = g.fromJson(metadata, JSONObject.class);\n+                    workflow.setMetadata(json);\n+                } else {\n+                    JSONObject json=new JSONObject();\n+                    workflow.setMetadata(json);\n+                }\n+            }\n+        } catch (SQLException e) {\n+            handleException(\"Error when retriving the workflow details\" , e);\n+        } finally {\n+            APIMgtDBUtil.closeAllConnections(prepStmt, connection, rs);\n+        }\n+        return workflow;\n+    }\n+\n+    /**\n+     * Get the Pending workflow Requests using WorkflowType for a particular tenant\n+     *\n+     * @param workflowType\n+     * @param status\n+     * @param tenantDomain\n+     * @return", "originalCommit": "6bf3e5572d4f5d21b3b4f4cb596a1eeea3348002", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyMDg5Mg==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r406620892", "bodyText": "format this whole method.  remove any unnecessary spaces", "author": "chamilaadhi", "createdAt": "2020-04-10T06:23:19Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/ApiMgtDAO.java", "diffHunk": "@@ -14610,4 +14621,284 @@ public String getUserID(String userName) throws APIManagementException {\n         }\n         return list;\n     }\n+\n+    /**\n+     * Remove the Pending workflow Requests using ExternalWorkflowReference\n+     *\n+     * @param workflowExtRef\n+     * @return\n+     */\n+\n+    public void deleteWorkflowRequest(String workflowExtRef) throws APIManagementException {\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+\n+        String query = SQLConstants.DELETE_WORKFLOW_REQUEST_SQL;\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            connection.setAutoCommit(false);\n+\n+            prepStmt = connection.prepareStatement(query);\n+            prepStmt.setString(1, workflowExtRef);\n+            prepStmt.executeUpdate();\n+            connection.commit();\n+        }\n+        catch (SQLException e) {\n+            handleException(\"Failed to delete the workflow request \", e);\n+        }\n+    }\n+\n+    /**\n+     * Get the Pending workflow Request using ExternalWorkflowReference\n+     *\n+     * @param externalWorkflowRef\n+     * @return\n+     */\n+\n+    public Workflow getworkflowReferenceByExternalWorkflowReference(String externalWorkflowRef)throws APIManagementException {\n+\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+        ResultSet rs = null;\n+\n+        Workflow workflow=new Workflow();\n+\n+        String sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS_BY_EWR;\n+\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            prepStmt = connection.prepareStatement(sqlQuery);\n+            prepStmt.setString(1, externalWorkflowRef);\n+\n+            rs = prepStmt.executeQuery();\n+\n+            while (rs.next()) {\n+\n+                workflow.setWorkflowId(rs.getInt(\"WF_ID\"));\n+                workflow.setWorkflowReference(rs.getString(\"WF_REFERENCE\"));\n+                workflow.setWorkflowType(rs.getString(\"WF_TYPE\"));\n+\n+                String workflowstatus =rs.getString(\"WF_STATUS\");\n+                workflow.setStatus(org.wso2.carbon.apimgt.api.WorkflowStatus.valueOf(workflowstatus));\n+\n+                workflow.setCreatedTime(rs.getTimestamp(\"WF_CREATED_TIME\").toString());\n+                workflow.setUpdatedTime(rs.getTimestamp(\"WF_UPDATED_TIME\").toString());\n+\n+                workflow.setWorkflowStatusDesc(rs.getString(\"WF_STATUS_DESC\"));\n+                workflow.setTenantId(rs.getInt(\"TENANT_ID\"));\n+                workflow.setTenantDomain(rs.getString(\"TENANT_DOMAIN\"));\n+                workflow.setExternalWorkflowReference(rs.getString(\"WF_EXTERNAL_REFERENCE\"));\n+                Blob metadatablob = rs.getBlob(\"WF_METADATA\");\n+\n+                byte[] metadataByte;\n+\n+                if(metadatablob != null) {\n+                    metadataByte = metadatablob.getBytes(1L, (int) metadatablob.length());\n+                    InputStream targetStream = new ByteArrayInputStream(metadataByte);\n+                    String metadata = APIMgtDBUtil.getStringFromInputStream(targetStream);\n+                    Gson g = new Gson();\n+                    JSONObject json = g.fromJson(metadata, JSONObject.class);\n+                    workflow.setMetadata(json);\n+                } else {\n+                    JSONObject json=new JSONObject();\n+                    workflow.setMetadata(json);\n+                }\n+            }\n+        } catch (SQLException e) {\n+            handleException(\"Error when retriving the workflow details\" , e);\n+        } finally {\n+            APIMgtDBUtil.closeAllConnections(prepStmt, connection, rs);\n+        }\n+        return workflow;\n+    }\n+\n+    /**\n+     * Get the Pending workflow Requests using WorkflowType for a particular tenant\n+     *\n+     * @param workflowType\n+     * @param status\n+     * @param tenantDomain\n+     * @return\n+     */\n+\n+    public Workflow[] getworkflows(String workflowType ,String status ,String tenantDomain) throws APIManagementException {\n+\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+        ResultSet rs = null;\n+\n+        Workflow[] workflows = null;\n+\n+        String sqlQuery;\n+\n+        if (workflowType != null){\n+            sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS_BY_WORKFLOW_TYPE;\n+        } else {\n+            sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS;\n+        }\n+\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            prepStmt = connection.prepareStatement(sqlQuery);\n+\n+            if (workflowType != null){\n+                prepStmt.setString(1, workflowType);\n+                prepStmt.setString( 2, status);\n+                prepStmt.setString( 3, tenantDomain);\n+\n+            } else {\n+                prepStmt.setString( 1, status);\n+                prepStmt.setString( 2, tenantDomain);\n+            }\n+", "originalCommit": "6bf3e5572d4f5d21b3b4f4cb596a1eeea3348002", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyMTI4Nw==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r406621287", "bodyText": "format whole method and remove unnecessary spaces", "author": "chamilaadhi", "createdAt": "2020-04-10T06:24:41Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/ApiMgtDAO.java", "diffHunk": "@@ -14610,4 +14621,284 @@ public String getUserID(String userName) throws APIManagementException {\n         }\n         return list;\n     }\n+\n+    /**\n+     * Remove the Pending workflow Requests using ExternalWorkflowReference\n+     *\n+     * @param workflowExtRef\n+     * @return\n+     */\n+\n+    public void deleteWorkflowRequest(String workflowExtRef) throws APIManagementException {\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+\n+        String query = SQLConstants.DELETE_WORKFLOW_REQUEST_SQL;\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            connection.setAutoCommit(false);\n+\n+            prepStmt = connection.prepareStatement(query);\n+            prepStmt.setString(1, workflowExtRef);\n+            prepStmt.executeUpdate();\n+            connection.commit();\n+        }\n+        catch (SQLException e) {\n+            handleException(\"Failed to delete the workflow request \", e);\n+        }\n+    }\n+\n+    /**\n+     * Get the Pending workflow Request using ExternalWorkflowReference\n+     *\n+     * @param externalWorkflowRef\n+     * @return\n+     */\n+\n+    public Workflow getworkflowReferenceByExternalWorkflowReference(String externalWorkflowRef)throws APIManagementException {\n+\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+        ResultSet rs = null;\n+\n+        Workflow workflow=new Workflow();\n+\n+        String sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS_BY_EWR;\n+\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            prepStmt = connection.prepareStatement(sqlQuery);\n+            prepStmt.setString(1, externalWorkflowRef);\n+\n+            rs = prepStmt.executeQuery();\n+\n+            while (rs.next()) {\n+\n+                workflow.setWorkflowId(rs.getInt(\"WF_ID\"));\n+                workflow.setWorkflowReference(rs.getString(\"WF_REFERENCE\"));\n+                workflow.setWorkflowType(rs.getString(\"WF_TYPE\"));\n+\n+                String workflowstatus =rs.getString(\"WF_STATUS\");\n+                workflow.setStatus(org.wso2.carbon.apimgt.api.WorkflowStatus.valueOf(workflowstatus));\n+\n+                workflow.setCreatedTime(rs.getTimestamp(\"WF_CREATED_TIME\").toString());\n+                workflow.setUpdatedTime(rs.getTimestamp(\"WF_UPDATED_TIME\").toString());\n+\n+                workflow.setWorkflowStatusDesc(rs.getString(\"WF_STATUS_DESC\"));\n+                workflow.setTenantId(rs.getInt(\"TENANT_ID\"));\n+                workflow.setTenantDomain(rs.getString(\"TENANT_DOMAIN\"));\n+                workflow.setExternalWorkflowReference(rs.getString(\"WF_EXTERNAL_REFERENCE\"));\n+                Blob metadatablob = rs.getBlob(\"WF_METADATA\");\n+\n+                byte[] metadataByte;\n+\n+                if(metadatablob != null) {\n+                    metadataByte = metadatablob.getBytes(1L, (int) metadatablob.length());\n+                    InputStream targetStream = new ByteArrayInputStream(metadataByte);\n+                    String metadata = APIMgtDBUtil.getStringFromInputStream(targetStream);\n+                    Gson g = new Gson();\n+                    JSONObject json = g.fromJson(metadata, JSONObject.class);\n+                    workflow.setMetadata(json);\n+                } else {\n+                    JSONObject json=new JSONObject();\n+                    workflow.setMetadata(json);\n+                }\n+            }\n+        } catch (SQLException e) {\n+            handleException(\"Error when retriving the workflow details\" , e);\n+        } finally {\n+            APIMgtDBUtil.closeAllConnections(prepStmt, connection, rs);\n+        }\n+        return workflow;\n+    }\n+\n+    /**\n+     * Get the Pending workflow Requests using WorkflowType for a particular tenant\n+     *\n+     * @param workflowType\n+     * @param status\n+     * @param tenantDomain\n+     * @return\n+     */\n+\n+    public Workflow[] getworkflows(String workflowType ,String status ,String tenantDomain) throws APIManagementException {\n+\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+        ResultSet rs = null;\n+\n+        Workflow[] workflows = null;\n+\n+        String sqlQuery;\n+\n+        if (workflowType != null){\n+            sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS_BY_WORKFLOW_TYPE;\n+        } else {\n+            sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS;\n+        }\n+\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            prepStmt = connection.prepareStatement(sqlQuery);\n+\n+            if (workflowType != null){\n+                prepStmt.setString(1, workflowType);\n+                prepStmt.setString( 2, status);\n+                prepStmt.setString( 3, tenantDomain);\n+\n+            } else {\n+                prepStmt.setString( 1, status);\n+                prepStmt.setString( 2, tenantDomain);\n+            }\n+\n+            rs = prepStmt.executeQuery();\n+\n+            ArrayList<Workflow> workflowsList = new ArrayList<Workflow>();\n+            Workflow workflow;\n+            while (rs.next()) {\n+                workflow = new Workflow();\n+                workflow.setWorkflowId(rs.getInt(\"WF_ID\"));\n+                workflow.setWorkflowReference(rs.getString(\"WF_REFERENCE\"));\n+                workflow.setWorkflowType(rs.getString(\"WF_TYPE\"));\n+\n+                String workflowstatus =rs.getString(\"WF_STATUS\");\n+                workflow.setStatus(org.wso2.carbon.apimgt.api.WorkflowStatus.valueOf(workflowstatus));\n+\n+                workflow.setCreatedTime(rs.getTimestamp(\"WF_CREATED_TIME\").toString());\n+                workflow.setUpdatedTime(rs.getTimestamp(\"WF_UPDATED_TIME\").toString());\n+\n+                workflow.setWorkflowStatusDesc(rs.getString(\"WF_STATUS_DESC\"));\n+                workflow.setTenantId(rs.getInt(\"TENANT_ID\"));\n+                workflow.setTenantDomain(rs.getString(\"TENANT_DOMAIN\"));\n+                workflow.setExternalWorkflowReference(rs.getString(\"WF_EXTERNAL_REFERENCE\"));\n+                workflow.setWorkflowDescription(rs.getString(\"WF_STATUS_DESC\"));\n+                Blob metadataBlob = rs.getBlob(\"WF_METADATA\");\n+                Blob propertiesBlob = rs.getBlob(\"WF_PROPERTIES\");\n+\n+                byte[] metadataByte;\n+\n+                if(metadataBlob != null) {\n+                    metadataByte = metadataBlob.getBytes(1L, (int) metadataBlob.length());\n+                    InputStream targetStream = new ByteArrayInputStream(metadataByte);\n+                    String metadata = APIMgtDBUtil.getStringFromInputStream(targetStream);\n+                    Gson g = new Gson();\n+\n+                    JSONObject json = g.fromJson(metadata, JSONObject.class);\n+                    workflow.setMetadata(json);\n+                } else {\n+                    JSONObject json = new JSONObject();\n+                    workflow.setMetadata(json);\n+                }\n+\n+                byte[] propertiesByte;\n+\n+                if(propertiesBlob != null) {\n+                    propertiesByte = propertiesBlob.getBytes(1L, (int) propertiesBlob.length());\n+                    InputStream propertiesTargetStream = new ByteArrayInputStream(propertiesByte);\n+                    String properties = APIMgtDBUtil.getStringFromInputStream(propertiesTargetStream);\n+                    Gson g = new Gson();\n+\n+                    JSONObject json = g.fromJson(properties, JSONObject.class);\n+                    workflow.setProperties(json);\n+                } else {\n+                    JSONObject json = new JSONObject();\n+                    workflow.setProperties(json);\n+                }\n+\n+                workflowsList.add(workflow);\n+            }\n+            workflows = workflowsList.toArray(new Workflow[workflowsList.size()]);\n+        } catch (SQLException e) {\n+            handleException(\"Error when retrieve all the workflow details\" , e);\n+        } finally {\n+            APIMgtDBUtil.closeAllConnections(prepStmt, connection, rs);\n+        }\n+        return workflows;\n+    }\n+\n+    /**\n+     * Get the Pending workflow Request using ExternalWorkflowReference for a particular tenant\n+     *\n+     * @param externelWorkflowRef\n+     * @param status\n+     * @param tenantDomain\n+     * @return\n+     */\n+\n+    public Workflow getworkflowReferenceByExternalWorkflowReferenceID(String externelWorkflowRef, String status ,\n+                                                                      String tenantDomain) throws APIManagementException {\n+\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+        ResultSet rs = null;\n+\n+        Workflow workflow=new Workflow();\n+\n+        String sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS_BY_EXTERNAL_WORKFLOW_REFERENCE;\n+\n+        try {", "originalCommit": "6bf3e5572d4f5d21b3b4f4cb596a1eeea3348002", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDc5MjE3Mg==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r410792172", "bodyText": "fixed with e00fe40", "author": "SahanHerath", "createdAt": "2020-04-19T02:02:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyMTI4Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyMTU2Mw==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r406621563", "bodyText": "put a meaningful names to the variables. don't use g, json, json1", "author": "chamilaadhi", "createdAt": "2020-04-10T06:25:51Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/ApiMgtDAO.java", "diffHunk": "@@ -14610,4 +14621,284 @@ public String getUserID(String userName) throws APIManagementException {\n         }\n         return list;\n     }\n+\n+    /**\n+     * Remove the Pending workflow Requests using ExternalWorkflowReference\n+     *\n+     * @param workflowExtRef\n+     * @return\n+     */\n+\n+    public void deleteWorkflowRequest(String workflowExtRef) throws APIManagementException {\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+\n+        String query = SQLConstants.DELETE_WORKFLOW_REQUEST_SQL;\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            connection.setAutoCommit(false);\n+\n+            prepStmt = connection.prepareStatement(query);\n+            prepStmt.setString(1, workflowExtRef);\n+            prepStmt.executeUpdate();\n+            connection.commit();\n+        }\n+        catch (SQLException e) {\n+            handleException(\"Failed to delete the workflow request \", e);\n+        }\n+    }\n+\n+    /**\n+     * Get the Pending workflow Request using ExternalWorkflowReference\n+     *\n+     * @param externalWorkflowRef\n+     * @return\n+     */\n+\n+    public Workflow getworkflowReferenceByExternalWorkflowReference(String externalWorkflowRef)throws APIManagementException {\n+\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+        ResultSet rs = null;\n+\n+        Workflow workflow=new Workflow();\n+\n+        String sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS_BY_EWR;\n+\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            prepStmt = connection.prepareStatement(sqlQuery);\n+            prepStmt.setString(1, externalWorkflowRef);\n+\n+            rs = prepStmt.executeQuery();\n+\n+            while (rs.next()) {\n+\n+                workflow.setWorkflowId(rs.getInt(\"WF_ID\"));\n+                workflow.setWorkflowReference(rs.getString(\"WF_REFERENCE\"));\n+                workflow.setWorkflowType(rs.getString(\"WF_TYPE\"));\n+\n+                String workflowstatus =rs.getString(\"WF_STATUS\");\n+                workflow.setStatus(org.wso2.carbon.apimgt.api.WorkflowStatus.valueOf(workflowstatus));\n+\n+                workflow.setCreatedTime(rs.getTimestamp(\"WF_CREATED_TIME\").toString());\n+                workflow.setUpdatedTime(rs.getTimestamp(\"WF_UPDATED_TIME\").toString());\n+\n+                workflow.setWorkflowStatusDesc(rs.getString(\"WF_STATUS_DESC\"));\n+                workflow.setTenantId(rs.getInt(\"TENANT_ID\"));\n+                workflow.setTenantDomain(rs.getString(\"TENANT_DOMAIN\"));\n+                workflow.setExternalWorkflowReference(rs.getString(\"WF_EXTERNAL_REFERENCE\"));\n+                Blob metadatablob = rs.getBlob(\"WF_METADATA\");\n+\n+                byte[] metadataByte;\n+\n+                if(metadatablob != null) {\n+                    metadataByte = metadatablob.getBytes(1L, (int) metadatablob.length());\n+                    InputStream targetStream = new ByteArrayInputStream(metadataByte);\n+                    String metadata = APIMgtDBUtil.getStringFromInputStream(targetStream);\n+                    Gson g = new Gson();\n+                    JSONObject json = g.fromJson(metadata, JSONObject.class);\n+                    workflow.setMetadata(json);\n+                } else {\n+                    JSONObject json=new JSONObject();\n+                    workflow.setMetadata(json);\n+                }\n+            }\n+        } catch (SQLException e) {\n+            handleException(\"Error when retriving the workflow details\" , e);\n+        } finally {\n+            APIMgtDBUtil.closeAllConnections(prepStmt, connection, rs);\n+        }\n+        return workflow;\n+    }\n+\n+    /**\n+     * Get the Pending workflow Requests using WorkflowType for a particular tenant\n+     *\n+     * @param workflowType\n+     * @param status\n+     * @param tenantDomain\n+     * @return\n+     */\n+\n+    public Workflow[] getworkflows(String workflowType ,String status ,String tenantDomain) throws APIManagementException {\n+\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+        ResultSet rs = null;\n+\n+        Workflow[] workflows = null;\n+\n+        String sqlQuery;\n+\n+        if (workflowType != null){\n+            sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS_BY_WORKFLOW_TYPE;\n+        } else {\n+            sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS;\n+        }\n+\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            prepStmt = connection.prepareStatement(sqlQuery);\n+\n+            if (workflowType != null){\n+                prepStmt.setString(1, workflowType);\n+                prepStmt.setString( 2, status);\n+                prepStmt.setString( 3, tenantDomain);\n+\n+            } else {\n+                prepStmt.setString( 1, status);\n+                prepStmt.setString( 2, tenantDomain);\n+            }\n+\n+            rs = prepStmt.executeQuery();\n+\n+            ArrayList<Workflow> workflowsList = new ArrayList<Workflow>();\n+            Workflow workflow;\n+            while (rs.next()) {\n+                workflow = new Workflow();\n+                workflow.setWorkflowId(rs.getInt(\"WF_ID\"));\n+                workflow.setWorkflowReference(rs.getString(\"WF_REFERENCE\"));\n+                workflow.setWorkflowType(rs.getString(\"WF_TYPE\"));\n+\n+                String workflowstatus =rs.getString(\"WF_STATUS\");\n+                workflow.setStatus(org.wso2.carbon.apimgt.api.WorkflowStatus.valueOf(workflowstatus));\n+\n+                workflow.setCreatedTime(rs.getTimestamp(\"WF_CREATED_TIME\").toString());\n+                workflow.setUpdatedTime(rs.getTimestamp(\"WF_UPDATED_TIME\").toString());\n+\n+                workflow.setWorkflowStatusDesc(rs.getString(\"WF_STATUS_DESC\"));\n+                workflow.setTenantId(rs.getInt(\"TENANT_ID\"));\n+                workflow.setTenantDomain(rs.getString(\"TENANT_DOMAIN\"));\n+                workflow.setExternalWorkflowReference(rs.getString(\"WF_EXTERNAL_REFERENCE\"));\n+                workflow.setWorkflowDescription(rs.getString(\"WF_STATUS_DESC\"));\n+                Blob metadataBlob = rs.getBlob(\"WF_METADATA\");\n+                Blob propertiesBlob = rs.getBlob(\"WF_PROPERTIES\");\n+\n+                byte[] metadataByte;\n+\n+                if(metadataBlob != null) {\n+                    metadataByte = metadataBlob.getBytes(1L, (int) metadataBlob.length());\n+                    InputStream targetStream = new ByteArrayInputStream(metadataByte);\n+                    String metadata = APIMgtDBUtil.getStringFromInputStream(targetStream);\n+                    Gson g = new Gson();\n+\n+                    JSONObject json = g.fromJson(metadata, JSONObject.class);\n+                    workflow.setMetadata(json);\n+                } else {\n+                    JSONObject json = new JSONObject();\n+                    workflow.setMetadata(json);\n+                }\n+\n+                byte[] propertiesByte;\n+\n+                if(propertiesBlob != null) {\n+                    propertiesByte = propertiesBlob.getBytes(1L, (int) propertiesBlob.length());\n+                    InputStream propertiesTargetStream = new ByteArrayInputStream(propertiesByte);\n+                    String properties = APIMgtDBUtil.getStringFromInputStream(propertiesTargetStream);\n+                    Gson g = new Gson();\n+\n+                    JSONObject json = g.fromJson(properties, JSONObject.class);\n+                    workflow.setProperties(json);\n+                } else {\n+                    JSONObject json = new JSONObject();\n+                    workflow.setProperties(json);\n+                }\n+\n+                workflowsList.add(workflow);\n+            }\n+            workflows = workflowsList.toArray(new Workflow[workflowsList.size()]);\n+        } catch (SQLException e) {\n+            handleException(\"Error when retrieve all the workflow details\" , e);\n+        } finally {\n+            APIMgtDBUtil.closeAllConnections(prepStmt, connection, rs);\n+        }\n+        return workflows;\n+    }\n+\n+    /**\n+     * Get the Pending workflow Request using ExternalWorkflowReference for a particular tenant\n+     *\n+     * @param externelWorkflowRef\n+     * @param status\n+     * @param tenantDomain\n+     * @return\n+     */\n+\n+    public Workflow getworkflowReferenceByExternalWorkflowReferenceID(String externelWorkflowRef, String status ,\n+                                                                      String tenantDomain) throws APIManagementException {\n+\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+        ResultSet rs = null;\n+\n+        Workflow workflow=new Workflow();\n+\n+        String sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS_BY_EXTERNAL_WORKFLOW_REFERENCE;\n+\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            prepStmt = connection.prepareStatement(sqlQuery);\n+            prepStmt.setString(1, externelWorkflowRef);\n+            prepStmt.setString(2, status);\n+            prepStmt.setString(3, tenantDomain);\n+\n+            rs = prepStmt.executeQuery();\n+\n+            while (rs.next()) {\n+\n+                workflow.setWorkflowId(rs.getInt(\"WF_ID\"));\n+                workflow.setWorkflowReference(rs.getString(\"WF_REFERENCE\"));\n+                workflow.setWorkflowType(rs.getString(\"WF_TYPE\"));\n+\n+                String workflowstatus =rs.getString(\"WF_STATUS\");\n+                workflow.setStatus(org.wso2.carbon.apimgt.api.WorkflowStatus.valueOf(workflowstatus));\n+\n+                workflow.setCreatedTime(rs.getTimestamp(\"WF_CREATED_TIME\").toString());\n+                workflow.setUpdatedTime(rs.getTimestamp(\"WF_UPDATED_TIME\").toString());\n+\n+                workflow.setWorkflowDescription(rs.getString(\"WF_STATUS_DESC\"));\n+                workflow.setTenantId(rs.getInt(\"TENANT_ID\"));\n+                workflow.setTenantDomain(rs.getString(\"TENANT_DOMAIN\"));\n+                workflow.setExternalWorkflowReference(rs.getString(\"WF_EXTERNAL_REFERENCE\"));\n+                Blob metadataBlob = rs.getBlob(\"WF_METADATA\");\n+                Blob propertiesBlob = rs.getBlob(\"WF_PROPERTIES\");\n+\n+                byte[] metadataByte;\n+\n+                if(metadataBlob != null) {\n+                    metadataByte = metadataBlob.getBytes(1L, (int) metadataBlob.length());\n+                    InputStream targetStream = new ByteArrayInputStream(metadataByte);\n+                    String metadata = APIMgtDBUtil.getStringFromInputStream(targetStream);\n+                    Gson g = new Gson();\n+\n+                    JSONObject json = g.fromJson(metadata, JSONObject.class);\n+                    workflow.setMetadata(json);", "originalCommit": "6bf3e5572d4f5d21b3b4f4cb596a1eeea3348002", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyMTY1MQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r406621651", "bodyText": "use meaningful variable names", "author": "chamilaadhi", "createdAt": "2020-04-10T06:26:14Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/ApiMgtDAO.java", "diffHunk": "@@ -14610,4 +14621,284 @@ public String getUserID(String userName) throws APIManagementException {\n         }\n         return list;\n     }\n+\n+    /**\n+     * Remove the Pending workflow Requests using ExternalWorkflowReference\n+     *\n+     * @param workflowExtRef\n+     * @return\n+     */\n+\n+    public void deleteWorkflowRequest(String workflowExtRef) throws APIManagementException {\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+\n+        String query = SQLConstants.DELETE_WORKFLOW_REQUEST_SQL;\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            connection.setAutoCommit(false);\n+\n+            prepStmt = connection.prepareStatement(query);\n+            prepStmt.setString(1, workflowExtRef);\n+            prepStmt.executeUpdate();\n+            connection.commit();\n+        }\n+        catch (SQLException e) {\n+            handleException(\"Failed to delete the workflow request \", e);\n+        }\n+    }\n+\n+    /**\n+     * Get the Pending workflow Request using ExternalWorkflowReference\n+     *\n+     * @param externalWorkflowRef\n+     * @return\n+     */\n+\n+    public Workflow getworkflowReferenceByExternalWorkflowReference(String externalWorkflowRef)throws APIManagementException {\n+\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+        ResultSet rs = null;\n+\n+        Workflow workflow=new Workflow();\n+\n+        String sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS_BY_EWR;\n+\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            prepStmt = connection.prepareStatement(sqlQuery);\n+            prepStmt.setString(1, externalWorkflowRef);\n+\n+            rs = prepStmt.executeQuery();\n+\n+            while (rs.next()) {\n+\n+                workflow.setWorkflowId(rs.getInt(\"WF_ID\"));\n+                workflow.setWorkflowReference(rs.getString(\"WF_REFERENCE\"));\n+                workflow.setWorkflowType(rs.getString(\"WF_TYPE\"));\n+\n+                String workflowstatus =rs.getString(\"WF_STATUS\");\n+                workflow.setStatus(org.wso2.carbon.apimgt.api.WorkflowStatus.valueOf(workflowstatus));\n+\n+                workflow.setCreatedTime(rs.getTimestamp(\"WF_CREATED_TIME\").toString());\n+                workflow.setUpdatedTime(rs.getTimestamp(\"WF_UPDATED_TIME\").toString());\n+\n+                workflow.setWorkflowStatusDesc(rs.getString(\"WF_STATUS_DESC\"));\n+                workflow.setTenantId(rs.getInt(\"TENANT_ID\"));\n+                workflow.setTenantDomain(rs.getString(\"TENANT_DOMAIN\"));\n+                workflow.setExternalWorkflowReference(rs.getString(\"WF_EXTERNAL_REFERENCE\"));\n+                Blob metadatablob = rs.getBlob(\"WF_METADATA\");\n+\n+                byte[] metadataByte;\n+\n+                if(metadatablob != null) {\n+                    metadataByte = metadatablob.getBytes(1L, (int) metadatablob.length());\n+                    InputStream targetStream = new ByteArrayInputStream(metadataByte);\n+                    String metadata = APIMgtDBUtil.getStringFromInputStream(targetStream);\n+                    Gson g = new Gson();\n+                    JSONObject json = g.fromJson(metadata, JSONObject.class);\n+                    workflow.setMetadata(json);\n+                } else {\n+                    JSONObject json=new JSONObject();\n+                    workflow.setMetadata(json);\n+                }\n+            }\n+        } catch (SQLException e) {\n+            handleException(\"Error when retriving the workflow details\" , e);\n+        } finally {\n+            APIMgtDBUtil.closeAllConnections(prepStmt, connection, rs);\n+        }\n+        return workflow;\n+    }\n+\n+    /**\n+     * Get the Pending workflow Requests using WorkflowType for a particular tenant\n+     *\n+     * @param workflowType\n+     * @param status\n+     * @param tenantDomain\n+     * @return\n+     */\n+\n+    public Workflow[] getworkflows(String workflowType ,String status ,String tenantDomain) throws APIManagementException {\n+\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+        ResultSet rs = null;\n+\n+        Workflow[] workflows = null;\n+\n+        String sqlQuery;\n+\n+        if (workflowType != null){\n+            sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS_BY_WORKFLOW_TYPE;\n+        } else {\n+            sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS;\n+        }\n+\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            prepStmt = connection.prepareStatement(sqlQuery);\n+\n+            if (workflowType != null){\n+                prepStmt.setString(1, workflowType);\n+                prepStmt.setString( 2, status);\n+                prepStmt.setString( 3, tenantDomain);\n+\n+            } else {\n+                prepStmt.setString( 1, status);\n+                prepStmt.setString( 2, tenantDomain);\n+            }\n+\n+            rs = prepStmt.executeQuery();\n+\n+            ArrayList<Workflow> workflowsList = new ArrayList<Workflow>();\n+            Workflow workflow;\n+            while (rs.next()) {\n+                workflow = new Workflow();\n+                workflow.setWorkflowId(rs.getInt(\"WF_ID\"));\n+                workflow.setWorkflowReference(rs.getString(\"WF_REFERENCE\"));\n+                workflow.setWorkflowType(rs.getString(\"WF_TYPE\"));\n+\n+                String workflowstatus =rs.getString(\"WF_STATUS\");\n+                workflow.setStatus(org.wso2.carbon.apimgt.api.WorkflowStatus.valueOf(workflowstatus));\n+\n+                workflow.setCreatedTime(rs.getTimestamp(\"WF_CREATED_TIME\").toString());\n+                workflow.setUpdatedTime(rs.getTimestamp(\"WF_UPDATED_TIME\").toString());\n+\n+                workflow.setWorkflowStatusDesc(rs.getString(\"WF_STATUS_DESC\"));\n+                workflow.setTenantId(rs.getInt(\"TENANT_ID\"));\n+                workflow.setTenantDomain(rs.getString(\"TENANT_DOMAIN\"));\n+                workflow.setExternalWorkflowReference(rs.getString(\"WF_EXTERNAL_REFERENCE\"));\n+                workflow.setWorkflowDescription(rs.getString(\"WF_STATUS_DESC\"));\n+                Blob metadataBlob = rs.getBlob(\"WF_METADATA\");\n+                Blob propertiesBlob = rs.getBlob(\"WF_PROPERTIES\");\n+\n+                byte[] metadataByte;\n+\n+                if(metadataBlob != null) {\n+                    metadataByte = metadataBlob.getBytes(1L, (int) metadataBlob.length());\n+                    InputStream targetStream = new ByteArrayInputStream(metadataByte);\n+                    String metadata = APIMgtDBUtil.getStringFromInputStream(targetStream);\n+                    Gson g = new Gson();\n+\n+                    JSONObject json = g.fromJson(metadata, JSONObject.class);\n+                    workflow.setMetadata(json);\n+                } else {\n+                    JSONObject json = new JSONObject();\n+                    workflow.setMetadata(json);\n+                }\n+\n+                byte[] propertiesByte;\n+\n+                if(propertiesBlob != null) {\n+                    propertiesByte = propertiesBlob.getBytes(1L, (int) propertiesBlob.length());\n+                    InputStream propertiesTargetStream = new ByteArrayInputStream(propertiesByte);\n+                    String properties = APIMgtDBUtil.getStringFromInputStream(propertiesTargetStream);\n+                    Gson g = new Gson();\n+\n+                    JSONObject json = g.fromJson(properties, JSONObject.class);\n+                    workflow.setProperties(json);\n+                } else {\n+                    JSONObject json = new JSONObject();\n+                    workflow.setProperties(json);\n+                }\n+\n+                workflowsList.add(workflow);\n+            }\n+            workflows = workflowsList.toArray(new Workflow[workflowsList.size()]);\n+        } catch (SQLException e) {\n+            handleException(\"Error when retrieve all the workflow details\" , e);\n+        } finally {\n+            APIMgtDBUtil.closeAllConnections(prepStmt, connection, rs);\n+        }\n+        return workflows;\n+    }\n+\n+    /**\n+     * Get the Pending workflow Request using ExternalWorkflowReference for a particular tenant\n+     *\n+     * @param externelWorkflowRef\n+     * @param status\n+     * @param tenantDomain\n+     * @return\n+     */\n+\n+    public Workflow getworkflowReferenceByExternalWorkflowReferenceID(String externelWorkflowRef, String status ,\n+                                                                      String tenantDomain) throws APIManagementException {\n+\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+        ResultSet rs = null;\n+\n+        Workflow workflow=new Workflow();\n+\n+        String sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS_BY_EXTERNAL_WORKFLOW_REFERENCE;\n+\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            prepStmt = connection.prepareStatement(sqlQuery);\n+            prepStmt.setString(1, externelWorkflowRef);\n+            prepStmt.setString(2, status);\n+            prepStmt.setString(3, tenantDomain);\n+\n+            rs = prepStmt.executeQuery();\n+\n+            while (rs.next()) {\n+\n+                workflow.setWorkflowId(rs.getInt(\"WF_ID\"));\n+                workflow.setWorkflowReference(rs.getString(\"WF_REFERENCE\"));\n+                workflow.setWorkflowType(rs.getString(\"WF_TYPE\"));\n+\n+                String workflowstatus =rs.getString(\"WF_STATUS\");\n+                workflow.setStatus(org.wso2.carbon.apimgt.api.WorkflowStatus.valueOf(workflowstatus));\n+\n+                workflow.setCreatedTime(rs.getTimestamp(\"WF_CREATED_TIME\").toString());\n+                workflow.setUpdatedTime(rs.getTimestamp(\"WF_UPDATED_TIME\").toString());\n+\n+                workflow.setWorkflowDescription(rs.getString(\"WF_STATUS_DESC\"));\n+                workflow.setTenantId(rs.getInt(\"TENANT_ID\"));\n+                workflow.setTenantDomain(rs.getString(\"TENANT_DOMAIN\"));\n+                workflow.setExternalWorkflowReference(rs.getString(\"WF_EXTERNAL_REFERENCE\"));\n+                Blob metadataBlob = rs.getBlob(\"WF_METADATA\");\n+                Blob propertiesBlob = rs.getBlob(\"WF_PROPERTIES\");\n+\n+                byte[] metadataByte;\n+\n+                if(metadataBlob != null) {\n+                    metadataByte = metadataBlob.getBytes(1L, (int) metadataBlob.length());\n+                    InputStream targetStream = new ByteArrayInputStream(metadataByte);\n+                    String metadata = APIMgtDBUtil.getStringFromInputStream(targetStream);\n+                    Gson g = new Gson();\n+\n+                    JSONObject json = g.fromJson(metadata, JSONObject.class);\n+                    workflow.setMetadata(json);\n+                } else {\n+                    JSONObject json=new JSONObject();\n+                    workflow.setMetadata(json);\n+                }\n+\n+                byte[] propertiesByte;\n+\n+                if(propertiesBlob != null) {\n+                    propertiesByte = propertiesBlob.getBytes(1L, (int) propertiesBlob.length());\n+                    InputStream propertiesTargetStream = new ByteArrayInputStream(propertiesByte);\n+                    String properties = APIMgtDBUtil.getStringFromInputStream(propertiesTargetStream);\n+                    Gson g = new Gson();\n+                    JSONObject json1 = g.fromJson(properties, JSONObject.class);", "originalCommit": "6bf3e5572d4f5d21b3b4f4cb596a1eeea3348002", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyMTc3MA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r406621770", "bodyText": "put a meaningful variable name", "author": "chamilaadhi", "createdAt": "2020-04-10T06:26:46Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/constants/SQLConstants.java", "diffHunk": "@@ -1869,6 +1869,34 @@\n     public static final String GET_ALL_WORKFLOW_ENTRY_FROM_INTERNAL_REF_SQL =\n             \"SELECT * FROM AM_WORKFLOWS WHERE WF_REFERENCE=? AND WF_TYPE=?\";\n \n+    public static final String ADD_PAYLOAD_SQL =\n+            \" UPDATE AM_WORKFLOWS \" +\n+                    \" SET \" +\n+                    \"   WF_METADATA = ?, \" +\n+                    \"   WF_PROPERTIES = ?, \" +\n+                    \"   WF_STATUS_DESC = ? \" +\n+                    \" WHERE \" +\n+                    \"    WF_EXTERNAL_REFERENCE = ?\";\n+\n+    public static final String DELETE_WORKFLOW_REQUEST_SQL=\n+            \" DELETE FROM AM_WORKFLOWS WHERE WF_EXTERNAL_REFERENCE = ?\";\n+\n+    public static final String GET_ALL_WORKFLOW_DETAILS_BY_EWR =", "originalCommit": "6bf3e5572d4f5d21b3b4f4cb596a1eeea3348002", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyMTg4OQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r406621889", "bodyText": "Add license header", "author": "chamilaadhi", "createdAt": "2020-04-10T06:27:16Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/workflow/APIStateChangeApprovalWorkflowExecutor.java", "diffHunk": "@@ -0,0 +1,223 @@\n+package org.wso2.carbon.apimgt.impl.workflow;", "originalCommit": "6bf3e5572d4f5d21b3b4f4cb596a1eeea3348002", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDc5MjI0MQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r410792241", "bodyText": "fixed with e00fe40", "author": "SahanHerath", "createdAt": "2020-04-19T02:03:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyMTg4OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDc5NjI3NQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r410796275", "bodyText": "changed year with 68b7419", "author": "SahanHerath", "createdAt": "2020-04-19T02:33:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyMTg4OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyMjA2Mw==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r406622063", "bodyText": "don't use wildcard import.", "author": "chamilaadhi", "createdAt": "2020-04-10T06:27:50Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/workflow/APIStateChangeApprovalWorkflowExecutor.java", "diffHunk": "@@ -0,0 +1,223 @@\n+package org.wso2.carbon.apimgt.impl.workflow;\n+\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+import org.wso2.carbon.apimgt.api.APIManagementException;\n+import org.wso2.carbon.apimgt.api.WorkflowResponse;\n+import org.wso2.carbon.apimgt.api.model.APIIdentifier;\n+import org.wso2.carbon.apimgt.api.model.Workflow;\n+import org.wso2.carbon.apimgt.impl.APIConstants;\n+import org.wso2.carbon.apimgt.impl.dao.ApiMgtDAO;\n+import org.wso2.carbon.apimgt.impl.dto.WorkflowDTO;\n+import org.wso2.carbon.apimgt.impl.internal.ServiceReferenceHolder;\n+import org.wso2.carbon.apimgt.impl.utils.APIUtil;\n+import org.wso2.carbon.context.PrivilegedCarbonContext;\n+import org.wso2.carbon.governance.api.generic.dataobjects.GenericArtifact;\n+import org.wso2.carbon.registry.core.Registry;\n+import org.wso2.carbon.registry.core.exceptions.RegistryException;\n+\n+import java.util.*;", "originalCommit": "6bf3e5572d4f5d21b3b4f4cb596a1eeea3348002", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyMjE0MA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r406622140", "bodyText": "where is the class description???", "author": "chamilaadhi", "createdAt": "2020-04-10T06:28:08Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/workflow/APIStateChangeApprovalWorkflowExecutor.java", "diffHunk": "@@ -0,0 +1,223 @@\n+package org.wso2.carbon.apimgt.impl.workflow;\n+\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+import org.wso2.carbon.apimgt.api.APIManagementException;\n+import org.wso2.carbon.apimgt.api.WorkflowResponse;\n+import org.wso2.carbon.apimgt.api.model.APIIdentifier;\n+import org.wso2.carbon.apimgt.api.model.Workflow;\n+import org.wso2.carbon.apimgt.impl.APIConstants;\n+import org.wso2.carbon.apimgt.impl.dao.ApiMgtDAO;\n+import org.wso2.carbon.apimgt.impl.dto.WorkflowDTO;\n+import org.wso2.carbon.apimgt.impl.internal.ServiceReferenceHolder;\n+import org.wso2.carbon.apimgt.impl.utils.APIUtil;\n+import org.wso2.carbon.context.PrivilegedCarbonContext;\n+import org.wso2.carbon.governance.api.generic.dataobjects.GenericArtifact;\n+import org.wso2.carbon.registry.core.Registry;\n+import org.wso2.carbon.registry.core.exceptions.RegistryException;\n+\n+import java.util.*;\n+\n+public class APIStateChangeApprovalWorkflowExecutor extends WorkflowExecutor{", "originalCommit": "6bf3e5572d4f5d21b3b4f4cb596a1eeea3348002", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDc5MjQ3NA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r410792474", "bodyText": "fixed with e00fe40", "author": "SahanHerath", "createdAt": "2020-04-19T02:04:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyMjE0MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyMjM1Mg==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r406622352", "bodyText": "format the whole class and remove unnecessary spaces between statements", "author": "chamilaadhi", "createdAt": "2020-04-10T06:28:52Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/workflow/APIStateChangeApprovalWorkflowExecutor.java", "diffHunk": "@@ -0,0 +1,223 @@\n+package org.wso2.carbon.apimgt.impl.workflow;\n+\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+import org.wso2.carbon.apimgt.api.APIManagementException;\n+import org.wso2.carbon.apimgt.api.WorkflowResponse;\n+import org.wso2.carbon.apimgt.api.model.APIIdentifier;\n+import org.wso2.carbon.apimgt.api.model.Workflow;\n+import org.wso2.carbon.apimgt.impl.APIConstants;\n+import org.wso2.carbon.apimgt.impl.dao.ApiMgtDAO;\n+import org.wso2.carbon.apimgt.impl.dto.WorkflowDTO;\n+import org.wso2.carbon.apimgt.impl.internal.ServiceReferenceHolder;\n+import org.wso2.carbon.apimgt.impl.utils.APIUtil;\n+import org.wso2.carbon.context.PrivilegedCarbonContext;\n+import org.wso2.carbon.governance.api.generic.dataobjects.GenericArtifact;\n+import org.wso2.carbon.registry.core.Registry;\n+import org.wso2.carbon.registry.core.exceptions.RegistryException;\n+\n+import java.util.*;\n+\n+public class APIStateChangeApprovalWorkflowExecutor extends WorkflowExecutor{\n+\n+    private static final Log log = LogFactory.getLog(APIStateChangeWSWorkflowExecutor.class);", "originalCommit": "6bf3e5572d4f5d21b3b4f4cb596a1eeea3348002", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDc5MjUyMw==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r410792523", "bodyText": "fixed with e00fe40", "author": "SahanHerath", "createdAt": "2020-04-19T02:05:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyMjM1Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyMjU3Mg==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r406622572", "bodyText": "lets put one debug log", "author": "chamilaadhi", "createdAt": "2020-04-10T06:29:30Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/workflow/APIStateChangeApprovalWorkflowExecutor.java", "diffHunk": "@@ -0,0 +1,223 @@\n+package org.wso2.carbon.apimgt.impl.workflow;\n+\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+import org.wso2.carbon.apimgt.api.APIManagementException;\n+import org.wso2.carbon.apimgt.api.WorkflowResponse;\n+import org.wso2.carbon.apimgt.api.model.APIIdentifier;\n+import org.wso2.carbon.apimgt.api.model.Workflow;\n+import org.wso2.carbon.apimgt.impl.APIConstants;\n+import org.wso2.carbon.apimgt.impl.dao.ApiMgtDAO;\n+import org.wso2.carbon.apimgt.impl.dto.WorkflowDTO;\n+import org.wso2.carbon.apimgt.impl.internal.ServiceReferenceHolder;\n+import org.wso2.carbon.apimgt.impl.utils.APIUtil;\n+import org.wso2.carbon.context.PrivilegedCarbonContext;\n+import org.wso2.carbon.governance.api.generic.dataobjects.GenericArtifact;\n+import org.wso2.carbon.registry.core.Registry;\n+import org.wso2.carbon.registry.core.exceptions.RegistryException;\n+\n+import java.util.*;\n+\n+public class APIStateChangeApprovalWorkflowExecutor extends WorkflowExecutor{\n+\n+    private static final Log log = LogFactory.getLog(APIStateChangeWSWorkflowExecutor.class);\n+    private String stateList;\n+\n+    public String getStateList() {\n+        return stateList;\n+    }\n+\n+    public void setStateList(String stateList) {\n+        this.stateList = stateList;\n+    }\n+\n+\n+    @Override\n+    public String getWorkflowType() {\n+        return WorkflowConstants.WF_TYPE_AM_API_STATE;\n+    }\n+\n+    @Override\n+    public List<WorkflowDTO> getWorkflowDetails(String workflowStatus) throws WorkflowException {\n+        return Collections.emptyList();\n+    }\n+\n+    @Override\n+    public WorkflowResponse execute(WorkflowDTO workflowDTO) throws WorkflowException {\n+\n+        if (log.isDebugEnabled()) {\n+            log.debug(\"Executing API State change Workflow.\");\n+            log.debug(\"Execute workflowDTO \" + workflowDTO.toString());", "originalCommit": "6bf3e5572d4f5d21b3b4f4cb596a1eeea3348002", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyMjg3Mw==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r406622873", "bodyText": "use simple s in 'State'", "author": "chamilaadhi", "createdAt": "2020-04-10T06:30:46Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/workflow/APIStateChangeApprovalWorkflowExecutor.java", "diffHunk": "@@ -0,0 +1,223 @@\n+package org.wso2.carbon.apimgt.impl.workflow;\n+\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+import org.wso2.carbon.apimgt.api.APIManagementException;\n+import org.wso2.carbon.apimgt.api.WorkflowResponse;\n+import org.wso2.carbon.apimgt.api.model.APIIdentifier;\n+import org.wso2.carbon.apimgt.api.model.Workflow;\n+import org.wso2.carbon.apimgt.impl.APIConstants;\n+import org.wso2.carbon.apimgt.impl.dao.ApiMgtDAO;\n+import org.wso2.carbon.apimgt.impl.dto.WorkflowDTO;\n+import org.wso2.carbon.apimgt.impl.internal.ServiceReferenceHolder;\n+import org.wso2.carbon.apimgt.impl.utils.APIUtil;\n+import org.wso2.carbon.context.PrivilegedCarbonContext;\n+import org.wso2.carbon.governance.api.generic.dataobjects.GenericArtifact;\n+import org.wso2.carbon.registry.core.Registry;\n+import org.wso2.carbon.registry.core.exceptions.RegistryException;\n+\n+import java.util.*;\n+\n+public class APIStateChangeApprovalWorkflowExecutor extends WorkflowExecutor{\n+\n+    private static final Log log = LogFactory.getLog(APIStateChangeWSWorkflowExecutor.class);\n+    private String stateList;\n+\n+    public String getStateList() {\n+        return stateList;\n+    }\n+\n+    public void setStateList(String stateList) {\n+        this.stateList = stateList;\n+    }\n+\n+\n+    @Override\n+    public String getWorkflowType() {\n+        return WorkflowConstants.WF_TYPE_AM_API_STATE;\n+    }\n+\n+    @Override\n+    public List<WorkflowDTO> getWorkflowDetails(String workflowStatus) throws WorkflowException {\n+        return Collections.emptyList();\n+    }\n+\n+    @Override\n+    public WorkflowResponse execute(WorkflowDTO workflowDTO) throws WorkflowException {\n+\n+        if (log.isDebugEnabled()) {\n+            log.debug(\"Executing API State change Workflow.\");\n+            log.debug(\"Execute workflowDTO \" + workflowDTO.toString());\n+        }\n+\n+        if (stateList != null) {\n+            Map<String, List<String>> stateActionMap = getSelectedStatesToApprove();\n+            APIStateWorkflowDTO apiStateWorkFlowDTO = (APIStateWorkflowDTO) workflowDTO;\n+\n+            if (stateActionMap.containsKey(apiStateWorkFlowDTO.getApiCurrentState().toUpperCase())\n+                    && stateActionMap.get(apiStateWorkFlowDTO.getApiCurrentState().toUpperCase())\n+                    .contains(apiStateWorkFlowDTO.getApiLCAction())) {\n+\n+                String callBackURL = apiStateWorkFlowDTO.getCallbackUrl();\n+                String message = \"Approval request for API State change action '\" + apiStateWorkFlowDTO.getApiLCAction()", "originalCommit": "6bf3e5572d4f5d21b3b4f4cb596a1eeea3348002", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyMzM5Nw==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r406623397", "bodyText": "this property is not needed. you don't have to set any . don't set any value", "author": "chamilaadhi", "createdAt": "2020-04-10T06:33:05Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/workflow/APIStateChangeApprovalWorkflowExecutor.java", "diffHunk": "@@ -0,0 +1,223 @@\n+package org.wso2.carbon.apimgt.impl.workflow;\n+\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+import org.wso2.carbon.apimgt.api.APIManagementException;\n+import org.wso2.carbon.apimgt.api.WorkflowResponse;\n+import org.wso2.carbon.apimgt.api.model.APIIdentifier;\n+import org.wso2.carbon.apimgt.api.model.Workflow;\n+import org.wso2.carbon.apimgt.impl.APIConstants;\n+import org.wso2.carbon.apimgt.impl.dao.ApiMgtDAO;\n+import org.wso2.carbon.apimgt.impl.dto.WorkflowDTO;\n+import org.wso2.carbon.apimgt.impl.internal.ServiceReferenceHolder;\n+import org.wso2.carbon.apimgt.impl.utils.APIUtil;\n+import org.wso2.carbon.context.PrivilegedCarbonContext;\n+import org.wso2.carbon.governance.api.generic.dataobjects.GenericArtifact;\n+import org.wso2.carbon.registry.core.Registry;\n+import org.wso2.carbon.registry.core.exceptions.RegistryException;\n+\n+import java.util.*;\n+\n+public class APIStateChangeApprovalWorkflowExecutor extends WorkflowExecutor{\n+\n+    private static final Log log = LogFactory.getLog(APIStateChangeWSWorkflowExecutor.class);\n+    private String stateList;\n+\n+    public String getStateList() {\n+        return stateList;\n+    }\n+\n+    public void setStateList(String stateList) {\n+        this.stateList = stateList;\n+    }\n+\n+\n+    @Override\n+    public String getWorkflowType() {\n+        return WorkflowConstants.WF_TYPE_AM_API_STATE;\n+    }\n+\n+    @Override\n+    public List<WorkflowDTO> getWorkflowDetails(String workflowStatus) throws WorkflowException {\n+        return Collections.emptyList();\n+    }\n+\n+    @Override\n+    public WorkflowResponse execute(WorkflowDTO workflowDTO) throws WorkflowException {\n+\n+        if (log.isDebugEnabled()) {\n+            log.debug(\"Executing API State change Workflow.\");\n+            log.debug(\"Execute workflowDTO \" + workflowDTO.toString());\n+        }\n+\n+        if (stateList != null) {\n+            Map<String, List<String>> stateActionMap = getSelectedStatesToApprove();\n+            APIStateWorkflowDTO apiStateWorkFlowDTO = (APIStateWorkflowDTO) workflowDTO;\n+\n+            if (stateActionMap.containsKey(apiStateWorkFlowDTO.getApiCurrentState().toUpperCase())\n+                    && stateActionMap.get(apiStateWorkFlowDTO.getApiCurrentState().toUpperCase())\n+                    .contains(apiStateWorkFlowDTO.getApiLCAction())) {\n+\n+                String callBackURL = apiStateWorkFlowDTO.getCallbackUrl();\n+                String message = \"Approval request for API State change action '\" + apiStateWorkFlowDTO.getApiLCAction()\n+                        + \"' from '\" + apiStateWorkFlowDTO.getApiCurrentState() + \"' state for the API '\"\n+                        + apiStateWorkFlowDTO.getApiName() + \" : \" + apiStateWorkFlowDTO.getApiVersion() + \"' by \"\n+                        + apiStateWorkFlowDTO.getApiProvider() + \"\";\n+\n+                apiStateWorkFlowDTO.setWorkflowDescription(message);\n+\n+                apiStateWorkFlowDTO.setMetadata(\"ClientId\", apiStateWorkFlowDTO.getClientId());\n+                apiStateWorkFlowDTO.setMetadata(\"ClientSecret\", apiStateWorkFlowDTO.getClientSecret());\n+                apiStateWorkFlowDTO.setMetadata(\"Scope\", apiStateWorkFlowDTO.getScope());\n+                apiStateWorkFlowDTO.setMetadata(\"TokenAPI\", apiStateWorkFlowDTO.getTokenAPI());\n+                apiStateWorkFlowDTO.setMetadata(\"CurrentState\", apiStateWorkFlowDTO.getApiCurrentState());\n+                apiStateWorkFlowDTO.setMetadata(\"Action\", apiStateWorkFlowDTO.getApiLCAction());\n+                apiStateWorkFlowDTO.setMetadata(\"ApiName\", apiStateWorkFlowDTO.getApiName());\n+                apiStateWorkFlowDTO.setMetadata(\"ApiVersion\", apiStateWorkFlowDTO.getApiVersion());\n+                apiStateWorkFlowDTO.setMetadata(\"ApiProvider\", apiStateWorkFlowDTO.getApiProvider());\n+                apiStateWorkFlowDTO.setMetadata(\"workflowExternalRef\", apiStateWorkFlowDTO.getExternalWorkflowReference());\n+                apiStateWorkFlowDTO.setMetadata(\"Invoker\", apiStateWorkFlowDTO.getInvoker());\n+                apiStateWorkFlowDTO.setMetadata(\"TenantId\", String.valueOf(apiStateWorkFlowDTO.getTenantId()));\n+                apiStateWorkFlowDTO.setMetadata(\"callBackURL\", callBackURL != null ? callBackURL : \"?\");\n+\n+                apiStateWorkFlowDTO.setProperties(\"Workflow Process\",\"Application Creation\");", "originalCommit": "6bf3e5572d4f5d21b3b4f4cb596a1eeea3348002", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyMzU4NA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r406623584", "bodyText": "Error message is not complete. see the end of the message", "author": "chamilaadhi", "createdAt": "2020-04-10T06:33:49Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/workflow/APIStateChangeApprovalWorkflowExecutor.java", "diffHunk": "@@ -0,0 +1,223 @@\n+package org.wso2.carbon.apimgt.impl.workflow;\n+\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+import org.wso2.carbon.apimgt.api.APIManagementException;\n+import org.wso2.carbon.apimgt.api.WorkflowResponse;\n+import org.wso2.carbon.apimgt.api.model.APIIdentifier;\n+import org.wso2.carbon.apimgt.api.model.Workflow;\n+import org.wso2.carbon.apimgt.impl.APIConstants;\n+import org.wso2.carbon.apimgt.impl.dao.ApiMgtDAO;\n+import org.wso2.carbon.apimgt.impl.dto.WorkflowDTO;\n+import org.wso2.carbon.apimgt.impl.internal.ServiceReferenceHolder;\n+import org.wso2.carbon.apimgt.impl.utils.APIUtil;\n+import org.wso2.carbon.context.PrivilegedCarbonContext;\n+import org.wso2.carbon.governance.api.generic.dataobjects.GenericArtifact;\n+import org.wso2.carbon.registry.core.Registry;\n+import org.wso2.carbon.registry.core.exceptions.RegistryException;\n+\n+import java.util.*;\n+\n+public class APIStateChangeApprovalWorkflowExecutor extends WorkflowExecutor{\n+\n+    private static final Log log = LogFactory.getLog(APIStateChangeWSWorkflowExecutor.class);\n+    private String stateList;\n+\n+    public String getStateList() {\n+        return stateList;\n+    }\n+\n+    public void setStateList(String stateList) {\n+        this.stateList = stateList;\n+    }\n+\n+\n+    @Override\n+    public String getWorkflowType() {\n+        return WorkflowConstants.WF_TYPE_AM_API_STATE;\n+    }\n+\n+    @Override\n+    public List<WorkflowDTO> getWorkflowDetails(String workflowStatus) throws WorkflowException {\n+        return Collections.emptyList();\n+    }\n+\n+    @Override\n+    public WorkflowResponse execute(WorkflowDTO workflowDTO) throws WorkflowException {\n+\n+        if (log.isDebugEnabled()) {\n+            log.debug(\"Executing API State change Workflow.\");\n+            log.debug(\"Execute workflowDTO \" + workflowDTO.toString());\n+        }\n+\n+        if (stateList != null) {\n+            Map<String, List<String>> stateActionMap = getSelectedStatesToApprove();\n+            APIStateWorkflowDTO apiStateWorkFlowDTO = (APIStateWorkflowDTO) workflowDTO;\n+\n+            if (stateActionMap.containsKey(apiStateWorkFlowDTO.getApiCurrentState().toUpperCase())\n+                    && stateActionMap.get(apiStateWorkFlowDTO.getApiCurrentState().toUpperCase())\n+                    .contains(apiStateWorkFlowDTO.getApiLCAction())) {\n+\n+                String callBackURL = apiStateWorkFlowDTO.getCallbackUrl();\n+                String message = \"Approval request for API State change action '\" + apiStateWorkFlowDTO.getApiLCAction()\n+                        + \"' from '\" + apiStateWorkFlowDTO.getApiCurrentState() + \"' state for the API '\"\n+                        + apiStateWorkFlowDTO.getApiName() + \" : \" + apiStateWorkFlowDTO.getApiVersion() + \"' by \"\n+                        + apiStateWorkFlowDTO.getApiProvider() + \"\";\n+\n+                apiStateWorkFlowDTO.setWorkflowDescription(message);\n+\n+                apiStateWorkFlowDTO.setMetadata(\"ClientId\", apiStateWorkFlowDTO.getClientId());\n+                apiStateWorkFlowDTO.setMetadata(\"ClientSecret\", apiStateWorkFlowDTO.getClientSecret());\n+                apiStateWorkFlowDTO.setMetadata(\"Scope\", apiStateWorkFlowDTO.getScope());\n+                apiStateWorkFlowDTO.setMetadata(\"TokenAPI\", apiStateWorkFlowDTO.getTokenAPI());\n+                apiStateWorkFlowDTO.setMetadata(\"CurrentState\", apiStateWorkFlowDTO.getApiCurrentState());\n+                apiStateWorkFlowDTO.setMetadata(\"Action\", apiStateWorkFlowDTO.getApiLCAction());\n+                apiStateWorkFlowDTO.setMetadata(\"ApiName\", apiStateWorkFlowDTO.getApiName());\n+                apiStateWorkFlowDTO.setMetadata(\"ApiVersion\", apiStateWorkFlowDTO.getApiVersion());\n+                apiStateWorkFlowDTO.setMetadata(\"ApiProvider\", apiStateWorkFlowDTO.getApiProvider());\n+                apiStateWorkFlowDTO.setMetadata(\"workflowExternalRef\", apiStateWorkFlowDTO.getExternalWorkflowReference());\n+                apiStateWorkFlowDTO.setMetadata(\"Invoker\", apiStateWorkFlowDTO.getInvoker());\n+                apiStateWorkFlowDTO.setMetadata(\"TenantId\", String.valueOf(apiStateWorkFlowDTO.getTenantId()));\n+                apiStateWorkFlowDTO.setMetadata(\"callBackURL\", callBackURL != null ? callBackURL : \"?\");\n+\n+                apiStateWorkFlowDTO.setProperties(\"Workflow Process\",\"Application Creation\");\n+\n+                super.execute(workflowDTO);\n+\n+                if (log.isDebugEnabled()) {\n+                    log.debug(\"APIStateChange payload: \");\n+                }\n+\n+            } else {\n+                // For any other states, act as simple workflow executor.\n+                workflowDTO.setStatus(WorkflowStatus.APPROVED);\n+                // calling super.complete() instead of complete() to act as the simpleworkflow executor\n+                super.complete(workflowDTO);\n+            }\n+        } else {\n+            String msg = \"State change list is not provided. Please check <stateList> element in \";", "originalCommit": "6bf3e5572d4f5d21b3b4f4cb596a1eeea3348002", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyMzY3Ng==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r406623676", "bodyText": "where is the payload??", "author": "chamilaadhi", "createdAt": "2020-04-10T06:34:07Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/workflow/APIStateChangeApprovalWorkflowExecutor.java", "diffHunk": "@@ -0,0 +1,223 @@\n+package org.wso2.carbon.apimgt.impl.workflow;\n+\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+import org.wso2.carbon.apimgt.api.APIManagementException;\n+import org.wso2.carbon.apimgt.api.WorkflowResponse;\n+import org.wso2.carbon.apimgt.api.model.APIIdentifier;\n+import org.wso2.carbon.apimgt.api.model.Workflow;\n+import org.wso2.carbon.apimgt.impl.APIConstants;\n+import org.wso2.carbon.apimgt.impl.dao.ApiMgtDAO;\n+import org.wso2.carbon.apimgt.impl.dto.WorkflowDTO;\n+import org.wso2.carbon.apimgt.impl.internal.ServiceReferenceHolder;\n+import org.wso2.carbon.apimgt.impl.utils.APIUtil;\n+import org.wso2.carbon.context.PrivilegedCarbonContext;\n+import org.wso2.carbon.governance.api.generic.dataobjects.GenericArtifact;\n+import org.wso2.carbon.registry.core.Registry;\n+import org.wso2.carbon.registry.core.exceptions.RegistryException;\n+\n+import java.util.*;\n+\n+public class APIStateChangeApprovalWorkflowExecutor extends WorkflowExecutor{\n+\n+    private static final Log log = LogFactory.getLog(APIStateChangeWSWorkflowExecutor.class);\n+    private String stateList;\n+\n+    public String getStateList() {\n+        return stateList;\n+    }\n+\n+    public void setStateList(String stateList) {\n+        this.stateList = stateList;\n+    }\n+\n+\n+    @Override\n+    public String getWorkflowType() {\n+        return WorkflowConstants.WF_TYPE_AM_API_STATE;\n+    }\n+\n+    @Override\n+    public List<WorkflowDTO> getWorkflowDetails(String workflowStatus) throws WorkflowException {\n+        return Collections.emptyList();\n+    }\n+\n+    @Override\n+    public WorkflowResponse execute(WorkflowDTO workflowDTO) throws WorkflowException {\n+\n+        if (log.isDebugEnabled()) {\n+            log.debug(\"Executing API State change Workflow.\");\n+            log.debug(\"Execute workflowDTO \" + workflowDTO.toString());\n+        }\n+\n+        if (stateList != null) {\n+            Map<String, List<String>> stateActionMap = getSelectedStatesToApprove();\n+            APIStateWorkflowDTO apiStateWorkFlowDTO = (APIStateWorkflowDTO) workflowDTO;\n+\n+            if (stateActionMap.containsKey(apiStateWorkFlowDTO.getApiCurrentState().toUpperCase())\n+                    && stateActionMap.get(apiStateWorkFlowDTO.getApiCurrentState().toUpperCase())\n+                    .contains(apiStateWorkFlowDTO.getApiLCAction())) {\n+\n+                String callBackURL = apiStateWorkFlowDTO.getCallbackUrl();\n+                String message = \"Approval request for API State change action '\" + apiStateWorkFlowDTO.getApiLCAction()\n+                        + \"' from '\" + apiStateWorkFlowDTO.getApiCurrentState() + \"' state for the API '\"\n+                        + apiStateWorkFlowDTO.getApiName() + \" : \" + apiStateWorkFlowDTO.getApiVersion() + \"' by \"\n+                        + apiStateWorkFlowDTO.getApiProvider() + \"\";\n+\n+                apiStateWorkFlowDTO.setWorkflowDescription(message);\n+\n+                apiStateWorkFlowDTO.setMetadata(\"ClientId\", apiStateWorkFlowDTO.getClientId());\n+                apiStateWorkFlowDTO.setMetadata(\"ClientSecret\", apiStateWorkFlowDTO.getClientSecret());\n+                apiStateWorkFlowDTO.setMetadata(\"Scope\", apiStateWorkFlowDTO.getScope());\n+                apiStateWorkFlowDTO.setMetadata(\"TokenAPI\", apiStateWorkFlowDTO.getTokenAPI());\n+                apiStateWorkFlowDTO.setMetadata(\"CurrentState\", apiStateWorkFlowDTO.getApiCurrentState());\n+                apiStateWorkFlowDTO.setMetadata(\"Action\", apiStateWorkFlowDTO.getApiLCAction());\n+                apiStateWorkFlowDTO.setMetadata(\"ApiName\", apiStateWorkFlowDTO.getApiName());\n+                apiStateWorkFlowDTO.setMetadata(\"ApiVersion\", apiStateWorkFlowDTO.getApiVersion());\n+                apiStateWorkFlowDTO.setMetadata(\"ApiProvider\", apiStateWorkFlowDTO.getApiProvider());\n+                apiStateWorkFlowDTO.setMetadata(\"workflowExternalRef\", apiStateWorkFlowDTO.getExternalWorkflowReference());\n+                apiStateWorkFlowDTO.setMetadata(\"Invoker\", apiStateWorkFlowDTO.getInvoker());\n+                apiStateWorkFlowDTO.setMetadata(\"TenantId\", String.valueOf(apiStateWorkFlowDTO.getTenantId()));\n+                apiStateWorkFlowDTO.setMetadata(\"callBackURL\", callBackURL != null ? callBackURL : \"?\");\n+\n+                apiStateWorkFlowDTO.setProperties(\"Workflow Process\",\"Application Creation\");\n+\n+                super.execute(workflowDTO);\n+\n+                if (log.isDebugEnabled()) {\n+                    log.debug(\"APIStateChange payload: \");", "originalCommit": "6bf3e5572d4f5d21b3b4f4cb596a1eeea3348002", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyNDYxNg==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r406624616", "bodyText": "You don't have to set all this information as metadata. ClientId, ClientSecret, Scope, TokenAPI, workflowExternalRef, callBackURL are not needed. plz remove them", "author": "chamilaadhi", "createdAt": "2020-04-10T06:37:51Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/workflow/APIStateChangeApprovalWorkflowExecutor.java", "diffHunk": "@@ -0,0 +1,223 @@\n+package org.wso2.carbon.apimgt.impl.workflow;\n+\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+import org.wso2.carbon.apimgt.api.APIManagementException;\n+import org.wso2.carbon.apimgt.api.WorkflowResponse;\n+import org.wso2.carbon.apimgt.api.model.APIIdentifier;\n+import org.wso2.carbon.apimgt.api.model.Workflow;\n+import org.wso2.carbon.apimgt.impl.APIConstants;\n+import org.wso2.carbon.apimgt.impl.dao.ApiMgtDAO;\n+import org.wso2.carbon.apimgt.impl.dto.WorkflowDTO;\n+import org.wso2.carbon.apimgt.impl.internal.ServiceReferenceHolder;\n+import org.wso2.carbon.apimgt.impl.utils.APIUtil;\n+import org.wso2.carbon.context.PrivilegedCarbonContext;\n+import org.wso2.carbon.governance.api.generic.dataobjects.GenericArtifact;\n+import org.wso2.carbon.registry.core.Registry;\n+import org.wso2.carbon.registry.core.exceptions.RegistryException;\n+\n+import java.util.*;\n+\n+public class APIStateChangeApprovalWorkflowExecutor extends WorkflowExecutor{\n+\n+    private static final Log log = LogFactory.getLog(APIStateChangeWSWorkflowExecutor.class);\n+    private String stateList;\n+\n+    public String getStateList() {\n+        return stateList;\n+    }\n+\n+    public void setStateList(String stateList) {\n+        this.stateList = stateList;\n+    }\n+\n+\n+    @Override\n+    public String getWorkflowType() {\n+        return WorkflowConstants.WF_TYPE_AM_API_STATE;\n+    }\n+\n+    @Override\n+    public List<WorkflowDTO> getWorkflowDetails(String workflowStatus) throws WorkflowException {\n+        return Collections.emptyList();\n+    }\n+\n+    @Override\n+    public WorkflowResponse execute(WorkflowDTO workflowDTO) throws WorkflowException {\n+\n+        if (log.isDebugEnabled()) {\n+            log.debug(\"Executing API State change Workflow.\");\n+            log.debug(\"Execute workflowDTO \" + workflowDTO.toString());\n+        }\n+\n+        if (stateList != null) {\n+            Map<String, List<String>> stateActionMap = getSelectedStatesToApprove();\n+            APIStateWorkflowDTO apiStateWorkFlowDTO = (APIStateWorkflowDTO) workflowDTO;\n+\n+            if (stateActionMap.containsKey(apiStateWorkFlowDTO.getApiCurrentState().toUpperCase())\n+                    && stateActionMap.get(apiStateWorkFlowDTO.getApiCurrentState().toUpperCase())\n+                    .contains(apiStateWorkFlowDTO.getApiLCAction())) {\n+\n+                String callBackURL = apiStateWorkFlowDTO.getCallbackUrl();\n+                String message = \"Approval request for API State change action '\" + apiStateWorkFlowDTO.getApiLCAction()\n+                        + \"' from '\" + apiStateWorkFlowDTO.getApiCurrentState() + \"' state for the API '\"\n+                        + apiStateWorkFlowDTO.getApiName() + \" : \" + apiStateWorkFlowDTO.getApiVersion() + \"' by \"\n+                        + apiStateWorkFlowDTO.getApiProvider() + \"\";\n+\n+                apiStateWorkFlowDTO.setWorkflowDescription(message);\n+\n+                apiStateWorkFlowDTO.setMetadata(\"ClientId\", apiStateWorkFlowDTO.getClientId());\n+                apiStateWorkFlowDTO.setMetadata(\"ClientSecret\", apiStateWorkFlowDTO.getClientSecret());\n+                apiStateWorkFlowDTO.setMetadata(\"Scope\", apiStateWorkFlowDTO.getScope());\n+                apiStateWorkFlowDTO.setMetadata(\"TokenAPI\", apiStateWorkFlowDTO.getTokenAPI());\n+                apiStateWorkFlowDTO.setMetadata(\"CurrentState\", apiStateWorkFlowDTO.getApiCurrentState());\n+                apiStateWorkFlowDTO.setMetadata(\"Action\", apiStateWorkFlowDTO.getApiLCAction());\n+                apiStateWorkFlowDTO.setMetadata(\"ApiName\", apiStateWorkFlowDTO.getApiName());\n+                apiStateWorkFlowDTO.setMetadata(\"ApiVersion\", apiStateWorkFlowDTO.getApiVersion());\n+                apiStateWorkFlowDTO.setMetadata(\"ApiProvider\", apiStateWorkFlowDTO.getApiProvider());\n+                apiStateWorkFlowDTO.setMetadata(\"workflowExternalRef\", apiStateWorkFlowDTO.getExternalWorkflowReference());\n+                apiStateWorkFlowDTO.setMetadata(\"Invoker\", apiStateWorkFlowDTO.getInvoker());\n+                apiStateWorkFlowDTO.setMetadata(\"TenantId\", String.valueOf(apiStateWorkFlowDTO.getTenantId()));\n+                apiStateWorkFlowDTO.setMetadata(\"callBackURL\", callBackURL != null ? callBackURL : \"?\");\n+", "originalCommit": "6bf3e5572d4f5d21b3b4f4cb596a1eeea3348002", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyNDgxMQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r406624811", "bodyText": "rename the variable name. don't use 1", "author": "chamilaadhi", "createdAt": "2020-04-10T06:38:35Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/workflow/APIStateChangeApprovalWorkflowExecutor.java", "diffHunk": "@@ -0,0 +1,223 @@\n+package org.wso2.carbon.apimgt.impl.workflow;\n+\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+import org.wso2.carbon.apimgt.api.APIManagementException;\n+import org.wso2.carbon.apimgt.api.WorkflowResponse;\n+import org.wso2.carbon.apimgt.api.model.APIIdentifier;\n+import org.wso2.carbon.apimgt.api.model.Workflow;\n+import org.wso2.carbon.apimgt.impl.APIConstants;\n+import org.wso2.carbon.apimgt.impl.dao.ApiMgtDAO;\n+import org.wso2.carbon.apimgt.impl.dto.WorkflowDTO;\n+import org.wso2.carbon.apimgt.impl.internal.ServiceReferenceHolder;\n+import org.wso2.carbon.apimgt.impl.utils.APIUtil;\n+import org.wso2.carbon.context.PrivilegedCarbonContext;\n+import org.wso2.carbon.governance.api.generic.dataobjects.GenericArtifact;\n+import org.wso2.carbon.registry.core.Registry;\n+import org.wso2.carbon.registry.core.exceptions.RegistryException;\n+\n+import java.util.*;\n+\n+public class APIStateChangeApprovalWorkflowExecutor extends WorkflowExecutor{\n+\n+    private static final Log log = LogFactory.getLog(APIStateChangeWSWorkflowExecutor.class);\n+    private String stateList;\n+\n+    public String getStateList() {\n+        return stateList;\n+    }\n+\n+    public void setStateList(String stateList) {\n+        this.stateList = stateList;\n+    }\n+\n+\n+    @Override\n+    public String getWorkflowType() {\n+        return WorkflowConstants.WF_TYPE_AM_API_STATE;\n+    }\n+\n+    @Override\n+    public List<WorkflowDTO> getWorkflowDetails(String workflowStatus) throws WorkflowException {\n+        return Collections.emptyList();\n+    }\n+\n+    @Override\n+    public WorkflowResponse execute(WorkflowDTO workflowDTO) throws WorkflowException {\n+\n+        if (log.isDebugEnabled()) {\n+            log.debug(\"Executing API State change Workflow.\");\n+            log.debug(\"Execute workflowDTO \" + workflowDTO.toString());\n+        }\n+\n+        if (stateList != null) {\n+            Map<String, List<String>> stateActionMap = getSelectedStatesToApprove();\n+            APIStateWorkflowDTO apiStateWorkFlowDTO = (APIStateWorkflowDTO) workflowDTO;\n+\n+            if (stateActionMap.containsKey(apiStateWorkFlowDTO.getApiCurrentState().toUpperCase())\n+                    && stateActionMap.get(apiStateWorkFlowDTO.getApiCurrentState().toUpperCase())\n+                    .contains(apiStateWorkFlowDTO.getApiLCAction())) {\n+\n+                String callBackURL = apiStateWorkFlowDTO.getCallbackUrl();\n+                String message = \"Approval request for API State change action '\" + apiStateWorkFlowDTO.getApiLCAction()\n+                        + \"' from '\" + apiStateWorkFlowDTO.getApiCurrentState() + \"' state for the API '\"\n+                        + apiStateWorkFlowDTO.getApiName() + \" : \" + apiStateWorkFlowDTO.getApiVersion() + \"' by \"\n+                        + apiStateWorkFlowDTO.getApiProvider() + \"\";\n+\n+                apiStateWorkFlowDTO.setWorkflowDescription(message);\n+\n+                apiStateWorkFlowDTO.setMetadata(\"ClientId\", apiStateWorkFlowDTO.getClientId());\n+                apiStateWorkFlowDTO.setMetadata(\"ClientSecret\", apiStateWorkFlowDTO.getClientSecret());\n+                apiStateWorkFlowDTO.setMetadata(\"Scope\", apiStateWorkFlowDTO.getScope());\n+                apiStateWorkFlowDTO.setMetadata(\"TokenAPI\", apiStateWorkFlowDTO.getTokenAPI());\n+                apiStateWorkFlowDTO.setMetadata(\"CurrentState\", apiStateWorkFlowDTO.getApiCurrentState());\n+                apiStateWorkFlowDTO.setMetadata(\"Action\", apiStateWorkFlowDTO.getApiLCAction());\n+                apiStateWorkFlowDTO.setMetadata(\"ApiName\", apiStateWorkFlowDTO.getApiName());\n+                apiStateWorkFlowDTO.setMetadata(\"ApiVersion\", apiStateWorkFlowDTO.getApiVersion());\n+                apiStateWorkFlowDTO.setMetadata(\"ApiProvider\", apiStateWorkFlowDTO.getApiProvider());\n+                apiStateWorkFlowDTO.setMetadata(\"workflowExternalRef\", apiStateWorkFlowDTO.getExternalWorkflowReference());\n+                apiStateWorkFlowDTO.setMetadata(\"Invoker\", apiStateWorkFlowDTO.getInvoker());\n+                apiStateWorkFlowDTO.setMetadata(\"TenantId\", String.valueOf(apiStateWorkFlowDTO.getTenantId()));\n+                apiStateWorkFlowDTO.setMetadata(\"callBackURL\", callBackURL != null ? callBackURL : \"?\");\n+\n+                apiStateWorkFlowDTO.setProperties(\"Workflow Process\",\"Application Creation\");\n+\n+                super.execute(workflowDTO);\n+\n+                if (log.isDebugEnabled()) {\n+                    log.debug(\"APIStateChange payload: \");\n+                }\n+\n+            } else {\n+                // For any other states, act as simple workflow executor.\n+                workflowDTO.setStatus(WorkflowStatus.APPROVED);\n+                // calling super.complete() instead of complete() to act as the simpleworkflow executor\n+                super.complete(workflowDTO);\n+            }\n+        } else {\n+            String msg = \"State change list is not provided. Please check <stateList> element in \";\n+            log.error(msg);\n+            throw new WorkflowException(msg);\n+        }\n+\n+        return new GeneralWorkflowResponse();\n+    }\n+\n+    /**\n+     * Complete the API state change workflow process.\n+     */\n+    @Override\n+    public WorkflowResponse complete(WorkflowDTO workflowDTO) throws WorkflowException{\n+        if (log.isDebugEnabled()) {\n+            log.debug(\"Completing API State change Workflow..\");\n+            log.debug(\"response: \" + workflowDTO.toString());\n+        }\n+\n+        workflowDTO.setUpdatedTime(System.currentTimeMillis());\n+        super.complete(workflowDTO);\n+\n+        String externalWorkflowRef=workflowDTO.getExternalWorkflowReference();\n+\n+        try {\n+            ApiMgtDAO apiMgtDAO1 = ApiMgtDAO.getInstance();", "originalCommit": "6bf3e5572d4f5d21b3b4f4cb596a1eeea3348002", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyNTAyOA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r406625028", "bodyText": "use the previous apiMgtDAO instead of creating a new variable", "author": "chamilaadhi", "createdAt": "2020-04-10T06:39:17Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/workflow/APIStateChangeApprovalWorkflowExecutor.java", "diffHunk": "@@ -0,0 +1,223 @@\n+package org.wso2.carbon.apimgt.impl.workflow;\n+\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+import org.wso2.carbon.apimgt.api.APIManagementException;\n+import org.wso2.carbon.apimgt.api.WorkflowResponse;\n+import org.wso2.carbon.apimgt.api.model.APIIdentifier;\n+import org.wso2.carbon.apimgt.api.model.Workflow;\n+import org.wso2.carbon.apimgt.impl.APIConstants;\n+import org.wso2.carbon.apimgt.impl.dao.ApiMgtDAO;\n+import org.wso2.carbon.apimgt.impl.dto.WorkflowDTO;\n+import org.wso2.carbon.apimgt.impl.internal.ServiceReferenceHolder;\n+import org.wso2.carbon.apimgt.impl.utils.APIUtil;\n+import org.wso2.carbon.context.PrivilegedCarbonContext;\n+import org.wso2.carbon.governance.api.generic.dataobjects.GenericArtifact;\n+import org.wso2.carbon.registry.core.Registry;\n+import org.wso2.carbon.registry.core.exceptions.RegistryException;\n+\n+import java.util.*;\n+\n+public class APIStateChangeApprovalWorkflowExecutor extends WorkflowExecutor{\n+\n+    private static final Log log = LogFactory.getLog(APIStateChangeWSWorkflowExecutor.class);\n+    private String stateList;\n+\n+    public String getStateList() {\n+        return stateList;\n+    }\n+\n+    public void setStateList(String stateList) {\n+        this.stateList = stateList;\n+    }\n+\n+\n+    @Override\n+    public String getWorkflowType() {\n+        return WorkflowConstants.WF_TYPE_AM_API_STATE;\n+    }\n+\n+    @Override\n+    public List<WorkflowDTO> getWorkflowDetails(String workflowStatus) throws WorkflowException {\n+        return Collections.emptyList();\n+    }\n+\n+    @Override\n+    public WorkflowResponse execute(WorkflowDTO workflowDTO) throws WorkflowException {\n+\n+        if (log.isDebugEnabled()) {\n+            log.debug(\"Executing API State change Workflow.\");\n+            log.debug(\"Execute workflowDTO \" + workflowDTO.toString());\n+        }\n+\n+        if (stateList != null) {\n+            Map<String, List<String>> stateActionMap = getSelectedStatesToApprove();\n+            APIStateWorkflowDTO apiStateWorkFlowDTO = (APIStateWorkflowDTO) workflowDTO;\n+\n+            if (stateActionMap.containsKey(apiStateWorkFlowDTO.getApiCurrentState().toUpperCase())\n+                    && stateActionMap.get(apiStateWorkFlowDTO.getApiCurrentState().toUpperCase())\n+                    .contains(apiStateWorkFlowDTO.getApiLCAction())) {\n+\n+                String callBackURL = apiStateWorkFlowDTO.getCallbackUrl();\n+                String message = \"Approval request for API State change action '\" + apiStateWorkFlowDTO.getApiLCAction()\n+                        + \"' from '\" + apiStateWorkFlowDTO.getApiCurrentState() + \"' state for the API '\"\n+                        + apiStateWorkFlowDTO.getApiName() + \" : \" + apiStateWorkFlowDTO.getApiVersion() + \"' by \"\n+                        + apiStateWorkFlowDTO.getApiProvider() + \"\";\n+\n+                apiStateWorkFlowDTO.setWorkflowDescription(message);\n+\n+                apiStateWorkFlowDTO.setMetadata(\"ClientId\", apiStateWorkFlowDTO.getClientId());\n+                apiStateWorkFlowDTO.setMetadata(\"ClientSecret\", apiStateWorkFlowDTO.getClientSecret());\n+                apiStateWorkFlowDTO.setMetadata(\"Scope\", apiStateWorkFlowDTO.getScope());\n+                apiStateWorkFlowDTO.setMetadata(\"TokenAPI\", apiStateWorkFlowDTO.getTokenAPI());\n+                apiStateWorkFlowDTO.setMetadata(\"CurrentState\", apiStateWorkFlowDTO.getApiCurrentState());\n+                apiStateWorkFlowDTO.setMetadata(\"Action\", apiStateWorkFlowDTO.getApiLCAction());\n+                apiStateWorkFlowDTO.setMetadata(\"ApiName\", apiStateWorkFlowDTO.getApiName());\n+                apiStateWorkFlowDTO.setMetadata(\"ApiVersion\", apiStateWorkFlowDTO.getApiVersion());\n+                apiStateWorkFlowDTO.setMetadata(\"ApiProvider\", apiStateWorkFlowDTO.getApiProvider());\n+                apiStateWorkFlowDTO.setMetadata(\"workflowExternalRef\", apiStateWorkFlowDTO.getExternalWorkflowReference());\n+                apiStateWorkFlowDTO.setMetadata(\"Invoker\", apiStateWorkFlowDTO.getInvoker());\n+                apiStateWorkFlowDTO.setMetadata(\"TenantId\", String.valueOf(apiStateWorkFlowDTO.getTenantId()));\n+                apiStateWorkFlowDTO.setMetadata(\"callBackURL\", callBackURL != null ? callBackURL : \"?\");\n+\n+                apiStateWorkFlowDTO.setProperties(\"Workflow Process\",\"Application Creation\");\n+\n+                super.execute(workflowDTO);\n+\n+                if (log.isDebugEnabled()) {\n+                    log.debug(\"APIStateChange payload: \");\n+                }\n+\n+            } else {\n+                // For any other states, act as simple workflow executor.\n+                workflowDTO.setStatus(WorkflowStatus.APPROVED);\n+                // calling super.complete() instead of complete() to act as the simpleworkflow executor\n+                super.complete(workflowDTO);\n+            }\n+        } else {\n+            String msg = \"State change list is not provided. Please check <stateList> element in \";\n+            log.error(msg);\n+            throw new WorkflowException(msg);\n+        }\n+\n+        return new GeneralWorkflowResponse();\n+    }\n+\n+    /**\n+     * Complete the API state change workflow process.\n+     */\n+    @Override\n+    public WorkflowResponse complete(WorkflowDTO workflowDTO) throws WorkflowException{\n+        if (log.isDebugEnabled()) {\n+            log.debug(\"Completing API State change Workflow..\");\n+            log.debug(\"response: \" + workflowDTO.toString());\n+        }\n+\n+        workflowDTO.setUpdatedTime(System.currentTimeMillis());\n+        super.complete(workflowDTO);\n+\n+        String externalWorkflowRef=workflowDTO.getExternalWorkflowReference();\n+\n+        try {\n+            ApiMgtDAO apiMgtDAO1 = ApiMgtDAO.getInstance();\n+            Workflow workflow = apiMgtDAO1.getworkflowReferenceByExternalWorkflowReference(externalWorkflowRef);\n+\n+            String apiName = workflow.getMetadata(\"ApiName\");\n+            String action = workflow.getMetadata(\"Action\");\n+            String providerName = workflow.getMetadata(\"ApiProvider\");\n+            String version = workflow.getMetadata(\"ApiVersion\");\n+            String invoker = workflow.getMetadata(\"Invoker\");\n+            String currentStatus = workflow.getMetadata(\"CurrentState\");\n+\n+            int tenantId = workflowDTO.getTenantId();\n+            ApiMgtDAO apiMgtDAO = ApiMgtDAO.getInstance();", "originalCommit": "6bf3e5572d4f5d21b3b4f4cb596a1eeea3348002", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyNTMyMQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r406625321", "bodyText": "license header", "author": "chamilaadhi", "createdAt": "2020-04-10T06:40:26Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/workflow/ApplicationCreationApprovalWorkflowExecutor.java", "diffHunk": "@@ -0,0 +1,132 @@\n+package org.wso2.carbon.apimgt.impl.workflow;", "originalCommit": "6bf3e5572d4f5d21b3b4f4cb596a1eeea3348002", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDc5MjU4OA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r410792588", "bodyText": "fixed with e00fe40", "author": "SahanHerath", "createdAt": "2020-04-19T02:05:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyNTMyMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDc5NjM0OA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r410796348", "bodyText": "changed year with 68b7419", "author": "SahanHerath", "createdAt": "2020-04-19T02:33:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyNTMyMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyNTM5Mw==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r406625393", "bodyText": "class description", "author": "chamilaadhi", "createdAt": "2020-04-10T06:40:39Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/workflow/ApplicationCreationApprovalWorkflowExecutor.java", "diffHunk": "@@ -0,0 +1,132 @@\n+package org.wso2.carbon.apimgt.impl.workflow;\n+\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+import org.wso2.carbon.apimgt.api.APIManagementException;\n+import org.wso2.carbon.apimgt.api.WorkflowResponse;\n+import org.wso2.carbon.apimgt.api.model.Application;\n+import org.wso2.carbon.apimgt.impl.APIConstants;\n+import org.wso2.carbon.apimgt.impl.dao.ApiMgtDAO;\n+import org.wso2.carbon.apimgt.impl.dto.ApplicationWorkflowDTO;\n+import org.wso2.carbon.apimgt.impl.dto.WorkflowDTO;\n+\n+import java.util.List;\n+\n+public class ApplicationCreationApprovalWorkflowExecutor extends WorkflowExecutor{", "originalCommit": "6bf3e5572d4f5d21b3b4f4cb596a1eeea3348002", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDc5MjYzMA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r410792630", "bodyText": "fixed with e00fe40", "author": "SahanHerath", "createdAt": "2020-04-19T02:05:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyNTM5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDMxMDE4OQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r414310189", "bodyText": "formatting issue.", "author": "chamilaadhi", "createdAt": "2020-04-24T05:47:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyNTM5Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyNTQ4MA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r406625480", "bodyText": "format whole class and remove spaces", "author": "chamilaadhi", "createdAt": "2020-04-10T06:41:00Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/workflow/ApplicationCreationApprovalWorkflowExecutor.java", "diffHunk": "@@ -0,0 +1,132 @@\n+package org.wso2.carbon.apimgt.impl.workflow;\n+\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+import org.wso2.carbon.apimgt.api.APIManagementException;\n+import org.wso2.carbon.apimgt.api.WorkflowResponse;\n+import org.wso2.carbon.apimgt.api.model.Application;\n+import org.wso2.carbon.apimgt.impl.APIConstants;\n+import org.wso2.carbon.apimgt.impl.dao.ApiMgtDAO;\n+import org.wso2.carbon.apimgt.impl.dto.ApplicationWorkflowDTO;\n+import org.wso2.carbon.apimgt.impl.dto.WorkflowDTO;\n+\n+import java.util.List;\n+\n+public class ApplicationCreationApprovalWorkflowExecutor extends WorkflowExecutor{\n+\n+", "originalCommit": "6bf3e5572d4f5d21b3b4f4cb596a1eeea3348002", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyNTYwOA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r406625608", "bodyText": "no need to set this", "author": "chamilaadhi", "createdAt": "2020-04-10T06:41:32Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/workflow/ApplicationCreationApprovalWorkflowExecutor.java", "diffHunk": "@@ -0,0 +1,132 @@\n+package org.wso2.carbon.apimgt.impl.workflow;\n+\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+import org.wso2.carbon.apimgt.api.APIManagementException;\n+import org.wso2.carbon.apimgt.api.WorkflowResponse;\n+import org.wso2.carbon.apimgt.api.model.Application;\n+import org.wso2.carbon.apimgt.impl.APIConstants;\n+import org.wso2.carbon.apimgt.impl.dao.ApiMgtDAO;\n+import org.wso2.carbon.apimgt.impl.dto.ApplicationWorkflowDTO;\n+import org.wso2.carbon.apimgt.impl.dto.WorkflowDTO;\n+\n+import java.util.List;\n+\n+public class ApplicationCreationApprovalWorkflowExecutor extends WorkflowExecutor{\n+\n+\n+    private static final Log log = LogFactory.getLog(ApplicationCreationApprovalWorkflowExecutor.class);\n+\n+    @Override\n+    public String getWorkflowType() {\n+        return WorkflowConstants.WF_TYPE_AM_APPLICATION_CREATION;\n+    }\n+\n+    @Override\n+    public WorkflowResponse execute(WorkflowDTO workflowDTO) throws WorkflowException {\n+        if (log.isDebugEnabled()) {\n+            log.debug(\"Executing Application creation Workflow.\");\n+        }\n+\n+        ApplicationWorkflowDTO appWorkFlowDTO = (ApplicationWorkflowDTO) workflowDTO;\n+        Application application = appWorkFlowDTO.getApplication();\n+        String callBackURL = appWorkFlowDTO.getCallbackUrl();\n+\n+        String message=\"Approve application [\"+ application.getName() +\"] creation request from application creator -\"\n+                +appWorkFlowDTO.getUserName()+\" with throttling tier - \"+application.getTier();\n+\n+        workflowDTO.setWorkflowDescription(message);\n+\n+        workflowDTO.setMetadata(\"applicationName\", application.getName());\n+        workflowDTO.setMetadata(\"applicationTier\", application.getTier());\n+        workflowDTO.setMetadata(\"applicationCallbackUrl\", application.getCallbackUrl());\n+        workflowDTO.setMetadata(\"applicationDescription\", application.getDescription());\n+        workflowDTO.setMetadata(\"tenantDomain\", appWorkFlowDTO.getTenantDomain());\n+        workflowDTO.setMetadata(\"userName\", appWorkFlowDTO.getUserName());\n+        workflowDTO.setMetadata(\"workflowExternalRef\", appWorkFlowDTO.getExternalWorkflowReference());\n+        workflowDTO.setMetadata(\"callBackURL\", callBackURL != null ? callBackURL : \"?\");\n+\n+        workflowDTO.setProperties(\"Workflow Process\",\"Application Creation\");", "originalCommit": "6bf3e5572d4f5d21b3b4f4cb596a1eeea3348002", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyNjAyNw==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r406626027", "bodyText": "you don't have to set any metadata. Only set them if you need to get it from the complete() method. seems like any of the above are not needed", "author": "chamilaadhi", "createdAt": "2020-04-10T06:43:04Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/workflow/ApplicationCreationApprovalWorkflowExecutor.java", "diffHunk": "@@ -0,0 +1,132 @@\n+package org.wso2.carbon.apimgt.impl.workflow;\n+\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+import org.wso2.carbon.apimgt.api.APIManagementException;\n+import org.wso2.carbon.apimgt.api.WorkflowResponse;\n+import org.wso2.carbon.apimgt.api.model.Application;\n+import org.wso2.carbon.apimgt.impl.APIConstants;\n+import org.wso2.carbon.apimgt.impl.dao.ApiMgtDAO;\n+import org.wso2.carbon.apimgt.impl.dto.ApplicationWorkflowDTO;\n+import org.wso2.carbon.apimgt.impl.dto.WorkflowDTO;\n+\n+import java.util.List;\n+\n+public class ApplicationCreationApprovalWorkflowExecutor extends WorkflowExecutor{\n+\n+\n+    private static final Log log = LogFactory.getLog(ApplicationCreationApprovalWorkflowExecutor.class);\n+\n+    @Override\n+    public String getWorkflowType() {\n+        return WorkflowConstants.WF_TYPE_AM_APPLICATION_CREATION;\n+    }\n+\n+    @Override\n+    public WorkflowResponse execute(WorkflowDTO workflowDTO) throws WorkflowException {\n+        if (log.isDebugEnabled()) {\n+            log.debug(\"Executing Application creation Workflow.\");\n+        }\n+\n+        ApplicationWorkflowDTO appWorkFlowDTO = (ApplicationWorkflowDTO) workflowDTO;\n+        Application application = appWorkFlowDTO.getApplication();\n+        String callBackURL = appWorkFlowDTO.getCallbackUrl();\n+\n+        String message=\"Approve application [\"+ application.getName() +\"] creation request from application creator -\"\n+                +appWorkFlowDTO.getUserName()+\" with throttling tier - \"+application.getTier();\n+\n+        workflowDTO.setWorkflowDescription(message);\n+\n+        workflowDTO.setMetadata(\"applicationName\", application.getName());\n+        workflowDTO.setMetadata(\"applicationTier\", application.getTier());\n+        workflowDTO.setMetadata(\"applicationCallbackUrl\", application.getCallbackUrl());\n+        workflowDTO.setMetadata(\"applicationDescription\", application.getDescription());\n+        workflowDTO.setMetadata(\"tenantDomain\", appWorkFlowDTO.getTenantDomain());\n+        workflowDTO.setMetadata(\"userName\", appWorkFlowDTO.getUserName());\n+        workflowDTO.setMetadata(\"workflowExternalRef\", appWorkFlowDTO.getExternalWorkflowReference());\n+        workflowDTO.setMetadata(\"callBackURL\", callBackURL != null ? callBackURL : \"?\");\n+", "originalCommit": "6bf3e5572d4f5d21b3b4f4cb596a1eeea3348002", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyNjIzOA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r406626238", "bodyText": "remove +", "author": "chamilaadhi", "createdAt": "2020-04-10T06:43:44Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/workflow/ApplicationCreationApprovalWorkflowExecutor.java", "diffHunk": "@@ -0,0 +1,132 @@\n+package org.wso2.carbon.apimgt.impl.workflow;\n+\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+import org.wso2.carbon.apimgt.api.APIManagementException;\n+import org.wso2.carbon.apimgt.api.WorkflowResponse;\n+import org.wso2.carbon.apimgt.api.model.Application;\n+import org.wso2.carbon.apimgt.impl.APIConstants;\n+import org.wso2.carbon.apimgt.impl.dao.ApiMgtDAO;\n+import org.wso2.carbon.apimgt.impl.dto.ApplicationWorkflowDTO;\n+import org.wso2.carbon.apimgt.impl.dto.WorkflowDTO;\n+\n+import java.util.List;\n+\n+public class ApplicationCreationApprovalWorkflowExecutor extends WorkflowExecutor{\n+\n+\n+    private static final Log log = LogFactory.getLog(ApplicationCreationApprovalWorkflowExecutor.class);\n+\n+    @Override\n+    public String getWorkflowType() {\n+        return WorkflowConstants.WF_TYPE_AM_APPLICATION_CREATION;\n+    }\n+\n+    @Override\n+    public WorkflowResponse execute(WorkflowDTO workflowDTO) throws WorkflowException {\n+        if (log.isDebugEnabled()) {\n+            log.debug(\"Executing Application creation Workflow.\");\n+        }\n+\n+        ApplicationWorkflowDTO appWorkFlowDTO = (ApplicationWorkflowDTO) workflowDTO;\n+        Application application = appWorkFlowDTO.getApplication();\n+        String callBackURL = appWorkFlowDTO.getCallbackUrl();\n+\n+        String message=\"Approve application [\"+ application.getName() +\"] creation request from application creator -\"\n+                +appWorkFlowDTO.getUserName()+\" with throttling tier - \"+application.getTier();\n+\n+        workflowDTO.setWorkflowDescription(message);\n+\n+        workflowDTO.setMetadata(\"applicationName\", application.getName());\n+        workflowDTO.setMetadata(\"applicationTier\", application.getTier());\n+        workflowDTO.setMetadata(\"applicationCallbackUrl\", application.getCallbackUrl());\n+        workflowDTO.setMetadata(\"applicationDescription\", application.getDescription());\n+        workflowDTO.setMetadata(\"tenantDomain\", appWorkFlowDTO.getTenantDomain());\n+        workflowDTO.setMetadata(\"userName\", appWorkFlowDTO.getUserName());\n+        workflowDTO.setMetadata(\"workflowExternalRef\", appWorkFlowDTO.getExternalWorkflowReference());\n+        workflowDTO.setMetadata(\"callBackURL\", callBackURL != null ? callBackURL : \"?\");\n+\n+        workflowDTO.setProperties(\"Workflow Process\",\"Application Creation\");\n+\n+        super.execute(workflowDTO);\n+\n+        return new GeneralWorkflowResponse();\n+    }\n+\n+    /**\n+     * Complete the external process status.\n+     * Based on the workflow , we will update the status column of the\n+     * Application table\n+     *\n+     * @param workFlowDTO object\n+     */\n+    @Override\n+    public WorkflowResponse complete(WorkflowDTO workFlowDTO) throws WorkflowException {\n+\n+        workFlowDTO.setUpdatedTime(System.currentTimeMillis());\n+        ApiMgtDAO dao = ApiMgtDAO.getInstance();\n+        try {\n+            if (dao.getApplicationById(Integer.parseInt(workFlowDTO.getWorkflowReference())) != null) {\n+\n+                super.complete(workFlowDTO);\n+                log.info(\"Application Creation [Complete] Workflow Invoked. Workflow ID : \" + workFlowDTO\n+                        .getExternalWorkflowReference() + \"Workflow State : \" + workFlowDTO.getStatus());\n+\n+                String status = null;\n+                if (WorkflowStatus.CREATED.equals(workFlowDTO.getStatus())) {\n+                    status = APIConstants.ApplicationStatus.APPLICATION_CREATED;\n+                } else if (WorkflowStatus.REJECTED.equals(workFlowDTO.getStatus())) {\n+                    status = APIConstants.ApplicationStatus.APPLICATION_REJECTED;\n+                } else if (WorkflowStatus.APPROVED.equals(workFlowDTO.getStatus())) {\n+                    status = APIConstants.ApplicationStatus.APPLICATION_APPROVED;\n+                }\n+\n+                try {\n+                    dao.updateApplicationStatus(Integer.parseInt(workFlowDTO.getWorkflowReference()), status);\n+                } catch (APIManagementException e) {\n+                    String msg = \"Error occurred when updating the status of the Application creation \" + \"process\";\n+                    log.error(msg, e);", "originalCommit": "6bf3e5572d4f5d21b3b4f4cb596a1eeea3348002", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDc5MjY5NA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r410792694", "bodyText": "fixed with e00fe40", "author": "SahanHerath", "createdAt": "2020-04-19T02:06:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyNjIzOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyNjQ4Ng==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r406626486", "bodyText": "License header, class description and format the whole class", "author": "chamilaadhi", "createdAt": "2020-04-10T06:44:40Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/workflow/ApplicationRegistrationApprovalWorkflowExecutor.java", "diffHunk": "@@ -0,0 +1,102 @@\n+package org.wso2.carbon.apimgt.impl.workflow;", "originalCommit": "6bf3e5572d4f5d21b3b4f4cb596a1eeea3348002", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDc5MjcwNA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r410792704", "bodyText": "fixed with e00fe40", "author": "SahanHerath", "createdAt": "2020-04-19T02:06:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyNjQ4Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDc5NjQwMA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r410796400", "bodyText": "changed year with 68b7419", "author": "SahanHerath", "createdAt": "2020-04-19T02:33:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyNjQ4Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDMxMDkwMA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r414310900", "bodyText": "your haven't formatted the class .", "author": "chamilaadhi", "createdAt": "2020-04-24T05:49:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyNjQ4Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyNjgwOA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r406626808", "bodyText": "metadata and properties are not needed.", "author": "chamilaadhi", "createdAt": "2020-04-10T06:45:43Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/workflow/ApplicationRegistrationApprovalWorkflowExecutor.java", "diffHunk": "@@ -0,0 +1,102 @@\n+package org.wso2.carbon.apimgt.impl.workflow;\n+\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+import org.wso2.carbon.apimgt.api.APIManagementException;\n+import org.wso2.carbon.apimgt.api.WorkflowResponse;\n+import org.wso2.carbon.apimgt.api.model.Application;\n+import org.wso2.carbon.apimgt.impl.dao.ApiMgtDAO;\n+import org.wso2.carbon.apimgt.impl.dto.ApplicationRegistrationWorkflowDTO;\n+import org.wso2.carbon.apimgt.impl.dto.WorkflowDTO;\n+\n+import java.util.List;\n+\n+public class ApplicationRegistrationApprovalWorkflowExecutor extends AbstractApplicationRegistrationWorkflowExecutor{\n+\n+\n+    private static final Log log = LogFactory.getLog(ApplicationRegistrationApprovalWorkflowExecutor.class);\n+\n+    @Override\n+    public WorkflowResponse execute(WorkflowDTO workflowDTO) throws WorkflowException {\n+        if (log.isDebugEnabled()) {\n+            log.debug(\"Executing Application registration Workflow..\");\n+        }\n+\n+        ApplicationRegistrationWorkflowDTO appRegDTO = (ApplicationRegistrationWorkflowDTO) workflowDTO;\n+        Application application = appRegDTO.getApplication();\n+        String callBackURL = appRegDTO.getCallbackUrl();\n+        String applicationCallbackUrl = application.getCallbackUrl();\n+        String applicationDescription = application.getDescription();\n+\n+        String message=\"Approve request to create \"+appRegDTO.getKeyType()+\" keys for [ \"+application.getName()+\n+                \" ] from application creator - \"+appRegDTO.getUserName()+\" with throttling tier - \"+application.getTier() ;\n+\n+        workflowDTO.setWorkflowDescription(message);\n+\n+        workflowDTO.setMetadata(\"applicationName\", application.getName());\n+        workflowDTO.setMetadata(\"applicationTier\", application.getTier());\n+        workflowDTO.setMetadata(\"applicationCallbackUrl\", applicationCallbackUrl != null ? applicationCallbackUrl : \"?\");\n+        workflowDTO.setMetadata(\"applicationDescription\", applicationDescription != null ? applicationDescription : \"?\");\n+        workflowDTO.setMetadata(\"TenantDomain\", appRegDTO.getTenantDomain());\n+        workflowDTO.setMetadata(\"UserName\", appRegDTO.getUserName());\n+        workflowDTO.setMetadata(\"workflowExternalRef\", appRegDTO.getExternalWorkflowReference());\n+        workflowDTO.setMetadata(\"callBackURL\", callBackURL != null ? callBackURL : \"?\");\n+        workflowDTO.setMetadata(\"KeyType\", appRegDTO.getKeyType());\n+\n+        workflowDTO.setProperties(\"Workflow Process\",\"Registration Creation\");\n+", "originalCommit": "6bf3e5572d4f5d21b3b4f4cb596a1eeea3348002", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyNzAwMA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r406627000", "bodyText": "remove 'TODO Auto-generated method stub' and add a valid comment", "author": "chamilaadhi", "createdAt": "2020-04-10T06:46:34Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/workflow/ApplicationRegistrationApprovalWorkflowExecutor.java", "diffHunk": "@@ -0,0 +1,102 @@\n+package org.wso2.carbon.apimgt.impl.workflow;\n+\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+import org.wso2.carbon.apimgt.api.APIManagementException;\n+import org.wso2.carbon.apimgt.api.WorkflowResponse;\n+import org.wso2.carbon.apimgt.api.model.Application;\n+import org.wso2.carbon.apimgt.impl.dao.ApiMgtDAO;\n+import org.wso2.carbon.apimgt.impl.dto.ApplicationRegistrationWorkflowDTO;\n+import org.wso2.carbon.apimgt.impl.dto.WorkflowDTO;\n+\n+import java.util.List;\n+\n+public class ApplicationRegistrationApprovalWorkflowExecutor extends AbstractApplicationRegistrationWorkflowExecutor{\n+\n+\n+    private static final Log log = LogFactory.getLog(ApplicationRegistrationApprovalWorkflowExecutor.class);\n+\n+    @Override\n+    public WorkflowResponse execute(WorkflowDTO workflowDTO) throws WorkflowException {\n+        if (log.isDebugEnabled()) {\n+            log.debug(\"Executing Application registration Workflow..\");\n+        }\n+\n+        ApplicationRegistrationWorkflowDTO appRegDTO = (ApplicationRegistrationWorkflowDTO) workflowDTO;\n+        Application application = appRegDTO.getApplication();\n+        String callBackURL = appRegDTO.getCallbackUrl();\n+        String applicationCallbackUrl = application.getCallbackUrl();\n+        String applicationDescription = application.getDescription();\n+\n+        String message=\"Approve request to create \"+appRegDTO.getKeyType()+\" keys for [ \"+application.getName()+\n+                \" ] from application creator - \"+appRegDTO.getUserName()+\" with throttling tier - \"+application.getTier() ;\n+\n+        workflowDTO.setWorkflowDescription(message);\n+\n+        workflowDTO.setMetadata(\"applicationName\", application.getName());\n+        workflowDTO.setMetadata(\"applicationTier\", application.getTier());\n+        workflowDTO.setMetadata(\"applicationCallbackUrl\", applicationCallbackUrl != null ? applicationCallbackUrl : \"?\");\n+        workflowDTO.setMetadata(\"applicationDescription\", applicationDescription != null ? applicationDescription : \"?\");\n+        workflowDTO.setMetadata(\"TenantDomain\", appRegDTO.getTenantDomain());\n+        workflowDTO.setMetadata(\"UserName\", appRegDTO.getUserName());\n+        workflowDTO.setMetadata(\"workflowExternalRef\", appRegDTO.getExternalWorkflowReference());\n+        workflowDTO.setMetadata(\"callBackURL\", callBackURL != null ? callBackURL : \"?\");\n+        workflowDTO.setMetadata(\"KeyType\", appRegDTO.getKeyType());\n+\n+        workflowDTO.setProperties(\"Workflow Process\",\"Registration Creation\");\n+\n+        super.execute(workflowDTO);\n+\n+        return new GeneralWorkflowResponse();\n+    }\n+\n+    /**\n+     * Complete the external process status.\n+     * Based on the workflow , we will update the status column of the\n+     * AM_APPLICATION_KEY_MAPPING table\n+     *\n+     * @param workFlowDTO\n+     */\n+    @Override\n+    public WorkflowResponse complete(WorkflowDTO workFlowDTO) throws WorkflowException {\n+        workFlowDTO.setUpdatedTime(System.currentTimeMillis());\n+        super.complete(workFlowDTO);\n+        log.info(\"Application Registration [Complete] Workflow Invoked. Workflow ID : \" + workFlowDTO\n+                .getExternalWorkflowReference() + \"Workflow State : \" + workFlowDTO.getStatus());\n+\n+        if (WorkflowStatus.APPROVED.equals(workFlowDTO.getStatus())) {\n+            try {\n+                generateKeysForApplication((ApplicationRegistrationWorkflowDTO) workFlowDTO);\n+            } catch (APIManagementException e) {\n+                String msg = \"Error occurred when updating the status of the Application Registration process\";\n+                log.error(msg, e);\n+                throw new WorkflowException(msg, e);\n+            }\n+        }\n+        return new GeneralWorkflowResponse();\n+    }\n+\n+    @Override\n+    public List<WorkflowDTO> getWorkflowDetails(String workflowStatus) throws WorkflowException {\n+        // TODO Auto-generated method stub\n+        return null;", "originalCommit": "6bf3e5572d4f5d21b3b4f4cb596a1eeea3348002", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDc5Mjc0OA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r410792748", "bodyText": "fixed with e00fe40", "author": "SahanHerath", "createdAt": "2020-04-19T02:06:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyNzAwMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyNzM5OA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r406627398", "bodyText": "missing license header, class description. Also format the class", "author": "chamilaadhi", "createdAt": "2020-04-10T06:48:09Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/workflow/SubscriptionCreationApprovalWorkflowExecutor.java", "diffHunk": "@@ -0,0 +1,115 @@\n+package org.wso2.carbon.apimgt.impl.workflow;", "originalCommit": "6bf3e5572d4f5d21b3b4f4cb596a1eeea3348002", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDc5Mjg5NQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r410792895", "bodyText": "fixed with e00fe40", "author": "SahanHerath", "createdAt": "2020-04-19T02:08:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyNzM5OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDc5NjQ2OA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r410796468", "bodyText": "changed year with 68b7419", "author": "SahanHerath", "createdAt": "2020-04-19T02:34:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyNzM5OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDMxMDgwNQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r414310805", "bodyText": "your haven't formatted the class .", "author": "chamilaadhi", "createdAt": "2020-04-24T05:48:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyNzM5OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyNzUzNw==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r406627537", "bodyText": "remove properties and metadata since they are not needed", "author": "chamilaadhi", "createdAt": "2020-04-10T06:48:33Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/workflow/SubscriptionCreationApprovalWorkflowExecutor.java", "diffHunk": "@@ -0,0 +1,115 @@\n+package org.wso2.carbon.apimgt.impl.workflow;\n+\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+import org.wso2.carbon.apimgt.api.APIManagementException;\n+import org.wso2.carbon.apimgt.api.WorkflowResponse;\n+import org.wso2.carbon.apimgt.impl.APIConstants;\n+import org.wso2.carbon.apimgt.impl.dao.ApiMgtDAO;\n+import org.wso2.carbon.apimgt.impl.dto.SubscriptionWorkflowDTO;\n+import org.wso2.carbon.apimgt.impl.dto.WorkflowDTO;\n+\n+import java.util.List;\n+\n+public class SubscriptionCreationApprovalWorkflowExecutor extends WorkflowExecutor{\n+\n+    private static final Log log = LogFactory.getLog(SubscriptionCreationApprovalWorkflowExecutor.class);\n+\n+\n+    @Override\n+    public String getWorkflowType() {\n+        return WorkflowConstants.WF_TYPE_AM_SUBSCRIPTION_CREATION;\n+    }\n+\n+    @Override\n+    public List<WorkflowDTO> getWorkflowDetails(String workflowStatus) throws WorkflowException {\n+        return null;\n+    }\n+\n+    /**\n+     * This method is used to execute the workflow without giving a workflow response back to the caller to execute\n+     * some other task after completing the workflow\n+     *\n+     * @param workflowDTO - The WorkflowDTO which contains workflow contextual information related to the workflow.\n+     * @throws WorkflowException\n+     */\n+    @Override\n+    public WorkflowResponse execute(WorkflowDTO workflowDTO) throws WorkflowException {\n+\n+        if (log.isDebugEnabled()) {\n+            log.debug(\"Executing Subscription Creation Webservice Workflow.. \");\n+        }\n+\n+        SubscriptionWorkflowDTO subsWorkflowDTO = (SubscriptionWorkflowDTO) workflowDTO;\n+        String callBackURL = subsWorkflowDTO.getCallbackUrl();\n+\n+        String message=\"Approve API [\"+ subsWorkflowDTO.getApiName()+\" - \"+subsWorkflowDTO.getApiVersion()+\n+                \"] subscription creation request from subscriber - \"+subsWorkflowDTO.getSubscriber()+\n+                \" for the application - \"+subsWorkflowDTO.getApplicationName();\n+\n+        workflowDTO.setWorkflowDescription(message);\n+\n+        workflowDTO.setMetadata(\"apiName\", subsWorkflowDTO.getApiName());\n+        workflowDTO.setMetadata(\"apiVersion\", subsWorkflowDTO.getApiVersion());\n+        workflowDTO.setMetadata(\"apiContext\", subsWorkflowDTO.getApiContext());\n+        workflowDTO.setMetadata(\"apiProvider\", subsWorkflowDTO.getApiProvider());\n+        workflowDTO.setMetadata(\"apiSubscriber\", subsWorkflowDTO.getSubscriber());\n+        workflowDTO.setMetadata(\"applicationName\", subsWorkflowDTO.getApplicationName());\n+        workflowDTO.setMetadata(\"TierName\", subsWorkflowDTO.getTierName());\n+        workflowDTO.setMetadata(\"workflowExternalRef\", subsWorkflowDTO.getExternalWorkflowReference());\n+        workflowDTO.setMetadata(\"callBackURL\", callBackURL != null ? callBackURL : \"?\");\n+\n+        workflowDTO.setProperties(\"Workflow Process\",\"Subscription Creation\");\n+", "originalCommit": "6bf3e5572d4f5d21b3b4f4cb596a1eeea3348002", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyNzk0NQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r406627945", "bodyText": "missing license header, class description. Also format the class", "author": "chamilaadhi", "createdAt": "2020-04-10T06:49:57Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/workflow/UserSignUpApprovalWorkflowExecutor.java", "diffHunk": "@@ -0,0 +1,138 @@\n+package org.wso2.carbon.apimgt.impl.workflow;", "originalCommit": "6bf3e5572d4f5d21b3b4f4cb596a1eeea3348002", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDc5MjkzMg==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r410792932", "bodyText": "fixed with e00fe40", "author": "SahanHerath", "createdAt": "2020-04-19T02:08:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyNzk0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDc5NjQ5Mw==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r410796493", "bodyText": "changed year with 68b7419", "author": "SahanHerath", "createdAt": "2020-04-19T02:34:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyNzk0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDMxMDcxNQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r414310715", "bodyText": "your haven't formatted the class .", "author": "chamilaadhi", "createdAt": "2020-04-24T05:48:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyNzk0NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyODI4NA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r406628284", "bodyText": "metadata and properties are not needed", "author": "chamilaadhi", "createdAt": "2020-04-10T06:51:20Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/workflow/UserSignUpApprovalWorkflowExecutor.java", "diffHunk": "@@ -0,0 +1,138 @@\n+package org.wso2.carbon.apimgt.impl.workflow;\n+\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+import org.wso2.carbon.apimgt.api.APIManagementException;\n+import org.wso2.carbon.apimgt.api.WorkflowResponse;\n+import org.wso2.carbon.apimgt.impl.APIConstants;\n+import org.wso2.carbon.apimgt.impl.APIManagerConfiguration;\n+import org.wso2.carbon.apimgt.impl.dao.ApiMgtDAO;\n+import org.wso2.carbon.apimgt.impl.dto.UserRegistrationConfigDTO;\n+import org.wso2.carbon.apimgt.impl.dto.WorkflowDTO;\n+import org.wso2.carbon.apimgt.impl.internal.ServiceReferenceHolder;\n+import org.wso2.carbon.apimgt.impl.utils.SelfSignUpUtil;\n+import org.wso2.carbon.utils.multitenancy.MultitenantUtils;\n+\n+import java.util.List;\n+\n+public class UserSignUpApprovalWorkflowExecutor extends UserSignUpWorkflowExecutor{\n+\n+    private static final Log log = LogFactory.getLog(UserSignUpWSWorkflowExecutor.class);\n+\n+\n+    @Override\n+    public String getWorkflowType() {\n+        return WorkflowConstants.WF_TYPE_AM_USER_SIGNUP;\n+    }\n+\n+    @Override\n+    public WorkflowResponse execute(WorkflowDTO workflowDTO) throws WorkflowException  {\n+\n+        if (log.isDebugEnabled()) {\n+            log.debug(\"Executing User SignUp Webservice Workflow for \" + workflowDTO.getWorkflowReference());\n+        }\n+\n+\n+        String callBackURL = workflowDTO.getCallbackUrl();\n+        String tenantAwareUserName = MultitenantUtils.getTenantAwareUsername(workflowDTO.getWorkflowReference());\n+\n+        String message=\"Approve APIStore signup request done by \"+tenantAwareUserName  +\" from the tenant domain \"+workflowDTO.getTenantDomain();\n+\n+        workflowDTO.setWorkflowDescription(message);\n+\n+        workflowDTO.setMetadata(\"TenantUserName\", tenantAwareUserName);\n+        workflowDTO.setMetadata(\"TenantDomain\", workflowDTO.getTenantDomain());\n+        workflowDTO.setMetadata(\"workflowExternalRef\", workflowDTO.getExternalWorkflowReference());\n+        workflowDTO.setMetadata(\"callBackURL\", callBackURL != null ? callBackURL : \"?\");\n+\n+        workflowDTO.setProperties(\"Workflow Process\",\"User Self Sign Up\");\n+", "originalCommit": "6bf3e5572d4f5d21b3b4f4cb596a1eeea3348002", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyOTIwOA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r406629208", "bodyText": "why catch a NPE here? fromWorkflowsToInfoDTO() method is not throwing it either. please remove this", "author": "chamilaadhi", "createdAt": "2020-04-10T06:54:33Z", "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.admin/src/main/java/org/wso2/carbon/apimgt/rest/api/admin/impl/WorkflowsApiServiceImpl.java", "diffHunk": "@@ -42,6 +48,87 @@\n \n     private static final Log log = LogFactory.getLog(WorkflowsApiService.class);\n \n+\n+    /**\n+     * This is used to get the workflow pending request according to ExternalWorkflowReference\n+     *\n+     * @param externalWorkflowRef is the unique identifier for workflow request\n+     * @param ifNoneMatch If-None-Match header value\n+     * @return\n+     */\n+\n+    @Override\n+    public Response workflowsExternalWorkflowRefGet(String externalWorkflowRef, String ifNoneMatch) {\n+        WorkflowInfoDTO workflowinfoDTO;\n+        try {\n+            Workflow workflow;\n+\n+            String status=\"CREATED\";\n+            String tenantDomain = RestApiUtil.getLoggedInUserTenantDomain();\n+\n+            APIAdmin apiAdmin = new APIAdminImpl();\n+            workflow=apiAdmin.getworkflowReferenceByExternalWorkflowReferenceID(externalWorkflowRef, status ,tenantDomain);\n+\n+            try {\n+                workflowinfoDTO = WorkflowMappingUtil.fromWorkflowsToInfoDTO(workflow);\n+                return Response.ok().entity(workflowinfoDTO).build();\n+            }\n+            catch(NullPointerException e){", "originalCommit": "6bf3e5572d4f5d21b3b4f4cb596a1eeea3348002", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyOTI2Mg==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r406629262", "bodyText": "format this whole method", "author": "chamilaadhi", "createdAt": "2020-04-10T06:54:45Z", "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.admin/src/main/java/org/wso2/carbon/apimgt/rest/api/admin/impl/WorkflowsApiServiceImpl.java", "diffHunk": "@@ -42,6 +48,87 @@\n \n     private static final Log log = LogFactory.getLog(WorkflowsApiService.class);\n \n+\n+    /**\n+     * This is used to get the workflow pending request according to ExternalWorkflowReference\n+     *\n+     * @param externalWorkflowRef is the unique identifier for workflow request\n+     * @param ifNoneMatch If-None-Match header value\n+     * @return\n+     */\n+\n+    @Override\n+    public Response workflowsExternalWorkflowRefGet(String externalWorkflowRef, String ifNoneMatch) {\n+        WorkflowInfoDTO workflowinfoDTO;\n+        try {", "originalCommit": "6bf3e5572d4f5d21b3b4f4cb596a1eeea3348002", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDc5MzAzOA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r410793038", "bodyText": "fixed with e00fe40", "author": "SahanHerath", "createdAt": "2020-04-19T02:09:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyOTI2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDMxMTQ4NQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r414311485", "bodyText": "your haven't formatted the method . see that there are no spaces between the '='", "author": "chamilaadhi", "createdAt": "2020-04-24T05:50:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyOTI2Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyOTY3NQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r406629675", "bodyText": "format whole method. remove unnecessary spaces", "author": "chamilaadhi", "createdAt": "2020-04-10T06:56:15Z", "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.admin/src/main/java/org/wso2/carbon/apimgt/rest/api/admin/impl/WorkflowsApiServiceImpl.java", "diffHunk": "@@ -42,6 +48,87 @@\n \n     private static final Log log = LogFactory.getLog(WorkflowsApiService.class);\n \n+\n+    /**\n+     * This is used to get the workflow pending request according to ExternalWorkflowReference\n+     *\n+     * @param externalWorkflowRef is the unique identifier for workflow request\n+     * @param ifNoneMatch If-None-Match header value\n+     * @return\n+     */\n+\n+    @Override\n+    public Response workflowsExternalWorkflowRefGet(String externalWorkflowRef, String ifNoneMatch) {\n+        WorkflowInfoDTO workflowinfoDTO;\n+        try {\n+            Workflow workflow;\n+\n+            String status=\"CREATED\";\n+            String tenantDomain = RestApiUtil.getLoggedInUserTenantDomain();\n+\n+            APIAdmin apiAdmin = new APIAdminImpl();\n+            workflow=apiAdmin.getworkflowReferenceByExternalWorkflowReferenceID(externalWorkflowRef, status ,tenantDomain);\n+\n+            try {\n+                workflowinfoDTO = WorkflowMappingUtil.fromWorkflowsToInfoDTO(workflow);\n+                return Response.ok().entity(workflowinfoDTO).build();\n+            }\n+            catch(NullPointerException e){\n+                RestApiUtil.handleInternalServerError(\"Error while retrieving workflow request by the external workflow reference\" , e,log);\n+            }\n+        }\n+\n+        catch(APIManagementException e){\n+            RestApiUtil.handleInternalServerError(\"Error while retrieving workflow request by the external workflow reference\" , e, log);\n+        }\n+        return null;\n+    }\n+\n+    /**\n+     * This is used to get the workflow pending requests\n+     *\n+     * @param limit       maximum number of workflow returns\n+     * @param offset      starting index\n+     * @param accept      accept header value\n+     * @param ifNoneMatch If-None-Match header value\n+     * @param workflowType is the the type of the workflow request. (e.g: Application Creation, Application Subscription etc.)\n+     * @return\n+     */\n+\n+    @Override\n+    public Response workflowsGet(Integer limit, Integer offset, String accept, String ifNoneMatch, String workflowType) {\n+\n+        limit = limit != null ? limit : RestApiConstants.PAGINATION_LIMIT_DEFAULT;", "originalCommit": "6bf3e5572d4f5d21b3b4f4cb596a1eeea3348002", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDc5MzIyOQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r410793229", "bodyText": "fixed with e00fe40", "author": "SahanHerath", "createdAt": "2020-04-19T02:10:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyOTY3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDMxMTgyMA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r414311820", "bodyText": "your haven't formatted the class .", "author": "chamilaadhi", "createdAt": "2020-04-24T05:51:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyOTY3NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyOTcyMA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r406629720", "bodyText": "why???", "author": "chamilaadhi", "createdAt": "2020-04-10T06:56:27Z", "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.admin/src/main/java/org/wso2/carbon/apimgt/rest/api/admin/impl/WorkflowsApiServiceImpl.java", "diffHunk": "@@ -42,6 +48,87 @@\n \n     private static final Log log = LogFactory.getLog(WorkflowsApiService.class);\n \n+\n+    /**\n+     * This is used to get the workflow pending request according to ExternalWorkflowReference\n+     *\n+     * @param externalWorkflowRef is the unique identifier for workflow request\n+     * @param ifNoneMatch If-None-Match header value\n+     * @return\n+     */\n+\n+    @Override\n+    public Response workflowsExternalWorkflowRefGet(String externalWorkflowRef, String ifNoneMatch) {\n+        WorkflowInfoDTO workflowinfoDTO;\n+        try {\n+            Workflow workflow;\n+\n+            String status=\"CREATED\";\n+            String tenantDomain = RestApiUtil.getLoggedInUserTenantDomain();\n+\n+            APIAdmin apiAdmin = new APIAdminImpl();\n+            workflow=apiAdmin.getworkflowReferenceByExternalWorkflowReferenceID(externalWorkflowRef, status ,tenantDomain);\n+\n+            try {\n+                workflowinfoDTO = WorkflowMappingUtil.fromWorkflowsToInfoDTO(workflow);\n+                return Response.ok().entity(workflowinfoDTO).build();\n+            }\n+            catch(NullPointerException e){\n+                RestApiUtil.handleInternalServerError(\"Error while retrieving workflow request by the external workflow reference\" , e,log);\n+            }\n+        }\n+\n+        catch(APIManagementException e){\n+            RestApiUtil.handleInternalServerError(\"Error while retrieving workflow request by the external workflow reference\" , e, log);\n+        }\n+        return null;\n+    }\n+\n+    /**\n+     * This is used to get the workflow pending requests\n+     *\n+     * @param limit       maximum number of workflow returns\n+     * @param offset      starting index\n+     * @param accept      accept header value\n+     * @param ifNoneMatch If-None-Match header value\n+     * @param workflowType is the the type of the workflow request. (e.g: Application Creation, Application Subscription etc.)\n+     * @return\n+     */\n+\n+    @Override\n+    public Response workflowsGet(Integer limit, Integer offset, String accept, String ifNoneMatch, String workflowType) {\n+\n+        limit = limit != null ? limit : RestApiConstants.PAGINATION_LIMIT_DEFAULT;\n+        offset = offset != null ? offset : RestApiConstants.PAGINATION_OFFSET_DEFAULT;\n+\n+\n+        String tenantDomain = RestApiUtil.getLoggedInUserTenantDomain();\n+\n+        WorkflowListDTO workflowListDTO;\n+        try {\n+            Workflow[] workflows;\n+            String status=\"CREATED\";\n+\n+            APIAdmin apiAdmin = new APIAdminImpl();\n+            workflows=apiAdmin.getworkflows(workflowType, status ,tenantDomain);\n+\n+\n+            try {\n+                workflowListDTO = WorkflowMappingUtil.fromWorkflowsToDTO(workflows, limit, offset);\n+                WorkflowMappingUtil.setPaginationParams(workflowListDTO, limit, offset,\n+                        workflows.length);\n+                return Response.ok().entity(workflowListDTO).build();\n+            }\n+            catch( NullPointerException e){\n+                RestApiUtil.handleInternalServerError(\"Error while retrieving workflow requests\" , e, log);", "originalCommit": "6bf3e5572d4f5d21b3b4f4cb596a1eeea3348002", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyOTk4Nw==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r406629987", "bodyText": "License header missing", "author": "chamilaadhi", "createdAt": "2020-04-10T06:57:25Z", "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.admin/src/main/java/org/wso2/carbon/apimgt/rest/api/admin/utils/mappings/WorkflowMappingUtil.java", "diffHunk": "@@ -0,0 +1,83 @@\n+package org.wso2.carbon.apimgt.rest.api.admin.utils.mappings;", "originalCommit": "6bf3e5572d4f5d21b3b4f4cb596a1eeea3348002", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDc5MzMzMQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r410793331", "bodyText": "fixed with e00fe40", "author": "SahanHerath", "createdAt": "2020-04-19T02:11:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyOTk4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDc5NjU4MA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r410796580", "bodyText": "changed year with 68b7419", "author": "SahanHerath", "createdAt": "2020-04-19T02:35:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyOTk4Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYzMDE3NA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r406630174", "bodyText": "class description missing. also format the whole class", "author": "chamilaadhi", "createdAt": "2020-04-10T06:57:54Z", "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.admin/src/main/java/org/wso2/carbon/apimgt/rest/api/admin/utils/mappings/WorkflowMappingUtil.java", "diffHunk": "@@ -0,0 +1,83 @@\n+package org.wso2.carbon.apimgt.rest.api.admin.utils.mappings;\n+\n+import org.wso2.carbon.apimgt.api.model.Workflow;\n+import org.wso2.carbon.apimgt.rest.api.admin.dto.WorkflowInfoDTO;\n+import org.wso2.carbon.apimgt.rest.api.admin.dto.WorkflowListDTO;\n+import org.wso2.carbon.apimgt.rest.api.util.RestApiConstants;\n+import org.wso2.carbon.apimgt.rest.api.util.utils.RestApiUtil;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+\n+public class WorkflowMappingUtil {", "originalCommit": "6bf3e5572d4f5d21b3b4f4cb596a1eeea3348002", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDc5MzM4Ng==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r410793386", "bodyText": "fixed with e00fe40", "author": "SahanHerath", "createdAt": "2020-04-19T02:11:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYzMDE3NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYzMDI0Ng==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r406630246", "bodyText": "remove unnecessary spaces", "author": "chamilaadhi", "createdAt": "2020-04-10T06:58:06Z", "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.admin/src/main/java/org/wso2/carbon/apimgt/rest/api/admin/utils/mappings/WorkflowMappingUtil.java", "diffHunk": "@@ -0,0 +1,83 @@\n+package org.wso2.carbon.apimgt.rest.api.admin.utils.mappings;\n+\n+import org.wso2.carbon.apimgt.api.model.Workflow;\n+import org.wso2.carbon.apimgt.rest.api.admin.dto.WorkflowInfoDTO;\n+import org.wso2.carbon.apimgt.rest.api.admin.dto.WorkflowListDTO;\n+import org.wso2.carbon.apimgt.rest.api.util.RestApiConstants;\n+import org.wso2.carbon.apimgt.rest.api.util.utils.RestApiUtil;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+\n+public class WorkflowMappingUtil {\n+\n+    private static Object WorkflowTypeEnum;\n+\n+\n+", "originalCommit": "6bf3e5572d4f5d21b3b4f4cb596a1eeea3348002", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e00fe40f5ef809f1ac81dc7c22faacda062adfab", "url": "https://github.com/wso2/carbon-apimgt/commit/e00fe40f5ef809f1ac81dc7c22faacda062adfab", "message": "Reformatted the approval workflow executor and rest APIs", "committedDate": "2020-04-15T10:56:04Z", "type": "commit"}, {"oid": "68b7419e6cbaa0784e59e60fbdbe77dbb27eb484", "url": "https://github.com/wso2/carbon-apimgt/commit/68b7419e6cbaa0784e59e60fbdbe77dbb27eb484", "message": "Changed the licence header in Approval Workflow Executor tests", "committedDate": "2020-04-19T01:46:12Z", "type": "commit"}, {"oid": "3719d98f3d2faba218147e15535025aa6169e371", "url": "https://github.com/wso2/carbon-apimgt/commit/3719d98f3d2faba218147e15535025aa6169e371", "message": "Change the licence header of Workflow.java", "committedDate": "2020-04-19T02:28:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDMwNzI2NQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r414307265", "bodyText": "formatting issue", "author": "chamilaadhi", "createdAt": "2020-04-24T05:39:14Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/APIAdminImpl.java", "diffHunk": "@@ -349,4 +346,38 @@ private int isCategoryAttached(APICategory category, String username) throws API\n         int length = (Integer) result.get(\"length\");\n         return length;\n     }\n+\n+    /**\n+     * The method converts the date into timestamp\n+     *\n+     * @param workflowType\n+     * @param status\n+     * @param tenantDomain\n+     * @return Workflow[]\n+     * @throws APIManagementException\n+     */\n+    public Workflow[] getworkflows(String workflowType, String status, String tenantDomain ) throws APIManagementException {", "originalCommit": "3719d98f3d2faba218147e15535025aa6169e371", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDMwNzQxOQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r414307419", "bodyText": "add a description for each parameter", "author": "chamilaadhi", "createdAt": "2020-04-24T05:39:39Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/APIAdminImpl.java", "diffHunk": "@@ -349,4 +346,38 @@ private int isCategoryAttached(APICategory category, String username) throws API\n         int length = (Integer) result.get(\"length\");\n         return length;\n     }\n+\n+    /**\n+     * The method converts the date into timestamp\n+     *\n+     * @param workflowType", "originalCommit": "3719d98f3d2faba218147e15535025aa6169e371", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDMwNzk3OQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8293#discussion_r414307979", "bodyText": "this method is not formatted", "author": "chamilaadhi", "createdAt": "2020-04-24T05:41:07Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/ApiMgtDAO.java", "diffHunk": "@@ -14610,4 +14620,243 @@ public String getUserID(String userName) throws APIManagementException {\n         }\n         return list;\n     }\n+\n+    /**\n+     * Remove the Pending workflow Requests using ExternalWorkflowReference\n+     * @param workflowExtRef External Workflow Reference of Workflow Pending Request\n+     * @throws APIManagementException\n+     */\n+    public void deleteWorkflowRequest(String workflowExtRef) throws APIManagementException {\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+        String query = SQLConstants.DELETE_WORKFLOW_REQUEST_SQL;\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            connection.setAutoCommit(false);\n+            prepStmt = connection.prepareStatement(query);\n+            prepStmt.setString(1, workflowExtRef);\n+            prepStmt.executeUpdate();\n+            connection.commit();\n+        }\n+        catch (SQLException e) {\n+            handleException(\"Failed to delete the workflow request. \", e);\n+        } finally {\n+            APIMgtDBUtil.closeAllConnections(prepStmt, connection, null);\n+        }\n+    }\n+\n+    /**\n+     * Get the Pending workflow Request using ExternalWorkflowReference\n+     * @param externalWorkflowRef\n+     * @return workflow pending request\n+     * @throws APIManagementException\n+     */\n+    public Workflow getworkflowReferenceByExternalWorkflowReference(String externalWorkflowRef)throws APIManagementException {\n+\n+        Connection connection = null;\n+        PreparedStatement prepStmt = null;\n+        ResultSet rs = null;\n+        Workflow workflow = new Workflow();\n+        String sqlQuery = SQLConstants.GET_ALL_WORKFLOW_DETAILS_BY_EXTERNALWORKFLOWREF;\n+        try {\n+            connection = APIMgtDBUtil.getConnection();\n+            prepStmt = connection.prepareStatement(sqlQuery);\n+            prepStmt.setString(1, externalWorkflowRef);\n+            rs = prepStmt.executeQuery();\n+\n+            while (rs.next()) {\n+                workflow.setWorkflowId(rs.getInt(\"WF_ID\"));\n+                workflow.setWorkflowReference(rs.getString(\"WF_REFERENCE\"));\n+                workflow.setWorkflowType(rs.getString(\"WF_TYPE\"));\n+                String workflowstatus =rs.getString(\"WF_STATUS\");\n+                workflow.setStatus(org.wso2.carbon.apimgt.api.WorkflowStatus.valueOf(workflowstatus));\n+                workflow.setCreatedTime(rs.getTimestamp(\"WF_CREATED_TIME\").toString());\n+                workflow.setUpdatedTime(rs.getTimestamp(\"WF_UPDATED_TIME\").toString());\n+                workflow.setWorkflowStatusDesc(rs.getString(\"WF_STATUS_DESC\"));\n+                workflow.setTenantId(rs.getInt(\"TENANT_ID\"));\n+                workflow.setTenantDomain(rs.getString(\"TENANT_DOMAIN\"));\n+                workflow.setExternalWorkflowReference(rs.getString(\"WF_EXTERNAL_REFERENCE\"));\n+                Blob metadatablob = rs.getBlob(\"WF_METADATA\");\n+\n+                byte[] metadataByte;\n+                if(metadatablob != null) {\n+                    metadataByte = metadatablob.getBytes(1L, (int) metadatablob.length());\n+                    InputStream targetStream = new ByteArrayInputStream(metadataByte);\n+                    String metadata = APIMgtDBUtil.getStringFromInputStream(targetStream);\n+                    Gson metadataGson = new Gson();\n+                    JSONObject metadataJson = metadataGson.fromJson(metadata, JSONObject.class);\n+                    workflow.setMetadata(metadataJson);\n+                } else {\n+                    JSONObject metadataJson = new JSONObject();\n+                    workflow.setMetadata(metadataJson);\n+                }\n+            }\n+        } catch (SQLException e) {\n+            handleException(\"Error when retriving the workflow details. \" , e);\n+        } finally {\n+            APIMgtDBUtil.closeAllConnections(prepStmt, connection, rs);\n+        }\n+        return workflow;\n+    }\n+\n+    /**\n+     * Get the Pending workflow Requests using WorkflowType for a particular tenant\n+     * @param workflowType Type of the workflow pending request\n+     * @param status workflow status of workflow pending request\n+     * @param tenantDomain tenantDomain of the user\n+     * @return List of workflow pending request\n+     * @throws APIManagementException\n+     */\n+    public Workflow[] getworkflows(String workflowType, String status, String tenantDomain) throws APIManagementException {", "originalCommit": "3719d98f3d2faba218147e15535025aa6169e371", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "9b48a01776745e4804aee0554f67dde112e0ccdd", "url": "https://github.com/wso2/carbon-apimgt/commit/9b48a01776745e4804aee0554f67dde112e0ccdd", "message": "Reformtted the previous commits and removed unwanted files", "committedDate": "2020-04-24T09:47:33Z", "type": "commit"}, {"oid": "56d859aa06815de769c0130c450c2764150312fc", "url": "https://github.com/wso2/carbon-apimgt/commit/56d859aa06815de769c0130c450c2764150312fc", "message": "Changed the admin-api.yaml and beans.xml in org.wso2.carbon.apimgt.rest.api.admin", "committedDate": "2020-04-28T10:11:28Z", "type": "commit"}]}