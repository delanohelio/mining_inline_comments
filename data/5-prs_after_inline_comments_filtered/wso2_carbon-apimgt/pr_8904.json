{"pr_number": 8904, "pr_title": "fix interminet subscription inactive issue", "pr_createdAt": "2020-07-01T18:39:53Z", "pr_url": "https://github.com/wso2/carbon-apimgt/pull/8904", "timeline": [{"oid": "67dcd08304b7d61fb827cbfea9199c085a49b2ca", "url": "https://github.com/wso2/carbon-apimgt/commit/67dcd08304b7d61fb827cbfea9199c085a49b2ca", "message": "fix interminet subscription inactive issue", "committedDate": "2020-07-01T18:41:07Z", "type": "commit"}, {"oid": "67dcd08304b7d61fb827cbfea9199c085a49b2ca", "url": "https://github.com/wso2/carbon-apimgt/commit/67dcd08304b7d61fb827cbfea9199c085a49b2ca", "message": "fix interminet subscription inactive issue", "committedDate": "2020-07-01T18:41:07Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODU1NDkyNg==", "url": "https://github.com/wso2/carbon-apimgt/pull/8904#discussion_r448554926", "bodyText": "shall we make it a warn?", "author": "bhathiya", "createdAt": "2020-07-01T18:51:46Z", "path": "components/apimgt/org.wso2.carbon.apimgt.keymgt/src/main/java/org/wso2/carbon/apimgt/keymgt/model/impl/SubscriptionDataStoreImpl.java", "diffHunk": "@@ -354,7 +354,21 @@ public boolean isSubscriptionValidationDataInitialized() {\n \n     @Override\n     public void addOrUpdateSubscription(Subscription subscription) {\n-        subscriptionMap.put(subscription.getCacheKey(), subscription);\n+\n+        synchronized (subscriptionMap) {\n+            Subscription retrievedSubscription = subscriptionMap.get(subscription.getCacheKey());\n+            if (retrievedSubscription == null) {\n+                subscriptionMap.put(subscription.getCacheKey(), subscription);\n+            } else {\n+                if (subscription.getTimeStamp() < retrievedSubscription.getTimeStamp()) {\n+                    if (log.isDebugEnabled()) {\n+                        log.debug(\"Drop the Event \" + subscription.toString() + \" since the event timestamp was old\");", "originalCommit": "67dcd08304b7d61fb827cbfea9199c085a49b2ca", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}