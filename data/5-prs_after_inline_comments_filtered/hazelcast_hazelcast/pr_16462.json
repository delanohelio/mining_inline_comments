{"pr_number": 16462, "pr_title": "Take serializeKeys into account in containsKey at ClientMapProxy", "pr_createdAt": "2020-01-10T12:14:27Z", "pr_url": "https://github.com/hazelcast/hazelcast/pull/16462", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTIwOTQ4Ng==", "url": "https://github.com/hazelcast/hazelcast/pull/16462#discussion_r365209486", "bodyText": "This looks clearer:\nif (serializeKeys) {\n\tcheckInstanceOf(Data.class, key, \"key must be of type Data!\");\n} else {\n    checkNotInstanceOf(Data.class, key, \"key cannot be of type Data!\");        \n}", "author": "ahmetmircik", "createdAt": "2020-01-10T12:22:47Z", "path": "hazelcast/src/main/java/com/hazelcast/internal/nearcache/impl/DefaultNearCache.java", "diffHunk": "@@ -222,6 +223,8 @@ public V tryPublishReserved(K key, V value, long reservationId, boolean deserial\n     private void checkKeyFormat(K key) {\n         if (!serializeKeys) {\n             checkNotInstanceOf(Data.class, key, \"key cannot be of type Data!\");\n+        } else {\n+            checkInstanceOf(Data.class, key, \"key must be of type Data!\");\n         }", "originalCommit": "15a0322816e5a745cca13c8ab94c4bce1531f78b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "ba218b95614072a1752f73cf43ade8b31a4967cc", "url": "https://github.com/hazelcast/hazelcast/commit/ba218b95614072a1752f73cf43ade8b31a4967cc", "message": "fixing test to honor serializeKeys also", "committedDate": "2020-01-10T13:12:22Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTY3Njg1Ng==", "url": "https://github.com/hazelcast/hazelcast/pull/16462#discussion_r365676856", "bodyText": "can we fail fast here instead of forcing it to be false?", "author": "ahmetmircik", "createdAt": "2020-01-13T08:03:43Z", "path": "hazelcast/src/main/java/com/hazelcast/client/impl/proxy/ClientReplicatedMapProxy.java", "diffHunk": "@@ -112,7 +112,11 @@ protected void onInitialize() {\n     private void initNearCache() {\n         NearCacheConfig nearCacheConfig = getContext().getClientConfig().getNearCacheConfig(name);\n         if (nearCacheConfig != null) {\n-            nearCache = getContext().getNearCacheManager(getServiceName()).getOrCreateNearCache(name, nearCacheConfig);\n+            NearCacheConfig copyNearCacheConfig = new NearCacheConfig(nearCacheConfig);\n+            //We don't have serializeKeys support on replicated map nearcache\n+            copyNearCacheConfig.setSerializeKeys(false);", "originalCommit": "73efca89f265e5fb3c53a9d3a2893000e6007d30", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "7bbd4586a00b0443e25d75c7ee22960724c0d369", "url": "https://github.com/hazelcast/hazelcast/commit/7bbd4586a00b0443e25d75c7ee22960724c0d369", "message": "Take serializeKeys into account in containsKey at ClientMapProxy\n\nNote that after adding the check to `checkKeyFormat` ,\nClientMapNearCacheBasicSlowTest starts to fail. It has tests\nfor containsKey. With the fix, it is passing now. So no new test is\nneeded.\n\nrelated to https://github.com/hazelcast/hazelcast/issues/16458", "committedDate": "2020-01-13T12:17:02Z", "type": "commit"}, {"oid": "05677733b17a924fd2819d8e51df7ba4310e3c6f", "url": "https://github.com/hazelcast/hazelcast/commit/05677733b17a924fd2819d8e51df7ba4310e3c6f", "message": "address review comments", "committedDate": "2020-01-13T12:17:02Z", "type": "commit"}, {"oid": "dd53b86abb0fe92c57dfaeb1bf2c24d867bbfa2b", "url": "https://github.com/hazelcast/hazelcast/commit/dd53b86abb0fe92c57dfaeb1bf2c24d867bbfa2b", "message": "fixing test to honor serializeKeys also", "committedDate": "2020-01-13T12:17:02Z", "type": "commit"}, {"oid": "0557b1cc96667796d3504b40573c9d6e97cc3cba", "url": "https://github.com/hazelcast/hazelcast/commit/0557b1cc96667796d3504b40573c9d6e97cc3cba", "message": "don't use serializeKeys on replicated map nearcache", "committedDate": "2020-01-13T12:17:02Z", "type": "commit"}, {"oid": "3bd216eebf32e801a395b12e53df81dfb1b4483d", "url": "https://github.com/hazelcast/hazelcast/commit/3bd216eebf32e801a395b12e53df81dfb1b4483d", "message": "make serializeKeys option failfast for replicated map", "committedDate": "2020-01-13T12:36:10Z", "type": "forcePushed"}, {"oid": "1cfbf837cbcdc5dcd9178418e44747861df96624", "url": "https://github.com/hazelcast/hazelcast/commit/1cfbf837cbcdc5dcd9178418e44747861df96624", "message": "make serializeKeys option failfast for replicated map", "committedDate": "2020-01-14T11:15:44Z", "type": "commit"}, {"oid": "1cfbf837cbcdc5dcd9178418e44747861df96624", "url": "https://github.com/hazelcast/hazelcast/commit/1cfbf837cbcdc5dcd9178418e44747861df96624", "message": "make serializeKeys option failfast for replicated map", "committedDate": "2020-01-14T11:15:44Z", "type": "forcePushed"}]}