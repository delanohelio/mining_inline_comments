{"pr_number": 17487, "pr_title": "Improve thread finishing", "pr_createdAt": "2020-09-03T14:57:07Z", "pr_url": "https://github.com/hazelcast/hazelcast/pull/17487", "timeline": [{"oid": "fa3169f107d3993a88e1a1454f509b9c2e29bea5", "url": "https://github.com/hazelcast/hazelcast/commit/fa3169f107d3993a88e1a1454f509b9c2e29bea5", "message": "Shutdown executors properly", "committedDate": "2020-09-03T16:02:13Z", "type": "forcePushed"}, {"oid": "554d6a3bf3175b88a6acd956a22d15b3a75975c6", "url": "https://github.com/hazelcast/hazelcast/commit/554d6a3bf3175b88a6acd956a22d15b3a75975c6", "message": "Shutdown executors properly", "committedDate": "2020-09-03T19:24:15Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTUxNDQ1NA==", "url": "https://github.com/hazelcast/hazelcast/pull/17487#discussion_r485514454", "bodyText": "If this thread is blocked inside tryReplicateExpiredWaitKeys() method, I don't think this change will help. I don't remember how raftNode.replicate(op).get() behaves when the local member is shutdown. We should investigate it too.", "author": "mdogan", "createdAt": "2020-09-09T10:42:45Z", "path": "hazelcast/src/main/java/com/hazelcast/cp/internal/datastructures/spi/blocking/AbstractBlockingService.java", "diffHunk": "@@ -366,6 +367,9 @@ public void run() {\n         @Override\n         public void run() {\n             for (Entry<CPGroupId, Collection<BiTuple<String, UUID>>> e : getWaitKeysToExpire().entrySet()) {\n+                if (currentThread().isInterrupted()) {\n+                    break;\n+                }\n                 tryReplicateExpiredWaitKeys(e.getKey(), e.getValue());", "originalCommit": "3570ccda3fdcbb08efe74d5a94e70ee46b0197f8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTU2MDUzNg==", "url": "https://github.com/hazelcast/hazelcast/pull/17487#discussion_r485560536", "bodyText": "I have added timeout there as you suggested.", "author": "ahmetmircik", "createdAt": "2020-09-09T12:09:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTUxNDQ1NA=="}], "type": "inlineReview"}, {"oid": "7d34659a842cae834fe88ca5ef64dff6c5388ebc", "url": "https://github.com/hazelcast/hazelcast/commit/7d34659a842cae834fe88ca5ef64dff6c5388ebc", "message": "Address Mehmet comments", "committedDate": "2020-09-09T12:06:01Z", "type": "forcePushed"}, {"oid": "bf3084683fb804ea7f35e31e648687515b49b196", "url": "https://github.com/hazelcast/hazelcast/commit/bf3084683fb804ea7f35e31e648687515b49b196", "message": "Shutdown executors properly", "committedDate": "2020-09-09T12:10:28Z", "type": "commit"}, {"oid": "b3f0fd41d3d1878b73ce1cb1b2b3e4a670780558", "url": "https://github.com/hazelcast/hazelcast/commit/b3f0fd41d3d1878b73ce1cb1b2b3e4a670780558", "message": "wip now", "committedDate": "2020-09-09T12:10:28Z", "type": "commit"}, {"oid": "dd603dbe1977696af45b86ebf14b7c6312af04f5", "url": "https://github.com/hazelcast/hazelcast/commit/dd603dbe1977696af45b86ebf14b7c6312af04f5", "message": "wip remove wait", "committedDate": "2020-09-09T12:10:28Z", "type": "commit"}, {"oid": "056cadc227845c3844221439110a612cbfa4f0c8", "url": "https://github.com/hazelcast/hazelcast/commit/056cadc227845c3844221439110a612cbfa4f0c8", "message": "handle thread interrupts", "committedDate": "2020-09-09T12:10:28Z", "type": "commit"}, {"oid": "6d97a77d172c6b48dcef3bb1ec006f5b627fbdbd", "url": "https://github.com/hazelcast/hazelcast/commit/6d97a77d172c6b48dcef3bb1ec006f5b627fbdbd", "message": "wip", "committedDate": "2020-09-09T12:10:28Z", "type": "commit"}, {"oid": "62e634cba0a7a71aecc9b40e3f73f09aa39fbb70", "url": "https://github.com/hazelcast/hazelcast/commit/62e634cba0a7a71aecc9b40e3f73f09aa39fbb70", "message": "Address Mehmet comments", "committedDate": "2020-09-09T12:11:43Z", "type": "commit"}, {"oid": "62e634cba0a7a71aecc9b40e3f73f09aa39fbb70", "url": "https://github.com/hazelcast/hazelcast/commit/62e634cba0a7a71aecc9b40e3f73f09aa39fbb70", "message": "Address Mehmet comments", "committedDate": "2020-09-09T12:11:43Z", "type": "forcePushed"}]}