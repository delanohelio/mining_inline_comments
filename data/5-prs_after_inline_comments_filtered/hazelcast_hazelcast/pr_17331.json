{"pr_number": 17331, "pr_title": "Fix WanAddConfigTest#testConfigAddingWithLiteMembersAdded", "pr_createdAt": "2020-08-11T12:43:09Z", "pr_url": "https://github.com/hazelcast/hazelcast/pull/17331", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODU1MTczMg==", "url": "https://github.com/hazelcast/hazelcast/pull/17331#discussion_r468551732", "bodyText": "This is the part which needs to be forward-ported to 4.1, with an adapted test in EE.", "author": "mmedenjak", "createdAt": "2020-08-11T12:46:11Z", "path": "hazelcast/src/main/java/com/hazelcast/wan/impl/WanEventContainerReplicationOperation.java", "diffHunk": "@@ -69,7 +69,7 @@ public void run() throws Exception {\n         int partitionId = getPartitionId();\n \n         for (WanReplicationConfig wanReplicationConfig : wanReplicationConfigs) {\n-            service.appendWanReplicationConfig(wanReplicationConfig);\n+            service.addWanReplicationConfigLocally(wanReplicationConfig);", "originalCommit": "65c86a7f6df26cce678fdf19e3b43d771c871e3b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e2d2ba92fc12b26d57ddefdea6475faca8647f58", "url": "https://github.com/hazelcast/hazelcast/commit/e2d2ba92fc12b26d57ddefdea6475faca8647f58", "message": "Fix WanAddConfigTest#testConfigAddingWithLiteMembersAdded\n\nWAN config is added as a partition operation. Lite members don't own any\npartitions which is why they don't get the WAN config added. In 3.12.z\nand 4.0.z we applied a best-effort fix where we add the config locally\nin case the member adding the config is a lite member while in 4.1 we\nadd a new operation which adds the config on lite members specifically.\nThis test fails randomly when the member adding the config is a data\nmember and passes when the member adding the config is a lite member.\n\nSince we cannot introduce new operations in a patch release, the only\noption is to adapt the test. The original version should still be\npassing on 4.1 and onward.\n\nWe apply an additional fix because the WAN queue migration operation\nwould add dynamically added WAN config even to a promoted lite member\nbut wouldn't initialize it, causing the rest of the migration operation\nto fail.\n\nFixes: https://github.com/hazelcast/hazelcast-enterprise/issues/3612\nFixes: https://github.com/hazelcast/hazelcast-enterprise/issues/3598", "committedDate": "2020-08-11T14:50:20Z", "type": "commit"}, {"oid": "e2d2ba92fc12b26d57ddefdea6475faca8647f58", "url": "https://github.com/hazelcast/hazelcast/commit/e2d2ba92fc12b26d57ddefdea6475faca8647f58", "message": "Fix WanAddConfigTest#testConfigAddingWithLiteMembersAdded\n\nWAN config is added as a partition operation. Lite members don't own any\npartitions which is why they don't get the WAN config added. In 3.12.z\nand 4.0.z we applied a best-effort fix where we add the config locally\nin case the member adding the config is a lite member while in 4.1 we\nadd a new operation which adds the config on lite members specifically.\nThis test fails randomly when the member adding the config is a data\nmember and passes when the member adding the config is a lite member.\n\nSince we cannot introduce new operations in a patch release, the only\noption is to adapt the test. The original version should still be\npassing on 4.1 and onward.\n\nWe apply an additional fix because the WAN queue migration operation\nwould add dynamically added WAN config even to a promoted lite member\nbut wouldn't initialize it, causing the rest of the migration operation\nto fail.\n\nFixes: https://github.com/hazelcast/hazelcast-enterprise/issues/3612\nFixes: https://github.com/hazelcast/hazelcast-enterprise/issues/3598", "committedDate": "2020-08-11T14:50:20Z", "type": "forcePushed"}]}