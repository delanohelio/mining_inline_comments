{"pr_number": 17934, "pr_title": "[IMDG-177] Java util optional serialization support", "pr_createdAt": "2020-12-04T11:46:49Z", "pr_url": "https://github.com/hazelcast/hazelcast/pull/17934", "timeline": [{"oid": "6bd225853cbf3b184920a5622b9ca9c05fd21d8e", "url": "https://github.com/hazelcast/hazelcast/commit/6bd225853cbf3b184920a5622b9ca9c05fd21d8e", "message": "Implemented serialization support of java.util.Optional", "committedDate": "2020-12-04T11:37:56Z", "type": "commit"}, {"oid": "096b2faea7f94c8aee9e850a6611922cb3ab4b75", "url": "https://github.com/hazelcast/hazelcast/commit/096b2faea7f94c8aee9e850a6611922cb3ab4b75", "message": "Updated serialization compatibility test", "committedDate": "2020-12-04T11:38:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjA0Mjc1Mw==", "url": "https://github.com/hazelcast/hazelcast/pull/17934#discussion_r536042753", "bodyText": "Is it OK to continue in row of negative ids?", "author": "sgflt", "createdAt": "2020-12-04T11:48:17Z", "path": "hazelcast/src/main/java/com/hazelcast/internal/serialization/impl/SerializationConstants.java", "diffHunk": "@@ -127,10 +127,12 @@\n \n     public static final int JAVA_DEFAULT_TYPE_PRIORITY_QUEUE = -49;\n \n+    public static final int JAVA_DEFAULT_TYPE_OPTIONAL = -50;", "originalCommit": "6bd225853cbf3b184920a5622b9ca9c05fd21d8e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODQyNDMwOQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17934#discussion_r538424309", "bodyText": "Yes, it is ok.", "author": "sancar", "createdAt": "2020-12-08T14:19:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjA0Mjc1Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjA0MzExMQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17934#discussion_r536043111", "bodyText": "TYPE_ENUM seems to be unused, but for sure I just decreased indentifier.", "author": "sgflt", "createdAt": "2020-12-04T11:49:04Z", "path": "hazelcast/src/main/java/com/hazelcast/internal/serialization/impl/SerializationConstants.java", "diffHunk": "@@ -127,10 +127,12 @@\n \n     public static final int JAVA_DEFAULT_TYPE_PRIORITY_QUEUE = -49;\n \n+    public static final int JAVA_DEFAULT_TYPE_OPTIONAL = -50;\n+\n     // NUMBER OF CONSTANT SERIALIZERS...\n-    public static final int CONSTANT_SERIALIZERS_LENGTH = 50;\n+    public static final int CONSTANT_SERIALIZERS_LENGTH = 51;\n \n-    public static final int JAVA_DEFAULT_TYPE_ENUM = -50;\n+    public static final int JAVA_DEFAULT_TYPE_ENUM = -51;", "originalCommit": "6bd225853cbf3b184920a5622b9ca9c05fd21d8e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzI2ODE4OQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17934#discussion_r537268189", "bodyText": "It could be used from our other projects like JET. Lets don't change it and add  JAVA_DEFAULT_TYPE_OPTIONAL as -51", "author": "sancar", "createdAt": "2020-12-07T06:50:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjA0MzExMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzQyMzIwMA==", "url": "https://github.com/hazelcast/hazelcast/pull/17934#discussion_r537423200", "bodyText": "I have tried suggested change, but there is a small problem with indexes. java.lang.ArrayIndexOutOfBoundsException: Index 51 out of bounds for length 51\nEach identifier is used as index to an array of registered serializers. ENUM is not registered and this causes null element on index 50 if CONSTANT_SERIALIZERS_LENGTH is set to 52.\nIs the null acceptable in array of serializers? (At first glance it seems to me as some kind of access optimization that is trying to prevent null to exist in array)", "author": "sgflt", "createdAt": "2020-12-07T11:12:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjA0MzExMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODQyNDU4MA==", "url": "https://github.com/hazelcast/hazelcast/pull/17934#discussion_r538424580", "bodyText": "Hi @sgflt , I have double-checked. It seems that the enum serializer is actually deleted but accidentally put back when doing a merge. We can delete it completely.", "author": "sancar", "createdAt": "2020-12-08T14:20:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjA0MzExMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODUzMDUwNg==", "url": "https://github.com/hazelcast/hazelcast/pull/17934#discussion_r538530506", "bodyText": "Hi @sancar. I've pushed commit with deletion of unused constant. Thanks for review.", "author": "sgflt", "createdAt": "2020-12-08T15:56:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjA0MzExMQ=="}], "type": "inlineReview"}, {"oid": "2ccb37586c53c168d62b5ede70fd938e4fe0d5f0", "url": "https://github.com/hazelcast/hazelcast/commit/2ccb37586c53c168d62b5ede70fd938e4fe0d5f0", "message": "Deleted unused constant JAVA_DEFAULT_TYPE_ENUM", "committedDate": "2020-12-08T15:51:26Z", "type": "commit"}]}