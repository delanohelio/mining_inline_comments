{"pr_number": 17826, "pr_title": "Release acquired sessions on failure for SessionAwareSemaphore", "pr_createdAt": "2020-11-04T10:09:24Z", "pr_url": "https://github.com/hazelcast/hazelcast/pull/17826", "timeline": [{"oid": "7d7fc0b59ecaab7f5442e71abd33ff299063157b", "url": "https://github.com/hazelcast/hazelcast/commit/7d7fc0b59ecaab7f5442e71abd33ff299063157b", "message": "Release acquired sessions on failure for SessionAwareSemaphore\n\nIn case of an unspecified exception, `acquire`, `tryAcquire` and\n`drainPermits` methods were not releasing the acquired permits.\nThis is an attempt to fix that problem by catching unspecified errors,\nreleasing the number of acquired permits, and rethrowing.", "committedDate": "2020-11-26T07:09:34Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDg0NTU2Mw==", "url": "https://github.com/hazelcast/hazelcast/pull/17826#discussion_r530845563", "bodyText": "We return false for other exceptional cases. Does a user expect an exception from this method?", "author": "petrpleshachkov", "createdAt": "2020-11-26T08:21:59Z", "path": "hazelcast/src/main/java/com/hazelcast/client/cp/internal/datastructures/semaphore/SessionAwareSemaphoreProxy.java", "diffHunk": "@@ -147,6 +151,9 @@ public boolean tryAcquire(int permits, long timeout, TimeUnit unit) {\n             } catch (WaitKeyCancelledException e) {\n                 sessionManager.releaseSession(this.groupId, sessionId, permits);\n                 return false;\n+            } catch (Throwable t) {\n+                sessionManager.releaseSession(this.groupId, sessionId, permits);\n+                throw rethrow(t);", "originalCommit": "7d7fc0b59ecaab7f5442e71abd33ff299063157b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDg4NzY1NQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17826#discussion_r530887655", "bodyText": "I didn't want to change the existing behavior so, I re-throw the exception here", "author": "mdumandag", "createdAt": "2020-11-26T09:29:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDg0NTU2Mw=="}], "type": "inlineReview"}, {"oid": "ef89f0a46a06cfdb555f005cc84cbbead137e366", "url": "https://github.com/hazelcast/hazelcast/commit/ef89f0a46a06cfdb555f005cc84cbbead137e366", "message": "add unit tests", "committedDate": "2021-01-22T10:22:19Z", "type": "forcePushed"}, {"oid": "4c020f9323149bbd6049eed14bb9285449049016", "url": "https://github.com/hazelcast/hazelcast/commit/4c020f9323149bbd6049eed14bb9285449049016", "message": "Release acquired sessions on failure for SessionAwareSemaphore\n\nIn case of an unspecified exception, `acquire`, `tryAcquire` and\n`drainPermits` methods were not releasing the acquired permits.\nThis is an attempt to fix that problem by catching unspecified errors,\nreleasing the number of acquired permits, and rethrowing.", "committedDate": "2021-03-03T09:59:49Z", "type": "commit"}, {"oid": "555227e53055c3e3e90ffe77d1b4a79a93db419f", "url": "https://github.com/hazelcast/hazelcast/commit/555227e53055c3e3e90ffe77d1b4a79a93db419f", "message": "catch only RuntimeExceptions", "committedDate": "2021-03-03T09:59:49Z", "type": "commit"}, {"oid": "016a487bbc46daba03ea99cb6ff8424d953b009d", "url": "https://github.com/hazelcast/hazelcast/commit/016a487bbc46daba03ea99cb6ff8424d953b009d", "message": "add unit tests", "committedDate": "2021-03-03T09:59:49Z", "type": "commit"}, {"oid": "d1b9c6d27a6392b36a90abc65e3db9cf86d409b4", "url": "https://github.com/hazelcast/hazelcast/commit/d1b9c6d27a6392b36a90abc65e3db9cf86d409b4", "message": "add missing copyright headers", "committedDate": "2021-03-03T10:00:30Z", "type": "commit"}, {"oid": "d1b9c6d27a6392b36a90abc65e3db9cf86d409b4", "url": "https://github.com/hazelcast/hazelcast/commit/d1b9c6d27a6392b36a90abc65e3db9cf86d409b4", "message": "add missing copyright headers", "committedDate": "2021-03-03T10:00:30Z", "type": "forcePushed"}, {"oid": "c159ded258643b1b3ca013e5393edf5c5418efe1", "url": "https://github.com/hazelcast/hazelcast/commit/c159ded258643b1b3ca013e5393edf5c5418efe1", "message": "update copyright years", "committedDate": "2021-03-03T10:07:19Z", "type": "commit"}]}