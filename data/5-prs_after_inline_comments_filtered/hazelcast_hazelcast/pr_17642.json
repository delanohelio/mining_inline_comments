{"pr_number": 17642, "pr_title": "Add support for JAAS logout on member side", "pr_createdAt": "2020-09-29T13:18:41Z", "pr_url": "https://github.com/hazelcast/hazelcast/pull/17642", "timeline": [{"oid": "7c07eff9e89cf08bf06e32820d484eda13813a1e", "url": "https://github.com/hazelcast/hazelcast/commit/7c07eff9e89cf08bf06e32820d484eda13813a1e", "message": "Add JAAS login context to Connection's attribute map and use it to call logout when the Connection is closed.", "committedDate": "2020-09-29T13:06:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjI4NDcxNg==", "url": "https://github.com/hazelcast/hazelcast/pull/17642#discussion_r502284716", "bodyText": "Do we know how much time a logout can take?\nIf we don't know, then probably it is best to get this offloaded to some executor to prevent blocking this thread for an underermined amount of time.", "author": "pveentjer", "createdAt": "2020-10-09T08:53:16Z", "path": "hazelcast/src/main/java/com/hazelcast/internal/server/tcp/TcpServerConnection.java", "diffHunk": "@@ -246,6 +249,15 @@ public void close(String reason, Throwable cause) {\n \n         lifecycleListener.onConnectionClose(this, null, false);\n         serverContext.onDisconnect(remoteAddress, cause);\n+\n+        LoginContext lc = (LoginContext) attributeMap.remove(LoginContext.class);\n+        if (lc != null) {\n+            try {\n+                lc.logout();", "originalCommit": "7c07eff9e89cf08bf06e32820d484eda13813a1e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjM1NTgxMw==", "url": "https://github.com/hazelcast/hazelcast/pull/17642#discussion_r502355813", "bodyText": "Logout usually means just removing some principal instances from a Set in the JAAS Subject.\nThe member login is not offloaded either, so let's keep it here the simple way.", "author": "kwart", "createdAt": "2020-10-09T11:11:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjI4NDcxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA2MDU3NA==", "url": "https://github.com/hazelcast/hazelcast/pull/17642#discussion_r503060574", "bodyText": "If it is just removal of a set, I'm fine with it. But if it potentially involved alien code and perhaps even doing remote calls.....", "author": "pveentjer", "createdAt": "2020-10-12T06:18:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjI4NDcxNg=="}], "type": "inlineReview"}]}