{"pr_number": 17550, "pr_title": "Simplify SqlResult", "pr_createdAt": "2020-09-15T20:54:19Z", "pr_url": "https://github.com/hazelcast/hazelcast/pull/17550", "timeline": [{"oid": "71b8446a9ddcebbbaca6f6060eacc7bbf72882af", "url": "https://github.com/hazelcast/hazelcast/commit/71b8446a9ddcebbbaca6f6060eacc7bbf72882af", "message": "Simplify SqlResult\n\nThe current SqlResult can represent two options: it's either a row set\nor an update count. The type is determined by calling `isUpdateCount()`.\n\nThis PR aligns it with the JDBC API:\n\n- we eliminate the `isUpdateCount()` method. Instead, the\n`updateCount()` method returns -1 in case the result represents a row set\n\n- we ensure that a result with update count doesn't have negative count\n\nWe also remove `isUpdateCount` from the responses and rename\n`updatedCount` to `updateCount`.", "committedDate": "2020-09-15T20:52:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTIzMDE5Ng==", "url": "https://github.com/hazelcast/hazelcast/pull/17550#discussion_r489230196", "bodyText": "What is the motivation for returning null? It is inconsistent with the behavior of the iterator() method. and makes the code prone to NPE. The previous behavior does not have this problem.", "author": "devozerov", "createdAt": "2020-09-16T07:43:06Z", "path": "hazelcast/src/main/java/com/hazelcast/sql/SqlResult.java", "diffHunk": "@@ -41,33 +41,24 @@\n  * }\n  * </pre>\n  *\n- * <p>\n  * <h4>Usage for update count</h4>\n  *\n  * <pre>\n  *     long updated = hazelcastInstance.getSql().execute(\"UPDATE ...\").updateCount();\n  * </pre>\n  *\n  * You don't need to call {@link #close()} in this case.\n+ *\n+ * <h4>Determining the type of the result</h4>\n+ *\n+ * To determine whether the result contains rows or an update count, call\n+ * {@link #updateCount()}. If it returns -1, the result is rows, otherwise\n+ * it's update count.\n  */\n public interface SqlResult extends Iterable<SqlRow>, AutoCloseable {\n \n     /**\n-     * If this result represents a row set, this method returns {@code false}.\n-     * If this result represents an update count (such as for a DML query), it\n-     * returns {@code true}.\n-     *\n-     * @return {@code false} for a rows result and {@code true} for an update\n-     *     count result\n-     */\n-    boolean isUpdateCount();\n-\n-    /**\n-     * Gets row metadata.\n-     *\n-     * @throws IllegalStateException if this result doesn't have rows (i.e.\n-     *     when {@link #isUpdateCount()} returns {@code true})\n-     * @return row metadata\n+     * Gets the row metadata or {@code null} if this result is an update count.", "originalCommit": "71b8446a9ddcebbbaca6f6060eacc7bbf72882af", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTMwMTg5OQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17550#discussion_r489301899", "bodyText": "It's stale Javadoc, I first returned null but changed it for the same reason. Fixed.", "author": "viliam-durina", "createdAt": "2020-09-16T09:35:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTIzMDE5Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTIzMDk0OQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17550#discussion_r489230949", "bodyText": "I think that instead of asking the user to do updateCount() == -1 to check for the result type, we should leave this method in the inversed form. This is more convenient and easier to use, and makes no harm to the API:\nboolean isResultSet() {\n    return updateCount() == -1;\n}", "author": "devozerov", "createdAt": "2020-09-16T07:44:21Z", "path": "hazelcast/src/main/java/com/hazelcast/sql/SqlResult.java", "diffHunk": "@@ -41,33 +41,24 @@\n  * }\n  * </pre>\n  *\n- * <p>\n  * <h4>Usage for update count</h4>\n  *\n  * <pre>\n  *     long updated = hazelcastInstance.getSql().execute(\"UPDATE ...\").updateCount();\n  * </pre>\n  *\n  * You don't need to call {@link #close()} in this case.\n+ *\n+ * <h4>Determining the type of the result</h4>\n+ *\n+ * To determine whether the result contains rows or an update count, call\n+ * {@link #updateCount()}. If it returns -1, the result is rows, otherwise\n+ * it's update count.\n  */\n public interface SqlResult extends Iterable<SqlRow>, AutoCloseable {\n \n     /**\n-     * If this result represents a row set, this method returns {@code false}.\n-     * If this result represents an update count (such as for a DML query), it\n-     * returns {@code true}.\n-     *\n-     * @return {@code false} for a rows result and {@code true} for an update\n-     *     count result\n-     */\n-    boolean isUpdateCount();", "originalCommit": "71b8446a9ddcebbbaca6f6060eacc7bbf72882af", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTMwNjExOQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17550#discussion_r489306119", "bodyText": "Agree, fixed.", "author": "viliam-durina", "createdAt": "2020-09-16T09:42:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTIzMDk0OQ=="}], "type": "inlineReview"}, {"oid": "d02f894d1cbbc048475bf845813aaa2f334807d3", "url": "https://github.com/hazelcast/hazelcast/commit/d02f894d1cbbc048475bf845813aaa2f334807d3", "message": "Address the review", "committedDate": "2020-09-16T09:43:13Z", "type": "commit"}, {"oid": "158509c4f251dd432d88bc75246360103b2cb577", "url": "https://github.com/hazelcast/hazelcast/commit/158509c4f251dd432d88bc75246360103b2cb577", "message": "Random typo", "committedDate": "2020-09-16T09:44:11Z", "type": "commit"}, {"oid": "17fc29043160868ff96e07eb6a73539f99797fd7", "url": "https://github.com/hazelcast/hazelcast/commit/17fc29043160868ff96e07eb6a73539f99797fd7", "message": "Address review", "committedDate": "2020-09-16T09:47:56Z", "type": "commit"}]}