{"pr_number": 16774, "pr_title": "exposed executor creation time metric", "pr_createdAt": "2020-03-18T14:40:52Z", "pr_url": "https://github.com/hazelcast/hazelcast/pull/16774", "timeline": [{"oid": "aaafb02539f12ab5647f6d9928bdf42ec9f85372", "url": "https://github.com/hazelcast/hazelcast/commit/aaafb02539f12ab5647f6d9928bdf42ec9f85372", "message": "exposed executor creation time metric\n\n* added creation time to executor jmx bean\n* annotated creationTime field with Probe", "committedDate": "2020-03-18T14:34:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDc4NzUyNg==", "url": "https://github.com/hazelcast/hazelcast/pull/16774#discussion_r394787526", "bodyText": "It's better to rename this method to #getLocalCreationTime for the sake of consistency with other methods from this bean.", "author": "puzpuzpuz", "createdAt": "2020-03-19T04:42:29Z", "path": "hazelcast/src/main/java/com/hazelcast/internal/jmx/ExecutorServiceMBean.java", "diffHunk": "@@ -29,6 +29,12 @@ protected ExecutorServiceMBean(IExecutorService managedObject, ManagementService\n         this.objectName = service.createObjectName(\"IExecutorService\", managedObject.getName());\n     }\n \n+    @ManagedAnnotation(\"localCreationTime\")\n+    @ManagedDescription(\"the creation time of this executor on this member.\")\n+    public long getCreationTime() {", "originalCommit": "aaafb02539f12ab5647f6d9928bdf42ec9f85372", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDc4NzczMw==", "url": "https://github.com/hazelcast/hazelcast/pull/16774#discussion_r394787733", "bodyText": "nit: remove the trailing dot (it's not used in descriptions for other fields here)", "author": "puzpuzpuz", "createdAt": "2020-03-19T04:43:13Z", "path": "hazelcast/src/main/java/com/hazelcast/internal/jmx/ExecutorServiceMBean.java", "diffHunk": "@@ -29,6 +29,12 @@ protected ExecutorServiceMBean(IExecutorService managedObject, ManagementService\n         this.objectName = service.createObjectName(\"IExecutorService\", managedObject.getName());\n     }\n \n+    @ManagedAnnotation(\"localCreationTime\")\n+    @ManagedDescription(\"the creation time of this executor on this member.\")", "originalCommit": "aaafb02539f12ab5647f6d9928bdf42ec9f85372", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDc4OTg4Mg==", "url": "https://github.com/hazelcast/hazelcast/pull/16774#discussion_r394789882", "bodyText": "This field has to be marked as volatile or final in order to guarantee safe publication.\n@blazember I can see that we use volatile for the same field in LocalMapStatsImpl, but not in LocalQueueStatsImpl, or LocalTopicStatsImpl, or LocalPNCounterStatsImpl, or many other stats classes. It looks like incorrect concurrent code to me. Maybe I'm missing something. Do you happen to know the reason for this?", "author": "puzpuzpuz", "createdAt": "2020-03-19T04:51:47Z", "path": "hazelcast/src/main/java/com/hazelcast/internal/monitor/impl/LocalExecutorStatsImpl.java", "diffHunk": "@@ -47,6 +48,8 @@\n             .newUpdater(LocalExecutorStatsImpl.class, \"totalStartLatency\");\n     private static final AtomicLongFieldUpdater<LocalExecutorStatsImpl> TOTAL_EXECUTION_TIME = AtomicLongFieldUpdater\n             .newUpdater(LocalExecutorStatsImpl.class, \"totalExecutionTime\");\n+\n+    @Probe(name = EXECUTOR_METRIC_CREATION_TIME, unit = MS)\n     private long creationTime;", "originalCommit": "aaafb02539f12ab5647f6d9928bdf42ec9f85372", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTA1MTQ1NQ==", "url": "https://github.com/hazelcast/hazelcast/pull/16774#discussion_r395051455", "bodyText": "Good catch @puzpuzpuz \ud83d\udc4d These fields should be volatile. The reason is that I didn't catch it when I updated the @Probe's. Don't know though why historically these are non-volatile, I think it is by mistake. According to the JLS (example 17.5-1), the reader threads could see 0 value for such fields even if initialized in the constructor - as you wrote. I raised #16778 to review and fix this.", "author": "blazember", "createdAt": "2020-03-19T14:07:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDc4OTg4Mg=="}], "type": "inlineReview"}, {"oid": "5b23e8ed005d395e60151d3ce3154a69a7356779", "url": "https://github.com/hazelcast/hazelcast/commit/5b23e8ed005d395e60151d3ce3154a69a7356779", "message": "address review comments", "committedDate": "2020-03-19T07:48:03Z", "type": "commit"}]}