{"pr_number": 17130, "pr_title": "SQL: Public API (#17042)", "pr_createdAt": "2020-06-26T09:09:56Z", "pr_url": "https://github.com/hazelcast/hazelcast/pull/17130", "timeline": [{"oid": "1d6cc1f85044ecba2e1b6ae8ea95c2397348e6cd", "url": "https://github.com/hazelcast/hazelcast/commit/1d6cc1f85044ecba2e1b6ae8ea95c2397348e6cd", "message": "Public API for SQL (#17042)", "committedDate": "2020-06-26T09:07:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjE0MTk5MA==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446141990", "bodyText": "I think these are not meant to be public - seems we're conflating the public \"SQL service\" with the internal \"Hazelcast SQL Service Implementation\"", "author": "cangencer", "createdAt": "2020-06-26T12:03:30Z", "path": "hazelcast/src/main/java/com/hazelcast/sql/SqlService.java", "diffHunk": "@@ -0,0 +1,52 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.sql;\n+\n+/**\n+ * Service to execute SQL queries.\n+ */\n+public interface SqlService {\n+    /** Unique service name. */\n+    String SERVICE_NAME = \"hz:impl:sqlService\";", "originalCommit": "1d6cc1f85044ecba2e1b6ae8ea95c2397348e6cd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjgzOTc3NQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446839775", "bodyText": "Removed. This service name is only required by a client implementation (which is not ready yet). It will be located in a private class.", "author": "devozerov", "createdAt": "2020-06-29T07:57:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjE0MTk5MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjE0MjMxNw==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446142317", "bodyText": "in Jet we have @Nonnull and @Nullable annotations for all public method return types and parameters, I think this is done in IMDG as well, seems to be missing here perhaps?", "author": "cangencer", "createdAt": "2020-06-26T12:04:16Z", "path": "hazelcast/src/main/java/com/hazelcast/sql/SqlService.java", "diffHunk": "@@ -0,0 +1,52 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.sql;\n+\n+/**\n+ * Service to execute SQL queries.\n+ */\n+public interface SqlService {\n+    /** Unique service name. */\n+    String SERVICE_NAME = \"hz:impl:sqlService\";\n+\n+    /**\n+     * Execute query.\n+     *\n+     * @param sql SQL.\n+     * @param params Parameters.\n+     * @return Cursor.\n+     */\n+    default SqlResult query(String sql, Object... params) {", "originalCommit": "1d6cc1f85044ecba2e1b6ae8ea95c2397348e6cd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njg2Nzc2Mw==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446867763", "bodyText": "Added annotations to public API. Please double-check that it looks good now.", "author": "devozerov", "createdAt": "2020-06-29T08:46:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjE0MjMxNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjE0MjQ3Ng==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446142476", "bodyText": "how about some examples here, the javadoc seems too barren?", "author": "cangencer", "createdAt": "2020-06-26T12:04:41Z", "path": "hazelcast/src/main/java/com/hazelcast/sql/SqlService.java", "diffHunk": "@@ -0,0 +1,52 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.sql;\n+\n+/**\n+ * Service to execute SQL queries.\n+ */\n+public interface SqlService {\n+    /** Unique service name. */\n+    String SERVICE_NAME = \"hz:impl:sqlService\";\n+\n+    /**\n+     * Execute query.", "originalCommit": "1d6cc1f85044ecba2e1b6ae8ea95c2397348e6cd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk3NDE0OA==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446974148", "bodyText": "Added example and general overview to the SqlService JavaDoc. Please let me know if you have any comments.", "author": "devozerov", "createdAt": "2020-06-29T13:32:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjE0MjQ3Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjE0MzIxMA==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446143210", "bodyText": "is it a good idea to use Java serialization here? Given this can be sent between different minor versions", "author": "cangencer", "createdAt": "2020-06-26T12:06:24Z", "path": "hazelcast/src/main/java/com/hazelcast/sql/SqlQuery.java", "diffHunk": "@@ -0,0 +1,274 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.sql;\n+\n+import com.hazelcast.config.SqlConfig;\n+\n+import java.io.Serializable;\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Objects;\n+\n+/**\n+ * Definition of the SQL query.\n+ * <p>\n+ * This object is mutable. Properties are read once before the execution is started.\n+ * Changes to properties do not affect the behavior of already running queries.\n+ */\n+public class SqlQuery implements Serializable {", "originalCommit": "1d6cc1f85044ecba2e1b6ae8ea95c2397348e6cd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njg0Mjg0OA==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446842848", "bodyText": "Agree. This was not part of the original proposal. I added it to provide some convenience to users but didn't think about compatibility.\nRemoved now.", "author": "devozerov", "createdAt": "2020-06-29T08:02:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjE0MzIxMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjE0NDIwNQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446144205", "bodyText": "would it make sense to provide getter for primitive types? or a method that supports generics so you don't need explicit casting? i.e  <T> T get(int index)", "author": "cangencer", "createdAt": "2020-06-26T12:08:59Z", "path": "hazelcast/src/main/java/com/hazelcast/sql/SqlRow.java", "diffHunk": "@@ -0,0 +1,40 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.sql;\n+\n+/**\n+ * SQL row.\n+ */\n+public interface SqlRow {\n+    /**\n+     * Gets the value of the column by index.\n+     * <p>\n+     * The class of the returned value depends on the SQL type of the column.\n+     *\n+     * @see #getRowMetadata()\n+     * @see SqlColumnMetadata#getType()\n+     * @param columnIndex Column index, 0-based.\n+     * @return Value of the column.\n+     * @throws IndexOutOfBoundsException If column index is out of bounds.\n+     */\n+    Object getObject(int columnIndex);", "originalCommit": "1d6cc1f85044ecba2e1b6ae8ea95c2397348e6cd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk0MzAzMw==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446943033", "bodyText": "Reverted back to <T> T getObject(...) approach, as it seems that the community is in agreement that it is more user-friendly.\nAlso, added <T> T getObject(String columnName) overload for convenience.\nThere will be no specialized methods in the first release (e.g. getInt(...)) because it requires additional considerations on the desired behavior (e.g. how to deal with nullability, whether to perform implicit conversions, etc).", "author": "devozerov", "createdAt": "2020-06-29T12:46:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjE0NDIwNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjE0NDY4NA==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446144684", "bodyText": "See same concern about SqlQuery", "author": "cangencer", "createdAt": "2020-06-26T12:09:58Z", "path": "hazelcast/src/main/java/com/hazelcast/sql/SqlRowMetadata.java", "diffHunk": "@@ -0,0 +1,119 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.sql;\n+\n+import javax.annotation.Nonnull;\n+import java.io.Serializable;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.stream.Collectors;\n+\n+/**\n+ * SQL row metadata.\n+ */\n+public class SqlRowMetadata implements Serializable {", "originalCommit": "1d6cc1f85044ecba2e1b6ae8ea95c2397348e6cd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njg0Mjk2NA==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446842964", "bodyText": "Removed.", "author": "devozerov", "createdAt": "2020-06-29T08:03:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjE0NDY4NA=="}], "type": "inlineReview"}, {"oid": "c23d9e897d55a53ceaa9dc1e68d8cfb55a02db1d", "url": "https://github.com/hazelcast/hazelcast/commit/c23d9e897d55a53ceaa9dc1e68d8cfb55a02db1d", "message": "Add missing operations to the ClientDynamicClusterConfig.", "committedDate": "2020-06-29T07:45:07Z", "type": "commit"}, {"oid": "d8efe36c6a0fbf8adec851bd8dbd06ad04e88c2b", "url": "https://github.com/hazelcast/hazelcast/commit/d8efe36c6a0fbf8adec851bd8dbd06ad04e88c2b", "message": "Throw IndexOutOfBound instead of IllegalArgumentException from SqlRowImpl.", "committedDate": "2020-06-29T07:50:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM1MTk5Mg==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446351992", "bodyText": "Why don't we use the same name for both?\nAlso intuitively, I would associate OBJECT with Java Object and ANY with Java ?, as in Collection<?>, not sure if in the SQL context these are the same.", "author": "viliam-durina", "createdAt": "2020-06-26T18:45:51Z", "path": "hazelcast-sql/src/main/java/com/hazelcast/sql/impl/calcite/SqlToQueryType.java", "diffHunk": "@@ -66,6 +66,9 @@\n         CALCITE_TO_HZ.put(SqlTypeName.DATE, QueryDataType.DATE);\n         CALCITE_TO_HZ.put(SqlTypeName.TIMESTAMP, QueryDataType.TIMESTAMP);\n         CALCITE_TO_HZ.put(SqlTypeName.TIMESTAMP_WITH_LOCAL_TIME_ZONE, QueryDataType.TIMESTAMP_WITH_TZ_OFFSET_DATE_TIME);\n+\n+        HZ_TO_CALCITE.put(QueryDataTypeFamily.OBJECT, SqlTypeName.ANY);\n+        CALCITE_TO_HZ.put(SqlTypeName.ANY, QueryDataType.OBJECT);", "originalCommit": "1d6cc1f85044ecba2e1b6ae8ea95c2397348e6cd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njg4MjgyNw==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446882827", "bodyText": "This will be clarified as a part of the expressions PR. There are no expressions support in the current PR. It is harmless in the current PR.", "author": "devozerov", "createdAt": "2020-06-29T10:09:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM1MTk5Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM1MzIzOA==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446353238", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    // 5. Collect original field names.\n          \n          \n            \n                    List<String> fieldNames = new ArrayList<>(root.fields.size());\n          \n          \n            \n            \n          \n          \n            \n                    for (Pair<Integer, String> field : root.fields) {\n          \n          \n            \n                        fieldNames.add(field.right);\n          \n          \n            \n                    }\n          \n          \n            \n            \n          \n          \n            \n                    return new QueryConvertResult(relTrimmed, fieldNames);\n          \n          \n            \n                    return new QueryConvertResult(relTrimmed, Pair.right(root.fields));", "author": "viliam-durina", "createdAt": "2020-06-26T18:48:40Z", "path": "hazelcast-sql/src/main/java/com/hazelcast/sql/impl/calcite/parse/QueryConverter.java", "diffHunk": "@@ -85,7 +89,14 @@ public RelNode convert(SqlNode node) {\n         // primarily in projections. This steps removes unused fields from the tree.\n         RelNode relTrimmed = converter.trimUnusedFields(true, relDecorrelated);\n \n-        return relTrimmed;\n+        // 5. Collect original field names.\n+        List<String> fieldNames = new ArrayList<>(root.fields.size());\n+\n+        for (Pair<Integer, String> field : root.fields) {\n+            fieldNames.add(field.right);\n+        }\n+\n+        return new QueryConvertResult(relTrimmed, fieldNames);", "originalCommit": "1d6cc1f85044ecba2e1b6ae8ea95c2397348e6cd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk0MDg2NQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446940865", "bodyText": "Applied.", "author": "devozerov", "createdAt": "2020-06-29T12:43:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM1MzIzOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM1ODQ2NQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446358465", "bodyText": "This reduces the runtime form 60 to 40s on my machine:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    for (long i = 0; i < DATA_SET_SIZE; i++) {\n          \n          \n            \n                        map.put(i, i);\n          \n          \n            \n                    }\n          \n          \n            \n                    map.putAll(LongStream.range(0, dataSetSize).boxed().collect(Collectors.toMap(this::key, this::value)));", "author": "viliam-durina", "createdAt": "2020-06-26T19:00:23Z", "path": "hazelcast-sql/src/test/java/com/hazelcast/sql/SqlErrorTest.java", "diffHunk": "@@ -0,0 +1,369 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.sql;\n+\n+import com.hazelcast.core.HazelcastInstance;\n+import com.hazelcast.map.IMap;\n+import com.hazelcast.sql.impl.SqlTestSupport;\n+import com.hazelcast.sql.impl.exec.BlockingExec;\n+import com.hazelcast.sql.impl.exec.FaultyExec;\n+import com.hazelcast.sql.impl.exec.scan.MapScanExec;\n+import com.hazelcast.test.HazelcastParallelClassRunner;\n+import com.hazelcast.test.TestHazelcastInstanceFactory;\n+import com.hazelcast.test.annotation.ParallelJVMTest;\n+import com.hazelcast.test.annotation.QuickTest;\n+import org.junit.After;\n+import org.junit.Test;\n+import org.junit.experimental.categories.Category;\n+import org.junit.runner.RunWith;\n+\n+import javax.annotation.Nonnull;\n+\n+import static junit.framework.TestCase.assertEquals;\n+import static junit.framework.TestCase.assertTrue;\n+import static junit.framework.TestCase.fail;\n+\n+/**\n+ * Test for different error conditions.\n+ */\n+@RunWith(HazelcastParallelClassRunner.class)\n+@Category({QuickTest.class, ParallelJVMTest.class})\n+public class SqlErrorTest extends SqlTestSupport {\n+\n+    private static final String MAP_NAME = \"map\";\n+    private static final int DATA_SET_SIZE = 100;\n+\n+    private final TestHazelcastInstanceFactory factory = new TestHazelcastInstanceFactory(2);\n+\n+    @After\n+    public void after() {\n+        factory.shutdownAll();\n+    }\n+\n+    @Test\n+    public void testTimeout() {\n+        // Start two instances and fill them with data\n+        HazelcastInstance instance1 = factory.newHazelcastInstance();\n+        HazelcastInstance instance2 = factory.newHazelcastInstance();\n+\n+        IMap<Long, Long> map = instance1.getMap(MAP_NAME);\n+\n+        for (long i = 0; i < DATA_SET_SIZE; i++) {\n+            map.put(i, i);\n+        }", "originalCommit": "1d6cc1f85044ecba2e1b6ae8ea95c2397348e6cd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk0MDU3MA==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446940570", "bodyText": "Applied batched putAll as suggested.", "author": "devozerov", "createdAt": "2020-06-29T12:42:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM1ODQ2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM2MjMxMw==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446362313", "bodyText": "Same comment twice. Many more instances of this in this PR. To me it's just extra noise, no added value.", "author": "viliam-durina", "createdAt": "2020-06-26T19:09:20Z", "path": "hazelcast/src/main/java/com/hazelcast/core/HazelcastInstance.java", "diffHunk": "@@ -452,6 +453,13 @@\n      */\n     @Nonnull CPSubsystem getCPSubsystem();\n \n+    /**\n+     * Returns SQL service.\n+     *\n+     * @return SQL service.", "originalCommit": "1d6cc1f85044ecba2e1b6ae8ea95c2397348e6cd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzAyMDg5OQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r447020899", "bodyText": "I agree that these comments do not add any value. At the same time, JavaDoc without body or return tag may look aesthetically inconsistent in both IDE, or when converted to HTML. E.g. JDK chooses the approach with repetition. When you look at missing part of JavaDoc the question is whether this is a bug or an intentional omission. With explicit docs it is clear - there is just no more useful information to add.\nTherefore I'd prefer to keep it as is, given that we do not have any hard project-wide rules for one or the other approach, and both formatting options could be found in different parts of the API.", "author": "devozerov", "createdAt": "2020-06-29T14:37:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM2MjMxMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzA3MDA0NQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r447070045", "bodyText": "given that this is the entry point to the API, I think it warrants more than a trivial comment? Perhaps a sentence or two about it wouldn't hurt.", "author": "cangencer", "createdAt": "2020-06-29T15:44:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM2MjMxMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzIzMjU4Ng==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r447232586", "bodyText": "Rendered in IntelliJ, how aesthetically consistent is this?\n\nMaybe we could replace the @return with @see SqlService. That's also duplicate, one can click on the return type, but it suggests that there's something interesting and related in there.", "author": "viliam-durina", "createdAt": "2020-06-29T20:25:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM2MjMxMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzIzMzI0NQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r447233245", "bodyText": "Also, should be marked with @NonNull.", "author": "viliam-durina", "createdAt": "2020-06-29T20:27:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM2MjMxMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzQzMTI1MA==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r447431250", "bodyText": "We do not go into details in HazelcastInstance, because extended JavaDocs are provided in the returned objects. I added a reference to SqlService in the method's JavaDoc.", "author": "devozerov", "createdAt": "2020-06-30T06:07:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM2MjMxMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM2MzkyNQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446363925", "bodyText": "Zero-value comment. It's impl class, it's not required by checkstyle. I'd rather remove all the comments in this class...", "author": "viliam-durina", "createdAt": "2020-06-26T19:13:07Z", "path": "hazelcast/src/main/java/com/hazelcast/spi/impl/NodeEngine.java", "diffHunk": "@@ -114,6 +115,13 @@\n      */\n     SplitBrainProtectionService getSplitBrainProtectionService();\n \n+    /**\n+     * Gets SQL service.\n+     *\n+     * @return the SQL service\n+     */\n+    SqlServiceImpl getSqlService();", "originalCommit": "1d6cc1f85044ecba2e1b6ae8ea95c2397348e6cd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzAyMTIyNQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r447021225", "bodyText": "Resolving this to keep the discussion in a single place (see the comment above).", "author": "devozerov", "createdAt": "2020-06-29T14:37:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM2MzkyNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjgyMDQ4MQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446820481", "bodyText": "These checks are perfectly handled by the list implementation, throw the same type of exception.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (index < 0) {\n          \n          \n            \n                        throw new IndexOutOfBoundsException(\"Column index cannot be negative: \" + index);\n          \n          \n            \n                    }\n          \n          \n            \n            \n          \n          \n            \n                    if (index >= columns.size()) {\n          \n          \n            \n                        throw new IndexOutOfBoundsException(\"Column index is out of bounds: \" + index);\n          \n          \n            \n                    }\n          \n          \n            \n            \n          \n          \n            \n                    return columns.get(index);\n          \n          \n            \n                    return columns.get(index);\n          \n      \n    \n    \n  \n\nWe should also document that we throw in case of and out-of-bounds index, some other methods return null.", "author": "viliam-durina", "createdAt": "2020-06-29T07:20:00Z", "path": "hazelcast/src/main/java/com/hazelcast/sql/SqlRowMetadata.java", "diffHunk": "@@ -0,0 +1,119 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.sql;\n+\n+import javax.annotation.Nonnull;\n+import java.io.Serializable;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.stream.Collectors;\n+\n+/**\n+ * SQL row metadata.\n+ */\n+public class SqlRowMetadata implements Serializable {\n+    /** Constant indicating that the column is not found. */\n+    public static final int COLUMN_NOT_FOUND = -1;\n+\n+    private static final long serialVersionUID = 1595632576318481583L;\n+\n+    private final List<SqlColumnMetadata> columns;\n+    private final Map<String, Integer> nameToIndex;\n+\n+    public SqlRowMetadata(List<SqlColumnMetadata> columns) {\n+        assert columns != null && !columns.isEmpty();\n+\n+        this.columns = new ArrayList<>(columns);\n+\n+        nameToIndex = new HashMap<>(columns.size());\n+\n+        for (int i = 0; i < columns.size(); i++) {\n+            nameToIndex.put(columns.get(i).getName(), i);\n+        }\n+    }\n+\n+    /**\n+     * Gets the number of columns in the row.\n+     *\n+     * @return The number of columns in the row.\n+     */\n+    public int getColumnCount() {\n+        return columns.size();\n+    }\n+\n+    /**\n+     * Get column metadata.\n+     *\n+     * @param index Column index, 0-based.\n+     * @return Column metadata.\n+     */\n+    @Nonnull\n+    public SqlColumnMetadata getColumn(int index) {\n+        if (index < 0) {\n+            throw new IndexOutOfBoundsException(\"Column index cannot be negative: \" + index);\n+        }\n+\n+        if (index >= columns.size()) {\n+            throw new IndexOutOfBoundsException(\"Column index is out of bounds: \" + index);\n+        }\n+\n+        return columns.get(index);", "originalCommit": "1d6cc1f85044ecba2e1b6ae8ea95c2397348e6cd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk0MDMzOQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446940339", "bodyText": "As discussed, these checks are intentional to make the API behavior stable irrespective of the underlying implementation.", "author": "devozerov", "createdAt": "2020-06-29T12:42:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjgyMDQ4MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjgyMTQ2Ng==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446821466", "bodyText": "This can be simplified to:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    Integer index = nameToIndex.get(name);\n          \n          \n            \n            \n          \n          \n            \n                    return index != null ? index : COLUMN_NOT_FOUND;\n          \n          \n            \n                    return nameToIndex.getOrDefault(name, COLUMN_NOT_FOUND);\n          \n      \n    \n    \n  \n\nBut I'm not sure this is a good design. If one refers to a column by name, it's a programming error to use a name not present in the query. I don't expect people to use this method to probe for the existence of a column.\nThe SqlRow class only has index-based access to values, if one uses:\nint fooIndex = metadata.findColumn('foo_column');\nObject value = row.getObject(fooIndex);\nhe will get \"column index out of range: -1\" instead of \"column 'foo_column' doesn't exist\".", "author": "viliam-durina", "createdAt": "2020-06-29T07:22:05Z", "path": "hazelcast/src/main/java/com/hazelcast/sql/SqlRowMetadata.java", "diffHunk": "@@ -0,0 +1,119 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.sql;\n+\n+import javax.annotation.Nonnull;\n+import java.io.Serializable;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.stream.Collectors;\n+\n+/**\n+ * SQL row metadata.\n+ */\n+public class SqlRowMetadata implements Serializable {\n+    /** Constant indicating that the column is not found. */\n+    public static final int COLUMN_NOT_FOUND = -1;\n+\n+    private static final long serialVersionUID = 1595632576318481583L;\n+\n+    private final List<SqlColumnMetadata> columns;\n+    private final Map<String, Integer> nameToIndex;\n+\n+    public SqlRowMetadata(List<SqlColumnMetadata> columns) {\n+        assert columns != null && !columns.isEmpty();\n+\n+        this.columns = new ArrayList<>(columns);\n+\n+        nameToIndex = new HashMap<>(columns.size());\n+\n+        for (int i = 0; i < columns.size(); i++) {\n+            nameToIndex.put(columns.get(i).getName(), i);\n+        }\n+    }\n+\n+    /**\n+     * Gets the number of columns in the row.\n+     *\n+     * @return The number of columns in the row.\n+     */\n+    public int getColumnCount() {\n+        return columns.size();\n+    }\n+\n+    /**\n+     * Get column metadata.\n+     *\n+     * @param index Column index, 0-based.\n+     * @return Column metadata.\n+     */\n+    @Nonnull\n+    public SqlColumnMetadata getColumn(int index) {\n+        if (index < 0) {\n+            throw new IndexOutOfBoundsException(\"Column index cannot be negative: \" + index);\n+        }\n+\n+        if (index >= columns.size()) {\n+            throw new IndexOutOfBoundsException(\"Column index is out of bounds: \" + index);\n+        }\n+\n+        return columns.get(index);\n+    }\n+\n+    /**\n+     * Find index of the column with the given name. Returned index can be used to get column value\n+     * from {@link SqlRow}.\n+     *\n+     * @see SqlRow\n+     * @param name Column name (case sensitive).\n+     * @return Column index or {@link #COLUMN_NOT_FOUND} if a column with the given name is not found.\n+     */\n+    public int findColumn(String name) {\n+        Integer index = nameToIndex.get(name);\n+\n+        return index != null ? index : COLUMN_NOT_FOUND;", "originalCommit": "1d6cc1f85044ecba2e1b6ae8ea95c2397348e6cd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjkzOTkwMQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446939901", "bodyText": "This is a common practice in Java. See String.indexOf or ResultSet.findColumn.\nAccess by column name has been added: SqlRow#getObject(String)", "author": "devozerov", "createdAt": "2020-06-29T12:41:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjgyMTQ2Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjgyMTcwNw==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446821707", "bodyText": "We should specify here whether the name is case sensitive.", "author": "viliam-durina", "createdAt": "2020-06-29T07:22:36Z", "path": "hazelcast/src/main/java/com/hazelcast/sql/SqlRowMetadata.java", "diffHunk": "@@ -0,0 +1,119 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.sql;\n+\n+import javax.annotation.Nonnull;\n+import java.io.Serializable;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.stream.Collectors;\n+\n+/**\n+ * SQL row metadata.\n+ */\n+public class SqlRowMetadata implements Serializable {\n+    /** Constant indicating that the column is not found. */\n+    public static final int COLUMN_NOT_FOUND = -1;\n+\n+    private static final long serialVersionUID = 1595632576318481583L;\n+\n+    private final List<SqlColumnMetadata> columns;\n+    private final Map<String, Integer> nameToIndex;\n+\n+    public SqlRowMetadata(List<SqlColumnMetadata> columns) {\n+        assert columns != null && !columns.isEmpty();\n+\n+        this.columns = new ArrayList<>(columns);\n+\n+        nameToIndex = new HashMap<>(columns.size());\n+\n+        for (int i = 0; i < columns.size(); i++) {\n+            nameToIndex.put(columns.get(i).getName(), i);\n+        }\n+    }\n+\n+    /**\n+     * Gets the number of columns in the row.\n+     *\n+     * @return The number of columns in the row.\n+     */\n+    public int getColumnCount() {\n+        return columns.size();\n+    }\n+\n+    /**\n+     * Get column metadata.\n+     *\n+     * @param index Column index, 0-based.\n+     * @return Column metadata.\n+     */\n+    @Nonnull\n+    public SqlColumnMetadata getColumn(int index) {\n+        if (index < 0) {\n+            throw new IndexOutOfBoundsException(\"Column index cannot be negative: \" + index);\n+        }\n+\n+        if (index >= columns.size()) {\n+            throw new IndexOutOfBoundsException(\"Column index is out of bounds: \" + index);\n+        }\n+\n+        return columns.get(index);\n+    }\n+\n+    /**\n+     * Find index of the column with the given name. Returned index can be used to get column value\n+     * from {@link SqlRow}.", "originalCommit": "1d6cc1f85044ecba2e1b6ae8ea95c2397348e6cd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjkzODg2MQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446938861", "bodyText": "It is specified in the parameter JavaDoc.", "author": "devozerov", "createdAt": "2020-06-29T12:40:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjgyMTcwNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjgzMjQ1Mg==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446832452", "bodyText": "We could use the sql syntax name + ' ' + type. Also the [] suggest a collection, but it's a tuple, i'd just use none.", "author": "viliam-durina", "createdAt": "2020-06-29T07:44:06Z", "path": "hazelcast/src/main/java/com/hazelcast/sql/SqlColumnMetadata.java", "diffHunk": "@@ -0,0 +1,92 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.sql;\n+\n+import javax.annotation.Nonnull;\n+import java.io.Serializable;\n+\n+/**\n+ * SQL column metadata.\n+ */\n+public class SqlColumnMetadata implements Serializable {\n+\n+    private static final long serialVersionUID = 1522422443380097801L;\n+\n+    private final String name;\n+    private final SqlColumnType type;\n+\n+    public SqlColumnMetadata(String name, SqlColumnType type) {\n+        assert name != null;\n+        assert type != null;\n+\n+        this.name = name;\n+        this.type = type;\n+    }\n+\n+    /**\n+     * Get column name.\n+     *\n+     * @return Column name.\n+     */\n+    @Nonnull\n+    public String getName() {\n+        return name;\n+    }\n+\n+    /**\n+     * Gets column type.\n+     *\n+     * @return Column type.\n+     */\n+    @Nonnull\n+    public SqlColumnType getType() {\n+        return type;\n+    }\n+\n+    @Override\n+    public boolean equals(Object o) {\n+        if (this == o) {\n+            return true;\n+        }\n+\n+        if (o == null || getClass() != o.getClass()) {\n+            return false;\n+        }\n+\n+        SqlColumnMetadata that = (SqlColumnMetadata) o;\n+\n+        if (!name.equals(that.name)) {\n+            return false;\n+        }\n+\n+        return type == that.type;\n+    }\n+\n+    @Override\n+    public int hashCode() {\n+        int result = name.hashCode();\n+\n+        result = 31 * result + type.hashCode();\n+\n+        return result;\n+    }\n+\n+    @Override\n+    public String toString() {\n+        return '[' + name + ':' + type + ']';", "originalCommit": "1d6cc1f85044ecba2e1b6ae8ea95c2397348e6cd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjkzODk3Nw==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446938977", "bodyText": "Fixed.", "author": "devozerov", "createdAt": "2020-06-29T12:40:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjgzMjQ1Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjgzNTYxNg==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446835616", "bodyText": "The getObject method declares to throw IOOBE in this case.", "author": "viliam-durina", "createdAt": "2020-06-29T07:50:03Z", "path": "hazelcast/src/main/java/com/hazelcast/sql/impl/SqlRowImpl.java", "diffHunk": "@@ -0,0 +1,55 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+\n+package com.hazelcast.sql.impl;\n+\n+import com.hazelcast.sql.SqlRow;\n+import com.hazelcast.sql.SqlRowMetadata;\n+import com.hazelcast.sql.impl.row.Row;\n+\n+/**\n+ * Default implementation of the SQL row which is exposed to users. We merely wrap the internal row, but add more checks which\n+ * is important for user-facing code, but which could cause performance degradation if implemented in the internal classes.\n+ */\n+public class SqlRowImpl implements SqlRow {\n+\n+    private final SqlRowMetadata rowMetadata;\n+    private final Row row;\n+\n+    public SqlRowImpl(SqlRowMetadata rowMetadata, Row row) {\n+        this.rowMetadata = rowMetadata;\n+        this.row = row;\n+    }\n+\n+    @Override\n+    public Object getObject(int columnIndex) {\n+        checkIndex(columnIndex);\n+\n+        return row.get(columnIndex);\n+    }\n+\n+    @Override\n+    public SqlRowMetadata getRowMetadata() {\n+        return rowMetadata;\n+    }\n+\n+    private void checkIndex(int index) {\n+        if (index < 0 || index >= rowMetadata.getColumnCount()) {\n+            throw new IllegalArgumentException(\"Column index is out of range: \" + index);", "originalCommit": "1d6cc1f85044ecba2e1b6ae8ea95c2397348e6cd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njg4MzA5OQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446883099", "bodyText": "Fixed", "author": "devozerov", "createdAt": "2020-06-29T10:10:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjgzNTYxNg=="}], "type": "inlineReview"}, {"oid": "e09c02d52d9ef89cdedc657966b553adac0e036d", "url": "https://github.com/hazelcast/hazelcast/commit/e09c02d52d9ef89cdedc657966b553adac0e036d", "message": "Removed service name from the public API.", "committedDate": "2020-06-29T07:54:55Z", "type": "commit"}, {"oid": "753a610f8d690121195b06a65f8894117074ac70", "url": "https://github.com/hazelcast/hazelcast/commit/753a610f8d690121195b06a65f8894117074ac70", "message": "Removed \"Serializable\" from public API classes.", "committedDate": "2020-06-29T08:02:00Z", "type": "commit"}, {"oid": "f4cec3ef4a012a92f7da43b6ae35be146e5ed917", "url": "https://github.com/hazelcast/hazelcast/commit/f4cec3ef4a012a92f7da43b6ae35be146e5ed917", "message": "getSqlService -> getSql", "committedDate": "2020-06-29T08:04:30Z", "type": "commit"}, {"oid": "c6d336d960ada0ebef7a550d117bfd62b31e126a", "url": "https://github.com/hazelcast/hazelcast/commit/c6d336d960ada0ebef7a550d117bfd62b31e126a", "message": "Add \"Nonnull\" annotations.", "committedDate": "2020-06-29T08:13:20Z", "type": "commit"}, {"oid": "53b67c8d42bbd7737fdb0a3ac4ade253b676e358", "url": "https://github.com/hazelcast/hazelcast/commit/53b67c8d42bbd7737fdb0a3ac4ade253b676e358", "message": "Added \"Nonnull\" and \"Nullable\" annotations.", "committedDate": "2020-06-29T08:45:55Z", "type": "commit"}, {"oid": "bbada9c8238b306466434907f92fb1f99cb5b65b", "url": "https://github.com/hazelcast/hazelcast/commit/bbada9c8238b306466434907f92fb1f99cb5b65b", "message": "Added column resolution by name.", "committedDate": "2020-06-29T08:58:31Z", "type": "commit"}, {"oid": "795dda1d72e8b92e220bfd62a18fcf0df01942b2", "url": "https://github.com/hazelcast/hazelcast/commit/795dda1d72e8b92e220bfd62a18fcf0df01942b2", "message": "Grammar", "committedDate": "2020-06-29T09:30:40Z", "type": "commit"}, {"oid": "112d5a89f1cc1006a77fe1ab799d64c91d296b2c", "url": "https://github.com/hazelcast/hazelcast/commit/112d5a89f1cc1006a77fe1ab799d64c91d296b2c", "message": "SqlRow.getRowMetadata -> SqlRow.getMetadata", "committedDate": "2020-06-29T09:38:23Z", "type": "commit"}, {"oid": "8c6a8ed62a3f8e4d905d7ce60ddafcdce9b99308", "url": "https://github.com/hazelcast/hazelcast/commit/8c6a8ed62a3f8e4d905d7ce60ddafcdce9b99308", "message": "Merge remote-tracking branch 'devozerov/issues/17042' into issues/17042", "committedDate": "2020-06-29T09:38:52Z", "type": "commit"}, {"oid": "cab28f3cec51f79d0a046d89fc5a8e8189a0f17e", "url": "https://github.com/hazelcast/hazelcast/commit/cab28f3cec51f79d0a046d89fc5a8e8189a0f17e", "message": "SqlRowImpl.toString", "committedDate": "2020-06-29T09:50:18Z", "type": "commit"}, {"oid": "bf9015d1ebb36da3e7c7ac6d817e78de6adb11eb", "url": "https://github.com/hazelcast/hazelcast/commit/bf9015d1ebb36da3e7c7ac6d817e78de6adb11eb", "message": "Batched puts in tests.", "committedDate": "2020-06-29T10:07:13Z", "type": "commit"}, {"oid": "3c2f90ab0b8ff5dd0ebc96f6461cc7af2d7267f0", "url": "https://github.com/hazelcast/hazelcast/commit/3c2f90ab0b8ff5dd0ebc96f6461cc7af2d7267f0", "message": "Minor simplification in SqlRowMetadata.", "committedDate": "2020-06-29T10:07:28Z", "type": "commit"}, {"oid": "a4bef99c99ede3024009a6202b6d254ad3593a68", "url": "https://github.com/hazelcast/hazelcast/commit/a4bef99c99ede3024009a6202b6d254ad3593a68", "message": "Minor simplification in QueryConverter.", "committedDate": "2020-06-29T10:09:58Z", "type": "commit"}, {"oid": "a7fd09a0e705205722e8e326444fd408ee98b091", "url": "https://github.com/hazelcast/hazelcast/commit/a7fd09a0e705205722e8e326444fd408ee98b091", "message": "Removed \":\" from the column metadata.", "committedDate": "2020-06-29T10:15:31Z", "type": "commit"}, {"oid": "9ea67e58951a2cce641b750cbcc326d127ae2ec3", "url": "https://github.com/hazelcast/hazelcast/commit/9ea67e58951a2cce641b750cbcc326d127ae2ec3", "message": "\"Object\" -> \"<T> T\" for row accessor.", "committedDate": "2020-06-29T10:20:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjkwNTE4Nw==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446905187", "bodyText": "I think it's a good convention to use something like queryTimeoutMillis because if you're editing the config file, the unit is not  always obvious. I think this convention is followed in rest of the config.", "author": "cangencer", "createdAt": "2020-06-29T11:41:51Z", "path": "hazelcast/src/main/java/com/hazelcast/config/SqlConfig.java", "diffHunk": "@@ -0,0 +1,154 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.config;\n+\n+import com.hazelcast.sql.SqlQuery;\n+\n+import static com.hazelcast.internal.util.Preconditions.checkNotNegative;\n+import static com.hazelcast.internal.util.Preconditions.checkPositive;\n+\n+/**\n+ * SQL service configuration.\n+ */\n+public class SqlConfig {\n+    /** Default number of threads responsible for query execution. */\n+    public static final int DEFAULT_EXECUTOR_POOL_SIZE = Runtime.getRuntime().availableProcessors();\n+\n+    /** Default number of threads responsible for network operations processing. */\n+    public static final int DEFAULT_OPERATION_POOL_SIZE = Math.min(8, Runtime.getRuntime().availableProcessors());\n+\n+    /** Default timeout in milliseconds that is applied to queries without explicit timeout. */\n+    public static final int DEFAULT_QUERY_TIMEOUT = 0;\n+\n+    /** Number of threads responsible for query execution. */\n+    private int executorPoolSize = DEFAULT_EXECUTOR_POOL_SIZE;\n+\n+    /** Number of threads responsible for network operations processing. */\n+    private int operationPoolSize = DEFAULT_OPERATION_POOL_SIZE;\n+\n+    /** Timeout in milliseconds that is applied to queries without an explicit timeout. */\n+    private long queryTimeout = DEFAULT_QUERY_TIMEOUT;\n+\n+    /**\n+     * Gets the number of threads responsible for query execution.\n+     *\n+     * @return Number of threads responsible for query execution.\n+     */\n+    public int getExecutorPoolSize() {\n+        return executorPoolSize;\n+    }\n+\n+    /**\n+     * Sets the number of threads responsible for query execution.\n+     * <p>\n+     * Normally the value of this parameter should be equal to the number of CPU cores.\n+     * <p>\n+     * Setting the value to less than the number of CPU cores will limit the degree of parallelism of the SQL subsystem. This\n+     * may be beneficial if you would like to prioritize other CPU-intensive workloads on the same machine.\n+     * <p>\n+     * It is not recommended to set the value of this parameter greater than the number of CPU cores because it may decrease\n+     * the system's overall performance due to excessive context switches.\n+     * <p>\n+     * Defaults to {@link #DEFAULT_EXECUTOR_POOL_SIZE}.\n+     *\n+     * @param executorPoolSize Number of threads responsible for query execution.\n+     * @return This instance for chaining.\n+     */\n+    public SqlConfig setExecutorPoolSize(int executorPoolSize) {\n+        checkPositive(executorPoolSize, \"Executor pool size should be positive\");\n+\n+        this.executorPoolSize = executorPoolSize;\n+\n+        return this;\n+    }\n+\n+    /**\n+     * Gets the number of threads responsible for network operations processing.\n+     *\n+     * @return Number of threads responsible for network operations processing.\n+     */\n+    public int getOperationPoolSize() {\n+        return operationPoolSize;\n+    }\n+\n+    /**\n+     * Sets the number of threads responsible for network operations processing.\n+     * <p>\n+     * When Hazelcast members execute a query, they send commands to each other over the network to coordinate the execution.\n+     * This includes requests to start or stop query execution, or a request to process a batch of data. These commands are\n+     * processed in a separate operation thread pool, to avoid frequent interruption of running query fragments.\n+     * <p>\n+     * The default value should be good enough for the most workloads. You may want to increase the default value if you run\n+     * very small queries, or the machine has a big number of CPU cores.\n+     * <p>\n+     * It is not recommended to set the value of this parameter greater than the number of CPU cores because it may decrease\n+     * the system's overall performance due to excessive context switches.\n+     *\n+     * <p>\n+     * Defaults to {@link #DEFAULT_OPERATION_POOL_SIZE}.\n+     *\n+     * @param operationPoolSize Number of threads responsible for network operations processing.\n+     * @return This instance for chaining.\n+     */\n+    public SqlConfig setOperationPoolSize(int operationPoolSize) {\n+        checkPositive(operationPoolSize, \"Operation pool size should be positive\");\n+\n+        this.operationPoolSize = operationPoolSize;\n+\n+        return this;\n+    }\n+\n+    /**\n+     * Gets the timeout in milliseconds that is applied to queries without an explicit timeout.\n+     *\n+     * @return Timeout in milliseconds.\n+     */\n+    public long getQueryTimeout() {", "originalCommit": "a4bef99c99ede3024009a6202b6d254ad3593a68", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk3NDM3OQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446974379", "bodyText": "Applied the suggestion.", "author": "devozerov", "createdAt": "2020-06-29T13:33:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjkwNTE4Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjkwNTgzOQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446905839", "bodyText": "should make the class final as it's public", "author": "cangencer", "createdAt": "2020-06-29T11:43:02Z", "path": "hazelcast/src/main/java/com/hazelcast/sql/SqlColumnMetadata.java", "diffHunk": "@@ -0,0 +1,89 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.sql;\n+\n+import javax.annotation.Nonnull;\n+\n+/**\n+ * SQL column metadata.\n+ */\n+public class SqlColumnMetadata {", "originalCommit": "a4bef99c99ede3024009a6202b6d254ad3593a68", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk4OTE5Mw==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446989193", "bodyText": "Fixed.", "author": "devozerov", "createdAt": "2020-06-29T13:53:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjkwNTgzOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjkwNTk3MA==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446905970", "bodyText": "missing annotations (it's public class).", "author": "cangencer", "createdAt": "2020-06-29T11:43:15Z", "path": "hazelcast/src/main/java/com/hazelcast/sql/SqlColumnMetadata.java", "diffHunk": "@@ -0,0 +1,89 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.sql;\n+\n+import javax.annotation.Nonnull;\n+\n+/**\n+ * SQL column metadata.\n+ */\n+public class SqlColumnMetadata {\n+\n+    private final String name;\n+    private final SqlColumnType type;\n+\n+    public SqlColumnMetadata(String name, SqlColumnType type) {", "originalCommit": "a4bef99c99ede3024009a6202b6d254ad3593a68", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjkyMDM3Mg==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446920372", "bodyText": "Maybe we can mark this as @PrivateApi, it's not meant to be used by the users.", "author": "viliam-durina", "createdAt": "2020-06-29T12:08:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjkwNTk3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk4OTAzNQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446989035", "bodyText": "Fixed.", "author": "devozerov", "createdAt": "2020-06-29T13:53:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjkwNTk3MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjkwNjgzMw==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446906833", "bodyText": "does this qualify as standard Javadoc format so it's picked up by the generator?", "author": "cangencer", "createdAt": "2020-06-29T11:44:37Z", "path": "hazelcast/src/main/java/com/hazelcast/sql/SqlColumnType.java", "diffHunk": "@@ -0,0 +1,87 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.sql;\n+\n+import javax.annotation.Nonnull;\n+import java.math.BigDecimal;\n+import java.time.LocalDate;\n+import java.time.LocalDateTime;\n+import java.time.LocalTime;\n+import java.time.OffsetDateTime;\n+\n+/**\n+ * SQL column type.\n+ */\n+public enum SqlColumnType {\n+    /** VARCHAR type, represented by {@link java.lang.String} */", "originalCommit": "a4bef99c99ede3024009a6202b6d254ad3593a68", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjkyMTA0Ng==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446921046", "bodyText": "Of course...", "author": "viliam-durina", "createdAt": "2020-06-29T12:10:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjkwNjgzMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk3NzI3NA==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446977274", "bodyText": "From the Oracle docs [1]:\n\nThis tag is valid in all documentation comments: overview, package, class, interface, constructor, method and field\n\n[1] https://docs.oracle.com/javase/8/docs/technotes/tools/windows/javadoc.html#CHDDIECH", "author": "devozerov", "createdAt": "2020-06-29T13:37:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjkwNjgzMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzAxMTgwMQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r447011801", "bodyText": "Resolving for now. Please re-open the conversation if you foresee any problems with these JavaDocs.", "author": "devozerov", "createdAt": "2020-06-29T14:25:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjkwNjgzMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjkwNzA2NA==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446907064", "bodyText": "missing annotations", "author": "cangencer", "createdAt": "2020-06-29T11:45:04Z", "path": "hazelcast/src/main/java/com/hazelcast/sql/SqlException.java", "diffHunk": "@@ -0,0 +1,53 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.sql;\n+\n+import com.hazelcast.core.HazelcastException;\n+\n+import javax.annotation.Nonnull;\n+import java.util.UUID;\n+\n+/**\n+ * An exception occurred during SQL query execution.\n+ */\n+public class SqlException extends HazelcastException {\n+\n+    private final UUID originatingMemberId;\n+    private final int code;\n+\n+    public SqlException(UUID originatingMemberId, int code, String message, Throwable cause) {", "originalCommit": "a4bef99c99ede3024009a6202b6d254ad3593a68", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk4ODkwNg==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446988906", "bodyText": "Fixed", "author": "devozerov", "createdAt": "2020-06-29T13:53:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjkwNzA2NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjkwNzE4OQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446907189", "bodyText": "missing annotation", "author": "cangencer", "createdAt": "2020-06-29T11:45:16Z", "path": "hazelcast/src/main/java/com/hazelcast/sql/SqlQuery.java", "diffHunk": "@@ -0,0 +1,286 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.sql;\n+\n+import com.hazelcast.config.SqlConfig;\n+import com.hazelcast.internal.util.Preconditions;\n+\n+import javax.annotation.Nonnull;\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Objects;\n+\n+/**\n+ * Definition of a SQL query.\n+ * <p>\n+ * This object is mutable. Properties are read once before the execution is started.\n+ * Changes to properties do not affect the behavior of already running queries.\n+ */\n+public class SqlQuery {\n+    /** Value for the timeout that is not set. */\n+    public static final long TIMEOUT_NOT_SET = -1;\n+\n+    /** Default timeout. */\n+    public static final long DEFAULT_TIMEOUT = TIMEOUT_NOT_SET;\n+\n+    /** Default page size. */\n+    public static final int DEFAULT_CURSOR_BUFFER_SIZE = 4096;\n+\n+    private String sql;\n+    private List<Object> parameters;\n+    private long timeout = DEFAULT_TIMEOUT;\n+    private int cursorBufferSize = DEFAULT_CURSOR_BUFFER_SIZE;\n+\n+    public SqlQuery(String sql) {", "originalCommit": "a4bef99c99ede3024009a6202b6d254ad3593a68", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk4ODc5OA==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446988798", "bodyText": "Done", "author": "devozerov", "createdAt": "2020-06-29T13:53:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjkwNzE4OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjkwNzkxOQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446907919", "bodyText": "should also consider making this final", "author": "cangencer", "createdAt": "2020-06-29T11:46:35Z", "path": "hazelcast/src/main/java/com/hazelcast/sql/SqlRowMetadata.java", "diffHunk": "@@ -0,0 +1,119 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.sql;\n+\n+import com.hazelcast.internal.util.Preconditions;\n+\n+import javax.annotation.Nonnull;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.stream.Collectors;\n+\n+/**\n+ * SQL row metadata.\n+ */\n+public class SqlRowMetadata {", "originalCommit": "a4bef99c99ede3024009a6202b6d254ad3593a68", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk4ODY5Ng==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446988696", "bodyText": "Done.", "author": "devozerov", "createdAt": "2020-06-29T13:53:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjkwNzkxOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjkwNzk5OQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446907999", "bodyText": "missing annotation", "author": "cangencer", "createdAt": "2020-06-29T11:46:42Z", "path": "hazelcast/src/main/java/com/hazelcast/sql/SqlRowMetadata.java", "diffHunk": "@@ -0,0 +1,119 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.sql;\n+\n+import com.hazelcast.internal.util.Preconditions;\n+\n+import javax.annotation.Nonnull;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.stream.Collectors;\n+\n+/**\n+ * SQL row metadata.\n+ */\n+public class SqlRowMetadata {\n+    /** Constant indicating that the column is not found. */\n+    public static final int COLUMN_NOT_FOUND = -1;\n+\n+    private final List<SqlColumnMetadata> columns;\n+    private final Map<String, Integer> nameToIndex;\n+\n+    public SqlRowMetadata(List<SqlColumnMetadata> columns) {", "originalCommit": "a4bef99c99ede3024009a6202b6d254ad3593a68", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk4ODQ4OQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446988489", "bodyText": "Fixed.", "author": "devozerov", "createdAt": "2020-06-29T13:52:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjkwNzk5OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjkwODg4OA==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446908888", "bodyText": "no toString implementation for this class, is that intentional?", "author": "cangencer", "createdAt": "2020-06-29T11:48:19Z", "path": "hazelcast/src/main/java/com/hazelcast/sql/impl/SqlResultImpl.java", "diffHunk": "@@ -0,0 +1,106 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.sql.impl;\n+\n+import com.hazelcast.sql.SqlResult;\n+import com.hazelcast.sql.SqlRow;\n+import com.hazelcast.sql.SqlRowMetadata;\n+import com.hazelcast.sql.impl.row.Row;\n+import com.hazelcast.sql.impl.state.QueryInitiatorState;\n+import com.hazelcast.sql.impl.state.QueryState;\n+\n+import javax.annotation.Nonnull;\n+import java.util.Iterator;\n+import java.util.NoSuchElementException;\n+\n+/**\n+ * Cursor implementation.\n+ */\n+public class SqlResultImpl implements SqlResult {", "originalCommit": "a4bef99c99ede3024009a6202b6d254ad3593a68", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjkxOTI1OQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446919259", "bodyText": "You mean to produce some string view of the whole result? We can't iterate the iterator here because it's a mutating operation. Years ago I had an issue that displaying a variable in the debugger called the toString and it lazy-loaded the value and then I couldn't reproduce my issue. If we want to format the results somehow, it should be a special method where we could document it, not toString.", "author": "viliam-durina", "createdAt": "2020-06-29T12:07:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjkwODg4OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk3OTM1Nw==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446979357", "bodyText": "There is nothing to expose here. Row and row metadata do have toString implementations.", "author": "devozerov", "createdAt": "2020-06-29T13:40:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjkwODg4OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjkwOTE3OA==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446909178", "bodyText": "might be nice to document this in the interface", "author": "cangencer", "createdAt": "2020-06-29T11:48:54Z", "path": "hazelcast/src/main/java/com/hazelcast/sql/impl/SqlRowImpl.java", "diffHunk": "@@ -0,0 +1,98 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+\n+package com.hazelcast.sql.impl;\n+\n+import com.hazelcast.sql.SqlColumnMetadata;\n+import com.hazelcast.sql.SqlRow;\n+import com.hazelcast.sql.SqlRowMetadata;\n+import com.hazelcast.sql.impl.row.Row;\n+\n+import javax.annotation.Nonnull;\n+import javax.annotation.Nullable;\n+import java.util.StringJoiner;\n+\n+/**\n+ * Default implementation of the SQL row which is exposed to users. We merely wrap the internal row, but add more checks which\n+ * is important for user-facing code, but which could cause performance degradation if implemented in the internal classes.\n+ */\n+public class SqlRowImpl implements SqlRow {\n+\n+    private final SqlRowMetadata rowMetadata;\n+    private final Row row;\n+\n+    public SqlRowImpl(SqlRowMetadata rowMetadata, Row row) {\n+        this.rowMetadata = rowMetadata;\n+        this.row = row;\n+    }\n+\n+    @Nullable\n+    @Override\n+    public Object getObject(int columnIndex) {\n+        checkIndex(columnIndex);\n+\n+        return getObject0(columnIndex);\n+    }\n+\n+    @Nullable\n+    @Override\n+    public Object getObject(@Nonnull String columnName) {\n+        int columnIndex = resolveIndex(columnName);\n+\n+        return getObject0(columnIndex);\n+    }\n+\n+    private Object getObject0(int columnIndex) {\n+        return row.get(columnIndex);\n+    }\n+\n+    private int resolveIndex(String columnName) {\n+        int index = rowMetadata.findColumn(columnName);\n+\n+        if (index == SqlRowMetadata.COLUMN_NOT_FOUND) {\n+            throw new IllegalArgumentException(\"Column \\\"\" + columnName + \"\\\" doesn't exist\");\n+        }\n+\n+        return index;\n+    }\n+\n+    @Nonnull\n+    @Override\n+    public SqlRowMetadata getMetadata() {\n+        return rowMetadata;\n+    }\n+\n+    private void checkIndex(int index) {\n+        if (index < 0 || index >= rowMetadata.getColumnCount()) {\n+            throw new IndexOutOfBoundsException(\"Column index is out of range: \" + index);\n+        }\n+    }\n+\n+    @Override\n+    public String toString() {", "originalCommit": "a4bef99c99ede3024009a6202b6d254ad3593a68", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk5NTI2NA==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446995264", "bodyText": "Could you please clarify what do you mean by this?", "author": "devozerov", "createdAt": "2020-06-29T14:02:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjkwOTE3OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjkxMDg2OQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446910869", "bodyText": "veery minor but typically the javadoc for @param statements start in lower case everywhere else", "author": "cangencer", "createdAt": "2020-06-29T11:52:01Z", "path": "hazelcast/src/main/java/com/hazelcast/sql/SqlRowMetadata.java", "diffHunk": "@@ -0,0 +1,119 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.sql;\n+\n+import com.hazelcast.internal.util.Preconditions;\n+\n+import javax.annotation.Nonnull;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.stream.Collectors;\n+\n+/**\n+ * SQL row metadata.\n+ */\n+public class SqlRowMetadata {\n+    /** Constant indicating that the column is not found. */\n+    public static final int COLUMN_NOT_FOUND = -1;\n+\n+    private final List<SqlColumnMetadata> columns;\n+    private final Map<String, Integer> nameToIndex;\n+\n+    public SqlRowMetadata(List<SqlColumnMetadata> columns) {\n+        assert columns != null && !columns.isEmpty();\n+\n+        this.columns = new ArrayList<>(columns);\n+\n+        nameToIndex = new HashMap<>(columns.size());\n+\n+        for (int i = 0; i < columns.size(); i++) {\n+            nameToIndex.put(columns.get(i).getName(), i);\n+        }\n+    }\n+\n+    /**\n+     * Gets the number of columns in the row.\n+     *\n+     * @return The number of columns in the row.\n+     */\n+    public int getColumnCount() {\n+        return columns.size();\n+    }\n+\n+    /**\n+     * Get column metadata.\n+     *\n+     * @param index Column index, 0-based.", "originalCommit": "a4bef99c99ede3024009a6202b6d254ad3593a68", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzAxMjQ1Mg==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r447012452", "bodyText": "Applied to @param, @return, @throws.", "author": "devozerov", "createdAt": "2020-06-29T14:25:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjkxMDg2OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njg0MTEwMw==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446841103", "bodyText": "SqlErrorCode is not in this PR, but I think we should remove the OK constant from there. This was used in C-style APIs where a return value was used instead of exceptions. The constant is unused.", "author": "viliam-durina", "createdAt": "2020-06-29T07:59:43Z", "path": "hazelcast/src/main/java/com/hazelcast/sql/SqlException.java", "diffHunk": "@@ -0,0 +1,51 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.sql;\n+\n+import com.hazelcast.core.HazelcastException;\n+\n+import java.util.UUID;\n+\n+/**\n+ * An exception occurred during SQL query execution.\n+ */\n+public class SqlException extends HazelcastException {\n+\n+    private final UUID originatingMemberId;\n+    private final int code;\n+\n+    public SqlException(UUID originatingMemberId, int code, String message, Throwable cause) {\n+        super(message, cause);\n+\n+        this.originatingMemberId = originatingMemberId;\n+        this.code = code;\n+    }\n+\n+    /**\n+     * @return ID of the member where the error occurred.\n+     */\n+    public UUID getOriginatingMemberId() {\n+        return originatingMemberId;\n+    }\n+\n+    /**\n+     * @return Error code from {@link SqlErrorCode}.", "originalCommit": "e09c02d52d9ef89cdedc657966b553adac0e036d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk5NTAxNQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446995015", "bodyText": "Removed OK.", "author": "devozerov", "createdAt": "2020-06-29T14:01:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njg0MTEwMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njg0MzMwNg==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446843306", "bodyText": "Not just during execution, but also parsing or anything that occurred in the sql subsystem.", "author": "viliam-durina", "createdAt": "2020-06-29T08:03:52Z", "path": "hazelcast/src/main/java/com/hazelcast/sql/SqlException.java", "diffHunk": "@@ -0,0 +1,51 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.sql;\n+\n+import com.hazelcast.core.HazelcastException;\n+\n+import java.util.UUID;\n+\n+/**\n+ * An exception occurred during SQL query execution.", "originalCommit": "753a610f8d690121195b06a65f8894117074ac70", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk4MDQ0OA==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446980448", "bodyText": "But parsing is a part of query execution, isn't it?", "author": "devozerov", "createdAt": "2020-06-29T13:41:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njg0MzMwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk4NjgxOQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446986819", "bodyText": "Well, depends on how you look at it, but you can say so. I leave it up to you, this comment is very minor.", "author": "viliam-durina", "createdAt": "2020-06-29T13:50:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njg0MzMwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzAxODE0NQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r447018145", "bodyText": "I propose to leave it as is since most users will not even aware of the parsing step as a separate internal execution stage.", "author": "devozerov", "createdAt": "2020-06-29T14:33:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njg0MzMwNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njg0OTAyNw==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446849027", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    this.parameters = parameters;\n          \n          \n            \n                    this.parameters = new ArrayList<>(parameters);\n          \n      \n    \n    \n  \n\nOtherwise the copy will share the parameter list, and this is contrary to what setParameters says.", "author": "viliam-durina", "createdAt": "2020-06-29T08:14:32Z", "path": "hazelcast/src/main/java/com/hazelcast/sql/SqlQuery.java", "diffHunk": "@@ -0,0 +1,271 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.sql;\n+\n+import com.hazelcast.config.SqlConfig;\n+\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Objects;\n+\n+/**\n+ * Definition of the SQL query.\n+ * <p>\n+ * This object is mutable. Properties are read once before the execution is started.\n+ * Changes to properties do not affect the behavior of already running queries.\n+ */\n+public class SqlQuery {\n+    /** Value for the timeout that is not set. */\n+    public static final long TIMEOUT_NOT_SET = -1;\n+\n+    /** Default timeout. */\n+    public static final long DEFAULT_TIMEOUT = TIMEOUT_NOT_SET;\n+\n+    /** Default page size. */\n+    public static final int DEFAULT_CURSOR_BUFFER_SIZE = 4096;\n+\n+    private String sql;\n+    private List<Object> parameters;\n+    private long timeout = DEFAULT_TIMEOUT;\n+    private int cursorBufferSize = DEFAULT_CURSOR_BUFFER_SIZE;\n+\n+    public SqlQuery(String sql) {\n+        setSql(sql);\n+    }\n+\n+    /**\n+     * Copying constructor.\n+     */\n+    private SqlQuery(String sql, List<Object> parameters, long timeout, int cursorBufferSize) {\n+        this.sql = sql;\n+        this.parameters = parameters;", "originalCommit": "753a610f8d690121195b06a65f8894117074ac70", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzAxNzQxNg==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r447017416", "bodyText": "Fixed, thanks for spotting this.", "author": "devozerov", "createdAt": "2020-06-29T14:32:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njg0OTAyNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njg1NTE0OQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446855149", "bodyText": "The main use case here is to cancel the query IMO. It's not even strictly necessary to close the result after it is fully iterated or after an exception in a finally clause. So I'd say that in the first sentence:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * Release the resources associated with the query result.\n          \n          \n            \n                 * Cancel the query on the cluster and release the resources associated with the query result.\n          \n      \n    \n    \n  \n\nI think it might be also useful to say here that if the client or submitting member crashes, the query will be cancelled automatically on the cluster.", "author": "viliam-durina", "createdAt": "2020-06-29T08:25:20Z", "path": "hazelcast/src/main/java/com/hazelcast/sql/SqlResult.java", "diffHunk": "@@ -0,0 +1,71 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.sql;\n+\n+import javax.annotation.Nonnull;\n+import java.util.Iterator;\n+\n+/**\n+ * SQL query result. Represents a stream of rows.\n+ * <p>\n+ * Use {@link #iterator()} to iterate over rows. The iterator could be requested only once.\n+ * <p>\n+ * Use {@link #close()} to release the resources associated with the result.\n+ * <p>\n+ * Typical usage pattern:\n+ * <pre>\n+ * try (SqlResult result = hazelcastInstance.getSqlQuery().query(\"SELECT ...\")) {\n+ *     for (SqlRow row : result) {\n+ *         // Process the row.\n+ *     }\n+ * }\n+ * </pre>\n+ *\n+ * @see #iterator()\n+ * @see #close()\n+ */\n+public interface SqlResult extends Iterable<SqlRow>, AutoCloseable {\n+    /**\n+     * Gets row metadata.\n+     *\n+     * @return Row metadata.\n+     */\n+    SqlRowMetadata getRowMetadata();\n+\n+    /**\n+     * Returns the iterator over query rows.\n+     * <p>\n+     * The iterator may be requested only once.\n+     *\n+     * @return Iterator.\n+     * @throws IllegalStateException If the method is invoked more than once.\n+     * @throws SqlException In case of an SQL-related error condition.\n+     */\n+    @Override\n+    @Nonnull\n+    Iterator<SqlRow> iterator();\n+\n+    /**\n+     * Release the resources associated with the query result.", "originalCommit": "753a610f8d690121195b06a65f8894117074ac70", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk4MjA5Ng==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446982096", "bodyText": "Not really. Cancellation is not common use case. The aim of this docs is to stress out that the query result is stateful, and the state must be released via a call to close. That is, it is used to avoid resource leaks in the first place, no to do a cancellation. Moreover, a call to close may or may not trigger a cancellation. Therefore, the proposed change is not accurate.", "author": "devozerov", "createdAt": "2020-06-29T13:44:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njg1NTE0OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njg2NDg1NA==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446864854", "bodyText": "Wouldn't it be easier to have the field always non-null and avoid all the null checking? SqlServiceImpl converts it from null to an empty collection again..", "author": "viliam-durina", "createdAt": "2020-06-29T08:41:43Z", "path": "hazelcast/src/main/java/com/hazelcast/sql/SqlQuery.java", "diffHunk": "@@ -0,0 +1,280 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.sql;\n+\n+import com.hazelcast.config.SqlConfig;\n+\n+import javax.annotation.Nonnull;\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Objects;\n+\n+/**\n+ * Definition of the SQL query.\n+ * <p>\n+ * This object is mutable. Properties are read once before the execution is started.\n+ * Changes to properties do not affect the behavior of already running queries.\n+ */\n+public class SqlQuery {\n+    /** Value for the timeout that is not set. */\n+    public static final long TIMEOUT_NOT_SET = -1;\n+\n+    /** Default timeout. */\n+    public static final long DEFAULT_TIMEOUT = TIMEOUT_NOT_SET;\n+\n+    /** Default page size. */\n+    public static final int DEFAULT_CURSOR_BUFFER_SIZE = 4096;\n+\n+    private String sql;\n+    private List<Object> parameters;\n+    private long timeout = DEFAULT_TIMEOUT;\n+    private int cursorBufferSize = DEFAULT_CURSOR_BUFFER_SIZE;\n+\n+    public SqlQuery(String sql) {\n+        setSql(sql);\n+    }\n+\n+    /**\n+     * Copying constructor.\n+     */\n+    private SqlQuery(String sql, List<Object> parameters, long timeout, int cursorBufferSize) {\n+        this.sql = sql;\n+        this.parameters = parameters;\n+        this.timeout = timeout;\n+        this.cursorBufferSize = cursorBufferSize;\n+    }\n+\n+    /**\n+     * Gets the SQL query to be executed.\n+     *\n+     * @return SQL query.\n+     */\n+    @Nonnull\n+    public String getSql() {\n+        return sql;\n+    }\n+\n+    /**\n+     * Sets the SQL query to be executed.\n+     * <p>\n+     * SQL query cannot be null or empty.\n+     *\n+     * @param sql SQL query.\n+     * @return This instance for chaining.\n+     */\n+    public SqlQuery setSql(String sql) {\n+        if (sql == null || sql.length() == 0) {\n+            throw new IllegalArgumentException(\"SQL cannot be null or empty.\");\n+        }\n+\n+        this.sql = sql;\n+\n+        return this;\n+    }\n+\n+    /**\n+     * Gets query parameters.\n+     *\n+     * @return Query parameters.\n+     */\n+    @Nonnull\n+    public List<Object> getParameters() {\n+        return parameters != null ? parameters : Collections.emptyList();", "originalCommit": "c6d336d960ada0ebef7a550d117bfd62b31e126a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzAxNzIxMw==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r447017213", "bodyText": "Agree, fixed.", "author": "devozerov", "createdAt": "2020-06-29T14:32:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njg2NDg1NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njg3MTEzMg==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446871132", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            + path + \"\\\": \" + e.getMessage(), e);\n          \n          \n            \n                            + path + \"\\\": \" + e, e);\n          \n      \n    \n    \n  \n\nIf the e is a NPE, we'll say: Failed to extract map entry key field \"foo\": null. The exception class is as important as the message, the message often adds information to the name. Also the message of an index-out-of-bounds-exc is just index=n, size=m, which looks weird per se.", "author": "viliam-durina", "createdAt": "2020-06-29T08:52:32Z", "path": "hazelcast/src/main/java/com/hazelcast/sql/impl/extract/GenericFieldExtractor.java", "diffHunk": "@@ -44,10 +45,14 @@ public GenericFieldExtractor(\n     @Override\n     public Object get() {\n         try {\n-            return type.convert(extractors.extract(getTarget(), path, null));\n+            return type.normalize(extractors.extract(getTarget(), path, null));\n+        } catch (QueryDataTypeMismatchException e) {\n+            throw QueryException.dataException(\"Failed to extract map entry \" + (key ? \"key\" : \"value\") + \" field \\\"\"\n+                + path + \"\\\" because of type mismatch [expectedClass=\" + e.getExpectedClass().getName()\n+                + \", actualClass=\" + e.getActualClass().getName() + ']');\n         } catch (Exception e) {\n-            throw QueryException.dataException(\"Cannot extract \" + (key ? \"key\" : \"value\") + \" field \\\"\" + path\n-                + \"\\\" of type \" + type + \": \" + e.getMessage(), e);\n+            throw QueryException.dataException(\"Failed to extract map entry \" + (key ? \"key\" : \"value\") + \" field \\\"\"\n+                + path + \"\\\": \" + e.getMessage(), e);", "originalCommit": "c6d336d960ada0ebef7a550d117bfd62b31e126a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk4MzQ1NA==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446983454", "bodyText": "The exception class is accessible from getCause().", "author": "devozerov", "createdAt": "2020-06-29T13:45:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njg3MTEzMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjkxNjIyMQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446916221", "bodyText": "We should also create a constant for the value of 0.", "author": "viliam-durina", "createdAt": "2020-06-29T12:01:46Z", "path": "hazelcast/src/main/java/com/hazelcast/sql/SqlQuery.java", "diffHunk": "@@ -0,0 +1,286 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.sql;\n+\n+import com.hazelcast.config.SqlConfig;\n+import com.hazelcast.internal.util.Preconditions;\n+\n+import javax.annotation.Nonnull;\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Objects;\n+\n+/**\n+ * Definition of a SQL query.\n+ * <p>\n+ * This object is mutable. Properties are read once before the execution is started.\n+ * Changes to properties do not affect the behavior of already running queries.\n+ */\n+public class SqlQuery {\n+    /** Value for the timeout that is not set. */\n+    public static final long TIMEOUT_NOT_SET = -1;\n+\n+    /** Default timeout. */\n+    public static final long DEFAULT_TIMEOUT = TIMEOUT_NOT_SET;\n+\n+    /** Default page size. */\n+    public static final int DEFAULT_CURSOR_BUFFER_SIZE = 4096;\n+\n+    private String sql;\n+    private List<Object> parameters;\n+    private long timeout = DEFAULT_TIMEOUT;\n+    private int cursorBufferSize = DEFAULT_CURSOR_BUFFER_SIZE;\n+\n+    public SqlQuery(String sql) {\n+        setSql(sql);\n+    }\n+\n+    /**\n+     * Copying constructor.\n+     */\n+    private SqlQuery(String sql, List<Object> parameters, long timeout, int cursorBufferSize) {\n+        this.sql = sql;\n+        this.parameters = parameters;\n+        this.timeout = timeout;\n+        this.cursorBufferSize = cursorBufferSize;\n+    }\n+\n+    /**\n+     * Gets the SQL query to be executed.\n+     *\n+     * @return SQL query.\n+     */\n+    @Nonnull\n+    public String getSql() {\n+        return sql;\n+    }\n+\n+    /**\n+     * Sets the SQL query to be executed.\n+     * <p>\n+     * The SQL query cannot be null or empty.\n+     *\n+     * @param sql SQL query.\n+     * @return This instance for chaining.\n+     * @throws NullPointerException If passed SQL query is null\n+     * @throws IllegalArgumentException If passed SQL query is empty\n+     */\n+    @Nonnull\n+    public SqlQuery setSql(@Nonnull String sql) {\n+        Preconditions.checkNotNull(sql, \"SQL cannot be null\");\n+\n+        if (sql.length() == 0) {\n+            throw new IllegalArgumentException(\"SQL cannot be empty\");\n+        }\n+\n+        this.sql = sql;\n+\n+        return this;\n+    }\n+\n+    /**\n+     * Gets the query parameters.\n+     *\n+     * @return Query parameters.\n+     */\n+    @Nonnull\n+    public List<Object> getParameters() {\n+        return parameters != null ? parameters : Collections.emptyList();\n+    }\n+\n+    /**\n+     * Sets the query parameters.\n+     * <p>\n+     * You may define parameter placeholders in the query with the {@code \"?\"} character. For every placeholder, a parameter\n+     * value must be provided.\n+     * <p>\n+     * When the method is called, the content of the parameters list is copied. Subsequent changes to the original list don't\n+     * change the query parameters.\n+     *\n+     * @see #addParameter(Object)\n+     * @see #clearParameters()\n+     * @param parameters Query parameters.\n+     * @return This instance for chaining.\n+     */\n+    @Nonnull\n+    public SqlQuery setParameters(List<Object> parameters) {\n+        if (parameters == null || parameters.isEmpty()) {\n+            this.parameters = null;\n+        } else {\n+            this.parameters = new ArrayList<>(parameters);\n+        }\n+\n+        return this;\n+    }\n+\n+    /**\n+     * Adds a single parameter to the end of the parameters list.\n+     *\n+     * @see #setParameters(List)\n+     * @see #clearParameters()\n+     * @param parameter Parameter.\n+     * @return This instance for chaining.\n+     */\n+    @Nonnull\n+    public SqlQuery addParameter(Object parameter) {\n+        if (parameters == null) {\n+            parameters = new ArrayList<>(1);\n+        }\n+\n+        parameters.add(parameter);\n+\n+        return this;\n+    }\n+\n+    /**\n+     * Clear query parameters.\n+     *\n+     * @see #setParameters(List)\n+     * @see #addParameter(Object)\n+     * @return This instance for chaining.\n+     */\n+    @Nonnull\n+    public SqlQuery clearParameters() {\n+        this.parameters = null;\n+\n+        return this;\n+    }\n+\n+    /**\n+     * Gets the query timeout in milliseconds.\n+     *\n+     * @return Query timeout in milliseconds.\n+     */\n+    public long getTimeout() {\n+        return timeout;\n+    }\n+\n+    /**\n+     * Sets the query timeout in milliseconds.\n+     * <p>\n+     * If the timeout is reached for a running query, it will be cancelled forcefully.\n+     * <p>\n+     * Zero value means no timeout. {@value #TIMEOUT_NOT_SET} means that the value from {@link SqlConfig#getQueryTimeout()} will", "originalCommit": "a4bef99c99ede3024009a6202b6d254ad3593a68", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk4ODAxNg==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446988016", "bodyText": "Added a constant.", "author": "devozerov", "createdAt": "2020-06-29T13:52:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjkxNjIyMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjkxNjU5MQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446916591", "bodyText": "We should also mark this argument as nonnull. Also elsewhere.", "author": "viliam-durina", "createdAt": "2020-06-29T12:02:25Z", "path": "hazelcast/src/main/java/com/hazelcast/sql/SqlQuery.java", "diffHunk": "@@ -0,0 +1,286 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.sql;\n+\n+import com.hazelcast.config.SqlConfig;\n+import com.hazelcast.internal.util.Preconditions;\n+\n+import javax.annotation.Nonnull;\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Objects;\n+\n+/**\n+ * Definition of a SQL query.\n+ * <p>\n+ * This object is mutable. Properties are read once before the execution is started.\n+ * Changes to properties do not affect the behavior of already running queries.\n+ */\n+public class SqlQuery {\n+    /** Value for the timeout that is not set. */\n+    public static final long TIMEOUT_NOT_SET = -1;\n+\n+    /** Default timeout. */\n+    public static final long DEFAULT_TIMEOUT = TIMEOUT_NOT_SET;\n+\n+    /** Default page size. */\n+    public static final int DEFAULT_CURSOR_BUFFER_SIZE = 4096;\n+\n+    private String sql;\n+    private List<Object> parameters;\n+    private long timeout = DEFAULT_TIMEOUT;\n+    private int cursorBufferSize = DEFAULT_CURSOR_BUFFER_SIZE;\n+\n+    public SqlQuery(String sql) {", "originalCommit": "a4bef99c99ede3024009a6202b6d254ad3593a68", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk4ODE0NQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446988145", "bodyText": "Fixed.", "author": "devozerov", "createdAt": "2020-06-29T13:52:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjkxNjU5MQ=="}], "type": "inlineReview"}, {"oid": "9b2347ca7ae76d5827c01f8d15d05d4a910d4f95", "url": "https://github.com/hazelcast/hazelcast/commit/9b2347ca7ae76d5827c01f8d15d05d4a910d4f95", "message": "1) timeout -> timeoutMillis\n2) Use \"-1\" as pool size default", "committedDate": "2020-06-29T12:39:13Z", "type": "commit"}, {"oid": "ea1866266c93e460f883853446ec1e8e24835e20", "url": "https://github.com/hazelcast/hazelcast/commit/ea1866266c93e460f883853446ec1e8e24835e20", "message": "Docs for SqlService.", "committedDate": "2020-06-29T13:31:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk2OTc1MA==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446969750", "bodyText": "What about adding this?\n@throws ClassCastException If the type of the column type isn't assignable to the type {@code T}.\n\nIt's not strictly correct because the CCE is not thrown by this method but when the result of this method is assigned, but it might help to understand the issue.\nIt also might help to put a blank line between the blocks of @see, @param and @throws lines, the javadoc renderer also groups it.", "author": "viliam-durina", "createdAt": "2020-06-29T13:26:35Z", "path": "hazelcast/src/main/java/com/hazelcast/sql/SqlRow.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.sql;\n+\n+import javax.annotation.Nonnull;\n+import javax.annotation.Nullable;\n+\n+/**\n+ * SQL row.\n+ */\n+public interface SqlRow {\n+    /**\n+     * Gets the value of the column by index.\n+     * <p>\n+     * The class of the returned value depends on the SQL type of the column. No implicit conversions are performed on the value.\n+     *\n+     * @see #getMetadata()\n+     * @see SqlColumnMetadata#getType()\n+     * @param columnIndex Column index, 0-based.\n+     * @return Value of the column.\n+     * @throws IndexOutOfBoundsException If the column index is out of bounds.\n+     */\n+    @Nullable\n+    <T> T getObject(int columnIndex);\n+\n+    /**\n+     * Gets the value of the column by column name.\n+     * <p>\n+     * Column name should be one of those defined in {@link SqlRowMetadata}, case-sensitive. You may also use\n+     * {@link SqlRowMetadata#findColumn(String)} to test for column existence.\n+     * <p>\n+     * The class of the returned value depends on the SQL type of the column. No implicit conversions are performed on the value.\n+     *\n+     * @see #getMetadata()\n+     * @see SqlRowMetadata#findColumn(String)\n+     * @see SqlColumnMetadata#getName()\n+     * @see SqlColumnMetadata#getType()\n+     * @param columnName Column name.\n+     * @return Value of the column\n+     * @throws NullPointerException If column name is null\n+     * @throws IllegalArgumentException If a column with the given name is not found", "originalCommit": "9b2347ca7ae76d5827c01f8d15d05d4a910d4f95", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk5MjEzMg==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446992132", "bodyText": "Fixed, thanks for the suggestion.", "author": "devozerov", "createdAt": "2020-06-29T13:57:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk2OTc1MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk3MjA1NA==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446972054", "bodyText": "This used to be Math.min(8, Runtime.getRuntime().availableProcessors()), was the change intentional?", "author": "viliam-durina", "createdAt": "2020-06-29T13:29:50Z", "path": "hazelcast/src/main/java/com/hazelcast/sql/impl/SqlServiceImpl.java", "diffHunk": "@@ -16,52 +16,79 @@\n \n package com.hazelcast.sql.impl;\n \n+import com.hazelcast.config.SqlConfig;\n import com.hazelcast.core.HazelcastException;\n import com.hazelcast.internal.nio.Packet;\n import com.hazelcast.internal.serialization.InternalSerializationService;\n+import com.hazelcast.internal.util.Preconditions;\n import com.hazelcast.logging.ILogger;\n import com.hazelcast.spi.impl.NodeEngine;\n import com.hazelcast.spi.impl.NodeEngineImpl;\n+import com.hazelcast.sql.SqlResult;\n+import com.hazelcast.sql.SqlQuery;\n+import com.hazelcast.sql.SqlService;\n import com.hazelcast.sql.impl.optimizer.DisabledSqlOptimizer;\n import com.hazelcast.sql.impl.optimizer.OptimizationTask;\n import com.hazelcast.sql.impl.optimizer.SqlOptimizer;\n import com.hazelcast.sql.impl.optimizer.SqlPlan;\n import com.hazelcast.sql.impl.plan.Plan;\n import com.hazelcast.sql.impl.state.QueryState;\n \n+import javax.annotation.Nonnull;\n import java.lang.reflect.Constructor;\n+import java.util.ArrayList;\n+import java.util.Collections;\n import java.util.List;\n import java.util.function.Consumer;\n import java.util.logging.Level;\n \n /**\n  * Base SQL service implementation that bridges optimizer implementation, public and private APIs.\n  */\n-public class SqlServiceImpl implements Consumer<Packet> {\n+public class SqlServiceImpl implements SqlService, Consumer<Packet> {\n     /** Outbox batch size in bytes. */\n     private static final int OUTBOX_BATCH_SIZE = 512 * 1024;\n \n     /** Default state check frequency. */\n-    private static final long STATE_CHECK_FREQUENCY = 10_000L;\n+    private static final long STATE_CHECK_FREQUENCY = 1_000L;\n \n     private static final String OPTIMIZER_CLASS_PROPERTY_NAME = \"hazelcast.sql.optimizerClass\";\n     private static final String SQL_MODULE_OPTIMIZER_CLASS = \"com.hazelcast.sql.impl.calcite.CalciteSqlOptimizer\";\n \n     private SqlOptimizer optimizer;\n     private final ILogger logger;\n     private final NodeEngineImpl nodeEngine;\n+    private final long queryTimeout;\n+\n+    private final NodeServiceProviderImpl nodeServiceProvider;\n \n     private volatile SqlInternalService internalService;\n \n     public SqlServiceImpl(NodeEngineImpl nodeEngine) {\n         this.nodeEngine = nodeEngine;\n         logger = nodeEngine.getLogger(getClass());\n \n-        // These two parameters will be taken from the config, when public API is ready.\n-        int operationThreadCount = Runtime.getRuntime().availableProcessors();\n-        int fragmentThreadCount = Runtime.getRuntime().availableProcessors();\n+        SqlConfig config = nodeEngine.getConfig().getSqlConfig();\n+\n+        int executorPoolSize = config.getExecutorPoolSize();\n+        int operationPoolSize = config.getOperationPoolSize();\n+        long queryTimeout = config.getQueryTimeoutMillis();\n \n-        NodeServiceProviderImpl nodeServiceProvider = new NodeServiceProviderImpl(nodeEngine);\n+        if (executorPoolSize == SqlConfig.DEFAULT_EXECUTOR_POOL_SIZE) {\n+            executorPoolSize = Runtime.getRuntime().availableProcessors();\n+        }\n+\n+        if (operationPoolSize == SqlConfig.DEFAULT_OPERATION_POOL_SIZE) {\n+            operationPoolSize = Runtime.getRuntime().availableProcessors();", "originalCommit": "9b2347ca7ae76d5827c01f8d15d05d4a910d4f95", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk4OTkwOQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446989909", "bodyText": "Math.min was very old heuristics with no proven value. It is simplified now.", "author": "devozerov", "createdAt": "2020-06-29T13:54:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk3MjA1NA=="}], "type": "inlineReview"}, {"oid": "5186bba92c0d1a79248bcb4e33cfcb38ad5012a5", "url": "https://github.com/hazelcast/hazelcast/commit/5186bba92c0d1a79248bcb4e33cfcb38ad5012a5", "message": "1) Nullability fixes\n2) Added a constant for a zero timeout value", "committedDate": "2020-06-29T13:50:58Z", "type": "commit"}, {"oid": "ea15c95c39da81b5f34a23cb22c46fd2280b758c", "url": "https://github.com/hazelcast/hazelcast/commit/ea15c95c39da81b5f34a23cb22c46fd2280b758c", "message": "Minor omission", "committedDate": "2020-06-29T13:55:11Z", "type": "commit"}, {"oid": "f5ed22a270ce8083fae4d9e4ddd62f3f0ee637a0", "url": "https://github.com/hazelcast/hazelcast/commit/f5ed22a270ce8083fae4d9e4ddd62f3f0ee637a0", "message": "Fix to SqlRow JavaDoc.", "committedDate": "2020-06-29T13:57:33Z", "type": "commit"}, {"oid": "7db7097336468822397606c485532d22f9f74ae7", "url": "https://github.com/hazelcast/hazelcast/commit/7db7097336468822397606c485532d22f9f74ae7", "message": "Merge remote-tracking branch 'devozerov/issues/17042' into issues/17042", "committedDate": "2020-06-29T13:57:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk5MjMwMw==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446992303", "bodyText": "What about marking this constructor a @PrivateApi? It's not supposed to be used by the users, we might add more metadata to it.\nAlso SqlRowMetadata, maybe also SqlException.", "author": "viliam-durina", "createdAt": "2020-06-29T13:58:06Z", "path": "hazelcast/src/main/java/com/hazelcast/sql/SqlColumnMetadata.java", "diffHunk": "@@ -0,0 +1,90 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.sql;\n+\n+import javax.annotation.Nonnull;\n+\n+/**\n+ * SQL column metadata.\n+ */\n+public final class SqlColumnMetadata {\n+\n+    private final String name;\n+    private final SqlColumnType type;\n+\n+    @SuppressWarnings(\"ConstantConditions\")\n+    public SqlColumnMetadata(@Nonnull String name, @Nonnull SqlColumnType type) {", "originalCommit": "ea15c95c39da81b5f34a23cb22c46fd2280b758c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk5MzQ4Nw==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r446993487", "bodyText": "Agreed, fixed.", "author": "devozerov", "createdAt": "2020-06-29T13:59:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk5MjMwMw=="}], "type": "inlineReview"}, {"oid": "e44408c205ee488f4561f40e739afe60ffd5378a", "url": "https://github.com/hazelcast/hazelcast/commit/e44408c205ee488f4561f40e739afe60ffd5378a", "message": "Added @PrivateApi to constructors that are not meant to be used by a user.", "committedDate": "2020-06-29T13:59:29Z", "type": "commit"}, {"oid": "98e1337b0cf25f4e4cbb5cadb09b84c71119a03c", "url": "https://github.com/hazelcast/hazelcast/commit/98e1337b0cf25f4e4cbb5cadb09b84c71119a03c", "message": "Fix typos", "committedDate": "2020-06-29T14:11:26Z", "type": "commit"}, {"oid": "28be72c1d92fa8a9a5cba2341d41568cc78f8c6c", "url": "https://github.com/hazelcast/hazelcast/commit/28be72c1d92fa8a9a5cba2341d41568cc78f8c6c", "message": "Normalized casing for JavaDoc.", "committedDate": "2020-06-29T14:23:55Z", "type": "commit"}, {"oid": "49e56635b2648c12747f6940e14eb0e09a09fe47", "url": "https://github.com/hazelcast/hazelcast/commit/49e56635b2648c12747f6940e14eb0e09a09fe47", "message": "Ensure that SqlQuery.parameters is never null.", "committedDate": "2020-06-29T14:31:45Z", "type": "commit"}, {"oid": "504ae67133ce87f8bc6b1a7a22f04630522d21ba", "url": "https://github.com/hazelcast/hazelcast/commit/504ae67133ce87f8bc6b1a7a22f04630522d21ba", "message": "Removed unnecessary </li>", "committedDate": "2020-06-29T14:46:03Z", "type": "commit"}, {"oid": "b9f8be2460c36590bc8bf177a2d9aaa94e942c8e", "url": "https://github.com/hazelcast/hazelcast/commit/b9f8be2460c36590bc8bf177a2d9aaa94e942c8e", "message": "Improve JavaDocs for HazelcastInstance.getSql.", "committedDate": "2020-06-30T06:03:42Z", "type": "commit"}, {"oid": "4c979ce1c9068fe6051d343bfea7895c49f82e1a", "url": "https://github.com/hazelcast/hazelcast/commit/4c979ce1c9068fe6051d343bfea7895c49f82e1a", "message": "Improve HazelcastInstance.getSql JavaDocs.", "committedDate": "2020-06-30T06:04:15Z", "type": "commit"}, {"oid": "cdc1f7d2bd5c0102246760870412443a36bb6cbc", "url": "https://github.com/hazelcast/hazelcast/commit/cdc1f7d2bd5c0102246760870412443a36bb6cbc", "message": "Added Beta annotation.", "committedDate": "2020-06-30T06:05:02Z", "type": "commit"}, {"oid": "4cc30bab01a1a89a2a7be31fb852236b124359d2", "url": "https://github.com/hazelcast/hazelcast/commit/4cc30bab01a1a89a2a7be31fb852236b124359d2", "message": "Merge branch 'master' into issues/17042\n\n# Conflicts:\n#\thazelcast/src/main/java/com/hazelcast/spi/impl/NodeEngine.java", "committedDate": "2020-06-30T08:16:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzU2OTU0NA==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r447569544", "bodyText": "Shouldn't we also mark this method as @Beta?", "author": "viliam-durina", "createdAt": "2020-06-30T10:09:06Z", "path": "hazelcast/src/main/java/com/hazelcast/core/HazelcastInstance.java", "diffHunk": "@@ -452,6 +453,15 @@\n      */\n     @Nonnull CPSubsystem getCPSubsystem();\n \n+    /**\n+     * Returns a service to execute distributed SQL queries.\n+     *\n+     * @return SQL service\n+     *\n+     * @see SqlService\n+     */\n+    @Nonnull SqlService getSql();", "originalCommit": "4cc30bab01a1a89a2a7be31fb852236b124359d2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzU3MTM4MQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r447571381", "bodyText": "I think it is sufficient to mark the service itself as @Beta. The method HazelcastInstance.getSql is not in the beta state on its own. It is the service that it provides in the beta status. We used this pattern for all other @Beta usages.", "author": "devozerov", "createdAt": "2020-06-30T10:12:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzU2OTU0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzU4MzEzMw==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r447583133", "bodyText": "I agree it's technically sufficient, but we're trying to make it as clear as possible for the users. All APIs available through this method are beta, so even though if this method itself is not, there's nothing you can do with it if you want to avoid beta.\nI would even document the state of the development here or in the SqlService class docs. It will set expectations and reduce disillusionment.", "author": "viliam-durina", "createdAt": "2020-06-30T10:33:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzU2OTU0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzY2ODIyNg==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r447668226", "bodyText": "Ok, agree. Added @Beta annotation to HazelcastInstance.getSql. Regarding concrete capabilities - it is nearly impossible to list and maintain the list of supported features. In SQL this is the goal of documentation.", "author": "devozerov", "createdAt": "2020-06-30T13:09:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzU2OTU0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzgyNDA4NQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r447824085", "bodyText": "I would add a statement like this:\n\nThe SQL module in the 4.1 release is in beta state. We might change details of the behavior in future releases or even change the API. The functionality is also limited, for example we don't yet support joins, aggregations or DML statements. We also don't support IMaps with NATIVE in-memory format (enterprise feature). However, the features that are implemented are of production quality and are safe to be used in production settings.", "author": "viliam-durina", "createdAt": "2020-06-30T16:36:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzU2OTU0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODkzNTUyNw==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r448935527", "bodyText": "Added a note about the beta state.\nAs mentioned before, I am not keen to add a description of specific features to JavaDoc. This is a goal of documentation, not JavaDoc, to inform users about supported SQL features. Whatever we write in JavaDoc will be outdated almost immediately. Even the list of unsupported features in the sample snippet is not accurate already.", "author": "devozerov", "createdAt": "2020-07-02T11:30:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzU2OTU0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzY0OTMwMg==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r447649302", "bodyText": "Shall we create a similar run for HD?", "author": "petrpleshachkov", "createdAt": "2020-06-30T12:38:44Z", "path": "hazelcast-sql/src/test/java/com/hazelcast/sql/SqlBasicTest.java", "diffHunk": "@@ -0,0 +1,961 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.sql;\n+\n+import com.hazelcast.config.Config;\n+import com.hazelcast.config.InMemoryFormat;\n+import com.hazelcast.config.MapConfig;\n+import com.hazelcast.config.SerializationConfig;\n+import com.hazelcast.core.HazelcastInstance;\n+import com.hazelcast.map.IMap;\n+import com.hazelcast.nio.ObjectDataInput;\n+import com.hazelcast.nio.ObjectDataOutput;\n+import com.hazelcast.nio.serialization.DataSerializable;\n+import com.hazelcast.nio.serialization.IdentifiedDataSerializable;\n+import com.hazelcast.nio.serialization.Portable;\n+import com.hazelcast.nio.serialization.PortableReader;\n+import com.hazelcast.nio.serialization.PortableWriter;\n+import com.hazelcast.sql.impl.SqlTestSupport;\n+import com.hazelcast.test.HazelcastParallelParametersRunnerFactory;\n+import com.hazelcast.test.TestHazelcastInstanceFactory;\n+import com.hazelcast.test.annotation.ParallelJVMTest;\n+import com.hazelcast.test.annotation.QuickTest;\n+import org.junit.AfterClass;\n+import org.junit.Before;\n+import org.junit.BeforeClass;\n+import org.junit.Test;\n+import org.junit.experimental.categories.Category;\n+import org.junit.runner.RunWith;\n+import org.junit.runners.Parameterized;\n+import org.junit.runners.Parameterized.Parameter;\n+import org.junit.runners.Parameterized.Parameters;\n+import org.junit.runners.Parameterized.UseParametersRunnerFactory;\n+\n+import java.io.IOException;\n+import java.io.Serializable;\n+import java.math.BigDecimal;\n+import java.math.BigInteger;\n+import java.time.Instant;\n+import java.time.LocalDate;\n+import java.time.LocalDateTime;\n+import java.time.LocalTime;\n+import java.time.OffsetDateTime;\n+import java.time.ZoneId;\n+import java.time.ZonedDateTime;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.Collection;\n+import java.util.Date;\n+import java.util.GregorianCalendar;\n+import java.util.HashMap;\n+import java.util.HashSet;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.NoSuchElementException;\n+import java.util.Set;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNotEquals;\n+\n+/**\n+ * Test that covers basic column read operations through SQL.\n+ */\n+@RunWith(Parameterized.class)\n+@UseParametersRunnerFactory(HazelcastParallelParametersRunnerFactory.class)\n+@Category({QuickTest.class, ParallelJVMTest.class})\n+@SuppressWarnings(\"checkstyle:RedundantModifier\")\n+public class SqlBasicTest extends SqlTestSupport {\n+\n+    private static final int IDS_FACTORY_ID = 1;\n+    private static final int IDS_KEY_CLASS_ID = 2;\n+    private static final int IDS_VALUE_CLASS_ID = 3;\n+    private static final int PORTABLE_FACTORY_ID = 1;\n+    private static final int PORTABLE_KEY_CLASS_ID = 2;\n+    private static final int PORTABLE_VALUE_CLASS_ID = 3;\n+    private static final int PORTABLE_NESTED_CLASS_ID = 4;\n+\n+    private static final String MAP_OBJECT = \"map_object\";\n+    private static final String MAP_BINARY = \"map_binary\";\n+\n+    private static final int[] PAGE_SIZES = { 1, 16, 256, 4096 };\n+    private static final int[] DATA_SET_SIZES = { 1, 256, 4096 };\n+    private static final TestHazelcastInstanceFactory FACTORY = new TestHazelcastInstanceFactory(2);\n+\n+    private static HazelcastInstance instance;\n+\n+    @Parameter\n+    public int cursorBufferSize;\n+\n+    @Parameter(1)\n+    public int dataSetSize;\n+\n+    @Parameter(2)\n+    public SerializationMode serializationMode;\n+\n+    @Parameter(3)\n+    public InMemoryFormat inMemoryFormat;\n+\n+    @Parameters(name = \"cursorBufferSize:{0}, dataSetSize:{1}, serializationMode:{2}, inMemoryFormat:{3}\")\n+    public static Collection<Object[]> parameters() {\n+        List<Object[]> res = new ArrayList<>();\n+\n+        for (int pageSize : PAGE_SIZES) {\n+            for (int dataSetSize : DATA_SET_SIZES) {\n+                for (SerializationMode serializationMode : SerializationMode.values()) {\n+                    for (InMemoryFormat format : new InMemoryFormat[] { InMemoryFormat.OBJECT, InMemoryFormat.BINARY }) {", "originalCommit": "4cc30bab01a1a89a2a7be31fb852236b124359d2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzY2ODQ5Ng==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r447668496", "bodyText": "HD is not supported in the scope of this PR", "author": "devozerov", "createdAt": "2020-06-30T13:09:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzY0OTMwMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzY1MDkzMw==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r447650933", "bodyText": "Maybe use assertNotNull() instead?", "author": "petrpleshachkov", "createdAt": "2020-06-30T12:41:20Z", "path": "hazelcast-sql/src/test/java/com/hazelcast/sql/SqlBasicTest.java", "diffHunk": "@@ -0,0 +1,961 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.sql;\n+\n+import com.hazelcast.config.Config;\n+import com.hazelcast.config.InMemoryFormat;\n+import com.hazelcast.config.MapConfig;\n+import com.hazelcast.config.SerializationConfig;\n+import com.hazelcast.core.HazelcastInstance;\n+import com.hazelcast.map.IMap;\n+import com.hazelcast.nio.ObjectDataInput;\n+import com.hazelcast.nio.ObjectDataOutput;\n+import com.hazelcast.nio.serialization.DataSerializable;\n+import com.hazelcast.nio.serialization.IdentifiedDataSerializable;\n+import com.hazelcast.nio.serialization.Portable;\n+import com.hazelcast.nio.serialization.PortableReader;\n+import com.hazelcast.nio.serialization.PortableWriter;\n+import com.hazelcast.sql.impl.SqlTestSupport;\n+import com.hazelcast.test.HazelcastParallelParametersRunnerFactory;\n+import com.hazelcast.test.TestHazelcastInstanceFactory;\n+import com.hazelcast.test.annotation.ParallelJVMTest;\n+import com.hazelcast.test.annotation.QuickTest;\n+import org.junit.AfterClass;\n+import org.junit.Before;\n+import org.junit.BeforeClass;\n+import org.junit.Test;\n+import org.junit.experimental.categories.Category;\n+import org.junit.runner.RunWith;\n+import org.junit.runners.Parameterized;\n+import org.junit.runners.Parameterized.Parameter;\n+import org.junit.runners.Parameterized.Parameters;\n+import org.junit.runners.Parameterized.UseParametersRunnerFactory;\n+\n+import java.io.IOException;\n+import java.io.Serializable;\n+import java.math.BigDecimal;\n+import java.math.BigInteger;\n+import java.time.Instant;\n+import java.time.LocalDate;\n+import java.time.LocalDateTime;\n+import java.time.LocalTime;\n+import java.time.OffsetDateTime;\n+import java.time.ZoneId;\n+import java.time.ZonedDateTime;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.Collection;\n+import java.util.Date;\n+import java.util.GregorianCalendar;\n+import java.util.HashMap;\n+import java.util.HashSet;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.NoSuchElementException;\n+import java.util.Set;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNotEquals;\n+\n+/**\n+ * Test that covers basic column read operations through SQL.\n+ */\n+@RunWith(Parameterized.class)\n+@UseParametersRunnerFactory(HazelcastParallelParametersRunnerFactory.class)\n+@Category({QuickTest.class, ParallelJVMTest.class})\n+@SuppressWarnings(\"checkstyle:RedundantModifier\")\n+public class SqlBasicTest extends SqlTestSupport {\n+\n+    private static final int IDS_FACTORY_ID = 1;\n+    private static final int IDS_KEY_CLASS_ID = 2;\n+    private static final int IDS_VALUE_CLASS_ID = 3;\n+    private static final int PORTABLE_FACTORY_ID = 1;\n+    private static final int PORTABLE_KEY_CLASS_ID = 2;\n+    private static final int PORTABLE_VALUE_CLASS_ID = 3;\n+    private static final int PORTABLE_NESTED_CLASS_ID = 4;\n+\n+    private static final String MAP_OBJECT = \"map_object\";\n+    private static final String MAP_BINARY = \"map_binary\";\n+\n+    private static final int[] PAGE_SIZES = { 1, 16, 256, 4096 };\n+    private static final int[] DATA_SET_SIZES = { 1, 256, 4096 };\n+    private static final TestHazelcastInstanceFactory FACTORY = new TestHazelcastInstanceFactory(2);\n+\n+    private static HazelcastInstance instance;\n+\n+    @Parameter\n+    public int cursorBufferSize;\n+\n+    @Parameter(1)\n+    public int dataSetSize;\n+\n+    @Parameter(2)\n+    public SerializationMode serializationMode;\n+\n+    @Parameter(3)\n+    public InMemoryFormat inMemoryFormat;\n+\n+    @Parameters(name = \"cursorBufferSize:{0}, dataSetSize:{1}, serializationMode:{2}, inMemoryFormat:{3}\")\n+    public static Collection<Object[]> parameters() {\n+        List<Object[]> res = new ArrayList<>();\n+\n+        for (int pageSize : PAGE_SIZES) {\n+            for (int dataSetSize : DATA_SET_SIZES) {\n+                for (SerializationMode serializationMode : SerializationMode.values()) {\n+                    for (InMemoryFormat format : new InMemoryFormat[] { InMemoryFormat.OBJECT, InMemoryFormat.BINARY }) {\n+                        res.add(new Object[] {\n+                            pageSize,\n+                            dataSetSize,\n+                            serializationMode,\n+                            format\n+                        });\n+                    }\n+                }\n+            }\n+        }\n+\n+        return res;\n+    }\n+\n+    @BeforeClass\n+    public static void beforeClass() {\n+        instance = FACTORY.newHazelcastInstance(config());\n+\n+        FACTORY.newHazelcastInstance(config());\n+    }\n+\n+    @AfterClass\n+    public static void afterClass() {\n+        FACTORY.shutdownAll();\n+    }\n+\n+    @Before\n+    public void before() {\n+        instance.getMap(MAP_OBJECT).clear();\n+        instance.getMap(MAP_BINARY).clear();\n+    }\n+\n+    @SuppressWarnings(\"ConstantConditions\")\n+    @Test\n+    public void testSelect() {\n+        // Get proper map\n+        IMap<Object, AbstractPojo> map = instance.getMap(mapName());\n+\n+        // Populate map with values\n+        Map<Object, AbstractPojo> data = new HashMap<>();\n+\n+        for (long i = 0; i < dataSetSize; i++) {\n+            data.put(key(i), value(i));\n+        }\n+\n+        map.putAll(data);\n+\n+        assertEquals(dataSetSize, map.size());\n+\n+        // Execute query\n+        boolean portable = serializationMode == SerializationMode.PORTABLE;\n+\n+        try (SqlResult res = query()) {\n+            SqlRowMetadata rowMetadata = res.getRowMetadata();\n+\n+            checkRowMetadata(rowMetadata);\n+\n+            Set<Long> uniqueKeys = new HashSet<>();\n+\n+            Iterator<SqlRow> rowIterator = res.iterator();\n+\n+            while (rowIterator.hasNext()) {\n+                SqlRow row = rowIterator.next();\n+\n+                assertEquals(rowMetadata, res.getRowMetadata());\n+\n+                Long key0 = row.getObject(rowMetadata.findColumn(adjustFieldName(\"key\")));\n+                assert key0 != null;", "originalCommit": "4cc30bab01a1a89a2a7be31fb852236b124359d2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzY3MDgxNg==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r447670816", "bodyText": "Fixed", "author": "devozerov", "createdAt": "2020-06-30T13:13:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzY1MDkzMw=="}], "type": "inlineReview"}, {"oid": "832ace46a5a3a7a706d7431a13f4610e4bc3a0a2", "url": "https://github.com/hazelcast/hazelcast/commit/832ace46a5a3a7a706d7431a13f4610e4bc3a0a2", "message": "Added @Beta annotation to HazelcastInstance.getSql.", "committedDate": "2020-06-30T13:07:54Z", "type": "commit"}, {"oid": "d45d466a8ab9631c7c3a43a49e985b793f1b33f0", "url": "https://github.com/hazelcast/hazelcast/commit/d45d466a8ab9631c7c3a43a49e985b793f1b33f0", "message": "Added default value for timeout to XSDs.", "committedDate": "2020-06-30T13:12:24Z", "type": "commit"}, {"oid": "2326f53ae2ba7769a99e07d76acc32b0558bab24", "url": "https://github.com/hazelcast/hazelcast/commit/2326f53ae2ba7769a99e07d76acc32b0558bab24", "message": "Minor change to SqlBasicTest.", "committedDate": "2020-06-30T13:12:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzY1NDU4Mw==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r447654583", "bodyText": "Do we have HD counterpart for the test?", "author": "petrpleshachkov", "createdAt": "2020-06-30T12:47:27Z", "path": "hazelcast-sql/src/test/java/com/hazelcast/sql/SqlErrorTest.java", "diffHunk": "@@ -0,0 +1,358 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.sql;\n+\n+import com.hazelcast.core.HazelcastInstance;\n+import com.hazelcast.map.IMap;\n+import com.hazelcast.sql.impl.SqlTestSupport;\n+import com.hazelcast.sql.impl.exec.BlockingExec;\n+import com.hazelcast.sql.impl.exec.FaultyExec;\n+import com.hazelcast.sql.impl.exec.scan.MapScanExec;\n+import com.hazelcast.test.HazelcastParallelClassRunner;\n+import com.hazelcast.test.TestHazelcastInstanceFactory;\n+import com.hazelcast.test.annotation.ParallelJVMTest;\n+import com.hazelcast.test.annotation.QuickTest;\n+import org.junit.After;\n+import org.junit.Test;\n+import org.junit.experimental.categories.Category;\n+import org.junit.runner.RunWith;\n+\n+import javax.annotation.Nonnull;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import static junit.framework.TestCase.assertEquals;\n+import static junit.framework.TestCase.assertTrue;\n+import static junit.framework.TestCase.fail;\n+\n+/**\n+ * Test for different error conditions.\n+ */\n+@RunWith(HazelcastParallelClassRunner.class)\n+@Category({QuickTest.class, ParallelJVMTest.class})\n+public class SqlErrorTest extends SqlTestSupport {", "originalCommit": "4cc30bab01a1a89a2a7be31fb852236b124359d2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODkzMDM4Mw==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r448930383", "bodyText": "Same as in the comment above.", "author": "devozerov", "createdAt": "2020-07-02T11:20:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzY1NDU4Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzY1ODExNw==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r447658117", "bodyText": "Minor: executorPoolSize != DEFAULT_EXECUTOR_POOL_SIZE ?", "author": "petrpleshachkov", "createdAt": "2020-06-30T12:53:20Z", "path": "hazelcast/src/main/java/com/hazelcast/config/SqlConfig.java", "diffHunk": "@@ -0,0 +1,161 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.config;\n+\n+import com.hazelcast.sql.SqlQuery;\n+\n+import static com.hazelcast.internal.util.Preconditions.checkNotNegative;\n+import static com.hazelcast.internal.util.Preconditions.checkPositive;\n+\n+/**\n+ * SQL service configuration.\n+ */\n+public class SqlConfig {\n+    /** Default number of threads responsible for query execution. */\n+    public static final int DEFAULT_EXECUTOR_POOL_SIZE = -1;\n+\n+    /** Default number of threads responsible for network operations processing. */\n+    public static final int DEFAULT_OPERATION_POOL_SIZE = -1;\n+\n+    /** Default timeout in milliseconds that is applied to queries without explicit timeout. */\n+    public static final int DEFAULT_QUERY_TIMEOUT = 0;\n+\n+    /** Number of threads responsible for query execution. */\n+    private int executorPoolSize = DEFAULT_EXECUTOR_POOL_SIZE;\n+\n+    /** Number of threads responsible for network operations processing. */\n+    private int operationPoolSize = DEFAULT_OPERATION_POOL_SIZE;\n+\n+    /** Timeout in milliseconds that is applied to queries without an explicit timeout. */\n+    private long queryTimeoutMillis = DEFAULT_QUERY_TIMEOUT;\n+\n+    /**\n+     * Gets the number of threads responsible for query execution.\n+     *\n+     * @return Number of threads responsible for query execution.\n+     */\n+    public int getExecutorPoolSize() {\n+        return executorPoolSize;\n+    }\n+\n+    /**\n+     * Sets the number of threads responsible for query execution.\n+     * <p>\n+     * The default value {@code -1} sets the pool size equal to the number of CPU cores, and should be good enough\n+     * for the most workloads.\n+     * <p>\n+     * Setting the value to less than the number of CPU cores will limit the degree of parallelism of the SQL subsystem. This\n+     * may be beneficial if you would like to prioritize other CPU-intensive workloads on the same machine.\n+     * <p>\n+     * It is not recommended to set the value of this parameter greater than the number of CPU cores because it may decrease\n+     * the system's overall performance due to excessive context switches.\n+     * <p>\n+     * Defaults to {@code -1}.\n+     *\n+     * @param executorPoolSize Number of threads responsible for query execution.\n+     * @return This instance for chaining.\n+     */\n+    public SqlConfig setExecutorPoolSize(int executorPoolSize) {\n+        if (executorPoolSize < DEFAULT_EXECUTOR_POOL_SIZE || executorPoolSize == 0) {", "originalCommit": "4cc30bab01a1a89a2a7be31fb852236b124359d2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODkzMDgwMA==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r448930800", "bodyText": "This will not work for positive values. We need to exclude all negative values and zero, but leave positive values and -1.", "author": "devozerov", "createdAt": "2020-07-02T11:20:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzY1ODExNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzY1ODQ5OQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r447658499", "bodyText": "The same?", "author": "petrpleshachkov", "createdAt": "2020-06-30T12:53:55Z", "path": "hazelcast/src/main/java/com/hazelcast/config/SqlConfig.java", "diffHunk": "@@ -0,0 +1,161 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.config;\n+\n+import com.hazelcast.sql.SqlQuery;\n+\n+import static com.hazelcast.internal.util.Preconditions.checkNotNegative;\n+import static com.hazelcast.internal.util.Preconditions.checkPositive;\n+\n+/**\n+ * SQL service configuration.\n+ */\n+public class SqlConfig {\n+    /** Default number of threads responsible for query execution. */\n+    public static final int DEFAULT_EXECUTOR_POOL_SIZE = -1;\n+\n+    /** Default number of threads responsible for network operations processing. */\n+    public static final int DEFAULT_OPERATION_POOL_SIZE = -1;\n+\n+    /** Default timeout in milliseconds that is applied to queries without explicit timeout. */\n+    public static final int DEFAULT_QUERY_TIMEOUT = 0;\n+\n+    /** Number of threads responsible for query execution. */\n+    private int executorPoolSize = DEFAULT_EXECUTOR_POOL_SIZE;\n+\n+    /** Number of threads responsible for network operations processing. */\n+    private int operationPoolSize = DEFAULT_OPERATION_POOL_SIZE;\n+\n+    /** Timeout in milliseconds that is applied to queries without an explicit timeout. */\n+    private long queryTimeoutMillis = DEFAULT_QUERY_TIMEOUT;\n+\n+    /**\n+     * Gets the number of threads responsible for query execution.\n+     *\n+     * @return Number of threads responsible for query execution.\n+     */\n+    public int getExecutorPoolSize() {\n+        return executorPoolSize;\n+    }\n+\n+    /**\n+     * Sets the number of threads responsible for query execution.\n+     * <p>\n+     * The default value {@code -1} sets the pool size equal to the number of CPU cores, and should be good enough\n+     * for the most workloads.\n+     * <p>\n+     * Setting the value to less than the number of CPU cores will limit the degree of parallelism of the SQL subsystem. This\n+     * may be beneficial if you would like to prioritize other CPU-intensive workloads on the same machine.\n+     * <p>\n+     * It is not recommended to set the value of this parameter greater than the number of CPU cores because it may decrease\n+     * the system's overall performance due to excessive context switches.\n+     * <p>\n+     * Defaults to {@code -1}.\n+     *\n+     * @param executorPoolSize Number of threads responsible for query execution.\n+     * @return This instance for chaining.\n+     */\n+    public SqlConfig setExecutorPoolSize(int executorPoolSize) {\n+        if (executorPoolSize < DEFAULT_EXECUTOR_POOL_SIZE || executorPoolSize == 0) {\n+            checkPositive(executorPoolSize, \"Executor pool size should be positive or -1: \" + executorPoolSize);\n+        }\n+\n+        this.executorPoolSize = executorPoolSize;\n+\n+        return this;\n+    }\n+\n+    /**\n+     * Gets the number of threads responsible for network operations processing.\n+     *\n+     * @return Number of threads responsible for network operations processing.\n+     */\n+    public int getOperationPoolSize() {\n+        return operationPoolSize;\n+    }\n+\n+    /**\n+     * Sets the number of threads responsible for network operations processing.\n+     * <p>\n+     * When Hazelcast members execute a query, they send commands to each other over the network to coordinate the execution.\n+     * This includes requests to start or stop query execution, or a request to process a batch of data. These commands are\n+     * processed in a separate operation thread pool, to avoid frequent interruption of running query fragments.\n+     * <p>\n+     * The default value {@code -1} sets the pool size equal to the number of CPU cores, and should be good enough\n+     * for the most workloads.\n+     * <p>\n+     * Setting the value to less than the number of CPU cores may improve the overall performance on machines\n+     * with large CPU count, because it will decrease the number of context switches.\n+     * <p>\n+     * It is not recommended to set the value of this parameter greater than the number of CPU cores because it\n+     * may decrease the system's overall performance due to excessive context switches.\n+     * <p>\n+     * Defaults to {@code -1}.\n+     *\n+     * @param operationPoolSize Number of threads responsible for network operations processing.\n+     * @return This instance for chaining.\n+     */\n+    public SqlConfig setOperationPoolSize(int operationPoolSize) {\n+        if (operationPoolSize < DEFAULT_OPERATION_POOL_SIZE || operationPoolSize == 0) {", "originalCommit": "4cc30bab01a1a89a2a7be31fb852236b124359d2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODkzMDg4OQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r448930889", "bodyText": "Explained in the comment above.", "author": "devozerov", "createdAt": "2020-07-02T11:21:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzY1ODQ5OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzY2NDg1MA==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r447664850", "bodyText": "AFAIU, this is a public class, shall we make it final ?", "author": "petrpleshachkov", "createdAt": "2020-06-30T13:04:07Z", "path": "hazelcast/src/main/java/com/hazelcast/sql/SqlQuery.java", "diffHunk": "@@ -0,0 +1,289 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.sql;\n+\n+import com.hazelcast.config.SqlConfig;\n+import com.hazelcast.internal.util.Preconditions;\n+\n+import javax.annotation.Nonnull;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Objects;\n+\n+/**\n+ * Definition of a SQL query.\n+ * <p>\n+ * This object is mutable. Properties are read once before the execution is started.\n+ * Changes to properties do not affect the behavior of already running queries.\n+ */\n+public class SqlQuery {", "originalCommit": "4cc30bab01a1a89a2a7be31fb852236b124359d2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODkzMTA5Mg==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r448931092", "bodyText": "Agree. Marked as final.", "author": "devozerov", "createdAt": "2020-07-02T11:21:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzY2NDg1MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzY2NjEwNQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r447666105", "bodyText": "Not sure that I understand which page we are talking about? Maybe use \"portion\" instead?", "author": "petrpleshachkov", "createdAt": "2020-06-30T13:06:00Z", "path": "hazelcast/src/main/java/com/hazelcast/sql/SqlQuery.java", "diffHunk": "@@ -0,0 +1,289 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.sql;\n+\n+import com.hazelcast.config.SqlConfig;\n+import com.hazelcast.internal.util.Preconditions;\n+\n+import javax.annotation.Nonnull;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Objects;\n+\n+/**\n+ * Definition of a SQL query.\n+ * <p>\n+ * This object is mutable. Properties are read once before the execution is started.\n+ * Changes to properties do not affect the behavior of already running queries.\n+ */\n+public class SqlQuery {\n+    /** Value for the timeout that is not set. */\n+    public static final long TIMEOUT_NOT_SET = -1;\n+\n+    /** Value for the timeout that is disabled. */\n+    public static final long TIMEOUT_DISABLED = 0;\n+\n+    /** Default timeout. */\n+    public static final long DEFAULT_TIMEOUT = TIMEOUT_NOT_SET;\n+\n+    /** Default page size. */", "originalCommit": "4cc30bab01a1a89a2a7be31fb852236b124359d2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODkzMDE3NQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r448930175", "bodyText": "This is about \"cursorBufferSize\". Fixed.", "author": "devozerov", "createdAt": "2020-07-02T11:19:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzY2NjEwNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzY2ODY2NA==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r447668664", "bodyText": "Minor: \"Clears query parameters\" to be consistent with the rest of the JavaDoc", "author": "petrpleshachkov", "createdAt": "2020-06-30T13:09:55Z", "path": "hazelcast/src/main/java/com/hazelcast/sql/SqlQuery.java", "diffHunk": "@@ -0,0 +1,289 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.sql;\n+\n+import com.hazelcast.config.SqlConfig;\n+import com.hazelcast.internal.util.Preconditions;\n+\n+import javax.annotation.Nonnull;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Objects;\n+\n+/**\n+ * Definition of a SQL query.\n+ * <p>\n+ * This object is mutable. Properties are read once before the execution is started.\n+ * Changes to properties do not affect the behavior of already running queries.\n+ */\n+public class SqlQuery {\n+    /** Value for the timeout that is not set. */\n+    public static final long TIMEOUT_NOT_SET = -1;\n+\n+    /** Value for the timeout that is disabled. */\n+    public static final long TIMEOUT_DISABLED = 0;\n+\n+    /** Default timeout. */\n+    public static final long DEFAULT_TIMEOUT = TIMEOUT_NOT_SET;\n+\n+    /** Default page size. */\n+    public static final int DEFAULT_CURSOR_BUFFER_SIZE = 4096;\n+\n+    private String sql;\n+    private List<Object> parameters = new ArrayList<>();\n+    private long timeout = DEFAULT_TIMEOUT;\n+    private int cursorBufferSize = DEFAULT_CURSOR_BUFFER_SIZE;\n+\n+    public SqlQuery(@Nonnull String sql) {\n+        setSql(sql);\n+    }\n+\n+    /**\n+     * Copying constructor.\n+     */\n+    private SqlQuery(String sql, List<Object> parameters, long timeout, int cursorBufferSize) {\n+        this.sql = sql;\n+        this.parameters = parameters;\n+        this.timeout = timeout;\n+        this.cursorBufferSize = cursorBufferSize;\n+    }\n+\n+    /**\n+     * Gets the SQL query to be executed.\n+     *\n+     * @return SQL query\n+     */\n+    @Nonnull\n+    public String getSql() {\n+        return sql;\n+    }\n+\n+    /**\n+     * Sets the SQL query to be executed.\n+     * <p>\n+     * The SQL query cannot be null or empty.\n+     *\n+     * @param sql SQL query\n+     * @return this instance for chaining\n+     * @throws NullPointerException if passed SQL query is null\n+     * @throws IllegalArgumentException if passed SQL query is empty\n+     */\n+    @Nonnull\n+    public SqlQuery setSql(@Nonnull String sql) {\n+        Preconditions.checkNotNull(sql, \"SQL cannot be null\");\n+\n+        if (sql.length() == 0) {\n+            throw new IllegalArgumentException(\"SQL cannot be empty\");\n+        }\n+\n+        this.sql = sql;\n+\n+        return this;\n+    }\n+\n+    /**\n+     * Gets the query parameters.\n+     *\n+     * @return query parameters\n+     */\n+    @Nonnull\n+    public List<Object> getParameters() {\n+        return parameters;\n+    }\n+\n+    /**\n+     * Sets the query parameters.\n+     * <p>\n+     * You may define parameter placeholders in the query with the {@code \"?\"} character. For every placeholder, a parameter\n+     * value must be provided.\n+     * <p>\n+     * When the method is called, the content of the parameters list is copied. Subsequent changes to the original list don't\n+     * change the query parameters.\n+     *\n+     * @param parameters query parameters\n+     * @return this instance for chaining\n+     *\n+     * @see #addParameter(Object)\n+     * @see #clearParameters()\n+     */\n+    @Nonnull\n+    public SqlQuery setParameters(List<Object> parameters) {\n+        if (parameters == null || parameters.isEmpty()) {\n+            this.parameters = new ArrayList<>();\n+        } else {\n+            this.parameters = new ArrayList<>(parameters);\n+        }\n+\n+        return this;\n+    }\n+\n+    /**\n+     * Adds a single parameter to the end of the parameters list.\n+     *\n+     * @param parameter parameter\n+     * @return this instance for chaining\n+     *\n+     * @see #setParameters(List)\n+     * @see #clearParameters()\n+     */\n+    @Nonnull\n+    public SqlQuery addParameter(Object parameter) {\n+        parameters.add(parameter);\n+\n+        return this;\n+    }\n+\n+    /**\n+     * Clear query parameters.", "originalCommit": "4cc30bab01a1a89a2a7be31fb852236b124359d2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODkyOTkyOQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r448929929", "bodyText": "Fixed.", "author": "devozerov", "createdAt": "2020-07-02T11:19:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzY2ODY2NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzY3MjYyOQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r447672629", "bodyText": "Typo: ff -> if", "author": "petrpleshachkov", "createdAt": "2020-06-30T13:15:48Z", "path": "hazelcast/src/main/java/com/hazelcast/sql/SqlResult.java", "diffHunk": "@@ -0,0 +1,72 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.sql;\n+\n+import javax.annotation.Nonnull;\n+import java.util.Iterator;\n+\n+/**\n+ * SQL query result. Represents a stream of rows.\n+ * <p>\n+ * Use {@link #iterator()} to iterate over the rows. The iterator can be requested only once.\n+ * <p>\n+ * Use {@link #close()} to release the resources associated with the result.\n+ * <p>\n+ * Typical usage pattern:\n+ * <pre>\n+ * try (SqlResult result = hazelcastInstance.getSql().query(\"SELECT ...\")) {\n+ *     for (SqlRow row : result) {\n+ *         // Process the row.\n+ *     }\n+ * }\n+ * </pre>\n+ *\n+ * @see #iterator()\n+ * @see #close()\n+ */\n+public interface SqlResult extends Iterable<SqlRow>, AutoCloseable {\n+    /**\n+     * Gets row metadata.\n+     *\n+     * @return row metadata\n+     */\n+    @Nonnull\n+    SqlRowMetadata getRowMetadata();\n+\n+    /**\n+     * Returns the iterator over the result rows.\n+     * <p>\n+     * The iterator may be requested only once.\n+     *\n+     * @return iterator\n+     * @throws IllegalStateException ff the method is invoked more than once", "originalCommit": "2326f53ae2ba7769a99e07d76acc32b0558bab24", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODkyOTQ4OQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r448929489", "bodyText": "Fixed.", "author": "devozerov", "createdAt": "2020-07-02T11:18:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzY3MjYyOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzY3NjMxNQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r447676315", "bodyText": "Minor Get -> Gets", "author": "petrpleshachkov", "createdAt": "2020-06-30T13:21:14Z", "path": "hazelcast/src/main/java/com/hazelcast/sql/SqlRowMetadata.java", "diffHunk": "@@ -0,0 +1,120 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.sql;\n+\n+import com.hazelcast.internal.util.Preconditions;\n+import com.hazelcast.spi.annotation.PrivateApi;\n+\n+import javax.annotation.Nonnull;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.stream.Collectors;\n+\n+/**\n+ * SQL row metadata.\n+ */\n+public final class SqlRowMetadata {\n+    /** Constant indicating that the column is not found. */\n+    public static final int COLUMN_NOT_FOUND = -1;\n+\n+    private final List<SqlColumnMetadata> columns;\n+    private final Map<String, Integer> nameToIndex;\n+\n+    @PrivateApi\n+    @SuppressWarnings(\"ConstantConditions\")\n+    public SqlRowMetadata(@Nonnull List<SqlColumnMetadata> columns) {\n+        assert columns != null && !columns.isEmpty();\n+\n+        this.columns = new ArrayList<>(columns);\n+\n+        nameToIndex = new HashMap<>(columns.size());\n+\n+        for (int i = 0; i < columns.size(); i++) {\n+            nameToIndex.put(columns.get(i).getName(), i);\n+        }\n+    }\n+\n+    /**\n+     * Gets the number of columns in the row.\n+     *\n+     * @return the number of columns in the row\n+     */\n+    public int getColumnCount() {\n+        return columns.size();\n+    }\n+\n+    /**\n+     * Get column metadata.", "originalCommit": "2326f53ae2ba7769a99e07d76acc32b0558bab24", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODkyOTY4OA==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r448929688", "bodyText": "Fixed", "author": "devozerov", "createdAt": "2020-07-02T11:18:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzY3NjMxNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzY4NTc5Nw==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r447685797", "bodyText": "What if a user constantly not closing the SqlResult? Will this cause OOM on the member eventually?", "author": "petrpleshachkov", "createdAt": "2020-06-30T13:33:46Z", "path": "hazelcast/src/main/java/com/hazelcast/sql/SqlService.java", "diffHunk": "@@ -0,0 +1,147 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.sql;\n+\n+import com.hazelcast.nio.serialization.Portable;\n+import com.hazelcast.nio.serialization.PortableWriter;\n+import com.hazelcast.spi.annotation.Beta;\n+\n+import javax.annotation.Nonnull;\n+\n+/**\n+ * Service to execute distributed SQL queries.\n+ * <h1>Overview</h1>\n+ * Hazelcast is able to execute distributed SQL queries over the following entities:\n+ * <ul>\n+ *     <li>IMap\n+ * </ul>\n+ * When a query is submitted to a member, it is parsed and optimized by the {@code hazelcast-sql} module, that is based on\n+ * <a href=\"https://calcite.apache.org\">Apache Calcite</a>. The {@code hazelcast-sql} must be in the classpath, otherwise\n+ * an exception will be thrown.\n+ * <p>\n+ * During optimization a query is converted into a directed acyclic graph (DAG) that is sent to cluster members for execution.\n+ * Query results are sent back to the originating member asynchronously and returned to the user via {@link SqlResult}.\n+ *\n+ * <h1>Querying an IMap</h1>\n+ * Every IMap instance is exposed as a table with the same name in the {@code partitioned} schema. The {@code partitioned}\n+ * schema is included into a default search path, therefore an IMap could be referenced in an SQL query with or without the\n+ * schema name.\n+ * <h2>Column resolution</h2>\n+ * Every table backed by an IMap has a set of columns that are resolved automatically. Column resolution uses IMap entries\n+ * located on the member that initiates the query. The engine extracts columns from a key and a value and then merges them\n+ * into a single column set. In case the key and the value have columns with the same name, the key takes precedence.\n+ * <p>\n+ * Columns are extracted from objects as follows:\n+ * <ul>\n+ *     <li>For non-Portable objects, public getters and fields are used to populate the column list. For getters, the first\n+ *     letter is converted to lower case. A getter takes precedence over a field in case of naming conflict\n+ *     <li>For {@link Portable} objects, field names used in the {@link Portable#writePortable(PortableWriter)} method\n+ *     are used to populate the column list\n+ * </ul>\n+ * The whole key and value objects could be accessed through a special fields {@code __key} and {@code this}, respectively. If\n+ * key (value) object has fields, then the whole key (value) field is exposed as a normal field. Otherwise the field is hidden.\n+ * Hidden fields can be accessed directly, but are not returned by {@code SELECT * FROM ...} queries.\n+ * <p>\n+ * If the member that initiates a query doesn't have local entries for the given IMap, the query fails.\n+ * <p>\n+ * Consider the following key/value model:\n+ * <pre>\n+ *     class PersonKey {\n+ *         private long personId;\n+ *         private long deptId;\n+ *\n+ *         public long getPersonId() { ... }\n+ *         public long getDepartmentId() { ... }\n+ *     }\n+ *\n+ *     class Person {\n+ *         public String name;\n+ *     }\n+ * </pre>\n+ * This model will be resolved to the following table columns:\n+ * <ul>\n+ *     <li>personId BIGINT\n+ *     <li>departmentId BIGINT\n+ *     <li>name VARCHAR\n+ *     <li>__key OBJECT (hidden)\n+ *     <li>this OBJECT (hidden)\n+ * </ul>\n+ * <h2>Consistency</h2>\n+ * Results returned from IMap query are weakly consistent:\n+ * <ul>\n+ *     <li>If an entry was not updated during iteration, it is guaranteed to be returned exactly once\n+ *     <li>If an entry was modified during iteration, it might be returned zero, one or several times\n+ * </ul>\n+ * <h1>Usage</h1>\n+ * When a query is executed, an {@link SqlResult} is returned. You may get row iterator from the result. The result must be closed", "originalCommit": "2326f53ae2ba7769a99e07d76acc32b0558bab24", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODkyOTIxNg==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r448929216", "bodyText": "Yes, it will cause OOME on many members.", "author": "devozerov", "createdAt": "2020-07-02T11:17:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzY4NTc5Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzY4Njg1OQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r447686859", "bodyText": "I'd add a few words to explain - parameters for what?", "author": "petrpleshachkov", "createdAt": "2020-06-30T13:35:14Z", "path": "hazelcast/src/main/java/com/hazelcast/sql/SqlService.java", "diffHunk": "@@ -0,0 +1,147 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.sql;\n+\n+import com.hazelcast.nio.serialization.Portable;\n+import com.hazelcast.nio.serialization.PortableWriter;\n+import com.hazelcast.spi.annotation.Beta;\n+\n+import javax.annotation.Nonnull;\n+\n+/**\n+ * Service to execute distributed SQL queries.\n+ * <h1>Overview</h1>\n+ * Hazelcast is able to execute distributed SQL queries over the following entities:\n+ * <ul>\n+ *     <li>IMap\n+ * </ul>\n+ * When a query is submitted to a member, it is parsed and optimized by the {@code hazelcast-sql} module, that is based on\n+ * <a href=\"https://calcite.apache.org\">Apache Calcite</a>. The {@code hazelcast-sql} must be in the classpath, otherwise\n+ * an exception will be thrown.\n+ * <p>\n+ * During optimization a query is converted into a directed acyclic graph (DAG) that is sent to cluster members for execution.\n+ * Query results are sent back to the originating member asynchronously and returned to the user via {@link SqlResult}.\n+ *\n+ * <h1>Querying an IMap</h1>\n+ * Every IMap instance is exposed as a table with the same name in the {@code partitioned} schema. The {@code partitioned}\n+ * schema is included into a default search path, therefore an IMap could be referenced in an SQL query with or without the\n+ * schema name.\n+ * <h2>Column resolution</h2>\n+ * Every table backed by an IMap has a set of columns that are resolved automatically. Column resolution uses IMap entries\n+ * located on the member that initiates the query. The engine extracts columns from a key and a value and then merges them\n+ * into a single column set. In case the key and the value have columns with the same name, the key takes precedence.\n+ * <p>\n+ * Columns are extracted from objects as follows:\n+ * <ul>\n+ *     <li>For non-Portable objects, public getters and fields are used to populate the column list. For getters, the first\n+ *     letter is converted to lower case. A getter takes precedence over a field in case of naming conflict\n+ *     <li>For {@link Portable} objects, field names used in the {@link Portable#writePortable(PortableWriter)} method\n+ *     are used to populate the column list\n+ * </ul>\n+ * The whole key and value objects could be accessed through a special fields {@code __key} and {@code this}, respectively. If\n+ * key (value) object has fields, then the whole key (value) field is exposed as a normal field. Otherwise the field is hidden.\n+ * Hidden fields can be accessed directly, but are not returned by {@code SELECT * FROM ...} queries.\n+ * <p>\n+ * If the member that initiates a query doesn't have local entries for the given IMap, the query fails.\n+ * <p>\n+ * Consider the following key/value model:\n+ * <pre>\n+ *     class PersonKey {\n+ *         private long personId;\n+ *         private long deptId;\n+ *\n+ *         public long getPersonId() { ... }\n+ *         public long getDepartmentId() { ... }\n+ *     }\n+ *\n+ *     class Person {\n+ *         public String name;\n+ *     }\n+ * </pre>\n+ * This model will be resolved to the following table columns:\n+ * <ul>\n+ *     <li>personId BIGINT\n+ *     <li>departmentId BIGINT\n+ *     <li>name VARCHAR\n+ *     <li>__key OBJECT (hidden)\n+ *     <li>this OBJECT (hidden)\n+ * </ul>\n+ * <h2>Consistency</h2>\n+ * Results returned from IMap query are weakly consistent:\n+ * <ul>\n+ *     <li>If an entry was not updated during iteration, it is guaranteed to be returned exactly once\n+ *     <li>If an entry was modified during iteration, it might be returned zero, one or several times\n+ * </ul>\n+ * <h1>Usage</h1>\n+ * When a query is executed, an {@link SqlResult} is returned. You may get row iterator from the result. The result must be closed\n+ * at the end. The code snippet below demonstrates a typical usage pattern:\n+ * <pre>\n+ *     HazelcastInstance instance = ...;\n+ *\n+ *     try (SqlResult result = instance.sql().query(\"SELECT * FROM person\")) {\n+ *         for (SqlRow row : result) {\n+ *             long personId = row.getObject(\"personId\");\n+ *             String name = row.getObject(\"name\");\n+ *             ...\n+ *         }\n+ *     }\n+ * </pre>\n+ */\n+@Beta\n+public interface SqlService {\n+    /**\n+     * Convenient method to execute a distributed query with the given parameters.\n+     * <p>\n+     * Converts passed SQL string and parameters into an {@link SqlQuery} object and invokes {@link #query(SqlQuery)}.\n+     *\n+     * @param sql SQL string\n+     * @param params parameters", "originalCommit": "2326f53ae2ba7769a99e07d76acc32b0558bab24", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODkzMTY0NQ==", "url": "https://github.com/hazelcast/hazelcast/pull/17130#discussion_r448931645", "bodyText": "Added explanation.", "author": "devozerov", "createdAt": "2020-07-02T11:22:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzY4Njg1OQ=="}], "type": "inlineReview"}, {"oid": "c6971390c0e7bf64ae0678dab6ecbef39702fac6", "url": "https://github.com/hazelcast/hazelcast/commit/c6971390c0e7bf64ae0678dab6ecbef39702fac6", "message": "Minors.", "committedDate": "2020-07-02T11:28:22Z", "type": "commit"}, {"oid": "bf5563b6292591c4240843d275e543219b909201", "url": "https://github.com/hazelcast/hazelcast/commit/bf5563b6292591c4240843d275e543219b909201", "message": "Added defaults.", "committedDate": "2020-07-03T08:48:11Z", "type": "commit"}, {"oid": "beb9c33c56417a4b3670673959951d5d12989035", "url": "https://github.com/hazelcast/hazelcast/commit/beb9c33c56417a4b3670673959951d5d12989035", "message": "Remove @Nullable from SqlRow.getObject.", "committedDate": "2020-07-03T11:25:59Z", "type": "commit"}]}