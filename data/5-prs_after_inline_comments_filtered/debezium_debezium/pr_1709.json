{"pr_number": 1709, "pr_title": "DBZ-137 contribution to the core, Oracle related", "pr_createdAt": "2020-07-22T18:38:03Z", "pr_url": "https://github.com/debezium/debezium/pull/1709", "timeline": [{"oid": "12fcb7e3fe4d801112235d9cc2bcaf6339a90a91", "url": "https://github.com/debezium/debezium/commit/12fcb7e3fe4d801112235d9cc2bcaf6339a90a91", "message": "DBZ-137 contribution to the core, Oracle related", "committedDate": "2020-09-10T18:29:26Z", "type": "commit"}, {"oid": "e87cee130fe2e632ab511ed0aaacb5c064643ee2", "url": "https://github.com/debezium/debezium/commit/e87cee130fe2e632ab511ed0aaacb5c064643ee2", "message": "DBZ-137 Fix rebase", "committedDate": "2020-09-10T18:29:26Z", "type": "commit"}, {"oid": "ce62c7417db2c240b382f7301c294139e79b31a1", "url": "https://github.com/debezium/debezium/commit/ce62c7417db2c240b382f7301c294139e79b31a1", "message": "DBZ-137 Introduce streaming.fetch.size for SQL Server.", "committedDate": "2020-09-10T18:29:27Z", "type": "commit"}, {"oid": "9017d8b28304c8f211a5c44ba238706c071db5e0", "url": "https://github.com/debezium/debezium/commit/9017d8b28304c8f211a5c44ba238706c071db5e0", "message": "DBZ-137 Remove snapshot.skip.locks for SQL Server", "committedDate": "2020-09-10T18:29:27Z", "type": "commit"}, {"oid": "d59ebacc51e9b03e15dfdfe43ffa56875b70c0d7", "url": "https://github.com/debezium/debezium/commit/d59ebacc51e9b03e15dfdfe43ffa56875b70c0d7", "message": "DBZ-137 Removed POM property version.oracle.driver", "committedDate": "2020-09-10T18:29:27Z", "type": "commit"}, {"oid": "faa083d3b1985fe574950f1796e79d44c159710c", "url": "https://github.com/debezium/debezium/commit/faa083d3b1985fe574950f1796e79d44c159710c", "message": "DBZ-137 Use Duration for CONNECTION_TIMEOUT_MS", "committedDate": "2020-09-10T18:29:27Z", "type": "commit"}, {"oid": "5f61d32e19324f4ee38ac8efbbd0c6583cc3df0e", "url": "https://github.com/debezium/debezium/commit/5f61d32e19324f4ee38ac8efbbd0c6583cc3df0e", "message": "DBZ-137 Fix compilation problems", "committedDate": "2020-09-10T18:29:27Z", "type": "commit"}, {"oid": "5ea5de8a264abe805af112787a984deba297b6f4", "url": "https://github.com/debezium/debezium/commit/5ea5de8a264abe805af112787a984deba297b6f4", "message": "DBZ-137 Fix SQL Server test failures", "committedDate": "2020-09-10T18:29:27Z", "type": "commit"}, {"oid": "ff90eb0f84233135add6bf5fb33cef5e90aa7b0e", "url": "https://github.com/debezium/debezium/commit/ff90eb0f84233135add6bf5fb33cef5e90aa7b0e", "message": "DBZ-137 Reimagine stream.fetch.size as query.fetch.size", "committedDate": "2020-09-10T18:29:27Z", "type": "commit"}, {"oid": "38436f5dc35465f002f95206ede6d74674955ce9", "url": "https://github.com/debezium/debezium/commit/38436f5dc35465f002f95206ede6d74674955ce9", "message": "DBZ-137 Suggested changes", "committedDate": "2020-09-11T20:03:36Z", "type": "commit"}, {"oid": "30479d0d497543e96164e8915edd30ff8ef81e14", "url": "https://github.com/debezium/debezium/commit/30479d0d497543e96164e8915edd30ff8ef81e14", "message": "DBZ-137 DBZ-2283 Exclude filtered columns in SQL Server snapshot", "committedDate": "2020-09-11T20:03:40Z", "type": "commit"}, {"oid": "929349ea46d44e4d04549288b5625883982ae695", "url": "https://github.com/debezium/debezium/commit/929349ea46d44e4d04549288b5625883982ae695", "message": "DBZ-137 Documentation update", "committedDate": "2020-09-11T20:03:40Z", "type": "commit"}, {"oid": "929349ea46d44e4d04549288b5625883982ae695", "url": "https://github.com/debezium/debezium/commit/929349ea46d44e4d04549288b5625883982ae695", "message": "DBZ-137 Documentation update", "committedDate": "2020-09-11T20:03:40Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzc2NDc3OQ==", "url": "https://github.com/debezium/debezium/pull/1709#discussion_r487764779", "bodyText": "I'm still struggling with this; where is this used? Only in your custom connection factory, @mallikankati?", "author": "gunnarmorling", "createdAt": "2020-09-14T09:10:55Z", "path": "debezium-connector-sqlserver/src/main/java/io/debezium/connector/sqlserver/SqlServerConnectorConfig.java", "diffHunk": "@@ -391,6 +401,10 @@ public String getDatabaseName() {\n         return databaseName;\n     }\n \n+    public String getInstanceName() {", "originalCommit": "929349ea46d44e4d04549288b5625883982ae695", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzc4ODI5MA==", "url": "https://github.com/debezium/debezium/pull/1709#discussion_r487788290", "bodyText": "Ok, I think it's a bit unfortunate that this was done only for SQL Server. I've logged https://issues.redhat.com/browse/DBZ-2525 for pulling this up so that all relational connectors benefit from this.", "author": "gunnarmorling", "createdAt": "2020-09-14T09:50:41Z", "path": "debezium-connector-sqlserver/src/main/java/io/debezium/connector/sqlserver/SqlServerSnapshotChangeEventSource.java", "diffHunk": "@@ -218,10 +221,45 @@ protected void complete(SnapshotContext snapshotContext) {\n      * @return a valid query string\n      */\n     @Override\n-    protected Optional<String> getSnapshotSelect(SnapshotContext snapshotContext, TableId tableId) {\n+    protected Optional<String> getSnapshotSelect(RelationalSnapshotContext snapshotContext, TableId tableId) {\n+        String modifiedColumns = checkExcludedColumns(tableId);", "originalCommit": "929349ea46d44e4d04549288b5625883982ae695", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzc5ODA4Mw==", "url": "https://github.com/debezium/debezium/pull/1709#discussion_r487798083", "bodyText": "I don't understand how this method is supposed to work. The excluded columns are not removed from the statement anywhere. Also note that the exclusion expression doesn't necessarily contain the table name (e.g. could be .*mycolumn). This entire method seems flawed to me.\nThat said, it doesn't seem to to harm either, so I'll for now simply move https://issues.redhat.com/browse/DBZ-2283 onwards to the next iteration.", "author": "gunnarmorling", "createdAt": "2020-09-14T10:06:56Z", "path": "debezium-connector-sqlserver/src/main/java/io/debezium/connector/sqlserver/SqlServerSnapshotChangeEventSource.java", "diffHunk": "@@ -218,10 +221,45 @@ protected void complete(SnapshotContext snapshotContext) {\n      * @return a valid query string\n      */\n     @Override\n-    protected Optional<String> getSnapshotSelect(SnapshotContext snapshotContext, TableId tableId) {\n+    protected Optional<String> getSnapshotSelect(RelationalSnapshotContext snapshotContext, TableId tableId) {\n+        String modifiedColumns = checkExcludedColumns(tableId);\n+        if (modifiedColumns != null) {\n+            return Optional.of(String.format(\"SELECT %s FROM [%s].[%s]\", modifiedColumns, tableId.schema(), tableId.table()));\n+        }\n         return Optional.of(String.format(\"SELECT * FROM [%s].[%s]\", tableId.schema(), tableId.table()));\n     }\n \n+    @Override\n+    protected String enhanceOverriddenSelect(RelationalSnapshotContext snapshotContext, String overriddenSelect, TableId tableId) {\n+        String modifiedColumns = checkExcludedColumns(tableId);\n+        if (modifiedColumns != null) {\n+            overriddenSelect = overriddenSelect.replaceAll(\"\\\\*\", modifiedColumns);\n+        }\n+        return overriddenSelect;\n+    }\n+\n+    private String checkExcludedColumns(TableId tableId) {\n+        String modifiedColumns = null;\n+        String excludedColumnStr = connectorConfig.getTableFilters().getExcludeColumns();", "originalCommit": "929349ea46d44e4d04549288b5625883982ae695", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "53b88e6f47189a69d385aac42ced4455ce573fc7", "url": "https://github.com/debezium/debezium/commit/53b88e6f47189a69d385aac42ced4455ce573fc7", "message": "DBZ-137 Docs update", "committedDate": "2020-09-14T10:28:50Z", "type": "commit"}, {"oid": "53b88e6f47189a69d385aac42ced4455ce573fc7", "url": "https://github.com/debezium/debezium/commit/53b88e6f47189a69d385aac42ced4455ce573fc7", "message": "DBZ-137 Docs update", "committedDate": "2020-09-14T10:28:50Z", "type": "forcePushed"}]}