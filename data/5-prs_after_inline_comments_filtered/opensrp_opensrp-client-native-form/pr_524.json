{"pr_number": 524, "pr_title": "Add altitude accuracy gps factory", "pr_createdAt": "2020-11-30T13:30:05Z", "pr_url": "https://github.com/opensrp/opensrp-client-native-form/pull/524", "timeline": [{"oid": "a6ced6a126d14501a0358b39ffd95934c892c50d", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/a6ced6a126d14501a0358b39ffd95934c892c50d", "message": "add addtional properties to value", "committedDate": "2020-11-30T07:29:14Z", "type": "commit"}, {"oid": "cd577714472793ac9a3e8187981d52a4ff02b245", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/cd577714472793ac9a3e8187981d52a4ff02b245", "message": "Merge branch 'optimize-native-forms' of github.com:OpenSRP/opensrp-client-native-form into add-altitude-accuracy-gps-factory", "committedDate": "2020-11-30T13:24:29Z", "type": "commit"}, {"oid": "dc15e9b3c3d44099d630a5e649fccd206e7c1944", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/dc15e9b3c3d44099d630a5e649fccd206e7c1944", "message": "revert/update fix with utils", "committedDate": "2020-11-30T14:05:55Z", "type": "commit"}, {"oid": "a9c4c89753e50aa7ad263b4f0c8261ad751e3e57", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/a9c4c89753e50aa7ad263b4f0c8261ad751e3e57", "message": "Merge branch 'optimize-native-forms' of github.com:OpenSRP/opensrp-client-native-form into add-altitude-accuracy-gps-factory", "committedDate": "2020-11-30T14:07:43Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjY2NDg0NA==", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/524#discussion_r532664844", "bodyText": "This is a public method. We should ideally maintain it's signature.", "author": "vincent-karuri", "createdAt": "2020-11-30T15:06:24Z", "path": "android-json-form-wizard/src/main/java/com/vijay/jsonwizard/widgets/GpsFactory.java", "diffHunk": "@@ -66,14 +66,15 @@ public static ValidationStatus validate(JsonFormFragmentView formFragmentView,\n \n     public static String constructString(Location location) {\n         if (location != null) {\n-            return constructString(String.valueOf(location.getLatitude()), String.valueOf(location.getLongitude()));\n+            return constructString(String.valueOf(location.getLatitude()), String.valueOf(location.getLongitude()),\n+                    String.valueOf(location.getAltitude()), String.valueOf(location.getAccuracy()));\n         }\n \n         return null;\n     }\n \n-    public static String constructString(String latitude, String longitude) {\n-        return latitude + \" \" + longitude;\n+    public static String constructString(String latitude, String longitude, String altitude, String accuracy) {", "originalCommit": "cd577714472793ac9a3e8187981d52a4ff02b245", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjY2NTg1OQ==", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/524#discussion_r532665859", "bodyText": "Consider creating a method that takes a collection of properties and iterates over them calling String.valueOf  (since it's repeated multiple times here) while concatenating them.", "author": "vincent-karuri", "createdAt": "2020-11-30T15:07:40Z", "path": "android-json-form-wizard/src/main/java/com/vijay/jsonwizard/widgets/GpsFactory.java", "diffHunk": "@@ -66,14 +66,15 @@ public static ValidationStatus validate(JsonFormFragmentView formFragmentView,\n \n     public static String constructString(Location location) {\n         if (location != null) {\n-            return constructString(String.valueOf(location.getLatitude()), String.valueOf(location.getLongitude()));\n+            return constructString(String.valueOf(location.getLatitude()), String.valueOf(location.getLongitude()),\n+                    String.valueOf(location.getAltitude()), String.valueOf(location.getAccuracy()));", "originalCommit": "cd577714472793ac9a3e8187981d52a4ff02b245", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjY2NzkyMw==", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/524#discussion_r532667923", "bodyText": "Like the previous pr we can use an array to remove the need for the length checks.", "author": "vincent-karuri", "createdAt": "2020-11-30T15:10:26Z", "path": "android-json-form-wizard/src/main/java/com/vijay/jsonwizard/widgets/GpsFactory.java", "diffHunk": "@@ -236,6 +237,10 @@ public void attachLayout(Context context, @NonNull JSONObject jsonObject, @NonNu\n             if (coordinateElements.length > 1) {\n                 latitude = coordinateElements[0];\n                 longitude = coordinateElements[1];\n+                if (coordinateElements.length >= 4) {\n+                    altitude = coordinateElements[2];\n+                    accuracy = coordinateElements[3];\n+                }", "originalCommit": "cd577714472793ac9a3e8187981d52a4ff02b245", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f7fe91fe48957b9a9f9c3826d7c46879d8b31c3a", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/f7fe91fe48957b9a9f9c3826d7c46879d8b31c3a", "message": "code cleanup", "committedDate": "2020-12-01T06:46:16Z", "type": "commit"}, {"oid": "005c7ec654d140536d62bdc94db6d0a0a5024a55", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/005c7ec654d140536d62bdc94db6d0a0a5024a55", "message": "update test", "committedDate": "2020-12-01T06:54:38Z", "type": "commit"}, {"oid": "005c7ec654d140536d62bdc94db6d0a0a5024a55", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/005c7ec654d140536d62bdc94db6d0a0a5024a55", "message": "update test", "committedDate": "2020-12-01T06:54:38Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzIzNjU1MQ==", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/524#discussion_r533236551", "bodyText": "Is there a reason we don't have the text set to empty by default? We end up repeating the same logic here https://github.com/OpenSRP/opensrp-client-native-form/pull/524/files#diff-607b2f74eb9df7c9ec407f98d71dc161ce12967b037b971ddcc4564b8ff5fefeR244 right?", "author": "vincent-karuri", "createdAt": "2020-12-01T09:43:00Z", "path": "android-json-form-wizard/src/main/java/com/vijay/jsonwizard/widgets/GpsFactory.java", "diffHunk": "@@ -224,27 +223,44 @@ protected void addViewTags(Button recordButton, WidgetArgs widgetArgs, WidgetMet\n         recordButton.setTag(R.id.extraPopup, widgetArgs.isPopup());\n     }\n \n-    public void attachLayout(Context context, @NonNull JSONObject jsonObject, @NonNull View dataView, @NonNull TextView latitudeTv, @NonNull TextView longitudeTv, @NonNull TextView altitudeTv, @NonNull TextView accuracyTv) {\n-        String latitude = \"\";\n-        String longitude = \"\";\n-        String accuracy = \"\";\n-        String altitude = \"\";\n+    public void attachLayout(Context context, @NonNull JSONObject jsonObject, @NonNull View dataView,\n+                             @NonNull TextView latitudeTv, @NonNull TextView longitudeTv,\n+                             @NonNull TextView altitudeTv, @NonNull TextView accuracyTv) {\n+        TextView[] views = new TextView[]{latitudeTv, longitudeTv, altitudeTv, accuracyTv};\n+\n+        int[] stringIds = new int[]{R.string.latitude, R.string.longitude, R.string.altitude, R.string.accuracy};\n+\n         if (jsonObject.has(JsonFormConstants.VALUE)) {\n             String coordinateData = jsonObject.optString(JsonFormConstants.VALUE);\n \n             String[] coordinateElements = coordinateData.split(\" \");\n-            if (coordinateElements.length > 1) {\n-                latitude = coordinateElements[0];\n-                longitude = coordinateElements[1];\n+\n+            //loops to fill textViews with values supplied\n+            for (int i = 0; i < coordinateElements.length; i++) {\n+                views[i].setText(getText(context, coordinateElements[i], stringIds[i]));\n             }\n-        }\n \n-        latitudeTv.setText(getText(context, latitude, R.string.latitude));\n-        longitudeTv.setText(getText(context, longitude, R.string.longitude));\n-        altitudeTv.setText(getText(context, altitude, R.string.altitude));\n-        accuracyTv.setText(getText(context, accuracy, R.string.accuracy));\n+            //loops to fill empty textViews with empty string since the values is not available\n+            for (int i = coordinateElements.length; i < stringIds.length; i++) {\n+                views[i].setText(getText(context, \"\", stringIds[i]));\n+            }\n \n-        dataView.setTag(R.id.raw_value, constructString(latitude, longitude));\n+            dataView.setTag(R.id.raw_value, constructString(coordinateElements));\n+        } else {\n+            //loops to fill all textViews with empty string\n+            for (int i = 0; i < stringIds.length; i++) {\n+                views[i].setText(getText(context, \"\", stringIds[i]));\n+            }\n+            dataView.setTag(R.id.raw_value, \"\");", "originalCommit": "005c7ec654d140536d62bdc94db6d0a0a5024a55", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzI2NjQ4Nw==", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/524#discussion_r533266487", "bodyText": "you mean on the xml?  if yes the text attribute of the TextView has been assigned a string resource id ; if no we will still need to call .setText() for each of those views", "author": "bennsimon", "createdAt": "2020-12-01T10:07:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzIzNjU1MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzMyNTI1NA==", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/524#discussion_r533325254", "bodyText": "Why do you need to call setText twice if it's being set to empty string? Can't it be done once initially (as a default) and let the values be overwritten if data for them exists?\nAlso, couldn't the xml have the default value already set?", "author": "vincent-karuri", "createdAt": "2020-12-01T11:06:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzIzNjU1MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzMyODQ0MQ==", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/524#discussion_r533328441", "bodyText": "Why do you need to call setText twice if it's being set to empty string? its not called twice there is an else", "author": "bennsimon", "createdAt": "2020-12-01T11:12:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzIzNjU1MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzM2OTE0NA==", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/524#discussion_r533369144", "bodyText": "Isn't the same logic done in both the if and else?", "author": "vincent-karuri", "createdAt": "2020-12-01T12:24:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzIzNjU1MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzM3MTgyNw==", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/524#discussion_r533371827", "bodyText": "Yeah its done in if only if the value has fewer coordinate elements than the number of textViews ... its done on else only when the value attribute does not exist", "author": "bennsimon", "createdAt": "2020-12-01T12:29:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzIzNjU1MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzM3NDk0Nw==", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/524#discussion_r533374947", "bodyText": "am only setting to empty when needed", "author": "bennsimon", "createdAt": "2020-12-01T12:35:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzIzNjU1MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzM4NTQ4MA==", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/524#discussion_r533385480", "bodyText": "Wouldn't it be cleaner to have the defaults already in place and not have to add an else or to worry about checking if the coordinates were fewer?", "author": "vincent-karuri", "createdAt": "2020-12-01T12:53:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzIzNjU1MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzM5NjY5Ng==", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/524#discussion_r533396696", "bodyText": "Maybe but ... just thought calling .setText twice for all the views i.e one for setting empty text and the other for actual text, will be unnecessary.", "author": "bennsimon", "createdAt": "2020-12-01T13:13:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzIzNjU1MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzQxNTUzOQ==", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/524#discussion_r533415539", "bodyText": "The ideal way would be to have the default text in xml, is this not possible?\nEither way I think the benefit of having concise and non-repeated code is a win here since the setText operation is not expensive.", "author": "vincent-karuri", "createdAt": "2020-12-01T13:43:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzIzNjU1MQ=="}], "type": "inlineReview"}, {"oid": "bf89dce5cee9260055f8458e8f3f31b93ec13c23", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/bf89dce5cee9260055f8458e8f3f31b93ec13c23", "message": "apply code feedback", "committedDate": "2020-12-01T14:40:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzUwMDIzMg==", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/524#discussion_r533500232", "bodyText": "Why not use StringUtils.join() here?", "author": "vincent-karuri", "createdAt": "2020-12-01T15:26:45Z", "path": "android-json-form-wizard/src/main/java/com/vijay/jsonwizard/widgets/GpsFactory.java", "diffHunk": "@@ -224,27 +223,40 @@ protected void addViewTags(Button recordButton, WidgetArgs widgetArgs, WidgetMet\n         recordButton.setTag(R.id.extraPopup, widgetArgs.isPopup());\n     }\n \n-    public void attachLayout(Context context, @NonNull JSONObject jsonObject, @NonNull View dataView, @NonNull TextView latitudeTv, @NonNull TextView longitudeTv, @NonNull TextView altitudeTv, @NonNull TextView accuracyTv) {\n-        String latitude = \"\";\n-        String longitude = \"\";\n-        String accuracy = \"\";\n-        String altitude = \"\";\n+    public void attachLayout(Context context, @NonNull JSONObject jsonObject, @NonNull View dataView,\n+                             @NonNull TextView latitudeTv, @NonNull TextView longitudeTv,\n+                             @NonNull TextView altitudeTv, @NonNull TextView accuracyTv) {\n+        TextView[] views = new TextView[]{latitudeTv, longitudeTv, altitudeTv, accuracyTv};\n+\n+        int[] stringIds = new int[]{R.string.latitude, R.string.longitude, R.string.altitude, R.string.accuracy};\n+\n+        //loops to fill all textViews with empty string\n+        for (int i = 0; i < stringIds.length; i++) {\n+            views[i].setText(getText(context, \"\", stringIds[i]));\n+        }\n+\n         if (jsonObject.has(JsonFormConstants.VALUE)) {\n             String coordinateData = jsonObject.optString(JsonFormConstants.VALUE);\n \n             String[] coordinateElements = coordinateData.split(\" \");\n-            if (coordinateElements.length > 1) {\n-                latitude = coordinateElements[0];\n-                longitude = coordinateElements[1];\n+\n+            //loops to fill textViews with values supplied\n+            for (int i = 0; i < coordinateElements.length; i++) {\n+                views[i].setText(getText(context, coordinateElements[i], stringIds[i]));\n             }\n-        }\n \n-        latitudeTv.setText(getText(context, latitude, R.string.latitude));\n-        longitudeTv.setText(getText(context, longitude, R.string.longitude));\n-        altitudeTv.setText(getText(context, altitude, R.string.altitude));\n-        accuracyTv.setText(getText(context, accuracy, R.string.accuracy));\n+            dataView.setTag(R.id.raw_value, constructString(coordinateElements));\n+        } else {\n+            dataView.setTag(R.id.raw_value, \"\");\n+        }\n+    }\n \n-        dataView.setTag(R.id.raw_value, constructString(latitude, longitude));\n+    private static String constructString(Object[] coordinateElements) {\n+        StringBuilder s = new StringBuilder();\n+        for (int i = 0; i < coordinateElements.length; i++) {\n+            s.append(i != coordinateElements.length - 1 ? coordinateElements[i] + \" \" : coordinateElements[i]);\n+        }\n+        return s.toString();\n     }", "originalCommit": "bf89dce5cee9260055f8458e8f3f31b93ec13c23", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzUwMTY1OQ==", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/524#discussion_r533501659", "bodyText": "i have a condition there.", "author": "bennsimon", "createdAt": "2020-12-01T15:28:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzUwMDIzMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzUwNTExOA==", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/524#discussion_r533505118", "bodyText": "Aren't we trying to join the coordinateElements with a space?", "author": "vincent-karuri", "createdAt": "2020-12-01T15:32:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzUwMDIzMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzUxMDM1MA==", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/524#discussion_r533510350", "bodyText": "updated", "author": "bennsimon", "createdAt": "2020-12-01T15:39:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzUwMDIzMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzUwMTE0Mg==", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/524#discussion_r533501142", "bodyText": "No need for this else block, we can set dataView.setTag(R.id.raw_value, \"\"); as the default value to be overwritten only if we have gps values.", "author": "vincent-karuri", "createdAt": "2020-12-01T15:27:53Z", "path": "android-json-form-wizard/src/main/java/com/vijay/jsonwizard/widgets/GpsFactory.java", "diffHunk": "@@ -224,27 +223,40 @@ protected void addViewTags(Button recordButton, WidgetArgs widgetArgs, WidgetMet\n         recordButton.setTag(R.id.extraPopup, widgetArgs.isPopup());\n     }\n \n-    public void attachLayout(Context context, @NonNull JSONObject jsonObject, @NonNull View dataView, @NonNull TextView latitudeTv, @NonNull TextView longitudeTv, @NonNull TextView altitudeTv, @NonNull TextView accuracyTv) {\n-        String latitude = \"\";\n-        String longitude = \"\";\n-        String accuracy = \"\";\n-        String altitude = \"\";\n+    public void attachLayout(Context context, @NonNull JSONObject jsonObject, @NonNull View dataView,\n+                             @NonNull TextView latitudeTv, @NonNull TextView longitudeTv,\n+                             @NonNull TextView altitudeTv, @NonNull TextView accuracyTv) {\n+        TextView[] views = new TextView[]{latitudeTv, longitudeTv, altitudeTv, accuracyTv};\n+\n+        int[] stringIds = new int[]{R.string.latitude, R.string.longitude, R.string.altitude, R.string.accuracy};\n+\n+        //loops to fill all textViews with empty string\n+        for (int i = 0; i < stringIds.length; i++) {\n+            views[i].setText(getText(context, \"\", stringIds[i]));\n+        }\n+\n         if (jsonObject.has(JsonFormConstants.VALUE)) {\n             String coordinateData = jsonObject.optString(JsonFormConstants.VALUE);\n \n             String[] coordinateElements = coordinateData.split(\" \");\n-            if (coordinateElements.length > 1) {\n-                latitude = coordinateElements[0];\n-                longitude = coordinateElements[1];\n+\n+            //loops to fill textViews with values supplied\n+            for (int i = 0; i < coordinateElements.length; i++) {\n+                views[i].setText(getText(context, coordinateElements[i], stringIds[i]));\n             }\n-        }\n \n-        latitudeTv.setText(getText(context, latitude, R.string.latitude));\n-        longitudeTv.setText(getText(context, longitude, R.string.longitude));\n-        altitudeTv.setText(getText(context, altitude, R.string.altitude));\n-        accuracyTv.setText(getText(context, accuracy, R.string.accuracy));\n+            dataView.setTag(R.id.raw_value, constructString(coordinateElements));\n+        } else {\n+            dataView.setTag(R.id.raw_value, \"\");", "originalCommit": "bf89dce5cee9260055f8458e8f3f31b93ec13c23", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3794b5443fdb7d0bc6f2ad166726a8d51f81c3fc", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/3794b5443fdb7d0bc6f2ad166726a8d51f81c3fc", "message": "apply feedback", "committedDate": "2020-12-01T15:30:09Z", "type": "commit"}, {"oid": "e6397b31d578cf46163a6fdc9764d745409263c6", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/e6397b31d578cf46163a6fdc9764d745409263c6", "message": "update test", "committedDate": "2020-12-01T15:38:23Z", "type": "commit"}]}