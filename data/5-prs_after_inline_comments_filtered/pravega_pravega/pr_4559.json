{"pr_number": 4559, "pr_title": "Issue 4558: Low single segment write performance", "pr_createdAt": "2020-02-12T19:52:46Z", "pr_url": "https://github.com/pravega/pravega/pull/4559", "timeline": [{"oid": "174b4c31134543820f7f93e195d4416ee8cc7f36", "url": "https://github.com/pravega/pravega/commit/174b4c31134543820f7f93e195d4416ee8cc7f36", "message": "Issue 4558: Add configuration option for Bookkeeper digest type.\n\nSigned-off-by: Ra\u00fal Gracia <raul.gracia@emc.com>", "committedDate": "2020-02-12T19:27:22Z", "type": "commit"}, {"oid": "0d913652be24c82928a126609eda97194f4a3988", "url": "https://github.com/pravega/pravega/commit/0d913652be24c82928a126609eda97194f4a3988", "message": "Merge branch 'master' into issue-4558-bk-write-performance", "committedDate": "2020-02-12T20:03:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODUxNTcwMw==", "url": "https://github.com/pravega/pravega/pull/4559#discussion_r378515703", "bodyText": "Instead of using this string, can we use BookKeeper.DigestType.CRC32C.name()?", "author": "andreipaduroiu", "createdAt": "2020-02-12T21:13:56Z", "path": "segmentstore/storage/impl/src/main/java/io/pravega/segmentstore/storage/impl/bookkeeper/BookKeeperConfig.java", "diffHunk": "@@ -48,6 +49,7 @@\n     public static final Property<Integer> BK_MIN_NUM_RACKS_PER_WRITE_QUORUM = Property.named(\"minNumRacksPerWriteQuorum\", 2);\n     public static final Property<String> BK_NETWORK_TOPOLOGY_SCRIPT_FILE_NAME = Property.named(\"networkTopologyScriptFileName\",\n             \"/opt/pravega/scripts/sample-bookkeeper-topology.sh\");\n+    public static final Property<String> BK_DIGEST_TYPE = Property.named(\"digestType\", \"CRC32C\");", "originalCommit": "0d913652be24c82928a126609eda97194f4a3988", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODU0NTY0Mg==", "url": "https://github.com/pravega/pravega/pull/4559#discussion_r378545642", "bodyText": "Done.", "author": "RaulGracia", "createdAt": "2020-02-12T22:18:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODUxNTcwMw=="}], "type": "inlineReview"}, {"oid": "e8230bb469e970d83319d9999b2448c7ea26add3", "url": "https://github.com/pravega/pravega/commit/e8230bb469e970d83319d9999b2448c7ea26add3", "message": "Issue 4558: Use enum name to set the default digest type.\n\nSigned-off-by: Ra\u00fal Gracia <raul.gracia@emc.com>", "committedDate": "2020-02-12T22:06:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTA2ODc5MQ==", "url": "https://github.com/pravega/pravega/pull/4559#discussion_r379068791", "bodyText": "I suggest to enable digestTypeAutodetection so you don't  need to care about it on the reader side and your code will be compatible with rolling upgrades", "author": "eolivelli", "createdAt": "2020-02-13T19:23:31Z", "path": "segmentstore/storage/impl/src/main/java/io/pravega/segmentstore/storage/impl/bookkeeper/Ledgers.java", "diffHunk": "@@ -88,7 +88,7 @@ static LedgerHandle openFence(long ledgerId, BookKeeper bookKeeper, BookKeeperCo\n     static LedgerHandle openRead(long ledgerId, BookKeeper bookKeeper, BookKeeperConfig config) throws DurableDataLogException {\n         try {\n             return Exceptions.handleInterruptedCall(\n-                    () -> bookKeeper.openLedgerNoRecovery(ledgerId, LEDGER_DIGEST_TYPE, config.getBKPassword()));\n+                    () -> bookKeeper.openLedgerNoRecovery(ledgerId, config.getDigestType(), config.getBKPassword()));", "originalCommit": "e8230bb469e970d83319d9999b2448c7ea26add3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "4d48dfb96d6741e9345b8515b9f3be64b08ada25", "url": "https://github.com/pravega/pravega/commit/4d48dfb96d6741e9345b8515b9f3be64b08ada25", "message": "Merge branch 'master' into issue-4558-bk-write-performance", "committedDate": "2020-02-13T23:44:55Z", "type": "commit"}]}