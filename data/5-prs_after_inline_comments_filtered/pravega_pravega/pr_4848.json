{"pr_number": 4848, "pr_title": "Issue 4847: Improve sealed stream handling of EventStreamWriter and ByteStreamWriter.", "pr_createdAt": "2020-06-05T15:53:44Z", "pr_url": "https://github.com/pravega/pravega/pull/4848", "timeline": [{"oid": "ce8cb22081602dc9c345211ec332305348fd1701", "url": "https://github.com/pravega/pravega/commit/ce8cb22081602dc9c345211ec332305348fd1701", "message": "Fix Stream Writer.\n\nSigned-off-by: Sandeep <sandeep.shridhar@emc.com>", "committedDate": "2020-06-05T12:53:28Z", "type": "commit"}, {"oid": "5c79aadbe19f5c25456ace2e2a76a4d0f71fb82a", "url": "https://github.com/pravega/pravega/commit/5c79aadbe19f5c25456ace2e2a76a4d0f71fb82a", "message": "Fix checkstyle.\n\nSigned-off-by: Sandeep <sandeep.shridhar@emc.com>", "committedDate": "2020-06-05T13:01:31Z", "type": "commit"}, {"oid": "d60261d9d920a30de200ce2dbbad36713ec469e6", "url": "https://github.com/pravega/pravega/commit/d60261d9d920a30de200ce2dbbad36713ec469e6", "message": "fix ByteStream writer.\n\nSigned-off-by: Sandeep <sandeep.shridhar@emc.com>", "committedDate": "2020-06-05T13:01:46Z", "type": "commit"}, {"oid": "5ea3e7aa66939005332262e4eba06e35fdc4f5e3", "url": "https://github.com/pravega/pravega/commit/5ea3e7aa66939005332262e4eba06e35fdc4f5e3", "message": "Fix junits.\n\nSigned-off-by: Sandeep <sandeep.shridhar@emc.com>", "committedDate": "2020-06-05T13:59:39Z", "type": "commit"}, {"oid": "865f8c79fb5dd0edbbae0c7d0b87a89a8dee6423", "url": "https://github.com/pravega/pravega/commit/865f8c79fb5dd0edbbae0c7d0b87a89a8dee6423", "message": "refactor tests.\n\nSigned-off-by: Sandeep <sandeep.shridhar@emc.com>", "committedDate": "2020-06-05T15:23:33Z", "type": "commit"}, {"oid": "8b35f5d0b6830decf92a066160a4badbeaa38c8d", "url": "https://github.com/pravega/pravega/commit/8b35f5d0b6830decf92a066160a4badbeaa38c8d", "message": "Merge branch 'master' into issue-sealstream-writer", "committedDate": "2020-06-05T23:16:25Z", "type": "commit"}, {"oid": "0077c28ec36d5f6a9a63214d918e791c07f5aabe", "url": "https://github.com/pravega/pravega/commit/0077c28ec36d5f6a9a63214d918e791c07f5aabe", "message": "Improve coverage.\n\nSigned-off-by: Sandeep <sandeep.shridhar@emc.com>", "committedDate": "2020-06-06T03:43:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI1ODg3NQ==", "url": "https://github.com/pravega/pravega/pull/4848#discussion_r436258875", "bodyText": "This new variable looks unused", "author": "eolivelli", "createdAt": "2020-06-06T10:51:31Z", "path": "client/src/test/java/io/pravega/client/stream/impl/ClientFactoryTest.java", "diffHunk": "@@ -54,8 +73,29 @@ public void testEventWriter() {\n         String scope = \"scope\";\n         String stream = \"stream1\";\n         // setup mocks\n-        ClientFactoryImpl clientFactory = new ClientFactoryImpl(scope, controllerClient, connectionFactory);\n+        ClientFactoryImpl clientFactory = new ClientFactoryImpl(scope, controllerClient, connectionFactory, inFactory, outFactory, condFactory, metaFactory);\n+        NavigableMap<Double, SegmentWithRange> segments = new TreeMap<>();\n+        Segment segment = new Segment(scope, stream, 0L);\n+        segments.put(1.0, new SegmentWithRange(segment, 0.0, 1.0));\n+        StreamSegments currentSegments = new StreamSegments(segments, \"\");\n+        SegmentOutputStream outStream = mock(SegmentOutputStream.class);\n+        when(controllerClient.getCurrentSegments(scope, stream))\n+                .thenReturn(CompletableFuture.completedFuture(currentSegments));\n+        when(outFactory.createOutputStreamForSegment(eq(segment), any(), any(), any())).thenReturn(outStream);\n+\n+        EventWriterConfig writerConfig = EventWriterConfig.builder().build();\n+        EventStreamWriter<String> writer = clientFactory.createEventWriter(stream, new JavaSerializer<String>(), writerConfig);\n+        assertEquals(writerConfig, writer.getConfig());\n+    }\n+\n+    @Test(expected = IllegalStateException.class)\n+    public void testEventWriterSealedStream() {\n+        String scope = \"scope\";\n+        String stream = \"stream1\";\n+        // setup mocks\n+        ClientFactoryImpl clientFactory = new ClientFactoryImpl(scope, controllerClient, connectionFactory, inFactory, outFactory, condFactory, metaFactory);\n         StreamSegments currentSegments = new StreamSegments(new TreeMap<>(), \"\");\n+        SegmentOutputStream outStream = mock(SegmentOutputStream.class);", "originalCommit": "0077c28ec36d5f6a9a63214d918e791c07f5aabe", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjM0Njk2Ng==", "url": "https://github.com/pravega/pravega/pull/4848#discussion_r436346966", "bodyText": "fixed it.", "author": "shrids", "createdAt": "2020-06-07T10:12:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI1ODg3NQ=="}], "type": "inlineReview"}, {"oid": "274d7e46033b8f7179d5418e7977ee5055514ddc", "url": "https://github.com/pravega/pravega/commit/274d7e46033b8f7179d5418e7977ee5055514ddc", "message": "CR Change: Remove unused variable.\n\nSigned-off-by: Sandeep <sandeep.shridhar@emc.com>", "committedDate": "2020-06-07T10:08:18Z", "type": "commit"}, {"oid": "18f700aff542ba13ac1c41643e0144b348842797", "url": "https://github.com/pravega/pravega/commit/18f700aff542ba13ac1c41643e0144b348842797", "message": "Merge branch 'master' into issue-sealstream-writer", "committedDate": "2020-06-07T10:09:21Z", "type": "commit"}, {"oid": "bbf5bff6512ee2a0cfd33cb6b47e8bd67a6f2439", "url": "https://github.com/pravega/pravega/commit/bbf5bff6512ee2a0cfd33cb6b47e8bd67a6f2439", "message": "Merge branch 'master' into issue-sealstream-writer", "committedDate": "2020-06-08T10:47:05Z", "type": "commit"}]}