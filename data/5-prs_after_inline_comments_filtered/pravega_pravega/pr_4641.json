{"pr_number": 4641, "pr_title": "Issue 4639: Table store helper to retry only on unknownhost and auth failure for update requests", "pr_createdAt": "2020-03-24T10:47:40Z", "pr_url": "https://github.com/pravega/pravega/pull/4641", "timeline": [{"oid": "784d7a3de9e607c8225f63fa39bec711d6d16d1e", "url": "https://github.com/pravega/pravega/commit/784d7a3de9e607c8225f63fa39bec711d6d16d1e", "message": "retry on unknownhost and auth failure\n\nSigned-off-by: Shivesh Ranjan <shivesh.ranjan@gmail.com>", "committedDate": "2020-03-24T10:45:26Z", "type": "commit"}, {"oid": "0a070d693bbe326d2fd1936909b7b9630cc99cd9", "url": "https://github.com/pravega/pravega/commit/0a070d693bbe326d2fd1936909b7b9630cc99cd9", "message": "Merge branch 'master' into issue4639", "committedDate": "2020-03-30T03:39:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDY2MjExMg==", "url": "https://github.com/pravega/pravega/pull/4641#discussion_r400662112", "bodyText": "This change causes a slight change in the behavior of the controller wrt to createScope().\nThis change prevents retries in the case of `ConnectionDropped` or `ConnectionFailed`. In the case of `createScope()` \nworkflow, this will prevent retries by the controller. And in this scenario the retries of the client would be used.", "author": "shrids", "createdAt": "2020-03-31T06:02:37Z", "path": "controller/src/main/java/io/pravega/controller/store/stream/PravegaTablesStoreHelper.java", "diffHunk": "@@ -176,7 +178,7 @@ public void invalidateCache(String table, String key) {\n                 new TableEntryImpl<>(new TableKeyImpl<>(key.getBytes(Charsets.UTF_8), KeyVersion.NOT_EXISTS), value));\n         Supplier<String> errorMessage = () -> String.format(\"addNewEntry: key: %s table: %s\", key, tableName);\n         return withRetries(() -> segmentHelper.updateTableEntries(tableName, entries, authToken.get(), RequestTag.NON_EXISTENT_ID),\n-                errorMessage)\n+                errorMessage, true)", "originalCommit": "0a070d693bbe326d2fd1936909b7b9630cc99cd9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDk4ODA3OA==", "url": "https://github.com/pravega/pravega/pull/4641#discussion_r400988078", "bodyText": "Yes, that is correct. But its not necessarily a behaviour change (except the bug fix). Its just fail faster rather than retry.\nMost updates happen from workflows.\nSome happen in the context of client calls.\nSo we can wrap an additional retry loop on create scope if we want. we can take it as a separate issue. i have opened the following issue: #4657", "author": "shiveshr", "createdAt": "2020-03-31T15:05:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDY2MjExMg=="}], "type": "inlineReview"}]}