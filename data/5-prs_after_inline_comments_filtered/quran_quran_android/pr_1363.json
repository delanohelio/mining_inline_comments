{"pr_number": 1363, "pr_title": "#1361 show the translated names of the sura in the sura list fragment.", "pr_createdAt": "2020-05-20T22:16:00Z", "pr_url": "https://github.com/quran/quran_android/pull/1363", "timeline": [{"oid": "35296173820de955683fe046284ca4c0cfb4b83c", "url": "https://github.com/quran/quran_android/commit/35296173820de955683fe046284ca4c0cfb4b83c", "message": "#1361 show the translated names of the sura in the sura list fragment.", "committedDate": "2020-05-20T22:13:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODM0MTE5Mg==", "url": "https://github.com/quran/quran_android/pull/1363#discussion_r428341192", "bodyText": "replace with:\n  @Inject\n  QuranSettings quranSettings;\n\nfield at the top.", "author": "ahmedre", "createdAt": "2020-05-20T22:22:01Z", "path": "app/src/main/java/com/quran/labs/androidquran/ui/fragment/SuraListFragment.java", "diffHunk": "@@ -128,7 +129,8 @@ private void updateScrollBarPositionHoneycomb() {\n \n     Activity activity = getActivity();\n     boolean wantPrefix = activity.getResources().getBoolean(R.bool.show_surat_prefix);\n-    boolean wantTranslation = activity.getResources().getBoolean(R.bool.show_sura_names_translation);\n+    QuranSettings settings = QuranSettings.getInstance(activity);", "originalCommit": "35296173820de955683fe046284ca4c0cfb4b83c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODM0MTc3MA==", "url": "https://github.com/quran/quran_android/pull/1363#discussion_r428341770", "bodyText": "suggestion - instead of doing it this way, i would remove this code and let changing the variable cause SuraListFragment instead to recompute with the updated flag and notifyDataSetChanged.", "author": "ahmedre", "createdAt": "2020-05-20T22:23:31Z", "path": "app/src/main/java/com/quran/labs/androidquran/ui/helpers/QuranListAdapter.java", "diffHunk": "@@ -248,6 +249,35 @@ public boolean onLongClick(View v) {\n     return false;\n   }\n \n+  public void showHideSuraTranslatedName(boolean showSuraTranslatedName) {\n+    if (showSuraTranslatedName && elements[1].text.indexOf(\"(\") != -1) return;\n+    if (!showSuraTranslatedName && elements[1].text.indexOf(\"(\") == -1) return;\n+    for (QuranRow row : elements) {\n+      if (row.sura != 0) {\n+        if (showSuraTranslatedName) {\n+          addTranslatedNameToSuraName(row);\n+        } else {\n+          removeSuraTranslatedName(row);\n+        }\n+      }\n+    }\n+    notifyDataSetChanged();\n+  }\n+\n+  private void removeSuraTranslatedName(QuranRow row) {\n+    if (row.text.indexOf(\"(\") != -1)\n+      row.text = row.text.substring(0, row.text.indexOf(\"(\") - 1);\n+  }\n+\n+  private void addTranslatedNameToSuraName(QuranRow row) {\n+    StringBuilder builder = new StringBuilder(row.text);\n+    String translation = context.getResources().getStringArray(R.array.sura_names_translation)[row.sura - 1];\n+    if (!TextUtils.isEmpty(translation)) {\n+      builder.append(\" (\" + translation + \")\");\n+    }\n+    row.text = builder.toString();\n+  }\n+", "originalCommit": "35296173820de955683fe046284ca4c0cfb4b83c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODM0Mjc0MQ==", "url": "https://github.com/quran/quran_android/pull/1363#discussion_r428342741", "bodyText": "so you could replace that code with a check in onResume - if the value of the checkbox changed, then re-compute and notifyDataSetChanged, otherwise do nothing.", "author": "ahmedre", "createdAt": "2020-05-20T22:25:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODM0MTc3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODM0OTI5OA==", "url": "https://github.com/quran/quran_android/pull/1363#discussion_r428349298", "bodyText": "okay, I will move this code [three methods] to the SuraListFragment, but I track if the value changed or not using the below-stopping conditions before re-compute.\nif (showSuraTranslatedName && elements[1].text.indexOf(\"(\") != -1) return;\nif (!showSuraTranslatedName && elements[1].text.indexOf(\"(\") == -1) return;\n\ndo you know how to track the value after being changed ?", "author": "AhmedGarhy", "createdAt": "2020-05-20T22:44:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODM0MTc3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODM2NDgwNA==", "url": "https://github.com/quran/quran_android/pull/1363#discussion_r428364804", "bodyText": "no need to move this code - remove it altogether. in onCreate of the SuraListFragment, read the value of wantTranslations into a variable. in onResume, check if the actual value differs, and if so, just re-call getSuraList() - pass the updated value to the adapter (you might have to expose a setter).", "author": "ahmedre", "createdAt": "2020-05-20T23:31:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODM0MTc3MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODM0MTg5Mw==", "url": "https://github.com/quran/quran_android/pull/1363#discussion_r428341893", "bodyText": "can you default to the value in R.bool.show_sura_names_translation", "author": "ahmedre", "createdAt": "2020-05-20T22:23:53Z", "path": "app/src/main/java/com/quran/labs/androidquran/util/QuranSettings.java", "diffHunk": "@@ -167,6 +167,9 @@ public void setShowDate(boolean isDateShown) {\n     prefs.edit().putBoolean(Constants.PREF_SHOW_DATE, isDateShown).apply();\n   }\n \n+  public boolean isShowSuraTranslatedName() {\n+    return prefs.getBoolean(Constants.PREF_SURA_TRANSLATED_NAME, false);", "originalCommit": "35296173820de955683fe046284ca4c0cfb4b83c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "eb52558fd25306fc1afc1967f37fff814619ddd9", "url": "https://github.com/quran/quran_android/commit/eb52558fd25306fc1afc1967f37fff814619ddd9", "message": "- use R.bool.show_sura_names_translation as default value instead of hardcoded.\n- move the showing translated name from the adapter to the fragment.", "committedDate": "2020-05-20T22:57:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjY5MDc2OQ==", "url": "https://github.com/quran/quran_android/pull/1363#discussion_r432690769", "bodyText": "what i meant is replace these 2 lines with something like:\nfinal QuranRow[] updatedElements = getSuraList();\nadapter.setElements(updatedElements);\nand in onCreate, make the adapter in a variable so you can call this setter on it. expose the setter on the adapter also. then you can just remove the show/add methods that you added below.", "author": "ahmedre", "createdAt": "2020-05-29T19:29:05Z", "path": "app/src/main/java/com/quran/labs/androidquran/ui/fragment/SuraListFragment.java", "diffHunk": "@@ -88,7 +92,11 @@ public void onPause() {\n   public void onResume() {\n     final Activity activity = getActivity();\n     if (activity instanceof QuranActivity) {\n-      QuranSettings settings = QuranSettings.getInstance(activity);\n+      boolean newValueOfShowSuraTranslatedName = quranSettings.isShowSuraTranslatedName();\n+      if (this.showSuraTranslatedName != newValueOfShowSuraTranslatedName) {\n+        showHideSuraTranslatedName(newValueOfShowSuraTranslatedName);\n+        this.showSuraTranslatedName = newValueOfShowSuraTranslatedName;", "originalCommit": "eb52558fd25306fc1afc1967f37fff814619ddd9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzE5NTA3OA==", "url": "https://github.com/quran/quran_android/pull/1363#discussion_r433195078", "bodyText": "Hi @ahmedre\nI got what do you want to say, but I believe that we don't have to repeat the construction of the SuraList by Calling getSuraList() again, instead of that, we can just modify the text of each Sura in the list by appending or removing the translated part.\nI believe this implementation is more optimal than calling the getSuraList again and again.", "author": "AhmedGarhy", "createdAt": "2020-06-01T12:04:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjY5MDc2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzI1MDk3NQ==", "url": "https://github.com/quran/quran_android/pull/1363#discussion_r433250975", "bodyText": "i agree that it's more optimal your way, but considering:\n\nwe can avoid adding extra code - so tradeoff for code readability\nthe extra price is only called when the person goes into the menu and chooses the option to show translation names - the number of people doing this is very small and will likely only do it once or twice at most.\nthe extra code means that in the future, if we change the way we're adding the translations (i.e. today, i guess we're manually making the string, which is not ideal and honestly we should fix this), then we'd have to modify this code - it also means other languages can't choose to something different - ex one language can use () one can use <>, one can do nothing at all.\n\nso for those reasons, was suggesting to do it this way despite being slightly less optimal.", "author": "ahmedre", "createdAt": "2020-06-01T14:00:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjY5MDc2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzI4Njc2Mg==", "url": "https://github.com/quran/quran_android/pull/1363#discussion_r433286762", "bodyText": "got it, thanks for the clarification.", "author": "AhmedGarhy", "createdAt": "2020-06-01T15:00:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjY5MDc2OQ=="}], "type": "inlineReview"}, {"oid": "edd451a1188f9f84994a17e267d237fc00152c8b", "url": "https://github.com/quran/quran_android/commit/edd451a1188f9f84994a17e267d237fc00152c8b", "message": "- recall getSuraList method.", "committedDate": "2020-06-01T14:59:32Z", "type": "commit"}]}