{"pr_number": 2579, "pr_title": "Add CopySpec for buildfile", "pr_createdAt": "2020-07-09T20:04:28Z", "pr_url": "https://github.com/GoogleContainerTools/jib/pull/2579", "timeline": [{"oid": "ff94143f0721edfbd806435ff09fed61ccd7a828", "url": "https://github.com/GoogleContainerTools/jib/commit/ff94143f0721edfbd806435ff09fed61ccd7a828", "message": "Add CopySpec for buildfile", "committedDate": "2020-07-09T20:03:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjk4MDcyMw==", "url": "https://github.com/GoogleContainerTools/jib/pull/2579#discussion_r452980723", "bodyText": "I assume if includes is given (and no 'excludesgiven), only those files listed are copied fromsrc`, right?", "author": "chanseokoh", "createdAt": "2020-07-10T17:36:10Z", "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/buildfile/CopySpec.java", "diffHunk": "@@ -0,0 +1,94 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+package com.google.cloud.tools.jib.cli.buildfile;\n+\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.google.cloud.tools.jib.api.buildplan.AbsoluteUnixPath;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.util.List;\n+import java.util.Optional;\n+import javax.annotation.Nullable;\n+\n+/**\n+ * A yaml block for specifying a copy directive.\n+ *\n+ * <p>Example use of this yaml snippet.\n+ *\n+ * <pre>{@code\n+ * src: path/to/somewhere\n+ * dest: /absolute/path/on/container\n+ * includes:\n+ *   - **\\/*.txt\n+ * excludes:\n+ *   - **\\/goose.txt\n+ *   - **\\/moose.txt\n+ * properties: see {@link FilePropertiesSpec}\n+ * }</pre>\n+ */\n+public class CopySpec {\n+  private final Path src;\n+  private final AbsoluteUnixPath dest;\n+\n+  @Nullable private final FilePropertiesSpec properties;\n+  @Nullable private final List<String> excludes;\n+  @Nullable private final List<String> includes;\n+\n+  /**\n+   * Constructor for use by jackson to populate this object.\n+   *\n+   * @param src a file/directory on the local filesystem to copy *from*\n+   * @param dest an absolute unix style path to copy *to* on the container\n+   * @param excludes glob of files to exclude (has precedence over includes)\n+   * @param includes glob of files to include", "originalCommit": "ff94143f0721edfbd806435ff09fed61ccd7a828", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjk5NDcyNg==", "url": "https://github.com/GoogleContainerTools/jib/pull/2579#discussion_r452994726", "bodyText": "Right, I'll clear that up", "author": "loosebazooka", "createdAt": "2020-07-10T18:05:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjk4MDcyMw=="}], "type": "inlineReview"}, {"oid": "ebbc31d27f6bfd07daf65506da5af488bd879249", "url": "https://github.com/GoogleContainerTools/jib/commit/ebbc31d27f6bfd07daf65506da5af488bd879249", "message": "updated comments", "committedDate": "2020-07-10T18:21:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzg0Mjg3OQ==", "url": "https://github.com/GoogleContainerTools/jib/pull/2579#discussion_r453842879", "bodyText": "I didn't think about copying collections at the time of review.", "author": "chanseokoh", "createdAt": "2020-07-13T18:21:33Z", "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/buildfile/CopySpec.java", "diffHunk": "@@ -0,0 +1,94 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+package com.google.cloud.tools.jib.cli.buildfile;\n+\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.google.cloud.tools.jib.api.buildplan.AbsoluteUnixPath;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.util.List;\n+import java.util.Optional;\n+import javax.annotation.Nullable;\n+\n+/**\n+ * A yaml block for specifying a copy directive.\n+ *\n+ * <p>Example use of this yaml snippet.\n+ *\n+ * <pre>{@code\n+ * src: path/to/somewhere\n+ * dest: /absolute/path/on/container\n+ * includes:\n+ *   - **\\/*.txt\n+ * excludes:\n+ *   - **\\/goose.txt\n+ *   - **\\/moose.txt\n+ * properties: see {@link FilePropertiesSpec}\n+ * }</pre>\n+ */\n+public class CopySpec {\n+  private final Path src;\n+  private final AbsoluteUnixPath dest;\n+\n+  @Nullable private final FilePropertiesSpec properties;\n+  @Nullable private final List<String> excludes;\n+  @Nullable private final List<String> includes;\n+\n+  /**\n+   * Constructor for use by jackson to populate this object.\n+   *\n+   * @param src a file/directory on the local filesystem to copy *from*\n+   * @param dest an absolute unix style path to copy *to* on the container\n+   * @param includes glob to filter files to include from \"src\"\n+   * @param excludes glob to filter out files included by \"src\" and \"includes\" (applied last)\n+   * @param properties a {@link FilePropertiesSpec} that applies to all files in this copy\n+   */\n+  @JsonCreator\n+  public CopySpec(\n+      @JsonProperty(value = \"src\", required = true) String src,\n+      @JsonProperty(value = \"dest\", required = true) String dest,\n+      @JsonProperty(\"includes\") List<String> includes,\n+      @JsonProperty(\"excludes\") List<String> excludes,\n+      @JsonProperty(\"properties\") FilePropertiesSpec properties) {\n+    this.src = Paths.get(src);\n+    this.dest = AbsoluteUnixPath.get(dest);\n+    this.excludes = excludes;\n+    this.includes = includes;", "originalCommit": "ebbc31d27f6bfd07daf65506da5af488bd879249", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}