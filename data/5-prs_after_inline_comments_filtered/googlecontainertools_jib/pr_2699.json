{"pr_number": 2699, "pr_title": "Fix child progress dispatcher factory", "pr_createdAt": "2020-08-12T19:41:38Z", "pr_url": "https://github.com/GoogleContainerTools/jib/pull/2699", "timeline": [{"oid": "77b987cc768e543fbf932ece12e99263a61b3919", "url": "https://github.com/GoogleContainerTools/jib/commit/77b987cc768e543fbf932ece12e99263a61b3919", "message": "Fixing concurrent progress dispatcher", "committedDate": "2020-08-12T19:37:54Z", "type": "commit"}, {"oid": "7fd2b8d530c956ea4814989aff77ae250d219eae", "url": "https://github.com/GoogleContainerTools/jib/commit/7fd2b8d530c956ea4814989aff77ae250d219eae", "message": "Fixing progress reporting pullBaseimageLayer", "committedDate": "2020-08-12T19:39:22Z", "type": "commit"}, {"oid": "8011fadccacc0f30e3e0549edfbfda4b8936b909", "url": "https://github.com/GoogleContainerTools/jib/commit/8011fadccacc0f30e3e0549edfbfda4b8936b909", "message": "Fixing Style", "committedDate": "2020-08-12T19:44:02Z", "type": "commit"}, {"oid": "616b5a3198cc91d79e589297b14e76882cc5baa2", "url": "https://github.com/GoogleContainerTools/jib/commit/616b5a3198cc91d79e589297b14e76882cc5baa2", "message": "Removing un-related changes", "committedDate": "2020-08-12T19:46:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTUwNDMxMQ==", "url": "https://github.com/GoogleContainerTools/jib/pull/2699#discussion_r469504311", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                  \"scheduling pushing base image layers\",\n          \n          \n            \n                                  \"scheduling obtaining base image layers\",", "author": "chanseokoh", "createdAt": "2020-08-12T19:55:58Z", "path": "jib-core/src/main/java/com/google/cloud/tools/jib/builder/steps/StepsRunner.java", "diffHunk": "@@ -304,22 +304,28 @@ private void pullBaseImages() {\n   private void obtainBaseImageLayers(boolean layersRequiredLocally) {\n     ProgressEventDispatcher.Factory childProgressDispatcherFactory =\n         Verify.verifyNotNull(rootProgressDispatcher).newChildProducer();\n+\n     results.baseImagesAndLayers =\n         executorService.submit(\n             () -> {\n+              ProgressEventDispatcher progressDispatcher =\n+                  childProgressDispatcherFactory.create(\n+                      \"scheduling pushing base image layers\",", "originalCommit": "616b5a3198cc91d79e589297b14e76882cc5baa2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTUwNDc0Mw==", "url": "https://github.com/GoogleContainerTools/jib/pull/2699#discussion_r469504743", "bodyText": "You are looping over baseImagesAndRegistryClient. The allocation for this ProgressEventDispatcher should match the number of times newChildProducer() will be called.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                  results.baseImagesAndLayers.get().size());\n          \n          \n            \n                                  results.baseImagesAndRegistryClient.get().size());", "author": "chanseokoh", "createdAt": "2020-08-12T19:56:45Z", "path": "jib-core/src/main/java/com/google/cloud/tools/jib/builder/steps/StepsRunner.java", "diffHunk": "@@ -304,22 +304,28 @@ private void pullBaseImages() {\n   private void obtainBaseImageLayers(boolean layersRequiredLocally) {\n     ProgressEventDispatcher.Factory childProgressDispatcherFactory =\n         Verify.verifyNotNull(rootProgressDispatcher).newChildProducer();\n+\n     results.baseImagesAndLayers =\n         executorService.submit(\n             () -> {\n+              ProgressEventDispatcher progressDispatcher =\n+                  childProgressDispatcherFactory.create(\n+                      \"scheduling pushing base image layers\",\n+                      results.baseImagesAndLayers.get().size());", "originalCommit": "616b5a3198cc91d79e589297b14e76882cc5baa2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTUxMzE3MQ==", "url": "https://github.com/GoogleContainerTools/jib/pull/2699#discussion_r469513171", "bodyText": "This is a temporary workaround to overcome the runtime failure. But I can accept this to move forward. Eventually, we should implement a permanent fix. Please keep track of this issue too.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                          ProgressEventDispatcher progressDispatcher =\n          \n          \n            \n                          // TODO: ideally, progressDispatcher should be closed at the right moment, after the scheduled threads have completed. However, it can be tricky and cumbersome to track completion, so it may just be better to delay closing until everything ends. At least, we must ensure that it's not closed prematurely. (Garbage collection doesn't auto-close it wit the current implementation.)\n          \n          \n            \n                          ProgressEventDispatcher progressDispatcher =", "author": "chanseokoh", "createdAt": "2020-08-12T20:13:33Z", "path": "jib-core/src/main/java/com/google/cloud/tools/jib/builder/steps/StepsRunner.java", "diffHunk": "@@ -304,22 +304,28 @@ private void pullBaseImages() {\n   private void obtainBaseImageLayers(boolean layersRequiredLocally) {\n     ProgressEventDispatcher.Factory childProgressDispatcherFactory =\n         Verify.verifyNotNull(rootProgressDispatcher).newChildProducer();\n+\n     results.baseImagesAndLayers =\n         executorService.submit(\n             () -> {\n+              ProgressEventDispatcher progressDispatcher =", "originalCommit": "616b5a3198cc91d79e589297b14e76882cc5baa2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "61134225fd03fa94711697635ab8227b17ca88d5", "url": "https://github.com/GoogleContainerTools/jib/commit/61134225fd03fa94711697635ab8227b17ca88d5", "message": "Add multiple pregress dispatchers for concuireent processes", "committedDate": "2020-08-12T22:05:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTU4NDA2MQ==", "url": "https://github.com/GoogleContainerTools/jib/pull/2699#discussion_r469584061", "bodyText": "\"building manifests\" sounds more informative to the user.", "author": "chanseokoh", "createdAt": "2020-08-12T22:33:54Z", "path": "jib-core/src/main/java/com/google/cloud/tools/jib/builder/steps/StepsRunner.java", "diffHunk": "@@ -377,6 +392,15 @@ private void buildImages() {\n     results.builtImagesAndBaseImages =\n         executorService.submit(\n             () -> {\n+              // TODO: ideally, progressDispatcher should be closed at the right moment, after the\n+              // scheduled threads have completed. However, it can be tricky and cumbersome to track\n+              // completion, so it may just be better to delay closing until everything ends. At\n+              // least, we must ensure that it's not closed prematurely. (Garbage collection doesn't\n+              // auto-close it wit the current implementation.)\n+              ProgressEventDispatcher progressDispatcher =\n+                  childProgressDispatcherFactory.create(\n+                      \"scheduling building images\", results.baseImagesAndLayers.get().size());", "originalCommit": "61134225fd03fa94711697635ab8227b17ca88d5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTU4NDE5NQ==", "url": "https://github.com/GoogleContainerTools/jib/pull/2699#discussion_r469584195", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                  results.builtImagesAndBaseImages.get().keySet().size());\n          \n          \n            \n                                  results.builtImagesAndBaseImages.get().size());", "author": "chanseokoh", "createdAt": "2020-08-12T22:34:16Z", "path": "jib-core/src/main/java/com/google/cloud/tools/jib/builder/steps/StepsRunner.java", "diffHunk": "@@ -404,14 +428,24 @@ private void pushContainerConfigurations() {\n     results.builtImagesAndContainerConfigurationPushResults =\n         executorService.submit(\n             () -> {\n+              // TODO: ideally, progressDispatcher should be closed at the right moment, after the\n+              // scheduled threads have completed. However, it can be tricky and cumbersome to track\n+              // completion, so it may just be better to delay closing until everything ends. At\n+              // least, we must ensure that it's not closed prematurely. (Garbage collection doesn't\n+              // auto-close it wit the current implementation.)\n+              ProgressEventDispatcher progressDispatcher =\n+                  childProgressDispatcherFactory.create(\n+                      \"scheduling pushing container configurations\",\n+                      results.builtImagesAndBaseImages.get().keySet().size());", "originalCommit": "61134225fd03fa94711697635ab8227b17ca88d5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTU4NDI4NQ==", "url": "https://github.com/GoogleContainerTools/jib/pull/2699#discussion_r469584285", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                  results.builtImagesAndBaseImages.get().keySet().size());\n          \n          \n            \n                                  results.builtImagesAndBaseImages.get().size());", "author": "chanseokoh", "createdAt": "2020-08-12T22:34:30Z", "path": "jib-core/src/main/java/com/google/cloud/tools/jib/builder/steps/StepsRunner.java", "diffHunk": "@@ -465,13 +499,24 @@ private void pushImages() {\n     results.buildResults =\n         executorService.submit(\n             () -> {\n+              // TODO: ideally, progressDispatcher should be closed at the right moment, after the\n+              // scheduled threads have completed. However, it can be tricky and cumbersome to track\n+              // completion, so it may just be better to delay closing until everything ends. At\n+              // least, we must ensure that it's not closed prematurely. (Garbage collection doesn't\n+              // auto-close it wit the current implementation.)\n+              ProgressEventDispatcher progressDispatcher =\n+                  childProgressDispatcherFactory.create(\n+                      \"scheduling pushing images\",\n+                      results.builtImagesAndBaseImages.get().keySet().size());", "originalCommit": "61134225fd03fa94711697635ab8227b17ca88d5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTU4NDQ2OQ==", "url": "https://github.com/GoogleContainerTools/jib/pull/2699#discussion_r469584469", "bodyText": "pushing manifests", "author": "chanseokoh", "createdAt": "2020-08-12T22:34:55Z", "path": "jib-core/src/main/java/com/google/cloud/tools/jib/builder/steps/StepsRunner.java", "diffHunk": "@@ -465,13 +499,24 @@ private void pushImages() {\n     results.buildResults =\n         executorService.submit(\n             () -> {\n+              // TODO: ideally, progressDispatcher should be closed at the right moment, after the\n+              // scheduled threads have completed. However, it can be tricky and cumbersome to track\n+              // completion, so it may just be better to delay closing until everything ends. At\n+              // least, we must ensure that it's not closed prematurely. (Garbage collection doesn't\n+              // auto-close it wit the current implementation.)\n+              ProgressEventDispatcher progressDispatcher =\n+                  childProgressDispatcherFactory.create(\n+                      \"scheduling pushing images\",", "originalCommit": "61134225fd03fa94711697635ab8227b17ca88d5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "4aed13dd7c56b2bef9d7bf93b1fe80851757daf1", "url": "https://github.com/GoogleContainerTools/jib/commit/4aed13dd7c56b2bef9d7bf93b1fe80851757daf1", "message": "Style Fix", "committedDate": "2020-08-13T01:34:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTk4OTE2NQ==", "url": "https://github.com/GoogleContainerTools/jib/pull/2699#discussion_r469989165", "bodyText": "#2699 (comment)\nAlmost all of our classes are immutable, so we didn't have to think about synchronization when accessing instances in the multi-threaded environment. However, progressDispatcher is an exception (understandably as a class to report progress updates to the user). And progressDispatcher is not designed to be thread-safe either.\nSo, it is unsafe to access progressDispatcher from multiple threads. That is, calling newChildProducer() here needs synchronization; it's being called in multiple threads launched through the loop.\nThe simplest solution I think is to call newChildProducer() outside executorService.submit() on line 408.", "author": "chanseokoh", "createdAt": "2020-08-13T14:22:02Z", "path": "jib-core/src/main/java/com/google/cloud/tools/jib/builder/steps/StepsRunner.java", "diffHunk": "@@ -379,7 +409,7 @@ private void buildImages() {\n                         () ->\n                             new BuildImageStep(\n                                     buildContext,\n-                                    childProgressDispatcherFactory,\n+                                    progressDispatcher.newChildProducer(),", "originalCommit": "4aed13dd7c56b2bef9d7bf93b1fe80851757daf1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTk5MjM4Ng==", "url": "https://github.com/GoogleContainerTools/jib/pull/2699#discussion_r469992386", "bodyText": "I see so that means creating a variable to hold the 'progressDispatcher.newChildProducer()` outside of the loop and then use the variable instead in the threads?", "author": "louismurerwa", "createdAt": "2020-08-13T14:26:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTk4OTE2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTk5NjcwNQ==", "url": "https://github.com/GoogleContainerTools/jib/pull/2699#discussion_r469996705", "bodyText": "Yes. You can actually see it's what the current code does in StepsRunner. For example,\n  private void pushApplicationLayers() {\n    ProgressEventDispatcher.Factory childProgressDispatcherFactory =\n        Verify.verifyNotNull(rootProgressDispatcher).newChildProducer();\n\n    results.applicationLayerPushResults =\n        executorService.submit(\n            () ->\n                scheduleCallables(..., childProgressDispatcherFactory, ...)\n  }\nYou won't need Verify.verifyNotNull() in your case. For naming, since childProgressDispatcherFactory is already taken, I think progressDispatcherFactory works.", "author": "chanseokoh", "createdAt": "2020-08-13T14:31:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTk4OTE2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDAwNDY2OQ==", "url": "https://github.com/GoogleContainerTools/jib/pull/2699#discussion_r470004669", "bodyText": "Yes from the looks of it ,its creating a newProducer()  out side of the executorSubmiter", "author": "louismurerwa", "createdAt": "2020-08-13T14:42:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTk4OTE2NQ=="}], "type": "inlineReview"}, {"oid": "b3c7b619fd33ca6a64d725dcb6f45a8990af54ae", "url": "https://github.com/GoogleContainerTools/jib/commit/b3c7b619fd33ca6a64d725dcb6f45a8990af54ae", "message": "Style Fix", "committedDate": "2020-08-13T14:40:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDAwNDg4NQ==", "url": "https://github.com/GoogleContainerTools/jib/pull/2699#discussion_r470004885", "bodyText": "It's ok as long as you are not accessing progressDispatcher concurrently. Let's keep the previous code.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                pushImage(entry.getKey(), entry.getValue(), progressDispatcherFactory));\n          \n          \n            \n                                pushImage(entry.getKey(), entry.getValue(), progressDispatcherFactory.newChildProducer()));", "author": "chanseokoh", "createdAt": "2020-08-13T14:42:53Z", "path": "jib-core/src/main/java/com/google/cloud/tools/jib/builder/steps/StepsRunner.java", "diffHunk": "@@ -459,13 +503,24 @@ private void pushImages() {\n     results.buildResults =\n         executorService.submit(\n             () -> {\n+              // TODO: ideally, progressDispatcher should be closed at the right moment, after the\n+              // scheduled threads have completed. However, it can be tricky and cumbersome to track\n+              // completion, so it may just be better to delay closing until everything ends. At\n+              // least, we must ensure that it's not closed prematurely. (Garbage collection doesn't\n+              // auto-close it wit the current implementation.)\n+              ProgressEventDispatcher progressDispatcher =\n+                  childProgressDispatcherFactory.create(\n+                      \"scheduling pushing manifests\",\n+                      results.builtImagesAndBaseImages.get().size());\n+\n               realizeFutures(results.applicationLayerPushResults.get());\n \n               List<Future<BuildResult>> buildResults = new ArrayList<>();\n               for (Map.Entry<Future<Image>, Image> entry :\n                   results.builtImagesAndBaseImages.get().entrySet()) {\n+                Factory progressDispatcherFactory = progressDispatcher.newChildProducer();\n                 buildResults.add(\n-                    pushImage(entry.getKey(), entry.getValue(), childProgressDispatcherFactory));\n+                    pushImage(entry.getKey(), entry.getValue(), progressDispatcherFactory));", "originalCommit": "b3c7b619fd33ca6a64d725dcb6f45a8990af54ae", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDAxOTM3Nw==", "url": "https://github.com/GoogleContainerTools/jib/pull/2699#discussion_r470019377", "bodyText": "I see so its only in the executorSubmiter", "author": "louismurerwa", "createdAt": "2020-08-13T15:02:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDAwNDg4NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDAwNTI1NA==", "url": "https://github.com/GoogleContainerTools/jib/pull/2699#discussion_r470005254", "bodyText": "Ditto, for simplicity, just progressDispatcher.newChildProducer().", "author": "chanseokoh", "createdAt": "2020-08-13T14:43:24Z", "path": "jib-core/src/main/java/com/google/cloud/tools/jib/builder/steps/StepsRunner.java", "diffHunk": "@@ -336,17 +348,28 @@ private void pushBaseImageLayers() {\n     results.baseImagesAndLayerPushResults =\n         executorService.submit(\n             () -> {\n+              // TODO: ideally, progressDispatcher should be closed at the right moment, after the\n+              // scheduled threads have completed. However, it can be tricky and cumbersome to track\n+              // completion, so it may just be better to delay closing until everything ends. At\n+              // least, we must ensure that it's not closed prematurely. (Garbage collection doesn't\n+              // auto-close it wit the current implementation.)\n+              ProgressEventDispatcher progressDispatcher =\n+                  childProgressDispatcherFactory.create(\n+                      \"scheduling pushing base image layers\",\n+                      results.baseImagesAndLayers.get().size());\n+\n               Map<Image, List<Future<BlobDescriptor>>> pushResults = new HashMap<>();\n               for (Map.Entry<Image, List<Future<PreparedLayer>>> entry :\n                   results.baseImagesAndLayers.get().entrySet()) {\n+                Factory progressDispatcherFactory = progressDispatcher.newChildProducer();\n                 Image baseImage = entry.getKey();\n                 List<Future<PreparedLayer>> baseImageLayers = entry.getValue();\n \n                 List<Future<BlobDescriptor>> baseImageLayerPushResult =\n                     scheduleCallables(\n                         PushLayerStep.makeList(\n                             buildContext,\n-                            childProgressDispatcherFactory,\n+                            progressDispatcherFactory,", "originalCommit": "b3c7b619fd33ca6a64d725dcb6f45a8990af54ae", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDAwNTM5MQ==", "url": "https://github.com/GoogleContainerTools/jib/pull/2699#discussion_r470005391", "bodyText": "ditto", "author": "chanseokoh", "createdAt": "2020-08-13T14:43:33Z", "path": "jib-core/src/main/java/com/google/cloud/tools/jib/builder/steps/StepsRunner.java", "diffHunk": "@@ -304,22 +304,34 @@ private void pullBaseImages() {\n   private void obtainBaseImageLayers(boolean layersRequiredLocally) {\n     ProgressEventDispatcher.Factory childProgressDispatcherFactory =\n         Verify.verifyNotNull(rootProgressDispatcher).newChildProducer();\n+\n     results.baseImagesAndLayers =\n         executorService.submit(\n             () -> {\n+              // TODO: ideally, progressDispatcher should be closed at the right moment, after the\n+              // scheduled threads have completed. However, it can be tricky and cumbersome to track\n+              // completion, so it may just be better to delay closing until everything ends. At\n+              // least, we must ensure that it's not closed prematurely. (Garbage collection doesn't\n+              // auto-close it wit the current implementation.)\n+              ProgressEventDispatcher progressDispatcher =\n+                  childProgressDispatcherFactory.create(\n+                      \"scheduling obtaining base image layers\",\n+                      results.baseImagesAndRegistryClient.get().images.size());\n+\n               Map<Image, List<Future<PreparedLayer>>> baseImagesAndLayers = new HashMap<>();\n               for (Image image : results.baseImagesAndRegistryClient.get().images) {\n+                Factory progressDispatcherFactory = progressDispatcher.newChildProducer();\n                 List<Future<PreparedLayer>> layers =\n                     scheduleCallables(\n                         layersRequiredLocally\n                             ? ObtainBaseImageLayerStep.makeListForForcedDownload(\n                                 buildContext,\n-                                childProgressDispatcherFactory,\n+                                progressDispatcherFactory,", "originalCommit": "b3c7b619fd33ca6a64d725dcb6f45a8990af54ae", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDAwNjE2OA==", "url": "https://github.com/GoogleContainerTools/jib/pull/2699#discussion_r470006168", "bodyText": "ProgressEventDispatcher.Factory progress... = ...\nError Prone usually complains if an inner class name is too generic.", "author": "chanseokoh", "createdAt": "2020-08-13T14:44:38Z", "path": "jib-core/src/main/java/com/google/cloud/tools/jib/builder/steps/StepsRunner.java", "diffHunk": "@@ -371,15 +394,25 @@ private void buildImages() {\n     results.builtImagesAndBaseImages =\n         executorService.submit(\n             () -> {\n+              // TODO: ideally, progressDispatcher should be closed at the right moment, after the\n+              // scheduled threads have completed. However, it can be tricky and cumbersome to track\n+              // completion, so it may just be better to delay closing until everything ends. At\n+              // least, we must ensure that it's not closed prematurely. (Garbage collection doesn't\n+              // auto-close it wit the current implementation.)\n+              ProgressEventDispatcher progressDispatcher =\n+                  childProgressDispatcherFactory.create(\n+                      \"scheduling building manifests\", results.baseImagesAndLayers.get().size());\n+\n               Map<Future<Image>, Image> builtImagesAndBaseImages = new HashMap<>();\n               for (Map.Entry<Image, List<Future<PreparedLayer>>> entry :\n                   results.baseImagesAndLayers.get().entrySet()) {\n+                Factory progressDispatcherFactory = progressDispatcher.newChildProducer();", "originalCommit": "b3c7b619fd33ca6a64d725dcb6f45a8990af54ae", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "fe5b67662260a7bb433f176c3342261897009e67", "url": "https://github.com/GoogleContainerTools/jib/commit/fe5b67662260a7bb433f176c3342261897009e67", "message": "Progress Dispatcher Fix", "committedDate": "2020-08-13T14:55:42Z", "type": "commit"}, {"oid": "25b40635d100d2cb8f57c63d846e675427dab91d", "url": "https://github.com/GoogleContainerTools/jib/commit/25b40635d100d2cb8f57c63d846e675427dab91d", "message": "Style Fix", "committedDate": "2020-08-13T15:01:12Z", "type": "commit"}]}