{"pr_number": 2609, "pr_title": "Convert most collections to empty instead of optional", "pr_createdAt": "2020-07-23T01:18:18Z", "pr_url": "https://github.com/GoogleContainerTools/jib/pull/2609", "timeline": [{"oid": "3ef65d47b4be6bd141b617969d03ea4682c39125", "url": "https://github.com/GoogleContainerTools/jib/commit/3ef65d47b4be6bd141b617969d03ea4682c39125", "message": "Convert most collections to empty instead of optional\n\n- entrypoint and cmd are still optional as we have to\n  differentiate between the user trying to erase a\n  base image value vs not setting anything.", "committedDate": "2020-07-23T01:15:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTQ4NjUzMA==", "url": "https://github.com/GoogleContainerTools/jib/pull/2609#discussion_r459486530", "bodyText": "This confuses me. It says \"can be null\" and then \"set to empty\". Does \"empty\" mean an empty list? And what exactly \"override\" means?", "author": "chanseokoh", "createdAt": "2020-07-23T14:20:48Z", "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/buildfile/BuildFileSpec.java", "diffHunk": "@@ -66,12 +68,14 @@\n   @Nullable private BaseImageSpec from;\n   @Nullable private Instant creationTime;\n   @Nullable private ImageFormat format;\n-  @Nullable private Map<String, String> environment;\n-  @Nullable private Map<String, String> labels;\n-  @Nullable private Set<AbsoluteUnixPath> volumes;\n-  @Nullable private Set<Port> exposedPorts;\n+  private Map<String, String> environment;\n+  private Map<String, String> labels;\n+  private Set<AbsoluteUnixPath> volumes;\n+  private Set<Port> exposedPorts;\n   @Nullable private String user;\n   @Nullable private AbsoluteUnixPath workingDirectory;\n+  // these two specific collection can be null as they can be set to empty to override\n+  // the base image", "originalCommit": "3ef65d47b4be6bd141b617969d03ea4682c39125", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTQ4ODgwNQ==", "url": "https://github.com/GoogleContainerTools/jib/pull/2609#discussion_r459488805", "bodyText": "Use of ImmutableMap makes me wonder if it is possible to make all the fields of the class final? (Although using final on all the fields doesn't make this class an immutable one, but there is no reason not to do so if possible.) Or, is it not feasible due to JSON parsing?", "author": "chanseokoh", "createdAt": "2020-07-23T14:23:55Z", "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/buildfile/BuildFileSpec.java", "diffHunk": "@@ -124,14 +128,13 @@ public BuildFileSpec(\n     if (format != null) {\n       this.format = ImageFormat.valueOf(format);\n     }\n-    this.environment = environment;\n-    this.labels = labels;\n-    if (volumes != null) {\n-      this.volumes = volumes.stream().map(AbsoluteUnixPath::get).collect(Collectors.toSet());\n-    }\n-    if (exposedPorts != null) {\n-      this.exposedPorts = Ports.parse(exposedPorts);\n-    }\n+    this.environment = (environment == null) ? ImmutableMap.of() : environment;", "originalCommit": "3ef65d47b4be6bd141b617969d03ea4682c39125", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTUxNjc0Mw==", "url": "https://github.com/GoogleContainerTools/jib/pull/2609#discussion_r459516743", "bodyText": "No final should be on it. I guess I just never got around to doing it.", "author": "loosebazooka", "createdAt": "2020-07-23T15:01:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTQ4ODgwNQ=="}], "type": "inlineReview"}, {"oid": "8d401248c9eea2787657acfaa66fc1bc1aca53c5", "url": "https://github.com/GoogleContainerTools/jib/commit/8d401248c9eea2787657acfaa66fc1bc1aca53c5", "message": "final and better comments on nullable list", "committedDate": "2020-07-23T15:08:17Z", "type": "commit"}, {"oid": "655fb972c6db24f18551aa8610b58d8c95bd00b0", "url": "https://github.com/GoogleContainerTools/jib/commit/655fb972c6db24f18551aa8610b58d8c95bd00b0", "message": "formatting", "committedDate": "2020-07-23T15:12:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTU4NDA4Ng==", "url": "https://github.com/GoogleContainerTools/jib/pull/2609#discussion_r459584086", "bodyText": "Sorry, can we return ImmutableList here instead of List? Might be more secure to pass around immutable collections.", "author": "mpeddada1", "createdAt": "2020-07-23T16:41:16Z", "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/buildfile/PlatformSpec.java", "diffHunk": "@@ -85,15 +86,15 @@ public PlatformSpec(\n     return Optional.ofNullable(osVersion);\n   }\n \n-  public Optional<List<String>> getOsFeatures() {\n-    return Optional.ofNullable(osFeatures);\n+  public List<String> getOsFeatures() {", "originalCommit": "655fb972c6db24f18551aa8610b58d8c95bd00b0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTYxODY2Mg==", "url": "https://github.com/GoogleContainerTools/jib/pull/2609#discussion_r459618662", "bodyText": "That's a good question. Usually we use the base type interface on return values. That keeps implementation details from leaking out. However having said that, this is not an api that is exposed externally, so it could be okay. The other issue is that we don't know what kind of list the yaml parser returns, so we would have to wrap the list generated in the constructor  (https://github.com/GoogleContainerTools/jib/pull/2609/files#diff-784a41ae78bc030a7b61cd50c6a28e42R72) with a ImmutableList type.\nSo there's a lot going on here, and there's no obvious correct answer. It could go either way. In general though, we use the base type interface, and I just happened to continue to use that pattern.", "author": "loosebazooka", "createdAt": "2020-07-23T17:40:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTU4NDA4Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTY1NjQ5OQ==", "url": "https://github.com/GoogleContainerTools/jib/pull/2609#discussion_r459656499", "bodyText": "Thanks for the explanation! That makes sense:)", "author": "mpeddada1", "createdAt": "2020-07-23T18:47:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTU4NDA4Ng=="}], "type": "inlineReview"}]}