{"pr_number": 2337, "pr_title": "Migrate deprecated LayerConfiguration and LayerEntry usage", "pr_createdAt": "2020-03-17T17:14:45Z", "pr_url": "https://github.com/GoogleContainerTools/jib/pull/2337", "timeline": [{"oid": "efdc4b40850d617e665c99e05f5ed6ba29712a8b", "url": "https://github.com/GoogleContainerTools/jib/commit/efdc4b40850d617e665c99e05f5ed6ba29712a8b", "message": "Move build-plan packages", "committedDate": "2020-03-16T15:00:44Z", "type": "commit"}, {"oid": "28e9f356fed0e9a1d2689081b11999468a6fb510", "url": "https://github.com/GoogleContainerTools/jib/commit/28e9f356fed0e9a1d2689081b11999468a6fb510", "message": "Migrate to buildplan API classes", "committedDate": "2020-03-16T16:03:04Z", "type": "commit"}, {"oid": "151478d212c57d73d3e56b8988638292c0b086c2", "url": "https://github.com/GoogleContainerTools/jib/commit/151478d212c57d73d3e56b8988638292c0b086c2", "message": "Fix code format", "committedDate": "2020-03-16T16:11:15Z", "type": "commit"}, {"oid": "ec87824c1b2ff3c1c48fc2b9635937f1a3f00072", "url": "https://github.com/GoogleContainerTools/jib/commit/ec87824c1b2ff3c1c48fc2b9635937f1a3f00072", "message": "wip", "committedDate": "2020-03-16T16:41:57Z", "type": "commit"}, {"oid": "6529d4546d08b4804dd759a5dd785a8864a58a80", "url": "https://github.com/GoogleContainerTools/jib/commit/6529d4546d08b4804dd759a5dd785a8864a58a80", "message": "Merge branch 'master' into migrate-core-classes-in-jib-core", "committedDate": "2020-03-16T21:18:50Z", "type": "commit"}, {"oid": "b228223fbca0b4d10488e544c2e49c317eec7556", "url": "https://github.com/GoogleContainerTools/jib/commit/b228223fbca0b4d10488e544c2e49c317eec7556", "message": "Fix tests", "committedDate": "2020-03-16T21:25:35Z", "type": "commit"}, {"oid": "ed4c2c0cccf7c16306c79e5c5fa9085abfb53409", "url": "https://github.com/GoogleContainerTools/jib/commit/ed4c2c0cccf7c16306c79e5c5fa9085abfb53409", "message": "More migration", "committedDate": "2020-03-16T21:29:24Z", "type": "commit"}, {"oid": "c9b2153990263e62ec0cf6ba439acb0b3950b41a", "url": "https://github.com/GoogleContainerTools/jib/commit/c9b2153990263e62ec0cf6ba439acb0b3950b41a", "message": "format", "committedDate": "2020-03-16T21:37:57Z", "type": "commit"}, {"oid": "231889fad7f5c3c6a56deb0c4a3aafb3a9301906", "url": "https://github.com/GoogleContainerTools/jib/commit/231889fad7f5c3c6a56deb0c4a3aafb3a9301906", "message": "sourceProject(':jib-build-plan') in jib-gradle-plugin", "committedDate": "2020-03-16T21:53:33Z", "type": "commit"}, {"oid": "1f3b9bb821cbebf8c55f3bce952cafb51740b4ee", "url": "https://github.com/GoogleContainerTools/jib/commit/1f3b9bb821cbebf8c55f3bce952cafb51740b4ee", "message": "Consistency", "committedDate": "2020-03-16T22:04:08Z", "type": "commit"}, {"oid": "5994eb27a806ddb7d75d2cd828162bff46dea355", "url": "https://github.com/GoogleContainerTools/jib/commit/5994eb27a806ddb7d75d2cd828162bff46dea355", "message": "Deprecate LayerConfiguration and LayerEntry", "committedDate": "2020-03-16T22:49:54Z", "type": "commit"}, {"oid": "94e8adee09baf0cfd363f61f5b7aa8e255a3457c", "url": "https://github.com/GoogleContainerTools/jib/commit/94e8adee09baf0cfd363f61f5b7aa8e255a3457c", "message": "Complete migration", "committedDate": "2020-03-16T23:45:33Z", "type": "commit"}, {"oid": "607dd7fff384c41cc3437b076cf19f6337738251", "url": "https://github.com/GoogleContainerTools/jib/commit/607dd7fff384c41cc3437b076cf19f6337738251", "message": "CHANGELOG", "committedDate": "2020-03-16T23:46:33Z", "type": "commit"}, {"oid": "eeea488488e42a905a23d4b2af562dcef1ee5289", "url": "https://github.com/GoogleContainerTools/jib/commit/eeea488488e42a905a23d4b2af562dcef1ee5289", "message": "More migration", "committedDate": "2020-03-16T23:56:37Z", "type": "commit"}, {"oid": "cef70b05b322b5f9fdd00e6ce5b100f03971f555", "url": "https://github.com/GoogleContainerTools/jib/commit/cef70b05b322b5f9fdd00e6ce5b100f03971f555", "message": "Fix Javadoc", "committedDate": "2020-03-17T00:00:28Z", "type": "commit"}, {"oid": "dcd201a4bc7e364278556adce0eb881048a2dfdb", "url": "https://github.com/GoogleContainerTools/jib/commit/dcd201a4bc7e364278556adce0eb881048a2dfdb", "message": "Merge remote-tracking branch 'origin/master' into migrate-LayerConfiguration-LayerEntry", "committedDate": "2020-03-17T14:44:01Z", "type": "commit"}, {"oid": "55ed121dc7cc2fa16d11d93d568dc6622c8eaf95", "url": "https://github.com/GoogleContainerTools/jib/commit/55ed121dc7cc2fa16d11d93d568dc6622c8eaf95", "message": "Refactor", "committedDate": "2020-03-17T14:48:16Z", "type": "commit"}, {"oid": "62f1e35cb827c618aa0eaf1bf6cca6dda59cd8b5", "url": "https://github.com/GoogleContainerTools/jib/commit/62f1e35cb827c618aa0eaf1bf6cca6dda59cd8b5", "message": "Merge branch 'migrate-LayerConfiguration-LayerEntry' into migrate-LayerConfiguration-LayerEntry-complete", "committedDate": "2020-03-17T14:50:41Z", "type": "commit"}, {"oid": "21e0254c7b006083eb5c241425fff692b491d399", "url": "https://github.com/GoogleContainerTools/jib/commit/21e0254c7b006083eb5c241425fff692b491d399", "message": "Refactor 2", "committedDate": "2020-03-17T14:53:36Z", "type": "commit"}, {"oid": "737e7947428edbbaf36ccaacd79c7d34fa740cec", "url": "https://github.com/GoogleContainerTools/jib/commit/737e7947428edbbaf36ccaacd79c7d34fa740cec", "message": "Refactor 3", "committedDate": "2020-03-17T14:59:07Z", "type": "commit"}, {"oid": "216fb4340eb3d527c4133614be449acbd336aa6e", "url": "https://github.com/GoogleContainerTools/jib/commit/216fb4340eb3d527c4133614be449acbd336aa6e", "message": "Merge branch 'migrate-LayerConfiguration-LayerEntry' into migrate-LayerConfiguration-LayerEntry-complete", "committedDate": "2020-03-17T15:29:50Z", "type": "commit"}, {"oid": "ce28c53404a1a1a8eafce06123112f6880a2bbb4", "url": "https://github.com/GoogleContainerTools/jib/commit/ce28c53404a1a1a8eafce06123112f6880a2bbb4", "message": "More changes", "committedDate": "2020-03-17T17:12:13Z", "type": "commit"}, {"oid": "afa869b0f47d11e4a5a801633a59bc4b48f72880", "url": "https://github.com/GoogleContainerTools/jib/commit/afa869b0f47d11e4a5a801633a59bc4b48f72880", "message": "Revert CHANGELOG", "committedDate": "2020-03-17T18:08:20Z", "type": "commit"}, {"oid": "2de418f1252fd2630cadee6a7a42e7a81018f8c2", "url": "https://github.com/GoogleContainerTools/jib/commit/2de418f1252fd2630cadee6a7a42e7a81018f8c2", "message": "Merge remote-tracking branch 'origin/master' into migrate-LayerConfiguration-LayerEntry-complete", "committedDate": "2020-03-17T19:38:47Z", "type": "commit"}, {"oid": "df357893136a8176419c1efd3943db6b8ef49863", "url": "https://github.com/GoogleContainerTools/jib/commit/df357893136a8176419c1efd3943db6b8ef49863", "message": "Merge branch 'migrate-LayerConfiguration-LayerEntry-complete' of https://github.com/GoogleContainerTools/jib into migrate-LayerConfiguration-LayerEntry-complete", "committedDate": "2020-03-17T19:38:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDYyOTk5OA==", "url": "https://github.com/GoogleContainerTools/jib/pull/2337#discussion_r394629998", "bodyText": "should this call setFileEntriesLayers with the final result of the stream.collect?", "author": "loosebazooka", "createdAt": "2020-03-18T20:47:50Z", "path": "jib-core/src/main/java/com/google/cloud/tools/jib/api/JibContainerBuilder.java", "diffHunk": "@@ -167,36 +170,82 @@ public JibContainerBuilder addLayer(List<Path> files, String pathInContainer) th\n   /**\n    * Adds a layer (defined by a {@link LayerConfiguration}).\n    *\n+   * <p>Deprecated. Use {@link #addFileEntriesLayer(FileEntriesLayer)}.\n+   *\n    * @param layerConfiguration the {@link LayerConfiguration}\n    * @return this\n    */\n+  @Deprecated\n   public JibContainerBuilder addLayer(LayerConfiguration layerConfiguration) {\n-    layerConfigurations.add(layerConfiguration);\n+    layerConfigurations.add(layerConfiguration.toFileEntriesLayer());\n+    return this;\n+  }\n+\n+  /**\n+   * Adds a layer (defined by a {@link FileEntriesLayer}).\n+   *\n+   * @param layer the {@link FileEntriesLayer}\n+   * @return this\n+   */\n+  public JibContainerBuilder addFileEntriesLayer(FileEntriesLayer layer) {\n+    layerConfigurations.add(layer);\n     return this;\n   }\n \n   /**\n    * Sets the layers (defined by a list of {@link LayerConfiguration}s). This replaces any\n    * previously-added layers.\n    *\n+   * <p>Deprecated. Use {@link #setFileEntriesLayers(List)}.\n+   *\n    * @param layerConfigurations the list of {@link LayerConfiguration}s\n    * @return this\n    */\n+  @Deprecated\n   public JibContainerBuilder setLayers(List<LayerConfiguration> layerConfigurations) {\n-    this.layerConfigurations = new ArrayList<>(layerConfigurations);\n+    this.layerConfigurations =\n+        layerConfigurations\n+            .stream()\n+            .map(LayerConfiguration::toFileEntriesLayer)\n+            .collect(Collectors.toList());", "originalCommit": "df357893136a8176419c1efd3943db6b8ef49863", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDY1NDc1NQ==", "url": "https://github.com/GoogleContainerTools/jib/pull/2337#discussion_r394654755", "bodyText": "Makes sense. I just wanted to avoid creating an additional ArrayList in setFileEntriesLayers, but that's really negligible.\nAlso updated addLayer() to call addFileEntriesLayer() similarly.", "author": "chanseokoh", "createdAt": "2020-03-18T21:38:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDYyOTk5OA=="}], "type": "inlineReview"}, {"oid": "fbe398ae610ac2bbae7e1f66427edbbfb62b40a5", "url": "https://github.com/GoogleContainerTools/jib/commit/fbe398ae610ac2bbae7e1f66427edbbfb62b40a5", "message": "Call new function from deprecated one", "committedDate": "2020-03-18T21:38:22Z", "type": "commit"}]}