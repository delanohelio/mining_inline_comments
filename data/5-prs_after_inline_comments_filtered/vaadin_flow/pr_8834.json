{"pr_number": 8834, "pr_title": "Fix integer overflow in Data Provider page number formula", "pr_createdAt": "2020-08-10T12:59:14Z", "pr_url": "https://github.com/vaadin/flow/pull/8834", "timeline": [{"oid": "d6d6cba637c61cc88f401082f0922ab2dd2bf318", "url": "https://github.com/vaadin/flow/commit/d6d6cba637c61cc88f401082f0922ab2dd2bf318", "message": "Fix integer overflow in Data Provider page number formula", "committedDate": "2020-08-10T12:56:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODQwNjE4NQ==", "url": "https://github.com/vaadin/flow/pull/8834#discussion_r468406185", "bodyText": "Commenting here even though this is about lines 726-732, but I noticed this from the added test:\nIt seems that the pages are fetched even if the backend runs out of items. If this is intentional, I would expect to see it as a comment in the code below. Is it intentional ? I can understand if it would have some performance implications for us for checking if the page \"was full or not\", but on the other hand, bombing the backend with queries for pages that don't exist can have a price too ?\nBy minimum I would expect a comment in the code that mentions that whether this is intentional or not (for now).\nAnother thing is that is it documented somehow for the users ?\nThis behavior was a bit unexpected for me since it is perfectly fine that this method returns less items than what was requested and it there verifies the count anyway stopping any further requests, but it seems that this part in this method does not do it itself.", "author": "pleku", "createdAt": "2020-08-11T08:16:59Z", "path": "flow-data/src/main/java/com/vaadin/flow/data/provider/DataCommunicator.java", "diffHunk": "@@ -716,7 +716,7 @@ protected Object getFilter() {\n              * Divisor minus one is placed on numerator part to ensure upwards\n              * rounding.\n              */\n-            final int pages = (limit + pageSize - 1) / pageSize;\n+            final int pages = (limit - 1) / pageSize + 1;", "originalCommit": "d6d6cba637c61cc88f401082f0922ab2dd2bf318", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTAxNzk0OA==", "url": "https://github.com/vaadin/flow/pull/8834#discussion_r469017948", "bodyText": "Thanks for catching this. I believe it's just a mistake and there is no reason to send an extra requests to backend if it runs out of items. Non-sense backend requests have much more performance issues than converting Stream to collection and check the result size. So, yes, this should be fixed, possibly within this PR.", "author": "mshabarov", "createdAt": "2020-08-12T05:45:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODQwNjE4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTA4NjA5Ng==", "url": "https://github.com/vaadin/flow/pull/8834#discussion_r469086096", "bodyText": "As discussed in the daily - a TODO for the code and the test with issue reference will suffice for now.", "author": "pleku", "createdAt": "2020-08-12T08:17:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODQwNjE4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTE2NjU2NQ==", "url": "https://github.com/vaadin/flow/pull/8834#discussion_r469166565", "bodyText": "done", "author": "mshabarov", "createdAt": "2020-08-12T10:38:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODQwNjE4NQ=="}], "type": "inlineReview"}, {"oid": "4d57741ae0a0a5eb6b0fa4ddcc48d4b9821aa23d", "url": "https://github.com/vaadin/flow/commit/4d57741ae0a0a5eb6b0fa4ddcc48d4b9821aa23d", "message": "Added a reference to excessive page requests issue", "committedDate": "2020-08-12T08:57:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTE2NjA1OA==", "url": "https://github.com/vaadin/flow/pull/8834#discussion_r469166058", "bodyText": "Complete the task associated to this TODO comment.", "author": "vaadin-bot", "createdAt": "2020-08-12T10:36:54Z", "path": "flow-data/src/main/java/com/vaadin/flow/data/provider/DataCommunicator.java", "diffHunk": "@@ -727,6 +727,13 @@ protected Object getFilter() {\n                     final int newOffset = offset + page * pageSize;\n                     query = new QueryTrace(newOffset, pageSize, backEndSorting,\n                             inMemorySorting, filter);\n+                    /*\n+                    * TODO: DataProvider is still queried for next pages", "originalCommit": "4d57741ae0a0a5eb6b0fa4ddcc48d4b9821aa23d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}