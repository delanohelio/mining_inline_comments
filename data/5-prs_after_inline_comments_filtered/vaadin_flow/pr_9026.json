{"pr_number": 9026, "pr_title": "Set `display:none` in addition to `hidden` attribute when hiding elements inside a shadow root", "pr_createdAt": "2020-09-17T20:42:23Z", "pr_url": "https://github.com/vaadin/flow/pull/9026", "timeline": [{"oid": "bca448378467d6594ad38efa7a525edffd1ed985", "url": "https://github.com/vaadin/flow/commit/bca448378467d6594ad38efa7a525edffd1ed985", "message": "Add `visibility: none` in additional to `hidden` attribute for invisibility", "committedDate": "2020-09-17T09:48:14Z", "type": "commit"}, {"oid": "b8a39227b5ec97d48dcaec252ae76b8251e596a7", "url": "https://github.com/vaadin/flow/commit/b8a39227b5ec97d48dcaec252ae76b8251e596a7", "message": "Integration test", "committedDate": "2020-09-17T12:00:05Z", "type": "commit"}, {"oid": "b55fe75ce6c17ba8f85673b9a07cb705c40225f8", "url": "https://github.com/vaadin/flow/commit/b55fe75ce6c17ba8f85673b9a07cb705c40225f8", "message": "Only set 'display: none' if hidden element is inside a shadow root", "committedDate": "2020-09-17T21:23:05Z", "type": "commit"}, {"oid": "b55fe75ce6c17ba8f85673b9a07cb705c40225f8", "url": "https://github.com/vaadin/flow/commit/b55fe75ce6c17ba8f85673b9a07cb705c40225f8", "message": "Only set 'display: none' if hidden element is inside a shadow root", "committedDate": "2020-09-17T21:23:05Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDgwNDg5OQ==", "url": "https://github.com/vaadin/flow/pull/9026#discussion_r490804899", "bodyText": "Since there is a code which checks for shadow root would be good to mention it also here.", "author": "denis-anisimov", "createdAt": "2020-09-18T09:00:05Z", "path": "flow-server/src/main/java/com/vaadin/flow/internal/nodefeature/NodeProperties.java", "diffHunk": "@@ -87,6 +87,14 @@\n      */\n     public static final String VISIBILITY_HIDDEN_PROPERTY = \"hidden\";\n \n+    /**\n+     * The property used on the client side only in addition to\n+     * {@link #VISIBLE}. It stores the client side value of the CSS \"display\"\n+     * property to be able to restore when making a hidden element visible", "originalCommit": "b55fe75ce6c17ba8f85673b9a07cb705c40225f8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDkzMjcxNA==", "url": "https://github.com/vaadin/flow/pull/9026#discussion_r490932714", "bodyText": "Done.", "author": "joheriks", "createdAt": "2020-09-18T13:01:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDgwNDg5OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDg0NDM4OA==", "url": "https://github.com/vaadin/flow/pull/9026#discussion_r490844388", "bodyText": "double f type", "author": "bogdanudrescu", "createdAt": "2020-09-18T10:10:29Z", "path": "flow-client/src/main/java/com/vaadin/client/PolymerUtils.java", "diffHunk": "@@ -646,4 +646,20 @@ public static native void setProperty(Element element, String path,\n          element.set(path, value);\n      }-*/;\n \n+    /**\n+     * Returns true iff the element has a shadow root ancestor.", "originalCommit": "b55fe75ce6c17ba8f85673b9a07cb705c40225f8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDkzMjg1OQ==", "url": "https://github.com/vaadin/flow/pull/9026#discussion_r490932859", "bodyText": "Spelled out.", "author": "joheriks", "createdAt": "2020-09-18T13:01:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDg0NDM4OA=="}], "type": "inlineReview"}, {"oid": "424826c9abb63077875bd147f8c64c044b6380b1", "url": "https://github.com/vaadin/flow/commit/424826c9abb63077875bd147f8c64c044b6380b1", "message": "Check for display CSS is not added in existing GWT tests that assert hidden attribute present (not in shadowroot)", "committedDate": "2020-09-18T12:56:34Z", "type": "commit"}, {"oid": "00559bfa3cdd6265290cbf4531be3aea615dfdb9", "url": "https://github.com/vaadin/flow/commit/00559bfa3cdd6265290cbf4531be3aea615dfdb9", "message": "Minor fixes based on review", "committedDate": "2020-09-18T13:01:04Z", "type": "commit"}, {"oid": "97bf38fcc65200492de02c20640d47450c43ec64", "url": "https://github.com/vaadin/flow/commit/97bf38fcc65200492de02c20640d47450c43ec64", "message": "Corrected test comment", "committedDate": "2020-09-21T07:02:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTg1NzA3Ng==", "url": "https://github.com/vaadin/flow/pull/9026#discussion_r491857076", "bodyText": "I added an additional assertion that style={display:none} is not added in existing tests checking attribute hidden. This protects against regressions where it would be added unncessarily (for elements not in shadow root). Not sure how to set up a GWT test for the shadow root case.\n\nI think we need more GWT tests for this.\nIt's possible to emulate code with shadow root with this code or change one.\nYou may create Elements hierarchy so that one element in the hierarchy returns '[object ShadowRoot]'.\nJust fake it: create a fake toString  method and return this string from it.\nAnother way could be reimplement this method a bit so that it doesn't use toString but check whether an element has a parent whose shadowRoot  property is set to the element.\nThen it's also possible to fake shadowRoot.\nWe have quite many tests like that which fakes elements.\nSee e.g. GwtBasicElementBinderTest: initPolymer , addShadowRootElement, etc.\nWith mocking/faking it should be possible to write the same tests for display style as we already have for hidden.", "author": "denis-anisimov", "createdAt": "2020-09-21T08:05:58Z", "path": "flow-client/src/main/java/com/vaadin/client/PolymerUtils.java", "diffHunk": "@@ -646,4 +646,20 @@ public static native void setProperty(Element element, String path,\n          element.set(path, value);\n      }-*/;\n \n+    /**\n+     * Returns true if and only if the element has a shadow root ancestor.\n+     * \n+     * @param element\n+     *            the element to test\n+     * @return whether the element is in a shadow root\n+     */\n+    public static native boolean isInShadowRoot(Element element)", "originalCommit": "97bf38fcc65200492de02c20640d47450c43ec64", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTk5MjU2MQ==", "url": "https://github.com/vaadin/flow/pull/9026#discussion_r491992561", "bodyText": "Ok, thanks for the hints. Added two unit tests.", "author": "joheriks", "createdAt": "2020-09-21T12:08:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTg1NzA3Ng=="}], "type": "inlineReview"}, {"oid": "7099d79987f9fae2ccff41c3ff0ed5cbdb02db72", "url": "https://github.com/vaadin/flow/commit/7099d79987f9fae2ccff41c3ff0ed5cbdb02db72", "message": "Comment fix", "committedDate": "2020-09-21T09:17:35Z", "type": "commit"}, {"oid": "ec80684b3f210138670db1f71bef352a074c66f0", "url": "https://github.com/vaadin/flow/commit/ec80684b3f210138670db1f71bef352a074c66f0", "message": "Added two unit tests", "committedDate": "2020-09-21T12:07:42Z", "type": "commit"}]}