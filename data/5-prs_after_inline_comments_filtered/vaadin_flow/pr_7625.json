{"pr_number": 7625, "pr_title": "Read proxy config from .npmrc file", "pr_createdAt": "2020-02-18T22:57:42Z", "pr_url": "https://github.com/vaadin/flow/pull/7625", "timeline": [{"oid": "89366d384c31ad28cb5272db623a4e896019b2eb", "url": "https://github.com/vaadin/flow/commit/89366d384c31ad28cb5272db623a4e896019b2eb", "message": "Read proxy config from .npmrc file", "committedDate": "2020-02-18T22:55:28Z", "type": "commit"}, {"oid": "0caf8595232c514ff0c9746f4cbc710d59fe9515", "url": "https://github.com/vaadin/flow/commit/0caf8595232c514ff0c9746f4cbc710d59fe9515", "message": "Fix sonar issue", "committedDate": "2020-02-19T07:50:11Z", "type": "commit"}, {"oid": "5b66ed9f208ad992d44aedeb2a892ca7f5712fcb", "url": "https://github.com/vaadin/flow/commit/5b66ed9f208ad992d44aedeb2a892ca7f5712fcb", "message": "Merge branch 'master' into 7567-proxy-def", "committedDate": "2020-02-19T07:53:13Z", "type": "commit"}, {"oid": "32bfc4d9048c64141c5a2e93f5cf3fe06f222cc2", "url": "https://github.com/vaadin/flow/commit/32bfc4d9048c64141c5a2e93f5cf3fe06f222cc2", "message": "Fix Javadoc issues", "committedDate": "2020-02-19T08:01:50Z", "type": "commit"}, {"oid": "5c41e9339bc713353f81df9dd5f43814a6322c09", "url": "https://github.com/vaadin/flow/commit/5c41e9339bc713353f81df9dd5f43814a6322c09", "message": "Add more Javadoc", "committedDate": "2020-02-19T08:14:31Z", "type": "commit"}, {"oid": "24653abb45cf617862712f0a3ad55738a77b2a3e", "url": "https://github.com/vaadin/flow/commit/24653abb45cf617862712f0a3ad55738a77b2a3e", "message": "Add other sources of proxy config", "committedDate": "2020-02-19T09:45:24Z", "type": "commit"}, {"oid": "843987a1469bba92f8b3def05e1ee1ea53764608", "url": "https://github.com/vaadin/flow/commit/843987a1469bba92f8b3def05e1ee1ea53764608", "message": "Fix compile error", "committedDate": "2020-02-19T11:20:12Z", "type": "commit"}, {"oid": "acda81a836ea7460cd12f373711bcd6d0450bf62", "url": "https://github.com/vaadin/flow/commit/acda81a836ea7460cd12f373711bcd6d0450bf62", "message": "Refactor FrontendUtils.getProxies", "committedDate": "2020-02-19T13:48:05Z", "type": "commit"}, {"oid": "7c6a5c18405361cf8fa92d01bd01956989f356ec", "url": "https://github.com/vaadin/flow/commit/7c6a5c18405361cf8fa92d01bd01956989f356ec", "message": "Change FrontendUtils.getProxies so it returns all defined proxies", "committedDate": "2020-02-20T12:53:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTk4NDA2OQ==", "url": "https://github.com/vaadin/flow/pull/7625#discussion_r381984069", "bodyText": "Found reliance on default encoding in com.vaadin.flow.server.frontend.FrontendUtils.readProxySettingsFromNpmrcFile(String, File): new java.io.FileReader(File)", "author": "vaadin-bot", "createdAt": "2020-02-20T13:02:40Z", "path": "flow-server/src/main/java/com/vaadin/flow/server/frontend/FrontendUtils.java", "diffHunk": "@@ -426,9 +441,118 @@ protected static String installNode(File installDirectory,\n                 .toString();\n     }\n \n-    private static List<ProxyConfig.Proxy> getProxies() {\n-        // TODO: Implement proxy collection #7567\n-        return Collections.emptyList();\n+    /**\n+     * Read list of configured proxies in order from system properties, .npmrc\n+     * file in the project root folder, .npmrc file in user root folder and\n+     * system environment variables.\n+     *\n+     * @param baseDir\n+     *            project root folder.\n+     * @return list of configured proxies\n+     */\n+    // Not private because of test\n+    static List<ProxyConfig.Proxy> getProxies(String baseDir) {\n+        File projectNpmrc = new File(baseDir, \".npmrc\");\n+        File userNpmrc = new File(FileUtils.getUserDirectory(), \".npmrc\");\n+        List<ProxyConfig.Proxy> proxyList = new ArrayList<>();\n+\n+        proxyList.addAll(readProxySettingsFromSystemProperties());\n+        proxyList.addAll(\n+                readProxySettingsFromNpmrcFile(\"project .npmrc\", projectNpmrc));\n+        proxyList.addAll(\n+                readProxySettingsFromNpmrcFile(\"user .npmrc\", userNpmrc));\n+        proxyList.addAll(readProxySettingsFromEnvironmentVariables());\n+\n+        return proxyList;\n+    }\n+\n+    private static List<ProxyConfig.Proxy> readProxySettingsFromNpmrcFile(\n+            String fileDescription, File npmrc) {\n+        if (!npmrc.exists()) {\n+            return Collections.emptyList();\n+        }\n+\n+        try (FileReader fileReader = new FileReader(npmrc)) {", "originalCommit": "7c6a5c18405361cf8fa92d01bd01956989f356ec", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "693f1f8bb41845e02acee05708b4f12f2c3c66ed", "url": "https://github.com/vaadin/flow/commit/693f1f8bb41845e02acee05708b4f12f2c3c66ed", "message": "Add test for no noproxy case", "committedDate": "2020-02-20T13:41:20Z", "type": "commit"}]}