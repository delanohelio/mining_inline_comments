{"pr_number": 9393, "pr_title": "Merge master to offline feature branch", "pr_createdAt": "2020-11-12T20:05:42Z", "pr_url": "https://github.com/vaadin/flow/pull/9393", "timeline": [{"oid": "8003fd8a1acdc0b5662689544450f5d5351f4814", "url": "https://github.com/vaadin/flow/commit/8003fd8a1acdc0b5662689544450f5d5351f4814", "message": "chore: Update README with branch versions (#9148)\n\nUpdated `master` to reference version 5.0. Added a few missing branches/versions. Updated to table format.", "committedDate": "2020-10-23T05:47:11Z", "type": "commit"}, {"oid": "e5e2209ef5036d6a71c42635a136fa320b53e70f", "url": "https://github.com/vaadin/flow/commit/e5e2209ef5036d6a71c42635a136fa320b53e70f", "message": "chore: Update chrome to 86 (#9221)", "committedDate": "2020-10-23T08:37:33Z", "type": "commit"}, {"oid": "f2e8464ae2558bced508858479cf26db34d91345", "url": "https://github.com/vaadin/flow/commit/f2e8464ae2558bced508858479cf26db34d91345", "message": "fix: add maven plugin documentation (#9204)\n\nAdd documentation on maven plugin\r\ngoals and configuration options.\r\n\r\nFixes #8617", "committedDate": "2020-10-23T09:40:13Z", "type": "commit"}, {"oid": "f4d34f98905b55a34dd8319f739125ce5120d89a", "url": "https://github.com/vaadin/flow/commit/f4d34f98905b55a34dd8319f739125ce5120d89a", "message": "test: Fix duplicate registration (#9233)\n\nLock the registry when registering\r\ndynamic route in serviceInit to not have\r\na race where 2 inits note that path is not\r\nregistered and then try to register the route.\r\n\r\nFixes #9223", "committedDate": "2020-10-26T10:32:05Z", "type": "commit"}, {"oid": "a044f5d4c8029916b9f0b1e6c0e2c7ae62ddf133", "url": "https://github.com/vaadin/flow/commit/a044f5d4c8029916b9f0b1e6c0e2c7ae62ddf133", "message": "refactor: Remove log usage in embedded components (#9254)\n\n8d012f755ccf8b00288959bfa7bc6dd7a3f51284 removed some log and converted others into debug\r\nbut log in disconnectedCallback was left.", "committedDate": "2020-10-28T14:22:31Z", "type": "commit"}, {"oid": "9ee754f7c2352027dc5fe8b8a569b467ec3a575a", "url": "https://github.com/vaadin/flow/commit/9ee754f7c2352027dc5fe8b8a569b467ec3a575a", "message": "refactor: expose the items count API to components (#9257)\n\nExposes DataCommunicator::getDataProviderSize to the components, in order to get the items count taking into account the countCallback, if it has been set previously.\r\n\r\nRelated-to: vaadin/vaadin-flow-components#282", "committedDate": "2020-10-28T15:00:41Z", "type": "commit"}, {"oid": "970b73a7a159e90cb50dd959559b496fffbea550", "url": "https://github.com/vaadin/flow/commit/970b73a7a159e90cb50dd959559b496fffbea550", "message": "chore: unit test for devmode-not-ready page contents and type (#9266)", "committedDate": "2020-10-30T04:42:37Z", "type": "commit"}, {"oid": "427ca7840cb2ec4fea44e7bb81fef22cf9d41965", "url": "https://github.com/vaadin/flow/commit/427ca7840cb2ec4fea44e7bb81fef22cf9d41965", "message": "chore: do not depend on commons.lang3 (#9271)", "committedDate": "2020-11-03T05:11:12Z", "type": "commit"}, {"oid": "3fd66e0fb14b2fb7e11e92d198cc776f0fb14de5", "url": "https://github.com/vaadin/flow/commit/3fd66e0fb14b2fb7e11e92d198cc776f0fb14de5", "message": "chore: fix typo (#9272)\n\nFix typo in DataCommunicator::getDataProviderSize() javadoc.", "committedDate": "2020-11-03T06:36:05Z", "type": "commit"}, {"oid": "bb51a2b5d3e04e28994f1fc619e7cf0848596625", "url": "https://github.com/vaadin/flow/commit/bb51a2b5d3e04e28994f1fc619e7cf0848596625", "message": "fix: Sync HierarchicalDataCommunicator's expand state with client side (#9275)\n\nHierarchicalDataCommunicator's expanded state were not being synchronised with client side and TreeGrid's expanded nodes were being collapsed after re-attaching.\r\n\r\nWarranty: Sync TreeGrid expanded items state with the client side when detaching and reattaching\r\n\r\nFixes: https://github.com/vaadin/flow/issues/9175", "committedDate": "2020-11-03T07:37:28Z", "type": "commit"}, {"oid": "84f92fec423e12298c16c377e198e2906f316421", "url": "https://github.com/vaadin/flow/commit/84f92fec423e12298c16c377e198e2906f316421", "message": "chore: Bump version to 6.0-SNAPSHOT (#9279)", "committedDate": "2020-11-03T11:47:57Z", "type": "commit"}, {"oid": "9f7cfa76fd21d8d18338237e6e325c1eeaf5c21b", "url": "https://github.com/vaadin/flow/commit/9f7cfa76fd21d8d18338237e6e325c1eeaf5c21b", "message": "refactor: make web browser immutable (#9298)", "committedDate": "2020-11-04T15:17:40Z", "type": "commit"}, {"oid": "526792ad8bc7b481fa24e37fff034a5963a04616", "url": "https://github.com/vaadin/flow/commit/526792ad8bc7b481fa24e37fff034a5963a04616", "message": "feat: Create Flow plugins for webpack (#9295)\n\n* feat: Create Flow plugins for webpack\r\n\r\nMoved stats file handling to a custom plugin.\r\nAdded feature for copying custom Flow plugins\r\nfor use with webpack.\r\n\r\nFixes #9283", "committedDate": "2020-11-05T13:34:05Z", "type": "commit"}, {"oid": "0ad3b215d2487bab11477e9379d8b063581bb656", "url": "https://github.com/vaadin/flow/commit/0ad3b215d2487bab11477e9379d8b063581bb656", "message": "fix: AppShellConfigurator is now considered for theme endpoint (#9332)\n\nAppShellConfigurator is now also considered when\r\nscanning for annotations and deciding theme.\r\n\r\nFixes #9110", "committedDate": "2020-11-06T14:55:03Z", "type": "commit"}, {"oid": "73ebb9eaf052afa2ad9843153a21b70eab67ee29", "url": "https://github.com/vaadin/flow/commit/73ebb9eaf052afa2ad9843153a21b70eab67ee29", "message": "fix: fix TreeGrid updating wrong expanded items state on setDataProvider (#9336)\n\nFixes: #9328\r\nDetails: HierarchicalDataProvider's reset method was called before recreating the HierrarchyMapper in setDataProvider. This was creating wrong updates for the client side.", "committedDate": "2020-11-06T16:44:35Z", "type": "commit"}, {"oid": "c5f531937fe99ae7b49b2a7310abfccfdc5e5bcc", "url": "https://github.com/vaadin/flow/commit/c5f531937fe99ae7b49b2a7310abfccfdc5e5bcc", "message": "feat!: Theme annotation should be only on AppShellConfigurator (#9313)\n\nHaving the `@Theme` annotation on Flow views or router layouts will not be allowed anymore, it should be on `AppShellConfigurator` instead.\r\n\r\nFixes #9092", "committedDate": "2020-11-09T08:21:31Z", "type": "commit"}, {"oid": "5a385294ad6d12f81da3244d9941c0373587d6fa", "url": "https://github.com/vaadin/flow/commit/5a385294ad6d12f81da3244d9941c0373587d6fa", "message": "test(TypeScript): ensure CSRF token is updated when session is invalidated (#9329)\n\n* test(TypeScript): ensure CSRF token is updated when session is invalidated\r\n\r\nFixes #9164\r\n\r\n* add log message", "committedDate": "2020-11-10T16:45:00Z", "type": "commit"}, {"oid": "529f7111729fe68c3c3190d12b22e3d41fcb84b6", "url": "https://github.com/vaadin/flow/commit/529f7111729fe68c3c3190d12b22e3d41fcb84b6", "message": "fix: increase threshold for performance test (#9381)", "committedDate": "2020-11-11T12:21:19Z", "type": "commit"}, {"oid": "676f7529f1eafeb188d3cf3bb87be86ea7722af6", "url": "https://github.com/vaadin/flow/commit/676f7529f1eafeb188d3cf3bb87be86ea7722af6", "message": "fix: hide loading indicator when endpoint call fails (#9380)", "committedDate": "2020-11-11T17:01:04Z", "type": "commit"}, {"oid": "6608604b94af4f11013463dfdcf9521681ddb4e0", "url": "https://github.com/vaadin/flow/commit/6608604b94af4f11013463dfdcf9521681ddb4e0", "message": "feat: tree-shakeable ES imports for TS form validators (#9374)\n\n- Use tree-shakeable ES imports for TS form validators based on the latest version of validators lib.\r\n- Add missing `return` in the `submit()` method", "committedDate": "2020-11-11T18:45:51Z", "type": "commit"}, {"oid": "7f5b5ed3316b21fc4f5b85a2b00ab15356adb9bf", "url": "https://github.com/vaadin/flow/commit/7f5b5ed3316b21fc4f5b85a2b00ab15356adb9bf", "message": "feat: Theme can be defined as string or class (#9349)\n\nAdd a string definition for theme that matches the \"application theme\" in the theme folder inside /frontend/theme/, loading the css automatically from there. This is based on Lumo theme, always.\r\nChange old class based theme to use themeClass for theme selection.\r\n\r\nFixes #9281", "committedDate": "2020-11-12T07:42:40Z", "type": "commit"}, {"oid": "5b2d4d8259a2efb3de70ea9d38fda18c4979cac6", "url": "https://github.com/vaadin/flow/commit/5b2d4d8259a2efb3de70ea9d38fda18c4979cac6", "message": "fix!: Use data view filter and sorting only to that component (#9315)\n\nIn-memory filtering and sorting are now stored directly in component, which gives an opportunity to change it through the data view API for a certain component separately from other components bound to the same data provider.\r\n\r\nFixes #8655", "committedDate": "2020-11-12T08:01:31Z", "type": "commit"}, {"oid": "ff28dd041ce8f477b4a0734c37540cec71ea524d", "url": "https://github.com/vaadin/flow/commit/ff28dd041ce8f477b4a0734c37540cec71ea524d", "message": "fix: support Range requests with either start or end byte index omitted (#9368)\n\nSupports headers of the type Range: -123 and Range: 123-.\r\n\r\nFixes #9083.", "committedDate": "2020-11-12T08:30:21Z", "type": "commit"}, {"oid": "775db42f470f41f1e84fdcfd6f7cbdd978ab6866", "url": "https://github.com/vaadin/flow/commit/775db42f470f41f1e84fdcfd6f7cbdd978ab6866", "message": "refactor: revert 'Use data view filter and sorting only to that component' (#9390)\n\nRevert the changes for https://github.com/vaadin/flow/issues/8655 to be able to bump the version of components and avoid compile errors.", "committedDate": "2020-11-12T14:00:17Z", "type": "commit"}, {"oid": "4a040fe7238178996e7072e8dc11f290191d930f", "url": "https://github.com/vaadin/flow/commit/4a040fe7238178996e7072e8dc11f290191d930f", "message": "Merge branch 'master' into merge-master", "committedDate": "2020-11-12T20:04:36Z", "type": "commit"}, {"oid": "ea7d5c6ace26628da706bf335ec5bfef5e37df44", "url": "https://github.com/vaadin/flow/commit/ea7d5c6ace26628da706bf335ec5bfef5e37df44", "message": "chore: remove test module test-subcontext (#9394)\n\nThis module is subsumed by test-router-custom-context.", "committedDate": "2020-11-13T05:35:29Z", "type": "commit"}, {"oid": "1b26485146c7333e7527a1a02e22325a02c00e27", "url": "https://github.com/vaadin/flow/commit/1b26485146c7333e7527a1a02e22325a02c00e27", "message": "chore: update readme with discord link (#9382)", "committedDate": "2020-11-13T07:28:35Z", "type": "commit"}, {"oid": "3446cac2357f268fdbb8f7ac3f1ac4dc56ded6f5", "url": "https://github.com/vaadin/flow/commit/3446cac2357f268fdbb8f7ac3f1ac4dc56ded6f5", "message": "Merge branch 'master' into merge-master", "committedDate": "2020-11-13T07:52:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjgxNTAxMQ==", "url": "https://github.com/vaadin/flow/pull/9393#discussion_r522815011", "bodyText": "This block of commented-out lines of code should be removed.", "author": "vaadin-bot", "createdAt": "2020-11-13T09:03:15Z", "path": "flow-server/src/main/java/com/vaadin/flow/server/frontend/TaskInstallWebpackPlugins.java", "diffHunk": "@@ -0,0 +1,179 @@\n+/*\n+ * Copyright 2000-2020 Vaadin Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+package com.vaadin.flow.server.frontend;\n+\n+import java.io.File;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.io.UncheckedIOException;\n+import java.net.URL;\n+import java.nio.charset.StandardCharsets;\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n+\n+import org.apache.commons.io.FileUtils;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import elemental.json.Json;\n+import elemental.json.JsonArray;\n+import elemental.json.JsonObject;\n+import static com.vaadin.flow.server.Constants.PACKAGE_JSON;\n+import static java.nio.charset.StandardCharsets.UTF_8;\n+\n+/**\n+ * Task that installs any Flow webpack plugins into node_modules/@vaadin for\n+ * use with webpack compilation.\n+ * <p>\n+ * This should preferably be executed after npm installation to not make it skip\n+ * or have the plugins deleted by {@link TaskRunNpmInstall}.\n+ *\n+ * @since\n+ */\n+public class TaskInstallWebpackPlugins implements FallibleCommand {\n+\n+    private File nodeModulesFolder;\n+\n+    /**\n+     * Copy Flow webpack plugins into the given nodeModulesFolder.\n+     *\n+     * @param nodeModulesFolder\n+     *     node_modules folder to copy files to\n+     */\n+    public TaskInstallWebpackPlugins(File nodeModulesFolder) {\n+        this.nodeModulesFolder = nodeModulesFolder;\n+    }\n+\n+    @Override\n+    public void execute() {\n+        getPlugins().forEach(plugin -> {\n+            try {\n+                generatePluginFiles(plugin);\n+            } catch (IOException ioe) {\n+                throw new UncheckedIOException(\n+                    \"Installation of Flow webpack plugin '\" + plugin\n+                        + \"' failed\", ioe);\n+            }\n+        });\n+    }\n+\n+    /**\n+     * Get names for plugins to install into node_modules.\n+     *\n+     * @return names of plugins to install\n+     */\n+    protected List<String> getPlugins() {\n+        try {\n+            final JsonObject jsonFile = getJsonFile(\n+                \"plugins/webpack-plugins.json\");\n+            if (jsonFile == null) {\n+                log().error(\n+                    \"Couldn't locate plugins/webpack-plugins.json, no Webpack plugins for Flow will be installed.\"\n+                        + \"If webpack build fails validate flow-server jar content.\");\n+                return Collections.emptyList();\n+            }\n+\n+            final JsonArray plugins = jsonFile.getArray(\"plugins\");\n+            List<String> pluginsToInstall = new ArrayList<>(plugins.length());\n+            for (int i = 0; i < plugins.length(); i++) {\n+                pluginsToInstall.add(plugins.getString(i));\n+            }\n+            return pluginsToInstall;\n+        } catch (IOException ioe) {\n+            throw new UncheckedIOException(\n+                \"Couldn't load webpack-plugins.json file\", ioe);\n+        }\n+    }\n+\n+    private void generatePluginFiles(String pluginName) throws IOException {\n+        // Get the target folder where the plugin should be installed to\n+        File pluginTargetFile = new File(nodeModulesFolder,\n+            \"@vaadin/\" + pluginName);\n+\n+        final String pluginFolderName = \"plugins/\" + pluginName + \"/\";\n+        final JsonObject packageJson = getJsonFile(\n+            pluginFolderName + PACKAGE_JSON);\n+        if (packageJson == null) {\n+            log().error(\n+                \"Couldn't locate '{}' for plugin '{}'. Plugin will not be installed.\",\n+                PACKAGE_JSON, pluginName);\n+            return;\n+        }\n+\n+        // Validate installed version and don't override if same\n+        if (pluginTargetFile.exists() && new File(pluginTargetFile,\n+            PACKAGE_JSON).exists()) {\n+            String packageFile = FileUtils\n+                .readFileToString(new File(pluginTargetFile, PACKAGE_JSON),\n+                    StandardCharsets.UTF_8);\n+            final FrontendVersion packageVersion = new FrontendVersion(\n+                Json.parse(packageFile).getString(\"version\"));\n+            FrontendVersion pluginVersion = new FrontendVersion(\n+                packageJson.getString(\"version\"));\n+            if (packageVersion.isEqualTo(pluginVersion)) {\n+                log().debug(\n+                    \"Skipping install of {} for version {} already installed\",\n+                    pluginName, pluginVersion.getFullVersion());\n+                return;\n+            }\n+        }\n+\n+        // Create target folder if necessary\n+        FileUtils.forceMkdir(pluginTargetFile);\n+\n+        // copy only files named in package.json { files }", "originalCommit": "3446cac2357f268fdbb8f7ac3f1ac4dc56ded6f5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjgxNTAyNw==", "url": "https://github.com/vaadin/flow/pull/9393#discussion_r522815027", "bodyText": "A \"NullPointerException\" could be thrown; \"frontendDependencies\" is nullable here.", "author": "vaadin-bot", "createdAt": "2020-11-13T09:03:16Z", "path": "flow-server/src/main/java/com/vaadin/flow/server/frontend/NodeTasks.java", "diffHunk": "@@ -597,6 +600,9 @@ private NodeTasks(Builder builder) {\n                             builder.npmFolder, builder.generatedFolder,\n                             builder.frontendDirectory, builder.tokenFile,\n                             builder.tokenFileData, builder.enablePnpm));\n+\n+            commands.add(new TaskUpdateThemeImport(builder.npmFolder,\n+                frontendDependencies.getThemeDefinition()));", "originalCommit": "3446cac2357f268fdbb8f7ac3f1ac4dc56ded6f5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}