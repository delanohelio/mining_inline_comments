{"pr_number": 9650, "pr_title": "Support reusable application theme", "pr_createdAt": "2020-12-14T16:03:41Z", "pr_url": "https://github.com/vaadin/flow/pull/9650", "timeline": [{"oid": "f81f44d5ff30656b8787ca16f747eaabcc72ab4e", "url": "https://github.com/vaadin/flow/commit/f81f44d5ff30656b8787ca16f747eaabcc72ab4e", "message": "Copy theme files from jar to target folder", "committedDate": "2020-12-11T08:35:02Z", "type": "commit"}, {"oid": "c4b788fb58fb992eb3a26af4ae3d14c104e50ccf", "url": "https://github.com/vaadin/flow/commit/c4b788fb58fb992eb3a26af4ae3d14c104e50ccf", "message": "Clone theme from frontend/themes to resources/META-INF/themes", "committedDate": "2020-12-11T08:41:50Z", "type": "commit"}, {"oid": "18129cb539226b13ab58313a11b81642dc04e8fd", "url": "https://github.com/vaadin/flow/commit/18129cb539226b13ab58313a11b81642dc04e8fd", "message": "Allow packaging test-theme to jar file", "committedDate": "2020-12-11T08:59:31Z", "type": "commit"}, {"oid": "07a5b024445b387815fc8364cf769f5048ac89b9", "url": "https://github.com/vaadin/flow/commit/07a5b024445b387815fc8364cf769f5048ac89b9", "message": "Recorrect theme location inside META-INF", "committedDate": "2020-12-11T10:33:24Z", "type": "commit"}, {"oid": "b64660dbdfe0246b61941681746c39e30403a257", "url": "https://github.com/vaadin/flow/commit/b64660dbdfe0246b61941681746c39e30403a257", "message": "Add submodule for testing app theme reusable", "committedDate": "2020-12-11T14:58:16Z", "type": "commit"}, {"oid": "7786ea73f4b60cbea37991e9cbc9cef6a2f8570e", "url": "https://github.com/vaadin/flow/commit/7786ea73f4b60cbea37991e9cbc9cef6a2f8570e", "message": "Install test-themes jar file to .m2 local repo to use for reusable module", "committedDate": "2020-12-11T17:07:39Z", "type": "commit"}, {"oid": "fa3503b11a19887316e37a52577cb9506e593eeb", "url": "https://github.com/vaadin/flow/commit/fa3503b11a19887316e37a52577cb9506e593eeb", "message": "Rename theme to themes in target/flow-frontend", "committedDate": "2020-12-11T19:24:28Z", "type": "commit"}, {"oid": "cdb764e70e954e27c150e1aef187581eb69f1ab2", "url": "https://github.com/vaadin/flow/commit/cdb764e70e954e27c150e1aef187581eb69f1ab2", "message": "Merge branch 'master' into reusable-theme", "committedDate": "2020-12-14T10:45:17Z", "type": "commit"}, {"oid": "7fa163482b151b3ef93c1369076b54bccc66e822", "url": "https://github.com/vaadin/flow/commit/7fa163482b151b3ef93c1369076b54bccc66e822", "message": "Update reusable theme IT test", "committedDate": "2020-12-14T16:02:33Z", "type": "commit"}, {"oid": "5a7b0d51b3e6d5e4e0e58ec1ef1ff64f9377ba97", "url": "https://github.com/vaadin/flow/commit/5a7b0d51b3e6d5e4e0e58ec1ef1ff64f9377ba97", "message": "Update to latest structure", "committedDate": "2020-12-15T19:55:30Z", "type": "commit"}, {"oid": "1c8d9ab32d5c178baa07a5d8c94a1b90c52541a2", "url": "https://github.com/vaadin/flow/commit/1c8d9ab32d5c178baa07a5d8c94a1b90c52541a2", "message": "Merge branch 'master' into reusable-theme", "committedDate": "2020-12-15T19:56:57Z", "type": "commit"}, {"oid": "958536e0af427dfd28f84be2e1a8b87ff97b7f6a", "url": "https://github.com/vaadin/flow/commit/958536e0af427dfd28f84be2e1a8b87ff97b7f6a", "message": "Fix assets location when copying to VAADIN/static\n\nThe location should be as same as app theme in frontend/themes/.\nI.e. `target\\classes\\META-INF\\VAADIN\\static\\themes\\reusable-theme`.", "committedDate": "2020-12-16T08:40:33Z", "type": "commit"}, {"oid": "958536e0af427dfd28f84be2e1a8b87ff97b7f6a", "url": "https://github.com/vaadin/flow/commit/958536e0af427dfd28f84be2e1a8b87ff97b7f6a", "message": "Fix assets location when copying to VAADIN/static\n\nThe location should be as same as app theme in frontend/themes/.\nI.e. `target\\classes\\META-INF\\VAADIN\\static\\themes\\reusable-theme`.", "committedDate": "2020-12-16T08:40:33Z", "type": "forcePushed"}, {"oid": "d488a574057dea03b6a77c195074e8cd3893953c", "url": "https://github.com/vaadin/flow/commit/d488a574057dea03b6a77c195074e8cd3893953c", "message": "Fix unit tests", "committedDate": "2020-12-16T09:57:52Z", "type": "commit"}, {"oid": "9bbe260c35a5e1c0ba156365ca0018718141499d", "url": "https://github.com/vaadin/flow/commit/9bbe260c35a5e1c0ba156365ca0018718141499d", "message": "Merge branch 'master' into reusable-theme", "committedDate": "2020-12-16T16:00:21Z", "type": "commit"}, {"oid": "4eac0f69aed9407b8eb53bc233c640c73feed6e6", "url": "https://github.com/vaadin/flow/commit/4eac0f69aed9407b8eb53bc233c640c73feed6e6", "message": "Move reusable-theme to be packaged in test-resources module", "committedDate": "2020-12-16T17:41:58Z", "type": "commit"}, {"oid": "b5e269d469b2fea457e0636aa37e6dce484c395e", "url": "https://github.com/vaadin/flow/commit/b5e269d469b2fea457e0636aa37e6dce484c395e", "message": "Clean up", "committedDate": "2020-12-16T20:36:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDg0MzYzOA==", "url": "https://github.com/vaadin/flow/pull/9650#discussion_r544843638", "bodyText": "fontawesome should be in the reusable jar in a file Dependencies.java themable can be here as it's a vaadin component dependency if I remember correctly, might not even need it at all anymore as we use actual component implementations from npm.", "author": "caalador", "createdAt": "2020-12-17T06:30:11Z", "path": "flow-tests/test-application-theme/test-theme-reusable/src/main/java/com/vaadin/flow/uitest/ui/theme/AppShell.java", "diffHunk": "@@ -0,0 +1,27 @@\n+/*\n+ * Copyright 2000-2020 Vaadin Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+package com.vaadin.flow.uitest.ui.theme;\n+\n+import com.vaadin.flow.component.dependency.NpmPackage;\n+import com.vaadin.flow.component.page.AppShellConfigurator;\n+import com.vaadin.flow.theme.Theme;\n+\n+@Theme(value = \"reusable-theme\")\n+@NpmPackage(value = \"@vaadin/vaadin-themable-mixin\", version = \"1.6.1\")\n+@NpmPackage(value = \"@fortawesome/fontawesome-free\", version = \"5.15.1\")", "originalCommit": "b5e269d469b2fea457e0636aa37e6dce484c395e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDk0OTE4Mw==", "url": "https://github.com/vaadin/flow/pull/9650#discussion_r544949183", "bodyText": "Removed.", "author": "tanbt", "createdAt": "2020-12-17T09:44:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDg0MzYzOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDg0NjU4MA==", "url": "https://github.com/vaadin/flow/pull/9650#discussion_r544846580", "bodyText": "Not applicable test for reusabel-theme", "author": "caalador", "createdAt": "2020-12-17T06:38:06Z", "path": "flow-tests/test-application-theme/test-theme-reusable/src/test/java/com/vaadin/flow/uitest/ui/theme/ReusableThemeIT.java", "diffHunk": "@@ -0,0 +1,198 @@\n+/*\n+ * Copyright 2000-2020 Vaadin Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+package com.vaadin.flow.uitest.ui.theme;\n+\n+import org.junit.Assert;\n+import org.junit.Test;\n+import org.openqa.selenium.By;\n+import org.openqa.selenium.JavascriptExecutor;\n+import org.openqa.selenium.WebElement;\n+\n+import com.vaadin.flow.component.html.testbench.ImageElement;\n+import com.vaadin.flow.component.html.testbench.SpanElement;\n+import com.vaadin.flow.testutil.ChromeBrowserTest;\n+import com.vaadin.testbench.TestBenchElement;\n+\n+import static com.vaadin.flow.uitest.ui.theme.ReusableThemeView.BUTTERFLY_ID;\n+import static com.vaadin.flow.uitest.ui.theme.ReusableThemeView.FONTAWESOME_ID;\n+import static com.vaadin.flow.uitest.ui.theme.ReusableThemeView.MY_LIT_ID;\n+import static com.vaadin.flow.uitest.ui.theme.ReusableThemeView.MY_POLYMER_ID;\n+import static com.vaadin.flow.uitest.ui.theme.ReusableThemeView.SNOWFLAKE_ID;\n+import static com.vaadin.flow.uitest.ui.theme.ReusableThemeView.OCTOPUSS_ID;\n+import static com.vaadin.flow.uitest.ui.theme.ReusableThemeView.SUB_COMPONENT_ID;\n+\n+public class ReusableThemeIT extends ChromeBrowserTest {\n+\n+    @Test\n+    public void typeScriptCssImport_stylesAreApplied() {", "originalCommit": "b5e269d469b2fea457e0636aa37e6dce484c395e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDk0OTY4MQ==", "url": "https://github.com/vaadin/flow/pull/9650#discussion_r544949681", "bodyText": "Removed.", "author": "tanbt", "createdAt": "2020-12-17T09:45:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDg0NjU4MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDg0NzQ2OQ==", "url": "https://github.com/vaadin/flow/pull/9650#discussion_r544847469", "bodyText": "not in folder structure com/vaadin/apptheme/reusabletheme  instead in a folder com.vaadin.apptheme.reusabletheme\nThis should be in the reusable module.", "author": "caalador", "createdAt": "2020-12-17T06:40:20Z", "path": "flow-tests/test-resources/src/main/java/com.vaadin.apptheme.reusabletheme/Dependency.java", "diffHunk": "@@ -0,0 +1,8 @@\n+package org.vaadin.apptheme.reusabletheme;", "originalCommit": "b5e269d469b2fea457e0636aa37e6dce484c395e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDk4OTY5OA==", "url": "https://github.com/vaadin/flow/pull/9650#discussion_r544989698", "bodyText": "Moved to reusable module.", "author": "tanbt", "createdAt": "2020-12-17T10:44:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDg0NzQ2OQ=="}], "type": "inlineReview"}, {"oid": "f4589ed2700736a63f569020580e8dec4384075d", "url": "https://github.com/vaadin/flow/commit/f4589ed2700736a63f569020580e8dec4384075d", "message": "Merge branch 'master' into reusable-theme", "committedDate": "2020-12-17T08:33:25Z", "type": "commit"}, {"oid": "808b9f1e4cecc3a6e20461fc212bc2fbc47f6c8a", "url": "https://github.com/vaadin/flow/commit/808b9f1e4cecc3a6e20461fc212bc2fbc47f6c8a", "message": "Update flow-tests/test-application-theme/pom.xml\n\nCo-authored-by: caalador <mikael.grankvist@gmail.com>", "committedDate": "2020-12-17T09:36:19Z", "type": "commit"}, {"oid": "36e712dad137dc66d6216385ac5d06ad3d006041", "url": "https://github.com/vaadin/flow/commit/36e712dad137dc66d6216385ac5d06ad3d006041", "message": "Move reusable theme to its own module", "committedDate": "2020-12-17T10:44:46Z", "type": "commit"}, {"oid": "64a411c6106c49838d0b450c193cba0e803b3a77", "url": "https://github.com/vaadin/flow/commit/64a411c6106c49838d0b450c193cba0e803b3a77", "message": "Not build reusable-theme outside of its parent module", "committedDate": "2020-12-17T11:30:02Z", "type": "commit"}, {"oid": "2bdf9ad8e9ee4af4687b2dddef2caac9cf75d173", "url": "https://github.com/vaadin/flow/commit/2bdf9ad8e9ee4af4687b2dddef2caac9cf75d173", "message": "Merge branch 'master' into reusable-theme", "committedDate": "2020-12-17T13:16:19Z", "type": "commit"}, {"oid": "61c0b9f8fa15b07d6b21c5ca56c41255d8df9ba7", "url": "https://github.com/vaadin/flow/commit/61c0b9f8fa15b07d6b21c5ca56c41255d8df9ba7", "message": "Merge branch 'master' into reusable-theme", "committedDate": "2020-12-17T16:13:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTY2MzgxMQ==", "url": "https://github.com/vaadin/flow/pull/9650#discussion_r545663811", "bodyText": "@taefi  is running for this to be in FrontendUtils.\n\nOf course, agree to define it once, but I have a feeling that it is better to define it here since many other\ndefault/hardcoded path and folder constants defined in this file, e.g. NODE_MODULES, FRONTEND,\nDEFAULT_NODE_DIR, DEFAULT_FRONTEND_DIR, etc. I propose to keep it here but rename it to\nAPPLICATION_THEME_ROOT as Tan defined.", "author": "caalador", "createdAt": "2020-12-18T08:44:31Z", "path": "flow-server/src/main/java/com/vaadin/flow/server/Constants.java", "diffHunk": "@@ -240,6 +240,16 @@\n      */\n     public static final String RESOURCES_FRONTEND_DEFAULT = \"META-INF/frontend\";\n \n+    /**\n+     * The name of the application theme root folder.\n+     */\n+    public static final String APPLICATION_THEME_ROOT = \"themes\";", "originalCommit": "61c0b9f8fa15b07d6b21c5ca56c41255d8df9ba7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTcyMDg5Mw==", "url": "https://github.com/vaadin/flow/pull/9650#discussion_r545720893", "bodyText": "So should I move this constant to FrontendUtils? Or @taefi  will do that in his PR?", "author": "tanbt", "createdAt": "2020-12-18T09:51:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTY2MzgxMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTcyNzYzMg==", "url": "https://github.com/vaadin/flow/pull/9650#discussion_r545727632", "bodyText": "Please resolve this kind of trivial issues as fast as possible by e.g. just agreeing over Slack", "author": "pleku", "createdAt": "2020-12-18T10:03:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTY2MzgxMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTcyNDcwNg==", "url": "https://github.com/vaadin/flow/pull/9650#discussion_r545724706", "bodyText": "non-blocking: I'm not sure if this related to this PR (?) but the comment should have been changed too", "author": "pleku", "createdAt": "2020-12-18T09:57:44Z", "path": "flow-server/src/main/java/com/vaadin/flow/server/frontend/TaskUpdateImports.java", "diffHunk": "@@ -134,7 +134,7 @@ protected void writeImportLines(List<String> lines) {\n \n             if (themeDef != null && !\"\".equals(themeDef.getName())) {\n                 // If we define a theme name we need to import theme/theme-generated.js\n-                lines.add(\"import {applyTheme} from 'theme/theme-generated.js';\");\n+                lines.add(\"import {applyTheme} from 'themes/theme-generated.js';\");", "originalCommit": "61c0b9f8fa15b07d6b21c5ca56c41255d8df9ba7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}