{"pr_number": 9549, "pr_title": "chore: merge master", "pr_createdAt": "2020-12-01T11:17:05Z", "pr_url": "https://github.com/vaadin/flow/pull/9549", "timeline": [{"oid": "fb1d15b9b4a71fd6ae354d5dd0b96ce847ccdd08", "url": "https://github.com/vaadin/flow/commit/fb1d15b9b4a71fd6ae354d5dd0b96ce847ccdd08", "message": "chore: fix outdated AppShell javadoc (#9453)", "committedDate": "2020-11-20T12:11:23Z", "type": "commit"}, {"oid": "f44b01af736f2df56470cd0be2d5163b08c239df", "url": "https://github.com/vaadin/flow/commit/f44b01af736f2df56470cd0be2d5163b08c239df", "message": "test: add test for setting global font (#9436)\n\nFixes #9409", "committedDate": "2020-11-20T12:37:14Z", "type": "commit"}, {"oid": "4e4c2b8e3db8fd99e62d3bf89123fe16917b92aa", "url": "https://github.com/vaadin/flow/commit/4e4c2b8e3db8fd99e62d3bf89123fe16917b92aa", "message": "fix race-condition in IT-Tests (#9416)\n\nSigned-off-by: Stefan Bischof <stbischof@bipolis.org>", "committedDate": "2020-11-21T16:40:36Z", "type": "commit"}, {"oid": "16912c85fe31640e2ff0a087eb598450e2e1b318", "url": "https://github.com/vaadin/flow/commit/16912c85fe31640e2ff0a087eb598450e2e1b318", "message": "fix: mark tests that should not be executed in OSGi (#9456)\n\n* fix: mark tests that should not be executed in OSGi\r\n\r\n* fix: don't use push in route not found error page in OSGi\r\n\r\n* fix: avoid route with wildcard parameter which doesn't work in OSGi\r\n\r\n* fix: exclude wildcard parameter IT and devmode IT\r\n\r\n* fix: exclude \"context\" resource IT from OSGi tests", "committedDate": "2020-11-23T08:40:29Z", "type": "commit"}, {"oid": "46733021e4a6097b63f6877910c7dbd36431789d", "url": "https://github.com/vaadin/flow/commit/46733021e4a6097b63f6877910c7dbd36431789d", "message": "fix: make annotation packages optional in OSGi (#9465)\n\nAlso fix test to first open page before checking client.\r\n\r\nfixes #9463", "committedDate": "2020-11-23T12:38:00Z", "type": "commit"}, {"oid": "b6f1765331b39138d39f556d268adb60009aaf5d", "url": "https://github.com/vaadin/flow/commit/b6f1765331b39138d39f556d268adb60009aaf5d", "message": "fix: made VaadinRequest available in endpoint (#9442)\n\n* fix: made vaadinrequest available in endpoint\r\n\r\n* clear VaadinRequest instance after endpoint call", "committedDate": "2020-11-23T14:46:52Z", "type": "commit"}, {"oid": "af83fa6165f1e3f427b483a7d6a781c152f82aa7", "url": "https://github.com/vaadin/flow/commit/af83fa6165f1e3f427b483a7d6a781c152f82aa7", "message": "chore: remove mentions of \u201cConnect\u201d (#9151)\n\n* Rename \u201cConnect\u201d to \u201cFusion\u201d\r\n\r\n* Remove \u201cFusion\u201d naming", "committedDate": "2020-11-23T16:59:32Z", "type": "commit"}, {"oid": "18ee55985eaafba645535560d0ee7954406e2aa3", "url": "https://github.com/vaadin/flow/commit/18ee55985eaafba645535560d0ee7954406e2aa3", "message": "feat: Serve theme static files from VAADIN/static (#9451)\n\nStatic files in META-INF/VAADIN/static will now be served\r\non request to VAADIN/static.\r\nAdded new webpack loader that changes app theme\r\ncss urls targeting ./ and ../ to be VAADIN/static/ instead.\r\nWhere ../ can not go outside of the application theme folder.\r\n\r\nFixes #9405", "committedDate": "2020-11-24T06:09:24Z", "type": "commit"}, {"oid": "cdb7c1fd537bb5dda3b88b4666672ae4db8c81f2", "url": "https://github.com/vaadin/flow/commit/cdb7c1fd537bb5dda3b88b4666672ae4db8c81f2", "message": "refactor: Remove OSGi code from flow-server (#9472)\n\n* refactor: Remove OSGi code from flow-server\r\n\r\nFixes #9219", "committedDate": "2020-11-24T07:17:37Z", "type": "commit"}, {"oid": "b33dec014ed3c183698f48fdb1156666f24841d0", "url": "https://github.com/vaadin/flow/commit/b33dec014ed3c183698f48fdb1156666f24841d0", "message": "chore: update Flow versions description (#9469)", "committedDate": "2020-11-24T08:14:42Z", "type": "commit"}, {"oid": "62e1e2693c773c1368ab0e716c74680f76b690d5", "url": "https://github.com/vaadin/flow/commit/62e1e2693c773c1368ab0e716c74680f76b690d5", "message": "feat: Theme component with app theme. (#9418)\n\nAdded the feature that you can theme components\r\nwith the app theme by creating a css file in\r\n'frontend/theme/myTheme/components' with the\r\ncomponent tag name e.g. 'my-field'  should have 'my-field.css'\r\n\r\nFixes #9348", "committedDate": "2020-11-24T08:18:29Z", "type": "commit"}, {"oid": "26aacd3cdf51c7e0a18ae21318d366ce7f91be8a", "url": "https://github.com/vaadin/flow/commit/26aacd3cdf51c7e0a18ae21318d366ce7f91be8a", "message": "fix: check whether class implements an interface first directly (#9486)\n\nPart of #9480", "committedDate": "2020-11-25T06:35:24Z", "type": "commit"}, {"oid": "0f6645b519d556b8bfe82d7e3d168ae1b2e5f0d0", "url": "https://github.com/vaadin/flow/commit/0f6645b519d556b8bfe82d7e3d168ae1b2e5f0d0", "message": "fix: remove instance field from singleton IndexHtmlRequestHandler (#9475)\n\n* fix: remove instance field from singleton IndexHtmlRequestHandler\r\n\r\n* apply code review suggestions", "committedDate": "2020-11-25T08:03:45Z", "type": "commit"}, {"oid": "463fb0009d1ce93d503b5ce96506317605fa5a33", "url": "https://github.com/vaadin/flow/commit/463fb0009d1ce93d503b5ce96506317605fa5a33", "message": "Stop logging error when updating dev dependencies (#9476)\n\nAs there is a conflict with the dependencies and prevent adding\r\nthe flow-dev-dependencies package to the platform (#9345), this will hide\r\nthe unavoidable error that was logged for Vaadin apps.\r\n \r\nFixes #9251", "committedDate": "2020-11-25T08:29:42Z", "type": "commit"}, {"oid": "9e2a67a8f1c32515cd2a6ede45a070c565d18dfd", "url": "https://github.com/vaadin/flow/commit/9e2a67a8f1c32515cd2a6ede45a070c565d18dfd", "message": "fix: optimize handling of requests containing Range header (#9484)\n\nMore efficient parsing of the header value. Also, range count is capped at 16\r\n(additional will be ignored) and overlapping ranges at 2 (request will be denied\r\nif above).", "committedDate": "2020-11-25T11:54:36Z", "type": "commit"}, {"oid": "f7449d932f41d8d1e63e2845f6ae184cc34bb773", "url": "https://github.com/vaadin/flow/commit/f7449d932f41d8d1e63e2845f6ae184cc34bb773", "message": "fix: Correct regexp to only match when digit first (#9496)\n\nUse Matcher::find instead of Matcher::matches as matches never matched.\r\n\r\nFixes #9494", "committedDate": "2020-11-26T08:31:41Z", "type": "commit"}, {"oid": "64c38f6cfa3ef9b265912d83647acc329190ef30", "url": "https://github.com/vaadin/flow/commit/64c38f6cfa3ef9b265912d83647acc329190ef30", "message": "test: add test that external urls are not touched (#9482)\n\nAdded test that we don't touch external\r\nurls (relative or abosolute).\r\nMoved flow to be under path so we can have\r\njetty serve \"external\" resources.\r\n\r\nFixes #9430", "committedDate": "2020-11-26T09:08:20Z", "type": "commit"}, {"oid": "ef55c46aa29fc6ca620991c82e008f19742e23d0", "url": "https://github.com/vaadin/flow/commit/ef55c46aa29fc6ca620991c82e008f19742e23d0", "message": "fix: Add polyfill for constructable stylesheets (#9489)\n\nAdd the constructable stylesheets polyfill so\r\napp theme also works with non chrome based browsers.\r\n\r\nFixes #9488", "committedDate": "2020-11-26T09:35:11Z", "type": "commit"}, {"oid": "47e9a17b337d0099c31defec9e7786d23fa0570f", "url": "https://github.com/vaadin/flow/commit/47e9a17b337d0099c31defec9e7786d23fa0570f", "message": "fix: Initialize VaadinServlet after Lookup is available (#9500)\n\nfix: don't initialize Vaadin servlet until Lookup is not available", "committedDate": "2020-11-26T12:37:13Z", "type": "commit"}, {"oid": "34448ea319e233cd7f7ff93a0d0c0f7abac3372f", "url": "https://github.com/vaadin/flow/commit/34448ea319e233cd7f7ff93a0d0c0f7abac3372f", "message": "feat: Enable adding assets from node_modules (#9495)\n\n* feat: Enable adding assets from node_modules\r\n\r\nIt is now possible to import resources from\r\ninstalled node_modules by adding the asset to\r\ntheme/my-theme/theme.json\r\n\r\nFixes #9468\r\n\r\n* Add comment to doc on copyStaticAssets\r\n\r\n* Fix url expectation after merge\r\n\r\n* format lines", "committedDate": "2020-11-26T14:47:23Z", "type": "commit"}, {"oid": "3007af7ba565dab177d9c1602a304938b1138b01", "url": "https://github.com/vaadin/flow/commit/3007af7ba565dab177d9c1602a304938b1138b01", "message": "test: add unit test for clear all in the servlet init method (#9507)", "committedDate": "2020-11-26T14:52:12Z", "type": "commit"}, {"oid": "899a6ea8fd546addbe9210dcbbfc21f57165ba50", "url": "https://github.com/vaadin/flow/commit/899a6ea8fd546addbe9210dcbbfc21f57165ba50", "message": "Fix: fix file system traversal of theme-loader to stop at root (#9505)\n\nThe theme-loader recursion for themeFolder should stop\r\nat the root level. Also if no theme folder found we should\r\nnot spend time on replacement.", "committedDate": "2020-11-26T15:49:32Z", "type": "commit"}, {"oid": "18ef55f477be20e62c9e39d7f0913de4bad7abac", "url": "https://github.com/vaadin/flow/commit/18ef55f477be20e62c9e39d7f0913de4bad7abac", "message": "fix: enable PlainScriptViaJavaScriptIT in OSGi (#9520)\n\nfixes #9461", "committedDate": "2020-11-27T12:53:03Z", "type": "commit"}, {"oid": "f4465264dc7c1978390b857dbe2d66fe9c07e2f8", "url": "https://github.com/vaadin/flow/commit/f4465264dc7c1978390b857dbe2d66fe9c07e2f8", "message": "fix: enable PushRouteWildcardParameterIT in OSGi (#9518)\n\nfixes #9459", "committedDate": "2020-11-30T06:44:15Z", "type": "commit"}, {"oid": "a2da02bc4422fa27abda8c5ac08d6bbcb628929c", "url": "https://github.com/vaadin/flow/commit/a2da02bc4422fa27abda8c5ac08d6bbcb628929c", "message": "fix: enable BaseHref IT back (#9515)\n\nFixes #9458", "committedDate": "2020-11-30T06:44:38Z", "type": "commit"}, {"oid": "7f35c6e0ed3535aee25a44362ab26320f76e4132", "url": "https://github.com/vaadin/flow/commit/7f35c6e0ed3535aee25a44362ab26320f76e4132", "message": "chore: Add information on logging in webpack (#9527)\n\nAdded information on log levels\r\nwith webpack loaders and plugins.", "committedDate": "2020-11-30T11:01:51Z", "type": "commit"}, {"oid": "4c65750be3605bb3a60a1d0c040620c32bc8e207", "url": "https://github.com/vaadin/flow/commit/4c65750be3605bb3a60a1d0c040620c32bc8e207", "message": "test: fix test class and register view servlet with a context in OSGi (#9528)\n\nPart of vaadin/osgi#5", "committedDate": "2020-11-30T13:50:35Z", "type": "commit"}, {"oid": "2589a18dd7a0dde7f09211528b18b1579fbd7a2a", "url": "https://github.com/vaadin/flow/commit/2589a18dd7a0dde7f09211528b18b1579fbd7a2a", "message": "fix: removed `hasClientIssue(\"8236\")` guard as ITs now pass (#9536)", "committedDate": "2020-12-01T08:10:48Z", "type": "commit"}, {"oid": "f663f148ae92b1df02cc5723cd2a1ae06a6c3fdb", "url": "https://github.com/vaadin/flow/commit/f663f148ae92b1df02cc5723cd2a1ae06a6c3fdb", "message": "Merge branch 'master' into feature/offline\n\n# Conflicts:\n#\tflow-maven-plugin/src/main/java/com/vaadin/flow/plugin/maven/FlowModeAbstractMojo.java\n#\tflow-server/src/main/java/com/vaadin/flow/server/StaticFileServer.java\n#\tflow-server/src/main/java/com/vaadin/flow/server/frontend/TaskUpdateWebpack.java\n#\tflow-server/src/test/java/com/vaadin/flow/server/OSGiVaadinServletTest.java\n#\tflow-tests/test-themes/pom.xml", "committedDate": "2020-12-01T11:14:19Z", "type": "commit"}, {"oid": "3cd150696b9deeac3e5f419ee0d228d9e19307dd", "url": "https://github.com/vaadin/flow/commit/3cd150696b9deeac3e5f419ee0d228d9e19307dd", "message": "fix: put VAADIN/static into VAADIN/webapp", "committedDate": "2020-12-01T13:50:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzQ2MzY4NA==", "url": "https://github.com/vaadin/flow/pull/9549#discussion_r533463684", "bodyText": "\"servletContext\" is a method parameter, and should not be used for synchronization.", "author": "vaadin-bot", "createdAt": "2020-12-01T14:44:42Z", "path": "flow-server/src/main/java/com/vaadin/flow/server/startup/LookupInitializer.java", "diffHunk": "@@ -223,14 +221,9 @@ public InputStream getClientResourceAsStream(String path)\n     @Override\n     public void process(Set<Class<?>> classSet, ServletContext servletContext)\n             throws ServletException {\n-        OSGiAccess osgiAccess = OSGiAccess.getInstance();\n         VaadinServletContext vaadinContext = new VaadinServletContext(\n                 servletContext);\n-        // OSGi case is out of the scope: the Lookup instance is set in the fake\n-        // context when it's created\n-        if (osgiAccess.getOsgiServletContext() == null) {\n-            initStandardLookup(classSet, servletContext);\n-        }\n+        initStandardLookup(classSet, servletContext);\n \n         DeferredServletContextInitializers initializers;\n         synchronized (servletContext) {", "originalCommit": "3cd150696b9deeac3e5f419ee0d228d9e19307dd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzQ2MzcxMw==", "url": "https://github.com/vaadin/flow/pull/9549#discussion_r533463713", "bodyText": "Replace the synchronized class \"Stack\" by an unsynchronized one such as \"Deque\".", "author": "vaadin-bot", "createdAt": "2020-12-01T14:44:43Z", "path": "flow-server/src/main/java/com/vaadin/flow/internal/ResponseWriter.java", "diffHunk": "@@ -196,13 +208,14 @@ private void writeRangeContents(String range, HttpServletResponse response,\n         long resourceLength = connection.getContentLengthLong();\n         Matcher rangeMatcher = BYTE_RANGE_PATTERN.matcher(byteRanges);\n \n-        List<Pair<Long, Long>> ranges = new ArrayList<>();\n-        while (rangeMatcher.find()) {\n+        Stack<Pair<Long, Long>> ranges = new Stack<>();", "originalCommit": "3cd150696b9deeac3e5f419ee0d228d9e19307dd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzQ2Mzc0Ng==", "url": "https://github.com/vaadin/flow/pull/9549#discussion_r533463746", "bodyText": "Invoke method(s) only conditionally.", "author": "vaadin-bot", "createdAt": "2020-12-01T14:44:44Z", "path": "flow-server/src/main/java/com/vaadin/flow/internal/ResponseWriter.java", "diffHunk": "@@ -211,11 +224,20 @@ private void writeRangeContents(String range, HttpServletResponse response,\n             if (end < start\n                     || (resourceLength >= 0 && start >= resourceLength)) {\n                 // illegal range -> 416\n+                getLogger().info(\"received an illegal range '{}' for resource '{}'\",\n+                        rangeMatcher.group(), resourceURL);", "originalCommit": "3cd150696b9deeac3e5f419ee0d228d9e19307dd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzQ2Mzc2Nw==", "url": "https://github.com/vaadin/flow/pull/9549#discussion_r533463767", "bodyText": "Invoke method(s) only conditionally.", "author": "vaadin-bot", "createdAt": "2020-12-01T14:44:45Z", "path": "flow-server/src/main/java/com/vaadin/flow/internal/ResponseWriter.java", "diffHunk": "@@ -196,13 +208,14 @@ private void writeRangeContents(String range, HttpServletResponse response,\n         long resourceLength = connection.getContentLengthLong();\n         Matcher rangeMatcher = BYTE_RANGE_PATTERN.matcher(byteRanges);\n \n-        List<Pair<Long, Long>> ranges = new ArrayList<>();\n-        while (rangeMatcher.find()) {\n+        Stack<Pair<Long, Long>> ranges = new Stack<>();\n+        while (rangeMatcher.find() && ranges.size() < MAX_RANGE_COUNT) {\n             String startGroup = rangeMatcher.group(1);\n             String endGroup = rangeMatcher.group(2);\n             if (startGroup.isEmpty() && endGroup.isEmpty()) {\n                 response.setContentLengthLong(0L);\n                 response.setStatus(416); // Range Not Satisfiable\n+                getLogger().info(\"received a malformed range: '{}'\", rangeMatcher.group());", "originalCommit": "3cd150696b9deeac3e5f419ee0d228d9e19307dd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzQ2MzgwMQ==", "url": "https://github.com/vaadin/flow/pull/9549#discussion_r533463801", "bodyText": "This block of commented-out lines of code should be removed.", "author": "vaadin-bot", "createdAt": "2020-12-01T14:44:46Z", "path": "flow-server/src/main/java/com/vaadin/flow/server/AppShellRegistry.java", "diffHunk": "@@ -151,6 +151,11 @@ public void setShell(Class<? extends AppShellConfigurator> shell) {\n     public boolean isShell(Class<?> clz) {\n         assert clz != null;\n         try {\n+            // first try to check without loading class via the {@code clz}", "originalCommit": "3cd150696b9deeac3e5f419ee0d228d9e19307dd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}