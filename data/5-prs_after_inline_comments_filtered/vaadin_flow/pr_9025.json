{"pr_number": 9025, "pr_title": "Deprecate Polymer Template related classes", "pr_createdAt": "2020-09-17T11:20:43Z", "pr_url": "https://github.com/vaadin/flow/pull/9025", "timeline": [{"oid": "55991ec4d4790ea18034d4f73570013044350b8a", "url": "https://github.com/vaadin/flow/commit/55991ec4d4790ea18034d4f73570013044350b8a", "message": "Extract common template classes and deprecate polymer support", "committedDate": "2020-09-17T04:33:38Z", "type": "commit"}, {"oid": "8ef73ad562c507d695c614250cafecc6768f03d9", "url": "https://github.com/vaadin/flow/commit/8ef73ad562c507d695c614250cafecc6768f03d9", "message": "Deprecate and extract common functionality from polymertemplate package", "committedDate": "2020-09-17T05:47:58Z", "type": "commit"}, {"oid": "b1399d87659cf99376240dba4688fc00a227d5a7", "url": "https://github.com/vaadin/flow/commit/b1399d87659cf99376240dba4688fc00a227d5a7", "message": "Deprecate polymer tempate Id annotation", "committedDate": "2020-09-17T08:27:23Z", "type": "commit"}, {"oid": "24cb292b6a93cc4bb384659d3992596e979b6ff4", "url": "https://github.com/vaadin/flow/commit/24cb292b6a93cc4bb384659d3992596e979b6ff4", "message": "Deprecate Polymer template related classes", "committedDate": "2020-09-17T09:33:25Z", "type": "commit"}, {"oid": "06b660abc252b2f63de3190d6a1e0d7d837473bf", "url": "https://github.com/vaadin/flow/commit/06b660abc252b2f63de3190d6a1e0d7d837473bf", "message": "Deprecate impl classes", "committedDate": "2020-09-17T09:41:23Z", "type": "commit"}, {"oid": "b2c4540effc9453c8f07adad8d7b18ae162f4e5d", "url": "https://github.com/vaadin/flow/commit/b2c4540effc9453c8f07adad8d7b18ae162f4e5d", "message": "Correct javadocs", "committedDate": "2020-09-17T12:05:04Z", "type": "commit"}, {"oid": "3999fe64717668d1a0cd2d196912cffe12a0bbd1", "url": "https://github.com/vaadin/flow/commit/3999fe64717668d1a0cd2d196912cffe12a0bbd1", "message": "Exclude classes from serializable test", "committedDate": "2020-09-18T05:30:24Z", "type": "commit"}, {"oid": "9c00d3110782605c7e509f43ccf61b20aafcd714", "url": "https://github.com/vaadin/flow/commit/9c00d3110782605c7e509f43ccf61b20aafcd714", "message": "Merge branch 'master' into 8955-deprecate", "committedDate": "2020-09-18T05:43:37Z", "type": "commit"}, {"oid": "ae4c655d449025d34e76f7bae9189cef4c42047c", "url": "https://github.com/vaadin/flow/commit/ae4c655d449025d34e76f7bae9189cef4c42047c", "message": "Fix after resolving conflicts", "committedDate": "2020-09-18T05:45:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDcyNzE4MQ==", "url": "https://github.com/vaadin/flow/pull/9025#discussion_r490727181", "bodyText": "Do not forget to remove this deprecated code someday.", "author": "vaadin-bot", "createdAt": "2020-09-18T06:23:28Z", "path": "flow-server/src/main/java/com/vaadin/flow/templatemodel/AbstractBasicModelType.java", "diffHunk": "@@ -37,8 +37,12 @@\n  *            the (basic) Java type used by this model type\n  * @author Vaadin Ltd\n  * @since 1.0\n- *\n+ * @deprecated Template model and model types are not supported for lit\n+ *             template, but you can use {@code @Id} mapping and the component\n+ *             API or the element API with property synchronization instead.\n+ *             This will be removed in an upcoming version.\n  */\n+@Deprecated\n public abstract class AbstractBasicModelType<T> implements ModelType {", "originalCommit": "ae4c655d449025d34e76f7bae9189cef4c42047c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDcyNzE5MQ==", "url": "https://github.com/vaadin/flow/pull/9025#discussion_r490727191", "bodyText": "Do not forget to remove this deprecated code someday.", "author": "vaadin-bot", "createdAt": "2020-09-18T06:23:29Z", "path": "flow-server/src/main/java/com/vaadin/flow/templatemodel/TemplateModelListProxy.java", "diffHunk": "@@ -30,8 +30,14 @@\n  * @since 1.0\n  * @param <T>\n  *            the type of items in the list\n+ * \n+ * @deprecated This functionality is internal and bound to template model which\n+ *             is not supported for lit template. This will be removed in an\n+ *             upcoming version.\n  */\n-public class TemplateModelListProxy<T> extends AbstractList<T> implements Serializable {\n+@Deprecated\n+public class TemplateModelListProxy<T> extends AbstractList<T>", "originalCommit": "ae4c655d449025d34e76f7bae9189cef4c42047c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDcyNzE5NA==", "url": "https://github.com/vaadin/flow/pull/9025#discussion_r490727194", "bodyText": "Do not forget to remove this deprecated code someday.", "author": "vaadin-bot", "createdAt": "2020-09-18T06:23:29Z", "path": "flow-server/src/main/java/com/vaadin/flow/component/polymertemplate/JsoupUtils.java", "diffHunk": "@@ -26,8 +26,10 @@\n  * Utilities for JSOUP DOM manipulations.\n  *\n  * @author Vaadin Ltd\n- *\n+ * @deprecated This class is internal and used only for Polymer templates, it\n+ *             will be removed in an upcoming version.\n  */\n+@Deprecated\n final class JsoupUtils {", "originalCommit": "ae4c655d449025d34e76f7bae9189cef4c42047c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDcyNzE5OA==", "url": "https://github.com/vaadin/flow/pull/9025#discussion_r490727198", "bodyText": "Do not forget to remove this deprecated code someday.", "author": "vaadin-bot", "createdAt": "2020-09-18T06:23:30Z", "path": "flow-server/src/main/java/com/vaadin/flow/templatemodel/ModelEncoder.java", "diffHunk": "@@ -33,7 +33,14 @@\n  *            the decoded type\n  * @param <E>\n  *            the encoded type\n+ * \n+ * @deprecated This functionality is bound to template model which is not\n+ *             supported for lit template. You can use {@code @Id} mapping and\n+ *             the component API or the element API with property\n+ *             synchronization instead. This will be removed in an upcoming\n+ *             version.\n  */\n+@Deprecated\n public interface ModelEncoder<D, E extends Serializable> extends Serializable {", "originalCommit": "ae4c655d449025d34e76f7bae9189cef4c42047c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDcyNzIxNg==", "url": "https://github.com/vaadin/flow/pull/9025#discussion_r490727216", "bodyText": "Do not forget to remove this deprecated code someday.", "author": "vaadin-bot", "createdAt": "2020-09-18T06:23:32Z", "path": "flow-server/src/main/java/com/vaadin/flow/component/polymertemplate/TemplateInitializer.java", "diffHunk": "@@ -42,17 +44,21 @@\n  *\n  * @author Vaadin Ltd\n  * @since 1.0\n+ * @deprecated Use {@link LitTemplateInitializer} for {@link LitTemplate}\n+ *             components, polymer templates are deprecated. This will be\n+ *             removed in an upcoming version.\n  *\n  */\n+@Deprecated\n public class TemplateInitializer {", "originalCommit": "ae4c655d449025d34e76f7bae9189cef4c42047c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDcyNzIyNg==", "url": "https://github.com/vaadin/flow/pull/9025#discussion_r490727226", "bodyText": "Do not forget to remove this deprecated code someday.", "author": "vaadin-bot", "createdAt": "2020-09-18T06:23:33Z", "path": "flow-server/src/main/java/com/vaadin/flow/templatemodel/PropertyMapBuilder.java", "diffHunk": "@@ -36,7 +36,12 @@\n  *\n  * @author Vaadin Ltd\n  * @since 1.0.\n+ * \n+ * @deprecated This functionality is internal and bound to template model which\n+ *             is not supported for lit template. This will be removed in an\n+ *             upcoming version.\n  */\n+@Deprecated\n class PropertyMapBuilder {", "originalCommit": "ae4c655d449025d34e76f7bae9189cef4c42047c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDcyNzIzNg==", "url": "https://github.com/vaadin/flow/pull/9025#discussion_r490727236", "bodyText": "Do not forget to remove this deprecated code someday.", "author": "vaadin-bot", "createdAt": "2020-09-18T06:23:34Z", "path": "flow-server/src/main/java/com/vaadin/flow/templatemodel/PropertyFilter.java", "diffHunk": "@@ -22,7 +22,12 @@\n  *\n  * @author Vaadin Ltd\n  * @since 1.0\n+ * \n+ * @deprecated This functionality is internal and bound to template model which\n+ *             is not supported for lit template. This will be removed in an\n+ *             upcoming version.\n  */\n+@Deprecated\n public class PropertyFilter implements Predicate<String> {", "originalCommit": "ae4c655d449025d34e76f7bae9189cef4c42047c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDcyNzI0Mg==", "url": "https://github.com/vaadin/flow/pull/9025#discussion_r490727242", "bodyText": "Do not forget to remove this deprecated code someday.", "author": "vaadin-bot", "createdAt": "2020-09-18T06:23:35Z", "path": "flow-server/src/main/java/com/vaadin/flow/templatemodel/ModelType.java", "diffHunk": "@@ -33,7 +33,13 @@\n  *\n  * @author Vaadin Ltd\n  * @since 1.0\n+ * \n+ * @deprecated Template model and model types are not supported for lit\n+ *             template, but you can use {@code @Id} mapping and the component\n+ *             API or the element API with property synchronization instead.\n+ *             This will be removed in an upcoming version.\n  */\n+@Deprecated\n public interface ModelType extends Serializable {", "originalCommit": "ae4c655d449025d34e76f7bae9189cef4c42047c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDcyNzI1Mw==", "url": "https://github.com/vaadin/flow/pull/9025#discussion_r490727253", "bodyText": "Do not forget to remove this deprecated code someday.", "author": "vaadin-bot", "createdAt": "2020-09-18T06:23:36Z", "path": "flow-server/src/main/java/com/vaadin/flow/templatemodel/TemplateModelUtil.java", "diffHunk": "@@ -31,7 +31,12 @@\n  *\n  * @author Vaadin Ltd\n  * @since 1.0\n+ * \n+ * @deprecated This functionality is internal and bound to template model which\n+ *             is not supported for lit template. This will be removed in an\n+ *             upcoming version.\n  */\n+@Deprecated\n public final class TemplateModelUtil {", "originalCommit": "ae4c655d449025d34e76f7bae9189cef4c42047c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDcyNzI1Nw==", "url": "https://github.com/vaadin/flow/pull/9025#discussion_r490727257", "bodyText": "Do not forget to remove this deprecated code someday.", "author": "vaadin-bot", "createdAt": "2020-09-18T06:23:37Z", "path": "flow-server/src/main/java/com/vaadin/flow/component/polymertemplate/AbstractTemplate.java", "diffHunk": "@@ -47,7 +48,10 @@\n  *\n  * @param <M>\n  *            a model class that will be used for template data propagation\n+ * @deprecated Polymer template support is deprecated - use {@link LitTemplate}\n+ *             instead. This will be removed in an upcoming version.\n  */\n+@Deprecated\n public abstract class AbstractTemplate<M extends TemplateModel>", "originalCommit": "ae4c655d449025d34e76f7bae9189cef4c42047c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDcyNzI2Mg==", "url": "https://github.com/vaadin/flow/pull/9025#discussion_r490727262", "bodyText": "Do not forget to remove this deprecated code someday.", "author": "vaadin-bot", "createdAt": "2020-09-18T06:23:38Z", "path": "flow-server/src/main/java/com/vaadin/flow/component/polymertemplate/PolymerTemplate.java", "diffHunk": "@@ -47,7 +49,11 @@\n  *\n  * @author Vaadin Ltd\n  * @since 1.0\n+ * @deprecated Polymer template support is deprecated - use {@link LitTemplate}\n+ *             instead, polymer templates are deprecated. This will be removed\n+ *             in an upcoming version.\n  */\n+@Deprecated\n public abstract class PolymerTemplate<M extends TemplateModel>", "originalCommit": "ae4c655d449025d34e76f7bae9189cef4c42047c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDcyNzI2OA==", "url": "https://github.com/vaadin/flow/pull/9025#discussion_r490727268", "bodyText": "Do not forget to remove this deprecated code someday.", "author": "vaadin-bot", "createdAt": "2020-09-18T06:23:39Z", "path": "flow-server/src/main/java/com/vaadin/flow/component/polymertemplate/NpmTemplateParser.java", "diffHunk": "@@ -56,7 +58,12 @@\n  * @since 2.0\n  *\n  * @see BundleParser\n+ * \n+ * @deprecated Use {@code LitTemplateParserImpl} class for {@link LitTemplate}\n+ *             components, polymer templates are deprecated. This will be\n+ *             removed in an upcoming version.\n  */\n+@Deprecated\n public class NpmTemplateParser implements TemplateParser {", "originalCommit": "ae4c655d449025d34e76f7bae9189cef4c42047c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDcyNzI3Mw==", "url": "https://github.com/vaadin/flow/pull/9025#discussion_r490727273", "bodyText": "Do not forget to remove this deprecated code someday.", "author": "vaadin-bot", "createdAt": "2020-09-18T06:23:40Z", "path": "flow-server/src/main/java/com/vaadin/flow/templatemodel/TemplateModelProxyHandler.java", "diffHunk": "@@ -45,7 +45,12 @@\n  *\n  * @author Vaadin Ltd\n  * @since 1.0\n+ * \n+ * @deprecated This functionality is internal and bound to template model which\n+ *             is not supported for lit template. This will be removed in an\n+ *             upcoming version.\n  */\n+@Deprecated\n public class TemplateModelProxyHandler implements Serializable {", "originalCommit": "ae4c655d449025d34e76f7bae9189cef4c42047c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDcyNzI3Nw==", "url": "https://github.com/vaadin/flow/pull/9025#discussion_r490727277", "bodyText": "Do not forget to remove this deprecated code someday.", "author": "vaadin-bot", "createdAt": "2020-09-18T06:23:41Z", "path": "flow-server/src/main/java/com/vaadin/flow/templatemodel/AllowClientUpdates.java", "diffHunk": "@@ -41,6 +46,7 @@\n @Target(ElementType.METHOD)\n @Repeatable(AllowClientUpdates.Container.class)\n @Documented\n+@Deprecated\n public @interface AllowClientUpdates {", "originalCommit": "ae4c655d449025d34e76f7bae9189cef4c42047c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDcyNzI4NQ==", "url": "https://github.com/vaadin/flow/pull/9025#discussion_r490727285", "bodyText": "Do not forget to remove this deprecated code someday.", "author": "vaadin-bot", "createdAt": "2020-09-18T06:23:42Z", "path": "flow-server/src/main/java/com/vaadin/flow/templatemodel/ModelDescriptor.java", "diffHunk": "@@ -24,7 +24,13 @@\n  * @since 1.0\n  * @param <T>\n  *            the template model type used by this descriptor\n+ * \n+ * @deprecated Template model and model types are not supported for lit\n+ *             template, but you can use {@code @Id} mapping and the component\n+ *             API or the element API with property synchronization instead.\n+ *             This will be removed in an upcoming version.\n  */\n+@Deprecated\n public class ModelDescriptor<T extends TemplateModel> extends BeanModelType<T> {", "originalCommit": "ae4c655d449025d34e76f7bae9189cef4c42047c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDcyNzI5Mw==", "url": "https://github.com/vaadin/flow/pull/9025#discussion_r490727293", "bodyText": "Do not forget to remove this deprecated code someday.", "author": "vaadin-bot", "createdAt": "2020-09-18T06:23:43Z", "path": "flow-server/src/main/java/com/vaadin/flow/component/polymertemplate/ModelItem.java", "diffHunk": "@@ -34,10 +34,17 @@\n  *\n  * @author Vaadin Ltd\n  * @since 1.0\n+ * @deprecated There is no any replacement in Lit template since template model\n+ *             is not supported for lit template, but you may still use\n+ *             {@code @EventData(\"some_data\")} to receive data from the client\n+ *             side or {@code @Id} mapping and the component API or the element\n+ *             API with property synchronization instead. This will be removed\n+ *             in an upcoming version.\n  */\n @Retention(RetentionPolicy.RUNTIME)\n @Target({ ElementType.PARAMETER })\n @Documented\n+@Deprecated\n public @interface ModelItem {", "originalCommit": "ae4c655d449025d34e76f7bae9189cef4c42047c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDcyNzMwMA==", "url": "https://github.com/vaadin/flow/pull/9025#discussion_r490727300", "bodyText": "Do not forget to remove this deprecated code someday.", "author": "vaadin-bot", "createdAt": "2020-09-18T06:23:44Z", "path": "flow-server/src/main/java/com/vaadin/flow/component/polymertemplate/BundleParser.java", "diffHunk": "@@ -46,7 +46,11 @@\n  * @since 2.0\n  *\n  * @see NpmTemplateParser\n+ * @deprecated Use {@link BundleLitParser} to parse Lit template since polymer\n+ *             template is deprecated. This will be removed in an upcoming\n+ *             version.\n  */\n+@Deprecated\n public final class BundleParser {", "originalCommit": "ae4c655d449025d34e76f7bae9189cef4c42047c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDcyNzMwNQ==", "url": "https://github.com/vaadin/flow/pull/9025#discussion_r490727305", "bodyText": "Do not forget to remove this deprecated code someday.", "author": "vaadin-bot", "createdAt": "2020-09-18T06:23:45Z", "path": "flow-server/src/main/java/com/vaadin/flow/templatemodel/BasicComplexModelType.java", "diffHunk": "@@ -36,10 +36,15 @@\n  *\n  * @param <T>\n  *            the (basic) Java type used by this model type\n+ * @deprecated Template model and model types are not supported for lit\n+ *             template, but you can use {@code @Id} mapping and the component\n+ *             API or the element API with property synchronization instead.\n+ *             This will be removed in an upcoming version.\n  *\n  * @author Vaadin Ltd\n  * @since 1.0\n  */\n+@Deprecated\n public class BasicComplexModelType<T> extends AbstractBasicModelType<T>", "originalCommit": "ae4c655d449025d34e76f7bae9189cef4c42047c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDcyNzMxMg==", "url": "https://github.com/vaadin/flow/pull/9025#discussion_r490727312", "bodyText": "Do not forget to remove this deprecated code someday.", "author": "vaadin-bot", "createdAt": "2020-09-18T06:23:46Z", "path": "flow-server/src/main/java/com/vaadin/flow/templatemodel/PathLookup.java", "diffHunk": "@@ -27,7 +27,11 @@\n  * @since 1.0\n  * @param <T>\n  *            the item type\n+ * @deprecated This functionality is internal and bound to template model which\n+ *             is not supported for lit template. This will be removed in an\n+ *             upcoming version.\n  */\n+@Deprecated\n public class PathLookup<T> {", "originalCommit": "ae4c655d449025d34e76f7bae9189cef4c42047c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDcyNzMxNw==", "url": "https://github.com/vaadin/flow/pull/9025#discussion_r490727317", "bodyText": "Do not forget to remove this deprecated code someday.", "author": "vaadin-bot", "createdAt": "2020-09-18T06:23:47Z", "path": "flow-server/src/main/java/com/vaadin/flow/templatemodel/ComplexModelType.java", "diffHunk": "@@ -25,7 +25,12 @@\n  *\n  * @param <T>\n  *            the proxy type used by this type\n+ * @deprecated Template model and model types are not supported for lit\n+ *             template, but you can use {@code @Id} mapping and the component\n+ *             API or the element API with property synchronization instead.\n+ *             This will be removed in an upcoming version.\n  */\n+@Deprecated\n public interface ComplexModelType<T> extends ModelType {", "originalCommit": "ae4c655d449025d34e76f7bae9189cef4c42047c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDcyNzMzNA==", "url": "https://github.com/vaadin/flow/pull/9025#discussion_r490727334", "bodyText": "Remove this use of \"DEAULT_FLOW_RESOURCES_FOLDER\"; it is deprecated.", "author": "vaadin-bot", "createdAt": "2020-09-18T06:23:50Z", "path": "flow-server/src/main/java/com/vaadin/flow/component/littemplate/BundleLitParser.java", "diffHunk": "@@ -0,0 +1,234 @@\n+/*\n+ * Copyright 2000-2020 Vaadin Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+package com.vaadin.flow.component.littemplate;\n+\n+import static com.vaadin.flow.server.frontend.FrontendUtils.DEAULT_FLOW_RESOURCES_FOLDER;\n+import static com.vaadin.flow.server.frontend.FrontendUtils.FLOW_NPM_PACKAGE_NAME;\n+import static elemental.json.JsonType.ARRAY;\n+import static elemental.json.JsonType.OBJECT;\n+import static elemental.json.JsonType.STRING;\n+\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+\n+import org.jsoup.Jsoup;\n+import org.jsoup.nodes.Document;\n+import org.jsoup.nodes.Element;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import com.vaadin.flow.internal.StringUtil;\n+\n+import elemental.json.Json;\n+import elemental.json.JsonArray;\n+import elemental.json.JsonObject;\n+import elemental.json.JsonType;\n+\n+/**\n+ * Parse statistics data provided by webpack.\n+ *\n+ * @author Vaadin Ltd\n+ * @since\n+ *\n+ * @see LitTemplateParser\n+ */\n+public final class BundleLitParser {\n+\n+    private static final Logger LOGGER = LoggerFactory\n+            .getLogger(BundleLitParser.class);\n+\n+    private static final String SOURCE = \"source\";\n+    private static final String NAME = \"name\";\n+    private static final String CHUNKS = \"chunks\";\n+    private static final String MODULES = \"modules\";\n+\n+    /**\n+     * Lit template pattern matches the template getter\n+     *\n+     * <pre>\n+     *     render() {\n+     *       return html`\n+     *         &lt;style&gt;\n+     *           .response { margin-top: 10px`; }\n+     *         &lt;/style&gt;\n+     *         &lt;paper-checkbox checked=&quot;${liked}&quot;&gt;I like web components.&lt;/paper-checkbox&gt;\n+     *\n+     *         &lt;div id=&quot;test&quot; ?hidden=&quot;${liked}&quot; class=&quot;response&quot;&gt;Web components like you, too.&lt;/div&gt;\n+     *       `;\n+     *     }\n+     * </pre>\n+     *\n+     * <p>\n+     * <code>render\\(\\)[\\s]*\\{</code> finds the template getter method\n+     * <p>\n+     * <code>[\\s]*return[\\s]*html`</code> finds the return statement\n+     * <p>\n+     * </p>\n+     * <code>(([^`]|\\\\\\\\.)*)</code> captures all text until we encounter the end\n+     * character with <code>;}</code> e.g. <code>';}</code>\n+     */\n+    private static final Pattern LIT_TEMPLATE_PATTERN = Pattern.compile(\n+            \"render\\\\(\\\\)[\\\\s]*\\\\{[\\\\s]*return[\\\\s]*html`(([^`]|\\\\\\\\.)*)`;[\\\\s]*\\\\}\");\n+\n+    private static final Pattern HASH_PATTERN = Pattern\n+            .compile(\"\\\"hash\\\"\\\\s*:\\\\s*\\\"([^\\\"]+)\\\"\\\\s*,\");\n+\n+    private static final String TEMPLATE_TAG_NAME = \"template\";\n+\n+    private BundleLitParser() {\n+    }\n+\n+    /**\n+     * Gets the hash from the string content of a webpack stats file. It uses\n+     * regex to avoid parsing the entire string into a json object.\n+     *\n+     * @param fileContents\n+     *            the content of the stats file\n+     * @return the hash\n+     */\n+    public static String getHashFromStatistics(String fileContents) {\n+        Matcher matcher = HASH_PATTERN.matcher(fileContents);\n+        return matcher.find() ? matcher.group(1) : \"\" + fileContents.length();\n+    }\n+\n+    /**\n+     * Parses the content of the stats file to return a json object.\n+     *\n+     * @param fileContents\n+     *            the content of the stats file\n+     * @return a JsonObject with the stats\n+     */\n+    public static JsonObject parseJsonStatistics(String fileContents) {\n+        return Json.parse(fileContents);\n+    }\n+\n+    /**\n+     * Get a module source from the statistics Json file generated by webpack.\n+     *\n+     * @param fileName\n+     *            name of the file to get from the json\n+     * @param statistics\n+     *            statistics json as a JsonObject\n+     * @return JsonObject for the file statistic\n+     */\n+    public static String getSourceFromStatistics(String fileName,\n+            JsonObject statistics) {\n+        return getSourceFromObject(statistics, fileName);\n+    }\n+\n+    /**\n+     * Get the Lit template element for the given polymer template source.\n+     *\n+     * @param fileName\n+     *            name of the handled file\n+     * @param source\n+     *            source js to get template element from\n+     * @return template element or {code null} if not found\n+     */\n+    public static Element parseLitTemplateElement(String fileName,\n+            String source) {\n+        Document templateDocument = null;\n+        String content = StringUtil.removeComments(source);\n+        Matcher templateMatcher = LIT_TEMPLATE_PATTERN.matcher(content);\n+\n+        // GroupCount should be 2 as the first group contains `|'|\" depending\n+        // on what was in template return html' and the second is the\n+        // template contents.\n+        if (templateMatcher.find() && templateMatcher.groupCount() == 2) {\n+            String group = templateMatcher.group(1);\n+            LOGGER.trace(\"Found regular Lit template content was {}\", group);\n+\n+            templateDocument = Jsoup.parse(group);\n+            LOGGER.trace(\"The parsed template document was {}\",\n+                    templateDocument);\n+            Element template = templateDocument\n+                    .createElement(TEMPLATE_TAG_NAME);\n+            Element body = templateDocument.body();\n+            templateDocument.body().children().stream()\n+                    .filter(node -> !node.equals(body))\n+                    .forEach(template::appendChild);\n+\n+            return template;\n+        }\n+        LOGGER.warn(\"No lit template data found in {} sources.\", fileName);\n+        return null;\n+    }\n+\n+    // find the first module whose name matches the file name\n+    private static String getSourceFromObject(JsonObject module,\n+            String fileName) {\n+        String source = null;\n+        if (validKey(module, MODULES, ARRAY)) {\n+            source = getSourceFromArray(module.getArray(MODULES), fileName);\n+        }\n+        if (source == null && validKey(module, CHUNKS, ARRAY)) {\n+            source = getSourceFromArray(module.getArray(CHUNKS), fileName);\n+        }\n+        if (source == null && validKey(module, NAME, STRING)\n+                && validKey(module, SOURCE, STRING)) {\n+            String name = module.getString(NAME);\n+\n+            // append `.js` extension if not yet as webpack does\n+            fileName = fileName.replaceFirst(\"(\\\\.js|)$\", \".js\");\n+\n+            String alternativeFileName = fileName\n+                    // Replace frontend part since webpack entry-point is\n+                    // already in the frontend folder\n+                    .replaceFirst(\"^(\\\\./)frontend/\", \"$1\")\n+                    // Replace the flow frontend protocol\n+                    .replaceFirst(\"^frontend://\", \".\");\n+\n+            // For polymer templates inside add-ons we will not find the sources\n+            // using ./ as the actual path contains\n+            // \"node_modules/@vaadin/flow-frontend/\" instead of \"./\"\n+            // \"target/flow-frontend/\" instead of \"./\"\n+            if (name.contains(FLOW_NPM_PACKAGE_NAME)\n+                    || name.contains(DEAULT_FLOW_RESOURCES_FOLDER)) {", "originalCommit": "ae4c655d449025d34e76f7bae9189cef4c42047c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDcyNzM0MQ==", "url": "https://github.com/vaadin/flow/pull/9025#discussion_r490727341", "bodyText": "Do not forget to remove this deprecated code someday.", "author": "vaadin-bot", "createdAt": "2020-09-18T06:23:51Z", "path": "flow-server/src/main/java/com/vaadin/flow/templatemodel/BasicModelType.java", "diffHunk": "@@ -25,7 +25,13 @@\n  *\n  * @author Vaadin Ltd\n  * @since 1.0\n+ * \n+ * @deprecated Template model and model types are not supported for lit\n+ *             template, but you can use {@code @Id} mapping and the component\n+ *             API or the element API with property synchronization instead.\n+ *             This will be removed in an upcoming version.\n  */\n+@Deprecated\n public class BasicModelType extends AbstractBasicModelType {", "originalCommit": "ae4c655d449025d34e76f7bae9189cef4c42047c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDcyNzM0NQ==", "url": "https://github.com/vaadin/flow/pull/9025#discussion_r490727345", "bodyText": "Do not forget to remove this deprecated code someday.", "author": "vaadin-bot", "createdAt": "2020-09-18T06:23:52Z", "path": "flow-server/src/main/java/com/vaadin/flow/component/polymertemplate/Id.java", "diffHunk": "@@ -75,10 +75,13 @@\n  *\n  * @author Vaadin Ltd\n  * @since 1.0\n+ * @deprecated Use com.vaadin.flow.component.template.Id instead. This will be\n+ *             removed in an upcoming version.\n  */\n @Retention(RetentionPolicy.RUNTIME)\n @Target(ElementType.FIELD)\n @Documented\n+@Deprecated\n public @interface Id {", "originalCommit": "ae4c655d449025d34e76f7bae9189cef4c42047c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDcyNzM1Mg==", "url": "https://github.com/vaadin/flow/pull/9025#discussion_r490727352", "bodyText": "Do not forget to remove this deprecated code someday.", "author": "vaadin-bot", "createdAt": "2020-09-18T06:23:53Z", "path": "flow-server/src/main/java/com/vaadin/flow/templatemodel/ListModelType.java", "diffHunk": "@@ -39,7 +38,13 @@\n  * @since 1.0\n  * @param <T>\n  *            the proxy type used by the bean type of this type\n+ * \n+ * @deprecated Template model and model types are not supported for lit\n+ *             template, but you can use {@code @Id} mapping and the component\n+ *             API or the element API with property synchronization instead.\n+ *             This will be removed in an upcoming version.\n  */\n+@Deprecated\n public class ListModelType<T> implements ComplexModelType<T> {", "originalCommit": "ae4c655d449025d34e76f7bae9189cef4c42047c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDcyNzM1OQ==", "url": "https://github.com/vaadin/flow/pull/9025#discussion_r490727359", "bodyText": "Do not forget to remove this deprecated code someday.", "author": "vaadin-bot", "createdAt": "2020-09-18T06:23:54Z", "path": "flow-server/src/main/java/com/vaadin/flow/templatemodel/ClientUpdateMode.java", "diffHunk": "@@ -22,7 +22,13 @@\n  *\n  * @author Vaadin Ltd\n  * @since 1.0\n+ * @deprecated This functionality is bound to template model which is not\n+ *             supported for lit template. You can use {@code @Id} mapping and\n+ *             the component API or the element API with property\n+ *             synchronization instead. This will be removed in an upcoming\n+ *             version.\n  */\n+@Deprecated\n public enum ClientUpdateMode {", "originalCommit": "ae4c655d449025d34e76f7bae9189cef4c42047c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDcyNzM2Nw==", "url": "https://github.com/vaadin/flow/pull/9025#discussion_r490727367", "bodyText": "Do not forget to remove this deprecated code someday.", "author": "vaadin-bot", "createdAt": "2020-09-18T06:23:55Z", "path": "flow-server/src/main/java/com/vaadin/flow/templatemodel/BeanModelType.java", "diffHunk": "@@ -50,7 +50,12 @@\n  * @since 1.0\n  * @param <T>\n  *            the proxy type used by this bean type\n+ * @deprecated Template model and model types are not supported for lit\n+ *             template, but you can use {@code @Id} mapping and the component\n+ *             API or the element API with property synchronization instead.\n+ *             This will be removed in an upcoming version.\n  */\n+@Deprecated\n public class BeanModelType<T> implements ComplexModelType<T> {", "originalCommit": "ae4c655d449025d34e76f7bae9189cef4c42047c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDcyNzM3Mg==", "url": "https://github.com/vaadin/flow/pull/9025#discussion_r490727372", "bodyText": "Do not forget to remove this deprecated code someday.", "author": "vaadin-bot", "createdAt": "2020-09-18T06:23:56Z", "path": "flow-server/src/main/java/com/vaadin/flow/templatemodel/InvalidTemplateModelException.java", "diffHunk": "@@ -20,11 +20,18 @@\n  *\n  * @author Vaadin Ltd\n  * @since 1.0\n+ * \n+ * @deprecated This functionality is bound to template model which is not\n+ *             supported for lit template. You can use {@code @Id} mapping and\n+ *             the component API or the element API with property\n+ *             synchronization instead. This will be removed in an upcoming\n+ *             version.\n  */\n+@Deprecated\n public class InvalidTemplateModelException extends RuntimeException {", "originalCommit": "ae4c655d449025d34e76f7bae9189cef4c42047c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDcyNzM3OA==", "url": "https://github.com/vaadin/flow/pull/9025#discussion_r490727378", "bodyText": "The class name com.vaadin.flow.component.polymertemplate.IdMapper shadows the simple name of the superclass com.vaadin.flow.component.template.internal.IdMapper", "author": "vaadin-bot", "createdAt": "2020-09-18T06:23:57Z", "path": "flow-server/src/main/java/com/vaadin/flow/component/polymertemplate/IdMapper.java", "diffHunk": "@@ -47,164 +36,7 @@\n      *            a template instance\n      */\n     public IdMapper(Component template) {\n-        this.template = template;\n-    }\n-\n-    /**\n-     * Maps an element or component to the given field.\n-     * <p>\n-     * If an element with the given id exists in the template element tree, that\n-     * element is used.\n-     * <p>\n-     * If no element exists (the typical case), a virtual element is created and\n-     * later on, when the template has been rendered in the client, is connected\n-     * to the rendered element with the given id.\n-     *\n-     * @param field\n-     *            the field to assign the element/component to\n-     * @param id\n-     *            the id of the element to map\n-     * @param tag\n-     *            the tag of the injected element or <code>null</code> if not\n-     *            known\n-     * @param beforeInject\n-     *            a callback invoked before assigning the element/component to\n-     *            the field\n-     */\n-    public void mapComponentOrElement(Field field, String id, String tag,\n-            Consumer<Element> beforeInject) {\n-        injectClientSideElement(tag, id, field, beforeInject);\n-    }\n-\n-    private Class<? extends Component> getContainerClass() {\n-        return template.getClass();\n-    }\n-\n-    private void injectClientSideElement(String tagName, String id, Field field,\n-            Consumer<Element> beforeInject) {\n-        Class<?> fieldType = field.getType();\n-\n-        Tag tag = fieldType.getAnnotation(Tag.class);\n-        if (tag != null && tagName != null\n-                && !tagName.equalsIgnoreCase(tag.value())) {\n-            String msg = String.format(\n-                    \"Class '%s' has field '%s' whose type '%s' is annotated with \"\n-                            + \"tag '%s' but the element defined in the HTML \"\n-                            + \"template with id '%s' has tag name '%s'\",\n-                    getContainerClass().getName(), field.getName(),\n-                    fieldType.getName(), tag.value(), id, tagName);\n-            throw new IllegalStateException(msg);\n-        }\n-        if (tag != null) {\n-            // tag can be null if injecting Element\n-            // tagName is the tag parsed from the template and it is null for\n-            // Lit templates,\n-            // which are not parsed\n-            tagName = tag.value();\n-        }\n-        attachExistingElementById(tagName, id, field, beforeInject);\n-    }\n-\n-    /**\n-     * Gets the shadow root for the template.\n-     * <p>\n-     * Creates a shadow root if the template does not have one.\n-     *\n-     * @return the shadow root for the template\n-     */\n-    public ShadowRoot getOrCreateShadowRoot() {\n-        return getElement().getShadowRoot()\n-                .orElseGet(() -> getElement().attachShadow());\n-    }\n-\n-    private Element getElement() {\n-        return template.getElement();\n-    }\n-\n-    /**\n-     * Attaches a child element with the given {@code tagName} and {@code id} to\n-     * an existing dom element on the client side with matching data.\n-     *\n-     * @param tagName\n-     *            tag name of element, not\u00a0{@code null}\n-     * @param id\n-     *            id of element to attach to\n-     * @param field\n-     *            field to attach {@code Element} or {@code Component} to\n-     * @param beforeInject\n-     *            a callback invoked before assigning the element/component to\n-     *            the field\n-     */\n-    private void attachExistingElementById(String tagName, String id,\n-            Field field, Consumer<Element> beforeInject) {\n-        if (tagName == null) {\n-            throw new IllegalArgumentException(\n-                    \"Tag name parameter cannot be null\");\n-        }\n-\n-        Element element = registeredElementIdToInjected.get(id);\n-        if (element == null) {\n-            element = new Element(tagName);\n-            VirtualChildrenList list = getElement().getNode()\n-                    .getFeature(VirtualChildrenList.class);\n-            list.append(element.getNode(), NodeProperties.INJECT_BY_ID, id);\n-            registeredElementIdToInjected.put(id, element);\n-        }\n-        injectTemplateElement(element, field, beforeInject);\n-    }\n-\n-    @SuppressWarnings(\"unchecked\")\n-    private void injectTemplateElement(Element element, Field field,\n-            Consumer<Element> beforeInject) {\n-        Class<?> fieldType = field.getType();\n-        if (Component.class.isAssignableFrom(fieldType)) {\n-            beforeInject.accept(element);\n-            Component component;\n-\n-            Optional<Component> wrappedComponent = element.getComponent();\n-            if (wrappedComponent.isPresent()) {\n-                component = wrappedComponent.get();\n-            } else {\n-                Class<? extends Component> componentType = (Class<? extends Component>) fieldType;\n-                component = Component.from(element, componentType);\n-            }\n-\n-            ReflectTools.setJavaFieldValue(template, field, component);\n-        } else if (Element.class.isAssignableFrom(fieldType)) {\n-            beforeInject.accept(element);\n-            ReflectTools.setJavaFieldValue(template, field, element);\n-        } else {\n-            String msg = String.format(\n-                    \"The field '%s' in '%s' has an @'%s' \"\n-                            + \"annotation but the field type '%s' \"\n-                            + \"does not extend neither '%s' nor '%s'\",\n-                    field.getName(), getContainerClass().getName(),\n-                    Id.class.getSimpleName(), fieldType.getName(),\n-                    Component.class.getSimpleName(),\n-                    Element.class.getSimpleName());\n-\n-            throw new IllegalArgumentException(msg);\n-        }\n-    }\n-\n-    /**\n-     * Resets the mapper to its original state, clearing any registered\n-     * mappings.\n-     */\n-    public void reset() {\n-        registeredElementIdToInjected.clear();\n-    }\n-\n-    /**\n-     * Checks if the given id has been mapped.\n-     *\n-     * @param id\n-     *            the id to check\n-     * @return <code>true</code> if the element has been mapped,\n-     *         <code>false</code> otherwise\n-     */\n-    public boolean isMapped(String id) {\n-        return registeredElementIdToInjected.containsKey(id);\n+        super(template);", "originalCommit": "ae4c655d449025d34e76f7bae9189cef4c42047c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDcyNzM4Nw==", "url": "https://github.com/vaadin/flow/pull/9025#discussion_r490727387", "bodyText": "Rename this class. \n Do not forget to remove this deprecated code someday.", "author": "vaadin-bot", "createdAt": "2020-09-18T06:23:58Z", "path": "flow-server/src/main/java/com/vaadin/flow/component/polymertemplate/IdMapper.java", "diffHunk": "@@ -15,30 +15,19 @@\n  */\n package com.vaadin.flow.component.polymertemplate;\n \n-import java.io.Serializable;\n-import java.lang.reflect.Field;\n-import java.util.HashMap;\n-import java.util.Optional;\n-import java.util.function.Consumer;\n-\n import com.vaadin.flow.component.Component;\n-import com.vaadin.flow.component.Tag;\n-import com.vaadin.flow.dom.Element;\n-import com.vaadin.flow.dom.ShadowRoot;\n-import com.vaadin.flow.internal.ReflectTools;\n-import com.vaadin.flow.internal.nodefeature.NodeProperties;\n-import com.vaadin.flow.internal.nodefeature.VirtualChildrenList;\n+import com.vaadin.flow.component.template.Id;\n \n /**\n  * Creates or maps Element instances to fields mapped using {@link Id @Id}.\n  *\n  * @since 2.0\n+ * @deprecated Use {@link com.vaadin.flow.component.template.internal.IdMapper}\n+ *             instead. This will be removed in an upcoming version.\n  */\n-public class IdMapper implements Serializable {\n-\n-    private final HashMap<String, Element> registeredElementIdToInjected = new HashMap<>();\n-\n-    private Component template;\n+@Deprecated\n+public class IdMapper", "originalCommit": "ae4c655d449025d34e76f7bae9189cef4c42047c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDcyNzM5NA==", "url": "https://github.com/vaadin/flow/pull/9025#discussion_r490727394", "bodyText": "Do not forget to remove this deprecated code someday.", "author": "vaadin-bot", "createdAt": "2020-09-18T06:23:59Z", "path": "flow-server/src/main/java/com/vaadin/flow/templatemodel/ConvertedModelType.java", "diffHunk": "@@ -34,7 +34,13 @@\n  *            application type of the converter used by this class\n  * @param <M>\n  *            model type of the converter used by this class\n+ * \n+ * @deprecated Template model and model types are not supported for lit\n+ *             template, but you can use {@code @Id} mapping and the component\n+ *             API or the element API with property synchronization instead.\n+ *             This will be removed in an upcoming version.\n  */\n+@Deprecated\n public class ConvertedModelType<A, M extends Serializable>", "originalCommit": "ae4c655d449025d34e76f7bae9189cef4c42047c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDcyNzQwMQ==", "url": "https://github.com/vaadin/flow/pull/9025#discussion_r490727401", "bodyText": "Replace this lambda with a method reference.", "author": "vaadin-bot", "createdAt": "2020-09-18T06:24:00Z", "path": "flow-server/src/main/java/com/vaadin/flow/component/polymertemplate/TemplateDataAnalyzer.java", "diffHunk": "@@ -141,23 +146,9 @@ public ParserData(Map<Field, String> fields, Map<String, String> tags,\n          *            the consumer to call for each mapped field\n          */\n         public void forEachInjectedField(InjectableFieldCunsumer consumer) {\n-            idByField.forEach(\n-                    (field, id) -> consumer.apply(field, id, tagById.get(id)));\n-        }\n-\n-        /**\n-         * Gets template element data (attribute values).\n-         * \n-         * @param id\n-         *            the id of the element\n-         * @return template data\n-         */\n-        public Map<String, String> getAttributes(String id) {\n-            Map<String, String> attrs = attributesById.get(id);\n-            if (attrs == null) {\n-                return Collections.emptyMap();\n-            }\n-            return attrs;\n+            InjectableFieldConsumer delegate = (field, id, tag) -> consumer", "originalCommit": "ae4c655d449025d34e76f7bae9189cef4c42047c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDcyNzQxMw==", "url": "https://github.com/vaadin/flow/pull/9025#discussion_r490727413", "bodyText": "Do not forget to remove this deprecated code someday.", "author": "vaadin-bot", "createdAt": "2020-09-18T06:24:01Z", "path": "flow-server/src/main/java/com/vaadin/flow/component/polymertemplate/TemplateDataAnalyzer.java", "diffHunk": "@@ -48,8 +51,12 @@\n  *\n  * @author Vaadin Ltd\n  * @since 1.0\n+ * @deprecated Use {@code LitTemplateDataAnalyzer} for {@link LitTemplate}\n+ *             components, polymer templates are deprecated. This will be\n+ *             removed in an upcoming version.\n  *\n  */\n+@Deprecated\n public class TemplateDataAnalyzer {", "originalCommit": "ae4c655d449025d34e76f7bae9189cef4c42047c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDcyNzQyMQ==", "url": "https://github.com/vaadin/flow/pull/9025#discussion_r490727421", "bodyText": "Do not forget to remove this deprecated code someday.", "author": "vaadin-bot", "createdAt": "2020-09-18T06:24:04Z", "path": "flow-server/src/main/java/com/vaadin/flow/component/polymertemplate/TemplateDataAnalyzer.java", "diffHunk": "@@ -91,18 +98,17 @@\n          * @param tag\n          *            the element tag\n          */\n+        @Override\n         void apply(Field field, String id, String tag);\n     }\n \n     /**\n      * Immutable parser data which may be stored in cache.\n+     * \n+     * Use {@link ParserData} instead.\n      */\n-    public static class ParserData {\n-\n-        private final Map<String, String> tagById;\n-        private final Map<Field, String> idByField;\n-\n-        private final Map<String, Map<String, String>> attributesById;\n+    @Deprecated\n+    public static class PolymerParserData extends ParserData {", "originalCommit": "ae4c655d449025d34e76f7bae9189cef4c42047c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDcyNzQyNw==", "url": "https://github.com/vaadin/flow/pull/9025#discussion_r490727427", "bodyText": "Do not forget to remove this deprecated code someday.", "author": "vaadin-bot", "createdAt": "2020-09-18T06:24:05Z", "path": "flow-server/src/main/java/com/vaadin/flow/component/polymertemplate/InjectablePolymerElementInitializer.java", "diffHunk": "@@ -27,8 +28,11 @@\n  * \n  * @author Vaadin Ltd\n  * @since\n- *\n+ * @deprecated {@link InjectableLitElementInitializer} should be used for Lit\n+ *             templates since polymer support is deprecated. This will be\n+ *             removed in an upcoming version.\n  */\n+@Deprecated\n public class InjectablePolymerElementInitializer", "originalCommit": "ae4c655d449025d34e76f7bae9189cef4c42047c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDcyNzQ0Mw==", "url": "https://github.com/vaadin/flow/pull/9025#discussion_r490727443", "bodyText": "Remove this use of \"Id\"; it is deprecated.", "author": "vaadin-bot", "createdAt": "2020-09-18T06:24:07Z", "path": "flow-server/src/main/java/com/vaadin/flow/component/template/internal/IdCollector.java", "diffHunk": "@@ -0,0 +1,225 @@\n+/*\n+ * Copyright 2000-2020 Vaadin Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+package com.vaadin.flow.component.template.internal;\n+\n+import java.lang.reflect.Field;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.stream.Stream;\n+\n+import org.jsoup.nodes.Attribute;\n+import org.jsoup.nodes.Attributes;\n+import org.jsoup.nodes.Element;\n+\n+import com.vaadin.flow.component.Component;\n+import com.vaadin.flow.component.polymertemplate.Id;\n+import com.vaadin.flow.internal.AnnotationReader;\n+\n+/**\n+ * Collects information of {@link Id @Id} mapped fields in a template class.\n+ *\n+ * @since\n+ */\n+public class IdCollector {\n+    private final Map<String, String> tagById = new HashMap<>();\n+    private final Map<Field, String> idByField = new HashMap<>();\n+    private final Map<String, Map<String, String>> attributesById = new HashMap<>();\n+    private Element templateRoot;\n+    private Class<?> templateClass;\n+    private String templateFile;\n+\n+    /**\n+     * Creates a collector the the given template.\n+     *\n+     * @param templateClass\n+     *            the template class, containing the {@code @Id} fields\n+     * @param templateFile\n+     *            The name of the file containing the template or\n+     *            <code>null</code> if not available {@code null}\n+     * @param templateRoot\n+     *            The root element of the template or <code>null</code> if not\n+     *            available\n+     */\n+    public IdCollector(Class<?> templateClass, String templateFile,\n+            Element templateRoot) {\n+        this.templateClass = templateClass;\n+        this.templateFile = templateFile;\n+        this.templateRoot = templateRoot;\n+    }\n+\n+    /**\n+     * Scans the given template class and finds fields mapped using\n+     * {@link com.vaadin.flow.component.template.Id @Id}.\n+     *\n+     * @param notInjectableElementIds\n+     *            ids which cannot be injected\n+     */\n+    public void collectInjectedIds(Set<String> notInjectableElementIds) {\n+        collectInjectedIds(templateClass, notInjectableElementIds);\n+    }\n+\n+    private void collectInjectedIds(Class<?> cls,\n+            Set<String> notInjectableElementIds) {\n+        if (!Component.class.equals(cls.getSuperclass())) {\n+            // Parent fields\n+            collectInjectedIds(cls.getSuperclass(), notInjectableElementIds);\n+        }\n+\n+        Stream.of(cls.getDeclaredFields()).filter(field -> !field.isSynthetic())\n+                .forEach(field -> collectedInjectedId(field,\n+                        notInjectableElementIds));\n+    }\n+\n+    private void collectedInjectedId(Field field,\n+            Set<String> notInjectableElementIds) {\n+        String id = getId(field).orElse(null);\n+        if (id == null) {\n+            return;\n+        }\n+        boolean emptyValue = id.isEmpty();\n+        if (emptyValue) {\n+            id = field.getName();\n+        }\n+        if (notInjectableElementIds.contains(id)) {\n+            throw new IllegalStateException(String.format(\n+                    \"Class '%s' contains field '%s' annotated with @Id%s. \"\n+                            + \"Corresponding element was found in a sub template, \"\n+                            + \"for which injection is not supported.\",\n+                    templateClass.getName(), field.getName(),\n+                    emptyValue\n+                            ? \" without value (so the name of the field should match the id of an element in the template)\"\n+                            : \"(\\\"\" + id + \"\\\")\"));\n+        }\n+\n+        if (!collectElementData(id, field)) {\n+            throw new IllegalStateException(String.format(\n+                    \"There is no element with \"\n+                            + \"id='%s' in the template file '%s'. Cannot map it using @%s\",\n+                    id, templateFile,\n+                    com.vaadin.flow.component.template.Id.class\n+                            .getSimpleName()));\n+        }\n+    }\n+\n+    private Optional<String> getId(Field field) {\n+        Optional<Id> idAnnotation = AnnotationReader.getAnnotationFor(field,", "originalCommit": "ae4c655d449025d34e76f7bae9189cef4c42047c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDcyNzQ1Mg==", "url": "https://github.com/vaadin/flow/pull/9025#discussion_r490727452", "bodyText": "Remove this use of \"Id\"; it is deprecated.", "author": "vaadin-bot", "createdAt": "2020-09-18T06:24:08Z", "path": "flow-server/src/main/java/com/vaadin/flow/component/template/internal/IdCollector.java", "diffHunk": "@@ -0,0 +1,225 @@\n+/*\n+ * Copyright 2000-2020 Vaadin Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+package com.vaadin.flow.component.template.internal;\n+\n+import java.lang.reflect.Field;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.stream.Stream;\n+\n+import org.jsoup.nodes.Attribute;\n+import org.jsoup.nodes.Attributes;\n+import org.jsoup.nodes.Element;\n+\n+import com.vaadin.flow.component.Component;\n+import com.vaadin.flow.component.polymertemplate.Id;\n+import com.vaadin.flow.internal.AnnotationReader;\n+\n+/**\n+ * Collects information of {@link Id @Id} mapped fields in a template class.\n+ *\n+ * @since\n+ */\n+public class IdCollector {\n+    private final Map<String, String> tagById = new HashMap<>();\n+    private final Map<Field, String> idByField = new HashMap<>();\n+    private final Map<String, Map<String, String>> attributesById = new HashMap<>();\n+    private Element templateRoot;\n+    private Class<?> templateClass;\n+    private String templateFile;\n+\n+    /**\n+     * Creates a collector the the given template.\n+     *\n+     * @param templateClass\n+     *            the template class, containing the {@code @Id} fields\n+     * @param templateFile\n+     *            The name of the file containing the template or\n+     *            <code>null</code> if not available {@code null}\n+     * @param templateRoot\n+     *            The root element of the template or <code>null</code> if not\n+     *            available\n+     */\n+    public IdCollector(Class<?> templateClass, String templateFile,\n+            Element templateRoot) {\n+        this.templateClass = templateClass;\n+        this.templateFile = templateFile;\n+        this.templateRoot = templateRoot;\n+    }\n+\n+    /**\n+     * Scans the given template class and finds fields mapped using\n+     * {@link com.vaadin.flow.component.template.Id @Id}.\n+     *\n+     * @param notInjectableElementIds\n+     *            ids which cannot be injected\n+     */\n+    public void collectInjectedIds(Set<String> notInjectableElementIds) {\n+        collectInjectedIds(templateClass, notInjectableElementIds);\n+    }\n+\n+    private void collectInjectedIds(Class<?> cls,\n+            Set<String> notInjectableElementIds) {\n+        if (!Component.class.equals(cls.getSuperclass())) {\n+            // Parent fields\n+            collectInjectedIds(cls.getSuperclass(), notInjectableElementIds);\n+        }\n+\n+        Stream.of(cls.getDeclaredFields()).filter(field -> !field.isSynthetic())\n+                .forEach(field -> collectedInjectedId(field,\n+                        notInjectableElementIds));\n+    }\n+\n+    private void collectedInjectedId(Field field,\n+            Set<String> notInjectableElementIds) {\n+        String id = getId(field).orElse(null);\n+        if (id == null) {\n+            return;\n+        }\n+        boolean emptyValue = id.isEmpty();\n+        if (emptyValue) {\n+            id = field.getName();\n+        }\n+        if (notInjectableElementIds.contains(id)) {\n+            throw new IllegalStateException(String.format(\n+                    \"Class '%s' contains field '%s' annotated with @Id%s. \"\n+                            + \"Corresponding element was found in a sub template, \"\n+                            + \"for which injection is not supported.\",\n+                    templateClass.getName(), field.getName(),\n+                    emptyValue\n+                            ? \" without value (so the name of the field should match the id of an element in the template)\"\n+                            : \"(\\\"\" + id + \"\\\")\"));\n+        }\n+\n+        if (!collectElementData(id, field)) {\n+            throw new IllegalStateException(String.format(\n+                    \"There is no element with \"\n+                            + \"id='%s' in the template file '%s'. Cannot map it using @%s\",\n+                    id, templateFile,\n+                    com.vaadin.flow.component.template.Id.class\n+                            .getSimpleName()));\n+        }\n+    }\n+\n+    private Optional<String> getId(Field field) {\n+        Optional<Id> idAnnotation = AnnotationReader.getAnnotationFor(field,\n+                Id.class);", "originalCommit": "ae4c655d449025d34e76f7bae9189cef4c42047c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDcyNzQ2NA==", "url": "https://github.com/vaadin/flow/pull/9025#discussion_r490727464", "bodyText": "Remove this use of \"Id\"; it is deprecated.", "author": "vaadin-bot", "createdAt": "2020-09-18T06:24:09Z", "path": "flow-server/src/main/java/com/vaadin/flow/component/template/internal/IdCollector.java", "diffHunk": "@@ -0,0 +1,225 @@\n+/*\n+ * Copyright 2000-2020 Vaadin Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+package com.vaadin.flow.component.template.internal;\n+\n+import java.lang.reflect.Field;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.stream.Stream;\n+\n+import org.jsoup.nodes.Attribute;\n+import org.jsoup.nodes.Attributes;\n+import org.jsoup.nodes.Element;\n+\n+import com.vaadin.flow.component.Component;\n+import com.vaadin.flow.component.polymertemplate.Id;\n+import com.vaadin.flow.internal.AnnotationReader;\n+\n+/**\n+ * Collects information of {@link Id @Id} mapped fields in a template class.\n+ *\n+ * @since\n+ */\n+public class IdCollector {\n+    private final Map<String, String> tagById = new HashMap<>();\n+    private final Map<Field, String> idByField = new HashMap<>();\n+    private final Map<String, Map<String, String>> attributesById = new HashMap<>();\n+    private Element templateRoot;\n+    private Class<?> templateClass;\n+    private String templateFile;\n+\n+    /**\n+     * Creates a collector the the given template.\n+     *\n+     * @param templateClass\n+     *            the template class, containing the {@code @Id} fields\n+     * @param templateFile\n+     *            The name of the file containing the template or\n+     *            <code>null</code> if not available {@code null}\n+     * @param templateRoot\n+     *            The root element of the template or <code>null</code> if not\n+     *            available\n+     */\n+    public IdCollector(Class<?> templateClass, String templateFile,\n+            Element templateRoot) {\n+        this.templateClass = templateClass;\n+        this.templateFile = templateFile;\n+        this.templateRoot = templateRoot;\n+    }\n+\n+    /**\n+     * Scans the given template class and finds fields mapped using\n+     * {@link com.vaadin.flow.component.template.Id @Id}.\n+     *\n+     * @param notInjectableElementIds\n+     *            ids which cannot be injected\n+     */\n+    public void collectInjectedIds(Set<String> notInjectableElementIds) {\n+        collectInjectedIds(templateClass, notInjectableElementIds);\n+    }\n+\n+    private void collectInjectedIds(Class<?> cls,\n+            Set<String> notInjectableElementIds) {\n+        if (!Component.class.equals(cls.getSuperclass())) {\n+            // Parent fields\n+            collectInjectedIds(cls.getSuperclass(), notInjectableElementIds);\n+        }\n+\n+        Stream.of(cls.getDeclaredFields()).filter(field -> !field.isSynthetic())\n+                .forEach(field -> collectedInjectedId(field,\n+                        notInjectableElementIds));\n+    }\n+\n+    private void collectedInjectedId(Field field,\n+            Set<String> notInjectableElementIds) {\n+        String id = getId(field).orElse(null);\n+        if (id == null) {\n+            return;\n+        }\n+        boolean emptyValue = id.isEmpty();\n+        if (emptyValue) {\n+            id = field.getName();\n+        }\n+        if (notInjectableElementIds.contains(id)) {\n+            throw new IllegalStateException(String.format(\n+                    \"Class '%s' contains field '%s' annotated with @Id%s. \"\n+                            + \"Corresponding element was found in a sub template, \"\n+                            + \"for which injection is not supported.\",\n+                    templateClass.getName(), field.getName(),\n+                    emptyValue\n+                            ? \" without value (so the name of the field should match the id of an element in the template)\"\n+                            : \"(\\\"\" + id + \"\\\")\"));\n+        }\n+\n+        if (!collectElementData(id, field)) {\n+            throw new IllegalStateException(String.format(\n+                    \"There is no element with \"\n+                            + \"id='%s' in the template file '%s'. Cannot map it using @%s\",\n+                    id, templateFile,\n+                    com.vaadin.flow.component.template.Id.class\n+                            .getSimpleName()));\n+        }\n+    }\n+\n+    private Optional<String> getId(Field field) {\n+        Optional<Id> idAnnotation = AnnotationReader.getAnnotationFor(field,\n+                Id.class);\n+        if (idAnnotation.isPresent()) {\n+            return idAnnotation.map(Id::value);", "originalCommit": "ae4c655d449025d34e76f7bae9189cef4c42047c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDcyNzQ3Ng==", "url": "https://github.com/vaadin/flow/pull/9025#discussion_r490727476", "bodyText": "Do not forget to remove this deprecated code someday.", "author": "vaadin-bot", "createdAt": "2020-09-18T06:24:09Z", "path": "flow-server/src/main/java/com/vaadin/flow/templatemodel/TemplateModel.java", "diffHunk": "@@ -38,7 +38,13 @@\n  *\n  * @author Vaadin Ltd\n  * @since 1.0\n+ * \n+ * @deprecated Template model is not supported for lit template, but you can use\n+ *             {@code @Id} mapping and the component API or the element API with\n+ *             property synchronization instead. This will be removed in an\n+ *             upcoming version.\n  */\n+@Deprecated\n public interface TemplateModel extends Serializable {", "originalCommit": "ae4c655d449025d34e76f7bae9189cef4c42047c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDcyNzQ4NA==", "url": "https://github.com/vaadin/flow/pull/9025#discussion_r490727484", "bodyText": "Do not forget to remove this deprecated code someday.", "author": "vaadin-bot", "createdAt": "2020-09-18T06:24:10Z", "path": "flow-server/src/main/java/com/vaadin/flow/internal/nodefeature/PolymerServerEventHandlers.java", "diffHunk": "@@ -34,8 +34,12 @@\n  *\n  * @author Vaadin Ltd\n  * @since 1.0\n+ * \n+ * @deprecated Polymer template support is deprecated - use LitTemplate instead.\n+ *             This will be removed in an upcoming version.\n  *\n  */\n+@Deprecated\n public class PolymerServerEventHandlers", "originalCommit": "ae4c655d449025d34e76f7bae9189cef4c42047c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDcyNzQ4Nw==", "url": "https://github.com/vaadin/flow/pull/9025#discussion_r490727487", "bodyText": "Do not forget to remove this deprecated code someday.", "author": "vaadin-bot", "createdAt": "2020-09-18T06:24:11Z", "path": "flow-server/src/main/java/com/vaadin/flow/component/polymertemplate/TemplateParser.java", "diffHunk": "@@ -42,8 +47,9 @@\n      *\n      * @author Vaadin Ltd\n      * @since 1.0\n-     *\n+     * @deprecated Use {@link LitTemplateParser.TemplateData} instead\n      */\n+    @Deprecated\n     class TemplateData {", "originalCommit": "ae4c655d449025d34e76f7bae9189cef4c42047c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDcyNzQ5Mg==", "url": "https://github.com/vaadin/flow/pull/9025#discussion_r490727492", "bodyText": "Do not forget to remove this deprecated code someday.", "author": "vaadin-bot", "createdAt": "2020-09-18T06:24:12Z", "path": "flow-server/src/main/java/com/vaadin/flow/component/polymertemplate/TemplateParser.java", "diffHunk": "@@ -29,8 +31,11 @@\n  *\n  * @author Vaadin Ltd\n  * @since 1.0\n- *\n+ * @deprecated Use {@link LitTemplateParser} for {@link LitTemplate} components,\n+ *             polymer templates are deprecated This will be removed in an\n+ *             upcoming version.\n  */\n+@Deprecated\n @FunctionalInterface\n public interface TemplateParser {", "originalCommit": "ae4c655d449025d34e76f7bae9189cef4c42047c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDcyNzQ5OQ==", "url": "https://github.com/vaadin/flow/pull/9025#discussion_r490727499", "bodyText": "Do not forget to remove this deprecated code someday.", "author": "vaadin-bot", "createdAt": "2020-09-18T06:24:13Z", "path": "flow-server/src/main/java/com/vaadin/flow/server/communication/rpc/PublishedServerEventHandlerRpcHandler.java", "diffHunk": "@@ -58,7 +58,10 @@\n  * @author Vaadin Ltd\n  * @since 1.0\n  *\n+ * @deprecated Polymer template support is deprecated - use LitTemplate instead.\n+ *             This will be removed in an upcoming version.\n  */\n+@Deprecated\n public class PublishedServerEventHandlerRpcHandler", "originalCommit": "ae4c655d449025d34e76f7bae9189cef4c42047c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDczMzI5Nw==", "url": "https://github.com/vaadin/flow/pull/9025#discussion_r490733297", "bodyText": "Rename this class. \n Do not forget to remove this deprecated code someday.", "author": "vaadin-bot", "createdAt": "2020-09-18T06:39:42Z", "path": "flow-server/src/main/java/com/vaadin/flow/component/polymertemplate/IdCollector.java", "diffHunk": "@@ -35,14 +26,13 @@\n  * Collects information of {@link Id @Id} mapped fields in a template class.\n  *\n  * @since 2.0\n+ * @deprecated Use\n+ *             {@link com.vaadin.flow.component.template.internal.IdCollector}\n+ *             instead. This will be removed in an upcoming version.\n  */\n-public class IdCollector {\n-    private final Map<String, String> tagById = new HashMap<>();\n-    private final Map<Field, String> idByField = new HashMap<>();\n-    private final Map<String, Map<String, String>> attributesById = new HashMap<>();\n-    private Element templateRoot;\n-    private Class<?> templateClass;\n-    private String templateFile;\n+@Deprecated\n+public class IdCollector", "originalCommit": "ae4c655d449025d34e76f7bae9189cef4c42047c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDczMzMyOQ==", "url": "https://github.com/vaadin/flow/pull/9025#discussion_r490733329", "bodyText": "Call \"tagName.isPresent()\" before accessing the value.", "author": "vaadin-bot", "createdAt": "2020-09-18T06:39:46Z", "path": "flow-server/src/main/java/com/vaadin/flow/component/template/internal/IdCollector.java", "diffHunk": "@@ -0,0 +1,225 @@\n+/*\n+ * Copyright 2000-2020 Vaadin Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+package com.vaadin.flow.component.template.internal;\n+\n+import java.lang.reflect.Field;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.stream.Stream;\n+\n+import org.jsoup.nodes.Attribute;\n+import org.jsoup.nodes.Attributes;\n+import org.jsoup.nodes.Element;\n+\n+import com.vaadin.flow.component.Component;\n+import com.vaadin.flow.component.polymertemplate.Id;\n+import com.vaadin.flow.internal.AnnotationReader;\n+\n+/**\n+ * Collects information of {@link Id @Id} mapped fields in a template class.\n+ *\n+ * @since\n+ */\n+public class IdCollector {\n+    private final Map<String, String> tagById = new HashMap<>();\n+    private final Map<Field, String> idByField = new HashMap<>();\n+    private final Map<String, Map<String, String>> attributesById = new HashMap<>();\n+    private Element templateRoot;\n+    private Class<?> templateClass;\n+    private String templateFile;\n+\n+    /**\n+     * Creates a collector the the given template.\n+     *\n+     * @param templateClass\n+     *            the template class, containing the {@code @Id} fields\n+     * @param templateFile\n+     *            The name of the file containing the template or\n+     *            <code>null</code> if not available {@code null}\n+     * @param templateRoot\n+     *            The root element of the template or <code>null</code> if not\n+     *            available\n+     */\n+    public IdCollector(Class<?> templateClass, String templateFile,\n+            Element templateRoot) {\n+        this.templateClass = templateClass;\n+        this.templateFile = templateFile;\n+        this.templateRoot = templateRoot;\n+    }\n+\n+    /**\n+     * Scans the given template class and finds fields mapped using\n+     * {@link com.vaadin.flow.component.template.Id @Id}.\n+     *\n+     * @param notInjectableElementIds\n+     *            ids which cannot be injected\n+     */\n+    public void collectInjectedIds(Set<String> notInjectableElementIds) {\n+        collectInjectedIds(templateClass, notInjectableElementIds);\n+    }\n+\n+    private void collectInjectedIds(Class<?> cls,\n+            Set<String> notInjectableElementIds) {\n+        if (!Component.class.equals(cls.getSuperclass())) {\n+            // Parent fields\n+            collectInjectedIds(cls.getSuperclass(), notInjectableElementIds);\n+        }\n+\n+        Stream.of(cls.getDeclaredFields()).filter(field -> !field.isSynthetic())\n+                .forEach(field -> collectedInjectedId(field,\n+                        notInjectableElementIds));\n+    }\n+\n+    private void collectedInjectedId(Field field,\n+            Set<String> notInjectableElementIds) {\n+        String id = getId(field).orElse(null);\n+        if (id == null) {\n+            return;\n+        }\n+        boolean emptyValue = id.isEmpty();\n+        if (emptyValue) {\n+            id = field.getName();\n+        }\n+        if (notInjectableElementIds.contains(id)) {\n+            throw new IllegalStateException(String.format(\n+                    \"Class '%s' contains field '%s' annotated with @Id%s. \"\n+                            + \"Corresponding element was found in a sub template, \"\n+                            + \"for which injection is not supported.\",\n+                    templateClass.getName(), field.getName(),\n+                    emptyValue\n+                            ? \" without value (so the name of the field should match the id of an element in the template)\"\n+                            : \"(\\\"\" + id + \"\\\")\"));\n+        }\n+\n+        if (!collectElementData(id, field)) {\n+            throw new IllegalStateException(String.format(\n+                    \"There is no element with \"\n+                            + \"id='%s' in the template file '%s'. Cannot map it using @%s\",\n+                    id, templateFile,\n+                    com.vaadin.flow.component.template.Id.class\n+                            .getSimpleName()));\n+        }\n+    }\n+\n+    private Optional<String> getId(Field field) {\n+        Optional<Id> idAnnotation = AnnotationReader.getAnnotationFor(field,\n+                Id.class);\n+        if (idAnnotation.isPresent()) {\n+            return idAnnotation.map(Id::value);\n+        }\n+        return AnnotationReader\n+                .getAnnotationFor(field,\n+                        com.vaadin.flow.component.template.Id.class)\n+                .map(com.vaadin.flow.component.template.Id::value);\n+    }\n+\n+    /**\n+     * Stores mapping between the given id and field.\n+     *\n+     * @param id\n+     *            the id value\n+     * @param field\n+     *            the Java field\n+     * @return <code>false</code> if the mapping did not pass validation,\n+     *         <code>true</code> otherwise\n+     */\n+    private boolean collectElementData(String id, Field field) {\n+        idByField.put(field, id);\n+        if (templateRoot != null) {\n+            // The template is available for parsing so check up front if the id\n+            // exists\n+            Optional<Element> element = Optional\n+                    .ofNullable(templateRoot.getElementById(id));\n+            Optional<String> tagName = element\n+                    .map(org.jsoup.nodes.Element::tagName);\n+            if (element.isPresent()) {\n+                Element domElement = element.get();\n+                tagById.put(id, tagName.get());", "originalCommit": "ae4c655d449025d34e76f7bae9189cef4c42047c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDczMjk1OA==", "url": "https://github.com/vaadin/flow/pull/9025#discussion_r490732958", "bodyText": "Referring to polymer template", "author": "pleku", "createdAt": "2020-09-18T06:38:47Z", "path": "flow-server/src/main/java/com/vaadin/flow/component/littemplate/BundleLitParser.java", "diffHunk": "@@ -0,0 +1,234 @@\n+/*\n+ * Copyright 2000-2020 Vaadin Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+package com.vaadin.flow.component.littemplate;\n+\n+import static com.vaadin.flow.server.frontend.FrontendUtils.DEAULT_FLOW_RESOURCES_FOLDER;\n+import static com.vaadin.flow.server.frontend.FrontendUtils.FLOW_NPM_PACKAGE_NAME;\n+import static elemental.json.JsonType.ARRAY;\n+import static elemental.json.JsonType.OBJECT;\n+import static elemental.json.JsonType.STRING;\n+\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+\n+import org.jsoup.Jsoup;\n+import org.jsoup.nodes.Document;\n+import org.jsoup.nodes.Element;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import com.vaadin.flow.internal.StringUtil;\n+\n+import elemental.json.Json;\n+import elemental.json.JsonArray;\n+import elemental.json.JsonObject;\n+import elemental.json.JsonType;\n+\n+/**\n+ * Parse statistics data provided by webpack.\n+ *\n+ * @author Vaadin Ltd\n+ * @since\n+ *\n+ * @see LitTemplateParser\n+ */\n+public final class BundleLitParser {\n+\n+    private static final Logger LOGGER = LoggerFactory\n+            .getLogger(BundleLitParser.class);\n+\n+    private static final String SOURCE = \"source\";\n+    private static final String NAME = \"name\";\n+    private static final String CHUNKS = \"chunks\";\n+    private static final String MODULES = \"modules\";\n+\n+    /**\n+     * Lit template pattern matches the template getter\n+     *\n+     * <pre>\n+     *     render() {\n+     *       return html`\n+     *         &lt;style&gt;\n+     *           .response { margin-top: 10px`; }\n+     *         &lt;/style&gt;\n+     *         &lt;paper-checkbox checked=&quot;${liked}&quot;&gt;I like web components.&lt;/paper-checkbox&gt;\n+     *\n+     *         &lt;div id=&quot;test&quot; ?hidden=&quot;${liked}&quot; class=&quot;response&quot;&gt;Web components like you, too.&lt;/div&gt;\n+     *       `;\n+     *     }\n+     * </pre>\n+     *\n+     * <p>\n+     * <code>render\\(\\)[\\s]*\\{</code> finds the template getter method\n+     * <p>\n+     * <code>[\\s]*return[\\s]*html`</code> finds the return statement\n+     * <p>\n+     * </p>\n+     * <code>(([^`]|\\\\\\\\.)*)</code> captures all text until we encounter the end\n+     * character with <code>;}</code> e.g. <code>';}</code>\n+     */\n+    private static final Pattern LIT_TEMPLATE_PATTERN = Pattern.compile(\n+            \"render\\\\(\\\\)[\\\\s]*\\\\{[\\\\s]*return[\\\\s]*html`(([^`]|\\\\\\\\.)*)`;[\\\\s]*\\\\}\");\n+\n+    private static final Pattern HASH_PATTERN = Pattern\n+            .compile(\"\\\"hash\\\"\\\\s*:\\\\s*\\\"([^\\\"]+)\\\"\\\\s*,\");\n+\n+    private static final String TEMPLATE_TAG_NAME = \"template\";\n+\n+    private BundleLitParser() {\n+    }\n+\n+    /**\n+     * Gets the hash from the string content of a webpack stats file. It uses\n+     * regex to avoid parsing the entire string into a json object.\n+     *\n+     * @param fileContents\n+     *            the content of the stats file\n+     * @return the hash\n+     */\n+    public static String getHashFromStatistics(String fileContents) {\n+        Matcher matcher = HASH_PATTERN.matcher(fileContents);\n+        return matcher.find() ? matcher.group(1) : \"\" + fileContents.length();\n+    }\n+\n+    /**\n+     * Parses the content of the stats file to return a json object.\n+     *\n+     * @param fileContents\n+     *            the content of the stats file\n+     * @return a JsonObject with the stats\n+     */\n+    public static JsonObject parseJsonStatistics(String fileContents) {\n+        return Json.parse(fileContents);\n+    }\n+\n+    /**\n+     * Get a module source from the statistics Json file generated by webpack.\n+     *\n+     * @param fileName\n+     *            name of the file to get from the json\n+     * @param statistics\n+     *            statistics json as a JsonObject\n+     * @return JsonObject for the file statistic\n+     */\n+    public static String getSourceFromStatistics(String fileName,\n+            JsonObject statistics) {\n+        return getSourceFromObject(statistics, fileName);\n+    }\n+\n+    /**\n+     * Get the Lit template element for the given polymer template source.\n+     *\n+     * @param fileName\n+     *            name of the handled file\n+     * @param source\n+     *            source js to get template element from\n+     * @return template element or {code null} if not found\n+     */\n+    public static Element parseLitTemplateElement(String fileName,\n+            String source) {\n+        Document templateDocument = null;\n+        String content = StringUtil.removeComments(source);\n+        Matcher templateMatcher = LIT_TEMPLATE_PATTERN.matcher(content);\n+\n+        // GroupCount should be 2 as the first group contains `|'|\" depending\n+        // on what was in template return html' and the second is the\n+        // template contents.\n+        if (templateMatcher.find() && templateMatcher.groupCount() == 2) {\n+            String group = templateMatcher.group(1);\n+            LOGGER.trace(\"Found regular Lit template content was {}\", group);\n+\n+            templateDocument = Jsoup.parse(group);\n+            LOGGER.trace(\"The parsed template document was {}\",\n+                    templateDocument);\n+            Element template = templateDocument\n+                    .createElement(TEMPLATE_TAG_NAME);\n+            Element body = templateDocument.body();\n+            templateDocument.body().children().stream()\n+                    .filter(node -> !node.equals(body))\n+                    .forEach(template::appendChild);\n+\n+            return template;\n+        }\n+        LOGGER.warn(\"No lit template data found in {} sources.\", fileName);\n+        return null;\n+    }\n+\n+    // find the first module whose name matches the file name\n+    private static String getSourceFromObject(JsonObject module,\n+            String fileName) {\n+        String source = null;\n+        if (validKey(module, MODULES, ARRAY)) {\n+            source = getSourceFromArray(module.getArray(MODULES), fileName);\n+        }\n+        if (source == null && validKey(module, CHUNKS, ARRAY)) {\n+            source = getSourceFromArray(module.getArray(CHUNKS), fileName);\n+        }\n+        if (source == null && validKey(module, NAME, STRING)\n+                && validKey(module, SOURCE, STRING)) {\n+            String name = module.getString(NAME);\n+\n+            // append `.js` extension if not yet as webpack does\n+            fileName = fileName.replaceFirst(\"(\\\\.js|)$\", \".js\");\n+\n+            String alternativeFileName = fileName\n+                    // Replace frontend part since webpack entry-point is\n+                    // already in the frontend folder\n+                    .replaceFirst(\"^(\\\\./)frontend/\", \"$1\")\n+                    // Replace the flow frontend protocol\n+                    .replaceFirst(\"^frontend://\", \".\");\n+\n+            // For polymer templates inside add-ons we will not find the sources", "originalCommit": "ae4c655d449025d34e76f7bae9189cef4c42047c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDczNTY3NA==", "url": "https://github.com/vaadin/flow/pull/9025#discussion_r490735674", "bodyText": "Polymer 2 detected - this should be removed as we have not supported polymer 2 since 3.0.", "author": "pleku", "createdAt": "2020-09-18T06:45:25Z", "path": "flow-server/src/main/java/com/vaadin/flow/component/polymertemplate/BundleParser.java", "diffHunk": "@@ -229,44 +200,6 @@ public static Element parseTemplateElement(String fileName, String source) {\n         return template;\n     }\n \n-    /**\n-     * Get the Lit template element for the given polymer template source.\n-     *\n-     * @param fileName\n-     *            name of the handled file\n-     * @param source\n-     *            source js to get template element from\n-     * @return template element or {code null} if not found\n-     */\n-    public static Element parseLitTemplateElement(String fileName,\n-            String source) {\n-        Document templateDocument = null;\n-        String content = StringUtil.removeComments(source);\n-        Matcher templateMatcher = LIT_TEMPLATE_PATTERN.matcher(content);\n-\n-        // GroupCount should be 2 as the first group contains `|'|\" depending\n-        // on what was in template return html' and the second is the\n-        // template contents.\n-        if (templateMatcher.find() && templateMatcher.groupCount() == 2) {\n-            String group = templateMatcher.group(1);\n-            LOGGER.trace(\"Found regular Lit template content was {}\", group);\n-\n-            templateDocument = Jsoup.parse(group);\n-            LOGGER.trace(\"The parsed template document was {}\",\n-                    templateDocument);\n-            Element template = templateDocument\n-                    .createElement(TEMPLATE_TAG_NAME);\n-            Element body = templateDocument.body();\n-            templateDocument.body().children().stream()\n-                    .filter(node -> !node.equals(body))\n-                    .forEach(template::appendChild);\n-\n-            return template;\n-        }\n-        LOGGER.warn(\"No lit template data found in {} sources.\", fileName);\n-        return null;\n-    }\n-\n     private static Element tryParsePolymer2(Document templateDocument,", "originalCommit": "ae4c655d449025d34e76f7bae9189cef4c42047c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDg1NTU2Ng==", "url": "https://github.com/vaadin/flow/pull/9025#discussion_r490855566", "bodyText": "I believe it's not Polymer 2 but some polymer2 style which can be used for Polymer 3.\nI don't remember exactly but anyway, this is not a part of this PR.", "author": "denis-anisimov", "createdAt": "2020-09-18T10:32:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDczNTY3NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDc4MjIyNg==", "url": "https://github.com/vaadin/flow/pull/9025#discussion_r490782226", "bodyText": "I think the first recommendation would be to \"Add a corresponding DOM listener from server side API instead.\" Then as second, if there is no event ready, either firing a custom event from client side template or ^ could be recommended. The custom event makes for more reusable code IMO.", "author": "pleku", "createdAt": "2020-09-18T08:20:30Z", "path": "flow-server/src/main/java/com/vaadin/flow/component/polymertemplate/EventHandler.java", "diffHunk": "@@ -32,7 +32,13 @@\n  * @author Vaadin Ltd\n  * @since 1.0\n  *\n+ * @deprecated Event handlers are not supported by Lit templates, the event\n+ *             should be handled directly on the client side and the server side\n+ *             may be called from this handler via", "originalCommit": "ae4c655d449025d34e76f7bae9189cef4c42047c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDc4MzgzMw==", "url": "https://github.com/vaadin/flow/pull/9025#discussion_r490783833", "bodyText": ", polymer templates are deprecated.\n\nUnnecessary repeat", "author": "pleku", "createdAt": "2020-09-18T08:23:25Z", "path": "flow-server/src/main/java/com/vaadin/flow/component/polymertemplate/PolymerTemplate.java", "diffHunk": "@@ -47,7 +49,11 @@\n  *\n  * @author Vaadin Ltd\n  * @since 1.0\n+ * @deprecated Polymer template support is deprecated - use {@link LitTemplate}\n+ *             instead, polymer templates are deprecated. This will be removed", "originalCommit": "ae4c655d449025d34e76f7bae9189cef4c42047c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDgyNzc3NQ==", "url": "https://github.com/vaadin/flow/pull/9025#discussion_r490827775", "bodyText": "This message should instead be:\nPolymer template support is deprecated - we recommend you to use {@link LitTemplate} instead. Read more details from <a href=\"https://vaadin.com/blog/future-of-html-templates-in-vaadin\">the Vaadin blog.</a>\"", "author": "pleku", "createdAt": "2020-09-18T09:40:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDc4MzgzMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDc5NDU2NQ==", "url": "https://github.com/vaadin/flow/pull/9025#discussion_r490794565", "bodyText": "Maybe should change this to \"..of a component or an element to..\" since +90% cases should be with component", "author": "pleku", "createdAt": "2020-09-18T08:42:19Z", "path": "flow-server/src/main/java/com/vaadin/flow/component/template/Id.java", "diffHunk": "@@ -0,0 +1,91 @@\n+/*\n+ * Copyright 2000-2020 Vaadin Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+package com.vaadin.flow.component.template;\n+\n+import java.lang.annotation.Documented;\n+import java.lang.annotation.ElementType;\n+import java.lang.annotation.Retention;\n+import java.lang.annotation.RetentionPolicy;\n+import java.lang.annotation.Target;\n+\n+import com.vaadin.flow.component.Component;\n+import com.vaadin.flow.component.littemplate.LitTemplate;\n+import com.vaadin.flow.dom.Element;\n+\n+/**\n+ * Defines the id of an element to map to inside a lit template.", "originalCommit": "ae4c655d449025d34e76f7bae9189cef4c42047c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDc5NTIwNw==", "url": "https://github.com/vaadin/flow/pull/9025#discussion_r490795207", "bodyText": "This should be updated to say that \"attribute values are reflected\" instead", "author": "pleku", "createdAt": "2020-09-18T08:43:33Z", "path": "flow-server/src/main/java/com/vaadin/flow/component/template/Id.java", "diffHunk": "@@ -0,0 +1,91 @@\n+/*\n+ * Copyright 2000-2020 Vaadin Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+package com.vaadin.flow.component.template;\n+\n+import java.lang.annotation.Documented;\n+import java.lang.annotation.ElementType;\n+import java.lang.annotation.Retention;\n+import java.lang.annotation.RetentionPolicy;\n+import java.lang.annotation.Target;\n+\n+import com.vaadin.flow.component.Component;\n+import com.vaadin.flow.component.littemplate.LitTemplate;\n+import com.vaadin.flow.dom.Element;\n+\n+/**\n+ * Defines the id of an element to map to inside a lit template.\n+ * <p>\n+ * Use this annotation with an identifier of the element which you want to refer\n+ * to as a value for a field inside your {@link LitTemplate} class.\n+ * <p>\n+ * Here is a Java sample:\n+ *\n+ * <pre>\n+ * <code>\n+ * &#64;Tag(\"details\")\n+ * public class Details extends {@link LitTemplate}{\n+ *\n+ *      &#64;Id(\"name\")\n+ *      private Div nestedDiv;\n+ *\n+ *      &#64;Id(\"email\")\n+ *      private Element nestedElement;\n+ * }\n+ * </code>\n+ * </pre>\n+ *\n+ * This code may be used with the following template:\n+ *\n+ * <pre>\n+ * <code>\n+ *    render(){\n+ *     return html`\n+ *     &lt;div id='name'&gt;\n+ *      &lt;label&gt;Text&lt;/label&gt;\n+ *     &lt;/div&gt;\n+ *     &lt;input type=\"text\" id='email'&gt;&lt;/div\"&gt;\n+ *     `;\n+ *   ....\n+ * </code>\n+ * </pre>\n+ * <p>\n+ * It's important to understand that the element's hierarchical structure for\n+ * the element injected via <code>@Id</code> is not populated and not available\n+ * on the server side (it's not known). It means that <code>nestedDiv</code>\n+ * field value which is a <code>Div</code> component doesn't have any child on\n+ * the server side. Also attribute values declared on the client side are not", "originalCommit": "ae4c655d449025d34e76f7bae9189cef4c42047c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDc5NzE0Mg==", "url": "https://github.com/vaadin/flow/pull/9025#discussion_r490797142", "bodyText": "newline", "author": "pleku", "createdAt": "2020-09-18T08:46:51Z", "path": "flow-server/src/main/java/com/vaadin/flow/component/template/internal/InjectableFieldConsumer.java", "diffHunk": "@@ -0,0 +1,29 @@\n+package com.vaadin.flow.component.template.internal;\n+\n+import java.lang.reflect.Field;\n+\n+/**\n+ * Three argument consumer.\n+ *\n+ * @author Vaadin Ltd\n+ * @since\n+ *\n+ */\n+@FunctionalInterface\n+public interface InjectableFieldConsumer {\n+\n+    /**\n+     * Performs this operation on the given arguments.\n+     * <p>\n+     * The arguments are: the field declared in a template class, the identifier\n+     * of the element inside the HTML template file, the element tag.\n+     *\n+     * @param field\n+     *            the field declared in a template class\n+     * @param id\n+     *            the element id\n+     * @param tag\n+     *            the element tag\n+     */\n+    void apply(Field field, String id, String tag);\n+}", "originalCommit": "ae4c655d449025d34e76f7bae9189cef4c42047c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDc5NzcwMw==", "url": "https://github.com/vaadin/flow/pull/9025#discussion_r490797703", "bodyText": "newline", "author": "pleku", "createdAt": "2020-09-18T08:47:50Z", "path": "flow-server/src/main/java/com/vaadin/flow/component/template/internal/ParserData.java", "diffHunk": "@@ -0,0 +1,80 @@\n+/*\n+ * Copyright 2000-2020 Vaadin Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+package com.vaadin.flow.component.template.internal;\n+\n+import java.lang.reflect.Field;\n+import java.util.Collections;\n+import java.util.Map;\n+\n+/**\n+ * \n+ * Immutable parser data which may be stored in cache.\n+ * \n+ * @author Vaadin Ltd\n+ * @since\n+ *\n+ */\n+public class ParserData {\n+\n+    private final Map<String, String> tagById;\n+    private final Map<Field, String> idByField;\n+\n+    private final Map<String, Map<String, String>> attributesById;\n+\n+    /**\n+     * Constructs an immutable data object with the given information.\n+     *\n+     * @param fields\n+     *            a map of fields to their ids\n+     * @param tags\n+     *            a map of ids to their tags\n+     * @param attributes\n+     *            a map of attributes values to the element id\n+     */\n+    public ParserData(Map<Field, String> fields, Map<String, String> tags,\n+            Map<String, Map<String, String>> attributes) {\n+        tagById = Collections.unmodifiableMap(tags);\n+        idByField = Collections.unmodifiableMap(fields);\n+        attributesById = Collections.unmodifiableMap(attributes);\n+    }\n+\n+    /**\n+     * Applies the given consumer to each mapped field.\n+     *\n+     * @param consumer\n+     *            the consumer to call for each mapped field\n+     */\n+    public void forEachInjectedField(InjectableFieldConsumer consumer) {\n+        idByField.forEach(\n+                (field, id) -> consumer.apply(field, id, tagById.get(id)));\n+    }\n+\n+    /**\n+     * Gets template element data (attribute values).\n+     * \n+     * @param id\n+     *            the id of the element\n+     * @return template data\n+     */\n+    public Map<String, String> getAttributes(String id) {\n+        Map<String, String> attrs = attributesById.get(id);\n+        if (attrs == null) {\n+            return Collections.emptyMap();\n+        }\n+        return attrs;\n+    }\n+\n+}", "originalCommit": "ae4c655d449025d34e76f7bae9189cef4c42047c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDgwMTIwMg==", "url": "https://github.com/vaadin/flow/pull/9025#discussion_r490801202", "bodyText": "Maybe the message could be instead\nTemplate model and polymer template support is deprecated - we recommend you to use {@link LitTemplate} instead. Read more details from <a href=\"https://vaadin.com/blog/future-of-html-templates-in-vaadin\">the Vaadin blog.</a> For lit templates, you can use ...\"", "author": "pleku", "createdAt": "2020-09-18T08:53:54Z", "path": "flow-server/src/main/java/com/vaadin/flow/templatemodel/ClientUpdateMode.java", "diffHunk": "@@ -22,7 +22,13 @@\n  *\n  * @author Vaadin Ltd\n  * @since 1.0\n+ * @deprecated This functionality is bound to template model which is not\n+ *             supported for lit template. You can use {@code @Id} mapping and", "originalCommit": "ae4c655d449025d34e76f7bae9189cef4c42047c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDgwMTcyNw==", "url": "https://github.com/vaadin/flow/pull/9025#discussion_r490801727", "bodyText": "Maybe the message could be instead\nTemplate model and polymer template support is deprecated - we recommend you to use {@link LitTemplate} instead. Read more details from <a href=\"https://vaadin.com/blog/future-of-html-templates-in-vaadin\">the Vaadin blog.</a> For lit templates, you can use ...\"", "author": "pleku", "createdAt": "2020-09-18T08:54:46Z", "path": "flow-server/src/main/java/com/vaadin/flow/templatemodel/Encode.java", "diffHunk": "@@ -33,6 +33,12 @@\n  *\n  * @author Vaadin Ltd\n  * @since 1.0\n+ * \n+ * @deprecated This functionality is bound to template model which is not\n+ *             supported for lit template. You can use {@code @Id} mapping and", "originalCommit": "ae4c655d449025d34e76f7bae9189cef4c42047c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDgwMjEyMQ==", "url": "https://github.com/vaadin/flow/pull/9025#discussion_r490802121", "bodyText": "Maybe the message could be instead\nTemplate model and polymer template support is deprecated - we recommend you to use {@link LitTemplate} instead. Read more details from <a href=\"https://vaadin.com/blog/future-of-html-templates-in-vaadin\">the Vaadin blog.</a> For lit templates, you can use ...\"", "author": "pleku", "createdAt": "2020-09-18T08:55:22Z", "path": "flow-server/src/main/java/com/vaadin/flow/templatemodel/Exclude.java", "diffHunk": "@@ -39,6 +39,12 @@\n  *\n  * @author Vaadin Ltd\n  * @since 1.0\n+ * \n+ * @deprecated This functionality is bound to template model which is not\n+ *             supported for lit template. You can use {@code @Id} mapping and", "originalCommit": "ae4c655d449025d34e76f7bae9189cef4c42047c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDgwMjQ0OQ==", "url": "https://github.com/vaadin/flow/pull/9025#discussion_r490802449", "bodyText": "Maybe the message could be instead\nTemplate model and polymer template support is deprecated - we recommend you to use {@link LitTemplate} instead. Read more details from <a href=\"https://vaadin.com/blog/future-of-html-templates-in-vaadin\">the Vaadin blog.</a> For lit templates, you can use ...\"", "author": "pleku", "createdAt": "2020-09-18T08:55:56Z", "path": "flow-server/src/main/java/com/vaadin/flow/templatemodel/Include.java", "diffHunk": "@@ -37,8 +37,13 @@\n  *\n  * @see Exclude\n  *\n- * @author Vaadin Ltd\n  * @since 1.0\n+ * \n+ * @deprecated This functionality is bound to template model which is not\n+ *             supported for lit template. You can use {@code @Id} mapping and", "originalCommit": "ae4c655d449025d34e76f7bae9189cef4c42047c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDgwMjYwMQ==", "url": "https://github.com/vaadin/flow/pull/9025#discussion_r490802601", "bodyText": "Maybe the message could be instead\nTemplate model and polymer template support is deprecated - we recommend you to use {@link LitTemplate} instead. Read more details from <a href=\"https://vaadin.com/blog/future-of-html-templates-in-vaadin\">the Vaadin blog.</a> For lit templates, you can use ...\"", "author": "pleku", "createdAt": "2020-09-18T08:56:10Z", "path": "flow-server/src/main/java/com/vaadin/flow/templatemodel/InvalidTemplateModelException.java", "diffHunk": "@@ -20,11 +20,18 @@\n  *\n  * @author Vaadin Ltd\n  * @since 1.0\n+ * \n+ * @deprecated This functionality is bound to template model which is not\n+ *             supported for lit template. You can use {@code @Id} mapping and", "originalCommit": "ae4c655d449025d34e76f7bae9189cef4c42047c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDgwMjg1Mw==", "url": "https://github.com/vaadin/flow/pull/9025#discussion_r490802853", "bodyText": "Nit: unrelated accidental change", "author": "pleku", "createdAt": "2020-09-18T08:56:36Z", "path": "flow-server/src/main/java/com/vaadin/flow/templatemodel/InvalidTemplateModelException.java", "diffHunk": "@@ -20,11 +20,18 @@\n  *\n  * @author Vaadin Ltd\n  * @since 1.0\n+ * \n+ * @deprecated This functionality is bound to template model which is not\n+ *             supported for lit template. You can use {@code @Id} mapping and\n+ *             the component API or the element API with property\n+ *             synchronization instead. This will be removed in an upcoming\n+ *             version.\n  */\n+@Deprecated\n public class InvalidTemplateModelException extends RuntimeException {\n     /**\n-     * Creates a new exception with the given message and cause.\n-     *\n+     * Creates a new exception with the given message and cause. w", "originalCommit": "ae4c655d449025d34e76f7bae9189cef4c42047c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDgwMzAxMw==", "url": "https://github.com/vaadin/flow/pull/9025#discussion_r490803013", "bodyText": "Maybe the message could be instead\nTemplate model and polymer template support is deprecated - we recommend you to use {@link LitTemplate} instead. Read more details from <a href=\"https://vaadin.com/blog/future-of-html-templates-in-vaadin\">the Vaadin blog.</a> For lit templates, you can use ...\"", "author": "pleku", "createdAt": "2020-09-18T08:56:50Z", "path": "flow-server/src/main/java/com/vaadin/flow/templatemodel/ListModelType.java", "diffHunk": "@@ -39,7 +38,13 @@\n  * @since 1.0\n  * @param <T>\n  *            the proxy type used by the bean type of this type\n+ * \n+ * @deprecated Template model and model types are not supported for lit\n+ *             template, but you can use {@code @Id} mapping and the component", "originalCommit": "ae4c655d449025d34e76f7bae9189cef4c42047c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDgwNDQ2OQ==", "url": "https://github.com/vaadin/flow/pull/9025#discussion_r490804469", "bodyText": "Maybe the message could be instead\nTemplate model and polymer template support is deprecated - we recommend you to use {@link LitTemplate} instead. Read more details from <a href=\"https://vaadin.com/blog/future-of-html-templates-in-vaadin\">the Vaadin blog.</a> For lit templates, you can use ...\"", "author": "pleku", "createdAt": "2020-09-18T08:59:20Z", "path": "flow-server/src/main/java/com/vaadin/flow/templatemodel/TemplateModel.java", "diffHunk": "@@ -38,7 +38,13 @@\n  *\n  * @author Vaadin Ltd\n  * @since 1.0\n+ * \n+ * @deprecated Template model is not supported for lit template, but you can use\n+ *             {@code @Id} mapping and the component API or the element API with", "originalCommit": "ae4c655d449025d34e76f7bae9189cef4c42047c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "58b3181f64b15fbfbc5d9263aa25da889f00874d", "url": "https://github.com/vaadin/flow/commit/58b3181f64b15fbfbc5d9263aa25da889f00874d", "message": "Fix SQ complains", "committedDate": "2020-09-18T10:09:42Z", "type": "commit"}, {"oid": "7b5eb5ff38a689d16e04780b0f8c232ac8bc3f33", "url": "https://github.com/vaadin/flow/commit/7b5eb5ff38a689d16e04780b0f8c232ac8bc3f33", "message": "Change deprecation message and correct jabadocs", "committedDate": "2020-09-18T10:59:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDg5NjY3Mg==", "url": "https://github.com/vaadin/flow/pull/9025#discussion_r490896672", "bodyText": "The class name com.vaadin.flow.component.polymertemplate.IdCollector shadows the simple name of the superclass com.vaadin.flow.component.template.internal.IdCollector", "author": "vaadin-bot", "createdAt": "2020-09-18T11:51:28Z", "path": "flow-server/src/main/java/com/vaadin/flow/component/polymertemplate/IdCollector.java", "diffHunk": "@@ -58,156 +50,7 @@\n      */\n     public IdCollector(Class<?> templateClass, String templateFile,\n             Element templateRoot) {\n-        this.templateClass = templateClass;\n-        this.templateFile = templateFile;\n-        this.templateRoot = templateRoot;\n-    }\n-\n-    /**\n-     * Scans the given template class and finds fields mapped using\n-     * {@link Id @Id}.\n-     *\n-     * @param notInjectableElementIds\n-     *            ids which cannot be injected\n-     */\n-    public void collectInjectedIds(Set<String> notInjectableElementIds) {\n-        collectInjectedIds(templateClass, notInjectableElementIds);\n-    }\n-\n-    private void collectInjectedIds(Class<?> cls,\n-            Set<String> notInjectableElementIds) {\n-        if (!Component.class.equals(cls.getSuperclass())) {\n-            // Parent fields\n-            collectInjectedIds(cls.getSuperclass(), notInjectableElementIds);\n-        }\n-\n-        Stream.of(cls.getDeclaredFields()).filter(field -> !field.isSynthetic())\n-                .forEach(field -> collectedInjectedId(field,\n-                        notInjectableElementIds));\n-    }\n-\n-    private void collectedInjectedId(Field field,\n-            Set<String> notInjectableElementIds) {\n-        Optional<Id> idAnnotation = AnnotationReader.getAnnotationFor(field,\n-                Id.class);\n-        if (!idAnnotation.isPresent()) {\n-            return;\n-        }\n-        String id = idAnnotation.get().value();\n-        boolean emptyValue = id.isEmpty();\n-        if (emptyValue) {\n-            id = field.getName();\n-        }\n-        if (notInjectableElementIds.contains(id)) {\n-            throw new IllegalStateException(String.format(\n-                    \"Class '%s' contains field '%s' annotated with @Id%s. \"\n-                            + \"Corresponding element was found in a sub template, \"\n-                            + \"for which injection is not supported.\",\n-                    templateClass.getName(), field.getName(),\n-                    emptyValue\n-                            ? \" without value (so the name of the field should match the id of an element in the template)\"\n-                            : \"(\\\"\" + id + \"\\\")\"));\n-        }\n-\n-        if (!collectElementData(id, field)) {\n-            throw new IllegalStateException(String.format(\n-                    \"There is no element with \"\n-                            + \"id='%s' in the template file '%s'. Cannot map it using @%s\",\n-                    id, templateFile, Id.class.getSimpleName()));\n-        }\n+        super(templateClass, templateFile, templateRoot);", "originalCommit": "7b5eb5ff38a689d16e04780b0f8c232ac8bc3f33", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTgwMjA3Nw==", "url": "https://github.com/vaadin/flow/pull/9025#discussion_r491802077", "bodyText": "Nit: typo with extra T (non-blocking)", "author": "pleku", "createdAt": "2020-09-21T05:39:30Z", "path": "flow-server/src/main/java/com/vaadin/flow/component/polymertemplate/ModelItem.java", "diffHunk": "@@ -38,8 +40,11 @@\n  *             is not supported for lit template, but you may still use\n  *             {@code @EventData(\"some_data\")} to receive data from the client\n  *             side or {@code @Id} mapping and the component API or the element\n- *             API with property synchronization instead. This will be removed\n- *             in an upcoming version.\n+ *             API with property synchronization instead. TPolymer template", "originalCommit": "7b5eb5ff38a689d16e04780b0f8c232ac8bc3f33", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTgwMzk4NA==", "url": "https://github.com/vaadin/flow/pull/9025#discussion_r491803984", "bodyText": "\"not support by\" -> \"not supported by\"", "author": "pleku", "createdAt": "2020-09-21T05:48:15Z", "path": "flow-server/src/main/java/com/vaadin/flow/component/polymertemplate/RepeatIndex.java", "diffHunk": "@@ -36,7 +37,11 @@\n  * @since 1.0\n  * @deprecated dom-repeat is not support by Lit templates but you may still use", "originalCommit": "7b5eb5ff38a689d16e04780b0f8c232ac8bc3f33", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}