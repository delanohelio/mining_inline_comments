{"pr_number": 9070, "pr_title": "Add data communicator API for disabling data provider interactions", "pr_createdAt": "2020-09-28T18:12:30Z", "pr_url": "https://github.com/vaadin/flow/pull/9070", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQ0NDc2Mw==", "url": "https://github.com/vaadin/flow/pull/9070#discussion_r496444763", "bodyText": "Unrelated unnecessary changes", "author": "pleku", "createdAt": "2020-09-29T06:24:54Z", "path": "flow-data/src/main/java/com/vaadin/flow/data/provider/DataCommunicator.java", "diffHunk": "@@ -530,8 +571,8 @@ public int getItemCountEstimateIncrease() {\n     public void setDefinedSize(boolean definedSize) {\n         if (this.definedSize != definedSize) {\n             this.definedSize = definedSize;\n-            countCallback = null;\n-            skipCountIncreaseUntilReset = false;\n+            this.countCallback = null;\n+            this.skipCountIncreaseUntilReset = false;", "originalCommit": "6a021a0c941a23095e2ec92aedb8e0b9b135e0c9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjcxNjE3Mw==", "url": "https://github.com/vaadin/flow/pull/9070#discussion_r496716173", "bodyText": "Reverted", "author": "mshabarov", "createdAt": "2020-09-29T13:28:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQ0NDc2Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQ0NTExOQ==", "url": "https://github.com/vaadin/flow/pull/9070#discussion_r496445119", "bodyText": "Unrelated unnecessary change (yes the this. for countCallback is unnecessary too)", "author": "pleku", "createdAt": "2020-09-29T06:25:38Z", "path": "flow-data/src/main/java/com/vaadin/flow/data/provider/DataCommunicator.java", "diffHunk": "@@ -496,7 +537,7 @@ public void setItemCountEstimateIncrease(int itemCountEstimateIncrease) {\n         }\n         this.itemCountEstimateIncrease = itemCountEstimateIncrease;\n         this.countCallback = null;\n-        definedSize = false;\n+        this.definedSize = false;", "originalCommit": "6a021a0c941a23095e2ec92aedb8e0b9b135e0c9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjcxNjI0Mg==", "url": "https://github.com/vaadin/flow/pull/9070#discussion_r496716242", "bodyText": "Reverted", "author": "mshabarov", "createdAt": "2020-09-29T13:28:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQ0NTExOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQ1MDM4OA==", "url": "https://github.com/vaadin/flow/pull/9070#discussion_r496450388", "bodyText": "Why should this be blocked ??? Since this API is not directly exposed to users, like it should not, it feels weird to me that for some components I can do\nComponent listing = createListing();\nlisting.setItems(query -> getStuff(query));\nlisting.getItem(0);\nbut not for all. So for Grid this would work and not for combobox (I guess) ??? That is confusing.", "author": "pleku", "createdAt": "2020-09-29T06:38:05Z", "path": "flow-data/src/main/java/com/vaadin/flow/data/provider/DataCommunicator.java", "diffHunk": "@@ -341,36 +375,43 @@ public T getItem(int index) {\n         int activeDataEnd = activeStart + activeKeyOrder.size() - 1;\n         /*\n          * Check if the item on a requested index is already in the cache of\n-         * active items. No matter is this currently a defined or undefined\n-         * mode\n+         * active items. No matter is this currently a defined or undefined mode\n          */\n         if (index >= activeStart && index <= activeDataEnd) {\n             return getKeyMapper().get(activeKeyOrder.get(index - activeStart));\n         } else {\n             final int itemCount = getItemCount();\n             /*\n-             * The exception is thrown if the exact size is used and the data\n-             * is empty, or the index is outside of the item count range,\n-             * because we definitely know the item count from a backend.\n+             * The exception is thrown if the exact size is used and the data is\n+             * empty, or the index is outside of the item count range, because\n+             * we definitely know the item count from a backend.\n              */\n             if (isDefinedSize()) {\n                 if (itemCount == 0) {\n-                    throw new IndexOutOfBoundsException(String\n-                            .format(\"Requested index %d on empty data.\", index));\n+                    throw new IndexOutOfBoundsException(String.format(\n+                            \"Requested index %d on empty data.\", index));\n                 } else if (index >= itemCount) {\n                     throw new IndexOutOfBoundsException(String.format(\n                             \"Given index %d is outside of the accepted range '0 - %d'\",\n                             index, itemCount - 1));\n                 }\n             }\n+\n+            if (fetchDisabled) {", "originalCommit": "6a021a0c941a23095e2ec92aedb8e0b9b135e0c9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjcxNzAxNg==", "url": "https://github.com/vaadin/flow/pull/9070#discussion_r496717016", "bodyText": "Excluded", "author": "mshabarov", "createdAt": "2020-09-29T13:29:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQ1MDM4OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQ1MTMwMg==", "url": "https://github.com/vaadin/flow/pull/9070#discussion_r496451302", "bodyText": "Again, it would be weird for a data view API user that the same things work for another component, but not for another.", "author": "pleku", "createdAt": "2020-09-29T06:40:12Z", "path": "flow-data/src/main/java/com/vaadin/flow/data/provider/DataCommunicator.java", "diffHunk": "@@ -648,15 +689,56 @@ public void setPagingEnabled(boolean pagingEnabled) {\n         this.pagingEnabled = pagingEnabled;\n     }\n \n+    /**\n+     * Returns whether the data communicator will call Data Provider for\n+     * fetching the items and/or getting the items count, or ignore such a\n+     * calls.\n+     *\n+     * @return {@code true} if the calls to data provider are ignored,\n+     *         {@code false} otherwise\n+     */\n+    public boolean isFetchDisabled() {\n+        return fetchDisabled;\n+    }\n+\n+    /**\n+     * Sets whether the data communicator will call Data Provider for fetching\n+     * the items and/or getting the items count, or ignore such a calls.\n+     * <p>\n+     * One may need to disable the data provider calls in order to configure the\n+     * data communicator and to postpone these calls until some event, i.e.\n+     * dropdown open event of the combo box.\n+     * <p>\n+     * This sets to {@code false} by default.\n+     *\n+     * @param fetchDisabled\n+     *            if {@code true} then the calls to data provider are ignored,\n+     *            otherwise the data provider is queried when needed.\n+     */\n+    public void setFetchDisabled(boolean fetchDisabled) {\n+        this.fetchDisabled = fetchDisabled;\n+    }\n+\n     /**\n      * Getter method for determining the item count of the data. Can be\n      * overridden by a subclass that uses a specific type of DataProvider and/or\n      * query.\n      *\n+     * @throws IllegalStateException\n+     *             if the calls to data provider are disabled.\n+     *\n      * @return the size of data provider with current filter\n      */\n     @SuppressWarnings({ \"unchecked\", \"rawtypes\" })\n     protected int getDataProviderSize() {\n+        if (fetchDisabled) {", "originalCommit": "6a021a0c941a23095e2ec92aedb8e0b9b135e0c9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjcxNzEzMg==", "url": "https://github.com/vaadin/flow/pull/9070#discussion_r496717132", "bodyText": "Excluded", "author": "mshabarov", "createdAt": "2020-09-29T13:29:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQ1MTMwMg=="}], "type": "inlineReview"}, {"oid": "4627d823d060e35fa683a7e32301dc9b137521c8", "url": "https://github.com/vaadin/flow/commit/4627d823d060e35fa683a7e32301dc9b137521c8", "message": "Add data communicator API for disabling data provider interactions", "committedDate": "2020-09-29T10:58:54Z", "type": "commit"}, {"oid": "ec18d31715b65e27ed25ee7e58e76002aff18358", "url": "https://github.com/vaadin/flow/commit/ec18d31715b65e27ed25ee7e58e76002aff18358", "message": "Exclude unnecessary restrictions", "committedDate": "2020-09-29T13:27:33Z", "type": "commit"}, {"oid": "ec18d31715b65e27ed25ee7e58e76002aff18358", "url": "https://github.com/vaadin/flow/commit/ec18d31715b65e27ed25ee7e58e76002aff18358", "message": "Exclude unnecessary restrictions", "committedDate": "2020-09-29T13:27:33Z", "type": "forcePushed"}, {"oid": "5928dc891c2c2cfd3d1cb761100fe291ba0b313b", "url": "https://github.com/vaadin/flow/commit/5928dc891c2c2cfd3d1cb761100fe291ba0b313b", "message": "Revert unchanged code formatting", "committedDate": "2020-09-29T18:48:49Z", "type": "commit"}, {"oid": "742842bbc03b20bc7eaff57df00c4b524d66e5f3", "url": "https://github.com/vaadin/flow/commit/742842bbc03b20bc7eaff57df00c4b524d66e5f3", "message": "More reverts", "committedDate": "2020-09-29T19:03:23Z", "type": "commit"}]}