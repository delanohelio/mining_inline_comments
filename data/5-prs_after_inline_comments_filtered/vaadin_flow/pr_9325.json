{"pr_number": 9325, "pr_title": "chore: consolidated offline navigation tests to single class", "pr_createdAt": "2020-11-05T14:45:17Z", "pr_url": "https://github.com/vaadin/flow/pull/9325", "timeline": [{"oid": "63c995df8a9bb2ac3279428cccb887819e5d4b08", "url": "https://github.com/vaadin/flow/commit/63c995df8a9bb2ac3279428cccb887819e5d4b08", "message": "chore: consolidated offline navigation tests to single class", "committedDate": "2020-11-05T14:43:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODU2ODQ3Mg==", "url": "https://github.com/vaadin/flow/pull/9325#discussion_r518568472", "bodyText": "I think we don't need to ignore this test?", "author": "haijian-vaadin", "createdAt": "2020-11-06T07:33:19Z", "path": "flow-tests/test-ccdm-flow-navigation/src/test/java/com/vaadin/flow/navigate/ServiceWorkerIT.java", "diffHunk": "@@ -129,4 +131,79 @@ public void openTsView_goOffline_navigateToOtherTsView_navigationSuccessful() th\n         }\n     }\n \n+    @Test\n+    @Ignore\n+    // This test fails currently because leaveNavigation currently tries to\n+    // connect to the server in offline mode.\n+    public void offlineServerView_navigateToTsView_navigationSuccessful() throws IOException {\n+        getDriver().get(getRootURL() + \"/hello\");\n+        waitForServiceWorkerReady();\n+\n+        // Set offline network conditions in ChromeDriver\n+        setConnectionType(NetworkConnection.ConnectionType.AIRPLANE_MODE);\n+\n+        try {\n+            $(\"main-view\").first().$(\"a\").id(\"menu-another\").click();\n+\n+            // Wait for component inside shadow root as there is no vaadin\n+            // to wait for as with server-side\n+            waitUntil(input -> $(\"another-view\").first().$(\"div\").id(\"another-content\")\n+                    .isDisplayed());\n+\n+            MatcherAssert.assertThat(getDriver().getCurrentUrl(),\n+                    CoreMatchers.endsWith(\"/another\"));\n+            Assert.assertTrue(getInShadowRoot(findElement(By.tagName(\"another-view\")),\n+                    By.id(\"another-content\")).isDisplayed());\n+        } finally {\n+            // Reset network conditions back\n+            setConnectionType(NetworkConnection.ConnectionType.ALL);\n+        }\n+    }\n+\n+    @Test\n+    @Ignore", "originalCommit": "63c995df8a9bb2ac3279428cccb887819e5d4b08", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODU3MTA5Mw==", "url": "https://github.com/vaadin/flow/pull/9325#discussion_r518571093", "bodyText": "Yes, it was a mistake. Fixed.", "author": "joheriks", "createdAt": "2020-11-06T07:39:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODU2ODQ3Mg=="}], "type": "inlineReview"}, {"oid": "3de6f26bc192532f271a7cab874808b2c6b05a81", "url": "https://github.com/vaadin/flow/commit/3de6f26bc192532f271a7cab874808b2c6b05a81", "message": "Unignore test", "committedDate": "2020-11-06T07:39:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODY2NTIxOA==", "url": "https://github.com/vaadin/flow/pull/9325#discussion_r518665218", "bodyText": "BTW there is one ignored test in test-ccdm module: com.vaadin.flow.ccdmtest.IndexHtmlRequestHandlerIT#should_installServiceWorker\nI verified, it is passing if running in a ChromeDeviceTest suite. So the ignoring could be removed. Should we move it here, perhaps?", "author": "platosha", "createdAt": "2020-11-06T10:38:33Z", "path": "flow-tests/test-ccdm-flow-navigation/src/test/java/com/vaadin/flow/navigate/ServiceWorkerIT.java", "diffHunk": "@@ -129,4 +131,78 @@ public void openTsView_goOffline_navigateToOtherTsView_navigationSuccessful() th\n         }\n     }\n \n+    @Test\n+    @Ignore\n+    // This test fails currently because leaveNavigation currently tries to\n+    // connect to the server in offline mode.\n+    public void offlineServerView_navigateToTsView_navigationSuccessful() throws IOException {\n+        getDriver().get(getRootURL() + \"/hello\");\n+        waitForServiceWorkerReady();\n+\n+        // Set offline network conditions in ChromeDriver\n+        setConnectionType(NetworkConnection.ConnectionType.AIRPLANE_MODE);\n+\n+        try {\n+            $(\"main-view\").first().$(\"a\").id(\"menu-another\").click();\n+\n+            // Wait for component inside shadow root as there is no vaadin\n+            // to wait for as with server-side\n+            waitUntil(input -> $(\"another-view\").first().$(\"div\").id(\"another-content\")\n+                    .isDisplayed());\n+\n+            MatcherAssert.assertThat(getDriver().getCurrentUrl(),\n+                    CoreMatchers.endsWith(\"/another\"));\n+            Assert.assertTrue(getInShadowRoot(findElement(By.tagName(\"another-view\")),\n+                    By.id(\"another-content\")).isDisplayed());\n+        } finally {\n+            // Reset network conditions back\n+            setConnectionType(NetworkConnection.ConnectionType.ALL);\n+        }\n+    }\n+\n+    @Test\n+    public void offlineTsView_navigateToServerView_offlineStubShown()\n+            throws IOException {\n+        getDriver().get(getRootURL() + \"/another\");\n+        waitForServiceWorkerReady();\n+\n+        setConnectionType(NetworkConnection.ConnectionType.AIRPLANE_MODE);\n+        try {\n+            $(\"main-view\").first().$(\"a\").id(\"menu-hello\").click();\n+\n+            waitForElementPresent(By.tagName(\"vaadin-offline-stub\"));\n+            WebElement offlineStub = findElement(\n+                    By.tagName(\"vaadin-offline-stub\"));\n+\n+            Assert.assertFalse(\n+                    \"vaadin-offline-stub shadow root expected to contain an element with class offline\",\n+                    findInShadowRoot(offlineStub, By.className(\"offline\"))\n+                            .isEmpty());\n+        } finally {\n+            setConnectionType(NetworkConnection.ConnectionType.ALL);\n+        }\n+    }\n+\n+    @Test\n+    public void offlineServerView_navigateToServerView_offlineStubShown()\n+            throws IOException {\n+        getDriver().get(getRootURL() + \"/hello\");\n+        waitForServiceWorkerReady();\n+\n+        setConnectionType(NetworkConnection.ConnectionType.AIRPLANE_MODE);\n+        try {\n+            $(\"main-view\").first().$(\"a\").id(\"menu-hello\").click();\n+\n+            waitForElementPresent(By.tagName(\"vaadin-offline-stub\"));\n+            WebElement offlineStub = findElement(\n+                    By.tagName(\"vaadin-offline-stub\"));\n+\n+            Assert.assertFalse(\n+                    \"vaadin-offline-stub shadow root expected to contain an element with class offline\",\n+                    findInShadowRoot(offlineStub, By.className(\"offline\"))\n+                            .isEmpty());\n+        } finally {\n+            setConnectionType(NetworkConnection.ConnectionType.ALL);\n+        }\n+    }", "originalCommit": "3de6f26bc192532f271a7cab874808b2c6b05a81", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "62b4030be820eea2131727f8984ab6b9c76d06fa", "url": "https://github.com/vaadin/flow/commit/62b4030be820eea2131727f8984ab6b9c76d06fa", "message": "Moved service worker IT from test-ccdm module", "committedDate": "2020-11-06T11:54:20Z", "type": "commit"}, {"oid": "b6fb9dd966e7a3661fc3cffca4dfa8b9ad206b52", "url": "https://github.com/vaadin/flow/commit/b6fb9dd966e7a3661fc3cffca4dfa8b9ad206b52", "message": "Unignored server-client offline navigation test", "committedDate": "2020-11-06T11:54:45Z", "type": "commit"}, {"oid": "ccd2dd33d55d0fd4c1ca7e6d9c1b12b1489e2703", "url": "https://github.com/vaadin/flow/commit/ccd2dd33d55d0fd4c1ca7e6d9c1b12b1489e2703", "message": "Merge branch 'feature/offline' into joheriks/9121-consolidate-offline-its", "committedDate": "2020-11-06T12:50:08Z", "type": "commit"}]}