{"pr_number": 183, "pr_title": "Status json code locations", "pr_createdAt": "2020-06-04T16:53:42Z", "pr_url": "https://github.com/blackducksoftware/synopsys-detect/pull/183", "timeline": [{"oid": "73d77215e6404c86314b9dc86aee3d6d8eb993be", "url": "https://github.com/blackducksoftware/synopsys-detect/commit/73d77215e6404c86314b9dc86aee3d6d8eb993be", "message": "feat: Incorporate code location data from all tools into status.json file (IDETECT-2035)", "committedDate": "2020-06-02T22:27:10Z", "type": "commit"}, {"oid": "bceb8e6212fed3082d20be6ad97643970517f875", "url": "https://github.com/blackducksoftware/synopsys-detect/commit/bceb8e6212fed3082d20be6ad97643970517f875", "message": "fix: Revert BazelExtractor", "committedDate": "2020-06-04T16:38:45Z", "type": "commit"}, {"oid": "1f5b0dc60a91e1f1c15d9faaeb3e635c1b408072", "url": "https://github.com/blackducksoftware/synopsys-detect/commit/1f5b0dc60a91e1f1c15d9faaeb3e635c1b408072", "message": "fix: Remove unnecessary comment", "committedDate": "2020-06-04T16:45:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTQxOTAwNA==", "url": "https://github.com/blackducksoftware/synopsys-detect/pull/183#discussion_r435419004", "bodyText": "I don't like that this is called \"collectCodeLocationNames\" when it really \"creates\" code location names.", "author": "taikuukaits", "createdAt": "2020-06-04T17:15:22Z", "path": "src/main/java/com/synopsys/integration/detect/lifecycle/run/RunManager.java", "diffHunk": "@@ -409,4 +414,14 @@ private void runBlackDuckProduct(final ProductRunData productRunData, final Dete\n         }\n     }\n \n+    private Set<String> collectCodeLocationNames(DetectableToolResult detectableToolResult, CodeLocationNameManager codeLocationNameManager, DirectoryManager directoryManager) {", "originalCommit": "1f5b0dc60a91e1f1c15d9faaeb3e635c1b408072", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTQ1MDk5Mw==", "url": "https://github.com/blackducksoftware/synopsys-detect/pull/183#discussion_r435450993", "bodyText": "that seems like a reasonable renaming", "author": "crowleySynopsys", "createdAt": "2020-06-04T18:09:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTQxOTAwNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTQxOTUzNQ==", "url": "https://github.com/blackducksoftware/synopsys-detect/pull/183#discussion_r435419535", "bodyText": "This isn't after calculation though, this is after we add it to wait data. Doesn't seem like the event matches up.", "author": "taikuukaits", "createdAt": "2020-06-04T17:16:16Z", "path": "src/main/java/com/synopsys/integration/detect/workflow/blackduck/CodeLocationWaitData.java", "diffHunk": "@@ -24,19 +24,26 @@\n \n import java.util.Date;\n import java.util.HashSet;\n+import java.util.List;\n import java.util.Set;\n \n import com.synopsys.integration.blackduck.codelocation.CodeLocationCreationData;\n import com.synopsys.integration.blackduck.service.model.NotificationTaskRange;\n+import com.synopsys.integration.detect.workflow.event.Event;\n+import com.synopsys.integration.detect.workflow.event.EventSystem;\n \n public class CodeLocationWaitData {\n     private NotificationTaskRange notificationRange;\n     private Set<String> codeLocationNames = new HashSet<>();\n     private int expectedNotificationCount = 0;\n \n-    public void addWaitForCreationData(CodeLocationCreationData codeLocationCreationData) {\n+    public void addWaitForCreationData(CodeLocationCreationData codeLocationCreationData, EventSystem eventSystem) {\n         expectedNotificationCount += codeLocationCreationData.getOutput().getExpectedNotificationCount();\n-        codeLocationNames.addAll(codeLocationCreationData.getOutput().getSuccessfulCodeLocationNames());\n+\n+        Set<String> codeLocationNames = codeLocationCreationData.getOutput().getSuccessfulCodeLocationNames();\n+        this.codeLocationNames.addAll(codeLocationNames);\n+        eventSystem.publishEvent(Event.CodeLocationNamesCalculated, codeLocationNames);", "originalCommit": "1f5b0dc60a91e1f1c15d9faaeb3e635c1b408072", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTQ1Mjk3NA==", "url": "https://github.com/blackducksoftware/synopsys-detect/pull/183#discussion_r435452974", "bodyText": "is the name of the event what you have an issue with?", "author": "crowleySynopsys", "createdAt": "2020-06-04T18:12:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTQxOTUzNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjAwNDE4MA==", "url": "https://github.com/blackducksoftware/synopsys-detect/pull/183#discussion_r436004180", "bodyText": "I'm concerned that publishing the events is not the responsibility of the WaitData, because as a consumer of that class I would assume I could call \"addWaitForCreationData\" multiple times but those events imply that it is called once. Did you consider having the caller send the event? My interpretation is that WaitData is like a DateRange where I can extend the range (extendToIncludeDays is to addWaitForCreationData) so I wouldn't expect it to have any logic (such as publishing events) and would put that on the caller.", "author": "taikuukaits", "createdAt": "2020-06-05T15:39:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTQxOTUzNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjAxOTIzNA==", "url": "https://github.com/blackducksoftware/synopsys-detect/pull/183#discussion_r436019234", "bodyText": "I see.  Yeah I just figured I'd publish within the method since it was already extracting the names I wanted sent to the event system, and otherwise I'd be doing so every time the method was called.  The event would be more appropriately named CodeLocationNamesAdded, as it is a mechanism to update the code location names found by all the different tools on a rolling basis.  If you think that publishing an event is confusing the role of the class, though, I'd be fine delegating to the caller", "author": "crowleySynopsys", "createdAt": "2020-06-05T16:05:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTQxOTUzNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjAzNzkxMw==", "url": "https://github.com/blackducksoftware/synopsys-detect/pull/183#discussion_r436037913", "bodyText": "Ah I see, then it is the event name and the class name that I am reacting to. If it was CodeLocationNamesAdded and CodeLocationWaitController (to me data means that it doesn't have the logic) then I think I would be OK with it.", "author": "taikuukaits", "createdAt": "2020-06-05T16:41:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTQxOTUzNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjA1MzMyMw==", "url": "https://github.com/blackducksoftware/synopsys-detect/pull/183#discussion_r436053323", "bodyText": "Okay cool, those name changes seem reasonable to me.", "author": "crowleySynopsys", "createdAt": "2020-06-05T17:12:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTQxOTUzNQ=="}], "type": "inlineReview"}, {"oid": "77f5bc128db3ea50db4eca2b4b70abec3af00b35", "url": "https://github.com/blackducksoftware/synopsys-detect/commit/77f5bc128db3ea50db4eca2b4b70abec3af00b35", "message": "fix: Renamed collectCodeLocationNames to createCodeLocationNames", "committedDate": "2020-06-05T14:29:01Z", "type": "commit"}, {"oid": "a8a6789d12b30cbc88cf39e7ea167867ceb0b358", "url": "https://github.com/blackducksoftware/synopsys-detect/commit/a8a6789d12b30cbc88cf39e7ea167867ceb0b358", "message": "style: renamed Event.CodeLocationNamesCalculated Event.CodeLocationNamesAdded -> , CodeLocationWaitData -> CodeLocationWaitController", "committedDate": "2020-06-05T17:19:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzU2Mjc0MQ==", "url": "https://github.com/blackducksoftware/synopsys-detect/pull/183#discussion_r437562741", "bodyText": "Shouldn't this be renamed to codeLocationsAdded?", "author": "JakeMathews", "createdAt": "2020-06-09T16:27:59Z", "path": "src/main/java/com/synopsys/integration/detect/workflow/report/output/FormattedOutputManager.java", "diffHunk": "@@ -130,8 +130,8 @@ private void detectorsComplete(final DetectorToolResult detectorToolResult) {\n         this.detectorToolResult = detectorToolResult;\n     }\n \n-    private void codeLocationsCalculated(final BdioCodeLocationResult bdioCodeLocationResult) {\n-        this.bdioCodeLocationResult = bdioCodeLocationResult;\n+    private void codeLocationsCalculated(final Collection<String> codeLocations) {", "originalCommit": "a8a6789d12b30cbc88cf39e7ea167867ceb0b358", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "c1c95687a4c3d578ed9cb626bbf816d5bd6cb657", "url": "https://github.com/blackducksoftware/synopsys-detect/commit/c1c95687a4c3d578ed9cb626bbf816d5bd6cb657", "message": "refactor: Renamed FormattedOutputManager.codeLocationsCalculated to FormattedOutputManager.codeLocationsAdded", "committedDate": "2020-06-09T17:12:39Z", "type": "commit"}, {"oid": "8f431ae1bcb91f141782eda213a2479dd2ef3852", "url": "https://github.com/blackducksoftware/synopsys-detect/commit/8f431ae1bcb91f141782eda213a2479dd2ef3852", "message": "Merge branch 'master' into statusJsonCodeLocations", "committedDate": "2020-06-09T17:24:18Z", "type": "commit"}, {"oid": "7780d24c03b20eaac655bdb33450d4c79ca7dfb5", "url": "https://github.com/blackducksoftware/synopsys-detect/commit/7780d24c03b20eaac655bdb33450d4c79ca7dfb5", "message": "fix: Resolving errors from merge conflict resolutions", "committedDate": "2020-06-09T17:28:23Z", "type": "commit"}]}