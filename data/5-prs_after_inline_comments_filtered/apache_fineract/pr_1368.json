{"pr_number": 1368, "pr_title": "Improve error handling if reporting service implementation is missing [FINERACT-1173]", "pr_createdAt": "2020-10-04T17:26:58Z", "pr_url": "https://github.com/apache/fineract/pull/1368", "timeline": [{"oid": "fc4fe9854ec869470bf2b99c180183c12975a219", "url": "https://github.com/apache/fineract/commit/fc4fe9854ec869470bf2b99c180183c12975a219", "message": "Improve error handling if reporting service implementation is missing [FINERACT-1173]", "committedDate": "2020-10-04T18:06:00Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI3Mzg2Mw==", "url": "https://github.com/apache/fineract/pull/1368#discussion_r499273863", "bodyText": "Unfortunately based on my read of the code, I don't think this is quite right:\nAfter this change, we are bailing out if we can't find a reporting process service for the report type.\nPreviously, if we couldn't find one, we would continue to execute the \"hardcoded\" reporting process service in the same function below.\nI think continuing execution is the expected behaviour: for any report that is not of type Pentaho or SMS, the report_type is set to Table. But there is no ReportingProcessService with type Table, so therefore the logic in this function below is used to simply prepare the CSV / PDF file.\nIn other words: if we check this in, as far as I can see it would break any report that doesn't have a specific report handler configured.\nNow having said that, a good idea would be to create a \"Table\" type report handler and move the code from this function to that report handler. And after that we could assume that there's a handler for each type of report, and bail out if we can't find one.", "author": "ptuomola", "createdAt": "2020-10-04T18:18:39Z", "path": "fineract-provider/src/main/java/org/apache/fineract/infrastructure/dataqueries/api/RunreportsApiResource.java", "diffHunk": "@@ -124,12 +125,13 @@ public Response runReport(@PathParam(\"reportName\") @Parameter(description = \"rep\n             parameterTypeValue = \"report\";\n             String reportType = this.readExtraDataAndReportingService.getReportType(reportName, isSelfServiceUserReport);\n             ReportingProcessService reportingProcessService = this.reportingProcessServiceProvider.findReportingProcessService(reportType);\n-            if (reportingProcessService != null) {\n-                return reportingProcessService.processRequest(reportName, queryParams);\n+            if (reportingProcessService == null) {\n+                throw new PlatformServiceUnavailableException(\"err.msg.report.service.implementation.missing\",\n+                        ReportingProcessServiceProvider.SERVICE_MISSING + reportType, reportType);", "originalCommit": "fc4fe9854ec869470bf2b99c180183c12975a219", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI3NjcyOA==", "url": "https://github.com/apache/fineract/pull/1368#discussion_r499276728", "bodyText": "Oh... wow, very well spotted. I'll have a go at the re-factoring you're suggesting, that would make a lot of sense, yes.\nBut before I get to that, I'm struggling with more fundamental classloading issues... urgh!! More soon on JIRA, hopefully.", "author": "vorburger", "createdAt": "2020-10-04T18:50:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI3Mzg2Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODE5ODI3NQ==", "url": "https://github.com/apache/fineract/pull/1368#discussion_r528198275", "bodyText": "@ptuomola I'm finally (7 weeks later, phew!) picking this up, and I'm struggling to understand how the reportType: SMS is intended to work... @vidakovic do you understand that? Can those be run on the /runreports API? I think what I'll do is just write a DefaultReportingProcessService with the current code to which this will delegate to for both Table and SMS.. I'll therefore make the type on org.apache.fineract.infrastructure.report.annotation.ReportService a multivalue. Does that sounds reasonable to you guys?", "author": "vorburger", "createdAt": "2020-11-21T13:46:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI3Mzg2Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODE5ODg3MQ==", "url": "https://github.com/apache/fineract/pull/1368#discussion_r528198871", "bodyText": "Also not sure how this SMS thing is supposed to work... will have a look at this later today.", "author": "vidakovic", "createdAt": "2020-11-21T13:52:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI3Mzg2Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODE5OTA4MA==", "url": "https://github.com/apache/fineract/pull/1368#discussion_r528199080", "bodyText": "Actually I guess that one would then more appropriately be our DatatableReportingProcessService (in infrastructure.dataqueries.service) instead of a DefaultReportingProcessService in  infrastructure.report.service.ReportingProcessService.... watch for an update on this PR! \ud83d\ude38", "author": "vorburger", "createdAt": "2020-11-21T13:53:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI3Mzg2Mw=="}], "type": "inlineReview"}, {"oid": "9258b875be4bc83b691c0194715f9f6efe5b1382", "url": "https://github.com/apache/fineract/commit/9258b875be4bc83b691c0194715f9f6efe5b1382", "message": "Improve error handling if reporting service implementation is missing [FINERACT-1173]", "committedDate": "2020-11-21T14:34:42Z", "type": "forcePushed"}, {"oid": "f8b1af8bf2567fdc113d991edf573e61e2411d2d", "url": "https://github.com/apache/fineract/commit/f8b1af8bf2567fdc113d991edf573e61e2411d2d", "message": "Fix flaky GET {entity}/{entityId}/images Content-Type bug (FINERACT-1265)", "committedDate": "2020-11-21T16:50:54Z", "type": "commit"}, {"oid": "c423ed94093f4c09b7d454468a3ee9b3308ee37d", "url": "https://github.com/apache/fineract/commit/c423ed94093f4c09b7d454468a3ee9b3308ee37d", "message": "Improve error handling if reporting service implementation is missing [FINERACT-1173]", "committedDate": "2020-11-21T17:13:14Z", "type": "forcePushed"}, {"oid": "b44ec399b3f239c6da9170ac75ee23843872f9df", "url": "https://github.com/apache/fineract/commit/b44ec399b3f239c6da9170ac75ee23843872f9df", "message": "Improve error handling if reporting service implementation is missing [FINERACT-1173]", "committedDate": "2020-11-21T19:48:19Z", "type": "commit"}, {"oid": "b44ec399b3f239c6da9170ac75ee23843872f9df", "url": "https://github.com/apache/fineract/commit/b44ec399b3f239c6da9170ac75ee23843872f9df", "message": "Improve error handling if reporting service implementation is missing [FINERACT-1173]", "committedDate": "2020-11-21T19:48:19Z", "type": "forcePushed"}]}