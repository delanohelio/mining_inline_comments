{"pr_number": 730, "pr_title": "Added: SQL builder toString function", "pr_createdAt": "2020-03-10T11:22:41Z", "pr_url": "https://github.com/apache/fineract/pull/730", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDI2MDUwNw==", "url": "https://github.com/apache/fineract/pull/730#discussion_r390260507", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    StringBuilder whereClause  = new StringBuilder();\n          \n          \n            \n                    StringBuilder whereClause  = new StringBuilder(\"SQLBuilder{ \");", "author": "vorburger", "createdAt": "2020-03-10T11:51:01Z", "path": "fineract-provider/src/main/java/org/apache/fineract/infrastructure/security/utils/SQLBuilder.java", "diffHunk": "@@ -118,9 +121,34 @@ public String getSQLTemplate() {\n     /*\n      * Returns a String representation suitable for debugging and log output.\n      * This is ONLY intended for debugging in logs, and NEVER for passing to a JDBC database.\n+     */\n     @Override\n     public String toString() {\n-        return \"SQLBuilder{...\"; // TODO implement this...\n+        StringBuilder whereClause  = new StringBuilder();", "originalCommit": "6c24faf7d8a10e4bf509449e95a1135ad4570221", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDI2MTE2NA==", "url": "https://github.com/apache/fineract/pull/730#discussion_r390261164", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    return \"SQLBuilder{\"+ whereClause.toString() +\"}\";\n          \n          \n            \n                    whereClause.append(\" }\");\n          \n          \n            \n                    return whereClause.toString();\n          \n      \n    \n    \n  \n\nThe point of this is to avoid unnecessary String concatenation object creation.\nYou should also avoid any other String + in this method - just append() everything.", "author": "vorburger", "createdAt": "2020-03-10T11:52:27Z", "path": "fineract-provider/src/main/java/org/apache/fineract/infrastructure/security/utils/SQLBuilder.java", "diffHunk": "@@ -118,9 +121,34 @@ public String getSQLTemplate() {\n     /*\n      * Returns a String representation suitable for debugging and log output.\n      * This is ONLY intended for debugging in logs, and NEVER for passing to a JDBC database.\n+     */\n     @Override\n     public String toString() {\n-        return \"SQLBuilder{...\"; // TODO implement this...\n+        StringBuilder whereClause  = new StringBuilder();\n+        ArrayList<String> modifiedArgs = new ArrayList<String>();\n+        for (Object obj : args)\n+        {\n+            if(obj instanceof String)\n+            {\n+                modifiedArgs.add(\"['\"+ obj + \"']\");\n+            }else if(obj == null)\n+            {\n+                modifiedArgs.add(\"[null]\");\n+            }else{\n+                modifiedArgs.add(\"[\"+ String.valueOf(obj) +\"]\");\n+            }\n+        }\n+        for (int i=0;i<crts.size();i++)\n+        {    if (whereClause.length() > 0)\n+            {\n+                whereClause.append(\"  AND  \");\n+            }\n+            if(whereClause.length()==0)\n+            {\n+                whereClause.append(\"WHERE  \");\n+            }\n+            whereClause.append(crts.get(i) + \" \" + modifiedArgs.get(i));\n+        }\n+        return \"SQLBuilder{\"+ whereClause.toString() +\"}\";", "originalCommit": "6c24faf7d8a10e4bf509449e95a1135ad4570221", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDI2MTgwMw==", "url": "https://github.com/apache/fineract/pull/730#discussion_r390261803", "bodyText": "you can probably avoid creating this intermediate list? Just iterate and append to the StringBuilder, no? Or perhaps I'm missing something here (quick review only; didn't read the code in full details).", "author": "vorburger", "createdAt": "2020-03-10T11:53:50Z", "path": "fineract-provider/src/main/java/org/apache/fineract/infrastructure/security/utils/SQLBuilder.java", "diffHunk": "@@ -118,9 +121,34 @@ public String getSQLTemplate() {\n     /*\n      * Returns a String representation suitable for debugging and log output.\n      * This is ONLY intended for debugging in logs, and NEVER for passing to a JDBC database.\n+     */\n     @Override\n     public String toString() {\n-        return \"SQLBuilder{...\"; // TODO implement this...\n+        StringBuilder whereClause  = new StringBuilder();\n+        ArrayList<String> modifiedArgs = new ArrayList<String>();", "originalCommit": "6c24faf7d8a10e4bf509449e95a1135ad4570221", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3d872624523e73d87e513384b8edc33ba4da9433", "url": "https://github.com/apache/fineract/commit/3d872624523e73d87e513384b8edc33ba4da9433", "message": "Added: SQL builder toString function", "committedDate": "2020-03-10T15:30:47Z", "type": "forcePushed"}, {"oid": "1be08bbb582646404a112223804ac25898d8bddb", "url": "https://github.com/apache/fineract/commit/1be08bbb582646404a112223804ac25898d8bddb", "message": "Added: SQL builder toString function", "committedDate": "2020-03-10T15:36:53Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDQyMTk5MQ==", "url": "https://github.com/apache/fineract/pull/730#discussion_r390421991", "bodyText": "I think you could still save this StringBuilder and just whereClause.append(...) as you go? Just a thought.", "author": "vorburger", "createdAt": "2020-03-10T15:55:51Z", "path": "fineract-provider/src/main/java/org/apache/fineract/infrastructure/security/utils/SQLBuilder.java", "diffHunk": "@@ -118,9 +121,40 @@ public String getSQLTemplate() {\n     /*\n      * Returns a String representation suitable for debugging and log output.\n      * This is ONLY intended for debugging in logs, and NEVER for passing to a JDBC database.\n+     */\n     @Override\n     public String toString() {\n-        return \"SQLBuilder{...\"; // TODO implement this...\n+       StringBuilder whereClause  = new StringBuilder(\"SQLBuilder{\");\n+       for (int i=0;i<args.size();i++)\n+        {\n+            if (i!=0)\n+            {\n+                whereClause.append(\"  AND  \");\n+            }\n+            else\n+            {\n+                whereClause.append(\"WHERE  \");\n+            }\n+            Object currentArg = args.get(i);\n+            String currentCri = crts.get(i);\n+            StringBuilder modifiedArg  = new StringBuilder(\"[\");", "originalCommit": "1be08bbb582646404a112223804ac25898d8bddb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDQzNjE5OQ==", "url": "https://github.com/apache/fineract/pull/730#discussion_r390436199", "bodyText": "Yes, on it.", "author": "thesmallstar", "createdAt": "2020-03-10T16:15:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDQyMTk5MQ=="}], "type": "inlineReview"}, {"oid": "02aa96e3cec3a8e359be1684f95b59c8d77e0814", "url": "https://github.com/apache/fineract/commit/02aa96e3cec3a8e359be1684f95b59c8d77e0814", "message": "Added: SQL builder toString function", "committedDate": "2020-03-10T16:38:31Z", "type": "forcePushed"}, {"oid": "f434ba8702dd660b0523c612fe1945b8a240088d", "url": "https://github.com/apache/fineract/commit/f434ba8702dd660b0523c612fe1945b8a240088d", "message": "Added: SQL builder toString function", "committedDate": "2020-03-10T16:39:57Z", "type": "commit"}, {"oid": "f434ba8702dd660b0523c612fe1945b8a240088d", "url": "https://github.com/apache/fineract/commit/f434ba8702dd660b0523c612fe1945b8a240088d", "message": "Added: SQL builder toString function", "committedDate": "2020-03-10T16:39:57Z", "type": "forcePushed"}]}