{"pr_number": 1079, "pr_title": "Added and Enforced AvoidHidingCauseException Checkstyle (FINERACT-942)", "pr_createdAt": "2020-06-17T19:58:26Z", "pr_url": "https://github.com/apache/fineract/pull/1079", "timeline": [{"oid": "ee4d8243add64755d752a029b4558269661a828d", "url": "https://github.com/apache/fineract/commit/ee4d8243add64755d752a029b4558269661a828d", "message": "FINERACT-942 Added and Enforced AvoidHidingCauseException Checkstyle", "committedDate": "2020-06-26T16:04:23Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMwMTQxMw==", "url": "https://github.com/apache/fineract/pull/1079#discussion_r446301413", "bodyText": "In this case, where there is no Object... defaultUserMessageArgs in the original far, you should not introduce it. Just have constructors which take an additional last new argument like , Throwable cause) - makes sense?", "author": "vorburger", "createdAt": "2020-06-26T16:57:17Z", "path": "fineract-provider/src/main/java/org/apache/fineract/infrastructure/core/exception/PlatformApiDataValidationException.java", "diffHunk": "@@ -43,6 +43,30 @@ public PlatformApiDataValidationException(final String globalisationMessageCode,\n         this.errors = errors;\n     }\n \n+    public PlatformApiDataValidationException(final String globalisationMessageCode, final String defaultUserMessage,\n+            final List<ApiParameterError> errors, final Object... defaultUserMessageArgs) {", "originalCommit": "ee4d8243add64755d752a029b4558269661a828d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUyOTU3Nw==", "url": "https://github.com/apache/fineract/pull/1079#discussion_r446529577", "bodyText": "okay! noted.", "author": "thesmallstar", "createdAt": "2020-06-27T14:00:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMwMTQxMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzI1NDk1OQ==", "url": "https://github.com/apache/fineract/pull/1079#discussion_r447254959", "bodyText": "Ok now.", "author": "vorburger", "createdAt": "2020-06-29T21:08:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMwMTQxMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMwMjc2NQ==", "url": "https://github.com/apache/fineract/pull/1079#discussion_r446302765", "bodyText": "copy pasting (my) findThrowableCause() & filterThrowableCause() seems like a shame... always try to avoid copy/paste, as much as you can. How about introducing a new e.g. public abstract class AbstractPlatformException extends RuntimeException with suitable protected constructors, and these two methods as protected static methods?", "author": "vorburger", "createdAt": "2020-06-26T17:00:05Z", "path": "fineract-provider/src/main/java/org/apache/fineract/infrastructure/core/exception/PlatformDataIntegrityException.java", "diffHunk": "@@ -30,18 +33,39 @@\n \n     public PlatformDataIntegrityException(final String globalisationMessageCode, final String defaultUserMessage,\n             final Object... defaultUserMessageArgs) {\n+        super(findThrowableCause(defaultUserMessageArgs));\n         this.globalisationMessageCode = globalisationMessageCode;\n         this.defaultUserMessage = defaultUserMessage;\n         this.parameterName = null;\n-        this.defaultUserMessageArgs = defaultUserMessageArgs;\n+        this.defaultUserMessageArgs = filterThrowableCause(defaultUserMessageArgs);\n     }\n \n     public PlatformDataIntegrityException(final String globalisationMessageCode, final String defaultUserMessage,\n             final String parameterName, final Object... defaultUserMessageArgs) {\n+        super(findThrowableCause(defaultUserMessageArgs));\n         this.globalisationMessageCode = globalisationMessageCode;\n         this.defaultUserMessage = defaultUserMessage;\n         this.parameterName = parameterName;\n-        this.defaultUserMessageArgs = defaultUserMessageArgs;\n+        this.defaultUserMessageArgs = filterThrowableCause(defaultUserMessageArgs);\n+    }\n+\n+    private static Throwable findThrowableCause(Object[] defaultUserMessageArgs) {", "originalCommit": "ee4d8243add64755d752a029b4558269661a828d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUyOTg1Ng==", "url": "https://github.com/apache/fineract/pull/1079#discussion_r446529856", "bodyText": "Agreed! I did not understand do we really need a constructor though(or you mean something else here), an abstract class without any attributes and two static methods will do IMO.", "author": "thesmallstar", "createdAt": "2020-06-27T14:03:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMwMjc2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUzNTE1Mg==", "url": "https://github.com/apache/fineract/pull/1079#discussion_r446535152", "bodyText": "@vorburger  made the change I am unsure though if is this is what you meant.", "author": "thesmallstar", "createdAt": "2020-06-27T15:01:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMwMjc2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzI1ODk1Ng==", "url": "https://github.com/apache/fineract/pull/1079#discussion_r447258956", "bodyText": "It's OK, although arguable now it's perhaps more of a... PlatformExceptionUtil than an AbstractPlatformException.. I'll merge it anyway, as this isn't super important, and perhaps I'll follow-up with a suggested improvement.", "author": "vorburger", "createdAt": "2020-06-29T21:16:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMwMjc2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzMwMDkxMw==", "url": "https://github.com/apache/fineract/pull/1079#discussion_r447300913", "bodyText": "@thesmallstar I did this, and much more in #1125", "author": "vorburger", "createdAt": "2020-06-29T22:43:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMwMjc2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMwNDA0Mg==", "url": "https://github.com/apache/fineract/pull/1079#discussion_r446304042", "bodyText": "you forgot actually propagating the cause here... ;-)\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    super(\"error.msg.provisioning.criteria.id.invalid\", \"Provisioning Criteria with identifier \" + id + \" does not exist\", id);\n          \n          \n            \n                    super(\"error.msg.provisioning.criteria.id.invalid\", \"Provisioning Criteria with identifier \" + id + \" does not exist\", id, e);", "author": "vorburger", "createdAt": "2020-06-26T17:02:34Z", "path": "fineract-provider/src/main/java/org/apache/fineract/organisation/provisioning/exception/ProvisioningCriteriaNotFoundException.java", "diffHunk": "@@ -19,10 +19,15 @@\n package org.apache.fineract.organisation.provisioning.exception;\n \n import org.apache.fineract.infrastructure.core.exception.AbstractPlatformResourceNotFoundException;\n+import org.springframework.dao.EmptyResultDataAccessException;\n \n public class ProvisioningCriteriaNotFoundException extends AbstractPlatformResourceNotFoundException {\n \n     public ProvisioningCriteriaNotFoundException(final Long id) {\n         super(\"error.msg.provisioning.criteria.id.invalid\", \"Provisioning Criteria with identifier \" + id + \" does not exist\", id);\n     }\n+\n+    public ProvisioningCriteriaNotFoundException(Long id, EmptyResultDataAccessException e) {\n+        super(\"error.msg.provisioning.criteria.id.invalid\", \"Provisioning Criteria with identifier \" + id + \" does not exist\", id);", "originalCommit": "ee4d8243add64755d752a029b4558269661a828d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUyOTMyOQ==", "url": "https://github.com/apache/fineract/pull/1079#discussion_r446529329", "bodyText": "nice catch! thanks", "author": "thesmallstar", "createdAt": "2020-06-27T13:56:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMwNDA0Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMwNTIzNw==", "url": "https://github.com/apache/fineract/pull/1079#discussion_r446305237", "bodyText": "I'm not 100% sure and haven't looked much at this, but could it make sense to:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                \"Loan product may only have one charge of each type.`\", \"charges\");\n          \n          \n            \n                                \"Loan product may only have one charge of each type.`\", \"charges\", realCause);", "author": "vorburger", "createdAt": "2020-06-26T17:05:12Z", "path": "fineract-provider/src/main/java/org/apache/fineract/portfolio/loanproduct/service/LoanProductWritePlatformServiceJpaRepositoryImpl.java", "diffHunk": "@@ -357,9 +357,8 @@ private void handleDataIntegrityIssues(final JsonCommand command, final Throwabl\n             throw new PlatformDataIntegrityException(\"error.msg.product.loan.duplicate.short.name\",\n                     \"Loan product with short name `\" + shortName + \"` already exists\", \"shortName\", shortName);\n         } else if (realCause.getMessage().contains(\"Duplicate entry\")) {\n-            final Object[] args = null;\n             throw new PlatformDataIntegrityException(\"error.msg.product.loan.duplicate.charge\",\n-                    \"Loan product may only have one charge of each type.`\", \"charges\", args);\n+                    \"Loan product may only have one charge of each type.`\", \"charges\");", "originalCommit": "ee4d8243add64755d752a029b4558269661a828d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUyOTQxNw==", "url": "https://github.com/apache/fineract/pull/1079#discussion_r446529417", "bodyText": "Yes! makes sense :D", "author": "thesmallstar", "createdAt": "2020-06-27T13:57:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMwNTIzNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUyOTUxNQ==", "url": "https://github.com/apache/fineract/pull/1079#discussion_r446529515", "bodyText": "Also adding the same in rest of the throws in the same function.", "author": "thesmallstar", "createdAt": "2020-06-27T13:59:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMwNTIzNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzI1NjI5NA==", "url": "https://github.com/apache/fineract/pull/1079#discussion_r447256294", "bodyText": "great, thanks; I've seen it - resolving", "author": "vorburger", "createdAt": "2020-06-29T21:10:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMwNTIzNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUzMzUxNA==", "url": "https://github.com/apache/fineract/pull/1079#discussion_r446533514", "bodyText": "Just curious but wouldn't it be better to add the 3rd param here instead of duplicating the method? cause I can see the 2param method will just be history and unused.", "author": "xurror", "createdAt": "2020-06-27T14:43:42Z", "path": "fineract-provider/src/main/java/org/apache/fineract/infrastructure/campaigns/email/exception/EmailConfigurationNotFoundException.java", "diffHunk": "@@ -28,4 +29,9 @@\n     public EmailConfigurationNotFoundException(final String name) {\n         super(\"error.msg.email.configuration.name.not.found\", \"Email configuration with name \" + name + \" does not exist\", name);", "originalCommit": "ee4d8243add64755d752a029b4558269661a828d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUzNDkzMQ==", "url": "https://github.com/apache/fineract/pull/1079#discussion_r446534931", "bodyText": "Nope, we cannot change the original implementation. If the cause of the exception is the exception itself, we need this constructor to be used.", "author": "thesmallstar", "createdAt": "2020-06-27T14:58:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUzMzUxNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzI1ODI0OA==", "url": "https://github.com/apache/fineract/pull/1079#discussion_r447258248", "bodyText": "@thesmallstar @xurror the real question is really more if there are any (legitimate) remaining usages of the original constructor, without the cause. It seems like this was only used in EmailConfigurationReadPlatformServiceImpl, which was changed to use the new constructor, right? Then I actually agree that it would have been nicer and better to just add an additional parameter here... this isn't important enough to justify not finally merging this, so I'll probably go ahead, but I'll leave this open in case you'd like to clean this up in a new PR? (And perhaps in other exceptions where a cause was added - if there is no usage without a cause, it's better to simplify - and force future users to provide a cause.)", "author": "vorburger", "createdAt": "2020-06-29T21:14:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUzMzUxNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzM5NzMxMQ==", "url": "https://github.com/apache/fineract/pull/1079#discussion_r447397311", "bodyText": "Agreed! I will update this", "author": "thesmallstar", "createdAt": "2020-06-30T04:10:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUzMzUxNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODU1NTg1OA==", "url": "https://github.com/apache/fineract/pull/1079#discussion_r448555858", "bodyText": "@vorburger  @xurror  making a new PR for this cleanup.", "author": "thesmallstar", "createdAt": "2020-07-01T18:53:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUzMzUxNA=="}], "type": "inlineReview"}, {"oid": "6ebcaf0e333df626dbe7e3335a850935d7b75632", "url": "https://github.com/apache/fineract/commit/6ebcaf0e333df626dbe7e3335a850935d7b75632", "message": "FINERACT-942 Added and Enforced AvoidHidingCauseException Checkstyle", "committedDate": "2020-06-27T14:54:48Z", "type": "commit"}, {"oid": "6ebcaf0e333df626dbe7e3335a850935d7b75632", "url": "https://github.com/apache/fineract/commit/6ebcaf0e333df626dbe7e3335a850935d7b75632", "message": "FINERACT-942 Added and Enforced AvoidHidingCauseException Checkstyle", "committedDate": "2020-06-27T14:54:48Z", "type": "forcePushed"}]}