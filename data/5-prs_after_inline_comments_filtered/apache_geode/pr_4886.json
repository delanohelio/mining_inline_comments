{"pr_number": 4886, "pr_title": "GEODE-7927: create tests to ensure feature-parity with Redis PEXPIRE \u2026", "pr_createdAt": "2020-03-30T21:36:21Z", "pr_url": "https://github.com/apache/geode/pull/4886", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDUxOTA0OA==", "url": "https://github.com/apache/geode/pull/4886#discussion_r400519048", "bodyText": "port is looks to be defined above as a static constant but is overridden below in the @BeforeClass.  Pretty sure you don't want it defined as 6379 up here, just a private static int port declaration.  Noticed other integration tests doing it so assuming it was just a copy/pasta type thing.  Though it also looks like port is only used in the @BeforeEach so maybe just make it a local variable and call it done?", "author": "moleske", "createdAt": "2020-03-30T21:57:28Z", "path": "geode-redis/src/integrationTest/java/org/apache/geode/redis/general/PexpireIntegrationTest.java", "diffHunk": "@@ -0,0 +1,68 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional information regarding\n+ * copyright ownership. The ASF licenses this file to You under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance with the License. You may obtain a\n+ * copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License\n+ * is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express\n+ * or implied. See the License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+package org.apache.geode.redis.general;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+import org.junit.AfterClass;\n+import org.junit.BeforeClass;\n+import org.junit.Test;\n+import redis.clients.jedis.Jedis;\n+\n+import org.apache.geode.cache.GemFireCache;\n+import org.apache.geode.internal.AvailablePortHelper;\n+import org.apache.geode.redis.GeodeRedisServer;\n+\n+public class PexpireIntegrationTest {\n+\n+  private static Jedis jedis;\n+  private static GeodeRedisServer server;\n+  private static GemFireCache cache;\n+  private static int port = 6379;", "originalCommit": "cf3b8b4923404e6c67a8dbad42e9f709bf5fc0ec", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTEwMjE0MQ==", "url": "https://github.com/apache/geode/pull/4886#discussion_r401102141", "bodyText": "When will I learn - copy/paste is not my friend ?!?  Point taken...", "author": "jhutchison", "createdAt": "2020-03-31T17:50:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDUxOTA0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTExNTg5OA==", "url": "https://github.com/apache/geode/pull/4886#discussion_r401115898", "bodyText": "corrected.  Thanks for the call out", "author": "jhutchison", "createdAt": "2020-03-31T18:13:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDUxOTA0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTExNjI2NQ==", "url": "https://github.com/apache/geode/pull/4886#discussion_r401116265", "bodyText": "(oops sorry-  not pushed yet... my over-eager fingers)", "author": "jhutchison", "createdAt": "2020-03-31T18:14:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDUxOTA0OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDUyMjA1MA==", "url": "https://github.com/apache/geode/pull/4886#discussion_r400522050", "bodyText": "10000000 is a timeout I think?  I saw in PubSubIntegrationTest the 10000000 was assigned to a constant of REDIS_CLIENT_TIMEOUT which would make it a little clearer without diving into the constructor (thought Intellij tells me what the parameter is so not too worried about it)", "author": "moleske", "createdAt": "2020-03-30T22:04:09Z", "path": "geode-redis/src/integrationTest/java/org/apache/geode/redis/general/PexpireIntegrationTest.java", "diffHunk": "@@ -0,0 +1,68 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional information regarding\n+ * copyright ownership. The ASF licenses this file to You under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance with the License. You may obtain a\n+ * copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License\n+ * is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express\n+ * or implied. See the License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+package org.apache.geode.redis.general;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+import org.junit.AfterClass;\n+import org.junit.BeforeClass;\n+import org.junit.Test;\n+import redis.clients.jedis.Jedis;\n+\n+import org.apache.geode.cache.GemFireCache;\n+import org.apache.geode.internal.AvailablePortHelper;\n+import org.apache.geode.redis.GeodeRedisServer;\n+\n+public class PexpireIntegrationTest {\n+\n+  private static Jedis jedis;\n+  private static GeodeRedisServer server;\n+  private static GemFireCache cache;\n+  private static int port = 6379;\n+\n+  @BeforeClass\n+  public static void setUp() {\n+    port = AvailablePortHelper.getRandomAvailableTCPPort();\n+    server = new GeodeRedisServer(\"localhost\", port);\n+    server.start();\n+    jedis = new Jedis(\"localhost\", port, 10000000);", "originalCommit": "cf3b8b4923404e6c67a8dbad42e9f709bf5fc0ec", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTExODYwMA==", "url": "https://github.com/apache/geode/pull/4886#discussion_r401118600", "bodyText": "corrected-  thx", "author": "jhutchison", "createdAt": "2020-03-31T18:18:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDUyMjA1MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDUyMjEzMw==", "url": "https://github.com/apache/geode/pull/4886#discussion_r400522133", "bodyText": "Thank you for a very clear test name!", "author": "moleske", "createdAt": "2020-03-30T22:04:23Z", "path": "geode-redis/src/integrationTest/java/org/apache/geode/redis/general/PexpireIntegrationTest.java", "diffHunk": "@@ -0,0 +1,68 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional information regarding\n+ * copyright ownership. The ASF licenses this file to You under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance with the License. You may obtain a\n+ * copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License\n+ * is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express\n+ * or implied. See the License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+package org.apache.geode.redis.general;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+import org.junit.AfterClass;\n+import org.junit.BeforeClass;\n+import org.junit.Test;\n+import redis.clients.jedis.Jedis;\n+\n+import org.apache.geode.cache.GemFireCache;\n+import org.apache.geode.internal.AvailablePortHelper;\n+import org.apache.geode.redis.GeodeRedisServer;\n+\n+public class PexpireIntegrationTest {\n+\n+  private static Jedis jedis;\n+  private static GeodeRedisServer server;\n+  private static GemFireCache cache;\n+  private static int port = 6379;\n+\n+  @BeforeClass\n+  public static void setUp() {\n+    port = AvailablePortHelper.getRandomAvailableTCPPort();\n+    server = new GeodeRedisServer(\"localhost\", port);\n+    server.start();\n+    jedis = new Jedis(\"localhost\", port, 10000000);\n+  }\n+\n+\n+  @AfterClass\n+  public static void tearDown() {\n+    jedis.close();\n+    server.shutdown();\n+  }\n+\n+  @Test\n+  public void Should_SetExpiration_givenKeyTo_StringValueInMilliSeconds() {", "originalCommit": "cf3b8b4923404e6c67a8dbad42e9f709bf5fc0ec", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDUyMzE2Ng==", "url": "https://github.com/apache/geode/pull/4886#discussion_r400523166", "bodyText": "I'm sure this test is important, but it seems odd that there's nothing else to test other than it is an instanceof", "author": "moleske", "createdAt": "2020-03-30T22:06:46Z", "path": "geode-redis/src/test/java/org/apache/geode/redis/internal/executor/general/PexpireExecutorJUnitTest.java", "diffHunk": "@@ -0,0 +1,33 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional information regarding\n+ * copyright ownership. The ASF licenses this file to You under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance with the License. You may obtain a\n+ * copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License\n+ * is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express\n+ * or implied. See the License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+package org.apache.geode.redis.internal.executor.general;\n+\n+import static org.assertj.core.api.AssertionsForInterfaceTypes.assertThat;\n+\n+import org.junit.Test;\n+\n+import org.apache.geode.redis.internal.Executor;\n+import org.apache.geode.redis.internal.executor.ExpireExecutor;\n+import org.apache.geode.redis.internal.executor.PExpireExecutor;\n+\n+public class PexpireExecutorJUnitTest {\n+\n+  @Test\n+  public void isAnInstanceOfExpireClass() {\n+    Executor subject = new PExpireExecutor();", "originalCommit": "cf3b8b4923404e6c67a8dbad42e9f709bf5fc0ec", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTEwMjE5Nw==", "url": "https://github.com/apache/geode/pull/4886#discussion_r401102197", "bodyText": "Not sure how to make this more clear- this idea is that there is a base class (expireExecutor) where 99% of functionality happens.   The Pexpireexecutor class calls uses the default base class for all functionality except for converting the seconds paramater to milliseconds.  SO we tests the millisecond functionality in the  extended integration test for the pexpire class, and test that it is extending its parent.  I was a little unsure about this one, but it didn;t seem that it was worth having all of the other unit tests to test the underlying base class (again).  Suggestions welcome...", "author": "jhutchison", "createdAt": "2020-03-31T17:50:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDUyMzE2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTEwNTcwNQ==", "url": "https://github.com/apache/geode/pull/4886#discussion_r401105705", "bodyText": "Oh the test is fine! I meant it was just weird to me that there wasn't anything else to test.  Sorry for the confusion!  Thank you for the clarifying response explaining that all the cool stuff happens in the base class", "author": "moleske", "createdAt": "2020-03-31T17:56:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDUyMzE2Ng=="}], "type": "inlineReview"}, {"oid": "423e7f4e143990cc5cd50f5b77e9109452deb3fc", "url": "https://github.com/apache/geode/commit/423e7f4e143990cc5cd50f5b77e9109452deb3fc", "message": "GEODE-7927: create tests to ensure feature-parity with Redis PEXPIRE command", "committedDate": "2020-03-31T18:16:51Z", "type": "commit"}, {"oid": "423e7f4e143990cc5cd50f5b77e9109452deb3fc", "url": "https://github.com/apache/geode/commit/423e7f4e143990cc5cd50f5b77e9109452deb3fc", "message": "GEODE-7927: create tests to ensure feature-parity with Redis PEXPIRE command", "committedDate": "2020-03-31T18:16:51Z", "type": "forcePushed"}]}