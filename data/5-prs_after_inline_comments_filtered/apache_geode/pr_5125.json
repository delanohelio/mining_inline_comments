{"pr_number": 5125, "pr_title": "GEODE-8170: Change all hash and set commands to use function+delta", "pr_createdAt": "2020-05-16T02:02:33Z", "pr_url": "https://github.com/apache/geode/pull/5125", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjcwMjg0Nw==", "url": "https://github.com/apache/geode/pull/5125#discussion_r426702847", "bodyText": "Do we still need this class? I'm not sure I fully understand it's usage since when I switched RedisHash.EMPTY to new RedisHash(Collections.emptyList()), HashesIntegrationTest still passes.", "author": "jdeppe-pivotal", "createdAt": "2020-05-18T15:17:09Z", "path": "geode-redis/src/main/java/org/apache/geode/redis/internal/executor/EmptyRedisHash.java", "diffHunk": "@@ -26,41 +25,26 @@\n import org.apache.geode.redis.internal.executor.hash.RedisHash;\n \n public class EmptyRedisHash extends RedisHash {\n-  @Override\n-  public synchronized int hset(Region<ByteArrayWrapper, RedisData> region, ByteArrayWrapper key,\n-      List<ByteArrayWrapper> fieldsToSet, boolean nx) {\n-    throw new UnsupportedOperationException();\n-  }\n-\n-  @Override\n-  public synchronized int hdel(Region<ByteArrayWrapper, RedisData> region, ByteArrayWrapper key,\n-      List<ByteArrayWrapper> fieldsToRemove) {\n-    return 0;\n-  }\n-\n-  @Override\n-  public synchronized Collection<ByteArrayWrapper> hgetall() {\n-    return emptyList();\n+  public EmptyRedisHash() {", "originalCommit": "011864416cad9c589e3a39ef76b8be10e0cc4711", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjcyMjkzMQ==", "url": "https://github.com/apache/geode/pull/5125#discussion_r426722931", "bodyText": "It is just an optimization. It gives us a single instance of RedisHash that represents an empty hash instead of having to create a new instance every time we want to represent an empty hash. We do this alot because we have a common pattern of not wanting to return null when we do the initial lookup of a RedisHash from the region.", "author": "dschneider-pivotal", "createdAt": "2020-05-18T15:46:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjcwMjg0Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjcyMzE0Mg==", "url": "https://github.com/apache/geode/pull/5125#discussion_r426723142", "bodyText": "We do have to be careful that our canonical instance is immutable", "author": "dschneider-pivotal", "createdAt": "2020-05-18T15:46:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjcwMjg0Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjcwMzY2Ng==", "url": "https://github.com/apache/geode/pull/5125#discussion_r426703666", "bodyText": "How is this used / invoked?", "author": "jdeppe-pivotal", "createdAt": "2020-05-18T15:18:24Z", "path": "geode-redis/src/main/java/org/apache/geode/redis/internal/executor/CommandFunction.java", "diffHunk": "@@ -117,6 +118,32 @@ protected Object compute(Region localRegion, ByteArrayWrapper key,\n             () -> new RedisSetInRegion(localRegion).sscan(key, matchPattern, count, cursor);\n         break;\n       }\n+      case SCREATE: {", "originalCommit": "011864416cad9c589e3a39ef76b8be10e0cc4711", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjcyMzU2OA==", "url": "https://github.com/apache/geode/pull/5125#discussion_r426723568", "bodyText": "I think the place I was using it was refactored and now it is not used. I'll remove it.", "author": "dschneider-pivotal", "createdAt": "2020-05-18T15:47:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjcwMzY2Ng=="}], "type": "inlineReview"}, {"oid": "fdc649b556d175add5e2a4b7c64af9bcb46b62d1", "url": "https://github.com/apache/geode/commit/fdc649b556d175add5e2a4b7c64af9bcb46b62d1", "message": "hexists now uses function\n\nhget now uses function\n\nhlen now uses function\n\nhmget now uses function\n\nhvals now uses function\n\nhkeys now uses function\n\nsmove now uses the srem and sadd functions\n\nhscan now uses function\n\nhincrby now uses function\n\nhincrbyfloat now uses function\n\ncleaned up hash impls by getting rid of synchronized\nand adding a createRedisHashCommmands method\n\nAdd the set commands now use functions\n\ndisabled some tests that fail because of GEODE-8143", "committedDate": "2020-05-21T06:46:03Z", "type": "commit"}, {"oid": "fdc649b556d175add5e2a4b7c64af9bcb46b62d1", "url": "https://github.com/apache/geode/commit/fdc649b556d175add5e2a4b7c64af9bcb46b62d1", "message": "hexists now uses function\n\nhget now uses function\n\nhlen now uses function\n\nhmget now uses function\n\nhvals now uses function\n\nhkeys now uses function\n\nsmove now uses the srem and sadd functions\n\nhscan now uses function\n\nhincrby now uses function\n\nhincrbyfloat now uses function\n\ncleaned up hash impls by getting rid of synchronized\nand adding a createRedisHashCommmands method\n\nAdd the set commands now use functions\n\ndisabled some tests that fail because of GEODE-8143", "committedDate": "2020-05-21T06:46:03Z", "type": "forcePushed"}]}