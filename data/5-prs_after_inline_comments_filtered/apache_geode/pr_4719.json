{"pr_number": 4719, "pr_title": "GEODE-6536: Added retry in borrowConnection/single hop", "pr_createdAt": "2020-02-19T15:03:58Z", "pr_url": "https://github.com/apache/geode/pull/4719", "timeline": [{"oid": "e4552deb2a41eea5292708152a3d7d11c8d18891", "url": "https://github.com/apache/geode/commit/e4552deb2a41eea5292708152a3d7d11c8d18891", "message": "GEODE-6536: Added retry in borrowConnection/single hop", "committedDate": "2020-02-19T23:07:51Z", "type": "commit"}, {"oid": "56729a9f453009f2bc46e275ffeb85944a997279", "url": "https://github.com/apache/geode/commit/56729a9f453009f2bc46e275ffeb85944a997279", "message": "GEODE-6536: bug fix", "committedDate": "2020-02-19T23:13:34Z", "type": "commit"}, {"oid": "56729a9f453009f2bc46e275ffeb85944a997279", "url": "https://github.com/apache/geode/commit/56729a9f453009f2bc46e275ffeb85944a997279", "message": "GEODE-6536: bug fix", "committedDate": "2020-02-19T23:13:34Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA2Njc1OQ==", "url": "https://github.com/apache/geode/pull/4719#discussion_r384066759", "bodyText": "The other acquireConnection() method uses a hard-coded timeout of 45000L, though I don't know why that is.  Why does this version use 15000L? We should remove the \"test hook\" comment because this method is used in GatewaySenderEventRemoteDispatcher.initializeConnection().", "author": "bschuchardt", "createdAt": "2020-02-25T19:08:49Z", "path": "geode-core/src/main/java/org/apache/geode/cache/client/internal/PoolImpl.java", "diffHunk": "@@ -921,7 +921,7 @@ public void returnConnection(Connection conn) {\n    * Test hook that acquires and returns a connection from the pool with a given ServerLocation.\n    */\n   public Connection acquireConnection(ServerLocation loc) {\n-    return manager.borrowConnection(loc, false);\n+    return manager.borrowConnection(loc, 15000L, false);", "originalCommit": "56729a9f453009f2bc46e275ffeb85944a997279", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDUxOTkxMg==", "url": "https://github.com/apache/geode/pull/4719#discussion_r384519912", "bodyText": "Thanx for comments.\nI find that previous code contained this value 15000L (which is removed with GEODE-6535).", "author": "mivanac", "createdAt": "2020-02-26T14:18:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA2Njc1OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA3Mjc3Nw==", "url": "https://github.com/apache/geode/pull/4719#discussion_r384072777", "bodyText": "I don't see where this is throwing ServerOperationException.  It throws its superclass, ServerConnectivityException.", "author": "bschuchardt", "createdAt": "2020-02-25T19:20:29Z", "path": "geode-core/src/main/java/org/apache/geode/cache/client/internal/pooling/ConnectionManagerImpl.java", "diffHunk": "@@ -308,24 +308,49 @@ public Connection borrowConnection(long acquireTimeout)\n    * destroyed when returned to the pool.\n    */\n   @Override\n-  public PooledConnection borrowConnection(ServerLocation server,\n-      boolean onlyUseExistingCnx) throws AllConnectionsInUseException, NoAvailableServersException {\n+  public PooledConnection borrowConnection(ServerLocation server, long acquireTimeout,\n+      boolean onlyUseExistingCnx)\n+      throws AllConnectionsInUseException, NoAvailableServersException, ServerOperationException {", "originalCommit": "56729a9f453009f2bc46e275ffeb85944a997279", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDUxNDY2NA==", "url": "https://github.com/apache/geode/pull/4719#discussion_r384514664", "bodyText": "Updated", "author": "mivanac", "createdAt": "2020-02-26T14:10:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA3Mjc3Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA3NTM0MQ==", "url": "https://github.com/apache/geode/pull/4719#discussion_r384075341", "bodyText": "If onlyUseExistingCnx is true then the acquireTimeout parameter is ignored.", "author": "bschuchardt", "createdAt": "2020-02-25T19:25:13Z", "path": "geode-core/src/main/java/org/apache/geode/cache/client/internal/pooling/ConnectionManager.java", "diffHunk": "@@ -56,6 +56,7 @@ Connection borrowConnection(long aquireTimeout)\n    * no connection is available.\n    *\n    * @param server The server the connection needs to be to.\n+   * @param aquireTimeout The amount of time to wait for a connection to become available.\n    * @param onlyUseExistingCnx if true, will not create a new connection if none are available.", "originalCommit": "56729a9f453009f2bc46e275ffeb85944a997279", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA3NjgxMA==", "url": "https://github.com/apache/geode/pull/4719#discussion_r384076810", "bodyText": "We should get rid of the javadoc on this method.  It's hiding a more complete javadoc in the ConnectionManager interface.", "author": "bschuchardt", "createdAt": "2020-02-25T19:27:50Z", "path": "geode-core/src/main/java/org/apache/geode/cache/client/internal/pooling/ConnectionManagerImpl.java", "diffHunk": "@@ -308,24 +308,49 @@ public Connection borrowConnection(long acquireTimeout)\n    * destroyed when returned to the pool.\n    */\n   @Override\n-  public PooledConnection borrowConnection(ServerLocation server,\n-      boolean onlyUseExistingCnx) throws AllConnectionsInUseException, NoAvailableServersException {\n+  public PooledConnection borrowConnection(ServerLocation server, long acquireTimeout,", "originalCommit": "56729a9f453009f2bc46e275ffeb85944a997279", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDUxOTYyNg==", "url": "https://github.com/apache/geode/pull/4719#discussion_r384519626", "bodyText": "Updated", "author": "mivanac", "createdAt": "2020-02-26T14:18:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA3NjgxMA=="}], "type": "inlineReview"}, {"oid": "ae656bf6bc9dbb48f53051d54d8a1f1dafc2fb35", "url": "https://github.com/apache/geode/commit/ae656bf6bc9dbb48f53051d54d8a1f1dafc2fb35", "message": "GEODE-6536: update after comments", "committedDate": "2020-02-26T14:34:02Z", "type": "commit"}]}