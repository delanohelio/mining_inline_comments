{"pr_number": 5237, "pr_title": "GEODE-8268: clean up ExecutionHandlerContext", "pr_createdAt": "2020-06-11T00:54:09Z", "pr_url": "https://github.com/apache/geode/pull/5237", "timeline": [{"oid": "3d272e07f94672b6633099477e26182e56e2933f", "url": "https://github.com/apache/geode/commit/3d272e07f94672b6633099477e26182e56e2933f", "message": "cleaned up ExecutionHandlerContext dependencies\nalso the ShutdownExecutor now implements the shutdown command\ninstead of it being embedded in the ExecutionHandlerContext", "committedDate": "2020-06-11T16:41:12Z", "type": "commit"}, {"oid": "3d272e07f94672b6633099477e26182e56e2933f", "url": "https://github.com/apache/geode/commit/3d272e07f94672b6633099477e26182e56e2933f", "message": "cleaned up ExecutionHandlerContext dependencies\nalso the ShutdownExecutor now implements the shutdown command\ninstead of it being embedded in the ExecutionHandlerContext", "committedDate": "2020-06-11T16:41:12Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODk5OTczNg==", "url": "https://github.com/apache/geode/pull/5237#discussion_r438999736", "bodyText": "I wonder if there is some 'feature-envy' creep happening here. What do you think about pushing the registration functionality onto the server? I'm also fine with this approach.", "author": "jdeppe-pivotal", "createdAt": "2020-06-11T18:49:47Z", "path": "geode-redis/src/main/java/org/apache/geode/redis/internal/netty/ExecutionHandlerContext.java", "diffHunk": "@@ -264,7 +238,7 @@ private void moveSubscribeToNewEventLoopGroup(ChannelHandlerContext ctx, Command\n     if (command.isOfType(SUBSCRIBE)) {\n       CountDownLatch latch = new CountDownLatch(0);\n       ctx.channel().deregister().addListener((ChannelFutureListener) future -> {\n-        subscriberEventLoopGroup.register(ctx.channel()).sync();\n+        server.getSubscriberGroup().register(ctx.channel()).sync();", "originalCommit": "3d272e07f94672b6633099477e26182e56e2933f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTAzMDY3Mg==", "url": "https://github.com/apache/geode/pull/5237#discussion_r439030672", "bodyText": "What I would like to see here is that this code (moveSubscribeToNewEventLoopGroup) to the SubscribeExecutor. Is that possible? I don't really understand what this is about and maybe it is important to do it after the executor has completed.\nI'd also like to see all the netty specific code get moved out of GeodeRedisServer into something like NettyServer in our netty package just to have all the interactions with netty be in that one package. So then this code would interact with the NettyServer for this registration. But then this code would need to get access to the NettyServer (probably from the GeodeRedisServer). If we could break this class's dependency on GeodeRedisServer that might be a good thing but for now we need the GeodeRedisServer anyway (I think so we can ask it to shutdown and if unsupported commands are allowed).", "author": "dschneider-pivotal", "createdAt": "2020-06-11T19:50:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODk5OTczNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTAwMDE2Mw==", "url": "https://github.com/apache/geode/pull/5237#discussion_r439000163", "bodyText": "This looks like a bug in that the latch should be initialized with 1. This is my bug :(.", "author": "jdeppe-pivotal", "createdAt": "2020-06-11T18:50:31Z", "path": "geode-redis/src/main/java/org/apache/geode/redis/internal/netty/ExecutionHandlerContext.java", "diffHunk": "@@ -264,7 +238,7 @@ private void moveSubscribeToNewEventLoopGroup(ChannelHandlerContext ctx, Command\n     if (command.isOfType(SUBSCRIBE)) {\n       CountDownLatch latch = new CountDownLatch(0);", "originalCommit": "3d272e07f94672b6633099477e26182e56e2933f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "8e80782ebbf305eb28e893f34b3d0c5564773ae3", "url": "https://github.com/apache/geode/commit/8e80782ebbf305eb28e893f34b3d0c5564773ae3", "message": "SubscribeExecutor now takes care of changing the EventGroup of its channel", "committedDate": "2020-06-16T18:15:39Z", "type": "commit"}]}