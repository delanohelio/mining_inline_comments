{"pr_number": 5196, "pr_title": "GEODE-8197: Add launcher acceptance testing for custom logging config", "pr_createdAt": "2020-06-02T17:18:49Z", "pr_url": "https://github.com/apache/geode/pull/5196", "timeline": [{"oid": "d647d0e9655965bf440d305aad2de3dfb7195216", "url": "https://github.com/apache/geode/commit/d647d0e9655965bf440d305aad2de3dfb7195216", "message": "GEODE-8197: Add launcher acceptance testing for custom logging config", "committedDate": "2020-06-02T17:29:55Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTQ5OTY1Ng==", "url": "https://github.com/apache/geode/pull/5196#discussion_r435499656", "bodyText": "Why locatorLogFile exits for this test, while ``locatorLogFile` doesn't exist for the other tests in this pull request? Can you share what configuration makes this difference?", "author": "jchen21", "createdAt": "2020-06-04T19:29:08Z", "path": "geode-assembly/src/acceptanceTest/java/org/apache/geode/launchers/LocatorLauncherWithPulseAcceptanceTest.java", "diffHunk": "@@ -0,0 +1,113 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional information regarding\n+ * copyright ownership. The ASF licenses this file to You under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance with the License. You may obtain a\n+ * copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License\n+ * is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express\n+ * or implied. See the License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+package org.apache.geode.launchers;\n+\n+import static org.apache.geode.test.awaitility.GeodeAwaitility.await;\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+import java.nio.file.Path;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.junit.rules.TemporaryFolder;\n+\n+import org.apache.geode.internal.AvailablePortHelper;\n+import org.apache.geode.test.assertj.LogFileAssert;\n+import org.apache.geode.test.junit.rules.RequiresGeodeHome;\n+\n+public class LocatorLauncherWithPulseAcceptanceTest {\n+\n+  private static final String LOCATOR_NAME = \"the-locator\";\n+\n+  private int locatorPort;\n+  private int httpServicePort;\n+  private Process locator;\n+  private Path geodeDependencies;\n+  private Path stdoutFile;\n+  private Path locatorLogFile;\n+  private Path pulseLogFile;\n+\n+  @Rule\n+  public RequiresGeodeHome requiresGeodeHome = new RequiresGeodeHome();\n+  @Rule\n+  public TemporaryFolder temporaryFolder = new TemporaryFolder();\n+\n+  @Before\n+  public void setUpGeodeDependencies() {\n+    Path geodeHome = requiresGeodeHome.getGeodeHome().toPath();\n+    geodeDependencies = geodeHome.resolve(\"lib/geode-dependencies.jar\");\n+\n+    assertThat(geodeDependencies).exists();\n+  }\n+\n+  @Before\n+  public void setUpOutputFiles() {\n+    stdoutFile = temporaryFolder.getRoot().toPath().resolve(\"stdout.txt\");\n+    locatorLogFile = temporaryFolder.getRoot().toPath().resolve(LOCATOR_NAME + \".log\");\n+    pulseLogFile = temporaryFolder.getRoot().toPath().resolve(\"pulse.log\");\n+  }\n+\n+  @Before\n+  public void setUpRandomPorts() {\n+    int[] ports = AvailablePortHelper.getRandomAvailableTCPPorts(2);\n+    locatorPort = ports[0];\n+    httpServicePort = ports[1];\n+  }\n+\n+  @After\n+  public void stopLocator() throws Exception {\n+    if (locator != null) {\n+      locator.destroyForcibly().waitFor(4, TimeUnit.SECONDS);\n+    }\n+  }\n+\n+  @Test\n+  public void locatorLauncherStartsPulse() throws Exception {\n+    ProcessBuilder processBuilder = new ProcessBuilder()\n+        .redirectErrorStream(true)\n+        .redirectOutput(stdoutFile.toFile())\n+        .directory(temporaryFolder.getRoot())\n+        .command(\"java\",\n+            \"-Dgemfire.http-service-port=\" + httpServicePort,\n+            \"-Dgemfire.jmx-manager-start=true\",\n+            \"-Djava.awt.headless=true\",\n+            \"-cp\", geodeDependencies.toFile().getAbsolutePath(),\n+            \"org.apache.geode.distributed.LocatorLauncher\", \"start\", LOCATOR_NAME,\n+            \"--port\", String.valueOf(locatorPort));\n+\n+    System.out.println(\"Launching command: \" + processBuilder.command());\n+\n+    locator = processBuilder\n+        .start();\n+\n+    assertThat(locator.isAlive()).isTrue();\n+\n+    await().untilAsserted(() -> {\n+      LogFileAssert.assertThat(locatorLogFile.toFile())\n+          .exists()", "originalCommit": "d647d0e9655965bf440d305aad2de3dfb7195216", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjA1MTIxMg==", "url": "https://github.com/apache/geode/pull/5196#discussion_r436051212", "bodyText": "LocatorLauncherWithPulseAcceptanceTest is the only test in this PR that doesn't provide a custom log4j2 xml file. So that means, it'll create a locator log file.\nThe other tests all use a custom log4j2 xml file which turns off logging to a file and turns on logging to stdout. These tests assert that the locator log file doesn't exist to help verify that the custom log4j2 xml file for that test was actually used.\nThe tests that use a custom log file include \"WithCustomLogConfig\" somewhere in the name of the test class, whereas LocatorLauncherWithPulseAcceptanceTest does not.", "author": "kirklund", "createdAt": "2020-06-05T17:07:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTQ5OTY1Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjA4MDY5Mw==", "url": "https://github.com/apache/geode/pull/5196#discussion_r436080693", "bodyText": "My understanding is that once GEODE-8197 related bug is fixed, this @Ignore annotation will be removed.", "author": "jchen21", "createdAt": "2020-06-05T18:05:26Z", "path": "geode-assembly/src/acceptanceTest/java/org/apache/geode/launchers/LocatorLauncherWithPulseAndCustomLogConfigAcceptanceTest.java", "diffHunk": "@@ -0,0 +1,268 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional information regarding\n+ * copyright ownership. The ASF licenses this file to You under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance with the License. You may obtain a\n+ * copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License\n+ * is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express\n+ * or implied. See the License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+package org.apache.geode.launchers;\n+\n+import static java.nio.file.Files.copy;\n+import static org.apache.geode.test.awaitility.GeodeAwaitility.await;\n+import static org.apache.geode.test.util.ResourceUtils.createFileFromResource;\n+import static org.apache.geode.test.util.ResourceUtils.getResource;\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+import java.io.File;\n+import java.nio.file.Path;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.Ignore;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.junit.rules.TemporaryFolder;\n+\n+import org.apache.geode.internal.AvailablePortHelper;\n+import org.apache.geode.test.assertj.LogFileAssert;\n+import org.apache.geode.test.junit.rules.RequiresGeodeHome;\n+\n+public class LocatorLauncherWithPulseAndCustomLogConfigAcceptanceTest {\n+\n+  private static final String CONFIG_WITH_GEODE_PLUGINS_FILE_NAME =\n+      \"LocatorLauncherWithPulseAndCustomLogConfigAcceptanceTestWithGeodePlugins.xml\";\n+  private static final String CONFIG_WITHOUT_GEODE_PLUGINS_FILE_NAME =\n+      \"LocatorLauncherWithPulseAndCustomLogConfigAcceptanceTestWithoutGeodePlugins.xml\";\n+  private static final String LOCATOR_NAME = \"the-locator\";\n+\n+  private int locatorPort;\n+  private int httpServicePort;\n+  private Path configWithGeodePluginsFile;\n+  private Path configWithoutGeodePluginsFile;\n+  private Process locator;\n+  private Path geodeDependencies;\n+  private Path stdoutFile;\n+  private Path locatorLogFile;\n+  private Path pulseLogFile;\n+\n+  @Rule\n+  public RequiresGeodeHome requiresGeodeHome = new RequiresGeodeHome();\n+  @Rule\n+  public TemporaryFolder temporaryFolder = new TemporaryFolder();\n+\n+  @Before\n+  public void setUpLogConfigFiles() {\n+    configWithGeodePluginsFile = createFileFromResource(\n+        getResource(CONFIG_WITH_GEODE_PLUGINS_FILE_NAME), temporaryFolder.getRoot(),\n+        CONFIG_WITH_GEODE_PLUGINS_FILE_NAME)\n+            .toPath();\n+\n+    configWithoutGeodePluginsFile = createFileFromResource(\n+        getResource(CONFIG_WITHOUT_GEODE_PLUGINS_FILE_NAME), temporaryFolder.getRoot(),\n+        CONFIG_WITHOUT_GEODE_PLUGINS_FILE_NAME)\n+            .toPath();\n+  }\n+\n+  @Before\n+  public void setUpGeodeDependencies() {\n+    Path geodeHome = requiresGeodeHome.getGeodeHome().toPath();\n+    geodeDependencies = geodeHome.resolve(\"lib/geode-dependencies.jar\");\n+\n+    assertThat(geodeDependencies).exists();\n+  }\n+\n+  @Before\n+  public void setUpOutputFiles() {\n+    stdoutFile = temporaryFolder.getRoot().toPath().resolve(\"stdout.txt\");\n+    locatorLogFile = temporaryFolder.getRoot().toPath().resolve(LOCATOR_NAME + \".log\");\n+    pulseLogFile = temporaryFolder.getRoot().toPath().resolve(\"pulse.log\");\n+  }\n+\n+  @Before\n+  public void setUpRandomPorts() {\n+    int[] ports = AvailablePortHelper.getRandomAvailableTCPPorts(2);\n+    locatorPort = ports[0];\n+    httpServicePort = ports[1];\n+  }\n+\n+  @After\n+  public void stopLocator() throws Exception {\n+    if (locator != null) {\n+      locator.destroyForcibly().waitFor(4, TimeUnit.SECONDS);\n+    }\n+  }\n+\n+  @Test\n+  public void locatorLauncherUsesSpecifiedConfigFileWithoutGeodePlugins() throws Exception {\n+    ProcessBuilder processBuilder = new ProcessBuilder()\n+        .redirectErrorStream(true)\n+        .redirectOutput(stdoutFile.toFile())\n+        .directory(temporaryFolder.getRoot())\n+        .command(\"java\",\n+            \"-Dgemfire.http-service-port=\" + httpServicePort,\n+            \"-Dgemfire.jmx-manager-start=true\",\n+            \"-Djava.awt.headless=true\",\n+            \"-Dlog4j.configurationFile=\" + configWithoutGeodePluginsFile.toAbsolutePath(),\n+            \"-cp\", geodeDependencies.toFile().getAbsolutePath(),\n+            \"org.apache.geode.distributed.LocatorLauncher\", \"start\", LOCATOR_NAME,\n+            \"--port\", String.valueOf(locatorPort));\n+\n+    System.out.println(\"Launching command: \" + processBuilder.command());\n+\n+    locator = processBuilder\n+        .start();\n+\n+    assertThat(locator.isAlive()).isTrue();\n+\n+    await().untilAsserted(() -> {\n+      assertThat(locatorLogFile)\n+          .doesNotExist();\n+\n+      assertThat(pulseLogFile)\n+          .doesNotExist();\n+\n+      LogFileAssert.assertThat(stdoutFile.toFile())\n+          .exists()\n+          .contains(\"Located war: geode-pulse\")\n+          .contains(\"Adding webapp /pulse\")\n+          .contains(\"Starting server location for Distribution Locator\")\n+          .doesNotContain(\"geode-pulse war file was not found\")\n+          .doesNotContain(\"java.lang.IllegalStateException: No factory method found for class\");\n+    });\n+  }\n+\n+  @Test\n+  public void locatorLauncherUsesConfigFileInClasspathWithoutGeodePlugins() throws Exception {\n+    copy(configWithoutGeodePluginsFile, temporaryFolder.getRoot().toPath().resolve(\"log4j2.xml\"));\n+\n+    String classpath = temporaryFolder.getRoot().getAbsolutePath() + File.pathSeparator +\n+        geodeDependencies.toFile().getAbsolutePath();\n+\n+    ProcessBuilder processBuilder = new ProcessBuilder()\n+        .redirectErrorStream(true)\n+        .redirectOutput(stdoutFile.toFile())\n+        .directory(temporaryFolder.getRoot())\n+        .command(\"java\",\n+            \"-Dgemfire.http-service-port=\" + httpServicePort,\n+            \"-Dgemfire.jmx-manager-start=true\",\n+            \"-Djava.awt.headless=true\",\n+            \"-cp\", classpath,\n+            \"org.apache.geode.distributed.LocatorLauncher\", \"start\", LOCATOR_NAME,\n+            \"--port\", String.valueOf(locatorPort));\n+\n+    System.out.println(\"Launching command: \" + processBuilder.command());\n+\n+    locator = processBuilder\n+        .start();\n+\n+    assertThat(locator.isAlive()).isTrue();\n+\n+    await().untilAsserted(() -> {\n+      assertThat(locatorLogFile)\n+          .doesNotExist();\n+\n+      assertThat(pulseLogFile)\n+          .doesNotExist();\n+\n+      LogFileAssert.assertThat(stdoutFile.toFile())\n+          .exists()\n+          .contains(\"Located war: geode-pulse\")\n+          .contains(\"Adding webapp /pulse\")\n+          .contains(\"Starting server location for Distribution Locator\")\n+          .doesNotContain(\"geode-pulse war file was not found\")\n+          .doesNotContain(\"java.lang.IllegalStateException: No factory method found for class\");\n+    });\n+  }\n+\n+  @Test\n+  @Ignore(\"GEODE-8197\")", "originalCommit": "d647d0e9655965bf440d305aad2de3dfb7195216", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjA4MDgzNg==", "url": "https://github.com/apache/geode/pull/5196#discussion_r436080836", "bodyText": "My understanding is that once GEODE-8197 related bug is fixed, this @Ignore annotation will be removed.", "author": "jchen21", "createdAt": "2020-06-05T18:05:41Z", "path": "geode-assembly/src/acceptanceTest/java/org/apache/geode/launchers/LocatorLauncherWithPulseAndCustomLogConfigAcceptanceTest.java", "diffHunk": "@@ -0,0 +1,268 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional information regarding\n+ * copyright ownership. The ASF licenses this file to You under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance with the License. You may obtain a\n+ * copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License\n+ * is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express\n+ * or implied. See the License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+package org.apache.geode.launchers;\n+\n+import static java.nio.file.Files.copy;\n+import static org.apache.geode.test.awaitility.GeodeAwaitility.await;\n+import static org.apache.geode.test.util.ResourceUtils.createFileFromResource;\n+import static org.apache.geode.test.util.ResourceUtils.getResource;\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+import java.io.File;\n+import java.nio.file.Path;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.Ignore;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.junit.rules.TemporaryFolder;\n+\n+import org.apache.geode.internal.AvailablePortHelper;\n+import org.apache.geode.test.assertj.LogFileAssert;\n+import org.apache.geode.test.junit.rules.RequiresGeodeHome;\n+\n+public class LocatorLauncherWithPulseAndCustomLogConfigAcceptanceTest {\n+\n+  private static final String CONFIG_WITH_GEODE_PLUGINS_FILE_NAME =\n+      \"LocatorLauncherWithPulseAndCustomLogConfigAcceptanceTestWithGeodePlugins.xml\";\n+  private static final String CONFIG_WITHOUT_GEODE_PLUGINS_FILE_NAME =\n+      \"LocatorLauncherWithPulseAndCustomLogConfigAcceptanceTestWithoutGeodePlugins.xml\";\n+  private static final String LOCATOR_NAME = \"the-locator\";\n+\n+  private int locatorPort;\n+  private int httpServicePort;\n+  private Path configWithGeodePluginsFile;\n+  private Path configWithoutGeodePluginsFile;\n+  private Process locator;\n+  private Path geodeDependencies;\n+  private Path stdoutFile;\n+  private Path locatorLogFile;\n+  private Path pulseLogFile;\n+\n+  @Rule\n+  public RequiresGeodeHome requiresGeodeHome = new RequiresGeodeHome();\n+  @Rule\n+  public TemporaryFolder temporaryFolder = new TemporaryFolder();\n+\n+  @Before\n+  public void setUpLogConfigFiles() {\n+    configWithGeodePluginsFile = createFileFromResource(\n+        getResource(CONFIG_WITH_GEODE_PLUGINS_FILE_NAME), temporaryFolder.getRoot(),\n+        CONFIG_WITH_GEODE_PLUGINS_FILE_NAME)\n+            .toPath();\n+\n+    configWithoutGeodePluginsFile = createFileFromResource(\n+        getResource(CONFIG_WITHOUT_GEODE_PLUGINS_FILE_NAME), temporaryFolder.getRoot(),\n+        CONFIG_WITHOUT_GEODE_PLUGINS_FILE_NAME)\n+            .toPath();\n+  }\n+\n+  @Before\n+  public void setUpGeodeDependencies() {\n+    Path geodeHome = requiresGeodeHome.getGeodeHome().toPath();\n+    geodeDependencies = geodeHome.resolve(\"lib/geode-dependencies.jar\");\n+\n+    assertThat(geodeDependencies).exists();\n+  }\n+\n+  @Before\n+  public void setUpOutputFiles() {\n+    stdoutFile = temporaryFolder.getRoot().toPath().resolve(\"stdout.txt\");\n+    locatorLogFile = temporaryFolder.getRoot().toPath().resolve(LOCATOR_NAME + \".log\");\n+    pulseLogFile = temporaryFolder.getRoot().toPath().resolve(\"pulse.log\");\n+  }\n+\n+  @Before\n+  public void setUpRandomPorts() {\n+    int[] ports = AvailablePortHelper.getRandomAvailableTCPPorts(2);\n+    locatorPort = ports[0];\n+    httpServicePort = ports[1];\n+  }\n+\n+  @After\n+  public void stopLocator() throws Exception {\n+    if (locator != null) {\n+      locator.destroyForcibly().waitFor(4, TimeUnit.SECONDS);\n+    }\n+  }\n+\n+  @Test\n+  public void locatorLauncherUsesSpecifiedConfigFileWithoutGeodePlugins() throws Exception {\n+    ProcessBuilder processBuilder = new ProcessBuilder()\n+        .redirectErrorStream(true)\n+        .redirectOutput(stdoutFile.toFile())\n+        .directory(temporaryFolder.getRoot())\n+        .command(\"java\",\n+            \"-Dgemfire.http-service-port=\" + httpServicePort,\n+            \"-Dgemfire.jmx-manager-start=true\",\n+            \"-Djava.awt.headless=true\",\n+            \"-Dlog4j.configurationFile=\" + configWithoutGeodePluginsFile.toAbsolutePath(),\n+            \"-cp\", geodeDependencies.toFile().getAbsolutePath(),\n+            \"org.apache.geode.distributed.LocatorLauncher\", \"start\", LOCATOR_NAME,\n+            \"--port\", String.valueOf(locatorPort));\n+\n+    System.out.println(\"Launching command: \" + processBuilder.command());\n+\n+    locator = processBuilder\n+        .start();\n+\n+    assertThat(locator.isAlive()).isTrue();\n+\n+    await().untilAsserted(() -> {\n+      assertThat(locatorLogFile)\n+          .doesNotExist();\n+\n+      assertThat(pulseLogFile)\n+          .doesNotExist();\n+\n+      LogFileAssert.assertThat(stdoutFile.toFile())\n+          .exists()\n+          .contains(\"Located war: geode-pulse\")\n+          .contains(\"Adding webapp /pulse\")\n+          .contains(\"Starting server location for Distribution Locator\")\n+          .doesNotContain(\"geode-pulse war file was not found\")\n+          .doesNotContain(\"java.lang.IllegalStateException: No factory method found for class\");\n+    });\n+  }\n+\n+  @Test\n+  public void locatorLauncherUsesConfigFileInClasspathWithoutGeodePlugins() throws Exception {\n+    copy(configWithoutGeodePluginsFile, temporaryFolder.getRoot().toPath().resolve(\"log4j2.xml\"));\n+\n+    String classpath = temporaryFolder.getRoot().getAbsolutePath() + File.pathSeparator +\n+        geodeDependencies.toFile().getAbsolutePath();\n+\n+    ProcessBuilder processBuilder = new ProcessBuilder()\n+        .redirectErrorStream(true)\n+        .redirectOutput(stdoutFile.toFile())\n+        .directory(temporaryFolder.getRoot())\n+        .command(\"java\",\n+            \"-Dgemfire.http-service-port=\" + httpServicePort,\n+            \"-Dgemfire.jmx-manager-start=true\",\n+            \"-Djava.awt.headless=true\",\n+            \"-cp\", classpath,\n+            \"org.apache.geode.distributed.LocatorLauncher\", \"start\", LOCATOR_NAME,\n+            \"--port\", String.valueOf(locatorPort));\n+\n+    System.out.println(\"Launching command: \" + processBuilder.command());\n+\n+    locator = processBuilder\n+        .start();\n+\n+    assertThat(locator.isAlive()).isTrue();\n+\n+    await().untilAsserted(() -> {\n+      assertThat(locatorLogFile)\n+          .doesNotExist();\n+\n+      assertThat(pulseLogFile)\n+          .doesNotExist();\n+\n+      LogFileAssert.assertThat(stdoutFile.toFile())\n+          .exists()\n+          .contains(\"Located war: geode-pulse\")\n+          .contains(\"Adding webapp /pulse\")\n+          .contains(\"Starting server location for Distribution Locator\")\n+          .doesNotContain(\"geode-pulse war file was not found\")\n+          .doesNotContain(\"java.lang.IllegalStateException: No factory method found for class\");\n+    });\n+  }\n+\n+  @Test\n+  @Ignore(\"GEODE-8197\")\n+  public void locatorLauncherUsesSpecifiedConfigFileWithGeodePlugins() throws Exception {\n+    ProcessBuilder processBuilder = new ProcessBuilder()\n+        .redirectErrorStream(true)\n+        .redirectOutput(stdoutFile.toFile())\n+        .directory(temporaryFolder.getRoot())\n+        .command(\"java\",\n+            \"-Dgemfire.http-service-port=\" + httpServicePort,\n+            \"-Dgemfire.jmx-manager-start=true\",\n+            \"-Djava.awt.headless=true\",\n+            \"-Dlog4j.configurationFile=\" + configWithGeodePluginsFile.toAbsolutePath(),\n+            \"-cp\", geodeDependencies.toFile().getAbsolutePath(),\n+            \"org.apache.geode.distributed.LocatorLauncher\", \"start\", LOCATOR_NAME,\n+            \"--port\", String.valueOf(locatorPort));\n+\n+    System.out.println(\"Launching command: \" + processBuilder.command());\n+\n+    locator = processBuilder\n+        .start();\n+\n+    assertThat(locator.isAlive()).isTrue();\n+\n+    await().untilAsserted(() -> {\n+      assertThat(locatorLogFile)\n+          .doesNotExist();\n+\n+      assertThat(pulseLogFile)\n+          .doesNotExist();\n+\n+      LogFileAssert.assertThat(stdoutFile.toFile())\n+          .exists()\n+          .contains(\"Located war: geode-pulse\")\n+          .contains(\"Adding webapp /pulse\")\n+          .contains(\"Starting server location for Distribution Locator\")\n+          .doesNotContain(\"geode-pulse war file was not found\")\n+          .doesNotContain(\"java.lang.IllegalStateException: No factory method found for class\");\n+    });\n+  }\n+\n+  @Test\n+  @Ignore(\"GEODE-8197\")", "originalCommit": "d647d0e9655965bf440d305aad2de3dfb7195216", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjE4NjU2NA==", "url": "https://github.com/apache/geode/pull/5196#discussion_r436186564", "bodyText": "Yes. This PR is only creating new tests. I'll follow up in the future with a fix and reenable the two new tests that are currently disabled with \"GEODE-8197\". Right now these two tests will fail.", "author": "kirklund", "createdAt": "2020-06-05T22:08:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjA4MDgzNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjMwOTc2MA==", "url": "https://github.com/apache/geode/pull/5196#discussion_r436309760", "bodyText": "If system property java.home is defined, please use System.getProperty(\"java.home\")+\"/bin/java\" instead.  Only use java if system property java.home is not defined", "author": "onichols-pivotal", "createdAt": "2020-06-06T23:52:54Z", "path": "geode-assembly/src/acceptanceTest/java/org/apache/geode/launchers/LocatorLauncherWithCustomLogConfigAcceptanceTest.java", "diffHunk": "@@ -0,0 +1,175 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional information regarding\n+ * copyright ownership. The ASF licenses this file to You under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance with the License. You may obtain a\n+ * copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License\n+ * is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express\n+ * or implied. See the License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+package org.apache.geode.launchers;\n+\n+import static org.apache.geode.test.awaitility.GeodeAwaitility.await;\n+import static org.apache.geode.test.util.ResourceUtils.createFileFromResource;\n+import static org.apache.geode.test.util.ResourceUtils.getResource;\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+import java.io.File;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.junit.rules.TemporaryFolder;\n+\n+import org.apache.geode.internal.AvailablePortHelper;\n+import org.apache.geode.test.assertj.LogFileAssert;\n+import org.apache.geode.test.junit.rules.RequiresGeodeHome;\n+\n+public class LocatorLauncherWithCustomLogConfigAcceptanceTest {\n+\n+  private static final String CONFIG_FILE_NAME =\n+      \"LocatorLauncherWithCustomLogConfigAcceptanceTest.xml\";\n+  private static final String LOCATOR_NAME = \"the-locator\";\n+\n+  private int locatorPort;\n+  private Path configFile;\n+  private Process locator;\n+  private Path geodeDependencies;\n+  private Path stdoutFile;\n+  private Path locatorLogFile;\n+  private Path pulseLogFile;\n+\n+  @Rule\n+  public RequiresGeodeHome requiresGeodeHome = new RequiresGeodeHome();\n+  @Rule\n+  public TemporaryFolder temporaryFolder = new TemporaryFolder();\n+\n+  @Before\n+  public void setUpLogConfigFile() {\n+    configFile = createFileFromResource(getResource(CONFIG_FILE_NAME), temporaryFolder.getRoot(),\n+        CONFIG_FILE_NAME)\n+            .toPath();\n+  }\n+\n+  @Before\n+  public void setUpGeodeDependencies() {\n+    Path geodeHome = requiresGeodeHome.getGeodeHome().toPath();\n+    geodeDependencies = geodeHome.resolve(\"lib/geode-dependencies.jar\");\n+\n+    assertThat(geodeDependencies).exists();\n+  }\n+\n+  @Before\n+  public void setUpOutputFiles() {\n+    stdoutFile = temporaryFolder.getRoot().toPath().resolve(\"stdout.txt\");\n+    locatorLogFile = temporaryFolder.getRoot().toPath().resolve(LOCATOR_NAME + \".log\");\n+    pulseLogFile = temporaryFolder.getRoot().toPath().resolve(\"pulse.log\");\n+  }\n+\n+  @Before\n+  public void setUpRandomPorts() {\n+    locatorPort = AvailablePortHelper.getRandomAvailableTCPPort();\n+  }\n+\n+  @After\n+  public void stopLocator() throws Exception {\n+    if (locator != null) {\n+      locator.destroyForcibly().waitFor(4, TimeUnit.SECONDS);\n+    }\n+  }\n+\n+  @Test\n+  public void locatorLauncherUsesLog4jConfigurationFile() throws Exception {\n+    ProcessBuilder processBuilder = new ProcessBuilder()\n+        .redirectErrorStream(true)\n+        .redirectOutput(stdoutFile.toFile())\n+        .directory(temporaryFolder.getRoot())\n+        .command(\"java\",", "originalCommit": "3157c674d8c1e4a2f41ba9524361b2a80a1cee0d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjg2MzQ5NA==", "url": "https://github.com/apache/geode/pull/5196#discussion_r436863494", "bodyText": "Thanks Owen!", "author": "kirklund", "createdAt": "2020-06-08T17:12:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjMwOTc2MA=="}], "type": "inlineReview"}, {"oid": "a0597aa3310277aa3dfb934c0287e5f6a80193a8", "url": "https://github.com/apache/geode/commit/a0597aa3310277aa3dfb934c0287e5f6a80193a8", "message": "GEODE-8197: Add launcher acceptance testing for custom logging config", "committedDate": "2020-06-10T22:00:35Z", "type": "commit"}, {"oid": "a0597aa3310277aa3dfb934c0287e5f6a80193a8", "url": "https://github.com/apache/geode/commit/a0597aa3310277aa3dfb934c0287e5f6a80193a8", "message": "GEODE-8197: Add launcher acceptance testing for custom logging config", "committedDate": "2020-06-10T22:00:35Z", "type": "forcePushed"}]}