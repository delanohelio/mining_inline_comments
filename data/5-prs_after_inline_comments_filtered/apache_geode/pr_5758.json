{"pr_number": 5758, "pr_title": "GEODE-8721: member that should become coordinator never detects loss of current coordinator", "pr_createdAt": "2020-11-17T22:03:16Z", "pr_url": "https://github.com/apache/geode/pull/5758", "timeline": [{"oid": "751c8ed68194f55eeae7f3c459040e2beaedbdf0", "url": "https://github.com/apache/geode/commit/751c8ed68194f55eeae7f3c459040e2beaedbdf0", "message": "GEODE-8721: member that should become coordinator never detects loss of current coordinator\n\nIf a server is in the process of performing an availability check on\nanother server we shouldn't update the contact timestamp for\nthe suspected server based on gossip from another server.  Doing so\nwill make the availability check pass and send out another gossip\nmessage that would likewise update their timestamps for the suspected\nserver, perpetuating the notion that the suspect is still around.", "committedDate": "2020-11-17T21:52:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTY2OTk1MQ==", "url": "https://github.com/apache/geode/pull/5758#discussion_r525669951", "bodyText": "do we need to add @VisibleForTesting annotation here?", "author": "kohlmu-pivotal", "createdAt": "2020-11-18T02:35:09Z", "path": "geode-membership/src/main/java/org/apache/geode/distributed/internal/membership/gms/fd/GMSHealthMonitor.java", "diffHunk": "@@ -152,7 +152,7 @@\n   /**\n    * Members undergoing final checks\n    */\n-  private final List<ID> membersInFinalCheck =\n+  final List<ID> membersInFinalCheck =", "originalCommit": "751c8ed68194f55eeae7f3c459040e2beaedbdf0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjE5NDQ0MA==", "url": "https://github.com/apache/geode/pull/5758#discussion_r526194440", "bodyText": "yes", "author": "bschuchardt", "createdAt": "2020-11-18T15:49:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTY2OTk1MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTY3MTQ2Mg==", "url": "https://github.com/apache/geode/pull/5758#discussion_r525671462", "bodyText": "Should we maybe remove direct access to this field and rather replace it with an accessor that we can then mark with @VisibleForTesting?", "author": "kohlmu-pivotal", "createdAt": "2020-11-18T02:36:47Z", "path": "geode-membership/src/main/java/org/apache/geode/distributed/internal/membership/gms/fd/GMSHealthMonitor.java", "diffHunk": "@@ -130,7 +130,7 @@\n   public static final long MEMBER_SUSPECT_COLLECTION_INTERVAL =\n       Long.getLong(\"geode.suspect-member-collection-interval\", 200);\n \n-  private volatile long currentTimeStamp;\n+  volatile long currentTimeStamp;", "originalCommit": "751c8ed68194f55eeae7f3c459040e2beaedbdf0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjE5NTQ0Mg==", "url": "https://github.com/apache/geode/pull/5758#discussion_r526195442", "bodyText": "seems the same as membersInFinalCheck to me, allowing a test subclass to access it", "author": "bschuchardt", "createdAt": "2020-11-18T15:50:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTY3MTQ2Mg=="}], "type": "inlineReview"}, {"oid": "bdf4a5f2b55b68f108aad9352a8bb0ddb3a3f935", "url": "https://github.com/apache/geode/commit/bdf4a5f2b55b68f108aad9352a8bb0ddb3a3f935", "message": "added VisibleForTesting", "committedDate": "2020-11-18T16:04:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjM3OTMxNg==", "url": "https://github.com/apache/geode/pull/5758#discussion_r526379316", "bodyText": "seems to be done to detect JVM pauses and delay suspect processing in those cases...", "author": "echobravopapa", "createdAt": "2020-11-18T19:56:15Z", "path": "geode-membership/src/main/java/org/apache/geode/distributed/internal/membership/gms/fd/GMSHealthMonitor.java", "diffHunk": "@@ -257,6 +257,7 @@ public void run() {\n           return;\n         }\n \n+        // TODO - why are we taking two clock readings and setting currentTimeStamp twice?", "originalCommit": "751c8ed68194f55eeae7f3c459040e2beaedbdf0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjM4MzcwNg==", "url": "https://github.com/apache/geode/pull/5758#discussion_r526383706", "bodyText": "solid fix!", "author": "echobravopapa", "createdAt": "2020-11-18T20:03:25Z", "path": "geode-membership/src/main/java/org/apache/geode/distributed/internal/membership/gms/fd/GMSHealthMonitor.java", "diffHunk": "@@ -1242,7 +1243,11 @@ void processMessage(FinalCheckPassedMessage<ID> m) {\n     if (isStopping) {\n       return;\n     }\n-    contactedBy(m.getSuspect());\n+    // if we're currently processing a final-check for this member don't artificially update the", "originalCommit": "751c8ed68194f55eeae7f3c459040e2beaedbdf0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}