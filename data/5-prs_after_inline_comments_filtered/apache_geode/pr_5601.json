{"pr_number": 5601, "pr_title": "GEODE-8603: Potentially expand classes identified for CI stressing to include subclasses", "pr_createdAt": "2020-10-07T16:28:33Z", "pr_url": "https://github.com/apache/geode/pull/5601", "timeline": [{"oid": "d639f73506dfb603717aa8b27b55d99f7dcaa45e", "url": "https://github.com/apache/geode/commit/d639f73506dfb603717aa8b27b55d99f7dcaa45e", "message": "Expand sub classes indicated by StressNewTest", "committedDate": "2020-10-07T16:28:08Z", "type": "commit"}, {"oid": "621887640458141efeed483a195054b866ed3c82", "url": "https://github.com/apache/geode/commit/621887640458141efeed483a195054b866ed3c82", "message": "Enable debug output", "committedDate": "2020-10-07T16:55:54Z", "type": "commit"}, {"oid": "23953a5cf9c79fe7a5d6d8661177e7cd45258037", "url": "https://github.com/apache/geode/commit/23953a5cf9c79fe7a5d6d8661177e7cd45258037", "message": "Shaving the yak", "committedDate": "2020-10-07T17:28:44Z", "type": "commit"}, {"oid": "42221e5244b8ba0b55032cf191131faa5d7497a5", "url": "https://github.com/apache/geode/commit/42221e5244b8ba0b55032cf191131faa5d7497a5", "message": "Fix checkPom and minor cleanup", "committedDate": "2020-10-07T18:08:06Z", "type": "commit"}, {"oid": "04c938d29027443e215784541064e375b3fb0844", "url": "https://github.com/apache/geode/commit/04c938d29027443e215784541064e375b3fb0844", "message": "Order classpath correctly and run devBuild and printTestClasspath separately\n\nAuthored-by: Jens Deppe <jdeppe@vmware.com>", "committedDate": "2020-10-08T15:02:32Z", "type": "commit"}, {"oid": "b4960327cc54fdc8690c798e7122005500971e56", "url": "https://github.com/apache/geode/commit/b4960327cc54fdc8690c798e7122005500971e56", "message": "Also work with actual java files", "committedDate": "2020-10-08T16:26:47Z", "type": "commit"}, {"oid": "a9edb3bef35d2d23c1e210f4e521d0569785f4dc", "url": "https://github.com/apache/geode/commit/a9edb3bef35d2d23c1e210f4e521d0569785f4dc", "message": "Improved log messages", "committedDate": "2020-10-08T16:43:57Z", "type": "commit"}, {"oid": "55e1a5793cbbe281547ed24963bcaf5074cb7067", "url": "https://github.com/apache/geode/commit/55e1a5793cbbe281547ed24963bcaf5074cb7067", "message": "Fix bash syntax error", "committedDate": "2020-10-08T17:03:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTk4MjA0Ng==", "url": "https://github.com/apache/geode/pull/5601#discussion_r501982046", "bodyText": "Is this possibly missing running concrete classes that also have subclasses? Like someone extended a real test with more subclasses?", "author": "upthewaterspout", "createdAt": "2020-10-08T20:06:07Z", "path": "geode-junit/src/main/java/org/apache/geode/test/util/ClassScanner.java", "diffHunk": "@@ -0,0 +1,98 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional information regarding\n+ * copyright ownership. The ASF licenses this file to You under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance with the License. You may obtain a\n+ * copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License\n+ * is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express\n+ * or implied. See the License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+package org.apache.geode.test.util;\n+\n+import java.io.File;\n+import java.util.Arrays;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+\n+import io.github.classgraph.ClassGraph;\n+import io.github.classgraph.ClassInfo;\n+import io.github.classgraph.ScanResult;\n+\n+/**\n+ * This class is intended as a helper to the CI StressNewTest job.\n+ */\n+public class ClassScanner {\n+\n+  private ScanResult scanResult;\n+  private String packageToScan;\n+\n+  public ClassScanner(String packageToScan) {\n+    this.packageToScan = packageToScan;\n+    scanResult = new ClassGraph().whitelistPackages(packageToScan)\n+        .enableClassInfo()\n+        .enableAnnotationInfo().scan();\n+  }\n+\n+  public List<String> whatExtends(String classOrFile) {\n+    Set<String> classesToConsider = new HashSet<>();\n+    classesToConsider.add(pathToClass(classOrFile));\n+\n+    if (!classOrFile.contains(\".\")) {\n+      classesToConsider.addAll(fullyQualifyClass(classOrFile));\n+    }\n+\n+    return classesToConsider.stream()\n+        .flatMap(x -> scanResult.getSubclasses(x).stream().map(ClassInfo::getSimpleName))", "originalCommit": "55e1a5793cbbe281547ed24963bcaf5074cb7067", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQ1NjY2MA==", "url": "https://github.com/apache/geode/pull/5601#discussion_r503456660", "bodyText": "In that case the selected subclass would end up executing tests in the super. A test could be missed if the subclass overrides a test in the super.", "author": "jdeppe-pivotal", "createdAt": "2020-10-12T18:10:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTk4MjA0Ng=="}], "type": "inlineReview"}, {"oid": "1c5b191b9fe3c7a756885a09e492694e6eef9461", "url": "https://github.com/apache/geode/commit/1c5b191b9fe3c7a756885a09e492694e6eef9461", "message": "Make StressNewTestHelper create the complete gradle test task commands\n\n- Since some tests may have subclasses in different source sets, (which\n  would require a different repeat task name), it's easier for the\n  command generation to all happen in the java helper rather than a\n  combination of bash and java.\n\nAuthored-by: Jens Deppe <jdeppe@vmware.com>", "committedDate": "2020-10-12T15:58:28Z", "type": "commit"}, {"oid": "762d9e9b3db96987f2cd7d9e3f8ca7c34c4ff87e", "url": "https://github.com/apache/geode/commit/762d9e9b3db96987f2cd7d9e3f8ca7c34c4ff87e", "message": "Only use those tasks that are defined", "committedDate": "2020-10-12T17:00:46Z", "type": "commit"}, {"oid": "011241212f5ee675036a192fd47fe53c274710d6", "url": "https://github.com/apache/geode/commit/011241212f5ee675036a192fd47fe53c274710d6", "message": "Ensure acceptanceTest is not used", "committedDate": "2020-10-12T17:58:12Z", "type": "commit"}, {"oid": "4fe70871dca291df67375135bf54297bb1c25999", "url": "https://github.com/apache/geode/commit/4fe70871dca291df67375135bf54297bb1c25999", "message": "Include candidate test class if it is not abstract", "committedDate": "2020-10-15T16:50:36Z", "type": "commit"}, {"oid": "91b9944eb4d23cc28b2ef14b766420584486a3c6", "url": "https://github.com/apache/geode/commit/91b9944eb4d23cc28b2ef14b766420584486a3c6", "message": "Various changes:\n\n- Output a fake Gradle param so that scripts can determine the number of\n  tests included.\n- Change the CI stress job timeout from 6 to 10 hours.\n- Increase the test count threshold from 25 to 35 changed tests. This\n  number also includes any tests inferred by this new code.\n\nAuthored-by: Jens Deppe <jdeppe@vmware.com>", "committedDate": "2020-10-15T17:26:15Z", "type": "commit"}, {"oid": "162bb2a8f9de667b826179aa3fdb7cb2e3db3c8a", "url": "https://github.com/apache/geode/commit/162bb2a8f9de667b826179aa3fdb7cb2e3db3c8a", "message": "Bump images to Ubuntu 20.04", "committedDate": "2020-10-15T18:02:04Z", "type": "commit"}, {"oid": "fda5d6da59cff572b74cc50ac329a4b580350ffb", "url": "https://github.com/apache/geode/commit/fda5d6da59cff572b74cc50ac329a4b580350ffb", "message": "Do not go interactive", "committedDate": "2020-10-15T19:09:46Z", "type": "commit"}, {"oid": "4b16ff0e9015e7aebf2c92b94aa56e6e18796d29", "url": "https://github.com/apache/geode/commit/4b16ff0e9015e7aebf2c92b94aa56e6e18796d29", "message": "Ubuntu 20 does not include python 2.7 anymore", "committedDate": "2020-10-15T21:16:27Z", "type": "commit"}, {"oid": "9d88b2781d4bbd1693469b201f2810c730be02d9", "url": "https://github.com/apache/geode/commit/9d88b2781d4bbd1693469b201f2810c730be02d9", "message": "Revert changes for Ubuntu 20.04", "committedDate": "2020-10-19T13:42:32Z", "type": "commit"}, {"oid": "570ace9bd1a641d66285ef9b57a68b432039aa62", "url": "https://github.com/apache/geode/commit/570ace9bd1a641d66285ef9b57a68b432039aa62", "message": "Fix tests", "committedDate": "2020-10-22T17:48:24Z", "type": "commit"}, {"oid": "c2f3e8fffb8dd57cc8ec0efbfc5aefbdd82b26d9", "url": "https://github.com/apache/geode/commit/c2f3e8fffb8dd57cc8ec0efbfc5aefbdd82b26d9", "message": "Trigger CI", "committedDate": "2020-10-22T19:07:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQ0MjA5MA==", "url": "https://github.com/apache/geode/pull/5601#discussion_r510442090", "bodyText": "was this intended to be left in?", "author": "onichols-pivotal", "createdAt": "2020-10-22T20:38:09Z", "path": "geode-redis/src/integrationTest/java/org/apache/geode/redis/internal/executor/pubsub/AbstractPubSubIntegrationTest.java", "diffHunk": "@@ -51,6 +51,7 @@\n import org.apache.geode.test.junit.rules.ExecutorServiceRule;\n \n public abstract class AbstractPubSubIntegrationTest implements RedisPortSupplier {\n+  /* Trigger a stress test run */", "originalCommit": "c2f3e8fffb8dd57cc8ec0efbfc5aefbdd82b26d9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQ0NTMzMw==", "url": "https://github.com/apache/geode/pull/5601#discussion_r510445333", "bodyText": "Thanks for pointing that out - I'll remove it.", "author": "jdeppe-pivotal", "createdAt": "2020-10-22T20:44:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQ0MjA5MA=="}], "type": "inlineReview"}, {"oid": "47e637228d04c6fa8b98ff93ae7564457171f351", "url": "https://github.com/apache/geode/commit/47e637228d04c6fa8b98ff93ae7564457171f351", "message": "Remove superfluous comment", "committedDate": "2020-10-22T20:45:14Z", "type": "commit"}]}