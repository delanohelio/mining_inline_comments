{"pr_number": 5648, "pr_title": "GEODE-5782: Try to improve memory reporting stats for Windows", "pr_createdAt": "2020-10-21T16:52:01Z", "pr_url": "https://github.com/apache/geode/pull/5648", "timeline": [{"oid": "c7669962cfc52cf77cec4c37c73e4723062b446f", "url": "https://github.com/apache/geode/commit/c7669962cfc52cf77cec4c37c73e4723062b446f", "message": "GEODE-8752: Try to improve memory reporting stats for Windows\n\n- This change is specifically to see if things improve on Windows\n\nAuthored-by: Jens Deppe <jdeppe@vmware.com>", "committedDate": "2020-10-21T16:50:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTE0MTkwOQ==", "url": "https://github.com/apache/geode/pull/5648#discussion_r511141909", "bodyText": "I'm really reluctant to add gc() or runFinalization(). Why do you think these will fix flakiness in this test?", "author": "kirklund", "createdAt": "2020-10-23T20:32:12Z", "path": "geode-core/src/integrationTest/java/org/apache/geode/distributed/LauncherMemberMXBeanIntegrationTest.java", "diffHunk": "@@ -227,6 +227,8 @@ public void showJVMMetrics_returnsOJVMMetricsType()\n         if (cdsValue.equals(osMetricValue)) {\n           break;\n         }\n+        System.gc();\n+        System.runFinalization();", "originalCommit": "c7669962cfc52cf77cec4c37c73e4723062b446f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjAwMTMwMw==", "url": "https://github.com/apache/geode/pull/5648#discussion_r512001303", "bodyText": "Yes, I'm probably on the wrong track here. The test flakiness is around reporting memory stats. Since the underlying (volatile) values are retrieved from VMStatsMonitor would it then be better to reduce the stat sampling period so that values are updated more frequently?", "author": "jdeppe-pivotal", "createdAt": "2020-10-26T14:27:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTE0MTkwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjE0OTAxOQ==", "url": "https://github.com/apache/geode/pull/5648#discussion_r512149019", "bodyText": "or can you change the test to be more patient to see an expected value? Do you know how often these values are currently being updated?", "author": "dschneider-pivotal", "createdAt": "2020-10-26T17:39:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTE0MTkwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjM0OTM1Ng==", "url": "https://github.com/apache/geode/pull/5648#discussion_r512349356", "bodyText": "If I understand the code correctly, I believe they are being updated via a StatsMonitor, so I presume no more frequently than statistic-sample-rate. The test could retrieve that setting and try for at least that amount of time.", "author": "jdeppe-pivotal", "createdAt": "2020-10-27T00:39:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTE0MTkwOQ=="}], "type": "inlineReview"}, {"oid": "5886b5cdc3c480a8ea7ef682099bdafe18cde9e3", "url": "https://github.com/apache/geode/commit/5886b5cdc3c480a8ea7ef682099bdafe18cde9e3", "message": "Improve converging methods\n\n- In order to have a better chance to converge on values, reduce the\n  sample rate and await for at most 5 sample periods before failing.\n\nAuthored-by: Jens Deppe <jdeppe@vmware.com>", "committedDate": "2020-11-07T03:36:08Z", "type": "commit"}]}