{"pr_number": 5863, "pr_title": "GEODE-8798: Improve output from export logs command", "pr_createdAt": "2020-12-17T02:03:59Z", "pr_url": "https://github.com/apache/geode/pull/5863", "timeline": [{"oid": "72a49bd785a07b6eeb0eff949afb45f40f071dc9", "url": "https://github.com/apache/geode/commit/72a49bd785a07b6eeb0eff949afb45f40f071dc9", "message": "GEODE-8798: Improve output from export logs command\n\n- Validate the format of the --start-time and --end-time arguments\n- Validate that the --start-time and --end-time arguments can be\ncorrectly parsed\n- Output the values for --start-time and --end-time as used by the\nfunction to allow users to check that they're as expected when specified\n- Update documentation to reflect the new output and better explain the\nbehaviour when the arguments are provided\n\nAuthored-by: Donal Evans <doevans@vmware.com>", "committedDate": "2021-01-05T19:22:42Z", "type": "commit"}, {"oid": "2cc200da0ac53c3082b7d89b7f9b691ed0c83ec6", "url": "https://github.com/apache/geode/commit/2cc200da0ac53c3082b7d89b7f9b691ed0c83ec6", "message": "Address review comments on docs changes\n\nAuthored-by: Donal Evans <doevans@vmware.com>", "committedDate": "2021-01-05T19:22:42Z", "type": "forcePushed"}, {"oid": "47901eeafe9313bcc9fab65f6e0b5afcd441fab3", "url": "https://github.com/apache/geode/commit/47901eeafe9313bcc9fab65f6e0b5afcd441fab3", "message": "Address review comments on docs changes\n\nAuthored-by: Donal Evans <doevans@vmware.com>", "committedDate": "2021-01-05T21:18:57Z", "type": "commit"}, {"oid": "47901eeafe9313bcc9fab65f6e0b5afcd441fab3", "url": "https://github.com/apache/geode/commit/47901eeafe9313bcc9fab65f6e0b5afcd441fab3", "message": "Address review comments on docs changes\n\nAuthored-by: Donal Evans <doevans@vmware.com>", "committedDate": "2021-01-05T21:18:57Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDIzNzE5MQ==", "url": "https://github.com/apache/geode/pull/5863#discussion_r554237191", "bodyText": "Might be a nitpick. Is it possible to append the ParseException error message as well?", "author": "pivotal-eshu", "createdAt": "2021-01-08T22:58:16Z", "path": "geode-gfsh/src/main/java/org/apache/geode/management/internal/cli/commands/ExportLogsInterceptor.java", "diffHunk": "@@ -106,8 +159,78 @@ public ResultModel postExecution(GfshParseResult parseResult, ResultModel comman\n     }\n \n     // if there is no downloaded file. File is saved on the locator/manager.\n-    return ResultModel.createInfo(\n-        \"Logs exported to the connected member's file system: \"\n-            + commandResult.getFileToDownload().toString());\n+    output.append(\"Logs exported to the connected member's file system: \")\n+        .append(commandResult.getFileToDownload().toString());\n+    return ResultModel.createInfo(output.toString());\n+  }\n+\n+  private ResultModel checkStartAndEndFormat(String start, String end) {\n+    StringBuilder formatErrorMessage = new StringBuilder();\n+    boolean formatError = false;\n+    if (start != null && !DATE_AND_TIME_PATTERN.matcher(start).matches()\n+        && !DATE_ONLY_PATTERN.matcher(start).matches()) {\n+      formatErrorMessage.append(EXPORT_LOGS__STARTTIME);\n+      formatError = true;\n+    }\n+\n+    if (end != null && !DATE_AND_TIME_PATTERN.matcher(end).matches()\n+        && !DATE_ONLY_PATTERN.matcher(end).matches()) {\n+      if (formatError) {\n+        formatErrorMessage.append(\" and \");\n+      }\n+      formatErrorMessage.append(EXPORT_LOGS__ENDTIME);\n+      formatError = true;\n+    }\n+\n+    if (formatError) {\n+      formatErrorMessage.append(\" had incorrect format. Valid formats are \")\n+          .append(ONLY_DATE_FORMAT).append(\" and \").append(FORMAT);\n+      return ResultModel.createError(formatErrorMessage.toString());\n+    }\n+    return null;\n+  }\n+\n+  private ResultModel checkStartAndEndParsing(String start, String end) {\n+    StringBuilder parseErrorMessage = new StringBuilder();\n+    boolean parseError = false;\n+\n+    SimpleDateFormat dateAndTimeFormat = new SimpleDateFormat(FORMAT);\n+    SimpleDateFormat dateOnlyFormat = new SimpleDateFormat(ONLY_DATE_FORMAT);\n+    if (start != null) {\n+      try {\n+        // If the input is intended to be parsed as date and time, use the date and time format\n+        if (start.length() > 10) {\n+          dateAndTimeFormat.parse(start);\n+        } else {\n+          dateOnlyFormat.parse(start);\n+        }\n+      } catch (ParseException e) {", "originalCommit": "47901eeafe9313bcc9fab65f6e0b5afcd441fab3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDI0MTEzMg==", "url": "https://github.com/apache/geode/pull/5863#discussion_r554241132", "bodyText": "The error message from the ParseException is simply \"Unparseable date: \" followed by the user input, so it doesn't add any useful information here.", "author": "DonalEvans", "createdAt": "2021-01-08T23:11:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDIzNzE5MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDIzNzQzNg==", "url": "https://github.com/apache/geode/pull/5863#discussion_r554237436", "bodyText": "Same here as well.", "author": "pivotal-eshu", "createdAt": "2021-01-08T22:58:58Z", "path": "geode-gfsh/src/main/java/org/apache/geode/management/internal/cli/commands/ExportLogsInterceptor.java", "diffHunk": "@@ -106,8 +159,78 @@ public ResultModel postExecution(GfshParseResult parseResult, ResultModel comman\n     }\n \n     // if there is no downloaded file. File is saved on the locator/manager.\n-    return ResultModel.createInfo(\n-        \"Logs exported to the connected member's file system: \"\n-            + commandResult.getFileToDownload().toString());\n+    output.append(\"Logs exported to the connected member's file system: \")\n+        .append(commandResult.getFileToDownload().toString());\n+    return ResultModel.createInfo(output.toString());\n+  }\n+\n+  private ResultModel checkStartAndEndFormat(String start, String end) {\n+    StringBuilder formatErrorMessage = new StringBuilder();\n+    boolean formatError = false;\n+    if (start != null && !DATE_AND_TIME_PATTERN.matcher(start).matches()\n+        && !DATE_ONLY_PATTERN.matcher(start).matches()) {\n+      formatErrorMessage.append(EXPORT_LOGS__STARTTIME);\n+      formatError = true;\n+    }\n+\n+    if (end != null && !DATE_AND_TIME_PATTERN.matcher(end).matches()\n+        && !DATE_ONLY_PATTERN.matcher(end).matches()) {\n+      if (formatError) {\n+        formatErrorMessage.append(\" and \");\n+      }\n+      formatErrorMessage.append(EXPORT_LOGS__ENDTIME);\n+      formatError = true;\n+    }\n+\n+    if (formatError) {\n+      formatErrorMessage.append(\" had incorrect format. Valid formats are \")\n+          .append(ONLY_DATE_FORMAT).append(\" and \").append(FORMAT);\n+      return ResultModel.createError(formatErrorMessage.toString());\n+    }\n+    return null;\n+  }\n+\n+  private ResultModel checkStartAndEndParsing(String start, String end) {\n+    StringBuilder parseErrorMessage = new StringBuilder();\n+    boolean parseError = false;\n+\n+    SimpleDateFormat dateAndTimeFormat = new SimpleDateFormat(FORMAT);\n+    SimpleDateFormat dateOnlyFormat = new SimpleDateFormat(ONLY_DATE_FORMAT);\n+    if (start != null) {\n+      try {\n+        // If the input is intended to be parsed as date and time, use the date and time format\n+        if (start.length() > 10) {\n+          dateAndTimeFormat.parse(start);\n+        } else {\n+          dateOnlyFormat.parse(start);\n+        }\n+      } catch (ParseException e) {\n+        parseErrorMessage.append(EXPORT_LOGS__STARTTIME);\n+        parseError = true;\n+      }\n+    }\n+\n+    if (end != null) {\n+      try {\n+        // If the input is intended to be parsed as date and time, use the date and time format\n+        if (end.length() > 10) {\n+          dateAndTimeFormat.parse(end);\n+        } else {\n+          dateOnlyFormat.parse(end);\n+        }\n+      } catch (ParseException e) {", "originalCommit": "47901eeafe9313bcc9fab65f6e0b5afcd441fab3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}