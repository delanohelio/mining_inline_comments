{"pr_number": 5009, "pr_title": "GEODE-8048: change redis sets to use functions and deltas", "pr_createdAt": "2020-04-27T22:49:59Z", "pr_url": "https://github.com/apache/geode/pull/5009", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjU2NTMyOQ==", "url": "https://github.com/apache/geode/pull/5009#discussion_r416565329", "bodyText": "This exception name tells the User what to do, i.e. \"retry\", instead of just stating what happened and letting the user decide how to handle it.\nMaybe just throwing a ConcurrentModificationException, or something like RegionUnexpectedModificationException", "author": "prettyClouds", "createdAt": "2020-04-28T12:18:22Z", "path": "geode-redis/src/main/java/org/apache/geode/redis/internal/executor/set/DeltaSet.java", "diffHunk": "@@ -0,0 +1,261 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional information regarding\n+ * copyright ownership. The ASF licenses this file to You under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance with the License. You may obtain a\n+ * copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License\n+ * is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express\n+ * or implied. See the License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+package org.apache.geode.redis.internal.executor.set;\n+\n+import java.io.DataInput;\n+import java.io.DataOutput;\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.HashSet;\n+import java.util.Set;\n+\n+import org.apache.geode.DataSerializable;\n+import org.apache.geode.DataSerializer;\n+import org.apache.geode.Delta;\n+import org.apache.geode.InvalidDeltaException;\n+import org.apache.geode.cache.Region;\n+import org.apache.geode.redis.internal.ByteArrayWrapper;\n+\n+/**\n+ * TODO: it is probably a bad idea for this class to implement Set.\n+ * We want to be careful how other code interacts with these instances\n+ * to make sure that no modifications are made that are not thread safe\n+ * and that will always be stored in the region.\n+ * Currently the only \"correct\" methods on this class are:\n+ * members, delete, customAddAll, customRemoveAll, and the\n+ * serialization methods.\n+ */\n+public class DeltaSet implements Delta, DataSerializable {\n+\n+  public static long sadd(Region<ByteArrayWrapper, DeltaSet> region,\n+      ByteArrayWrapper key,\n+      ArrayList<ByteArrayWrapper> membersToAdd) {\n+    while (true) {\n+      DeltaSet deltaSet = region.get(key);\n+      if (deltaSet == null) {\n+        // create new set\n+        if (region.putIfAbsent(key, new DeltaSet(membersToAdd)) == null) {\n+          return membersToAdd.size();\n+        } else {\n+          // retry since another thread concurrently changed the region\n+        }\n+      } else {\n+        // update existing value\n+        try {\n+          return deltaSet.saddInstance(membersToAdd, region, key);\n+        } catch (DeltaSet.RetryDueToConcurrentModification ex) {\n+          // retry since another thread concurrently changed the region\n+        }\n+      }\n+    }\n+  }\n+\n+  public static long srem(Region<ByteArrayWrapper, DeltaSet> region,\n+      ByteArrayWrapper key,\n+      ArrayList<ByteArrayWrapper> membersToRemove) {\n+    while (true) {\n+      DeltaSet deltaSet = region.get(key);\n+      if (deltaSet == null) {\n+        return 0L;\n+      }\n+      try {\n+        return deltaSet.sremInstance(membersToRemove, region, key);\n+      } catch (DeltaSet.RetryDueToConcurrentModification ex) {\n+        // retry since another thread concurrently changed the region\n+      }\n+    }\n+  }\n+\n+  public static boolean del(Region<ByteArrayWrapper, DeltaSet> region,\n+      ByteArrayWrapper key) {\n+    while (true) {\n+      DeltaSet deltaSet = region.get(key);\n+      if (deltaSet == null) {\n+        return false;\n+      }\n+      if (deltaSet.delInstance(region, key)) {\n+        return true;\n+      } else {\n+        // retry since another thread concurrently changed the region\n+      }\n+    }\n+  }\n+\n+  public static Set<ByteArrayWrapper> members(Region<ByteArrayWrapper, DeltaSet> region,\n+      ByteArrayWrapper key) {\n+    DeltaSet deltaSet = region.get(key);\n+    if (deltaSet != null) {\n+      return deltaSet.members();\n+    } else {\n+      return Collections.emptySet();\n+    }\n+  }\n+\n+  public synchronized boolean contains(ByteArrayWrapper member) {\n+    return members.contains(member);\n+  }\n+\n+  public synchronized int size() {\n+    return members.size();\n+  }\n+\n+  private HashSet<ByteArrayWrapper> members;\n+  private transient ArrayList<ByteArrayWrapper> deltas;\n+  // true if deltas contains adds; false if removes\n+  private transient boolean deltasAreAdds;\n+\n+  DeltaSet(Collection<ByteArrayWrapper> members) {\n+    if (members instanceof HashSet) {\n+      this.members = (HashSet<ByteArrayWrapper>) members;\n+    } else {\n+      this.members = new HashSet<>(members);\n+    }\n+  }\n+\n+  // for serialization\n+  public DeltaSet() {}\n+\n+\n+  // DELTA\n+  @Override\n+  public boolean hasDelta() {\n+    return deltas != null;\n+  }\n+\n+  @Override\n+  public void toDelta(DataOutput out) throws IOException {\n+    DataSerializer.writeBoolean(deltasAreAdds, out);\n+    DataSerializer.writeArrayList(deltas, out);\n+  }\n+\n+  @Override\n+  public synchronized void fromDelta(DataInput in)\n+      throws IOException, InvalidDeltaException {\n+    boolean deltaAdds = DataSerializer.readBoolean(in);\n+    try {\n+      ArrayList<ByteArrayWrapper> deltas = DataSerializer.readArrayList(in);\n+      if (deltas != null) {\n+        if (deltaAdds) {\n+          members.addAll(deltas);\n+        } else {\n+          members.removeAll(deltas);\n+        }\n+      }\n+    } catch (ClassNotFoundException e) {\n+      throw new RuntimeException(e);\n+    }\n+  }\n+\n+  // DATA SERIALIZABLE\n+\n+  @Override\n+  public void toData(DataOutput out) throws IOException {\n+    DataSerializer.writeHashSet(members, out);\n+  }\n+\n+  @Override\n+  public void fromData(DataInput in) throws IOException, ClassNotFoundException {\n+    members = DataSerializer.readHashSet(in);\n+  }\n+\n+\n+  /**\n+   * @param membersToAdd members to add to this set; NOTE this list may by\n+   *        modified by this call\n+   * @param region the region this instance is stored in\n+   * @param key the name of the set to add to\n+   * @return the number of members actually added\n+   * @throws RetryDueToConcurrentModification if a concurrent modification is detected\n+   */\n+  private synchronized long saddInstance(ArrayList<ByteArrayWrapper> membersToAdd,\n+      Region<ByteArrayWrapper, DeltaSet> region,\n+      ByteArrayWrapper key) {\n+    if (region.get(key) != this) {\n+      throw new RetryDueToConcurrentModification();\n+    }\n+    membersToAdd.removeIf(memberToAdd -> !members.add(memberToAdd));\n+    int membersAdded = membersToAdd.size();\n+    if (membersAdded != 0) {\n+      deltasAreAdds = true;\n+      deltas = membersToAdd;\n+      try {\n+        region.put(key, this);\n+      } finally {\n+        deltas = null;\n+      }\n+    }\n+    return membersAdded;\n+  }\n+\n+  /**\n+   * @param membersToRemove members to remove from this set; NOTE this list may by\n+   *        modified by this call\n+   * @param region the region this instance is stored in\n+   * @param key the name of the set to remove from\n+   * @return the number of members actually removed\n+   * @throws RetryDueToConcurrentModification if a concurrent modification is detected\n+   */\n+  private synchronized long sremInstance(ArrayList<ByteArrayWrapper> membersToRemove,\n+      Region<ByteArrayWrapper, DeltaSet> region,\n+      ByteArrayWrapper key) {\n+    if (region.get(key) != this) {\n+      throw new RetryDueToConcurrentModification();\n+    }\n+    membersToRemove.removeIf(memberToRemove -> !members.remove(memberToRemove));\n+    int membersRemoved = membersToRemove.size();\n+    if (membersRemoved != 0) {\n+      deltasAreAdds = false;\n+      deltas = membersToRemove;\n+      try {\n+        region.put(key, this);\n+      } finally {\n+        deltas = null;\n+      }\n+    }\n+    return membersRemoved;\n+  }\n+\n+  /**\n+   * This exception is thrown if a modification fails because some other\n+   * thread changed what is stored in the region.\n+   */\n+  static class RetryDueToConcurrentModification extends RuntimeException {", "originalCommit": "395bb3a7965a63d0f1941d76d40c85e2e81d7184", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjcxOTg1NQ==", "url": "https://github.com/apache/geode/pull/5009#discussion_r416719855", "bodyText": "Keep in mind this exception is for our internal implementation; not the user. It is possible we could refactor this code so that we don't need to throw on exception to force a retry.", "author": "dschneider-pivotal", "createdAt": "2020-04-28T15:42:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjU2NTMyOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjU3MzAyNw==", "url": "https://github.com/apache/geode/pull/5009#discussion_r416573027", "bodyText": "If we synchronize \"lower\" in the stack, can we avoid the complexity of looping and throwing exceptions. Can we somehow guarantee that on a given key, only one of these operations is happening simultaneously? Maybe an exclusive lock on the key?", "author": "prettyClouds", "createdAt": "2020-04-28T12:30:46Z", "path": "geode-redis/src/main/java/org/apache/geode/redis/internal/executor/set/DeltaSet.java", "diffHunk": "@@ -0,0 +1,261 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional information regarding\n+ * copyright ownership. The ASF licenses this file to You under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance with the License. You may obtain a\n+ * copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License\n+ * is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express\n+ * or implied. See the License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+package org.apache.geode.redis.internal.executor.set;\n+\n+import java.io.DataInput;\n+import java.io.DataOutput;\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.HashSet;\n+import java.util.Set;\n+\n+import org.apache.geode.DataSerializable;\n+import org.apache.geode.DataSerializer;\n+import org.apache.geode.Delta;\n+import org.apache.geode.InvalidDeltaException;\n+import org.apache.geode.cache.Region;\n+import org.apache.geode.redis.internal.ByteArrayWrapper;\n+\n+/**\n+ * TODO: it is probably a bad idea for this class to implement Set.\n+ * We want to be careful how other code interacts with these instances\n+ * to make sure that no modifications are made that are not thread safe\n+ * and that will always be stored in the region.\n+ * Currently the only \"correct\" methods on this class are:\n+ * members, delete, customAddAll, customRemoveAll, and the\n+ * serialization methods.\n+ */\n+public class DeltaSet implements Delta, DataSerializable {\n+\n+  public static long sadd(Region<ByteArrayWrapper, DeltaSet> region,\n+      ByteArrayWrapper key,\n+      ArrayList<ByteArrayWrapper> membersToAdd) {\n+    while (true) {", "originalCommit": "395bb3a7965a63d0f1941d76d40c85e2e81d7184", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjU3ODE0NQ==", "url": "https://github.com/apache/geode/pull/5009#discussion_r416578145", "bodyText": "We could even use some kind of custom read-write lock...sadds should be able to happen in parallel, and srems should be able to happen in parallel exclusive of sadds, and dels just have to be exclusive of everything.", "author": "prettyClouds", "createdAt": "2020-04-28T12:38:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjU3MzAyNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjU3NTUxMg==", "url": "https://github.com/apache/geode/pull/5009#discussion_r416575512", "bodyText": "When we first implemented this a few weeks back, Jens suggested having just one remote function that encapsulated all the Set commands, and the execute could just switch on some parameter.  I don't have a strong feeling either way, but I can't remember Jens' rationale...just wanted to capture the thought here, before it gets lost.", "author": "prettyClouds", "createdAt": "2020-04-28T12:34:42Z", "path": "geode-redis/src/main/java/org/apache/geode/redis/internal/executor/set/SaddFunction.java", "diffHunk": "@@ -0,0 +1,54 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional information regarding\n+ * copyright ownership. The ASF licenses this file to You under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance with the License. You may obtain a\n+ * copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License\n+ * is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express\n+ * or implied. See the License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+package org.apache.geode.redis.internal.executor.set;\n+\n+import java.util.ArrayList;\n+\n+import org.apache.geode.cache.Region;\n+import org.apache.geode.cache.execute.Function;\n+import org.apache.geode.cache.execute.FunctionContext;\n+import org.apache.geode.internal.cache.execute.RegionFunctionContextImpl;\n+import org.apache.geode.redis.internal.ByteArrayWrapper;\n+\n+class SaddFunction implements Function {", "originalCommit": "395bb3a7965a63d0f1941d76d40c85e2e81d7184", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjcxMzMwMg==", "url": "https://github.com/apache/geode/pull/5009#discussion_r416713302", "bodyText": "I like that idea, just to reduce the number of functions", "author": "dschneider-pivotal", "createdAt": "2020-04-28T15:35:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjU3NTUxMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjU3NjM4NQ==", "url": "https://github.com/apache/geode/pull/5009#discussion_r416576385", "bodyText": "How do we get rid of these? Adding a type to the class declaration, like ... implements Function<Object>?", "author": "prettyClouds", "createdAt": "2020-04-28T12:36:04Z", "path": "geode-redis/src/main/java/org/apache/geode/redis/internal/executor/set/SaddFunction.java", "diffHunk": "@@ -0,0 +1,54 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional information regarding\n+ * copyright ownership. The ASF licenses this file to You under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance with the License. You may obtain a\n+ * copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License\n+ * is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express\n+ * or implied. See the License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+package org.apache.geode.redis.internal.executor.set;\n+\n+import java.util.ArrayList;\n+\n+import org.apache.geode.cache.Region;\n+import org.apache.geode.cache.execute.Function;\n+import org.apache.geode.cache.execute.FunctionContext;\n+import org.apache.geode.internal.cache.execute.RegionFunctionContextImpl;\n+import org.apache.geode.redis.internal.ByteArrayWrapper;\n+\n+class SaddFunction implements Function {\n+\n+  public static final String ID = \"SADD_FUNCTION\";\n+\n+  @SuppressWarnings(\"unchecked\")", "originalCommit": "395bb3a7965a63d0f1941d76d40c85e2e81d7184", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "91c96511d6dfd51b4196cf4c8269e17d288dba14", "url": "https://github.com/apache/geode/commit/91c96511d6dfd51b4196cf4c8269e17d288dba14", "message": "fixed some lgtm warnings about casts", "committedDate": "2020-04-28T16:21:22Z", "type": "forcePushed"}, {"oid": "e4e405adb1d9caab6319d987040c0f178e958281", "url": "https://github.com/apache/geode/commit/e4e405adb1d9caab6319d987040c0f178e958281", "message": "DeltaSet now supports the new delete of an empty set when doing srem", "committedDate": "2020-04-29T00:27:11Z", "type": "forcePushed"}, {"oid": "dc618f20badfd0624bab547df3ad6fa275a93449", "url": "https://github.com/apache/geode/commit/dc618f20badfd0624bab547df3ad6fa275a93449", "message": "make sure the redis set functions are registered", "committedDate": "2020-04-29T06:44:35Z", "type": "forcePushed"}, {"oid": "0cfea4050d9316576d9085cda2db88c6012cf056", "url": "https://github.com/apache/geode/commit/0cfea4050d9316576d9085cda2db88c6012cf056", "message": "Deltas", "committedDate": "2020-04-29T22:07:05Z", "type": "commit"}, {"oid": "27170c931e2b5660bb9c765ef207964b04602f8b", "url": "https://github.com/apache/geode/commit/27170c931e2b5660bb9c765ef207964b04602f8b", "message": "don't use copy constructor", "committedDate": "2020-04-29T22:07:05Z", "type": "commit"}, {"oid": "1c966d42fc73e7540a63609b4ba81274246d2b45", "url": "https://github.com/apache/geode/commit/1c966d42fc73e7540a63609b4ba81274246d2b45", "message": "spotless", "committedDate": "2020-04-29T22:07:05Z", "type": "commit"}, {"oid": "6ceec1a75be9a4869ad1f64289d43de2a0f3a6cf", "url": "https://github.com/apache/geode/commit/6ceec1a75be9a4869ad1f64289d43de2a0f3a6cf", "message": "now uses the function when doing sadd", "committedDate": "2020-04-29T22:07:05Z", "type": "commit"}, {"oid": "346b010cf99b035abb1aea048487ab2b161b76a6", "url": "https://github.com/apache/geode/commit/346b010cf99b035abb1aea048487ab2b161b76a6", "message": "fixed race that caused first value in set to be lost\nif two threads concurrently added first value.", "committedDate": "2020-04-29T22:07:05Z", "type": "commit"}, {"oid": "439d37562fc26f951832198e52df4303048232ea", "url": "https://github.com/apache/geode/commit/439d37562fc26f951832198e52df4303048232ea", "message": "disabled noop optimization in customAddAll", "committedDate": "2020-04-29T22:07:05Z", "type": "commit"}, {"oid": "82a8e0b9edc14b7d43a5808ec99631107f2f8b8d", "url": "https://github.com/apache/geode/commit/82a8e0b9edc14b7d43a5808ec99631107f2f8b8d", "message": "added DEBUG logging", "committedDate": "2020-04-29T22:07:05Z", "type": "commit"}, {"oid": "6e39beac094d79923714eeaf1e22b837f0472a51", "url": "https://github.com/apache/geode/commit/6e39beac094d79923714eeaf1e22b837f0472a51", "message": "Revert \"added DEBUG logging\"\n\nThis reverts commit d14ab8f7b1c29cc390ab9f95398e5439f15bb0b7.", "committedDate": "2020-04-29T22:07:05Z", "type": "commit"}, {"oid": "7d853316d896ed5dea0fb0eab4cda98a4223f148", "url": "https://github.com/apache/geode/commit/7d853316d896ed5dea0fb0eab4cda98a4223f148", "message": "Adds function/delta for SREM", "committedDate": "2020-04-29T22:07:05Z", "type": "commit"}, {"oid": "73ba857dc9ccb1c5cb3e92845c0c56ea88a3127e", "url": "https://github.com/apache/geode/commit/73ba857dc9ccb1c5cb3e92845c0c56ea88a3127e", "message": "Adds function implementation and delta for SREM and SMEMBERS", "committedDate": "2020-04-29T22:07:06Z", "type": "commit"}, {"oid": "fc02340056559c4c9317b1ed19afefa2dcb5c1f7", "url": "https://github.com/apache/geode/commit/fc02340056559c4c9317b1ed19afefa2dcb5c1f7", "message": "WIP add Del function delta crap", "committedDate": "2020-04-29T22:07:06Z", "type": "commit"}, {"oid": "30d8acabf7f1fefbb16ac23c12f9fadd22a6823d", "url": "https://github.com/apache/geode/commit/30d8acabf7f1fefbb16ac23c12f9fadd22a6823d", "message": "Fixing synchronization of members", "committedDate": "2020-04-29T22:07:06Z", "type": "commit"}, {"oid": "9b25a3432ddd39c9cf2244b3129ff05092133a14", "url": "https://github.com/apache/geode/commit/9b25a3432ddd39c9cf2244b3129ff05092133a14", "message": "SetIntegrationTest now passes. Before it failed with class cast exceptions", "committedDate": "2020-04-29T22:07:06Z", "type": "commit"}, {"oid": "874ae8349be1b72ce07f356efc9b504afd1742a6", "url": "https://github.com/apache/geode/commit/874ae8349be1b72ce07f356efc9b504afd1742a6", "message": "Add default constructors", "committedDate": "2020-04-29T22:07:06Z", "type": "commit"}, {"oid": "5efd2736150aa27e6c3804111467956d888b038a", "url": "https://github.com/apache/geode/commit/5efd2736150aa27e6c3804111467956d888b038a", "message": "Fix DeltaSet", "committedDate": "2020-04-29T22:07:06Z", "type": "commit"}, {"oid": "37d88582240b54cd1484e59852f653b70fe4ee24", "url": "https://github.com/apache/geode/commit/37d88582240b54cd1484e59852f653b70fe4ee24", "message": "reenabled addAll early out if empty set", "committedDate": "2020-04-29T22:07:06Z", "type": "commit"}, {"oid": "3cac7f7eac6e15ffefdb8c75d483f798230f0053", "url": "https://github.com/apache/geode/commit/3cac7f7eac6e15ffefdb8c75d483f798230f0053", "message": "did some cleanup/refactoring of the DeltaSet code", "committedDate": "2020-04-29T22:07:06Z", "type": "commit"}, {"oid": "c0f26ed998078df823b69592c7dddab541a77575", "url": "https://github.com/apache/geode/commit/c0f26ed998078df823b69592c7dddab541a77575", "message": "added DeltaSet javadocs", "committedDate": "2020-04-29T22:07:06Z", "type": "commit"}, {"oid": "fdffa4412d49a29390ae0cfcdaa6468a612522ee", "url": "https://github.com/apache/geode/commit/fdffa4412d49a29390ae0cfcdaa6468a612522ee", "message": "Fixed a concurrency issue with delete by making it synchronized.\nSimplified the concurrency check in customAddAll and customRemoveAll\nso that the deltas no longer require an ArrayList instance to be\nkept on each DeltaSet instance but instead the passed in ArrayList\nof members can be used to tell geode which members were just added/removed.", "committedDate": "2020-04-29T22:07:06Z", "type": "commit"}, {"oid": "8c28a9a075e5a90e6654ead64eacdb23702b7ae4", "url": "https://github.com/apache/geode/commit/8c28a9a075e5a90e6654ead64eacdb23702b7ae4", "message": "fixed build problems", "committedDate": "2020-04-29T22:07:06Z", "type": "commit"}, {"oid": "ca4516f6aac428973c3a13d79f12bce23e0bd611", "url": "https://github.com/apache/geode/commit/ca4516f6aac428973c3a13d79f12bce23e0bd611", "message": "got rid of GeodeRedisSetSynchronized. Now the function go right to DeltaSet", "committedDate": "2020-04-29T22:07:06Z", "type": "commit"}, {"oid": "1ba4ccbc7538e573aa3c6f9e6e9603185788aed5", "url": "https://github.com/apache/geode/commit/1ba4ccbc7538e573aa3c6f9e6e9603185788aed5", "message": "fixed the region value type to be DeltaSet\ndid a quick impl of all set commands to expect DeltaSet", "committedDate": "2020-04-29T22:07:06Z", "type": "commit"}, {"oid": "e1ca535afca5a4623f683ff68a19c6e103688380", "url": "https://github.com/apache/geode/commit/e1ca535afca5a4623f683ff68a19c6e103688380", "message": "fixed some lgtm warnings about casts", "committedDate": "2020-04-29T22:07:06Z", "type": "commit"}, {"oid": "81d2e8f18121356a6e6fef28a1fc7dba4afc2bb0", "url": "https://github.com/apache/geode/commit/81d2e8f18121356a6e6fef28a1fc7dba4afc2bb0", "message": "fixed spop", "committedDate": "2020-04-29T22:15:56Z", "type": "commit"}, {"oid": "dcaa004573fd4694c2524baf7505bba2fc8bfc35", "url": "https://github.com/apache/geode/commit/dcaa004573fd4694c2524baf7505bba2fc8bfc35", "message": "fixed some serialization problems and got rid of an unneeded exception", "committedDate": "2020-04-29T22:15:57Z", "type": "commit"}, {"oid": "b6c6c0e54cb4d37b62b4e1c2e106b7b1bea95d5a", "url": "https://github.com/apache/geode/commit/b6c6c0e54cb4d37b62b4e1c2e106b7b1bea95d5a", "message": "DeltaSet now supports the new delete of an empty set when doing srem", "committedDate": "2020-04-29T22:15:57Z", "type": "commit"}, {"oid": "83f0cac8aa4bd6f3b3ff9cf96f53c2ac691c45a8", "url": "https://github.com/apache/geode/commit/83f0cac8aa4bd6f3b3ff9cf96f53c2ac691c45a8", "message": "SRemExecutor now compiles", "committedDate": "2020-04-29T22:15:57Z", "type": "commit"}, {"oid": "2009b3cac3872f946ef1bbb1e3bd491fe1638dd7", "url": "https://github.com/apache/geode/commit/2009b3cac3872f946ef1bbb1e3bd491fe1638dd7", "message": "RedisLockService test no longer changes region type to replicate\nsince the set region must now be a partition", "committedDate": "2020-04-29T22:15:57Z", "type": "commit"}, {"oid": "721dcee5a2c1b8e6de7df2f89b282f8649652cb7", "url": "https://github.com/apache/geode/commit/721dcee5a2c1b8e6de7df2f89b282f8649652cb7", "message": "make sure the redis set functions are registered", "committedDate": "2020-04-29T22:15:57Z", "type": "commit"}, {"oid": "21b618b906e4afd2dd6ad4992a2caae921cc90d6", "url": "https://github.com/apache/geode/commit/21b618b906e4afd2dd6ad4992a2caae921cc90d6", "message": "Functions are registered as part of the GeodeRedisServer startup\n\n- This also helps with tests re-running multiple times\n\nAuthored-by: Jens Deppe <jdeppe@vmware.com>", "committedDate": "2020-04-29T22:15:57Z", "type": "commit"}, {"oid": "db5acf018dbbd01fe87a74fd488945c1772a5721", "url": "https://github.com/apache/geode/commit/db5acf018dbbd01fe87a74fd488945c1772a5721", "message": "Revert \"make sure the redis set functions are registered\"\n\nThis reverts commit dc618f20badfd0624bab547df3ad6fa275a93449.", "committedDate": "2020-04-29T22:15:57Z", "type": "commit"}, {"oid": "18735e90bc5ee7959f62360b194d179997c8975e", "url": "https://github.com/apache/geode/commit/18735e90bc5ee7959f62360b194d179997c8975e", "message": "fix imports", "committedDate": "2020-04-29T22:15:57Z", "type": "commit"}, {"oid": "18735e90bc5ee7959f62360b194d179997c8975e", "url": "https://github.com/apache/geode/commit/18735e90bc5ee7959f62360b194d179997c8975e", "message": "fix imports", "committedDate": "2020-04-29T22:15:57Z", "type": "forcePushed"}, {"oid": "ef9b5a6431eef78857501b5f8506b08d6a0fe256", "url": "https://github.com/apache/geode/commit/ef9b5a6431eef78857501b5f8506b08d6a0fe256", "message": "Add various generic type signatures\n\nAuthored-by: Jens Deppe <jdeppe@vmware.com>", "committedDate": "2020-04-30T12:35:49Z", "type": "commit"}]}