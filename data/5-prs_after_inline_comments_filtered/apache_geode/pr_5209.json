{"pr_number": 5209, "pr_title": "GEODE-8211: fix flaky shutdown test", "pr_createdAt": "2020-06-03T19:32:26Z", "pr_url": "https://github.com/apache/geode/pull/5209", "timeline": [{"oid": "d7497dcf4bff10cc920b71136efe66781df0c66f", "url": "https://github.com/apache/geode/commit/d7497dcf4bff10cc920b71136efe66781df0c66f", "message": "GEODE-8211: fix flaky shutdown test", "committedDate": "2020-06-03T19:31:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDgxMTg3NA==", "url": "https://github.com/apache/geode/pull/5209#discussion_r434811874", "bodyText": "Will jedis.shutdown() no longer throw JedisConnectionException? Or if  JedisConnectionException is thrown, we just don't want to catch it?", "author": "jchen21", "createdAt": "2020-06-03T19:43:30Z", "path": "geode-redis/src/integrationTest/java/org/apache/geode/redis/general/ShutdownIntegrationTest.java", "diffHunk": "@@ -61,11 +61,7 @@ public void shutdownIsDisabled_whenOnlySupportedCommandsAreAllowed() {\n \n     // Unfortunately Jedis' shutdown() doesn't seem to throw a JedisDataException when the command\n     // returns an error.\n-    try {\n-      jedis.shutdown();\n-    } catch (JedisConnectionException ignore) {", "originalCommit": "d7497dcf4bff10cc920b71136efe66781df0c66f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDgxNDU3MQ==", "url": "https://github.com/apache/geode/pull/5209#discussion_r434814571", "bodyText": "It was throwing this before, intermittently, because the server was actually shutting down intermittently. The point of the test was for shutdown to be a NOOP. But the flag the test sets to make it a noop did not work because the thread reading the flag is in another thread so it sometimes did not see that the command was unsupported. So now with the \"volatile\" on the boolean, it will always see the change this test makes.", "author": "dschneider-pivotal", "createdAt": "2020-06-03T19:48:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDgxMTg3NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDgxNDg1Mg==", "url": "https://github.com/apache/geode/pull/5209#discussion_r434814852", "bodyText": "Also, this fix was already reviewed on another branch. I just wanted it to be isolated on its own PR instead of being part of another PR.", "author": "dschneider-pivotal", "createdAt": "2020-06-03T19:49:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDgxMTg3NA=="}], "type": "inlineReview"}]}