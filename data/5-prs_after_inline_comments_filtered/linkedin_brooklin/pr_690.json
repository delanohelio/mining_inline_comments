{"pr_number": 690, "pr_title": "Fix zk cleanup test in TestCoordinator.java", "pr_createdAt": "2020-03-10T03:21:44Z", "pr_url": "https://github.com/linkedin/brooklin/pull/690", "timeline": [{"oid": "c31cd4a15cc8dd69b0a653dbe4201de934ea6d65", "url": "https://github.com/linkedin/brooklin/commit/c31cd4a15cc8dd69b0a653dbe4201de934ea6d65", "message": "Merge pull request #1 from linkedin/master\n\nPull latest", "committedDate": "2019-11-18T20:06:44Z", "type": "commit"}, {"oid": "e8437a603918e25035b06af9b156749d8533e156", "url": "https://github.com/linkedin/brooklin/commit/e8437a603918e25035b06af9b156749d8533e156", "message": "Merge branch 'master' of github.com:linkedin/brooklin into fixZkCleanupTest", "committedDate": "2020-03-10T02:14:17Z", "type": "commit"}, {"oid": "91fa76621367c08b749f6418371a7081f4906eb9", "url": "https://github.com/linkedin/brooklin/commit/91fa76621367c08b749f6418371a7081f4906eb9", "message": "Fix TestCoordinator flaky testcase", "committedDate": "2020-03-10T03:19:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDA3NjE0NA==", "url": "https://github.com/linkedin/brooklin/pull/690#discussion_r390076144", "bodyText": "Is there no way to do this using testng instead of adding a junit dependency?", "author": "somandal", "createdAt": "2020-03-10T03:25:46Z", "path": "datastream-server-restli/src/test/java/com/linkedin/datastream/server/TestCoordinator.java", "diffHunk": "@@ -2555,7 +2556,7 @@ public void testCoordinatorLeaderCleanupTasksPostElection() throws Exception {\n     instance1.stop();\n     Assert.assertTrue(PollUtils.poll(() -> instance2.getIsLeader().getAsBoolean(), 100, 30000));\n     verify(spyZkAdapter1, times(0)).cleanUpOrphanConnectorTasks(anyBoolean());\n-    verify(spyZkAdapter2, times(1)).cleanUpOrphanConnectorTasks(anyBoolean());\n+    verify(spyZkAdapter2, timeout(30000).times(1)).cleanUpOrphanConnectorTasks(anyBoolean());", "originalCommit": "91fa76621367c08b749f6418371a7081f4906eb9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDA3NzE5Mw==", "url": "https://github.com/linkedin/brooklin/pull/690#discussion_r390077193", "bodyText": "Updated the comment. Mockito uses junit underneath and is compiled using V4.X. We are getting junit transitively and is pointing to 3.8.1. So, it hits ClassNotFoundError.", "author": "vmaheshw", "createdAt": "2020-03-10T03:30:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDA3NjE0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDA3NzMyMw==", "url": "https://github.com/linkedin/brooklin/pull/690#discussion_r390077323", "bodyText": "got it.", "author": "somandal", "createdAt": "2020-03-10T03:31:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDA3NjE0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDQ2NTMyNA==", "url": "https://github.com/linkedin/brooklin/pull/690#discussion_r390465324", "bodyText": "Quick question. How do we make sure its called within 30 seconds? Also how did we come up with the number 30s? Will this not fail in the future due to timeout?", "author": "vishwajith-s", "createdAt": "2020-03-10T16:56:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDA3NjE0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDQ2NzA1Mw==", "url": "https://github.com/linkedin/brooklin/pull/690#discussion_r390467053", "bodyText": "After becoming leader, coordinator does assignment and then cleanup. Unit-tests are not heavy. So, the operations should finish within 30 sec. 30 sec is used for other operations in the tests as well. For reference, in intellij and gradlew this test finishes within 1 sec.", "author": "vmaheshw", "createdAt": "2020-03-10T16:59:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDA3NjE0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDQ3MzAzOQ==", "url": "https://github.com/linkedin/brooklin/pull/690#discussion_r390473039", "bodyText": "Cool! Interesting. I would prefer if we avoided depending on timeouts in unit tests.  It's fine for now. LGTM.", "author": "vishwajith-s", "createdAt": "2020-03-10T17:08:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDA3NjE0NA=="}], "type": "inlineReview"}, {"oid": "f856e322d4eae5800b55799caf6977166ef2371e", "url": "https://github.com/linkedin/brooklin/commit/f856e322d4eae5800b55799caf6977166ef2371e", "message": "Remove junit dependency", "committedDate": "2020-03-10T19:02:42Z", "type": "commit"}]}