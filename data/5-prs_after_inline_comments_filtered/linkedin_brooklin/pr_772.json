{"pr_number": 772, "pr_title": "Add way to enable per topic latency metrics along with datastream level event producer metrics", "pr_createdAt": "2020-10-21T20:58:43Z", "pr_url": "https://github.com/linkedin/brooklin/pull/772", "timeline": [{"oid": "4e3f2eb1e1ebc981a826594378becc5f52a3e352", "url": "https://github.com/linkedin/brooklin/commit/4e3f2eb1e1ebc981a826594378becc5f52a3e352", "message": "Add way to enable per topic latency metrics along with datastream level event producer metrics", "committedDate": "2020-10-21T20:53:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTc5NzQ1MA==", "url": "https://github.com/linkedin/brooklin/pull/772#discussion_r509797450", "bodyText": "I didn't get this check. Can you please elaborate?", "author": "vishwajith-s", "createdAt": "2020-10-21T23:44:47Z", "path": "datastream-server/src/main/java/com/linkedin/datastream/server/EventProducer.java", "diffHunk": "@@ -304,6 +310,11 @@ private void reportMetrics(DatastreamRecordMetadata metadata, long eventsSourceT\n       _dynamicMetricsManager.createOrUpdateSlidingWindowHistogram(MODULE, _datastreamTask.getConnectorType(),\n           EVENTS_LATENCY_MS_STRING, LATENCY_SLIDING_WINDOW_LENGTH_MS, sourceToDestinationLatencyMs);\n \n+      if (_enablePerTopicEventLatencyMetrics && !_enablePerTopicMetrics) {", "originalCommit": "4e3f2eb1e1ebc981a826594378becc5f52a3e352", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTc5ODI4Nw==", "url": "https://github.com/linkedin/brooklin/pull/772#discussion_r509798287", "bodyText": "If someone enables per topic metrics for all metrics via the _enablePerTopicMetrics, then I don't want to double count, since the topicOrDatastreamName will point to the topic name already. Would you like me to add a comment?", "author": "somandal", "createdAt": "2020-10-21T23:47:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTc5NzQ1MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTc5OTI3Ng==", "url": "https://github.com/linkedin/brooklin/pull/772#discussion_r509799276", "bodyText": "Please add a comment. It's not obvious. Thanks for the explanation", "author": "vishwajith-s", "createdAt": "2020-10-21T23:50:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTc5NzQ1MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTgwMTE4MQ==", "url": "https://github.com/linkedin/brooklin/pull/772#discussion_r509801181", "bodyText": "done", "author": "somandal", "createdAt": "2020-10-21T23:57:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTc5NzQ1MA=="}], "type": "inlineReview"}, {"oid": "8829b2e742254247c52051c4226be7d9666a2ca5", "url": "https://github.com/linkedin/brooklin/commit/8829b2e742254247c52051c4226be7d9666a2ca5", "message": "Address review comments", "committedDate": "2020-10-21T23:56:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTgwMTcwMw==", "url": "https://github.com/linkedin/brooklin/pull/772#discussion_r509801703", "bodyText": "if this was written as:\n_enablePerTopicEventLatencyMetrics =         Boolean.parseBoolean(config.getProperty(CONFIG_ENABLE_PER_TOPIC_EVENT_LATENCY_METRICS,\n            String.valueOf(_enablePerTopicMetrics)));``` \nyou possibly won't need to check the 2 values below and can just check  if `_enablePerTopicEventLatencyMetrics` is true?", "author": "DEEPTHIKORAT", "createdAt": "2020-10-21T23:58:52Z", "path": "datastream-server/src/main/java/com/linkedin/datastream/server/EventProducer.java", "diffHunk": "@@ -159,6 +161,10 @@ public EventProducer(DatastreamTask task, TransportProvider transportProvider, C\n     _enablePerTopicMetrics =\n         Boolean.parseBoolean(config.getProperty(CONFIG_ENABLE_PER_TOPIC_METRICS, Boolean.TRUE.toString()));\n \n+    _enablePerTopicEventLatencyMetrics =", "originalCommit": "4e3f2eb1e1ebc981a826594378becc5f52a3e352", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTgwMzI4OQ==", "url": "https://github.com/linkedin/brooklin/pull/772#discussion_r509803289", "bodyText": "Not sure I fully follow. If I set the default to String.valueOf(_enablePerTopicMetrics)) then I'm essentially picking up it's value (true or false), right? Which means if enablePerTopicMetrics is true and enablePerTopicEventLatencyMetrics isn't set, then enablePerTopicEventLatencyMetrics will become true too and i'll land up double counting later, right?", "author": "somandal", "createdAt": "2020-10-22T00:04:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTgwMTcwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTgwNDY0MQ==", "url": "https://github.com/linkedin/brooklin/pull/772#discussion_r509804641", "bodyText": "Ah, you are right. I misunderstood the code.", "author": "DEEPTHIKORAT", "createdAt": "2020-10-22T00:07:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTgwMTcwMw=="}], "type": "inlineReview"}]}