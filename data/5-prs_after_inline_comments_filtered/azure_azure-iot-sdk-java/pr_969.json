{"pr_number": 969, "pr_title": "refactor(samples): Minor improvements to samples", "pr_createdAt": "2020-10-13T21:02:00Z", "pr_url": "https://github.com/Azure/azure-iot-sdk-java/pull/969", "timeline": [{"oid": "e1b992f1ecaf87dbd29e92082641d07c9f65a2ab", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/e1b992f1ecaf87dbd29e92082641d07c9f65a2ab", "message": "Minor improvements to samples", "committedDate": "2020-10-13T21:01:38Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI1NjQ5NQ==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/969#discussion_r504256495", "bodyText": "DISABLED is not used", "author": "vinagesh", "createdAt": "2020-10-13T21:02:20Z", "path": "device/iot-device-samples/device-twin-sample/src/main/java/samples/com/microsoft/azure/sdk/iot/DeviceTwinSample.java", "diffHunk": "@@ -18,7 +18,7 @@\n  */\n public class DeviceTwinSample\n {\n-    private enum LIGHTS{ ON, OFF, DISABLED }\n+    private enum LIGHTS{ ON, OFF }", "originalCommit": "e1b992f1ecaf87dbd29e92082641d07c9f65a2ab", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI1NjYzMg==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/969#discussion_r504256632", "bodyText": "https is not supported", "author": "vinagesh", "createdAt": "2020-10-13T21:02:38Z", "path": "device/iot-device-samples/module-method-sample/src/main/java/samples/com/microsoft/azure/sdk/iot/ModuleMethodSample.java", "diffHunk": "@@ -23,12 +23,8 @@\n             + \"2. (mqtt | amqps | amqps_ws | mqtt_ws)\\n\";\n \n     private static String SAMPLE_USAGE_WITH_WRONG_ARGS = \"Expected 2 or 3 arguments but received: %d.\\n\" + SAMPLE_USAGE;\n-    private static String SAMPLE_USAGE_WITH_INVALID_PROTOCOL = \"Expected argument 2 to be one of 'mqtt', 'https', 'amqps' or 'amqps_ws' but received %s\\n\" + SAMPLE_USAGE;\n-\n-    private static IotHubClientProtocol protocol = IotHubClientProtocol.MQTT;\n+    private static String SAMPLE_USAGE_WITH_INVALID_PROTOCOL = \"Expected argument 2 to be one of 'mqtt', 'amqps' or 'amqps_ws' but received %s\\n\" + SAMPLE_USAGE;", "originalCommit": "e1b992f1ecaf87dbd29e92082641d07c9f65a2ab", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI2NTY1OQ==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/969#discussion_r504265659", "bodyText": "what about mqtt_ws?", "author": "abhipsaMisra", "createdAt": "2020-10-13T21:21:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI1NjYzMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI2OTQ4MQ==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/969#discussion_r504269481", "bodyText": "That does not exist in the list so I did not test it. Do we support that? amqps_ws is supported though.", "author": "vinagesh", "createdAt": "2020-10-13T21:29:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI1NjYzMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI3MjQ1OA==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/969#discussion_r504272458", "bodyText": "Afaik methods should be supported over both tcp and ws, for mqtt (usually the feature is supported over both protocols, with proxy being the only feature/capability that is restricted to ws).\nWhich list doesn't mention mqtt_ws? Does it include a comment about the omission maybe?", "author": "abhipsaMisra", "createdAt": "2020-10-13T21:35:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI1NjYzMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI3MzYxNw==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/969#discussion_r504273617", "bodyText": "Line 26 is what I went by for testing assuming whoever wrote the test had the full list.", "author": "vinagesh", "createdAt": "2020-10-13T21:38:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI1NjYzMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI3NTIxNw==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/969#discussion_r504275217", "bodyText": "It is possible that the sample is just now showing usage of mqtt_ws. We can add it in a subsequent PR to all samples where it is relevant.", "author": "vinagesh", "createdAt": "2020-10-13T21:41:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI1NjYzMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI1NjcwNg==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/969#discussion_r504256706", "bodyText": "not used", "author": "vinagesh", "createdAt": "2020-10-13T21:02:46Z", "path": "device/iot-device-samples/module-method-sample/src/main/java/samples/com/microsoft/azure/sdk/iot/ModuleMethodSample.java", "diffHunk": "@@ -23,12 +23,8 @@\n             + \"2. (mqtt | amqps | amqps_ws | mqtt_ws)\\n\";\n \n     private static String SAMPLE_USAGE_WITH_WRONG_ARGS = \"Expected 2 or 3 arguments but received: %d.\\n\" + SAMPLE_USAGE;\n-    private static String SAMPLE_USAGE_WITH_INVALID_PROTOCOL = \"Expected argument 2 to be one of 'mqtt', 'https', 'amqps' or 'amqps_ws' but received %s\\n\" + SAMPLE_USAGE;\n-\n-    private static IotHubClientProtocol protocol = IotHubClientProtocol.MQTT;", "originalCommit": "e1b992f1ecaf87dbd29e92082641d07c9f65a2ab", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI1Njc1OA==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/969#discussion_r504256758", "bodyText": "not used", "author": "vinagesh", "createdAt": "2020-10-13T21:02:52Z", "path": "device/iot-device-samples/module-twin-sample/src/main/java/samples/com/microsoft/azure/sdk/iot/ModuleTwinSample.java", "diffHunk": "@@ -24,9 +24,9 @@\n             + \"2. (mqtt | amqps | amqps_ws | mqtt_ws)\\n\";\n \n     private static String SAMPLE_USAGE_WITH_WRONG_ARGS = \"Expected 2 or 3 arguments but received: %d.\\n\" + SAMPLE_USAGE;\n-    private static String SAMPLE_USAGE_WITH_INVALID_PROTOCOL = \"Expected argument 2 to be one of 'mqtt', 'https', 'amqps' or 'amqps_ws' but received %s\\n\" + SAMPLE_USAGE;\n+    private static String SAMPLE_USAGE_WITH_INVALID_PROTOCOL = \"Expected argument 2 to be one of 'mqtt', 'amqps' or 'amqps_ws' but received %s\\n\" + SAMPLE_USAGE;\n \n-    private enum LIGHTS{ ON, OFF, DISABLED }\n+    private enum LIGHTS{ ON, OFF }", "originalCommit": "e1b992f1ecaf87dbd29e92082641d07c9f65a2ab", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI1NjgxNg==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/969#discussion_r504256816", "bodyText": "https is not supported", "author": "vinagesh", "createdAt": "2020-10-13T21:02:59Z", "path": "device/iot-device-samples/module-twin-sample/src/main/java/samples/com/microsoft/azure/sdk/iot/ModuleTwinSample.java", "diffHunk": "@@ -24,9 +24,9 @@\n             + \"2. (mqtt | amqps | amqps_ws | mqtt_ws)\\n\";\n \n     private static String SAMPLE_USAGE_WITH_WRONG_ARGS = \"Expected 2 or 3 arguments but received: %d.\\n\" + SAMPLE_USAGE;\n-    private static String SAMPLE_USAGE_WITH_INVALID_PROTOCOL = \"Expected argument 2 to be one of 'mqtt', 'https', 'amqps' or 'amqps_ws' but received %s\\n\" + SAMPLE_USAGE;\n+    private static String SAMPLE_USAGE_WITH_INVALID_PROTOCOL = \"Expected argument 2 to be one of 'mqtt', 'amqps' or 'amqps_ws' but received %s\\n\" + SAMPLE_USAGE;", "originalCommit": "e1b992f1ecaf87dbd29e92082641d07c9f65a2ab", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI1Njk1NQ==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/969#discussion_r504256955", "bodyText": "We should not accidentally check in these values so changed to using env variables", "author": "vinagesh", "createdAt": "2020-10-13T21:03:20Z", "path": "service/iot-service-samples/device-twin-sample/src/main/java/samples/com/microsoft/azure/sdk/iot/DeviceTwinSample.java", "diffHunk": "@@ -16,8 +16,8 @@\n /** Manages device twin operations on IotHub */\n public class DeviceTwinSample\n {\n-    public static final String iotHubConnectionString = \"[IOT HUB Connection String]\";\n-    public static final String deviceId = \"[Device ID]\";\n+    private static final String iotHubConnectionString  = System.getenv(\"IOTHUB_CONNECTION_STRING\");", "originalCommit": "e1b992f1ecaf87dbd29e92082641d07c9f65a2ab", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI1NzAzMQ==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/969#discussion_r504257031", "bodyText": "Sample does not work without this", "author": "vinagesh", "createdAt": "2020-10-13T21:03:30Z", "path": "service/iot-service-samples/device-twin-sample/src/main/java/samples/com/microsoft/azure/sdk/iot/DeviceTwinSample.java", "diffHunk": "@@ -121,6 +121,8 @@ private static void scheduleUpdateDesiredProperties(DeviceTwin twinClient, Devic\n         desiredProperties.add(new Pair(\"temp\", new Random().nextInt(TEMPERATURE_RANGE)));\n         desiredProperties.add(new Pair(\"hum\", new Random().nextInt(HUMIDITY_RANGE)));\n         device.setDesiredProperties(desiredProperties);\n+        // ScheduleUpdateTwin job type is a force update, which only accepts '*' as the Etag\n+        device.setETag(\"*\");", "originalCommit": "e1b992f1ecaf87dbd29e92082641d07c9f65a2ab", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI2OTI5Mg==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/969#discussion_r504269292", "bodyText": "good to know! :)", "author": "abhipsaMisra", "createdAt": "2020-10-13T21:28:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI1NzAzMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI2MTk3NQ==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/969#discussion_r504261975", "bodyText": "Is this correct though? I see schedule update call next to this line", "author": "bikamani", "createdAt": "2020-10-13T21:13:41Z", "path": "service/iot-service-samples/device-twin-sample/src/main/java/samples/com/microsoft/azure/sdk/iot/DeviceTwinSample.java", "diffHunk": "@@ -152,14 +154,16 @@ private static void cancelJob(DeviceTwin twinClient, DeviceTwinDevice device) th\n         desiredProperties.add(new Pair(\"temp\", new Random().nextInt(TEMPERATURE_RANGE)));\n         desiredProperties.add(new Pair(\"hum\", new Random().nextInt(HUMIDITY_RANGE)));\n         device.setDesiredProperties(desiredProperties);\n+        // ScheduleUpdateTwin job type is a force update, which only accepts '*' as the Etag\n+        device.setETag(\"*\");\n \n         // date when the update shall be executed\n         Date updateDateInFuture = new Date(new Date().getTime() + ADD_10_MINUTES_IN_MILLISECONDS); // 10 minutes in the future.\n \n         // query condition that defines the list of device to be updated\n         String queryCondition = \"DeviceId IN ['\" + deviceId + \"']\";\n \n-        System.out.println(\"Schedule updating Device twin (new temp, hum) in 10 minutes\");\n+        System.out.println(\"Cancel updating Device twin (new temp, hum) in 10 minutes\");", "originalCommit": "e1b992f1ecaf87dbd29e92082641d07c9f65a2ab", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI2ODIxMw==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/969#discussion_r504268213", "bodyText": "It is the same method but our sample is using it to cancel. First time we use it to schedule and second time to cancel. Our logs should indicate that and not that we are calling the same function.", "author": "vinagesh", "createdAt": "2020-10-13T21:26:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI2MTk3NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI2Nzg0MQ==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/969#discussion_r504267841", "bodyText": "I didn't get this point - does this refer to the sequence of sending message from service and then setting callback on the device?", "author": "abhipsaMisra", "createdAt": "2020-10-13T21:25:48Z", "path": "device/iot-device-samples/handle-messages/src/main/java/samples/com/microsoft/azure/sdk/iot/HandleMessages.java", "diffHunk": "@@ -223,7 +223,7 @@ else if (protocolStr.equals(\"mqtt_ws\"))\n \n         System.out.println(\"Opened connection to IoT Hub.\");\n \n-        System.out.println(\"Beginning to receive messages...\");\n+        System.out.println(\"Beginning to receive messages(only for MQTT and AMQP). To receive in Https, send message and then start the sample...\");", "originalCommit": "e1b992f1ecaf87dbd29e92082641d07c9f65a2ab", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI2ODg5NQ==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/969#discussion_r504268895", "bodyText": "yes. For MQTT and AMQP, you can run the device sample and then send messages from the portal or wherever you want. However for https, it is not really polling. You need to send the message and then execute receive. If you run this sample and send a message and wait for the message to show up, it will not show up.", "author": "vinagesh", "createdAt": "2020-10-13T21:28:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI2Nzg0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI3MDk0Mw==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/969#discussion_r504270943", "bodyText": "That is interesting!", "author": "abhipsaMisra", "createdAt": "2020-10-13T21:32:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI2Nzg0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI3MzM2MA==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/969#discussion_r504273360", "bodyText": "If you think it is a bug, we should discuss.", "author": "vinagesh", "createdAt": "2020-10-13T21:37:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI2Nzg0MQ=="}], "type": "inlineReview"}]}