{"pr_number": 918, "pr_title": "feat(digitaltwin): Digitaltwin(pnp) API implementation", "pr_createdAt": "2020-09-17T18:30:51Z", "pr_url": "https://github.com/Azure/azure-iot-sdk-java/pull/918", "timeline": [{"oid": "d84583a2a9ef2062d43e7793d7a0d5752e16cdf1", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/d84583a2a9ef2062d43e7793d7a0d5752e16cdf1", "message": "Adding comments", "committedDate": "2020-09-17T22:23:51Z", "type": "forcePushed"}, {"oid": "34c13afe0da4ad4e424afbd6f5d99b1bbd7b1f68", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/34c13afe0da4ad4e424afbd6f5d99b1bbd7b1f68", "message": "Device client api version update", "committedDate": "2020-09-23T02:18:07Z", "type": "forcePushed"}, {"oid": "c8215443b179deca8a2525cb13ff694452d59a18", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/c8215443b179deca8a2525cb13ff694452d59a18", "message": "Updated readme", "committedDate": "2020-09-23T02:18:48Z", "type": "forcePushed"}, {"oid": "fd8f3494a6c2ae1c0dd7f35b3d76cab151c6df12", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/fd8f3494a6c2ae1c0dd7f35b3d76cab151c6df12", "message": "thermostat sample", "committedDate": "2020-09-23T02:19:17Z", "type": "forcePushed"}, {"oid": "7dce9d7a2b9dffc80e7e2584cb8ccc78831d18c2", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/7dce9d7a2b9dffc80e7e2584cb8ccc78831d18c2", "message": " update add operations in sample", "committedDate": "2020-09-23T02:19:45Z", "type": "forcePushed"}, {"oid": "d577d8214d0048d41bba9a4dd4ed5ca7a27adae4", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/d577d8214d0048d41bba9a4dd4ed5ca7a27adae4", "message": "Update sample", "committedDate": "2020-09-23T02:22:27Z", "type": "forcePushed"}, {"oid": "b48dc78b90f2684ec5a3f3d5658b7df6b99b4c0a", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/b48dc78b90f2684ec5a3f3d5658b7df6b99b4c0a", "message": "get with response deserialization", "committedDate": "2020-09-23T02:23:44Z", "type": "forcePushed"}, {"oid": "3e7db95f061df7b5287913dd21d839c53711d139", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/3e7db95f061df7b5287913dd21d839c53711d139", "message": "merge fixes", "committedDate": "2020-09-23T02:24:07Z", "type": "forcePushed"}, {"oid": "89bd8ee689458431662b47b6733fb8b7ea2f40e0", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/89bd8ee689458431662b47b6733fb8b7ea2f40e0", "message": "feat(digitaltwin): Generated protocol layer and added API implementation", "committedDate": "2020-09-23T02:30:13Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzE2MTA2Mw==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r493161063", "bodyText": "Device client should now call the latest GA version for pnp flow only", "author": "vinagesh", "createdAt": "2020-09-23T02:31:36Z", "path": "device/iot-device-client/src/main/java/com/microsoft/azure/sdk/iot/device/transport/TransportUtils.java", "diffHunk": "@@ -10,7 +10,7 @@\n     public static String IOTHUB_API_VERSION = \"2019-10-01\";\n \n     // The preview API version support has been added to enable support for PnP features. This will be removed once the service goes GA.\n-    public static String IOTHUB_API_VERSION_PREVIEW = \"2020-05-31-preview\";\n+    public static String IOTHUB_API_VERSION_PREVIEW = \"2020-09-30\";", "originalCommit": "89bd8ee689458431662b47b6733fb8b7ea2f40e0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzE2MTIzNA==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r493161234", "bodyText": "Still a TODO", "author": "vinagesh", "createdAt": "2020-09-23T02:32:12Z", "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/digitaltwin/DigitalTwinServiceClientTests.java", "diffHunk": "@@ -0,0 +1,38 @@\n+package tests.integration.com.microsoft.azure.sdk.iot.digitaltwin;", "originalCommit": "89bd8ee689458431662b47b6733fb8b7ea2f40e0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzE2MTgxMA==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r493161810", "bodyText": "Adding missing params so that javadocs does no fail on build", "author": "vinagesh", "createdAt": "2020-09-23T02:34:19Z", "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/ServiceClient.java", "diffHunk": "@@ -89,6 +89,7 @@ protected ServiceClient(IotHubConnectionString iotHubConnectionString, IotHubSer\n      *\n      * @param iotHubConnectionString The ConnectionString object for the IotHub\n      * @param iotHubServiceClientProtocol protocol to use\n+     * @param options options for proxy", "originalCommit": "89bd8ee689458431662b47b6733fb8b7ea2f40e0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzE2MTk1MA==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r493161950", "bodyText": "This is the implementation of pnp APIs and the most important part of the PR.", "author": "vinagesh", "createdAt": "2020-09-23T02:34:48Z", "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/digitaltwin/DigitalTwinAsyncClient.java", "diffHunk": "@@ -0,0 +1,216 @@\n+package com.microsoft.azure.sdk.iot.service.digitaltwin;\n+\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.authentication.SasTokenProvider;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.authentication.ServiceClientCredentialsProvider;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.authentication.ServiceConnectionString;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.authentication.ServiceConnectionStringParser;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.implementation.DigitalTwinsImpl;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.implementation.IotHubGatewayServiceAPIsImpl;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.DigitalTwins;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.models.DigitalTwinGetDigitalTwinHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.models.DigitalTwinInvokeRootLevelCommandHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.models.DigitalTwinUpdateDigitalTwinHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.helpers.DeserializationHelpers;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.helpers.UpdateOperationUtility;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.models.CommandRequestOptions;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.models.UpdateRequestOptions;\n+import com.microsoft.rest.*;\n+import com.microsoft.rest.serializer.JacksonAdapter;\n+import lombok.Builder;\n+import lombok.NonNull;\n+import lombok.Setter;\n+import rx.Observable;\n+import rx.functions.Func1;\n+import rx.schedulers.Schedulers;\n+\n+import java.util.List;\n+import java.util.Objects;\n+\n+import static lombok.AccessLevel.PACKAGE;", "originalCommit": "89bd8ee689458431662b47b6733fb8b7ea2f40e0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "334a9b0117e9f00c22d116cb3e8933be2f3fa364", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/334a9b0117e9f00c22d116cb3e8933be2f3fa364", "message": "feat(digitaltwin): Generated protocol layer and added API implementation", "committedDate": "2020-09-23T02:37:38Z", "type": "forcePushed"}, {"oid": "ccc471cc92922100c44f61d0c2151e37cd4a6856", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/ccc471cc92922100c44f61d0c2151e37cd4a6856", "message": "feat(digitaltwin): Generated protocol layer and added API implementation", "committedDate": "2020-09-23T02:38:15Z", "type": "forcePushed"}, {"oid": "00f6ca4c195800cefc3e30de3da0f695a3a63755", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/00f6ca4c195800cefc3e30de3da0f695a3a63755", "message": "feat(digitaltwin): Generated protocol layer and added API implementation", "committedDate": "2020-09-23T02:40:10Z", "type": "forcePushed"}, {"oid": "326d538b651e5285f1c86ee9f1b6d684a81c6270", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/326d538b651e5285f1c86ee9f1b6d684a81c6270", "message": "feat(digitaltwin): Generated protocol layer and added API implementation", "committedDate": "2020-09-23T02:41:12Z", "type": "forcePushed"}, {"oid": "baf96db9e8e1bef11216c61b28114df8bcfc1ba7", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/baf96db9e8e1bef11216c61b28114df8bcfc1ba7", "message": "feat(digitaltwin): Generated protocol layer and added API implementation", "committedDate": "2020-09-23T02:44:54Z", "type": "forcePushed"}, {"oid": "601e84926fbe0cb01a6e35d1e29cdd8208222e26", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/601e84926fbe0cb01a6e35d1e29cdd8208222e26", "message": "feat(digitaltwin): Generated protocol layer and added API implementation", "committedDate": "2020-09-23T02:50:09Z", "type": "forcePushed"}, {"oid": "e2ce9cabf2c885f89917d42a64c97d8f1aa3867e", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/e2ce9cabf2c885f89917d42a64c97d8f1aa3867e", "message": "feat(digitaltwin): Generated protocol layer and added API implementation", "committedDate": "2020-09-23T02:57:16Z", "type": "forcePushed"}, {"oid": "b0154d26c334d12aecd22e9c2b6be2421daecdc9", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/b0154d26c334d12aecd22e9c2b6be2421daecdc9", "message": "feat(digitaltwin): Generated protocol layer and added API implementation", "committedDate": "2020-09-23T03:04:56Z", "type": "forcePushed"}, {"oid": "b226557f6ab016cea3de9aacf728bd4f18b5504d", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/b226557f6ab016cea3de9aacf728bd4f18b5504d", "message": "feat(digitaltwin): Generated protocol layer and added API implementation", "committedDate": "2020-09-23T03:08:27Z", "type": "forcePushed"}, {"oid": "b2b4009bd8d1896a2d331e95f7b0da2c1475e28d", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/b2b4009bd8d1896a2d331e95f7b0da2c1475e28d", "message": "feat(digitaltwin): Generated protocol layer and added API implementation", "committedDate": "2020-09-23T03:10:26Z", "type": "forcePushed"}, {"oid": "c420d02b5240cade598091620d611caa2fb21ea5", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/c420d02b5240cade598091620d611caa2fb21ea5", "message": "feat(digitaltwin): Generated protocol layer and added API implementation", "committedDate": "2020-09-23T04:14:54Z", "type": "forcePushed"}, {"oid": "59484cb60a1f362b7fd08793f849bb55fb3e9cbd", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/59484cb60a1f362b7fd08793f849bb55fb3e9cbd", "message": "feat(digitaltwin): Generated protocol layer and added API implementation", "committedDate": "2020-09-23T05:41:42Z", "type": "forcePushed"}, {"oid": "ded2e10531cc6fac8cf9d35dcf921daebc678891", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/ded2e10531cc6fac8cf9d35dcf921daebc678891", "message": "feat(digitaltwin): Generated protocol layer and added API implementation", "committedDate": "2020-09-23T05:45:50Z", "type": "forcePushed"}, {"oid": "fc8e3b4cfcd3f084448b650363918ab6d94bf81c", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/fc8e3b4cfcd3f084448b650363918ab6d94bf81c", "message": "feat(digitaltwin): Generated protocol layer and added API implementation", "committedDate": "2020-09-23T16:47:51Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzkzMDEzMw==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r493930133", "bodyText": "copyright", "author": "abhipsaMisra", "createdAt": "2020-09-23T22:27:16Z", "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/digitaltwin/DigitalTwinAsyncClient.java", "diffHunk": "@@ -0,0 +1,218 @@\n+package com.microsoft.azure.sdk.iot.service.digitaltwin;", "originalCommit": "d0cb7b0f6f8553609be356ce554b4421952a248d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzkzMTA3NA==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r493931074", "bodyText": "needs to return Observable<DigitalTwinCommandResponse>", "author": "abhipsaMisra", "createdAt": "2020-09-23T22:30:07Z", "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/digitaltwin/DigitalTwinAsyncClient.java", "diffHunk": "@@ -0,0 +1,218 @@\n+package com.microsoft.azure.sdk.iot.service.digitaltwin;\n+\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.authentication.SasTokenProvider;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.authentication.ServiceClientCredentialsProvider;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.authentication.ServiceConnectionString;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.authentication.ServiceConnectionStringParser;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.implementation.DigitalTwinsImpl;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.implementation.IotHubGatewayServiceAPIsImpl;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.DigitalTwins;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.models.DigitalTwinGetHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.models.DigitalTwinInvokeRootLevelCommandHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.models.DigitalTwinUpdateHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.helpers.DeserializationHelpers;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.helpers.UpdateOperationUtility;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.models.DigitalTwinCommandResponse;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.models.DigitalTwinInvokeCommandHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.models.DigitalTwinInvokeCommandRequestOptions;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.models.DigitalTwinUpdateRequestOptions;\n+import com.microsoft.rest.*;\n+import com.microsoft.rest.serializer.JacksonAdapter;\n+import lombok.Builder;\n+import lombok.NonNull;\n+import lombok.Setter;\n+import rx.Observable;\n+import rx.schedulers.Schedulers;\n+\n+import java.util.List;\n+import java.util.Objects;\n+\n+import static com.microsoft.azure.sdk.iot.service.digitaltwin.helpers.Tools.*;\n+import static lombok.AccessLevel.PACKAGE;\n+\n+public class DigitalTwinAsyncClient {\n+    @Setter(PACKAGE)\n+    private DigitalTwinsImpl digitalTwin;\n+    private static ObjectMapper objectMapper = new ObjectMapper();\n+\n+    /***\n+     * Creates an implementation instance of {@link DigitalTwins} that is used to invoke the Digital Twin features\n+     * @param connectionString The IoTHub connection string\n+     */\n+    @Builder(builderMethodName = \"buildFromConnectionString\", builderClassName = \"FromConnectionStringBuilder\")\n+    public DigitalTwinAsyncClient(@NonNull String connectionString) {\n+        ServiceConnectionString serviceConnectionString = ServiceConnectionStringParser.parseConnectionString(connectionString);\n+        SasTokenProvider sasTokenProvider = serviceConnectionString.createSasTokenProvider();\n+        String httpsEndpoint = serviceConnectionString.getHttpsEndpoint();\n+\n+        init(sasTokenProvider, httpsEndpoint);\n+    }\n+\n+    private void init(SasTokenProvider sasTokenProvider, String httpsEndpoint) {\n+        RestClient simpleRestClient = new RestClient.Builder()\n+                .withBaseUrl(httpsEndpoint)\n+                .withCredentials(new ServiceClientCredentialsProvider(sasTokenProvider))\n+                .withResponseBuilderFactory(new ServiceResponseBuilder.Factory())\n+                .withSerializerAdapter(new JacksonAdapter())\n+                .build();\n+\n+        IotHubGatewayServiceAPIsImpl protocolLayerClient = new IotHubGatewayServiceAPIsImpl(simpleRestClient);\n+        digitalTwin = new DigitalTwinsImpl(simpleRestClient.retrofit(), protocolLayerClient);\n+    }\n+\n+    /**\n+     * Gets a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param clazz The class to deserialize the application/json into.\n+     * @param <T> The generic type to deserialize the application/json into.\n+     * @return The application/json of the digital twin.\n+     */\n+    public <T> Observable<T> getDigitalTwin (@NonNull String digitalTwinId, Class<T> clazz)\n+    {\n+        return digitalTwin.getDigitalTwinAsync(digitalTwinId)\n+                .filter(Objects::nonNull)\n+                .map(response -> {\n+                    T genericResponse = null;\n+                    try {\n+                        genericResponse = DeserializationHelpers.castObject(objectMapper, response, clazz);\n+                    } catch (JsonProcessingException e) {\n+                        Observable.error(e);\n+                    }\n+                    return genericResponse;\n+                })\n+                .subscribeOn(Schedulers.io());\n+    }\n+\n+    /**\n+     * Gets a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param clazz The class to deserialize the application/json into.\n+     * @param <T> The generic type to deserialize the application/json into.\n+     * @return A {@link ServiceResponseWithHeaders} representing deserialized application/json of the digital twin with {@link DigitalTwinGetHeaders}.\n+     */\n+    public <T> Observable<ServiceResponseWithHeaders<T, DigitalTwinGetHeaders>> getDigitalTwinWithResponse (@NonNull String digitalTwinId, Class<T> clazz)\n+    {\n+        return digitalTwin.getDigitalTwinWithServiceResponseAsync(digitalTwinId)\n+                .map(response -> {\n+                    T genericResponse = null;\n+                    try {\n+                        genericResponse = DeserializationHelpers.castObject(objectMapper, response.body(), clazz);\n+                    } catch (JsonProcessingException e) {\n+                        Observable.error(e);\n+                    }\n+                    return new ServiceResponseWithHeaders<>(genericResponse, response.headers(), response.response());\n+                })\n+                .subscribeOn(Schedulers.io());\n+    }\n+\n+    /**\n+     * Updates a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param digitalTwinUpdateOperations The JSON patch to apply to the specified digital twin. This argument can be created using {@link UpdateOperationUtility}.\n+     * @return A {@link ServiceResponseWithHeaders} with {@link DigitalTwinUpdateHeaders}.\n+     */\n+    public Observable<ServiceResponseWithHeaders<Void, DigitalTwinUpdateHeaders>> updateDigitalTwinWithResponse (@NonNull String digitalTwinId, @NonNull List<Object> digitalTwinUpdateOperations)\n+    {\n+        return digitalTwin.updateDigitalTwinWithServiceResponseAsync(digitalTwinId, digitalTwinUpdateOperations)\n+                .subscribeOn(Schedulers.io());\n+    }\n+\n+    /**\n+     * Updates a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param digitalTwinUpdateOperations The JSON patch to apply to the specified digital twin. This argument can be created using {@link UpdateOperationUtility}.\n+     * @param options The optional settings for this request.\n+     * @return A {@link ServiceResponseWithHeaders} with {@link DigitalTwinUpdateHeaders}.\n+     */\n+    public Observable<ServiceResponseWithHeaders<Void, DigitalTwinUpdateHeaders>> updateDigitalTwinWithResponse (@NonNull String digitalTwinId, @NonNull List<Object> digitalTwinUpdateOperations, @NonNull DigitalTwinUpdateRequestOptions options)\n+    {\n+        String ifMatch = options != null ? options.getIfMatch() : null;\n+        return digitalTwin.updateDigitalTwinWithServiceResponseAsync(digitalTwinId, digitalTwinUpdateOperations, ifMatch)\n+                .subscribeOn(Schedulers.io());\n+    }\n+\n+    /**\n+     * Invoke a command on a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param commandName The command to be invoked.\n+     * @param payload The command payload.\n+     * @return The application/json command invocation response.\n+     */\n+    public Observable<String> invokeCommand (@NonNull String digitalTwinId, @NonNull String commandName, String payload)", "originalCommit": "d0cb7b0f6f8553609be356ce554b4421952a248d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzkzMjIwNQ==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r493932205", "bodyText": "nit: call \".withResponse\" API instead", "author": "abhipsaMisra", "createdAt": "2020-09-23T22:33:33Z", "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/digitaltwin/DigitalTwinAsyncClient.java", "diffHunk": "@@ -0,0 +1,218 @@\n+package com.microsoft.azure.sdk.iot.service.digitaltwin;\n+\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.authentication.SasTokenProvider;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.authentication.ServiceClientCredentialsProvider;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.authentication.ServiceConnectionString;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.authentication.ServiceConnectionStringParser;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.implementation.DigitalTwinsImpl;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.implementation.IotHubGatewayServiceAPIsImpl;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.DigitalTwins;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.models.DigitalTwinGetHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.models.DigitalTwinInvokeRootLevelCommandHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.models.DigitalTwinUpdateHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.helpers.DeserializationHelpers;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.helpers.UpdateOperationUtility;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.models.DigitalTwinCommandResponse;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.models.DigitalTwinInvokeCommandHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.models.DigitalTwinInvokeCommandRequestOptions;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.models.DigitalTwinUpdateRequestOptions;\n+import com.microsoft.rest.*;\n+import com.microsoft.rest.serializer.JacksonAdapter;\n+import lombok.Builder;\n+import lombok.NonNull;\n+import lombok.Setter;\n+import rx.Observable;\n+import rx.schedulers.Schedulers;\n+\n+import java.util.List;\n+import java.util.Objects;\n+\n+import static com.microsoft.azure.sdk.iot.service.digitaltwin.helpers.Tools.*;\n+import static lombok.AccessLevel.PACKAGE;\n+\n+public class DigitalTwinAsyncClient {\n+    @Setter(PACKAGE)\n+    private DigitalTwinsImpl digitalTwin;\n+    private static ObjectMapper objectMapper = new ObjectMapper();\n+\n+    /***\n+     * Creates an implementation instance of {@link DigitalTwins} that is used to invoke the Digital Twin features\n+     * @param connectionString The IoTHub connection string\n+     */\n+    @Builder(builderMethodName = \"buildFromConnectionString\", builderClassName = \"FromConnectionStringBuilder\")\n+    public DigitalTwinAsyncClient(@NonNull String connectionString) {\n+        ServiceConnectionString serviceConnectionString = ServiceConnectionStringParser.parseConnectionString(connectionString);\n+        SasTokenProvider sasTokenProvider = serviceConnectionString.createSasTokenProvider();\n+        String httpsEndpoint = serviceConnectionString.getHttpsEndpoint();\n+\n+        init(sasTokenProvider, httpsEndpoint);\n+    }\n+\n+    private void init(SasTokenProvider sasTokenProvider, String httpsEndpoint) {\n+        RestClient simpleRestClient = new RestClient.Builder()\n+                .withBaseUrl(httpsEndpoint)\n+                .withCredentials(new ServiceClientCredentialsProvider(sasTokenProvider))\n+                .withResponseBuilderFactory(new ServiceResponseBuilder.Factory())\n+                .withSerializerAdapter(new JacksonAdapter())\n+                .build();\n+\n+        IotHubGatewayServiceAPIsImpl protocolLayerClient = new IotHubGatewayServiceAPIsImpl(simpleRestClient);\n+        digitalTwin = new DigitalTwinsImpl(simpleRestClient.retrofit(), protocolLayerClient);\n+    }\n+\n+    /**\n+     * Gets a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param clazz The class to deserialize the application/json into.\n+     * @param <T> The generic type to deserialize the application/json into.\n+     * @return The application/json of the digital twin.\n+     */\n+    public <T> Observable<T> getDigitalTwin (@NonNull String digitalTwinId, Class<T> clazz)\n+    {\n+        return digitalTwin.getDigitalTwinAsync(digitalTwinId)\n+                .filter(Objects::nonNull)\n+                .map(response -> {\n+                    T genericResponse = null;\n+                    try {\n+                        genericResponse = DeserializationHelpers.castObject(objectMapper, response, clazz);\n+                    } catch (JsonProcessingException e) {\n+                        Observable.error(e);\n+                    }\n+                    return genericResponse;\n+                })\n+                .subscribeOn(Schedulers.io());\n+    }\n+\n+    /**\n+     * Gets a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param clazz The class to deserialize the application/json into.\n+     * @param <T> The generic type to deserialize the application/json into.\n+     * @return A {@link ServiceResponseWithHeaders} representing deserialized application/json of the digital twin with {@link DigitalTwinGetHeaders}.\n+     */\n+    public <T> Observable<ServiceResponseWithHeaders<T, DigitalTwinGetHeaders>> getDigitalTwinWithResponse (@NonNull String digitalTwinId, Class<T> clazz)\n+    {\n+        return digitalTwin.getDigitalTwinWithServiceResponseAsync(digitalTwinId)\n+                .map(response -> {\n+                    T genericResponse = null;\n+                    try {\n+                        genericResponse = DeserializationHelpers.castObject(objectMapper, response.body(), clazz);\n+                    } catch (JsonProcessingException e) {\n+                        Observable.error(e);\n+                    }\n+                    return new ServiceResponseWithHeaders<>(genericResponse, response.headers(), response.response());\n+                })\n+                .subscribeOn(Schedulers.io());\n+    }\n+\n+    /**\n+     * Updates a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param digitalTwinUpdateOperations The JSON patch to apply to the specified digital twin. This argument can be created using {@link UpdateOperationUtility}.\n+     * @return A {@link ServiceResponseWithHeaders} with {@link DigitalTwinUpdateHeaders}.\n+     */\n+    public Observable<ServiceResponseWithHeaders<Void, DigitalTwinUpdateHeaders>> updateDigitalTwinWithResponse (@NonNull String digitalTwinId, @NonNull List<Object> digitalTwinUpdateOperations)\n+    {\n+        return digitalTwin.updateDigitalTwinWithServiceResponseAsync(digitalTwinId, digitalTwinUpdateOperations)\n+                .subscribeOn(Schedulers.io());\n+    }\n+\n+    /**\n+     * Updates a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param digitalTwinUpdateOperations The JSON patch to apply to the specified digital twin. This argument can be created using {@link UpdateOperationUtility}.\n+     * @param options The optional settings for this request.\n+     * @return A {@link ServiceResponseWithHeaders} with {@link DigitalTwinUpdateHeaders}.\n+     */\n+    public Observable<ServiceResponseWithHeaders<Void, DigitalTwinUpdateHeaders>> updateDigitalTwinWithResponse (@NonNull String digitalTwinId, @NonNull List<Object> digitalTwinUpdateOperations, @NonNull DigitalTwinUpdateRequestOptions options)\n+    {\n+        String ifMatch = options != null ? options.getIfMatch() : null;\n+        return digitalTwin.updateDigitalTwinWithServiceResponseAsync(digitalTwinId, digitalTwinUpdateOperations, ifMatch)\n+                .subscribeOn(Schedulers.io());\n+    }\n+\n+    /**\n+     * Invoke a command on a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param commandName The command to be invoked.\n+     * @param payload The command payload.\n+     * @return The application/json command invocation response.\n+     */\n+    public Observable<String> invokeCommand (@NonNull String digitalTwinId, @NonNull String commandName, String payload)\n+    {\n+        return digitalTwin.invokeRootLevelCommandAsync(digitalTwinId, commandName, payload, null, null)", "originalCommit": "d0cb7b0f6f8553609be356ce554b4421952a248d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzkzMzIyNg==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r493933226", "bodyText": "\"String payload\" needs to be @nonnull, there needs to be another API overload without it", "author": "abhipsaMisra", "createdAt": "2020-09-23T22:36:33Z", "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/digitaltwin/DigitalTwinAsyncClient.java", "diffHunk": "@@ -0,0 +1,218 @@\n+package com.microsoft.azure.sdk.iot.service.digitaltwin;\n+\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.authentication.SasTokenProvider;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.authentication.ServiceClientCredentialsProvider;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.authentication.ServiceConnectionString;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.authentication.ServiceConnectionStringParser;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.implementation.DigitalTwinsImpl;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.implementation.IotHubGatewayServiceAPIsImpl;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.DigitalTwins;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.models.DigitalTwinGetHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.models.DigitalTwinInvokeRootLevelCommandHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.models.DigitalTwinUpdateHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.helpers.DeserializationHelpers;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.helpers.UpdateOperationUtility;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.models.DigitalTwinCommandResponse;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.models.DigitalTwinInvokeCommandHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.models.DigitalTwinInvokeCommandRequestOptions;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.models.DigitalTwinUpdateRequestOptions;\n+import com.microsoft.rest.*;\n+import com.microsoft.rest.serializer.JacksonAdapter;\n+import lombok.Builder;\n+import lombok.NonNull;\n+import lombok.Setter;\n+import rx.Observable;\n+import rx.schedulers.Schedulers;\n+\n+import java.util.List;\n+import java.util.Objects;\n+\n+import static com.microsoft.azure.sdk.iot.service.digitaltwin.helpers.Tools.*;\n+import static lombok.AccessLevel.PACKAGE;\n+\n+public class DigitalTwinAsyncClient {\n+    @Setter(PACKAGE)\n+    private DigitalTwinsImpl digitalTwin;\n+    private static ObjectMapper objectMapper = new ObjectMapper();\n+\n+    /***\n+     * Creates an implementation instance of {@link DigitalTwins} that is used to invoke the Digital Twin features\n+     * @param connectionString The IoTHub connection string\n+     */\n+    @Builder(builderMethodName = \"buildFromConnectionString\", builderClassName = \"FromConnectionStringBuilder\")\n+    public DigitalTwinAsyncClient(@NonNull String connectionString) {\n+        ServiceConnectionString serviceConnectionString = ServiceConnectionStringParser.parseConnectionString(connectionString);\n+        SasTokenProvider sasTokenProvider = serviceConnectionString.createSasTokenProvider();\n+        String httpsEndpoint = serviceConnectionString.getHttpsEndpoint();\n+\n+        init(sasTokenProvider, httpsEndpoint);\n+    }\n+\n+    private void init(SasTokenProvider sasTokenProvider, String httpsEndpoint) {\n+        RestClient simpleRestClient = new RestClient.Builder()\n+                .withBaseUrl(httpsEndpoint)\n+                .withCredentials(new ServiceClientCredentialsProvider(sasTokenProvider))\n+                .withResponseBuilderFactory(new ServiceResponseBuilder.Factory())\n+                .withSerializerAdapter(new JacksonAdapter())\n+                .build();\n+\n+        IotHubGatewayServiceAPIsImpl protocolLayerClient = new IotHubGatewayServiceAPIsImpl(simpleRestClient);\n+        digitalTwin = new DigitalTwinsImpl(simpleRestClient.retrofit(), protocolLayerClient);\n+    }\n+\n+    /**\n+     * Gets a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param clazz The class to deserialize the application/json into.\n+     * @param <T> The generic type to deserialize the application/json into.\n+     * @return The application/json of the digital twin.\n+     */\n+    public <T> Observable<T> getDigitalTwin (@NonNull String digitalTwinId, Class<T> clazz)\n+    {\n+        return digitalTwin.getDigitalTwinAsync(digitalTwinId)\n+                .filter(Objects::nonNull)\n+                .map(response -> {\n+                    T genericResponse = null;\n+                    try {\n+                        genericResponse = DeserializationHelpers.castObject(objectMapper, response, clazz);\n+                    } catch (JsonProcessingException e) {\n+                        Observable.error(e);\n+                    }\n+                    return genericResponse;\n+                })\n+                .subscribeOn(Schedulers.io());\n+    }\n+\n+    /**\n+     * Gets a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param clazz The class to deserialize the application/json into.\n+     * @param <T> The generic type to deserialize the application/json into.\n+     * @return A {@link ServiceResponseWithHeaders} representing deserialized application/json of the digital twin with {@link DigitalTwinGetHeaders}.\n+     */\n+    public <T> Observable<ServiceResponseWithHeaders<T, DigitalTwinGetHeaders>> getDigitalTwinWithResponse (@NonNull String digitalTwinId, Class<T> clazz)\n+    {\n+        return digitalTwin.getDigitalTwinWithServiceResponseAsync(digitalTwinId)\n+                .map(response -> {\n+                    T genericResponse = null;\n+                    try {\n+                        genericResponse = DeserializationHelpers.castObject(objectMapper, response.body(), clazz);\n+                    } catch (JsonProcessingException e) {\n+                        Observable.error(e);\n+                    }\n+                    return new ServiceResponseWithHeaders<>(genericResponse, response.headers(), response.response());\n+                })\n+                .subscribeOn(Schedulers.io());\n+    }\n+\n+    /**\n+     * Updates a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param digitalTwinUpdateOperations The JSON patch to apply to the specified digital twin. This argument can be created using {@link UpdateOperationUtility}.\n+     * @return A {@link ServiceResponseWithHeaders} with {@link DigitalTwinUpdateHeaders}.\n+     */\n+    public Observable<ServiceResponseWithHeaders<Void, DigitalTwinUpdateHeaders>> updateDigitalTwinWithResponse (@NonNull String digitalTwinId, @NonNull List<Object> digitalTwinUpdateOperations)\n+    {\n+        return digitalTwin.updateDigitalTwinWithServiceResponseAsync(digitalTwinId, digitalTwinUpdateOperations)\n+                .subscribeOn(Schedulers.io());\n+    }\n+\n+    /**\n+     * Updates a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param digitalTwinUpdateOperations The JSON patch to apply to the specified digital twin. This argument can be created using {@link UpdateOperationUtility}.\n+     * @param options The optional settings for this request.\n+     * @return A {@link ServiceResponseWithHeaders} with {@link DigitalTwinUpdateHeaders}.\n+     */\n+    public Observable<ServiceResponseWithHeaders<Void, DigitalTwinUpdateHeaders>> updateDigitalTwinWithResponse (@NonNull String digitalTwinId, @NonNull List<Object> digitalTwinUpdateOperations, @NonNull DigitalTwinUpdateRequestOptions options)\n+    {\n+        String ifMatch = options != null ? options.getIfMatch() : null;\n+        return digitalTwin.updateDigitalTwinWithServiceResponseAsync(digitalTwinId, digitalTwinUpdateOperations, ifMatch)\n+                .subscribeOn(Schedulers.io());\n+    }\n+\n+    /**\n+     * Invoke a command on a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param commandName The command to be invoked.\n+     * @param payload The command payload.\n+     * @return The application/json command invocation response.\n+     */\n+    public Observable<String> invokeCommand (@NonNull String digitalTwinId, @NonNull String commandName, String payload)", "originalCommit": "d0cb7b0f6f8553609be356ce554b4421952a248d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzkzNDA0NQ==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r493934045", "bodyText": "@nonnull String digitalTwinId, @nonnull String commandName\n@nonnull String digitalTwinId, @nonnull String commandName, @nonnull String payload\n@nonnull String digitalTwinId, @nonnull String commandName, @nonnull String payload, @nonnull DigitalTwinInvokeCommandRequestOptions options => with http response", "author": "abhipsaMisra", "createdAt": "2020-09-23T22:39:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzkzMzIyNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzkzNTg4Mg==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r493935882", "bodyText": "add another overload that returns void -> no http response", "author": "abhipsaMisra", "createdAt": "2020-09-23T22:44:16Z", "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/digitaltwin/DigitalTwinAsyncClient.java", "diffHunk": "@@ -0,0 +1,218 @@\n+package com.microsoft.azure.sdk.iot.service.digitaltwin;\n+\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.authentication.SasTokenProvider;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.authentication.ServiceClientCredentialsProvider;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.authentication.ServiceConnectionString;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.authentication.ServiceConnectionStringParser;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.implementation.DigitalTwinsImpl;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.implementation.IotHubGatewayServiceAPIsImpl;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.DigitalTwins;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.models.DigitalTwinGetHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.models.DigitalTwinInvokeRootLevelCommandHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.models.DigitalTwinUpdateHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.helpers.DeserializationHelpers;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.helpers.UpdateOperationUtility;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.models.DigitalTwinCommandResponse;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.models.DigitalTwinInvokeCommandHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.models.DigitalTwinInvokeCommandRequestOptions;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.models.DigitalTwinUpdateRequestOptions;\n+import com.microsoft.rest.*;\n+import com.microsoft.rest.serializer.JacksonAdapter;\n+import lombok.Builder;\n+import lombok.NonNull;\n+import lombok.Setter;\n+import rx.Observable;\n+import rx.schedulers.Schedulers;\n+\n+import java.util.List;\n+import java.util.Objects;\n+\n+import static com.microsoft.azure.sdk.iot.service.digitaltwin.helpers.Tools.*;\n+import static lombok.AccessLevel.PACKAGE;\n+\n+public class DigitalTwinAsyncClient {\n+    @Setter(PACKAGE)\n+    private DigitalTwinsImpl digitalTwin;\n+    private static ObjectMapper objectMapper = new ObjectMapper();\n+\n+    /***\n+     * Creates an implementation instance of {@link DigitalTwins} that is used to invoke the Digital Twin features\n+     * @param connectionString The IoTHub connection string\n+     */\n+    @Builder(builderMethodName = \"buildFromConnectionString\", builderClassName = \"FromConnectionStringBuilder\")\n+    public DigitalTwinAsyncClient(@NonNull String connectionString) {\n+        ServiceConnectionString serviceConnectionString = ServiceConnectionStringParser.parseConnectionString(connectionString);\n+        SasTokenProvider sasTokenProvider = serviceConnectionString.createSasTokenProvider();\n+        String httpsEndpoint = serviceConnectionString.getHttpsEndpoint();\n+\n+        init(sasTokenProvider, httpsEndpoint);\n+    }\n+\n+    private void init(SasTokenProvider sasTokenProvider, String httpsEndpoint) {\n+        RestClient simpleRestClient = new RestClient.Builder()\n+                .withBaseUrl(httpsEndpoint)\n+                .withCredentials(new ServiceClientCredentialsProvider(sasTokenProvider))\n+                .withResponseBuilderFactory(new ServiceResponseBuilder.Factory())\n+                .withSerializerAdapter(new JacksonAdapter())\n+                .build();\n+\n+        IotHubGatewayServiceAPIsImpl protocolLayerClient = new IotHubGatewayServiceAPIsImpl(simpleRestClient);\n+        digitalTwin = new DigitalTwinsImpl(simpleRestClient.retrofit(), protocolLayerClient);\n+    }\n+\n+    /**\n+     * Gets a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param clazz The class to deserialize the application/json into.\n+     * @param <T> The generic type to deserialize the application/json into.\n+     * @return The application/json of the digital twin.\n+     */\n+    public <T> Observable<T> getDigitalTwin (@NonNull String digitalTwinId, Class<T> clazz)\n+    {\n+        return digitalTwin.getDigitalTwinAsync(digitalTwinId)\n+                .filter(Objects::nonNull)\n+                .map(response -> {\n+                    T genericResponse = null;\n+                    try {\n+                        genericResponse = DeserializationHelpers.castObject(objectMapper, response, clazz);\n+                    } catch (JsonProcessingException e) {\n+                        Observable.error(e);\n+                    }\n+                    return genericResponse;\n+                })\n+                .subscribeOn(Schedulers.io());\n+    }\n+\n+    /**\n+     * Gets a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param clazz The class to deserialize the application/json into.\n+     * @param <T> The generic type to deserialize the application/json into.\n+     * @return A {@link ServiceResponseWithHeaders} representing deserialized application/json of the digital twin with {@link DigitalTwinGetHeaders}.\n+     */\n+    public <T> Observable<ServiceResponseWithHeaders<T, DigitalTwinGetHeaders>> getDigitalTwinWithResponse (@NonNull String digitalTwinId, Class<T> clazz)\n+    {\n+        return digitalTwin.getDigitalTwinWithServiceResponseAsync(digitalTwinId)\n+                .map(response -> {\n+                    T genericResponse = null;\n+                    try {\n+                        genericResponse = DeserializationHelpers.castObject(objectMapper, response.body(), clazz);\n+                    } catch (JsonProcessingException e) {\n+                        Observable.error(e);\n+                    }\n+                    return new ServiceResponseWithHeaders<>(genericResponse, response.headers(), response.response());\n+                })\n+                .subscribeOn(Schedulers.io());\n+    }\n+\n+    /**\n+     * Updates a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param digitalTwinUpdateOperations The JSON patch to apply to the specified digital twin. This argument can be created using {@link UpdateOperationUtility}.\n+     * @return A {@link ServiceResponseWithHeaders} with {@link DigitalTwinUpdateHeaders}.\n+     */\n+    public Observable<ServiceResponseWithHeaders<Void, DigitalTwinUpdateHeaders>> updateDigitalTwinWithResponse (@NonNull String digitalTwinId, @NonNull List<Object> digitalTwinUpdateOperations)", "originalCommit": "d0cb7b0f6f8553609be356ce554b4421952a248d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTI1OTg2OQ==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r495259869", "bodyText": "The other fields in this class don't seem to be using lombok for generating getters and setters. We should be consistent in our usage - update lombok usage for a  fields/ explicitly generate the getter and setters for this field.\nWhat do you think?", "author": "abhipsaMisra", "createdAt": "2020-09-25T21:49:56Z", "path": "deps/src/main/java/com/microsoft/azure/sdk/iot/deps/twin/RegisterManager.java", "diffHunk": "@@ -123,6 +125,17 @@\n     @SerializedName(CAPABILITIES_TAG)\n     protected DeviceCapabilities capabilities = null;\n \n+    /**\n+     * The Digital Twin model id of the device and module\n+     * The value will be null for a non-pnp device.\n+     * The value will be null for a pnp device until the device connects and registers with the model id.\n+     */\n+    private static final String MODEL_ID = \"modelId\";\n+    @Expose(serialize = true, deserialize = true)\n+    @SerializedName(MODEL_ID)\n+    @Setter\n+    @Getter\n+    protected String modelId = null;", "originalCommit": "651b1ff7910c059cc58e5b49cd4ecd84a55abc2d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTI2MTU3Mg==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r495261572", "bodyText": "Doesn't java have a property on Message class to set this directly?\nalso nit: I've update the .NET code to make all these public, and added a comment explaining what they mean and why they are required.", "author": "abhipsaMisra", "createdAt": "2020-09-25T21:52:16Z", "path": "device/iot-device-client/src/main/java/com/microsoft/azure/sdk/iot/device/plugandplay/PnpHelper.java", "diffHunk": "@@ -15,15 +15,16 @@\n \n import static java.util.Collections.singleton;\n import static java.util.Collections.singletonMap;\n-\n+/*\n+ A helper class for formatting command requests and properties as per plug and play convention.\n+*/\n public class PnpHelper {\n \n     private static final String TELEMETRY_COMPONENT_NAME = \"$.sub\";", "originalCommit": "651b1ff7910c059cc58e5b49cd4ecd84a55abc2d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTc1NjU1OA==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r495756558", "bodyText": "remove dps as default since bug bash is over", "author": "barustum", "createdAt": "2020-09-28T08:01:36Z", "path": "device/iot-device-samples/pnp-device-sample/temperature-controller-device-sample/src/main/java/samples/com/microsoft/azure/sdk/iot/device/TemperatureController.java", "diffHunk": "@@ -44,13 +44,14 @@\n \n     // DTDL interface used: https://github.com/Azure/opendigitaltwins-dtdl/blob/master/DTDL/v2/samples/TemperatureController.json\n     private static final String deviceConnectionString = System.getenv(\"IOTHUB_DEVICE_CONNECTION_STRING\");\n+    // Defaulting to DPS flow for bug bash", "originalCommit": "17dac616bf1f635227e00fbaeaabb9af7c280b11", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTc1NzU1OQ==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r495757559", "bodyText": "remove defaulting to dps since bug bash is over", "author": "barustum", "createdAt": "2020-09-28T08:03:30Z", "path": "device/iot-device-samples/pnp-device-sample/thermostat-device-sample/src/main/java/samples/com/microsoft/azure/sdk/iot/device/Thermostat.java", "diffHunk": "@@ -39,10 +39,11 @@\n \n     // DTDL interface used: https://github.com/Azure/opendigitaltwins-dtdl/blob/master/DTDL/v2/samples/Thermostat.json\n     private static final String deviceConnectionString = System.getenv(\"IOTHUB_DEVICE_CONNECTION_STRING\");\n+    // Defaulting to DPS flow for bug bash", "originalCommit": "17dac616bf1f635227e00fbaeaabb9af7c280b11", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTc1OTcxMg==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r495759712", "bodyText": "other private fields do not have a getter and setter. Intentional?", "author": "barustum", "createdAt": "2020-09-28T08:07:32Z", "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/devicetwin/DeviceTwinDevice.java", "diffHunk": "@@ -34,6 +36,9 @@\n     private Map<String, ConfigurationInfo> configurations = null;\n     private DeviceCapabilities capabilities = null;\n     private String connectionState;\n+    @Getter\n+    @Setter\n+    private String modelId;", "originalCommit": "17dac616bf1f635227e00fbaeaabb9af7c280b11", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTc2MjA3Mg==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r495762072", "bodyText": "nit: move private method towards the end of the class", "author": "barustum", "createdAt": "2020-09-28T08:12:02Z", "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/digitaltwin/DigitalTwinAsyncClient.java", "diffHunk": "@@ -0,0 +1,229 @@\n+// Copyright (c) Microsoft. All rights reserved.\n+// Licensed under the MIT license. See LICENSE file in the project root for full license information.\n+package com.microsoft.azure.sdk.iot.service.digitaltwin;\n+\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.authentication.SasTokenProvider;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.authentication.ServiceClientCredentialsProvider;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.authentication.ServiceConnectionString;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.authentication.ServiceConnectionStringParser;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.implementation.DigitalTwinsImpl;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.implementation.IotHubGatewayServiceAPIsImpl;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.DigitalTwins;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.models.DigitalTwinGetHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.models.DigitalTwinInvokeRootLevelCommandHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.models.DigitalTwinUpdateHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.helpers.DeserializationHelpers;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.helpers.UpdateOperationUtility;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.models.DigitalTwinCommandResponse;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.models.DigitalTwinInvokeCommandHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.models.DigitalTwinInvokeCommandRequestOptions;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.models.DigitalTwinUpdateRequestOptions;\n+import com.microsoft.rest.*;\n+import com.microsoft.rest.serializer.JacksonAdapter;\n+import lombok.Builder;\n+import lombok.NonNull;\n+import lombok.Setter;\n+import rx.Observable;\n+import rx.schedulers.Schedulers;\n+\n+import java.util.List;\n+import java.util.Objects;\n+\n+import static com.microsoft.azure.sdk.iot.service.digitaltwin.helpers.Tools.*;\n+import static lombok.AccessLevel.PACKAGE;\n+\n+public class DigitalTwinAsyncClient {\n+    @Setter(PACKAGE)\n+    private DigitalTwinsImpl digitalTwin;\n+    private static ObjectMapper objectMapper = new ObjectMapper();\n+\n+    /***\n+     * Creates an implementation instance of {@link DigitalTwins} that is used to invoke the Digital Twin features\n+     * @param connectionString The IoTHub connection string\n+     */\n+    @Builder(builderMethodName = \"buildFromConnectionString\", builderClassName = \"FromConnectionStringBuilder\")\n+    public DigitalTwinAsyncClient(@NonNull String connectionString) {\n+        ServiceConnectionString serviceConnectionString = ServiceConnectionStringParser.parseConnectionString(connectionString);\n+        SasTokenProvider sasTokenProvider = serviceConnectionString.createSasTokenProvider();\n+        String httpsEndpoint = serviceConnectionString.getHttpsEndpoint();\n+\n+        init(sasTokenProvider, httpsEndpoint);\n+    }\n+\n+    private void init(SasTokenProvider sasTokenProvider, String httpsEndpoint) {", "originalCommit": "17dac616bf1f635227e00fbaeaabb9af7c280b11", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTc2NDM1OA==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r495764358", "bodyText": "if an exception is thrown and caught here, it seems like we are returning null (through 'return generticResponse'). Is this intentional? or do we expect to rethrow the exception to the user?", "author": "barustum", "createdAt": "2020-09-28T08:16:12Z", "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/digitaltwin/DigitalTwinAsyncClient.java", "diffHunk": "@@ -0,0 +1,229 @@\n+// Copyright (c) Microsoft. All rights reserved.\n+// Licensed under the MIT license. See LICENSE file in the project root for full license information.\n+package com.microsoft.azure.sdk.iot.service.digitaltwin;\n+\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.authentication.SasTokenProvider;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.authentication.ServiceClientCredentialsProvider;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.authentication.ServiceConnectionString;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.authentication.ServiceConnectionStringParser;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.implementation.DigitalTwinsImpl;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.implementation.IotHubGatewayServiceAPIsImpl;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.DigitalTwins;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.models.DigitalTwinGetHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.models.DigitalTwinInvokeRootLevelCommandHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.models.DigitalTwinUpdateHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.helpers.DeserializationHelpers;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.helpers.UpdateOperationUtility;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.models.DigitalTwinCommandResponse;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.models.DigitalTwinInvokeCommandHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.models.DigitalTwinInvokeCommandRequestOptions;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.models.DigitalTwinUpdateRequestOptions;\n+import com.microsoft.rest.*;\n+import com.microsoft.rest.serializer.JacksonAdapter;\n+import lombok.Builder;\n+import lombok.NonNull;\n+import lombok.Setter;\n+import rx.Observable;\n+import rx.schedulers.Schedulers;\n+\n+import java.util.List;\n+import java.util.Objects;\n+\n+import static com.microsoft.azure.sdk.iot.service.digitaltwin.helpers.Tools.*;\n+import static lombok.AccessLevel.PACKAGE;\n+\n+public class DigitalTwinAsyncClient {\n+    @Setter(PACKAGE)\n+    private DigitalTwinsImpl digitalTwin;\n+    private static ObjectMapper objectMapper = new ObjectMapper();\n+\n+    /***\n+     * Creates an implementation instance of {@link DigitalTwins} that is used to invoke the Digital Twin features\n+     * @param connectionString The IoTHub connection string\n+     */\n+    @Builder(builderMethodName = \"buildFromConnectionString\", builderClassName = \"FromConnectionStringBuilder\")\n+    public DigitalTwinAsyncClient(@NonNull String connectionString) {\n+        ServiceConnectionString serviceConnectionString = ServiceConnectionStringParser.parseConnectionString(connectionString);\n+        SasTokenProvider sasTokenProvider = serviceConnectionString.createSasTokenProvider();\n+        String httpsEndpoint = serviceConnectionString.getHttpsEndpoint();\n+\n+        init(sasTokenProvider, httpsEndpoint);\n+    }\n+\n+    private void init(SasTokenProvider sasTokenProvider, String httpsEndpoint) {\n+        RestClient simpleRestClient = new RestClient.Builder()\n+                .withBaseUrl(httpsEndpoint)\n+                .withCredentials(new ServiceClientCredentialsProvider(sasTokenProvider))\n+                .withResponseBuilderFactory(new ServiceResponseBuilder.Factory())\n+                .withSerializerAdapter(new JacksonAdapter())\n+                .build();\n+\n+        IotHubGatewayServiceAPIsImpl protocolLayerClient = new IotHubGatewayServiceAPIsImpl(simpleRestClient);\n+        digitalTwin = new DigitalTwinsImpl(simpleRestClient.retrofit(), protocolLayerClient);\n+    }\n+\n+    /**\n+     * Gets a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param clazz The class to deserialize the application/json into.\n+     * @param <T> The generic type to deserialize the application/json into.\n+     * @return The application/json of the digital twin.\n+     */\n+    public <T> Observable<T> getDigitalTwin (@NonNull String digitalTwinId, Class<T> clazz)\n+    {\n+        return digitalTwin.getDigitalTwinAsync(digitalTwinId)\n+                .filter(Objects::nonNull)\n+                .map(response -> {\n+                    T genericResponse = null;\n+                    try {\n+                        genericResponse = DeserializationHelpers.castObject(objectMapper, response, clazz);\n+                    } catch (JsonProcessingException e) {\n+                        Observable.error(e);", "originalCommit": "17dac616bf1f635227e00fbaeaabb9af7c280b11", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTc2ODM2NQ==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r495768365", "bodyText": "missing options param", "author": "barustum", "createdAt": "2020-09-28T08:23:35Z", "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/digitaltwin/DigitalTwinClient.java", "diffHunk": "@@ -0,0 +1,174 @@\n+// Copyright (c) Microsoft. All rights reserved.\n+// Licensed under the MIT license. See LICENSE file in the project root for full license information.\n+package com.microsoft.azure.sdk.iot.service.digitaltwin;\n+\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.DigitalTwins;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.models.DigitalTwinGetHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.models.DigitalTwinInvokeRootLevelCommandHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.models.DigitalTwinUpdateHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.helpers.UpdateOperationUtility;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.models.DigitalTwinCommandResponse;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.models.DigitalTwinInvokeCommandHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.models.DigitalTwinInvokeCommandRequestOptions;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.models.DigitalTwinUpdateRequestOptions;\n+import com.microsoft.rest.*;\n+import lombok.NonNull;\n+import lombok.Setter;\n+import rx.Observable;\n+import rx.schedulers.Schedulers;\n+\n+import java.util.List;\n+\n+import static lombok.AccessLevel.PACKAGE;\n+\n+public class DigitalTwinClient {\n+    @Setter(PACKAGE)\n+    private final DigitalTwinAsyncClient digitalTwinAsyncClient;\n+    private static ObjectMapper objectMapper = new ObjectMapper();\n+\n+    /***\n+     * Creates an implementation instance of {@link DigitalTwins} that is used to invoke the Digital Twin features\n+     * @param digitalTwinAsyncClient Digital Twin Async Client\n+     */\n+    public DigitalTwinClient(@NonNull DigitalTwinAsyncClient digitalTwinAsyncClient) {\n+        this.digitalTwinAsyncClient = digitalTwinAsyncClient;\n+    }\n+\n+    /**\n+     * Gets a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param clazz The class to deserialize the application/json into.\n+     * @param <T> The generic type to deserialize the application/json into.\n+     * @return The application/json of the digital twin.\n+     */\n+    public <T> T getDigitalTwin (@NonNull String digitalTwinId, Class<T> clazz)\n+    {\n+        return digitalTwinAsyncClient.getDigitalTwin(digitalTwinId, clazz)\n+                .toBlocking().single();\n+    }\n+\n+    /**\n+     * Gets a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param clazz The class to deserialize the application/json into.\n+     * @param <T> The generic type to deserialize the application/json into.\n+     * @return A {@link ServiceResponseWithHeaders} representing deserialized application/json of the digital twin with {@link DigitalTwinGetHeaders}.\n+     */\n+    public <T> ServiceResponseWithHeaders<T, DigitalTwinGetHeaders> getDigitalTwinWithResponse (@NonNull String digitalTwinId, Class<T> clazz)\n+    {\n+        return digitalTwinAsyncClient.getDigitalTwinWithResponse(digitalTwinId, clazz)\n+                .toBlocking().single();\n+    }\n+\n+    /**\n+     * Updates a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param digitalTwinUpdateOperations The JSON patch to apply to the specified digital twin. This argument can be created using {@link UpdateOperationUtility}.\n+     * @return void.\n+     */\n+    public Void updateDigitalTwin (@NonNull String digitalTwinId, @NonNull List<Object> digitalTwinUpdateOperations)\n+    {\n+        return digitalTwinAsyncClient.updateDigitalTwin(digitalTwinId, digitalTwinUpdateOperations)\n+            .toBlocking().single();\n+    }\n+\n+    /**\n+     * Updates a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param digitalTwinUpdateOperations The JSON patch to apply to the specified digital twin. This argument can be created using {@link UpdateOperationUtility}.\n+     * @return A {@link ServiceResponseWithHeaders} with {@link DigitalTwinUpdateHeaders}.\n+     */\n+    public ServiceResponseWithHeaders<Void, DigitalTwinUpdateHeaders> updateDigitalTwinWithResponse (@NonNull String digitalTwinId, @NonNull List<Object> digitalTwinUpdateOperations)\n+    {\n+        return digitalTwinAsyncClient.updateDigitalTwinWithResponse(digitalTwinId, digitalTwinUpdateOperations)\n+                .toBlocking().single();\n+    }\n+\n+    /**\n+     * Updates a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param digitalTwinUpdateOperations The JSON patch to apply to the specified digital twin. This argument can be created using {@link UpdateOperationUtility}.\n+     * @param options The optional settings for this request.\n+     * @return A {@link ServiceResponseWithHeaders} with {@link DigitalTwinUpdateHeaders}.\n+     */\n+    public ServiceResponseWithHeaders<Void, DigitalTwinUpdateHeaders> updateDigitalTwinWithResponse (@NonNull String digitalTwinId, @NonNull List<Object> digitalTwinUpdateOperations, @NonNull DigitalTwinUpdateRequestOptions options)\n+    {\n+        return digitalTwinAsyncClient.updateDigitalTwinWithResponse(digitalTwinId, digitalTwinUpdateOperations, options)\n+                .toBlocking().single();\n+    }\n+\n+    /**\n+     * Invoke a command on a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param commandName The command to be invoked.\n+     * @return A {@link DigitalTwinCommandResponse} which contains the application/json command invocation response.\n+     */\n+    public DigitalTwinCommandResponse invokeCommand(@NonNull String digitalTwinId, @NonNull String commandName) {\n+        return digitalTwinAsyncClient.invokeCommand(digitalTwinId, commandName)\n+                .toBlocking().single();\n+    }\n+\n+    /**\n+     * Invoke a command on a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param commandName The command to be invoked.\n+     * @param payload The command payload.\n+     * @return A {@link DigitalTwinCommandResponse} which contains the application/json command invocation response.\n+     */\n+    public DigitalTwinCommandResponse invokeCommand(@NonNull String digitalTwinId, @NonNull String commandName, @NonNull String payload) {\n+        return digitalTwinAsyncClient.invokeCommand(digitalTwinId, commandName, payload)\n+                .toBlocking().single();\n+    }\n+\n+    /**\n+     * Invoke a command on a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param commandName The command to be invoked.\n+     * @param payload The command payload.\n+     * @param options The optional settings for this request.\n+     * @return A {@link ServiceResponseWithHeaders} with {@link DigitalTwinInvokeRootLevelCommandHeaders} and {@link DigitalTwinCommandResponse} which contains the application/json command invocation response.\n+     */\n+    public ServiceResponseWithHeaders<DigitalTwinCommandResponse, DigitalTwinInvokeCommandHeaders> invokeCommandWithResponse(@NonNull String digitalTwinId, @NonNull String commandName, @NonNull String payload, @NonNull DigitalTwinInvokeCommandRequestOptions options) {\n+        return digitalTwinAsyncClient.invokeCommandWithResponse(digitalTwinId, commandName, payload, options)\n+                .toBlocking().single();\n+    }\n+\n+    /**\n+     * Invoke a command on a digital twin component.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param componentName The component name under which the command is defined.\n+     * @param commandName The command to be invoked.\n+     * @return A {@link DigitalTwinCommandResponse} which contains the application/json command invocation response.\n+     */\n+    public DigitalTwinCommandResponse invokeComponentCommand(@NonNull String digitalTwinId, @NonNull String componentName, @NonNull String commandName) {\n+        return digitalTwinAsyncClient.invokeComponentCommand(digitalTwinId, componentName, commandName)\n+                .toBlocking().single();\n+    }\n+\n+    /**\n+     * Invoke a command on a digital twin component.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param componentName The component name under which the command is defined.\n+     * @param commandName The command to be invoked.\n+     * @param payload The command payload.\n+     * @return A {@link DigitalTwinCommandResponse} which contains the application/json command invocation response.\n+     */\n+    public DigitalTwinCommandResponse invokeComponentCommand(@NonNull String digitalTwinId, @NonNull String componentName, @NonNull String commandName, @NonNull String payload) {\n+        return digitalTwinAsyncClient.invokeComponentCommand(digitalTwinId, componentName, commandName, payload)\n+                .toBlocking().single();\n+    }\n+\n+    /**\n+     * Invoke a command on a digital twin component.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param componentName The component name under which the command is defined.\n+     * @param commandName The command to be invoked.\n+     * @param payload The command payload.", "originalCommit": "17dac616bf1f635227e00fbaeaabb9af7c280b11", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTc3Mjg0MQ==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r495772841", "bodyText": "remove extra space", "author": "barustum", "createdAt": "2020-09-28T08:31:12Z", "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/digitaltwin/helpers/UpdateOperationUtility.java", "diffHunk": "@@ -0,0 +1,169 @@\n+// Copyright (c) Microsoft. All rights reserved.\n+// Licensed under the MIT license. See LICENSE file in the project root for full license information.\n+package com.microsoft.azure.sdk.iot.service.digitaltwin.helpers;\n+\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.stream.Collectors;\n+\n+/**\n+ * A utility to create the JSON patch payload required for update operations such as update digital twin\n+ */\n+public final class UpdateOperationUtility {\n+    private static final String ADD = \"add\";\n+    private static final String REPLACE = \"replace\";\n+    private static final String REMOVE = \"remove\";\n+    private static final ObjectMapper mapper = new ObjectMapper();\n+\n+    private final List<UpdateOperation> operations = new ArrayList<>();\n+\n+    /**\n+     * Gets the JSON patch payload required for update operations.\n+     * @return The JSON patch payload required for update operations.\n+     */\n+    public List<Object> getUpdateOperations() {\n+        return operations.stream().map(op -> mapper.convertValue(op, Object.class)).collect(Collectors.toList());\n+    }\n+\n+    /**\n+     * Include an add operation for a property.\n+     * @param path The path to the property to be added.\n+     * @param value The value to update to.\n+     * @return The UpdateOperationUtility object itself.\n+     */\n+    public UpdateOperationUtility appendAddPropertyOperation(String path, Object value) {\n+", "originalCommit": "17dac616bf1f635227e00fbaeaabb9af7c280b11", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTc3NDM5OA==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r495774398", "bodyText": "add space after the copyright block", "author": "barustum", "createdAt": "2020-09-28T08:34:07Z", "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/digitaltwin/helpers/UpdateOperationUtility.java", "diffHunk": "@@ -0,0 +1,169 @@\n+// Copyright (c) Microsoft. All rights reserved.\n+// Licensed under the MIT license. See LICENSE file in the project root for full license information.\n+package com.microsoft.azure.sdk.iot.service.digitaltwin.helpers;", "originalCommit": "17dac616bf1f635227e00fbaeaabb9af7c280b11", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTc3NjE0MQ==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r495776141", "bodyText": "add space after the copyright block", "author": "barustum", "createdAt": "2020-09-28T08:37:06Z", "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/digitaltwin/models/DigitalTwinCommandResponse.java", "diffHunk": "@@ -0,0 +1,16 @@\n+// Copyright (c) Microsoft. All rights reserved.\n+// Licensed under the MIT license. See LICENSE file in the project root for full license information.\n+package com.microsoft.azure.sdk.iot.service.digitaltwin.models;", "originalCommit": "17dac616bf1f635227e00fbaeaabb9af7c280b11", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTc3NjM4OA==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r495776388", "bodyText": "remove space", "author": "barustum", "createdAt": "2020-09-28T08:37:31Z", "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/digitaltwin/models/DigitalTwinInvokeCommandHeaders.java", "diffHunk": "@@ -0,0 +1,13 @@\n+// Copyright (c) Microsoft. All rights reserved.\n+// Licensed under the MIT license. See LICENSE file in the project root for full license information.\n+package com.microsoft.azure.sdk.iot.service.digitaltwin.models;\n+\n+import lombok.Getter;\n+import lombok.Setter;\n+\n+public final class DigitalTwinInvokeCommandHeaders {\n+", "originalCommit": "17dac616bf1f635227e00fbaeaabb9af7c280b11", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTc3NjcwNw==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r495776707", "bodyText": "Add a copyrights block", "author": "barustum", "createdAt": "2020-09-28T08:38:07Z", "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/digitaltwin/models/DigitalTwinMetadata.java", "diffHunk": "@@ -0,0 +1,61 @@\n+package com.microsoft.azure.sdk.iot.service.digitaltwin.models;", "originalCommit": "17dac616bf1f635227e00fbaeaabb9af7c280b11", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "22e0f6f75af6a94164db2141643deb3eb07f4f0f", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/22e0f6f75af6a94164db2141643deb3eb07f4f0f", "message": "feat(digitaltwin): Digitaltwin(pnp) API implementation", "committedDate": "2020-09-30T18:03:27Z", "type": "forcePushed"}, {"oid": "8cb725b42b384d6869580b8ecc69d0bfc3fdc977", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/8cb725b42b384d6869580b8ecc69d0bfc3fdc977", "message": "feat(digitaltwin): Digitaltwin(pnp) API implementation", "committedDate": "2020-09-30T23:19:14Z", "type": "commit"}, {"oid": "5e7682bf693dae0f65b306e13ebe9941605b10b4", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/5e7682bf693dae0f65b306e13ebe9941605b10b4", "message": "Sample and readme updates (#954)", "committedDate": "2020-09-30T23:19:14Z", "type": "commit"}, {"oid": "8baa011533602627fda31bdbbc663b4f13b4070b", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/8baa011533602627fda31bdbbc663b4f13b4070b", "message": "Update E2E test, readme update and async samples fix (#955)", "committedDate": "2020-09-30T23:19:14Z", "type": "commit"}, {"oid": "8baa011533602627fda31bdbbc663b4f13b4070b", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/8baa011533602627fda31bdbbc663b4f13b4070b", "message": "Update E2E test, readme update and async samples fix (#955)", "committedDate": "2020-09-30T23:19:14Z", "type": "forcePushed"}, {"oid": "68fcc40d8173f272a9d9503b4b552b06035536b2", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/68fcc40d8173f272a9d9503b4b552b06035536b2", "message": "changes", "committedDate": "2020-09-30T23:54:59Z", "type": "forcePushed"}, {"oid": "715a10906774d8763ea0b4db3038537c97211809", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/715a10906774d8763ea0b4db3038537c97211809", "message": "changes", "committedDate": "2020-09-30T23:59:44Z", "type": "commit"}, {"oid": "715a10906774d8763ea0b4db3038537c97211809", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/715a10906774d8763ea0b4db3038537c97211809", "message": "changes", "committedDate": "2020-09-30T23:59:44Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg2NzAzOQ==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r497867039", "bodyText": "this looks like 3 spaces intended, and then on line 47 we indent way more than 4. What's up with that?", "author": "drwill-ms", "createdAt": "2020-10-01T00:09:03Z", "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/digitaltwin/DigitalTwinAsyncClient.java", "diffHunk": "@@ -0,0 +1,249 @@\n+// Copyright (c) Microsoft. All rights reserved.\n+// Licensed under the MIT license. See LICENSE file in the project root for full license information.\n+\n+package com.microsoft.azure.sdk.iot.service.digitaltwin;\n+\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.databind.module.SimpleModule;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.authentication.SasTokenProvider;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.authentication.ServiceClientCredentialsProvider;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.authentication.ServiceConnectionString;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.authentication.ServiceConnectionStringParser;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.customized.DigitalTwinGetHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.customized.DigitalTwinUpdateHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.implementation.DigitalTwinsImpl;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.implementation.IotHubGatewayServiceAPIsImpl;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.DigitalTwins;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.models.DigitalTwinInvokeRootLevelCommandHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.serialization.DeserializationHelpers;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.serialization.DigitalTwinStringSerializer;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.models.*;\n+import com.microsoft.azure.sdk.iot.service.exceptions.IotHubException;\n+import com.microsoft.rest.*;\n+import com.microsoft.rest.serializer.JacksonAdapter;\n+import rx.Observable;\n+import rx.schedulers.Schedulers;\n+\n+import java.io.IOException;\n+import java.util.List;\n+\n+import static com.microsoft.azure.sdk.iot.service.digitaltwin.helpers.Tools.*;\n+\n+public class DigitalTwinAsyncClient {\n+    private DigitalTwinsImpl digitalTwin;\n+    private static ObjectMapper objectMapper = new ObjectMapper();\n+\n+     DigitalTwinAsyncClient(String connectionString) {\n+        ServiceConnectionString serviceConnectionString = ServiceConnectionStringParser.parseConnectionString(connectionString);", "originalCommit": "715a10906774d8763ea0b4db3038537c97211809", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzkxMjExNg==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r497912116", "bodyText": "Fixed", "author": "bikamani", "createdAt": "2020-10-01T01:23:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg2NzAzOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg2NzA3OQ==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r497867079", "bodyText": "extra space after method name", "author": "drwill-ms", "createdAt": "2020-10-01T00:09:15Z", "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/digitaltwin/DigitalTwinAsyncClient.java", "diffHunk": "@@ -0,0 +1,249 @@\n+// Copyright (c) Microsoft. All rights reserved.\n+// Licensed under the MIT license. See LICENSE file in the project root for full license information.\n+\n+package com.microsoft.azure.sdk.iot.service.digitaltwin;\n+\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.databind.module.SimpleModule;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.authentication.SasTokenProvider;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.authentication.ServiceClientCredentialsProvider;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.authentication.ServiceConnectionString;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.authentication.ServiceConnectionStringParser;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.customized.DigitalTwinGetHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.customized.DigitalTwinUpdateHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.implementation.DigitalTwinsImpl;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.implementation.IotHubGatewayServiceAPIsImpl;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.DigitalTwins;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.models.DigitalTwinInvokeRootLevelCommandHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.serialization.DeserializationHelpers;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.serialization.DigitalTwinStringSerializer;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.models.*;\n+import com.microsoft.azure.sdk.iot.service.exceptions.IotHubException;\n+import com.microsoft.rest.*;\n+import com.microsoft.rest.serializer.JacksonAdapter;\n+import rx.Observable;\n+import rx.schedulers.Schedulers;\n+\n+import java.io.IOException;\n+import java.util.List;\n+\n+import static com.microsoft.azure.sdk.iot.service.digitaltwin.helpers.Tools.*;\n+\n+public class DigitalTwinAsyncClient {\n+    private DigitalTwinsImpl digitalTwin;\n+    private static ObjectMapper objectMapper = new ObjectMapper();\n+\n+     DigitalTwinAsyncClient(String connectionString) {\n+        ServiceConnectionString serviceConnectionString = ServiceConnectionStringParser.parseConnectionString(connectionString);\n+        SasTokenProvider sasTokenProvider = serviceConnectionString.createSasTokenProvider();\n+        String httpsEndpoint = serviceConnectionString.getHttpsEndpoint();\n+        final SimpleModule stringModule = new SimpleModule(\"String Serializer\");\n+        stringModule.addSerializer(new DigitalTwinStringSerializer(String.class, objectMapper));\n+\n+        JacksonAdapter adapter = new JacksonAdapter();\n+        adapter.serializer().registerModule(stringModule);\n+        RestClient simpleRestClient = new RestClient.Builder()\n+                .withBaseUrl(httpsEndpoint)\n+                .withCredentials(new ServiceClientCredentialsProvider(sasTokenProvider))\n+                .withResponseBuilderFactory(new ServiceResponseBuilder.Factory())\n+                .withSerializerAdapter(adapter)\n+                .build();\n+\n+        IotHubGatewayServiceAPIsImpl protocolLayerClient = new IotHubGatewayServiceAPIsImpl(simpleRestClient);\n+        digitalTwin = new DigitalTwinsImpl(simpleRestClient.retrofit(), protocolLayerClient);\n+    }\n+\n+    /**\n+     * Creates an implementation instance of {@link DigitalTwins} that is used to invoke the Digital Twin features\n+     * @param connectionString The IoTHub connection string\n+     * @return DigitalTwinAsyncClient\n+     */\n+    public static DigitalTwinAsyncClient createFromConnectionString(String connectionString)\n+    {\n+        return new DigitalTwinAsyncClient(connectionString);\n+    }\n+\n+    /**\n+     * Gets a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param clazz The class to deserialize the application/json into.\n+     * @param <T> The generic type to deserialize the application/json into.\n+     * @return The application/json of the digital twin.\n+     */\n+    public <T> Observable<T> getDigitalTwin (String digitalTwinId, Class<T> clazz)", "originalCommit": "715a10906774d8763ea0b4db3038537c97211809", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzkxMjg5OA==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r497912898", "bodyText": "removed here and other places in this class.", "author": "bikamani", "createdAt": "2020-10-01T01:24:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg2NzA3OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg2ODM5OA==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r497868398", "bodyText": "how does this ever get set?", "author": "drwill-ms", "createdAt": "2020-10-01T00:14:31Z", "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/digitaltwin/authentication/StaticSasTokenProvider.java", "diffHunk": "@@ -0,0 +1,19 @@\n+// Copyright (c) Microsoft. All rights reserved.\n+// Licensed under the MIT license. See LICENSE file in the project root for full license information.\n+\n+package com.microsoft.azure.sdk.iot.service.digitaltwin.authentication;\n+\n+import lombok.AllArgsConstructor;\n+import lombok.NonNull;\n+\n+@AllArgsConstructor\n+public class StaticSasTokenProvider implements SasTokenProvider {\n+\n+    @NonNull\n+    private final String sharedAccessSignature;", "originalCommit": "715a10906774d8763ea0b4db3038537c97211809", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg3NzM4Mw==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r497877383", "bodyText": "very good question", "author": "azabbasi", "createdAt": "2020-10-01T00:29:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg2ODM5OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzkxNjA0NQ==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r497916045", "bodyText": "return new StaticSasTokenProvider(sharedAccessSignature);\nin ServiceConnectionString.java\n@AllArgsConstructor generates a constructor with 1 parameter for each field in your class. Fields marked with @nonnull result in null checks on those parameters.", "author": "bikamani", "createdAt": "2020-10-01T01:29:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg2ODM5OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg2OTAyNA==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r497869024", "bodyText": "duplicate summaries on these", "author": "drwill-ms", "createdAt": "2020-10-01T00:15:43Z", "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/digitaltwin/generated/DigitalTwins.java", "diffHunk": "@@ -0,0 +1,370 @@\n+/**\n+ * Code generated by Microsoft (R) AutoRest Code Generator.\n+ * Changes may cause incorrect behavior and will be lost if the code is\n+ * regenerated.\n+ */\n+\n+package com.microsoft.azure.sdk.iot.service.digitaltwin.generated;\n+\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.models.DigitalTwinGetDigitalTwinHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.models.DigitalTwinInvokeComponentCommandHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.models.DigitalTwinInvokeRootLevelCommandHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.models.DigitalTwinUpdateDigitalTwinHeaders;\n+import com.microsoft.rest.RestException;\n+import com.microsoft.rest.ServiceCallback;\n+import com.microsoft.rest.ServiceFuture;\n+import com.microsoft.rest.ServiceResponseWithHeaders;\n+import java.io.IOException;\n+import java.util.List;\n+import rx.Observable;\n+\n+/**\n+ * An instance of this class provides access to all the operations defined\n+ * in DigitalTwins.\n+ */\n+public interface DigitalTwins {\n+    /**\n+     * Gets a digital twin.\n+     *\n+     * @param id Digital Twin ID.\n+     * @throws IllegalArgumentException thrown if parameters fail the validation\n+     * @throws RestException thrown if the request is rejected by server\n+     * @throws RuntimeException all other wrapped checked exceptions if the request fails to be sent\n+     * @return the Object object if successful.\n+     */\n+    Object getDigitalTwin(String id);\n+\n+    /**\n+     * Gets a digital twin.\n+     *\n+     * @param id Digital Twin ID.\n+     * @param serviceCallback the async ServiceCallback to handle successful and failed responses.\n+     * @throws IllegalArgumentException thrown if parameters fail the validation\n+     * @return the {@link ServiceFuture} object\n+     */\n+    ServiceFuture<Object> getDigitalTwinAsync(String id, final ServiceCallback<Object> serviceCallback);\n+\n+    /**\n+     * Gets a digital twin.\n+     *\n+     * @param id Digital Twin ID.\n+     * @throws IllegalArgumentException thrown if parameters fail the validation\n+     * @return the observable to the Object object\n+     */\n+    Observable<Object> getDigitalTwinAsync(String id);\n+\n+    /**\n+     * Gets a digital twin.\n+     *\n+     * @param id Digital Twin ID.\n+     * @throws IllegalArgumentException thrown if parameters fail the validation\n+     * @return the observable to the Object object\n+     */\n+    Observable<ServiceResponseWithHeaders<Object, DigitalTwinGetDigitalTwinHeaders>> getDigitalTwinWithServiceResponseAsync(String id);\n+\n+    /**\n+     * Updates a digital twin.\n+     *\n+     * @param id Digital Twin ID.\n+     * @param digitalTwinPatch json-patch contents to update.\n+     * @throws IllegalArgumentException thrown if parameters fail the validation\n+     * @throws RestException thrown if the request is rejected by server\n+     * @throws RuntimeException all other wrapped checked exceptions if the request fails to be sent\n+     */\n+    void updateDigitalTwin(String id, List<Object> digitalTwinPatch);\n+\n+    /**\n+     * Updates a digital twin.\n+     *\n+     * @param id Digital Twin ID.\n+     * @param digitalTwinPatch json-patch contents to update.\n+     * @param serviceCallback the async ServiceCallback to handle successful and failed responses.\n+     * @throws IllegalArgumentException thrown if parameters fail the validation\n+     * @return the {@link ServiceFuture} object\n+     */\n+    ServiceFuture<Void> updateDigitalTwinAsync(String id, List<Object> digitalTwinPatch, final ServiceCallback<Void> serviceCallback);\n+\n+    /**\n+     * Updates a digital twin.\n+     *\n+     * @param id Digital Twin ID.\n+     * @param digitalTwinPatch json-patch contents to update.\n+     * @throws IllegalArgumentException thrown if parameters fail the validation\n+     * @return the {@link ServiceResponseWithHeaders} object if successful.\n+     */\n+    Observable<Void> updateDigitalTwinAsync(String id, List<Object> digitalTwinPatch);\n+\n+    /**\n+     * Updates a digital twin.\n+     *\n+     * @param id Digital Twin ID.\n+     * @param digitalTwinPatch json-patch contents to update.\n+     * @throws IllegalArgumentException thrown if parameters fail the validation\n+     * @return the {@link ServiceResponseWithHeaders} object if successful.\n+     */\n+    Observable<ServiceResponseWithHeaders<Void, DigitalTwinUpdateDigitalTwinHeaders>> updateDigitalTwinWithServiceResponseAsync(String id, List<Object> digitalTwinPatch);\n+    /**\n+     * Updates a digital twin.\n+     *\n+     * @param id Digital Twin ID.\n+     * @param digitalTwinPatch json-patch contents to update.\n+     * @param ifMatch the String value\n+     * @throws IllegalArgumentException thrown if parameters fail the validation\n+     * @throws RestException thrown if the request is rejected by server\n+     * @throws RuntimeException all other wrapped checked exceptions if the request fails to be sent\n+     */\n+    void updateDigitalTwin(String id, List<Object> digitalTwinPatch, String ifMatch);\n+\n+    /**\n+     * Updates a digital twin.\n+     *\n+     * @param id Digital Twin ID.\n+     * @param digitalTwinPatch json-patch contents to update.\n+     * @param ifMatch the String value\n+     * @param serviceCallback the async ServiceCallback to handle successful and failed responses.\n+     * @throws IllegalArgumentException thrown if parameters fail the validation\n+     * @return the {@link ServiceFuture} object\n+     */\n+    ServiceFuture<Void> updateDigitalTwinAsync(String id, List<Object> digitalTwinPatch, String ifMatch, final ServiceCallback<Void> serviceCallback);\n+\n+    /**\n+     * Updates a digital twin.\n+     *\n+     * @param id Digital Twin ID.\n+     * @param digitalTwinPatch json-patch contents to update.\n+     * @param ifMatch the String value\n+     * @throws IllegalArgumentException thrown if parameters fail the validation\n+     * @return the {@link ServiceResponseWithHeaders} object if successful.\n+     */\n+    Observable<Void> updateDigitalTwinAsync(String id, List<Object> digitalTwinPatch, String ifMatch);\n+\n+    /**\n+     * Updates a digital twin.\n+     *\n+     * @param id Digital Twin ID.\n+     * @param digitalTwinPatch json-patch contents to update.\n+     * @param ifMatch the String value\n+     * @throws IllegalArgumentException thrown if parameters fail the validation\n+     * @return the {@link ServiceResponseWithHeaders} object if successful.\n+     */\n+    Observable<ServiceResponseWithHeaders<Void, DigitalTwinUpdateDigitalTwinHeaders>> updateDigitalTwinWithServiceResponseAsync(String id, List<Object> digitalTwinPatch, String ifMatch);\n+\n+    /**\n+     * Invoke a digital twin root level command.\n+     * Invoke a digital twin root level command.\n+     *\n+     * @param id the String value\n+     * @param commandName the String value\n+     * @throws IllegalArgumentException thrown if parameters fail the validation\n+     * @throws RestException thrown if the request is rejected by server\n+     * @throws RuntimeException all other wrapped checked exceptions if the request fails to be sent\n+     * @return the Object object if successful.\n+     */\n+    Object invokeRootLevelCommand(String id, String commandName);\n+\n+    /**\n+     * Invoke a digital twin root level command.\n+     * Invoke a digital twin root level command.", "originalCommit": "715a10906774d8763ea0b4db3038537c97211809", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg3NTk3Ng==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r497875976", "bodyText": "this is generated code, I wonder why this happened.", "author": "azabbasi", "createdAt": "2020-10-01T00:26:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg2OTAyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg3NjE4NQ==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r497876185", "bodyText": "same thing on line 153", "author": "azabbasi", "createdAt": "2020-10-01T00:27:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg2OTAyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg3NjMyMw==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r497876323", "bodyText": "and everywhere on this file.", "author": "azabbasi", "createdAt": "2020-10-01T00:27:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg2OTAyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg4MzE3Mg==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r497883172", "bodyText": "I'm guessing both summary and description have the same value?", "author": "drwill-ms", "createdAt": "2020-10-01T00:38:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg2OTAyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzkxNjYzMg==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r497916632", "bodyText": "Even if I remove it now, when we generate again it may be there. Do we want to manually update these generated files every time?", "author": "bikamani", "createdAt": "2020-10-01T01:30:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg2OTAyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzkxNzMxOA==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r497917318", "bodyText": "For now I have removed here and below.", "author": "bikamani", "createdAt": "2020-10-01T01:31:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg2OTAyNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg2ODA5MQ==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r497868091", "bodyText": "nit: indentation is off here", "author": "azabbasi", "createdAt": "2020-10-01T00:13:19Z", "path": "iot-e2e-tests/common/src/test/java/tests/integration/com/microsoft/azure/sdk/iot/iothub/twin/TwinPnPTests.java", "diffHunk": "@@ -0,0 +1,237 @@\n+// Copyright (c) Microsoft. All rights reserved.\n+// Licensed under the MIT license. See LICENSE file in the project root for full license information.\n+\n+package tests.integration.com.microsoft.azure.sdk.iot.iothub.twin;\n+\n+import com.microsoft.azure.sdk.iot.device.*;\n+import com.microsoft.azure.sdk.iot.service.BaseDevice;\n+import com.microsoft.azure.sdk.iot.service.RegistryManager;\n+import com.microsoft.azure.sdk.iot.service.auth.AuthenticationType;\n+import com.microsoft.azure.sdk.iot.service.devicetwin.DeviceTwin;\n+import com.microsoft.azure.sdk.iot.service.devicetwin.DeviceTwinDevice;\n+import com.microsoft.azure.sdk.iot.service.Device;\n+import com.microsoft.azure.sdk.iot.service.Module;\n+import org.junit.After;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.junit.runners.Parameterized;\n+import tests.integration.com.microsoft.azure.sdk.iot.helpers.*;\n+import tests.integration.com.microsoft.azure.sdk.iot.helpers.annotations.IotHubTest;\n+import tests.integration.com.microsoft.azure.sdk.iot.helpers.annotations.StandardTierHubOnlyTest;\n+import tests.integration.com.microsoft.azure.sdk.iot.helpers.Tools;\n+\n+import javax.net.ssl.SSLContext;\n+import java.io.IOException;\n+import java.util.*;\n+\n+import static com.microsoft.azure.sdk.iot.device.IotHubClientProtocol.*;\n+import static com.microsoft.azure.sdk.iot.device.IotHubClientProtocol.MQTT_WS;\n+import static com.microsoft.azure.sdk.iot.service.auth.AuthenticationType.SAS;\n+import static com.microsoft.azure.sdk.iot.service.auth.AuthenticationType.SELF_SIGNED;\n+import static org.junit.Assert.assertEquals;\n+\n+/**\n+ * Test class containing all tests to be run for PnP.\n+ */\n+@IotHubTest\n+@StandardTierHubOnlyTest\n+@RunWith(Parameterized.class)\n+public class TwinPnPTests extends IntegrationTest\n+{\n+    protected static String iotHubConnectionString = \"\";\n+    private static RegistryManager registryManager;\n+    private String ModelId;\n+\n+    @Parameterized.Parameters(name = \"{0}_{1}_{2}\")\n+    public static Collection inputs() throws IOException\n+    {\n+        iotHubConnectionString = Tools.retrieveEnvironmentVariableValue(TestConstants.IOT_HUB_CONNECTION_STRING_ENV_VAR_NAME);\n+        isBasicTierHub = Boolean.parseBoolean(Tools.retrieveEnvironmentVariableValue(TestConstants.IS_BASIC_TIER_HUB_ENV_VAR_NAME));\n+\n+        registryManager = RegistryManager.createFromConnectionString(iotHubConnectionString);\n+\n+        X509CertificateGenerator certificateGenerator = new X509CertificateGenerator();\n+        String publicKeyCert = certificateGenerator.getPublicCertificate();\n+        String privateKey = certificateGenerator.getPrivateKey();\n+        String x509Thumbprint = certificateGenerator.getX509Thumbprint();\n+\n+        List inputs = new ArrayList();\n+        inputs.addAll(Arrays.asList(\n+                new Object[][]", "originalCommit": "715a10906774d8763ea0b4db3038537c97211809", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg2ODEzNQ==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r497868135", "bodyText": "and below", "author": "azabbasi", "createdAt": "2020-10-01T00:13:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg2ODA5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzkxNzcxMg==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r497917712", "bodyText": "done", "author": "bikamani", "createdAt": "2020-10-01T01:32:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg2ODA5MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg2OTk2NQ==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r497869965", "bodyText": "extra line", "author": "azabbasi", "createdAt": "2020-10-01T00:17:09Z", "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/digitaltwin/DigitalTwinAsyncClient.java", "diffHunk": "@@ -0,0 +1,249 @@\n+// Copyright (c) Microsoft. All rights reserved.\n+// Licensed under the MIT license. See LICENSE file in the project root for full license information.\n+\n+package com.microsoft.azure.sdk.iot.service.digitaltwin;\n+\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.databind.module.SimpleModule;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.authentication.SasTokenProvider;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.authentication.ServiceClientCredentialsProvider;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.authentication.ServiceConnectionString;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.authentication.ServiceConnectionStringParser;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.customized.DigitalTwinGetHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.customized.DigitalTwinUpdateHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.implementation.DigitalTwinsImpl;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.implementation.IotHubGatewayServiceAPIsImpl;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.DigitalTwins;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.models.DigitalTwinInvokeRootLevelCommandHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.serialization.DeserializationHelpers;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.serialization.DigitalTwinStringSerializer;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.models.*;\n+import com.microsoft.azure.sdk.iot.service.exceptions.IotHubException;\n+import com.microsoft.rest.*;\n+import com.microsoft.rest.serializer.JacksonAdapter;\n+import rx.Observable;\n+import rx.schedulers.Schedulers;\n+\n+import java.io.IOException;\n+import java.util.List;\n+\n+import static com.microsoft.azure.sdk.iot.service.digitaltwin.helpers.Tools.*;\n+\n+public class DigitalTwinAsyncClient {\n+    private DigitalTwinsImpl digitalTwin;\n+    private static ObjectMapper objectMapper = new ObjectMapper();\n+\n+     DigitalTwinAsyncClient(String connectionString) {\n+        ServiceConnectionString serviceConnectionString = ServiceConnectionStringParser.parseConnectionString(connectionString);\n+        SasTokenProvider sasTokenProvider = serviceConnectionString.createSasTokenProvider();\n+        String httpsEndpoint = serviceConnectionString.getHttpsEndpoint();\n+        final SimpleModule stringModule = new SimpleModule(\"String Serializer\");\n+        stringModule.addSerializer(new DigitalTwinStringSerializer(String.class, objectMapper));\n+\n+        JacksonAdapter adapter = new JacksonAdapter();\n+        adapter.serializer().registerModule(stringModule);\n+        RestClient simpleRestClient = new RestClient.Builder()\n+                .withBaseUrl(httpsEndpoint)\n+                .withCredentials(new ServiceClientCredentialsProvider(sasTokenProvider))\n+                .withResponseBuilderFactory(new ServiceResponseBuilder.Factory())\n+                .withSerializerAdapter(adapter)\n+                .build();\n+\n+        IotHubGatewayServiceAPIsImpl protocolLayerClient = new IotHubGatewayServiceAPIsImpl(simpleRestClient);\n+        digitalTwin = new DigitalTwinsImpl(simpleRestClient.retrofit(), protocolLayerClient);\n+    }\n+\n+    /**\n+     * Creates an implementation instance of {@link DigitalTwins} that is used to invoke the Digital Twin features\n+     * @param connectionString The IoTHub connection string\n+     * @return DigitalTwinAsyncClient\n+     */\n+    public static DigitalTwinAsyncClient createFromConnectionString(String connectionString)\n+    {\n+        return new DigitalTwinAsyncClient(connectionString);\n+    }\n+\n+    /**\n+     * Gets a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param clazz The class to deserialize the application/json into.\n+     * @param <T> The generic type to deserialize the application/json into.\n+     * @return The application/json of the digital twin.\n+     */\n+    public <T> Observable<T> getDigitalTwin (String digitalTwinId, Class<T> clazz)\n+    {\n+        return getDigitalTwinWithResponse(digitalTwinId, clazz)\n+                .map(response -> response.body());\n+    }\n+\n+    /**\n+     * Gets a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param clazz The class to deserialize the application/json into.\n+     * @param <T> The generic type to deserialize the application/json into.\n+     * @return A {@link ServiceResponseWithHeaders} representing deserialized application/json of the digital twin with {@link DigitalTwinGetHeaders}.\n+     */\n+    public <T> Observable<ServiceResponseWithHeaders<T, DigitalTwinGetHeaders>> getDigitalTwinWithResponse (String digitalTwinId, Class<T> clazz)\n+    {\n+        if(clazz == null)\n+        {\n+            throw new IllegalArgumentException(\"Parameter clazz is required and cannot be null.\");\n+        }\n+\n+        return digitalTwin.getDigitalTwinWithServiceResponseAsync(digitalTwinId)\n+                .flatMap(FUNC_TO_DIGITAL_TWIN_GET_RESPONSE)\n+                .flatMap(response -> {\n+                    try {\n+                        T genericResponse = DeserializationHelpers.castObject(objectMapper, response.body(), clazz);\n+                        return Observable.just(new ServiceResponseWithHeaders<>(genericResponse, response.headers(), response.response()));\n+                    } catch (JsonProcessingException e) {\n+                        return Observable.error(new IotHubException(\"Failed to parse the resonse\"));\n+                    }\n+", "originalCommit": "715a10906774d8763ea0b4db3038537c97211809", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg3MDUxOA==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r497870518", "bodyText": "I think instead of null you should create the options with default values and pass it in.", "author": "azabbasi", "createdAt": "2020-10-01T00:18:02Z", "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/digitaltwin/DigitalTwinAsyncClient.java", "diffHunk": "@@ -0,0 +1,249 @@\n+// Copyright (c) Microsoft. All rights reserved.\n+// Licensed under the MIT license. See LICENSE file in the project root for full license information.\n+\n+package com.microsoft.azure.sdk.iot.service.digitaltwin;\n+\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.databind.module.SimpleModule;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.authentication.SasTokenProvider;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.authentication.ServiceClientCredentialsProvider;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.authentication.ServiceConnectionString;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.authentication.ServiceConnectionStringParser;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.customized.DigitalTwinGetHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.customized.DigitalTwinUpdateHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.implementation.DigitalTwinsImpl;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.implementation.IotHubGatewayServiceAPIsImpl;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.DigitalTwins;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.models.DigitalTwinInvokeRootLevelCommandHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.serialization.DeserializationHelpers;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.serialization.DigitalTwinStringSerializer;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.models.*;\n+import com.microsoft.azure.sdk.iot.service.exceptions.IotHubException;\n+import com.microsoft.rest.*;\n+import com.microsoft.rest.serializer.JacksonAdapter;\n+import rx.Observable;\n+import rx.schedulers.Schedulers;\n+\n+import java.io.IOException;\n+import java.util.List;\n+\n+import static com.microsoft.azure.sdk.iot.service.digitaltwin.helpers.Tools.*;\n+\n+public class DigitalTwinAsyncClient {\n+    private DigitalTwinsImpl digitalTwin;\n+    private static ObjectMapper objectMapper = new ObjectMapper();\n+\n+     DigitalTwinAsyncClient(String connectionString) {\n+        ServiceConnectionString serviceConnectionString = ServiceConnectionStringParser.parseConnectionString(connectionString);\n+        SasTokenProvider sasTokenProvider = serviceConnectionString.createSasTokenProvider();\n+        String httpsEndpoint = serviceConnectionString.getHttpsEndpoint();\n+        final SimpleModule stringModule = new SimpleModule(\"String Serializer\");\n+        stringModule.addSerializer(new DigitalTwinStringSerializer(String.class, objectMapper));\n+\n+        JacksonAdapter adapter = new JacksonAdapter();\n+        adapter.serializer().registerModule(stringModule);\n+        RestClient simpleRestClient = new RestClient.Builder()\n+                .withBaseUrl(httpsEndpoint)\n+                .withCredentials(new ServiceClientCredentialsProvider(sasTokenProvider))\n+                .withResponseBuilderFactory(new ServiceResponseBuilder.Factory())\n+                .withSerializerAdapter(adapter)\n+                .build();\n+\n+        IotHubGatewayServiceAPIsImpl protocolLayerClient = new IotHubGatewayServiceAPIsImpl(simpleRestClient);\n+        digitalTwin = new DigitalTwinsImpl(simpleRestClient.retrofit(), protocolLayerClient);\n+    }\n+\n+    /**\n+     * Creates an implementation instance of {@link DigitalTwins} that is used to invoke the Digital Twin features\n+     * @param connectionString The IoTHub connection string\n+     * @return DigitalTwinAsyncClient\n+     */\n+    public static DigitalTwinAsyncClient createFromConnectionString(String connectionString)\n+    {\n+        return new DigitalTwinAsyncClient(connectionString);\n+    }\n+\n+    /**\n+     * Gets a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param clazz The class to deserialize the application/json into.\n+     * @param <T> The generic type to deserialize the application/json into.\n+     * @return The application/json of the digital twin.\n+     */\n+    public <T> Observable<T> getDigitalTwin (String digitalTwinId, Class<T> clazz)\n+    {\n+        return getDigitalTwinWithResponse(digitalTwinId, clazz)\n+                .map(response -> response.body());\n+    }\n+\n+    /**\n+     * Gets a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param clazz The class to deserialize the application/json into.\n+     * @param <T> The generic type to deserialize the application/json into.\n+     * @return A {@link ServiceResponseWithHeaders} representing deserialized application/json of the digital twin with {@link DigitalTwinGetHeaders}.\n+     */\n+    public <T> Observable<ServiceResponseWithHeaders<T, DigitalTwinGetHeaders>> getDigitalTwinWithResponse (String digitalTwinId, Class<T> clazz)\n+    {\n+        if(clazz == null)\n+        {\n+            throw new IllegalArgumentException(\"Parameter clazz is required and cannot be null.\");\n+        }\n+\n+        return digitalTwin.getDigitalTwinWithServiceResponseAsync(digitalTwinId)\n+                .flatMap(FUNC_TO_DIGITAL_TWIN_GET_RESPONSE)\n+                .flatMap(response -> {\n+                    try {\n+                        T genericResponse = DeserializationHelpers.castObject(objectMapper, response.body(), clazz);\n+                        return Observable.just(new ServiceResponseWithHeaders<>(genericResponse, response.headers(), response.response()));\n+                    } catch (JsonProcessingException e) {\n+                        return Observable.error(new IotHubException(\"Failed to parse the resonse\"));\n+                    }\n+\n+                })\n+                .subscribeOn(Schedulers.io());\n+    }\n+\n+    /**\n+     * Updates a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param digitalTwinUpdateOperations The JSON patch to apply to the specified digital twin. This argument can be created using {@link UpdateOperationUtility}.\n+     * @return void.\n+     */\n+    public Observable<Void> updateDigitalTwin (String digitalTwinId, List<Object> digitalTwinUpdateOperations)\n+    {\n+        return updateDigitalTwinWithResponse(digitalTwinId, digitalTwinUpdateOperations, null)\n+                .map(response -> response.body());\n+    }\n+\n+    /**\n+     * Updates a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param digitalTwinUpdateOperations The JSON patch to apply to the specified digital twin. This argument can be created using {@link UpdateOperationUtility}.\n+     * @return A {@link ServiceResponseWithHeaders} with {@link DigitalTwinUpdateHeaders}.\n+     */\n+    public Observable<ServiceResponseWithHeaders<Void, DigitalTwinUpdateHeaders>> updateDigitalTwinWithResponse (String digitalTwinId, List<Object> digitalTwinUpdateOperations)\n+    {\n+        return updateDigitalTwinWithResponse(digitalTwinId, digitalTwinUpdateOperations, null);", "originalCommit": "715a10906774d8763ea0b4db3038537c97211809", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg3MjA2Ng==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r497872066", "bodyText": "consider that for all APIs", "author": "azabbasi", "createdAt": "2020-10-01T00:20:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg3MDUxOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg3MTA1NQ==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r497871055", "bodyText": "can we be consistent with the track 2 and the C# sdk and call this _protocolLayer?", "author": "azabbasi", "createdAt": "2020-10-01T00:18:56Z", "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/digitaltwin/DigitalTwinAsyncClient.java", "diffHunk": "@@ -0,0 +1,249 @@\n+// Copyright (c) Microsoft. All rights reserved.\n+// Licensed under the MIT license. See LICENSE file in the project root for full license information.\n+\n+package com.microsoft.azure.sdk.iot.service.digitaltwin;\n+\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.databind.module.SimpleModule;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.authentication.SasTokenProvider;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.authentication.ServiceClientCredentialsProvider;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.authentication.ServiceConnectionString;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.authentication.ServiceConnectionStringParser;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.customized.DigitalTwinGetHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.customized.DigitalTwinUpdateHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.implementation.DigitalTwinsImpl;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.implementation.IotHubGatewayServiceAPIsImpl;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.DigitalTwins;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.models.DigitalTwinInvokeRootLevelCommandHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.serialization.DeserializationHelpers;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.serialization.DigitalTwinStringSerializer;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.models.*;\n+import com.microsoft.azure.sdk.iot.service.exceptions.IotHubException;\n+import com.microsoft.rest.*;\n+import com.microsoft.rest.serializer.JacksonAdapter;\n+import rx.Observable;\n+import rx.schedulers.Schedulers;\n+\n+import java.io.IOException;\n+import java.util.List;\n+\n+import static com.microsoft.azure.sdk.iot.service.digitaltwin.helpers.Tools.*;\n+\n+public class DigitalTwinAsyncClient {\n+    private DigitalTwinsImpl digitalTwin;", "originalCommit": "715a10906774d8763ea0b4db3038537c97211809", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzkyMjA0NQ==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r497922045", "bodyText": "done", "author": "bikamani", "createdAt": "2020-10-01T01:38:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg3MTA1NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg3MTQwMg==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r497871402", "bodyText": "space after if", "author": "azabbasi", "createdAt": "2020-10-01T00:19:31Z", "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/digitaltwin/DigitalTwinAsyncClient.java", "diffHunk": "@@ -0,0 +1,249 @@\n+// Copyright (c) Microsoft. All rights reserved.\n+// Licensed under the MIT license. See LICENSE file in the project root for full license information.\n+\n+package com.microsoft.azure.sdk.iot.service.digitaltwin;\n+\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.databind.module.SimpleModule;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.authentication.SasTokenProvider;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.authentication.ServiceClientCredentialsProvider;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.authentication.ServiceConnectionString;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.authentication.ServiceConnectionStringParser;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.customized.DigitalTwinGetHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.customized.DigitalTwinUpdateHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.implementation.DigitalTwinsImpl;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.implementation.IotHubGatewayServiceAPIsImpl;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.DigitalTwins;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.models.DigitalTwinInvokeRootLevelCommandHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.serialization.DeserializationHelpers;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.serialization.DigitalTwinStringSerializer;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.models.*;\n+import com.microsoft.azure.sdk.iot.service.exceptions.IotHubException;\n+import com.microsoft.rest.*;\n+import com.microsoft.rest.serializer.JacksonAdapter;\n+import rx.Observable;\n+import rx.schedulers.Schedulers;\n+\n+import java.io.IOException;\n+import java.util.List;\n+\n+import static com.microsoft.azure.sdk.iot.service.digitaltwin.helpers.Tools.*;\n+\n+public class DigitalTwinAsyncClient {\n+    private DigitalTwinsImpl digitalTwin;\n+    private static ObjectMapper objectMapper = new ObjectMapper();\n+\n+     DigitalTwinAsyncClient(String connectionString) {\n+        ServiceConnectionString serviceConnectionString = ServiceConnectionStringParser.parseConnectionString(connectionString);\n+        SasTokenProvider sasTokenProvider = serviceConnectionString.createSasTokenProvider();\n+        String httpsEndpoint = serviceConnectionString.getHttpsEndpoint();\n+        final SimpleModule stringModule = new SimpleModule(\"String Serializer\");\n+        stringModule.addSerializer(new DigitalTwinStringSerializer(String.class, objectMapper));\n+\n+        JacksonAdapter adapter = new JacksonAdapter();\n+        adapter.serializer().registerModule(stringModule);\n+        RestClient simpleRestClient = new RestClient.Builder()\n+                .withBaseUrl(httpsEndpoint)\n+                .withCredentials(new ServiceClientCredentialsProvider(sasTokenProvider))\n+                .withResponseBuilderFactory(new ServiceResponseBuilder.Factory())\n+                .withSerializerAdapter(adapter)\n+                .build();\n+\n+        IotHubGatewayServiceAPIsImpl protocolLayerClient = new IotHubGatewayServiceAPIsImpl(simpleRestClient);\n+        digitalTwin = new DigitalTwinsImpl(simpleRestClient.retrofit(), protocolLayerClient);\n+    }\n+\n+    /**\n+     * Creates an implementation instance of {@link DigitalTwins} that is used to invoke the Digital Twin features\n+     * @param connectionString The IoTHub connection string\n+     * @return DigitalTwinAsyncClient\n+     */\n+    public static DigitalTwinAsyncClient createFromConnectionString(String connectionString)\n+    {\n+        return new DigitalTwinAsyncClient(connectionString);\n+    }\n+\n+    /**\n+     * Gets a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param clazz The class to deserialize the application/json into.\n+     * @param <T> The generic type to deserialize the application/json into.\n+     * @return The application/json of the digital twin.\n+     */\n+    public <T> Observable<T> getDigitalTwin (String digitalTwinId, Class<T> clazz)\n+    {\n+        return getDigitalTwinWithResponse(digitalTwinId, clazz)\n+                .map(response -> response.body());\n+    }\n+\n+    /**\n+     * Gets a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param clazz The class to deserialize the application/json into.\n+     * @param <T> The generic type to deserialize the application/json into.\n+     * @return A {@link ServiceResponseWithHeaders} representing deserialized application/json of the digital twin with {@link DigitalTwinGetHeaders}.\n+     */\n+    public <T> Observable<ServiceResponseWithHeaders<T, DigitalTwinGetHeaders>> getDigitalTwinWithResponse (String digitalTwinId, Class<T> clazz)\n+    {\n+        if(clazz == null)\n+        {\n+            throw new IllegalArgumentException(\"Parameter clazz is required and cannot be null.\");\n+        }\n+\n+        return digitalTwin.getDigitalTwinWithServiceResponseAsync(digitalTwinId)\n+                .flatMap(FUNC_TO_DIGITAL_TWIN_GET_RESPONSE)\n+                .flatMap(response -> {\n+                    try {\n+                        T genericResponse = DeserializationHelpers.castObject(objectMapper, response.body(), clazz);\n+                        return Observable.just(new ServiceResponseWithHeaders<>(genericResponse, response.headers(), response.response()));\n+                    } catch (JsonProcessingException e) {\n+                        return Observable.error(new IotHubException(\"Failed to parse the resonse\"));\n+                    }\n+\n+                })\n+                .subscribeOn(Schedulers.io());\n+    }\n+\n+    /**\n+     * Updates a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param digitalTwinUpdateOperations The JSON patch to apply to the specified digital twin. This argument can be created using {@link UpdateOperationUtility}.\n+     * @return void.\n+     */\n+    public Observable<Void> updateDigitalTwin (String digitalTwinId, List<Object> digitalTwinUpdateOperations)\n+    {\n+        return updateDigitalTwinWithResponse(digitalTwinId, digitalTwinUpdateOperations, null)\n+                .map(response -> response.body());\n+    }\n+\n+    /**\n+     * Updates a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param digitalTwinUpdateOperations The JSON patch to apply to the specified digital twin. This argument can be created using {@link UpdateOperationUtility}.\n+     * @return A {@link ServiceResponseWithHeaders} with {@link DigitalTwinUpdateHeaders}.\n+     */\n+    public Observable<ServiceResponseWithHeaders<Void, DigitalTwinUpdateHeaders>> updateDigitalTwinWithResponse (String digitalTwinId, List<Object> digitalTwinUpdateOperations)\n+    {\n+        return updateDigitalTwinWithResponse(digitalTwinId, digitalTwinUpdateOperations, null);\n+    }\n+\n+    /**\n+     * Updates a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param digitalTwinUpdateOperations The JSON patch to apply to the specified digital twin. This argument can be created using {@link UpdateOperationUtility}.\n+     * @param options The optional settings for this request.\n+     * @return A {@link ServiceResponseWithHeaders} with {@link DigitalTwinUpdateHeaders}.\n+     */\n+    public Observable<ServiceResponseWithHeaders<Void, DigitalTwinUpdateHeaders>> updateDigitalTwinWithResponse (String digitalTwinId, List<Object> digitalTwinUpdateOperations, DigitalTwinUpdateRequestOptions options)\n+    {\n+        String ifMatch = options != null ? options.getIfMatch() : null;\n+        return digitalTwin.updateDigitalTwinWithServiceResponseAsync(digitalTwinId, digitalTwinUpdateOperations, ifMatch)\n+                .flatMap(FUNC_TO_DIGITAL_TWIN_UPDATE_RESPONSE)\n+                .subscribeOn(Schedulers.io());\n+    }\n+\n+    /**\n+     * Invoke a command on a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param commandName The command to be invoked.\n+     * @return A {@link DigitalTwinCommandResponse} which contains the application/json command invocation response.\n+     * @throws IOException can be thrown if the provided payload cannot be deserialized to an Object.\n+     */\n+    public Observable<DigitalTwinCommandResponse> invokeCommand (String digitalTwinId, String commandName) throws IOException {\n+        return invokeCommandWithResponse(digitalTwinId, commandName, null, null)\n+                .map(response -> response.body());\n+    }\n+\n+    /**\n+     * Invoke a command on a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param commandName The command to be invoked.\n+     * @param payload The command payload.\n+     * @return A {@link DigitalTwinCommandResponse} which contains the application/json command invocation response.\n+     * @throws IOException can be thrown if the provided payload cannot be deserialized into a valid Json object.\n+     */\n+    public Observable<DigitalTwinCommandResponse> invokeCommand (String digitalTwinId, String commandName, String payload) throws IOException {\n+        // Retrofit does not work well with null in body\n+        return invokeCommandWithResponse(digitalTwinId, commandName, payload, null)\n+                .map(response -> response.body());\n+    }\n+\n+    /**\n+     * Invoke a command on a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param commandName The command to be invoked.\n+     * @param payload The command payload.\n+     * @param options The optional settings for this request.\n+     * @return A {@link ServiceResponseWithHeaders} with {@link DigitalTwinInvokeRootLevelCommandHeaders} and {@link DigitalTwinCommandResponse} which contains the application/json command invocation response.\n+     * @throws IOException can be thrown if the provided payload cannot be deserialized into a valid Json object.\n+     */\n+    public Observable<ServiceResponseWithHeaders<DigitalTwinCommandResponse, DigitalTwinInvokeCommandHeaders>> invokeCommandWithResponse (String digitalTwinId, String commandName, String payload, DigitalTwinInvokeCommandRequestOptions options) throws IOException {\n+        if(options == null)", "originalCommit": "715a10906774d8763ea0b4db3038537c97211809", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzkyMjYzNA==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r497922634", "bodyText": "done here and other places", "author": "bikamani", "createdAt": "2020-10-01T01:40:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg3MTQwMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg3MTYyOQ==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r497871629", "bodyText": "space after if", "author": "azabbasi", "createdAt": "2020-10-01T00:19:51Z", "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/digitaltwin/DigitalTwinAsyncClient.java", "diffHunk": "@@ -0,0 +1,249 @@\n+// Copyright (c) Microsoft. All rights reserved.\n+// Licensed under the MIT license. See LICENSE file in the project root for full license information.\n+\n+package com.microsoft.azure.sdk.iot.service.digitaltwin;\n+\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.databind.module.SimpleModule;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.authentication.SasTokenProvider;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.authentication.ServiceClientCredentialsProvider;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.authentication.ServiceConnectionString;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.authentication.ServiceConnectionStringParser;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.customized.DigitalTwinGetHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.customized.DigitalTwinUpdateHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.implementation.DigitalTwinsImpl;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.implementation.IotHubGatewayServiceAPIsImpl;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.DigitalTwins;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.models.DigitalTwinInvokeRootLevelCommandHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.serialization.DeserializationHelpers;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.serialization.DigitalTwinStringSerializer;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.models.*;\n+import com.microsoft.azure.sdk.iot.service.exceptions.IotHubException;\n+import com.microsoft.rest.*;\n+import com.microsoft.rest.serializer.JacksonAdapter;\n+import rx.Observable;\n+import rx.schedulers.Schedulers;\n+\n+import java.io.IOException;\n+import java.util.List;\n+\n+import static com.microsoft.azure.sdk.iot.service.digitaltwin.helpers.Tools.*;\n+\n+public class DigitalTwinAsyncClient {\n+    private DigitalTwinsImpl digitalTwin;\n+    private static ObjectMapper objectMapper = new ObjectMapper();\n+\n+     DigitalTwinAsyncClient(String connectionString) {\n+        ServiceConnectionString serviceConnectionString = ServiceConnectionStringParser.parseConnectionString(connectionString);\n+        SasTokenProvider sasTokenProvider = serviceConnectionString.createSasTokenProvider();\n+        String httpsEndpoint = serviceConnectionString.getHttpsEndpoint();\n+        final SimpleModule stringModule = new SimpleModule(\"String Serializer\");\n+        stringModule.addSerializer(new DigitalTwinStringSerializer(String.class, objectMapper));\n+\n+        JacksonAdapter adapter = new JacksonAdapter();\n+        adapter.serializer().registerModule(stringModule);\n+        RestClient simpleRestClient = new RestClient.Builder()\n+                .withBaseUrl(httpsEndpoint)\n+                .withCredentials(new ServiceClientCredentialsProvider(sasTokenProvider))\n+                .withResponseBuilderFactory(new ServiceResponseBuilder.Factory())\n+                .withSerializerAdapter(adapter)\n+                .build();\n+\n+        IotHubGatewayServiceAPIsImpl protocolLayerClient = new IotHubGatewayServiceAPIsImpl(simpleRestClient);\n+        digitalTwin = new DigitalTwinsImpl(simpleRestClient.retrofit(), protocolLayerClient);\n+    }\n+\n+    /**\n+     * Creates an implementation instance of {@link DigitalTwins} that is used to invoke the Digital Twin features\n+     * @param connectionString The IoTHub connection string\n+     * @return DigitalTwinAsyncClient\n+     */\n+    public static DigitalTwinAsyncClient createFromConnectionString(String connectionString)\n+    {\n+        return new DigitalTwinAsyncClient(connectionString);\n+    }\n+\n+    /**\n+     * Gets a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param clazz The class to deserialize the application/json into.\n+     * @param <T> The generic type to deserialize the application/json into.\n+     * @return The application/json of the digital twin.\n+     */\n+    public <T> Observable<T> getDigitalTwin (String digitalTwinId, Class<T> clazz)\n+    {\n+        return getDigitalTwinWithResponse(digitalTwinId, clazz)\n+                .map(response -> response.body());\n+    }\n+\n+    /**\n+     * Gets a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param clazz The class to deserialize the application/json into.\n+     * @param <T> The generic type to deserialize the application/json into.\n+     * @return A {@link ServiceResponseWithHeaders} representing deserialized application/json of the digital twin with {@link DigitalTwinGetHeaders}.\n+     */\n+    public <T> Observable<ServiceResponseWithHeaders<T, DigitalTwinGetHeaders>> getDigitalTwinWithResponse (String digitalTwinId, Class<T> clazz)\n+    {\n+        if(clazz == null)\n+        {\n+            throw new IllegalArgumentException(\"Parameter clazz is required and cannot be null.\");\n+        }\n+\n+        return digitalTwin.getDigitalTwinWithServiceResponseAsync(digitalTwinId)\n+                .flatMap(FUNC_TO_DIGITAL_TWIN_GET_RESPONSE)\n+                .flatMap(response -> {\n+                    try {\n+                        T genericResponse = DeserializationHelpers.castObject(objectMapper, response.body(), clazz);\n+                        return Observable.just(new ServiceResponseWithHeaders<>(genericResponse, response.headers(), response.response()));\n+                    } catch (JsonProcessingException e) {\n+                        return Observable.error(new IotHubException(\"Failed to parse the resonse\"));\n+                    }\n+\n+                })\n+                .subscribeOn(Schedulers.io());\n+    }\n+\n+    /**\n+     * Updates a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param digitalTwinUpdateOperations The JSON patch to apply to the specified digital twin. This argument can be created using {@link UpdateOperationUtility}.\n+     * @return void.\n+     */\n+    public Observable<Void> updateDigitalTwin (String digitalTwinId, List<Object> digitalTwinUpdateOperations)\n+    {\n+        return updateDigitalTwinWithResponse(digitalTwinId, digitalTwinUpdateOperations, null)\n+                .map(response -> response.body());\n+    }\n+\n+    /**\n+     * Updates a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param digitalTwinUpdateOperations The JSON patch to apply to the specified digital twin. This argument can be created using {@link UpdateOperationUtility}.\n+     * @return A {@link ServiceResponseWithHeaders} with {@link DigitalTwinUpdateHeaders}.\n+     */\n+    public Observable<ServiceResponseWithHeaders<Void, DigitalTwinUpdateHeaders>> updateDigitalTwinWithResponse (String digitalTwinId, List<Object> digitalTwinUpdateOperations)\n+    {\n+        return updateDigitalTwinWithResponse(digitalTwinId, digitalTwinUpdateOperations, null);\n+    }\n+\n+    /**\n+     * Updates a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param digitalTwinUpdateOperations The JSON patch to apply to the specified digital twin. This argument can be created using {@link UpdateOperationUtility}.\n+     * @param options The optional settings for this request.\n+     * @return A {@link ServiceResponseWithHeaders} with {@link DigitalTwinUpdateHeaders}.\n+     */\n+    public Observable<ServiceResponseWithHeaders<Void, DigitalTwinUpdateHeaders>> updateDigitalTwinWithResponse (String digitalTwinId, List<Object> digitalTwinUpdateOperations, DigitalTwinUpdateRequestOptions options)\n+    {\n+        String ifMatch = options != null ? options.getIfMatch() : null;\n+        return digitalTwin.updateDigitalTwinWithServiceResponseAsync(digitalTwinId, digitalTwinUpdateOperations, ifMatch)\n+                .flatMap(FUNC_TO_DIGITAL_TWIN_UPDATE_RESPONSE)\n+                .subscribeOn(Schedulers.io());\n+    }\n+\n+    /**\n+     * Invoke a command on a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param commandName The command to be invoked.\n+     * @return A {@link DigitalTwinCommandResponse} which contains the application/json command invocation response.\n+     * @throws IOException can be thrown if the provided payload cannot be deserialized to an Object.\n+     */\n+    public Observable<DigitalTwinCommandResponse> invokeCommand (String digitalTwinId, String commandName) throws IOException {\n+        return invokeCommandWithResponse(digitalTwinId, commandName, null, null)\n+                .map(response -> response.body());\n+    }\n+\n+    /**\n+     * Invoke a command on a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param commandName The command to be invoked.\n+     * @param payload The command payload.\n+     * @return A {@link DigitalTwinCommandResponse} which contains the application/json command invocation response.\n+     * @throws IOException can be thrown if the provided payload cannot be deserialized into a valid Json object.\n+     */\n+    public Observable<DigitalTwinCommandResponse> invokeCommand (String digitalTwinId, String commandName, String payload) throws IOException {\n+        // Retrofit does not work well with null in body\n+        return invokeCommandWithResponse(digitalTwinId, commandName, payload, null)\n+                .map(response -> response.body());\n+    }\n+\n+    /**\n+     * Invoke a command on a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param commandName The command to be invoked.\n+     * @param payload The command payload.\n+     * @param options The optional settings for this request.\n+     * @return A {@link ServiceResponseWithHeaders} with {@link DigitalTwinInvokeRootLevelCommandHeaders} and {@link DigitalTwinCommandResponse} which contains the application/json command invocation response.\n+     * @throws IOException can be thrown if the provided payload cannot be deserialized into a valid Json object.\n+     */\n+    public Observable<ServiceResponseWithHeaders<DigitalTwinCommandResponse, DigitalTwinInvokeCommandHeaders>> invokeCommandWithResponse (String digitalTwinId, String commandName, String payload, DigitalTwinInvokeCommandRequestOptions options) throws IOException {\n+        if(options == null)\n+        {\n+            options = new DigitalTwinInvokeCommandRequestOptions();\n+        }\n+\n+        // Retrofit does not work well with null in body\n+        if(payload == null)\n+        {\n+            payload = \"\";\n+        }\n+\n+        return digitalTwin.invokeRootLevelCommandWithServiceResponseAsync(digitalTwinId, commandName, payload, options.getConnectTimeoutInSeconds(), options.getResponseTimeoutInSeconds())\n+                .flatMap(FUNC_TO_DIGITAL_TWIN_COMMAND_RESPONSE);\n+    }\n+\n+    /**\n+     * Invoke a command on a digital twin component.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param componentName The component name under which the command is defined.\n+     * @param commandName The command to be invoked.\n+     * @return A {@link DigitalTwinCommandResponse} which contains the application/json command invocation response.\n+     * @throws IOException can be thrown if the provided payload cannot be deserialized into a valid Json object.\n+     */\n+    public Observable<DigitalTwinCommandResponse> invokeComponentCommand(String digitalTwinId, String componentName, String commandName) throws IOException {\n+        return invokeComponentCommandWithResponse(digitalTwinId, componentName, commandName, null, null)\n+                .map(response -> response.body());\n+    }\n+\n+    /**\n+     * Invoke a command on a digital twin component.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param componentName The component name under which the command is defined.\n+     * @param commandName The command to be invoked.\n+     * @param payload The command payload.\n+     * @return A {@link DigitalTwinCommandResponse} which contains the application/json command invocation response.\n+     * @throws IOException can be thrown if the provided payload cannot be deserialized into a valid Json object.\n+     */\n+    public Observable<DigitalTwinCommandResponse> invokeComponentCommand(String digitalTwinId, String componentName, String commandName, String payload) throws IOException {\n+        return invokeComponentCommandWithResponse(digitalTwinId, componentName, commandName, payload, null)\n+                .map(response -> response.body());\n+    }\n+\n+    /**\n+     * Invoke a command on a digital twin component.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param componentName The component name under which the command is defined.\n+     * @param commandName The command to be invoked.\n+     * @param payload The command payload.\n+     * @param options The optional settings for this request.\n+     * @return A {@link ServiceResponseWithHeaders} with {@link DigitalTwinInvokeRootLevelCommandHeaders} and {@link DigitalTwinCommandResponse} which contains the application/json command invocation response.\n+     * @throws IOException can be thrown if the provided payload cannot be deserialized into a valid Json object.\n+     */\n+    public Observable<ServiceResponseWithHeaders<DigitalTwinCommandResponse, DigitalTwinInvokeCommandHeaders>> invokeComponentCommandWithResponse (String digitalTwinId, String componentName, String commandName, String payload, DigitalTwinInvokeCommandRequestOptions options) throws IOException {\n+        if(options == null)", "originalCommit": "715a10906774d8763ea0b4db3038537c97211809", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg3MTcyOA==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r497871728", "bodyText": "same everywhere", "author": "azabbasi", "createdAt": "2020-10-01T00:19:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg3MTYyOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg3MTg4OA==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r497871888", "bodyText": "you can break down the lines ... seems too long", "author": "azabbasi", "createdAt": "2020-10-01T00:20:12Z", "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/digitaltwin/DigitalTwinAsyncClient.java", "diffHunk": "@@ -0,0 +1,249 @@\n+// Copyright (c) Microsoft. All rights reserved.\n+// Licensed under the MIT license. See LICENSE file in the project root for full license information.\n+\n+package com.microsoft.azure.sdk.iot.service.digitaltwin;\n+\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.databind.module.SimpleModule;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.authentication.SasTokenProvider;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.authentication.ServiceClientCredentialsProvider;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.authentication.ServiceConnectionString;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.authentication.ServiceConnectionStringParser;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.customized.DigitalTwinGetHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.customized.DigitalTwinUpdateHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.implementation.DigitalTwinsImpl;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.implementation.IotHubGatewayServiceAPIsImpl;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.DigitalTwins;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.models.DigitalTwinInvokeRootLevelCommandHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.serialization.DeserializationHelpers;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.serialization.DigitalTwinStringSerializer;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.models.*;\n+import com.microsoft.azure.sdk.iot.service.exceptions.IotHubException;\n+import com.microsoft.rest.*;\n+import com.microsoft.rest.serializer.JacksonAdapter;\n+import rx.Observable;\n+import rx.schedulers.Schedulers;\n+\n+import java.io.IOException;\n+import java.util.List;\n+\n+import static com.microsoft.azure.sdk.iot.service.digitaltwin.helpers.Tools.*;\n+\n+public class DigitalTwinAsyncClient {\n+    private DigitalTwinsImpl digitalTwin;\n+    private static ObjectMapper objectMapper = new ObjectMapper();\n+\n+     DigitalTwinAsyncClient(String connectionString) {\n+        ServiceConnectionString serviceConnectionString = ServiceConnectionStringParser.parseConnectionString(connectionString);\n+        SasTokenProvider sasTokenProvider = serviceConnectionString.createSasTokenProvider();\n+        String httpsEndpoint = serviceConnectionString.getHttpsEndpoint();\n+        final SimpleModule stringModule = new SimpleModule(\"String Serializer\");\n+        stringModule.addSerializer(new DigitalTwinStringSerializer(String.class, objectMapper));\n+\n+        JacksonAdapter adapter = new JacksonAdapter();\n+        adapter.serializer().registerModule(stringModule);\n+        RestClient simpleRestClient = new RestClient.Builder()\n+                .withBaseUrl(httpsEndpoint)\n+                .withCredentials(new ServiceClientCredentialsProvider(sasTokenProvider))\n+                .withResponseBuilderFactory(new ServiceResponseBuilder.Factory())\n+                .withSerializerAdapter(adapter)\n+                .build();\n+\n+        IotHubGatewayServiceAPIsImpl protocolLayerClient = new IotHubGatewayServiceAPIsImpl(simpleRestClient);\n+        digitalTwin = new DigitalTwinsImpl(simpleRestClient.retrofit(), protocolLayerClient);\n+    }\n+\n+    /**\n+     * Creates an implementation instance of {@link DigitalTwins} that is used to invoke the Digital Twin features\n+     * @param connectionString The IoTHub connection string\n+     * @return DigitalTwinAsyncClient\n+     */\n+    public static DigitalTwinAsyncClient createFromConnectionString(String connectionString)\n+    {\n+        return new DigitalTwinAsyncClient(connectionString);\n+    }\n+\n+    /**\n+     * Gets a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param clazz The class to deserialize the application/json into.\n+     * @param <T> The generic type to deserialize the application/json into.\n+     * @return The application/json of the digital twin.\n+     */\n+    public <T> Observable<T> getDigitalTwin (String digitalTwinId, Class<T> clazz)\n+    {\n+        return getDigitalTwinWithResponse(digitalTwinId, clazz)\n+                .map(response -> response.body());\n+    }\n+\n+    /**\n+     * Gets a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param clazz The class to deserialize the application/json into.\n+     * @param <T> The generic type to deserialize the application/json into.\n+     * @return A {@link ServiceResponseWithHeaders} representing deserialized application/json of the digital twin with {@link DigitalTwinGetHeaders}.\n+     */\n+    public <T> Observable<ServiceResponseWithHeaders<T, DigitalTwinGetHeaders>> getDigitalTwinWithResponse (String digitalTwinId, Class<T> clazz)\n+    {\n+        if(clazz == null)\n+        {\n+            throw new IllegalArgumentException(\"Parameter clazz is required and cannot be null.\");\n+        }\n+\n+        return digitalTwin.getDigitalTwinWithServiceResponseAsync(digitalTwinId)\n+                .flatMap(FUNC_TO_DIGITAL_TWIN_GET_RESPONSE)\n+                .flatMap(response -> {\n+                    try {\n+                        T genericResponse = DeserializationHelpers.castObject(objectMapper, response.body(), clazz);\n+                        return Observable.just(new ServiceResponseWithHeaders<>(genericResponse, response.headers(), response.response()));\n+                    } catch (JsonProcessingException e) {\n+                        return Observable.error(new IotHubException(\"Failed to parse the resonse\"));\n+                    }\n+\n+                })\n+                .subscribeOn(Schedulers.io());\n+    }\n+\n+    /**\n+     * Updates a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param digitalTwinUpdateOperations The JSON patch to apply to the specified digital twin. This argument can be created using {@link UpdateOperationUtility}.\n+     * @return void.\n+     */\n+    public Observable<Void> updateDigitalTwin (String digitalTwinId, List<Object> digitalTwinUpdateOperations)\n+    {\n+        return updateDigitalTwinWithResponse(digitalTwinId, digitalTwinUpdateOperations, null)\n+                .map(response -> response.body());\n+    }\n+\n+    /**\n+     * Updates a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param digitalTwinUpdateOperations The JSON patch to apply to the specified digital twin. This argument can be created using {@link UpdateOperationUtility}.\n+     * @return A {@link ServiceResponseWithHeaders} with {@link DigitalTwinUpdateHeaders}.\n+     */\n+    public Observable<ServiceResponseWithHeaders<Void, DigitalTwinUpdateHeaders>> updateDigitalTwinWithResponse (String digitalTwinId, List<Object> digitalTwinUpdateOperations)\n+    {\n+        return updateDigitalTwinWithResponse(digitalTwinId, digitalTwinUpdateOperations, null);\n+    }\n+\n+    /**\n+     * Updates a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param digitalTwinUpdateOperations The JSON patch to apply to the specified digital twin. This argument can be created using {@link UpdateOperationUtility}.\n+     * @param options The optional settings for this request.\n+     * @return A {@link ServiceResponseWithHeaders} with {@link DigitalTwinUpdateHeaders}.\n+     */\n+    public Observable<ServiceResponseWithHeaders<Void, DigitalTwinUpdateHeaders>> updateDigitalTwinWithResponse (String digitalTwinId, List<Object> digitalTwinUpdateOperations, DigitalTwinUpdateRequestOptions options)\n+    {\n+        String ifMatch = options != null ? options.getIfMatch() : null;\n+        return digitalTwin.updateDigitalTwinWithServiceResponseAsync(digitalTwinId, digitalTwinUpdateOperations, ifMatch)\n+                .flatMap(FUNC_TO_DIGITAL_TWIN_UPDATE_RESPONSE)\n+                .subscribeOn(Schedulers.io());\n+    }\n+\n+    /**\n+     * Invoke a command on a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param commandName The command to be invoked.\n+     * @return A {@link DigitalTwinCommandResponse} which contains the application/json command invocation response.\n+     * @throws IOException can be thrown if the provided payload cannot be deserialized to an Object.\n+     */\n+    public Observable<DigitalTwinCommandResponse> invokeCommand (String digitalTwinId, String commandName) throws IOException {\n+        return invokeCommandWithResponse(digitalTwinId, commandName, null, null)\n+                .map(response -> response.body());\n+    }\n+\n+    /**\n+     * Invoke a command on a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param commandName The command to be invoked.\n+     * @param payload The command payload.\n+     * @return A {@link DigitalTwinCommandResponse} which contains the application/json command invocation response.\n+     * @throws IOException can be thrown if the provided payload cannot be deserialized into a valid Json object.\n+     */\n+    public Observable<DigitalTwinCommandResponse> invokeCommand (String digitalTwinId, String commandName, String payload) throws IOException {\n+        // Retrofit does not work well with null in body\n+        return invokeCommandWithResponse(digitalTwinId, commandName, payload, null)\n+                .map(response -> response.body());\n+    }\n+\n+    /**\n+     * Invoke a command on a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param commandName The command to be invoked.\n+     * @param payload The command payload.\n+     * @param options The optional settings for this request.\n+     * @return A {@link ServiceResponseWithHeaders} with {@link DigitalTwinInvokeRootLevelCommandHeaders} and {@link DigitalTwinCommandResponse} which contains the application/json command invocation response.\n+     * @throws IOException can be thrown if the provided payload cannot be deserialized into a valid Json object.\n+     */\n+    public Observable<ServiceResponseWithHeaders<DigitalTwinCommandResponse, DigitalTwinInvokeCommandHeaders>> invokeCommandWithResponse (String digitalTwinId, String commandName, String payload, DigitalTwinInvokeCommandRequestOptions options) throws IOException {\n+        if(options == null)\n+        {\n+            options = new DigitalTwinInvokeCommandRequestOptions();\n+        }\n+\n+        // Retrofit does not work well with null in body\n+        if(payload == null)\n+        {\n+            payload = \"\";\n+        }\n+\n+        return digitalTwin.invokeRootLevelCommandWithServiceResponseAsync(digitalTwinId, commandName, payload, options.getConnectTimeoutInSeconds(), options.getResponseTimeoutInSeconds())\n+                .flatMap(FUNC_TO_DIGITAL_TWIN_COMMAND_RESPONSE);\n+    }\n+\n+    /**\n+     * Invoke a command on a digital twin component.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param componentName The component name under which the command is defined.\n+     * @param commandName The command to be invoked.\n+     * @return A {@link DigitalTwinCommandResponse} which contains the application/json command invocation response.\n+     * @throws IOException can be thrown if the provided payload cannot be deserialized into a valid Json object.\n+     */\n+    public Observable<DigitalTwinCommandResponse> invokeComponentCommand(String digitalTwinId, String componentName, String commandName) throws IOException {\n+        return invokeComponentCommandWithResponse(digitalTwinId, componentName, commandName, null, null)\n+                .map(response -> response.body());\n+    }\n+\n+    /**\n+     * Invoke a command on a digital twin component.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param componentName The component name under which the command is defined.\n+     * @param commandName The command to be invoked.\n+     * @param payload The command payload.\n+     * @return A {@link DigitalTwinCommandResponse} which contains the application/json command invocation response.\n+     * @throws IOException can be thrown if the provided payload cannot be deserialized into a valid Json object.\n+     */\n+    public Observable<DigitalTwinCommandResponse> invokeComponentCommand(String digitalTwinId, String componentName, String commandName, String payload) throws IOException {\n+        return invokeComponentCommandWithResponse(digitalTwinId, componentName, commandName, payload, null)\n+                .map(response -> response.body());\n+    }\n+\n+    /**\n+     * Invoke a command on a digital twin component.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param componentName The component name under which the command is defined.\n+     * @param commandName The command to be invoked.\n+     * @param payload The command payload.\n+     * @param options The optional settings for this request.\n+     * @return A {@link ServiceResponseWithHeaders} with {@link DigitalTwinInvokeRootLevelCommandHeaders} and {@link DigitalTwinCommandResponse} which contains the application/json command invocation response.\n+     * @throws IOException can be thrown if the provided payload cannot be deserialized into a valid Json object.\n+     */\n+    public Observable<ServiceResponseWithHeaders<DigitalTwinCommandResponse, DigitalTwinInvokeCommandHeaders>> invokeComponentCommandWithResponse (String digitalTwinId, String componentName, String commandName, String payload, DigitalTwinInvokeCommandRequestOptions options) throws IOException {\n+        if(options == null)\n+        {\n+            options = new DigitalTwinInvokeCommandRequestOptions();\n+        }\n+\n+        // Retrofit does not work well with null in body\n+        if(payload == null)\n+        {\n+            payload = \"\";\n+        }\n+\n+        return digitalTwin.invokeComponentCommandWithServiceResponseAsync(digitalTwinId, componentName, commandName, payload, options.getConnectTimeoutInSeconds(), options.getResponseTimeoutInSeconds())", "originalCommit": "715a10906774d8763ea0b4db3038537c97211809", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg3MjMzNw==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r497872337", "bodyText": "nit: line too long.", "author": "azabbasi", "createdAt": "2020-10-01T00:20:54Z", "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/digitaltwin/DigitalTwinAsyncClient.java", "diffHunk": "@@ -0,0 +1,249 @@\n+// Copyright (c) Microsoft. All rights reserved.\n+// Licensed under the MIT license. See LICENSE file in the project root for full license information.\n+\n+package com.microsoft.azure.sdk.iot.service.digitaltwin;\n+\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.databind.module.SimpleModule;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.authentication.SasTokenProvider;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.authentication.ServiceClientCredentialsProvider;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.authentication.ServiceConnectionString;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.authentication.ServiceConnectionStringParser;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.customized.DigitalTwinGetHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.customized.DigitalTwinUpdateHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.implementation.DigitalTwinsImpl;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.implementation.IotHubGatewayServiceAPIsImpl;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.DigitalTwins;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.models.DigitalTwinInvokeRootLevelCommandHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.serialization.DeserializationHelpers;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.serialization.DigitalTwinStringSerializer;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.models.*;\n+import com.microsoft.azure.sdk.iot.service.exceptions.IotHubException;\n+import com.microsoft.rest.*;\n+import com.microsoft.rest.serializer.JacksonAdapter;\n+import rx.Observable;\n+import rx.schedulers.Schedulers;\n+\n+import java.io.IOException;\n+import java.util.List;\n+\n+import static com.microsoft.azure.sdk.iot.service.digitaltwin.helpers.Tools.*;\n+\n+public class DigitalTwinAsyncClient {\n+    private DigitalTwinsImpl digitalTwin;\n+    private static ObjectMapper objectMapper = new ObjectMapper();\n+\n+     DigitalTwinAsyncClient(String connectionString) {\n+        ServiceConnectionString serviceConnectionString = ServiceConnectionStringParser.parseConnectionString(connectionString);\n+        SasTokenProvider sasTokenProvider = serviceConnectionString.createSasTokenProvider();\n+        String httpsEndpoint = serviceConnectionString.getHttpsEndpoint();\n+        final SimpleModule stringModule = new SimpleModule(\"String Serializer\");\n+        stringModule.addSerializer(new DigitalTwinStringSerializer(String.class, objectMapper));\n+\n+        JacksonAdapter adapter = new JacksonAdapter();\n+        adapter.serializer().registerModule(stringModule);\n+        RestClient simpleRestClient = new RestClient.Builder()\n+                .withBaseUrl(httpsEndpoint)\n+                .withCredentials(new ServiceClientCredentialsProvider(sasTokenProvider))\n+                .withResponseBuilderFactory(new ServiceResponseBuilder.Factory())\n+                .withSerializerAdapter(adapter)\n+                .build();\n+\n+        IotHubGatewayServiceAPIsImpl protocolLayerClient = new IotHubGatewayServiceAPIsImpl(simpleRestClient);\n+        digitalTwin = new DigitalTwinsImpl(simpleRestClient.retrofit(), protocolLayerClient);\n+    }\n+\n+    /**\n+     * Creates an implementation instance of {@link DigitalTwins} that is used to invoke the Digital Twin features\n+     * @param connectionString The IoTHub connection string\n+     * @return DigitalTwinAsyncClient\n+     */\n+    public static DigitalTwinAsyncClient createFromConnectionString(String connectionString)\n+    {\n+        return new DigitalTwinAsyncClient(connectionString);\n+    }\n+\n+    /**\n+     * Gets a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param clazz The class to deserialize the application/json into.\n+     * @param <T> The generic type to deserialize the application/json into.\n+     * @return The application/json of the digital twin.\n+     */\n+    public <T> Observable<T> getDigitalTwin (String digitalTwinId, Class<T> clazz)\n+    {\n+        return getDigitalTwinWithResponse(digitalTwinId, clazz)\n+                .map(response -> response.body());\n+    }\n+\n+    /**\n+     * Gets a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param clazz The class to deserialize the application/json into.\n+     * @param <T> The generic type to deserialize the application/json into.\n+     * @return A {@link ServiceResponseWithHeaders} representing deserialized application/json of the digital twin with {@link DigitalTwinGetHeaders}.\n+     */\n+    public <T> Observable<ServiceResponseWithHeaders<T, DigitalTwinGetHeaders>> getDigitalTwinWithResponse (String digitalTwinId, Class<T> clazz)\n+    {\n+        if(clazz == null)\n+        {\n+            throw new IllegalArgumentException(\"Parameter clazz is required and cannot be null.\");\n+        }\n+\n+        return digitalTwin.getDigitalTwinWithServiceResponseAsync(digitalTwinId)\n+                .flatMap(FUNC_TO_DIGITAL_TWIN_GET_RESPONSE)\n+                .flatMap(response -> {\n+                    try {\n+                        T genericResponse = DeserializationHelpers.castObject(objectMapper, response.body(), clazz);\n+                        return Observable.just(new ServiceResponseWithHeaders<>(genericResponse, response.headers(), response.response()));\n+                    } catch (JsonProcessingException e) {\n+                        return Observable.error(new IotHubException(\"Failed to parse the resonse\"));\n+                    }\n+\n+                })\n+                .subscribeOn(Schedulers.io());\n+    }\n+\n+    /**\n+     * Updates a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param digitalTwinUpdateOperations The JSON patch to apply to the specified digital twin. This argument can be created using {@link UpdateOperationUtility}.\n+     * @return void.\n+     */\n+    public Observable<Void> updateDigitalTwin (String digitalTwinId, List<Object> digitalTwinUpdateOperations)\n+    {\n+        return updateDigitalTwinWithResponse(digitalTwinId, digitalTwinUpdateOperations, null)\n+                .map(response -> response.body());\n+    }\n+\n+    /**\n+     * Updates a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param digitalTwinUpdateOperations The JSON patch to apply to the specified digital twin. This argument can be created using {@link UpdateOperationUtility}.\n+     * @return A {@link ServiceResponseWithHeaders} with {@link DigitalTwinUpdateHeaders}.\n+     */\n+    public Observable<ServiceResponseWithHeaders<Void, DigitalTwinUpdateHeaders>> updateDigitalTwinWithResponse (String digitalTwinId, List<Object> digitalTwinUpdateOperations)\n+    {\n+        return updateDigitalTwinWithResponse(digitalTwinId, digitalTwinUpdateOperations, null);\n+    }\n+\n+    /**\n+     * Updates a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param digitalTwinUpdateOperations The JSON patch to apply to the specified digital twin. This argument can be created using {@link UpdateOperationUtility}.\n+     * @param options The optional settings for this request.\n+     * @return A {@link ServiceResponseWithHeaders} with {@link DigitalTwinUpdateHeaders}.\n+     */\n+    public Observable<ServiceResponseWithHeaders<Void, DigitalTwinUpdateHeaders>> updateDigitalTwinWithResponse (String digitalTwinId, List<Object> digitalTwinUpdateOperations, DigitalTwinUpdateRequestOptions options)\n+    {\n+        String ifMatch = options != null ? options.getIfMatch() : null;\n+        return digitalTwin.updateDigitalTwinWithServiceResponseAsync(digitalTwinId, digitalTwinUpdateOperations, ifMatch)\n+                .flatMap(FUNC_TO_DIGITAL_TWIN_UPDATE_RESPONSE)\n+                .subscribeOn(Schedulers.io());\n+    }\n+\n+    /**\n+     * Invoke a command on a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param commandName The command to be invoked.\n+     * @return A {@link DigitalTwinCommandResponse} which contains the application/json command invocation response.\n+     * @throws IOException can be thrown if the provided payload cannot be deserialized to an Object.\n+     */\n+    public Observable<DigitalTwinCommandResponse> invokeCommand (String digitalTwinId, String commandName) throws IOException {\n+        return invokeCommandWithResponse(digitalTwinId, commandName, null, null)\n+                .map(response -> response.body());\n+    }\n+\n+    /**\n+     * Invoke a command on a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param commandName The command to be invoked.\n+     * @param payload The command payload.\n+     * @return A {@link DigitalTwinCommandResponse} which contains the application/json command invocation response.\n+     * @throws IOException can be thrown if the provided payload cannot be deserialized into a valid Json object.\n+     */\n+    public Observable<DigitalTwinCommandResponse> invokeCommand (String digitalTwinId, String commandName, String payload) throws IOException {\n+        // Retrofit does not work well with null in body\n+        return invokeCommandWithResponse(digitalTwinId, commandName, payload, null)\n+                .map(response -> response.body());\n+    }\n+\n+    /**\n+     * Invoke a command on a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param commandName The command to be invoked.\n+     * @param payload The command payload.\n+     * @param options The optional settings for this request.\n+     * @return A {@link ServiceResponseWithHeaders} with {@link DigitalTwinInvokeRootLevelCommandHeaders} and {@link DigitalTwinCommandResponse} which contains the application/json command invocation response.\n+     * @throws IOException can be thrown if the provided payload cannot be deserialized into a valid Json object.\n+     */\n+    public Observable<ServiceResponseWithHeaders<DigitalTwinCommandResponse, DigitalTwinInvokeCommandHeaders>> invokeCommandWithResponse (String digitalTwinId, String commandName, String payload, DigitalTwinInvokeCommandRequestOptions options) throws IOException {\n+        if(options == null)\n+        {\n+            options = new DigitalTwinInvokeCommandRequestOptions();\n+        }\n+\n+        // Retrofit does not work well with null in body\n+        if(payload == null)\n+        {\n+            payload = \"\";\n+        }\n+\n+        return digitalTwin.invokeRootLevelCommandWithServiceResponseAsync(digitalTwinId, commandName, payload, options.getConnectTimeoutInSeconds(), options.getResponseTimeoutInSeconds())", "originalCommit": "715a10906774d8763ea0b4db3038537c97211809", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg3MzcyOQ==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r497873729", "bodyText": "nit: line too long", "author": "azabbasi", "createdAt": "2020-10-01T00:23:26Z", "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/digitaltwin/DigitalTwinClient.java", "diffHunk": "@@ -0,0 +1,172 @@\n+// Copyright (c) Microsoft. All rights reserved.\n+// Licensed under the MIT license. See LICENSE file in the project root for full license information.\n+\n+package com.microsoft.azure.sdk.iot.service.digitaltwin;\n+\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.customized.DigitalTwinGetHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.customized.DigitalTwinUpdateHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.DigitalTwins;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.generated.models.DigitalTwinInvokeRootLevelCommandHeaders;\n+import com.microsoft.azure.sdk.iot.service.digitaltwin.models.*;\n+import com.microsoft.rest.*;\n+\n+import java.io.IOException;\n+import java.util.List;\n+\n+public class DigitalTwinClient {\n+    private DigitalTwinAsyncClient digitalTwinAsyncClient;\n+\n+    DigitalTwinClient(String connectionString) {\n+        digitalTwinAsyncClient = DigitalTwinAsyncClient.createFromConnectionString(connectionString);\n+    }\n+\n+    /**\n+     * Creates an implementation instance of {@link DigitalTwins} that is used to invoke the Digital Twin features\n+     * @param connectionString The IoTHub connection string\n+     * @return DigitalTwinClient\n+     */\n+    public static DigitalTwinClient createFromConnectionString(String connectionString)\n+    {\n+        return new DigitalTwinClient(connectionString);\n+    }\n+\n+    /**\n+     * Gets a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param clazz The class to deserialize the application/json into.\n+     * @param <T> The generic type to deserialize the application/json into.\n+     * @return The application/json of the digital twin.\n+     */\n+    public <T> T getDigitalTwin (String digitalTwinId, Class<T> clazz)\n+    {\n+        return getDigitalTwinWithResponse(digitalTwinId, clazz).body();\n+    }\n+\n+    /**\n+     * Gets a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param clazz The class to deserialize the application/json into.\n+     * @param <T> The generic type to deserialize the application/json into.\n+     * @return A {@link ServiceResponseWithHeaders} representing deserialized application/json of the digital twin with {@link DigitalTwinGetHeaders}.\n+     */\n+    public <T> ServiceResponseWithHeaders<T, DigitalTwinGetHeaders> getDigitalTwinWithResponse (String digitalTwinId, Class<T> clazz)\n+    {\n+        return digitalTwinAsyncClient.getDigitalTwinWithResponse(digitalTwinId, clazz)\n+                .toBlocking().single();\n+    }\n+\n+    /**\n+     * Updates a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param digitalTwinUpdateOperations The JSON patch to apply to the specified digital twin. This argument can be created using {@link UpdateOperationUtility}.\n+     * @return void.\n+     */\n+    public Void updateDigitalTwin (String digitalTwinId, List<Object> digitalTwinUpdateOperations)\n+    {\n+        return digitalTwinAsyncClient.updateDigitalTwin(digitalTwinId, digitalTwinUpdateOperations)\n+            .toBlocking().single();\n+    }\n+\n+    /**\n+     * Updates a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param digitalTwinUpdateOperations The JSON patch to apply to the specified digital twin. This argument can be created using {@link UpdateOperationUtility}.\n+     * @return A {@link ServiceResponseWithHeaders} with {@link DigitalTwinUpdateHeaders}.\n+     */\n+    public ServiceResponseWithHeaders<Void, DigitalTwinUpdateHeaders> updateDigitalTwinWithResponse (String digitalTwinId, List<Object> digitalTwinUpdateOperations)\n+    {\n+        return updateDigitalTwinWithResponse(digitalTwinId, digitalTwinUpdateOperations, null);\n+    }\n+\n+    /**\n+     * Updates a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param digitalTwinUpdateOperations The JSON patch to apply to the specified digital twin. This argument can be created using {@link UpdateOperationUtility}.\n+     * @param options The optional settings for this request.\n+     * @return A {@link ServiceResponseWithHeaders} with {@link DigitalTwinUpdateHeaders}.\n+     */\n+    public ServiceResponseWithHeaders<Void, DigitalTwinUpdateHeaders> updateDigitalTwinWithResponse (String digitalTwinId, List<Object> digitalTwinUpdateOperations, DigitalTwinUpdateRequestOptions options)\n+    {\n+        return digitalTwinAsyncClient.updateDigitalTwinWithResponse(digitalTwinId, digitalTwinUpdateOperations, options)\n+                .toBlocking().single();\n+    }\n+\n+    /**\n+     * Invoke a command on a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param commandName The command to be invoked.\n+     * @return A {@link DigitalTwinCommandResponse} which contains the application/json command invocation response.\n+     * @throws IOException can be thrown if the provided payload cannot be deserialized into a valid Json object.\n+     */\n+    public DigitalTwinCommandResponse invokeCommand(String digitalTwinId, String commandName) throws IOException {\n+        return invokeCommandWithResponse(digitalTwinId, commandName, null, null).body();\n+    }\n+\n+    /**\n+     * Invoke a command on a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param commandName The command to be invoked.\n+     * @param payload The command payload.\n+     * @return A {@link DigitalTwinCommandResponse} which contains the application/json command invocation response.\n+     * @throws IOException can be thrown if the provided payload cannot be deserialized into a valid Json object.\n+     */\n+    public DigitalTwinCommandResponse invokeCommand(String digitalTwinId, String commandName, String payload) throws IOException {\n+        // Retrofit does not work well with null in body\n+        return invokeCommandWithResponse(digitalTwinId, commandName, payload, null).body();\n+    }\n+\n+    /**\n+     * Invoke a command on a digital twin.\n+     * @param digitalTwinId The Id of the digital twin.\n+     * @param commandName The command to be invoked.\n+     * @param payload The command payload.\n+     * @param options The optional settings for this request.\n+     * @return A {@link ServiceResponseWithHeaders} with {@link DigitalTwinInvokeRootLevelCommandHeaders} and {@link DigitalTwinCommandResponse} which contains the application/json command invocation response.\n+     * @throws IOException can be thrown if the provided payload cannot be deserialized into a valid Json object.\n+     */\n+    public ServiceResponseWithHeaders<DigitalTwinCommandResponse, DigitalTwinInvokeCommandHeaders> invokeCommandWithResponse(String digitalTwinId, String commandName, String payload, DigitalTwinInvokeCommandRequestOptions options) throws IOException {", "originalCommit": "715a10906774d8763ea0b4db3038537c97211809", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg3NDY5OA==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r497874698", "bodyText": "nit : indentation", "author": "azabbasi", "createdAt": "2020-10-01T00:24:55Z", "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/digitaltwin/authentication/ServiceClientCredentialsProvider.java", "diffHunk": "@@ -0,0 +1,31 @@\n+// Copyright (c) Microsoft. All rights reserved.\n+// Licensed under the MIT license. See LICENSE file in the project root for full license information.\n+\n+package com.microsoft.azure.sdk.iot.service.digitaltwin.authentication;;\n+\n+import com.microsoft.rest.credentials.ServiceClientCredentials;\n+import lombok.AllArgsConstructor;\n+import lombok.NonNull;\n+import okhttp3.Interceptor;\n+import okhttp3.OkHttpClient;\n+import okhttp3.Request;\n+\n+@AllArgsConstructor\n+public class ServiceClientCredentialsProvider implements ServiceClientCredentials {\n+\n+    private static final String AUTHORIZATION = \"Authorization\";\n+    @NonNull\n+    private final SasTokenProvider sasTokenProvider;\n+\n+    @Override\n+    public void applyCredentialsFilter(OkHttpClient.Builder clientBuilder) {\n+        Interceptor authenticationInterceptor = chain -> {\n+            Request authenticatedRequest = chain.request()\n+                                                .newBuilder()", "originalCommit": "715a10906774d8763ea0b4db3038537c97211809", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzkzOTA0NQ==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r497939045", "bodyText": "This one and two below, I have left as it is. Wasn't sure if you meant it is more indented but looked fine to me.", "author": "bikamani", "createdAt": "2020-10-01T02:06:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg3NDY5OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg3NDgzMA==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r497874830", "bodyText": "nit: indentation", "author": "azabbasi", "createdAt": "2020-10-01T00:25:09Z", "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/digitaltwin/authentication/ServiceConnectionString.java", "diffHunk": "@@ -0,0 +1,55 @@\n+// Copyright (c) Microsoft. All rights reserved.\n+// Licensed under the MIT license. See LICENSE file in the project root for full license information.\n+\n+package com.microsoft.azure.sdk.iot.service.digitaltwin.authentication;\n+\n+import lombok.Builder;\n+import lombok.Getter;\n+import lombok.NonNull;\n+\n+@Getter\n+public class ServiceConnectionString {\n+    private static final String HOST_NAME_REGEX = \"[a-zA-Z0-9_\\\\-\\\\.]+$\";\n+    private static final String SHARED_ACCESS_KEY_NAME_REGEX = \"^[a-zA-Z0-9_\\\\-@\\\\.]+$\";\n+    private static final String SHARED_ACCESS_KEY_REGEX = \"^.+$\";\n+    private static final String SHARED_ACCESS_SIGNATURE_REGEX = \"^.+$\";\n+\n+    private String hostName;\n+    private String httpsEndpoint;\n+    private String sharedAccessKeyName;\n+    private String sharedAccessKey;\n+    private String sharedAccessSignature;\n+\n+    @Builder\n+    ServiceConnectionString(@NonNull String hostName, @NonNull String httpsEndpoint, String sharedAccessKeyName, String sharedAccessKey, String sharedAccessSignature) {\n+        if (!validInput(sharedAccessKeyName, sharedAccessKey, sharedAccessSignature)) {\n+            throw new IllegalArgumentException(\"Specify either both the sharedAccessKey and sharedAccessKeyName, or sharedAccessSignature\");\n+        }\n+\n+        this.hostName = hostName;\n+        this.httpsEndpoint = httpsEndpoint;\n+        this.sharedAccessKeyName = sharedAccessKeyName;\n+        this.sharedAccessKey = sharedAccessKey;\n+        this.sharedAccessSignature = sharedAccessSignature;\n+    }\n+\n+    public SasTokenProvider createSasTokenProvider() {\n+        if (sharedAccessSignature != null) {\n+            return new StaticSasTokenProvider(sharedAccessSignature);\n+        } else {\n+            return SasTokenProviderWithSharedAccessKey.builder()\n+                                                      .hostName(hostName)", "originalCommit": "715a10906774d8763ea0b4db3038537c97211809", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg3NTA5Mg==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r497875092", "bodyText": "nit: indentation", "author": "azabbasi", "createdAt": "2020-10-01T00:25:37Z", "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/digitaltwin/authentication/ServiceConnectionStringParser.java", "diffHunk": "@@ -0,0 +1,53 @@\n+// Copyright (c) Microsoft. All rights reserved.\n+// Licensed under the MIT license. See LICENSE file in the project root for full license information.\n+\n+package com.microsoft.azure.sdk.iot.service.digitaltwin.authentication;\n+\n+import lombok.NonNull;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.StringTokenizer;\n+\n+public final class ServiceConnectionStringParser {\n+    private static final String VALUE_PAIR_DELIMITER = \";\";\n+    private static final String VALUE_PAIR_SEPARATOR = \"=\";\n+\n+    private static final String HOST_NAME_PROPERTY_NAME = \"HostName\";\n+    private static final String SHARED_ACCESS_KEY_NAME_PROPERTY_NAME = \"SharedAccessKeyName\";\n+    private static final String SHARED_ACCESS_KEY_PROPERTY_NAME = \"SharedAccessKey\";\n+    private static final String SHARED_ACCESS_SIGNATURE_PROPERTY_NAME = \"SharedAccessSignature\";\n+\n+    private static final String ENDPOINT_PROTOCOL = \"https\";\n+\n+    private ServiceConnectionStringParser() {\n+    }\n+\n+    public static ServiceConnectionString parseConnectionString(@NonNull String connectionString) {\n+        Map<String, String> keyValueMap = new HashMap<>();\n+\n+        StringTokenizer stringTokenizer1 = new StringTokenizer(connectionString, VALUE_PAIR_DELIMITER);\n+        while (stringTokenizer1.hasMoreTokens()) {\n+            String currentToken = stringTokenizer1.nextToken();\n+\n+            String[] splitString = currentToken.split(VALUE_PAIR_SEPARATOR, 2);\n+            if (splitString.length == 2) {\n+                keyValueMap.put(splitString[0], splitString[1]);\n+            }\n+        }\n+\n+        String hostName = keyValueMap.get(HOST_NAME_PROPERTY_NAME);\n+\n+        return ServiceConnectionString.builder()", "originalCommit": "715a10906774d8763ea0b4db3038537c97211809", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg4MDIzMA==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r497880230", "bodyText": "else should be on the same line, no?", "author": "drwill-ms", "createdAt": "2020-10-01T00:33:43Z", "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/digitaltwin/serialization/DeserializationHelpers.java", "diffHunk": "@@ -0,0 +1,32 @@\n+// Copyright (c) Microsoft. All rights reserved.\n+// Licensed under the MIT license. See LICENSE file in the project root for full license information.\n+\n+package com.microsoft.azure.sdk.iot.service.digitaltwin.serialization;\n+\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+\n+public class DeserializationHelpers {\n+\n+    /**\n+     * Converts the payload object into a generic type.\n+     * There are two different paths we will have to take based on the type T\n+     * In case of a String, we need to write the value of the payload as a String\n+     * In case of any other type that the user decides to deserialize the payload, we will use mapper.convertValue to perform the conversion.\n+     * Updates a digital twin.\n+     * @param mapper Object Mapper\n+     * @param payload payload object to cast.\n+     * @param clazz The class to deserialize the object into.\n+     * @param <T> The generic type to deserialize the object into.\n+     * @return T The generic type response.\n+     * @throws JsonProcessingException Json parsing exception.\n+     */\n+    public static <T> T castObject(ObjectMapper mapper, Object payload, Class<T> clazz) throws JsonProcessingException {\n+        if (clazz.isAssignableFrom(String.class)){\n+            return (T)mapper.writeValueAsString(payload);\n+        }", "originalCommit": "715a10906774d8763ea0b4db3038537c97211809", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzkyNTMzNw==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r497925337", "bodyText": "Is that the format we are following?", "author": "bikamani", "createdAt": "2020-10-01T01:44:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg4MDIzMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzkzODMxMg==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r497938312", "bodyText": "I have left it as it is for now.", "author": "bikamani", "createdAt": "2020-10-01T02:05:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg4MDIzMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg3NzgzMQ==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r497877831", "bodyText": "nit: indentation off", "author": "azabbasi", "createdAt": "2020-10-01T00:29:55Z", "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/digitaltwin/helpers/Base64.java", "diffHunk": "@@ -0,0 +1,284 @@\n+// Copyright (c) Microsoft. All rights reserved.\n+// Licensed under the MIT license. See LICENSE file in the project root for full license information.\n+\n+package com.microsoft.azure.sdk.iot.service.digitaltwin.helpers;\n+\n+public final class Base64 {\n+    private static final byte BYTE_START_UPPERCASE = 'A';\n+    private static final byte BYTE_END_UPPERCASE = 'Z';\n+    private static final byte BYTE_START_LOWERCASE = 'a';\n+    private static final byte BYTE_END_LOWERCASE = 'z';\n+    private static final byte BYTE_START_NUMBER = '0';\n+    private static final byte BYTE_END_NUMBER = '9';\n+    private static final byte BYTE_PLUS = '+';\n+    private static final byte BYTE_SLASH = '/';\n+\n+    private static final int BASE64_END_UPPERCASE = 26;\n+    private static final int BASE64_END_LOWERCASE = 52;\n+    private static final int BASE64_END_NUMBER = 62;\n+    private static final int BASE64_PLUS = 62;\n+    private static final int BASE64_SLASH = 63;\n+    private static final byte BASE64_PAD = '=';\n+\n+    private static final int HALF_NIBBLE = 2;\n+    private static final int ONE_NIBBLE = 4;\n+    private static final int ONE_AND_HALF_NIBBLE = 6;\n+    private static final int ONE_BYTE = 8;\n+    private static final int TWO_BYTES = 16;\n+    private static final int THREE_BYTES = 24;\n+\n+    private static final int ISOLATE_BYTE = 0xFF;\n+    private static final int ISOLATE_BASE64 = 0x3F;\n+    private static final int ISOLATE_LSB_BASE64 = 0x0F;\n+    private static final int ISOLATE_MSB_BASE64 = 0x03;\n+\n+    private static final int BYTE_GROUP_SIZE = 3;\n+    private static final int BASE64_GROUP_SIZE = 4;\n+\n+    private static final int[] BASE64D16_CONVERSION_TABLE =\n+            {\n+                    ((int) 'A' + ((int) 'E' << ONE_BYTE) + ((int) 'I' << TWO_BYTES) + ((int) 'M' << THREE_BYTES)),", "originalCommit": "715a10906774d8763ea0b4db3038537c97211809", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg3ODU2Nw==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r497878567", "bodyText": "These should be marked private", "author": "azabbasi", "createdAt": "2020-10-01T00:30:57Z", "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/digitaltwin/models/DigitalTwinCommandResponse.java", "diffHunk": "@@ -0,0 +1,39 @@\n+// Copyright (c) Microsoft. All rights reserved.\n+// Licensed under the MIT license. See LICENSE file in the project root for full license information.\n+\n+package com.microsoft.azure.sdk.iot.service.digitaltwin.models;\n+\n+/**\n+ * Represents the device command invocation results.\n+ */\n+public final class DigitalTwinCommandResponse {\n+    /**\n+     * Command invocation result status, as supplied by the device.\n+     */\n+    Integer status;", "originalCommit": "715a10906774d8763ea0b4db3038537c97211809", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg3ODY3Mw==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r497878673", "bodyText": "no?", "author": "azabbasi", "createdAt": "2020-10-01T00:31:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg3ODU2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzkyNjY2NA==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r497926664", "bodyText": "agree", "author": "bikamani", "createdAt": "2020-10-01T01:46:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg3ODU2Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg3ODk2Ng==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r497878966", "bodyText": "javadoc missing", "author": "azabbasi", "createdAt": "2020-10-01T00:31:34Z", "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/digitaltwin/models/DigitalTwinInvokeCommandRequestOptions.java", "diffHunk": "@@ -0,0 +1,42 @@\n+// Copyright (c) Microsoft. All rights reserved.\n+// Licensed under the MIT license. See LICENSE file in the project root for full license information.\n+\n+package com.microsoft.azure.sdk.iot.service.digitaltwin.models;\n+\n+/**\n+ * General request options that are applicable, but optional, for invoke command APIs.\n+ */\n+public final class DigitalTwinInvokeCommandRequestOptions {\n+\n+    /**\n+     * The time (in seconds) that the service waits for the device to come online.\n+     * The default is 0 seconds (which means the device must already be online) and the maximum is 300 seconds.\n+     */\n+    private Integer connectTimeoutInSeconds;\n+\n+    /**\n+     * The time (in seconds) that the service waits for the method invocation to return a response.\n+     * The default is 30 seconds, minimum is 5 seconds, and maximum is 300 seconds.\n+     */\n+    private Integer responseTimeoutInSeconds;\n+\n+    public Integer getConnectTimeoutInSeconds()\n+    {\n+        return connectTimeoutInSeconds;\n+    }\n+\n+    public void setConnectTimeoutInSeconds(Integer connectTimeoutInSeconds)", "originalCommit": "715a10906774d8763ea0b4db3038537c97211809", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg3OTA4MA==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r497879080", "bodyText": "this and below", "author": "azabbasi", "createdAt": "2020-10-01T00:31:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg3ODk2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzkyODI5MQ==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r497928291", "bodyText": "This is generated using delombok which does not add documentation unfortunately from private fields above", "author": "bikamani", "createdAt": "2020-10-01T01:49:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg3ODk2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzkyOTE0Mw==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r497929143", "bodyText": "I have added documentation for now", "author": "bikamani", "createdAt": "2020-10-01T01:50:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg3ODk2Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg3OTU4Mg==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r497879582", "bodyText": "method should be called addWritableProperty", "author": "azabbasi", "createdAt": "2020-10-01T00:32:31Z", "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/digitaltwin/serialization/DigitalTwinMetadata.java", "diffHunk": "@@ -0,0 +1,66 @@\n+// Copyright (c) Microsoft. All rights reserved.\n+// Licensed under the MIT license. See LICENSE file in the project root for full license information.\n+\n+package com.microsoft.azure.sdk.iot.service.digitaltwin.serialization;\n+\n+import com.fasterxml.jackson.annotation.JsonAnyGetter;\n+import com.fasterxml.jackson.annotation.JsonAnySetter;\n+import com.fasterxml.jackson.annotation.JsonIgnore;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+public final class DigitalTwinMetadata {\n+    /* The Id of the model that the digital twin or component is modeled by. This is present on a digital twin's root level metadata */\n+    @JsonProperty(value = \"$model\", required = true)\n+    private String modelId;\n+\n+    /* Model-defined writable properties' request state. */\n+    @JsonIgnore\n+    private final Map<String, WritableProperty> writeableProperties = new HashMap<>();\n+\n+    /**\n+     * Creates an instance of digital twin metadata.\n+     */\n+    public DigitalTwinMetadata() {\n+    }\n+\n+    /**\n+     * Gets the Id of the model that the digital twin or component is modeled by.\n+     * @return The Id of the model that the digital twin or component is modeled by.\n+     */\n+    public String getModelId() {\n+        return modelId;\n+    }\n+\n+    /**\n+     * Sets the Id of the model that the digital twin or component is modeled by.\n+     * @param modelId The Id of the model that the digital twin or component is modeled by.\n+     * @return The DigitalTwinMetadata object itself.\n+     */\n+    public DigitalTwinMetadata setModelId(String modelId) {\n+        this.modelId = modelId;\n+        return this;\n+    }\n+\n+    /**\n+     * Gets the model-defined writable properties' request state.\n+     * For your convenience, the value of each map can be turned into an instance of WritableProperty.\n+     * @return The model-defined writable properties' request state.\n+     */\n+    @JsonAnyGetter\n+    public Map<String, WritableProperty> getWriteableProperties() {\n+        return writeableProperties;\n+    }\n+\n+    /**\n+     * Sets the model-defined writable properties' request state.\n+     * @return The DigitalTwinMetadata object itself.\n+     */\n+    @JsonAnySetter\n+    DigitalTwinMetadata setWritableProperties(String key, WritableProperty value) {", "originalCommit": "715a10906774d8763ea0b4db3038537c97211809", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzkzMzEwMA==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/918#discussion_r497933100", "bodyText": "I do agree.", "author": "bikamani", "createdAt": "2020-10-01T01:56:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg3OTU4Mg=="}], "type": "inlineReview"}, {"oid": "5ceb8f5d8b44586373a77b0cabd6410e5a7f2b77", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/5ceb8f5d8b44586373a77b0cabd6410e5a7f2b77", "message": "resolving code review comments", "committedDate": "2020-10-01T02:03:52Z", "type": "commit"}, {"oid": "4405a7dea82ba4957aac1d701d2cb880c44153d0", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/4405a7dea82ba4957aac1d701d2cb880c44153d0", "message": "lombok nonnull dependency", "committedDate": "2020-10-01T02:28:05Z", "type": "commit"}, {"oid": "367a93572d545c4db3a88ba549412835b0d90304", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/367a93572d545c4db3a88ba549412835b0d90304", "message": "Add Android runner for Digital Twin tests (#956)", "committedDate": "2020-10-01T19:08:47Z", "type": "commit"}]}