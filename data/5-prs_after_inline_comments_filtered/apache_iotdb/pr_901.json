{"pr_number": 901, "pr_title": "Cheery pick changes from cluster_new", "pr_createdAt": "2020-03-11T09:43:40Z", "pr_url": "https://github.com/apache/iotdb/pull/901", "timeline": [{"oid": "0a45c19c8f07ca8014ef7d7c4a37fd9956b1de32", "url": "https://github.com/apache/iotdb/commit/0a45c19c8f07ca8014ef7d7c4a37fd9956b1de32", "message": "cheery pick changes from cluster_new:\n1. getAllClosedStorageGroupTsFile is now grouped by partition\n2. fix empty AggregationResult is not correctly serialized\n3. fix two empty AvgAggrResult merge to a wrong result\n4. fix reset in First/LastValue\n5. change member protection levels\n6. extract GroupByExecutor and LocalGroupByExecutor\n7. extract getters of readers and datasets\n8. extract fill initialization", "committedDate": "2020-03-11T09:40:39Z", "type": "commit"}, {"oid": "24540ddf39dbaf4bba2a8c7354c4955a296029fe", "url": "https://github.com/apache/iotdb/commit/24540ddf39dbaf4bba2a8c7354c4955a296029fe", "message": "fix license", "committedDate": "2020-03-12T03:34:35Z", "type": "commit"}, {"oid": "596e1c1855a0bdf505cee9fd3cd7edc7a2ebba92", "url": "https://github.com/apache/iotdb/commit/596e1c1855a0bdf505cee9fd3cd7edc7a2ebba92", "message": "simplify GroupByExecutor", "committedDate": "2020-03-13T08:15:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjA1OTYyMw==", "url": "https://github.com/apache/iotdb/pull/901#discussion_r392059623", "bodyText": "The partition number is an Integer or Long?", "author": "qiaojialin", "createdAt": "2020-03-13T07:03:50Z", "path": "server/src/main/java/org/apache/iotdb/db/engine/StorageEngine.java", "diffHunk": "@@ -529,15 +529,23 @@ private String getSgByEngineFile(File file) {\n \n   /**\n    *\n-   * @return TsFiles (seq or unseq) grouped by their storage group.\n+   * @return TsFiles (seq or unseq) grouped by their storage group and partition number.\n    */\n-  public Map<String, List<TsFileResource>> getAllClosedStorageGroupTsFile() {\n-    Map<String, List<TsFileResource>> ret = new HashMap<>();\n+  public Map<String, Map<Integer, List<TsFileResource>>> getAllClosedStorageGroupTsFile() {", "originalCommit": "24540ddf39dbaf4bba2a8c7354c4955a296029fe", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjA1OTc1Ng==", "url": "https://github.com/apache/iotdb/pull/901#discussion_r392059756", "bodyText": "only get sequence file?", "author": "qiaojialin", "createdAt": "2020-03-13T07:04:18Z", "path": "server/src/main/java/org/apache/iotdb/db/engine/StorageEngine.java", "diffHunk": "@@ -529,15 +529,23 @@ private String getSgByEngineFile(File file) {\n \n   /**\n    *\n-   * @return TsFiles (seq or unseq) grouped by their storage group.\n+   * @return TsFiles (seq or unseq) grouped by their storage group and partition number.\n    */\n-  public Map<String, List<TsFileResource>> getAllClosedStorageGroupTsFile() {\n-    Map<String, List<TsFileResource>> ret = new HashMap<>();\n+  public Map<String, Map<Integer, List<TsFileResource>>> getAllClosedStorageGroupTsFile() {\n+    Map<String, Map<Integer, List<TsFileResource>>> ret = new HashMap<>();\n     for (Entry<String, StorageGroupProcessor> entry : processorMap\n         .entrySet()) {\n-      ret.computeIfAbsent(entry.getKey(), sg -> new ArrayList<>()).addAll(entry.getValue().getSequenceFileTreeSet());\n-      ret.get(entry.getKey()).addAll(entry.getValue().getUnSequenceFileList());\n-      ret.get(entry.getKey()).removeIf(file -> !file.isClosed());\n+      List<TsFileResource> sequenceFiles = entry.getValue().getSequenceFileTreeSet();", "originalCommit": "24540ddf39dbaf4bba2a8c7354c4955a296029fe", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjA2MDc5Nw==", "url": "https://github.com/apache/iotdb/pull/901#discussion_r392060797", "bodyText": "part?", "author": "qiaojialin", "createdAt": "2020-03-13T07:08:02Z", "path": "server/src/main/java/org/apache/iotdb/db/metadata/MManager.java", "diffHunk": "@@ -885,7 +885,7 @@ public void collectSeries(String startingPath, List<MeasurementSchema> timeserie\n    * and the wildcard will be removed.\n    * If the wildcard is at the tail, then the inference will go on until the storage groups are found\n    * and the wildcard will be kept.\n-   * (2) Suppose the part of the path is a substring that begin after the storage group name. (e.g.,\n+   * (2) Suppose the path of the path is a substring that begin after the storage group name. (e.g.,", "originalCommit": "24540ddf39dbaf4bba2a8c7354c4955a296029fe", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "acd5fee1467a982da1bccbf95194c6d49aebf1db", "url": "https://github.com/apache/iotdb/commit/acd5fee1467a982da1bccbf95194c6d49aebf1db", "message": "fix sonar and getAllResource", "committedDate": "2020-03-13T08:37:32Z", "type": "commit"}, {"oid": "9544f2a7b534afc01497605e44828b96afdce381", "url": "https://github.com/apache/iotdb/commit/9544f2a7b534afc01497605e44828b96afdce381", "message": "fix last getDeviceNode", "committedDate": "2020-03-13T08:45:36Z", "type": "commit"}, {"oid": "ed1ac34c55302ee89e34cc49f4e812a430fd8223", "url": "https://github.com/apache/iotdb/commit/ed1ac34c55302ee89e34cc49f4e812a430fd8223", "message": "extract get series type in TSServiceImpl", "committedDate": "2020-03-13T09:27:27Z", "type": "commit"}, {"oid": "215197eacb6495f568b7d83f18c463d88fa15d01", "url": "https://github.com/apache/iotdb/commit/215197eacb6495f568b7d83f18c463d88fa15d01", "message": "Merge branch 'master' into cherry_pick_cluster_2", "committedDate": "2020-03-13T09:28:44Z", "type": "commit"}]}