{"pr_number": 1796, "pr_title": "[IOTDB-886]fix float loss precision", "pr_createdAt": "2020-10-05T08:38:21Z", "pr_url": "https://github.com/apache/iotdb/pull/1796", "timeline": [{"oid": "f089cf41c6e6bcc4888e36ada093789e001f3e22", "url": "https://github.com/apache/iotdb/commit/f089cf41c6e6bcc4888e36ada093789e001f3e22", "message": "fix float loss precision", "committedDate": "2020-10-05T08:36:39Z", "type": "commit"}, {"oid": "d0c4ed687489e0cf7031c173fd2e6ba5f05318e9", "url": "https://github.com/apache/iotdb/commit/d0c4ed687489e0cf7031c173fd2e6ba5f05318e9", "message": "add test", "committedDate": "2020-10-05T09:34:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzQxMDExOQ==", "url": "https://github.com/apache/iotdb/pull/1796#discussion_r507410119", "bodyText": "This may be time-consuming when insert integer string.", "author": "qiaojialin", "createdAt": "2020-10-19T03:30:48Z", "path": "server/src/main/java/org/apache/iotdb/db/utils/TypeInferenceUtils.java", "diffHunk": "@@ -52,6 +54,10 @@ private static boolean isBoolean(String s) {\n         .equalsIgnoreCase(SQLConstant.BOOLEAN_FALSE);\n   }\n \n+  private static boolean isConvertFloatPrecisionLack(String s){\n+    return Long.parseLong(s) > (2 << 24);", "originalCommit": "d0c4ed687489e0cf7031c173fd2e6ba5f05318e9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODEzMDkzNQ==", "url": "https://github.com/apache/iotdb/pull/1796#discussion_r508130935", "bodyText": "how about just check the length of the string?", "author": "jixuan1989", "createdAt": "2020-10-20T00:04:15Z", "path": "server/src/main/java/org/apache/iotdb/db/utils/TypeInferenceUtils.java", "diffHunk": "@@ -63,6 +69,9 @@ public static TSDataType getPredictedDataType(Object value, boolean inferType) {\n         return booleanStringInferType;\n       } else if (isNumber(strValue)){\n         if (!strValue.contains(TsFileConstant.PATH_SEPARATOR)) {\n+          if (isConvertFloatPrecisionLack(strValue)) {", "originalCommit": "d0c4ed687489e0cf7031c173fd2e6ba5f05318e9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTYxNDAwMw==", "url": "https://github.com/apache/iotdb/pull/1796#discussion_r511614003", "bodyText": "this will only happen at the first insertion of a time series, don't worry", "author": "qiaojialin", "createdAt": "2020-10-25T15:50:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODEzMDkzNQ=="}], "type": "inlineReview"}]}