{"pr_number": 1289, "pr_title": "Add force stop storage engine interface", "pr_createdAt": "2020-05-29T12:40:54Z", "pr_url": "https://github.com/apache/iotdb/pull/1289", "timeline": [{"oid": "d3d70dee3cc01fbb21629877ac9c6f7099beeaed", "url": "https://github.com/apache/iotdb/commit/d3d70dee3cc01fbb21629877ac9c6f7099beeaed", "message": "add some test", "committedDate": "2020-05-29T12:41:00Z", "type": "commit"}, {"oid": "02c2d1f963c2026ba1bfb0213f75243fccd02df9", "url": "https://github.com/apache/iotdb/commit/02c2d1f963c2026ba1bfb0213f75243fccd02df9", "message": "add one more test", "committedDate": "2020-05-29T14:47:23Z", "type": "commit"}, {"oid": "882508530059235e3f501f8f79de0edb1c8792be", "url": "https://github.com/apache/iotdb/commit/882508530059235e3f501f8f79de0edb1c8792be", "message": "add testStop", "committedDate": "2020-06-01T03:03:13Z", "type": "commit"}, {"oid": "7638bfff96dc62c3e57e0ebeb57782b128e790c9", "url": "https://github.com/apache/iotdb/commit/7638bfff96dc62c3e57e0ebeb57782b128e790c9", "message": "Merge branch 'master' of https://github.com/apache/incubator-iotdb into add_restart_test", "committedDate": "2020-06-01T03:03:24Z", "type": "commit"}, {"oid": "a3d2f0de5e41cbfde9360293d9c4cac8fdba87aa", "url": "https://github.com/apache/iotdb/commit/a3d2f0de5e41cbfde9360293d9c4cac8fdba87aa", "message": "fix sonar", "committedDate": "2020-06-01T03:28:41Z", "type": "commit"}, {"oid": "8f0f62f1e3dbb431cc2895762909890bd73c93e0", "url": "https://github.com/apache/iotdb/commit/8f0f62f1e3dbb431cc2895762909890bd73c93e0", "message": "refactor testStop", "committedDate": "2020-06-01T08:31:11Z", "type": "commit"}, {"oid": "a677d2626709a7d39268f4afb44dcb3f2c1f87e5", "url": "https://github.com/apache/iotdb/commit/a677d2626709a7d39268f4afb44dcb3f2c1f87e5", "message": "fix sonar", "committedDate": "2020-06-01T08:47:07Z", "type": "commit"}, {"oid": "425d1f016b813ad096718224dbc6034459471253", "url": "https://github.com/apache/iotdb/commit/425d1f016b813ad096718224dbc6034459471253", "message": "fix windows test", "committedDate": "2020-06-02T01:48:51Z", "type": "commit"}, {"oid": "6f07f327f33b5c7f080ee1864183a5263f4d30cf", "url": "https://github.com/apache/iotdb/commit/6f07f327f33b5c7f080ee1864183a5263f4d30cf", "message": "Merge branch 'master' of https://github.com/apache/incubator-iotdb into add_restart_test", "committedDate": "2020-06-11T09:44:30Z", "type": "commit"}, {"oid": "0c3cf3112e02729f5851d7dce808c0dda6b00005", "url": "https://github.com/apache/iotdb/commit/0c3cf3112e02729f5851d7dce808c0dda6b00005", "message": "force stop storage engine", "committedDate": "2020-06-12T09:11:27Z", "type": "commit"}, {"oid": "45604e567b36b96bdaac6e76fe31330d136d11fe", "url": "https://github.com/apache/iotdb/commit/45604e567b36b96bdaac6e76fe31330d136d11fe", "message": "fix test", "committedDate": "2020-06-13T06:16:12Z", "type": "commit"}, {"oid": "2b0e2f6996df2b4a452adef95558703abd9d19de", "url": "https://github.com/apache/iotdb/commit/2b0e2f6996df2b4a452adef95558703abd9d19de", "message": "fix test", "committedDate": "2020-06-15T05:31:33Z", "type": "commit"}, {"oid": "c933d1ebbb64a9c9d8eceea79a5082c5ba8eae94", "url": "https://github.com/apache/iotdb/commit/c933d1ebbb64a9c9d8eceea79a5082c5ba8eae94", "message": "fix mmanager init", "committedDate": "2020-06-15T07:32:21Z", "type": "commit"}, {"oid": "fa9d71f46accebd3240d4a287a1823e957671862", "url": "https://github.com/apache/iotdb/commit/fa9d71f46accebd3240d4a287a1823e957671862", "message": "fix wal", "committedDate": "2020-06-15T08:51:20Z", "type": "commit"}, {"oid": "52d35ed4e4ba9532ca38f1d67f17640ed440fef0", "url": "https://github.com/apache/iotdb/commit/52d35ed4e4ba9532ca38f1d67f17640ed440fef0", "message": "stop wal", "committedDate": "2020-06-16T08:15:05Z", "type": "commit"}, {"oid": "1ff4135b88ec8d9afb3739b40e7e4e7840b1d180", "url": "https://github.com/apache/iotdb/commit/1ff4135b88ec8d9afb3739b40e7e4e7840b1d180", "message": "add normal stop back", "committedDate": "2020-06-17T02:26:07Z", "type": "commit"}, {"oid": "4fd8240529106943fd0bd2c6432db39229558c46", "url": "https://github.com/apache/iotdb/commit/4fd8240529106943fd0bd2c6432db39229558c46", "message": "Merge branch 'master' of https://github.com/apache/incubator-iotdb into add_restart_test", "committedDate": "2020-06-17T05:58:36Z", "type": "commit"}, {"oid": "859f165811a7a74c25499709c0548a4879afb6bb", "url": "https://github.com/apache/iotdb/commit/859f165811a7a74c25499709c0548a4879afb6bb", "message": "fix sonar", "committedDate": "2020-06-17T06:09:01Z", "type": "commit"}, {"oid": "4f6608781f87f2b98c0a122fc4d6bbf3a34a6846", "url": "https://github.com/apache/iotdb/commit/4f6608781f87f2b98c0a122fc4d6bbf3a34a6846", "message": "fix sonar", "committedDate": "2020-06-17T06:19:29Z", "type": "commit"}, {"oid": "a628fdc9c53806dc311f60c68d0dfca370d433e0", "url": "https://github.com/apache/iotdb/commit/a628fdc9c53806dc311f60c68d0dfca370d433e0", "message": "try fix error", "committedDate": "2020-06-17T13:24:28Z", "type": "commit"}, {"oid": "8198df42ed72a3d42283ce3764b3ab7f8bd2431e", "url": "https://github.com/apache/iotdb/commit/8198df42ed72a3d42283ce3764b3ab7f8bd2431e", "message": "try fix error", "committedDate": "2020-06-18T05:43:01Z", "type": "commit"}, {"oid": "ae2e139d73162d7f69492798af558b3013b36d46", "url": "https://github.com/apache/iotdb/commit/ae2e139d73162d7f69492798af558b3013b36d46", "message": "wal", "committedDate": "2020-06-18T07:50:46Z", "type": "commit"}, {"oid": "132767e0ee91eb6d705c4c6d3ca646fc29acfad6", "url": "https://github.com/apache/iotdb/commit/132767e0ee91eb6d705c4c6d3ca646fc29acfad6", "message": "add is open check", "committedDate": "2020-06-18T08:28:22Z", "type": "commit"}, {"oid": "d3cfa1025329d94f8360bffb0878f6c7c6ebf234", "url": "https://github.com/apache/iotdb/commit/d3cfa1025329d94f8360bffb0878f6c7c6ebf234", "message": "fix restart ci", "committedDate": "2020-06-18T09:28:13Z", "type": "commit"}, {"oid": "81222191bb9ae8f0aa53719de96cb22751cfb31a", "url": "https://github.com/apache/iotdb/commit/81222191bb9ae8f0aa53719de96cb22751cfb31a", "message": "fix restart ci", "committedDate": "2020-06-18T09:30:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjE2ODQ0OQ==", "url": "https://github.com/apache/iotdb/pull/1289#discussion_r442168449", "bodyText": "Why we need to set it to true, it seems thats it has been set to true in the constructor of MMangaer.", "author": "JackieTien97", "createdAt": "2020-06-18T11:51:32Z", "path": "server/src/main/java/org/apache/iotdb/db/metadata/MManager.java", "diffHunk": "@@ -176,6 +176,7 @@ public synchronized void init() {\n     try {\n       tagLogFile = new TagLogFile(config.getSchemaDir(), MetadataConstant.TAG_LOG);\n \n+      isRecovering = true;", "originalCommit": "81222191bb9ae8f0aa53719de96cb22751cfb31a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjIzMzg4NA==", "url": "https://github.com/apache/iotdb/pull/1289#discussion_r442233884", "bodyText": "Actually, when IoTDB close and restart using API, we don't get a new Instance of MManager. If we didn't set isRecovering = true here, the value of isRecovering would be null.", "author": "HTHou", "createdAt": "2020-06-18T13:40:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjE2ODQ0OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjE4Mzc5OQ==", "url": "https://github.com/apache/iotdb/pull/1289#discussion_r442183799", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                EnvironmentUtils.shutdownDaemon();\n          \n          \n            \n                EnvironmentUtils.reactiveDaemon();\n          \n          \n            \n                EnvironmentUtils.restartDaemon();", "author": "JackieTien97", "createdAt": "2020-06-18T12:20:44Z", "path": "server/src/test/java/org/apache/iotdb/db/integration/IoTDBRecoverUnclosedIT.java", "diffHunk": "@@ -0,0 +1,267 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.iotdb.db.integration;\n+\n+import static org.apache.iotdb.db.constant.TestConstant.count;\n+import static org.apache.iotdb.db.constant.TestConstant.max_value;\n+import static org.apache.iotdb.db.constant.TestConstant.min_time;\n+import static org.apache.iotdb.db.constant.TestConstant.min_value;\n+import static org.junit.Assert.fail;\n+\n+import java.io.IOException;\n+import java.sql.Connection;\n+import java.sql.DriverManager;\n+import java.sql.ResultSet;\n+import java.sql.SQLException;\n+import java.sql.Statement;\n+import java.util.Locale;\n+import org.apache.iotdb.db.exception.StartupException;\n+import org.apache.iotdb.db.utils.EnvironmentUtils;\n+import org.apache.iotdb.jdbc.Config;\n+import org.junit.After;\n+import org.junit.Assert;\n+import org.junit.Before;\n+import org.junit.Test;\n+\n+public class IoTDBRecoverUnclosedIT {\n+\n+  private static final String TIMESTAMP_STR = \"Time\";\n+  private static final String TEMPERATURE_STR = \"root.ln.wf01.wt01.temperature\";\n+  private static String[] creationSqls = new String[]{\n+      \"SET STORAGE GROUP TO root.vehicle.d0\",\n+      \"SET STORAGE GROUP TO root.vehicle.d1\",\n+\n+      \"CREATE TIMESERIES root.vehicle.d0.s0 WITH DATATYPE=INT32, ENCODING=RLE\",\n+      \"CREATE TIMESERIES root.vehicle.d0.s1 WITH DATATYPE=INT64, ENCODING=RLE\",\n+      \"CREATE TIMESERIES root.vehicle.d0.s2 WITH DATATYPE=FLOAT, ENCODING=RLE\",\n+      \"CREATE TIMESERIES root.vehicle.d0.s3 WITH DATATYPE=TEXT, ENCODING=PLAIN\",\n+      \"CREATE TIMESERIES root.vehicle.d0.s4 WITH DATATYPE=BOOLEAN, ENCODING=PLAIN\"\n+  };\n+  private static String[] dataSet2 = new String[]{\n+      \"SET STORAGE GROUP TO root.ln.wf01.wt01\",\n+      \"CREATE TIMESERIES root.ln.wf01.wt01.status WITH DATATYPE=BOOLEAN, ENCODING=PLAIN\",\n+      \"CREATE TIMESERIES root.ln.wf01.wt01.temperature WITH DATATYPE=FLOAT, ENCODING=PLAIN\",\n+      \"CREATE TIMESERIES root.ln.wf01.wt01.hardware WITH DATATYPE=INT32, ENCODING=PLAIN\",\n+      \"INSERT INTO root.ln.wf01.wt01(timestamp,temperature,status, hardware) \"\n+          + \"values(1, 1.1, false, 11)\",\n+      \"INSERT INTO root.ln.wf01.wt01(timestamp,temperature,status, hardware) \"\n+          + \"values(2, 2.2, true, 22)\",\n+      \"INSERT INTO root.ln.wf01.wt01(timestamp,temperature,status, hardware) \"\n+          + \"values(3, 3.3, false, 33 )\",\n+      \"INSERT INTO root.ln.wf01.wt01(timestamp,temperature,status, hardware) \"\n+          + \"values(4, 4.4, false, 44)\",\n+      \"INSERT INTO root.ln.wf01.wt01(timestamp,temperature,status, hardware) \"\n+          + \"values(5, 5.5, false, 55)\"\n+  };\n+  private final String d0s0 = \"root.vehicle.d0.s0\";\n+  private final String d0s1 = \"root.vehicle.d0.s1\";\n+  private final String d0s2 = \"root.vehicle.d0.s2\";\n+  private final String d0s3 = \"root.vehicle.d0.s3\";\n+  private String insertTemplate = \"INSERT INTO root.vehicle.d0(timestamp,s0,s1,s2,s3,s4)\"\n+      + \" VALUES(%d,%d,%d,%f,%s,%s)\";\n+\n+  @Before\n+  public void setUp() throws Exception {\n+    EnvironmentUtils.closeStatMonitor();\n+\n+    EnvironmentUtils.envSetUp();\n+    Class.forName(Config.JDBC_DRIVER_NAME);\n+    prepareData();\n+  }\n+\n+  @After\n+  public void tearDown() throws Exception {\n+    EnvironmentUtils.cleanEnv();\n+  }\n+\n+  @Test\n+  public void test() throws SQLException, IOException, StartupException {\n+    String[] retArray = new String[]{\n+        \"0,2\",\n+        \"0,4\",\n+        \"0,3\"\n+    };\n+    try (Connection connection = DriverManager.\n+        getConnection(\"jdbc:iotdb://127.0.0.1:6667/\", \"root\", \"root\");\n+        Statement statement = connection.createStatement()) {\n+\n+      boolean hasResultSet = statement.execute(\n+          \"select count(temperature) from root.ln.wf01.wt01 where time > 3\");\n+\n+      Assert.assertTrue(hasResultSet);\n+      int cnt;\n+      try (ResultSet resultSet = statement.getResultSet();) {\n+        cnt = 0;\n+        while (resultSet.next()) {\n+          String ans = resultSet.getString(TIMESTAMP_STR) + \",\" +\n+              resultSet.getString(count(TEMPERATURE_STR));\n+          Assert.assertEquals(retArray[cnt], ans);\n+          cnt++;\n+        }\n+        Assert.assertEquals(1, cnt);\n+      }\n+\n+      hasResultSet = statement.execute(\n+          \"select min_time(temperature) from root.ln.wf01.wt01 where time > 3\");\n+\n+      Assert.assertTrue(hasResultSet);\n+      try (ResultSet resultSet = statement.getResultSet()) {\n+        while (resultSet.next()) {\n+          String ans = resultSet.getString(TIMESTAMP_STR) + \",\" +\n+              resultSet.getString(min_time(TEMPERATURE_STR));\n+          Assert.assertEquals(retArray[cnt], ans);\n+          cnt++;\n+        }\n+        Assert.assertEquals(2, cnt);\n+      }\n+\n+      hasResultSet = statement.execute(\n+          \"select min_time(temperature) from root.ln.wf01.wt01 where temperature > 3\");\n+\n+      Assert.assertTrue(hasResultSet);\n+      try (ResultSet resultSet = statement.getResultSet()) {\n+        while (resultSet.next()) {\n+          String ans = resultSet.getString(TIMESTAMP_STR) + \",\" +\n+              resultSet.getString(min_time(TEMPERATURE_STR));\n+          Assert.assertEquals(retArray[cnt], ans);\n+          cnt++;\n+        }\n+        Assert.assertEquals(3, cnt);\n+      }\n+\n+    } catch (Exception e) {\n+      e.printStackTrace();\n+      fail(e.getMessage());\n+    }\n+\n+    EnvironmentUtils.shutdownDaemon();\n+    EnvironmentUtils.reactiveDaemon();", "originalCommit": "81222191bb9ae8f0aa53719de96cb22751cfb31a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjI1NTg2NQ==", "url": "https://github.com/apache/iotdb/pull/1289#discussion_r442255865", "bodyText": "Fixed, thanks~", "author": "HTHou", "createdAt": "2020-06-18T14:10:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjE4Mzc5OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjE4NDAyOQ==", "url": "https://github.com/apache/iotdb/pull/1289#discussion_r442184029", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                EnvironmentUtils.shutdownDaemon();\n          \n          \n            \n                EnvironmentUtils.reactiveDaemon();\n          \n          \n            \n                EnvironmentUtils.restartDaemon();", "author": "JackieTien97", "createdAt": "2020-06-18T12:21:06Z", "path": "server/src/test/java/org/apache/iotdb/db/integration/IoTDBRecoverUnclosedIT.java", "diffHunk": "@@ -0,0 +1,267 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.iotdb.db.integration;\n+\n+import static org.apache.iotdb.db.constant.TestConstant.count;\n+import static org.apache.iotdb.db.constant.TestConstant.max_value;\n+import static org.apache.iotdb.db.constant.TestConstant.min_time;\n+import static org.apache.iotdb.db.constant.TestConstant.min_value;\n+import static org.junit.Assert.fail;\n+\n+import java.io.IOException;\n+import java.sql.Connection;\n+import java.sql.DriverManager;\n+import java.sql.ResultSet;\n+import java.sql.SQLException;\n+import java.sql.Statement;\n+import java.util.Locale;\n+import org.apache.iotdb.db.exception.StartupException;\n+import org.apache.iotdb.db.utils.EnvironmentUtils;\n+import org.apache.iotdb.jdbc.Config;\n+import org.junit.After;\n+import org.junit.Assert;\n+import org.junit.Before;\n+import org.junit.Test;\n+\n+public class IoTDBRecoverUnclosedIT {\n+\n+  private static final String TIMESTAMP_STR = \"Time\";\n+  private static final String TEMPERATURE_STR = \"root.ln.wf01.wt01.temperature\";\n+  private static String[] creationSqls = new String[]{\n+      \"SET STORAGE GROUP TO root.vehicle.d0\",\n+      \"SET STORAGE GROUP TO root.vehicle.d1\",\n+\n+      \"CREATE TIMESERIES root.vehicle.d0.s0 WITH DATATYPE=INT32, ENCODING=RLE\",\n+      \"CREATE TIMESERIES root.vehicle.d0.s1 WITH DATATYPE=INT64, ENCODING=RLE\",\n+      \"CREATE TIMESERIES root.vehicle.d0.s2 WITH DATATYPE=FLOAT, ENCODING=RLE\",\n+      \"CREATE TIMESERIES root.vehicle.d0.s3 WITH DATATYPE=TEXT, ENCODING=PLAIN\",\n+      \"CREATE TIMESERIES root.vehicle.d0.s4 WITH DATATYPE=BOOLEAN, ENCODING=PLAIN\"\n+  };\n+  private static String[] dataSet2 = new String[]{\n+      \"SET STORAGE GROUP TO root.ln.wf01.wt01\",\n+      \"CREATE TIMESERIES root.ln.wf01.wt01.status WITH DATATYPE=BOOLEAN, ENCODING=PLAIN\",\n+      \"CREATE TIMESERIES root.ln.wf01.wt01.temperature WITH DATATYPE=FLOAT, ENCODING=PLAIN\",\n+      \"CREATE TIMESERIES root.ln.wf01.wt01.hardware WITH DATATYPE=INT32, ENCODING=PLAIN\",\n+      \"INSERT INTO root.ln.wf01.wt01(timestamp,temperature,status, hardware) \"\n+          + \"values(1, 1.1, false, 11)\",\n+      \"INSERT INTO root.ln.wf01.wt01(timestamp,temperature,status, hardware) \"\n+          + \"values(2, 2.2, true, 22)\",\n+      \"INSERT INTO root.ln.wf01.wt01(timestamp,temperature,status, hardware) \"\n+          + \"values(3, 3.3, false, 33 )\",\n+      \"INSERT INTO root.ln.wf01.wt01(timestamp,temperature,status, hardware) \"\n+          + \"values(4, 4.4, false, 44)\",\n+      \"INSERT INTO root.ln.wf01.wt01(timestamp,temperature,status, hardware) \"\n+          + \"values(5, 5.5, false, 55)\"\n+  };\n+  private final String d0s0 = \"root.vehicle.d0.s0\";\n+  private final String d0s1 = \"root.vehicle.d0.s1\";\n+  private final String d0s2 = \"root.vehicle.d0.s2\";\n+  private final String d0s3 = \"root.vehicle.d0.s3\";\n+  private String insertTemplate = \"INSERT INTO root.vehicle.d0(timestamp,s0,s1,s2,s3,s4)\"\n+      + \" VALUES(%d,%d,%d,%f,%s,%s)\";\n+\n+  @Before\n+  public void setUp() throws Exception {\n+    EnvironmentUtils.closeStatMonitor();\n+\n+    EnvironmentUtils.envSetUp();\n+    Class.forName(Config.JDBC_DRIVER_NAME);\n+    prepareData();\n+  }\n+\n+  @After\n+  public void tearDown() throws Exception {\n+    EnvironmentUtils.cleanEnv();\n+  }\n+\n+  @Test\n+  public void test() throws SQLException, IOException, StartupException {\n+    String[] retArray = new String[]{\n+        \"0,2\",\n+        \"0,4\",\n+        \"0,3\"\n+    };\n+    try (Connection connection = DriverManager.\n+        getConnection(\"jdbc:iotdb://127.0.0.1:6667/\", \"root\", \"root\");\n+        Statement statement = connection.createStatement()) {\n+\n+      boolean hasResultSet = statement.execute(\n+          \"select count(temperature) from root.ln.wf01.wt01 where time > 3\");\n+\n+      Assert.assertTrue(hasResultSet);\n+      int cnt;\n+      try (ResultSet resultSet = statement.getResultSet();) {\n+        cnt = 0;\n+        while (resultSet.next()) {\n+          String ans = resultSet.getString(TIMESTAMP_STR) + \",\" +\n+              resultSet.getString(count(TEMPERATURE_STR));\n+          Assert.assertEquals(retArray[cnt], ans);\n+          cnt++;\n+        }\n+        Assert.assertEquals(1, cnt);\n+      }\n+\n+      hasResultSet = statement.execute(\n+          \"select min_time(temperature) from root.ln.wf01.wt01 where time > 3\");\n+\n+      Assert.assertTrue(hasResultSet);\n+      try (ResultSet resultSet = statement.getResultSet()) {\n+        while (resultSet.next()) {\n+          String ans = resultSet.getString(TIMESTAMP_STR) + \",\" +\n+              resultSet.getString(min_time(TEMPERATURE_STR));\n+          Assert.assertEquals(retArray[cnt], ans);\n+          cnt++;\n+        }\n+        Assert.assertEquals(2, cnt);\n+      }\n+\n+      hasResultSet = statement.execute(\n+          \"select min_time(temperature) from root.ln.wf01.wt01 where temperature > 3\");\n+\n+      Assert.assertTrue(hasResultSet);\n+      try (ResultSet resultSet = statement.getResultSet()) {\n+        while (resultSet.next()) {\n+          String ans = resultSet.getString(TIMESTAMP_STR) + \",\" +\n+              resultSet.getString(min_time(TEMPERATURE_STR));\n+          Assert.assertEquals(retArray[cnt], ans);\n+          cnt++;\n+        }\n+        Assert.assertEquals(3, cnt);\n+      }\n+\n+    } catch (Exception e) {\n+      e.printStackTrace();\n+      fail(e.getMessage());\n+    }\n+\n+    EnvironmentUtils.shutdownDaemon();\n+    EnvironmentUtils.reactiveDaemon();\n+    \n+    insertMoreData();\n+\n+    EnvironmentUtils.shutdownDaemon();\n+    EnvironmentUtils.reactiveDaemon();", "originalCommit": "81222191bb9ae8f0aa53719de96cb22751cfb31a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjI1NzQ0NA==", "url": "https://github.com/apache/iotdb/pull/1289#discussion_r442257444", "bodyText": "Fixed~", "author": "HTHou", "createdAt": "2020-06-18T14:12:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjE4NDAyOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjE4NTg0Ng==", "url": "https://github.com/apache/iotdb/pull/1289#discussion_r442185846", "bodyText": "I think you should rethrow the exception, and in the tests, you should catch it, and add failed() clause.", "author": "JackieTien97", "createdAt": "2020-06-18T12:24:24Z", "path": "server/src/main/java/org/apache/iotdb/db/service/RegisterManager.java", "diffHunk": "@@ -64,4 +65,21 @@ public void deregisterAll() {\n     iServices.clear();\n     logger.info(\"deregister all service.\");\n   }\n+  \n+  /**\n+   * stop all service and clear iService list.\n+   */\n+  public void shutdownAll() {\n+    //we stop JMXServer at last\n+    Collections.reverse(iServices);\n+    for (IService service : iServices) {\n+      try {\n+        service.shutdown(10000);\n+      } catch (Exception e) {\n+        logger.error(\"Failed to stop {} because:\", service.getID().getName(), e);", "originalCommit": "81222191bb9ae8f0aa53719de96cb22751cfb31a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjI3NzIxMQ==", "url": "https://github.com/apache/iotdb/pull/1289#discussion_r442277211", "bodyText": "Very good point! Thanks. Fixed.", "author": "HTHou", "createdAt": "2020-06-18T14:37:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjE4NTg0Ng=="}], "type": "inlineReview"}, {"oid": "c68d6f5e2516d2525a4eecd3ec011e7c0124e455", "url": "https://github.com/apache/iotdb/commit/c68d6f5e2516d2525a4eecd3ec011e7c0124e455", "message": "fix review", "committedDate": "2020-06-18T14:53:30Z", "type": "commit"}, {"oid": "85f1c0ca154f628a950501db81c1178dffd3443c", "url": "https://github.com/apache/iotdb/commit/85f1c0ca154f628a950501db81c1178dffd3443c", "message": "throw exception when shutdown", "committedDate": "2020-06-19T02:52:28Z", "type": "commit"}, {"oid": "af281695d449d65913633c24394cdd1196bb0550", "url": "https://github.com/apache/iotdb/commit/af281695d449d65913633c24394cdd1196bb0550", "message": "code smells", "committedDate": "2020-06-19T06:28:49Z", "type": "commit"}]}