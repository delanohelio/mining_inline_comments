{"pr_number": 1544, "pr_title": "[IOTDB-810] Set Configuration of Max Number of Logs in Memory", "pr_createdAt": "2020-07-23T02:56:21Z", "pr_url": "https://github.com/apache/iotdb/pull/1544", "timeline": [{"oid": "995dba58e02c03f29425f6d4ca13aa0c99d951bc", "url": "https://github.com/apache/iotdb/commit/995dba58e02c03f29425f6d4ca13aa0c99d951bc", "message": "add max num of logs in mem config", "committedDate": "2020-07-22T13:29:52Z", "type": "commit"}, {"oid": "23daa1115a27e2d63b9d5b6a29135ecb7e8d7242", "url": "https://github.com/apache/iotdb/commit/23daa1115a27e2d63b9d5b6a29135ecb7e8d7242", "message": "rename minimum number of logs in memory", "committedDate": "2020-07-22T13:37:36Z", "type": "commit"}, {"oid": "8817a1c8bd8dc7f37cd58a4c3e3ee63c4c646449", "url": "https://github.com/apache/iotdb/commit/8817a1c8bd8dc7f37cd58a4c3e3ee63c4c646449", "message": "rename min config", "committedDate": "2020-07-22T13:46:06Z", "type": "commit"}, {"oid": "de0e8ab867381be2d986dab9d85980421042179c", "url": "https://github.com/apache/iotdb/commit/de0e8ab867381be2d986dab9d85980421042179c", "message": "typo", "committedDate": "2020-07-22T13:46:39Z", "type": "commit"}, {"oid": "0edbcd7978599767b9d5f54b51ab621dcdad4718", "url": "https://github.com/apache/iotdb/commit/0edbcd7978599767b9d5f54b51ab621dcdad4718", "message": "log number out of bound exception", "committedDate": "2020-07-23T02:53:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTg1MDI3MA==", "url": "https://github.com/apache/iotdb/pull/1544#discussion_r459850270", "bodyText": "Maybe this should be 1000 or at least a different number from min.", "author": "jt2594838", "createdAt": "2020-07-24T04:48:47Z", "path": "cluster/src/main/java/org/apache/iotdb/cluster/config/ClusterConfig.java", "diffHunk": "@@ -63,7 +63,12 @@\n   /**\n    * max number of committed logs to be saved\n    */\n-  private int maxNumberOfLogs = 100;\n+  private int minNumOfLogsInMem = 100;\n+\n+  /**\n+   * max number of committed logs in memory\n+   */\n+  private int maxNumOfLogsInMem = 100;", "originalCommit": "0edbcd7978599767b9d5f54b51ab621dcdad4718", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDAzNjA2Nw==", "url": "https://github.com/apache/iotdb/pull/1544#discussion_r460036067", "bodyText": "Sorry for the mistake. I will correct it.", "author": "Ring-k", "createdAt": "2020-07-24T12:58:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTg1MDI3MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTg1MTIwOA==", "url": "https://github.com/apache/iotdb/pull/1544#discussion_r459851208", "bodyText": "You should trigger a log deletion and proceed the committing instead of throwing an exception.", "author": "jt2594838", "createdAt": "2020-07-24T04:53:36Z", "path": "cluster/src/main/java/org/apache/iotdb/cluster/log/manage/RaftLogManager.java", "diffHunk": "@@ -415,6 +423,9 @@ public void commitTo(long newCommitIndex, boolean ignoreExecutionExceptions)\n               .clear();\n         }\n         try {\n+          if (committedEntryManager.getTotalSize() + entries.size() > maxNumOfLogsInMem) {\n+            throw new LogNumberOutOfBoundException();\n+          }", "originalCommit": "0edbcd7978599767b9d5f54b51ab621dcdad4718", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDA1NTExNQ==", "url": "https://github.com/apache/iotdb/pull/1544#discussion_r460055115", "bodyText": "I see. Thanks for your suggestion.", "author": "Ring-k", "createdAt": "2020-07-24T13:34:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTg1MTIwOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTg1MTQwNw==", "url": "https://github.com/apache/iotdb/pull/1544#discussion_r459851407", "bodyText": "This exception is unneeded, and we should solve it silently by triggering a log deletion.", "author": "jt2594838", "createdAt": "2020-07-24T04:54:41Z", "path": "cluster/src/main/java/org/apache/iotdb/cluster/exception/LogNumberOutOfBoundException.java", "diffHunk": "@@ -0,0 +1,35 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.iotdb.cluster.exception;\n+\n+public class LogNumberOutOfBoundException extends Exception{", "originalCommit": "0edbcd7978599767b9d5f54b51ab621dcdad4718", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDAzNTQ1MQ==", "url": "https://github.com/apache/iotdb/pull/1544#discussion_r460035451", "bodyText": "Thanks for your advice. I will remove it.", "author": "Ring-k", "createdAt": "2020-07-24T12:57:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTg1MTQwNw=="}], "type": "inlineReview"}, {"oid": "d01a1dec972d9cb177664a59f7a211c5b85e9253", "url": "https://github.com/apache/iotdb/commit/d01a1dec972d9cb177664a59f7a211c5b85e9253", "message": "delete", "committedDate": "2020-07-24T12:53:47Z", "type": "commit"}, {"oid": "4628d064bc88a9e4c89f6f859440a0b5d1601729", "url": "https://github.com/apache/iotdb/commit/4628d064bc88a9e4c89f6f859440a0b5d1601729", "message": "comments", "committedDate": "2020-07-24T12:54:47Z", "type": "commit"}, {"oid": "a049ceaf78487ba5539e13e72baf4736e7bd05db", "url": "https://github.com/apache/iotdb/commit/a049ceaf78487ba5539e13e72baf4736e7bd05db", "message": "Merge branch 'cluster_new' into kyy2", "committedDate": "2020-07-24T12:56:23Z", "type": "commit"}, {"oid": "013c179c814e324a76ab1c001155c1af9c91f49e", "url": "https://github.com/apache/iotdb/commit/013c179c814e324a76ab1c001155c1af9c91f49e", "message": "extract delete log", "committedDate": "2020-07-24T13:07:42Z", "type": "commit"}]}