{"pr_number": 1433, "pr_title": "Abstract InsertPlan", "pr_createdAt": "2020-06-29T05:06:25Z", "pr_url": "https://github.com/apache/iotdb/pull/1433", "timeline": [{"oid": "eb3efa85fec76531e99051ef1f61131227f4660d", "url": "https://github.com/apache/iotdb/commit/eb3efa85fec76531e99051ef1f61131227f4660d", "message": "Abstract insertPlan", "committedDate": "2020-06-29T05:36:48Z", "type": "commit"}, {"oid": "eb3efa85fec76531e99051ef1f61131227f4660d", "url": "https://github.com/apache/iotdb/commit/eb3efa85fec76531e99051ef1f61131227f4660d", "message": "Abstract insertPlan", "committedDate": "2020-06-29T05:36:48Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjgwMzg0NQ==", "url": "https://github.com/apache/iotdb/pull/1433#discussion_r446803845", "bodyText": "maybe you should use \"markFailedMeasurementInsertion\"", "author": "SilverNarcissus", "createdAt": "2020-06-29T06:41:51Z", "path": "server/src/main/java/org/apache/iotdb/db/qp/physical/crud/InsertPlan.java", "diffHunk": "@@ -369,97 +81,16 @@ public int getFailedMeasurementNumber() {\n     return failedMeasurements == null ? 0 : failedMeasurements.size();\n   }\n \n-  public TSDataType[] getTypes() {\n-    return types;\n-  }\n-\n-  public void setTypes(TSDataType[] types) {\n-    this.types = types;\n-  }\n-\n-  public void setValues(ByteBuffer buffer) throws QueryProcessException {\n-    for (int i = 0; i < measurements.length; i++) {\n-      types[i] = ReadWriteIOUtils.readDataType(buffer);\n-      switch (types[i]) {\n-        case BOOLEAN:\n-          values[i] = ReadWriteIOUtils.readBool(buffer);\n-          break;\n-        case INT32:\n-          values[i] = ReadWriteIOUtils.readInt(buffer);\n-          break;\n-        case INT64:\n-          values[i] = ReadWriteIOUtils.readLong(buffer);\n-          break;\n-        case FLOAT:\n-          values[i] = ReadWriteIOUtils.readFloat(buffer);\n-          break;\n-        case DOUBLE:\n-          values[i] = ReadWriteIOUtils.readDouble(buffer);\n-          break;\n-        case TEXT:\n-          values[i] = ReadWriteIOUtils.readBinary(buffer);\n-          break;\n-        default:\n-          throw new QueryProcessException(\"Unsupported data type:\" + types[i]);\n-      }\n-    }\n-  }\n-\n-  @Override\n-  public void serialize(ByteBuffer buffer) {\n-    int type = PhysicalPlanType.INSERT.ordinal();\n-    buffer.put((byte) type);\n-    buffer.putLong(time);\n-\n-    putString(buffer, deviceId);\n-\n-    buffer.putInt(measurements.length - (failedMeasurements == null ? 0 : failedMeasurements.size()));\n-\n-    for (String measurement : measurements) {\n-      if (measurement != null) {\n-        putString(buffer, measurement);\n-      }\n-    }\n-\n-    try {\n-      putValues(buffer);\n-    } catch (QueryProcessException e) {\n-      e.printStackTrace();\n-    }\n-  }\n-\n-  @Override\n-  public void deserialize(ByteBuffer buffer) {\n-    this.time = buffer.getLong();\n-    this.deviceId = readString(buffer);\n-\n-    int measurementSize = buffer.getInt();\n-\n-    this.measurements = new String[measurementSize];\n-    for (int i = 0; i < measurementSize; i++) {\n-      measurements[i] = readString(buffer);\n-    }\n-\n-    this.types = new TSDataType[measurementSize];\n-    this.values = new Object[measurementSize];\n-    try {\n-      setValues(buffer);\n-    } catch (QueryProcessException e) {\n-      e.printStackTrace();\n+  /**\n+   * @param index failed measurement index\n+   */\n+  public void markMeasurementInsertionFailed(int index) {", "originalCommit": "eb3efa85fec76531e99051ef1f61131227f4660d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzA4NjU2MQ==", "url": "https://github.com/apache/iotdb/pull/1433#discussion_r447086561", "bodyText": "OK~", "author": "LebronAl", "createdAt": "2020-06-29T16:08:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjgwMzg0NQ=="}], "type": "inlineReview"}, {"oid": "44c3ce3414df3962e8e0d00beb53af93c209e352", "url": "https://github.com/apache/iotdb/commit/44c3ce3414df3962e8e0d00beb53af93c209e352", "message": "rename markMeasurementInsertionFailed to markFailedMeasurementInsertion", "committedDate": "2020-06-29T16:08:39Z", "type": "commit"}]}