{"pr_number": 7313, "pr_title": "Iqss/7309 s3 resource leaks", "pr_createdAt": "2020-10-07T20:30:21Z", "pr_url": "https://github.com/IQSS/dataverse/pull/7313", "timeline": [{"oid": "00dc9b97b4a0d2df501b3300bc72f9899528c1f1", "url": "https://github.com/IQSS/dataverse/commit/00dc9b97b4a0d2df501b3300bc72f9899528c1f1", "message": "close any open streams/channels\n\nusing try-with-resources where it looks straight forward, or\nIOUtils.closeQuietly() where it isn't. (The latter is deprecated in\nfavor of using try-with-resources these days.)", "committedDate": "2020-10-07T20:09:07Z", "type": "commit"}, {"oid": "ec791bd79cd52076ae9f80942c62eba59a9f5918", "url": "https://github.com/IQSS/dataverse/commit/ec791bd79cd52076ae9f80942c62eba59a9f5918", "message": "formatting", "committedDate": "2020-10-07T20:14:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTI5NjI3MA==", "url": "https://github.com/IQSS/dataverse/pull/7313#discussion_r501296270", "bodyText": "guessing this method could/should close it but I didn't see where it was getting called.", "author": "qqmyers", "createdAt": "2020-10-07T20:40:36Z", "path": "src/main/java/edu/harvard/iq/dataverse/ingest/tabulardata/impl/plugins/dta/DTAFileReaderSpi.java", "diffHunk": "@@ -131,6 +131,7 @@ public boolean canDecodeInput(Object source) throws IOException {\n \n     @Override\n     public boolean canDecodeInput(BufferedInputStream stream) throws IOException {\n+    \t//who closes this stream?", "originalCommit": "ec791bd79cd52076ae9f80942c62eba59a9f5918", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTM4MTA3MQ==", "url": "https://github.com/IQSS/dataverse/pull/7313#discussion_r501381071", "bodyText": "We are not calling these methods at this time. They are part of a builtin infrastructure for automatically matching ingest plugins to specific file types... We are not using it now, but we may go back to it.\nIt would be the responsibility of the code that calls these methods to close the streams.", "author": "landreev", "createdAt": "2020-10-08T00:18:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTI5NjI3MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTMwNzM1OQ==", "url": "https://github.com/IQSS/dataverse/pull/7313#discussion_r501307359", "bodyText": "FWIW - this private method doesn't get used according to eclipse - do we need it?", "author": "qqmyers", "createdAt": "2020-10-07T21:01:03Z", "path": "src/main/java/edu/harvard/iq/dataverse/ingest/IngestServiceBean.java", "diffHunk": "@@ -1056,12 +1061,11 @@ private BufferedInputStream openFile(DataFile dataFile) throws IOException {\n         if (storageIO.isLocalFile()) {\n             inputStream = new BufferedInputStream(storageIO.getInputStream());\n         } else {\n-            ReadableByteChannel dataFileChannel = storageIO.getReadChannel();\n-            File tempFile = File.createTempFile(\"tempIngestSourceFile\", \".tmp\");\n-            FileChannel tempIngestSourceChannel = new FileOutputStream(tempFile).getChannel();\n-            \n-            tempIngestSourceChannel.transferFrom(dataFileChannel, 0, storageIO.getSize());\n-            \n+        \tFile tempFile = File.createTempFile(\"tempIngestSourceFile\", \".tmp\");", "originalCommit": "ec791bd79cd52076ae9f80942c62eba59a9f5918", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTM3OTYzOQ==", "url": "https://github.com/IQSS/dataverse/pull/7313#discussion_r501379639", "bodyText": "It really appears an unused leftover method.", "author": "landreev", "createdAt": "2020-10-08T00:13:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTMwNzM1OQ=="}], "type": "inlineReview"}]}