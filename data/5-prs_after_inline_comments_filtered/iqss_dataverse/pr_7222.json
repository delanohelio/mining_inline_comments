{"pr_number": 7222, "pr_title": "Security18 hibernate validator vulnerability", "pr_createdAt": "2020-08-24T21:11:43Z", "pr_url": "https://github.com/IQSS/dataverse/pull/7222", "timeline": [{"oid": "76c0b3c00e211e83f7c0e2d035fc1eb52066c4c3", "url": "https://github.com/IQSS/dataverse/commit/76c0b3c00e211e83f7c0e2d035fc1eb52066c4c3", "message": "The version pf hibernate-validator that we were using, 5.0.3.Final was reported to allow an attacker to escalate permissions and access private values and create invalid instances - see CVE-2017-7536. It is reported to be fixed in versions 5.2.5.Final and greater.\n\nThe upgraded library had changes to the api for constructing ConstaintValidatorContextImpl, used in URLValidatorTest.java. In investigating the changes, it was found that there were further changes to the api in recent versions and it was decided to adapt the code to the latest changes and use the latest available stable hibernate-validator library - 6.1.5.Final.\n\nIt was also necessary to add a dependency to javax.el due to changes in the library starting with version 5.3.1.Final and later.", "committedDate": "2020-08-20T16:48:16Z", "type": "commit"}, {"oid": "438a7d0b4a317abae32d0116beed5d377c8b1b6d", "url": "https://github.com/IQSS/dataverse/commit/438a7d0b4a317abae32d0116beed5d377c8b1b6d", "message": "code cleanup", "committedDate": "2020-08-20T17:49:41Z", "type": "commit"}, {"oid": "ab33496e6bc3b62c0de83e94a011dbd6a48142c1", "url": "https://github.com/IQSS/dataverse/commit/ab33496e6bc3b62c0de83e94a011dbd6a48142c1", "message": "sorry, one more line of commented code removed", "committedDate": "2020-08-20T17:53:40Z", "type": "commit"}, {"oid": "df442c5c4ccd84a02169adda11f0ebda52833833", "url": "https://github.com/IQSS/dataverse/commit/df442c5c4ccd84a02169adda11f0ebda52833833", "message": "Change ek dependency to jakarta.el provided by Payara", "committedDate": "2020-08-20T20:31:45Z", "type": "commit"}, {"oid": "a7fcdfa9a1891fb73c58467c5aaa6d09a369dd24", "url": "https://github.com/IQSS/dataverse/commit/a7fcdfa9a1891fb73c58467c5aaa6d09a369dd24", "message": "Use hibernate-validator provided with Payara (still a 6.1.x -6.1.2 specifically at this point)", "committedDate": "2020-08-20T21:50:13Z", "type": "commit"}, {"oid": "1dd243115af5e04eba4d3a4751fa42d20bcc7064", "url": "https://github.com/IQSS/dataverse/commit/1dd243115af5e04eba4d3a4751fa42d20bcc7064", "message": "changed hibernat-validator scope from provided to compile, because we were getting NoClassDefFoundError: org/hibernate/validator/internal/util/CollectionHelper at runtime while creating an account", "committedDate": "2020-08-25T21:52:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzEwMDU5Nw==", "url": "https://github.com/IQSS/dataverse/pull/7222#discussion_r477100597", "bodyText": "The complete test class should be refactored to use a JUnit5 @ParameterizedTest, usable for both unit tests.\nThe context object should be mocked. Creating a real object is of no use here and at least on my machine creates errors. Happy to create a PR against this PR.", "author": "poikilotherm", "createdAt": "2020-08-26T07:46:01Z", "path": "src/test/java/edu/harvard/iq/dataverse/URLValidatorTest.java", "diffHunk": "@@ -35,15 +39,15 @@ public void testIsValidWithUnspecifiedContext() {\n     @Test\n     public void testIsValidWithContextAndValidURL() {\n         String value = \"https://twitter.com/\";\n-        ConstraintValidatorContext context = new ConstraintValidatorContextImpl(null, PathImpl.createPathFromString(\"\"), null);\n+        ConstraintValidatorContext context = new ConstraintValidatorContextImpl(validatorFactory.getClockProvider(), PathImpl.createPathFromString(\"\"),null, null);\n \n         assertEquals(true, new URLValidator().isValid(value, context));\n     }\n \n     @Test\n     public void testIsValidWithContextButInvalidURL() {\n         String value = \"cnn.com\";\n-        ConstraintValidatorContext context = new ConstraintValidatorContextImpl(null, PathImpl.createPathFromString(\"\"), null);\n+        ConstraintValidatorContext context = new ConstraintValidatorContextImpl(validatorFactory.getClockProvider(), PathImpl.createPathFromString(\"\"),null, null);", "originalCommit": "1dd243115af5e04eba4d3a4751fa42d20bcc7064", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "7f3051a93715a1780ea9c7a2e0a6ffcf3381ae6b", "url": "https://github.com/IQSS/dataverse/commit/7f3051a93715a1780ea9c7a2e0a6ffcf3381ae6b", "message": "Remove compile scope as unneccessary because it is the default scope", "committedDate": "2020-08-26T13:44:35Z", "type": "commit"}, {"oid": "5e3b6acb5b13ce7a11d863125eb6228f0f2c99e6", "url": "https://github.com/IQSS/dataverse/commit/5e3b6acb5b13ce7a11d863125eb6228f0f2c99e6", "message": "Last commit included experimental removal of jakarta.el, which does not work", "committedDate": "2020-08-26T14:01:04Z", "type": "commit"}]}