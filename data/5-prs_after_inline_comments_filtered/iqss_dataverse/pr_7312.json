{"pr_number": 7312, "pr_title": "Checksum truncation, click to copy + file metadata fragment code consolidation", "pr_createdAt": "2020-10-07T19:45:23Z", "pr_url": "https://github.com/IQSS/dataverse/pull/7312", "timeline": [{"oid": "2903b0888a8d8591f68dec2afca089bee17bdcfe", "url": "https://github.com/IQSS/dataverse/commit/2903b0888a8d8591f68dec2afca089bee17bdcfe", "message": "Consolidated file metadata on dataset pg by using file-info-fragment from file replace pg [ref #7081]", "committedDate": "2020-10-07T19:34:05Z", "type": "commit"}, {"oid": "f094b97dce164f28701492db089de3164c85ef14", "url": "https://github.com/IQSS/dataverse/commit/f094b97dce164f28701492db089de3164c85ef14", "message": "Fixed download count error on file-info-fragment, as well as cleaned up thumbnail code [ref #7081]", "committedDate": "2020-10-08T15:19:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTg0NzIwNg==", "url": "https://github.com/IQSS/dataverse/pull/7312#discussion_r501847206", "bodyText": "Here is the canDownloadFile logic that was removed, as I do no believe is necessary on EditDatafilesPage. If you can edit, you can download.", "author": "mheppler", "createdAt": "2020-10-08T16:18:22Z", "path": "src/main/java/edu/harvard/iq/dataverse/EditDatafilesPage.java", "diffHunk": "@@ -2562,20 +2562,6 @@ public boolean isLocked() {\n         return false;\n     }\n     \n-    public boolean isThumbnailAvailable(FileMetadata fileMetadata) {\n-        // new and optimized logic: \n-        // - check download permission here (should be cached - so it's free!)\n-        // - only then ask the file service if the thumbnail is available/exists.\n-        // the service itself no longer checks download permissions.  \n-        if (!fileDownloadHelper.canDownloadFile(fileMetadata)) {\n-            return false;\n-        }\n-\n-        return datafileService.isThumbnailAvailable(fileMetadata.getDataFile());\n-    }", "originalCommit": "f094b97dce164f28701492db089de3164c85ef14", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDAxMzM0Mg==", "url": "https://github.com/IQSS/dataverse/pull/7312#discussion_r564013342", "bodyText": "While this is true with the current built in roles, it is not inherently true of the permission system. Is it possible that some day, someone would want a a role that can edit but not download (for example editing the metadata?) It may be worth keeping this; alternatively we can keep removed knowing that we'd have to revisit it someday.", "author": "scolapasta", "createdAt": "2021-01-25T20:13:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTg0NzIwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDg3Mzk5Nw==", "url": "https://github.com/IQSS/dataverse/pull/7312#discussion_r564873997", "bodyText": "note: added the permission check back (directly in the rendered of the fragment).", "author": "scolapasta", "createdAt": "2021-01-26T22:21:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTg0NzIwNg=="}], "type": "inlineReview"}, {"oid": "56dc4c75ba9acf9c66906169bb9baa2dc74a7691", "url": "https://github.com/IQSS/dataverse/commit/56dc4c75ba9acf9c66906169bb9baa2dc74a7691", "message": "Removed additional editMode render logic not needed in file table on dataset pg [ref #7081]", "committedDate": "2020-10-08T19:52:24Z", "type": "commit"}, {"oid": "44722f51a12878d8e1bf01d452eed082f0b6a6e6", "url": "https://github.com/IQSS/dataverse/commit/44722f51a12878d8e1bf01d452eed082f0b6a6e6", "message": "Removed commented out isDuplicate render logic from checksum in dataset pg file table [ref #7081]", "committedDate": "2020-10-09T16:27:56Z", "type": "commit"}, {"oid": "9eb7f9aef2dd38556d025431b840ae42783300e2", "url": "https://github.com/IQSS/dataverse/commit/9eb7f9aef2dd38556d025431b840ae42783300e2", "message": "Additional render logic clean up on file-info-fragment [ref #7081]", "committedDate": "2020-10-09T16:50:37Z", "type": "commit"}, {"oid": "81384baec44f1a100ff84434a511bc7df93d975e", "url": "https://github.com/IQSS/dataverse/commit/81384baec44f1a100ff84434a511bc7df93d975e", "message": "Added checksum truncation function WIP [ref #7081 #6685 #5210]", "committedDate": "2020-10-15T16:56:42Z", "type": "commit"}, {"oid": "aefcfad57abd0d4a35256c098a44359bb54cb103", "url": "https://github.com/IQSS/dataverse/commit/aefcfad57abd0d4a35256c098a44359bb54cb103", "message": "Merge branch '7081-kebab-file-options-icon-btn' into 7081-file-metadata-include", "committedDate": "2020-10-18T19:25:18Z", "type": "commit"}, {"oid": "da6e3640566489366ad29ad7f7ff8ba076ef0c92", "url": "https://github.com/IQSS/dataverse/commit/da6e3640566489366ad29ad7f7ff8ba076ef0c92", "message": "Merge branch 'develop' into 7081-file-metadata-include", "committedDate": "2020-12-17T16:05:37Z", "type": "commit"}, {"oid": "3b90d1c87d923c3325e9343c9f9abb7d3dc24f56", "url": "https://github.com/IQSS/dataverse/commit/3b90d1c87d923c3325e9343c9f9abb7d3dc24f56", "message": "Commented out code in file table include to clean up UI [ref #6685 #5210]", "committedDate": "2020-12-17T16:41:25Z", "type": "commit"}, {"oid": "35982b764575553c5a3fdc5f8f0f18f2274dbd8e", "url": "https://github.com/IQSS/dataverse/commit/35982b764575553c5a3fdc5f8f0f18f2274dbd8e", "message": "Checksum truncate and click to copy added to file table on dataset pg [ref #5210]", "committedDate": "2021-01-05T20:23:27Z", "type": "commit"}, {"oid": "b9052ceba00a43598df3b4a5c827a245f9c87d17", "url": "https://github.com/IQSS/dataverse/commit/b9052ceba00a43598df3b4a5c827a245f9c87d17", "message": "Merge branch 'develop' into 7081-file-metadata-include", "committedDate": "2021-01-05T20:23:59Z", "type": "commit"}, {"oid": "3ea71dd0c3fbfd008831d82e84142ad498ab5ca9", "url": "https://github.com/IQSS/dataverse/commit/3ea71dd0c3fbfd008831d82e84142ad498ab5ca9", "message": "Checksum/unf truncation, click to copy, for dataset pg and dataverse pg, plus file metadata code clean up [ref #5210]", "committedDate": "2021-01-08T18:25:08Z", "type": "commit"}, {"oid": "d0397848abc540bc92345a38449c8cf74710d0de", "url": "https://github.com/IQSS/dataverse/commit/d0397848abc540bc92345a38449c8cf74710d0de", "message": "Applied truncation to UNF, moved tabular metadata labels to bundle [ref #5210 #6685]", "committedDate": "2021-01-11T15:12:15Z", "type": "commit"}, {"oid": "d0397848abc540bc92345a38449c8cf74710d0de", "url": "https://github.com/IQSS/dataverse/commit/d0397848abc540bc92345a38449c8cf74710d0de", "message": "Applied truncation to UNF, moved tabular metadata labels to bundle [ref #5210 #6685]", "committedDate": "2021-01-11T15:12:15Z", "type": "forcePushed"}, {"oid": "d16b6ee4bdb8b5fb282200391bcf78963d8f7247", "url": "https://github.com/IQSS/dataverse/commit/d16b6ee4bdb8b5fb282200391bcf78963d8f7247", "message": "This is the reason search cards were not fully initialized for tabular files. (#7312)", "committedDate": "2021-01-11T17:15:36Z", "type": "commit"}, {"oid": "1b27ec324fa45968e329b6ae39411b7d9f58b064", "url": "https://github.com/IQSS/dataverse/commit/1b27ec324fa45968e329b6ae39411b7d9f58b064", "message": "Separate unf display from variables + observations on dataverse pg result cards [ref #5210 #6685]", "committedDate": "2021-01-11T20:08:28Z", "type": "commit"}, {"oid": "16a3efad80f995f95a199bf9eb59740a69146f85", "url": "https://github.com/IQSS/dataverse/commit/16a3efad80f995f95a199bf9eb59740a69146f85", "message": "Overwrite css from primefaces component.css for overflow property to be visible for datatables [ref #5210 #6685]", "committedDate": "2021-01-11T20:20:24Z", "type": "commit"}, {"oid": "aae992507223dcec08dbe58f99090195e9bc6a18", "url": "https://github.com/IQSS/dataverse/commit/aae992507223dcec08dbe58f99090195e9bc6a18", "message": "Fixed float UI issue in file table on dataset pg [ref #5210, #6685]", "committedDate": "2021-01-11T21:33:48Z", "type": "commit"}, {"oid": "d85806e6f31adc7360abed068cd85b9e83135777", "url": "https://github.com/IQSS/dataverse/commit/d85806e6f31adc7360abed068cd85b9e83135777", "message": "Merge branch 'develop' into 7081-file-metadata-include", "committedDate": "2021-01-11T21:48:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTkzNjQ4NQ==", "url": "https://github.com/IQSS/dataverse/pull/7312#discussion_r555936485", "bodyText": "If I understand correctly (e.g. from the code links below), MIME_TYPE_TSV_ALT should be the only mimetype that will have variable metadata. So -  can you also drop the first MIME_TYPE_TSV in this if statement?\nIngested tabular file mimetype set to MIME_TYPE_TSV_ALT:\n\n  \n    \n      dataverse/src/main/java/edu/harvard/iq/dataverse/ingest/IngestServiceBean.java\n    \n    \n         Line 922\n      in\n      0bcdcfd\n    \n    \n    \n    \n\n        \n          \n           dataFile.setContentType(FileUtil.MIME_TYPE_INGESTED_FILE); \n        \n    \n  \n\n\nIncoming files of type MIME_TYPE_TSV_ALT changed to MIME_TYPE_TSV\n\n  \n    \n      dataverse/src/main/java/edu/harvard/iq/dataverse/ingest/IngestServiceBean.java\n    \n    \n        Lines 355 to 358\n      in\n      0bcdcfd\n    \n    \n    \n    \n\n        \n          \n           } else if (FileUtil.MIME_TYPE_INGESTED_FILE.equals(dataFile.getContentType())) { \n        \n\n        \n          \n                              // Make sure no *uningested* tab-delimited files are saved with the type \"text/tab-separated-values\"! \n        \n\n        \n          \n                              // \"text/tsv\" should be used instead:  \n        \n\n        \n          \n                              dataFile.setContentType(FileUtil.MIME_TYPE_TSV);", "author": "qqmyers", "createdAt": "2021-01-12T17:11:10Z", "path": "src/main/java/edu/harvard/iq/dataverse/DataFileServiceBean.java", "diffHunk": "@@ -497,7 +497,7 @@ public DataFile findCheapAndEasy(Long id) {\n         // If content type indicates it's tabular data, spend 2 extra queries \n         // looking up the data table and tabular tags objects:\n         \n-        if (MIME_TYPE_TSV.equalsIgnoreCase(contentType)) {\n+        if (MIME_TYPE_TSV.equalsIgnoreCase(contentType) || MIME_TYPE_TSV_ALT.equalsIgnoreCase(contentType)) {", "originalCommit": "d85806e6f31adc7360abed068cd85b9e83135777", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NjExNjc1NQ==", "url": "https://github.com/IQSS/dataverse/pull/7312#discussion_r556116755", "bodyText": "I thought about it, but I believe it is entirely possible for some legacy installations to still have some ingested tabular files with the other mime types. So I figured I would leave it in place to be safe. The worst possible drawback here is 1 wasted custom query, if this not an ingested tab. file.\n(We make sure NOT to rely on the mime type, for identifying tabular data files elsewhere, and instead check for the presence of the DataTable object; but this is one situation where we have to - because we only have the search result, but not the entity).", "author": "landreev", "createdAt": "2021-01-12T21:47:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTkzNjQ4NQ=="}], "type": "inlineReview"}, {"oid": "6b4fb249a3a4a5bf84ab9fb5c67eec3b7e8f4415", "url": "https://github.com/IQSS/dataverse/commit/6b4fb249a3a4a5bf84ab9fb5c67eec3b7e8f4415", "message": "Undo on bug testing revision mistakenly left in java function [ref #5210, #6685]", "committedDate": "2021-01-12T21:33:32Z", "type": "commit"}, {"oid": "2ee739aa59d7ac22db815c8f8005043370a4f4ec", "url": "https://github.com/IQSS/dataverse/commit/2ee739aa59d7ac22db815c8f8005043370a4f4ec", "message": "File table responsive clean up, added file date labels [ref #5210, #6685]", "committedDate": "2021-01-19T16:32:16Z", "type": "commit"}, {"oid": "23e8f5cc2b05d069af92fc32c92b7884087a3ff8", "url": "https://github.com/IQSS/dataverse/commit/23e8f5cc2b05d069af92fc32c92b7884087a3ff8", "message": "Merge branch 'develop' into 7081-file-metadata-include", "committedDate": "2021-01-19T16:58:35Z", "type": "commit"}, {"oid": "c7f7782d73811d7dffcb569f80476063d1c2f964", "url": "https://github.com/IQSS/dataverse/commit/c7f7782d73811d7dffcb569f80476063d1c2f964", "message": "Updated metadata labels in dataset version differences popup, added to bundle [ref #5210, #6685]", "committedDate": "2021-01-20T21:58:55Z", "type": "commit"}, {"oid": "0706720c310adc0c22f26afd8cc9b17a68c54cc7", "url": "https://github.com/IQSS/dataverse/commit/0706720c310adc0c22f26afd8cc9b17a68c54cc7", "message": "Mistakenly committed dev workaround, removed emuns [ref #5210, #6685]", "committedDate": "2021-01-21T17:42:41Z", "type": "commit"}, {"oid": "3587fe9c345f5a75f1a81c18b9afc22aa315ef7a", "url": "https://github.com/IQSS/dataverse/commit/3587fe9c345f5a75f1a81c18b9afc22aa315ef7a", "message": "Hide file metadata download count in file tables if dataset unpublished [ref #5210, #7513]", "committedDate": "2021-01-21T19:22:21Z", "type": "commit"}, {"oid": "dfa367e8ceb087f257312823ef523a146f603d23", "url": "https://github.com/IQSS/dataverse/commit/dfa367e8ceb087f257312823ef523a146f603d23", "message": "Removed parantesis from Tags label [ref #5210]", "committedDate": "2021-01-21T19:29:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjE4ODY1MA==", "url": "https://github.com/IQSS/dataverse/pull/7312#discussion_r562188650", "bodyText": "these values are only used for the equality check, seems silly to not just check isRestricted directly.", "author": "scolapasta", "createdAt": "2021-01-21T20:50:43Z", "path": "src/main/java/edu/harvard/iq/dataverse/DatasetVersionDifference.java", "diffHunk": "@@ -1080,10 +1055,9 @@ private boolean fileMetadataIsDifferent(FileMetadata fm1, FileMetadata fm2) {\n             return true;\n         }\n         \n-        //File restrictions\n-        \n-        value1 = fm1.isRestricted() ? \"Restricted\" : \"Not Restricted\";\n-        value2 = fm2.isRestricted() ? \"Restricted\" : \"Not Restricted\";\n+        // File restrictions\n+        value1 = fm1.isRestricted() ? BundleUtil.getStringFromBundle(\"restricted\") : BundleUtil.getStringFromBundle(\"public\");\n+        value2 = fm2.isRestricted() ? BundleUtil.getStringFromBundle(\"restricted\") : BundleUtil.getStringFromBundle(\"public\");", "originalCommit": "dfa367e8ceb087f257312823ef523a146f603d23", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDA1Mzk2Nw==", "url": "https://github.com/IQSS/dataverse/pull/7312#discussion_r564053967", "bodyText": "Happy to copy and paste any further code refactoring suggestions if you could be so kind as to provide them.", "author": "mheppler", "createdAt": "2021-01-25T21:25:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjE4ODY1MA=="}], "type": "inlineReview"}, {"oid": "0a14b8625f46ed5a82c046905302acfbad5cd56d", "url": "https://github.com/IQSS/dataverse/commit/0a14b8625f46ed5a82c046905302acfbad5cd56d", "message": "Merge branch 'develop' into 7081-file-metadata-include", "committedDate": "2021-01-25T21:40:41Z", "type": "commit"}, {"oid": "f46a87f52b573f9ecc77778c8e6b62801e3bad58", "url": "https://github.com/IQSS/dataverse/commit/f46a87f52b573f9ecc77778c8e6b62801e3bad58", "message": "Removed unnecessary editMode render logic, refactored other logic [ref #7081]", "committedDate": "2021-01-26T01:41:30Z", "type": "commit"}, {"oid": "191bdfc45371fc146b2e92ee33d63684896dea2f", "url": "https://github.com/IQSS/dataverse/commit/191bdfc45371fc146b2e92ee33d63684896dea2f", "message": "Code clean up and comments to doc renders and params for file-info [ref #7081, #6685, #5210]", "committedDate": "2021-01-26T21:22:37Z", "type": "commit"}, {"oid": "59610338421de5774b9a65b0ef8b9aa172f2262e", "url": "https://github.com/IQSS/dataverse/commit/59610338421de5774b9a65b0ef8b9aa172f2262e", "message": "Undoing mistakenly committed bug workaround hack for notifications git add src/main/java/edu/harvard/iq/dataverse/UserNotification.javagit add src/main/java/edu/harvard/iq/dataverse/UserNotification.java", "committedDate": "2021-01-26T21:26:17Z", "type": "commit"}, {"oid": "c0dc967cffe64ac468fef229611a1dbaa12e78b7", "url": "https://github.com/IQSS/dataverse/commit/c0dc967cffe64ac468fef229611a1dbaa12e78b7", "message": "Update file-info-fragment.xhtml", "committedDate": "2021-01-26T21:48:36Z", "type": "commit"}, {"oid": "0ebc23f42102230af140044387dee517f7c442de", "url": "https://github.com/IQSS/dataverse/commit/0ebc23f42102230af140044387dee517f7c442de", "message": "Update dataset.xhtml", "committedDate": "2021-01-26T21:58:07Z", "type": "commit"}, {"oid": "714b288363a2a68d816d2532fc5e58bc96d885a9", "url": "https://github.com/IQSS/dataverse/commit/714b288363a2a68d816d2532fc5e58bc96d885a9", "message": "Update filesFragment.xhtml", "committedDate": "2021-01-26T21:58:46Z", "type": "commit"}, {"oid": "7f97d018b1383420d2b45516aaa254eaef1b63d8", "url": "https://github.com/IQSS/dataverse/commit/7f97d018b1383420d2b45516aaa254eaef1b63d8", "message": "Update dataset.xhtml", "committedDate": "2021-01-26T22:04:47Z", "type": "commit"}, {"oid": "63eb5bdad0aec8df97aefd0f84330f46682d73fa", "url": "https://github.com/IQSS/dataverse/commit/63eb5bdad0aec8df97aefd0f84330f46682d73fa", "message": "Update DatasetPage.java", "committedDate": "2021-01-26T22:09:30Z", "type": "commit"}, {"oid": "0d08717b8d28656040db4789775435f804e9de33", "url": "https://github.com/IQSS/dataverse/commit/0d08717b8d28656040db4789775435f804e9de33", "message": "Merge branch 'develop' into 7081-file-metadata-include", "committedDate": "2021-01-27T21:20:23Z", "type": "commit"}, {"oid": "814c005645a09163a897276a6934f16e3b956429", "url": "https://github.com/IQSS/dataverse/commit/814c005645a09163a897276a6934f16e3b956429", "message": "Cleaned up copy to clipboard code for checksums and tokens [ref #6039, #7081, #6685, #5210]", "committedDate": "2021-01-27T22:00:10Z", "type": "commit"}, {"oid": "89023bae820cf46b2481da191e6ddaf626fabbd1", "url": "https://github.com/IQSS/dataverse/commit/89023bae820cf46b2481da191e6ddaf626fabbd1", "message": "Fix checksum flashing and rebinding issues on download, search [ref #7081]", "committedDate": "2021-01-29T16:53:17Z", "type": "commit"}, {"oid": "85755bad3aba0e577d539c447aa650a63e26252f", "url": "https://github.com/IQSS/dataverse/commit/85755bad3aba0e577d539c447aa650a63e26252f", "message": "Fix checksum flashing and rebinding issues on download [ref #7081]", "committedDate": "2021-01-29T17:05:32Z", "type": "commit"}, {"oid": "a6d46bb47d7da64da9cdffe8f82e0166d610cc7c", "url": "https://github.com/IQSS/dataverse/commit/a6d46bb47d7da64da9cdffe8f82e0166d610cc7c", "message": "Added copy to clipboard success ok icon for checksums [ref #7081]", "committedDate": "2021-02-02T15:15:34Z", "type": "commit"}, {"oid": "e17300f516654e176eaa81747391341fdb9994aa", "url": "https://github.com/IQSS/dataverse/commit/e17300f516654e176eaa81747391341fdb9994aa", "message": "Merge branch 'develop' into 7081-file-metadata-include", "committedDate": "2021-02-02T16:40:35Z", "type": "commit"}, {"oid": "e9e99b4121012ecc4ff937b7c3ac5500e8ff5632", "url": "https://github.com/IQSS/dataverse/commit/e9e99b4121012ecc4ff937b7c3ac5500e8ff5632", "message": "Fixed double click issue on click to copy [ref #7081, #6685, #5210]", "committedDate": "2021-02-03T00:57:09Z", "type": "commit"}]}