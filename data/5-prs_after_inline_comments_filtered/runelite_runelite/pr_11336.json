{"pr_number": 11336, "pr_title": "Add option to copy chat message contents to clipboard", "pr_createdAt": "2020-04-21T20:32:57Z", "pr_url": "https://github.com/runelite/runelite/pull/11336", "timeline": [{"oid": "5f5765ebffbfc4273d3deb31b7ba50e8b1145c6e", "url": "https://github.com/runelite/runelite/commit/5f5765ebffbfc4273d3deb31b7ba50e8b1145c6e", "message": "Add option to copy chat message contents to clipboard\n\nSigned-off-by: Tomas Slusny <slusnucky@gmail.com>", "committedDate": "2020-04-21T22:09:30Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTIzNTQ3Mg==", "url": "https://github.com/runelite/runelite/pull/11336#discussion_r415235472", "bodyText": "This feels way too much like it should be an API function than an, admittedly documented, magic number-ridden line of code in some plugin.", "author": "Nightfirecat", "createdAt": "2020-04-26T06:56:29Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/chathistory/ChatHistoryPlugin.java", "diffHunk": "@@ -167,6 +182,43 @@ public void onChatMessage(ChatMessage chatMessage)\n \t\t}\n \t}\n \n+\t@Subscribe\n+\tpublic void onMenuOpened(MenuOpened event)\n+\t{\n+\t\tif (event.getFirstEntry() == null || !config.copyToClipboard())\n+\t\t{\n+\t\t\treturn;\n+\t\t}\n+\n+\t\tfinal int groupId = TO_GROUP(event.getFirstEntry().getParam1());\n+\t\tfinal int childId = TO_CHILD(event.getFirstEntry().getParam1());\n+\n+\t\tif (groupId != WidgetInfo.CHATBOX.getGroupId())\n+\t\t{\n+\t\t\treturn;\n+\t\t}\n+\n+\t\tfinal Widget widget = client.getWidget(groupId, childId);\n+\t\tfinal Widget parent = widget.getParent();\n+\t\tfinal Widget[] dynamicChildren = parent.getDynamicChildren();\n+\n+\t\t// Convert current message static widget id to dynamic widget id of message node with message contents\n+\t\tfinal int dynamicChildId = (childId - 59) * 2 + 1;", "originalCommit": "5f5765ebffbfc4273d3deb31b7ba50e8b1145c6e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTM2MTAwOA==", "url": "https://github.com/runelite/runelite/pull/11336#discussion_r415361008", "bodyText": "I don't think this should be API method as I don't think it will be useful outside of this plugin. It works just for getting chat message contents based on info from menu entry when menu is openened and nothing else.", "author": "deathbeam", "createdAt": "2020-04-26T17:39:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTIzNTQ3Mg=="}], "type": "inlineReview"}, {"oid": "a87cc19c1f685bc269e4636b3792386c0bb32d14", "url": "https://github.com/runelite/runelite/commit/a87cc19c1f685bc269e4636b3792386c0bb32d14", "message": "Add option to copy chat message contents to clipboard\n\nSigned-off-by: Tomas Slusny <slusnucky@gmail.com>", "committedDate": "2020-04-26T17:52:07Z", "type": "forcePushed"}, {"oid": "38faa2d5d6eca07cdb1db917583fcf74dd20277d", "url": "https://github.com/runelite/runelite/commit/38faa2d5d6eca07cdb1db917583fcf74dd20277d", "message": "Add option to copy chat message contents to clipboard\n\nSigned-off-by: Tomas Slusny <slusnucky@gmail.com>", "committedDate": "2020-04-26T18:09:45Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzkzODY1NQ==", "url": "https://github.com/runelite/runelite/pull/11336#discussion_r417938655", "bodyText": "this should check the entry type first", "author": "abextm", "createdAt": "2020-04-30T11:22:31Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/chathistory/ChatHistoryPlugin.java", "diffHunk": "@@ -167,6 +182,50 @@ public void onChatMessage(ChatMessage chatMessage)\n \t\t}\n \t}\n \n+\t@Subscribe\n+\tpublic void onMenuOpened(MenuOpened event)\n+\t{\n+\t\tif (event.getMenuEntries().length < 2 || !config.copyToClipboard())\n+\t\t{\n+\t\t\treturn;\n+\t\t}\n+\n+\t\t// Use second entry as first one can be walk here with transparent chatbox\n+\t\tfinal MenuEntry entry = event.getMenuEntries()[event.getMenuEntries().length - 2];\n+\n+\t\tfinal int groupId = TO_GROUP(entry.getParam1());", "originalCommit": "38faa2d5d6eca07cdb1db917583fcf74dd20277d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzk0NTE0Mg==", "url": "https://github.com/runelite/runelite/pull/11336#discussion_r417945142", "bodyText": "This should be a constant 169.59 in widgetinfo", "author": "abextm", "createdAt": "2020-04-30T11:35:52Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/chathistory/ChatHistoryPlugin.java", "diffHunk": "@@ -167,6 +182,50 @@ public void onChatMessage(ChatMessage chatMessage)\n \t\t}\n \t}\n \n+\t@Subscribe\n+\tpublic void onMenuOpened(MenuOpened event)\n+\t{\n+\t\tif (event.getMenuEntries().length < 2 || !config.copyToClipboard())\n+\t\t{\n+\t\t\treturn;\n+\t\t}\n+\n+\t\t// Use second entry as first one can be walk here with transparent chatbox\n+\t\tfinal MenuEntry entry = event.getMenuEntries()[event.getMenuEntries().length - 2];\n+\n+\t\tfinal int groupId = TO_GROUP(entry.getParam1());\n+\t\tfinal int childId = TO_CHILD(entry.getParam1());\n+\n+\t\tif (groupId != WidgetInfo.CHATBOX.getGroupId())\n+\t\t{\n+\t\t\treturn;\n+\t\t}\n+\n+\t\tfinal Widget widget = client.getWidget(groupId, childId);\n+\t\tfinal Widget parent = widget.getParent();\n+\t\tfinal Widget[] dynamicChildren = parent.getDynamicChildren();\n+\n+\t\t// Get child id of first chat message static child so we can substract this offset to link to dynamic child\n+\t\t// later\n+\t\tfinal int first = TO_CHILD(parent.getStaticChildren()[0].getId());", "originalCommit": "38faa2d5d6eca07cdb1db917583fcf74dd20277d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzk0NjgwMA==", "url": "https://github.com/runelite/runelite/pull/11336#discussion_r417946800", "bodyText": "this should have a check against a widget info too", "author": "abextm", "createdAt": "2020-04-30T11:39:00Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/chathistory/ChatHistoryPlugin.java", "diffHunk": "@@ -167,6 +182,50 @@ public void onChatMessage(ChatMessage chatMessage)\n \t\t}\n \t}\n \n+\t@Subscribe\n+\tpublic void onMenuOpened(MenuOpened event)\n+\t{\n+\t\tif (event.getMenuEntries().length < 2 || !config.copyToClipboard())\n+\t\t{\n+\t\t\treturn;\n+\t\t}\n+\n+\t\t// Use second entry as first one can be walk here with transparent chatbox\n+\t\tfinal MenuEntry entry = event.getMenuEntries()[event.getMenuEntries().length - 2];\n+\n+\t\tfinal int groupId = TO_GROUP(entry.getParam1());\n+\t\tfinal int childId = TO_CHILD(entry.getParam1());\n+\n+\t\tif (groupId != WidgetInfo.CHATBOX.getGroupId())\n+\t\t{\n+\t\t\treturn;\n+\t\t}\n+\n+\t\tfinal Widget widget = client.getWidget(groupId, childId);\n+\t\tfinal Widget parent = widget.getParent();", "originalCommit": "38faa2d5d6eca07cdb1db917583fcf74dd20277d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzk0NjkwNQ==", "url": "https://github.com/runelite/runelite/pull/11336#discussion_r417946905", "bodyText": "prefer getChildren or getChild", "author": "abextm", "createdAt": "2020-04-30T11:39:12Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/chathistory/ChatHistoryPlugin.java", "diffHunk": "@@ -167,6 +182,50 @@ public void onChatMessage(ChatMessage chatMessage)\n \t\t}\n \t}\n \n+\t@Subscribe\n+\tpublic void onMenuOpened(MenuOpened event)\n+\t{\n+\t\tif (event.getMenuEntries().length < 2 || !config.copyToClipboard())\n+\t\t{\n+\t\t\treturn;\n+\t\t}\n+\n+\t\t// Use second entry as first one can be walk here with transparent chatbox\n+\t\tfinal MenuEntry entry = event.getMenuEntries()[event.getMenuEntries().length - 2];\n+\n+\t\tfinal int groupId = TO_GROUP(entry.getParam1());\n+\t\tfinal int childId = TO_CHILD(entry.getParam1());\n+\n+\t\tif (groupId != WidgetInfo.CHATBOX.getGroupId())\n+\t\t{\n+\t\t\treturn;\n+\t\t}\n+\n+\t\tfinal Widget widget = client.getWidget(groupId, childId);\n+\t\tfinal Widget parent = widget.getParent();\n+\t\tfinal Widget[] dynamicChildren = parent.getDynamicChildren();", "originalCommit": "38faa2d5d6eca07cdb1db917583fcf74dd20277d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzk0ODAxNQ==", "url": "https://github.com/runelite/runelite/pull/11336#discussion_r417948015", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\telse if (menuOption.contains(COPY_TO_CLIPBOARD) && !Strings.isNullOrEmpty(currentMessage))\n          \n          \n            \n            \t\telse if (COPY_TO_CLIPBOARD.equals(menuOption) && !Strings.isNullOrEmpty(currentMessage))", "author": "abextm", "createdAt": "2020-04-30T11:41:26Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/chathistory/ChatHistoryPlugin.java", "diffHunk": "@@ -185,6 +244,11 @@ public void onMenuOptionClicked(MenuOptionClicked event)\n \t\t\t\tmessageQueue.removeIf(e -> e.getType() == ChatMessageType.PUBLICCHAT || e.getType() == ChatMessageType.MODCHAT);\n \t\t\t}\n \t\t}\n+\t\telse if (menuOption.contains(COPY_TO_CLIPBOARD) && !Strings.isNullOrEmpty(currentMessage))", "originalCommit": "38faa2d5d6eca07cdb1db917583fcf74dd20277d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzk0OTMyMQ==", "url": "https://github.com/runelite/runelite/pull/11336#discussion_r417949321", "bodyText": "also an explanation of what the widget tree looks like for this to work would be nice", "author": "abextm", "createdAt": "2020-04-30T11:44:07Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/chathistory/ChatHistoryPlugin.java", "diffHunk": "@@ -167,6 +182,50 @@ public void onChatMessage(ChatMessage chatMessage)\n \t\t}\n \t}\n \n+\t@Subscribe\n+\tpublic void onMenuOpened(MenuOpened event)\n+\t{\n+\t\tif (event.getMenuEntries().length < 2 || !config.copyToClipboard())\n+\t\t{\n+\t\t\treturn;\n+\t\t}\n+\n+\t\t// Use second entry as first one can be walk here with transparent chatbox\n+\t\tfinal MenuEntry entry = event.getMenuEntries()[event.getMenuEntries().length - 2];\n+\n+\t\tfinal int groupId = TO_GROUP(entry.getParam1());\n+\t\tfinal int childId = TO_CHILD(entry.getParam1());\n+\n+\t\tif (groupId != WidgetInfo.CHATBOX.getGroupId())\n+\t\t{\n+\t\t\treturn;\n+\t\t}\n+\n+\t\tfinal Widget widget = client.getWidget(groupId, childId);\n+\t\tfinal Widget parent = widget.getParent();\n+\t\tfinal Widget[] dynamicChildren = parent.getDynamicChildren();\n+\n+\t\t// Get child id of first chat message static child so we can substract this offset to link to dynamic child\n+\t\t// later\n+\t\tfinal int first = TO_CHILD(parent.getStaticChildren()[0].getId());\n+\n+\t\t// Convert current message static widget id to dynamic widget id of message node with message contents\n+\t\tfinal int dynamicChildId = (childId - first) * 2 + 1;", "originalCommit": "38faa2d5d6eca07cdb1db917583fcf74dd20277d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "84885f754688368b5b41988760564be526a3e10f", "url": "https://github.com/runelite/runelite/commit/84885f754688368b5b41988760564be526a3e10f", "message": "Add option to copy chat message contents to clipboard\n\nSigned-off-by: Tomas Slusny <slusnucky@gmail.com>", "committedDate": "2020-04-30T22:09:57Z", "type": "commit"}, {"oid": "84885f754688368b5b41988760564be526a3e10f", "url": "https://github.com/runelite/runelite/commit/84885f754688368b5b41988760564be526a3e10f", "message": "Add option to copy chat message contents to clipboard\n\nSigned-off-by: Tomas Slusny <slusnucky@gmail.com>", "committedDate": "2020-04-30T22:09:57Z", "type": "forcePushed"}]}