{"pr_number": 11909, "pr_title": "Add support for menu options on infoboxes", "pr_createdAt": "2020-06-17T01:31:22Z", "pr_url": "https://github.com/runelite/runelite/pull/11909", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI5MjM2Nw==", "url": "https://github.com/runelite/runelite/pull/11909#discussion_r441292367", "bodyText": "Why assert then cast? It will throw regardless", "author": "abextm", "createdAt": "2020-06-17T05:41:03Z", "path": "runelite-client/src/main/java/net/runelite/client/ui/overlay/infobox/InfoBoxOverlay.java", "diffHunk": "@@ -122,25 +141,56 @@ public Dimension render(Graphics2D graphics)\n \n \t\tfor (final LayoutableRenderableEntity child : panelComponent.getChildren())\n \t\t{\n-\t\t\tif (child instanceof InfoBoxComponent)\n+\t\t\tassert child instanceof InfoBoxComponent;", "originalCommit": "28de3105b7d27b94aad8b5d56b10847a63fb4830", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI5NTIxNw==", "url": "https://github.com/runelite/runelite/pull/11909#discussion_r441295217", "bodyText": "why not just invoke a listener attached to the infobox?", "author": "abextm", "createdAt": "2020-06-17T05:50:07Z", "path": "runelite-client/src/main/java/net/runelite/client/ui/overlay/infobox/InfoBoxOverlay.java", "diffHunk": "@@ -122,25 +141,56 @@ public Dimension render(Graphics2D graphics)\n \n \t\tfor (final LayoutableRenderableEntity child : panelComponent.getChildren())\n \t\t{\n-\t\t\tif (child instanceof InfoBoxComponent)\n+\t\t\tassert child instanceof InfoBoxComponent;\n+\t\t\tfinal InfoBoxComponent component = (InfoBoxComponent) child;\n+\n+\t\t\t// Create intersection rectangle\n+\t\t\tfinal Rectangle intersectionRectangle = new Rectangle(component.getBounds());\n+\t\t\tintersectionRectangle.translate(getBounds().x, getBounds().y);\n+\n+\t\t\tif (intersectionRectangle.contains(mouse))\n \t\t\t{\n-\t\t\t\tfinal InfoBoxComponent component = (InfoBoxComponent) child;\n+\t\t\t\tfinal String tooltip = component.getTooltip();\n+\t\t\t\tif (!Strings.isNullOrEmpty(tooltip))\n+\t\t\t\t{\n+\t\t\t\t\ttooltipManager.add(new Tooltip(tooltip));\n+\t\t\t\t}\n \n-\t\t\t\tif (!Strings.isNullOrEmpty(component.getTooltip()))\n+\t\t\t\tif (!menuOpen)\n \t\t\t\t{\n-\t\t\t\t\t// Create intersection rectangle\n-\t\t\t\t\tfinal Rectangle intersectionRectangle = new Rectangle(component.getBounds());\n-\t\t\t\t\tintersectionRectangle.translate(getBounds().x, getBounds().y);\n-\n-\t\t\t\t\tif (intersectionRectangle.contains(mouse))\n-\t\t\t\t\t{\n-\t\t\t\t\t\ttooltipManager.add(new Tooltip(component.getTooltip()));\n-\t\t\t\t\t}\n+\t\t\t\t\thoveredComponent = component;\n \t\t\t\t}\n+\t\t\t\tbreak;\n \t\t\t}\n \t\t}\n \n \t\tpanelComponent.getChildren().clear();\n \t\treturn dimension;\n \t}\n+\n+\t@Override\n+\tpublic List<OverlayMenuEntry> getMenuEntries()\n+\t{\n+\t\t// we dynamically build the menu options based on which infobox is hovered\n+\t\treturn hoveredComponent == null ? Collections.emptyList() : hoveredComponent.getInfoBox().getMenuEntries();\n+\t}\n+\n+\t@Subscribe\n+\tpublic void onMenuOptionClicked(MenuOptionClicked menuOptionClicked)\n+\t{\n+\t\tif (menuOptionClicked.getMenuAction() != MenuAction.RUNELITE_INFOBOX)\n+\t\t{\n+\t\t\treturn;\n+\t\t}\n+\n+\t\tInfoBox infoBox = hoveredComponent.getInfoBox();\n+\t\tOverlayMenuEntry overlayMenuEntry = infoBox.getMenuEntries().stream()\n+\t\t\t.filter(me -> me.getOption().equals(menuOptionClicked.getMenuOption()))\n+\t\t\t.findAny()\n+\t\t\t.orElse(null);\n+\t\tif (overlayMenuEntry != null)\n+\t\t{\n+\t\t\teventBus.post(new InfoBoxMenuClicked(overlayMenuEntry, infoBox));", "originalCommit": "28de3105b7d27b94aad8b5d56b10847a63fb4830", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTU1NDEyOQ==", "url": "https://github.com/runelite/runelite/pull/11909#discussion_r441554129", "bodyText": "EDIT: nvm", "author": "Adam-", "createdAt": "2020-06-17T13:41:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI5NTIxNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI5NjE2NA==", "url": "https://github.com/runelite/runelite/pull/11909#discussion_r441296164", "bodyText": "if (infoBoxMenuClicked.getInfobox() == deathTimer)?", "author": "abextm", "createdAt": "2020-06-17T05:52:57Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/deathindicator/DeathIndicatorPlugin.java", "diffHunk": "@@ -287,12 +303,37 @@ public void onGameStateChanged(GameStateChanged event)\n \t\t}\n \t}\n \n+\t@Subscribe\n+\tpublic void onInfoBoxMenuClicked(InfoBoxMenuClicked infoBoxMenuClicked)\n+\t{\n+\t\tOverlayMenuEntry overlayMenuEntry = infoBoxMenuClicked.getEntry();\n+\t\tif (overlayMenuEntry.getMenuAction() == MenuAction.RUNELITE_INFOBOX\n+\t\t\t&& infoBoxMenuClicked.getInfoBox() == deathTimer\n+\t\t\t&& infoBoxMenuClicked.getEntry().getOption().equals(DEATH_TIMER_CLEAR))", "originalCommit": "ca45fbe4103f1f66f75ee92798673258c17c725f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1680e97315eb91fbb2904e8b4fec64a0b14f0a64", "url": "https://github.com/runelite/runelite/commit/1680e97315eb91fbb2904e8b4fec64a0b14f0a64", "message": "overlay: optimize some menu handling code", "committedDate": "2020-06-17T15:12:42Z", "type": "commit"}, {"oid": "a3f0932cba2e5b91cc4fd24d51ec6413226f8c08", "url": "https://github.com/runelite/runelite/commit/a3f0932cba2e5b91cc4fd24d51ec6413226f8c08", "message": "client: add support for menu options on infoboxes", "committedDate": "2020-06-17T15:12:44Z", "type": "commit"}, {"oid": "442535ffb8fb9468fc6a73c8093fde20d17e0ef6", "url": "https://github.com/runelite/runelite/commit/442535ffb8fb9468fc6a73c8093fde20d17e0ef6", "message": "death indicator: add clear option to infobox\n\nCo-authored-by: ThatGamerBlue <thatgamerblue@gmail.com>", "committedDate": "2020-06-17T15:12:46Z", "type": "commit"}, {"oid": "442535ffb8fb9468fc6a73c8093fde20d17e0ef6", "url": "https://github.com/runelite/runelite/commit/442535ffb8fb9468fc6a73c8093fde20d17e0ef6", "message": "death indicator: add clear option to infobox\n\nCo-authored-by: ThatGamerBlue <thatgamerblue@gmail.com>", "committedDate": "2020-06-17T15:12:46Z", "type": "forcePushed"}]}