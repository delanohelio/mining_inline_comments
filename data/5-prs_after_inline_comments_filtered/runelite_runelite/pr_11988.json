{"pr_number": 11988, "pr_title": "Add a Toggle to the Status Bars w/ a Delay to show only in Combat", "pr_createdAt": "2020-06-26T02:26:51Z", "pr_url": "https://github.com/runelite/runelite/pull/11988", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTI5Njc4MQ==", "url": "https://github.com/runelite/runelite/pull/11988#discussion_r449296781", "bodyText": "This should mention that 0 will mean bars are always shown", "author": "Nightfirecat", "createdAt": "2020-07-02T22:42:00Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/statusbars/StatusBarsConfig.java", "diffHunk": "@@ -60,4 +61,15 @@ default boolean enableRestorationBars()\n \t{\n \t\treturn true;\n \t}\n-}\n+\n+\t@ConfigItem(\n+\t\tkeyName = \"hideAfterCombatDelay\",\n+\t\tname = \"Hide after combat delay\",\n+\t\tdescription = \"Time required to hide status bars after no longer in combat.\"", "originalCommit": "c172d24dea60697598a4c2807cf9cabbc0501540", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTI5NzI4Nw==", "url": "https://github.com/runelite/runelite/pull/11988#discussion_r449297287", "bodyText": "This field isn't accessed outside this class. Why does it have a getter?", "author": "Nightfirecat", "createdAt": "2020-07-02T22:43:45Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/statusbars/StatusBarsPlugin.java", "diffHunk": "@@ -47,10 +59,18 @@\n \t@Inject\n \tprivate OverlayManager overlayManager;\n \n+\t@Inject\n+\tprivate Client client;\n+\n+\t@Inject\n+\tprivate StatusBarsConfig config;\n+\n+\t@Getter(AccessLevel.PACKAGE)", "originalCommit": "c172d24dea60697598a4c2807cf9cabbc0501540", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTI5NzkyNw==", "url": "https://github.com/runelite/runelite/pull/11988#discussion_r449297927", "bodyText": "Game ticks would be a better unit of measurement since that's the unit of time this change actually operates on. That would also let you drop the Instant.now() duration comparisons in favor of using client.getTickCount().", "author": "Nightfirecat", "createdAt": "2020-07-02T22:46:07Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/statusbars/StatusBarsConfig.java", "diffHunk": "@@ -60,4 +61,15 @@ default boolean enableRestorationBars()\n \t{\n \t\treturn true;\n \t}\n-}\n+\n+\t@ConfigItem(\n+\t\tkeyName = \"hideAfterCombatDelay\",\n+\t\tname = \"Hide after combat delay\",\n+\t\tdescription = \"Time required to hide status bars after no longer in combat.\"\n+\t)\n+\t@Units(Units.SECONDS)", "originalCommit": "c172d24dea60697598a4c2807cf9cabbc0501540", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTI5ODE4NQ==", "url": "https://github.com/runelite/runelite/pull/11988#discussion_r449298185", "bodyText": "startUp() should be removed if it contains no code.", "author": "Nightfirecat", "createdAt": "2020-07-02T22:47:06Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/statusbars/StatusBarsPlugin.java", "diffHunk": "@@ -47,10 +59,18 @@\n \t@Inject\n \tprivate OverlayManager overlayManager;\n \n+\t@Inject\n+\tprivate Client client;\n+\n+\t@Inject\n+\tprivate StatusBarsConfig config;\n+\n+\t@Getter(AccessLevel.PACKAGE)\n+\tprivate Instant lastCombatAction;\n+\n \t@Override\n \tprotected void startUp() throws Exception\n \t{\n-\t\toverlayManager.add(overlay);", "originalCommit": "c172d24dea60697598a4c2807cf9cabbc0501540", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "d4fd0c5532d669cc6fb5a7768f5708a151394bef", "url": "https://github.com/runelite/runelite/commit/d4fd0c5532d669cc6fb5a7768f5708a151394bef", "message": "Condensed and Fixed conditionals\n- config is just one item now\n- conditionals were fixed && replaced with ||", "committedDate": "2020-10-02T17:58:46Z", "type": "forcePushed"}, {"oid": "610cd3533426908f959b46ce633ffe1b04b6dcf8", "url": "https://github.com/runelite/runelite/commit/610cd3533426908f959b46ce633ffe1b04b6dcf8", "message": "cleanup, add pvp combat check", "committedDate": "2020-10-29T04:47:40Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTUzMjM4Ng==", "url": "https://github.com/runelite/runelite/pull/11988#discussion_r515532386", "bodyText": "Usually we prefer short names since there is not much room for it in the side panel. When you hover over it it will show the description anyway. This would probably just show Show amount...", "author": "Adam-", "createdAt": "2020-10-31T19:47:52Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/statusbars/StatusBarsConfig.java", "diffHunk": "@@ -54,14 +56,25 @@ default boolean enableSkillIcon()\n \n \t@ConfigItem(\n \t\tkeyName = \"enableRestorationBars\",\n-\t\tname = \"Show restores\",\n-\t\tdescription = \"Visually shows how much will be restored to your status bar.\"\n+\t\tname = \"Show amount of hitpoints and prayer restored\",", "originalCommit": "610cd3533426908f959b46ce633ffe1b04b6dcf8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjE1NDcwMA==", "url": "https://github.com/runelite/runelite/pull/11988#discussion_r516154700", "bodyText": "Agreed! Change made.", "author": "ermalsh", "createdAt": "2020-11-02T17:53:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTUzMjM4Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTUzMjQwMg==", "url": "https://github.com/runelite/runelite/pull/11988#discussion_r515532402", "bodyText": "Maybe Hide delay", "author": "Adam-", "createdAt": "2020-10-31T19:48:06Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/statusbars/StatusBarsConfig.java", "diffHunk": "@@ -54,14 +56,25 @@ default boolean enableSkillIcon()\n \n \t@ConfigItem(\n \t\tkeyName = \"enableRestorationBars\",\n-\t\tname = \"Show restores\",\n-\t\tdescription = \"Visually shows how much will be restored to your status bar.\"\n+\t\tname = \"Show amount of hitpoints and prayer restored\",\n+\t\tdescription = \"Visually shows how much a food or prayer will heal/restore you on the bars.\"\n \t)\n \tdefault boolean enableRestorationBars()\n \t{\n \t\treturn true;\n \t}\n \n+\t@ConfigItem(\n+\t\tkeyName = \"hideAfterCombatDelay\",\n+\t\tname = \"Hide after combat delay\",", "originalCommit": "610cd3533426908f959b46ce633ffe1b04b6dcf8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTA1MTEwMQ==", "url": "https://github.com/runelite/runelite/pull/11988#discussion_r519051101", "bodyText": "Instead of adding and removing the overlay various places, you can keep the overlay enabled the entire time and return; from it early when the combat has timed out.", "author": "Adam-", "createdAt": "2020-11-06T23:16:49Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/statusbars/StatusBarsPlugin.java", "diffHunk": "@@ -64,4 +74,39 @@ StatusBarsConfig provideConfig(ConfigManager configManager)\n \t{\n \t\treturn configManager.getConfig(StatusBarsConfig.class);\n \t}\n+\n+\t@Subscribe\n+\tpublic void onGameTick(GameTick gameTick)\n+\t{\n+\t\tif (config.hideAfterCombatDelay() > 0)\n+\t\t{\n+\t\t\tshouldToggleStatusBars();\n+\t\t}\n+\t\telse\n+\t\t{\n+\t\t\toverlayManager.add(overlay);", "originalCommit": "6429fb617a97c7dfbb6b2c8a5164bf0594bccddf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "94f7d818b8285e8edb5df2ef8e187b6b6e369ff9", "url": "https://github.com/runelite/runelite/commit/94f7d818b8285e8edb5df2ef8e187b6b6e369ff9", "message": "statusbars: Add option to hide outside of combat", "committedDate": "2021-01-12T03:31:05Z", "type": "forcePushed"}, {"oid": "d049ed4d6621bb7cd4c73af1f2b8ad64f12c3874", "url": "https://github.com/runelite/runelite/commit/d049ed4d6621bb7cd4c73af1f2b8ad64f12c3874", "message": "statusbars: Add option to hide outside of combat", "committedDate": "2021-01-12T03:32:48Z", "type": "forcePushed"}, {"oid": "98cbdf535b062e388fedc04f3255782dccc01091", "url": "https://github.com/runelite/runelite/commit/98cbdf535b062e388fedc04f3255782dccc01091", "message": "statusbars: Add option to hide outside of combat", "committedDate": "2021-02-06T22:28:03Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NDE2MDQyOQ==", "url": "https://github.com/runelite/runelite/pull/11988#discussion_r584160429", "bodyText": "This must be run on the client thread or will error.", "author": "Adam-", "createdAt": "2021-02-27T17:12:00Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/statusbars/StatusBarsPlugin.java", "diffHunk": "@@ -47,21 +59,78 @@\n \t@Inject\n \tprivate OverlayManager overlayManager;\n \n+\t@Inject\n+\tprivate Client client;\n+\n+\t@Inject\n+\tprivate StatusBarsConfig config;\n+\n+\t@Inject\n+\tprivate ClientThread clientThread;\n+\n+\t@Getter(AccessLevel.PACKAGE)\n+\tprivate boolean barsDisplayed;\n+\n+\tprivate int lastCombatActionTickCount;\n+\n \t@Override\n \tprotected void startUp() throws Exception\n \t{\n+\t\tclientThread.invokeLater(this::shouldToggleStatusBars);\n \t\toverlayManager.add(overlay);\n \t}\n \n \t@Override\n \tprotected void shutDown() throws Exception\n \t{\n \t\toverlayManager.remove(overlay);\n+\t\tbarsDisplayed = false;\n \t}\n \n \t@Provides\n \tStatusBarsConfig provideConfig(ConfigManager configManager)\n \t{\n \t\treturn configManager.getConfig(StatusBarsConfig.class);\n \t}\n+\n+\t@Subscribe\n+\tpublic void onGameTick(GameTick gameTick)\n+\t{\n+\t\tshouldToggleStatusBars();\n+\t}\n+\n+\t@Subscribe\n+\tpublic void onConfigChanged(ConfigChanged event)\n+\t{\n+\t\tif (StatusBarsConfig.GROUP.equals(event.getGroup()) && event.getKey().equals(\"hideAfterCombatDelay\"))\n+\t\t{\n+\t\t\tshouldToggleStatusBars();", "originalCommit": "98cbdf535b062e388fedc04f3255782dccc01091", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NDE2MTAwNg==", "url": "https://github.com/runelite/runelite/pull/11988#discussion_r584161006", "bodyText": "This should be named something which resembles what it is doing like  checkStatusBars", "author": "Adam-", "createdAt": "2021-02-27T17:15:05Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/statusbars/StatusBarsPlugin.java", "diffHunk": "@@ -47,21 +59,78 @@\n \t@Inject\n \tprivate OverlayManager overlayManager;\n \n+\t@Inject\n+\tprivate Client client;\n+\n+\t@Inject\n+\tprivate StatusBarsConfig config;\n+\n+\t@Inject\n+\tprivate ClientThread clientThread;\n+\n+\t@Getter(AccessLevel.PACKAGE)\n+\tprivate boolean barsDisplayed;\n+\n+\tprivate int lastCombatActionTickCount;\n+\n \t@Override\n \tprotected void startUp() throws Exception\n \t{\n+\t\tclientThread.invokeLater(this::shouldToggleStatusBars);\n \t\toverlayManager.add(overlay);\n \t}\n \n \t@Override\n \tprotected void shutDown() throws Exception\n \t{\n \t\toverlayManager.remove(overlay);\n+\t\tbarsDisplayed = false;\n \t}\n \n \t@Provides\n \tStatusBarsConfig provideConfig(ConfigManager configManager)\n \t{\n \t\treturn configManager.getConfig(StatusBarsConfig.class);\n \t}\n+\n+\t@Subscribe\n+\tpublic void onGameTick(GameTick gameTick)\n+\t{\n+\t\tshouldToggleStatusBars();\n+\t}\n+\n+\t@Subscribe\n+\tpublic void onConfigChanged(ConfigChanged event)\n+\t{\n+\t\tif (StatusBarsConfig.GROUP.equals(event.getGroup()) && event.getKey().equals(\"hideAfterCombatDelay\"))\n+\t\t{\n+\t\t\tshouldToggleStatusBars();\n+\t\t}\n+\t}\n+\n+\tprivate void shouldToggleStatusBars()", "originalCommit": "98cbdf535b062e388fedc04f3255782dccc01091", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NDE2MTI4MQ==", "url": "https://github.com/runelite/runelite/pull/11988#discussion_r584161281", "bodyText": "I think you can just check this above and do an early return if it is 0, since it isn't necessary to check anything else then?", "author": "Adam-", "createdAt": "2021-02-27T17:16:11Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/statusbars/StatusBarsPlugin.java", "diffHunk": "@@ -47,21 +59,78 @@\n \t@Inject\n \tprivate OverlayManager overlayManager;\n \n+\t@Inject\n+\tprivate Client client;\n+\n+\t@Inject\n+\tprivate StatusBarsConfig config;\n+\n+\t@Inject\n+\tprivate ClientThread clientThread;\n+\n+\t@Getter(AccessLevel.PACKAGE)\n+\tprivate boolean barsDisplayed;\n+\n+\tprivate int lastCombatActionTickCount;\n+\n \t@Override\n \tprotected void startUp() throws Exception\n \t{\n+\t\tclientThread.invokeLater(this::shouldToggleStatusBars);\n \t\toverlayManager.add(overlay);\n \t}\n \n \t@Override\n \tprotected void shutDown() throws Exception\n \t{\n \t\toverlayManager.remove(overlay);\n+\t\tbarsDisplayed = false;\n \t}\n \n \t@Provides\n \tStatusBarsConfig provideConfig(ConfigManager configManager)\n \t{\n \t\treturn configManager.getConfig(StatusBarsConfig.class);\n \t}\n+\n+\t@Subscribe\n+\tpublic void onGameTick(GameTick gameTick)\n+\t{\n+\t\tshouldToggleStatusBars();\n+\t}\n+\n+\t@Subscribe\n+\tpublic void onConfigChanged(ConfigChanged event)\n+\t{\n+\t\tif (StatusBarsConfig.GROUP.equals(event.getGroup()) && event.getKey().equals(\"hideAfterCombatDelay\"))\n+\t\t{\n+\t\t\tshouldToggleStatusBars();\n+\t\t}\n+\t}\n+\n+\tprivate void shouldToggleStatusBars()\n+\t{\n+\t\tfinal Player localPlayer = client.getLocalPlayer();\n+\t\tif (localPlayer == null)\n+\t\t{\n+\t\t\treturn;\n+\t\t}\n+\n+\t\tfinal Actor interacting = localPlayer.getInteracting();\n+\n+\t\tif ((interacting instanceof NPC && ArrayUtils.contains(((NPC) interacting).getComposition().getActions(), \"Attack\"))\n+\t\t\t|| (interacting instanceof Player && client.getVar(Varbits.PVP_SPEC_ORB) == 1))\n+\t\t{\n+\t\t\tlastCombatActionTickCount = client.getTickCount();\n+\t\t\tbarsDisplayed = true;\n+\t\t}\n+\t\telse if (config.hideAfterCombatDelay() == 0)", "originalCommit": "98cbdf535b062e388fedc04f3255782dccc01091", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "772fcba90d6c20d61d95d257e439d2ef78e298e2", "url": "https://github.com/runelite/runelite/commit/772fcba90d6c20d61d95d257e439d2ef78e298e2", "message": "statusbars: Add option to hide outside of combat", "committedDate": "2021-03-02T07:04:58Z", "type": "forcePushed"}, {"oid": "fcfda4d63af5c7724ded583c58f14c0ada20d0b2", "url": "https://github.com/runelite/runelite/commit/fcfda4d63af5c7724ded583c58f14c0ada20d0b2", "message": "statusbars: Add option to hide outside of combat", "committedDate": "2021-05-14T07:16:48Z", "type": "commit"}, {"oid": "fcfda4d63af5c7724ded583c58f14c0ada20d0b2", "url": "https://github.com/runelite/runelite/commit/fcfda4d63af5c7724ded583c58f14c0ada20d0b2", "message": "statusbars: Add option to hide outside of combat", "committedDate": "2021-05-14T07:16:48Z", "type": "forcePushed"}]}