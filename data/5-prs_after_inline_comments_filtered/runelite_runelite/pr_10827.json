{"pr_number": 10827, "pr_title": "Improve GPU Plugin performance", "pr_createdAt": "2020-02-18T15:38:21Z", "pr_url": "https://github.com/runelite/runelite/pull/10827", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDc2NzE0NQ==", "url": "https://github.com/runelite/runelite/pull/10827#discussion_r380767145", "bodyText": "The scene buffers are not updated per frame nor even drawn from directly, instead they are (readonly) accessed via ssbo in the compute shaders.", "author": "Adam-", "createdAt": "2020-02-18T15:59:37Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/gpu/GpuPlugin.java", "diffHunk": "@@ -1195,26 +1241,17 @@ private void uploadScene()\n \t\tIntBuffer vertexBuffer = this.vertexBuffer.getBuffer();\n \t\tFloatBuffer uvBuffer = this.uvBuffer.getBuffer();\n \n-\t\tif (bufferId != -1)\n-\t\t{\n-\t\t\tGLUtil.glDeleteBuffer(gl, bufferId);\n-\t\t\tbufferId = -1;\n-\t\t}\n-\n-\t\tif (uvBufferId != -1)\n-\t\t{\n-\t\t\tGLUtil.glDeleteBuffer(gl, uvBufferId);\n-\t\t\tuvBufferId = -1;\n-\t\t}\n+\t\tif (bufferId == -1)\n+\t\t\tbufferId = glGenBuffers(gl);\n \n-\t\tbufferId = glGenBuffers(gl);\n-\t\tuvBufferId = glGenBuffers(gl);\n+\t\tif (uvBufferId == -1)\n+\t\t\tuvBufferId = glGenBuffers(gl);\n \n \t\tgl.glBindBuffer(gl.GL_ARRAY_BUFFER, bufferId);\n-\t\tgl.glBufferData(gl.GL_ARRAY_BUFFER, vertexBuffer.limit() * Integer.BYTES, vertexBuffer, gl.GL_STATIC_COPY);\n+\t\tgl.glBufferData(gl.GL_ARRAY_BUFFER, vertexBuffer.limit() * Integer.BYTES, vertexBuffer, gl.GL_DYNAMIC_DRAW);", "originalCommit": "81c88e01ce78fa4668f35ab1b10189e809cef0d5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "8cfaeb2a073f3d963962065a5b27ebc7081ce55e", "url": "https://github.com/runelite/runelite/commit/8cfaeb2a073f3d963962065a5b27ebc7081ce55e", "message": "gpu: create tmp data buffers during init and reuse across frames\n\nCreating and destroying buffers each frame is unnecessary and inefficient as it doesn't give the driver the chance to observe the buffer's usage and optimize its access.\n\nCo-authored-by: Adam <Adam@sigterm.info>", "committedDate": "2020-02-19T14:43:42Z", "type": "forcePushed"}, {"oid": "e8f04c7159c08df9abfc78f52be9042808064dd5", "url": "https://github.com/runelite/runelite/commit/e8f04c7159c08df9abfc78f52be9042808064dd5", "message": "gpu: create tmp data buffers during init and reuse across frames\n\nCreating and destroying buffers each frame is unnecessary and inefficient as it doesn't give the driver the chance to observe the buffer's usage and optimize its access.\n\nCo-authored-by: Adam <Adam@sigterm.info>", "committedDate": "2020-02-19T18:11:38Z", "type": "commit"}, {"oid": "e8f04c7159c08df9abfc78f52be9042808064dd5", "url": "https://github.com/runelite/runelite/commit/e8f04c7159c08df9abfc78f52be9042808064dd5", "message": "gpu: create tmp data buffers during init and reuse across frames\n\nCreating and destroying buffers each frame is unnecessary and inefficient as it doesn't give the driver the chance to observe the buffer's usage and optimize its access.\n\nCo-authored-by: Adam <Adam@sigterm.info>", "committedDate": "2020-02-19T18:11:38Z", "type": "forcePushed"}]}