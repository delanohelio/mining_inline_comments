{"pr_number": 12337, "pr_title": "grounditems plugin: fix despawn timer for private KBD instances", "pr_createdAt": "2020-08-14T06:27:27Z", "pr_url": "https://github.com/runelite/runelite/pull/12337", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTIxMTg4Nw==", "url": "https://github.com/runelite/runelite/pull/12337#discussion_r471211887", "bodyText": "We need to check LootType.DROPPED to determine whether the despawn time should be set to DESPAWN_TIME_LOOT (2 minutes) or DESPAWN_TIME_DROP (3 minutes).", "author": "honeyhoney", "createdAt": "2020-08-17T03:19:05Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/grounditems/GroundItemsOverlay.java", "diffHunk": "@@ -391,8 +392,16 @@ private void drawTimerOverlay(Graphics2D graphics, int textX, int textY, GroundI\n \t\t\t{\n \t\t\t\treturn;\n \t\t\t}\n+\t\t\t// Items in the KBD instance use the standard despawn timer\n+\t\t\telse if (isInKBD())\n+\t\t\t{\n+\t\t\t\tdespawnTime = spawnTime.plus(DESPAWN_TIME_LOOT);", "originalCommit": "686cc62a8cc647e2cd39630bb10747dc9d5e3a83", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjc0Mzc0NQ==", "url": "https://github.com/runelite/runelite/pull/12337#discussion_r472743745", "bodyText": "Thanks for the catch, for some reason I was thinking that the timers would be the same like they would be in an instance just shorter.", "author": "arafian", "createdAt": "2020-08-19T06:12:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTIxMTg4Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTIxMzM1MQ==", "url": "https://github.com/runelite/runelite/pull/12337#discussion_r471213351", "bodyText": "Put a local player plane check here (plane should be 0).", "author": "honeyhoney", "createdAt": "2020-08-17T03:25:55Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/grounditems/GroundItemsOverlay.java", "diffHunk": "@@ -478,4 +487,9 @@ private boolean isInKraken()\n \t\treturn ArrayUtils.contains(client.getMapRegions(), KRAKEN_REGION);\n \t}\n \n+\tprivate boolean isInKBD()\n+\t{\n+\t\treturn ArrayUtils.contains(client.getMapRegions(), KBD_REGION);", "originalCommit": "686cc62a8cc647e2cd39630bb10747dc9d5e3a83", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjc0NDg4OA==", "url": "https://github.com/runelite/runelite/pull/12337#discussion_r472744888", "bodyText": "Why do we do this? Should we also put the check in the IsInKraken method too, or is it a different case?", "author": "arafian", "createdAt": "2020-08-19T06:13:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTIxMzM1MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzE3NzQwNg==", "url": "https://github.com/runelite/runelite/pull/12337#discussion_r473177406", "bodyText": "NMZ uses the same map region at the KBD lair. The way we differentiate between the two is is the plane.\nThis is of course assuming NMZ instances use normal instance logic when it comes to dropped and looted items - definitely worth checking. If they use the same logic as a private KBD instance then of course you don't need to add a plane check but would want to rename the method to isInKBDorNMZ or something akin to that. If they use alternative logic to regular instances and private KBD instances then you'll want to add a new isInNMZ method (using the same map region but different plane check) and implement the new despawn logic similar to how you did for KBD.\nEdit: to answer your question more specifically, you do not need to add a check to IsInKraken as I do not believe any instanced area shares the same map region.", "author": "honeyhoney", "createdAt": "2020-08-19T16:50:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTIxMzM1MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzYxNjk5Mg==", "url": "https://github.com/runelite/runelite/pull/12337#discussion_r473616992", "bodyText": "Ah, I see that makes sense.\nSo I tested out how loot and dropped items work in NMZ and it's pretty confusing...\nFrom what I can tell items dropped in NMZ never despawn. I waited for over an hour but they didn't despawn.\nLoot in NMZ uniformly despawn after 3 minutes which is what you would expect, but the weird thing is RuneLite only seems to be detecting some of the dropped object items for timers. It doesn't show timers for any of the bones/ashes dropped by monsters, but it does show timers for some of the other dropped items such as leaves dropped by Tanglefoot and vampyre dust dropped by Dessous. However, other drops have no timers such as choc-ice dropped by Karamel and cake dropped by the Culinromancer. I didn't test every boss, but I have no idea why some items have timers and some don't. Apart from that, it should be straightforward to add another if/else for NMZ's drop/loot mechanics too. I attached a image that shows what I mean; the bones have no timers but the leaves do.", "author": "arafian", "createdAt": "2020-08-20T05:45:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTIxMzM1MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTczNTY5MA==", "url": "https://github.com/runelite/runelite/pull/12337#discussion_r479735690", "bodyText": "Ok, so the reason the bones had to timers is because I was dumb and had them hidden by accident. I've updated it so dropped items in NMZ have no despawn timer (since they never despawn) and monster drops have the regular loot timer which is accurate based on my testing.", "author": "arafian", "createdAt": "2020-08-30T07:46:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTIxMzM1MQ=="}], "type": "inlineReview"}, {"oid": "89468a23574318de0dfaa323235c270e7cbe2af3", "url": "https://github.com/runelite/runelite/commit/89468a23574318de0dfaa323235c270e7cbe2af3", "message": "grounditems plugin: fix despawn timer for private KBD instances", "committedDate": "2020-08-30T07:43:19Z", "type": "commit"}, {"oid": "5cc66adb4b9c9fad8e4d86eed31d2b4491d17ae6", "url": "https://github.com/runelite/runelite/commit/5cc66adb4b9c9fad8e4d86eed31d2b4491d17ae6", "message": "separate drop and loot timers", "committedDate": "2020-08-30T07:43:19Z", "type": "commit"}, {"oid": "5b59a164145f0aed461a9cdf252d952647a95025", "url": "https://github.com/runelite/runelite/commit/5b59a164145f0aed461a9cdf252d952647a95025", "message": "add NMZ instance check", "committedDate": "2020-08-30T07:43:19Z", "type": "commit"}, {"oid": "5b1a577339dea43684b78c9d616bbbf98b8d3fca", "url": "https://github.com/runelite/runelite/commit/5b1a577339dea43684b78c9d616bbbf98b8d3fca", "message": "Update GroundItemsOverlay.java", "committedDate": "2020-08-30T14:48:57Z", "type": "commit"}]}