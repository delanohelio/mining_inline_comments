{"pr_number": 2998, "pr_title": "ARTEMIS-2641 Openwire client runs out of credits after reconnection", "pr_createdAt": "2020-03-04T08:20:31Z", "pr_url": "https://github.com/apache/activemq-artemis/pull/2998", "timeline": [{"oid": "c0f3ea66a91613cb1f928edabdfe213e7c44a4b9", "url": "https://github.com/apache/activemq-artemis/commit/c0f3ea66a91613cb1f928edabdfe213e7c44a4b9", "message": "ARTEMIS-2641 Openwire client runs out of credits after reconnection\n\nClear the messagePullHandler on setting prefetchSize.", "committedDate": "2020-03-04T08:14:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUyMzY0OQ==", "url": "https://github.com/apache/activemq-artemis/pull/2998#discussion_r387523649", "bodyText": "what happen if it won't succeed?", "author": "franz1981", "createdAt": "2020-03-04T08:53:25Z", "path": "artemis-protocols/artemis-openwire-protocol/src/main/java/org/apache/activemq/artemis/core/protocol/openwire/amq/AMQConsumer.java", "diffHunk": "@@ -380,6 +383,11 @@ public void setPrefetchSize(int prefetchSize) {\n       this.prefetchSize = prefetchSize;\n       this.currentWindow.set(prefetchSize);\n       this.info.setPrefetchSize(prefetchSize);\n+      if (this.prefetchSize == 0) {\n+         messagePullHandler.compareAndSet(null, new MessagePullHandler());", "originalCommit": "c0f3ea66a91613cb1f928edabdfe213e7c44a4b9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUyMzk5NQ==", "url": "https://github.com/apache/activemq-artemis/pull/2998#discussion_r387523995", "bodyText": "@michaelandrepearce any suggestions?", "author": "franz1981", "createdAt": "2020-03-04T08:54:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUyMzY0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUyNTQ5MQ==", "url": "https://github.com/apache/activemq-artemis/pull/2998#discussion_r387525491", "bodyText": "what do you mean if it wont succeed? if its not null it means it already had a pullhandler set, no need to assign a new one.", "author": "michaelpearce-gain", "createdAt": "2020-03-04T08:57:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUyMzY0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUyODAxMw==", "url": "https://github.com/apache/activemq-artemis/pull/2998#discussion_r387528013", "bodyText": "that can happen if:\n\nthere is a racing thread doing it\nthe value isn't null\n\nin both cases probably logging some trace/debug is ok if we expect it to happen?", "author": "franz1981", "createdAt": "2020-03-04T09:01:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUyMzY0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUyODc1Mg==", "url": "https://github.com/apache/activemq-artemis/pull/2998#discussion_r387528752", "bodyText": "Anyway It's fine to me; if there are no objections I'm going to merge this ;)", "author": "franz1981", "createdAt": "2020-03-04T09:03:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUyMzY0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUyOTAzNA==", "url": "https://github.com/apache/activemq-artemis/pull/2998#discussion_r387529034", "bodyText": "if its not null, we dont want to change it. e.g. the case there is client was already at prefetch 0 and simply sent a second update which set it to the same size, as such you want to leave the original pullhandler.", "author": "michaelpearce-gain", "createdAt": "2020-03-04T09:03:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUyMzY0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUyOTU4Mw==", "url": "https://github.com/apache/activemq-artemis/pull/2998#discussion_r387529583", "bodyText": "if you really want a log i would add it as a trace, i dont think its needed tbh i think it just clutter the code base.", "author": "michaelpearce-gain", "createdAt": "2020-03-04T09:04:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUyMzY0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUyOTg1NQ==", "url": "https://github.com/apache/activemq-artemis/pull/2998#discussion_r387529855", "bodyText": "no need to set messagePullHandler value if it isn't null", "author": "brusdev", "createdAt": "2020-03-04T09:05:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUyMzY0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUzMDIzNw==", "url": "https://github.com/apache/activemq-artemis/pull/2998#discussion_r387530237", "bodyText": "\ud83d\udc4d  thanks for the explanation bud :)", "author": "franz1981", "createdAt": "2020-03-04T09:06:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUyMzY0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUzMTcxMA==", "url": "https://github.com/apache/activemq-artemis/pull/2998#discussion_r387531710", "bodyText": "Anyway It's fine to me; if there are no objections I'm going to merge this ;)\n\nno objections here, please go ahead....", "author": "michaelpearce-gain", "createdAt": "2020-03-04T09:09:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUyMzY0OQ=="}], "type": "inlineReview"}]}