{"pr_number": 3374, "pr_title": "ARTEMIS-3024 Expiry or DLQ Retry not working with AMQP", "pr_createdAt": "2020-12-08T19:20:48Z", "pr_url": "https://github.com/apache/activemq-artemis/pull/3374", "timeline": [{"oid": "825341734a84807634f44c6bd14c40b7379182f2", "url": "https://github.com/apache/activemq-artemis/commit/825341734a84807634f44c6bd14c40b7379182f2", "message": "ARTEMIS-3024 Expiry or DLQ Retry not working with AMQP", "committedDate": "2020-12-08T19:13:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODg2MTk4MA==", "url": "https://github.com/apache/activemq-artemis/pull/3374#discussion_r538861980", "bodyText": "Whats the purpose of this?", "author": "michaelandrepearce", "createdAt": "2020-12-08T22:40:08Z", "path": "artemis-server/src/main/java/org/apache/activemq/artemis/core/server/impl/QueueImpl.java", "diffHunk": "@@ -2140,6 +2140,7 @@ private int iterQueue(final int flushLimit,\n                                       QueueIterateAction messageAction) throws Exception {\n       int count = 0;\n       int txCount = 0;\n+      Integer expectedHits = messageAction.expectedHits();", "originalCommit": "825341734a84807634f44c6bd14c40b7379182f2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODg5MzA5NQ==", "url": "https://github.com/apache/activemq-artemis/pull/3374#discussion_r538893095", "bodyText": "QueueControl.expire with a messageID will only expire a single record, however the iteration will go until the end. it's sort of an optimization.", "author": "clebertsuconic", "createdAt": "2020-12-08T23:41:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODg2MTk4MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODg2MjUxNQ==", "url": "https://github.com/apache/activemq-artemis/pull/3374#discussion_r538862515", "bodyText": "Why default method? Its been implemented in queueimpl", "author": "michaelandrepearce", "createdAt": "2020-12-08T22:41:11Z", "path": "artemis-server/src/main/java/org/apache/activemq/artemis/core/server/Queue.java", "diffHunk": "@@ -361,6 +361,10 @@ int moveReferences(int flushLimit,\n \n    int retryMessages(Filter filter) throws Exception;\n \n+   default int retryMessages(Filter filter, Integer expectedHits) throws Exception {", "originalCommit": "825341734a84807634f44c6bd14c40b7379182f2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODg5MjgyOQ==", "url": "https://github.com/apache/activemq-artemis/pull/3374#discussion_r538892829", "bodyText": "there are a bunch of Fakes that don't require implementing anything.", "author": "clebertsuconic", "createdAt": "2020-12-08T23:40:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODg2MjUxNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODkxNDY5NQ==", "url": "https://github.com/apache/activemq-artemis/pull/3374#discussion_r538914695", "bodyText": "@michaelandrepearce I could go without the default.. but having the default here minimized the number of changes on Fakes.. etc... It was just for simplicity and minimize the number of lines changed.", "author": "clebertsuconic", "createdAt": "2020-12-09T00:36:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODg2MjUxNQ=="}], "type": "inlineReview"}]}