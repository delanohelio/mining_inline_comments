{"pr_number": 2839, "pr_title": "Collect Metrics for JVM Safe Point Stats", "pr_createdAt": "2020-12-05T03:26:08Z", "pr_url": "https://github.com/CorfuDB/CorfuDB/pull/2839", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODAwNjAxMA==", "url": "https://github.com/CorfuDB/CorfuDB/pull/2839#discussion_r538006010", "bodyText": "maybe we should use micrometer's JVM metrics? https://micrometer.io/docs/ref/jvm", "author": "xnull", "createdAt": "2020-12-08T03:27:46Z", "path": "common/src/main/java/org/corfudb/common/metrics/micrometer/JVMMetrics.java", "diffHunk": "@@ -0,0 +1,43 @@\n+package org.corfudb.common.metrics.micrometer;\n+\n+import io.micrometer.core.instrument.Gauge;\n+import io.micrometer.core.instrument.MeterRegistry;\n+import java.util.Optional;\n+import lombok.Data;\n+import lombok.Getter;\n+import sun.management.HotspotRuntimeMBean;\n+import sun.management.ManagementFactoryHelper;\n+\n+/** Provides JVM level metrics. */\n+\n+public final class JVMMetrics {\n+\n+    @Getter(lazy=true)\n+    private final static HotspotRuntimeMBean runtimeMBean = ManagementFactoryHelper.getHotspotRuntimeMBean();\n+\n+    @Data\n+    private static class SafePointStats {\n+        long safepointTime;\n+        long safepointCount;\n+    }\n+\n+    public static void register(Optional<MeterRegistry> metricsRegistry) {\n+\n+        if (metricsRegistry.isPresent()) {", "originalCommit": "537f5f1a7bb4fe46d5432cdb24750862206549c5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODAwODAwMA==", "url": "https://github.com/CorfuDB/CorfuDB/pull/2839#discussion_r538008000", "bodyText": "I checked micrometer's jvm metrics, but they don't collect TotalSafepointTime. Maybe because its a \"private\" API.", "author": "Maithem", "createdAt": "2020-12-08T03:33:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODAwNjAxMA=="}], "type": "inlineReview"}, {"oid": "680c163f98dadfbcbd94b12c7bbcc05a3d2832b4", "url": "https://github.com/CorfuDB/CorfuDB/commit/680c163f98dadfbcbd94b12c7bbcc05a3d2832b4", "message": "Collect Metrics for JVM Safe Point Stats\n\nExcessive JVM pauses can adversely affect the fault detection system\nrendering the cluster instable because of unnecessary reconfigurations.\nSafepoint metrics are crucial for debugging such problems, so this patch\nadds safe point stats to the standard collection process.", "committedDate": "2020-12-08T21:53:58Z", "type": "forcePushed"}, {"oid": "05c8115b947b0efb8c964638330f63a49abc3e66", "url": "https://github.com/CorfuDB/CorfuDB/commit/05c8115b947b0efb8c964638330f63a49abc3e66", "message": "Collect Metrics for JVM Safe Point Stats\n\nExcessive JVM pauses can adversely affect the fault detection system\nrendering the cluster instable because of unnecessary reconfigurations.\nSafepoint metrics are crucial for debugging such problems, so this patch\nadds safe point stats to the standard collection process.", "committedDate": "2020-12-08T22:08:03Z", "type": "forcePushed"}, {"oid": "72114fc2529bb2b2cd8bb4b975580ceea21b9cff", "url": "https://github.com/CorfuDB/CorfuDB/commit/72114fc2529bb2b2cd8bb4b975580ceea21b9cff", "message": "Collect Metrics for JVM Safe Point Stats\n\nExcessive JVM pauses can adversely affect the fault detection system\nrendering the cluster instable because of unnecessary reconfigurations.\nSafepoint metrics are crucial for debugging such problems, so this patch\nadds safe point stats to the standard collection process.", "committedDate": "2020-12-08T22:15:14Z", "type": "commit"}, {"oid": "72114fc2529bb2b2cd8bb4b975580ceea21b9cff", "url": "https://github.com/CorfuDB/CorfuDB/commit/72114fc2529bb2b2cd8bb4b975580ceea21b9cff", "message": "Collect Metrics for JVM Safe Point Stats\n\nExcessive JVM pauses can adversely affect the fault detection system\nrendering the cluster instable because of unnecessary reconfigurations.\nSafepoint metrics are crucial for debugging such problems, so this patch\nadds safe point stats to the standard collection process.", "committedDate": "2020-12-08T22:15:14Z", "type": "forcePushed"}, {"oid": "5469324f35183aeb2348b7a94ed548617cdd0cb8", "url": "https://github.com/CorfuDB/CorfuDB/commit/5469324f35183aeb2348b7a94ed548617cdd0cb8", "message": "Merge branch 'master' into stwGCPauseMetric", "committedDate": "2020-12-09T00:15:58Z", "type": "commit"}, {"oid": "e8e1e59b78a2ecee1927ec0337e4f7d152a26d66", "url": "https://github.com/CorfuDB/CorfuDB/commit/e8e1e59b78a2ecee1927ec0337e4f7d152a26d66", "message": "Merge branch 'master' into stwGCPauseMetric", "committedDate": "2020-12-09T06:03:43Z", "type": "commit"}, {"oid": "58440292dc218543bc4a156d48bf7eed35d0b80d", "url": "https://github.com/CorfuDB/CorfuDB/commit/58440292dc218543bc4a156d48bf7eed35d0b80d", "message": "Merge branch 'master' into stwGCPauseMetric", "committedDate": "2020-12-09T18:11:00Z", "type": "commit"}]}