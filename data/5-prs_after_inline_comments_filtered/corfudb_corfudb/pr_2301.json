{"pr_number": 2301, "pr_title": "CorfuStore: Version should start with 0", "pr_createdAt": "2020-01-03T23:25:29Z", "pr_url": "https://github.com/CorfuDB/CorfuDB/pull/2301", "timeline": [{"oid": "ac2f772eedda55ca730e48a5032a86956509da47", "url": "https://github.com/CorfuDB/CorfuDB/commit/ac2f772eedda55ca730e48a5032a86956509da47", "message": "CorfuStore: Version should start with 0\n\nNewly created objects need to have a version field of 0\nto be compatible with some older usecases.\n+TestCase to validate this.", "committedDate": "2020-01-03T23:23:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzQ1NDk3Ng==", "url": "https://github.com/CorfuDB/CorfuDB/pull/2301#discussion_r363454976", "bodyText": "Can we make 0L a static final variable?", "author": "annym", "createdAt": "2020-01-06T19:51:58Z", "path": "runtime/src/main/java/org/corfudb/runtime/collections/Table.java", "diffHunk": "@@ -300,15 +305,16 @@ int count() {\n             Descriptors.FieldDescriptor.Type.SFIXED64\n     ));\n \n-    private M getNewMetadata(@Nonnull M previousMetadata,\n-                             @Nullable M userMetadata) {\n+    private M mergeOldAndNewMetadata(@Nonnull M previousMetadata,\n+                                     @Nullable M userMetadata, boolean isCreate) {\n         M.Builder builder = previousMetadata.toBuilder();\n         for (Descriptors.FieldDescriptor fieldDescriptor : previousMetadata.getDescriptorForType().getFields()) {\n             if (fieldDescriptor.getOptions().getExtension(CorfuOptions.schema).getVersion()) {\n+                // If an object is just being created, explicitly set its version field to 0\n                 builder.setField(\n                         fieldDescriptor,\n                         Optional.ofNullable(previousMetadata.getField(fieldDescriptor))\n-                                .map(previousVersion -> ((Long) previousVersion) + 1)\n+                                .map(previousVersion -> (isCreate ? 0L : ((Long) previousVersion) + 1))", "originalCommit": "ac2f772eedda55ca730e48a5032a86956509da47", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}