{"pr_number": 8511, "pr_title": "Fix #7763 gpx track selection", "pr_createdAt": "2020-02-19T13:14:26Z", "pr_url": "https://github.com/osmandapp/OsmAnd/pull/8511", "timeline": [{"oid": "41df9fff9ef87939d3efc87ce679933bd47c40f3", "url": "https://github.com/osmandapp/OsmAnd/commit/41df9fff9ef87939d3efc87ce679933bd47c40f3", "message": "Fix #7763 selected gpx file status", "committedDate": "2020-02-18T15:18:45Z", "type": "commit"}, {"oid": "2697095a9933f471bf63b76ecfac5ddd8b8e95b7", "url": "https://github.com/osmandapp/OsmAnd/commit/2697095a9933f471bf63b76ecfac5ddd8b8e95b7", "message": "Fix remarks remove loadingFileName", "committedDate": "2020-02-19T10:40:44Z", "type": "commit"}, {"oid": "0159bc77fa95313615435337965d6e4ee795e419", "url": "https://github.com/osmandapp/OsmAnd/commit/0159bc77fa95313615435337965d6e4ee795e419", "message": "Fix refactoring SelectGpxTask->GpxSelectionHelper", "committedDate": "2020-02-19T13:01:52Z", "type": "commit"}, {"oid": "c774bd1fc58c9735be6d3f30445a3f3dfda1d4eb", "url": "https://github.com/osmandapp/OsmAnd/commit/c774bd1fc58c9735be6d3f30445a3f3dfda1d4eb", "message": "Merge branch 'master' into Fix_7763_gpx_track_selection", "committedDate": "2020-02-19T13:03:43Z", "type": "commit"}, {"oid": "ab8a90fac33d8f33845cb4f7075ed59d908b9ea3", "url": "https://github.com/osmandapp/OsmAnd/commit/ab8a90fac33d8f33845cb4f7075ed59d908b9ea3", "message": "Fix refactoring SelectGpxTask->GpxSelectionHelper", "committedDate": "2020-02-19T13:07:57Z", "type": "commit"}, {"oid": "93cfc83a4e7e4a10c698c1ec3a1d920010cb30d5", "url": "https://github.com/osmandapp/OsmAnd/commit/93cfc83a4e7e4a10c698c1ec3a1d920010cb30d5", "message": "Refactoring GpxSelectionHelper", "committedDate": "2020-02-20T15:13:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjEyMzU2Ng==", "url": "https://github.com/osmandapp/OsmAnd/pull/8511#discussion_r382123566", "bodyText": "Why always true for the current track?", "author": "Chumva", "createdAt": "2020-02-20T16:45:29Z", "path": "OsmAnd/src/net/osmand/plus/myplaces/AvailableGPXFragment.java", "diffHunk": "@@ -605,19 +625,22 @@ public boolean onPrepareActionMode(ActionMode mode, Menu menu) {\n \n \t\t\t@Override\n \t\t\tpublic boolean onActionItemClicked(ActionMode mode, MenuItem item) {\n-\t\t\t\trunSelection(false);\n+\t\t\t\tHashMap<String, Boolean> selectedItemsFileNames = new HashMap<>();\n+\t\t\t\toriginalSelectedItems.addAll(selectedItems);\n+\t\t\t\tfor (GpxInfo gpxInfo : originalSelectedItems) {\n+\t\t\t\t\tif (gpxInfo.currentlyRecordingTrack) {\n+\t\t\t\t\t\tselectedItemsFileNames.put(CURRENT_TRACK, true);", "originalCommit": "93cfc83a4e7e4a10c698c1ec3a1d920010cb30d5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1d9d09e3774073b85a714d29ee347924fad7e858", "url": "https://github.com/osmandapp/OsmAnd/commit/1d9d09e3774073b85a714d29ee347924fad7e858", "message": "GpxSelectionHelper refactoring", "committedDate": "2020-02-21T11:31:09Z", "type": "commit"}, {"oid": "8e872492c77589883ff2b5280b75d5ca5f309c64", "url": "https://github.com/osmandapp/OsmAnd/commit/8e872492c77589883ff2b5280b75d5ca5f309c64", "message": "Refactoring gpxTaskListener", "committedDate": "2020-02-21T12:23:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjU2ODM4MA==", "url": "https://github.com/osmandapp/OsmAnd/pull/8511#discussion_r382568380", "bodyText": "No field is needed ! Fields should be created carefully and when it is not needed better to use parameter for method", "author": "vshcherb", "createdAt": "2020-02-21T13:00:16Z", "path": "OsmAnd/src/net/osmand/plus/GpxSelectionHelper.java", "diffHunk": "@@ -54,7 +56,12 @@\n \tprivate Map<GPXFile, Long> selectedGpxFilesBackUp = new java.util.HashMap<>();\n \tprivate SavingTrackHelper savingTrackHelper;\n \tprivate final static Log LOG = PlatformUtil.getLog(GpxSelectionHelper.class);\n+\tprivate SelectGpxTask selectGpxTask;\n+\tprivate SelectGpxTaskListener gpxTaskListener;\n \n+\tpublic void setGpxTaskListener(SelectGpxTaskListener gpxTaskListener) {", "originalCommit": "8e872492c77589883ff2b5280b75d5ca5f309c64", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjU3NjQxMA==", "url": "https://github.com/osmandapp/OsmAnd/pull/8511#discussion_r382576410", "bodyText": "I know, but with this listener, we can get updates for necessary screens if update working in the background and it doesn`t update new screen. We have similar behaviour in DownloadIndexesThread with DownloadEvents.", "author": "Chumva", "createdAt": "2020-02-21T13:19:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjU2ODM4MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjU2ODcwNA==", "url": "https://github.com/osmandapp/OsmAnd/pull/8511#discussion_r382568704", "bodyText": "better to use -1 if it is going to be used. Sometimes 0 is system time", "author": "vshcherb", "createdAt": "2020-02-21T13:00:52Z", "path": "OsmAnd/src/net/osmand/plus/GpxSelectionHelper.java", "diffHunk": "@@ -698,6 +715,10 @@ public void setGpxFile(GPXFile gpxFile, OsmandApplication app) {\n \t\t\tprocessPoints(app);\n \t\t}\n \n+\t\tpublic boolean isLoaded() {\n+\t\t\treturn gpxFile.modifiedTime != 0;", "originalCommit": "8e872492c77589883ff2b5280b75d5ca5f309c64", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjU2ODk3NQ==", "url": "https://github.com/osmandapp/OsmAnd/pull/8511#discussion_r382568975", "bodyText": "Field is not used anywhere", "author": "vshcherb", "createdAt": "2020-02-21T13:01:35Z", "path": "OsmAnd/src/net/osmand/plus/GpxSelectionHelper.java", "diffHunk": "@@ -54,7 +56,12 @@\n \tprivate Map<GPXFile, Long> selectedGpxFilesBackUp = new java.util.HashMap<>();\n \tprivate SavingTrackHelper savingTrackHelper;\n \tprivate final static Log LOG = PlatformUtil.getLog(GpxSelectionHelper.class);\n+\tprivate SelectGpxTask selectGpxTask;", "originalCommit": "8e872492c77589883ff2b5280b75d5ca5f309c64", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjU3MzUwNQ==", "url": "https://github.com/osmandapp/OsmAnd/pull/8511#discussion_r382573505", "bodyText": "This field is used for checking running SelectGpxTask in runSelection", "author": "Chumva", "createdAt": "2020-02-21T13:12:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjU2ODk3NQ=="}], "type": "inlineReview"}, {"oid": "a58c0069a73800b5454f1c16e08130615206c510", "url": "https://github.com/osmandapp/OsmAnd/commit/a58c0069a73800b5454f1c16e08130615206c510", "message": "Refactoring SelectGpxTaskListener", "committedDate": "2020-02-21T17:03:44Z", "type": "commit"}, {"oid": "55363869c1ba7f8b728f6b4ae65e08763a00e8ad", "url": "https://github.com/osmandapp/OsmAnd/commit/55363869c1ba7f8b728f6b4ae65e08763a00e8ad", "message": "Fix modified time -1", "committedDate": "2020-02-24T16:14:42Z", "type": "commit"}, {"oid": "0675e262b3ee4a89f9a12f94c44a96cad4f04d7e", "url": "https://github.com/osmandapp/OsmAnd/commit/0675e262b3ee4a89f9a12f94c44a96cad4f04d7e", "message": "Merge branch 'master' into Fix_7763_gpx_track_selection", "committedDate": "2020-03-02T10:38:36Z", "type": "commit"}]}