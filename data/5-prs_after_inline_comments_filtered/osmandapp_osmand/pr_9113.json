{"pr_number": 9113, "pr_title": "Change Wikipedia poi behaviour", "pr_createdAt": "2020-06-01T10:00:57Z", "pr_url": "https://github.com/osmandapp/OsmAnd/pull/9113", "timeline": [{"oid": "05eb4d701c76e17e11c2539768999dcf3529c25e", "url": "https://github.com/osmandapp/OsmAnd/commit/05eb4d701c76e17e11c2539768999dcf3529c25e", "message": "Change Wikipedia poi behaviour", "committedDate": "2020-06-01T10:00:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzE4Nzk2OQ==", "url": "https://github.com/osmandapp/OsmAnd/pull/9113#discussion_r433187969", "bodyText": "?", "author": "vshcherb", "createdAt": "2020-06-01T11:45:26Z", "path": "OsmAnd/src/net/osmand/plus/poi/PoiFiltersHelper.java", "diffHunk": "@@ -55,10 +55,10 @@\n \tprivate PoiUIFilter customPOIFilter;\n \tprivate PoiUIFilter showAllPOIFilter;\n \tprivate PoiUIFilter localWikiPoiFilter;\n-\tprivate PoiUIFilter globalWikiPoiFilter;\n+\tprivate PoiUIFilter topWikiPoiFilter;\n \tprivate List<PoiUIFilter> cacheTopStandardFilters;\n-\tprivate List<PoiUIFilter> cacheWikipediaFilters;\n-\tprivate Map<PoiTemplateList, Set<PoiUIFilter>> selectedPoiFilters = new TreeMap<>();\n+\tprivate Set<PoiUIFilter> selectedPoiFilters = new TreeSet<>();\n+\tprivate boolean updatePoiFiltersOnMap;", "originalCommit": "05eb4d701c76e17e11c2539768999dcf3529c25e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzE4ODM5OA==", "url": "https://github.com/osmandapp/OsmAnd/pull/9113#discussion_r433188398", "bodyText": "is this correct method?", "author": "vshcherb", "createdAt": "2020-06-01T11:46:26Z", "path": "OsmAnd/src/net/osmand/plus/poi/PoiFiltersHelper.java", "diffHunk": "@@ -139,56 +135,42 @@ public PoiUIFilter getLocalWikiPOIFilter() {\n \t\treturn localWikiPoiFilter;\n \t}\n \n-\tpublic PoiUIFilter getGlobalWikiPoiFilter() {\n-\t\tif (globalWikiPoiFilter == null) {\n-\t\t\tString wikiFilterId = PoiUIFilter.STD_PREFIX + \"osmwiki\";\n-\t\t\tfor (PoiUIFilter filter : getTopDefinedPoiFilters()) {\n-\t\t\t\tif (wikiFilterId.equals(filter.getFilterId())) {\n-\t\t\t\t\tglobalWikiPoiFilter = filter;\n-\t\t\t\t\tbreak;\n+\tpublic void prepareTopWikiFilter(@NonNull PoiUIFilter wiki) {\n+\t\tboolean prepareByDefault = true;\n+\t\tBundle wikiSettings = WikipediaPoiMenu.getWikiPoiSettings(application);\n+\t\tif (wikiSettings != null) {\n+\t\t\tboolean allLanguages = wikiSettings.getBoolean(GLOBAL_WIKI_POI_ENABLED_KEY);\n+\t\t\tList<String> languages = wikiSettings\n+\t\t\t\t\t.getStringArrayList(ENABLED_WIKI_POI_LANGUAGES_KEY);\n+\t\t\tif (!allLanguages && languages != null) {\n+\t\t\t\tprepareByDefault = false;\n+\t\t\t\tString wikiLang = \"wiki:lang:\";\n+\t\t\t\tStringBuilder sb = new StringBuilder();\n+\t\t\t\tfor (String lang : languages) {\n+\t\t\t\t\tif (sb.length() > 1) {\n+\t\t\t\t\t\tsb.append(\" \");\n+\t\t\t\t\t}\n+\t\t\t\t\tsb.append(wikiLang).append(lang);\n \t\t\t\t}\n+\t\t\t\twiki.setFilterByName(sb.toString());", "originalCommit": "05eb4d701c76e17e11c2539768999dcf3529c25e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "c1228dc82f37fec75298085cb39842240dde438d", "url": "https://github.com/osmandapp/OsmAnd/commit/c1228dc82f37fec75298085cb39842240dde438d", "message": "wikipedia poi fixes", "committedDate": "2020-06-01T14:25:22Z", "type": "commit"}, {"oid": "74a41eb5251dfb4c956af316277aeaacc53956d6", "url": "https://github.com/osmandapp/OsmAnd/commit/74a41eb5251dfb4c956af316277aeaacc53956d6", "message": "small fixes", "committedDate": "2020-06-01T14:32:29Z", "type": "commit"}]}