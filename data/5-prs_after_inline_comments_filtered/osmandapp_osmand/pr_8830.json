{"pr_number": 8830, "pr_title": "Discount badge", "pr_createdAt": "2020-04-22T19:10:31Z", "pr_url": "https://github.com/osmandapp/OsmAnd/pull/8830", "timeline": [{"oid": "c66d5601e9d7c92e604941c647062695f445616d", "url": "https://github.com/osmandapp/OsmAnd/commit/c66d5601e9d7c92e604941c647062695f445616d", "message": "Discount badge on Choose plan", "committedDate": "2020-04-22T19:04:00Z", "type": "commit"}, {"oid": "3d731717c40b0175d44cac515b1756b01e5ea258", "url": "https://github.com/osmandapp/OsmAnd/commit/3d731717c40b0175d44cac515b1756b01e5ea258", "message": "Merge branch 'master' into Discount_badge\n\n# Conflicts:\n#\tOsmAnd/res/values/strings.xml", "committedDate": "2020-04-22T19:08:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzU3Mjk4NA==", "url": "https://github.com/osmandapp/OsmAnd/pull/8830#discussion_r413572984", "bodyText": "Remove getSubscriptionWithMaxDiscount. First - it is wrong since it iterates through all and not visible. Second - it is redundant, use for loop above.", "author": "max-klaus", "createdAt": "2020-04-23T07:22:17Z", "path": "OsmAnd/src/net/osmand/plus/chooseplan/ChoosePlanDialogFragment.java", "diffHunk": "@@ -352,18 +355,21 @@ private void setupOsmLiveCardButtons(boolean progress) {\n \t\t\tosmLiveCardButtonsContainer.removeAllViews();\n \t\t\tView lastBtn = null;\n \t\t\tList<InAppSubscription> visibleSubscriptions = purchaseHelper.getLiveUpdates().getVisibleSubscriptions();\n-\t\t\tboolean anyPurchasedOrIntroducted = false;\n+\t\t\tboolean anyPurchased = false;\n \t\t\tfor (final InAppSubscription s : visibleSubscriptions) {\n-\t\t\t\tif (s.isPurchased() || s.getIntroductoryInfo() != null) {\n-\t\t\t\t\tanyPurchasedOrIntroducted = true;\n+\t\t\t\tif (s.isPurchased()) {\n+\t\t\t\t\tanyPurchased = true;\n \t\t\t\t\tbreak;\n \t\t\t\t}\n \t\t\t}\n+\t\t\tInAppSubscription subscriptionMaxDiscount = purchaseHelper.getLiveUpdates()\n+\t\t\t\t\t.getSubscriptionWithMaxDiscount(purchaseHelper.getMonthlyLiveUpdates());", "originalCommit": "3d731717c40b0175d44cac515b1756b01e5ea258", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e7430dcd5b0f9a18db9537b2c492f5b002d9881b", "url": "https://github.com/osmandapp/OsmAnd/commit/e7430dcd5b0f9a18db9537b2c492f5b002d9881b", "message": "Fix strings, refactor", "committedDate": "2020-04-23T08:46:58Z", "type": "commit"}, {"oid": "dd6c7c07e0269e6f5aa51c351ed96d8edb99e6fd", "url": "https://github.com/osmandapp/OsmAnd/commit/dd6c7c07e0269e6f5aa51c351ed96d8edb99e6fd", "message": "Refactor", "committedDate": "2020-04-24T13:07:42Z", "type": "commit"}, {"oid": "bda66990abaa9685ae7e11c2d325b0b9171c7626", "url": "https://github.com/osmandapp/OsmAnd/commit/bda66990abaa9685ae7e11c2d325b0b9171c7626", "message": "Fix maxDiscountSubscription calculation", "committedDate": "2020-04-27T09:44:00Z", "type": "commit"}, {"oid": "943cea21390c8890062f065b3413de72cc5e1cf2", "url": "https://github.com/osmandapp/OsmAnd/commit/943cea21390c8890062f065b3413de72cc5e1cf2", "message": "Refactor", "committedDate": "2020-04-27T15:41:40Z", "type": "commit"}]}