{"pr_number": 8283, "pr_title": "Fix parking issue. Show Home Work Parking icon on map.", "pr_createdAt": "2020-01-21T13:47:51Z", "pr_url": "https://github.com/osmandapp/OsmAnd/pull/8283", "timeline": [{"oid": "f55e4f7c0052ddd7a0d02306ca33f5d3e179f577", "url": "https://github.com/osmandapp/OsmAnd/commit/f55e4f7c0052ddd7a0d02306ca33f5d3e179f577", "message": "Fix parking issue. Show Home Work Parking icon on map. Disable ParkingPositionPlugin layer", "committedDate": "2020-01-21T13:46:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTAxOTc0NQ==", "url": "https://github.com/osmandapp/OsmAnd/pull/8283#discussion_r369019745", "bodyText": "??? delete", "author": "vshcherb", "createdAt": "2020-01-21T14:07:28Z", "path": "OsmAnd/src/net/osmand/plus/parkingpoint/ParkingPositionPlugin.java", "diffHunk": "@@ -193,7 +192,7 @@ public void registerLayers(MapActivity activity) {\n \t\t\tactivity.getMapView().removeLayer(parkingLayer);\n \t\t}\n \t\tparkingLayer = new ParkingPositionLayer(activity, this);\n-\t\tactivity.getMapView().addLayer(parkingLayer, 5.5f);\n+//\t\tactivity.getMapView().addLayer(parkingLayer, 5.5f);", "originalCommit": "f55e4f7c0052ddd7a0d02306ca33f5d3e179f577", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTAxOTgyNw==", "url": "https://github.com/osmandapp/OsmAnd/pull/8283#discussion_r369019827", "bodyText": "ParkingPositionLayer - delete", "author": "vshcherb", "createdAt": "2020-01-21T14:07:37Z", "path": "OsmAnd/src/net/osmand/plus/parkingpoint/ParkingPositionPlugin.java", "diffHunk": "@@ -193,7 +192,7 @@ public void registerLayers(MapActivity activity) {\n \t\t\tactivity.getMapView().removeLayer(parkingLayer);\n \t\t}\n \t\tparkingLayer = new ParkingPositionLayer(activity, this);", "originalCommit": "f55e4f7c0052ddd7a0d02306ca33f5d3e179f577", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "32783e61cd106d4511f0c88890af95abd35a8ca1", "url": "https://github.com/osmandapp/OsmAnd/commit/32783e61cd106d4511f0c88890af95abd35a8ca1", "message": "Delete ParkingPositionLayer", "committedDate": "2020-01-21T15:51:45Z", "type": "commit"}, {"oid": "210515c2fd034f6c3991e6ef61d1557c5472413e", "url": "https://github.com/osmandapp/OsmAnd/commit/210515c2fd034f6c3991e6ef61d1557c5472413e", "message": "Add writing icon name to file", "committedDate": "2020-01-22T11:46:59Z", "type": "commit"}, {"oid": "2737e95ce712148e2fa9663e950ff6d783d9c7d7", "url": "https://github.com/osmandapp/OsmAnd/commit/2737e95ce712148e2fa9663e950ff6d783d9c7d7", "message": "Merge branch 'master' into home_icon_on_map", "committedDate": "2020-01-22T12:06:12Z", "type": "commit"}, {"oid": "2b1bfa9ce3ab2e5fbd1163dad169542d079a1dcd", "url": "https://github.com/osmandapp/OsmAnd/commit/2b1bfa9ce3ab2e5fbd1163dad169542d079a1dcd", "message": "Implement different icons on the map and on the ui", "committedDate": "2020-01-22T15:32:44Z", "type": "commit"}, {"oid": "e6e841f61901e57a9f87c11549b02284c217a0f1", "url": "https://github.com/osmandapp/OsmAnd/commit/e6e841f61901e57a9f87c11549b02284c217a0f1", "message": "Fix getColor api 16", "committedDate": "2020-01-22T15:53:15Z", "type": "commit"}, {"oid": "4f39004c5e589621086959ed6067a87637182996", "url": "https://github.com/osmandapp/OsmAnd/commit/4f39004c5e589621086959ed6067a87637182996", "message": "GPXLayer custom icon", "committedDate": "2020-01-23T12:08:18Z", "type": "commit"}, {"oid": "e974d7ca72fdbed62eef645292321c17824d172a", "url": "https://github.com/osmandapp/OsmAnd/commit/e974d7ca72fdbed62eef645292321c17824d172a", "message": "Fix favorite import", "committedDate": "2020-01-23T13:13:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDEzMzY2NA==", "url": "https://github.com/osmandapp/OsmAnd/pull/8283#discussion_r370133664", "bodyText": "should be cut", "author": "vshcherb", "createdAt": "2020-01-23T14:02:19Z", "path": "OsmAnd/src/net/osmand/plus/base/FavoriteImageDrawable.java", "diffHunk": "@@ -42,31 +41,39 @@\n \tprivate Paint paintInnerCircle = new Paint();\n \tprivate ColorFilter colorFilter;\n \tprivate ColorFilter grayFilter;\n-\tprivate Drawable personalPointBitmap;\n \n \tprivate FavoriteImageDrawable(Context ctx, int color, boolean withShadow, boolean synced, FavouritePoint point) {\n \t\tthis.withShadow = withShadow;\n \t\tthis.synced = synced;\n \t\tResources res = ctx.getResources();\n \t\tint overlayIconId = point != null ? point.getOverlayIconId() : 0;\n \t\tif (overlayIconId != 0) {\n-\t\t\tpersonalPointBitmap = UiUtilities.tintDrawable(ResourcesCompat.getDrawable(res, overlayIconId, null),\n-\t\t\t\t\tContextCompat.getColor(ctx, R.color.icon_color_default_light));\n+\t\t\tfavIcon = ((OsmandApplication) ctx.getApplicationContext()).getUIUtilities()\n+\t\t\t\t\t.getIcon(getMapIconId(ctx, overlayIconId), R.color.color_white);\n+\t\t\tlistDrawable = ((OsmandApplication) ctx.getApplicationContext()).getUIUtilities()\n+\t\t\t\t\t.getIcon(overlayIconId, R.color.color_white);\n+\t\t} else {\n+\t\t\tfavIcon = res.getDrawable(R.drawable.map_favorite);\n+\t\t\tlistDrawable = ResourcesCompat.getDrawable(res, R.drawable.ic_action_fav_dark, null).mutate();\n \t\t}\n \t\tint col = color == 0 || color == Color.BLACK ? res.getColor(R.color.color_favorite) : color;\n-\t\tfavIcon = BitmapFactory.decodeResource(res, R.drawable.map_favorite);\n \t\tfavBackground = BitmapFactory.decodeResource(res, R.drawable.map_white_favorite_shield);\n \t\tsyncedStroke = BitmapFactory.decodeResource(res, R.drawable.map_shield_marker_point_stroke);\n \t\tsyncedColor = BitmapFactory.decodeResource(res, R.drawable.map_shield_marker_point_color);\n \t\tsyncedShadow = BitmapFactory.decodeResource(res, R.drawable.map_shield_marker_point_shadow);\n \t\tsyncedIcon = BitmapFactory.decodeResource(res, R.drawable.map_marker_point_14dp);\n-\t\tlistDrawable = ResourcesCompat.getDrawable(res, R.drawable.ic_action_fav_dark, null).mutate();\n \t\tinitSimplePaint(paintOuter, color == 0 || color == Color.BLACK ? 0x88555555 : color);\n \t\tinitSimplePaint(paintInnerCircle, col);\n \t\tcolorFilter = new PorterDuffColorFilter(col, PorterDuff.Mode.MULTIPLY);\n \t\tgrayFilter = new PorterDuffColorFilter(res.getColor(R.color.color_favorite_gray), PorterDuff.Mode.MULTIPLY);\n \t}\n \n+\tprivate int getMapIconId(Context ctx, int iconId) {\n+\t\tString iconName = ctx.getResources().getResourceEntryName(iconId);\n+\t\treturn ctx.getResources().getIdentifier(iconName\n+\t\t\t\t.replaceFirst(\"mx_\", \"mm_\"), \"drawable\", ctx.getPackageName());", "originalCommit": "e974d7ca72fdbed62eef645292321c17824d172a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "db080a9447f6f8088c2a4ab6add5d94d53c48f8d", "url": "https://github.com/osmandapp/OsmAnd/commit/db080a9447f6f8088c2a4ab6add5d94d53c48f8d", "message": "Fix icon name without prefix", "committedDate": "2020-01-23T15:24:17Z", "type": "commit"}]}