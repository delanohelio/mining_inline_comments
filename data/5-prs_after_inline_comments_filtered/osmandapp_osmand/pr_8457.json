{"pr_number": 8457, "pr_title": "Straight Line remake", "pr_createdAt": "2020-02-13T14:45:59Z", "pr_url": "https://github.com/osmandapp/OsmAnd/pull/8457", "timeline": [{"oid": "a9915e7e82242ffb8d93071773ffa560805ab18f", "url": "https://github.com/osmandapp/OsmAnd/commit/a9915e7e82242ffb8d93071773ffa560805ab18f", "message": "Direct to: show projection point only on certain distance from location marker.\nDirect to: prevent route recalculations.", "committedDate": "2020-02-12T14:44:02Z", "type": "commit"}, {"oid": "989f118fb6d4590c3fb10bd1da74ff087bb8f434", "url": "https://github.com/osmandapp/OsmAnd/commit/989f118fb6d4590c3fb10bd1da74ff087bb8f434", "message": "add setting for min recaclulation distance for Straight line routing", "committedDate": "2020-02-12T19:43:20Z", "type": "commit"}, {"oid": "6069ee0a38d1d81a6abe3e2201030a388196dea8", "url": "https://github.com/osmandapp/OsmAnd/commit/6069ee0a38d1d81a6abe3e2201030a388196dea8", "message": "Merge branch 'master' into straight_to", "committedDate": "2020-02-12T20:05:04Z", "type": "commit"}, {"oid": "38e935fb96f49d2cdd5ee65b5d20c95c36c054fd", "url": "https://github.com/osmandapp/OsmAnd/commit/38e935fb96f49d2cdd5ee65b5d20c95c36c054fd", "message": "fix settings formatting\ncalculate pointToReturn on track.", "committedDate": "2020-02-13T14:37:13Z", "type": "commit"}, {"oid": "f3424e0c3f3a6dd7efad624097af5af068fb61c2", "url": "https://github.com/osmandapp/OsmAnd/commit/f3424e0c3f3a6dd7efad624097af5af068fb61c2", "message": "Merge branch 'master' into straight_to", "committedDate": "2020-02-13T14:41:24Z", "type": "commit"}, {"oid": "a9b9bceea40e8d36125d3d11f5ae6d62e75ca382", "url": "https://github.com/osmandapp/OsmAnd/commit/a9b9bceea40e8d36125d3d11f5ae6d62e75ca382", "message": "add icon to settings", "committedDate": "2020-02-13T14:41:40Z", "type": "commit"}, {"oid": "597a3518fe58fcd9c9f6b091be088b79175380e8", "url": "https://github.com/osmandapp/OsmAnd/commit/597a3518fe58fcd9c9f6b091be088b79175380e8", "message": "Merge branch 'master' into straight_to\n\n# Conflicts:\n#\tOsmAnd/res/values/strings.xml", "committedDate": "2020-02-13T14:47:43Z", "type": "commit"}, {"oid": "640fb6af3d1dfdfb90669dd061c121a2094ed88a", "url": "https://github.com/osmandapp/OsmAnd/commit/640fb6af3d1dfdfb90669dd061c121a2094ed88a", "message": "fix values for miles/feets", "committedDate": "2020-02-13T15:07:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODkyODkxOA==", "url": "https://github.com/osmandapp/OsmAnd/pull/8457#discussion_r378928918", "bodyText": "Point of return to route calculated and passed to routeGeometry.drawSegments", "author": "MadWasp79", "createdAt": "2020-02-13T15:22:56Z", "path": "OsmAnd/src/net/osmand/plus/views/RouteLayer.java", "diffHunk": "@@ -1098,18 +1101,40 @@ public void drawLocations(RotatedTileBox tb, Canvas canvas, double topLatitude,\n \t\t\t\tLocation startLocation = new Location(\"transport\");\n \t\t\t\tstartLocation.setLatitude(start.getLatitude());\n \t\t\t\tstartLocation.setLongitude(start.getLongitude());\n-\t\t\t\trouteGeometry.drawSegments(tb, canvas, topLatitude, leftLongitude, bottomLatitude, rightLongitude, startLocation, 0, false);\n+\t\t\t\trouteGeometry.drawSegments(tb, canvas, topLatitude, leftLongitude, bottomLatitude, rightLongitude,\n+\t\t\t\t\t\tstartLocation, 0, false, null);\n \t\t\t}\n \t\t} else {\n \t\t\tRouteCalculationResult route = helper.getRoute();\n \t\t\trouteGeometry.clearTransportRoute();\n \t\t\trouteGeometry.updateRoute(tb, route);\n \t\t\tif (helper.getRoute().isShowOriginalRoute() && helper.getOriginalStartingLocation() != null) {\n \t\t\t\trouteGeometry.drawSegments(tb, canvas, topLatitude, leftLongitude, bottomLatitude, rightLongitude,\n-\t\t\t\t\t\thelper.getOriginalStartingLocation(),  0, true);\n+\t\t\t\t\t\thelper.getOriginalStartingLocation(),  0, true, null);\n \t\t\t} else {\n+\t\t\t\tLocation currentLoc = helper.getLastProjection();\n+\t\t\t\tint currentRoute = route == null ? 0 : route.getCurrentRoute();\n+\t\t\t\tLocation pointToReturn = null;\n+\t\t\t\tif (route != null && currentRoute > 0 && route.getRouteRecalcDistance() > 0) {\n+\t\t\t\t\tfinal Location from = routeGeometry.locations.get(currentRoute - 1);\n+\t\t\t\t\tfinal Location to = routeGeometry.locations.get(currentRoute);\n+\t\t\t\t\tfinal LatLon projection = MapUtils.getProjection(currentLoc.getLatitude(),\n+\t\t\t\t\t\t\tcurrentLoc.getLongitude(), from.getLatitude(), from.getLongitude(),\n+\t\t\t\t\t\t\tto.getLatitude(), to.getLongitude());\n+\n+\t\t\t\t\tfinal double deviation = MapUtils.getDistance(projection.getLatitude(), projection.getLongitude(), currentLoc.getLatitude(), currentLoc.getLongitude());\n+\t\t\t\t\tif (deviation < route.getRouteRecalcDistance()) {\n+\t\t\t\t\t\tdouble distFromProjectionToEnd = Math.sqrt(Math.pow(to.getLatitude() - projection.getLatitude(), 2) + Math.pow(to.getLongitude() - projection.getLongitude(), 2));\n+\t\t\t\t\t\tdouble coef = deviation / distFromProjectionToEnd;\n+\t\t\t\t\t\tpointToReturn = new Location(\"route_layer\");\n+\t\t\t\t\t\tpointToReturn.setLatitude(projection.getLatitude() + (to.getLatitude() - projection.getLatitude()) * coef);\n+\t\t\t\t\t\tpointToReturn.setLongitude(projection.getLongitude() + (to.getLongitude() - projection.getLatitude()) * coef);\n+\t\t\t\t\t\t//how to draw line to this point from lastProjection?!", "originalCommit": "640fb6af3d1dfdfb90669dd061c121a2094ed88a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "d0d44e8ed46f829f7acd5d6d3fd3cac7e8af0a26", "url": "https://github.com/osmandapp/OsmAnd/commit/d0d44e8ed46f829f7acd5d6d3fd3cac7e8af0a26", "message": "Merge branch 'master' into straight_to", "committedDate": "2020-02-13T16:10:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODk2MjI1OQ==", "url": "https://github.com/osmandapp/OsmAnd/pull/8457#discussion_r378962259", "bodyText": "formatting?", "author": "vshcherb", "createdAt": "2020-02-13T16:12:31Z", "path": "OsmAnd/src/net/osmand/plus/routing/RouteCalculationResult.java", "diffHunk": "@@ -113,6 +114,9 @@ public RouteCalculationResult(List<Location> list, List<RouteDirectionInfo> dire\n \t\tupdateDirectionsTime(this.directions, this.listDistance);\n \n \t\tthis.showOriginalRoute = params.showOriginalRoute;\n+\t\tthis.noRecalculations = params.noRecalculations;\n+\t\tif (params.routeRecalculationDistance != 0)", "originalCommit": "d0d44e8ed46f829f7acd5d6d3fd3cac7e8af0a26", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1578f4c91c98db7d6992940972a494c9d435df5e", "url": "https://github.com/osmandapp/OsmAnd/commit/1578f4c91c98db7d6992940972a494c9d435df5e", "message": "settings change", "committedDate": "2020-02-14T09:16:06Z", "type": "commit"}, {"oid": "6844c2594573f8b2d28d4563848910c75f1561dd", "url": "https://github.com/osmandapp/OsmAnd/commit/6844c2594573f8b2d28d4563848910c75f1561dd", "message": "Merge branch 'master' into straight_to\n\n# Conflicts:\n#\tOsmAnd/res/values/strings.xml", "committedDate": "2020-02-14T09:19:44Z", "type": "commit"}, {"oid": "ed22ba35890d6928e37b6e2c9bb972a4e47a9aad", "url": "https://github.com/osmandapp/OsmAnd/commit/ed22ba35890d6928e37b6e2c9bb972a4e47a9aad", "message": "Merge remote-tracking branch 'origin/straight_to' into straight_to", "committedDate": "2020-02-14T09:20:17Z", "type": "commit"}, {"oid": "a577b25b867aa4ceba13bf9f9f458a900678f5d7", "url": "https://github.com/osmandapp/OsmAnd/commit/a577b25b867aa4ceba13bf9f9f458a900678f5d7", "message": "fix settings", "committedDate": "2020-02-14T15:52:35Z", "type": "commit"}, {"oid": "a3dc78c8cdb5927459253bc600ab367c71e55775", "url": "https://github.com/osmandapp/OsmAnd/commit/a3dc78c8cdb5927459253bc600ab367c71e55775", "message": "Merge branch 'master' into straight_to", "committedDate": "2020-02-14T15:54:04Z", "type": "commit"}, {"oid": "116673f0817d3d621ac31a937e0a209764cc0104", "url": "https://github.com/osmandapp/OsmAnd/commit/116673f0817d3d621ac31a937e0a209764cc0104", "message": "Fix settings", "committedDate": "2020-02-14T17:03:35Z", "type": "commit"}, {"oid": "29b03fd0eab4a822627c4dd6a454ede82f8aba29", "url": "https://github.com/osmandapp/OsmAnd/commit/29b03fd0eab4a822627c4dd6a454ede82f8aba29", "message": "Fix settigns for straight to", "committedDate": "2020-02-14T17:07:27Z", "type": "commit"}, {"oid": "dff8dfa82c06ec40dc7587db7bf74cfb43129074", "url": "https://github.com/osmandapp/OsmAnd/commit/dff8dfa82c06ec40dc7587db7bf74cfb43129074", "message": "Fix setting", "committedDate": "2020-02-14T17:10:45Z", "type": "commit"}, {"oid": "1c0890d5a11ef5a9527ec38c568c11e2ce0dbf82", "url": "https://github.com/osmandapp/OsmAnd/commit/1c0890d5a11ef5a9527ec38c568c11e2ce0dbf82", "message": "Merge branch 'master' into straight_to", "committedDate": "2020-02-17T10:41:16Z", "type": "commit"}, {"oid": "cd5d2ad16e8dde4171dce9f30bd7967d0a5b4190", "url": "https://github.com/osmandapp/OsmAnd/commit/cd5d2ad16e8dde4171dce9f30bd7967d0a5b4190", "message": "work in progress - routing", "committedDate": "2020-02-17T12:17:43Z", "type": "commit"}, {"oid": "3629ee40a2eead9c6815dadcfc99d0d260e3afc0", "url": "https://github.com/osmandapp/OsmAnd/commit/3629ee40a2eead9c6815dadcfc99d0d260e3afc0", "message": "work in progress - straight line with 'back to route' segment", "committedDate": "2020-02-17T15:09:17Z", "type": "commit"}, {"oid": "1c7c25471882e420056eb6d8002d712354ce21c7", "url": "https://github.com/osmandapp/OsmAnd/commit/1c7c25471882e420056eb6d8002d712354ce21c7", "message": "Fix routing helper to support points", "committedDate": "2020-02-17T16:06:04Z", "type": "commit"}, {"oid": "9cfdceb8501d0a0c5e5b5fbf952a6b4eb81ee513", "url": "https://github.com/osmandapp/OsmAnd/commit/9cfdceb8501d0a0c5e5b5fbf952a6b4eb81ee513", "message": "Fix straight line routing", "committedDate": "2020-02-17T16:17:33Z", "type": "commit"}, {"oid": "d352b5fa9aa6584e7ead8dc63ee9c804a4c31475", "url": "https://github.com/osmandapp/OsmAnd/commit/d352b5fa9aa6584e7ead8dc63ee9c804a4c31475", "message": "Fix straight line routing", "committedDate": "2020-02-17T16:26:29Z", "type": "commit"}, {"oid": "1d5a344fb10dfef96d473740330ef4ba41005886", "url": "https://github.com/osmandapp/OsmAnd/commit/1d5a344fb10dfef96d473740330ef4ba41005886", "message": "Fix RP", "committedDate": "2020-02-17T16:36:09Z", "type": "commit"}, {"oid": "298893ae1794ba01f80570559d0404678b0f1848", "url": "https://github.com/osmandapp/OsmAnd/commit/298893ae1794ba01f80570559d0404678b0f1848", "message": "Fix RP", "committedDate": "2020-02-17T16:36:55Z", "type": "commit"}, {"oid": "c419845b0c21ee5a6b00daeacaf6abaa202f717c", "url": "https://github.com/osmandapp/OsmAnd/commit/c419845b0c21ee5a6b00daeacaf6abaa202f717c", "message": "Clean up", "committedDate": "2020-02-17T17:06:38Z", "type": "commit"}, {"oid": "49f901998d39aec34b54f4a971100a16a98e2e82", "url": "https://github.com/osmandapp/OsmAnd/commit/49f901998d39aec34b54f4a971100a16a98e2e82", "message": "Clean up", "committedDate": "2020-02-17T17:22:30Z", "type": "commit"}, {"oid": "a09181fa12a6d896120d5ab8e3eddc927d9620b1", "url": "https://github.com/osmandapp/OsmAnd/commit/a09181fa12a6d896120d5ab8e3eddc927d9620b1", "message": "Clean up", "committedDate": "2020-02-17T17:24:13Z", "type": "commit"}, {"oid": "78a3c51696a42f2798a90068ff3c32c336362378", "url": "https://github.com/osmandapp/OsmAnd/commit/78a3c51696a42f2798a90068ff3c32c336362378", "message": "Clean up", "committedDate": "2020-02-17T17:25:29Z", "type": "commit"}, {"oid": "efeab50c6c473bcb39aabb94213a0e2f3ca748c3", "url": "https://github.com/osmandapp/OsmAnd/commit/efeab50c6c473bcb39aabb94213a0e2f3ca748c3", "message": "Clean up", "committedDate": "2020-02-17T17:27:39Z", "type": "commit"}, {"oid": "588c96ba514f7805cd620fd06ae9a627ee8e7a56", "url": "https://github.com/osmandapp/OsmAnd/commit/588c96ba514f7805cd620fd06ae9a627ee8e7a56", "message": "Fix npe", "committedDate": "2020-02-17T17:33:37Z", "type": "commit"}, {"oid": "13b3f16bca94b3ffb5734fe9cfed64b07e57022f", "url": "https://github.com/osmandapp/OsmAnd/commit/13b3f16bca94b3ffb5734fe9cfed64b07e57022f", "message": "Fix infinite loop", "committedDate": "2020-02-17T17:49:12Z", "type": "commit"}, {"oid": "3af2136673c1809ceaf190cd42d1f6c54e413d41", "url": "https://github.com/osmandapp/OsmAnd/commit/3af2136673c1809ceaf190cd42d1f6c54e413d41", "message": "Fix infinite loop", "committedDate": "2020-02-17T17:52:59Z", "type": "commit"}, {"oid": "f0b3062ab8413619ba429a8750469b0d42ea692a", "url": "https://github.com/osmandapp/OsmAnd/commit/f0b3062ab8413619ba429a8750469b0d42ea692a", "message": "Fix issues", "committedDate": "2020-02-17T18:42:10Z", "type": "commit"}, {"oid": "b1ab80663279ff48baaa6d22645f67cddc3520b2", "url": "https://github.com/osmandapp/OsmAnd/commit/b1ab80663279ff48baaa6d22645f67cddc3520b2", "message": "Fix straight_to", "committedDate": "2020-02-17T19:07:52Z", "type": "commit"}]}