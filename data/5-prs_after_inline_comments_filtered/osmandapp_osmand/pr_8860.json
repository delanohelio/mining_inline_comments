{"pr_number": 8860, "pr_title": "Configure menu items fix", "pr_createdAt": "2020-04-29T12:40:56Z", "pr_url": "https://github.com/osmandapp/OsmAnd/pull/8860", "timeline": [{"oid": "892d3e78c6adccd3aaeab6f8d589a2a984368723", "url": "https://github.com/osmandapp/OsmAnd/commit/892d3e78c6adccd3aaeab6f8d589a2a984368723", "message": "support for profile theme", "committedDate": "2020-04-24T09:11:57Z", "type": "commit"}, {"oid": "4fb1c7a07747f6a76b26f3169b5e3af0ecb71838", "url": "https://github.com/osmandapp/OsmAnd/commit/4fb1c7a07747f6a76b26f3169b5e3af0ecb71838", "message": "Configure map/Map rendering sortByOrder", "committedDate": "2020-04-24T09:34:07Z", "type": "commit"}, {"oid": "3c0bd48945a545d7a510290b2d0a20c3f7a1908a", "url": "https://github.com/osmandapp/OsmAnd/commit/3c0bd48945a545d7a510290b2d0a20c3f7a1908a", "message": "ui fixes", "committedDate": "2020-04-24T11:33:06Z", "type": "commit"}, {"oid": "602670fd28f4f8ad96a025e0354cf8a8c43abeb4", "url": "https://github.com/osmandapp/OsmAnd/commit/602670fd28f4f8ad96a025e0354cf8a8c43abeb4", "message": "Merge remote-tracking branch 'origin/master' into configure_menu_items_fix", "committedDate": "2020-04-27T10:45:53Z", "type": "commit"}, {"oid": "1736b3c789c064e417f59316dc55a602e7067a86", "url": "https://github.com/osmandapp/OsmAnd/commit/1736b3c789c064e417f59316dc55a602e7067a86", "message": "context menu actions fixes / tracker item fix / ui fixes", "committedDate": "2020-04-29T12:22:47Z", "type": "commit"}, {"oid": "4e7abcb41fd46efd78b58d7a8806b417bf0e37be", "url": "https://github.com/osmandapp/OsmAnd/commit/4e7abcb41fd46efd78b58d7a8806b417bf0e37be", "message": "fix instantiateContextMenuAdapter() NPE after screen rotating", "committedDate": "2020-04-29T12:39:39Z", "type": "commit"}, {"oid": "de063c68aec6a2829cf06fd95e45f6d1f554e6e6", "url": "https://github.com/osmandapp/OsmAnd/commit/de063c68aec6a2829cf06fd95e45f6d1f554e6e6", "message": "refactor", "committedDate": "2020-04-30T12:28:44Z", "type": "commit"}, {"oid": "a8c05348b857f1a8bda2dd03b6bfd5a2f66a8f6c", "url": "https://github.com/osmandapp/OsmAnd/commit/a8c05348b857f1a8bda2dd03b6bfd5a2f66a8f6c", "message": "reset dialog", "committedDate": "2020-04-30T12:35:46Z", "type": "commit"}, {"oid": "d1a19429077a0bb11471faec296ae99c26b25f74", "url": "https://github.com/osmandapp/OsmAnd/commit/d1a19429077a0bb11471faec296ae99c26b25f74", "message": "use one string for \"Actions\"", "committedDate": "2020-04-30T13:24:43Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTA4MzIxNg==", "url": "https://github.com/osmandapp/OsmAnd/pull/8860#discussion_r419083216", "bodyText": "Bad code. Remove try - catch.", "author": "max-klaus", "createdAt": "2020-05-03T10:34:32Z", "path": "OsmAnd/src/net/osmand/plus/ContextMenuAdapter.java", "diffHunk": "@@ -91,10 +92,10 @@ public void addItem(ContextMenuItem item) {\n \t\t\t\titem.setOrder(getItemOrder(id, item.getOrder()));\n \t\t\t}\n \t\t\titems.add(item.getPos(), item);\n-\t\t\tsortItemsByOrder();\n \t\t} catch (IndexOutOfBoundsException ex) {", "originalCommit": "d1a19429077a0bb11471faec296ae99c26b25f74", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTA4MzU1Mg==", "url": "https://github.com/osmandapp/OsmAnd/pull/8860#discussion_r419083552", "bodyText": "Make sortItemsByOrder private and remove it from all other places. It must be called from addItem only!", "author": "max-klaus", "createdAt": "2020-05-03T10:37:29Z", "path": "OsmAnd/src/net/osmand/plus/dialogs/ConfigureMapMenu.java", "diffHunk": "@@ -911,6 +911,7 @@ public void onClick(DialogInterface dialog, int which) {\n \t\t\t\t\t.setCategory(true).setLayout(R.layout.list_group_title_with_switch).createItem());\n \t\t\tcreateCustomRenderingProperties(adapter, activity, customRules, app, selectedProfileColor, nightMode, themeRes);\n \t\t}\n+\t\tadapter.sortItemsByOrder();", "originalCommit": "d1a19429077a0bb11471faec296ae99c26b25f74", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTA4MzYyNw==", "url": "https://github.com/osmandapp/OsmAnd/pull/8860#discussion_r419083627", "bodyText": "Do not commit TODO", "author": "max-klaus", "createdAt": "2020-05-03T10:38:18Z", "path": "OsmAnd/src/net/osmand/plus/mapcontextmenu/MapContextMenuFragment.java", "diffHunk": "@@ -568,18 +568,30 @@ public void onClick(View v) {\n //\t\tTODO refactor section", "originalCommit": "d1a19429077a0bb11471faec296ae99c26b25f74", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTA4MzY5OA==", "url": "https://github.com/osmandapp/OsmAnd/pull/8860#discussion_r419083698", "bodyText": "Wrong", "author": "max-klaus", "createdAt": "2020-05-03T10:38:40Z", "path": "OsmAnd/src/net/osmand/plus/mapcontextmenu/MapContextMenuFragment.java", "diffHunk": "@@ -568,18 +568,30 @@ public void onClick(View v) {\n //\t\tTODO refactor section\n \t\tContextMenuAdapter adapter = menu.getActionsContextMenuAdapter(false);\n \t\tList<ContextMenuItem> items = new ArrayList<>();\n+\t\tList<String> mainIds = app.getSettings().CONTEXT_MENU_ACTIONS_ITEMS.get().getMainActionIds();\n \t\tfor (ContextMenuItem item : adapter.getItems()) {\n \t\t\tif (!item.isHidden()) {", "originalCommit": "d1a19429077a0bb11471faec296ae99c26b25f74", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTEwMjkzMA==", "url": "https://github.com/osmandapp/OsmAnd/pull/8860#discussion_r419102930", "bodyText": "Wrong code. Should be \"if (id != null && (id.startsWith(idScheme))\" only.", "author": "max-klaus", "createdAt": "2020-05-03T13:20:43Z", "path": "OsmAnd/src/net/osmand/plus/ContextMenuAdapter.java", "diffHunk": "@@ -579,7 +580,7 @@ public boolean onRowItemClick(ArrayAdapter<ContextMenuItem> adapter, View view,\n \t\tList<ContextMenuItem> items = new ArrayList<>();\n \t\tfor (ContextMenuItem item : this.items) {\n \t\t\tString id = item.getId();\n-\t\t\tif (id != null && id.startsWith(idScheme) && !APP_PROFILES_ID.equals(id)) {\n+\t\t\tif (id != null && (id.startsWith(idScheme) && !APP_PROFILES_ID.equals(id) || id.startsWith(AIDL_LAYERS_PREFIX))) {", "originalCommit": "d1a19429077a0bb11471faec296ae99c26b25f74", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTEwNjE2NQ==", "url": "https://github.com/osmandapp/OsmAnd/pull/8860#discussion_r419106165", "bodyText": "Not clear why AIDL_LAYERS_PREFIX here", "author": "max-klaus", "createdAt": "2020-05-03T13:47:10Z", "path": "OsmAnd/src/net/osmand/plus/OsmandSettings.java", "diffHunk": "@@ -1206,7 +1218,11 @@ public void readFromJsonString(String jsonString, @NonNull String idScheme) {\n \t\t\tif (jsonArray != null) {\n \t\t\t\tfor (int i = 0; i < jsonArray.length(); i++) {\n \t\t\t\t\tString id = jsonArray.optString(i);\n-\t\t\t\t\tlist.add(idScheme + id);\n+\t\t\t\t\tif (id.startsWith(AIDL_LAYERS_PREFIX)) {", "originalCommit": "d1a19429077a0bb11471faec296ae99c26b25f74", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "9066a33335b7e0d93c725a77779b515604348085", "url": "https://github.com/osmandapp/OsmAnd/commit/9066a33335b7e0d93c725a77779b515604348085", "message": "Merge remote-tracking branch 'origin/master' into configure_menu_items_fix\n\n# Conflicts:\n#\tOsmAnd/res/values/strings.xml", "committedDate": "2020-05-04T07:09:54Z", "type": "commit"}, {"oid": "d80f4c039ca4b950b6dd599f4b1bdb3d1b81e5b7", "url": "https://github.com/osmandapp/OsmAnd/commit/d80f4c039ca4b950b6dd599f4b1bdb3d1b81e5b7", "message": "remove string in another languages", "committedDate": "2020-05-04T12:46:39Z", "type": "commit"}, {"oid": "23a7b701a7c964bc494ae994ad1b625180892535", "url": "https://github.com/osmandapp/OsmAnd/commit/23a7b701a7c964bc494ae994ad1b625180892535", "message": "refactor ContextMenuItemsPreference, corrections", "committedDate": "2020-05-05T08:38:27Z", "type": "commit"}, {"oid": "5a788a4d70b12040cbbb0ee81b48442876f011f8", "url": "https://github.com/osmandapp/OsmAnd/commit/5a788a4d70b12040cbbb0ee81b48442876f011f8", "message": "remove position", "committedDate": "2020-05-05T08:52:51Z", "type": "commit"}, {"oid": "b140ac4392a03991f91bea313b3a3613d97c5157", "url": "https://github.com/osmandapp/OsmAnd/commit/b140ac4392a03991f91bea313b3a3613d97c5157", "message": "Merge remote-tracking branch 'origin/master' into configure_menu_items_fix\n\n# Conflicts:\n#\tOsmAnd/res/values/strings.xml\n#\tOsmAnd/src/net/osmand/plus/OsmandSettings.java", "committedDate": "2020-05-05T10:22:18Z", "type": "commit"}, {"oid": "edbb876830ba405d7b5d6b05f55d6c44cabafa76", "url": "https://github.com/osmandapp/OsmAnd/commit/edbb876830ba405d7b5d6b05f55d6c44cabafa76", "message": "reset configure map item if hidden", "committedDate": "2020-05-05T12:50:33Z", "type": "commit"}, {"oid": "8b10342d33a6f99fb90e593a92f8e4c6a430b00c", "url": "https://github.com/osmandapp/OsmAnd/commit/8b10342d33a6f99fb90e593a92f8e4c6a430b00c", "message": "remove APP_PROFILES_ID check from ContextMenuAdapter", "committedDate": "2020-05-05T14:37:59Z", "type": "commit"}, {"oid": "99fafc9a9d97eb34e21cc7c3168ca4193bf6cb93", "url": "https://github.com/osmandapp/OsmAnd/commit/99fafc9a9d97eb34e21cc7c3168ca4193bf6cb93", "message": "Merge remote-tracking branch 'origin/master' into configure_menu_items_fix\n\n# Conflicts:\n#\tOsmAnd/res/values-hu/strings.xml\n#\tOsmAnd/res/values-sc/strings.xml\n#\tOsmAnd/res/values-uk/strings.xml", "committedDate": "2020-05-06T07:56:03Z", "type": "commit"}, {"oid": "125ede4e5d8e4ae94eccda6bcd5253f9fa537b56", "url": "https://github.com/osmandapp/OsmAnd/commit/125ede4e5d8e4ae94eccda6bcd5253f9fa537b56", "message": "refactor MainContextMenuItemsSettings", "committedDate": "2020-05-06T08:29:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDY0MjUwNg==", "url": "https://github.com/osmandapp/OsmAnd/pull/8860#discussion_r420642506", "bodyText": "mPosition?", "author": "max-klaus", "createdAt": "2020-05-06T09:00:39Z", "path": "OsmAnd/src/net/osmand/plus/ContextMenuItem.java", "diffHunk": "@@ -416,14 +417,13 @@ public ItemBuilder setId(String id) {\n \t\tpublic ContextMenuItem createItem() {\n \t\t\treturn new ContextMenuItem(mTitleId, mTitle, mIcon, mColorRes, mSecondaryIcon,\n \t\t\t\t\tmSelected, mProgress, mLayout, mLoading, mIsCategory, mIsClickable, mSkipPaintingWithoutColor,\n-\t\t\t\t\tmPosition, mOrder, mDescription, mItemClickListener, mIntegerListener, mProgressListener, itemDeleteAction,\n+\t\t\t\t\tmPosition, mOrder, mDescription, mItemClickListener, mIntegerListener, mProgressListener, mItemDeleteAction,", "originalCommit": "125ede4e5d8e4ae94eccda6bcd5253f9fa537b56", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e1b1756dd8cfe1b3f3e9ed12ec2719453d248218", "url": "https://github.com/osmandapp/OsmAnd/commit/e1b1756dd8cfe1b3f3e9ed12ec2719453d248218", "message": "remove position from ContextMenuItem", "committedDate": "2020-05-06T09:51:10Z", "type": "commit"}, {"oid": "df79d568fdf22cedde6ed77c417fb9eac2a15a4b", "url": "https://github.com/osmandapp/OsmAnd/commit/df79d568fdf22cedde6ed77c417fb9eac2a15a4b", "message": "fix string add/edit", "committedDate": "2020-05-06T09:52:10Z", "type": "commit"}, {"oid": "dadfc2556a6a95f5bae2ac9bc689f4547005c938", "url": "https://github.com/osmandapp/OsmAnd/commit/dadfc2556a6a95f5bae2ac9bc689f4547005c938", "message": "fix wrong settings keys", "committedDate": "2020-05-06T09:56:32Z", "type": "commit"}, {"oid": "7f470613791eae077e2f2f73b57063e210dd321d", "url": "https://github.com/osmandapp/OsmAnd/commit/7f470613791eae077e2f2f73b57063e210dd321d", "message": "remove reset items call", "committedDate": "2020-05-06T10:02:59Z", "type": "commit"}, {"oid": "3d7a6341cca27fe981a7a57c2d7bedf71406b728", "url": "https://github.com/osmandapp/OsmAnd/commit/3d7a6341cca27fe981a7a57c2d7bedf71406b728", "message": "change reset dialog message", "committedDate": "2020-05-06T10:17:45Z", "type": "commit"}, {"oid": "ee0d9677afa5c594816daab01bdbd42a02041e01", "url": "https://github.com/osmandapp/OsmAnd/commit/ee0d9677afa5c594816daab01bdbd42a02041e01", "message": "possibility to change dialog cancel button title", "committedDate": "2020-05-06T10:35:57Z", "type": "commit"}, {"oid": "9c7597f0cb548343b7de22eddbd2756cf28bc509", "url": "https://github.com/osmandapp/OsmAnd/commit/9c7597f0cb548343b7de22eddbd2756cf28bc509", "message": "refactor OnItemDeleteAction", "committedDate": "2020-05-06T11:37:40Z", "type": "commit"}, {"oid": "8a60632ee855806baaa28563961030fb9f88f670", "url": "https://github.com/osmandapp/OsmAnd/commit/8a60632ee855806baaa28563961030fb9f88f670", "message": "copy ids prefs rom another profile fix", "committedDate": "2020-05-06T11:54:51Z", "type": "commit"}, {"oid": "b96c227ec7ccfaf8ffc37a25b0ecfabc8850b1ab", "url": "https://github.com/osmandapp/OsmAnd/commit/b96c227ec7ccfaf8ffc37a25b0ecfabc8850b1ab", "message": "Merge remote-tracking branch 'origin/master' into configure_menu_items_fix\n\n# Conflicts:\n#\tOsmAnd/res/values/strings.xml\n#\tOsmAnd/src/net/osmand/plus/activities/MapActivityActions.java\n#\tOsmAnd/src/net/osmand/plus/dialogs/ConfigureMapMenu.java", "committedDate": "2020-05-06T12:01:54Z", "type": "commit"}, {"oid": "7aa599e2bb0515c3a3ce767a6be94d44171c31b8", "url": "https://github.com/osmandapp/OsmAnd/commit/7aa599e2bb0515c3a3ce767a6be94d44171c31b8", "message": "refactor", "committedDate": "2020-05-06T12:28:55Z", "type": "commit"}]}