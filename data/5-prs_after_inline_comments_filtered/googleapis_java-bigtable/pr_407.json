{"pr_number": 407, "pr_title": "fix: RowCells are not actually serializeable", "pr_createdAt": "2020-09-03T13:26:19Z", "pr_url": "https://github.com/googleapis/java-bigtable/pull/407", "timeline": [{"oid": "9758245e3dca75ce909badf8ce3d654ff1a81c3c", "url": "https://github.com/googleapis/java-bigtable/commit/9758245e3dca75ce909badf8ce3d654ff1a81c3c", "message": "fix: make RowCell serializable regardless given type of the labels parameter", "committedDate": "2020-09-03T11:04:44Z", "type": "commit"}, {"oid": "b33307bdf977aed2f6e7f11ad3bbbaa588958454", "url": "https://github.com/googleapis/java-bigtable/commit/b33307bdf977aed2f6e7f11ad3bbbaa588958454", "message": "fix: make RowCell serializable regardless given type of the labels parameter", "committedDate": "2020-09-03T11:36:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzEyNjE3OA==", "url": "https://github.com/googleapis/java-bigtable/pull/407#discussion_r483126178", "bodyText": "This doesnt optimize for the common case. The common case is empty labels. This is currently creating an extra allocation. Optimization would be:\nlabels = labels.isEmpty()? ImmutableList.of() : ImmutableList.copyOf(labels);", "author": "igorbernstein2", "createdAt": "2020-09-03T16:59:54Z", "path": "google-cloud-bigtable/src/main/java/com/google/cloud/bigtable/data/v2/models/RowCell.java", "diffHunk": "@@ -62,7 +63,8 @@ public static RowCell create(\n       long timestamp,\n       @Nonnull List<String> labels,\n       @Nonnull ByteString value) {\n-    return new AutoValue_RowCell(family, qualifier, timestamp, value, labels);\n+    // Ensure that the list is serializable and optimize for the common case\n+    return new AutoValue_RowCell(family, qualifier, timestamp, value, ImmutableList.copyOf(labels));", "originalCommit": "b33307bdf977aed2f6e7f11ad3bbbaa588958454", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzE1ODAxOA==", "url": "https://github.com/googleapis/java-bigtable/pull/407#discussion_r483158018", "bodyText": "Yes, indeed. I assumed ImmutableList.of() accepts var args, but it is not.\nTernary Operator does not work here(the compiler is not happy), so I have to use if.\nPlease take a look.", "author": "dmitry-fa", "createdAt": "2020-09-03T17:57:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzEyNjE3OA=="}], "type": "inlineReview"}, {"oid": "020c4374de90bfe63f1689d80bd9f570e1aeac89", "url": "https://github.com/googleapis/java-bigtable/commit/020c4374de90bfe63f1689d80bd9f570e1aeac89", "message": "optimization for an empty labels list", "committedDate": "2020-09-03T17:48:53Z", "type": "commit"}]}