{"pr_number": 450, "pr_title": "feat: backup level IAM", "pr_createdAt": "2020-10-07T19:26:07Z", "pr_url": "https://github.com/googleapis/java-bigtable/pull/450", "timeline": [{"oid": "600101d163de5d91c07b5e58da7b8ee25d3f40e5", "url": "https://github.com/googleapis/java-bigtable/commit/600101d163de5d91c07b5e58da7b8ee25d3f40e5", "message": "feat: backup level IAM", "committedDate": "2020-10-07T19:22:19Z", "type": "commit"}, {"oid": "1224c6831b89e6e8f8b8860fb93ee1ddccd2115f", "url": "https://github.com/googleapis/java-bigtable/commit/1224c6831b89e6e8f8b8860fb93ee1ddccd2115f", "message": "docs", "committedDate": "2020-10-07T19:24:10Z", "type": "commit"}, {"oid": "3917f542de82c595355644a62f74e36b0f907f9f", "url": "https://github.com/googleapis/java-bigtable/commit/3917f542de82c595355644a62f74e36b0f907f9f", "message": "extract out common logic", "committedDate": "2020-10-13T16:18:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTc3NTYzMQ==", "url": "https://github.com/googleapis/java-bigtable/pull/450#discussion_r505775631", "bodyText": "The name sticks out a bit. I'm guessing its to avoid conflict with existing table getIamPolicy.\nI think it would be cleaner to name the generic versions as getResourceIamPolicy, setResourceIamPolicy, etc. or getIamPolicyBase\nAnd the public resource specific ones can be called getBackupIamPolicy.", "author": "igorbernstein2", "createdAt": "2020-10-15T19:05:39Z", "path": "google-cloud-bigtable/src/main/java/com/google/cloud/bigtable/admin/v2/BigtableTableAdminClient.java", "diffHunk": "@@ -1463,9 +1434,226 @@ public Policy apply(com.google.iam.v1.Policy proto) {\n    */\n   @SuppressWarnings({\"WeakerAccess\"})\n   public ApiFuture<List<String>> testIamPermissionAsync(String tableId, String... permissions) {\n+    String tableName = NameUtil.formatTableName(projectId, instanceId, tableId);\n+    return testIamPermissions(tableName, permissions);\n+  }\n+\n+  /**\n+   * Gets the IAM access control policy for the specified backup.\n+   *\n+   * <p>Sample code:\n+   *\n+   * <pre>{@code\n+   * Policy policy = client.getBackupIamPolicy(\"my-cluster-id\", \"my-backup-id\");\n+   * for(Map.Entry<Role, Set<Identity>> entry : policy.getBindings().entrySet()) {\n+   *   System.out.printf(\"Role: %s Identities: %s\\n\", entry.getKey(), entry.getValue());\n+   * }\n+   * }</pre>\n+   *\n+   * @see <a\n+   *     href=\"https://cloud.google.com/bigtable/docs/access-control#iam-management-table\">Table-level\n+   *     IAM management</a>\n+   */\n+  @SuppressWarnings(\"WeakerAccess\")\n+  public Policy getBackupIamPolicy(String clusterId, String backupId) {\n+    return ApiExceptions.callAndTranslateApiException(getBackupIamPolicyAsync(clusterId, backupId));\n+  }\n+\n+  /**\n+   * Asynchronously gets the IAM access control policy for the specified backup.\n+   *\n+   * <p>Sample code:\n+   *\n+   * <pre>{@code\n+   * ApiFuture<Policy> policyFuture = client.getBackupIamPolicyAsync(\"my-cluster-id\", \"my-backup-id\");\n+   *\n+   * ApiFutures.addCallback(policyFuture,\n+   *   new ApiFutureCallback<Policy>() {\n+   *     public void onSuccess(Policy policy) {\n+   *       for (Entry<Role, Set<Identity>> entry : policy.getBindings().entrySet()) {\n+   *         System.out.printf(\"Role: %s Identities: %s\\n\", entry.getKey(), entry.getValue());\n+   *       }\n+   *     }\n+   *\n+   *     public void onFailure(Throwable t) {\n+   *       t.printStackTrace();\n+   *     }\n+   *   },\n+   *   MoreExecutors.directExecutor());\n+   * }</pre>\n+   *\n+   * @see <a\n+   *     href=\"https://cloud.google.com/bigtable/docs/access-control#iam-management-table\">Table-level\n+   *     IAM management</a>\n+   */\n+  @SuppressWarnings(\"WeakerAccess\")\n+  public ApiFuture<Policy> getBackupIamPolicyAsync(String clusterId, String backupId) {\n+    String backupName = NameUtil.formatBackupName(projectId, instanceId, clusterId, backupId);\n+    return getIamPolicyResult(backupName);\n+  }\n+\n+  /**\n+   * Replaces the IAM policy associated with the specified backup.\n+   *\n+   * <p>Sample code:\n+   *\n+   * <pre>{@code\n+   * Policy newPolicy = client.setBackupIamPolicy(\"my-cluster-id\", \"my-backup-id\",\n+   *   Policy.newBuilder()\n+   *     .addIdentity(Role.of(\"bigtable.user\"), Identity.user(\"someone@example.com\"))\n+   *     .addIdentity(Role.of(\"bigtable.admin\"), Identity.group(\"admins@example.com\"))\n+   *     .build());\n+   * }</pre>\n+   *\n+   * @see <a\n+   *     href=\"https://cloud.google.com/bigtable/docs/access-control#iam-management-table\">Table-level\n+   *     IAM management</a>\n+   */\n+  @SuppressWarnings(\"WeakerAccess\")\n+  public Policy setBackupIamPolicy(String clusterId, String backupId, Policy policy) {\n+    return ApiExceptions.callAndTranslateApiException(\n+        setBackupIamPolicyAsync(clusterId, backupId, policy));\n+  }\n+\n+  /**\n+   * Asynchronously replaces the IAM policy associated with the specified backup.\n+   *\n+   * <p>Sample code:\n+   *\n+   * <pre>{@code\n+   * ApiFuture<Policy> newPolicyFuture = client.setBackupIamPolicyAsync(\"my-cluster-id\", \"my-backup-id\",\n+   *   Policy.newBuilder()\n+   *     .addIdentity(Role.of(\"bigtable.user\"), Identity.user(\"someone@example.com\"))\n+   *     .addIdentity(Role.of(\"bigtable.admin\"), Identity.group(\"admins@example.com\"))\n+   *     .build());\n+   *\n+   * ApiFutures.addCallback(newPolicyFuture,\n+   *   new ApiFutureCallback<Policy>() {\n+   *     public void onSuccess(Policy policy) {\n+   *       for (Entry<Role, Set<Identity>> entry : policy.getBindings().entrySet()) {\n+   *         System.out.printf(\"Role: %s Identities: %s\\n\", entry.getKey(), entry.getValue());\n+   *       }\n+   *     }\n+   *\n+   *     public void onFailure(Throwable t) {\n+   *       t.printStackTrace();\n+   *     }\n+   *   },\n+   *   MoreExecutors.directExecutor());\n+   * }</pre>\n+   *\n+   * @see <a\n+   *     href=\"https://cloud.google.com/bigtable/docs/access-control#iam-management-table\">Table-level\n+   *     IAM management</a>\n+   */\n+  @SuppressWarnings(\"WeakerAccess\")\n+  public ApiFuture<Policy> setBackupIamPolicyAsync(\n+      String clusterId, String backupId, Policy policy) {\n+    String backupName = NameUtil.formatBackupName(projectId, instanceId, clusterId, backupId);\n+    return setIamPolicy(policy, backupName);\n+  }\n+\n+  /**\n+   * Tests whether the caller has the given permissions for the specified backup. Returns a subset\n+   * of the specified permissions that the caller has.\n+   *\n+   * <p>Sample code:\n+   *\n+   * <pre>{@code\n+   * List<String> grantedPermissions = client.testBackupIamPermission(\"my-cluster-id\", \"my-backup-id\",\n+   *   \"bigtable.backups.restore\", \"bigtable.backups.delete\");\n+   * }</pre>\n+   *\n+   * System.out.println(\"Has restore access: \" +\n+   * grantedPermissions.contains(\"bigtable.backups.restore\"));\n+   *\n+   * <p>System.out.println(\"Has delete access: \" +\n+   * grantedPermissions.contains(\"bigtable.backups.delete\"));\n+   *\n+   * @see <a href=\"https://cloud.google.com/bigtable/docs/access-control#permissions\">Cloud Bigtable\n+   *     permissions</a>\n+   */\n+  @SuppressWarnings({\"WeakerAccess\"})\n+  public List<String> testBackupIamPermission(\n+      String clusterId, String backupId, String... permissions) {\n+    return ApiExceptions.callAndTranslateApiException(\n+        testBackupIamPermissionAsync(clusterId, backupId, permissions));\n+  }\n+\n+  /**\n+   * Asynchronously tests whether the caller has the given permissions for the specified backup.\n+   * Returns a subset of the specified permissions that the caller has.\n+   *\n+   * <p>Sample code:\n+   *\n+   * <pre>{@code\n+   * ApiFuture<List<String>> grantedPermissionsFuture = client.testBackupIamPermissionAsync(\"my-cluster-id\", \"my-backup-id\",\n+   *   \"bigtable.backups.restore\", \"bigtable.backups.delete\");\n+   *\n+   * ApiFutures.addCallback(grantedPermissionsFuture,\n+   *   new ApiFutureCallback<List<String>>() {\n+   *     public void onSuccess(List<String> grantedPermissions) {\n+   *       System.out.println(\"Has restore access: \" + grantedPermissions.contains(\"bigtable.backups.restore\"));\n+   *       System.out.println(\"Has delete access: \" + grantedPermissions.contains(\"bigtable.backups.delete\"));\n+   *     }\n+   *\n+   *     public void onFailure(Throwable t) {\n+   *       t.printStackTrace();\n+   *     }\n+   *   },\n+   *   MoreExecutors.directExecutor());\n+   * }</pre>\n+   *\n+   * @see <a href=\"https://cloud.google.com/bigtable/docs/access-control#permissions\">Cloud Bigtable\n+   *     permissions</a>\n+   */\n+  @SuppressWarnings({\"WeakerAccess\"})\n+  public ApiFuture<List<String>> testBackupIamPermissionAsync(\n+      String clusterId, String backupId, String... permissions) {\n+    String backupName = NameUtil.formatBackupName(projectId, instanceId, clusterId, backupId);\n+    return testIamPermissions(backupName, permissions);\n+  }\n+\n+  private ApiFuture<Policy> getIamPolicyResult(String name) {", "originalCommit": "3917f542de82c595355644a62f74e36b0f907f9f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "40636e5404b8376440a37435b4207e6496c7109e", "url": "https://github.com/googleapis/java-bigtable/commit/40636e5404b8376440a37435b4207e6496c7109e", "message": "code feedback", "committedDate": "2020-10-16T15:24:42Z", "type": "commit"}, {"oid": "f32d90387dc319db08c18f494de3a99735ece602", "url": "https://github.com/googleapis/java-bigtable/commit/f32d90387dc319db08c18f494de3a99735ece602", "message": "lint", "committedDate": "2020-10-16T17:47:53Z", "type": "commit"}]}