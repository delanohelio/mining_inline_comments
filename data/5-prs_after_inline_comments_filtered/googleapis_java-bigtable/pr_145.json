{"pr_number": 145, "pr_title": "deps: upgrade gax to 1.53.0", "pr_createdAt": "2020-01-09T20:40:19Z", "pr_url": "https://github.com/googleapis/java-bigtable/pull/145", "timeline": [{"oid": "e6674ef018fe170a17bf849c4992c84dd8bcd840", "url": "https://github.com/googleapis/java-bigtable/commit/e6674ef018fe170a17bf849c4992c84dd8bcd840", "message": "deps: upgrade gax to 1.53.0", "committedDate": "2020-01-09T20:39:53Z", "type": "commit"}, {"oid": "ab3059038b0be4ac189de26a2937fe4b58ae1ebe", "url": "https://github.com/googleapis/java-bigtable/commit/ab3059038b0be4ac189de26a2937fe4b58ae1ebe", "message": "fix compile failures", "committedDate": "2020-01-09T21:05:17Z", "type": "commit"}, {"oid": "5693e6e6438b9308aa9f793e6ca12e77c3366d9c", "url": "https://github.com/googleapis/java-bigtable/commit/5693e6e6438b9308aa9f793e6ca12e77c3366d9c", "message": "rename parameter", "committedDate": "2020-01-09T21:06:42Z", "type": "commit"}, {"oid": "ea5371624cf7e16df1187252b119b6225b537528", "url": "https://github.com/googleapis/java-bigtable/commit/ea5371624cf7e16df1187252b119b6225b537528", "message": "rename test variables", "committedDate": "2020-01-09T21:10:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDk2MTA4OQ==", "url": "https://github.com/googleapis/java-bigtable/pull/145#discussion_r364961089", "bodyText": "lets rename batch to entries", "author": "igorbernstein2", "createdAt": "2020-01-09T21:10:34Z", "path": "google-cloud-bigtable/src/main/java/com/google/cloud/bigtable/data/v2/stub/mutaterows/MutateRowsBatchingDescriptor.java", "diffHunk": "@@ -45,9 +46,9 @@\n   }\n \n   @Override\n-  public void splitResponse(Void response, List<SettableApiFuture<Void>> batch) {\n-    for (SettableApiFuture<Void> batchResponse : batch) {\n-      batchResponse.set(null);\n+  public void splitResponse(Void response, List<BatchEntry<RowMutationEntry, Void>> batch) {", "originalCommit": "5693e6e6438b9308aa9f793e6ca12e77c3366d9c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDk2MTEyOA==", "url": "https://github.com/googleapis/java-bigtable/pull/145#discussion_r364961128", "bodyText": "lets rename batch to entries", "author": "igorbernstein2", "createdAt": "2020-01-09T21:10:42Z", "path": "google-cloud-bigtable/src/main/java/com/google/cloud/bigtable/data/v2/stub/mutaterows/MutateRowsBatchingDescriptor.java", "diffHunk": "@@ -58,10 +59,10 @@ public void splitResponse(Void response, List<SettableApiFuture<Void>> batch) {\n    * entries whose index is mentioned {@link MutateRowsException#getFailedMutations()}.\n    */\n   @Override\n-  public void splitException(Throwable throwable, List<SettableApiFuture<Void>> batch) {\n+  public void splitException(Throwable throwable, List<BatchEntry<RowMutationEntry, Void>> batch) {", "originalCommit": "5693e6e6438b9308aa9f793e6ca12e77c3366d9c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDk2MTc4NA==", "url": "https://github.com/googleapis/java-bigtable/pull/145#discussion_r364961784", "bodyText": "The mutaterows descriptor shouldn't accept nulls, the check is missing, but lets keep the test correct:\nList<BatchEntry<RowMutationEntry, Void>> entries =\n        ImmutableList.of(\n            BatchEntry.create(\n                RowMutationEntry.create(\"key1\").deleteRow(), SettableApiFuture.<Void>create()),\n            BatchEntry.create(\n                RowMutationEntry.create(\"key2\").deleteRow(), SettableApiFuture.<Void>create()));", "author": "igorbernstein2", "createdAt": "2020-01-09T21:12:18Z", "path": "google-cloud-bigtable/src/test/java/com/google/cloud/bigtable/data/v2/stub/mutaterows/MutateRowsBatchingDescriptorTest.java", "diffHunk": "@@ -77,29 +78,35 @@ public void requestBuilderTest() {\n \n   @Test\n   public void splitResponseTest() {\n-    List<SettableApiFuture<Void>> batchResponse =\n-        ImmutableList.of(SettableApiFuture.<Void>create(), SettableApiFuture.<Void>create());\n-    assertThat(batchResponse.get(0).isDone()).isFalse();\n-    assertThat(batchResponse.get(1).isDone()).isFalse();\n+    BatchEntry<RowMutationEntry, Void> resultFuture1 = BatchEntry.create(null, SettableApiFuture.<Void>create());\n+    BatchEntry<RowMutationEntry, Void> resultFuture2 = BatchEntry.create(null, SettableApiFuture.<Void>create());\n+", "originalCommit": "5693e6e6438b9308aa9f793e6ca12e77c3366d9c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDk2MjM2MA==", "url": "https://github.com/googleapis/java-bigtable/pull/145#discussion_r364962360", "bodyText": "same as above:\nList<BatchEntry<RowMutationEntry, Void>> batchResponses =\n        ImmutableList.of(\n            BatchEntry.create(\n                RowMutationEntry.create(\"key1\").deleteRow(), SettableApiFuture.<Void>create()),\n            BatchEntry.create(\n                RowMutationEntry.create(\"key2\").deleteRow(), SettableApiFuture.<Void>create()));", "author": "igorbernstein2", "createdAt": "2020-01-09T21:13:55Z", "path": "google-cloud-bigtable/src/test/java/com/google/cloud/bigtable/data/v2/stub/mutaterows/MutateRowsBatchingDescriptorTest.java", "diffHunk": "@@ -77,29 +78,35 @@ public void requestBuilderTest() {\n \n   @Test\n   public void splitResponseTest() {\n-    List<SettableApiFuture<Void>> batchResponse =\n-        ImmutableList.of(SettableApiFuture.<Void>create(), SettableApiFuture.<Void>create());\n-    assertThat(batchResponse.get(0).isDone()).isFalse();\n-    assertThat(batchResponse.get(1).isDone()).isFalse();\n+    BatchEntry<RowMutationEntry, Void> resultFuture1 = BatchEntry.create(null, SettableApiFuture.<Void>create());\n+    BatchEntry<RowMutationEntry, Void> resultFuture2 = BatchEntry.create(null, SettableApiFuture.<Void>create());\n+\n+    List<BatchEntry<RowMutationEntry, Void>> batchResponse =\n+        ImmutableList.of(resultFuture1, resultFuture2);\n+    assertThat(batchResponse.get(0).getResultFuture().isDone()).isFalse();\n+    assertThat(batchResponse.get(1).getResultFuture().isDone()).isFalse();\n \n     MutateRowsBatchingDescriptor underTest = new MutateRowsBatchingDescriptor();\n     underTest.splitResponse(null, batchResponse);\n-    assertThat(batchResponse.get(0).isDone()).isTrue();\n-    assertThat(batchResponse.get(1).isDone()).isTrue();\n+    assertThat(batchResponse.get(0).getResultFuture().isDone()).isTrue();\n+    assertThat(batchResponse.get(1).getResultFuture().isDone()).isTrue();\n   }\n \n   @Test\n   public void splitExceptionTest() {\n+    BatchEntry<RowMutationEntry, Void> resultFuture1 = BatchEntry.create(null, SettableApiFuture.<Void>create());\n+    BatchEntry<RowMutationEntry, Void> resultFuture2 = BatchEntry.create(null, SettableApiFuture.<Void>create());\n+", "originalCommit": "5693e6e6438b9308aa9f793e6ca12e77c3366d9c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDk2MzAzOQ==", "url": "https://github.com/googleapis/java-bigtable/pull/145#discussion_r364963039", "bodyText": "similar to above, don't use null", "author": "igorbernstein2", "createdAt": "2020-01-09T21:15:33Z", "path": "google-cloud-bigtable/src/test/java/com/google/cloud/bigtable/data/v2/stub/mutaterows/MutateRowsBatchingDescriptorTest.java", "diffHunk": "@@ -110,9 +117,9 @@ public void splitExceptionTest() {\n   public void splitExceptionWithFailedMutationsTest() {\n     MutateRowsBatchingDescriptor underTest = new MutateRowsBatchingDescriptor();\n     Throwable actualThrowable = null;\n-    SettableApiFuture<Void> resultFuture1 = SettableApiFuture.create();\n-    SettableApiFuture<Void> resultFuture2 = SettableApiFuture.create();\n-    SettableApiFuture<Void> resultFuture3 = SettableApiFuture.create();\n+    BatchEntry<RowMutationEntry, Void> resultFuture1 = BatchEntry.create(null, SettableApiFuture.<Void>create());\n+    BatchEntry<RowMutationEntry, Void> resultFuture2 = BatchEntry.create(null, SettableApiFuture.<Void>create());\n+    BatchEntry<RowMutationEntry, Void> resultFuture3 = BatchEntry.create(null, SettableApiFuture.<Void>create());", "originalCommit": "5693e6e6438b9308aa9f793e6ca12e77c3366d9c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "8d5e153c2b4be0b1fb999c971fd6131991788825", "url": "https://github.com/googleapis/java-bigtable/commit/8d5e153c2b4be0b1fb999c971fd6131991788825", "message": "review feedback", "committedDate": "2020-01-09T21:19:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDk2NjYwMQ==", "url": "https://github.com/googleapis/java-bigtable/pull/145#discussion_r364966601", "bodyText": "s/future/entry", "author": "igorbernstein2", "createdAt": "2020-01-09T21:24:34Z", "path": "google-cloud-bigtable/src/main/java/com/google/cloud/bigtable/data/v2/stub/mutaterows/MutateRowsBatchingDescriptor.java", "diffHunk": "@@ -58,10 +58,11 @@ public void splitResponse(Void response, List<SettableApiFuture<Void>> batch) {\n    * entries whose index is mentioned {@link MutateRowsException#getFailedMutations()}.\n    */\n   @Override\n-  public void splitException(Throwable throwable, List<SettableApiFuture<Void>> batch) {\n+  public void splitException(\n+      Throwable throwable, List<BatchEntry<RowMutationEntry, Void>> entries) {\n     if (!(throwable instanceof MutateRowsException)) {\n-      for (SettableApiFuture<Void> future : batch) {\n-        future.setException(throwable);\n+      for (BatchEntry<RowMutationEntry, Void> future : entries) {\n+        future.getResultFuture().setException(throwable);", "originalCommit": "8d5e153c2b4be0b1fb999c971fd6131991788825", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDk2NjY5OQ==", "url": "https://github.com/googleapis/java-bigtable/pull/145#discussion_r364966699", "bodyText": "s/entryResultFuture/entry", "author": "igorbernstein2", "createdAt": "2020-01-09T21:24:52Z", "path": "google-cloud-bigtable/src/main/java/com/google/cloud/bigtable/data/v2/stub/mutaterows/MutateRowsBatchingDescriptor.java", "diffHunk": "@@ -74,12 +75,12 @@ public void splitException(Throwable throwable, List<SettableApiFuture<Void>> ba\n     }\n \n     int i = 0;\n-    for (SettableApiFuture<Void> entryResultFuture : batch) {\n+    for (BatchEntry<RowMutationEntry, Void> entryResultFuture : entries) {", "originalCommit": "8d5e153c2b4be0b1fb999c971fd6131991788825", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "65a15e227bb96f7b892bb6253d23d5cd555d5a32", "url": "https://github.com/googleapis/java-bigtable/commit/65a15e227bb96f7b892bb6253d23d5cd555d5a32", "message": "review feedback", "committedDate": "2020-01-09T21:26:50Z", "type": "commit"}]}