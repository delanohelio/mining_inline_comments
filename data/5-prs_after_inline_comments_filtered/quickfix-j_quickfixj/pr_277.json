{"pr_number": 277, "pr_title": "Add optional TLS SNI initiator support", "pr_createdAt": "2020-03-27T23:21:18Z", "pr_url": "https://github.com/quickfix-j/quickfixj/pull/277", "timeline": [{"oid": "7395c5d9ed1811eb07637a6acf0a812edbdb83fa", "url": "https://github.com/quickfix-j/quickfixj/commit/7395c5d9ed1811eb07637a6acf0a812edbdb83fa", "message": "activate TLS SNI support by default when using TLS", "committedDate": "2020-03-27T23:19:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTc4OTA3MA==", "url": "https://github.com/quickfix-j/quickfixj/pull/277#discussion_r399789070", "bodyText": "I would log the remote peer address being set.", "author": "the-thing", "createdAt": "2020-03-29T12:13:13Z", "path": "quickfixj-core/src/main/java/quickfix/mina/ssl/SSLFilter.java", "diffHunk": "@@ -49,4 +58,20 @@ public void setEnabledCipherSuites(String[] cipherSuites) {\n     public void setCipherSuites(String[] cipherSuites) {\r\n         super.setEnabledCipherSuites(cipherSuites);\r\n     }\r\n+\r\n+    @Override\r\n+    public void onPreAdd(IoFilterChain parent, String name, NextFilter nextFilter)\r\n+        throws SSLException {\r\n+\r\n+        IoSession session = parent.getSession();\r\n+        SocketAddress remoteAddress = session.getRemoteAddress();\r\n+\r\n+        if(remoteAddress instanceof InetSocketAddress) {\r\n+            // activate the SNI support in the JSSE SSLEngine\r\n+            log.info(\"activating TLS SNI support\");\r", "originalCommit": "7395c5d9ed1811eb07637a6acf0a812edbdb83fa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTgxMzI0NA==", "url": "https://github.com/quickfix-j/quickfixj/pull/277#discussion_r399813244", "bodyText": "debug or info ?", "author": "youurayy", "createdAt": "2020-03-29T15:29:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTc4OTA3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTgxNDI1MA==", "url": "https://github.com/quickfix-j/quickfixj/pull/277#discussion_r399814250", "bodyText": "I would keep the current info and just added the param.", "author": "the-thing", "createdAt": "2020-03-29T15:37:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTc4OTA3MA=="}], "type": "inlineReview"}, {"oid": "a93a20ca02d82d4318725e0a4cfcc7e6ec278147", "url": "https://github.com/quickfix-j/quickfixj/commit/a93a20ca02d82d4318725e0a4cfcc7e6ec278147", "message": "add address to SNI init log output", "committedDate": "2020-03-30T18:51:20Z", "type": "commit"}, {"oid": "028b2762c0af051b49b072f02a2dde85243bfeb6", "url": "https://github.com/quickfix-j/quickfixj/commit/028b2762c0af051b49b072f02a2dde85243bfeb6", "message": "add UseSNI opt-in parameter", "committedDate": "2020-03-30T19:30:16Z", "type": "commit"}, {"oid": "acf00c10073b4e91ab24fa92225253b2da895173", "url": "https://github.com/quickfix-j/quickfixj/commit/acf00c10073b4e91ab24fa92225253b2da895173", "message": "add doc for the UseSNI config parameter", "committedDate": "2020-03-30T19:39:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQ0OTIwNA==", "url": "https://github.com/quickfix-j/quickfixj/pull/277#discussion_r400449204", "bodyText": "No need for +, you can use the argument", "author": "the-thing", "createdAt": "2020-03-30T19:44:15Z", "path": "quickfixj-core/src/main/java/quickfix/mina/ssl/SSLFilter.java", "diffHunk": "@@ -49,4 +59,26 @@ public void setEnabledCipherSuites(String[] cipherSuites) {\n     public void setCipherSuites(String[] cipherSuites) {\r\n         super.setEnabledCipherSuites(cipherSuites);\r\n     }\r\n+\r\n+    @Override\r\n+    public void onPreAdd(IoFilterChain parent, String name, NextFilter nextFilter)\r\n+        throws SSLException {\r\n+\r\n+        if (useSNI) {\r\n+            IoSession session = parent.getSession();\r\n+            SocketAddress remoteAddress = session.getRemoteAddress();\r\n+\r\n+            if (remoteAddress instanceof InetSocketAddress) {\r\n+                // activate the SNI support in the JSSE SSLEngine\r\n+                log.info(\"activating TLS SNI support for peer address: \" + remoteAddress);\r", "originalCommit": "acf00c10073b4e91ab24fa92225253b2da895173", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQ1NDQzMQ==", "url": "https://github.com/quickfix-j/quickfixj/pull/277#discussion_r400454431", "bodyText": "That doesn't seem to be the style established in the project (or, I don't understand what you mean by \"argument\")", "author": "youurayy", "createdAt": "2020-03-30T19:53:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQ0OTIwNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQ1NzY4Mg==", "url": "https://github.com/quickfix-j/quickfixj/pull/277#discussion_r400457682", "bodyText": "I think it is mixed, depends which class you look at e.g. quickfix.mina.SingleThreadedEventHandlingStrategy#blockInThread. If you keep + I will not complain.", "author": "the-thing", "createdAt": "2020-03-30T19:59:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQ0OTIwNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQ2NzUwOQ==", "url": "https://github.com/quickfix-j/quickfixj/pull/277#discussion_r400467509", "bodyText": "Changed.", "author": "youurayy", "createdAt": "2020-03-30T20:17:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQ0OTIwNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQ0OTM5OA==", "url": "https://github.com/quickfix-j/quickfixj/pull/277#discussion_r400449398", "bodyText": "This can be combined with  below if statement.", "author": "the-thing", "createdAt": "2020-03-30T19:44:36Z", "path": "quickfixj-core/src/main/java/quickfix/mina/ssl/SSLFilter.java", "diffHunk": "@@ -49,4 +59,26 @@ public void setEnabledCipherSuites(String[] cipherSuites) {\n     public void setCipherSuites(String[] cipherSuites) {\r\n         super.setEnabledCipherSuites(cipherSuites);\r\n     }\r\n+\r\n+    @Override\r\n+    public void onPreAdd(IoFilterChain parent, String name, NextFilter nextFilter)\r\n+        throws SSLException {\r\n+\r\n+        if (useSNI) {\r", "originalCommit": "acf00c10073b4e91ab24fa92225253b2da895173", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQ1Mjg3Mw==", "url": "https://github.com/quickfix-j/quickfixj/pull/277#discussion_r400452873", "bodyText": "Yes it can, but it will diminish the clarity of intent.", "author": "youurayy", "createdAt": "2020-03-30T19:51:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQ0OTM5OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQ2MDc1NQ==", "url": "https://github.com/quickfix-j/quickfixj/pull/277#discussion_r400460755", "bodyText": "I mean, the check on the enabling parameter is at a different \"logical level\" than the safety instanceof check, and mixing them may confuse code readers due to this. I can change if you insist.", "author": "youurayy", "createdAt": "2020-03-30T20:05:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQ0OTM5OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQ2NDcxNA==", "url": "https://github.com/quickfix-j/quickfixj/pull/277#discussion_r400464714", "bodyText": "also, the remoteAddress local variable is introduced is introduced within the if (useSNI) { block, so to have it participate in the top-most condition would require a hacky style, e.g. if (useSNI && ((remoteAddress = session.getRemoteAddress()) instanceof InetSocketAddress)) {.\nSimilarly for the session local variable.", "author": "youurayy", "createdAt": "2020-03-30T20:12:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQ0OTM5OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQ2OTA3Mg==", "url": "https://github.com/quickfix-j/quickfixj/pull/277#discussion_r400469072", "bodyText": "I see the address. Keep it then.", "author": "the-thing", "createdAt": "2020-03-30T20:20:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQ0OTM5OA=="}], "type": "inlineReview"}, {"oid": "3a499f4552195750effa5822aa957f6fa7d4e0cd", "url": "https://github.com/quickfix-j/quickfixj/commit/3a499f4552195750effa5822aa957f6fa7d4e0cd", "message": "change to parametrized logging", "committedDate": "2020-03-30T20:18:25Z", "type": "commit"}, {"oid": "260d266c5cf7ff9dd70e96cbc536ff6144924a04", "url": "https://github.com/quickfix-j/quickfixj/commit/260d266c5cf7ff9dd70e96cbc536ff6144924a04", "message": "remove javascript from LGTM processing", "committedDate": "2020-03-31T14:44:47Z", "type": "commit"}, {"oid": "f981b055476c1532e1f0c688a0d392ca5f0306e1", "url": "https://github.com/quickfix-j/quickfixj/commit/f981b055476c1532e1f0c688a0d392ca5f0306e1", "message": "remove javascript and html from LGTM processing", "committedDate": "2020-03-31T15:05:37Z", "type": "commit"}, {"oid": "bea7b6e54e442fd231bfa04fd9924682b9f940e7", "url": "https://github.com/quickfix-j/quickfixj/commit/bea7b6e54e442fd231bfa04fd9924682b9f940e7", "message": "remove javascript and html from LGTM processing", "committedDate": "2020-03-31T15:10:15Z", "type": "commit"}, {"oid": "21753fd4bd331dde1cad91b79aa29edd93691199", "url": "https://github.com/quickfix-j/quickfixj/commit/21753fd4bd331dde1cad91b79aa29edd93691199", "message": "remove javascript from LGTM processing", "committedDate": "2020-03-31T15:29:14Z", "type": "commit"}, {"oid": "884005a054caf41a5bd4412d02d9ec1fc2ef4b75", "url": "https://github.com/quickfix-j/quickfixj/commit/884005a054caf41a5bd4412d02d9ec1fc2ef4b75", "message": "remove javascript, html and yaml from LGTM processing", "committedDate": "2020-03-31T15:33:21Z", "type": "commit"}, {"oid": "9f7789f601b2a71ab03b7598a67d502b94a2c690", "url": "https://github.com/quickfix-j/quickfixj/commit/9f7789f601b2a71ab03b7598a67d502b94a2c690", "message": "specify Java for LGTM processing explicitly", "committedDate": "2020-03-31T15:36:18Z", "type": "commit"}, {"oid": "6a78a862db5dadacaad15f068c439eaf685775e6", "url": "https://github.com/quickfix-j/quickfixj/commit/6a78a862db5dadacaad15f068c439eaf685775e6", "message": "dummy javascript file to make LGTM extractor happy", "committedDate": "2020-03-31T15:49:38Z", "type": "commit"}, {"oid": "1eca95e1b37b5b048cb53f91ef7f1debfe7eb2f8", "url": "https://github.com/quickfix-j/quickfixj/commit/1eca95e1b37b5b048cb53f91ef7f1debfe7eb2f8", "message": "dummy html file to make LGTM extractor happy", "committedDate": "2020-03-31T15:55:39Z", "type": "commit"}, {"oid": "11a5b15b91adb9b8382860f52d6fdd2f9e636a24", "url": "https://github.com/quickfix-j/quickfixj/commit/11a5b15b91adb9b8382860f52d6fdd2f9e636a24", "message": "dummy html file to make LGTM javascript extractor happy", "committedDate": "2020-03-31T16:04:31Z", "type": "commit"}, {"oid": "c5fe53ed4917d572d71f084da8279fc4b4992e84", "url": "https://github.com/quickfix-j/quickfixj/commit/c5fe53ed4917d572d71f084da8279fc4b4992e84", "message": "dummy html file to make LGTM javascript extractor happy", "committedDate": "2020-03-31T16:04:46Z", "type": "commit"}, {"oid": "bb96d577215f91d6f1fd9ebbd6b088b929142942", "url": "https://github.com/quickfix-j/quickfixj/commit/bb96d577215f91d6f1fd9ebbd6b088b929142942", "message": "dummy html file to make LGTM javascript extractor happy", "committedDate": "2020-03-31T16:12:55Z", "type": "commit"}, {"oid": "b5d12e9c3f767327b2f0884ecdbf40f4e27e5af6", "url": "https://github.com/quickfix-j/quickfixj/commit/b5d12e9c3f767327b2f0884ecdbf40f4e27e5af6", "message": "add a dummy JS to make LGTM extractor happy; remove previous dummy file attempt;", "committedDate": "2020-03-31T16:24:24Z", "type": "commit"}, {"oid": "2317f54d4af21dcaabf845d89166951ddc06b527", "url": "https://github.com/quickfix-j/quickfixj/commit/2317f54d4af21dcaabf845d89166951ddc06b527", "message": "remove javascript from LGTM processing", "committedDate": "2020-03-31T16:36:14Z", "type": "commit"}, {"oid": "9e397cbebf8ec93db578287d2e2eff8244367309", "url": "https://github.com/quickfix-j/quickfixj/commit/9e397cbebf8ec93db578287d2e2eff8244367309", "message": "remove javascript from LGTM processing", "committedDate": "2020-03-31T16:40:42Z", "type": "commit"}, {"oid": "9b83adf3a313760fe89bf711f2781adb0824f901", "url": "https://github.com/quickfix-j/quickfixj/commit/9b83adf3a313760fe89bf711f2781adb0824f901", "message": "remove javascript from LGTM processing", "committedDate": "2020-03-31T16:44:13Z", "type": "commit"}, {"oid": "3b14a0e100f0bcaef27f7ae22463b65a48906eab", "url": "https://github.com/quickfix-j/quickfixj/commit/3b14a0e100f0bcaef27f7ae22463b65a48906eab", "message": "remove javascript from LGTM processing", "committedDate": "2020-03-31T16:56:06Z", "type": "commit"}, {"oid": "35ab5d33bf139b2d68ac9fdb8fff870150ea4e91", "url": "https://github.com/quickfix-j/quickfixj/commit/35ab5d33bf139b2d68ac9fdb8fff870150ea4e91", "message": "remove javascript from LGTM processing", "committedDate": "2020-03-31T17:03:10Z", "type": "commit"}, {"oid": "5be49de76070962d3395ba4a2eb242372a44a42f", "url": "https://github.com/quickfix-j/quickfixj/commit/5be49de76070962d3395ba4a2eb242372a44a42f", "message": "remove javascript from LGTM processing", "committedDate": "2020-03-31T17:17:49Z", "type": "commit"}, {"oid": "e94b78bfb62c9a4810b61f837c0855f84425d6b1", "url": "https://github.com/quickfix-j/quickfixj/commit/e94b78bfb62c9a4810b61f837c0855f84425d6b1", "message": "undo the lgtm exlusion attempts", "committedDate": "2020-03-31T17:25:14Z", "type": "commit"}, {"oid": "6a9bec3ea7d66ba4fd7688d49fa3a91783afc501", "url": "https://github.com/quickfix-j/quickfixj/commit/6a9bec3ea7d66ba4fd7688d49fa3a91783afc501", "message": "minor changes to comments and logging", "committedDate": "2020-04-01T10:42:42Z", "type": "commit"}, {"oid": "f41557b2b860972e8487d96a244a071ff872bb8a", "url": "https://github.com/quickfix-j/quickfixj/commit/f41557b2b860972e8487d96a244a071ff872bb8a", "message": "corrected SNI (indication)", "committedDate": "2020-04-01T10:47:22Z", "type": "commit"}]}