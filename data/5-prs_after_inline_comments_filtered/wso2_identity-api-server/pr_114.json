{"pr_number": 114, "pr_title": "Fix the issue of Identity Provider REST API Patch operation", "pr_createdAt": "2020-03-11T01:46:09Z", "pr_url": "https://github.com/wso2/identity-api-server/pull/114", "timeline": [{"oid": "4758e308e4121d8fa0a940b0076fe797d002c404", "url": "https://github.com/wso2/identity-api-server/commit/4758e308e4121d8fa0a940b0076fe797d002c404", "message": "Fix the issue of Identity Provider REST API Patch operation", "committedDate": "2020-03-10T17:58:28Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDczNDAxNA==", "url": "https://github.com/wso2/identity-api-server/pull/114#discussion_r390734014", "bodyText": "if its a certificate it will be an object. so we need to do something similar to https://github.com/wso2/identity-api-server/blob/master/components/org.wso2.carbon.identity.api.server.idp/org.wso2.carbon.identity.api.server.idp.v1/src/main/java/org/wso2/carbon/identity/api/server/idp/v1/core/ServerIdpManagementService.java#L1136-L1141", "author": "emswbandara", "createdAt": "2020-03-11T03:58:12Z", "path": "components/org.wso2.carbon.identity.api.server.idp/org.wso2.carbon.identity.api.server.idp.v1/src/main/java/org/wso2/carbon/identity/api/server/idp/v1/core/ServerIdpManagementService.java", "diffHunk": "@@ -1953,6 +1953,12 @@ private void processPatchRequest(List<Patch> patchRequest, IdentityProvider idpT\n                     case Constants.HOME_REALM_PATH:\n                         idpToUpdate.setHomeRealmId(value);\n                         break;\n+                    case Constants.ALIAS:\n+                        idpToUpdate.setAlias(value);\n+                        break;\n+                    case Constants.CERTIFICATE:\n+                        idpToUpdate.setCertificate(value);", "originalCommit": "4758e308e4121d8fa0a940b0076fe797d002c404", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "8382cd79bb7b201e3bf5e9c66077c0b748be4bde", "url": "https://github.com/wso2/identity-api-server/commit/8382cd79bb7b201e3bf5e9c66077c0b748be4bde", "message": "Fix patch operation for certificate attribute", "committedDate": "2020-03-12T09:06:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQ5MTk5Mg==", "url": "https://github.com/wso2/identity-api-server/pull/114#discussion_r391491992", "bodyText": "let's add ArrayUtils.isnotEmpty(idpToUpdate.getCertificateInfoArray()) here before iterating", "author": "emswbandara", "createdAt": "2020-03-12T09:25:16Z", "path": "components/org.wso2.carbon.identity.api.server.idp/org.wso2.carbon.identity.api.server.idp.v1/src/main/java/org/wso2/carbon/identity/api/server/idp/v1/core/ServerIdpManagementService.java", "diffHunk": "@@ -1931,31 +1931,53 @@ private void processPatchRequest(List<Patch> patchRequest, IdentityProvider idpT\n             // We support only 'REPLACE' patch operation.\n             if (operation == Patch.OperationEnum.REPLACE) {\n                 String value = patch.getValue();\n-                switch (path) {\n-                    case Constants.NAME_PATH:\n-                        idpToUpdate.setIdentityProviderName(value);\n-                        break;\n-                    case Constants.DESCRIPTION_PATH:\n-                        idpToUpdate.setIdentityProviderDescription(value);\n-                        break;\n-                    case Constants.IMAGE_PATH:\n-                        idpToUpdate.setImageUrl(value);\n-                        break;\n-                    case Constants.IS_PRIMARY_PATH:\n-                        idpToUpdate.setPrimary(Boolean.parseBoolean(value));\n-                        break;\n-                    case Constants.IS_ENABLED_PATH:\n-                        idpToUpdate.setEnable(Boolean.parseBoolean(value));\n-                        break;\n-                    case Constants.IS_FEDERATION_HUB_PATH:\n-                        idpToUpdate.setFederationHub(Boolean.parseBoolean(value));\n-                        break;\n-                    case Constants.HOME_REALM_PATH:\n-                        idpToUpdate.setHomeRealmId(value);\n-                        break;\n-                    default:\n-                        throw handleException(Response.Status.BAD_REQUEST, Constants.ErrorMessage\n-                                .ERROR_CODE_INVALID_INPUT, null);\n+                if (path.contains(Constants.CERTIFICATE)) {\n+                    List<String> certificates = new ArrayList<>();\n+                    for (CertificateInfo certInfo : idpToUpdate.getCertificateInfoArray()) {", "originalCommit": "8382cd79bb7b201e3bf5e9c66077c0b748be4bde", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTU2NzAxMA==", "url": "https://github.com/wso2/identity-api-server/pull/114#discussion_r391567010", "bodyText": "Fixed d8c03ce", "author": "GANGANI", "createdAt": "2020-03-12T11:47:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQ5MTk5Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQ5NTIwNw==", "url": "https://github.com/wso2/identity-api-server/pull/114#discussion_r391495207", "bodyText": "if we do contains here, it will allow invalid paths as well. Its better to define a regex for this and do a regex match.\ne.g. you can use a regex similar to 'certificate/certificates/\\d+'", "author": "emswbandara", "createdAt": "2020-03-12T09:31:10Z", "path": "components/org.wso2.carbon.identity.api.server.idp/org.wso2.carbon.identity.api.server.idp.v1/src/main/java/org/wso2/carbon/identity/api/server/idp/v1/core/ServerIdpManagementService.java", "diffHunk": "@@ -1931,31 +1931,53 @@ private void processPatchRequest(List<Patch> patchRequest, IdentityProvider idpT\n             // We support only 'REPLACE' patch operation.\n             if (operation == Patch.OperationEnum.REPLACE) {\n                 String value = patch.getValue();\n-                switch (path) {\n-                    case Constants.NAME_PATH:\n-                        idpToUpdate.setIdentityProviderName(value);\n-                        break;\n-                    case Constants.DESCRIPTION_PATH:\n-                        idpToUpdate.setIdentityProviderDescription(value);\n-                        break;\n-                    case Constants.IMAGE_PATH:\n-                        idpToUpdate.setImageUrl(value);\n-                        break;\n-                    case Constants.IS_PRIMARY_PATH:\n-                        idpToUpdate.setPrimary(Boolean.parseBoolean(value));\n-                        break;\n-                    case Constants.IS_ENABLED_PATH:\n-                        idpToUpdate.setEnable(Boolean.parseBoolean(value));\n-                        break;\n-                    case Constants.IS_FEDERATION_HUB_PATH:\n-                        idpToUpdate.setFederationHub(Boolean.parseBoolean(value));\n-                        break;\n-                    case Constants.HOME_REALM_PATH:\n-                        idpToUpdate.setHomeRealmId(value);\n-                        break;\n-                    default:\n-                        throw handleException(Response.Status.BAD_REQUEST, Constants.ErrorMessage\n-                                .ERROR_CODE_INVALID_INPUT, null);\n+                if (path.contains(Constants.CERTIFICATE)) {", "originalCommit": "8382cd79bb7b201e3bf5e9c66077c0b748be4bde", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTU2NjkyNw==", "url": "https://github.com/wso2/identity-api-server/pull/114#discussion_r391566927", "bodyText": "Fixed d8c03ce", "author": "GANGANI", "createdAt": "2020-03-12T11:46:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQ5NTIwNw=="}], "type": "inlineReview"}, {"oid": "d8c03ce82b78b02cebb6f87be8ce9e77c1973a80", "url": "https://github.com/wso2/identity-api-server/commit/d8c03ce82b78b02cebb6f87be8ce9e77c1973a80", "message": "Add regex to match certificate path", "committedDate": "2020-03-12T11:26:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTU3MDMxMg==", "url": "https://github.com/wso2/identity-api-server/pull/114#discussion_r391570312", "bodyText": "lets verify whether 0 < index <= idpToUpdate.getCertificateInfoArray().length as well.", "author": "emswbandara", "createdAt": "2020-03-12T11:54:20Z", "path": "components/org.wso2.carbon.identity.api.server.idp/org.wso2.carbon.identity.api.server.idp.v1/src/main/java/org/wso2/carbon/identity/api/server/idp/v1/core/ServerIdpManagementService.java", "diffHunk": "@@ -1931,31 +1931,54 @@ private void processPatchRequest(List<Patch> patchRequest, IdentityProvider idpT\n             // We support only 'REPLACE' patch operation.\n             if (operation == Patch.OperationEnum.REPLACE) {\n                 String value = patch.getValue();\n-                switch (path) {\n-                    case Constants.NAME_PATH:\n-                        idpToUpdate.setIdentityProviderName(value);\n-                        break;\n-                    case Constants.DESCRIPTION_PATH:\n-                        idpToUpdate.setIdentityProviderDescription(value);\n-                        break;\n-                    case Constants.IMAGE_PATH:\n-                        idpToUpdate.setImageUrl(value);\n-                        break;\n-                    case Constants.IS_PRIMARY_PATH:\n-                        idpToUpdate.setPrimary(Boolean.parseBoolean(value));\n-                        break;\n-                    case Constants.IS_ENABLED_PATH:\n-                        idpToUpdate.setEnable(Boolean.parseBoolean(value));\n-                        break;\n-                    case Constants.IS_FEDERATION_HUB_PATH:\n-                        idpToUpdate.setFederationHub(Boolean.parseBoolean(value));\n-                        break;\n-                    case Constants.HOME_REALM_PATH:\n-                        idpToUpdate.setHomeRealmId(value);\n-                        break;\n-                    default:\n-                        throw handleException(Response.Status.BAD_REQUEST, Constants.ErrorMessage\n-                                .ERROR_CODE_INVALID_INPUT, null);\n+                if (path.matches(\"/certificate/certificates/[0-9]+\")) {\n+                    List<String> certificates = new ArrayList<>();\n+                    int index = Integer.parseInt(path.split(\"/\")[3]);\n+                    if (ArrayUtils.isNotEmpty(idpToUpdate.getCertificateInfoArray())) {", "originalCommit": "d8c03ce82b78b02cebb6f87be8ce9e77c1973a80", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjAxOTQ0Ng==", "url": "https://github.com/wso2/identity-api-server/pull/114#discussion_r392019446", "bodyText": "Fixed caa5f02", "author": "GANGANI", "createdAt": "2020-03-13T03:57:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTU3MDMxMg=="}], "type": "inlineReview"}, {"oid": "caa5f02e2d13533499f8730c7d67af32843f80a5", "url": "https://github.com/wso2/identity-api-server/commit/caa5f02e2d13533499f8730c7d67af32843f80a5", "message": "Validate the certificate path", "committedDate": "2020-03-13T03:55:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjAzMzUzMg==", "url": "https://github.com/wso2/identity-api-server/pull/114#discussion_r392033532", "bodyText": "do we use this constant anywhere? if not, let's remove it", "author": "emswbandara", "createdAt": "2020-03-13T05:12:58Z", "path": "components/org.wso2.carbon.identity.api.server.idp/org.wso2.carbon.identity.api.server.idp.common/src/main/java/org/wso2/carbon/identity/api/server/idp/common/Constants.java", "diffHunk": "@@ -40,6 +41,9 @@\n     public static final String IS_ENABLED_PATH = \"/isEnabled\";\n     public static final String IS_FEDERATION_HUB_PATH = \"/isFederationHub\";\n     public static final String HOME_REALM_PATH = \"/homeRealmIdentifier\";\n+    public static final String ALIAS = \"/alias\";\n+    public static final String CERTIFICATE_JWKSURI = \"/certificate/jwksUri\";\n+    public static final String CERTIFICATE = \"/certificate/certificates\";", "originalCommit": "caa5f02e2d13533499f8730c7d67af32843f80a5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjAzMzYyOQ==", "url": "https://github.com/wso2/identity-api-server/pull/114#discussion_r392033629", "bodyText": "move this constant to under  Patch operation paths.", "author": "emswbandara", "createdAt": "2020-03-13T05:13:32Z", "path": "components/org.wso2.carbon.identity.api.server.idp/org.wso2.carbon.identity.api.server.idp.common/src/main/java/org/wso2/carbon/identity/api/server/idp/common/Constants.java", "diffHunk": "@@ -28,6 +28,7 @@\n     public static final String META_DATA_SAML = \"meta_data_saml\";\n     public static final String SELECT_MODE = \"SelectMode\";\n     public static final String SELECT_MODE_METADATA = \"Metadata File Configuration\";\n+    public static final String CERTIFICATE_PATH_REGEX = \"/certificate/certificates/[0-9]+\";", "originalCommit": "caa5f02e2d13533499f8730c7d67af32843f80a5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjAzMzk1NA==", "url": "https://github.com/wso2/identity-api-server/pull/114#discussion_r392033954", "bodyText": "do we need to define a default value for index?", "author": "emswbandara", "createdAt": "2020-03-13T05:15:07Z", "path": "components/org.wso2.carbon.identity.api.server.idp/org.wso2.carbon.identity.api.server.idp.v1/src/main/java/org/wso2/carbon/identity/api/server/idp/v1/core/ServerIdpManagementService.java", "diffHunk": "@@ -1922,6 +1922,7 @@ private OutboundConnector createOutboundConnector(String connectorId, IdentityPr\n      */\n     private void processPatchRequest(List<Patch> patchRequest, IdentityProvider idpToUpdate) {\n \n+        int index = 0;", "originalCommit": "caa5f02e2d13533499f8730c7d67af32843f80a5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "9d6a54b25602a0777a002ef0db1440fd95f0fdff", "url": "https://github.com/wso2/identity-api-server/commit/9d6a54b25602a0777a002ef0db1440fd95f0fdff", "message": "Modify processPatchRequest method", "committedDate": "2020-03-13T11:03:04Z", "type": "commit"}, {"oid": "e9d5f277a1c5c19e7302bd430944352484bd3b85", "url": "https://github.com/wso2/identity-api-server/commit/e9d5f277a1c5c19e7302bd430944352484bd3b85", "message": "Redefine index variable", "committedDate": "2020-03-13T11:20:14Z", "type": "commit"}]}