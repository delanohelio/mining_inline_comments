{"pr_number": 1981, "pr_title": "1967 ratings", "pr_createdAt": "2020-10-12T20:04:49Z", "pr_url": "https://github.com/FAForever/downlords-faf-client/pull/1981", "timeline": [{"oid": "af23f8f689c62d0fba6a9fbeb255bf5636d2b36f", "url": "https://github.com/FAForever/downlords-faf-client/commit/af23f8f689c62d0fba6a9fbeb255bf5636d2b36f", "message": "#1967 Implemented game list filtering based on the rating.", "committedDate": "2020-10-10T19:20:19Z", "type": "commit"}, {"oid": "bf7b11edcf625249bda0e4141c874364555f31da", "url": "https://github.com/FAForever/downlords-faf-client/commit/bf7b11edcf625249bda0e4141c874364555f31da", "message": "#1967 First stab at implementing ratings using the new server model", "committedDate": "2020-10-12T12:31:05Z", "type": "commit"}, {"oid": "88a8c2b1a42abf14a1b7443d02acee33d5b1377d", "url": "https://github.com/FAForever/downlords-faf-client/commit/88a8c2b1a42abf14a1b7443d02acee33d5b1377d", "message": "#1967 Added the rating information to the new game creation.", "committedDate": "2020-10-12T19:32:26Z", "type": "commit"}, {"oid": "c6b27fcf3ea594a67fd2ca70f67561dd4bd7631e", "url": "https://github.com/FAForever/downlords-faf-client/commit/c6b27fcf3ea594a67fd2ca70f67561dd4bd7631e", "message": "#1967 Removed the new localizations from other countries", "committedDate": "2020-10-12T20:00:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzc5MjMwNQ==", "url": "https://github.com/FAForever/downlords-faf-client/pull/1981#discussion_r503792305", "bodyText": "There are also negative Ratings!", "author": "Brutus5000", "createdAt": "2020-10-13T09:10:58Z", "path": "src/main/java/com/faforever/client/game/CreateGameController.java", "diffHunk": "@@ -386,13 +387,30 @@ public void onCreateButtonClicked() {\n         .map(ModVersion::getUid)\n         .collect(Collectors.toSet());\n \n+    int minRating = 0;", "originalCommit": "c6b27fcf3ea594a67fd2ca70f67561dd4bd7631e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTU0NDU2MA==", "url": "https://github.com/FAForever/downlords-faf-client/pull/1981#discussion_r505544560", "bodyText": "rating range is -invinity to +invinity", "author": "1-alex98", "createdAt": "2020-10-15T13:32:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzc5MjMwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjk2MzM5MA==", "url": "https://github.com/FAForever/downlords-faf-client/pull/1981#discussion_r506963390", "bodyText": "Good point! I'm adding a boolean parameter to the JavaFxUtil method, that signifies if negative values should be allowed in the text field.", "author": "chrsin", "createdAt": "2020-10-17T17:08:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzc5MjMwNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTU0MzcxMw==", "url": "https://github.com/FAForever/downlords-faf-client/pull/1981#discussion_r505543713", "bodyText": "constants like 0 and 3000 need to go away... should be something like null, null", "author": "1-alex98", "createdAt": "2020-10-15T13:31:14Z", "path": "src/main/java/com/faforever/client/coop/CoopController.java", "diffHunk": "@@ -267,7 +267,10 @@ public void onPlayButtonClicked() {\n     modService.getFeaturedMod(COOP.getTechnicalName())\n         .thenAccept(featuredModBean -> gameService.hostGame(new NewGameInfo(titleTextField.getText(),\n             Strings.emptyToNull(passwordTextField.getText()), featuredModBean, getSelectedMission().getMapFolderName(),\n-            emptySet())));\n+            emptySet(),\n+            0, //Rating isn't interesting for coop games\n+            3000,", "originalCommit": "c6b27fcf3ea594a67fd2ca70f67561dd4bd7631e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjk2MzQ0Mg==", "url": "https://github.com/FAForever/downlords-faf-client/pull/1981#discussion_r506963442", "bodyText": "Good point! I'll implement that.", "author": "chrsin", "createdAt": "2020-10-17T17:09:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTU0MzcxMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTU0NDYwNQ==", "url": "https://github.com/FAForever/downlords-faf-client/pull/1981#discussion_r505544605", "bodyText": "Nowhere should constants be found that imply a max or a min rating.... There is no max and no min rating. If no max rating is set then there is no max rating....", "author": "1-alex98", "createdAt": "2020-10-15T13:32:27Z", "path": "src/main/java/com/faforever/client/game/CreateGameController.java", "diffHunk": "@@ -386,13 +387,30 @@ public void onCreateButtonClicked() {\n         .map(ModVersion::getUid)\n         .collect(Collectors.toSet());\n \n+    int minRating = 0;\n+    int maxRating = 3000;", "originalCommit": "c6b27fcf3ea594a67fd2ca70f67561dd4bd7631e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTU0NTg1NQ==", "url": "https://github.com/FAForever/downlords-faf-client/pull/1981#discussion_r505545855", "bodyText": "{} always for code style reasons", "author": "1-alex98", "createdAt": "2020-10-15T13:34:16Z", "path": "src/main/java/com/faforever/client/game/GameRangePredicate.java", "diffHunk": "@@ -0,0 +1,24 @@\n+package com.faforever.client.game;\n+\n+import com.faforever.client.player.Player;\n+import com.faforever.client.util.RatingUtil;\n+\n+import java.util.Optional;\n+import java.util.function.Predicate;\n+\n+public class GameRangePredicate implements Predicate<Game> {\n+  private final Optional<Player> player;\n+\n+  public GameRangePredicate(Optional<Player> player) {\n+    this.player = player;\n+  }\n+\n+  @Override\n+  public boolean test(Game game) {\n+    if(!player.isPresent() || !game.getEnforceRating())", "originalCommit": "c6b27fcf3ea594a67fd2ca70f67561dd4bd7631e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTU0NjM3NA==", "url": "https://github.com/FAForever/downlords-faf-client/pull/1981#discussion_r505546374", "bodyText": "null checks!!!!", "author": "1-alex98", "createdAt": "2020-10-15T13:34:56Z", "path": "src/main/java/com/faforever/client/game/GameRangePredicate.java", "diffHunk": "@@ -0,0 +1,24 @@\n+package com.faforever.client.game;\n+\n+import com.faforever.client.player.Player;\n+import com.faforever.client.util.RatingUtil;\n+\n+import java.util.Optional;\n+import java.util.function.Predicate;\n+\n+public class GameRangePredicate implements Predicate<Game> {\n+  private final Optional<Player> player;\n+\n+  public GameRangePredicate(Optional<Player> player) {\n+    this.player = player;\n+  }\n+\n+  @Override\n+  public boolean test(Game game) {\n+    if(!player.isPresent() || !game.getEnforceRating())\n+      return true;\n+\n+    float rating = RatingUtil.getGlobalRating(player.get());\n+    return game.getMaxRating() >= rating && game.getMinRating() <= rating;", "originalCommit": "c6b27fcf3ea594a67fd2ca70f67561dd4bd7631e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjk2MzY0Mw==", "url": "https://github.com/FAForever/downlords-faf-client/pull/1981#discussion_r506963643", "bodyText": "Yeah now I'm changing from int to Integers I will need those. Or am I missing something else?", "author": "chrsin", "createdAt": "2020-10-17T17:11:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTU0NjM3NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTU0NjkxOQ==", "url": "https://github.com/FAForever/downlords-faf-client/pull/1981#discussion_r505546919", "bodyText": "use Integer so you can set it to null", "author": "1-alex98", "createdAt": "2020-10-15T13:35:36Z", "path": "src/main/java/com/faforever/client/game/NewGameInfo.java", "diffHunk": "@@ -17,8 +17,11 @@\n   private String map;\n   private Set<String> simMods;\n   private GameVisibility gameVisibility;\n+  private Integer ratingMin;\n+  private Integer ratingMax;\n+  private Boolean enforceRatingRange;\n \n-  public NewGameInfo(String title, String password, FeaturedMod featuredMod, String map, Set<String> simMods) {\n-    this(title, password, featuredMod, map, simMods, GameVisibility.PUBLIC);\n+  public NewGameInfo(String title, String password, FeaturedMod featuredMod, String map, Set<String> simMods, int minRating, int maxRating, boolean enforceRating) {", "originalCommit": "c6b27fcf3ea594a67fd2ca70f67561dd4bd7631e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTU0NzI4OQ==", "url": "https://github.com/FAForever/downlords-faf-client/pull/1981#discussion_r505547289", "bodyText": "I think there is a PlayerBuilder", "author": "1-alex98", "createdAt": "2020-10-15T13:36:05Z", "path": "src/test/java/com/faforever/client/game/GameRangePredicateTest.java", "diffHunk": "@@ -0,0 +1,130 @@\n+package com.faforever.client.game;\n+\n+import com.faforever.client.player.Player;\n+import org.junit.Assert;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.mockito.junit.MockitoJUnitRunner;\n+\n+import java.util.ArrayList;\n+import java.util.Optional;\n+\n+@RunWith(MockitoJUnitRunner.class)\n+public class GameRangePredicateTest {\n+\n+  private Player validPlayer;\n+  private GameRangePredicate predicate;\n+  private Game game;\n+\n+  @Before\n+  public void setUp() {\n+    validPlayer = new Player(\"\");", "originalCommit": "c6b27fcf3ea594a67fd2ca70f67561dd4bd7631e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjk2Mzc5Mw==", "url": "https://github.com/FAForever/downlords-faf-client/pull/1981#discussion_r506963793", "bodyText": "For these tests only the rating is relevant so don't think using the player builder gives any value. Do you disagree?", "author": "chrsin", "createdAt": "2020-10-17T17:13:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTU0NzI4OQ=="}], "type": "inlineReview"}, {"oid": "2fe22cec8d4981e18641a455a43e53ea592c1f64", "url": "https://github.com/FAForever/downlords-faf-client/commit/2fe22cec8d4981e18641a455a43e53ea592c1f64", "message": "#1967 Made the rankings optional. If null is supplied no rating is requested.", "committedDate": "2020-10-17T12:05:01Z", "type": "commit"}, {"oid": "5e9c5ead49a7bd93befa68be0a40fdc1a777fdf5", "url": "https://github.com/FAForever/downlords-faf-client/commit/5e9c5ead49a7bd93befa68be0a40fdc1a777fdf5", "message": "#1967 Made the rating text field accept negative values.", "committedDate": "2020-10-17T21:35:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjk4NzAzMQ==", "url": "https://github.com/FAForever/downlords-faf-client/pull/1981#discussion_r506987031", "bodyText": "No filtering needs to be done !!! The server already filters the game so they fit your rating. If the rating it not enforced the games are not filtered by the server and the rating only acts as a description.", "author": "1-alex98", "createdAt": "2020-10-17T21:41:35Z", "path": "src/main/java/com/faforever/client/game/CustomGamesController.java", "diffHunk": "@@ -179,9 +185,11 @@ private void updateFilteredItems() {\n     boolean showPasswordProtectedGames = showPasswordProtectedGamesCheckBox.isSelected();\n     boolean showModdedGames = showModdedGamesCheckBox.isSelected();\n \n-    filteredItems.setPredicate(OPEN_CUSTOM_GAMES_PREDICATE.and(gameInfoBean ->\n-        (showPasswordProtectedGames || !gameInfoBean.isPasswordProtected())\n-            && (showModdedGames || gameInfoBean.getSimMods().isEmpty())));\n+    filteredItems.setPredicate(OPEN_CUSTOM_GAMES_PREDICATE\n+        .and(gameInfoBean ->\n+            (showPasswordProtectedGames || !gameInfoBean.isPasswordProtected())\n+                && (showModdedGames || gameInfoBean.getSimMods().isEmpty()))\n+        .and(rangePredicate));", "originalCommit": "5e9c5ead49a7bd93befa68be0a40fdc1a777fdf5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjk4NzEwNw==", "url": "https://github.com/FAForever/downlords-faf-client/pull/1981#discussion_r506987107", "bodyText": "this is already done by the server", "author": "1-alex98", "createdAt": "2020-10-17T21:42:17Z", "path": "src/main/java/com/faforever/client/game/GameRangePredicate.java", "diffHunk": "@@ -0,0 +1,33 @@\n+package com.faforever.client.game;\n+\n+import com.faforever.client.player.Player;\n+import com.faforever.client.util.RatingUtil;\n+\n+import java.util.Optional;\n+import java.util.function.Predicate;\n+\n+public class GameRangePredicate implements Predicate<Game> {", "originalCommit": "5e9c5ead49a7bd93befa68be0a40fdc1a777fdf5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzE5MDM2NQ==", "url": "https://github.com/FAForever/downlords-faf-client/pull/1981#discussion_r507190365", "bodyText": "Makes sense... But also that makes me a sad panda.", "author": "chrsin", "createdAt": "2020-10-18T17:33:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjk4NzEwNw=="}], "type": "inlineReview"}, {"oid": "3c2f864d0abec25f5fa88cec652b4fece5e66e04", "url": "https://github.com/FAForever/downlords-faf-client/commit/3c2f864d0abec25f5fa88cec652b4fece5e66e04", "message": "#1967 Removed the unused GameRangePredicate.", "committedDate": "2020-10-18T17:45:45Z", "type": "commit"}, {"oid": "01ce5e88ab90c971e2a682e45c3432e0247a6c90", "url": "https://github.com/FAForever/downlords-faf-client/commit/01ce5e88ab90c971e2a682e45c3432e0247a6c90", "message": "Merge remote-tracking branch 'faf/develop' into 1967-ratings\n\n# Conflicts:\n#\tsrc/main/java/com/faforever/client/game/CustomGamesController.java", "committedDate": "2020-10-18T18:03:45Z", "type": "commit"}, {"oid": "94ef6fd67822f62688219a207963b949d56417c7", "url": "https://github.com/FAForever/downlords-faf-client/commit/94ef6fd67822f62688219a207963b949d56417c7", "message": "#1967 Removed the constant values from the coop controller", "committedDate": "2020-10-18T18:19:30Z", "type": "commit"}, {"oid": "13214aad778cf5fd3af592e9852181431d197050", "url": "https://github.com/FAForever/downlords-faf-client/commit/13214aad778cf5fd3af592e9852181431d197050", "message": "#1967 Fixed a nullref in the join game helper", "committedDate": "2020-10-18T18:27:28Z", "type": "commit"}, {"oid": "1e65c9302f2fa857941e77d0dfcb0f2f45434915", "url": "https://github.com/FAForever/downlords-faf-client/commit/1e65c9302f2fa857941e77d0dfcb0f2f45434915", "message": "#1967 Added unit test for the makeNumeric method and removed the enforcerating from the Coop NewGameInfo constructor", "committedDate": "2020-10-18T18:55:58Z", "type": "commit"}, {"oid": "46ef0c8919b2ce3861e160577443e7125f416e8c", "url": "https://github.com/FAForever/downlords-faf-client/commit/46ef0c8919b2ce3861e160577443e7125f416e8c", "message": "Fix unit test", "committedDate": "2020-10-18T19:08:38Z", "type": "commit"}]}