{"pr_number": 1979, "pr_title": "#1978 Implemented a filter for country in the chat window.", "pr_createdAt": "2020-10-10T17:30:22Z", "pr_url": "https://github.com/FAForever/downlords-faf-client/pull/1979", "timeline": [{"oid": "01e0898a2658167ec9f307a00759a581ff3fe782", "url": "https://github.com/FAForever/downlords-faf-client/commit/01e0898a2658167ec9f307a00759a581ff3fe782", "message": "#1978 Implemented a filter for country in the chat window.", "committedDate": "2020-10-10T17:20:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjk1NzkxNQ==", "url": "https://github.com/FAForever/downlords-faf-client/pull/1979#discussion_r502957915", "bodyText": "A lot of code for a simple thing:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              public List<String> getCountries(String startsWith) {\n          \n          \n            \n                String[] countries = Locale.getISOCountries();\n          \n          \n            \n                if(startsWith == null) {\n          \n          \n            \n                  return Arrays.asList(countries);\n          \n          \n            \n                }\n          \n          \n            \n            \n          \n          \n            \n                startsWith = startsWith.toLowerCase();\n          \n          \n            \n            \n          \n          \n            \n                ArrayList<String> result = new ArrayList(countries.length);\n          \n          \n            \n                for(String country : countries)  {\n          \n          \n            \n                  if(country.toLowerCase().startsWith(startsWith))\n          \n          \n            \n                    result.add(country);\n          \n          \n            \n                }\n          \n          \n            \n            \n          \n          \n            \n                return result;\n          \n          \n            \n              }\n          \n          \n            \n              return Arrays.stream(Locale.getISOCountries())\n          \n          \n            \n                    .filter(country -> startsWith == null || country.startsWith(startsWith))\n          \n          \n            \n                    .collect(Collectors.toList());", "author": "1-alex98", "createdAt": "2020-10-11T19:48:42Z", "path": "src/main/java/com/faforever/client/chat/CountryFlagService.java", "diffHunk": "@@ -35,6 +39,24 @@\n         .map(url -> new Image(url.toString(), true));\n   }\n \n+  @Cacheable(COUNTRY_NAMES)\n+  public List<String> getCountries(String startsWith) {\n+    String[] countries = Locale.getISOCountries();\n+    if(startsWith == null) {\n+      return Arrays.asList(countries);\n+    }\n+\n+    startsWith = startsWith.toLowerCase();\n+\n+    ArrayList<String> result = new ArrayList(countries.length);\n+    for(String country : countries)  {\n+      if(country.toLowerCase().startsWith(startsWith))\n+        result.add(country);\n+    }\n+\n+    return result;\n+  }", "originalCommit": "01e0898a2658167ec9f307a00759a581ff3fe782", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjk1ODcxNw==", "url": "https://github.com/FAForever/downlords-faf-client/pull/1979#discussion_r502958717", "bodyText": "Java stream api", "author": "1-alex98", "createdAt": "2020-10-11T19:55:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjk1NzkxNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQ1ODc1Mg==", "url": "https://github.com/FAForever/downlords-faf-client/pull/1979#discussion_r503458752", "bodyText": "Didn't know about the stream API. Thanks really helpful! Ended out using a method since there was a bit much logic for a one liner.", "author": "chrsin", "createdAt": "2020-10-12T18:13:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjk1NzkxNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjk1Nzk4Nw==", "url": "https://github.com/FAForever/downlords-faf-client/pull/1979#discussion_r502957987", "bodyText": "for code style reasons we use {} always", "author": "1-alex98", "createdAt": "2020-10-11T19:49:20Z", "path": "src/main/java/com/faforever/client/chat/CountryFlagService.java", "diffHunk": "@@ -35,6 +39,24 @@\n         .map(url -> new Image(url.toString(), true));\n   }\n \n+  @Cacheable(COUNTRY_NAMES)\n+  public List<String> getCountries(String startsWith) {\n+    String[] countries = Locale.getISOCountries();\n+    if(startsWith == null) {\n+      return Arrays.asList(countries);\n+    }\n+\n+    startsWith = startsWith.toLowerCase();\n+\n+    ArrayList<String> result = new ArrayList(countries.length);\n+    for(String country : countries)  {\n+      if(country.toLowerCase().startsWith(startsWith))\n+        result.add(country);", "originalCommit": "01e0898a2658167ec9f307a00759a581ff3fe782", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjk1ODAyNw==", "url": "https://github.com/FAForever/downlords-faf-client/pull/1979#discussion_r502958027", "bodyText": "final\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              private CountryFlagService flagService;\n          \n          \n            \n              private final CountryFlagService flagService;", "author": "1-alex98", "createdAt": "2020-10-11T19:49:34Z", "path": "src/main/java/com/faforever/client/chat/UserFilterController.java", "diffHunk": "@@ -30,20 +33,24 @@\n public class UserFilterController implements Controller<Node> {\n \n   private final I18n i18n;\n+  private CountryFlagService flagService;", "originalCommit": "01e0898a2658167ec9f307a00759a581ff3fe782", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjk1ODIxMA==", "url": "https://github.com/FAForever/downlords-faf-client/pull/1979#discussion_r502958210", "bodyText": "A ComboBox of what. See how Intelij warns you. In order to achieve type safety please use the Type parameter:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              public ComboBox countryFilterField;\n          \n          \n            \n              public ComboBox<String> countryFilterField;", "author": "1-alex98", "createdAt": "2020-10-11T19:50:58Z", "path": "src/main/java/com/faforever/client/chat/UserFilterController.java", "diffHunk": "@@ -30,20 +33,24 @@\n public class UserFilterController implements Controller<Node> {\n \n   private final I18n i18n;\n+  private CountryFlagService flagService;\n   public MenuButton gameStatusMenu;\n   public GridPane filterUserRoot;\n   public TextField clanFilterField;\n   public TextField minRatingFilterField;\n   public TextField maxRatingFilterField;\n   public ToggleGroup gameStatusToggleGroup;\n+  public ComboBox countryFilterField;", "originalCommit": "01e0898a2658167ec9f307a00759a581ff3fe782", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQ1OTI5NQ==", "url": "https://github.com/FAForever/downlords-faf-client/pull/1979#discussion_r503459295", "bodyText": "Ended up going with a TextField instead. The ComboBox was confusing as you could end up seeing values that didn't match what you were typing.", "author": "chrsin", "createdAt": "2020-10-12T18:14:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjk1ODIxMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjk1ODI2NA==", "url": "https://github.com/FAForever/downlords-faf-client/pull/1979#discussion_r502958264", "bodyText": "We avoid var for code style reasons", "author": "1-alex98", "createdAt": "2020-10-11T19:51:43Z", "path": "src/main/java/com/faforever/client/chat/UserFilterController.java", "diffHunk": "@@ -159,6 +172,27 @@ boolean isGameStatusMatch(ChatChannelUser chatUser) {\n     }\n   }\n \n+  boolean isCountryMatch(ChatChannelUser chatUser) {\n+    var fieldValue = countryFilterField.getEditor().getText();", "originalCommit": "01e0898a2658167ec9f307a00759a581ff3fe782", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQ1OTUwNw==", "url": "https://github.com/FAForever/downlords-faf-client/pull/1979#discussion_r503459507", "bodyText": "Being explicit is better. I agree", "author": "chrsin", "createdAt": "2020-10-12T18:14:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjk1ODI2NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjk1ODMwNw==", "url": "https://github.com/FAForever/downlords-faf-client/pull/1979#discussion_r502958307", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                if(fieldValue.isEmpty())\n          \n          \n            \n                  return true;\n          \n          \n            \n                if(fieldValue.isEmpty()){\n          \n          \n            \n                  return true;\n          \n          \n            \n                }", "author": "1-alex98", "createdAt": "2020-10-11T19:52:04Z", "path": "src/main/java/com/faforever/client/chat/UserFilterController.java", "diffHunk": "@@ -159,6 +172,27 @@ boolean isGameStatusMatch(ChatChannelUser chatUser) {\n     }\n   }\n \n+  boolean isCountryMatch(ChatChannelUser chatUser) {\n+    var fieldValue = countryFilterField.getEditor().getText();\n+    if(fieldValue.isEmpty())\n+      return true;", "originalCommit": "01e0898a2658167ec9f307a00759a581ff3fe782", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjk1ODMyMQ==", "url": "https://github.com/FAForever/downlords-faf-client/pull/1979#discussion_r502958321", "bodyText": "{}", "author": "1-alex98", "createdAt": "2020-10-11T19:52:12Z", "path": "src/main/java/com/faforever/client/chat/UserFilterController.java", "diffHunk": "@@ -159,6 +172,27 @@ boolean isGameStatusMatch(ChatChannelUser chatUser) {\n     }\n   }\n \n+  boolean isCountryMatch(ChatChannelUser chatUser) {\n+    var fieldValue = countryFilterField.getEditor().getText();\n+    if(fieldValue.isEmpty())\n+      return true;\n+\n+    Optional<Player> playerOptional = chatUser.getPlayer();\n+\n+    if(!playerOptional.isPresent())\n+      return false;", "originalCommit": "01e0898a2658167ec9f307a00759a581ff3fe782", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjk1ODM3Nw==", "url": "https://github.com/FAForever/downlords-faf-client/pull/1979#discussion_r502958377", "bodyText": "...", "author": "1-alex98", "createdAt": "2020-10-11T19:52:41Z", "path": "src/main/java/com/faforever/client/chat/UserFilterController.java", "diffHunk": "@@ -159,6 +172,27 @@ boolean isGameStatusMatch(ChatChannelUser chatUser) {\n     }\n   }\n \n+  boolean isCountryMatch(ChatChannelUser chatUser) {\n+    var fieldValue = countryFilterField.getEditor().getText();\n+    if(fieldValue.isEmpty())\n+      return true;\n+\n+    Optional<Player> playerOptional = chatUser.getPlayer();\n+\n+    if(!playerOptional.isPresent())\n+      return false;\n+\n+    Player player = playerOptional.get();\n+\n+    var country = player.getCountry();", "originalCommit": "01e0898a2658167ec9f307a00759a581ff3fe782", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjY0OTM2Nw==", "url": "https://github.com/FAForever/downlords-faf-client/pull/1979#discussion_r506649367", "bodyText": "still", "author": "1-alex98", "createdAt": "2020-10-16T18:21:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjk1ODM3Nw=="}], "type": "inlineReview"}, {"oid": "b56347539bc8d5835413ddcd3bcee2805b1f9fdf", "url": "https://github.com/FAForever/downlords-faf-client/commit/b56347539bc8d5835413ddcd3bcee2805b1f9fdf", "message": "#1978 implemented country filter using a TextField instead of ComboBox", "committedDate": "2020-10-12T18:07:38Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjY0ODM1OA==", "url": "https://github.com/FAForever/downlords-faf-client/pull/1979#discussion_r506648358", "bodyText": "Use @RequiredArgsConstructor above the class instead", "author": "1-alex98", "createdAt": "2020-10-16T18:19:12Z", "path": "src/main/java/com/faforever/client/chat/CountryFlagService.java", "diffHunk": "@@ -24,6 +30,12 @@\n   private static final Logger logger = LoggerFactory.getLogger(MethodHandles.lookup().lookupClass());\n \n   private static final Collection<String> NON_COUNTRY_CODES = Arrays.asList(\"A1\", \"A2\", \"\");\n+  private final I18n i18n;\n+\n+  public CountryFlagService(I18n i18n) {\n+    this.i18n = i18n;\n+  }", "originalCommit": "b56347539bc8d5835413ddcd3bcee2805b1f9fdf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "2e779f839829bc65f5863214a68b5706a321ea50", "url": "https://github.com/FAForever/downlords-faf-client/commit/2e779f839829bc65f5863214a68b5706a321ea50", "message": "#1978 Made some minor changes to satisfy the standards", "committedDate": "2020-10-18T09:08:56Z", "type": "commit"}, {"oid": "0d890c1cdf795178ee4413d52c49d375e0f4c013", "url": "https://github.com/FAForever/downlords-faf-client/commit/0d890c1cdf795178ee4413d52c49d375e0f4c013", "message": "Merge remote-tracking branch 'faf/develop' into develop", "committedDate": "2020-10-19T17:10:58Z", "type": "commit"}, {"oid": "d55679a3bd3c5e8193c48936ecf986e7790e032d", "url": "https://github.com/FAForever/downlords-faf-client/commit/d55679a3bd3c5e8193c48936ecf986e7790e032d", "message": "Merge remote-tracking branch 'faf/develop' into develop\n\n# Conflicts:\n#\tsrc/main/resources/i18n/messages.properties", "committedDate": "2020-10-19T17:17:30Z", "type": "commit"}]}