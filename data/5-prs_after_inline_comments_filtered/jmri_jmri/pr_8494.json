{"pr_number": 8494, "pr_title": "SPROG CBUS mode switcher", "pr_createdAt": "2020-05-06T15:54:48Z", "pr_url": "https://github.com/JMRI/JMRI/pull/8494", "timeline": [{"oid": "652fe21ebf6e3a1e55b799e1601fc8b475b4dfcd", "url": "https://github.com/JMRI/JMRI/commit/652fe21ebf6e3a1e55b799e1601fc8b475b4dfcd", "message": "CBUS switch between programmer and command station modes\n\nAdded ability to swicth between programmer and command station modes, updating the programmer status in the DP3 gui as appropriate.", "committedDate": "2020-05-06T15:50:28Z", "type": "commit"}, {"oid": "5e5c8d66e15b873c92e96fb4b8222b660d001b74", "url": "https://github.com/JMRI/JMRI/commit/5e5c8d66e15b873c92e96fb4b8222b660d001b74", "message": "Merge branch 'master' into WIP--Mode-Switcher", "committedDate": "2020-05-06T15:51:22Z", "type": "commit"}, {"oid": "2749319c0ebc061f24d82f79043bab7194eba5c2", "url": "https://github.com/JMRI/JMRI/commit/2749319c0ebc061f24d82f79043bab7194eba5c2", "message": "Rework mode changer to remove InstanceManager changes", "committedDate": "2020-05-07T19:20:11Z", "type": "commit"}, {"oid": "7f33d4f0dbe4bc75913d73385fa551755d9385c3", "url": "https://github.com/JMRI/JMRI/commit/7f33d4f0dbe4bc75913d73385fa551755d9385c3", "message": "Use correct classes and rename tests", "committedDate": "2020-05-07T20:00:44Z", "type": "commit"}, {"oid": "0940d61b93ba90f12fecb74684d7253c37043f7c", "url": "https://github.com/JMRI/JMRI/commit/0940d61b93ba90f12fecb74684d7253c37043f7c", "message": "Fire events when programmer properties change", "committedDate": "2020-05-09T00:43:23Z", "type": "commit"}, {"oid": "2f2bfffb42aee472e66264df720e405aaa3be991", "url": "https://github.com/JMRI/JMRI/commit/2f2bfffb42aee472e66264df720e405aaa3be991", "message": "fix: listen to existing programmer managers", "committedDate": "2020-05-09T09:40:51Z", "type": "commit"}, {"oid": "4c455d7c7fa80df4dcf3e6d5641d5a9a084b3a4a", "url": "https://github.com/JMRI/JMRI/commit/4c455d7c7fa80df4dcf3e6d5641d5a9a084b3a4a", "message": "Merge pull request #1 from rhwood/live-programming-modes\n\nfeat: Fire events when programmer properties change", "committedDate": "2020-05-09T13:07:59Z", "type": "commit"}, {"oid": "78c31fc7931a4263fc0c0d60aa543f6f54d118e3", "url": "https://github.com/JMRI/JMRI/commit/78c31fc7931a4263fc0c0d60aa543f6f54d118e3", "message": "Revert \"Use correct classes and rename tests\"\n\nThis reverts commit 7f33d4f0dbe4bc75913d73385fa551755d9385c3.", "committedDate": "2020-05-09T13:51:26Z", "type": "commit"}, {"oid": "d01c01816378f6570606e1f4ebcbfc3ed96c2c05", "url": "https://github.com/JMRI/JMRI/commit/d01c01816378f6570606e1f4ebcbfc3ed96c2c05", "message": "Revert \"Revert \"Use correct classes and rename tests\"\"\n\nThis reverts commit 78c31fc7931a4263fc0c0d60aa543f6f54d118e3.", "committedDate": "2020-05-09T13:52:02Z", "type": "commit"}, {"oid": "fcfd97baea5b8d3514e87b47de5f4d0a2f2ac30e", "url": "https://github.com/JMRI/JMRI/commit/fcfd97baea5b8d3514e87b47de5f4d0a2f2ac30e", "message": "Revert \"Revert \"Revert \"Use correct classes and rename tests\"\"\"\n\nThis reverts commit d01c01816378f6570606e1f4ebcbfc3ed96c2c05.", "committedDate": "2020-05-09T13:52:11Z", "type": "commit"}, {"oid": "3e3b97242f594434dae966084ec158669cb684e2", "url": "https://github.com/JMRI/JMRI/commit/3e3b97242f594434dae966084ec158669cb684e2", "message": "Revert \"Rework mode changer to remove InstanceManager changes\"\n\nThis reverts commit 2749319c0ebc061f24d82f79043bab7194eba5c2.", "committedDate": "2020-05-09T13:52:23Z", "type": "commit"}, {"oid": "a67995aeb636da22c74442389af50bf15e3f4968", "url": "https://github.com/JMRI/JMRI/commit/a67995aeb636da22c74442389af50bf15e3f4968", "message": "Merge branch 'WIP--Mode-Switcher' of https://github.com/crosland/JMRI into WIP--Mode-Switcher", "committedDate": "2020-05-09T13:53:18Z", "type": "commit"}, {"oid": "7bba800770071dd62e03a6b7da5228e946bad2e8", "url": "https://github.com/JMRI/JMRI/commit/7bba800770071dd62e03a6b7da5228e946bad2e8", "message": "Use more descriptive name", "committedDate": "2020-05-09T17:44:45Z", "type": "commit"}, {"oid": "a2bc3082d4c45e5c08d9b4d1239640ec092fd236", "url": "https://github.com/JMRI/JMRI/commit/a2bc3082d4c45e5c08d9b4d1239640ec092fd236", "message": "Merge remote-tracking branch 'upstream/master' into WIP--Mode-Switcher", "committedDate": "2020-05-10T12:26:12Z", "type": "commit"}, {"oid": "235ec5bc3537df4216cc2761275e042cf14b98ad", "url": "https://github.com/JMRI/JMRI/commit/235ec5bc3537df4216cc2761275e042cf14b98ad", "message": "Add preferences support", "committedDate": "2020-05-10T18:40:07Z", "type": "commit"}, {"oid": "f18db17630e0541792b63b927cb36c2e8c7b2fa5", "url": "https://github.com/JMRI/JMRI/commit/f18db17630e0541792b63b927cb36c2e8c7b2fa5", "message": "Register preferences with InstanceManager", "committedDate": "2020-05-10T19:37:31Z", "type": "commit"}, {"oid": "8a9ee37da170686b0f318772763bbbb2d00ad3cb", "url": "https://github.com/JMRI/JMRI/commit/8a9ee37da170686b0f318772763bbbb2d00ad3cb", "message": "Catch possible null pointer", "committedDate": "2020-05-11T12:00:45Z", "type": "commit"}, {"oid": "a3597f46e43733e11b2d1e15506aa3af58965bed", "url": "https://github.com/JMRI/JMRI/commit/a3597f46e43733e11b2d1e15506aa3af58965bed", "message": "Merge branch 'master' into WIP--Mode-Switcher", "committedDate": "2020-05-11T12:01:25Z", "type": "commit"}, {"oid": "9e0705a824b57f45a8222e261c9ea4f14ed60ba6", "url": "https://github.com/JMRI/JMRI/commit/9e0705a824b57f45a8222e261c9ea4f14ed60ba6", "message": "Always register CBUS programming hardware\n\nHardware must be registered with the instance manager so that it's known about when we try to re-enable it if saved preferences initially set it to disabled", "committedDate": "2020-05-11T15:06:04Z", "type": "commit"}, {"oid": "8ea74c94ea8ada80c1f1b5417c1068260dca47b9", "url": "https://github.com/JMRI/JMRI/commit/8ea74c94ea8ada80c1f1b5417c1068260dca47b9", "message": "Add Node Variable writet to set connected hardware mode", "committedDate": "2020-05-11T18:42:09Z", "type": "commit"}, {"oid": "e47ffe947b32845aa4c16e62070b07db2c4392fb", "url": "https://github.com/JMRI/JMRI/commit/e47ffe947b32845aa4c16e62070b07db2c4392fb", "message": "Fix tests", "committedDate": "2020-05-11T19:33:31Z", "type": "commit"}, {"oid": "03ef489c40aa78a8d84f5b0c74a1678af6120722", "url": "https://github.com/JMRI/JMRI/commit/03ef489c40aa78a8d84f5b0c74a1678af6120722", "message": "Add missing supr call in teardown", "committedDate": "2020-05-12T08:44:57Z", "type": "commit"}, {"oid": "6df2dc82daad5e31c8778e5b99b3dbc4d03aabf1", "url": "https://github.com/JMRI/JMRI/commit/6df2dc82daad5e31c8778e5b99b3dbc4d03aabf1", "message": "Another attempt to get test to pass", "committedDate": "2020-05-12T09:40:13Z", "type": "commit"}, {"oid": "65d20bde832c6917a9c27c373ddbfabd39471c5a", "url": "https://github.com/JMRI/JMRI/commit/65d20bde832c6917a9c27c373ddbfabd39471c5a", "message": "Remove programmer after test", "committedDate": "2020-05-12T11:21:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE2ODI1MA==", "url": "https://github.com/JMRI/JMRI/pull/8494#discussion_r424168250", "bodyText": "What kind of errors lead to this comment?  It looks strange having a Pane on the class name, but inheriting from a frame.  We either need to fix the class or change the name.", "author": "pabender", "createdAt": "2020-05-13T04:39:41Z", "path": "java/src/jmri/jmrix/can/cbus/swing/modeswitcher/SprogCbusModeSwitcherPane.java", "diffHunk": "@@ -0,0 +1,236 @@\n+package jmri.jmrix.can.cbus.swing.modeswitcher;\n+\n+import java.awt.BorderLayout;\n+import java.awt.event.ActionListener;\n+import javax.swing.BorderFactory;\n+import javax.swing.BoxLayout;\n+import javax.swing.JLabel;\n+import javax.swing.JPanel;\n+import javax.swing.JRadioButton;\n+import jmri.GlobalProgrammerManager;\n+import jmri.InstanceManager;\n+import jmri.jmrix.can.CanListener;\n+import jmri.jmrix.can.CanMessage;\n+import jmri.jmrix.can.CanReply;\n+import jmri.jmrix.can.CanSystemConnectionMemo;\n+import jmri.jmrix.can.TrafficController;\n+import jmri.jmrix.can.cbus.CbusDccProgrammerManager;\n+import jmri.jmrix.can.cbus.CbusPreferences;\n+import jmri.jmrix.can.cbus.CbusSend;\n+import jmri.jmrix.can.cbus.node.CbusNode;\n+import jmri.jmrix.can.cbus.node.CbusNodeTableDataModel;\n+import jmri.util.JmriJFrame;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * Mode Switcher to switch modes between programmer and command station.\n+ *\n+ * No matter what I tried, I cannot get the label text to wrap when added to a\n+ * CanNamedPane, so this is implemented as a JmriJFrame.", "originalCommit": "65d20bde832c6917a9c27c373ddbfabd39471c5a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDI4MTMzOA==", "url": "https://github.com/JMRI/JMRI/pull/8494#discussion_r424281338", "bodyText": "Ah, that's left over from trying to use a CanNamedPane. See https://jmri-developers.groups.io/g/jmri/message/3326 I switched to a JmriJFrame instead . I have now renamed the class.", "author": "crosland", "createdAt": "2020-05-13T08:57:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE2ODI1MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE2OTc5MA==", "url": "https://github.com/JMRI/JMRI/pull/8494#discussion_r424169790", "bodyText": "You don\u2019t want to call JUnitUtil.resetWindows before the call to super.tearDown.  super.tearDown disposes of the frame and then calls resetWindows.", "author": "pabender", "createdAt": "2020-05-13T04:46:42Z", "path": "java/test/jmri/jmrix/can/cbus/swing/modeswitcher/SprogCbusModeSwitcherPaneTest.java", "diffHunk": "@@ -0,0 +1,63 @@\n+package jmri.jmrix.can.cbus.swing.modeswitcher;\n+\n+import java.awt.GraphicsEnvironment;\n+import jmri.GlobalProgrammerManager;\n+import jmri.jmrix.can.CanSystemConnectionMemo;\n+import jmri.jmrix.can.TrafficControllerScaffold;\n+import jmri.jmrix.can.cbus.CbusDccProgrammer;\n+import jmri.jmrix.can.cbus.CbusDccProgrammerManager;\n+import jmri.jmrix.can.cbus.CbusPreferences;\n+import jmri.util.JUnitUtil;\n+import org.junit.After;\n+import org.junit.Assume;\n+import org.junit.Before;\n+import org.junit.Test;\n+\n+/**\n+ * Tests for the ModeSwitcherPane class\n+ *\n+ * @author Andrew Crosland (C) 2020\n+ */\n+public class SprogCbusModeSwitcherPaneTest extends jmri.util.JmriJFrameTestBase {\n+\n+    CanSystemConnectionMemo memo;\n+    CbusDccProgrammer prog;\n+    jmri.jmrix.can.TrafficController tc;\n+    \n+    @Test\n+    public void testInitComponents() throws Exception{\n+        Assume.assumeFalse(GraphicsEnvironment.isHeadless());\n+        // for now, just make sure there isn't an exception.\n+        ((SprogCbusModeSwitcherPane) frame).initComponents();\n+    }\n+\n+    @Before\n+    @Override\n+    public void setUp() {\n+        JUnitUtil.setUp();\n+        \n+        jmri.InstanceManager.setDefault(jmri.jmrix.can.cbus.CbusPreferences.class,new CbusPreferences() );\n+\n+        tc = new TrafficControllerScaffold();\n+        memo = new CanSystemConnectionMemo();\n+        memo.setTrafficController(tc);\n+        prog = new CbusDccProgrammer(tc);\n+        \n+        jmri.InstanceManager.setDefault(GlobalProgrammerManager.class,new CbusDccProgrammerManager(prog, memo) );\n+        if (!GraphicsEnvironment.isHeadless()) {\n+            frame = new SprogCbusModeSwitcherPane(memo);\n+        }\n+    }\n+\n+    @After\n+    @Override\n+    public void tearDown() {\n+        prog = null;\n+        tc.terminateThreads();\n+        memo.dispose();\n+        tc = null;\n+        memo = null;\n+        JUnitUtil.resetWindows(false,false);\n+        super.tearDown();", "originalCommit": "65d20bde832c6917a9c27c373ddbfabd39471c5a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDI4MTc3MA==", "url": "https://github.com/JMRI/JMRI/pull/8494#discussion_r424281770", "bodyText": "OK, I added that as I saw it used in another test and thought it may help.", "author": "crosland", "createdAt": "2020-05-13T08:58:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE2OTc5MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE3MDU3NQ==", "url": "https://github.com/JMRI/JMRI/pull/8494#discussion_r424170575", "bodyText": "You really don\u2019t need this test.  initComponets is called as part of testShowAndClose in the base class.", "author": "pabender", "createdAt": "2020-05-13T04:50:01Z", "path": "java/test/jmri/jmrix/can/cbus/swing/modeswitcher/SprogCbusModeSwitcherPaneTest.java", "diffHunk": "@@ -0,0 +1,63 @@\n+package jmri.jmrix.can.cbus.swing.modeswitcher;\n+\n+import java.awt.GraphicsEnvironment;\n+import jmri.GlobalProgrammerManager;\n+import jmri.jmrix.can.CanSystemConnectionMemo;\n+import jmri.jmrix.can.TrafficControllerScaffold;\n+import jmri.jmrix.can.cbus.CbusDccProgrammer;\n+import jmri.jmrix.can.cbus.CbusDccProgrammerManager;\n+import jmri.jmrix.can.cbus.CbusPreferences;\n+import jmri.util.JUnitUtil;\n+import org.junit.After;\n+import org.junit.Assume;\n+import org.junit.Before;\n+import org.junit.Test;\n+\n+/**\n+ * Tests for the ModeSwitcherPane class\n+ *\n+ * @author Andrew Crosland (C) 2020\n+ */\n+public class SprogCbusModeSwitcherPaneTest extends jmri.util.JmriJFrameTestBase {\n+\n+    CanSystemConnectionMemo memo;\n+    CbusDccProgrammer prog;\n+    jmri.jmrix.can.TrafficController tc;\n+    \n+    @Test\n+    public void testInitComponents() throws Exception{", "originalCommit": "65d20bde832c6917a9c27c373ddbfabd39471c5a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDI4Mjc3Nw==", "url": "https://github.com/JMRI/JMRI/pull/8494#discussion_r424282777", "bodyText": "OK. Again, I think this is copied from another test that I used as a template but I may be confusing between testing JmriJFrames and other panes.", "author": "crosland", "createdAt": "2020-05-13T08:59:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE3MDU3NQ=="}], "type": "inlineReview"}, {"oid": "53d397183d39e02356c2172ba6efef26e10ed00b", "url": "https://github.com/JMRI/JMRI/commit/53d397183d39e02356c2172ba6efef26e10ed00b", "message": "Changes recommended by @pabender comments in PR", "committedDate": "2020-05-13T09:00:14Z", "type": "commit"}, {"oid": "6598f1f801848d5469266771b1857864e00bd9e6", "url": "https://github.com/JMRI/JMRI/commit/6598f1f801848d5469266771b1857864e00bd9e6", "message": "call super.dispose()", "committedDate": "2020-05-13T10:23:53Z", "type": "commit"}]}