{"pr_number": 9201, "pr_title": "Warrant track speeds", "pr_createdAt": "2020-12-05T18:27:07Z", "pr_url": "https://github.com/JMRI/JMRI/pull/9201", "timeline": [{"oid": "463e2d2fe5f8f1f09a13c2c78313840634f74d9c", "url": "https://github.com/JMRI/JMRI/commit/463e2d2fe5f8f1f09a13c2c78313840634f74d9c", "message": "rework ramp algorithm. add auto speed profiling.\nfix 'linting' bugs.", "committedDate": "2020-12-02T02:17:08Z", "type": "commit"}, {"oid": "2c2203eb55e8b9071b8f5a548b20f271b294a6bc", "url": "https://github.com/JMRI/JMRI/commit/2c2203eb55e8b9071b8f5a548b20f271b294a6bc", "message": "Merge branch 'master' of https://github.com/JMRI/JMRI into pcWarrantTrackSpeeds", "committedDate": "2020-12-02T03:08:26Z", "type": "commit"}, {"oid": "a8168bc1cdc502c213ee0f34d75b8396c4364b37", "url": "https://github.com/JMRI/JMRI/commit/a8168bc1cdc502c213ee0f34d75b8396c4364b37", "message": "Remove non-roster addresses from shutDown task", "committedDate": "2020-12-03T22:24:13Z", "type": "commit"}, {"oid": "31aab52e5b418bab538b722dc99e04db481e757a", "url": "https://github.com/JMRI/JMRI/commit/31aab52e5b418bab538b722dc99e04db481e757a", "message": "Fix static analysis problems", "committedDate": "2020-12-03T22:45:42Z", "type": "commit"}, {"oid": "7879f7509e96dd502a4cdb253217cbca417a9eda", "url": "https://github.com/JMRI/JMRI/commit/7879f7509e96dd502a4cdb253217cbca417a9eda", "message": "fix static analysis", "committedDate": "2020-12-04T00:14:24Z", "type": "commit"}, {"oid": "f1fdecc02930df32c5612dd024a43312c27b14c8", "url": "https://github.com/JMRI/JMRI/commit/f1fdecc02930df32c5612dd024a43312c27b14c8", "message": "Static analysis", "committedDate": "2020-12-04T00:38:39Z", "type": "commit"}, {"oid": "88e943ae7934123a2608a4a2a22fe0e7207ac758", "url": "https://github.com/JMRI/JMRI/commit/88e943ae7934123a2608a4a2a22fe0e7207ac758", "message": "remove clearShutDownManager teardown", "committedDate": "2020-12-04T22:01:59Z", "type": "commit"}, {"oid": "0ee302a751055452614b9b2f45e9ffd211a446f6", "url": "https://github.com/JMRI/JMRI/commit/0ee302a751055452614b9b2f45e9ffd211a446f6", "message": "Merge branch 'master' of https://github.com/JMRI/JMRI into pcWarrantTrackSpeeds", "committedDate": "2020-12-04T22:09:01Z", "type": "commit"}, {"oid": "f83bf42415c2bba5a26ae51332521c49ec018224", "url": "https://github.com/JMRI/JMRI/commit/f83bf42415c2bba5a26ae51332521c49ec018224", "message": "Possibly a fix to travis-ci failure", "committedDate": "2020-12-05T20:09:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjkwMTc5NA==", "url": "https://github.com/JMRI/JMRI/pull/9201#discussion_r536901794", "bodyText": "If rlist.get(0) is not a WarrantShutdownTask, this will be an infinite loop. I suggest an else statement that throws an exception or breaks out of the loop.", "author": "danielb987", "createdAt": "2020-12-05T22:08:41Z", "path": "java/test/jmri/jmrit/logix/LearnWarrantTest.java", "diffHunk": "@@ -201,25 +200,31 @@ private Sensor recordtimes(String[] route, DccThrottle throttle) throws Exceptio\n     @BeforeEach\n     public void setUp() {\n         JUnitUtil.setUp();\n+        JUnitUtil.resetInstanceManager();\n         jmri.util.JUnitUtil.resetProfileManager();\n         JUnitUtil.initConfigureManager();\n         JUnitUtil.initInternalTurnoutManager();\n-        JUnitUtil.initInternalLightManager();\n         JUnitUtil.initInternalSensorManager();\n-        JUnitUtil.initInternalSignalHeadManager();\n         JUnitUtil.initDebugPowerManager();\n-        JUnitUtil.initDebugThrottleManager();\n-        JUnitUtil.initMemoryManager();\n         JUnitUtil.initOBlockManager();\n         JUnitUtil.initLogixManager();\n-        JUnitUtil.initConditionalManager();\n         WarrantPreferences.getDefault().setShutdown(WarrantPreferences.Shutdown.NO_MERGE);\n         JUnitUtil.initWarrantManager();\n+        JUnitUtil.initDebugThrottleManager();\n     }\n \n     @AfterEach\n     public void tearDown() {\n-        JUnitUtil.clearShutDownManager(); // should be converted to check of scheduled ShutDownActions\n+        if (InstanceManager.containsDefault(ShutDownManager.class)) {\n+            ShutDownManager sm = InstanceManager.getDefault(jmri.ShutDownManager.class);\n+            List<Runnable> rlist = sm.getRunnables();\n+            while (!rlist.isEmpty()) {\n+                if (rlist.get(0) instanceof jmri.jmrit.logix.WarrantShutdownTask) {\n+                    sm.deregister((ShutDownTask)rlist.get(0));\n+                    rlist = sm.getRunnables();\n+                }\n+            }", "originalCommit": "f83bf42415c2bba5a26ae51332521c49ec018224", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjkwMTkyMw==", "url": "https://github.com/JMRI/JMRI/pull/9201#discussion_r536901923", "bodyText": "If rlist.get(0) is not a WarrantShutdownTask, this will be an infinite loop. I suggest an else statement that throws an exception or breaks out of the loop.", "author": "danielb987", "createdAt": "2020-12-05T22:09:30Z", "path": "java/test/jmri/jmrit/logix/LinkedWarrantTest.java", "diffHunk": "@@ -354,7 +356,16 @@ public void tearDown() {\n         _sensorMgr.dispose();\n         _sensorMgr = null;\n         \n-        JUnitUtil.clearShutDownManager(); // should be converted to check of scheduled ShutDownActions\n+        if (InstanceManager.containsDefault(ShutDownManager.class)) {\n+            ShutDownManager sm = InstanceManager.getDefault(jmri.ShutDownManager.class);\n+            List<Runnable> rlist = sm.getRunnables();\n+            while (!rlist.isEmpty()) {\n+                if (rlist.get(0) instanceof jmri.jmrit.logix.WarrantShutdownTask) {\n+                    sm.deregister((ShutDownTask)rlist.get(0));\n+                    rlist = sm.getRunnables();\n+                }\n+            }", "originalCommit": "f83bf42415c2bba5a26ae51332521c49ec018224", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "ff37a9ff38887e124b7e01eaf859a1d46832c265", "url": "https://github.com/JMRI/JMRI/commit/ff37a9ff38887e124b7e01eaf859a1d46832c265", "message": "use JUnitUtil.clearShutDownManager() instead of checking and\nderegistering", "committedDate": "2020-12-05T22:35:01Z", "type": "commit"}, {"oid": "5904a142801e46dd62ccd57e598112d55c1e5ab9", "url": "https://github.com/JMRI/JMRI/commit/5904a142801e46dd62ccd57e598112d55c1e5ab9", "message": "try again", "committedDate": "2020-12-05T22:49:20Z", "type": "commit"}, {"oid": "29fba1d09a86c65431f8b51747c66c339444abcd", "url": "https://github.com/JMRI/JMRI/commit/29fba1d09a86c65431f8b51747c66c339444abcd", "message": "Add clearShutDownManager() again", "committedDate": "2020-12-05T23:45:30Z", "type": "commit"}, {"oid": "f76d9813d0624768d608bc3734d6e5d1d17754c3", "url": "https://github.com/JMRI/JMRI/commit/f76d9813d0624768d608bc3734d6e5d1d17754c3", "message": "Maybe this will help...", "committedDate": "2020-12-06T02:29:04Z", "type": "commit"}]}