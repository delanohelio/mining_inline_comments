{"pr_number": 8384, "pr_title": "Spotbugs Null on some path", "pr_createdAt": "2020-04-19T11:46:14Z", "pr_url": "https://github.com/JMRI/JMRI/pull/8384", "timeline": [{"oid": "1ca821bce5f8d394b06467199245c1c80b5e70d3", "url": "https://github.com/JMRI/JMRI/commit/1ca821bce5f8d394b06467199245c1c80b5e70d3", "message": "NP_NULL_ON_SOME_PATH_FROM_RETURN_VALUE", "committedDate": "2020-04-19T00:40:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDkwMTg5Ng==", "url": "https://github.com/JMRI/JMRI/pull/8384#discussion_r410901896", "bodyText": "Please use a SuppressWarning annotation here\u2014if someone has removed parts of a JMRI installation that we can\u2019t compile without, we should crash on the NPE (or whatever error the JmriScriptEngineManager will throw because missing dependencies are not present instead of logging here.", "author": "rhwood", "createdAt": "2020-04-19T13:11:04Z", "path": "java/src/jmri/jmrit/jython/JynstrumentFactory.java", "diffHunk": "@@ -33,6 +33,10 @@ public static Jynstrument createInstrument(String path, Object context) {\n         }\n         String jyFile = path + File.separator + className + \".py\";\n         ScriptEngine engine = JmriScriptEngineManager.getDefault().getEngine(JmriScriptEngineManager.PYTHON);\n+        if (engine==null){", "originalCommit": "1ca821bce5f8d394b06467199245c1c80b5e70d3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTM5MDkxMw==", "url": "https://github.com/JMRI/JMRI/pull/8384#discussion_r411390913", "bodyText": "Thanks, changed to annotation.", "author": "icklesteve", "createdAt": "2020-04-20T13:47:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDkwMTg5Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDkwMjYxNA==", "url": "https://github.com/JMRI/JMRI/pull/8384#discussion_r410902614", "bodyText": "It is not an internal error for a LayoutBlock to be null, so a JsonException should not indicate such. Also the doGet you replaced will either return a non-null result or throw a JsonException, so this check here for null is merely complexity for a situation that should not be possible.", "author": "rhwood", "createdAt": "2020-04-19T13:14:48Z", "path": "java/src/jmri/server/json/layoutblock/JsonLayoutBlockHttpService.java", "diffHunk": "@@ -52,7 +52,11 @@ public JsonLayoutBlockHttpService(ObjectMapper mapper) {\n \n     @Override\n     public JsonNode doGet(String type, String name, JsonNode data, JsonRequest request) throws JsonException {\n-        return doGet(InstanceManager.getDefault(LayoutBlockManager.class).getBySystemName(name), name, type, request);", "originalCommit": "1ca821bce5f8d394b06467199245c1c80b5e70d3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTM5MTE0Mg==", "url": "https://github.com/JMRI/JMRI/pull/8384#discussion_r411391142", "bodyText": "Thanks, changed to annotation.", "author": "icklesteve", "createdAt": "2020-04-20T13:47:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDkwMjYxNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDkwMjc2NQ==", "url": "https://github.com/JMRI/JMRI/pull/8384#discussion_r410902765", "bodyText": "Please use a SuppressWarning annotation here\u2014if someone has removed parts of a JMRI installation that we can\u2019t compile without, we should crash on the NPE (or whatever error the JmriScriptEngineManager will throw because missing dependencies are not present instead of logging here.", "author": "rhwood", "createdAt": "2020-04-19T13:15:40Z", "path": "java/src/jmri/jmrit/jython/InputWindow.java", "diffHunk": "@@ -179,7 +179,10 @@ protected boolean loadFile(JFileChooser fileChooser) {\n                     languages.setSelectedItem(JmriScriptEngineManager.getDefault().getFactoryByExtension(Files.getFileExtension(file.getName())).getLanguageName());\n                 } catch (ScriptException npe) {\n                     log.error(\"Unable to identify script language for {}, assuming its Python.\", file);\n-                    languages.setSelectedItem(JmriScriptEngineManager.getDefault().getFactory(JmriScriptEngineManager.PYTHON).getLanguageName());", "originalCommit": "1ca821bce5f8d394b06467199245c1c80b5e70d3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTM5MTM0OA==", "url": "https://github.com/JMRI/JMRI/pull/8384#discussion_r411391348", "bodyText": "Thanks, changed to annotation.", "author": "icklesteve", "createdAt": "2020-04-20T13:48:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDkwMjc2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDkxMzY1NQ==", "url": "https://github.com/JMRI/JMRI/pull/8384#discussion_r410913655", "bodyText": "Do we have a test that makes sure colorToColorName and colorToString produce the same results for the named colors?\nMy concern is that the strings produced here MAY be stored in panel files, and we need to make sure we don\u2019t break that.", "author": "pabender", "createdAt": "2020-04-19T14:06:18Z", "path": "java/src/jmri/jmrit/display/layoutEditor/LayoutEditor.java", "diffHunk": "@@ -7144,7 +7144,7 @@ public Color getDefaultTrackColorColor() {\n \n     @Nonnull\n     public String getDefaultOccupiedTrackColor() {\n-        return ColorUtil.colorToColorName(defaultOccupiedTrackColor);\n+        return ColorUtil.colorToString(defaultOccupiedTrackColor);", "originalCommit": "1ca821bce5f8d394b06467199245c1c80b5e70d3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTM5Njc2Mw==", "url": "https://github.com/JMRI/JMRI/pull/8384#discussion_r411396763", "bodyText": "Thanks Paul, a justified concern, the replacement method doesn't covert to RGB strings.\nHave changed to annotation, as far as I can make out, colorToString will only return null if null passed.", "author": "icklesteve", "createdAt": "2020-04-20T13:54:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDkxMzY1NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDkxMzgyNA==", "url": "https://github.com/JMRI/JMRI/pull/8384#discussion_r410913824", "bodyText": "Same comment about colors", "author": "pabender", "createdAt": "2020-04-19T14:07:42Z", "path": "java/src/jmri/jmrit/display/layoutEditor/LayoutEditor.java", "diffHunk": "@@ -7160,7 +7160,7 @@ public Color getDefaultOccupiedTrackColorColor() {\n \n     @Nonnull\n     public String getDefaultAlternativeTrackColor() {\n-        return ColorUtil.colorToColorName(defaultAlternativeTrackColor);\n+        return ColorUtil.colorToString(defaultAlternativeTrackColor);", "originalCommit": "1ca821bce5f8d394b06467199245c1c80b5e70d3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDkxMzg3MQ==", "url": "https://github.com/JMRI/JMRI/pull/8384#discussion_r410913871", "bodyText": "Same comment about colors", "author": "pabender", "createdAt": "2020-04-19T14:07:55Z", "path": "java/src/jmri/jmrit/display/layoutEditor/LayoutEditor.java", "diffHunk": "@@ -7176,17 +7176,17 @@ public Color getDefaultAlternativeTrackColorColor() {\n \n     @Nonnull\n     public String getDefaultTextColor() {\n-        return ColorUtil.colorToColorName(defaultTextColor);\n+        return ColorUtil.colorToString(defaultTextColor);", "originalCommit": "1ca821bce5f8d394b06467199245c1c80b5e70d3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDkxMzkwMw==", "url": "https://github.com/JMRI/JMRI/pull/8384#discussion_r410913903", "bodyText": "Same comment about colors", "author": "pabender", "createdAt": "2020-04-19T14:08:05Z", "path": "java/src/jmri/jmrit/display/layoutEditor/LayoutEditor.java", "diffHunk": "@@ -7176,17 +7176,17 @@ public Color getDefaultAlternativeTrackColorColor() {\n \n     @Nonnull\n     public String getDefaultTextColor() {\n-        return ColorUtil.colorToColorName(defaultTextColor);\n+        return ColorUtil.colorToString(defaultTextColor);\n     }\n \n     @Nonnull\n     public String getTurnoutCircleColor() {\n-        return ColorUtil.colorToColorName(turnoutCircleColor);\n+        return ColorUtil.colorToString(turnoutCircleColor);", "originalCommit": "1ca821bce5f8d394b06467199245c1c80b5e70d3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDkxMzk2MQ==", "url": "https://github.com/JMRI/JMRI/pull/8384#discussion_r410913961", "bodyText": "Same comment about colors", "author": "pabender", "createdAt": "2020-04-19T14:08:15Z", "path": "java/src/jmri/jmrit/display/layoutEditor/LayoutEditor.java", "diffHunk": "@@ -7176,17 +7176,17 @@ public Color getDefaultAlternativeTrackColorColor() {\n \n     @Nonnull\n     public String getDefaultTextColor() {\n-        return ColorUtil.colorToColorName(defaultTextColor);\n+        return ColorUtil.colorToString(defaultTextColor);\n     }\n \n     @Nonnull\n     public String getTurnoutCircleColor() {\n-        return ColorUtil.colorToColorName(turnoutCircleColor);\n+        return ColorUtil.colorToString(turnoutCircleColor);\n     }\n \n     @Nonnull\n     public String getTurnoutCircleThrownColor() {\n-        return ColorUtil.colorToColorName(turnoutCircleThrownColor);\n+        return ColorUtil.colorToString(turnoutCircleThrownColor);", "originalCommit": "1ca821bce5f8d394b06467199245c1c80b5e70d3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "4cc22a69a37217f11ffcc1de3bdbb4d21f1218b9", "url": "https://github.com/JMRI/JMRI/commit/4cc22a69a37217f11ffcc1de3bdbb4d21f1218b9", "message": "add SuppressFBWarnings as per feedback", "committedDate": "2020-04-20T13:40:25Z", "type": "commit"}, {"oid": "6ef216b4e2a33a859cde9cc6973a115d42e341d6", "url": "https://github.com/JMRI/JMRI/commit/6ef216b4e2a33a859cde9cc6973a115d42e341d6", "message": "further annotation", "committedDate": "2020-04-20T15:00:28Z", "type": "commit"}]}