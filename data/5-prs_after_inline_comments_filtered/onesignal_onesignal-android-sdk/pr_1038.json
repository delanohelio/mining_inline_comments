{"pr_number": 1038, "pr_title": "Refactor Influence module to Kotlin", "pr_createdAt": "2020-06-01T23:58:08Z", "pr_url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1038", "timeline": [{"oid": "e18f64461eab0dd8fb460e134d271cf4679488f4", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/e18f64461eab0dd8fb460e134d271cf4679488f4", "message": "Refactor Influence module to Kotlin\n\n  * Change influence module classes from java to kotlin\n  * Remove instrumentedPackage from roboelectric tests, this will make time shadow to not work\n  * Add OSTime for time method access\n  * Mock OSTime on Tests", "committedDate": "2020-06-02T00:00:05Z", "type": "forcePushed"}, {"oid": "dd43281b803c63f2fcbbeca9b052e644d502ee72", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/dd43281b803c63f2fcbbeca9b052e644d502ee72", "message": "Refactor Influence module to Kotlin\n\n  * Change influence module classes from java to kotlin\n  * Remove instrumentedPackage from roboelectric tests, this will make time shadow to not work\n  * Add OSTime for time method access\n  * Mock OSTime on Tests", "committedDate": "2020-06-02T00:05:25Z", "type": "forcePushed"}, {"oid": "72f396baa51d38d30937e3fce3228bf7a28bf17f", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/72f396baa51d38d30937e3fce3228bf7a28bf17f", "message": "Refactor Influence module to Kotlin\n\n  * Change influence module classes from java to kotlin\n  * Remove instrumentedPackage from roboelectric tests, this will make time shadow to not work\n  * Add OSTime for time method access\n  * Mock OSTime on Tests", "committedDate": "2020-07-28T22:44:31Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjYxNDAyOQ==", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1038#discussion_r466614029", "bodyText": "Do we want this to be public?", "author": "mikechoch", "createdAt": "2020-08-06T18:43:54Z", "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OneSignal.java", "diffHunk": "@@ -3072,9 +3073,17 @@ static void fireEmailUpdateFailure() {\n       }\n    }\n \n+   @NonNull\n+   public static OSTime getTime() {", "originalCommit": "dba89a3a54391538f99ccab383ccaa7e20a61af9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzI0NzQ1Ng==", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1038#discussion_r467247456", "bodyText": "good catch!", "author": "Jeasmine", "createdAt": "2020-08-07T20:11:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjYxNDAyOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjYxNjI3Nw==", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1038#discussion_r466616277", "bodyText": "Rename to MockOSTimeImpl to match our real OSTimeImpl?", "author": "mikechoch", "createdAt": "2020-08-06T18:48:05Z", "path": "OneSignalSDK/unittest/src/test/java/com/onesignal/MockOSTime.java", "diffHunk": "@@ -0,0 +1,43 @@\n+package com.onesignal;\n+\n+import android.os.SystemClock;\n+\n+public class MockOSTime implements OSTime {", "originalCommit": "dba89a3a54391538f99ccab383ccaa7e20a61af9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzI0OTgyNA==", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1038#discussion_r467249824", "bodyText": "love this one!", "author": "Jeasmine", "createdAt": "2020-08-07T20:18:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjYxNjI3Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjYxNzM4MQ==", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1038#discussion_r466617381", "bodyText": "Instead of passing everything into the advanceSystemTimeBy maybe we should just call a method inside of time?\nExample:\ntime.advanceSystemTimeBy(604_801)?", "author": "mikechoch", "createdAt": "2020-08-06T18:50:05Z", "path": "OneSignalSDK/unittest/src/test/java/com/test/onesignal/GenerateNotificationRunner.java", "diffHunk": "@@ -836,7 +842,7 @@ public void shouldRestoreNotifications() {\n \n       // Go forward 1 week\n       // Note: Does not effect the SQL function strftime\n-      advanceSystemTimeBy(604_801);\n+      advanceSystemTimeBy(time, 604_801);", "originalCommit": "dba89a3a54391538f99ccab383ccaa7e20a61af9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzI1ODI0Ng==", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1038#discussion_r467258246", "bodyText": ":not_bad: \ud83d\udc4d", "author": "Jeasmine", "createdAt": "2020-08-07T20:39:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjYxNzM4MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjYxOTQ1OA==", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1038#discussion_r466619458", "bodyText": "Add a space advanceSystemAndElapsedTimeBy(time, 0);", "author": "mikechoch", "createdAt": "2020-08-06T18:54:03Z", "path": "OneSignalSDK/unittest/src/test/java/com/test/onesignal/MainOneSignalClassRunner.java", "diffHunk": "@@ -2516,12 +2531,13 @@ public void ensureSyncJobServiceRescheduleOnApiTimeout() throws Exception {\n    }\n \n    private void useAppFor2minThenBackground() throws Exception {\n+      advanceSystemAndElapsedTimeBy(time,0);", "originalCommit": "dba89a3a54391538f99ccab383ccaa7e20a61af9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjYyMTUwMg==", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1038#discussion_r466621502", "bodyText": "Add a space advanceSystemAndElapsedTimeBy(time, 31);", "author": "mikechoch", "createdAt": "2020-08-06T18:57:33Z", "path": "OneSignalSDK/unittest/src/test/java/com/test/onesignal/TestHelpers.java", "diffHunk": "@@ -241,11 +241,11 @@ static void fastColdRestartApp() throws Exception {\n       StaticResetHelper.restSetStaticFields();\n    }\n \n-   static void restartAppAndElapseTimeToNextSession() throws Exception {\n+   static void restartAppAndElapseTimeToNextSession(MockOSTime time) throws Exception {\n       stopAllOSThreads();\n       flushBufferedSharedPrefs();\n       StaticResetHelper.restSetStaticFields();\n-      advanceSystemTimeBy(31);\n+      advanceSystemAndElapsedTimeBy(time,31);", "originalCommit": "dba89a3a54391538f99ccab383ccaa7e20a61af9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "d6186de2a9bd786c3a0d7ff096319e22df9f26e5", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/d6186de2a9bd786c3a0d7ff096319e22df9f26e5", "message": "Code improvement", "committedDate": "2020-08-10T15:24:14Z", "type": "forcePushed"}, {"oid": "37a4e04507d09d0c4820b410594359f3cff50017", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/37a4e04507d09d0c4820b410594359f3cff50017", "message": "Refactor Influence module to Kotlin\n\n  * Change influence module classes from java to kotlin\n  * Remove instrumentedPackage from roboelectric tests, this will make time shadow to not work\n  * Add OSTime for time method access\n  * Mock OSTime on Tests", "committedDate": "2020-08-10T18:20:41Z", "type": "commit"}, {"oid": "818c865eac21a663f1497c7d4c5afa0f25eb8fa4", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/818c865eac21a663f1497c7d4c5afa0f25eb8fa4", "message": "Improve code", "committedDate": "2020-08-10T18:20:41Z", "type": "commit"}, {"oid": "21c7760340816ab101c79d9e2eb373ba36a0edc5", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/21c7760340816ab101c79d9e2eb373ba36a0edc5", "message": "Code improvement", "committedDate": "2020-08-10T18:29:19Z", "type": "commit"}, {"oid": "de9acea2bf8429df57a37192fd022a60a12bdd56", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/de9acea2bf8429df57a37192fd022a60a12bdd56", "message": "Refactor Outcome module to Kotlin\n\n   * Change outcome module classes from java to kotlin", "committedDate": "2020-08-10T18:47:28Z", "type": "commit"}, {"oid": "de9acea2bf8429df57a37192fd022a60a12bdd56", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/de9acea2bf8429df57a37192fd022a60a12bdd56", "message": "Refactor Outcome module to Kotlin\n\n   * Change outcome module classes from java to kotlin", "committedDate": "2020-08-10T18:47:28Z", "type": "forcePushed"}]}