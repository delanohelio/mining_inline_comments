{"pr_number": 476, "pr_title": "[PPL] Add simple json formatter", "pr_createdAt": "2020-05-20T17:30:53Z", "pr_url": "https://github.com/opendistro-for-elasticsearch/sql/pull/476", "timeline": [{"oid": "58828f2223d779f28d1a27cb1e87367709c3f32d", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/58828f2223d779f28d1a27cb1e87367709c3f32d", "message": "Move response listener interface to common module and add java doc", "committedDate": "2020-05-18T18:26:08Z", "type": "commit"}, {"oid": "633730a72cb101f8ef5ee7331d56cb82ac83f904", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/633730a72cb101f8ef5ee7331d56cb82ac83f904", "message": "Add json response formatter and UT", "committedDate": "2020-05-18T21:14:21Z", "type": "commit"}, {"oid": "7dcbfbb274052b5cc84a5ba5e58c4e3fb29a86c4", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/7dcbfbb274052b5cc84a5ba5e58c4e3fb29a86c4", "message": "Add json response formatter and UT", "committedDate": "2020-05-18T23:21:44Z", "type": "commit"}, {"oid": "dc8335d90e7578677a9ed7bee4be384f7e3f0b6d", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/dc8335d90e7578677a9ed7bee4be384f7e3f0b6d", "message": "Add json response formatter and UT", "committedDate": "2020-05-18T23:44:42Z", "type": "commit"}, {"oid": "7c5ce828bcbba56de20f0c14c0508dbe8c0e82ed", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/7c5ce828bcbba56de20f0c14c0508dbe8c0e82ed", "message": "Add enum for pretty format", "committedDate": "2020-05-18T23:51:28Z", "type": "commit"}, {"oid": "65a3391f7061a98fae04f900f0e4df21c392b2c2", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/65a3391f7061a98fae04f900f0e4df21c392b2c2", "message": "Merge branch 'feature/ppl' into add-table-formatter", "committedDate": "2020-05-18T23:52:47Z", "type": "commit"}, {"oid": "be481d73e58119b2767ab2ecc0c7414998e0a4ca", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/be481d73e58119b2767ab2ecc0c7414998e0a4ca", "message": "Move to protocol module", "committedDate": "2020-05-19T23:45:01Z", "type": "commit"}, {"oid": "3e3019ee2e2a08bcd7fa7174f7b849a00edebb4b", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/3e3019ee2e2a08bcd7fa7174f7b849a00edebb4b", "message": "Move to protocol module", "committedDate": "2020-05-19T23:49:40Z", "type": "commit"}, {"oid": "6d37b8b527d99dbf5bc74d97eb9be93ced59702d", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/6d37b8b527d99dbf5bc74d97eb9be93ced59702d", "message": "Implement json formatter", "committedDate": "2020-05-20T00:35:33Z", "type": "commit"}, {"oid": "7c00be111e989c6433e9b96210eb1af64b431c8c", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/7c00be111e989c6433e9b96210eb1af64b431c8c", "message": "Add more UTs", "committedDate": "2020-05-20T03:32:42Z", "type": "commit"}, {"oid": "10a76c685c81725ca74f6150aa595a7e5022671a", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/10a76c685c81725ca74f6150aa595a7e5022671a", "message": "Refactor", "committedDate": "2020-05-20T03:38:25Z", "type": "commit"}, {"oid": "aaaec3f62c8290ef58f60a48fea5628f254d13ea", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/aaaec3f62c8290ef58f60a48fea5628f254d13ea", "message": "Fix error in ppl", "committedDate": "2020-05-20T03:46:28Z", "type": "commit"}, {"oid": "f638a6d7f9d10616936d663974f8416828046abd", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/f638a6d7f9d10616936d663974f8416828046abd", "message": "Add total and size field", "committedDate": "2020-05-20T16:18:44Z", "type": "commit"}, {"oid": "764262a2a4fad9e410bd48868d9d1e28655dd63a", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/764262a2a4fad9e410bd48868d9d1e28655dd63a", "message": "Refactor", "committedDate": "2020-05-20T17:03:22Z", "type": "commit"}, {"oid": "0791ff48bc1adba5ba8e2a463506a342a0b08fb1", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/0791ff48bc1adba5ba8e2a463506a342a0b08fb1", "message": "Refactor", "committedDate": "2020-05-20T17:12:14Z", "type": "commit"}, {"oid": "881bc889acda8f2e8c91c82dd6d693967ddaaff1", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/881bc889acda8f2e8c91c82dd6d693967ddaaff1", "message": "Refactor", "committedDate": "2020-05-20T17:12:54Z", "type": "commit"}, {"oid": "2ac3019bdc3c49f270b13921ae2e7d9e19546868", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/2ac3019bdc3c49f270b13921ae2e7d9e19546868", "message": "Refactor", "committedDate": "2020-05-20T17:15:57Z", "type": "commit"}, {"oid": "f48a8f28ad50dbdcfd4bf2ca3c4cb46b6a06ec1a", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/f48a8f28ad50dbdcfd4bf2ca3c4cb46b6a06ec1a", "message": "Add JavaDoc", "committedDate": "2020-05-20T17:19:54Z", "type": "commit"}, {"oid": "33df6f72e5332f59681a744b6d9c8ccbb6dfff60", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/33df6f72e5332f59681a744b6d9c8ccbb6dfff60", "message": "Add JavaDoc", "committedDate": "2020-05-20T17:27:23Z", "type": "commit"}, {"oid": "3e457537f0845baefc6c20428cbeec149de91d1a", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/3e457537f0845baefc6c20428cbeec149de91d1a", "message": "Merge branch 'feature/ppl' into add-table-formatter", "committedDate": "2020-05-20T17:41:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODIxNDYyMA==", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/476#discussion_r428214620", "bodyText": "it is possible the ExprValue has missing value, in this case, the type value may missing.\ne.g. [{\"name\": \"susan\"}, {\"name\": \"bob\", \"age\":30}].\nit may required the type info from the planner?", "author": "penghuo", "createdAt": "2020-05-20T18:18:10Z", "path": "protocol/src/main/java/com/amazon/opendistroforelasticsearch/sql/protocol/response/QueryResponse.java", "diffHunk": "@@ -0,0 +1,95 @@\n+/*\n+ *    Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ *    Licensed under the Apache License, Version 2.0 (the \"License\").\n+ *    You may not use this file except in compliance with the License.\n+ *    A copy of the License is located at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *    or in the \"license\" file accompanying this file. This file is distributed\n+ *    on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ *    express or implied. See the License for the specific language governing\n+ *    permissions and limitations under the License.\n+ *\n+ */\n+\n+package com.amazon.opendistroforelasticsearch.sql.protocol.response;\n+\n+import com.amazon.opendistroforelasticsearch.sql.data.model.ExprValue;\n+import com.amazon.opendistroforelasticsearch.sql.data.model.ExprValueUtils;\n+import lombok.RequiredArgsConstructor;\n+\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.Iterator;\n+import java.util.LinkedHashMap;\n+import java.util.Map;\n+\n+/**\n+ * Query response that encapsulates query results and isolate {@link ExprValue} related from formatter implementation.\n+ */\n+@RequiredArgsConstructor\n+public class QueryResponse implements Iterable<Object[]> {\n+\n+    /**\n+     * Results which are collection of expression\n+     */\n+    private final Collection<ExprValue> exprValues;\n+\n+\n+    /**\n+     * @return  size of results\n+     */\n+    public int size() {\n+        return exprValues.size();\n+    }\n+\n+    /**\n+     * Parse column name from results\n+     * @return  mapping from column names to its expression type\n+     */\n+    public Map<String, String> columnNameTypes() {\n+        if (exprValues.isEmpty()) {\n+            return Collections.emptyMap();\n+        }\n+\n+        Map<String, ExprValue> tupleValue = getFirstTupleValue();", "originalCommit": "3e457537f0845baefc6c20428cbeec149de91d1a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODI4NDY1Nw==", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/476#discussion_r428284657", "bodyText": "let's add Todo here.", "author": "penghuo", "createdAt": "2020-05-20T20:21:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODIxNDYyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODI4NTUyOQ==", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/476#discussion_r428285529", "bodyText": "Sure, I'm adding comment and a disabled UT. Thanks!", "author": "dai-chen", "createdAt": "2020-05-20T20:22:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODIxNDYyMA=="}], "type": "inlineReview"}, {"oid": "f5639904dad8ee63843a6d620b9b920541f51585", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/f5639904dad8ee63843a6d620b9b920541f51585", "message": "Add to-do and UT for missing values", "committedDate": "2020-05-20T20:33:44Z", "type": "commit"}]}