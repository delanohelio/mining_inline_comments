{"pr_number": 810, "pr_title": "add Request ID in log", "pr_createdAt": "2020-09-29T08:17:56Z", "pr_url": "https://github.com/vmware/singleton/pull/810", "timeline": [{"oid": "a4dca3457d4546eb63fb57c187d5894b689f167d", "url": "https://github.com/vmware/singleton/commit/a4dca3457d4546eb63fb57c187d5894b689f167d", "message": "fixed the Config file copyright files", "committedDate": "2020-08-31T07:15:05Z", "type": "commit"}, {"oid": "5d2b5e93e84ba71a26f265ffb651da03d6669d4b", "url": "https://github.com/vmware/singleton/commit/5d2b5e93e84ba71a26f265ffb651da03d6669d4b", "message": "fixed the Config file copyright files", "committedDate": "2020-08-31T08:42:43Z", "type": "commit"}, {"oid": "35a52bbaccc6abc1078279a23320c7e3fc553d61", "url": "https://github.com/vmware/singleton/commit/35a52bbaccc6abc1078279a23320c7e3fc553d61", "message": "fixed the Config file copyright files", "committedDate": "2020-08-31T08:47:37Z", "type": "commit"}, {"oid": "f86a41e2bc16238da4bcce01fd993d112a9d640a", "url": "https://github.com/vmware/singleton/commit/f86a41e2bc16238da4bcce01fd993d112a9d640a", "message": "fixed the timezone name data bug", "committedDate": "2020-09-10T06:13:51Z", "type": "commit"}, {"oid": "6d134b7fe444bcb47e0e2233784afbe469db71d8", "url": "https://github.com/vmware/singleton/commit/6d134b7fe444bcb47e0e2233784afbe469db71d8", "message": "Merge branch 'master' into master", "committedDate": "2020-09-10T06:19:18Z", "type": "commit"}, {"oid": "c7f8f81752b09757362d28fd95295c1d758da62d", "url": "https://github.com/vmware/singleton/commit/c7f8f81752b09757362d28fd95295c1d758da62d", "message": "Merge branch 'master' into master", "committedDate": "2020-09-14T09:16:35Z", "type": "commit"}, {"oid": "79e5bed73ba34c7309b3b0765f606ad0e4607213", "url": "https://github.com/vmware/singleton/commit/79e5bed73ba34c7309b3b0765f606ad0e4607213", "message": "Merge branch 'master' into master", "committedDate": "2020-09-15T00:01:53Z", "type": "commit"}, {"oid": "e606f065c5c83516776c6b1ec008e6c62536f683", "url": "https://github.com/vmware/singleton/commit/e606f065c5c83516776c6b1ec008e6c62536f683", "message": "change the timezone name format", "committedDate": "2020-09-15T03:11:11Z", "type": "commit"}, {"oid": "13dc86c8f218c3b6568d206072327f4d1e367aeb", "url": "https://github.com/vmware/singleton/commit/13dc86c8f218c3b6568d206072327f4d1e367aeb", "message": "change the timezone name format", "committedDate": "2020-09-15T04:11:58Z", "type": "commit"}, {"oid": "d44349bd8d1afb53d0f7200930d7e4772d891e52", "url": "https://github.com/vmware/singleton/commit/d44349bd8d1afb53d0f7200930d7e4772d891e52", "message": "Merge branch 'master' into master", "committedDate": "2020-09-15T05:06:10Z", "type": "commit"}, {"oid": "09e359a9388fe491a957bc116b411b850c60ba12", "url": "https://github.com/vmware/singleton/commit/09e359a9388fe491a957bc116b411b850c60ba12", "message": "change the timezone name format", "committedDate": "2020-09-15T05:23:08Z", "type": "commit"}, {"oid": "d10d71d9ce9e8581f96a6820f2b67f1b895c37e7", "url": "https://github.com/vmware/singleton/commit/d10d71d9ce9e8581f96a6820f2b67f1b895c37e7", "message": "change the timezone name format", "committedDate": "2020-09-15T06:13:10Z", "type": "commit"}, {"oid": "5f6290256d1cab810dad7e166cbc1b820ca4288e", "url": "https://github.com/vmware/singleton/commit/5f6290256d1cab810dad7e166cbc1b820ca4288e", "message": "change the timezone name format", "committedDate": "2020-09-15T06:36:08Z", "type": "commit"}, {"oid": "eb51a5c91f8416e26a6f54443044c43f83c37ea3", "url": "https://github.com/vmware/singleton/commit/eb51a5c91f8416e26a6f54443044c43f83c37ea3", "message": "fixed the comment", "committedDate": "2020-09-15T08:38:39Z", "type": "commit"}, {"oid": "b94ebdca0aae30370ee6736ca1a8947c001cedfa", "url": "https://github.com/vmware/singleton/commit/b94ebdca0aae30370ee6736ca1a8947c001cedfa", "message": "update the l2 jar content", "committedDate": "2020-09-16T01:15:19Z", "type": "commit"}, {"oid": "20d159dcd9455a01a13044f324418317ce95cb83", "url": "https://github.com/vmware/singleton/commit/20d159dcd9455a01a13044f324418317ce95cb83", "message": "Merge branch 'master' into master", "committedDate": "2020-09-16T01:30:23Z", "type": "commit"}, {"oid": "7368f78e4e0895e3f921ac976021bc9c3e157451", "url": "https://github.com/vmware/singleton/commit/7368f78e4e0895e3f921ac976021bc9c3e157451", "message": "Merge branch 'master' into master", "committedDate": "2020-09-16T05:34:48Z", "type": "commit"}, {"oid": "491d0a9ffb0e62e0166123c83c40c67d8b139a5e", "url": "https://github.com/vmware/singleton/commit/491d0a9ffb0e62e0166123c83c40c67d8b139a5e", "message": "Load formatting pattern lib from Maven instead of locally", "committedDate": "2020-09-16T05:41:19Z", "type": "commit"}, {"oid": "b424c27439236e77804e2de9d62be12b18c078bd", "url": "https://github.com/vmware/singleton/commit/b424c27439236e77804e2de9d62be12b18c078bd", "message": "update the timezonename list format", "committedDate": "2020-09-22T08:50:21Z", "type": "commit"}, {"oid": "f6b15c74bd7480e3f5ae51a2b9fc97beb01f47bc", "url": "https://github.com/vmware/singleton/commit/f6b15c74bd7480e3f5ae51a2b9fc97beb01f47bc", "message": "Merge branch 'master' into master", "committedDate": "2020-09-22T08:57:13Z", "type": "commit"}, {"oid": "c5afe2a26bac5536ea9e92b93219704db2fe7938", "url": "https://github.com/vmware/singleton/commit/c5afe2a26bac5536ea9e92b93219704db2fe7938", "message": "fixed the comment", "committedDate": "2020-09-23T05:51:23Z", "type": "commit"}, {"oid": "ad5f0ced6bdb24f481d2c42dbd2de63777fcc887", "url": "https://github.com/vmware/singleton/commit/ad5f0ced6bdb24f481d2c42dbd2de63777fcc887", "message": "fixed the snarqube upgrade jdk scan issue", "committedDate": "2020-09-23T07:16:39Z", "type": "commit"}, {"oid": "8d75f67b8fca00b5e338fed57e4d096d21be8431", "url": "https://github.com/vmware/singleton/commit/8d75f67b8fca00b5e338fed57e4d096d21be8431", "message": "fixed the snarqube upgrade jdk scan issue", "committedDate": "2020-09-23T07:35:13Z", "type": "commit"}, {"oid": "a75222a0d82f356568eadc2c7483d5c5222e70f6", "url": "https://github.com/vmware/singleton/commit/a75222a0d82f356568eadc2c7483d5c5222e70f6", "message": "Merge branch 'master' into master", "committedDate": "2020-09-23T07:47:24Z", "type": "commit"}, {"oid": "936a98646b4969d2ec13ff1c8154f9a8fd1c6908", "url": "https://github.com/vmware/singleton/commit/936a98646b4969d2ec13ff1c8154f9a8fd1c6908", "message": "fixed the snarqube upgrade jdk scan issue", "committedDate": "2020-09-23T08:18:26Z", "type": "commit"}, {"oid": "a6a891e60efbf787c4396bc140443df28c4d8ec9", "url": "https://github.com/vmware/singleton/commit/a6a891e60efbf787c4396bc140443df28c4d8ec9", "message": "fixed the snarqube upgrade jdk scan issue", "committedDate": "2020-09-23T08:38:54Z", "type": "commit"}, {"oid": "0498a6e901dc5cfc87fc649841606dec64be2843", "url": "https://github.com/vmware/singleton/commit/0498a6e901dc5cfc87fc649841606dec64be2843", "message": "fixed the scan bug", "committedDate": "2020-09-25T07:56:48Z", "type": "commit"}, {"oid": "d6e38a7a65101a6d8a2e0a3367cdec4837625d6c", "url": "https://github.com/vmware/singleton/commit/d6e38a7a65101a6d8a2e0a3367cdec4837625d6c", "message": "Merge branch 'master' into master", "committedDate": "2020-09-25T08:04:46Z", "type": "commit"}, {"oid": "2aa0aaa600479bc84cb07700691c356a5be63f76", "url": "https://github.com/vmware/singleton/commit/2aa0aaa600479bc84cb07700691c356a5be63f76", "message": "Merge branch 'master' into master", "committedDate": "2020-09-29T08:18:05Z", "type": "commit"}, {"oid": "8e00fa7ba438b0779317cd87aafc8df7cb170e72", "url": "https://github.com/vmware/singleton/commit/8e00fa7ba438b0779317cd87aafc8df7cb170e72", "message": "add the print client request id in log", "committedDate": "2020-09-29T09:38:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzU4NjYwMQ==", "url": "https://github.com/vmware/singleton/pull/810#discussion_r507586601", "bodyText": "add description to this method.", "author": "linr211", "createdAt": "2020-10-19T09:02:30Z", "path": "g11n-ws/vip-manager-i18n/src/main/java/com/vmware/vip/core/Interceptor/APIValidationInterceptor.java", "diffHunk": "@@ -108,5 +123,20 @@ public void afterCompletion(HttpServletRequest request,\n \t\t\tthrows Exception {\n \t\t // Do nothing because of not need to afterCompletion business\n \t}\n+\t\n+\t\n+\tprivate String getRequestId(HttpServletRequest request, List<String> headerNames) {", "originalCommit": "8e00fa7ba438b0779317cd87aafc8df7cb170e72", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzU4ODUwNg==", "url": "https://github.com/vmware/singleton/pull/810#discussion_r507588506", "bodyText": "miss space before and after '+'", "author": "linr211", "createdAt": "2020-10-19T09:05:33Z", "path": "g11n-ws/vip-manager-i18n/src/main/java/com/vmware/vip/core/Interceptor/APIValidationInterceptor.java", "diffHunk": "@@ -55,8 +69,9 @@ public APIValidationInterceptor(Map<String, Object> allowedListMap) {\n \tpublic boolean preHandle(HttpServletRequest request,\n \t\t\tHttpServletResponse response, Object handler) throws Exception {\n \t\tLOGGER.debug(request.getSession().getId());\n-\t\tString logOfUrl = \"The request url is: \" + request.getRequestURL();\n-\t\tString logOfQueryStr = \"The request query string is: \" + request.getQueryString();\n+\t\tString SingletonRequestID = getRequestId(request, this.clientRequestIds);\n+\t\tString logOfUrl = SingletonRequestID+\"The request url is: \" + request.getRequestURL();", "originalCommit": "8e00fa7ba438b0779317cd87aafc8df7cb170e72", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzU4OTI4NA==", "url": "https://github.com/vmware/singleton/pull/810#discussion_r507589284", "bodyText": "miss space before and after '+'", "author": "linr211", "createdAt": "2020-10-19T09:06:41Z", "path": "g11n-ws/vip-manager-i18n/src/main/java/com/vmware/vip/core/Interceptor/APIValidationInterceptor.java", "diffHunk": "@@ -81,7 +96,7 @@ public boolean preHandle(HttpServletRequest request,\n \t\t\t\treturn false;\n \t\t\t}\n \t\t}\n-\t\tString startHandle = \"[thread-\" + Thread.currentThread().getId() + \"] Start to handle request...\";\n+\t\tString startHandle = SingletonRequestID+\"[thread-\" + Thread.currentThread().getId() + \"] Start to handle request...\";", "originalCommit": "8e00fa7ba438b0779317cd87aafc8df7cb170e72", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzYyNjYxMg==", "url": "https://github.com/vmware/singleton/pull/810#discussion_r507626612", "bodyText": "Local variable and method parameter names should comply with a naming convention (squid:S00117)\nCODE_SMELLCode smellMINORMinor\nShared naming conventions allow teams to collaborate effectively. This rule raises an issue when a local variable or function parameter name does not match the provided regular expression.\nWith the default regular expression ^[a-z][a-zA-Z0-9]*$:", "author": "Xiaochao8", "createdAt": "2020-10-19T10:06:00Z", "path": "g11n-ws/vip-manager-i18n/src/main/java/com/vmware/vip/core/Interceptor/APIValidationInterceptor.java", "diffHunk": "@@ -55,8 +69,9 @@ public APIValidationInterceptor(Map<String, Object> allowedListMap) {\n \tpublic boolean preHandle(HttpServletRequest request,\n \t\t\tHttpServletResponse response, Object handler) throws Exception {\n \t\tLOGGER.debug(request.getSession().getId());\n-\t\tString logOfUrl = \"The request url is: \" + request.getRequestURL();\n-\t\tString logOfQueryStr = \"The request query string is: \" + request.getQueryString();\n+\t\tString SingletonRequestID = getRequestId(request, this.clientRequestIds);", "originalCommit": "8e00fa7ba438b0779317cd87aafc8df7cb170e72", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzYyODE2Mw==", "url": "https://github.com/vmware/singleton/pull/810#discussion_r507628163", "bodyText": "Are you sure there are multiple headers used to trace?", "author": "Xiaochao8", "createdAt": "2020-10-19T10:08:50Z", "path": "g11n-ws/vip-manager-i18n/src/main/java/com/vmware/vip/core/Interceptor/APIValidationInterceptor.java", "diffHunk": "@@ -35,9 +40,18 @@\n \tprivate static Logger LOGGER = LoggerFactory.getLogger(APIValidationInterceptor.class);\n \n \tprivate Map<String, Object> allowedListMap;\n-\tpublic APIValidationInterceptor(Map<String, Object> allowedListMap) {\n+\tprivate String clientRequestIdsStr;\n+\tprivate List<String> clientRequestIds;\n+\tpublic APIValidationInterceptor(Map<String, Object> allowedListMap, String clientReqIdsStr) {\n \t\tsuper();\n \t\tthis.allowedListMap = allowedListMap;\n+\t\tthis.clientRequestIdsStr = clientReqIdsStr;\n+\t\ttry {\n+\t\t\tthis.clientRequestIds = Arrays.asList(this.clientRequestIdsStr.split(ConstantsChar.COMMA));", "originalCommit": "8e00fa7ba438b0779317cd87aafc8df7cb170e72", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODIzOTYyMw==", "url": "https://github.com/vmware/singleton/pull/810#discussion_r508239623", "bodyText": "in Saas environment, need to support multiple headers", "author": "tigershi", "createdAt": "2020-10-20T06:29:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzYyODE2Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzYzMTMzOA==", "url": "https://github.com/vmware/singleton/pull/810#discussion_r507631338", "bodyText": "If config.client.requestIds is empty, then don't need to call this method in order to improve performance.", "author": "Xiaochao8", "createdAt": "2020-10-19T10:14:18Z", "path": "g11n-ws/vip-manager-i18n/src/main/java/com/vmware/vip/core/Interceptor/APIValidationInterceptor.java", "diffHunk": "@@ -55,8 +69,9 @@ public APIValidationInterceptor(Map<String, Object> allowedListMap) {\n \tpublic boolean preHandle(HttpServletRequest request,\n \t\t\tHttpServletResponse response, Object handler) throws Exception {\n \t\tLOGGER.debug(request.getSession().getId());\n-\t\tString logOfUrl = \"The request url is: \" + request.getRequestURL();\n-\t\tString logOfQueryStr = \"The request query string is: \" + request.getQueryString();\n+\t\tString SingletonRequestID = getRequestId(request, this.clientRequestIds);", "originalCommit": "8e00fa7ba438b0779317cd87aafc8df7cb170e72", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODI0NDY0Mw==", "url": "https://github.com/vmware/singleton/pull/810#discussion_r508244643", "bodyText": "Yes, you are right. I have done the business in start of the getRequetId method", "author": "tigershi", "createdAt": "2020-10-20T06:40:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzYzMTMzOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzYzMjgyNQ==", "url": "https://github.com/vmware/singleton/pull/810#discussion_r507632825", "bodyText": "Suggest to merge these 2 logs into 1. Add thread id and request id to this log, and remove thread id from line 99.", "author": "Xiaochao8", "createdAt": "2020-10-19T10:16:47Z", "path": "g11n-ws/vip-manager-i18n/src/main/java/com/vmware/vip/core/Interceptor/APIValidationInterceptor.java", "diffHunk": "@@ -55,8 +69,9 @@ public APIValidationInterceptor(Map<String, Object> allowedListMap) {\n \tpublic boolean preHandle(HttpServletRequest request,\n \t\t\tHttpServletResponse response, Object handler) throws Exception {\n \t\tLOGGER.debug(request.getSession().getId());\n-\t\tString logOfUrl = \"The request url is: \" + request.getRequestURL();\n-\t\tString logOfQueryStr = \"The request query string is: \" + request.getQueryString();\n+\t\tString SingletonRequestID = getRequestId(request, this.clientRequestIds);\n+\t\tString logOfUrl = SingletonRequestID+\"The request url is: \" + request.getRequestURL();", "originalCommit": "8e00fa7ba438b0779317cd87aafc8df7cb170e72", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "4d328ce6b9791ab8c3afd98089d0a2983d41844d", "url": "https://github.com/vmware/singleton/commit/4d328ce6b9791ab8c3afd98089d0a2983d41844d", "message": "fixed the comments reqeust ID", "committedDate": "2020-10-20T06:45:58Z", "type": "commit"}, {"oid": "bd5436b43f83deef9744338a7e2c8bd10e7ff11b", "url": "https://github.com/vmware/singleton/commit/bd5436b43f83deef9744338a7e2c8bd10e7ff11b", "message": "fixed the comments", "committedDate": "2020-10-21T09:12:18Z", "type": "commit"}]}