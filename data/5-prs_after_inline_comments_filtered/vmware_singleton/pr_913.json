{"pr_number": 913, "pr_title": "Fix Windows bug on getComponentMessages", "pr_createdAt": "2020-12-08T04:07:23Z", "pr_url": "https://github.com/vmware/singleton/pull/913", "timeline": [{"oid": "5f42099ac12f4359c243ad405efb814f3fd94804", "url": "https://github.com/vmware/singleton/commit/5f42099ac12f4359c243ad405efb814f3fd94804", "message": "Non-blocking getSupportedLocales", "committedDate": "2020-11-17T17:45:57Z", "type": "commit"}, {"oid": "a207056bed88cde53601edd708ae91fd6d47af9f", "url": "https://github.com/vmware/singleton/commit/a207056bed88cde53601edd708ae91fd6d47af9f", "message": "fixing failing test", "committedDate": "2020-11-17T22:13:49Z", "type": "commit"}, {"oid": "d291d7a04e00bd56a78149615e5bf1c6dffe95a6", "url": "https://github.com/vmware/singleton/commit/d291d7a04e00bd56a78149615e5bf1c6dffe95a6", "message": "code clean up", "committedDate": "2020-11-17T22:17:05Z", "type": "commit"}, {"oid": "134d23d8c2685edbe4b82d59739870e7b021860e", "url": "https://github.com/vmware/singleton/commit/134d23d8c2685edbe4b82d59739870e7b021860e", "message": "test", "committedDate": "2020-11-18T00:23:58Z", "type": "commit"}, {"oid": "a75c69b1b1a255519ec8e06ff11bcaef021229e2", "url": "https://github.com/vmware/singleton/commit/a75c69b1b1a255519ec8e06ff11bcaef021229e2", "message": "fix test", "committedDate": "2020-11-18T01:06:44Z", "type": "commit"}, {"oid": "de5850ad5190a38f0c3aee4b94602d2a5384aa77", "url": "https://github.com/vmware/singleton/commit/de5850ad5190a38f0c3aee4b94602d2a5384aa77", "message": "code clean up", "committedDate": "2020-11-18T01:36:11Z", "type": "commit"}, {"oid": "1c67db91591df11e8cd642210d94019fd5de56c7", "url": "https://github.com/vmware/singleton/commit/1c67db91591df11e8cd642210d94019fd5de56c7", "message": "code clean up", "committedDate": "2020-11-18T01:38:11Z", "type": "commit"}, {"oid": "d7b27c305b8851a72336741b0c4d9081c6644121", "url": "https://github.com/vmware/singleton/commit/d7b27c305b8851a72336741b0c4d9081c6644121", "message": "Refresh cache of supported locales in a separate thread", "committedDate": "2020-11-18T21:02:22Z", "type": "commit"}, {"oid": "a9b5238462e0043a61fd106d44e2f2acf4d6f476", "url": "https://github.com/vmware/singleton/commit/a9b5238462e0043a61fd106d44e2f2acf4d6f476", "message": "code clean up", "committedDate": "2020-11-18T21:15:59Z", "type": "commit"}, {"oid": "e1dca831225246a33e4a94fd746b2a2b0864a70c", "url": "https://github.com/vmware/singleton/commit/e1dca831225246a33e4a94fd746b2a2b0864a70c", "message": "code clean up", "committedDate": "2020-11-18T21:17:29Z", "type": "commit"}, {"oid": "7f05a14b8eec7eed046f2243fee5da8e6c3c61c1", "url": "https://github.com/vmware/singleton/commit/7f05a14b8eec7eed046f2243fee5da8e6c3c61c1", "message": "fixing sonarcube bug", "committedDate": "2020-11-19T01:00:11Z", "type": "commit"}, {"oid": "120e4d9475e2224189bbef81203f278c460d96c1", "url": "https://github.com/vmware/singleton/commit/120e4d9475e2224189bbef81203f278c460d96c1", "message": "code cleanup", "committedDate": "2020-11-19T01:08:47Z", "type": "commit"}, {"oid": "c0b385da498cfb7edd56e53c4fd661616a900391", "url": "https://github.com/vmware/singleton/commit/c0b385da498cfb7edd56e53c4fd661616a900391", "message": "sonarcube bug", "committedDate": "2020-11-19T03:32:39Z", "type": "commit"}, {"oid": "12cc751f788b20f5b77a031742467e37c5b0e0e5", "url": "https://github.com/vmware/singleton/commit/12cc751f788b20f5b77a031742467e37c5b0e0e5", "message": "code clean up", "committedDate": "2020-11-22T18:26:38Z", "type": "commit"}, {"oid": "d0dae5dcca2b92157818d1f8d34416d787cabcd3", "url": "https://github.com/vmware/singleton/commit/d0dae5dcca2b92157818d1f8d34416d787cabcd3", "message": "code clean up", "committedDate": "2020-11-22T19:58:16Z", "type": "commit"}, {"oid": "b86d3374fa641cfb1c43436bbebdc13509ada1db", "url": "https://github.com/vmware/singleton/commit/b86d3374fa641cfb1c43436bbebdc13509ada1db", "message": "Use getResourceAsStream to read bundle", "committedDate": "2020-11-30T21:52:52Z", "type": "commit"}, {"oid": "117b8b2131600336b0563874390108697b98444a", "url": "https://github.com/vmware/singleton/commit/117b8b2131600336b0563874390108697b98444a", "message": "code clean up", "committedDate": "2020-12-01T22:40:26Z", "type": "commit"}, {"oid": "7ae72d527ef95c5aefab314b1235b1cd75267b6e", "url": "https://github.com/vmware/singleton/commit/7ae72d527ef95c5aefab314b1235b1cd75267b6e", "message": "adding else block", "committedDate": "2020-12-02T17:34:33Z", "type": "commit"}, {"oid": "5c99efe185ef61b7a074b8cbc00a24463ea7a800", "url": "https://github.com/vmware/singleton/commit/5c99efe185ef61b7a074b8cbc00a24463ea7a800", "message": "Update src/main/java/com/vmware/vipclient/i18n/messages/api/opt/local/LocalMessagesOpt.java\n\nCo-authored-by: Xiaochao Li <48587632+Xiaochao8@users.noreply.github.com>", "committedDate": "2020-12-03T17:12:28Z", "type": "commit"}, {"oid": "e58155aebeaaf97b7cff398f9e22141c6713721d", "url": "https://github.com/vmware/singleton/commit/e58155aebeaaf97b7cff398f9e22141c6713721d", "message": "changes after code review", "committedDate": "2020-12-03T21:38:26Z", "type": "commit"}, {"oid": "cebb186d42c08a8a2171d8fa200cfcec0fecbce1", "url": "https://github.com/vmware/singleton/commit/cebb186d42c08a8a2171d8fa200cfcec0fecbce1", "message": "rename parameter", "committedDate": "2020-12-03T21:46:36Z", "type": "commit"}, {"oid": "4eb761b82c7b52c06668720213f915fe63cdf7f7", "url": "https://github.com/vmware/singleton/commit/4eb761b82c7b52c06668720213f915fe63cdf7f7", "message": "code clean up", "committedDate": "2020-12-03T22:59:06Z", "type": "commit"}, {"oid": "9fa2837842baae6e1297b5411c1fd8dec6954a72", "url": "https://github.com/vmware/singleton/commit/9fa2837842baae6e1297b5411c1fd8dec6954a72", "message": "Merge branch 'non-block-cache' of github.com:jessiejuachon/singleton into non-block-cache", "committedDate": "2020-12-03T22:59:54Z", "type": "commit"}, {"oid": "d6559b36f1a8c94dddb9b52c38ac025fb6b3ea88", "url": "https://github.com/vmware/singleton/commit/d6559b36f1a8c94dddb9b52c38ac025fb6b3ea88", "message": "thread safety", "committedDate": "2020-12-04T03:38:15Z", "type": "commit"}, {"oid": "5ab40c53fea011ae2e894a5c8e511a73a49be3cf", "url": "https://github.com/vmware/singleton/commit/5ab40c53fea011ae2e894a5c8e511a73a49be3cf", "message": "adding comment", "committedDate": "2020-12-04T03:52:03Z", "type": "commit"}, {"oid": "26bc13855d88e03b1890b8300d6b065b38a8b589", "url": "https://github.com/vmware/singleton/commit/26bc13855d88e03b1890b8300d6b065b38a8b589", "message": "space clean up", "committedDate": "2020-12-04T03:56:58Z", "type": "commit"}, {"oid": "f47feea51f629fd43fce5d37db886abd60ba831f", "url": "https://github.com/vmware/singleton/commit/f47feea51f629fd43fce5d37db886abd60ba831f", "message": "thread-safe file system access", "committedDate": "2020-12-04T05:58:28Z", "type": "commit"}, {"oid": "8f11aa817ce79100f273f64a1f62e42fa4546f9e", "url": "https://github.com/vmware/singleton/commit/8f11aa817ce79100f273f64a1f62e42fa4546f9e", "message": "optimizations", "committedDate": "2020-12-04T21:40:42Z", "type": "commit"}, {"oid": "84b6e2f49a6b61b1b693df24c5e2e9f4eb462023", "url": "https://github.com/vmware/singleton/commit/84b6e2f49a6b61b1b693df24c5e2e9f4eb462023", "message": "Merge remote-tracking branch 'upstream/g11n-java-client' into non-block-cache", "committedDate": "2020-12-04T22:49:18Z", "type": "commit"}, {"oid": "1d830b283732b915a0d9993cd291cb262325c83c", "url": "https://github.com/vmware/singleton/commit/1d830b283732b915a0d9993cd291cb262325c83c", "message": "removing file system lock from this PR (out of scope)", "committedDate": "2020-12-05T18:06:53Z", "type": "commit"}, {"oid": "b55e685870091baa74bf354458e566ce504e1038", "url": "https://github.com/vmware/singleton/commit/b55e685870091baa74bf354458e566ce504e1038", "message": "closing input stream", "committedDate": "2020-12-05T19:30:48Z", "type": "commit"}, {"oid": "d8ac6f6df8f74f120528d93ea25c27bf10197cb4", "url": "https://github.com/vmware/singleton/commit/d8ac6f6df8f74f120528d93ea25c27bf10197cb4", "message": "closing inputstream", "committedDate": "2020-12-05T19:46:27Z", "type": "commit"}, {"oid": "6e5e871b15351b59ead2feee67e5d04ac0ace8d7", "url": "https://github.com/vmware/singleton/commit/6e5e871b15351b59ead2feee67e5d04ac0ace8d7", "message": "Fixing windows bug on getComponentMessages", "committedDate": "2020-12-08T04:02:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODA4MTE0MA==", "url": "https://github.com/vmware/singleton/pull/913#discussion_r538081140", "bodyText": "Can \"/\" be suitable for all systems? Should it be FileSeparator?", "author": "huihuiw01", "createdAt": "2020-12-08T06:57:29Z", "path": "src/main/java/com/vmware/vipclient/i18n/messages/api/opt/local/LocalMessagesOpt.java", "diffHunk": "@@ -67,9 +67,11 @@ public void getComponentMessages(MessageCacheItem cacheItem) {\n \tprivate InputStream getInputStream() {\n \t\tString locale = LocaleUtility.fmtToMappedLocale(dto.getLocale()).toLanguageTag();\n \t\twhile (true) {\n-\t\t\tString filePath = FormatUtils.format(OFFLINE_RESOURCE_PATH, dto.getComponent(), locale);\n-\t\t\tPath path = Paths.get(VIPCfg.getInstance().getOfflineResourcesBaseUrl(), filePath);\n-\t\t\tInputStream is = Thread.currentThread().getContextClassLoader().getResourceAsStream(path.toString());\n+\t\t\tString offlineResourcePath = VIPCfg.getInstance().getOfflineResourcesBaseUrl();\n+\t\t\tif(!offlineResourcePath.endsWith(\"/\"))", "originalCommit": "6e5e871b15351b59ead2feee67e5d04ac0ace8d7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODYzODAzMQ==", "url": "https://github.com/vmware/singleton/pull/913#discussion_r538638031", "bodyText": "No, that is the root cause of the bug. If we use FileSeparator (same as Paths.get), then '' (backslash) will be used in Windows platform. However, the forward slash in jar is not platform dependent. Even if the application is run on a Windows platform, the jar files will still have forward slashes. The use of Paths.get (or FileSeparator) was causing the issue of not finding the message bundles.", "author": "jessiejuachon", "createdAt": "2020-12-08T17:31:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODA4MTE0MA=="}], "type": "inlineReview"}, {"oid": "6bb40e03c7d3679739cfa38d6c72450ef2f81f26", "url": "https://github.com/vmware/singleton/commit/6bb40e03c7d3679739cfa38d6c72450ef2f81f26", "message": "Merge remote-tracking branch 'upstream/g11n-java-client' into non-block-cache", "committedDate": "2020-12-08T17:29:33Z", "type": "commit"}]}